<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[三方支付真的香吗？日本iOS、Google三方支付调研报告]]></title>    <link>https://juejin.cn/post/7604853010171510825</link>    <guid>https://juejin.cn/post/7604853010171510825</guid>    <pubDate>2026-02-10T13:04:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010171510825" data-draft-id="7591506455973691446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="三方支付真的香吗？日本iOS、Google三方支付调研报告"/> <meta itemprop="keywords" content="iOS,Apple"/> <meta itemprop="datePublished" content="2026-02-10T13:04:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CocoaKier"/> <meta itemprop="url" content="https://juejin.cn/user/4388906146735864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            三方支付真的香吗？日本iOS、Google三方支付调研报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906146735864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CocoaKier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:04:09.000Z" title="Tue Feb 10 2026 13:04:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你以为的“三方支付”的样子，和苹果谷歌落地“三方支付”的样子，堪比网友见面、梦境与现实。</p>
<ul>
<li>抽成方面：即使你使用三方支付，苹果谷歌依然要抽成，只是换了个名字叫“商店服务费”，抽成并没有便宜多少。</li>
<li>财务对账：苹果谷歌为了审计你的三方支付的抽成，你需要每月和苹果谷歌对账、打款。</li>
<li>必须接入官方内购系统：即使使用三方支付，依然必须接入官方内购系统作为可选项，与三方支付并列显示。</li>
<li>劝退弹窗：用户使用三方支付时，会被苹果谷歌弹窗警告，“你即将离开安全环境”、“苹果将不再负责该交易的安全、退款及支持”等。</li>
</ul>
<p>下面是详细介绍。</p>
<h2 data-id="heading-0">一、抽成费率</h2>
<p>苹果和谷歌又将“三方支付”分为“应用内三方支付”、“网页外链支付”。顾名思义，“应用内三方支付”就是在应用内使用三方支付（例如接入PayPal SDK），“网页外链支付”就是跳出应用，打开外链支付。二者抽成比例是不一样的。</p>
<p><strong>苹果</strong></p>
<p>在日本，苹果将原来的“佣金”拆分成了 “商店服务费” 和 固定5%的“支付处理费”。如果使用三方支付，则不用出 5%“支付处理费”，但“商店服务费”还是得出。苹果：我聪明吧。</p>





























<table><thead><tr><th>方案</th><th>苹果收取的商店服务费</th><th>苹果收的支付服务费</th><th>苹果抽成合计</th></tr></thead><tbody><tr><td>官方内购</td><td>21% (小型开发者或订阅 10%)</td><td>5%</td><td>15% ~ 26%</td></tr><tr><td>App内三方支付</td><td>21% (小型开发者或订阅 10%)</td><td>0</td><td>10% ~ 21%</td></tr><tr><td>网页外链支付</td><td>15% (小型开发者或订阅 10%)</td><td>0</td><td>10% ~ 15%</td></tr></tbody></table>
<p>信源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fcn%2Fsupport%2Fapp-distribution-in-japan%2F" target="_blank" title="https://developer.apple.com/cn/support/app-distribution-in-japan/" ref="nofollow noopener noreferrer">Changes to iOS in Japan</a></p>
<p><strong>谷歌</strong></p>

























<table><thead><tr><th>场景</th><th>Google 收取的费率</th><th>谷歌抽成合计</th></tr></thead><tbody><tr><td>官方内购</td><td>30% (小型开发者或订阅 15%)</td><td>15% ~ 30%</td></tr><tr><td>App内三方支付</td><td>26% (小型开发者或订阅 11%)</td><td>11% ~ 26%</td></tr><tr><td>网页外链支付</td><td>20% (小型开发者或订阅 10%)</td><td>10% ~ 20%</td></tr></tbody></table>
<p>App内三方支付，4%优惠，信源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F11222040" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/11222040" ref="nofollow noopener noreferrer">自选结算系统优惠4%</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F13821247" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/13821247" ref="nofollow noopener noreferrer">Understanding user choice billing on Google Play</a>（文档里列出了JP）</p>
<p>网页外链支付，10%优惠，信源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F14372887" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/14372887" ref="nofollow noopener noreferrer">Enrolling in the external offers program</a></p>
<p><strong>费率小结：</strong><br/>
三方支付，支付通道（PayPal、Stripe等）收取的通道费一般在3%左右，所以三方支付的综合成本，应该在上面再加上3%。加完后，应用内三方支付和官方内购差别极小，毫无优势。只有“网页外链支付”在抽成方面占优势，但“网页外链支付”体验很差，用户可能更倾向选官方内购，导致“网页外链支付”实际使用率低，达不到降低抽成的效果。</p>
<h2 data-id="heading-1">二、申请开通</h2>
<p>使用三方支付（App内三方支付、网页外链支付）均需向苹果和谷歌提交申请，并签署新的协议条款。</p>
<h3 data-id="heading-2">向苹果提交申请</h3>
<p><strong>1、签署最新商业条款</strong></p>
<p>账号持有者（Account Holder）登录 Apple Developer 官网。 在协议（Agreements）页面，找到并签署针对日本地区的最新补充协议（如 Alternative Terms Addendum for Apps in Japan）。这代表你接受苹果的新版佣金结构及月度申报制度。</p>
<p><strong>2、提交在线申请表单</strong></p>
<p>（1）申请入口： 访问苹果官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3Dhttps%3A%2F%2Fdeveloper.apple.com%2Fcontact%2Frequest%2Fstorekit-external-purchase-link-jp%2F" target="_blank" title="https://www.google.com/search?q=https://developer.apple.com/contact/request/storekit-external-purchase-link-jp/" ref="nofollow noopener noreferrer">权限申请表单</a>（需登录）</p>
<p>（2）选择授权类型：</p>
<ul>
<li>外链支付：勾选 StoreKit External Purchase Link Entitlement (Japan)。</li>
<li>第三方支付：勾选 Alternative Payment Processor Entitlement (Japan)。</li>
</ul>
<p>（3）填写 App 详细信息：</p>
<ul>
<li>Bundle ID：必须是已经上架或准备在日本商店分发的 App ID。</li>
<li>支付网站域名：如果是申请外链支付，必须提供你计划链接到的顶级域名（URL 必须是 HTTPS 且归属于开发者）。</li>
<li>PSP 信息：如果是第三方内购，需要填写你合作的支付服务商名称（如 Stripe, PayPay 等）。</li>
</ul>
<h3 data-id="heading-3">向谷歌提交申请</h3>
<p>申请“第三方应用内支付”（Google Play External Payments Declaration Form）</p>
<p>1、主体要求： 必须是以“企业/组织”名义注册的账号（个人开发者目前很难申请通过）<br/>
2、目标市场： App 必须在日本市场分发，且该功能仅对日本用户生效。<br/>
3、技术准备： App 必须集成 Play Billing Library 8.2 或更高版本。即使申请通过，不调用新版本API没办法实现。<br/>
4、谷歌官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fgoogleplay%2Fandroid-developer%2Fanswer%2F16787536" target="_blank" title="https://support.google.com/googleplay/android-developer/answer/16787536" ref="nofollow noopener noreferrer">帮助文档页面</a>，找到“declaration form”入口进行意向申请 (提交后，谷歌会审核开发者身份，然后后台开放配置入口)<br/>
5、如果意向申请通过，Google Play Console -&gt; 在左侧菜单中找到 设置 (Settings) -&gt; 外部支付计划，这个页面可以提交计划使用的外部支付网址URL，然后供谷歌审核<br/>
6、提供详细信息：</p>
<blockquote>
<p>开发者账号ID：Google Play Console后台可查看的开发者账号ID<br/>
企业官方名称：必须与你申请开发者账号时提交的企业名称一致<br/>
企业注册地址：请使用注册公司所在国家/地区的官方语言输入地址<br/>
应用包名：填写要申请应用的包名，可以一次申请多个应用，但每个应用都需要符合日本分发要求。<br/>
账单寄送地址：谷歌在电子发票上显示的地址。用于财务对账和开票。<br/>
账单接收邮箱地址：谷歌会根据上报的金额按月向这个邮箱发送服务费账单<br/>
联系人邮箱：政策审核、技术问题、合规通知的接收邮箱<br/>
用户申诉的地址：一般可以是客服链接或者处理交易纠纷的邮箱地址</p>
</blockquote>
<h2 data-id="heading-4">三、每月对账：上报三方支付流水</h2>
<p>因为苹果和谷歌需要对三方支付抽成，所以需要按照平台要求，每月和苹果谷歌对账，提交三方支付流水。<strong>如果被发现瞒报、漏报，苹果和谷歌会采取极严厉的惩罚，包括：追缴欠款及利息；终止该权益的使用权限；</strong> <strong>封禁开发者账号。</strong></p>
<h3 data-id="heading-5">向苹果提交交易报告</h3>
<p>采用 <strong>API 实时上报 + 每月财务对账”</strong> 的模式。 注意，即使做了API实时上报，也必须做每月App Store Connect的对账进行二次确认。</p>
<p><strong>1、技术侧实时上报</strong></p>
<p>整体流程：客户端生成 Token (StoreKit 侧) =&gt; <strong>业务服务端</strong> =&gt; 苹果服务器</p>
<p>（1）App 调用 ExternalPurchase.present() (针对外链) 或 ExternalPurchase.purchase() (针对三方支付)</p>
<p>（2）如果用户在系统弹窗中点击了“继续”，StoreKit 会生成一个加密的 ExternalPurchaseToken（字符串格式）。这个 Token 包含了当前用户、当前 App 以及这次点击行为的唯一标识，它是苹果后续对账的唯一凭证，每月财务对账的csv文件里也需要包含该字段。</p>
<p>（3）客户端将token发送给业务服务端。业务服务器需要将这个 Token 与该用户的订单/会话进行关联。如果是外链支付，可能需要暂存这个 Token，等待用户在网页端完成支付</p>
<p>（4）服务器收到三方支付回调（确认钱已到账）后，必须立即（或在 24 小时内）通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fexternalpurchaseserverapi" target="_blank" title="https://developer.apple.com/documentation/externalpurchaseserverapi" ref="nofollow noopener noreferrer">External Purchase Server API</a> 调用 <strong>Send External Purchase Report</strong> 接口。</p>
<p>上报内容：你需要把从客户端拿到的 Token，连同实际的交易金额（Amount）、货币类型（Currency）以及交易时间戳一起发给苹果服务器。</p>
<p>退款上报：如果用户后来在三方支付端发起了退款，你的服务器也需要通过 API 向苹果上报这笔退款，否则苹果依然会扣你这笔订单的佣金。</p>
<p><strong>2、每月财务对账与支付</strong></p>
<p>（1）在<strong>每个日历月</strong>结束后的 <strong>15天内</strong>，你需要通过 <strong>App Store Connect</strong> 提交一份详细的交易报告。申报通常是上传一个 <strong>.csv 格式的模板文件</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">申报填写字段： 
<span class="hljs-title class_">App</span> <span class="hljs-title class_">Apple</span> <span class="hljs-variable constant_">ID</span>,纯数字,您 <span class="hljs-title class_">App</span> 的唯一 <span class="hljs-variable constant_">ID</span> 
<span class="hljs-title class_">Transaction</span> <span class="hljs-title class_">Date</span>,日期格式,交易发生的具体日期 
<span class="hljs-variable constant_">PSP</span> <span class="hljs-title class_">Name</span>,手动输入文本,您使用的支付服务商全称 
<span class="hljs-title class_">Purchase</span> <span class="hljs-title class_">Token</span>,字符串,技术端生成的唯一追踪标识符
<span class="hljs-title class_">Sales</span> <span class="hljs-title class_">Amount</span>,数字,用户实际支付的金额（需扣除交易税） 
</code></pre>
<p>（2）即使无交易也需汇报：如果该月没有产生任何三方支付流水，您依然需要提交一份“零交易汇报（Zero Transaction Report）”</p>
<p>（3）提交入口：App Store Connect - “Payments and Financial Reports” (付款和财务报告) 模块 - “External Purchases” (外部购买) 选项卡</p>
<p>（4）上传或确认数据：系统通常会根据您通过 API 上报的数据自动预填部分信息。您需要核对并上传最终的 CSV 格式报告，确保其与您的财务记录一致。</p>
<p>（5）苹果会根据你申报的销售额扣除佣金，然后向你发送电子发票。你需要按照发票金额，在规定时间内通过银行转账等方式向苹果支付这笔费用。</p>
<p>（6）注意：为了防止偷税漏税，苹果在协议中保留了<strong>强力审计权</strong>：苹果有权雇佣第三方审计机构检查你的财务账簿。如果被发现瞒报、漏报，苹果会采取极严厉的惩罚，包括：追缴欠款及利息；终止该权益的使用权限；封禁开发者账号。</p>
<h3 data-id="heading-6">向谷歌提交交易报告</h3>
<p>采用 <strong>"API 实时上报 + 开发者后台汇总确认"</strong> 的模式。谷歌不用每月手动上报，采用全自动上报模式，但需要核对漏报进行补报。</p>
<p><strong>1、技术侧实时上报</strong><br/>
与苹果相比，谷歌的流程更强调实时性 <strong>（24小时内）</strong> 和交易类型的精细化。</p>
<p>整体流程：客户端生成 Token (externalTransactionToken) =&gt; <strong>业务服务端</strong> =&gt; 谷歌服务器</p>
<p>（1）当用户在 App 内选择三方支付或点击外链，并在 Google Play 弹出的系统底页（Disclosure Sheet）点击“确认”后，Billing Library 会向你的 App 返回一个 <strong>externalTransactionToken</strong>。App 必须将此 Token 连同订单信息传给你的业务后端。它是这笔交易唯一的身份凭证。</p>
<p>（2）每当三方支付成功后，你必须在 <strong>24 小时内</strong> 通过<strong>服务端</strong>调用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fandroid-publisher%2Fapi-ref%2Frest%2Fv3%2Fexternaltransactions%2F" target="_blank" title="https://developers.google.com/android-publisher/api-ref/rest/v3/externaltransactions/" ref="nofollow noopener noreferrer">externaltransactions API</a>。<strong>内容</strong>：上报 Token、交易金额、货币、时间戳、税收地址（日本区对税收合规要求严格）以及交易类型。</p>
<pre><code class="hljs language-json" lang="json">你的服务器需要使用一个拥有 Reply to reviews 或 Manage orders 权限的 Google Cloud 服务账号 (Service Account)。

业务服务端调用上报接口
接口地址： POST https<span class="hljs-punctuation">:</span><span class="hljs-comment">//androidpublisher.googleapis.com/androidpublisher/v3/applications/{packageName}/externalTransactions?externalTransactionId={ID}</span>
URL参数：externalTransactionId：由你定义的唯一订单号（建议使用你数据库里的自增 ID 或 UUID）。

请求body参数：
<span class="hljs-punctuation">{</span>
 <span class="hljs-attr">"externalTransactionToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"从客户端传来的Token"</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">"transactionTime"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T10:00:00Z"</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">"oneTimeTransaction"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"fullPrice"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
   <span class="hljs-attr">"amountMicros"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1000000"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 代表 1.00 货币单位（百万分之一单位）</span>
   <span class="hljs-attr">"currency"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JPY"</span>
  <span class="hljs-punctuation">}</span>
 <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
 <span class="hljs-comment">// 或者如果是订阅</span>
 <span class="hljs-comment">// "recurringTransaction": { ... },</span>
 <span class="hljs-attr">"userTaxAddress"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"regionCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JP"</span> <span class="hljs-comment">// 对日本区对账极其重要</span>
 <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>（3）<strong>异常处理</strong>：如果在 API 上报过程中出现了由于网络等原因导致的漏报，你需要在次月 <strong>5 个工作日内</strong> 通过 API 补报（补报之前的漏单）</p>
<p>（4）<strong>下载报告核对</strong>：你可以从 Google Play Console 的 <code>创收</code> &gt; <code>备选的结算系统</code> 中导出谷歌生成的报告，将其与你自己的数据库进行核对。如果金额对不上，通常是因为你漏报了某些 API 请求。</p>
<p> 
参考资料：<br/>
创建/上报交易 (Create Transaction)
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fandroid-publisher%2Fapi-ref%2Frest%2Fv3%2Fexternaltransactions%2Fcreate" target="_blank" title="https://developers.google.com/android-publisher/api-ref/rest/v3/externaltransactions/create" ref="nofollow noopener noreferrer">developers.google.com/android-pub…</a><br/>
注：在该页面左侧菜单可以看到 get 和 refund（退款）接口</p>
<p>备选结算系统（Alternative Billing）集成指南<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fgoogle%2Fplay%2Fbilling%2Falternative" target="_blank" title="https://developer.android.com/google/play/billing/alternative" ref="nofollow noopener noreferrer">developer.android.com/google/play…</a><br/>
此页面包含了“报告外部交易”的技术步骤说明。</p>
<p><strong>2、</strong> <strong>账单确认与支付</strong><br/>
<strong>生成账单</strong>：谷歌会根据你 API 上报的数据，在次月生成汇总账单。<br/>
<strong>支付方式</strong>：不像苹果通常需要你主动汇款，谷歌通常会从你账户绑定的<strong>结算方式（信用卡或付款资料）</strong> 中<strong>直接扣除</strong>这部分佣金，或者发送正式账单让你在规定时间内支付。</p>
<h2 data-id="heading-7">四、严苛的“劝退式”交互</h2>
<p>为了保护自己的生态，<strong>两大巨头</strong>在用户体验上设置了重重障碍：</p>
<p><strong>内购强制接入：</strong> 苹果和谷歌均要求，开发者不能仅提供第三方支付，必须同时接入官方内购作为选项，且官方支付按钮的醒目程度必须不低于第三方支付。</p>
<p><strong>劝退的风险弹窗：</strong> 用户在点击第三方支付链接时，系统会弹出充满“警告色”的通知（如：“你即将离开安全环境”、“苹果将不再负责该交易的安全、退款及支持”等），这极大地增加了用户的跳失率。</p>
<h2 data-id="heading-8">五、总结</h2>
<h3 data-id="heading-9">1、并没有消失的“平台税”</h3>
<p>先看抽成方面。</p>
<p>通过应用内三方支付SDK方式接入，体验较好，但抽成比例和官方支付差别很小，<strong>可以省约 1%~2%</strong> ；<strong>只有通过外链跳出App支付这种方式接入，省的比较多，可以省7%左右，但这种方式体验较差，再加上平台强制“风险警告弹窗”，即使接入了这种支付方式，最终又有多少比例的用户会选择这种支付方式呢？所以，这个7%可能需要打个大折扣。</strong></p>
<p>总结起来就是，接入三方支付并不一定会“省钱”。</p>
<h3 data-id="heading-10">2、从运营成本方面看</h3>
<p>一旦采用第三方支付，开发者需要承担原本由平台处理的大量行政工作：</p>
<p><strong>每月结算申报：</strong> 开发者必须<strong>每月</strong>手动向苹果/谷歌<strong>申报</strong>通过第三方渠道产生的流水，<strong>并根据申报单向平台转账支付佣金</strong>。</p>
<p><strong>自理客服与退款：</strong> 所有的<strong>退款申请、订阅管理和支付争议</strong>，平台一概不管，开发者必须建立自己的客服团队来处理这些琐事。</p>
<p><strong>接受审计风险：</strong> 平台保留对开发者财务记录进行审计的权利。如果瞒报、（人员或技术疏忽导致的）漏报三方支付流水，可能面临权利被限制、下架或封号等风险。</p>
<h3 data-id="heading-11">3、过审可能变得困难</h3>
<p><strong>接入三方支付，会增加包体提审被拒的风险。</strong></p>
<p>作为开发者，<strong>提审时需要额外在审核备注里说明接入了三方支付，并提供支付流程截图或视频</strong>。</p>
<p>作为审核人员，也会额外“关照”接入了三方支付的应用，检查是否符合相关审核要求。</p>
<p>包体层面，接入三方支付，势必会在包体里加入<strong>支付判断、支付切换，或者嵌入三方支付SDK 等高风险行为。机器审核有可能误判为切支付、隐藏功能，增加过审难度。</strong></p>
<h3 data-id="heading-12">4、可能失去官方推荐资格</h3>
<p>虽然苹果和谷歌官方层面没有明确表明，接入三方支付的应用不会被推荐。<strong>但从平台的角度出发，加入三方支付，很大程度上会影响被平台推荐的可能性。</strong></p>
<p><strong>苹果</strong><br/>
官方口径： 只要符合 Guideline 3.1.1(a) 且已获得 Entitlement 授权，应用在法律上具备推荐资格。</p>
<p>实际：苹果的推荐位是由其编辑团队（App Store Editors）<strong>人工筛选的</strong>。他们的考核标准中，“用户体验的一致性”权重极高。三方支付必须弹出一个“离开 App”的系统警告框。对于编辑来说，这种“打断感”被视为用户体验的瑕疵。编辑团队通常倾向于推荐那些能给平台带来完整生态价值（包括 IAP 闭环）的应用。</p>
<p><strong>谷歌</strong><br/>
官方口径： 参与 User Choice Billing (UCB) 计划的应用，其推荐资格不受限制。</p>
<p>实际： 算法决定了你是否能进入备选池，人工决定了你是否被推荐。谷歌的自动化推荐算法（如“猜你喜欢”）基于转化率和评分。如果三方支付导致支付流程变长、跳出率增加，你的算法推荐位会自然下降。针对三方支付的退款请求，务必在 App 内提供显著的客服入口，避免用户在商店留下“无法退款，骗钱”的差评，这是算法降权的头号原因。</p>
<p><strong>结语</strong></p>
<p>看完上面的内容，你还会觉得“三方支付真香”吗？</p>
<p>而且，后续如果其它国家或地区吵着要开三方支付，大概率也会遵循上面日本的范式。</p>
<p>放弃幻想吧，宝子们！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ff5a959b2b4ccbbd4575a75ec03133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29jb2FLaWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771333456&amp;x-signature=2vwqdVUboQd3lh%2B%2F6fPg%2BxHvn64%3D" alt="理想与现实的落差.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain 进阶实战：当 Memory 遇上 OutputParser，打造有记忆的结构化助手]]></title>    <link>https://juejin.cn/post/7605051978872078355</link>    <guid>https://juejin.cn/post/7605051978872078355</guid>    <pubDate>2026-02-10T13:25:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978872078355" data-draft-id="7605041451327553579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain 进阶实战：当 Memory 遇上 OutputParser，打造有记忆的结构化助手"/> <meta itemprop="keywords" content="前端,LangChain"/> <meta itemprop="datePublished" content="2026-02-10T13:25:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain 进阶实战：当 Memory 遇上 OutputParser，打造有记忆的结构化助手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:25:23.000Z" title="Tue Feb 10 2026 13:25:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当前的 LLM 应用开发中，我们经常陷入两个极端的场景：</p>
<ol>
<li><strong>记性好的话痨</strong>：类似于 ChatBot，能记住上下文，聊天体验流畅，但输出全是不可控的自然语言。</li>
<li><strong>一次性的 API</strong>：类似于信息提取工具，能返回标准的 JSON 数据，但它是“无状态”的，每一轮调用都是全新的开始。</li>
</ol>
<p>然而，在复杂的业务系统中，我们往往需要二者兼备：<strong>既要像人一样拥有记忆上下文的能力，又要像传统 API 一样返回严格的结构化数据（JSON）。</strong></p>
<p>本文将基于 LangChain (LCEL) 体系，讲解如何将 <strong>Memory (记忆模块)</strong>  与 <strong>OutputParser (输出解析器)</strong>  结合，打造一个既懂业务逻辑又能规范输出的智能助手。</p>
<h2 data-id="heading-0">第一部分：记忆的载体 (Review)</h2>
<p>我们在之前的工程实践中已经明确：LLM 本身是无状态的（Stateless）。为了维持对话的连续性，我们需要在应用层手动维护历史消息。</p>
<p>在 LangChain 中，RunnableWithMessageHistory 是实现这一功能的核心容器。它的工作原理非常直观：</p>
<ol>
<li><strong>读取</strong>：在调用大模型前，从存储介质（Memory）中读取历史对话。</li>
<li><strong>注入</strong>：将历史对话填充到 Prompt 的占位符（Placeholder）中。</li>
<li><strong>保存</strong>：模型返回结果后，将“用户输入”和“AI 回复”追加到 Memory 中。</li>
</ol>
<p>这是让 AI “拥有记忆”的基础设施。</p>
<h2 data-id="heading-1">第二部分：输出的规整 (The Parser)</h2>
<p>模型原生的输出是 BaseMessage 或纯文本字符串。直接在业务代码中使用 JSON.parse() 处理模型输出是非常危险的，原因如下：</p>
<ul>
<li><strong>幻觉与废话</strong>：模型可能会在 JSON 前后添加 "Here is your JSON" 之类的自然语言。</li>
<li><strong>格式错误</strong>：Markdown 代码块符号（```json）会破坏 JSON 结构。</li>
<li><strong>字段缺失</strong>：模型可能忘记输出某些关键字段。</li>
</ul>
<p>LangChain 提供了 OutputParser 组件来充当“翻译官”和“校验员”。</p>
<h3 data-id="heading-2">1. StringOutputParser</h3>
<p>最基础的解析器。它将模型的输出（Message 对象）转换为字符串，并自动去除首尾的空白字符。这在处理简单的文本生成任务时非常有用。</p>
<h3 data-id="heading-3">2. StructuredOutputParser (重点)</h3>
<p>这是工程化中最常用的解析器。它通常与 Zod 库结合使用，能够：</p>
<ul>
<li><strong>生成提示词</strong>：自动生成一段 Prompt，告诉模型“你需要按照这个 JSON Schema 输出”。</li>
<li><strong>解析结果</strong>：将模型返回的文本清洗并解析为标准的 JavaScript 对象。</li>
<li><strong>校验数据</strong>：确保返回的数据类型符合定义（如 age 必须是数字）。</li>
</ul>
<h2 data-id="heading-4">第三部分：核心实战 (The Fusion)</h2>
<p>接下来，我们将构建一个**“用户信息收集助手”**。<br/>
<strong>需求</strong>：助手与用户对话，记住用户的名字（Memory），并根据对话内容提取用户的详细信息（Parser），最终输出包含 { name, age, job } 的标准 JSON 对象。</p>
<p>以下是基于 LangChain LCEL 的完整实现代码：</p>
<h3 data-id="heading-5">1. 环境准备与依赖</h3>
<p>确保安装了 @langchain/core, @langchain/deepseek, zod。</p>
<h3 data-id="heading-6">2. 代码实现</h3>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatDeepSeek</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/deepseek"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatPromptTemplate</span>, <span class="hljs-title class_">MessagesPlaceholder</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/prompts"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RunnableWithMessageHistory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/runnables"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">InMemoryChatMessageHistory</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/chat_history"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StructuredOutputParser</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/output_parsers"</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">"zod"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'dotenv/config'</span>;

<span class="hljs-comment">// 1. 定义输出结构 (Schema)</span>
<span class="hljs-comment">// 我们希望模型最终返回的数据格式</span>
<span class="hljs-keyword">const</span> parser = <span class="hljs-title class_">StructuredOutputParser</span>.<span class="hljs-title function_">fromZodSchema</span>(
  z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的姓名，如果未知则为 null"</span>),
    <span class="hljs-attr">age</span>: z.<span class="hljs-title function_">number</span>().<span class="hljs-title function_">nullable</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的年龄，如果未知则为 null"</span>),
    <span class="hljs-attr">job</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">nullable</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"用户的职业，如果未知则为 null"</span>),
    <span class="hljs-attr">response</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">"AI 对用户的自然语言回复"</span>)
  })
);

<span class="hljs-comment">// 获取格式化指令，这会自动生成一段类似 "You must format your output as a JSON value..." 的文本</span>
<span class="hljs-keyword">const</span> formatInstructions = parser.<span class="hljs-title function_">getFormatInstructions</span>();

<span class="hljs-comment">// 2. 初始化模型</span>
<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"deepseek-chat"</span>, <span class="hljs-comment">// 使用适合对话的模型</span>
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 设为 0 以提高结构化输出的稳定性</span>
});

<span class="hljs-comment">// 3. 构建 Prompt 模板</span>
<span class="hljs-comment">// 关键点：</span>
<span class="hljs-comment">// - history: 用于存放历史记忆</span>
<span class="hljs-comment">// - format_instructions: 用于告诉模型如何输出 JSON</span>
<span class="hljs-keyword">const</span> prompt = <span class="hljs-title class_">ChatPromptTemplate</span>.<span class="hljs-title function_">fromMessages</span>([
  [<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个用户信息收集助手。你的目标是从对话中提取用户信息。\n{format_instructions}"</span>],
  [<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{history}"</span>], <span class="hljs-comment">// 历史消息占位符</span>
  [<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>]
]);

<span class="hljs-comment">// 4. 构建处理链 (Chain)</span>
<span class="hljs-comment">// 数据流向：Prompt -&gt; Model -&gt; Parser</span>
<span class="hljs-keyword">const</span> chain = prompt.<span class="hljs-title function_">pipe</span>(model).<span class="hljs-title function_">pipe</span>(parser);

<span class="hljs-comment">// 5. 挂载记忆模块</span>
<span class="hljs-comment">// 使用内存存储历史记录 (生产环境应替换为 Redis 等)</span>
<span class="hljs-keyword">const</span> messageHistory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryChatMessageHistory</span>();

<span class="hljs-keyword">const</span> chainWithHistory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RunnableWithMessageHistory</span>({
  <span class="hljs-attr">runnable</span>: chain,
  <span class="hljs-attr">getMessageHistory</span>: <span class="hljs-keyword">async</span> (sessionId) =&gt; {
    <span class="hljs-comment">// 实际业务中应根据 sessionId 获取对应的历史记录</span>
    <span class="hljs-keyword">return</span> messageHistory;
  },
  <span class="hljs-attr">inputMessagesKey</span>: <span class="hljs-string">"input"</span>,
  <span class="hljs-attr">historyMessagesKey</span>: <span class="hljs-string">"history"</span>,
});

<span class="hljs-comment">// 6. 执行与测试</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> sessionId = <span class="hljs-string">"user_session_123"</span>;

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"--- 第一轮对话 ---"</span>);
  <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> chainWithHistory.<span class="hljs-title function_">invoke</span>(
    {
      <span class="hljs-attr">input</span>: <span class="hljs-string">"你好，我叫陈总，我是一名全栈工程师。"</span>,
      <span class="hljs-attr">format_instructions</span>: formatInstructions <span class="hljs-comment">// 注入格式化指令</span>
    },
    { <span class="hljs-attr">configurable</span>: { sessionId } }
  );
  
  <span class="hljs-comment">// 此时 res1 已经是一个标准的 JSON 对象，而不是字符串</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"解析后的输出:"</span>, res1);
  <span class="hljs-comment">// 输出示例: { name: '陈总', age: null, job: '全栈工程师', response: '你好陈总，很高兴认识你！' }</span>

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"\n--- 第二轮对话 ---"</span>);
  <span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">await</span> chainWithHistory.<span class="hljs-title function_">invoke</span>(
    {
      <span class="hljs-attr">input</span>: <span class="hljs-string">"我今年35岁了。"</span>,
      <span class="hljs-attr">format_instructions</span>: formatInstructions
    },
    { <span class="hljs-attr">configurable</span>: { sessionId } }
  );

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"解析后的输出:"</span>, res2);
  <span class="hljs-comment">// 输出示例: { name: '陈总', age: 35, job: '全栈工程师', response: '好的，记录下来了，你今年35岁。' }</span>
}

<span class="hljs-title function_">run</span>();
</code></pre>
<h2 data-id="heading-7">第四部分：工程化思考</h2>
<p>在将 Memory 和 Parser 结合时，有几个关键的工程细节需要注意：</p>
<h3 data-id="heading-8">1. 数据流向与调试</h3>
<p>在上面的代码中，数据流向是：<br/>
User Input -&gt; Prompt Template (注入 History + Format Instructions) -&gt; LLM -&gt; String Output -&gt; Output Parser -&gt; JSON Object。</p>
<p>如果你发现报错，通常是因为模型没有严格遵循 formatInstructions。建议在开发阶段使用 ConsoleCallbackHandler 或 LangSmith 监控中间步骤，查看传递给模型的最终 Prompt 是否包含了正确的 JSON Schema 定义。</p>
<h3 data-id="heading-9">2. 记忆存储的内容</h3>
<p>这是一个极其容易被忽略的点：<strong>Memory 中到底存了什么？</strong></p>
<p>在 RunnableWithMessageHistory 的默认行为中，它会尝试存储 Chain 的输入和输出。</p>
<ul>
<li><strong>输入</strong>：{ input: "..." } (文本)</li>
<li><strong>输出</strong>：经过 Parser 处理后的 <strong>JSON 对象</strong>。</li>
</ul>
<p>当下一轮对话开始时，LangChain 会尝试将这个 JSON 对象注入到 Prompt 的 {history} 中。虽然 LangChain 会尝试将其序列化为字符串，但为了保证 Prompt 的语义清晰，建议模型生成的 response 字段专门用于维持对话上下文，而结构化数据则用于业务逻辑处理。</p>
<h3 data-id="heading-10">3. Token 消耗</h3>
<p>引入 StructuredOutputParser 会显著增加 Prompt 的长度（因为它注入了复杂的 Schema 定义）。在多轮对话中，如果历史记录也越来越长，很容易超出上下文窗口或导致 API 费用激增。务必配合 ConversationSummaryMemory（摘要记忆）或限制历史消息条数。</p>
<h2 data-id="heading-11">结语</h2>
<p>LangChain 的魅力在于其组件的积木式组合。通过将 RunnableWithMessageHistory（状态管理）与 StructuredOutputParser（输出规整）串联，我们将 LLM 从一个“不可控的聊天机器人”进化为了一个“有状态的业务处理单元”。</p>
<p>掌握这一套组合拳，是在生产环境构建复杂 AI Agent 的必经之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理解链表算法：从基础操作到高级应用]]></title>    <link>https://juejin.cn/post/7604846849464533044</link>    <guid>https://juejin.cn/post/7604846849464533044</guid>    <pubDate>2026-02-10T13:37:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604846849464533044" data-draft-id="7605042079668486159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理解链表算法：从基础操作到高级应用"/> <meta itemprop="keywords" content="后端,JavaScript,算法"/> <meta itemprop="datePublished" content="2026-02-10T13:37:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜酱"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理解链表算法：从基础操作到高级应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:37:16.000Z" title="Tue Feb 10 2026 13:37:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读41分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">理解链表算法：从基础操作到高级应用</h2>
<p>链表是算法面试中<strong>最高频的考点之一</strong>，其「非连续存储」的特性决定了它的解题思路和数组有本质区别——指针操作、边界处理、虚拟头节点等技巧贯穿始终。本文将从链表的核心解题思想出发，拆解合并、分解、指针技巧、运算四大类经典题型，结合LeetCode高频题给出最优解，并标注面试中最容易踩坑的易错点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2441ad45a51408ebc4deae02c84aa5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771335554&amp;x-signature=7pSmbisfcctEWWu3Pp04nVULW4g%3D" alt="link_1.png" loading="lazy"/></p>

<h3 data-id="heading-1">一、核心解题思想：先掌握这3个通用技巧</h3>
<p>在开始刷题前，先牢记链表题的「三板斧」，能解决80%的问题：</p>
<h4 data-id="heading-2">1. 虚拟头节点（Dummy Node）</h4>
<p><strong>适用场景</strong>：需要创建/修改链表（如合并、删除、分解），避免处理「头节点为空」的边界情况。</p>
<p><strong>核心价值</strong>：让「删除头节点」和「删除中间节点」、「创建新链表头」和「拼接后续节点」的逻辑完全统一。</p>
<p><strong>示例</strong>：合并两个链表时，用<code>dummy = new ListNode(-1)</code>作为占位符，最终返回<code>dummy.next</code>即可。</p>
<h4 data-id="heading-3">2. 双指针技巧</h4>
<p>链表的绝大多数经典问题（中点、倒数k、环、相交）都依赖双指针，核心是通过指针的「步长差」或「路径差」实现目标：</p>
<ul>
<li>
<p>快慢指针：慢指针走1步，快指针走2步（中点、环检测）；</p>
</li>
<li>
<p>前后指针：前驱指针记录「待删除节点的前一个节点」（删除重复、倒数k）；</p>
</li>
<li>
<p>互换指针：遍历完A链表接B链表，遍历完B链表接A链表（链表相交）。</p>
</li>
</ul>
<h4 data-id="heading-4">3. 栈/堆的辅助使用</h4>
<ul>
<li>
<p>栈：解决「正序链表逆序操作」（如445题两数相加II，正序链表转逆序取数）；</p>
</li>
<li>
<p>最小堆（优先队列）：解决「多链表合并」（如合并k个升序链表、有序矩阵找第k小）。</p>
</li>
</ul>
<h3 data-id="heading-5">二、经典题型拆解（附最优解+易错点）</h3>
<h4 data-id="heading-6">（一）链表的合并：从2个到k个，再到矩阵/数组的「伪合并」</h4>
<p>合并类问题的核心是「筛选最小值/符合条件的值，按序拼接」，从基础的2个链表合并，可延伸到k个链表、有序矩阵等场景。</p>
<h5 data-id="heading-7">1. 合并两个升序链表（LeetCode 21）</h5>
<p><strong>题目要求</strong>：将两个升序链表合并为一个新的升序链表。</p>
<p><strong>核心思路</strong>：双指针「拉拉链」——两个指针分别遍历两个链表，每次选值更小的节点接入新链表，遍历完一个后直接拼接另一个的剩余部分。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">l1</span> - 升序链表1
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">l2</span> - 升序链表2
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 合并后的升序链表
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">mergeTwoLists</span>(<span class="hljs-params">l1, l2</span>) {
    <span class="hljs-comment">// 虚拟头节点：避免处理l1/l2为空的情况</span>
    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p = dummy; <span class="hljs-comment">// 新链表的尾指针</span>
    <span class="hljs-keyword">let</span> p1 = l1, p2 = l2;

    <span class="hljs-comment">// 核心：选更小的节点接入新链表</span>
    <span class="hljs-keyword">while</span> (p1 !== <span class="hljs-literal">null</span> &amp;&amp; p2 !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (p1.<span class="hljs-property">val</span> &lt;= p2.<span class="hljs-property">val</span>) {
            p.<span class="hljs-property">next</span> = p1;
            p1 = p1.<span class="hljs-property">next</span>;
        } <span class="hljs-keyword">else</span> {
            p.<span class="hljs-property">next</span> = p2;
            p2 = p2.<span class="hljs-property">next</span>;
        }
        p = p.<span class="hljs-property">next</span>; <span class="hljs-comment">// 尾指针后移</span>
    }

    <span class="hljs-comment">// 拼接剩余节点（剩余部分本身有序）</span>
    p.<span class="hljs-property">next</span> = p1 === <span class="hljs-literal">null</span> ? p2 : p1;
    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
}
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>忘记拼接剩余节点，导致结果缺失部分链表；</p>
</li>
<li>
<p>尾指针<code>p</code>未后移，始终覆盖<code>dummy.next</code>，最终只保留最后一个节点。</p>
</li>
</ul>
<h5 data-id="heading-8">2. 合并k个升序链表（LeetCode 23）</h5>
<p><strong>题目要求</strong>：合并k个升序链表，返回合并后的升序链表。</p>
<p><strong>核心思路</strong>：最小堆筛选最小值——用堆存储各链表的当前节点，每次取堆顶（最小值）接入新链表，再将该链表的下一个节点入堆。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode[]</span>} <span class="hljs-variable">lists</span> - k个升序链表数组
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 合并后的链表
 */</span>
<span class="hljs-keyword">var</span> mergeKLists = <span class="hljs-keyword">function</span>(<span class="hljs-params">lists</span>) {
    <span class="hljs-keyword">const</span> k = lists.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">if</span> (k === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 定义最小堆（按节点值排序）</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">MinHeap</span> {
        <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span> = [];
        }
        <span class="hljs-title function_">push</span>(<span class="hljs-params">node</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-title function_">push</span>(node);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swim</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
        }
        <span class="hljs-title function_">pop</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> min = <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">const</span> last = <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-title function_">pop</span>();
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[<span class="hljs-number">0</span>] = last;
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sink</span>(<span class="hljs-number">0</span>);
            }
            <span class="hljs-keyword">return</span> min;
        }
        <span class="hljs-comment">// 上浮：维护小顶堆</span>
        <span class="hljs-title function_">swim</span>(<span class="hljs-params">idx</span>) {
            <span class="hljs-keyword">while</span> (idx &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">const</span> parent = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((idx - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[parent].<span class="hljs-property">val</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx].<span class="hljs-property">val</span>) {
                    [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[parent], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx]] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[parent]];
                    idx = parent;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-comment">// 下沉：维护小顶堆</span>
        <span class="hljs-title function_">sink</span>(<span class="hljs-params">idx</span>) {
            <span class="hljs-keyword">while</span> (idx * <span class="hljs-number">2</span> + <span class="hljs-number">1</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span>) {
                <span class="hljs-keyword">let</span> minIdx = idx * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;
                <span class="hljs-keyword">const</span> right = idx * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>;
                <span class="hljs-keyword">if</span> (right &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[right].<span class="hljs-property">val</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx].<span class="hljs-property">val</span>) {
                    minIdx = right;
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx].<span class="hljs-property">val</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx].<span class="hljs-property">val</span>) <span class="hljs-keyword">break</span>;
                [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx]] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[minIdx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>[idx]];
                idx = minIdx;
            }
        }
        <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">heap</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p = dummy;
    <span class="hljs-keyword">const</span> minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MinHeap</span>();

    <span class="hljs-comment">// 初始化堆：各链表的第一个节点入堆</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; k; i++) {
        <span class="hljs-keyword">if</span> (lists[i] !== <span class="hljs-literal">null</span>) minHeap.<span class="hljs-title function_">push</span>(lists[i]);
    }

    <span class="hljs-comment">// 循环取堆顶，拼接链表</span>
    <span class="hljs-keyword">while</span> (!minHeap.<span class="hljs-title function_">isEmpty</span>()) {
        <span class="hljs-keyword">const</span> minNode = minHeap.<span class="hljs-title function_">pop</span>();
        p.<span class="hljs-property">next</span> = minNode;
        p = p.<span class="hljs-property">next</span>;
        <span class="hljs-comment">// 该链表的下一个节点入堆</span>
        <span class="hljs-keyword">if</span> (minNode.<span class="hljs-property">next</span> !== <span class="hljs-literal">null</span>) minHeap.<span class="hljs-title function_">push</span>(minNode.<span class="hljs-property">next</span>);
    }

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>堆的比较逻辑写错（如写成大顶堆），导致取到最大值；</p>
</li>
<li>
<p>忘记将「当前节点的下一个节点」入堆，堆很快为空，只合并了各链表的第一个节点；</p>
</li>
<li>
<p>未处理<code>lists</code>中包含<code>null</code>的情况，入堆时报错。</p>
</li>
</ul>
<h5 data-id="heading-9">3. 延伸：有序矩阵中第K小的元素（LeetCode 378）</h5>
<p><strong>核心思路</strong>：将「矩阵的每一行」视为「升序链表」，复用「合并k个链表」的堆思路——每行一个指针，堆存储「行索引+当前值」，每次取最小值后将该行下一个值入堆。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 通用优先队列实现（支持大顶堆/小顶堆，基于完全二叉树+数组存储）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">compareFn</span> - 比较函数，决定堆类型：
 *                                返回值是负数的时候，第一个参数的优先级更高
 *                               - 小顶堆（默认）：(a,b) =&gt; a - b（返回负数则a优先级高）
 *                               - 大顶堆：(a,b) =&gt; b - a（返回负数则b优先级高）
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityQueue1</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">compareFn = (a, b) =&gt; a - b</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">compareFn</span> = compareFn; <span class="hljs-comment">// 自定义比较函数（核心：替代硬编码比较）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 堆的有效元素个数（≠queue.length，避免数组空洞）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = []; <span class="hljs-comment">// 物理存储数组（逻辑完全二叉树）</span>
  }

  <span class="hljs-comment">// 入队：添加元素并上浮堆化</span>
  <span class="hljs-title function_">enqueue</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-comment">// 1. 把新元素放到数组末尾（完全二叉树的最后一个节点）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>] = val;
    <span class="hljs-comment">// 2. 上浮：维护堆的性质（从新元素位置向上调整）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swim</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>);
    <span class="hljs-comment">// 3. 有效元素个数+1（先swim再++，因为swim需要当前索引）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>++;
  }

  <span class="hljs-comment">// 出队：移除并返回堆顶元素，最后一个元素补位后下沉堆化</span>
  <span class="hljs-title function_">dequeue</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 边界：空队列返回null</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// 1. 保存堆顶元素（要返回的值）</span>
    <span class="hljs-keyword">const</span> peek = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-number">0</span>];
    <span class="hljs-comment">// 2. 最后一个元素移到堆顶（完全二叉树补位）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-number">0</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> - <span class="hljs-number">1</span>];
    <span class="hljs-comment">// 3. 下沉：维护堆的性质（从堆顶向下调整）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sink</span>(<span class="hljs-number">0</span>);
    <span class="hljs-comment">// 4. 有效元素个数-1（堆大小减小）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>--;
    <span class="hljs-comment">// 可选：清空数组空洞（非必需，但更优雅）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-property">length</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>;
    <span class="hljs-keyword">return</span> peek;
  }

  <span class="hljs-comment">// 获取堆顶元素（不出队）</span>
  <span class="hljs-title function_">head</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span> ? <span class="hljs-literal">null</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[<span class="hljs-number">0</span>];
  }

  <span class="hljs-comment">// 获取父节点索引</span>
  <span class="hljs-title function_">parent</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((idx - <span class="hljs-number">1</span>) / <span class="hljs-number">2</span>);
  }

  <span class="hljs-comment">// 获取左子节点索引</span>
  <span class="hljs-title function_">left</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-keyword">return</span> idx * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">// 获取右子节点索引</span>
  <span class="hljs-title function_">right</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-keyword">return</span> idx * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>;
  }

  <span class="hljs-comment">// 交换两个节点的值</span>
  <span class="hljs-title function_">swap</span>(<span class="hljs-params">idx1, idx2</span>) {
    [<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx1], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx2]] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx2], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx1]];
  }

  <span class="hljs-comment">// 上浮（swim）：从idx向上调整，维护堆性质</span>
  <span class="hljs-title function_">swim</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-comment">// 循环：直到根节点（idx=0）或当前节点不小于父节点</span>
    <span class="hljs-keyword">while</span> (idx &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> parentIdx = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parent</span>(idx);
      <span class="hljs-comment">// 核心：用compareFn替代硬编码比较</span>
      <span class="hljs-comment">// compareFn(a,b) &lt; 0 → a优先级更高（应上浮）</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compareFn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[parentIdx]) &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 当前节点优先级不高于父节点，停止上浮</span>
      }
      <span class="hljs-comment">// 交换当前节点和父节点</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swap</span>(idx, parentIdx);
      <span class="hljs-comment">// 继续向上检查</span>
      idx = parentIdx;
    }
  }

  <span class="hljs-comment">// 下沉（sink）：从idx向下调整，维护堆性质</span>
  <span class="hljs-title function_">sink</span>(<span class="hljs-params">idx</span>) {
    <span class="hljs-comment">// 循环：直到没有左子节点（完全二叉树，左子不存在则右子也不存在）</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">left</span>(idx) &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span>) {
      <span class="hljs-keyword">const</span> leftIdx = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">left</span>(idx);
      <span class="hljs-keyword">const</span> rightIdx = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">right</span>(idx);
      <span class="hljs-comment">// 找到“优先级更高”的子节点（小顶堆找更小的，大顶堆找更大的）</span>
      <span class="hljs-keyword">let</span> priorityIdx = leftIdx;

      <span class="hljs-comment">// 右子节点存在，且右子优先级更高 → 切换到右子</span>
      <span class="hljs-keyword">if</span> (rightIdx &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compareFn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[rightIdx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[leftIdx]) &lt; <span class="hljs-number">0</span>) {
        priorityIdx = rightIdx;
      }

      <span class="hljs-comment">// 当前节点优先级 ≥ 子节点 → 停止下沉</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">compareFn</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[idx], <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>[priorityIdx]) &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">break</span>;
      }

      <span class="hljs-comment">// 交换当前节点和优先级更高的子节点</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">swap</span>(idx, priorityIdx);
      <span class="hljs-comment">// 继续向下检查</span>
      idx = priorityIdx;
    }
  }

  <span class="hljs-comment">// 辅助：判断队列是否为空</span>
  <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>;
  }
}
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number[][]</span>} <span class="hljs-variable">matrix</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">k</span>
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">number</span>}
 */</span>
<span class="hljs-keyword">var</span> kthSmallest = <span class="hljs-keyword">function</span>(<span class="hljs-params">matrix, k</span>) {
  <span class="hljs-keyword">const</span> rows = matrix.<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> cols = matrix[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>
  <span class="hljs-comment">// 每一行，都有一个指针，pArr[0]表示第0行的指针，pArr[1]表示第1行的指针，</span>
  <span class="hljs-keyword">let</span> pArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(rows).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>)
  <span class="hljs-comment">// 返回值</span>
  <span class="hljs-keyword">let</span> res
  <span class="hljs-comment">// 这里因为需要存储第几行的信息，所以queue队列里存储的不单单是val 还有row的信息，这样的话，需要重新写compareFn</span>
  <span class="hljs-keyword">const</span> pq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue1</span>(<span class="hljs-function">(<span class="hljs-params">[row1,val1],[row2,val2]</span>)=&gt;</span>val1-val2)
  <span class="hljs-comment">// 每行的第一个元素进队</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> row=<span class="hljs-number">0</span>;row&lt;rows;row++){
    pq.<span class="hljs-title function_">enqueue</span>([row,matrix[row][<span class="hljs-number">0</span>]])
  }
  <span class="hljs-comment">// 当队存在且k&gt;0的时候 说明需要继续</span>
  <span class="hljs-keyword">while</span>(pq.<span class="hljs-property">size</span>&gt;<span class="hljs-number">0</span> &amp;&amp; k&gt;<span class="hljs-number">0</span>){
    <span class="hljs-comment">// 出队的是当前最小的</span>
    <span class="hljs-keyword">const</span> [curRow,curVal] = pq.<span class="hljs-title function_">dequeue</span>()
    <span class="hljs-comment">// 值存下</span>
    res = curVal
    <span class="hljs-comment">// 循环k次就能获取到k小的值</span>
    k--
    <span class="hljs-keyword">const</span> nextCol = pArr[curRow]+<span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span>(nextCol&lt;cols){
      pArr[curRow] = nextCol
      pq.<span class="hljs-title function_">enqueue</span>([curRow,matrix[curRow][nextCol]])
    }
  }
  <span class="hljs-keyword">return</span> res

};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>堆中仅存储值，未记录行索引，无法找到下一个要入堆的值；</p>
</li>
<li>
<p>忽略矩阵单行/单列的边界情况。</p>
</li>
</ul>
<h4 data-id="heading-10">（二）链表的分解：按条件拆分，删除重复</h4>
<p>分解类问题的核心是「用两个虚拟头节点分别存储符合/不符合条件的节点，最后拼接」。</p>
<h5 data-id="heading-11">1. 分隔链表（LeetCode 86）</h5>
<p><strong>题目要求</strong>：将链表分隔为两部分，小于x的节点在前，大于等于x的节点在后，保持原有相对顺序。</p>
<p><strong>核心思路</strong>：两个虚拟头节点分别存储「小于x」和「大于等于x」的节点，遍历原链表后拼接。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> partition = <span class="hljs-keyword">function</span>(<span class="hljs-params">head, x</span>) {
    <span class="hljs-comment">// 两个虚拟头节点：分别存储小于x和大于等于x的节点</span>
    <span class="hljs-keyword">const</span> p1Dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> p2Dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p1 = p1Dummy, p2 = p2Dummy;
    <span class="hljs-keyword">let</span> p = head;

    <span class="hljs-keyword">while</span> (p !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (p.<span class="hljs-property">val</span> &lt; x) {
            p1.<span class="hljs-property">next</span> = p;
            p1 = p1.<span class="hljs-property">next</span>;
        } <span class="hljs-keyword">else</span> {
            p2.<span class="hljs-property">next</span> = p;
            p2 = p2.<span class="hljs-property">next</span>;
        }
        p = p.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 关键：断开p2的尾节点，避免链表成环</span>
    p2.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// 拼接两个链表</span>
    p1.<span class="hljs-property">next</span> = p2Dummy.<span class="hljs-property">next</span>;

    <span class="hljs-keyword">return</span> p1Dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>未断开<code>p2.next</code>，若原链表末尾属于「大于等于x」的部分，会导致链表成环；</p>
</li>
<li>
<p>拼接时错误拼接<code>p2Dummy</code>而非<code>p2Dummy.next</code>，引入无效的虚拟头节点。</p>
</li>
</ul>
<h5 data-id="heading-12">2. 删除排序链表中的重复元素II（LeetCode 82）</h5>
<p><strong>题目要求</strong>：删除链表中所有重复的节点，只保留原链表中没有重复出现的节点。</p>
<p><strong>核心思路</strong>：前驱指针+跳过重复项——前驱指针记录「最后一个不重复的节点」，遍历指针找到所有连续重复节点后，前驱指针跳过这些节点。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> deleteDuplicates = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    dummy.<span class="hljs-property">next</span> = head;
    <span class="hljs-keyword">let</span> prev = dummy; <span class="hljs-comment">// 前驱指针：最后一个不重复的节点</span>
    <span class="hljs-keyword">let</span> p = head;     <span class="hljs-comment">// 遍历指针</span>

    <span class="hljs-keyword">while</span> (p) {
        <span class="hljs-comment">// 找到所有连续重复的节点</span>
        <span class="hljs-keyword">if</span> (p.<span class="hljs-property">next</span> &amp;&amp; p.<span class="hljs-property">val</span> === p.<span class="hljs-property">next</span>.<span class="hljs-property">val</span>) {
            <span class="hljs-keyword">while</span> (p &amp;&amp; p.<span class="hljs-property">next</span> &amp;&amp; p.<span class="hljs-property">val</span> === p.<span class="hljs-property">next</span>.<span class="hljs-property">val</span>) {
                p = p.<span class="hljs-property">next</span>;
            }
            <span class="hljs-comment">// 跳过所有重复节点</span>
            prev.<span class="hljs-property">next</span> = p.<span class="hljs-property">next</span>;
            p = p.<span class="hljs-property">next</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 无重复，前驱指针后移</span>
            prev = prev.<span class="hljs-property">next</span>;
            p = p.<span class="hljs-property">next</span>;
        }
    }

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>内层循环未判空<code>p &amp;&amp; p.next</code>，导致<code>p.next.val</code>报错；</p>
</li>
<li>
<p>无重复时忘记移动前驱指针<code>prev</code>，<code>prev</code>始终停留在虚拟头节点，最终结果缺失部分节点；</p>
</li>
<li>
<p>仅删除重复节点中的一个，而非全部跳过。</p>
</li>
</ul>
<h4 data-id="heading-13">（三）双指针经典：中点、倒数k、环、相交</h4>
<p>这类问题的核心是「通过指针的步长/路径设计，一次遍历完成目标」，避免先遍历统计长度的二次遍历。</p>
<h5 data-id="heading-14">1. 链表的中间节点（LeetCode 876）</h5>
<p><strong>题目要求</strong>：返回链表的中间节点，偶数长度返回第二个中间节点。</p>
<p><strong>核心思路</strong>：快慢指针——慢指针走1步，快指针走2步，快指针到末尾时，慢指针即为中间节点。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> middleNode = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">let</span> slow = head, fast = head;
    <span class="hljs-comment">// 循环条件：fast和fast.next都不为空</span>
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast.<span class="hljs-property">next</span>) {
        slow = slow.<span class="hljs-property">next</span>;
        fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;
    }

    <span class="hljs-keyword">return</span> slow;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>循环条件漏写<code>fast</code>或<code>fast.next</code>，导致<code>fast.next.next</code>报错；</p>
</li>
<li>
<p>混淆偶数长度的返回值（要求返回第二个中间节点，快慢指针的逻辑天然满足）。</p>
</li>
</ul>
<h5 data-id="heading-15">2. 删除链表的倒数第N个节点（LeetCode 19）</h5>
<p><strong>核心思路</strong>：快慢指针拉开N步距离——快指针先前进N步，然后快慢指针同步前进，快指针到末尾时，慢指针指向倒数第N个节点的前驱。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> removeNthFromEnd = <span class="hljs-keyword">function</span>(<span class="hljs-params">head, n</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    dummy.<span class="hljs-property">next</span> = head;
    <span class="hljs-keyword">let</span> slow = dummy, fast = dummy;

    <span class="hljs-comment">// 快指针先前进n步</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        fast = fast.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 同步前进，快指针到末尾时停止</span>
    <span class="hljs-keyword">while</span> (fast.<span class="hljs-property">next</span>) {
        slow = slow.<span class="hljs-property">next</span>;
        fast = fast.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 删除倒数第n个节点</span>
    slow.<span class="hljs-property">next</span> = slow.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>未使用虚拟头节点，删除倒数第L个节点（头节点）时出错；</p>
</li>
<li>
<p>快指针前进n步时未判空，n超过链表长度时报错；</p>
</li>
<li>
<p>循环条件写成<code>fast !== null</code>，导致慢指针位置错误。</p>
</li>
</ul>
<h5 data-id="heading-16">3. 环形链表II（LeetCode 142）</h5>
<p><strong>题目要求</strong>：判断链表是否有环，若有则返回环的入口节点。</p>
<p><strong>核心思路</strong>：快慢指针分两步——</p>
<ol>
<li>
<p>判环：慢1快2，相遇则有环；</p>
</li>
<li>
<p>找入口：相遇后慢指针回头部，快慢均走1步，再次相遇即为入口。</p>
</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> detectCycle = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">let</span> slow = head, fast = head;
    <span class="hljs-keyword">while</span> (fast &amp;&amp; fast.<span class="hljs-property">next</span>) {
        slow = slow.<span class="hljs-property">next</span>;
        fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;

        <span class="hljs-comment">// 相遇则找入口</span>
        <span class="hljs-keyword">if</span> (slow === fast) {
            slow = head; <span class="hljs-comment">// 慢指针回头部</span>
            <span class="hljs-keyword">while</span> (slow !== fast) {
                slow = slow.<span class="hljs-property">next</span>;
                fast = fast.<span class="hljs-property">next</span>; <span class="hljs-comment">// 快指针改为走1步</span>
            }
            <span class="hljs-keyword">return</span> slow;
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};
</code></pre>
<p><strong>原理推导</strong>：</p>
<p>设<code>a</code>=表头到入口的距离，<code>b</code>=入口到相遇点的距离，<code>c</code>=相遇点回到入口的距离：</p>
<ul>
<li>
<p>快指针路程：<code>2(a+b) = a + b + n*(b+c)</code> → <code>a = (n-1)*(b+c) + c</code>；</p>
</li>
<li>
<p>当<code>n=1</code>时，<code>a=c</code>，因此慢指针回头部后，同步走必然在入口相遇。</p>
</li>
</ul>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>相遇后快指针未改为走1步，仍走2步，无法找到入口；</p>
</li>
<li>
<p>判环时循环条件漏写<code>fast.next</code>，导致报错；</p>
</li>
<li>
<p>忽略单节点成环的情况（如<code>head.next = head</code>）。</p>
</li>
</ul>
<h5 data-id="heading-17">4. 相交链表（LeetCode 160）</h5>
<p><strong>题目要求</strong>：找到两个单链表相交的起始节点，无相交则返回null。</p>
<p><strong>核心思路</strong>：互换指针——p1遍历完A接B，p2遍历完B接A，总路程均为<code>A+B</code>，相交则在交点相遇，否则同时到null。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> getIntersectionNode = <span class="hljs-keyword">function</span>(<span class="hljs-params">headA, headB</span>) {
    <span class="hljs-keyword">if</span> (headA === <span class="hljs-literal">null</span> || headB === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">let</span> p1 = headA, p2 = headB;
    <span class="hljs-keyword">while</span> (p1 !== p2) {
        p1 = p1 === <span class="hljs-literal">null</span> ? headB : p1.<span class="hljs-property">next</span>;
        p2 = p2 === <span class="hljs-literal">null</span> ? headA : p2.<span class="hljs-property">next</span>;
    }

    <span class="hljs-keyword">return</span> p1;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>担心无限循环：无需担心，p1/p2总路程相等，最终必相遇（要么交点，要么null）；</p>
</li>
<li>
<p>遍历到末尾时未切换到另一个链表，而是直接返回null。</p>
</li>
</ul>
<h4 data-id="heading-18">（四）链表运算：两数相加（逆序/正序）</h4>
<p>链表运算的核心是「模拟手工运算」，结合栈处理正序链表的逆序操作。</p>
<h5 data-id="heading-19">1. 两数相加（LeetCode 2）</h5>
<p><strong>题目要求</strong>：两个逆序存储数字的链表，返回相加后的逆序链表。</p>
<p><strong>核心思路</strong>：模拟手工加法——遍历链表，逐位相加，处理进位。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> addTwoNumbers = <span class="hljs-keyword">function</span>(<span class="hljs-params">l1, l2</span>) {
    <span class="hljs-keyword">if</span> (l1 === <span class="hljs-literal">null</span> &amp;&amp; l2 === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> dummy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> p = dummy;
    <span class="hljs-keyword">let</span> p1 = l1, p2 = l2;
    <span class="hljs-keyword">let</span> isNeedPlusOne = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 进位标记</span>

    <span class="hljs-keyword">while</span> (p1 || p2 || isNeedPlusOne) {
        <span class="hljs-keyword">let</span> val = isNeedPlusOne ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (p1) {
            val += p1.<span class="hljs-property">val</span>;
            p1 = p1.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">if</span> (p2) {
            val += p2.<span class="hljs-property">val</span>;
            p2 = p2.<span class="hljs-property">next</span>;
        }

        isNeedPlusOne = val &gt;= <span class="hljs-number">10</span>;
        val = val % <span class="hljs-number">10</span>;
        p.<span class="hljs-property">next</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(val);
        p = p.<span class="hljs-property">next</span>;
    }

    <span class="hljs-keyword">return</span> dummy.<span class="hljs-property">next</span>;
};
</code></pre>
<h5 data-id="heading-20">2. 两数相加II（LeetCode 445）</h5>
<p><strong>题目要求</strong>：两个正序存储数字的链表，返回相加后的正序链表。</p>
<p><strong>核心思路</strong>：栈逆序取数 + 反向构建链表——先将正序链表入栈，逆序取数相加，再反向构建正序链表。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">var</span> addTwoNumbers = <span class="hljs-keyword">function</span>(<span class="hljs-params">l1, l2</span>) {
    <span class="hljs-keyword">if</span> (l1 === <span class="hljs-literal">null</span> &amp;&amp; l2 === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// 正序链表入栈，逆序取数</span>
    <span class="hljs-keyword">const</span> stack1 = [], stack2 = [];
    <span class="hljs-keyword">let</span> p1 = l1, p2 = l2;
    <span class="hljs-keyword">while</span> (p1) { stack1.<span class="hljs-title function_">push</span>(p1.<span class="hljs-property">val</span>); p1 = p1.<span class="hljs-property">next</span>; }
    <span class="hljs-keyword">while</span> (p2) { stack2.<span class="hljs-title function_">push</span>(p2.<span class="hljs-property">val</span>); p2 = p2.<span class="hljs-property">next</span>; }

    <span class="hljs-keyword">let</span> head = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> isNeedPlusOne = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// 核心：逆序相加 + 反向构建链表</span>
    <span class="hljs-keyword">while</span> (stack1.<span class="hljs-property">length</span> || stack2.<span class="hljs-property">length</span> || isNeedPlusOne) {
        <span class="hljs-keyword">let</span> val = isNeedPlusOne ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (stack1.<span class="hljs-property">length</span>) val += stack1.<span class="hljs-title function_">pop</span>();
        <span class="hljs-keyword">if</span> (stack2.<span class="hljs-property">length</span>) val += stack2.<span class="hljs-title function_">pop</span>();

        isNeedPlusOne = val &gt;= <span class="hljs-number">10</span>;
        val = val % <span class="hljs-number">10</span>;

        <span class="hljs-comment">// 反向构建：新节点作为头节点</span>
        <span class="hljs-keyword">const</span> newNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(val);
        newNode.<span class="hljs-property">next</span> = head;
        head = newNode;
    }

    <span class="hljs-keyword">return</span> head;
};
</code></pre>
<p><strong>易错点</strong>：</p>
<ul>
<li>
<p>循环条件漏写<code>isNeedPlusOne</code>，漏掉末尾进位（如999+1=1000）；</p>
</li>
<li>
<p>反向构建链表时<code>next</code>指向写反（如<code>head.next = newNode</code>），导致链表断裂；</p>
</li>
<li>
<p>栈取数用<code>shift()</code>而非<code>pop()</code>，取数顺序错误。</p>
</li>
</ul>
<h3 data-id="heading-21">三、面试高频易错点总结（避坑指南）</h3>








































<table><thead><tr><th>场景</th><th>常见错误</th><th>正确做法</th></tr></thead><tbody><tr><td>虚拟头节点</td><td>返回<code>head</code>而非<code>dummy.next</code></td><td>始终返回<code>dummy.next</code>，避免头节点被删除/修改</td></tr><tr><td>链表拼接</td><td>未断开尾节点的<code>next</code></td><td>拼接前将尾节点<code>next</code>置为null，避免成环</td></tr><tr><td>快慢指针</td><td>循环条件漏写<code>fast.next</code></td><td>判环/中点时用<code>while (fast &amp;&amp; fast.next)</code></td></tr><tr><td>堆/栈</td><td>堆的比较逻辑写错（大顶堆/小顶堆混淆）</td><td>小顶堆用<code>a.val - b.val</code>，大顶堆用<code>b.val - a.val</code></td></tr><tr><td>反向构建链表</td><td><code>next</code>指向写反</td><td>正确逻辑：<code>newNode.next = head; head = newNode</code></td></tr><tr><td>进位处理</td><td>进位判断在取余之后</td><td>先判断<code>val &gt;= 10</code>，再取余<code>val % 10</code></td></tr></tbody></table>
<h3 data-id="heading-22">四、总结</h3>
<p>链表题的核心是「指针操作+边界处理」，掌握以下3点即可应对绝大多数面试题：</p>
<ol>
<li>
<p><strong>虚拟头节点</strong>：解决头节点边界问题；</p>
</li>
<li>
<p><strong>双指针</strong>：快慢/前后/互换指针，一次遍历完成目标；</p>
</li>
<li>
<p><strong>栈/堆辅助</strong>：处理逆序/多链表合并场景。</p>
</li>
</ol>
<p>刷题时建议按「合并→分解→双指针→运算」的顺序，每道题先想清楚「指针该怎么动」，再动手写代码，同时标注易错点——面试中不仅要写对代码，更要能讲清「为什么这么写」和「避免了哪些坑」。</p>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘马斯克甩出王炸，X推荐算法开源，6小时斩获1.6k Star]]></title>    <link>https://juejin.cn/post/7605041451327668267</link>    <guid>https://juejin.cn/post/7605041451327668267</guid>    <pubDate>2026-02-10T13:52:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451327668267" data-draft-id="7605041451327651883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘马斯克甩出王炸，X推荐算法开源，6小时斩获1.6k Star"/> <meta itemprop="keywords" content="架构,人工智能"/> <meta itemprop="datePublished" content="2026-02-10T13:52:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不惑_"/> <meta itemprop="url" content="https://juejin.cn/user/1471609400466218"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘马斯克甩出王炸，X推荐算法开源，6小时斩获1.6k Star
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1471609400466218/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不惑_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:52:01.000Z" title="Tue Feb 10 2026 13:52:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>昨天刷X的时候,突然发现xAI把整个For You推荐算法开源了。说实话,我当时就愣住了。</p>
<p>要知道,推荐算法这东西,对社交平台来说就是命根子。抖音的推荐算法、小红书的推荐逻辑,哪个不是藏着掖着当核心机密?结果马斯克直接把代码扔GitHub上,7000多个star,就这么大大方方让你看。</p>
<p>这背后到底藏着什么秘密?</p>
<h2 data-id="heading-0">一个让我震惊的发现</h2>
<p>我花了整整几个晚上扒完这套代码,发现了一个颠覆认知的事实:<strong>X的推荐系统里,几乎没有人工规则</strong>。</p>
<p>什么意思?传统的推荐系统,工程师会设计几百上千条规则。比如用户点赞过科技类内容,就多推科技,或者转发率高的内容加权。这些都是人脑想出来的逻辑。</p>
<p>但X的算法完全不是这么玩的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dc50bd2647145a8b98693ad85e1bfa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=ZtOPNAPC%2FEPFIx%2BG4YjEb6LYPJ8%3D" alt="image.png" loading="lazy"/></p>
<p>他们用的是Grok改造的Transformer模型。这个模型会自己观察你过去的所有互动记录,点赞了什么、回复了谁、在哪条推文上停留了多久,然后自己学会你喜欢什么。</p>
<p>没有一条人为设定的规则。</p>
<h2 data-id="heading-1">那些让我眼前一亮的技术细节</h2>
<p>深入看代码的时候,我发现了几个特别巧妙的设计。</p>
<p><strong>第一个是候选隔离机制</strong>。</p>
<p>这个设计解决了一个很多人没意识到的问题:如果你同时推荐100条内容,模型在给A内容打分的时候,会不会受到B内容的影响?</p>
<p>X的解决方案很聪明。他们让Transformer在处理的时候,每条候选内容只能看到你的历史行为,但看不到其他候选内容。就像100个学生各自独立答题,互不影响。</p>
<p>这样做的好处是什么?每条内容的分数是稳定的,可以缓存起来反复使用。如果内容之间能互相影响,那每次推荐的组合不同,分数就会变,系统就乱套了。</p>
<p><strong>第二个是Thunder这个内存数据库</strong>。</p>
<p>你关注的人发的新推文,需要在几毫秒内出现在你的推荐里。如果每次都去查数据库,肯定来不及。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f73ba7a9a7a4a8798536be879f5252d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=WLXtOcBQ%2BUmQOZZelTiwRQJeHpA%3D" alt="image.png" loading="lazy"/></p>
<p>X直接把最近的推文全部加载到内存里。你关注的人一发推,系统就通过Kafka实时接收,存到Thunder里。查询的时候根本不走硬盘,全在内存里找,速度快到离谱。</p>
<p>这就是为什么你刷新feed,新内容总能立刻出现的原因。</p>
<p><strong>第三个是多行为预测</strong>。</p>
<p>一般的推荐系统只预测一个指标,比如点击率。但X的模型会同时预测你对一条推文的15种可能行为:</p>
<p>点赞、回复、转发、引用、点击、看视频、展开图片、分享、停留时长......</p>
<p>甚至还包括负面行为:点不感兴趣、屏蔽作者、静音、举报。</p>
<p>每个行为都有一个权重。正面行为加分,负面行为扣分。最后把这15个概率乘以各自的权重,加起来就是这条推文的最终得分。</p>
<p>这个设计太精妙了。它不是简单地追求让你点击,它追求的是让你真正喜欢。</p>
<h2 data-id="heading-2">藏在代码里的价值观</h2>
<p>看到这里,你可能会好奇:这套算法到底想推给你什么?</p>
<p>我注意到一个有意思的细节。在评分权重里,<strong>点赞和转发的权重是正的</strong>,这个好理解。但<strong>停留时长的权重也是正的</strong>。</p>
<p>什么意思?如果你在一条推文上停留了很久,即使没点赞,算法也会认为这内容对你有价值。</p>
<p>更关键的是,<strong>点不感兴趣屏蔽举报这些行为,权重是负的</strong>。如果模型预测你很可能会屏蔽某个作者,那这条推文的得分会大幅下降,根本不会推给你。</p>
<p>这说明什么?算法不是在追求让你上瘾,它在努力避免让你反感。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1b486f593747708ce6e50e54a98f8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=w%2B3k7yo2iBLMCQNdZOEpk4SCRxM%3D" alt="unnamed.png" loading="lazy"/></p>
<p>这跟抖音那种只要你不划走就一直推类似内容的逻辑完全不同。</p>
<h2 data-id="heading-3">两个让我意外的真相</h2>
<p>深挖代码的过程中,我发现了两个打破我认知的事实。</p>
<p><strong>第一,你的feed里,有一半内容来自你不关注的人</strong>。</p>
<p>X的推荐分两路:Thunder负责推你关注的人发的内容,Phoenix负责在全网范围内找你可能感兴趣的内容。这两路内容最后混在一起,统一打分排序。</p>
<p>所以你经常刷到一些你可能感兴趣的陌生账号,不是bug,是feature。算法故意这么设计的,目的是让你发现新的有价值的声音。</p>
<p><strong>第二,算法会主动降低同一个作者的推荐频率</strong>。</p>
<p>代码里有个叫Author Diversity Scorer的模块,专门用来衰减重复作者的得分。</p>
<p>如果你特别喜欢某个大V,算法确实会多推ta的内容。但当ta的推文在你feed里占比太高时,后面的推文得分会被打折扣。</p>
<p>为什么要这么做?因为信息茧房真的存在。如果你的feed全是同一个人的观点,你的视野会越来越窄。</p>
<p>这个设计让我对X的团队有点刮目相看。他们确实在用技术手段对抗算法本身的缺陷。</p>
<h2 data-id="heading-4">那些被过滤掉的内容</h2>
<p>看到这里,你可能会问:那些你永远刷不到的内容,都去哪了?</p>
<p>代码里有个很长的过滤器列表。在打分之前,系统会先过滤掉这些:</p>
<p>你自己发的推文(废话)、你屏蔽的人、你静音的关键词、超过7天的旧推文、你已经看过的内容、被举报太多次的推文、删除的内容、垃圾信息、暴力血腥......</p>
<p>这个过滤环节分两次。第一次在打分前,第二次在选出Top K之后。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc5f940cc2ec4bdd9d66cccbd659c29c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771336325&amp;x-signature=b82EQbSKTLuR%2B81WNAYlb58DEX8%3D" alt="image.png" loading="lazy"/></p>
<p>第二次过滤很关键。因为有些违规内容刚发出来的时候系统还没识别出来,但在准备推送给你的那一刻,审核结果出来了,就会被拦下来。</p>
<p>这也是为什么有时候你刷到一半,突然有条推文消失了。不是你眼花,是它在最后一秒被过滤掉了。</p>
<h2 data-id="heading-5">一个让我陷入沉思的问题</h2>
<p>看完整套代码,我脑子里一直盘旋着一个问题:马斯克为什么要开源这个?</p>
<p>社交平台的推荐算法,这可是最核心的商业机密。字节跳动的推荐算法值多少钱?恐怕没人说得清。</p>
<p>但马斯克就这么把它开放了。</p>
<p>我想了很久,可能有三个原因。</p>
<p><strong>第一,技术自信</strong>。X用的是xAI自己的Grok模型,这个模型本身就是开源的。既然模型都开源了,基于它做的推荐系统再藏着也没意义。反正别人拿去也训练不出同样的效果,因为他们没有X这么多的用户行为数据。</p>
<p><strong>第二,建立信任</strong>。这两年,所有社交平台的推荐算法都在被质疑。用户总觉得算法在操控我。X干脆把代码摊开,你自己看,我到底有没有暗箱操作。这招确实高明。</p>
<p><strong>第三,吸引人才</strong>。这么复杂的工程开源出来,全世界的优秀工程师都能看到X团队的水平。想招人的时候,根本不用自己吹,代码就是最好的简历。</p>
<p>不管出于什么原因,这个举动确实够大胆。</p>
<h2 data-id="heading-6">普通人能从中学到什么</h2>
<p>我知道很多人看到这里会说:这些技术细节跟我有什么关系?我又不是工程师。</p>
<p>但我觉得,理解这套算法的运作逻辑,对每个人都有价值。</p>
<p><strong>首先,你会明白你的行为在训练算法</strong>。</p>
<p>你点的每个赞、看的每个视频、停留的每秒钟,都在告诉算法你喜欢什么。如果你总是点开那些标题党,算法就会给你推更多标题党。如果你经常举报垃圾信息,算法会学会离那些内容远一点。</p>
<p>你在塑造你自己的信息世界。</p>
<p><strong>其次,你会理解为什么有时候刷不到想看的内容</strong>。</p>
<p>不是算法针对你,是过滤规则在起作用。可能那条推文太旧了,可能你之前静音了相关关键词,可能系统认为它可能让你反感。</p>
<p>了解这些,你就知道怎么调整自己的使用习惯,让算法更懂你。</p>
<p><strong>最后,你会意识到算法不是万能的</strong>。</p>
<p>即使X用了最先进的Transformer模型,即使它能预测15种行为,它依然会出错。它不可能完美理解你的每一个需求。</p>
<p>所以主动去关注你感兴趣的账号,主动去搜索你想了解的话题,永远比被动地等算法推送要有效。</p>
<h2 data-id="heading-7">结尾的一点感慨</h2>
<p>写完这篇文章的时候,已经是凌晨1点了。</p>
<p>我重新翻了一遍X算法的代码,突然有个感觉:这套系统最厉害的地方,不是技术有多先进,也不是模型有多复杂。</p>
<p>它厉害在,它尝试在让你多刷和给你真正想看的之间找平衡。</p>
<p>它会推你没关注的账号,避免你活在信息茧房里。它会衰减同一个作者的推送,逼你接触更多元的观点。它会惩罚那些让人反感的内容,即使那些内容点击率很高。</p>
<p>当然,它不是完美的。你还是会刷到垃圾信息,还是会遇到推荐不准的时候。</p>
<p>但至少,它在努力做一个不那么坏的算法。</p>
<p>这可能就是马斯克愿意把它开源的真正原因吧。他想告诉所有人:看,我们的算法就是这样工作的,没有阴谋,没有操控,就是在用数学和工程解决一个复杂的问题。</p>
<p>你信不信,是你的选择。但至少,你现在知道它是怎么运作的了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Django 入门指南：从零构建强大的 Web 应用]]></title>    <link>https://juejin.cn/post/7604863528944812047</link>    <guid>https://juejin.cn/post/7604863528944812047</guid>    <pubDate>2026-02-10T12:08:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528944812047" data-draft-id="7604769326225375268" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Django 入门指南：从零构建强大的 Web 应用"/> <meta itemprop="keywords" content="后端,Python,Django"/> <meta itemprop="datePublished" content="2026-02-10T12:08:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小张说故事"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Django 入门指南：从零构建强大的 Web 应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小张说故事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:08:33.000Z" title="Tue Feb 10 2026 12:08:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 库的概览与核心价值</h2>
<p>想象一下，如果你需要从零开始搭建一个完整的网站，就像要盖一栋房子却只有一堆泥土和木材——你需要自己设计地基、砌墙、装修，还要处理水电、门窗等细节。这个过程不仅耗时，而且充满风险。</p>
<p><strong>Django</strong> 正是为解决这种复杂性而生的"全能建筑团队"。作为 Python 世界中最受欢迎的 Web 框架，Django 遵循"batteries included"（自带电池）的设计哲学，为开发者提供了构建 Web 应用所需的一切核心组件：ORM 对象关系映射、自动化的管理后台、强大的表单处理、用户认证系统、模板引擎等。</p>
<p>在 Python 生态中，Django 定位为"企业级全栈框架"。相比于 Flask 的轻量灵活和 FastAPI 的高性能异步，Django 更注重"快速开发"和"安全稳定"。它特别适合需要快速构建内容管理系统（CMS）、电商平台、社交网络等数据驱动的复杂 Web 应用。</p>
<p>Django 的不可替代性体现在：<strong>它让开发者能够专注于业务逻辑，而不是重复造轮子</strong>。正如 Instagram、Pinterest、Mozilla 等知名公司的选择，Django 在保证开发效率的同时，也提供了足够的安全性和可扩展性。</p>
<h2 data-id="heading-1">2. 环境搭建与 "Hello, World"</h2>
<h3 data-id="heading-2">安装说明</h3>
<p>在开始之前，请确保你的系统已安装 Python 3.10 或更高版本。Django 5.0 支持 Python 3.10-3.12。</p>
<p><strong>方式一：使用 pip 安装（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install django==5.0
</code></pre>
<p><strong>方式二：使用 conda 安装</strong></p>
<pre><code class="hljs language-bash" lang="bash">conda install django=5.0
</code></pre>
<p><strong>常见安装失败原因及解决方法：</strong></p>
<ul>
<li>权限不足：使用 <code>pip install --user django</code> 或虚拟环境</li>
<li>网络问题：使用国内镜像源，如 <code>pip install django -i https://pypi.tuna.tsinghua.edu.cn/simple</code></li>
<li>版本冲突：确保 Python 版本符合要求</li>
</ul>
<h3 data-id="heading-3">最简示例：第一个 Django 项目</h3>
<p>让我们创建一个最简单的 Django 项目，输出 "Hello, World!"：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 创建项目</span>
django-admin startproject mysite

<span class="hljs-comment"># 2. 进入项目目录</span>
cd mysite

<span class="hljs-comment"># 3. 启动开发服务器</span>
python manage.py runserver
</code></pre>
<p><strong>逐行解释：</strong></p>
<ol>
<li>
<p><code>django-admin startproject mysite</code>：使用 Django 提供的命令行工具创建一个名为 "mysite" 的项目。这会自动生成项目的基本目录结构和配置文件。</p>
</li>
<li>
<p><code>cd mysite</code>：进入刚创建的项目目录。这是运行后续 Django 命令的必要步骤。</p>
</li>
<li>
<p><code>python manage.py runserver</code>：启动 Django 内置的开发服务器。<code>manage.py</code> 是 Django 项目的管理工具脚本，<code>runserver</code> 命令会启动一个轻量级的 Web 服务器，默认监听 8000 端口。</p>
</li>
</ol>
<p><strong>运行结果：</strong></p>
<p>启动成功后，在浏览器中访问 <code>http://127.0.0.1:8000/</code>，你将看到 Django 的欢迎页面，显示 "The install worked successfully! Congratulations!"，这表示你的 Django 环境已经正确搭建。</p>
<p>要输出 "Hello, World!"，我们需要进一步创建视图和路由：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># mysite/views.py</span>
<span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse

<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>(<span class="hljs-params">request</span>):
    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">"Hello, World!"</span>)
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># mysite/urls.py</span>
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
    path(<span class="hljs-string">''</span>, views.hello_world, name=<span class="hljs-string">'hello_world'</span>),
]
</code></pre>
<p>现在访问 <code>http://127.0.0.1:8000/</code>，就能看到 "Hello, World!" 了。</p>
<h2 data-id="heading-4">3. 核心概念解析</h2>
<p>Django 的核心架构基于 <strong>MVT 模式</strong>（Model-View-Template），这是对传统 MVC 模式的一种变体。理解这三个核心概念及其交互关系是掌握 Django 的关键。</p>
<h3 data-id="heading-5">3.1 Model（模型）- 数据层</h3>
<p>Model 是 Django 与数据库交互的桥梁，它是一个 Python 类，继承自 <code>django.db.models.Model</code>。每个 Model 类对应数据库中的一张表，类的属性对应表的字段。</p>
<p><strong>核心作用：</strong></p>
<ul>
<li>定义数据结构和字段类型</li>
<li>提供数据验证规则</li>
<li>封装数据库操作（增删改查）</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span>(models.Model):
    title = models.CharField(max_length=<span class="hljs-number">200</span>)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=<span class="hljs-literal">True</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.title
</code></pre>
<h3 data-id="heading-6">3.2 View（视图）- 业务逻辑层</h3>
<p>View 在 Django 中相当于传统 MVC 的 Controller，它负责处理 HTTP 请求、执行业务逻辑、与 Model 交互，并决定返回什么响应。</p>
<p><strong>核心作用：</strong></p>
<ul>
<li>接收用户请求</li>
<li>调用 Model 获取或处理数据</li>
<li>选择合适的 Template 进行渲染</li>
<li>返回 HTTP 响应</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):
    articles = Article.objects.<span class="hljs-built_in">all</span>()
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'articles/list.html'</span>, {<span class="hljs-string">'articles'</span>: articles})
</code></pre>
<h3 data-id="heading-7">3.3 Template（模板）- 表现层</h3>
<p>Template 负责数据的展示和页面的渲染，使用 Django 模板语言（DTL）将动态数据嵌入 HTML 中。</p>
<p><strong>核心作用：</strong></p>
<ul>
<li>定义页面结构</li>
<li>接收 View 传递的数据</li>
<li>使用模板语法动态渲染内容</li>
<li>实现页面复用（继承、包含）</li>
</ul>
<pre><code class="hljs language-html" lang="html">{% for article in articles %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ article.content }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>发布时间：{{ article.created_at|date:"Y-m-d" }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
{% endfor %}
</code></pre>
<h3 data-id="heading-8">MVT 架构交互流程</h3>
<p>下图展示了 Django MVT 架构中各组件的交互关系：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户浏览器] --&gt;|HTTP请求| B[URL路由系统]
    B --&gt;|匹配URL模式| C[View视图]
    C --&gt;|查询/操作数据| D[Model模型]
    D --&gt;|返回数据| C
    C --&gt;|传递上下文数据| E[Template模板]
    E --&gt;|渲染HTML| C
    C --&gt;|HTTP响应| A
    
    style A fill:#e1f5ff
    style B fill:#fff4e1
    style C fill:#ffe1f5
    style D fill:#e1ffe1
    style E fill:#f5e1ff
</code></pre>
<p><strong>交互流程说明：</strong></p>
<ol>
<li>用户通过浏览器发送 HTTP 请求</li>
<li>URL 路由系统根据 URL 模式匹配到对应的 View</li>
<li>View 调用 Model 进行数据操作（查询、创建、更新、删除）</li>
<li>Model 返回处理后的数据给 View</li>
<li>View 选择合适的 Template，并将数据传递给它</li>
<li>Template 渲染生成 HTML 页面</li>
<li>View 将渲染后的页面作为 HTTP 响应返回给用户</li>
</ol>
<h2 data-id="heading-9">4. 实战演练：构建一个简单的博客系统</h2>
<p>让我们通过一个完整的迷你项目——简单的博客系统，来实践 Django 的核心功能。这个项目将实现文章的列表展示、详情查看、后台管理等功能。</p>
<h3 data-id="heading-10">需求分析</h3>
<p>我们要构建一个具备以下功能的博客系统：</p>
<ul>
<li>在后台管理界面创建、编辑、删除文章</li>
<li>前台展示文章列表</li>
<li>点击文章标题查看文章详情</li>
<li>显示文章的发布时间</li>
</ul>
<h3 data-id="heading-11">方案设计</h3>
<p>我们将使用 Django 的以下核心功能：</p>
<ul>
<li><strong>Model</strong>：定义 <code>Article</code> 模型，包含标题、内容、发布时间字段</li>
<li><strong>Admin</strong>：使用 Django 自带的管理后台快速实现文章管理</li>
<li><strong>View</strong>：创建列表视图和详情视图</li>
<li><strong>Template</strong>：设计文章列表页和详情页</li>
<li><strong>URL 路由</strong>：配置 URL 模式</li>
</ul>
<h3 data-id="heading-12">代码实现</h3>
<p><strong>步骤 1：创建项目和应用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目</span>
django-admin startproject blog_project
<span class="hljs-built_in">cd</span> blog_project

<span class="hljs-comment"># 创建博客应用</span>
python manage.py startapp blog
</code></pre>
<p><strong>步骤 2：定义数据模型</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/models.py</span>
<span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span>(models.Model):
    <span class="hljs-string">"""文章模型"""</span>
    title = models.CharField(<span class="hljs-string">'标题'</span>, max_length=<span class="hljs-number">200</span>)
    content = models.TextField(<span class="hljs-string">'内容'</span>)
    created_at = models.DateTimeField(<span class="hljs-string">'发布时间'</span>, auto_now_add=<span class="hljs-literal">True</span>)
    updated_at = models.DateTimeField(<span class="hljs-string">'更新时间'</span>, auto_now=<span class="hljs-literal">True</span>)
    is_published = models.BooleanField(<span class="hljs-string">'是否发布'</span>, default=<span class="hljs-literal">True</span>)
    
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:
        ordering = [<span class="hljs-string">'-created_at'</span>]
        verbose_name = <span class="hljs-string">'文章'</span>
        verbose_name_plural = <span class="hljs-string">'文章'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.title
</code></pre>
<p><strong>步骤 3：注册到管理后台</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/admin.py</span>
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-meta">@admin.register(<span class="hljs-params">Article</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleAdmin</span>(admin.ModelAdmin):
    list_display = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'is_published'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'updated_at'</span>]
    list_filter = [<span class="hljs-string">'is_published'</span>, <span class="hljs-string">'created_at'</span>]
    search_fields = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>]
    list_editable = [<span class="hljs-string">'is_published'</span>]
    date_hierarchy = <span class="hljs-string">'created_at'</span>
</code></pre>
<p><strong>步骤 4：创建视图函数</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/views.py</span>
<span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render, get_object_or_404
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):
    <span class="hljs-string">"""文章列表视图"""</span>
    articles = Article.objects.<span class="hljs-built_in">filter</span>(is_published=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'blog/article_list.html'</span>, {<span class="hljs-string">'articles'</span>: articles})

<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_detail</span>(<span class="hljs-params">request, article_id</span>):
    <span class="hljs-string">"""文章详情视图"""</span>
    article = get_object_or_404(Article, <span class="hljs-built_in">id</span>=article_id, is_published=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'blog/article_detail.html'</span>, {<span class="hljs-string">'article'</span>: article})
</code></pre>
<p><strong>步骤 5：配置 URL 路由</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog/urls.py</span>
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path
<span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views

urlpatterns = [
    path(<span class="hljs-string">''</span>, views.article_list, name=<span class="hljs-string">'article_list'</span>),
    path(<span class="hljs-string">'article/&lt;int:article_id&gt;/'</span>, views.article_detail, name=<span class="hljs-string">'article_detail'</span>),
]
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog_project/urls.py（项目主路由）</span>
<span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin
<span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path, include

urlpatterns = [
    path(<span class="hljs-string">'admin/'</span>, admin.site.urls),
    path(<span class="hljs-string">''</span>, include(<span class="hljs-string">'blog.urls'</span>)),
]
</code></pre>
<p><strong>步骤 6：创建模板文件</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- blog/templates/blog/base.html（基础模板）--&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{% block title %}我的博客{% endblock %}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Microsoft YaHei'</span>, sans-serif; <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.header</span> { <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#333</span>; <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">10px</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.article</span> { <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>; <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>; }
        <span class="hljs-selector-class">.article-title</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; <span class="hljs-attribute">text-decoration</span>: none; }
        <span class="hljs-selector-class">.article-title</span><span class="hljs-selector-pseudo">:hover</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#0066cc</span>; }
        <span class="hljs-selector-class">.meta</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9em</span>; <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>; }
        <span class="hljs-selector-class">.content</span> { <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>; <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>; }
        <span class="hljs-selector-class">.back-link</span> { <span class="hljs-attribute">display</span>: inline-block; <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#0066cc</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{% url 'article_list' %}"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-decoration: none; color: #333;"</span>&gt;</span>我的博客<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% block content %}{% endblock %}
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- blog/templates/blog/article_list.html（文章列表页）--&gt;</span>
{% extends 'blog/base.html' %}

{% block title %}文章列表 - 我的博客{% endblock %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>最新文章<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    {% for article in articles %}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"article"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{% url 'article_detail' article.id %}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"article-title"</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"meta"</span>&gt;</span>
                发布时间：{{ article.created_at|date:"Y年m月d日 H:i" }}
                {% if article.updated_at != article.created_at %}
                    | 更新时间：{{ article.updated_at|date:"Y年m月d日 H:i" }}
                {% endif %}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    {% empty %}
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>暂无文章<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    {% endfor %}
{% endblock %}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- blog/templates/blog/article_detail.html（文章详情页）--&gt;</span>
{% extends 'blog/base.html' %}

{% block title %}{{ article.title }} - 我的博客{% endblock %}

{% block content %}
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"article"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ article.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"meta"</span>&gt;</span>
            发布时间：{{ article.created_at|date:"Y年m月d日 H:i" }}
            {% if article.updated_at != article.created_at %}
                | 更新时间：{{ article.updated_at|date:"Y年m月d日 H:i" }}
            {% endif %}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
            {{ article.content|linebreaks }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"{% url 'article_list' %}"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"back-link"</span>&gt;</span>← 返回文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
{% endblock %}
</code></pre>
<p><strong>步骤 7：配置应用设置</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># blog_project/settings.py</span>
INSTALLED_APPS = [
    <span class="hljs-string">'django.contrib.admin'</span>,
    <span class="hljs-string">'django.contrib.auth'</span>,
    <span class="hljs-string">'django.contrib.contenttypes'</span>,
    <span class="hljs-string">'django.contrib.sessions'</span>,
    <span class="hljs-string">'django.contrib.messages'</span>,
    <span class="hljs-string">'django.contrib.staticfiles'</span>,
    <span class="hljs-string">'blog'</span>,  <span class="hljs-comment"># 添加我们的博客应用</span>
]
</code></pre>
<p><strong>步骤 8：生成数据库和创建超级用户</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成数据库迁移文件</span>
python manage.py makemigrations

<span class="hljs-comment"># 执行迁移，创建数据库表</span>
python manage.py migrate

<span class="hljs-comment"># 创建超级用户（用于登录管理后台）</span>
python manage.py createsuperuser
<span class="hljs-comment"># 按提示输入用户名、邮箱、密码</span>
</code></pre>
<h3 data-id="heading-13">运行说明</h3>
<p><strong>启动开发服务器：</strong></p>
<pre><code class="hljs language-bash" lang="bash">python manage.py runserver
</code></pre>
<p><strong>访问管理后台：</strong></p>
<ol>
<li>在浏览器中访问 <code>http://127.0.0.1:8000/admin/</code></li>
<li>使用刚创建的超级用户账号登录</li>
<li>在 "文章" 管理界面添加几篇文章</li>
</ol>
<p><strong>查看博客：</strong></p>
<ul>
<li>访问 <code>http://127.0.0.1:8000/</code> 查看文章列表</li>
<li>点击任意文章标题查看详情</li>
</ul>
<p><strong>程序运行结果：</strong>
你将看到一个完整的博客系统，包含文章列表、文章详情、后台管理等功能。所有的增删改查操作都通过 Django 的 ORM 自动完成，无需编写任何 SQL 语句。</p>
<h2 data-id="heading-14">5. 最佳实践与常见陷阱</h2>
<h3 data-id="heading-15">常见错误及规避方法</h3>
<p><strong>错误 1：忘记在 <code>INSTALLED_APPS</code> 中注册应用</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-comment"># 创建应用后忘记在 settings.py 中注册</span>
python manage.py startapp myapp
<span class="hljs-comment"># 直接使用模型，导致错误：django.core.exceptions.ImproperlyConfigured</span>

<span class="hljs-comment"># ✅ 正确做法</span>
INSTALLED_APPS = [
    <span class="hljs-comment"># ... 其他应用</span>
    <span class="hljs-string">'myapp'</span>,  <span class="hljs-comment"># 记得注册应用</span>
]
</code></pre>
<p><strong>错误 2：在模板中编写复杂业务逻辑</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-comment"># 在模板中进行复杂的数据处理</span>
{% <span class="hljs-keyword">for</span> article <span class="hljs-keyword">in</span> articles %}
    {% <span class="hljs-keyword">if</span> article.content|length &gt; <span class="hljs-number">100</span> %}
        &lt;p&gt;{{ article.content|<span class="hljs-built_in">slice</span>:<span class="hljs-string">":100"</span> }}...&lt;/p&gt;
    {% <span class="hljs-keyword">else</span> %}
        &lt;p&gt;{{ article.content }}&lt;/p&gt;
    {% endif %}
{% endfor %}

<span class="hljs-comment"># ✅ 正确做法</span>
<span class="hljs-comment"># 在 View 中预处理数据</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">article_list</span>(<span class="hljs-params">request</span>):
    articles = Article.objects.annotate(
        short_content=Substr(<span class="hljs-string">'content'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">100</span>)
    )
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">'blog/list.html'</span>, {<span class="hljs-string">'articles'</span>: articles})
</code></pre>
<p><strong>错误 3：直接使用 <code>.get()</code> 而不处理异常</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-comment"># 可能抛出 DoesNotExist 异常导致 500 错误</span>
article = Article.objects.get(<span class="hljs-built_in">id</span>=article_id)

<span class="hljs-comment"># ✅ 正确做法</span>
<span class="hljs-comment"># 使用 get_object_or_404 或 try-except</span>
<span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> get_object_or_404
article = get_object_or_404(Article, <span class="hljs-built_in">id</span>=article_id)
</code></pre>
<h3 data-id="heading-16">最佳实践建议</h3>
<p><strong>1. 使用虚拟环境隔离项目依赖</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建虚拟环境</span>
python -m venv venv

<span class="hljs-comment"># 激活虚拟环境</span>
<span class="hljs-comment"># Windows</span>
venv\Scripts\activate
<span class="hljs-comment"># Mac/Linux</span>
<span class="hljs-built_in">source</span> venv/bin/activate

<span class="hljs-comment"># 安装依赖</span>
pip install django
pip freeze &gt; requirements.txt
</code></pre>
<p><strong>2. 合理组织项目结构</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">project/
├── apps/
│   ├── blog/
│   └── users/
├── config/
│   ├── settings/
│   │   ├── base.py
│   │   ├── development.py
│   │   └── production.py
│   └── urls.py
├── <span class="hljs-type">static</span>/
├── templates/
├── media/
└── manage.py
</code></pre>
<p><strong>3. 充分利用 Django Admin 的定制功能</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@admin.register(<span class="hljs-params">Article</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleAdmin</span>(admin.ModelAdmin):
    <span class="hljs-comment"># 列表页显示字段</span>
    list_display = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'author'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'is_published'</span>]
    
    <span class="hljs-comment"># 启用列表页编辑</span>
    list_editable = [<span class="hljs-string">'is_published'</span>]
    
    <span class="hljs-comment"># 添加搜索功能</span>
    search_fields = [<span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>]
    
    <span class="hljs-comment"># 添加过滤器</span>
    list_filter = [<span class="hljs-string">'is_published'</span>, <span class="hljs-string">'created_at'</span>, <span class="hljs-string">'author'</span>]
    
    <span class="hljs-comment"># 添加日期层级导航</span>
    date_hierarchy = <span class="hljs-string">'created_at'</span>
    
    <span class="hljs-comment"># 每页显示数量</span>
    list_per_page = <span class="hljs-number">20</span>
</code></pre>
<p><strong>4. 使用 context processors 共享全局数据</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建 context processor</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">global_context</span>(<span class="hljs-params">request</span>):
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">'site_name'</span>: <span class="hljs-string">'我的博客'</span>,
        <span class="hljs-string">'current_year'</span>: datetime.now().year,
    }

<span class="hljs-comment"># 在 settings.py 中注册</span>
TEMPLATES = [
    {
        <span class="hljs-string">'OPTIONS'</span>: {
            <span class="hljs-string">'context_processors'</span>: [
                <span class="hljs-comment"># ... 其他 processors</span>
                <span class="hljs-string">'myapp.context_processors.global_context'</span>,
            ],
        },
    },
]
</code></pre>
<p><strong>5. 善用 Django 的信号机制</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db.models.signals <span class="hljs-keyword">import</span> post_save
<span class="hljs-keyword">from</span> django.dispatch <span class="hljs-keyword">import</span> receiver
<span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Article

<span class="hljs-meta">@receiver(<span class="hljs-params">post_save, sender=Article</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification</span>(<span class="hljs-params">sender, instance, created, **kwargs</span>):
    <span class="hljs-string">"""文章保存后发送通知"""</span>
    <span class="hljs-keyword">if</span> created:
        <span class="hljs-comment"># 发送新文章通知</span>
        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 发送文章更新通知</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<h2 data-id="heading-17">6. 进阶指引</h2>
<p>掌握了 Django 的基础知识后，你可以继续探索以下高级主题：</p>
<h3 data-id="heading-18">高级功能</h3>
<ul>
<li><strong>类视图（Class-Based Views）</strong>：使用 <code>ListView</code>、<code>DetailView</code>、<code>CreateView</code> 等通用视图减少代码重复</li>
<li><strong>中间件（Middleware）</strong>：实现请求/响应的横切关注点，如日志记录、性能监控</li>
<li><strong>信号（Signals）</strong>：实现解耦的事件驱动编程</li>
<li><strong>缓存系统</strong>：使用 Redis 或 Memcached 提升应用性能</li>
<li><strong>异步视图</strong>：利用 Django 5.0 的异步支持处理 IO 密集型任务</li>
</ul>
<h3 data-id="heading-19">生态扩展</h3>
<ul>
<li><strong>Django REST Framework</strong>：构建强大的 RESTful API</li>
<li><strong>Celery</strong>：处理异步任务和定时任务</li>
<li><strong>Django CMS</strong>：快速搭建内容管理系统</li>
<li><strong>Wagtail</strong>：现代化的内容管理系统</li>
<li><strong>Django Debug Toolbar</strong>：调试和性能分析工具</li>
</ul>
<h3 data-id="heading-20">学习资源</h3>
<ul>
<li><strong>官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fzh-hans%2F5.0%2F%25EF%25BC%2588%25E6%259C%2580%25E6%259D%2583%25E5%25A8%2581%25E3%2580%2581%25E6%259C%2580%25E5%2585%25A8%25E9%259D%25A2%25EF%25BC%2589" target="_blank" title="https://docs.djangoproject.com/zh-hans/5.0/%EF%BC%88%E6%9C%80%E6%9D%83%E5%A8%81%E3%80%81%E6%9C%80%E5%85%A8%E9%9D%A2%EF%BC%89" ref="nofollow noopener noreferrer">docs.djangoproject.com/zh-hans/5.0…</a></li>
<li><strong>Django Girls 教程</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftutorial.djangogirls.org%2Fzh%2F%25EF%25BC%2588%25E9%2580%2582%25E5%2590%2588%25E5%25AE%258C%25E5%2585%25A8%25E5%2588%259D%25E5%25AD%25A6%25E8%2580%2585%25EF%25BC%2589" target="_blank" title="https://tutorial.djangogirls.org/zh/%EF%BC%88%E9%80%82%E5%90%88%E5%AE%8C%E5%85%A8%E5%88%9D%E5%AD%A6%E8%80%85%EF%BC%89" ref="nofollow noopener noreferrer">tutorial.djangogirls.org/zh/（适合完全初学者…</a></li>
<li><strong>Two Scoops of Django</strong>：Django 最佳实践的权威指南</li>
<li><strong>Django Project GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdjango%2Fdjango%25EF%25BC%2588%25E6%25BA%2590%25E7%25A0%2581%25E5%25AD%25A6%25E4%25B9%25A0%25EF%25BC%2589" target="_blank" title="https://github.com/django/django%EF%BC%88%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%89" ref="nofollow noopener noreferrer">github.com/django/djan…</a></li>
<li><strong>Stack Overflow Django 标签</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2Ftagged%2Fdjango%25EF%25BC%2588%25E9%2597%25AE%25E9%25A2%2598%25E8%25A7%25A3%25E7%25AD%2594%25EF%25BC%2589" target="_blank" title="https://stackoverflow.com/questions/tagged/django%EF%BC%88%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94%EF%BC%89" ref="nofollow noopener noreferrer">stackoverflow.com/questions/t…</a></li>
</ul>
<p>Django 的学习曲线相对平缓，但要真正掌握它的精髓，需要不断地实践和探索。建议从实际项目出发，在解决问题的过程中深入理解各个组件的设计理念和使用技巧。记住，Django 的强大之处不仅在于它的功能丰富，更在于它倡导的"约定优于配置"和"不要重复自己"（DRY）的编程哲学。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里Qwen-Image-2.0实测：终于有一款能听懂人话、写对汉字的AI了]]></title>    <link>https://juejin.cn/post/7604791354259390502</link>    <guid>https://juejin.cn/post/7604791354259390502</guid>    <pubDate>2026-02-10T12:46:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604791354259390502" data-draft-id="7604984549173903369" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里Qwen-Image-2.0实测：终于有一款能听懂人话、写对汉字的AI了"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-10T12:46:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里Qwen-Image-2.0实测：终于有一款能听懂人话、写对汉字的AI了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:46:04.000Z" title="Tue Feb 10 2026 12:46:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年的AI圈开年大戏，比预想中来得更猛烈一些。</p>
<p>就在2月10日，没有任何预热铺垫，阿里巴巴通义千问团队直接把Qwen-Image-2.0摆上了台面。如果你对国产模型的印象还停留在“追赶者”的角色，这次可能得刷新一下认知了。</p>
<p>我看完了所有的官方披露和媒体实测，最直观的感受只有两个字：实用。它不再只是生成一些除了好看一无是处的“显卡壁纸”，而是真正想往你的生产力工具里钻。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdgdfag-1-1024x811.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdgdfag-1-1024x811.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9337e1305e504c25858b611f3cad3f0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332366&amp;x-signature=BLLOZQA4Fa863VBbOVmcRAhkb9o%3D" alt="asdgdfag" loading="lazy"/></a></p>
<p><strong>瘦身成功，但脑子更灵光了</strong></p>
<p>这次升级最反直觉的一点是模型变“小”了。</p>
<p>相比上一代动辄200亿参数的庞然大物，Qwen-Image-2.0采用了更轻量的7B参数统一架构。别看参数少了，它玩了一手“合二为一”的绝活：这是业界罕见的将“图像生成”和“图像编辑”功能塞进同一个模型里的尝试。</p>
<p>这意味着什么？意味着你不需要在生图模型和修图模型之间来回横跳。生成一张图，觉得左上角光线不对？直接告诉它“把左上角调亮”，同一个大脑瞬间就能处理，推理速度快得惊人。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdgdfagdf-1-1024x512.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdgdfagdf-1-1024x512.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78fadb7056fd463dac7f2aa96c2c6671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332366&amp;x-signature=Q94dBKwuznDiOj3aAyKWuLi0K6k%3D" alt="asdgdfagdf" loading="lazy"/></a></p>
<p><strong>专治“甲方综合征”的长文本理解</strong></p>
<p>以前玩AI绘图，大家都在卷提示词的精简度。但Qwen-Image-2.0反其道而行之，它支持整整1K token的超长指令。</p>
<p>这直接解决了设计圈的一个痛点：复杂的逻辑。</p>
<p>你可以把一份详细的活动策划、复杂的A/B测试数据，甚至是一段啰嗦的甲方修改意见直接扔给它。它不仅能读懂，还能执行出分叉的时间轴、多图层的海报，甚至是包含“画中画”逻辑的复杂PPT。在AI Arena的测评里，它的文生图拿到了1029分，全球第三，把Flux2-Max这类狠角色都甩在了身后，目前也就谷歌的Nano Banana Pro还能压它一头。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdgfdgdfsg-1-1024x585.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdgfdgdfsg-1-1024x585.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8113772d4a5444758e18f23145ef8f93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332366&amp;x-signature=trCpKhOPNDBNHzA78GFuYrwqw3s%3D" alt="asdgfdgdfsg" loading="lazy"/></a></p>
<p><strong>汉字渲染：这次是真的写对了</strong></p>
<p>对于中文用户来说，Qwen-Image-2.0最大的杀手锏是它对汉字的掌控力。</p>
<p>众所周知，让国外模型写汉字，出来的基本都是“鬼画符”。但阿里毕竟是本土作战，这次的中文渲染能力堪称恐怖。媒体报道中提到一个细节：它能用瘦金体或者小楷，把几百字的《兰亭集序》全文渲染进图片里，错字率极低，而且排版极具美感。</p>
<p>不管是做古风海报，还是生成带数据的商业图表，它终于不再是“文盲”了。这点在办公场景下，价值巨大。</p>
<p><strong>告别“AI油腻感”</strong></p>
<p>在画质方面，2K分辨率（2048×2048）成了标配。更有意思的是它的审美取向。</p>
<p>这一代模型似乎刻意去除了以往AI生成图中那种塑料感十足的“油腻光泽”。无论是人物皮肤的毛孔细节，还是建筑的纹理，它都更倾向于摄影级的真实质感。如果不拿放大镜看，你很难一眼辨别出这是AI画的还是单反拍的。</p>
<p><strong>怎么玩？</strong></p>
<p>阿里这次很良心，没有搞封闭内测那一套。</p>
<p>对于普通玩家，直接去Qwen Chat的网页就能免费白嫖，生图、改图都能试。对于开发者，阿里云百炼平台也已经开了API邀测。</p>
<p>总的来说，Qwen-Image-2.0或许不是参数最大的模型，但它极有可能是目前最懂中文语境、最适合干正经事儿的图像模型。当AI开始能精准画PPT、写书法的时候，它离接管我们的部分工作真的不远了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一款开源、强大、简单易用的 .NET 假数据生成利器]]></title>    <link>https://juejin.cn/post/7605041556655947785</link>    <guid>https://juejin.cn/post/7605041556655947785</guid>    <pubDate>2026-02-10T12:54:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041556655947785" data-draft-id="7604984549173886985" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一款开源、强大、简单易用的 .NET 假数据生成利器"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-02-10T12:54:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一款开源、强大、简单易用的 .NET 假数据生成利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:54:39.000Z" title="Tue Feb 10 2026 12:54:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常的 .NET 项目开发中，我们经常需要大量的测试数据来验证业务逻辑、填充数据库、进行性能测试或者做产品演示。手动编写这些测试数据不仅枯燥乏味、浪费时间，而且难以覆盖各种边界场景。今天大姚给大家推荐一款开源、强大、简单易用的 .NET 假数据生成库：<strong>Bogus</strong>。</p>
<ul>
<li><strong>👪DotNetGuide技术社区：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCbPvhmfK4ZWsHJj2eKMk7Q" target="_blank" title="https://mp.weixin.qq.com/s/CbPvhmfK4ZWsHJj2eKMk7Q" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/CbPvhmfK4…</a></li>
</ul>
<h2 data-id="heading-1">项目介绍</h2>
<p>Bogus 是一个基于著名的 faker.js 移植而来的开源（MIT License） .NET 假数据生成库，它为 .NET 开发者提供了一套强大、简单易用的 API，可快速生成各种类型的模拟数据，支持 40+ 种语言区域本地化，广泛应用于单元测试、数据库填充、原型演示以及示例数据生成等场景。</p>
<h2 data-id="heading-2">支持语言</h2>
<p>支持语言：C#、F#、VB.NET。</p>
<h2 data-id="heading-3">应用场景</h2>
<ul>
<li><strong>单元测试 / 集成测试</strong>：快速生成符合业务模型的测试对象，替代手工 Mock 数据。</li>
<li><strong>数据库填充（Seed）</strong> ：开发/测试环境数据库填充真实感十足的假数据。</li>
<li><strong>性能与压力测试</strong>：批量生成大规模数据集来模拟真实负载。</li>
<li><strong>API 开发调试</strong>：快速构造 API 返回的模拟响应数据。</li>
<li><strong>数据脱敏</strong>：替换生产数据中的敏感信息。</li>
</ul>
<h2 data-id="heading-4">支持以下语言环境</h2>
<p>Bogus 支持以下语言环境：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b80fae0df9646318db13df2395e921a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=ELX7%2BcZZxOFkjntQWixV3TSAlPA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">创建一个 .NET 控制台应用</h2>
<p>接下来我们创建一个名为：<code>BogusExercise</code> .NET 9 控制台应用：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90476a0dde2c4532ae661d74f32fd1c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=sQfiwX2vpuXP1nIhHLma%2BVmsdDU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73db0fcd93c64419b5477ee84726819c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=0%2Bbb4wTDg3oOTnkGyv6xZBWBpb0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">项目 NuGet 安装</h2>
<p>在 NuGet 包管理器控制台中执行：</p>
<pre><code class="hljs">Install-Package Bogus
</code></pre>
<p>或者在 NuGet 包管理器中搜索安装：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e780fccf5044f3f8ac3f2102192f55b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332880&amp;x-signature=GlLJG3R7JonhGHBFzv3N2JCSpcE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">Bogus 快速入门</h2>
<h3 data-id="heading-8">生成 3 个随机订单的模拟用户信息</h3>
<p>以下是 Bogus 仓库中提供的示例代码，使用 Bogus 生成了 3 个带随机订单的模拟用户。</p>
<pre><code class="hljs language-dart" lang="dart">    public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    </span>{
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> Main(string[] args)
        {
            <span class="hljs-comment">//生成 3 个随机订单的模拟用户信息</span>
            <span class="hljs-keyword">var</span> users = GenerateSampleUsers(<span class="hljs-number">3</span>);
        }

        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
        <span class="hljs-comment">///<span class="markdown"> 生成随机订单的模拟用户</span></span>
        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"count"</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">param</span>&gt;</span></span></span></span>
        <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">returns</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">returns</span>&gt;</span></span></span></span>
        public <span class="hljs-keyword">static</span> <span class="hljs-built_in">List</span>&lt;User&gt; GenerateSampleUsers(<span class="hljs-built_in">int</span> count = <span class="hljs-number">3</span>)
        {
            <span class="hljs-comment">// 设置随机种子，生成可重复的数据集</span>
            Randomizer.Seed = <span class="hljs-keyword">new</span> Random(<span class="hljs-number">3897234</span>);

            <span class="hljs-keyword">var</span> fruit = <span class="hljs-keyword">new</span>[] { <span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"strawberry"</span>, <span class="hljs-string">"kiwi"</span> };

            <span class="hljs-keyword">var</span> orderIds = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> testOrders = <span class="hljs-keyword">new</span> Faker&lt;Order&gt;()
                <span class="hljs-comment">// 开启严格模式：确保所有属性都有规则</span>
                .StrictMode(<span class="hljs-keyword">true</span>)
                <span class="hljs-comment">// OrderId 自增</span>
                .RuleFor(o =&gt; o.OrderId, f =&gt; orderIds++)
                <span class="hljs-comment">// 从水果篮中随机挑选</span>
                .RuleFor(o =&gt; o.Item, f =&gt; f.PickRandom(fruit))
                <span class="hljs-comment">// 随机数量 1~10</span>
                .RuleFor(o =&gt; o.Quantity, f =&gt; f.Random.Number(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
                <span class="hljs-comment">// 可空 int?，80% 概率为 null</span>
                .RuleFor(o =&gt; o.LotNumber, f =&gt; f.Random.Int(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>).OrNull(f, <span class="hljs-number">.8</span>f));

            <span class="hljs-keyword">var</span> userIds = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> testUsers = <span class="hljs-keyword">new</span> Faker&lt;User&gt;()
                <span class="hljs-comment">// 自定义构造函数</span>
                .CustomInstantiator(f =&gt; <span class="hljs-keyword">new</span> User(userIds++, f.Random.Replace(<span class="hljs-string">"###-##-####"</span>)))
                <span class="hljs-comment">// 基本规则</span>
                .RuleFor(u =&gt; u.FirstName, f =&gt; f.Name.FirstName())
                .RuleFor(u =&gt; u.LastName, f =&gt; f.Name.LastName())
                .RuleFor(u =&gt; u.Avatar, f =&gt; f.Internet.Avatar())
                .RuleFor(u =&gt; u.UserName, (f, u) =&gt; f.Internet.UserName(u.FirstName, u.LastName))
                .RuleFor(u =&gt; u.Email, (f, u) =&gt; f.Internet.Email(u.FirstName, u.LastName))
                .RuleFor(u =&gt; u.SomethingUnique, f =&gt; $<span class="hljs-string">"Value {f.UniqueIndex}"</span>)
                .RuleFor(u =&gt; u.SomeGuid, Guid.NewGuid)
                <span class="hljs-comment">// 随机选取枚举</span>
                .RuleFor(u =&gt; u.Gender, f =&gt; f.PickRandom&lt;Gender&gt;())
                .RuleFor(u =&gt; u.CartId, f =&gt; Guid.NewGuid())
                <span class="hljs-comment">// 组合属性：利用已生成的 FirstName 和 LastName</span>
                .RuleFor(u =&gt; u.FullName, (f, u) =&gt; u.FirstName + <span class="hljs-string">" "</span> + u.LastName)
                <span class="hljs-comment">// 嵌套集合生成</span>
                .RuleFor(u =&gt; u.Orders, f =&gt; testOrders.Generate(<span class="hljs-number">3</span>))
                <span class="hljs-comment">// 生成完成后的回调</span>
                .FinishWith((f, u) =&gt;
                {
                    Console.WriteLine(<span class="hljs-string">"User Created! Name={0}"</span>, u.FullName);
                });

            <span class="hljs-comment">// 一次生成 3 个用户</span>
            <span class="hljs-keyword">return</span> testUsers.Generate(count);
        }
    }

    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    <span class="hljs-comment">///<span class="markdown"> 订单实体</span></span>
    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span>
    </span>{
        public <span class="hljs-built_in">int</span> OrderId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string Item { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public <span class="hljs-built_in">int</span> Quantity { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public <span class="hljs-built_in">int?</span> LotNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }

    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    <span class="hljs-comment">///<span class="markdown"> 性别枚举</span></span>
    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    public <span class="hljs-keyword">enum</span> Gender
    {
        Male,
        Female
    }

    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    <span class="hljs-comment">///<span class="markdown"> 用户实体</span></span>
    <span class="hljs-comment">///<span class="markdown"> <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">summary</span>&gt;</span></span></span></span>
    public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>
    </span>{
        public User(<span class="hljs-built_in">int</span> userId, string ssn)
        {
            <span class="hljs-keyword">this</span>.Id = userId;
            <span class="hljs-keyword">this</span>.SSN = ssn;
        }

        public <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string FirstName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string LastName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string FullName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string UserName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string SomethingUnique { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public Guid SomeGuid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string Avatar { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public Guid CartId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public string SSN { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public Gender Gender { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        public <span class="hljs-built_in">List</span>&lt;Order&gt; Orders { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }
</code></pre>
<h3 data-id="heading-9">生成随机用户信息</h3>
<p>使用 Bogus 快速生成随机用户姓名、邮箱、地址、电话等关联数据：</p>
<pre><code class="hljs language-csharp" lang="csharp">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成随机用户信息</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GenerateRandomData</span>()</span>
        {
            <span class="hljs-comment">// 自动生成姓名、邮箱、地址、电话等关联数据</span>
            <span class="hljs-keyword">var</span> faker = <span class="hljs-keyword">new</span> Faker(<span class="hljs-string">"zh_CN"</span>);<span class="hljs-comment">// 使用简体中文</span>
            <span class="hljs-keyword">var</span> randomName = faker.Name.FullName();
            <span class="hljs-keyword">var</span> randomEmail = faker.Internet.Email();
            <span class="hljs-keyword">var</span> randomAddress = faker.Address.FullAddress();
            <span class="hljs-keyword">var</span> randomPhone = faker.Phone.PhoneNumber();
            Console.WriteLine(<span class="hljs-string">$"Name: <span class="hljs-subst">{randomName}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"Email: <span class="hljs-subst">{randomEmail}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"Address: <span class="hljs-subst">{randomAddress}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"Phone: <span class="hljs-subst">{randomPhone}</span>"</span>);
        }
</code></pre>
<h3 data-id="heading-10">EF Core 数据库种子数据填充</h3>
<p>使用 EF Core 填充 Blog &amp; Post 数据：</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> EF Core 数据库种子数据填充</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 适合开发/测试环境，在应用启动时自动填充数据：</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> FakeData.Init(10); // 生成 10 个 Blog，每个包含 3~5 篇 Post</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FakeData</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Blog&gt; Blogs = <span class="hljs-keyword">new</span> List&lt;Blog&gt;();
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Post&gt; Posts = <span class="hljs-keyword">new</span> List&lt;Post&gt;();

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Init</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> count</span>)</span>
        {
            <span class="hljs-keyword">var</span> postId = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> postFaker = <span class="hljs-keyword">new</span> Faker&lt;Post&gt;()
                .RuleFor(p =&gt; p.PostId, _ =&gt; postId++)
                .RuleFor(p =&gt; p.Title, f =&gt; f.Hacker.Phrase())
                .RuleFor(p =&gt; p.Content, f =&gt; f.Lorem.Sentence());

            <span class="hljs-keyword">var</span> blogId = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> blogFaker = <span class="hljs-keyword">new</span> Faker&lt;Blog&gt;()
                .RuleFor(b =&gt; b.BlogId, _ =&gt; blogId++)
                .RuleFor(b =&gt; b.Url, f =&gt; f.Internet.Url())
                .RuleFor(b =&gt; b.Posts, (f, b) =&gt;
                {
                    postFaker.RuleFor(p =&gt; p.BlogId, _ =&gt; b.BlogId);
                    <span class="hljs-keyword">var</span> posts = postFaker.GenerateBetween(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>);

                    <span class="hljs-comment">// 关键：收集所有 Posts 到静态列表中</span>
                    Posts.AddRange(posts);

                    <span class="hljs-keyword">return</span> posts;
                });

            <span class="hljs-comment">// 清空旧数据，避免重复调用累积</span>
            Blogs.Clear();
            Posts.Clear();

            Blogs = blogFaker.Generate(count);
        }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> Blog</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BlogId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Url { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> List&lt;Post&gt; Posts { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }

    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> Post</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Post</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> PostId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Title { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Content { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> BlogId { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    }
</code></pre>
<p>在 Program.cs 启动时填充：</p>
<pre><code class="hljs language-ini" lang="ini">    public class Program
    {
        public static void Main(string<span class="hljs-section">[]</span> args)
        {
            var <span class="hljs-attr">builder</span> = WebApplication.CreateBuilder(args)<span class="hljs-comment">;</span>

            // 注册 DbContext
            builder.Services.AddDbContext&lt;BlogDbContext&gt;(<span class="hljs-attr">options</span> =&gt;
                options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")))<span class="hljs-comment">;</span>

            var <span class="hljs-attr">app</span> = builder.Build()<span class="hljs-comment">;</span>

            // 应用启动时填充种子数据
            using (var <span class="hljs-attr">scope</span> = app.Services.CreateScope())
            {
                var <span class="hljs-attr">context</span> = scope.ServiceProvider.GetRequiredService&lt;BlogDbContext&gt;()<span class="hljs-comment">;</span>

                // 确保数据库已创建
                context.Database.EnsureCreated()<span class="hljs-comment">;</span>

                // 仅在数据库为空时填充假数据
                if (!context.Blogs.Any())
                {
                    FakeData.Init(10)<span class="hljs-comment">; // 生成 10 个 Blog，每个包含 3~5 篇 Post</span>

                    context.Blogs.AddRange(FakeData.Blogs)<span class="hljs-comment">;</span>
                    context.Posts.AddRange(FakeData.Posts)<span class="hljs-comment">;</span>
                    context.SaveChanges()<span class="hljs-comment">;</span>

                    Console.WriteLine($"已填充 {FakeData.Blogs.Count} 个博客, {FakeData.Posts.Count} 篇文章")<span class="hljs-comment">;</span>
                }
            }

            app.MapControllers()<span class="hljs-comment">;</span>
            app.Run()<span class="hljs-comment">;</span>
        }
    }
</code></pre>
<h3 data-id="heading-11">自定义扩展 Bogus 数据集</h3>
<p>开发者可以轻松扩展 Bogus，添加自定义的数据生成器：</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 为 Bogus 的 Faker 类提供食品相关的自定义假数据扩展方法</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FoodExtensions</span>
    {
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成一个随机的糖果名称</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="faker"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Candy</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Faker faker</span>)</span>
        {
            <span class="hljs-keyword">return</span> faker.PickRandom(<span class="hljs-keyword">new</span>[] { <span class="hljs-string">"巧克力"</span>, <span class="hljs-string">"棒棒糖"</span>, <span class="hljs-string">"口香糖"</span>, <span class="hljs-string">"软糖"</span>, <span class="hljs-string">"太妃糖"</span> });
        }

        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 生成一个随机的饮品名称</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="faker"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Drink</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Faker faker</span>)</span>
        {
            <span class="hljs-keyword">return</span> faker.PickRandom(<span class="hljs-keyword">new</span>[] { <span class="hljs-string">"可乐"</span>, <span class="hljs-string">"雪碧"</span>, <span class="hljs-string">"橙汁"</span>, <span class="hljs-string">"咖啡"</span>, <span class="hljs-string">"牛奶"</span> });
        }
    }
    
    <span class="hljs-comment">// 使用自定义扩展</span>
    <span class="hljs-keyword">var</span> faker = <span class="hljs-keyword">new</span> Faker();
    Console.WriteLine(<span class="hljs-string">$"最爱糖果: <span class="hljs-subst">{faker.Candy()}</span>"</span>);
    Console.WriteLine(<span class="hljs-string">$"最爱饮料: <span class="hljs-subst">{faker.Drink()}</span>"</span>);
</code></pre>
<h2 data-id="heading-12">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbchavez%2FBogus" target="_blank" title="https://github.com/bchavez/Bogus" ref="nofollow noopener noreferrer">github.com/bchavez/Bog…</a></li>
<li><strong>文章代码示例：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetExercises%2Ftree%2Fmaster%2FBogusExercise" target="_blank" title="https://github.com/YSGStudyHards/DotNetExercises/tree/master/BogusExercise" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<h2 data-id="heading-13">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#/.NET/.NET Core优秀项目和框架2026年1月简报]]></title>    <link>https://juejin.cn/post/7604984549173919753</link>    <guid>https://juejin.cn/post/7604984549173919753</guid>    <pubDate>2026-02-10T12:56:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604984549173919753" data-draft-id="7605036907458412595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#/.NET/.NET Core优秀项目和框架2026年1月简报"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-02-10T12:56:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#/.NET/.NET Core优秀项目和框架2026年1月简报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:56:03.000Z" title="Tue Feb 10 2026 12:56:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28a0d0e920c44fc19a695c5f81599b41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=FUItO%2FW9wbn0%2Fz2TMwYkWRAp5Lg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>公众号每月定期推广和分享的C#/.NET/.NET Core优秀项目和框架（每周至少会推荐两个优秀的项目和框架当然节假日除外），公众号推文中有项目和框架的详细介绍、功能特点、使用方式以及部分功能截图等（打不开或者打开GitHub很慢的同学可以优先查看公众号推文，文末一定会附带项目和框架源码地址）。注意：排名不分先后，都是十分优秀的开源项目和框架，每周定期更新分享。</p>
<ul>
<li><strong>💡简报Gitee开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectMonthly.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectMonthly.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></strong></li>
<li><strong>🔔简报GitHub开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectMonthly.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectMonthly.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></strong></li>
<li><strong>👪DotNetGuide技术社区：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCbPvhmfK4ZWsHJj2eKMk7Q" target="_blank" title="https://mp.weixin.qq.com/s/CbPvhmfK4ZWsHJj2eKMk7Q" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/CbPvhmfK4…</a></li>
</ul>
<h2 data-id="heading-1">PicView</h2>
<ul>
<li><strong>项目简介：</strong> PicView 是一款基于 .NET Avalonia 的开源免费、快速、可高度定制、跨平台的图片查看器，支持 macOS 和 Windows 10/11 操作系统。它支持几乎所有常见的图像文件类型，包括但不限于 (animated)WEBP、(animated)GIF、SVG、AVIF、HEIC、PSD 等，为用户提供了一个清洁、无干扰且高效的图片浏览体验。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRuben2776%2FPicView" target="_blank" title="https://github.com/Ruben2776/PicView" ref="nofollow noopener noreferrer">github.com/Ruben2776/P…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FeFQoxqJqbpQAPGpVaXd6Wg" target="_blank" title="https://mp.weixin.qq.com/s/eFQoxqJqbpQAPGpVaXd6Wg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/eFQoxqJqb…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81f96d3fa1604dfea401d05590894cf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=WaoxkSAUYeTRiz3Me9z7%2BIFgxwg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/babf74fa47fb4f6c97a3a5318f5fb504~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=Eak5vM3AMHaKzzdHAKeyLY2UPSg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">NanUI</h2>
<ul>
<li><strong>项目简介：</strong> NanUI 是一个基于 .NET 平台的开源（MIT License）框架，旨在帮助开发者使用 HTML5、CSS3 和 JavaScript 构建具有现代感的 WinForm 应用程序用户界面。它底层依托于 Xilium.CefGlue 这是 Chromium Embedded Framework（CEF）在 .NET 环境下的官方绑定实现，通过嵌入完整的 Chromium 渲染引擎，使 WinForm 应用能够呈现 Web 技术驱动的富交互界面。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdotnetchina%2FNanUI" target="_blank" title="https://gitee.com/dotnetchina/NanUI" ref="nofollow noopener noreferrer">gitee.com/dotnetchina…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2PDN5Q31wX6vEctodVKcig" target="_blank" title="https://mp.weixin.qq.com/s/2PDN5Q31wX6vEctodVKcig" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/2PDN5Q31w…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b217456fd15c42009ad69fd6a0151506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=1s2cCQvnFizTMCK6KJBPIDoINMs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19d819666f0948e697305a41db776f53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=27U5KC8jJrLz%2FHYfDQQ%2FygHlZEk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">Generative-AI-for-beginners-dotnet</h2>
<ul>
<li><strong>项目简介：</strong> Generative-AI-for-beginners-dotnet 是一个微软官方开源且实用课程，教你如何在.NET 中构建生成式人工智能应用。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FGenerative-AI-for-beginners-dotnet" target="_blank" title="https://github.com/microsoft/Generative-AI-for-beginners-dotnet" ref="nofollow noopener noreferrer">github.com/microsoft/G…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fzy16qmxDPbxovRwHvKae6g" target="_blank" title="https://mp.weixin.qq.com/s/zy16qmxDPbxovRwHvKae6g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/zy16qmxDP…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dec180ab8f24f1a942c24ca5fde1667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=g4TFUoIWD19mxxzqL%2BeyE6fPyYA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">XAML Studio</h2>
<ul>
<li><strong>项目简介：</strong> XAML Studio 是一款专为 WinUI XAML 设计的快速原型设计工具，基于 C# 开源（MIT license），生成的代码可轻松复制到 Visual Studio 中的应用中。XAML Studio 让你实时预览 XAML 代码，并与结果互动，就像它在你自己的应用中运行一样。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnet%2FXAMLStudio" target="_blank" title="https://github.com/dotnet/XAMLStudio" ref="nofollow noopener noreferrer">github.com/dotnet/XAML…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FKf_MrpoC-I7UbhmUNLusow" target="_blank" title="https://mp.weixin.qq.com/s/Kf_MrpoC-I7UbhmUNLusow" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Kf_MrpoC-…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e08ab50f4ef344c589b0daeba0c36f74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=C1EtgCQ7VpBW%2FOD0cvSKInhaKCU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8174ee62cd704e81bb2bba317730b471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=7v%2BsKB402Pkgfs6XVLhYYg%2BiqxE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Codist</h2>
<ul>
<li><strong>项目简介：</strong> Codist 是一个使用 .NET 编写、开源免费的 Visual Studio 扩展插件，致力于为 C# 程序员提供更好的编程体验和生产效率。它不仅强化了语法高亮、快速信息提示、导航栏、滚动条和显示质量，还集成了自动版本号更新、括号自动补全、支持高级编辑功能的智能工具栏、代码分析等功能。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwmjordan%2FCodist" target="_blank" title="https://github.com/wmjordan/Codist" ref="nofollow noopener noreferrer">github.com/wmjordan/Co…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUWuCIY4Q5PJeNClrQWPGEw" target="_blank" title="https://mp.weixin.qq.com/s/UWuCIY4Q5PJeNClrQWPGEw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/UWuCIY4Q5…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36c7dca1f9ec44b8a0d5e7f7b397c405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=nb%2BguVASxRKkMKdFzVu3M3Vz4J0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">PropertyTools</h2>
<ul>
<li><strong>项目简介：</strong> PropertyTools 是一款开源（MIT license）、免费的 WPF 自定义控件集，该控件集涵盖了 PropertyGrid、DataGrid、支持多选的 TreeView、ColorPicker 等常用控件。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPropertyTools%2FPropertyTools" target="_blank" title="https://github.com/PropertyTools/PropertyTools" ref="nofollow noopener noreferrer">github.com/PropertyToo…</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfLsTZWyY1W7UFJWCmIa4mQ" target="_blank" title="https://mp.weixin.qq.com/s/fLsTZWyY1W7UFJWCmIa4mQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/fLsTZWyY1…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25fa205b29f54571a4b8c9ccb68c6b48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=mtvfUeOEwUbuT9FBGYfpMFkGq%2Bg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eac31637b0140aa9baf4f36f382dcb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=NEERduwnFzUUM8Q3kXo6iGs7NgM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">WMES</h2>
<ul>
<li><strong>项目简介：</strong> WMES 是一套基于 ASP.NET 6.0 MVC + SqlSugar + LayUI 的框架，源代码完全开源。该系统旨在帮助企业解决 C#.NET 项目的重复工作，提高开发效率，节省人力成本，同时保持高度的灵活性。系统支持多数据库类型，模块化设计，层次结构清晰，内置一系列企业信息管理的基础功能。</li>
<li><strong>项目源码地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fbzh%2Fwmes" target="_blank" title="https://gitee.com/bzh/wmes" ref="nofollow noopener noreferrer">gitee.com/bzh/wmes</a></li>
<li><strong>项目详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsYCB90ss0sRiOS17F-fdhg" target="_blank" title="https://mp.weixin.qq.com/s/sYCB90ss0sRiOS17F-fdhg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/sYCB90ss0…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09eee9e8b9b7417681924f94f41cc54d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=DUlTBZ%2BlMTcAoqu9FYFCXuLhFAA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/569ba6734aff466091f06f0ae0e916b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771332965&amp;x-signature=7S66qG5s%2FnR9Dj%2FgQWZ1b3s05w0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React父子组件通信：从“武林秘籍”看懂数据流向]]></title>    <link>https://juejin.cn/post/7604793276908208191</link>    <guid>https://juejin.cn/post/7604793276908208191</guid>    <pubDate>2026-02-10T12:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604793276908208191" data-draft-id="7604769326225424420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React父子组件通信：从“武林秘籍”看懂数据流向"/> <meta itemprop="keywords" content="前端,React.js,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T12:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React父子组件通信：从“武林秘籍”看懂数据流向
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:59:50.000Z" title="Tue Feb 10 2026 12:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在React的江湖中，组件就像是各大门派的武林人士。有的位高权重如“父组件”，有的初出茅庐如“子组件”。在这个世界里，内功心法（数据）的传递有着森严的等级和规矩。</p>
<p>很多初学者在面对组件通信时，往往会被各种 Props、Callback、Context 搞得晕头转向。其实，只要搞懂了数据的流向，这套武功秘籍也就融会贯通了。</p>
<p>今天，我们就用一套“武林法则”，彻底拆解React中的四种核心通信方式。</p>
<h2 data-id="heading-0">一、父传子：盟主传授“单向秘籍”</h2>
<p>这是最基础的招式。想象一下，父组件是武林盟主，手里有一本绝世武功《九阴真经》（State），他想把这套武功传给刚入门的小徒弟（子组件）。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>授受不亲</strong>：盟主必须亲手把秘籍递给徒弟（在子组件标签上绑定属性）。</li>
<li><strong>只读铁律</strong>：徒弟拿到秘籍后，只能研读修炼，绝对不能擅自涂改秘籍上的文字！如果徒弟试图修改 Props，就会走火入魔（报错）。</li>
</ol>
<p><strong>代码演练：</strong></p>
<p>父组件（盟主）将 name 传给子组件：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> state = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'九阴真经'</span> <span class="hljs-comment">// 盟主手里的秘籍</span>
    };
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>武林盟主（父组件）<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            {/* 盟主发功：将秘籍打包成 msg 属性传给徒弟 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">{state.name}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p>子组件（徒弟）接收秘籍，谨记只读：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件 Child.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-comment">// props.msg = '葵花宝典'; // 错误示范：徒弟不能擅自篡改秘籍，否则报错！</span>
    
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* 徒弟展示学到的招式 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>入室弟子（子组件）-- 习得：{props.msg}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><strong>核心心法</strong>：Props 是只读（Read-Only）的。数据流向是从上至下的单向流动，这保证了数据源的纯净和可追溯。</p>
<h2 data-id="heading-1">二、子传父：徒弟呈递“飞鸽传书”</h2>
<p>有时候，青出于蓝而胜于蓝。徒弟（子组件）自己悟出了一套新招式（State），想要上报给盟主（父组件）。但江湖规矩森严，徒弟不能直接把招式塞进盟主的脑子里。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>锦囊妙计</strong>：盟主需要先给徒弟一个“空锦囊”（函数）。</li>
<li><strong>装入招式</strong>：徒弟在适当时机，把自己的新招式装进锦囊（调用函数并传参）。</li>
<li><strong>飞鸽回传</strong>：锦囊一旦封好，就会自动飞回盟主手中，盟主打开锦囊，更新自己的内力（setState）。</li>
</ol>
<p><strong>代码演练：</strong></p>
<p>父组件准备“锦囊”（函数）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.jsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// 定义锦囊：这是一个用来接收徒弟数据的函数</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">receiveMove</span> = (<span class="hljs-params">n</span>) =&gt; {
        <span class="hljs-title function_">setCount</span>(n); <span class="hljs-comment">// 盟主收到招式后，更新自己的内力</span>
    }

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>盟主内力值：{count}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            {/* 把锦囊（函数）传给徒弟 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">getNum</span>=<span class="hljs-string">{receiveMove}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p>子组件使用“锦囊”回传数据：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件 Child.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> state = {
        <span class="hljs-attr">num</span>: <span class="hljs-number">100</span> <span class="hljs-comment">// 徒弟自创的新招式</span>
    };

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">send</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 关键一步：调用父组件给的函数，把数据作为参数传回去</span>
        props.<span class="hljs-title function_">getNum</span>(state.<span class="hljs-property">num</span>);
    }

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>入室弟子<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{send}</span>&gt;</span>飞鸽传书给盟主<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><strong>核心心法</strong>：React 中没有直接的“子传父”语法，本质是<strong>父组件将函数作为 Props 传递给子组件，子组件执行该函数</strong>。</p>
<h2 data-id="heading-2">三、兄弟组件：盟主充当“中间人”</h2>
<p>现在有两个徒弟：大师兄（Child1）和二师弟（Child2）。大师兄想把自己的内力传给二师弟，怎么办？他们之间没有直接的经脉相连（无直接通信渠道）。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>中转站</strong>：必须由师父（父组件）出面。</li>
<li><strong>状态提升</strong>：大师兄先把内力传给师父（子传父），师父收到后，再把内力传给二师弟（父传子）。</li>
</ol>
<p>这在武学中被称为“移花接木”，在 React 中叫<strong>状态提升（Lifting State Up）</strong> 。</p>
<p><strong>代码演练：</strong></p>
<p>父组件作为枢纽：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.jsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child1</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child1"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child2</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child2"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"等待传功..."</span>);

    <span class="hljs-comment">// 接收大师兄数据的锦囊</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getFromChild1</span> = (<span class="hljs-params">msg</span>) =&gt; {
        <span class="hljs-title function_">setMessage</span>(msg);
    }

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>武林盟主（中转站）<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            {/* 接收端：把函数给大师兄 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child1</span> <span class="hljs-attr">transfer</span>=<span class="hljs-string">{getFromChild1}</span> /&gt;</span>
            {/* 发送端：把收到的数据给二师弟 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Child2</span> <span class="hljs-attr">msg</span>=<span class="hljs-string">{message}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>大师兄（发送方）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Child1.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child1</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">const</span> energy = <span class="hljs-string">"混元霹雳手"</span>; 
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.transfer(energy)}&gt;
                大师兄：发送内力
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>二师弟（接收方）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Child2.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Child2</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* 展示从师父那里转交过来的大师兄的内力 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>二师弟：接收到的招式 -- {props.msg}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><strong>核心心法</strong>：兄弟不分家，全靠父当家。遇到兄弟通信，先找共同的父组件，把状态提升上去。</p>
<h2 data-id="heading-3">四、跨组件通信：狮子吼“全域广播”</h2>
<p>如果门派等级森严，盟主要把消息传给徒弟的徒弟的徒弟（孙组件、重孙组件），一层层传 Props 实在是太慢了，而且容易出错（Prop Drilling）。</p>
<p>这时候，盟主会使用绝学“千里传音”或“狮子吼”（Context API）。</p>
<p><strong>江湖规矩：</strong></p>
<ol>
<li><strong>建立广播台</strong>：使用 createContext 创建一个信号塔。</li>
<li><strong>发功（Provider）</strong> ：盟主在高处使用 Provider 发出信号，笼罩在信号范围内的所有后代。</li>
<li><strong>接收（Consumer/useContext）</strong> ：任何层级的徒子徒孙，只要有 useContext 这个接收器，就能直接听到盟主的声音，无需中间人转述。</li>
</ol>
<p><strong>代码演练：</strong></p>
<p>建立广播台（Context）：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Context.js</span>
<span class="hljs-keyword">import</span> { createContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SectContext</span> = <span class="hljs-title function_">createContext</span>(); <span class="hljs-comment">// 创建门派广播台</span>
</code></pre>
<p>父组件发功：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Parent.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SectContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Context'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Child"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SectContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{</span>'<span class="hljs-attr">武林至尊</span>，<span class="hljs-attr">宝刀屠龙</span>'}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>盟主发出狮子吼<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> /&gt;</span> {/* 子组件内部包裹着孙组件 */}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">SectContext.Provider</span>&gt;</span></span>
    );
}
</code></pre>
<p>孙组件（无需经过子组件）直接接收：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Grandson.jsx</span>
<span class="hljs-keyword">import</span> { useContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SectContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Context'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Grandson</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 越级接收：直接获取上下文中的数据</span>
    <span class="hljs-keyword">const</span> secret = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">SectContext</span>);
    
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>徒孙接收到的广播：{secret}<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}
</code></pre>
<p><strong>核心心法</strong>：Context 能够打破组件层级的限制，实现数据的“隔空传送”，非常适合处理主题颜色、用户登录状态等全局数据。</p>
<h2 data-id="heading-4">五、结语：武功谱总结</h2>
<p>React 的组件通信，归根结底就是<strong>数据流向</strong>的管理。不要死记硬背代码，要理解数据是从哪里来，要到哪里去。</p>
<p>最后，附上一份“武功谱”供各位少侠修炼参考：</p>



































<table><thead><tr><th>通信方式</th><th>适用场景</th><th>核心流向</th><th>隐喻</th></tr></thead><tbody><tr><td><strong>Props</strong></td><td>父子通信</td><td>父 -&gt; 子</td><td>盟主传秘籍（只读）</td></tr><tr><td><strong>Callback</strong></td><td>子父通信</td><td>子 -&gt; 父</td><td>徒弟用锦囊飞鸽传书</td></tr><tr><td><strong>状态提升</strong></td><td>兄弟通信</td><td>子A -&gt; 父 -&gt; 子B</td><td>盟主做中间人移花接木</td></tr><tr><td><strong>Context</strong></td><td>跨级通信</td><td>Provider -&gt; Consumer</td><td>狮子吼全域广播</td></tr></tbody></table>
<p>愿各位在 React 的江湖中，内功深厚，Bug 不侵！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全栈进阶-redis最佳入门实战项目篇]]></title>    <link>https://juejin.cn/post/7604853010171428905</link>    <guid>https://juejin.cn/post/7604853010171428905</guid>    <pubDate>2026-02-10T11:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010171428905" data-draft-id="7604853010171412521" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全栈进阶-redis最佳入门实战项目篇"/> <meta itemprop="keywords" content="前端,Python,Redis"/> <meta itemprop="datePublished" content="2026-02-10T11:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="只与明月听"/> <meta itemprop="url" content="https://juejin.cn/user/386661153249102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全栈进阶-redis最佳入门实战项目篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386661153249102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    只与明月听
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:23:31.000Z" title="Tue Feb 10 2026 11:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、环境准备</h2>
<p>后端采用<code>Python + FastApi</code>，<code>Redis</code>和<code>MySQL</code>都在云服务器上，通过docker安装的，向外暴露接口实现的远程连接。</p>
<h5 data-id="heading-1">服务部署</h5>
<p>前面介绍过<a href="https://juejin.cn/post/7579887768228085794" target="_blank" title="https://juejin.cn/post/7579887768228085794">fastapi</a>的基本语法，但是缺了部署这个环节，在这里补充下。</p>
<p>我的安装环境都是在阿里云的云服务器上，采用的是<code>pm2</code>来管理fastapi项目，首先在<code>centos</code>上安装相关依赖和环境：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 更新系统</span>
sudo yum update -y
​
<span class="hljs-comment"># 2. 安装 EPEL 源（Python 虚拟环境需要）</span>
sudo yum install -y epel-release
​
<span class="hljs-comment"># 3. 安装 Python3 和 pip</span>
sudo yum install -y python3 python3-pip python3-venv python3-wheel
​
<span class="hljs-comment"># 确认 Python 安装</span>
python3 -V
pip3 -V
​
<span class="hljs-comment"># 4. 安装 Node.js (使用官方源安装最新 LTS)</span>
curl -fsSL https://rpm.nodesource.com/setup_lts.x | sudo bash -
sudo yum install -y nodejs
​
<span class="hljs-comment"># 确认 Node 和 npm 安装</span>
node -v
npm -v
​
<span class="hljs-comment"># 5. 安装 PM2 全局</span>
sudo npm install -g pm2
pm2 -v
​
</code></pre>
<p>准备测试脚本：</p>
<p>首先准备下虚拟环境：</p>
<pre><code class="hljs">python3 -m venv venv
​
venv\Scripts\activate
</code></pre>
<p>新建<code>main.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
​
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, Query
<span class="hljs-keyword">import</span> pymysql
​
​
app = FastAPI(title=<span class="hljs-string">"Simple MySQL Query Service"</span>)
​
​
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_connection</span>() -&gt; pymysql.connections.Connection:
    <span class="hljs-string">"""创建并返回一个 MySQL 连接。"""</span>
​
    <span class="hljs-keyword">return</span> pymysql.connect(
        host=<span class="hljs-string">"118.31.xxx"</span>,
        port=<span class="hljs-number">3307</span>,
        user=<span class="hljs-string">"root"</span>,
        password=<span class="hljs-string">"xxx"</span>,
        database=<span class="hljs-string">"blog"</span>,
        cursorclass=pymysql.cursors.DictCursor,
        charset=<span class="hljs-string">"utf8mb4"</span>,
    )
​
​
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/hello"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():
    <span class="hljs-string">"""返回 你好 + 当前时间（年月日 时分秒）。"""</span>
​
    now = datetime.now()
    current_time = now.strftime(<span class="hljs-string">"%Y年%m月%d日 %H:%M:%S"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">f"你好，当前时间是：<span class="hljs-subst">{current_time}</span>"</span>}
​
​
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/student_score"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_student_score</span>(<span class="hljs-params">number: <span class="hljs-built_in">str</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">"学生编号"</span></span>)</span>):
    <span class="hljs-string">"""根据 number 查询 blog 库中 student_score 表的 subject 和 score。"""</span>
​
    <span class="hljs-keyword">try</span>:
        conn = get_connection()
        <span class="hljs-keyword">with</span> conn:
            <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                sql = (
                    <span class="hljs-string">"SELECT subject, score "</span>
                    <span class="hljs-string">"FROM student_score "</span>
                    <span class="hljs-string">"WHERE number = %s"</span>
                )
                cursor.execute(sql, (number,))
                rows = cursor.fetchall()
    <span class="hljs-keyword">except</span> pymysql.MySQLError <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># 数据库连接或执行出错</span>
        detail = (
            exc.args[<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exc.args) &gt; <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(exc)
        )
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"数据库错误: <span class="hljs-subst">{detail}</span>"</span>) <span class="hljs-keyword">from</span> exc
​
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 number 对应的成绩"</span>)
​
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"number"</span>: number, <span class="hljs-string">"results"</span>: rows}
​
​
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
​
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, reload=<span class="hljs-literal">True</span>)
​
</code></pre>
<p>本地运行下<code>python mian.py</code>，然后测试下我们的接口，看来是没问题的。就着手开始部署到线上。</p>
<p>新建<code>Gunicorn</code>配置文件<code>gunicorn_config.py</code>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">bind</span> = <span class="hljs-string">"0.0.0.0:8011"</span>          <span class="hljs-comment"># 对外端口</span>
<span class="hljs-attr">workers</span> = <span class="hljs-number">2</span>                    <span class="hljs-comment"># worker 数量，看 CPU 调整</span>
<span class="hljs-attr">worker_class</span> = <span class="hljs-string">"uvicorn.workers.UvicornWorker"</span>
<span class="hljs-attr">timeout</span> = <span class="hljs-number">60</span>
<span class="hljs-attr">accesslog</span> = <span class="hljs-string">"logs/access.log"</span>
<span class="hljs-attr">errorlog</span> = <span class="hljs-string">"logs/error.log"</span>
<span class="hljs-attr">loglevel</span> = <span class="hljs-string">"info"</span>
</code></pre>
<p>开始新建项目依赖<code>requirements.txt</code></p>
<pre><code class="hljs language-css" lang="css">fastapi
uvicorn<span class="hljs-selector-attr">[standard]</span>
pymysql
</code></pre>
<p>同时我的<code>nginx</code>的代理转发的配置文件，是这样的</p>
<pre><code class="hljs language-ini" lang="ini">location /fastapi/query/ {
        proxy_pass http://127.0.0.1:8011/<span class="hljs-comment">;</span>
        proxy_set_header Host $host<span class="hljs-comment">;</span>
        proxy_set_header X-Real-IP $remote_addr<span class="hljs-comment">;</span>
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="hljs-comment">;</span>
        proxy_set_header X-Forwarded-Proto $scheme<span class="hljs-comment">;</span>
        proxy_redirect off<span class="hljs-comment">;</span>
    }
</code></pre>
<p>接下来将项目文件压缩成zip包，拖到服务器的指定目录，运行<code>unzip query.zip</code>解压即可。</p>
<p>然后开始安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">首先开启虚拟环境：
python3 -m venv venv
<span class="hljs-built_in">source</span> venv/bin/activate
​
然后安装依赖
pip install -r requirements.txt
​
这一步可能安装巨慢，建议切换阿里云的下载链接
</code></pre>
<blockquote>
<p>这里巨坑，折腾了我一个多小时，阿里云的python版本默认是3.6.8，使用<code>Gunicorn</code>需要3.10以上的，一开始安装依赖一直卡住了，也不报错，换了好几个源，还是不行，我以为我服务器带宽小导致的，换成本地安装，然后拖到服务器上，这才发现是版本的原因，然后安装<code>3.11.9</code>后删除虚拟环境，重新安装才成功。</p>
</blockquote>
<p>安装成功后，就可以啦。</p>
<p>测试下：运行<code>gunicorn -c gunicorn_config.py main:app</code>，在开启一个服务器连接，</p>
<pre><code class="hljs language-perl" lang="perl">输入：
curl <span class="hljs-string">"http://127.0.0.1:8011/hello"</span>
{<span class="hljs-string">"message"</span>:<span class="hljs-string">"你好，当前时间是：2026年02月08日 15:38:53"</span>}[root@iZbp1f9urggte5qz3ri1riZ ~]<span class="hljs-comment"># </span>
curl <span class="hljs-string">"http://127.0.0.1:8011/student_score?number=20180101"</span>
{<span class="hljs-string">"number"</span>:<span class="hljs-string">"20180101"</span>,<span class="hljs-string">"results"</span>:[{<span class="hljs-string">"subject"</span>:<span class="hljs-string">"母猪的产后护理"</span>,<span class="hljs-string">"score"</span>:<span class="hljs-number">78</span>},{<span class="hljs-string">"subject"</span>:<span class="hljs-string">"论萨达姆的战争准备"</span>,<span class="hljs-string">"score"</span>:<span class="hljs-number">88</span>}]}[root@iZbp1f9urg
</code></pre>
<p>可以看到我们的服务器已经正常运行了，二级域名已经解析了，nginx代理也已经配置了，</p>
<p>输入<code>curl http://api.jinxudong.com/fastapi/query/hello</code>可以看到正常的接口输出的，说明我们的脚本已经部署成功了，但是这种部署方式还是比较原始的，而且后续服务肯定不止这个一个，我打算采用<code>pm2</code>来管理这些服务。</p>
<p>在项目的根目录写上配置文件<code>ecosystem.config.js</code></p>
<pre><code class="hljs language-css" lang="css">module<span class="hljs-selector-class">.exports</span> = {
  apps: [
    {
      name: <span class="hljs-string">"query"</span>,
      script: <span class="hljs-string">"bash"</span>,
      args: <span class="hljs-string">"-c '/var/www/python/query/venv/bin/gunicorn -c gunicorn_config.py main:app'"</span>,
      cwd: <span class="hljs-string">"/var/www/python/query"</span>
    }
  ]
};
​
</code></pre>
<p>运行脚本<code>pm2 start ecosystem.config.js</code>就可以看到我们的服务了，在设置下开机自启：</p>
<pre><code class="hljs">pm2 save
pm2 startup
</code></pre>
<p>我们的服务已经正常部署到线上啦，可以通过域名去访问</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/api.jinxudong.com/fastapi</span><span class="hljs-regexp">/query/student</span>_score?number=<span class="hljs-number">20180101</span>
​
{<span class="hljs-string">"number"</span><span class="hljs-symbol">:<span class="hljs-string">"20180101"</span></span>,<span class="hljs-string">"results"</span><span class="hljs-symbol">:</span>[{<span class="hljs-string">"subject"</span><span class="hljs-symbol">:<span class="hljs-string">"母猪的产后护理"</span></span>,<span class="hljs-string">"score"</span><span class="hljs-symbol">:</span><span class="hljs-number">78</span>},{<span class="hljs-string">"subject"</span><span class="hljs-symbol">:<span class="hljs-string">"论萨达姆的战争准备"</span></span>,<span class="hljs-string">"score"</span><span class="hljs-symbol">:</span><span class="hljs-number">88</span>}]}
</code></pre>
<h5 data-id="heading-2">压测工具介绍</h5>
<p>一个系统上线后，是必须要经过压测的，就是模拟大量用户同时访问服务，找到系统的极限QPS，极限并发，找出性能瓶颈，避免线上事故。</p>
<p>接下来介绍两个常见的压测工具：</p>
<ol>
<li>
<p>ab</p>
<p>这是<code>Apache</code>自带的压测工具，非常的简轻量，很适合小接口测试，做下简单的性能验证。</p>
<p>首先安装下这个工具</p>
<pre><code class="hljs">yum install httpd-tools
</code></pre>
<p>使用也很简单</p>
<pre><code class="hljs language-ini" lang="ini">ab -n 1000 -c 50 https://api.jinxudong.com/fastapi/query/student_score?<span class="hljs-attr">number</span>=<span class="hljs-number">20180101</span>
</code></pre>
<p>用50的并发完成1000次请求，看下ab的输出日志</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Server Software:</span>        <span class="hljs-string">nginx/1.20.1</span>
<span class="hljs-attr">Server Hostname:</span>        <span class="hljs-string">api.jinxudong.com</span>
<span class="hljs-attr">Server Port:</span>            <span class="hljs-number">443</span>
<span class="hljs-attr">SSL/TLS Protocol:</span>       <span class="hljs-string">TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256</span>
<span class="hljs-attr">Server Temp Key:</span>        <span class="hljs-string">X25519</span> <span class="hljs-number">253</span> <span class="hljs-string">bits</span>
<span class="hljs-attr">TLS Server Name:</span>        <span class="hljs-string">api.jinxudong.com</span>
<span class="hljs-string">​</span>
<span class="hljs-attr">Document Path:</span>          <span class="hljs-string">/fastapi/query/student_score?number=20180101</span>
<span class="hljs-attr">Document Length:</span>        <span class="hljs-number">133</span> <span class="hljs-string">bytes</span>
<span class="hljs-string">​</span>
<span class="hljs-attr">Concurrency Level:</span>      <span class="hljs-number">50</span>
<span class="hljs-attr">Time taken for tests:</span>   <span class="hljs-number">17.659</span> <span class="hljs-string">seconds</span>
<span class="hljs-attr">Complete requests:</span>      <span class="hljs-number">1000</span>
<span class="hljs-attr">Failed requests:</span>        <span class="hljs-number">0</span>
<span class="hljs-attr">Total transferred:</span>      <span class="hljs-number">283000</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">HTML transferred:</span>       <span class="hljs-number">133000</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">Requests per second:</span>    <span class="hljs-number">56.63</span> [<span class="hljs-comment">#/sec] (mean)</span>
<span class="hljs-attr">Time per request:</span>       <span class="hljs-number">882.956</span> [<span class="hljs-string">ms</span>] <span class="hljs-string">(mean)</span>
<span class="hljs-attr">Time per request:</span>       <span class="hljs-number">17.659</span> [<span class="hljs-string">ms</span>] <span class="hljs-string">(mean</span>, <span class="hljs-string">across</span> <span class="hljs-string">all</span> <span class="hljs-string">concurrent</span> <span class="hljs-string">requests)</span>
<span class="hljs-attr">Transfer rate:</span>          <span class="hljs-number">15.65</span> [<span class="hljs-string">Kbytes/sec</span>] <span class="hljs-string">received</span>
<span class="hljs-string">​</span>
<span class="hljs-string">Connection</span> <span class="hljs-string">Times</span> <span class="hljs-string">(ms)</span>
              <span class="hljs-string">min</span>  <span class="hljs-string">mean</span>[<span class="hljs-string">+/-sd</span>] <span class="hljs-string">median</span>   <span class="hljs-string">max</span>
<span class="hljs-attr">Connect:</span>       <span class="hljs-number">11</span>   <span class="hljs-number">56</span> <span class="hljs-number">119.1</span>     <span class="hljs-number">13</span>    <span class="hljs-number">1471</span>
<span class="hljs-attr">Processing:</span>    <span class="hljs-number">32</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">807</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Waiting:</span>       <span class="hljs-number">30</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">806</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Total:</span>         <span class="hljs-number">48</span>  <span class="hljs-number">866</span> <span class="hljs-number">258.9</span>    <span class="hljs-number">828</span>    <span class="hljs-number">2290</span>
<span class="hljs-string">​</span>
<span class="hljs-string">Percentage</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">requests</span> <span class="hljs-string">served</span> <span class="hljs-string">within</span> <span class="hljs-string">a</span> <span class="hljs-string">certain</span> <span class="hljs-string">time</span> <span class="hljs-string">(ms)</span>
  <span class="hljs-number">50</span><span class="hljs-string">%</span>    <span class="hljs-number">828</span>
  <span class="hljs-number">66</span><span class="hljs-string">%</span>    <span class="hljs-number">911</span>
  <span class="hljs-number">75</span><span class="hljs-string">%</span>    <span class="hljs-number">998</span>
  <span class="hljs-number">80</span><span class="hljs-string">%</span>   <span class="hljs-number">1041</span>
  <span class="hljs-number">90</span><span class="hljs-string">%</span>   <span class="hljs-number">1195</span>
  <span class="hljs-number">95</span><span class="hljs-string">%</span>   <span class="hljs-number">1295</span>
  <span class="hljs-number">98</span><span class="hljs-string">%</span>   <span class="hljs-number">1559</span>
  <span class="hljs-number">99</span><span class="hljs-string">%</span>   <span class="hljs-number">1798</span>
 <span class="hljs-number">100</span><span class="hljs-string">%</span>   <span class="hljs-number">2290</span> <span class="hljs-string">(longest</span> <span class="hljs-string">request)</span>
</code></pre>
<p>看下几个核心指标</p>
<ol>
<li>
<p><code>Request per second</code>，也就是常说的QPS，也就是每秒可以处理56个请求</p>
</li>
<li>
<p><code>Time per request</code>，平均响应时间</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-type">Time</span> <span class="hljs-keyword">per</span> request:       <span class="hljs-number">882.956</span> [ms] (mean)
<span class="hljs-type">Time</span> <span class="hljs-keyword">per</span> request:       <span class="hljs-number">17.659</span> [ms] (mean, across <span class="hljs-keyword">all</span> concurrent requests)
</code></pre>
<p>第一个时间单个请求平均耗时，这是用户真实的体验时间，第二个时间是平均耗时/并发数</p>
</li>
<li>
<p>延迟分布</p>
<pre><code class="hljs language-shell" lang="shell">Percentage of the requests served within a certain time (ms)
<span class="hljs-meta prompt_">  50% </span><span class="bash">   828</span>
<span class="hljs-meta prompt_">  66% </span><span class="bash">   911</span>
<span class="hljs-meta prompt_">  75% </span><span class="bash">   998</span>
<span class="hljs-meta prompt_">  80% </span><span class="bash">  1041</span>
<span class="hljs-meta prompt_">  90% </span><span class="bash">  1195</span>
<span class="hljs-meta prompt_">  95% </span><span class="bash">  1295</span>
<span class="hljs-meta prompt_">  98% </span><span class="bash">  1559</span>
<span class="hljs-meta prompt_">  99% </span><span class="bash">  1798</span>
<span class="hljs-meta prompt_"> 100% </span><span class="bash">  2290 (longest request)</span>
</code></pre>
<p>第一个数字是百分比，第二个是耗时，换成表格是这样</p>





























<table><thead><tr><th>百分位</th><th>含义</th></tr></thead><tbody><tr><td>P50</td><td>50%请求 &lt; 828ms</td></tr><tr><td>P90</td><td>90%请求 &lt; 1195ms</td></tr><tr><td>P95</td><td>95%请求 &lt; 1295ms</td></tr><tr><td>P99</td><td>99%请求 &lt; 1798ms</td></tr><tr><td>max</td><td>最慢请求 2290ms</td></tr></tbody></table>
</li>
<li>
<p>连接时间分析</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Connection</span> <span class="hljs-string">Times</span> <span class="hljs-string">(ms)</span>
              <span class="hljs-string">min</span>  <span class="hljs-string">mean[+/-sd]</span> <span class="hljs-string">median</span>   <span class="hljs-string">max</span>
<span class="hljs-attr">Connect:</span>       <span class="hljs-number">11</span>   <span class="hljs-number">56</span> <span class="hljs-number">119.1</span>     <span class="hljs-number">13</span>    <span class="hljs-number">1471</span>
<span class="hljs-attr">Processing:</span>    <span class="hljs-number">32</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">807</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Waiting:</span>       <span class="hljs-number">30</span>  <span class="hljs-number">810</span> <span class="hljs-number">212.6</span>    <span class="hljs-number">806</span>    <span class="hljs-number">1854</span>
<span class="hljs-attr">Total:</span>         <span class="hljs-number">48</span>  <span class="hljs-number">866</span> <span class="hljs-number">258.9</span>    <span class="hljs-number">828</span>    <span class="hljs-number">2290</span>
</code></pre>
<p>这里的<code>Connect</code>就是<code>TCP</code>握手简历链接的时间，<code>Processing</code>就是后端处理的时间</p>
</li>
</ol>
</li>
<li>
<p>wrk</p>
</li>
</ol>
<p>wrk目前是后端常用的压测工具，支持多线程和Lua脚本，可以模拟真实并发。</p>
<p>首先在服务器上安装下</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#先安装编译工具</span>
sudo yum groupinstall <span class="hljs-string">"Development Tools"</span> -y
sudo yum install git -y
<span class="hljs-comment">#下载</span>
curl -L -o wrk.zip https://codeload.github.com/wg/wrk/zip/refs/heads/master
unzip wrk.zip
<span class="hljs-built_in">cd</span> wrk-master
​
<span class="hljs-comment">#编译</span>
make
​
<span class="hljs-comment">#复制到全局路径</span>
sudo <span class="hljs-built_in">cp</span> wrk /usr/local/bin/
</code></pre>
<p>安装成功以后，直接测试：</p>
<pre><code class="hljs language-ini" lang="ini">wrk -t4 -c100 -d30s --latency https://api.jinxudong.com/fastapi/query/student_score?<span class="hljs-attr">number</span>=<span class="hljs-number">20180101</span>
</code></pre>
<p>意思就是四个线程，100的并发，测试30秒</p>
<pre><code class="hljs language-matlab" lang="matlab">  <span class="hljs-number">4</span> threads and <span class="hljs-number">100</span> connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     <span class="hljs-number">1.18</span>s    <span class="hljs-number">66.72</span>ms   <span class="hljs-number">1.42</span>s    <span class="hljs-number">96.70</span><span class="hljs-comment">%</span>
    Req/Sec    <span class="hljs-number">36.35</span>     <span class="hljs-number">26.08</span>   <span class="hljs-number">100.00</span>     <span class="hljs-number">54.00</span><span class="hljs-comment">%</span>
  Latency Distribution
     <span class="hljs-number">50</span><span class="hljs-comment">%    1.18s </span>
     <span class="hljs-number">75</span><span class="hljs-comment">%    1.19s </span>
     <span class="hljs-number">90</span><span class="hljs-comment">%    1.20s </span>
     <span class="hljs-number">99</span><span class="hljs-comment">%    1.23s </span>
  <span class="hljs-number">2483</span> requests in <span class="hljs-number">30.07</span>s, <span class="hljs-number">698.34</span>KB read
Requests/<span class="hljs-built_in">sec</span>:     <span class="hljs-number">82.58</span>
Transfer/<span class="hljs-built_in">sec</span>:     <span class="hljs-number">23.22</span>KB
</code></pre>
<p>可以看到，<code>Requests/sec</code>就是吞吐量82，每秒可以处理82个请求，平均延迟1.23秒，</p>
<p>压测还是比较简单的，就是利用工具查看qps和延迟时间，当qps不涨，延迟时间飞涨甚至于报错，那说明就到达极限了。</p>
<p>下面就开始实战环节了。</p>
<h2 data-id="heading-3">二、信息查询系统</h2>
<p>这是一个查询商品信息的系统，就是查询商品详情，为了增加系统的吞吐量，常见的做法就是增加一个缓存层，流程就是：请求接口来了，先去查询redis缓存层，缓存命中就直接返回；如果未命中再去查库。这也是前面介绍的旁路缓存，用内存换取数据库压力。</p>
<p>系统架构图如下</p>
<pre><code class="hljs language-lua" lang="lua">客户端 (浏览器/APP)
        |
        v
    FastAPI 接口层
        |
    <span class="hljs-comment">-----------------</span>
    |               |
Redis 缓存         MySQL 数据库
</code></pre>
<h5 data-id="heading-4">环境准备</h5>
<p>数据库设计</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    stock <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    description TEXT,
    updated_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<p><code>id</code> 是主键</p>
<p><code>name</code>, <code>price</code>, <code>stock</code>, <code>description</code> 是商品核心信息</p>
<p><code>updated_at</code> 商品的更新时间，可以用于后面缓存过期策略（缓存失效时刷新）</p>
<p>然后插入一些测试数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products (name, price, stock, description)
<span class="hljs-keyword">SELECT</span>
    CONCAT(<span class="hljs-string">'商品-'</span>, t.num),
    ROUND(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">500</span> <span class="hljs-operator">+</span> <span class="hljs-number">10</span>, <span class="hljs-number">2</span>),
    <span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">100</span>),
    CONCAT(<span class="hljs-string">'这是商品 '</span>, t.num, <span class="hljs-string">' 的描述'</span>)
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> a.n <span class="hljs-operator">+</span> b.n <span class="hljs-operator">*</span> <span class="hljs-number">10</span> <span class="hljs-operator">+</span> c.n <span class="hljs-operator">*</span> <span class="hljs-number">100</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> num
    <span class="hljs-keyword">FROM</span>
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> n <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>
         <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">8</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">9</span>) a,
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> n <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>
         <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">8</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">9</span>) b,
        (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> n <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">4</span>
         <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">5</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">6</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">7</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">8</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">9</span>) c
) t
<span class="hljs-keyword">WHERE</span> t.num <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1000</span>;
</code></pre>
<p>准备工作已经就绪，接下来开始编写代码啦</p>
<h5 data-id="heading-5">系统编写</h5>
<p>代码也比较简单，就是一个查询接口，和前面是实例基本一致</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/get_product"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_product</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">"商品编号"</span></span>)</span>):
    <span class="hljs-string">"""根据商品 id 查询商品信息。"""</span>
    <span class="hljs-keyword">try</span>:
        conn = get_connection()
        <span class="hljs-keyword">with</span> conn:
            <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                sql = (
                    <span class="hljs-string">"SELECT * "</span>
                    <span class="hljs-string">"FROM products "</span>
                    <span class="hljs-string">"WHERE id = %s"</span>
                )
                cursor.execute(sql, (<span class="hljs-built_in">id</span>,))
                rows = cursor.fetchall()
    <span class="hljs-keyword">except</span> pymysql.MySQLError <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># 数据库连接或执行出错</span>
        detail = (
            exc.args[<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exc.args) &gt; <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(exc)
        )
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"数据库错误: <span class="hljs-subst">{detail}</span>"</span>) <span class="hljs-keyword">from</span> exc
​
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 id 对应的商品信息"</span>)
​
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"results"</span>: rows}
​
​
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
​
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, reload=<span class="hljs-literal">True</span>)
</code></pre>
<p>然后运行<code>python main.py</code>，<code>http://localhost:8000/get_product?id=22</code>是可以看到数据返回的。</p>
<p>说明我们的代码是没问题的，接下来就开始部署，然后再服务器上做压测，看下当前的服务器的最大QPS是多大。</p>
<p>部署方案和前面介绍的一致，记得更改<code>nginx</code>配置和<code>pm2</code>的配置文件，通过公网访问下我们的接口</p>
<pre><code class="hljs language-bash" lang="bash">https://api.jinxudong.com/fastapi/queryDetail/get_product?<span class="hljs-built_in">id</span>=122
可以看到如下输出：
{
  <span class="hljs-string">"id"</span>: 122,
  <span class="hljs-string">"results"</span>: [
    {
      <span class="hljs-string">"id"</span>: 122,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"商品-172"</span>,
      <span class="hljs-string">"price"</span>: 461.79,
      <span class="hljs-string">"stock"</span>: 72,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"这是商品 172 的描述"</span>,
      <span class="hljs-string">"updated_at"</span>: <span class="hljs-string">"2026-02-10T04:13:17"</span>
    }
  ]
}
</code></pre>
<p>说明接口已经部署成功了，下面就开始压测，要知道这个接口的最大QPS，接下来使用ab来开始压测</p>
<h6 data-id="heading-6">第一次压测</h6>
<p>首先使用20的并发，看下压测报告：</p>
<pre><code class="hljs language-matlab" lang="matlab">ab -n <span class="hljs-number">1000</span> -c <span class="hljs-number">20</span> https://api.jinxudong.com/fastapi/queryDetail/get_product?id=<span class="hljs-number">122</span>
​
压测报告截取：
Requests per second:    <span class="hljs-number">54.99</span> [#/<span class="hljs-built_in">sec</span>] (<span class="hljs-built_in">mean</span>)  
Time per request:       <span class="hljs-number">363.704</span> [ms] (<span class="hljs-built_in">mean</span>)  
<span class="hljs-number">50</span><span class="hljs-comment">%    307ms</span>
<span class="hljs-number">75</span><span class="hljs-comment">%    417ms</span>
<span class="hljs-number">90</span><span class="hljs-comment">%    512ms</span>
<span class="hljs-number">99</span><span class="hljs-comment">%   1282ms</span>
</code></pre>
<p>可以看到QPS54，平均时间363ms，延迟分布中50%的请求小于307ms</p>
<h6 data-id="heading-7">第二次压测</h6>
<p>使用40的并发，看下压测报告：</p>
<pre><code class="hljs language-matlab" lang="matlab">ab -n <span class="hljs-number">1000</span> -c <span class="hljs-number">40</span> https://api.jinxudong.com/fastapi/queryDetail/get_product?id=<span class="hljs-number">122</span>
 
压测报告截取：
Requests per second:    <span class="hljs-number">53.87</span> [#/<span class="hljs-built_in">sec</span>] (<span class="hljs-built_in">mean</span>)
Time per request:       <span class="hljs-number">742.486</span> [ms] (<span class="hljs-built_in">mean</span>)
  <span class="hljs-number">50</span><span class="hljs-comment">%    712</span>
  <span class="hljs-number">66</span><span class="hljs-comment">%    769</span>
  <span class="hljs-number">75</span><span class="hljs-comment">%    826</span>
  <span class="hljs-number">80</span><span class="hljs-comment">%    850</span>
  <span class="hljs-number">90</span><span class="hljs-comment">%    926</span>
</code></pre>
<p>QPS53，延迟时间和平均请求时间都在增大，有一种步子迈大了的感觉，减少并发试试</p>
<h6 data-id="heading-8">第三次压测</h6>
<p>使用10的并发，看下压测报告</p>
<pre><code class="hljs language-matlab" lang="matlab"> ab -n <span class="hljs-number">1000</span> -c <span class="hljs-number">10</span> https://api.jinxudong.com/fastapi/queryDetail/get_product?id=<span class="hljs-number">122</span>
 
 压测报告截取：
 Requests per second:    <span class="hljs-number">55.53</span> [#/<span class="hljs-built_in">sec</span>] (<span class="hljs-built_in">mean</span>)
Time per request:       <span class="hljs-number">180.081</span> [ms] (<span class="hljs-built_in">mean</span>)
  <span class="hljs-number">50</span><span class="hljs-comment">%    135</span>
  <span class="hljs-number">66</span><span class="hljs-comment">%    154</span>
  <span class="hljs-number">75</span><span class="hljs-comment">%    173</span>
  <span class="hljs-number">80</span><span class="hljs-comment">%    181</span>
  <span class="hljs-number">90</span><span class="hljs-comment">%    332</span>
</code></pre>
<p>QPS55，平均时间和延迟时间都降低了，但是QPS确实没怎么变化，可以断定当前系统的最大吞吐量就是55，下面增加一个缓存层，然后看下系统的吞吐量是否发生变化</p>
<h5 data-id="heading-9">存增加缓存层</h5>
<p>首先回顾下旁路缓存，当查询时首先去缓存中查找，如果缓存命中就直接返回；如果未命中就去查询数据库，然后将值写到缓存中，如果数据库也没有，就写一个空值到缓存中，防止穿透。这就是下面要写的代码的逻辑。</p>
<p>直接看下接口代码</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/get_product"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_product</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Query(<span class="hljs-params">..., description=<span class="hljs-string">"商品编号"</span></span>)</span>):
    <span class="hljs-string">"""根据商品 id 查询商品信息。"""</span>
​
    cache_key = _make_product_cache_key(<span class="hljs-built_in">id</span>)
​
    <span class="hljs-comment"># 1. 先查 Redis 缓存</span>
    <span class="hljs-keyword">try</span>:
        cached = redis_client.get(cache_key)
        <span class="hljs-keyword">if</span> cached <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            rows = json.loads(cached)
            <span class="hljs-comment"># 缓存命中空列表，说明数据库也没有，直接返回 404，防止缓存穿透</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
                <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 id 对应的商品信息"</span>)
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"results"</span>: rows}
    <span class="hljs-keyword">except</span> redis.RedisError:
        <span class="hljs-comment"># 缓存异常时，降级为直接查数据库</span>
        <span class="hljs-keyword">pass</span>
​
    <span class="hljs-keyword">try</span>:
        conn = get_connection()
        <span class="hljs-keyword">with</span> conn:
            <span class="hljs-keyword">with</span> conn.cursor() <span class="hljs-keyword">as</span> cursor:
                sql = (
                    <span class="hljs-string">"SELECT * "</span>
                    <span class="hljs-string">"FROM products "</span>
                    <span class="hljs-string">"WHERE id = %s"</span>
                )
                cursor.execute(sql, (<span class="hljs-built_in">id</span>,))
                rows = cursor.fetchall()
    <span class="hljs-keyword">except</span> pymysql.MySQLError <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># 数据库连接或执行出错</span>
        detail = (
            exc.args[<span class="hljs-number">1</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exc.args) &gt; <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(exc)
        )
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"数据库错误: <span class="hljs-subst">{detail}</span>"</span>) <span class="hljs-keyword">from</span> exc
​
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rows:
        <span class="hljs-comment"># 数据库未命中，也写入空列表到缓存，防止穿透</span>
        <span class="hljs-keyword">try</span>:
            redis_client.setex(cache_key, <span class="hljs-number">60</span>, json.dumps([]))
        <span class="hljs-keyword">except</span> redis.RedisError:
            <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"未找到该 id 对应的商品信息"</span>)
​
    <span class="hljs-comment"># 查询到数据后写入缓存</span>
    <span class="hljs-keyword">try</span>:
        encoded_rows = jsonable_encoder(rows)
        redis_client.setex(cache_key, <span class="hljs-number">300</span>, json.dumps(encoded_rows, ensure_ascii=<span class="hljs-literal">False</span>))
    <span class="hljs-keyword">except</span> (redis.RedisError, TypeError, ValueError):
        <span class="hljs-comment"># 缓存写入失败不影响接口主流程</span>
        <span class="hljs-keyword">pass</span>
​
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"results"</span>: rows}
​
</code></pre>
<p>首先在接口请求时，一开始就构建了缓存的key，<code>_make_product_cache_key</code>的方法是这样的</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_product_cache_key</span>(<span class="hljs-params">product_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""生成商品缓存 key。"""</span>
​
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"product:<span class="hljs-subst">{product_id}</span>"</span>
</code></pre>
<p>构建的key就是<code>product:{product_id}</code>，然后就先查询缓存，如果缓存命中就直接返回，未命中就查库；命中时也有个非空判断，如果是写入的空数组，表明是数据库也没有的，直接返回404，防止穿透。查询数据库就是和前面一样的逻辑了，加了个写入缓存的逻辑：<code>redis_client.setex(cache_key, 300, json.dumps(encoded_rows, ensure_ascii=False))</code>。当数据库也没有时，就写个空，防止穿透：<code>redis_client.setex(cache_key, 60, json.dumps([]))</code>，然后返回错误。</p>
<p>部署到线上后，<code>https://api.jinxudong.com/fastapi/queryDetail/get_product?id=5</code>接口有正常的返回，看下<code>redis</code>数据库，也有相关的<code>product:5</code>作为key，表明我们的更改是成功的。</p>
<p>要想证明我们的更改效果，就需要做压测了，</p>
<h6 data-id="heading-10">第一次压测</h6>
<p>直接使用40的并发</p>
<pre><code class="hljs language-bash" lang="bash">ab -n 1000 -c 40 https://api.jinxudong.com/fastapi/queryDetail/get_product?<span class="hljs-built_in">id</span>=122
​
Requests per second: 73.80 [<span class="hljs-comment">#/sec] (mean) </span>
Time per request: 542.007 [ms] (mean)
</code></pre>
<p>我以为这个QPS会变得非常大，才是73，而没加<code>redis</code>是53，我查看了<code>redis</code>数据库，缓存是存在的，虽然说QPS增加了，但是并不是很明显，看来影响系统的吞吐量的并不只是查询数据库，还有TCP连接，因为这个接口多了一层nginx转发，</p>
<h6 data-id="heading-11">第二次压测</h6>
<p>这次不走nginx转发了，直接走系统的服务</p>
<pre><code class="hljs language-ini" lang="ini">ab -n 1000 -c 40 http://127.0.0.1:8012/get_product?<span class="hljs-attr">id</span>=<span class="hljs-number">122</span>
​
Requests per second:    365.20 <span class="hljs-section">[#/sec]</span> (mean)
Time per request:       109.528 <span class="hljs-section">[ms]</span> (mean)
</code></pre>
<p>QPS一下子就起来了，而且平均响应时间也降低了。</p>
<p>两次测试结果有点出乎意料，都说<code>redis</code>毫秒级别的响应，但是QPS并没有指数级别的上升，看来对于小型应用，提升QPS来说，<code>redis</code>的作用其实并没有那么大，我的服务器宽带只有2M，费这么大劲，还不如去增加点带宽效果来的明显。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIDL/HIDL与HAL层通信实战:从接口定义到服务实现]]></title>    <link>https://juejin.cn/post/7604769326225342500</link>    <guid>https://juejin.cn/post/7604769326225342500</guid>    <pubDate>2026-02-10T11:53:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604769326225342500" data-draft-id="7605051978871832595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIDL/HIDL与HAL层通信实战:从接口定义到服务实现"/> <meta itemprop="keywords" content="Android,源码阅读,性能优化"/> <meta itemprop="datePublished" content="2026-02-10T11:53:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIDL/HIDL与HAL层通信实战:从接口定义到服务实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:53:23.000Z" title="Tue Feb 10 2026 11:53:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在前两篇文章中,我们深入分析了Binder驱动机制和ServiceManager服务注册。但在真实的Android系统开发中,很少有人直接操作Binder驱动——大家使用的都是更高层的抽象:AIDL(Android Interface Definition Language)和HIDL(HAL Interface Definition Language)。</p>
<p>想象一下这个场景:Framework层的BatteryService想要获取电池电量,它需要和HAL层的Health服务通信。怎么做?</p>
<pre><code class="hljs language-scss" lang="scss">Framework (Java)  ←→  Native Service (C++)  ←→  HAL Service (C++)  ←→  硬件
    ↓                      ↓                         ↓
 AIDL接口             AIDL/HIDL桥接           AIDL HAL接口
</code></pre>
<p>这就是本文要解决的问题:<strong>如何通过AIDL/HIDL定义接口,并实现跨进程的HAL层通信?</strong></p>
<blockquote>
<p>📖 <strong>系列前置阅读</strong>:建议先阅读第9篇(Binder驱动)和第10篇(ServiceManager),理解Binder IPC的底层机制。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">AIDL与HIDL:两代接口定义语言</h2>
<h3 data-id="heading-2">为什么需要接口定义语言?</h3>
<p>直接操作Binder需要手工编写大量模板代码:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 手工Binder代码示例(已简化)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BpMyService</span> : <span class="hljs-keyword">public</span> BpInterface&lt;IMyService&gt; {
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">getValue</span><span class="hljs-params">()</span> </span>{
        Parcel data, reply;
        data.<span class="hljs-built_in">writeInterfaceToken</span>(IMyService::<span class="hljs-built_in">getInterfaceDescriptor</span>());
        <span class="hljs-built_in">remote</span>()-&gt;<span class="hljs-built_in">transact</span>(TRANSACTION_getValue, data, &amp;reply);
        <span class="hljs-keyword">return</span> reply.<span class="hljs-built_in">readInt32</span>();
    }
};
</code></pre>
<p>这种方式<strong>容易出错、维护困难、版本管理混乱</strong>。</p>
<p>AIDL和HIDL的诞生就是为了<strong>自动生成这些模板代码</strong>,让开发者专注于业务逻辑。</p>
<h3 data-id="heading-3">AIDL vs HIDL:历史演进</h3>















































<table><thead><tr><th align="left">特性</th><th align="left">AIDL (传统)</th><th align="left">HIDL</th><th align="left">AIDL (Stable/现代)</th></tr></thead><tbody><tr><td align="left"><strong>引入版本</strong></td><td align="left">Android 1.0</td><td align="left">Android 8.0</td><td align="left">Android 11</td></tr><tr><td align="left"><strong>主要用途</strong></td><td align="left">Framework内部</td><td align="left">Framework-HAL</td><td align="left">Framework-HAL</td></tr><tr><td align="left"><strong>语言支持</strong></td><td align="left">Java + C++</td><td align="left">C++</td><td align="left">Java + C++ + Rust</td></tr><tr><td align="left"><strong>版本管理</strong></td><td align="left">❌ 无</td><td align="left">✅ 强制语义化版本</td><td align="left">✅ Stable接口</td></tr><tr><td align="left"><strong>向后兼容</strong></td><td align="left">❌ 不保证</td><td align="left">✅ 保证</td><td align="left">✅ 保证</td></tr><tr><td align="left"><strong>当前状态</strong></td><td align="left">维护中</td><td align="left">❌ 不推荐新项目</td><td align="left">✅ <strong>推荐</strong></td></tr></tbody></table>
<p><strong>Android 15的策略</strong>:</p>
<ul>
<li><strong>新HAL服务</strong>:使用Stable AIDL</li>
<li><strong>遗留HAL</strong>:HIDL继续支持,但不再新增</li>
<li><strong>Framework内部</strong>:传统AIDL和Stable AIDL混用</li>
</ul>
<blockquote>
<p>🎯 <strong>关键洞察</strong>:Google在Android 11后推动"HIDL退役,AIDL统一天下"的策略。Stable AIDL结合了AIDL的灵活性和HIDL的版本管理优势。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f524bd5976c74420af783c85732aa93d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329341&amp;x-signature=JujObMQLBlh97Sdks9Qt%2BxBSQQI%3D" alt="11-01-aidl-hidl-hal-architecture.png" loading="lazy"/></p>
<p><em>图:从Framework Java层到内核驱动的完整调用链,通过AIDL接口实现跨进程HAL通信</em></p>
<hr/>
<h2 data-id="heading-4">AIDL基础:从语法到生成代码</h2>
<h3 data-id="heading-5">AIDL文件结构</h3>
<p>一个典型的AIDL接口定义:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IHealth.aidl (简化版)</span>
<span class="hljs-keyword">package</span> android.hardware.health;

<span class="hljs-keyword">import</span> android.hardware.health.HealthInfo;
<span class="hljs-keyword">import</span> android.hardware.health.IHealthInfoCallback;

<span class="hljs-meta">@VintfStability</span>  <span class="hljs-comment">// ← Android 15: VINTF声明标记</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-comment">// 常量定义</span>
    const <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_UNKNOWN</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    const <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_CALLBACK_DIED</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;

    <span class="hljs-comment">// 方法声明</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unregisterCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// 返回值可以是基本类型或Parcelable</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">getChargeCounterUah</span><span class="hljs-params">()</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">getCurrentNowMicroamps</span><span class="hljs-params">()</span>;
    HealthInfo <span class="hljs-title function_">getHealthInfo</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>语法要点</strong>:</p>
<ol>
<li><strong>包名</strong>:<code>package</code>声明命名空间</li>
<li><strong>导入</strong>:<code>import</code>其他AIDL类型</li>
<li><strong>注解</strong>:<code>@VintfStability</code>表示接口稳定性(Android 15强制要求)</li>
<li><strong>方向标记</strong>:<code>in</code>(输入)/<code>out</code>(输出)/<code>inout</code>(双向)</li>
<li><strong>支持类型</strong>:基本类型、String、List、Map、Parcelable、其他AIDL接口</li>
</ol>
<h3 data-id="heading-6">AIDL编译流程</h3>
<pre><code class="hljs language-scss" lang="scss">IHealth<span class="hljs-selector-class">.aidl</span>  →  <span class="hljs-selector-attr">[AIDL Compiler]</span>  →  生成代码
                                     ├── IHealth<span class="hljs-selector-class">.h</span>/cpp (C++ Native Backend)
                                     ├── IHealth<span class="hljs-selector-class">.java</span> (Java Backend)
                                     └── IHealth<span class="hljs-selector-class">.rs</span> (Rust Backend)
</code></pre>
<p><strong>生成的C++代码</strong>(Android 15,简化版):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 自动生成的 IHealth.h (片段)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/binder_ibinder.h&gt;</span></span>

<span class="hljs-keyword">namespace</span> aidl::android::hardware::health {

<span class="hljs-keyword">class</span> <span class="hljs-title class_">IHealth</span> : <span class="hljs-keyword">public</span> ::ndk::ICInterface {
<span class="hljs-keyword">public</span>:
    <span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* descriptor;  <span class="hljs-comment">// "android.hardware.health.IHealth"</span>

    <span class="hljs-comment">// 纯虚函数,由实现类覆盖</span>
    <span class="hljs-keyword">virtual</span> ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">registerCallback</span><span class="hljs-params">(
        <span class="hljs-type">const</span> std::shared_ptr&lt;IHealthInfoCallback&gt;&amp; in_callback)</span> </span>= <span class="hljs-number">0</span>;

    <span class="hljs-keyword">virtual</span> ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getChargeCounterUah</span><span class="hljs-params">(<span class="hljs-type">int32_t</span>* _aidl_return)</span> </span>= <span class="hljs-number">0</span>;

    <span class="hljs-comment">// Binder通信相关</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::shared_ptr&lt;IHealth&gt; <span class="hljs-title">fromBinder</span><span class="hljs-params">(<span class="hljs-type">const</span> ::ndk::SpAIBinder&amp; binder)</span></span>;
};

<span class="hljs-comment">// Bn = Binder Native (服务端基类)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BnHealth</span> : <span class="hljs-keyword">public</span> ::ndk::BnCInterface&lt;IHealth&gt; {
<span class="hljs-keyword">public</span>:
    ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getInterfaceVersion</span><span class="hljs-params">(<span class="hljs-type">int32_t</span>* _aidl_return)</span> <span class="hljs-keyword">final</span></span>;
<span class="hljs-keyword">protected</span>:
    ::<span class="hljs-function">ndk::SpAIBinder <span class="hljs-title">createBinder</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span></span>;
};

<span class="hljs-comment">// Bp = Binder Proxy (客户端代理)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BpHealth</span> : <span class="hljs-keyword">public</span> ::ndk::BpCInterface&lt;IHealth&gt; {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">BpHealth</span><span class="hljs-params">(<span class="hljs-type">const</span> ::ndk::SpAIBinder&amp; binder)</span></span>;

    <span class="hljs-comment">// 实现所有虚函数,内部调用transact()</span>
    ::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">registerCallback</span><span class="hljs-params">(
        <span class="hljs-type">const</span> std::shared_ptr&lt;IHealthInfoCallback&gt;&amp; in_callback)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 序列化参数 → transact() → 反序列化返回值</span>
        <span class="hljs-comment">// ...</span>
    }
};

}  <span class="hljs-comment">// namespace aidl::android::hardware::health</span>
</code></pre>
<p><strong>关键类的职责</strong>:</p>
<ul>
<li><strong><code>IHealth</code></strong>(接口类):定义API契约</li>
<li><strong><code>BnHealth</code></strong>(Binder Native):服务端基类,处理transact()</li>
<li><strong><code>BpHealth</code></strong>(Binder Proxy):客户端代理,封装IPC细节</li>
</ul>
<hr/>
<h2 data-id="heading-7">Stable AIDL:版本管理的救星</h2>
<h3 data-id="heading-8">传统AIDL的痛点</h3>
<p>在Android 10之前,AIDL接口变更是噩梦:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Version 1</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IFoo</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Version 2 (破坏性变更!)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IFoo</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// ← 新增方法,老版本无法识别!</span>
}
</code></pre>
<p><strong>问题</strong>:</p>
<ul>
<li>无法在新旧版本间兼容</li>
<li>HAL升级强制要求Framework同步升级</li>
<li>OTA更新可能导致系统崩溃</li>
</ul>
<h3 data-id="heading-9">Stable AIDL的解决方案</h3>
<p><strong>核心机制</strong>:冻结旧版本接口 + 通过新方法扩展。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Stable AIDL的目录结构</span>
hardware/interfaces/health/aidl/
├── android/hardware/health/
│   ├── IHealth.aidl              <span class="hljs-comment"># 当前开发版本</span>
│   ├── HealthInfo.aidl
│   └── ...
└── aidl_api/android.hardware.health/
    ├── 1/                         <span class="hljs-comment"># 冻结的版本1</span>
    │   └── android/hardware/health/IHealth.aidl
    ├── 2/                         <span class="hljs-comment"># 冻结的版本2</span>
    │   └── android/hardware/health/IHealth.aidl
    └── current/                   <span class="hljs-comment"># 当前版本符号链接</span>
</code></pre>
<p><strong>版本演进示例</strong>(Android 15 Health HAL):</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Version 1 (冻结,不可修改)</span>
<span class="hljs-keyword">package</span> android.hardware.health;
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">getCapacity</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Version 2 (冻结,不可修改)</span>
<span class="hljs-keyword">package</span> android.hardware.health;
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerCallback</span><span class="hljs-params">(in IHealthInfoCallback callback)</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">getCapacity</span><span class="hljs-params">()</span>;
    <span class="hljs-comment">// 新增方法(向后兼容!)</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setChargingPolicy</span><span class="hljs-params">(BatteryChargingPolicy in_value)</span>;
    BatteryChargingPolicy <span class="hljs-title function_">getChargingPolicy</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Current (开发中)</span>
<span class="hljs-keyword">package</span> android.hardware.health;
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-comment">// ... 继承所有旧方法</span>
    <span class="hljs-comment">// 新增Android 15特性</span>
    BatteryHealthData <span class="hljs-title function_">getBatteryHealthData</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>版本检查代码</strong>(客户端):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 客户端检查HAL服务版本</span>
std::shared_ptr&lt;IHealth&gt; health = IHealth::<span class="hljs-built_in">fromBinder</span>(binder);

<span class="hljs-type">int32_t</span> version = <span class="hljs-number">0</span>;
health-&gt;<span class="hljs-built_in">getInterfaceVersion</span>(&amp;version);

<span class="hljs-keyword">if</span> (version &gt;= <span class="hljs-number">2</span>) {
    <span class="hljs-comment">// 使用Version 2的特性</span>
    BatteryChargingPolicy policy;
    health-&gt;<span class="hljs-built_in">getChargingPolicy</span>(&amp;policy);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 降级处理</span>
    <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Health HAL version "</span> &lt;&lt; version &lt;&lt; <span class="hljs-string">" does not support charging policy"</span>;
}
</code></pre>
<blockquote>
<p>✅ <strong>Stable AIDL的优势</strong>:</p>
<ol>
<li><strong>向后兼容</strong>:新Framework可以使用老HAL</li>
<li><strong>向前兼容</strong>:老Framework不会因新HAL崩溃(忽略未知方法)</li>
<li><strong>独立升级</strong>:HAL和Framework可以各自OTA</li>
</ol>
</blockquote>
<hr/>
<h2 data-id="heading-10">HIDL简介:HAL的前辈</h2>
<p>虽然HIDL正在被Stable AIDL取代,但Android 15中仍有大量遗留HAL使用HIDL。</p>
<h3 data-id="heading-11">HIDL语法特点</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// IUsb.hal (HIDL 1.0)</span>
package android.hardware.usb@<span class="hljs-number">1.0</span>;

import IUsbCallback;

interface IUsb {
    <span class="hljs-comment">/**
     * oneway = 异步调用,不等待返回
     */</span>
    oneway <span class="hljs-title function_">switchRole</span><span class="hljs-params">(<span class="hljs-built_in">string</span> portName, PortRole role)</span>;

    oneway <span class="hljs-title function_">setCallback</span><span class="hljs-params">(IUsbCallback callback)</span>;

    oneway <span class="hljs-title function_">queryPortStatus</span><span class="hljs-params">()</span>;
};
</code></pre>
<p><strong>HIDL vs AIDL对比</strong>:</p>






























<table><thead><tr><th align="left">特性</th><th align="left">HIDL</th><th align="left">AIDL</th></tr></thead><tbody><tr><td align="left"><strong>文件后缀</strong></td><td align="left"><code>.hal</code></td><td align="left"><code>.aidl</code></td></tr><tr><td align="left"><strong>版本标记</strong></td><td align="left"><code>@1.0</code> (包名中)</td><td align="left"><code>aidl_api/版本号/</code> (目录)</td></tr><tr><td align="left"><strong>异步语法</strong></td><td align="left"><code>oneway</code> 关键字</td><td align="left"><code>oneway</code> 关键字</td></tr><tr><td align="left"><strong>数据传输</strong></td><td align="left">hidl_vec/hidl_string</td><td align="left">std::vector/std::string</td></tr></tbody></table>
<h3 data-id="heading-12">HIDL遗留问题</h3>
<ol>
<li><strong>复杂的版本号管理</strong>:<code>@1.0</code> → <code>@1.1</code> → <code>@2.0</code> 需要手动维护</li>
<li><strong>工具链老旧</strong>:<code>hidl-gen</code>已停止维护</li>
<li><strong>无Rust支持</strong>:限制了现代化改造</li>
</ol>
<hr/>
<h2 data-id="heading-13">HAL服务实现:以Health HAL为例</h2>
<h3 data-id="heading-14">Health HAL架构</h3>
<pre><code class="hljs language-java" lang="java">┌─────────────────────────────────────────────────────────┐
│             Framework (Java)                            │
│  frameworks/base/services/core/java/...BatteryService   │
└─────────────┬───────────────────────────────────────────┘
              │ JNI
              ↓
┌─────────────────────────────────────────────────────────┐
│         Native <span class="hljs-title function_">Service</span> <span class="hljs-params">(C++)</span>                            │
│  frameworks/<span class="hljs-keyword">native</span>/services/batteryservice              │
└─────────────┬───────────────────────────────────────────┘
              │ Binder <span class="hljs-title function_">IPC</span> <span class="hljs-params">(AIDL)</span>
              ↓
┌─────────────────────────────────────────────────────────┐
│           HAL <span class="hljs-title function_">Service</span> <span class="hljs-params">(C++)</span>                             │
│  hardware/interfaces/health/aidl/<span class="hljs-keyword">default</span>/Health.cpp     │
│                                                          │
│  ┌────────────────────────────────────────────┐         │
│  │  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Health</span> : <span class="hljs-keyword">public</span> BnHealth {          │         │
│  │    BatteryMonitor battery_monitor_;        │         │
│  │    ndk::ScopedAStatus <span class="hljs-title function_">getCapacity</span><span class="hljs-params">(...)</span> {   │         │
│  │      <span class="hljs-comment">// 读取 /sys/class/power_supply/...  │         │</span>
│  │    }                                        │         │
│  │  }                                          │         │
│  └────────────────────────────────────────────┘         │
└─────────────┬───────────────────────────────────────────┘
              │ sysfs
              ↓
┌─────────────────────────────────────────────────────────┐
│              Kernel Driver                              │
│  drivers/power/supply/xxx_battery.c                     │
└─────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-15">服务端实现(Android 15源码分析)</h3>
<p><strong>Health.cpp</strong>(截取核心逻辑):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hardware/interfaces/health/aidl/default/Health.cpp (Android 15)</span>
<span class="hljs-keyword">namespace</span> aidl::android::hardware::health {

<span class="hljs-comment">// Health服务构造函数</span>
Health::<span class="hljs-built_in">Health</span>(std::string_view instance_name,
               std::unique_ptr&lt;<span class="hljs-keyword">struct</span> healthd_config&gt;&amp;&amp; config)
    : <span class="hljs-built_in">instance_name_</span>(instance_name),
      <span class="hljs-built_in">healthd_config_</span>(std::<span class="hljs-built_in">move</span>(config)),
      <span class="hljs-built_in">death_recipient_</span>(<span class="hljs-built_in">AIBinder_DeathRecipient_new</span>(&amp;OnCallbackDiedWrapped)) {

    <span class="hljs-comment">// 注册死亡通知回调(类似ServiceManager的linkToDeath)</span>
    <span class="hljs-built_in">AIBinder_DeathRecipient_setOnUnlinked</span>(death_recipient_.<span class="hljs-built_in">get</span>(), onCallbackUnlinked);

    <span class="hljs-comment">// 初始化电池监控器(底层读取sysfs)</span>
    battery_monitor_.<span class="hljs-built_in">init</span>(healthd_config_.<span class="hljs-built_in">get</span>());
}

<span class="hljs-comment">// ========== AIDL接口实现:获取电池电量 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::getCapacity</span><span class="hljs-params">(<span class="hljs-type">int32_t</span>* out)</span> </span>{
    <span class="hljs-comment">// 调用BatteryMonitor读取 /sys/class/power_supply/battery/capacity</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">GetProperty</span>&lt;<span class="hljs-type">int32_t</span>&gt;(&amp;battery_monitor_,
                                 ::android::BATTERY_PROP_CAPACITY,
                                 <span class="hljs-number">0</span>,  <span class="hljs-comment">// 默认值</span>
                                 out);
}

<span class="hljs-comment">// ========== AIDL接口实现:获取充电状态 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::getChargeStatus</span><span class="hljs-params">(BatteryStatus* out)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">GetProperty</span>(&amp;battery_monitor_,
                       ::android::BATTERY_PROP_BATTERY_STATUS,
                       BatteryStatus::UNKNOWN,
                       out);
}

<span class="hljs-comment">// ========== AIDL接口实现:设置充电策略 (Android 15新增) ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::setChargingPolicy</span><span class="hljs-params">(BatteryChargingPolicy in_value)</span> </span>{
    ::android::<span class="hljs-type">status_t</span> err = battery_monitor_.<span class="hljs-built_in">setChargingPolicy</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(in_value));

    <span class="hljs-keyword">switch</span> (err) {
        <span class="hljs-keyword">case</span> ::android::OK:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
        <span class="hljs-keyword">case</span> ::android::NAME_NOT_FOUND:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_UNSUPPORTED_OPERATION);
        <span class="hljs-keyword">case</span> ::android::BAD_VALUE:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromStatus</span>(::android::INVALID_OPERATION);
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromServiceSpecificErrorWithMessage</span>(
                    IHealth::STATUS_UNKNOWN, ::android::<span class="hljs-built_in">statusToString</span>(err).<span class="hljs-built_in">c_str</span>());
    }
}

<span class="hljs-comment">// ========== 回调管理:注册健康信息监听器 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::registerCallback</span><span class="hljs-params">(
    <span class="hljs-type">const</span> std::shared_ptr&lt;IHealthInfoCallback&gt;&amp; callback)</span> </span>{

    <span class="hljs-keyword">if</span> (callback == <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_NULL_POINTER);
    }

    {
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(callbacks_lock_)</span></span>;
        callbacks_.<span class="hljs-built_in">push_back</span>(callback);

        <span class="hljs-comment">// 为callback注册死亡通知(防止客户端崩溃后内存泄漏)</span>
        <span class="hljs-keyword">auto</span> linked = std::<span class="hljs-built_in">make_unique</span>&lt;LinkedCallback&gt;(<span class="hljs-built_in">weak_from_this</span>(), callback);
        <span class="hljs-keyword">auto</span> binder = callback-&gt;<span class="hljs-built_in">asBinder</span>();
        <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">AIBinder_linkToDeath</span>(binder.<span class="hljs-built_in">get</span>(),
                                           death_recipient_.<span class="hljs-built_in">get</span>(),
                                           linked.<span class="hljs-built_in">get</span>());
        <span class="hljs-keyword">if</span> (status == STATUS_OK) {
            linked.<span class="hljs-built_in">release</span>();  <span class="hljs-comment">// 交给Binder管理生命周期</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Cannot link to death: "</span> &lt;&lt; status;
        }
    }

    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}

<span class="hljs-comment">// ========== 主动通知所有回调 ==========</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Health::update</span><span class="hljs-params">()</span> </span>{
    battery_monitor_.<span class="hljs-built_in">updateValues</span>();
    HealthInfo health_info = battery_monitor_.<span class="hljs-built_in">getHealthInfo</span>();

    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(callbacks_lock_)</span></span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; callback : callbacks_) {
        <span class="hljs-comment">// 异步通知(oneway),避免阻塞</span>
        <span class="hljs-keyword">auto</span> status = callback-&gt;<span class="hljs-built_in">healthInfoChanged</span>(health_info);
        <span class="hljs-keyword">if</span> (!status.<span class="hljs-built_in">isOk</span>()) {
            <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Callback failed: "</span> &lt;&lt; status.<span class="hljs-built_in">getDescription</span>();
        }
    }

    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}

}  <span class="hljs-comment">// namespace aidl::android::hardware::health</span>
</code></pre>
<p><strong>关键设计</strong>:</p>
<ol>
<li><strong>错误处理</strong>:统一转换<code>::android::status_t</code>到AIDL的<code>ScopedAStatus</code></li>
<li><strong>死亡通知</strong>:防止客户端崩溃导致服务端泄漏回调</li>
<li><strong>线程安全</strong>:使用<code>std::mutex</code>保护共享数据(<code>callbacks_</code>)</li>
<li><strong>异步通知</strong>:回调使用<code>oneway</code>,避免阻塞HAL服务</li>
</ol>
<h3 data-id="heading-16">服务注册与启动</h3>
<p><strong>main.cpp</strong>(Health HAL服务入口):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hardware/interfaces/health/aidl/default/main.cpp</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 创建Health服务实例</span>
    <span class="hljs-keyword">auto</span> config = std::<span class="hljs-built_in">make_unique</span>&lt;healthd_config&gt;();
    ::android::hardware::health::<span class="hljs-built_in">InitHealthdConfig</span>(config.<span class="hljs-built_in">get</span>());
    <span class="hljs-keyword">auto</span> health = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;Health&gt;(<span class="hljs-string">"default"</span>, std::<span class="hljs-built_in">move</span>(config));

    <span class="hljs-comment">// 注册到ServiceManager</span>
    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(Health::descriptor) + <span class="hljs-string">"/default"</span>;
    <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">AServiceManager_addService</span>(health-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(), instance.<span class="hljs-built_in">c_str</span>());
    <span class="hljs-keyword">if</span> (status != STATUS_OK) {
        <span class="hljs-built_in">LOG</span>(FATAL) &lt;&lt; <span class="hljs-string">"Failed to register Health HAL: "</span> &lt;&lt; status;
    }

    <span class="hljs-comment">// 启动Binder线程池</span>
    <span class="hljs-built_in">ABinderProcess_setThreadPoolMaxThreadCount</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 0 = 自动管理</span>
    <span class="hljs-built_in">ABinderProcess_startThreadPool</span>();
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();  <span class="hljs-comment">// 阻塞等待</span>

    <span class="hljs-keyword">return</span> EXIT_FAILURE;  <span class="hljs-comment">// 永不返回,除非异常</span>
}
</code></pre>
<p><strong>注册流程解析</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">Health HAL服务启动
    ↓
<span class="hljs-number">1</span>. 创建Health实例 (new Health(...))
    ↓
<span class="hljs-number">2</span>. 生成服务名称 ("android.hardware.health.IHealth/default")
    ↓
<span class="hljs-number">3</span>. 调用 <span class="hljs-built_in">AServiceManager_addService</span>()
    ├→ 内部调用 Binder <span class="hljs-built_in">transact</span>(ADD_SERVICE)
    └→ ServiceManager记录到 mNameToService
    ↓
<span class="hljs-number">4</span>. 启动Binder线程池 (等待客户端调用)
    ↓
<span class="hljs-number">5</span>. <span class="hljs-built_in">joinThreadPool</span>() (阻塞主线程)
</code></pre>
<h3 data-id="heading-17">客户端调用</h3>
<p><strong>Native客户端代码</strong>:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// frameworks/native/services/batteryservice/HealthHalCallbackHidl.cpp (简化)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/hardware/health/IHealth.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/binder_manager.h&gt;</span></span>

<span class="hljs-keyword">using</span> aidl::android::hardware::health::IHealth;
<span class="hljs-keyword">using</span> aidl::android::hardware::health::HealthInfo;

<span class="hljs-comment">// 获取Health HAL服务</span>
<span class="hljs-function">std::shared_ptr&lt;IHealth&gt; <span class="hljs-title">getHealthService</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(IHealth::descriptor) + <span class="hljs-string">"/default"</span>;

    <span class="hljs-comment">// 通过ServiceManager查询服务</span>
    <span class="hljs-function">ndk::SpAIBinder <span class="hljs-title">binder</span><span class="hljs-params">(AServiceManager_waitForService(instance.c_str()))</span></span>;
    <span class="hljs-keyword">if</span> (binder.<span class="hljs-built_in">get</span>() == <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to get Health HAL service"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }

    <span class="hljs-comment">// 将Binder转换为IHealth接口</span>
    <span class="hljs-keyword">return</span> IHealth::<span class="hljs-built_in">fromBinder</span>(binder);
}

<span class="hljs-comment">// 使用Health HAL获取电池信息</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">getBatteryInfo</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> health = <span class="hljs-built_in">getHealthService</span>();
    <span class="hljs-keyword">if</span> (!health) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 调用AIDL接口</span>
    HealthInfo info;
    <span class="hljs-keyword">auto</span> status = health-&gt;<span class="hljs-built_in">getHealthInfo</span>(&amp;info);
    <span class="hljs-keyword">if</span> (!status.<span class="hljs-built_in">isOk</span>()) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"getHealthInfo failed: "</span> &lt;&lt; status.<span class="hljs-built_in">getDescription</span>();
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"Battery level: "</span> &lt;&lt; info.batteryLevel &lt;&lt; <span class="hljs-string">"%"</span>;
    <span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"Charging status: "</span> &lt;&lt; <span class="hljs-built_in">toString</span>(info.batteryStatus);
}
</code></pre>
<hr/>
<h2 data-id="heading-18">实战技巧:AIDL/HIDL开发最佳实践</h2>
<h3 data-id="heading-19">1. 选择AIDL还是HIDL?</h3>
<p><strong>决策树</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">新项目?</span>
<span class="hljs-string">├─</span> <span class="hljs-literal">Yes</span> <span class="hljs-string">→</span> <span class="hljs-string">使用</span> <span class="hljs-string">Stable</span> <span class="hljs-string">AIDL</span>
<span class="hljs-string">└─</span> <span class="hljs-literal">No</span> <span class="hljs-string">→</span> <span class="hljs-string">已有HAL使用HIDL?</span>
       <span class="hljs-string">├─</span> <span class="hljs-literal">Yes</span> <span class="hljs-string">→</span> <span class="hljs-string">继续维护HIDL</span> <span class="hljs-string">(除非有重大重构)</span>
       <span class="hljs-string">└─</span> <span class="hljs-literal">No</span> <span class="hljs-string">→</span> <span class="hljs-string">迁移到</span> <span class="hljs-string">Stable</span> <span class="hljs-string">AIDL</span>
</code></pre>
<h3 data-id="heading-20">2. Stable AIDL版本升级流程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 修改当前开发版本的AIDL文件</span>
vim hardware/interfaces/health/aidl/android/hardware/health/IHealth.aidl

<span class="hljs-comment"># 2. 冻结当前版本(假设从version 2升级到3)</span>
m android.hardware.health-freeze-api

<span class="hljs-comment"># 3. 自动生成 aidl_api/android.hardware.health/3/ 目录</span>

<span class="hljs-comment"># 4. 更新实现代码以支持新接口</span>

<span class="hljs-comment"># 5. 构建验证</span>
m android.hardware.health-impl
</code></pre>
<h3 data-id="heading-21">3. 错误处理规范</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ❌ 错误示例:直接返回空指针</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getService</span><span class="hljs-params">(...)</span> </span>{
    <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;  <span class="hljs-comment">// 编译错误!</span>
}

<span class="hljs-comment">// ✅ 正确示例:使用ScopedAStatus</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">getService</span><span class="hljs-params">(...)</span> </span>{
    <span class="hljs-keyword">if</span> (not_found) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_UNSUPPORTED_OPERATION);
    }
    <span class="hljs-keyword">if</span> (unknown_error) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromServiceSpecificError</span>(
            IHealth::STATUS_UNKNOWN, <span class="hljs-string">"Detailed error message"</span>);
    }
    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}
</code></pre>
<h3 data-id="heading-22">4. 性能优化:减少Binder往返</h3>
<p><strong>❌ 低效写法</strong>(每次调用都跨进程):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int</span> level = health-&gt;<span class="hljs-built_in">getCapacity</span>();       <span class="hljs-comment">// Binder调用1</span>
<span class="hljs-type">int</span> current = health-&gt;<span class="hljs-built_in">getCurrentNow</span>();   <span class="hljs-comment">// Binder调用2</span>
<span class="hljs-type">int</span> voltage = health-&gt;<span class="hljs-built_in">getVoltage</span>();      <span class="hljs-comment">// Binder调用3</span>
</code></pre>
<p><strong>✅ 高效写法</strong>(一次调用获取所有数据):</p>
<pre><code class="hljs language-cpp" lang="cpp">HealthInfo info;
health-&gt;<span class="hljs-built_in">getHealthInfo</span>(&amp;info);  <span class="hljs-comment">// 单次Binder调用,包含所有数据</span>

<span class="hljs-type">int</span> level = info.batteryLevel;
<span class="hljs-type">int</span> current = info.batteryCurrentMicroamps;
<span class="hljs-type">int</span> voltage = info.batteryVoltage;
</code></pre>
<p><strong>性能对比</strong>:</p>
<ul>
<li>方案1:3次Binder transact,约 300-900μs</li>
<li>方案2:1次Binder transact,约 100-300μs</li>
<li><strong>提升</strong>: 60%-70%</li>
</ul>
<h3 data-id="heading-23">5. 死亡通知最佳实践</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallback</span> : <span class="hljs-keyword">public</span> BnHealthInfoCallback {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 使用weak_ptr避免循环引用</span>
    std::weak_ptr&lt;MyService&gt; service_;

<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MyCallback</span><span class="hljs-params">(std::shared_ptr&lt;MyService&gt; service)</span>
        : service_(service) {</span>}

    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">healthInfoChanged</span><span class="hljs-params">(<span class="hljs-type">const</span> HealthInfo&amp; info)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 检查service是否还存活</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> svc = service_.<span class="hljs-built_in">lock</span>()) {
            svc-&gt;<span class="hljs-built_in">onHealthInfoUpdate</span>(info);
        }
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
    }

    <span class="hljs-comment">// 死亡通知回调</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">binderDied</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Health HAL服务崩溃,尝试重连..."</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">auto</span> svc = service_.<span class="hljs-built_in">lock</span>()) {
            svc-&gt;<span class="hljs-built_in">reconnectHealthHAL</span>();
        }
    }
};
</code></pre>
<h3 data-id="heading-24">6. 调试技巧</h3>
<p><strong>查看已注册的AIDL服务</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有AIDL HAL服务</span>
adb shell dumpsys -l | grep android.hardware

<span class="hljs-comment"># 查看Health HAL服务详情</span>
adb shell dumpsys android.hardware.health.IHealth/default

<span class="hljs-comment"># 输出示例:</span>
<span class="hljs-comment"># Battery Health:</span>
<span class="hljs-comment">#   batteryLevel: 85</span>
<span class="hljs-comment">#   batteryStatus: CHARGING</span>
<span class="hljs-comment">#   batteryHealth: GOOD</span>
<span class="hljs-comment">#   batteryChargeCounter: 2850000 µAh</span>
</code></pre>
<p><strong>Binder通信追踪</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用Binder日志</span>
adb shell setprop log.tag.binder VERBOSE

<span class="hljs-comment"># 实时查看AIDL调用</span>
adb logcat -s binder:V | grep <span class="hljs-string">"IHealth"</span>

<span class="hljs-comment"># 输出示例:</span>
<span class="hljs-comment"># binder: 1234:1234 BC_TRANSACTION thr 1234 -&gt; 5678 node 12345 handle 0x3 code 0x1 (IHealth::getCapacity)</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">常见问题与解答</h2>
<h3 data-id="heading-26">Q1: Stable AIDL的版本号如何管理?</h3>
<p><strong>A</strong>: 版本号存储在<code>aidl_api/</code>目录下,每次<code>freeze-api</code>自动递增:</p>
<pre><code class="hljs language-bash" lang="bash">aidl_api/android.hardware.health/
├── 1/      <span class="hljs-comment"># 第一次freeze</span>
├── 2/      <span class="hljs-comment"># 第二次freeze</span>
├── 3/      <span class="hljs-comment"># 最新freeze</span>
└── current -&gt; 3/  <span class="hljs-comment"># 符号链接指向最新版本</span>
</code></pre>
<p>客户端代码可以通过<code>getInterfaceVersion()</code>查询服务版本:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">int32_t</span> version = <span class="hljs-number">0</span>;
health-&gt;<span class="hljs-built_in">getInterfaceVersion</span>(&amp;version);
<span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"Health HAL version: "</span> &lt;&lt; version;
</code></pre>
<h3 data-id="heading-27">Q2: AIDL接口可以修改已冻结的版本吗?</h3>
<p><strong>A</strong>: <strong>绝对不行!</strong> 这会破坏向后兼容性。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 错误操作:修改冻结版本</span>
vim aidl_api/android.hardware.health/2/android/hardware/health/IHealth.aidl

<span class="hljs-comment"># ✅ 正确做法:修改当前开发版本,然后freeze</span>
vim android/hardware/health/IHealth.aidl
m android.hardware.health-freeze-api
</code></pre>
<h3 data-id="heading-28">Q3: HIDL如何调用AIDL服务(或反向)?</h3>
<p><strong>A</strong>: 需要编写适配层(Adapter):</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// HIDL → AIDL适配器示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HidlToAidlAdapter</span> : <span class="hljs-keyword">public</span> IHidlInterface {
    std::shared_ptr&lt;IAidlInterface&gt; aidl_service_;

    <span class="hljs-function">Return&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title">hidlMethod</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-comment">// 转换HIDL类型到AIDL类型</span>
        AidlType aidl_param = <span class="hljs-built_in">convertHidlToAidl</span>(hidl_param);

        <span class="hljs-comment">// 调用AIDL服务</span>
        <span class="hljs-keyword">auto</span> status = aidl_service_-&gt;<span class="hljs-built_in">aidlMethod</span>(aidl_param);

        <span class="hljs-comment">// 转换返回值</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">convertAidlToHidl</span>(status);
    }
};
</code></pre>
<p>Android 15的部分遗留HAL仍在使用此模式。</p>
<h3 data-id="heading-29">Q4: 如何处理HAL服务崩溃?</h3>
<p><strong>A</strong>: 使用死亡通知(DeathRecipient)自动重连:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthServiceManager</span> {
    std::shared_ptr&lt;IHealth&gt; health_;
    ndk::ScopedAIBinder_DeathRecipient death_recipient_;

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connectService</span><span class="hljs-params">()</span> </span>{
        health_ = <span class="hljs-built_in">getHealthService</span>();
        <span class="hljs-keyword">if</span> (!health_) {
            <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to get Health HAL"</span>;
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 注册死亡通知</span>
        <span class="hljs-keyword">auto</span> binder = health_-&gt;<span class="hljs-built_in">asBinder</span>();
        <span class="hljs-built_in">AIBinder_linkToDeath</span>(binder.<span class="hljs-built_in">get</span>(), death_recipient_.<span class="hljs-built_in">get</span>(), <span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">onServiceDied</span><span class="hljs-params">(<span class="hljs-type">void</span>* cookie)</span> </span>{
        <span class="hljs-keyword">auto</span>* manager = <span class="hljs-built_in">static_cast</span>&lt;HealthServiceManager*&gt;(cookie);
        <span class="hljs-built_in">LOG</span>(WARNING) &lt;&lt; <span class="hljs-string">"Health HAL died, reconnecting..."</span>;

        <span class="hljs-comment">// 等待100ms后重连</span>
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
        manager-&gt;<span class="hljs-built_in">connectService</span>();
    }
};
</code></pre>
<h3 data-id="heading-30">Q5: AIDL的性能与直接Binder调用相比如何?</h3>
<p><strong>A</strong>: 性能差异在5%以内(主要是代码生成的轻微开销):</p>

























<table><thead><tr><th align="left">方式</th><th align="center">延迟(中位数)</th><th align="center">吞吐量</th></tr></thead><tbody><tr><td align="left">直接Binder</td><td align="center">100μs</td><td align="center">10k ops/s</td></tr><tr><td align="left">AIDL (C++)</td><td align="center">105μs</td><td align="center">9.5k ops/s</td></tr><tr><td align="left">AIDL (Java)</td><td align="center">120μs</td><td align="center">8.3k ops/s</td></tr></tbody></table>
<p><strong>结论</strong>:AIDL的抽象带来的开销可以忽略,应优先使用AIDL以获得更好的维护性。</p>
<hr/>
<h2 data-id="heading-31">Android 15新特性:AIDL生态的升级</h2>
<h3 data-id="heading-32">1. Rust Backend支持</h3>
<p>Android 15的AIDL编译器新增Rust语言支持:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成Rust绑定</span>
aidl_interface {
    name: <span class="hljs-string">"android.hardware.health"</span>,
    backend: {
        rust: {
            enabled: <span class="hljs-literal">true</span>,
        },
    },
}
</code></pre>
<p><strong>生成的Rust代码</strong>(简化):</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 自动生成的 IHealth.rs</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">trait</span> <span class="hljs-title class_">IHealth</span>: binder::Interface {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> binder::<span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>&gt;;
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_health_info</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> binder::<span class="hljs-type">Result</span>&lt;HealthInfo&gt;;
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">IHealth</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">BpHealth</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">get_capacity</span>(&amp;<span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> binder::<span class="hljs-type">Result</span>&lt;<span class="hljs-type">i32</span>&gt; {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">reply</span> = <span class="hljs-keyword">self</span>.binder.<span class="hljs-title function_ invoke__">transact</span>(TRANSACTION_getCapacity, <span class="hljs-number">0</span>)?;
        reply.<span class="hljs-title function_ invoke__">read</span>()
    }
}
</code></pre>
<h3 data-id="heading-33">2. VINTF强制验证</h3>
<p>Android 15要求所有Stable AIDL HAL声明VINTF稳定性:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@VintfStability</span>  <span class="hljs-comment">// ← 必须添加</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IHealth</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>同时需要在<code>vintf</code>目录添加清单文件:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- hardware/interfaces/health/aidl/vintf/android.hardware.health-service.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"1.0"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"device"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hal</span> <span class="hljs-attr">format</span>=<span class="hljs-string">"aidl"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>android.hardware.health<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">interface</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>IHealth<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">instance</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">instance</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">hal</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<h3 data-id="heading-34">3. Lazy HAL支持</h3>
<p>按需启动HAL服务,节省内存:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// main.cpp (Lazy启动)</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> health = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;Health&gt;(<span class="hljs-string">"default"</span>, ...);

    <span class="hljs-comment">// 使用LazyServiceRegistrar代替直接注册</span>
    <span class="hljs-keyword">auto</span> registrar = ndk::LazyServiceRegistrar::<span class="hljs-built_in">getInstance</span>();
    registrar.<span class="hljs-built_in">registerService</span>(health-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(),
                               instance.<span class="hljs-built_in">c_str</span>());

    <span class="hljs-comment">// 当无客户端连接时,服务会自动退出</span>
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();
    <span class="hljs-keyword">return</span> EXIT_FAILURE;
}
</code></pre>
<p><strong>优势</strong>:</p>
<ul>
<li>待机状态下,未使用的HAL不占用内存</li>
<li>首次调用时自动启动(100ms延迟)</li>
<li>适用于低频使用的HAL(如NFC、IR)</li>
</ul>
<hr/>
<h2 data-id="heading-35">实战案例:创建自定义AIDL HAL</h2>
<p>假设我们要为智能座舱系统添加一个"氛围灯控制"HAL。</p>
<h3 data-id="heading-36">1. 定义AIDL接口</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// hardware/interfaces/ambientlight/aidl/android/hardware/ambientlight/IAmbientLight.aidl</span>
<span class="hljs-keyword">package</span> android.hardware.ambientlight;

<span class="hljs-keyword">import</span> android.hardware.ambientlight.LightZone;
<span class="hljs-keyword">import</span> android.hardware.ambientlight.RgbColor;

<span class="hljs-meta">@VintfStability</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IAmbientLight</span> {
    <span class="hljs-comment">/**
     * 设置指定区域的颜色
     * <span class="hljs-doctag">@param</span> zone 灯光区域(前排/后排/氛围带)
     * <span class="hljs-doctag">@param</span> color RGB颜色值
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setColor</span><span class="hljs-params">(in LightZone zone, in RgbColor color)</span>;

    <span class="hljs-comment">/**
     * 设置亮度(0-100)
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBrightness</span><span class="hljs-params">(<span class="hljs-type">int</span> brightness)</span>;

    <span class="hljs-comment">/**
     * 启用/禁用呼吸灯效果
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBreathingMode</span><span class="hljs-params">(<span class="hljs-type">boolean</span> enabled)</span>;
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// RgbColor.aidl</span>
<span class="hljs-keyword">package</span> android.hardware.ambientlight;

parcelable RgbColor {
    <span class="hljs-type">int</span> red;    <span class="hljs-comment">// 0-255</span>
    <span class="hljs-type">int</span> green;  <span class="hljs-comment">// 0-255</span>
    <span class="hljs-type">int</span> blue;   <span class="hljs-comment">// 0-255</span>
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// LightZone.aidl</span>
<span class="hljs-keyword">package</span> android.hardware.ambientlight;

<span class="hljs-meta">@Backing(type="int")</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">LightZone</span> {
    FRONT_DASHBOARD = <span class="hljs-number">0</span>,
    REAR_SEATS = <span class="hljs-number">1</span>,
    DOOR_AMBIENT = <span class="hljs-number">2</span>,
}
</code></pre>
<h3 data-id="heading-37">2. 添加构建配置</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># hardware/interfaces/ambientlight/aidl/Android.bp</span>
aidl_interface {
    name: <span class="hljs-string">"android.hardware.ambientlight"</span>,
    vendor_available: true,
    srcs: [<span class="hljs-string">"android/hardware/ambientlight/*.aidl"</span>],
    stability: <span class="hljs-string">"vintf"</span>,
    backend: {
        java: {
            sdk_version: <span class="hljs-string">"module_current"</span>,
        },
        cpp: {
            enabled: true,
        },
        rust: {
            enabled: true,
        },
    },
    versions_with_info: [
        {
            version: <span class="hljs-string">"1"</span>,
            imports: [],
        },
    ],
}
</code></pre>
<h3 data-id="heading-38">3. 实现HAL服务</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// hardware/interfaces/ambientlight/aidl/default/AmbientLight.h</span>
<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;aidl/android/hardware/ambientlight/BnAmbientLight.h&gt;</span></span>

<span class="hljs-keyword">namespace</span> aidl::android::hardware::ambientlight {

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AmbientLight</span> : <span class="hljs-keyword">public</span> BnAmbientLight {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">setColor</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">setBrightness</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> brightness)</span> <span class="hljs-keyword">override</span></span>;
    <span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">setBreathingMode</span><span class="hljs-params">(<span class="hljs-type">bool</span> enabled)</span> <span class="hljs-keyword">override</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">writeToHardware</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color, <span class="hljs-type">int</span> brightness)</span></span>;
};

}  <span class="hljs-comment">// namespace</span>
</code></pre>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// AmbientLight.cpp</span>
<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">AmbientLight::setColor</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color)</span> </span>{
    <span class="hljs-keyword">if</span> (color.red &lt; <span class="hljs-number">0</span> || color.red &gt; <span class="hljs-number">255</span>) {
        <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">fromExceptionCode</span>(EX_ILLEGAL_ARGUMENT);
    }

    <span class="hljs-comment">// 写入硬件寄存器或通过CAN总线发送</span>
    <span class="hljs-built_in">writeToHardware</span>(zone, color, current_brightness_);

    <span class="hljs-keyword">return</span> ndk::ScopedAStatus::<span class="hljs-built_in">ok</span>();
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AmbientLight::writeToHardware</span><span class="hljs-params">(LightZone zone, <span class="hljs-type">const</span> RgbColor&amp; color, <span class="hljs-type">int</span> brightness)</span> </span>{
    <span class="hljs-comment">// 伪代码:实际应通过SPI/I2C/CAN与硬件通信</span>
    <span class="hljs-type">int</span> led_controller_fd = <span class="hljs-built_in">open</span>(<span class="hljs-string">"/dev/led_controller"</span>, O_RDWR);

    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">led_command</span> {
        <span class="hljs-type">uint8_t</span> zone;
        <span class="hljs-type">uint8_t</span> r, g, b;
        <span class="hljs-type">uint8_t</span> brightness;
    } cmd = {
        .zone = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(zone),
        .r = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(color.red),
        .g = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(color.green),
        .b = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(color.blue),
        .brightness = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(brightness),
    };

    <span class="hljs-built_in">write</span>(led_controller_fd, &amp;cmd, <span class="hljs-built_in">sizeof</span>(cmd));
    <span class="hljs-built_in">close</span>(led_controller_fd);
}
</code></pre>
<h3 data-id="heading-39">4. 注册服务</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// main.cpp</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> ambient_light = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;AmbientLight&gt;();

    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(IAmbientLight::descriptor) + <span class="hljs-string">"/default"</span>;
    <span class="hljs-keyword">auto</span> status = <span class="hljs-built_in">AServiceManager_addService</span>(ambient_light-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(),
                                             instance.<span class="hljs-built_in">c_str</span>());
    <span class="hljs-built_in">CHECK</span>(status == STATUS_OK) &lt;&lt; <span class="hljs-string">"Failed to register AmbientLight HAL"</span>;

    <span class="hljs-built_in">ABinderProcess_setThreadPoolMaxThreadCount</span>(<span class="hljs-number">4</span>);
    <span class="hljs-built_in">ABinderProcess_startThreadPool</span>();
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();

    <span class="hljs-keyword">return</span> EXIT_FAILURE;
}
</code></pre>
<h3 data-id="heading-40">5. 客户端调用</h3>
<p><strong>Native客户端</strong>:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/hardware/ambientlight/IAmbientLight.h&gt;</span></span>

<span class="hljs-keyword">using</span> aidl::android::hardware::ambientlight::IAmbientLight;
<span class="hljs-keyword">using</span> aidl::android::hardware::ambientlight::RgbColor;
<span class="hljs-keyword">using</span> aidl::android::hardware::ambientlight::LightZone;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setAmbientLightColor</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 获取HAL服务</span>
    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>(IAmbientLight::descriptor) + <span class="hljs-string">"/default"</span>;
    <span class="hljs-keyword">auto</span> binder = ndk::<span class="hljs-built_in">SpAIBinder</span>(<span class="hljs-built_in">AServiceManager_getService</span>(instance.<span class="hljs-built_in">c_str</span>()));
    <span class="hljs-keyword">auto</span> light = IAmbientLight::<span class="hljs-built_in">fromBinder</span>(binder);

    <span class="hljs-keyword">if</span> (!light) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to get AmbientLight HAL"</span>;
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 设置前排仪表台为蓝色</span>
    RgbColor blue{.red = <span class="hljs-number">0</span>, .green = <span class="hljs-number">0</span>, .blue = <span class="hljs-number">255</span>};
    <span class="hljs-keyword">auto</span> status = light-&gt;<span class="hljs-built_in">setColor</span>(LightZone::FRONT_DASHBOARD, blue);

    <span class="hljs-keyword">if</span> (!status.<span class="hljs-built_in">isOk</span>()) {
        <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"setColor failed: "</span> &lt;&lt; status.<span class="hljs-built_in">getDescription</span>();
    }
}
</code></pre>
<p><strong>Java客户端</strong>(Framework层):</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> android.hardware.ambientlight.IAmbientLight;
<span class="hljs-keyword">import</span> android.hardware.ambientlight.RgbColor;
<span class="hljs-keyword">import</span> android.hardware.ambientlight.LightZone;
<span class="hljs-keyword">import</span> android.os.ServiceManager;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AmbientLightManager</span> {
    <span class="hljs-keyword">private</span> IAmbientLight mService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AmbientLightManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            mService = IAmbientLight.Stub.asInterface(
                ServiceManager.waitForService(<span class="hljs-string">"android.hardware.ambientlight.IAmbientLight/default"</span>)
            );
        } <span class="hljs-keyword">catch</span> (Exception e) {
            Log.e(TAG, <span class="hljs-string">"Failed to get AmbientLight service"</span>, e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFrontColor</span><span class="hljs-params">(<span class="hljs-type">int</span> r, <span class="hljs-type">int</span> g, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-type">RgbColor</span> <span class="hljs-variable">color</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RgbColor</span>();
        color.red = r;
        color.green = g;
        color.blue = b;

        <span class="hljs-keyword">try</span> {
            mService.setColor(LightZone.FRONT_DASHBOARD, color);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            Log.e(TAG, <span class="hljs-string">"Failed to set color"</span>, e);
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-41">总结</h2>
<p>本文深入分析了AIDL和HIDL在Android 15中的应用,涵盖了从接口定义到HAL服务实现的完整流程。</p>
<p><strong>核心要点回顾</strong>:</p>
<ol>
<li>
<p><strong>AIDL vs HIDL</strong>:</p>
<ul>
<li>HIDL正在退役,新项目使用Stable AIDL</li>
<li>Stable AIDL通过版本冻结实现向后兼容</li>
<li>Android 15全面支持Rust AIDL Backend</li>
</ul>
</li>
<li>
<p><strong>HAL服务开发</strong>:</p>
<ul>
<li>继承<code>BnXXX</code>实现服务端</li>
<li>通过<code>AServiceManager_addService()</code>注册</li>
<li>使用<code>fromBinder()</code>获取客户端代理</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong>:</p>
<ul>
<li>批量获取数据减少Binder往返</li>
<li>使用<code>oneway</code>实现异步回调</li>
<li>考虑Lazy HAL减少内存占用</li>
</ul>
</li>
<li>
<p><strong>最佳实践</strong>:</p>
<ul>
<li>注册死亡通知防止泄漏</li>
<li>统一错误处理(ScopedAStatus)</li>
<li>VINTF清单声明确保兼容性</li>
</ul>
</li>
</ol>
<p>通过Health HAL和自定义AmbientLight HAL的实战案例,你已经具备了开发AIDL HAL服务的完整能力!</p>
<hr/>
<h3 data-id="heading-42">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.android.com%2Fdocs%2Fcore%2Farchitecture%2Faidl" target="_blank" title="https://source.android.com/docs/core/architecture/aidl" ref="nofollow noopener noreferrer">Android AIDL官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fandroid15-release%3Asystem%2Ftools%2Faidl%2FREADME.md" target="_blank" title="https://cs.android.com/android/platform/superproject/+/android15-release:system/tools/aidl/README.md" ref="nofollow noopener noreferrer">Stable AIDL设计文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2Fandroid%2Fplatform%2Fsuperproject%2F%2B%2Fandroid15-release%3Ahardware%2Finterfaces%2Fhealth%2Faidl%2F" target="_blank" title="https://cs.android.com/android/platform/superproject/+/android15-release:hardware/interfaces/health/aidl/" ref="nofollow noopener noreferrer">Health HAL源码</a></li>
</ul>
<hr/>
<h3 data-id="heading-43">系列文章</h3>
<ul>
<li><a href="https://juejin.cn/post/7603651011978477610" target="_blank" title="https://juejin.cn/post/7603651011978477610">上一篇：Android 15 ServiceManager与Binder服务注册深度解析</a></li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[给你的 code agent 搓一个错误检测机制]]></title>    <link>https://juejin.cn/post/7604889577937649691</link>    <guid>https://juejin.cn/post/7604889577937649691</guid>    <pubDate>2026-02-10T11:51:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604889577937649691" data-draft-id="7604984549173706761" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="给你的 code agent 搓一个错误检测机制"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T11:51:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="imoo"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104364766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            给你的 code agent 搓一个错误检测机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104364766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    imoo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T11:51:50.000Z" title="Tue Feb 10 2026 11:51:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>众所周知，code agent 是无法判断出生成的代码是否正确的。也就是只有生成环节，没有验证环节，所以需要我们一点点做 debug，这也是很多人最开始不看好 ai 的原因。</p>
<p>但反过来想，是不是解决了验证环节，ai 的体验就会获得大幅提升呢。</p>
<h2 data-id="heading-1">锁定问题</h2>
<p>要想解决验证环节，可以先思考我们是如何做 debug 的。</p>
<p>对于前端，一般而言都是先安装依赖，看看代码有没有爆红。然后运行，看项目是否能正常启动，最后打开页面和控制台，点一点看哪里有问题。</p>
<p>拆解来看，其实分为了几个问题：</p>
<ul>
<li>是否能正常安装依赖</li>
<li>代码是否直接在编辑器就出现了错误（静态检测/开发时错误）</li>
<li>项目是否能正常启动（构建时错误）</li>
<li>控制台是否报错（运行时错误）</li>
</ul>
<p>所以，我们的目标是依次解决这些问题。</p>
<h2 data-id="heading-2">解决方案</h2>
<h4 data-id="heading-3">能否正常安装依赖</h4>
<p>这一步其实相对简单，运行 <code>npm i</code> 就行了。需要注意的点有：</p>
<ol>
<li>npm 安装依赖存在不少问题，它使用扁平化所有依赖，并逐个进行下载的做法，这可能会导致<strong>幽灵依赖</strong>（能引用到没安装 package.json 的部分包），<strong>安装缓慢</strong>（内存存储双爆炸），<strong>依赖冲突</strong>（子依赖使用了不同版本）等问题。为了解决这些问题，<strong>pnpm</strong> 出现了，目前大部分前端项目都会优先考虑使用 pnpm</li>
<li>关于锁文件的问题</li>
</ol>
<p><strong>真正决定安装版本的是锁文件</strong>，其生成依赖于 package.json。但<strong>不要手动修改锁文件。</strong></p>
<p>安装会有很多种情况</p>
<p>情况1：当有锁文件，且与 package.json 中包一致时，执行安装，会完全按照锁文件进行安装，这是最常见且最安全的情况。</p>
<p>情况2：当有锁文件，且与 package.json 中包不一致（比如手动在 package.json 中更新了包），执行安装，锁文件会更新有变化的部分。锁文件更新后，后续再进行安装就会进入到情况1</p>
<p>情况3：当没有锁文件，执行安装依赖时，会按 package.json 里的依赖</p>
<ul>
<li>精确版本号时，会选择精确版本（"axios": "1.5.0" 会安装 1.5.0）</li>
<li>有 ^ 时，允许小版本自动更新（"axios": "^1.5.0" 会选择最新且小于 2.0.0 的版本）</li>
<li>有 ~ 时，允许小特性自动更新（"axios": "~1.5.0" 会安装最新且小于 1.6.0 的版本）</li>
</ul>
<p>根据这些规则，会选择出所有适合的包，生成锁文件，接着进入情况1，使后续该项目使用的包稳定，不会出现突然升级的问题。</p>
<p>暂时无法在昆仑万维文档外展示此内容</p>
<p><strong>最佳实践</strong>：安装/更新新依赖，最好还是走命令行</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span> <span class="hljs-comment">// 安装</span>
<span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span>@<span class="hljs-selector-tag">latest</span> <span class="hljs-comment">// 更新最新版，也可以指定版本如 xxx@1.0.0</span>
</code></pre>
<p>这样能自动同时更新 package.json 和锁文件，且不影响其他包。</p>
<p>退而求其次，是手动修改 package.json，随后再进行 npm i 重新安装，这样也能让锁文件进行更新，</p>
<blockquote>
<p>如果单独修改 package.json 文件，可能是无效的，比如：package.json 中 <code>"axios": "^1.5.0"</code>，lock 中 <code>1.5.2</code>，此时你将 package.json 的 <code>^1.5.0</code> 改为 <code>^1.5.1</code>，由于 lock 中的 <code>1.5.2</code> 仍符合<code>^1.5.1</code>，所以是无事发生，不会产生任何更新。</p>
</blockquote>
<h4 data-id="heading-4">是否直接在编辑器就出现了错误</h4>
<p>ai 的很多错误，其实在前端通常都能很直接的看到，如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44a2db0eeab04ed3a2ff9766ccefe36d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=h9l%2BJ%2BlTwEj1sQjQWM89bum5veg%3D" alt="" loading="lazy"/></p>
<p>这里的报错其实有两个原因：eslint 报错与 ts 报错</p>
<p>我们可以通过这两个命令扫描出对应的错误：</p>
<pre><code class="hljs language-css" lang="css">npx eslint ./
npx tsc <span class="hljs-attr">--noEmit</span> -<span class="hljs-selector-tag">p</span> tsconfig<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.json</span> <span class="hljs-attr">--strict</span>
</code></pre>
<p>我们可以在对应的文件中，配置对应的规则集，eslint 的配置位于 eslint.config.js 中；ts 的配置位于 tsconfig.app.json。</p>
<p>严格的规则，有助于 ai 生成产物的稳定，更不容易出现白屏报错等问题，但相对的时间会更长，因为要解决更多 error。宽松的规则，则对应 token 的减少，时间更快。</p>
<p>在我们的项目中，使用了默认的规则集，基本上就够用了，不过有几个模型经常报错、但不影响主流程的，我们还是降低为了 warn，从而规避修复所需要花费的成本。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"@typescript-eslint/no-unused-vars"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-regexp">//</span> 未使用变量降为 <span class="hljs-keyword">warn</span>
<span class="hljs-string">"@typescript-eslint/no-empty-object-type"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-regexp">//</span> 空对象类型降为 <span class="hljs-keyword">warn</span>
<span class="hljs-string">"@typescript-eslint/no-explicit-any"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-regexp">//</span> any 类型降为 <span class="hljs-keyword">warn</span>，这个可能还有待商榷，过多的使用 any 本质上就是忽略报错
</code></pre>
<h4 data-id="heading-5">项目是否能正常启动</h4>
<p>在大部分情况下，如果前两个步骤是正确的，最后一步 build 大概率不会有问题。即使有问题，模型也能在 build 后也能看到构建报错，从而直接进行修复。</p>
<p>如果想要验证也简单，跑一个构建命令就行了</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run build
</code></pre>
<h4 data-id="heading-6">控制台是否报错</h4>
<p>前面三个环节，都可以用命令行进行验证和 debug，也就是 agent 有办法感知到。但控制台的报错，属于运行时错误，很难报给 agent，所以我们需要设计一套上报机制来解决这个问题。</p>
<p>也就是这个需求 <a href="https://link.juejin.cn?target=https%3A%2F%2Frg975ojk5z.feishu.cn%2Fwiki%2FULd7wVcniizLapkaNlTcnFjBnJg" target="_blank" title="https://rg975ojk5z.feishu.cn/wiki/ULd7wVcniizLapkaNlTcnFjBnJg" ref="nofollow noopener noreferrer">【Websites】增加手动Debug模式</a>，简单来说，就是<strong>控制台的所有报错都暴露出来发给 agent</strong></p>
<p>要实现这点，关键在于拦截所有报错，我们来看常见的报错，逐个进行解决。</p>
<ol>
<li>普通 js 同步报错，也是最常见的一种，语法问题等引起</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f88e31ffa647cfbb54afd64bf3da99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=p0WdYPLcKhxV0uDLNRXl0v6AnHc%3D" alt="" loading="lazy"/></p>
<p>解法：可以用 window.onerror 进行回调处理</p>
<ol start="2">
<li>promise reject 未处理报错，类似 try catch 问题</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec16dc6c20fc4888ac631793320c009a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=JIm0W3EpqtpNNn%2BkUz5Q0rnlJ5Q%3D" alt="" loading="lazy"/></p>
<p>解法：可以使用 window.addEventListener("unhandledrejection", event =&gt; {}) 来做回调处理</p>
<ol start="3">
<li>接口报错 / 资源加载失败</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe97c0be1474856a2d9c0e5ade5fbd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW1vbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771329115&amp;x-signature=EwcuIZ9nRw5P1x9UKBTiL1QhF18%3D" alt="" loading="lazy"/></p>
<p>虽然严格意义上，不算代码的问题，但是也有必要让 agent 感知到</p>
<p>解法：通信使用 axios 包，并且在其响应拦截器中做处理，如果不是 200，则进行 error 回调</p>
<p>主要的报错就这三种，我们可以基于此封装一套错误抛出的机制。不过 github 实际上有现成的更完备的库，可以考虑直接使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsentry.io%2Fwelcome%2F" target="_blank" title="https://sentry.io/welcome/" ref="nofollow noopener noreferrer">Sentry</a> 来做这件事。sentry 本身是用于错误上报的，不过我们可以将其拦截掉，在 callback 中只执行我们的逻辑即可。</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
    <span class="hljs-attr">dsn</span>: <span class="hljs-string">'https://examplePublicKey@o0.ingest.sentry.io/0'</span>, <span class="hljs-comment">// 使用假 DSN 来启用错误捕获功能</span>
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用 Sentry</span>
    <span class="hljs-attr">attachStacktrace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 附加堆栈跟踪</span>
    
    <span class="hljs-comment">// 在发送前处理错误</span>
    <span class="hljs-title function_">beforeSend</span>(<span class="hljs-params">event, hint</span>) {
      <span class="hljs-keyword">const</span> error = hint.<span class="hljs-property">originalException</span> || hint.<span class="hljs-property">syntheticException</span>
      <span class="hljs-title function_">dosomething</span>(error, event)
      <span class="hljs-comment">// 返回 null 阻止实际上报到 Sentry</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    },
  })
</code></pre>
<p>当你的模版中接入了这套流程后，你就可以将错误向 agent 抛出了，比如说：</p>
<ol>
<li>
<p>skywork 中，产物是在 iframe 里，那么我们可以利用 postMessage 将错误反馈到主应用，从而在输入框中引用到错误并发送给 agent</p>
</li>
<li>
<p>如果产物完全独立，可以考虑将错误打到接口中，之后的通信让 agent 先去访问这些错误，修复后再做操作</p>
</li>
</ol>
<h2 data-id="heading-7">总结</h2>
<p>所以最终这个机制有以下几个部分构成：</p>
<ol>
<li>安装、更新依赖时走命令行（且最好使用 pnpm 而非 npm）</li>
</ol>

<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span> <span class="hljs-comment">// 安装</span>
<span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">xxx</span>@<span class="hljs-selector-tag">latest</span> <span class="hljs-comment">// 更新最新版，也可以指定版本如 xxx@1.0.0</span>
</code></pre>
<p>2.  build 前先扫描错误并修复（要使用 typescript 而非 js，要接入 eslint）</p>

<pre><code class="hljs language-css" lang="css">npx eslint ./
npx tsc <span class="hljs-attr">--noEmit</span> -<span class="hljs-selector-tag">p</span> tsconfig<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.json</span> <span class="hljs-attr">--strict</span>
</code></pre>
<p>3.  跑 build 看有没有问题</p>

<pre><code class="hljs language-arduino" lang="arduino">npm run build
</code></pre>
<p>4.  在模版中接入运行时错误监控，并将监控的结果传递给 agent</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
    <span class="hljs-attr">dsn</span>: <span class="hljs-string">'https://examplePublicKey@o0.ingest.sentry.io/0'</span>, <span class="hljs-comment">// 使用假 DSN 来启用错误捕获功能</span>
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用 Sentry</span>
    <span class="hljs-attr">attachStacktrace</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 附加堆栈跟踪</span>
    
    <span class="hljs-comment">// 在发送前处理错误</span>
    <span class="hljs-title function_">beforeSend</span>(<span class="hljs-params">event, hint</span>) {
      <span class="hljs-keyword">const</span> error = hint.<span class="hljs-property">originalException</span> || hint.<span class="hljs-property">syntheticException</span>
      <span class="hljs-title function_">dosomething</span>(error, event) <span class="hljs-comment">// 自定义实现</span>
      <span class="hljs-comment">// 返回 null 阻止实际上报到 Sentry</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    },
  })
  
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第18篇）：OpenWork - 开源版Claude Cowork，本地AI代理工作台]]></title>    <link>https://juejin.cn/post/7605051978871881747</link>    <guid>https://juejin.cn/post/7605051978871881747</guid>    <pubDate>2026-02-10T12:01:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871881747" data-draft-id="7604964464689709119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第18篇）：OpenWork - 开源版Claude Cowork，本地AI代理工作台"/> <meta itemprop="keywords" content="AI编程,AIGC,开源"/> <meta itemprop="datePublished" content="2026-02-10T12:01:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第18篇）：OpenWork - 开源版Claude Cowork，本地AI代理工作台
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T12:01:06.000Z" title="Tue Feb 10 2026 12:01:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果 Claude Cowork 能开源、本地化运行，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第18篇文章。今天带你了解的项目是 <strong>OpenWork</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork" target="_blank" title="https://github.com/different-ai/openwork" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>在 AI 代理工具领域，Claude Cowork 是一个强大的协作工作台，但它是闭源的商业产品。OpenWork 应运而生，它是一个完全开源的桌面应用，由 OpenCode 驱动，实现了与 Claude Cowork 类似的功能：<strong>运行 AI 代理、技能和 MCP（模型上下文协议）</strong>。更重要的是，它采用"本地优先，云端就绪"的设计理念，让你可以在自己的机器上一键运行，完全掌控自己的 AI 工作流。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🖥️ <strong>开源替代品</strong>：Claude Cowork 的免费开源替代方案</li>
<li>🏠 <strong>本地优先</strong>：在本地运行 AI 代理，数据完全由你掌控</li>
<li>🔌 <strong>MCP 协议支持</strong>：原生支持 Model Context Protocol</li>
<li>🧩 <strong>可组合架构</strong>：桌面应用、聊天应用连接器、服务器模式随意切换</li>
<li>⚡ <strong>技能管理器</strong>：安装、导入和管理各种技能</li>
<li>🌐 <strong>跨平台支持</strong>：基于 Tauri 构建，支持 macOS、Windows、Linux</li>
<li>🔓 <strong>可"弹出"设计</strong>：甚至无需 UI 也能通过命令行工作</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>OpenWork 的核心架构和设计理念</li>
<li>如何在本地部署和运行 AI 代理工作流</li>
<li>MCP 协议在 OpenWork 中的应用</li>
<li>技能系统的使用和管理</li>
<li>主机模式与客户端模式的区别和应用场景</li>
<li>与其他 AI 工作台工具的对比分析</li>
<li>实际应用场景和最佳实践</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对 AI 代理概念有基本了解</li>
<li>了解 MCP（Model Context Protocol）协议（可选）</li>
<li>熟悉命令行操作（可选）</li>
<li>对桌面应用开发有基本概念（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>OpenWork</strong> 是一个<strong>开源桌面 AI 代理工作台</strong>，作为 Claude Cowork 的替代品，由 OpenCode CLI 提供核心能力。它允许用户在本地或服务器上运行 AI 代理、技能和 MCP，支持从单人使用扩展到团队协作共享。OpenWork 采用"本地优先，云端就绪"的设计哲学，让用户可以一键在本地运行 AI 工作流，同时也支持连接远程服务器。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>Claude Cowork 是闭源商业产品，无法本地化部署</li>
<li>现有 AI 代理工具缺乏统一的技能管理和 MCP 支持</li>
<li>团队协作需要共享 AI 工作流，但缺乏开源解决方案</li>
<li>开发者需要一个可扩展、可组合的 AI 代理工作台</li>
<li>隐私敏感场景需要完全本地化的 AI 代理运行环境</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>需要本地运行 AI 代理的开发者</li>
<li>希望使用 Claude Cowork 类似功能但不想付费的用户</li>
<li>对 MCP 协议感兴趣的技术人员</li>
<li>需要团队共享 AI 工作流的团队</li>
<li>对数据隐私有高要求的企业和个人</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>团队：different-ai</strong></p>
<ul>
<li><strong>背景</strong>：专注于开源 AI 工具开发的团队</li>
<li><strong>代表作品</strong>：OpenWork、file-organizer-2000 等</li>
<li><strong>理念</strong>：让 AI 工具更加开放、可访问、可组合</li>
<li><strong>技术栈</strong>：TypeScript、Rust、Tauri、React</li>
</ul>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 9.2k+（快速增长中）</li>
<li>🍴 <strong>Forks</strong>: 768+</li>
<li>📦 <strong>版本</strong>: 持续更新中（830+ commits）</li>
<li>📄 <strong>License</strong>: MIT（完全开源，自由使用）</li>
<li>🌐 <strong>项目地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork" target="_blank" title="https://github.com/different-ai/openwork" ref="nofollow noopener noreferrer">GitHub</a></li>
<li>💬 <strong>社区</strong>: GitHub Issues 活跃</li>
<li>👥 <strong>贡献者</strong>: 23位贡献者，活跃的社区参与</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2024-2025年：项目创建，实现核心功能</li>
<li>持续迭代：添加技能管理器、MCP 支持等新功能</li>
<li>社区增长：达到 9.2k+ Stars，成为热门项目</li>
<li>多模态支持：支持桌面应用、Web 界面、CLI 等多种使用方式</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>OpenWork 的核心作用是<strong>提供一个开源的 AI 代理工作台</strong>，主要功能包括：</p>
<ol>
<li><strong>AI 代理运行</strong>：在本地或服务器上运行各种 AI 代理</li>
<li><strong>技能管理</strong>：安装、导入和管理各种技能（Skills）</li>
<li><strong>MCP 协议支持</strong>：原生支持 Model Context Protocol</li>
<li><strong>会话管理</strong>：管理多个会话，支持实时提示发送</li>
<li><strong>工作流模板</strong>：保存工作流模板，支持重复执行</li>
<li><strong>权限控制</strong>：处理代理的权限请求</li>
<li><strong>执行时间线</strong>：可视化展示执行计划时间线</li>
<li><strong>事件流订阅</strong>：支持 SSE 事件流订阅</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<p>OpenWork 适用于多种 AI 工作流场景：</p>
<ol>
<li>
<p><strong>本地开发</strong></p>
<ul>
<li>在本地运行 AI 代理进行开发测试</li>
<li>无需云服务即可使用完整功能</li>
<li>保护代码和数据隐私</li>
</ul>
</li>
<li>
<p><strong>团队协作</strong></p>
<ul>
<li>搭建共享的 AI 代理服务器</li>
<li>团队成员通过客户端模式连接</li>
<li>统一管理技能和工作流</li>
</ul>
</li>
<li>
<p><strong>自动化任务</strong></p>
<ul>
<li>使用技能自动化重复性任务</li>
<li>保存工作流模板重复执行</li>
<li>批量处理多个任务</li>
</ul>
</li>
<li>
<p><strong>MCP 集成</strong></p>
<ul>
<li>连接各种 MCP 服务器</li>
<li>扩展 AI 代理的能力</li>
<li>与现有工具链集成</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">安装方式</h4>
<p>OpenWork 提供多种安装方式：</p>
<p><strong>方式一：下载预构建版本（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS 用户</span>
<span class="hljs-comment"># 访问 Releases 页面下载 DMG 文件</span>

<span class="hljs-comment"># 或访问官网下载</span>
<span class="hljs-comment"># https://github.com/different-ai/openwork/releases</span>
</code></pre>
<p><strong>方式二：从源码构建</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆项目</span>
git <span class="hljs-built_in">clone</span> https://github.com/different-ai/openwork.git
<span class="hljs-built_in">cd</span> openwork

<span class="hljs-comment"># 2. 安装依赖</span>
pnpm install

<span class="hljs-comment"># 3. 启动开发服务器</span>
pnpm dev       <span class="hljs-comment"># 桌面应用</span>
pnpm dev:ui    <span class="hljs-comment"># 仅Web界面</span>
</code></pre>
<p><strong>系统要求</strong>：</p>
<ul>
<li>Node.js 18+</li>
<li>pnpm 包管理器</li>
<li>Rust（如果需要从源码构建 Tauri）</li>
<li>macOS / Windows / Linux</li>
</ul>
<h4 data-id="heading-12">基本使用</h4>
<p><strong>启动应用</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开发模式</span>
pnpm dev

<span class="hljs-comment"># 生产构建</span>
pnpm build
</code></pre>
<p><strong>连接模式选择</strong>：</p>
<p>OpenWork 支持两种运行模式：</p>
<ol>
<li>
<p><strong>主机模式</strong>（Host Mode）</p>
<ul>
<li>在本地启动完整服务</li>
<li>适合个人使用或作为团队服务器</li>
</ul>
</li>
<li>
<p><strong>客户端模式</strong>（Client Mode）</p>
<ul>
<li>连接到远程 OpenWork 服务器</li>
<li>适合团队协作场景</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">常用操作示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动桌面应用（开发模式）</span>
pnpm dev

<span class="hljs-comment"># 仅启动 Web 界面</span>
pnpm dev:ui

<span class="hljs-comment"># 构建桌面应用</span>
pnpm build

<span class="hljs-comment"># 使用 CLI 模式（openwrk）</span>
<span class="hljs-comment"># openwrk 提供纯命令行的主机模式</span>
</code></pre>
<h3 data-id="heading-14">核心特性</h3>
<p>OpenWork 的核心特性包括：</p>
<ol>
<li>
<p><strong>本地优先设计</strong></p>
<ul>
<li>在本地机器上一键运行</li>
<li>数据完全由用户掌控</li>
<li>无需云服务即可使用</li>
</ul>
</li>
<li>
<p><strong>可组合架构</strong></p>
<ul>
<li>桌面应用模式</li>
<li>聊天应用连接器（如 WhatsApp）</li>
<li>服务器模式</li>
</ul>
</li>
<li>
<p><strong>可"弹出"设计</strong></p>
<ul>
<li>由 OpenCode 驱动</li>
<li>甚至无需 UI 也能工作</li>
<li>支持 CLI 纯命令行操作</li>
</ul>
</li>
<li>
<p><strong>会话管理</strong></p>
<ul>
<li>创建和管理多个会话</li>
<li>实时发送提示</li>
<li>查看会话历史</li>
</ul>
</li>
<li>
<p><strong>SSE 事件流</strong></p>
<ul>
<li>订阅实时事件</li>
<li>跟踪执行进度</li>
<li>接收代理响应</li>
</ul>
</li>
<li>
<p><strong>执行计划时间线</strong></p>
<ul>
<li>可视化展示执行步骤</li>
<li>追踪代理行为</li>
<li>调试和分析</li>
</ul>
</li>
<li>
<p><strong>权限请求处理</strong></p>
<ul>
<li>代理权限请求弹窗</li>
<li>用户授权控制</li>
<li>安全执行保障</li>
</ul>
</li>
<li>
<p><strong>工作流模板</strong></p>
<ul>
<li>保存常用工作流</li>
<li>一键重复执行</li>
<li>团队共享模板</li>
</ul>
</li>
<li>
<p><strong>技能管理器</strong></p>
<ul>
<li>安装新技能</li>
<li>导入自定义技能</li>
<li>管理已安装技能</li>
</ul>
</li>
</ol>
<h3 data-id="heading-15">项目优势</h3>
<p>与其他 AI 工作台工具相比，OpenWork 的优势：</p>



























































<table><thead><tr><th align="left">对比项</th><th align="left">OpenWork</th><th align="left">Claude Cowork</th><th align="left">其他开源方案</th></tr></thead><tbody><tr><td align="left"><strong>开源程度</strong></td><td align="left">完全开源（MIT）</td><td align="left">闭源商业</td><td align="left">部分开源</td></tr><tr><td align="left"><strong>本地运行</strong></td><td align="left">原生支持</td><td align="left">云端为主</td><td align="left">部分支持</td></tr><tr><td align="left"><strong>MCP 支持</strong></td><td align="left">原生支持</td><td align="left">支持</td><td align="left">有限支持</td></tr><tr><td align="left"><strong>技能系统</strong></td><td align="left">完整</td><td align="left">完整</td><td align="left">简单</td></tr><tr><td align="left"><strong>跨平台</strong></td><td align="left">macOS/Win/Linux</td><td align="left">Web为主</td><td align="left">各异</td></tr><tr><td align="left"><strong>可组合性</strong></td><td align="left">高（多模态）</td><td align="left">中</td><td align="left">低</td></tr><tr><td align="left"><strong>定制能力</strong></td><td align="left">高（源码可改）</td><td align="left">低</td><td align="left">中</td></tr><tr><td align="left"><strong>价格</strong></td><td align="left">免费</td><td align="left">付费订阅</td><td align="left">免费/部分付费</td></tr></tbody></table>
<p><strong>为什么选择 OpenWork？</strong></p>
<ul>
<li>✅ <strong>完全开源</strong>：MIT 许可，自由使用和修改</li>
<li>✅ <strong>本地优先</strong>：数据隐私有保障</li>
<li>✅ <strong>MCP 原生</strong>：完整的协议支持</li>
<li>✅ <strong>多模态支持</strong>：桌面、Web、CLI 随心选择</li>
<li>✅ <strong>技能生态</strong>：丰富的技能管理能力</li>
<li>✅ <strong>社区活跃</strong>：9.2k+ Stars，持续更新</li>
</ul>
<hr/>
<h2 data-id="heading-16">项目详细剖析</h2>
<h3 data-id="heading-17">架构设计</h3>
<p>OpenWork 采用 Tauri + React 架构，实现跨平台桌面应用：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────┐
│                    USER INTERFACE                        │
│  🖥️ Desktop App (Tauri Window)                          │
│  🌐 Web UI (React)                                      │
│  💬 Chat Connectors (WhatsApp, etc.)                   │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│               APPLICATION LAYER                          │
│  📝 Session Management                                  │
│  🔧 Skill Manager                                       │
│  📊 Execution Timeline                                  │
│  🔐 Permission Handler                                  │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                 CORE ENGINE                              │
│  ⚙️ OpenCode CLI Integration                            │
│  📡 SSE Event Stream                                    │
│  🔌 MCP Protocol Handler                                │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│              RUNTIME LAYER                               │
│  🦀 Rust/Tauri (Desktop Runtime)                        │
│  📦 Node<span class="hljs-selector-class">.js</span> (Server Runtime)                            │
└─────────────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────┐
│                  INTEGRATIONS                            │
│  🤖 AI Providers (Claude, OpenAI, etc.)                │
│  🔌 MCP Servers                                         │
│  📁 Local File System                                   │
└─────────────────────────────────────────────────────────┘
</code></pre>
<p><strong>核心组件</strong>：</p>
<ol>
<li><strong>用户界面层</strong>：Tauri 桌面窗口 + React Web UI</li>
<li><strong>应用层</strong>：会话管理、技能管理、执行时间线、权限处理</li>
<li><strong>核心引擎</strong>：OpenCode CLI 集成、SSE 事件流、MCP 协议处理</li>
<li><strong>运行时层</strong>：Rust/Tauri（桌面）+ Node.js（服务器）</li>
<li><strong>集成层</strong>：AI 提供商、MCP 服务器、本地文件系统</li>
</ol>
<h3 data-id="heading-18">核心模块分析</h3>
<h4 data-id="heading-19">1. OpenCode 集成</h4>
<p>OpenWork 由 OpenCode CLI 驱动，提供核心 AI 代理能力：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>执行 AI 代理任务</li>
<li>管理代理生命周期</li>
<li>处理代理输入输出</li>
</ul>
<p><strong>特点</strong>：</p>
<ul>
<li>可以脱离 UI 独立运行</li>
<li>支持命令行直接调用</li>
<li>提供完整的代理能力</li>
</ul>
<h4 data-id="heading-20">2. 技能管理器（Skill Manager）</h4>
<p>OpenWork 提供完整的技能管理功能：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>浏览和安装新技能</li>
<li>导入自定义技能</li>
<li>管理已安装技能</li>
<li>启用/禁用技能</li>
</ul>
<p><strong>技能类型</strong>：</p>
<ul>
<li>代码生成技能</li>
<li>文件操作技能</li>
<li>数据处理技能</li>
<li>自定义扩展技能</li>
</ul>
<h4 data-id="heading-21">3. 会话管理（Session Management）</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>创建新会话</li>
<li>管理多个并行会话</li>
<li>实时发送提示</li>
<li>查看会话历史</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>每个会话独立运行</li>
<li>支持会话间切换</li>
<li>保存会话状态</li>
</ul>
<h4 data-id="heading-22">4. MCP 协议支持</h4>
<p>OpenWork 原生支持 Model Context Protocol：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>连接 MCP 服务器</li>
<li>调用 MCP 工具</li>
<li>管理 MCP 资源</li>
</ul>
<p><strong>应用场景</strong>：</p>
<ul>
<li>扩展 AI 代理能力</li>
<li>集成外部工具</li>
<li>访问外部数据源</li>
</ul>
<h4 data-id="heading-23">5. SSE 事件流</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>实时订阅执行事件</li>
<li>跟踪代理执行进度</li>
<li>接收代理响应</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>Server-Sent Events 协议</li>
<li>实时推送更新</li>
<li>低延迟响应</li>
</ul>
<h3 data-id="heading-24">技术栈详解</h3>
<p>OpenWork 使用现代化的技术栈：</p>
<p><strong>前端/界面</strong>：</p>
<ul>
<li><strong>TypeScript</strong> (72.1%)：主要编程语言</li>
<li><strong>React</strong>：UI 框架</li>
<li><strong>JavaScript</strong> (12.9%)：辅助脚本</li>
</ul>
<p><strong>桌面运行时</strong>：</p>
<ul>
<li><strong>Tauri</strong>：跨平台桌面框架</li>
<li><strong>Rust</strong> (9.1%)：Tauri 核心运行时</li>
</ul>
<p><strong>构建工具</strong>：</p>
<ul>
<li><strong>pnpm</strong>：包管理和工作区管理</li>
<li><strong>Node.js</strong>：JavaScript 运行时</li>
</ul>
<p><strong>为什么选择这个技术栈？</strong></p>





























<table><thead><tr><th align="left">技术</th><th align="left">选择理由</th></tr></thead><tbody><tr><td align="left">Tauri</td><td align="left">比 Electron 更轻量，安全性更好</td></tr><tr><td align="left">TypeScript</td><td align="left">类型安全，开发体验好</td></tr><tr><td align="left">React</td><td align="left">成熟的生态，组件化开发</td></tr><tr><td align="left">Rust</td><td align="left">高性能，内存安全</td></tr><tr><td align="left">pnpm</td><td align="left">高效的包管理，支持 monorepo</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-25">实际使用案例</h2>
<h3 data-id="heading-26">案例1：本地开发环境</h3>
<p><strong>场景</strong>：在本地搭建 AI 辅助开发环境。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆并启动 OpenWork</span>
git <span class="hljs-built_in">clone</span> https://github.com/different-ai/openwork.git
<span class="hljs-built_in">cd</span> openwork
pnpm install
pnpm dev

<span class="hljs-comment"># 2. 在桌面应用中创建新会话</span>

<span class="hljs-comment"># 3. 安装需要的技能（如代码生成技能）</span>

<span class="hljs-comment"># 4. 开始与 AI 代理交互</span>
</code></pre>
<p><strong>效果</strong>：在本地拥有完整的 AI 代理工作台，无需云服务，数据完全本地化。</p>
<h3 data-id="heading-27">案例2：团队共享服务器</h3>
<p><strong>场景</strong>：为团队搭建共享的 AI 代理服务器。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 在服务器上启动 OpenWork（主机模式）</span>
pnpm dev:ui  <span class="hljs-comment"># 或使用 openwrk CLI</span>

<span class="hljs-comment"># 2. 团队成员使用客户端模式连接</span>
<span class="hljs-comment"># 在 OpenWork 中选择"Client Mode"</span>
<span class="hljs-comment"># 输入服务器地址连接</span>

<span class="hljs-comment"># 3. 共享技能和工作流模板</span>

<span class="hljs-comment"># 4. 团队成员可以协作使用相同的 AI 代理</span>
</code></pre>
<p><strong>效果</strong>：团队共享 AI 代理资源，统一管理技能和工作流，提高协作效率。</p>
<h3 data-id="heading-28">案例3：MCP 集成工作流</h3>
<p><strong>场景</strong>：通过 MCP 协议扩展 AI 代理能力。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 启动 OpenWork</span>

<span class="hljs-comment"># 2. 配置 MCP 服务器连接</span>
<span class="hljs-comment"># 在设置中添加 MCP 服务器地址</span>

<span class="hljs-comment"># 3. AI 代理自动获得 MCP 工具能力</span>

<span class="hljs-comment"># 4. 在会话中使用 MCP 提供的工具</span>
</code></pre>
<p><strong>效果</strong>：AI 代理能力大幅扩展，可以访问数据库、文件系统、外部 API 等。</p>
<h3 data-id="heading-29">案例4：自动化工作流</h3>
<p><strong>场景</strong>：创建自动化工作流处理重复性任务。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 在 OpenWork 中创建会话</span>

<span class="hljs-comment"># 2. 执行一系列操作完成任务</span>

<span class="hljs-comment"># 3. 将工作流保存为模板</span>

<span class="hljs-comment"># 4. 后续一键执行相同工作流</span>
</code></pre>
<p><strong>效果</strong>：重复性任务自动化执行，节省时间和精力。</p>
<hr/>
<h2 data-id="heading-30">项目地址与资源</h2>
<h3 data-id="heading-31">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork" target="_blank" title="https://github.com/different-ai/openwork" ref="nofollow noopener noreferrer">github.com/different-a…</a></li>
<li>📦 <strong>Releases</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdifferent-ai%2Fopenwork%2Freleases" target="_blank" title="https://github.com/different-ai/openwork/releases" ref="nofollow noopener noreferrer">下载页面</a></li>
</ul>
<h3 data-id="heading-32">相关项目</h3>
<ul>
<li><strong>OpenCode</strong>: OpenWork 的核心引擎</li>
<li><strong>Owpenbot</strong>: WhatsApp 集成</li>
<li><strong>Openwrk</strong>: CLI 主机模式</li>
</ul>
<hr/>
<h2 data-id="heading-33">适用人群</h2>
<p>OpenWork 适合以下人群：</p>
<h3 data-id="heading-34">1. 开发者</h3>
<ul>
<li>✅ 需要本地 AI 代理环境的开发者</li>
<li>✅ 对 Claude Cowork 感兴趣但不想付费的用户</li>
<li>✅ 需要定制化 AI 工作流的技术人员</li>
</ul>
<h3 data-id="heading-35">2. 团队用户</h3>
<ul>
<li>✅ 需要共享 AI 代理资源的团队</li>
<li>✅ 希望统一管理技能和工作流的组织</li>
<li>✅ 对数据隐私有要求的企业</li>
</ul>
<h3 data-id="heading-36">3. AI 爱好者</h3>
<ul>
<li>✅ 对 MCP 协议感兴趣</li>
<li>✅ 希望探索 AI 代理技术</li>
<li>✅ 喜欢尝试开源工具</li>
</ul>
<h3 data-id="heading-37">4. 隐私敏感用户</h3>
<ul>
<li>✅ 需要完全本地化运行</li>
<li>✅ 不希望数据上传云端</li>
<li>✅ 需要在离线环境使用</li>
</ul>
<hr/>
<h2 data-id="heading-38">总结</h2>
<p>OpenWork 是一个出色的开源 AI 代理工作台，它成功地将 Claude Cowork 的核心功能带入开源世界。通过"本地优先，云端就绪"的设计理念，它让用户可以完全掌控自己的 AI 工作流。</p>
<p><strong>项目亮点回顾</strong>：</p>
<ul>
<li>🖥️ <strong>开源替代品</strong>：Claude Cowork 的免费开源替代方案</li>
<li>🏠 <strong>本地优先</strong>：数据完全由用户掌控</li>
<li>🔌 <strong>MCP 协议支持</strong>：原生支持 Model Context Protocol</li>
<li>🧩 <strong>可组合架构</strong>：桌面应用、Web、CLI 多模态支持</li>
<li>⚡ <strong>技能管理器</strong>：完整的技能安装和管理功能</li>
<li>🌐 <strong>跨平台</strong>：基于 Tauri 支持多平台</li>
<li>🔓 <strong>可"弹出"</strong>：甚至无需 UI 也能通过命令行工作</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>本地 AI 代理开发环境</li>
<li>团队共享 AI 工作台</li>
<li>MCP 协议集成工作流</li>
<li>自动化任务处理</li>
<li>隐私敏感的 AI 应用</li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[彻底搞懂跨域：前后端分离架构下的成因剖析与最优解决方案]]></title>    <link>https://juejin.cn/post/7604984549173379081</link>    <guid>https://juejin.cn/post/7604984549173379081</guid>    <pubDate>2026-02-10T09:55:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604984549173379081" data-draft-id="7604984549173264393" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="彻底搞懂跨域：前后端分离架构下的成因剖析与最优解决方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T09:55:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大鹏1988"/> <meta itemprop="url" content="https://juejin.cn/user/2526022571922992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            彻底搞懂跨域：前后端分离架构下的成因剖析与最优解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2526022571922992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大鹏1988
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:55:24.000Z" title="Tue Feb 10 2026 09:55:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Web 开发中，“前后端分离”已成为主流架构模式：前端（React/Vue 等）通过 HTTP API 与后端（Node.js/Java/Go 等）交互。然而，这种解耦也带来了高频问题——<strong>跨域（CORS）错误</strong>。开发者常被浏览器控制台中的 <code>Blocked by CORS policy</code> 困扰。本文将系统梳理跨域的<strong>根本原因、常见场景</strong>，并给出<strong>生产环境推荐的最优解决方案</strong>。</p>
<hr/>
<h2 data-id="heading-0">一、什么是“跨域”？为什么浏览器要限制它？</h2>
<h3 data-id="heading-1">1. 同源策略（Same-Origin Policy）</h3>
<p>浏览器出于安全考虑，限制一个源（Origin）的脚本如何与另一个源的资源进行交互。</p>
<blockquote>
<p><strong>同源 = 协议 + 域名 + 端口 完全一致</strong><br/>
例如：<code>https://app.example.com:443</code> 与 <code>http://app.example.com</code>（协议不同）、<code>https://api.example.com</code>（子域名不同）、<code>https://app.example.com:8080</code>（端口不同）均属于<strong>跨域</strong>。</p>
</blockquote>
<h3 data-id="heading-2">2. 跨域 ≠ 请求失败</h3>
<ul>
<li><strong>请求其实发出去了</strong>！但浏览器在收到响应后，若发现不符合 CORS 规则，会<strong>拦截响应数据</strong>，不让前端 JavaScript 读取。</li>
<li>这是<strong>浏览器的安全机制</strong>，服务器本身不受影响（可用 Postman 直接调通）。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、前后端分离项目中跨域的常见原因</h2>



































<table><thead><tr><th>场景</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td><strong>开发环境本地调试</strong></td><td>前端 <code>localhost:3000</code> → 后端 <code>localhost:8080</code></td><td>端口不同，触发跨域</td></tr><tr><td><strong>测试/预发环境分离部署</strong></td><td>前端 <code>test-fe.example.com</code> → 后端 <code>test-api.example.com</code></td><td>子域名不同</td></tr><tr><td><strong>API 网关未正确透传头</strong></td><td>请求经 Nginx 转发，但未处理 <code>Origin</code> 和 CORS 头</td><td>导致后端无法识别跨域请求</td></tr><tr><td><strong>前端携带凭证（credentials）但后端未允许</strong></td><td><code>fetch</code> 设置 <code>credentials: 'include'</code>，但后端未设 <code>Access-Control-Allow-Credentials: true</code></td><td>浏览器拒绝响应</td></tr><tr><td><strong>自定义请求头未被允许</strong></td><td>前端发送 <code>X-Token: abc</code>，但后端未在 <code>Access-Control-Allow-Headers</code> 中声明</td><td>触发预检（Preflight）失败</td></tr></tbody></table>
<blockquote>
<p>⚠️ 注意：<strong>简单请求（如 GET/POST + JSON）可能不触发预检，但带自定义头、非标准 Content-Type（如 application/json）等会触发 OPTIONS 预检请求</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">三、跨域解决方案全景图</h2>
<h3 data-id="heading-5">❌ 不推荐方案（仅限开发）</h3>





















<table><thead><tr><th>方案</th><th>问题</th></tr></thead><tbody><tr><td><strong>禁用浏览器安全策略</strong>（如 Chrome 启动加 <code>--disable-web-security</code>）</td><td>仅本地测试可用，无法解决生产问题，且危险</td></tr><tr><td><strong>JSONP</strong></td><td>仅支持 GET，无错误处理，安全性差，已淘汰</td></tr><tr><td><strong>代理插件（如 CORS Unblock）</strong></td><td>用户不可控，仅调试用</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">四、最优解决方案：服务端正确配置 CORS</h2>
<p><strong>核心原则：跨域问题应在服务端解决，而非绕过。</strong></p>
<h3 data-id="heading-7">1. 后端设置 CORS 响应头（以 Node.js/Express 为例）</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 使用 cors 中间件（推荐）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">cors</span> = <span class="hljs-keyword">require</span>(<span class="hljs-string">'cors'</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">corsOptions</span> = {
  origin: [<span class="hljs-string">'https://app.example.com'</span>, <span class="hljs-string">'https://admin.example.com'</span>], <span class="hljs-comment">// 明确指定可信源</span>
  credentials: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许携带 Cookie/认证头</span>
  optionsSuccessStatus: <span class="hljs-number">200</span>
};

app.<span class="hljs-keyword">use</span>(<span class="hljs-title function_ invoke__">cors</span>(corsOptions));
</code></pre>
<blockquote>
<p>✅ <strong>关键点</strong>：</p>
<ul>
<li><strong>不要设 <code>origin: '*'</code></strong> ！若需携带凭证（如 Cookie），<code>*</code> 会导致失败。</li>
<li><strong>生产环境必须白名单化</strong>可信前端域名。</li>
</ul>
</blockquote>
<h3 data-id="heading-8">2. 手动设置 CORS 头（通用）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 预检请求（OPTIONS）响应</span>
<span class="hljs-string">HTTP/1.1</span> <span class="hljs-number">200</span> <span class="hljs-string">OK</span>
<span class="hljs-attr">Access-Control-Allow-Origin:</span> <span class="hljs-string">https://app.example.com</span>
<span class="hljs-attr">Access-Control-Allow-Credentials:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">Access-Control-Allow-Methods:</span> <span class="hljs-string">GET,</span> <span class="hljs-string">POST,</span> <span class="hljs-string">PUT,</span> <span class="hljs-string">DELETE,</span> <span class="hljs-string">OPTIONS</span>
<span class="hljs-attr">Access-Control-Allow-Headers:</span> <span class="hljs-string">Content-Type,</span> <span class="hljs-string">Authorization,</span> <span class="hljs-string">X-Token</span>
<span class="hljs-attr">Access-Control-Max-Age:</span> <span class="hljs-number">86400</span>  <span class="hljs-comment"># 预检结果缓存 24 小时</span>

<span class="hljs-comment"># 实际请求响应</span>
<span class="hljs-attr">Access-Control-Allow-Origin:</span> <span class="hljs-string">https://app.example.com</span>
<span class="hljs-attr">Access-Control-Allow-Credentials:</span> <span class="hljs-literal">true</span>
</code></pre>
<h3 data-id="heading-9">3. Nginx 层统一处理 CORS（适合多后端服务）</h3>
<pre><code class="hljs language-bash" lang="bash">location /api/ {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request_method</span> = <span class="hljs-string">'OPTIONS'</span>) {
        add_header <span class="hljs-string">'Access-Control-Allow-Origin'</span> <span class="hljs-string">'https://app.example.com'</span>;
        add_header <span class="hljs-string">'Access-Control-Allow-Credentials'</span> <span class="hljs-string">'true'</span>;
        add_header <span class="hljs-string">'Access-Control-Allow-Methods'</span> <span class="hljs-string">'GET, POST, PUT, DELETE, OPTIONS'</span>;
        add_header <span class="hljs-string">'Access-Control-Allow-Headers'</span> <span class="hljs-string">'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-Token'</span>;
        add_header <span class="hljs-string">'Access-Control-Max-Age'</span> 86400;
        add_header <span class="hljs-string">'Content-Length'</span> 0;
        add_header <span class="hljs-string">'Content-Type'</span> <span class="hljs-string">'text/plain; charset=utf-8'</span>;
        <span class="hljs-built_in">return</span> 204;
    }

    <span class="hljs-comment"># 代理到后端</span>
    proxy_pass http://backend;
    proxy_set_header Host <span class="hljs-variable">$host</span>;
    proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;

    <span class="hljs-comment"># 实际响应也需加 CORS 头</span>
    add_header <span class="hljs-string">'Access-Control-Allow-Origin'</span> <span class="hljs-string">'https://app.example.com'</span> always;
    add_header <span class="hljs-string">'Access-Control-Allow-Credentials'</span> <span class="hljs-string">'true'</span> always;
}
</code></pre>
<blockquote>
<p>💡 <strong>优势</strong>：集中管理，避免每个微服务重复配置。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">五、前端配合最佳实践</h2>
<ul>
<li>
<p><strong>明确请求是否需要凭证</strong>：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 如需发送 Cookie</span>
<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">'/api/user'</span>, {
  <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span> // 对应后端 Access-Control-Allow-<span class="hljs-attr">Credentials</span>: <span class="hljs-literal">true</span>
});
</code></pre>
</li>
<li>
<p><strong>避免随意添加自定义头</strong>：如非必要，不要加 <code>X-xxx</code> 头，减少预检开销。</p>
</li>
<li>
<p><strong>使用相对路径或环境变量管理 API 地址</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env.development</span>
<span class="hljs-attr">VITE_API_BASE</span> = <span class="hljs-string">"http://localhost:8080"</span>

<span class="hljs-comment"># .env.production</span>
<span class="hljs-attr">VITE_API_BASE</span> = <span class="hljs-string">"/api"</span>  <span class="hljs-comment"># 配合 Nginx 反向代理</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">六、终极推荐架构：开发用代理，生产用同源</h2>
<h3 data-id="heading-12">开发阶段：前端 Dev Server 代理（无跨域）</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// vite.config.js (Vite)</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  server: {
    proxy: {
      <span class="hljs-string">'/api'</span>: {
        target: <span class="hljs-string">'http://localhost:8080'</span>,
        changeOrigin: <span class="hljs-literal">true</span>,
        secure: <span class="hljs-literal">false</span>
      }
    }
  }
}
</code></pre>
<p>→ 前端请求 <code>/api/user</code> 实际转发到 <code>http://localhost:8080/api/user</code>，<strong>浏览器认为是同源</strong>。</p>
<h3 data-id="heading-13">生产阶段：Nginx 反向代理（同源部署）</h3>
<pre><code class="hljs language-bash" lang="bash">server {
  listen 443 ssl;
  server_name app.example.com;

  <span class="hljs-comment"># 前端静态资源</span>
  location / {
    root /dist;
    try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
  }

  <span class="hljs-comment"># API 代理到后端（同域名，无跨域）</span>
  location /api/ {
    proxy_pass http://backend-cluster;
  }
}
</code></pre>
<p>→ 用户访问 <code>https://app.example.com/api/user</code>，<strong>前端与 API 同源</strong>，彻底规避 CORS。</p>
<blockquote>
<p>✅ <strong>这是大型项目最推荐的方式：开发靠代理，生产靠反向代理，全程无跨域烦恼。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-14">结语</h2>
<p>跨域不是“bug”，而是浏览器安全模型的正常行为。理解其原理，才能从根本上解决。<strong>最优路径 = 开发阶段用前端代理 + 生产环境用 Nginx 反向代理 + 后端兜底 CORS 白名单</strong>。</p>
<p>记住：永远不要为了“快速解决”而牺牲安全性（如 <code>origin: *</code> + credentials）。真正的工程素养，是在便利与安全之间找到平衡点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent skills 工程实践：为什么“抽取公共层”在传统软件设计里是美德，在 Agents & Skills 里却经常变成毒药？]]></title>    <link>https://juejin.cn/post/7604853010171265065</link>    <guid>https://juejin.cn/post/7604853010171265065</guid>    <pubDate>2026-02-10T10:02:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604853010171265065" data-draft-id="7604793276907929663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent skills 工程实践：为什么“抽取公共层”在传统软件设计里是美德，在 Agents &amp; Skills 里却经常变成毒药？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T10:02:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcr_stephen"/> <meta itemprop="url" content="https://juejin.cn/user/2427345905409885"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent skills 工程实践：为什么“抽取公共层”在传统软件设计里是美德，在 Agents &amp; Skills 里却经常变成毒药？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2427345905409885/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcr_stephen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:02:03.000Z" title="Tue Feb 10 2026 10:02:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在搭建基于大模型的 Agent 系统时，踩了一个非常典型的坑，也因此和 Grok 深入聊了几轮，意外发现这个话题其实戳中了很多人在 Agent 工程化过程中的共鸣痛点。</p>
<p>简单一句话总结：</p>
<p><strong>传统软件设计追求 DRY（Don't Repeat Yourself），把通用逻辑抽到公共层，让具体模块保持轻量；<br/>
但在 LLM Agent + Skills 的世界里，过度抽取到公共层（比如 agents.md 的系统提示）反而会导致遵守率暴跌、焦点丢失，甚至严重干扰原本很明确的 Skill 逻辑。</strong></p>
<p>下面用一个真实的业务场景来说明这个反直觉的现象，以及为什么会这样，以及目前最务实的应对方式。</p>
<h2 data-id="heading-0">场景：订单异常处理的 Skill 集群</h2>
<p>假设我们有一个订单异常处理的 Agent，需要处理多种异常类型（超时未发货、重复扣款、地址异常、库存负数……），每种异常对应一个 Skill。</p>
<p><strong>最初的实现方式（传统软件思维）</strong></p>
<p>每个 Skill 里都有一段几乎一模一样的登录逻辑：</p>
<pre><code class="hljs language-text" lang="text"># Skill: 超时未发货处理
1. 登录 SQL 工单平台（账号：xxx，密码：yyy，两步验证，session 保持，错误重试 3 次）
2. 查询订单表，筛选超时订单
3. 生成工单并提交
</code></pre>
<p>重复代码太多 → 抽取！
于是我们把登录相关规则全部挪到 agents.md（全局系统提示）的最前面：</p>
<h2 data-id="heading-1">全局规则 - 工单平台操作规范</h2>
<p>任何涉及 SQL 工单平台、数据库查询、工单提交的操作，必须严格遵守以下登录流程：</p>
<ol>
<li>使用账号 xxx / 密码 yyy</li>
<li>完成两步验证</li>
<li>保持 session 有效，若失效则重试 3 次</li>
<li>登录失败时抛出明确错误，不得继续执行后续步骤</li>
<li>业务订单的背景知识
...</li>
</ol>
<p>看起来 DRY 了，优雅了。</p>
<h3 data-id="heading-2">然后问题来了：遵守率崩了</h3>
<ul>
<li>简单 Skill（只有登录 + 一件事）还算正常</li>
<li>稍微复杂一点的 Skill（多步查询 + 判断 + 写工单 + 通知）就开始各种“失忆”：
** 直接跳过登录就去查表
** 用错账号/环境
** 在第 7 步突然想起来要登录，于是插入一个不合时宜的步骤
** 甚至把登录规则当成“背景知识”而不是“必须执行的第一步”</li>
</ul>
<p>最讽刺的是：把登录规则放回每个 Skill 开头后，效果立刻恢复，甚至比原来更好。</p>
<h2 data-id="heading-3">为什么会出现“越抽象越差”？</h2>
<p>核心原因其实和大模型的注意力机制、上下文优先级、指令跟随偏好高度相关：</p>
<p>1.注意力稀释 &amp; Recency Bias</p>
<p>全局规则放在 prompt 最前面，当 Skill 本身很长时，后面的具体指令会占据模型绝大部分注意力。
前面的规则逐渐变成“背景噪声”，模型“知道有这个规则，但不觉得现在要用”。</p>
<ol start="2">
<li>缺乏强触发锚点</li>
</ol>
<p>放在 agents.md 里的规则是静态声明，没有和“当前 Skill”强绑定。
而原来每个 Skill 里写一遍，等于把“先登录”这件事放在了当前上下文最显眼的位置，触发强度完全不同。</p>
<ol start="3">
<li>噪声累积 &amp; 焦点漂移</li>
</ol>
<p>复杂 Skill 本身已经塞了很多业务逻辑、分支、格式要求。
再叠加几百 token 的公共规则，整体上下文变“脏”，模型容易在无关细节上纠结，或者直接跳过某些步骤。</p>
<ol start="4">
<li>当前 LLM 的指令忠诚度规律</li>
</ol>
<p>模型对 局部、显式、重复出现 的指令遵守度，远高于 全局、抽象、只出现一次 的规则。
这和传统软件的 DRY 原则几乎完全相反。</p>
<p>一句话：在 LLM prompting 里，DRY 经常是反模式，尤其是对那些需要严格顺序的流程性任务。</p>
<h2 data-id="heading-4">目前社区和实践中最有效的应对策略</h2>





















































<table><thead><tr><th>优先级</th><th>做法</th><th>适用场景</th><th>重复度</th><th>遵守率提升</th><th>维护成本</th></tr></thead><tbody><tr><td>★★★★★</td><td>每个相关 Skill 开头显式写 3-5 行核心登录指令（“必须先完成登录，使用 xxx 账号……”）</td><td>当前大多数中小型系统</td><td>中</td><td>最高</td><td>最低</td></tr><tr><td>★★★★☆</td><td>agents.md 只保留最弱约束（“涉及工单/数据库操作前，确保已登录”），具体细节放 Skill 里</td><td>想尽量减少重复</td><td>低</td><td>高</td><td>低</td></tr><tr><td>★★★☆☆</td><td>把“登录”做成独立 Tool（login_sql），Skill 里强制写“第一步：call login_sql tool”</td><td>Skill 数量多、流程标准化</td><td>无</td><td>很高</td><td>中</td></tr><tr><td>★★☆☆☆</td><td>代码层动态注入：在生成 Skill prompt 时自动插入登录段落</td><td>使用代码生成/模板化 Skill</td><td>无</td><td>高</td><td>中</td></tr><tr><td>★☆☆☆☆</td><td>多轮 / 子 Agent 拆分：登录交给基础设施 Agent，业务 Skill 只接收已登录状态</td><td>超大型系统</td><td>无</td><td>最高</td><td>高</td></tr></tbody></table>
<h3 data-id="heading-5">最务实的起步建议：</h3>
<p>先挑 2-3 个最常出问题的复杂 Skill，把 agents.md 里的登录相关全部删掉，只在这些 Skill 开头手动加回简洁的登录指令。
跑几轮相同 case 对比，你会明显看到“干扰消失、准确率回升”。</p>
<h2 data-id="heading-6">总结</h2>
<p>传统软件设计：把通用部分抽到公共层，让具体实现保持轻量 → 美德</p>
<p>LLM Agent 工程：把关键步骤抽到公共层，往往让具体 Skill 失去焦点 → 毒药</p>
<p>在当前大模型的能力阶段，宁可局部重复，也别让关键动作被全局规则稀释掉。</p>
<p>等未来模型的上下文窗口更大、长上下文理解能力更强、或者有更好的“全局记忆”机制，这个规律可能会变。</p>
<p>但至少在 2025-2026 年，这几乎是 Agent 工程实践里最硬的一条经验教训。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[踩坑小记之闭包陷阱]]></title>    <link>https://juejin.cn/post/7604984549173395465</link>    <guid>https://juejin.cn/post/7604984549173395465</guid>    <pubDate>2026-02-10T09:55:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604984549173395465" data-draft-id="7604889577937272859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="踩坑小记之闭包陷阱"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2026-02-10T09:55:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="正是江南好时节"/> <meta itemprop="url" content="https://juejin.cn/user/66441912532215"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            踩坑小记之闭包陷阱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/66441912532215/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    正是江南好时节
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:55:36.000Z" title="Tue Feb 10 2026 09:55:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><h2 data-id="heading-0">问题背景</h2>
<p>在页面中，用户可以通过表格中的开关（Switch）组件快速切换计划的启用/禁用状态。系统的预期行为是：</p>
<ul>
<li>点击第一行的开关从"开启"切换到"关闭"</li>
<li>立即点击第二行的开关从"关闭"切换到"开启"</li>
<li>预期结果：第一行变关闭，第二行变开启</li>
</ul>
<p>但实际发生的问题是：<strong>两行的开关状态会变成一样</strong>，要么都变成开启，要么都变成关闭。</p>
<h3 data-id="heading-1">问题现象</h3>
<p>这个问题在<strong>刷新页面后首次操作时必现</strong>，尤其是在以下场景：</p>
<ol>
<li>用户快速连续点击多行的状态开关</li>
<li>点击第一行后，在接口请求还未返回时，立即点击第二行</li>
<li>两个请求基本同时发出</li>
</ol>
<h2 data-id="heading-2">技术实现（错误版本）</h2>
<h3 data-id="heading-3">原始代码</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/page/UpgradePlan/index.js</span>

<span class="hljs-keyword">const</span> [appList, setAppList] = <span class="hljs-title function_">useState</span>([]) <span class="hljs-comment">// 表格数据列表</span>

<span class="hljs-comment">/**
 * 处理计划状态变更
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">record</span> - 当前行数据
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">newStatus</span> - 新状态值 ('ACTIVE' 或 'INACTIVE')
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePlanStatusChange</span> = (<span class="hljs-params">record, newStatus</span>) =&gt; {
  <span class="hljs-comment">// ❌ 问题代码：基于闭包捕获的 appList</span>
  <span class="hljs-keyword">const</span> updatedList = appList.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">planId</span> === record.<span class="hljs-property">planId</span>) {
      <span class="hljs-keyword">return</span> {
        ...item,
        <span class="hljs-attr">planStatus</span>: newStatus,
      }
    }
    <span class="hljs-keyword">return</span> item
  })
  <span class="hljs-title function_">setAppList</span>(updatedList)
}
</code></pre>
<h3 data-id="heading-4">表格状态渲染</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/page/UpgradePlan/UpgradePlanTable.js</span>

<span class="hljs-keyword">const</span> columns = [
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'计划状态'</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'planStatus'</span>,
    <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span>,
    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">text, record</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Switch</span>
          <span class="hljs-attr">checked</span>=<span class="hljs-string">{text</span> === <span class="hljs-string">'ACTIVE'</span> ? <span class="hljs-attr">true</span> <span class="hljs-attr">:</span> <span class="hljs-attr">false</span>}
          <span class="hljs-attr">checkedChildren</span>=<span class="hljs-string">"开启"</span>
          <span class="hljs-attr">unCheckedChildren</span>=<span class="hljs-string">"关闭"</span>
          <span class="hljs-attr">loading</span>=<span class="hljs-string">{loadingPlanIds.has(record.planId)}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{checked</span> =&gt;</span> {
            handlePlanStatusChange(checked, record, text)
          }}
        /&gt;</span>
      )
    },
  },
  <span class="hljs-comment">// ... 其他列</span>
]
</code></pre>
<h2 data-id="heading-5">问题根源分析</h2>
<h3 data-id="heading-6">1. 闭包陷阱</h3>
<p>这是一个经典的 <strong>React 状态闭包问题</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 每次 handlePlanStatusChange 执行时，appList 都是被闭包捕获的"旧值"</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePlanStatusChange</span> = (<span class="hljs-params">record, newStatus</span>) =&gt; {
  <span class="hljs-keyword">const</span> updatedList = appList.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {  <span class="hljs-comment">// appList 来自闭包，可能已过时</span>
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">planId</span> === record.<span class="hljs-property">planId</span>) {
      <span class="hljs-keyword">return</span> { ...item, <span class="hljs-attr">planStatus</span>: newStatus }
    }
    <span class="hljs-keyword">return</span> item
  })
  <span class="hljs-title function_">setAppList</span>(updatedList)
}
</code></pre>
<h3 data-id="heading-7">2. 执行流程演示</h3>
<p>假设初始状态：</p>
<pre><code class="hljs language-arduino" lang="arduino">appList = [
  { planId: <span class="hljs-number">1</span>, planStatus: <span class="hljs-string">'ACTIVE'</span> },   <span class="hljs-comment">// 第一行：开启</span>
  { planId: <span class="hljs-number">2</span>, planStatus: <span class="hljs-string">'INACTIVE'</span> }  <span class="hljs-comment">// 第二行：关闭</span>
]
</code></pre>
<p><strong>快速点击两行的执行流程：</strong></p>
<pre><code class="hljs language-css" lang="css">时刻 T0: 初始 appList = [{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'ACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'INACTIVE'</span>}]

时刻 T1: 用户点击第一行开关 (ACTIVE → INACTIVE)
         └─ 调用 <span class="hljs-built_in">handlePlanStatusChange</span>(record1, <span class="hljs-string">'INACTIVE'</span>)
         └─ 函数内捕获的 appList 仍是 T0 时刻的值
         └─ updatedList = [{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'INACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'INACTIVE'</span>}]
         └─ setAppList(updatedList)  // 开始异步更新

时刻 T2: 用户立即点击第二行开关 (INACTIVE → ACTIVE)  [此时第一个更新还未完成]
         └─ 调用 <span class="hljs-built_in">handlePlanStatusChange</span>(record2, <span class="hljs-string">'ACTIVE'</span>)
         └─ 函数内捕获的 appList 仍是 T0 时刻的值 ⚠️ 关键问题！
         └─ updatedList = [{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'ACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'ACTIVE'</span>}]
         └─ setAppList(updatedList)  // 这个更新会覆盖 T1 的更新

时刻 T3: React 处理状态更新
         └─ 第二个 setAppList 覆盖了第一个
         └─ 最终结果：[{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'ACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'ACTIVE'</span>}]
         └─ ❌ 第一行的状态变更丢失了！
</code></pre>
<h3 data-id="heading-8">3. 问题本质</h3>
<ul>
<li><strong>闭包捕获过时值</strong>：<code>handlePlanStatusChange</code> 函数体内的 <code>appList</code> 是在函数定义时捕获的，不是执行时的最新值</li>
<li><strong>异步状态更新</strong>：两个 <code>setAppList</code> 调用都会加入 React 的更新队列，但都基于同一时刻的旧状态快照</li>
<li><strong>后者覆盖前者</strong>：第二个 <code>setAppList</code> 执行时，会用包含过时数据的 <code>updatedList</code> 覆盖第一个的更新</li>
</ul>
<h2 data-id="heading-9">改正措施</h2>
<h3 data-id="heading-10">解决方案：使用函数式状态更新</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 改正后的代码</span>

<span class="hljs-comment">/**
 * 处理计划状态变更
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">record</span> - 当前行数据
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">newStatus</span> - 新状态值
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePlanStatusChange</span> = (<span class="hljs-params">record, newStatus</span>) =&gt; {
  <span class="hljs-comment">// ✅ 使用函数式更新，prevAppList 始终是最新的状态</span>
  <span class="hljs-title function_">setAppList</span>(<span class="hljs-function"><span class="hljs-params">prevAppList</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> prevAppList.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">planId</span> === record.<span class="hljs-property">planId</span>) {
        <span class="hljs-keyword">return</span> {
          ...item,
          <span class="hljs-attr">planStatus</span>: newStatus,
        }
      }
      <span class="hljs-keyword">return</span> item
    })
  })
}
</code></pre>
<h3 data-id="heading-11">改正后的执行流程</h3>
<pre><code class="hljs language-css" lang="css">时刻 T0: 初始 appList = [{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'ACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'INACTIVE'</span>}]

时刻 T1: 用户点击第一行开关 (ACTIVE → INACTIVE)
         └─ 调用 <span class="hljs-built_in">setAppList</span>(prevAppList =&gt; {...})
         └─ prevAppList = T0 时刻的值
         └─ updatedList = <span class="hljs-selector-attr">[{id:1, status:<span class="hljs-string">'INACTIVE'</span>}, {id:2, status:<span class="hljs-string">'INACTIVE'</span>}]</span>
         └─ 加入更新队列

时刻 T2: 用户立即点击第二行开关 (INACTIVE → ACTIVE)
         └─ 调用 <span class="hljs-built_in">setAppList</span>(prevAppList =&gt; {...})
         └─ ⚠️ 但此时 prevAppList = T1 更新后的值！
         └─ prevAppList = <span class="hljs-selector-attr">[{id:1, status:<span class="hljs-string">'INACTIVE'</span>}, {id:2, status:<span class="hljs-string">'INACTIVE'</span>}]</span>
         └─ 只更新 id:<span class="hljs-number">2</span>，保留 id:<span class="hljs-number">1</span> 的状态
         └─ updatedList = [{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'INACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'ACTIVE'</span>}]
         └─ 加入更新队列

时刻 T3: React 处理状态更新（批处理）
         └─ 先执行 T1 的更新
         └─ 再执行 T2 的更新（基于 T1 的结果）
         └─ 最终结果：[{id:<span class="hljs-number">1</span>, status:<span class="hljs-string">'INACTIVE'</span>}, {id:<span class="hljs-number">2</span>, status:<span class="hljs-string">'ACTIVE'</span>}]
         └─ ✅ 两行状态都正确！
</code></pre>
<h2 data-id="heading-12">关键区别对比</h2>
<h3 data-id="heading-13">❌ 错误方式：直接访问闭包变量</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePlanStatusChange</span> = (<span class="hljs-params">record, newStatus</span>) =&gt; {
  <span class="hljs-comment">// appList 是闭包捕获的，在快速连续调用时是同一时刻的值</span>
  <span class="hljs-keyword">const</span> updatedList = appList.<span class="hljs-title function_">map</span>(...)
  <span class="hljs-title function_">setAppList</span>(updatedList)
}
</code></pre>
<p><strong>问题：</strong></p>
<ul>
<li>多次快速调用时，所有调用都基于同一时刻的 <code>appList</code></li>
<li>后面的调用会覆盖前面的结果</li>
<li>状态变更会丢失</li>
</ul>
<h3 data-id="heading-14">✅ 正确方式：函数式状态更新</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePlanStatusChange</span> = (<span class="hljs-params">record, newStatus</span>) =&gt; {
  <span class="hljs-comment">// prevAppList 参数由 React 提供，始终是最新的状态</span>
  <span class="hljs-title function_">setAppList</span>(<span class="hljs-function"><span class="hljs-params">prevAppList</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> prevAppList.<span class="hljs-title function_">map</span>(...)
  })
}
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>React 保证每次调用时，<code>prevAppList</code> 都是最新的状态</li>
<li>多次快速调用时，每次都基于前一次更新的结果</li>
<li>状态更新会正确链式执行</li>
<li>充分利用 React 的批处理机制</li>
</ul>
<h2 data-id="heading-15">深入理解</h2>
<h3 data-id="heading-16">React 状态更新的本质</h3>
<p>React 的状态更新机制：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React 内部维护的更新队列</span>
<span class="hljs-keyword">const</span> updateQueue = []

<span class="hljs-comment">// 当调用 setAppList(newValue) 时</span>
<span class="hljs-title function_">setAppList</span>(newValue) 
  <span class="hljs-comment">// React 会加入队列</span>
  updateQueue.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'direct'</span>, <span class="hljs-attr">value</span>: newValue })

<span class="hljs-comment">// 当调用 setAppList(prevValue =&gt; newValue) 时</span>
<span class="hljs-title function_">setAppList</span>(<span class="hljs-function"><span class="hljs-params">prevValue</span> =&gt;</span> newValue)
  <span class="hljs-comment">// React 会记录更新函数，并在需要时执行</span>
  updateQueue.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'function'</span>, <span class="hljs-attr">fn</span>: <span class="hljs-function">(<span class="hljs-params">prevValue</span>) =&gt;</span> newValue })
</code></pre>
<p><strong>批处理时</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 直接值更新（会被覆盖）</span>
<span class="hljs-title function_">setAppList</span>(value1)  <span class="hljs-comment">// → queue: [{ type: 'direct', value: value1 }]</span>
<span class="hljs-title function_">setAppList</span>(value2)  <span class="hljs-comment">// → queue: [{ type: 'direct', value: value2 }] 覆盖前一个</span>
<span class="hljs-comment">// 最终结果：只有 value2 生效</span>

<span class="hljs-comment">// ✅ 函数式更新（会链式执行）</span>
<span class="hljs-title function_">setAppList</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> <span class="hljs-title function_">newValue1</span>(prev))  <span class="hljs-comment">// → queue: [fn1]</span>
<span class="hljs-title function_">setAppList</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> <span class="hljs-title function_">newValue2</span>(prev))  <span class="hljs-comment">// → queue: [fn1, fn2]</span>
<span class="hljs-comment">// 执行：fn1(initialState) → state1</span>
<span class="hljs-comment">//     fn2(state1) → state2</span>
<span class="hljs-comment">// 最终结果：两个更新都生效</span>
</code></pre>
<h2 data-id="heading-17">应用场景</h2>
<p>这个问题常见于以下场景：</p>
<ol>
<li><strong>列表行操作</strong>：快速切换表格中多行的状态</li>
<li><strong>表单快速提交</strong>：连续提交多个表单项</li>
<li><strong>购物车操作</strong>：快速添加/删除多个商品</li>
<li><strong>批量操作</strong>：连续执行多个列表项的操作</li>
</ol>
<h2 data-id="heading-18">总结</h2>
<h3 data-id="heading-19">核心要点</h3>






























<table><thead><tr><th>项目</th><th>错误方式</th><th>正确方式</th></tr></thead><tbody><tr><td><strong>方式</strong></td><td><code>setAppList(updatedList)</code></td><td><code>setAppList(prev =&gt; updatedList(prev))</code></td></tr><tr><td><strong>状态来源</strong></td><td>闭包捕获的旧值</td><td>React 提供的最新值</td></tr><tr><td><strong>快速操作</strong></td><td>后面的调用覆盖前面的</td><td>链式执行，都生效</td></tr><tr><td><strong>适用场景</strong></td><td>单次更新</td><td>多次连续更新</td></tr></tbody></table>
<h3 data-id="heading-20">最佳实践</h3>
<p><strong>在 React 中更新状态时，如果新状态依赖于旧状态，始终使用函数式更新：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 推荐写法（避免闭包陷阱）</span>
<span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prevState</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    ...prevState,
    <span class="hljs-comment">// 基于 prevState 的更新</span>
  }
})

<span class="hljs-comment">// ❌ 避免（容易踩坑）</span>
<span class="hljs-title function_">setState</span>({
  ...state,
  <span class="hljs-comment">// 基于当前 state 的更新</span>
})
</code></pre>
<h2 data-id="heading-21">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseState%23updating-state-based-on-the-previous-state" target="_blank" title="https://react.dev/reference/react/useState#updating-state-based-on-the-previous-state" ref="nofollow noopener noreferrer">React 官方文档 - 函数式更新</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FClosures" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures" ref="nofollow noopener noreferrer">JavaScript 闭包 - MDN</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2021%2F06%2F08%2Fthe-next-major-version-of-react" target="_blank" title="https://react.dev/blog/2021/06/08/the-next-major-version-of-react" ref="nofollow noopener noreferrer">React 批处理机制</a></li>
</ul>
<hr/>
<p><strong>教训：</strong> 在 React 中处理依赖于前一状态的更新时，永远优先考虑使用函数式状态更新，这是避免闭包陷阱最直接有效的方法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1篇搞懂AI通识:大白话拆解核心点]]></title>    <link>https://juejin.cn/post/7605051978871537683</link>    <guid>https://juejin.cn/post/7605051978871537683</guid>    <pubDate>2026-02-10T10:11:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871537683" data-draft-id="7605051978871472147" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1篇搞懂AI通识:大白话拆解核心点"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-10T10:11:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1篇搞懂AI通识:大白话拆解核心点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:11:49.000Z" title="Tue Feb 10 2026 10:11:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 AI 技术从实验室走向日常，“机器学习”“大模型”“Transformer”“MOE” 等词汇已不再是技术圈的专属。从智能聊天助手到电商推荐，从语音识别到自动驾驶，AI 正以多元形态融入生活。这篇文章按 “基础→核心→优化→落地→工具→术语” 的逻辑，用最通俗的大白话，把 AI 通识技术点讲透，希望帮助大家建立更完整的 AI 认知框架，理解技术背后的核心逻辑与实际价值，“看透” AI 技术的底层逻辑，让复杂概念变得清晰易懂。</p>
<h2 data-id="heading-0">一、基础概念（搞懂AI的底层逻辑）</h2>
<h3 data-id="heading-1">1. 什么是 AI（人工智能）？</h3>
<p>AI 本质就是 “让机器像人一样思考、干活” 的技术体系——不用人一步步指挥，机器能自己学规律、做决策。比如手机人脸识别、聊天机器人、自动驾驶，都是 AI 的具体应用。它不是单一技术，而是一堆技术的 “总称”，就像 “家电” 包含冰箱、电视一样。这张网上流行的图概述了人工智能（AI）随着时间推移的发展历程，从早期阶段到机器学习、深度学习以及大型语言模型（LLM）的出现。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f511f348c13483ea5ecd4f5bf17048b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=1Q%2FVUauJfTmtTN5YNe60MXWoSgg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">2. 什么是机器学习、强化学习、深度学习，它们的关系？</h3>
<p>这仨是 AI 的 “核心方法论”，是 “大圈套小圈” 的关系：</p>
<p>机器学习：AI 的 “基础学习法”—— 让机器像 “学生刷题”，从数据里自己找规律（比如看 1000 张猫的照片，自己总结 “尖耳朵 = 猫”），不用人逐条教规则。</p>
<p>深度学习：机器学习的 “高级版”—— 给机器配了 “多层思考大脑”（神经网络），能分层挖数据的深层规律（比如先看猫的轮廓，再看细节，最后判断），适合处理图片、长文本等复杂任务。</p>
<p>强化学习：机器学习的 “特训法”—— 让机器像 “宠物学技能”，做对了给奖励（赢棋加分），做错了给惩罚（输棋扣分），反复试错后优化策略，比如 AI 玩游戏、下围棋都靠它。</p>
<p>关系总结：机器学习是 “总方法”，深度学习是 “高级分支”，强化学习是 “训练技巧”，三者常搭配使用（比如 ChatGPT 用深度学习架构，靠强化学习优化回答）。</p>
<h3 data-id="heading-3">3. 机器学习三大范式</h3>
<p>范式就是 “教机器干活的具体方式”，核心区别是 “给不给机器‘标准答案’”（标准答案叫 “标签”，比如 “这张是猫”）：</p>
<p>补充：强化学习也常被单独列为一类，核心是 “靠奖励 / 惩罚试错学习”。</p>
<h3 data-id="heading-4">4. 什么是神经网络？</h3>
<p>神经网络是深度学习的 “核心骨架”，模仿人脑神经元的连接方式，本质是 “按层排列的小计算单元集合”，像 “工厂流水线”：</p>
<p>输入层：“原材料入口”—— 接收原始数据（比如图片像素、文字）；</p>
<p>隐藏层：“核心加工车间”—— 层数越多，深度学习越 “深”，负责一步步提取数据特征（从轮廓到细节）；</p>
<p>输出层：“成品出口”—— 输出最终结果（比如 “这是猫”“翻译结果”）。</p>
<p>每个 “小计算单元”（神经元）就像 “小计算器”，筛选有用信息、弱化无用信息，训练模型就是调整这些单元的 “工作规则”，让它越来越精准。</p>
<h3 data-id="heading-5">5. 为什么深度学习要 “深”？</h3>
<p>“深” 指神经网络的 “隐藏层多”，不是为了凑数，而是为了 “挖深层规律”：</p>
<p>1层网络（浅）：只能看表面信息（比如图片的像素颜色），分不清猫和狗；</p>
<p>3层网络（中深）：第 1 层看 “边缘 / 明暗”→第 2 层拼 “耳朵 / 圆形轮廓”→第3层判断 “尖耳朵 = 猫、圆形 = 球”；</p>
<p>10层以上网络（深）：能分层提取特征（先轮廓→再细节→再逻辑），比如识别 “小狗在追蝴蝶”，能看懂 “动作” 和 “场景”。</p>
<p>简单说：“深” 的本质是 “分层提取特征”：从表面的 “像素 / 文字”，挖到深层的 “逻辑 / 场景”；任务越复杂（写小说、解数学题），越需要 “深” 网络，才能从表面数据挖到核心逻辑。</p>
<h3 data-id="heading-6">6. 什么是预训练？</h3>
<p>预训练就是给大模型 “打基础”—— 用海量通用数据（比如几百万本书、网页）让模型先学 “通用知识”（语法、常识、逻辑），相当于让学生先读完小学到大学的通识课程，具备基本能力。</p>
<p>预训练后的模型就像 “有基础的学霸”，不用再从零学起，后续只需针对性培训（微调），就能适配具体任务（比如当客服、写代码）。</p>
<h3 data-id="heading-7">7. 什么是大模型 LLM？</h3>
<p>LLM 是 “大语言模型” 的缩写，核心是 “用超大神经网络，学海量文字数据，能像人一样理解和生成语言”—— 通俗说就是 “读过全世界书的超级学霸”。</p>
<p>“大” 体现在三点：</p>
<p>参数量大：相当于 “学霸的脑细胞多”，能存更多知识（比如 GPT-4 有万亿级参数）；</p>
<p>数据量多：相当于 “学霸读的书多”，覆盖书籍、论文、网页等，知识渊博；</p>
<p>能力全：能聊天、写文案、解数学题、编代码，不用专门训练。</p>
<h3 data-id="heading-8">8. 什么是多模态大模型？</h3>
<p>“模态” 就是 AI 能处理的 “信息类型”（文字、图片、语音、视频），多模态大模型就是 “全能选手”—— 能同时处理多种信息：</p>
<p>比如你发一张风景照，它能描述内容、配诗，还能把诗读出来；</p>
<p>常见例子：GPT-4V、文心一言多模态版，能看图片、听语音、写文字。</p>
<h2 data-id="heading-9">二、核心架构与机制（AI的底层骨架）</h2>
<h3 data-id="heading-10">1. 传统架构与演进：什么是 RNN/LSTM/GRU？</h3>
<p>在 Transformer 出现前，处理文字、语音等 “序列数据”（有先后顺序的数据）靠这些架构：</p>
<p>RNN：“逐字处理” 的架构 —— 像读文章逐字念，只能记住最近的信息，处理长文本会 “忘事”（比如读 1000 字文章，后面忘了前面）；</p>
<p>LSTM/GRU：RNN 的 “升级版”—— 加了 “记忆单元”，能记住更多长距离信息，但效率还是低，处理超长文本仍吃力。</p>
<p>这些架构是 AI 的 “老基建”，现在主流大模型已不用，但了解它们能更好理解 Transformer 的创新。</p>
<h3 data-id="heading-11">2. 现代大模型基石：什么是 Transformer 架构？</h3>
<p>Transformer 架构是一种以 “并行计算 + 自注意力机制” 为核心的神经网络结构，能高效捕捉数据（如文字）间的关联关系，是现代大模型（如 ChatGPT、DeepSeek）的基础骨架。2017 年由 Google 提出，是大模型 “高效运行” 的关键—— 决定了模型能跑多快、处理多长文本、效果多好，彻底解决了传统架构的痛点：</p>
<p>核心创新：“并行计算 + 注意力机制”—— 不用逐字处理，能同时分析多个关键词，还能记住词与词的关系，又快又准。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cc6dce334b3473cbe6f0f90d623a8c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=GvbaCOvGI6G3nQzEzyooJmg%2B6nY%3D" alt="image.png" loading="lazy"/></p>
<p>核心结构：分 “编码器（Encoder）” 和 “解码器（Decoder）”—— 编码器负责 “理解信息”（比如读文章），解码器负责 “生成信息”（比如写文章）；</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5b89021437b485c9889391197e8d7ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=3v7d1p%2F5F7zTsy9XjhZm2mi3KCA%3D" alt="image.png" loading="lazy"/></p>
<p>简单说，Transformer 架构就是让 AI 能同时看懂文字间的关联、还能快速处理长文本的 “高效大脑骨架”～。</p>
<h3 data-id="heading-12">3. 什么是位置编码？</h3>
<p>Transformer 架构本身 “不认识文字顺序”—— 如果不加位置编码，机器会把 “我打你” 和 “你打我” 当成一回事。位置编码的核心作用是 “标记文字的先后顺序”，让机器理解语序逻辑。</p>
<p>通俗解释</p>
<p>比如处理句子 “小明吃苹果”：位置编码给 “小明” 贴 “1 号”、“吃” 贴 “2 号”、“苹果” 贴 “3 号”；</p>
<p>机器看到标签后，就知道 “1 号（小明）做 2 号（吃）动作，对象是 3 号（苹果）”，不会搞反逻辑；</p>
<p>注意：位置编码不是简单的 1、2、3，而是用特殊数字编码，让机器同时理解 “相邻词关系更近”（如 “吃” 和 “小明”“苹果” 的关系比 “小明” 和 “苹果” 更近）。</p>
<p>核心作用</p>
<p>位置编码解决了 “语序混乱” 的问题，让机器能正确理解 “主谓宾”“先后顺序” 等语言逻辑，是处理文本任务的关键小技巧。</p>
<h3 data-id="heading-13">4. 语义理解引擎：什么是注意力模型、自注意力机制、多头注意力？</h3>
<p>这仨是 Transformer 的 “核心能力”，本质是让机器 “抓重点、理关系”：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e8797654bc340519d4126e1bf4df52f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=eyBYUfVLnIKfxgeiNmAcJ%2F8HDuo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-14">5. 注意力优化升级：什么是 MLA、NSA 和代理注意力？</h3>
<p>普通注意力机制处理长文本（比如 10 万字报告）时，会 “内存不够、跑不动”，这三个是 “优化版”，核心是 “省资源、提效率”：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dabc383c785437ab85c4f543b3485da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=1v4aBIvWdtG2PVDsS3Vjfb%2BTK8s%3D" alt="image.png" loading="lazy"/></p>
<p>三者的核心思路都是 “抓大放小”，在不影响理解效果的前提下，通过压缩信息、减少计算量，实现长文本的高效处理。</p>
<h3 data-id="heading-15">6. 生成逻辑差异：什么是自回归生成与非自回归生成？</h3>
<p>大模型生成文字的两种核心方式：</p>
<p>自回归生成：“逐字写”—— 像人写字一样，写完一个字再写下一个，能保证逻辑连贯，ChatGPT、DeepSeek 都用这种；</p>
<p>非自回归生成：“同时写多个字”—— 效率高，但容易逻辑混乱，适合对速度要求高、对连贯性要求低的场景（比如简单翻译）。</p>
<h2 data-id="heading-16">三、模型优化与适配技术（让AI更实用、更易部署）</h2>
<h3 data-id="heading-17">1. 什么是 MOE 混合专家架构？</h3>
<p>MOE（Mixture of Experts）即混合专家架构，核心是让 “专业的人干专业的事”—— 模型里有多个 “专家模块”，每个模块只擅长一个领域，处理任务时只激活相关专家，既省算力又高效。主要结构拆解如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2230c2a778d439aa366a1514fc7052e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=d1WbNcZfJzgEgUxZGR2uCxMAwzk%3D" alt="image.png" loading="lazy"/></p>
<p>1）专家模块：不同科室的医生，每个专家只擅长一个领域（如 “代码专家” 专做编程，“数学专家” 专解难题，“中文专家” 专处理诗词和对话）；</p>
<p>2）门控网络：医院导诊台，输入任务后先 “判断任务类型”（如 “怎么写 Python 代码” 属于编程任务）；接收输入任务后，通过计算判断任务类型，筛选出最适合处理该任务的 1-2 个专家模块；</p>
<p>3）高效协作：只叫醒需要的专家，不会让无关专家参与（如编程任务只激活 “代码专家”，不打扰 “数学专家”）。</p>
<p>实际案例：DeepSeek-V3 的 MOE 架构</p>
<p>总参数量：6710 亿（相当于 256 个专家模块）；</p>
<p>激活数量：处理任务时只激活 370 亿参数（8 个专家模块）；</p>
<p>优势：算力浪费少，训练成本仅为传统模型的 1/3，处理任务速度更快。</p>
<h3 data-id="heading-18">2. 什么是数据并行、模型并行、张量并行？</h3>
<p>大模型参数量太大（比如万亿级），单台电脑装不下、训不动，这三种是 “分工训练” 的方式：</p>
<p>数据并行：多台电脑 “一起练不同批次的数据”—— 比如甲练第 1-100 条，乙练第 101-200 条，最后汇总经验；</p>
<p>模型并行：多台电脑 “各负责模型的一部分”—— 比如甲负责输入层，乙负责隐藏层，分工协作；</p>
<p>张量并行：把模型的 “计算任务拆分”—— 比如一个复杂计算拆成 3 份，3 台电脑同时算，加快速度。</p>
<h3 data-id="heading-19">3. 什么是量化、知识蒸馏、剪枝？</h3>
<p>大模型原本 “笨重”（需超大内存），这三种是 “给模型瘦身” 的技术，让它能装在普通电脑、手机上：</p>
<p>量化：把模型里的 “精准数字简化”—— 比如 “1.23456” 改成 “1.23”，像把 4K 照片转成清晰缩略图，体积变小但核心信息不变；</p>
<p>知识蒸馏：让 “小模型学大模型的本事”—— 大模型像 “教授”，小模型像 “学生”，学生学教授的核心知识，体积变小 10 倍仍保精度；</p>
<p>剪枝：给模型 “删无用部分”—— 去掉模型里没用的参数（比如很少用到的 “小计算单元”），让它更轻巧。</p>
<h3 data-id="heading-20">4. 什么是模型压缩？</h3>
<p>就是把量化、蒸馏、剪枝等技术 “打包使用”，综合给模型瘦身，比如把 10GB 的大模型压缩到 1GB，适配手机、智能手表等资源受限设备。</p>
<h3 data-id="heading-21">5. 什么是模型微调（Fine-tuning）？</h3>
<p>微调就是给 “有基础的 AI 学霸” 做 “岗前培训”—— 预训练模型已经会通用知识（会说话、懂常识），微调时用少量专项数据（比如公司客服对话），教它做具体事：</p>
<p>流程：通用大模型→输入专项数据→训练几天→输出专项模型（比如客服 AI）；</p>
<p>优势：省数据、省时间，不用从零训练；学完专项技能后，仍会聊天、算数学题等通用能力。</p>
<h3 data-id="heading-22">6. 什么是 LoRA、QLoRA？</h3>
<p>普通微调仍需要不少算力，这俩是 “轻量级微调” 技术：</p>
<p>核心逻辑：不改变大模型的核心参数，只给它加 “小插件”（少量新参数），教插件专项技能；</p>
<p>优势：用普通电脑就能做，成本低、速度快，适合中小企业和个人。</p>
<h3 data-id="heading-23">7. 什么是领域自适应（Domain Adaptation）？</h3>
<p>让大模型 “适配特定行业”—— 比如给通用大模型喂医疗数据，让它学会看病历、答医疗问题；喂金融数据，让它懂股票、基金，成为行业专用模型。</p>
<h3 data-id="heading-24">8. 什么是 RLHF（人类反馈强化学习）？</h3>
<p>让模型的输出 “符合人类偏好”—— 比如模型回答后，人给打分（好 / 不好），再用这些分数训练模型，让它越来越懂 “人喜欢什么样的回答”（比如更礼貌、更精准）。</p>
<h3 data-id="heading-25">9. 什么是 RAG、KAG？</h3>
<p>解决大模型 “知识过时、不懂专业领域” 的问题：</p>
<p>RAG（检索增强生成）：AI “开卷考试”—— 回答问题前，先从外部知识库（比如公司文档、最新新闻）查相关信息，再结合自己的知识生成答案，比如问 “2025 年最新政策”，它会先查 2025 年的资料；</p>
<p>KAG（知识增强生成）：AI “把知识点记牢再答题”—— 预训练时就把结构化知识（比如百科词条、行业术语）融入模型，不用临时查，适合回答固定常识（比如 “牛顿三大定律”）。</p>
<h3 data-id="heading-26">10. 什么是事实核查（Fact-checking）？</h3>
<p>减少大模型 “胡说八道”（幻觉）的技术 —— 模型生成答案后，自动核对事实（比如查资料确认 “北京到上海的距离”），纠正错误信息，让回答更靠谱。</p>
<h3 data-id="heading-27">11. 什么是对齐（Alignment）与安全护栏（Safety Guardrails）？</h3>
<p>对齐：让模型的目标和人类一致 —— 比如不生成有害内容、不撒谎；</p>
<p>安全护栏：给模型 “设禁区”—— 禁止生成暴力、歧视等有害内容，确保使用安全。</p>
<h2 data-id="heading-28">四、典型模型与生态实践（从理论到应用）</h2>
<h3 data-id="heading-29">1. 主流大模型分类与代表</h3>
<p>通用大模型：能应对多种任务，比如 GPT 系列（OpenAI）、文心一言（百度）、Llama 系列（Meta）、通义千问（阿里）、Qwen（阿里云）；</p>
<p>垂直领域大模型：专注某一行业，比如医疗大模型（看病历、辅助诊断）、法律大模型（查法条、写合同）、编程大模型（DeepSeek-Coder、GitHub Copilot）。</p>
<h3 data-id="heading-30">2. 典型创新案例：DeepSeek 的核心创新点</h3>
<p>DeepSeek 的核心创新围绕 “高效、低成本、高适配” 展开，通过架构优化、训练方法创新等，实现了 “用更少资源做出高性能模型” 的目标，让大模型更易普及。</p>
<p>核心创新点：</p>
<p>高效架构设计：MOE+MLA结合混合专家架构（MOE）和多头潜在注意力（MLA），6710 亿总参数量仅激活 370 亿参数处理任务，同时通过 MLA 压缩长文本信息，支持 12 万字长文本处理，算力成本降低 70% 以上。</p>
<p>低成本训练技术：强化学习 + 知识蒸馏采用 GRPO 强化学习算法，无需大量人工标注数据，通过 “试错反馈” 优化模型推理能力；结合动态知识蒸馏技术，将大模型能力迁移至小模型，体积减少 40% 仍保持精度，训练成本仅为 GPT-4 的 1/18。</p>
<p>高适配性部署：多场景 + 轻量化推出通用模型、编程模型（DeepSeek-Coder）、推理模型（DeepSeek-R1）等系列产品，适配不同场景；支持本地、云端、边缘设备部署，普通 GPU 即可运行，企业可快速集成到金融、教育、医疗等行业。</p>
<p>强推理能力：分步思考机制基于强化学习实现 “分步推理”，模型处理数学、编程等复杂任务时，会像人类一样拆解步骤、逐步求解，准确率比肩 OpenAI o1 系列。</p>
<h3 data-id="heading-31">3. 部署形态：云端、边缘、本地部署</h3>
<p>云端部署：模型存在远程服务器上，通过网络使用（比如 ChatGPT 网页版），不用自己装；</p>
<p>本地部署：把模型装在自己的电脑、服务器上，离线也能用，适合注重数据隐私的场景；</p>
<p>边缘部署：把模型装在边缘设备上（比如手机、智能摄像头），响应快、不占网络带宽。</p>
<h2 data-id="heading-32">五、常用工具与交互技术（高效用AI）</h2>
<h3 data-id="heading-33">1. 什么是提示工程（Prompt Engineering）？</h3>
<p>就是 “教 AI 怎么说话”—— 通过优化输入指令（提示词），让 AI 输出符合预期的结果：</p>
<p>比如只说 “写旅游攻略”，效果一般；但说 “写一篇适合亲子家庭的北京 3 日游攻略，含景点、餐饮、交通，语言简洁”，结果更精准；</p>
<p>核心：指令清晰、逻辑明确，帮 AI 懂你的需求。</p>
<h3 data-id="heading-34">2. 关于提示学习中的思维链、自洽性和思维树？</h3>
<p>一句话总结：</p>
<p>思维链：让 AI “会写步骤”；</p>
<p>自洽性：让 AI “会查答案”；</p>
<p>思维树：让 AI“会拆难题、选思路”；都是为了让 AI 的回答更靠谱，只是简单问题用思维链，易出错问题加自洽性，复杂问题用思维树～</p>
<p>三者对比</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43abe069b0e24a4e87c8db6d70f57bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771323212&amp;x-signature=OpxJV25sIG2h9NEoxDYbhF1W64g%3D" alt="image.png" loading="lazy"/></p>
<p>举例：</p>
<p>1）用思维树（ToT）拆问题：把大题拆成 3 个小题，每个小题想 2 种解法；</p>
<p>2）用思维链（CoT）写步骤：每个解法都写详细推导；</p>
<p>3）用自洽性验证：每个小题的 2 种解法结果一致，再汇总大题答案。</p>
<ol start="3">
<li>什么是少样本 / 零样本提示？
提示工程的 “进阶技巧”：</li>
</ol>
<p>少样本提示：给 AI “几个例子”—— 比如让它翻译方言，先给 2 个 “方言→普通话” 的例子，它就会模仿；</p>
<p>零样本提示：不给例子，直接让 AI 做任务 —— 比如让它写一首诗，全靠它自己的知识。</p>
<h2 data-id="heading-35">六、高频术语（读懂AI文档的关键词）</h2>
<ol>
<li>
<p>Token：AI 处理文字的 “最小单位”—— 中文是单个字或词语（比如 “我 / 爱 / AI”），英文是单词或词根，模型能处理的 Token 数量决定了文本长度（比如 4096 个 Token 约 3000 中文字）；</p>
</li>
<li>
<p>标签（Label）：数据的 “标准答案”，比如 “这张是猫”；</p>
</li>
<li>
<p>批次（Batch）：训练时一次喂给模型的数据量（比如一次喂 32 条文本）；</p>
</li>
<li>
<p>训练步长（Step）：模型处理一批数据 + 调整一次参数，算 1 个 Step（衡量训练进度）；</p>
</li>
<li>
<p>轮次（Epoch）：把所有训练数据完整学一遍，算 1 个 Epoch（比如 10 万条数据，每批 32 条，约 3125 个 Step=1 个 Epoch）。</p>
</li>
<li>
<p>上下文（Context）：AI 的 “聊天记忆”—— 记住之前的对话内容，比如你先问 “北京天气”，再问 “穿什么”，AI 知道你指北京；</p>
</li>
<li>
<p>上下文窗口（Context Window）：AI 能记住的 “对话长度上限”—— 比如 4096 个 Token 窗口，超过就会忘前面的内容；</p>
</li>
<li>
<p>多轮对话（Multi-turn Conversation）：和 AI 聊好几轮（比如问问题→追更→再问），AI 能连贯回应；</p>
</li>
<li>
<p>Agent（AI 智能体）：“有自主能力的 AI 助手”—— 不用你一步步指挥，能自己理解任务、用工具、解决问题（比如让它规划旅游，自己查景点、订酒店）；</p>
</li>
<li>
<p>A2A（Agent-to-Agent）：A2A是谷歌公开的一个协议，它能够实现不同的Agent之间能够实现直接互通，让智能体之间能够协作起来解决多任务的问题；A2A是让多个Agent能够连接起来，形成一个能力更加强大的Agent，解决多个Agent的通信效率问题。简单说就是多个 AI 智能体 “协作干活”—— 比如一个查资料、一个写文案、一个校对，合力完成复杂任务。</p>
</li>
<li>
<p>幻觉（Hallucination）：AI “胡说八道”—— 编造不存在的事实（比如假新闻、假数据）。</p>
</li>
<li>
<p>MCP（模型上下文协议）：MCP（Model Context Protocol）即 “模型上下文协议”，简单说就是AI 聊天的 “记忆管理规则”—— 规定能记多少轮对话、优先保留什么信息，确保连贯又省内存。MCP让所有的API、工具、数据源能够按照统一的协议通信，只要按此规范，这些工具都可以被开发者直接调用；MCP解决了搭建单个Agent的效率问题，让搭建单个Agent的效率变得更高。</p>
</li>
<li>
<p>AGI（通用人工智能）：AI 的 “终极目标”—— 具备人类级智慧，能做任何人类能做的事（做饭、编程、科研），目前还在理论阶段；</p>
</li>
<li>
<p>ASI（超级人工智能）：比人类智慧还强的 AI，目前仅存在于设想中。</p>
</li>
</ol>
<h2 data-id="heading-36">七、结语</h2>
<p>AI技术的核心逻辑可概括为 “从数据找规律到落地实用” 的递进过程，本质简洁且层层聚焦：</p>
<p>核心是让机器从数据中学习规律 —— 机器学习是基础 “找规律”，深度学习是 “多层递进找规律”，大模型则是 “海量数据 + 多层架构” 的高效找规律。具体通过四层实现：</p>
<p>1）基础层：机器学习让机器 “从数据中找规律”，神经网络是实现这一目标的 “骨架”；</p>
<p>2）进阶层：Transformer 架构 + 注意力机制让机器 “高效找规律、记重点”，解决长文本、高难度任务；</p>
<p>3）优化层：量化、蒸馏、微调、MOE 等技术让机器 “变小、变快、变便宜”，适配更多场景；</p>
<p>4）应用层：大模型（如 ChatGPT、DeepSeek）是最终成果，直接服务于日常聊天、办公、编程等需求。</p>
<p>这篇文章覆盖 AI 全链路知识，从基础概念到架构、优化技术、落地应用及术语，希望能在此找到自己需要的内容。而学习 AI 的关键，正如 Transformer 架构的逻辑 —— 先掌握整体全貌与基本原理，再层层深入剖析细节.....</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React学习-setState、useState]]></title>    <link>https://juejin.cn/post/7604766431227002920</link>    <guid>https://juejin.cn/post/7604766431227002920</guid>    <pubDate>2026-02-10T10:20:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604766431227002920" data-draft-id="7605042125298221090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React学习-setState、useState"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-02-10T10:20:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="web_bee"/> <meta itemprop="url" content="https://juejin.cn/user/428665740231"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React学习-setState、useState
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/428665740231/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    web_bee
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:20:31.000Z" title="Tue Feb 10 2026 10:20:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">setState</h2>
<p>语法：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">this</span>.setState(updater, [callback])
</code></pre>
<p>写法总结：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 语法：this.setState({ newState })</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
​
<span class="hljs-comment">// 推荐使用，尤其是状态更新依赖于前一次状态时。它可以接收当前 state 和 props</span>
<span class="hljs-comment">// 语法：this.setState((state, props) =&gt; { return { newState } })</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">state, props</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>
}));
​
<span class="hljs-comment">// 在 setState 更新完成并重新渲染界面后执行，可确保获取到最新状态</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> }, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'更新后的状态:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span>);
});
</code></pre>
<h3 data-id="heading-1">特性：</h3>
<ul>
<li><strong><code>setState</code> 是异步的</strong>：React 会将多个 <code>setState</code> 调用合并（batch）成一次更新，以提升性能。</li>
<li>在<strong>事件处理函数</strong>（如 onClick）中，<code>setState</code> 是批量的。</li>
<li>在<strong>原生事件、setTimeout、Promise 等异步上下文</strong>中，<code>setState</code> 可能不会自动批处理（但在 React 18+ 中已改进），可能表现为`同步状态。</li>
</ul>
<blockquote>
<p>⚠️ 注意：React 18 开始，无论在哪里调用 <code>setState</code>，默认都会自动批处理（automatic batching）。</p>
</blockquote>
<h3 data-id="heading-2">底层原理（React 16+ Fiber 架构）</h3>
<ul>
<li>调用 <code>setState</code> 会触发 <code>enqueueSetState</code>。</li>
<li>React 将更新放入一个<strong>更新队列（Update Queue）</strong> ，并标记该 Fiber 节点为“需要更新”。</li>
<li>在<strong>渲染阶段（render phase）</strong> ，React 会遍历 Fiber 树，收集所有待更新的节点。</li>
<li>在<strong>提交阶段（commit phase）</strong> ，应用 DOM 更新并触发副作用（如生命周期方法）。</li>
</ul>
<blockquote>
<p>关键点：<code>setState</code> 并不立即修改 <code>this.state</code>，而是创建一个更新对象（update object），由 React 调度器（Scheduler）决定何时处理。</p>
</blockquote>
<h2 data-id="heading-3">useState</h2>
<p>它允许你向组件添加一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Flearn%2Fstate-a-components-memory" target="_blank" title="https://zh-hans.react.dev/learn/state-a-components-memory" ref="nofollow noopener noreferrer">状态变量</a>，语法：</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[state, setState]</span> = <span class="hljs-built_in">useState</span>(initialState)
</code></pre>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Freference%2Freact%2FuseState%23reference" target="_blank" title="https://zh-hans.react.dev/reference/react/useState#reference" ref="nofollow noopener noreferrer">参考</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Freference%2Freact%2FuseState%23usestate" target="_blank" title="https://zh-hans.react.dev/reference/react/useState#usestate" ref="nofollow noopener noreferrer"><code>useState(initialState)</code></a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Freference%2Freact%2FuseState%23setstate" target="_blank" title="https://zh-hans.react.dev/reference/react/useState#setstate" ref="nofollow noopener noreferrer"><code>set</code> 函数，例如 <code>setSomething(nextState)</code></a></li>
</ul>
</li>
</ul>
<p>它没有回调函数；</p>
<h3 data-id="heading-4">特性：</h3>
<ul>
<li>和 <code>setState</code> 一样，<code>useState</code> 的 <code>setXXX</code> 也是<strong>异步且批量更新</strong>的。</li>
<li>React 18 后，在任何上下文中（包括 setTimeout）都会自动批处理。</li>
</ul>
<h3 data-id="heading-5">底层原理（Hooks 机制）</h3>
<ul>
<li>
<p><code>useState</code> 是 React Hooks 的一部分，其状态存储在 <strong>Fiber 节点的 <code>memoizedState</code> 字段</strong>中。</p>
</li>
<li>
<p>每个 Hook（如 <code>useState</code>, <code>useEffect</code>）在 Fiber 节点上按调用顺序形成一个<strong>链表（Hook 链表）</strong> 。</p>
</li>
<li>
<p>调用 <code>setCount</code> 时，React 会：</p>
<ol>
<li>创建一个更新对象（类似类组件的 update）。</li>
<li>将其加入对应 Hook 的更新队列。</li>
<li>触发组件重新渲染（schedule update）。</li>
</ol>
</li>
<li>
<p>在下一次渲染时，React 会遍历 Hook 链表，应用所有 pending updates，计算出新的 state。</p>
</li>
</ul>
<blockquote>
<p>📌 关键：<strong>Hooks 的状态与组件实例绑定</strong>，通过 Fiber 节点维持状态，而不是像类组件那样通过 <code>this.state</code>。</p>
</blockquote>
<h2 data-id="heading-6">setState vs useState 对比</h2>








































<table><thead><tr><th>特性</th><th><code>setState</code>（类组件）</th><th><code>useState</code>（函数组件）</th></tr></thead><tbody><tr><td>状态结构</td><td>单个对象（可包含多个字段）</td><td>多个独立状态（每个 <code>useState</code> 管理一个）</td></tr><tr><td>更新方式</td><td>合并对象（shallow merge）</td><td>替换整个值（非合并）</td></tr><tr><td>初始值</td><td>构造函数中定义</td><td><code>useState(initialValue)</code></td></tr><tr><td>底层存储</td><td><code>this.state</code>（实际由 Fiber 管理）</td><td>Fiber 的 <code>memoizedState</code> 链表</td></tr><tr><td>性能</td><td>批量更新，Fiber 调度</td><td>同左，支持并发模式</td></tr><tr><td>推荐使用</td><td>已逐渐被函数组件取代</td><td>React 官方推荐方式</td></tr></tbody></table>
<blockquote>
<p>💡 注意：<code>useState</code> 不会自动合并对象！</p>
</blockquote>
<h2 data-id="heading-7"><strong>底层共通机制（React 18+）</strong></h2>
<p>无论是 <code>setState</code> 还是 <code>useState</code>，最终都依赖于：</p>
<ol>
<li><strong>Fiber 架构</strong>：每个组件对应一个 Fiber 节点，状态和更新都挂载其上。</li>
<li><strong>更新队列（Update Queue）</strong> ：存放待处理的状态变更。</li>
<li><strong>调度器（Scheduler）</strong> ：基于优先级（如用户交互高优先级）决定何时执行更新。</li>
<li><strong>协调（Reconciliation）</strong> ：通过 diff 算法生成最小 DOM 操作。</li>
<li><strong>自动批处理（Automatic Batching）</strong> ：React 18 起，所有状态更新默认批处理。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Repo 多git仓库管理工具]]></title>    <link>https://juejin.cn/post/7604881286037602356</link>    <guid>https://juejin.cn/post/7604881286037602356</guid>    <pubDate>2026-02-10T10:20:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604881286037602356" data-draft-id="7604766431226986536" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Repo 多git仓库管理工具"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-02-10T10:20:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sTone87375"/> <meta itemprop="url" content="https://juejin.cn/user/2946346894764584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Repo 多git仓库管理工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2946346894764584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sTone87375
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:20:36.000Z" title="Tue Feb 10 2026 10:20:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是 Repo？</h2>
<p><strong>Repo</strong> 是 Google 开发的 Python 脚本工具，用于管理多个 Git 仓库。它封装了 Git 命令，让你能够同时操作数百个 Git 仓库，常用于大型项目（如 Android 源码、AOSP）。</p>
<hr/>
<h2 data-id="heading-1">一、安装 Repo</h2>
<h3 data-id="heading-2">1. 下载 Repo 工具</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 bin 目录并下载 repo</span>
<span class="hljs-built_in">mkdir</span> -p ~/.bin
curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/.bin/repo
<span class="hljs-built_in">chmod</span> a+rx ~/.bin/repo

<span class="hljs-comment"># 添加到 PATH</span>
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">${HOME}</span>/.bin:<span class="hljs-variable">${PATH}</span>"</span>
</code></pre>
<h3 data-id="heading-3">2. 配置 Git 基本信息（必需）</h3>
<pre><code class="hljs language-bash" lang="bash">git config --global user.name <span class="hljs-string">"Your Name"</span>
git config --global user.email <span class="hljs-string">"your.email@example.com"</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">二、基础工作流程</h2>
<h3 data-id="heading-5">1. 初始化仓库（repo init）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化 manifest 仓库</span>
repo init -u &lt;manifest仓库地址&gt; -b &lt;分支名&gt; -m &lt;manifest文件&gt;

<span class="hljs-comment"># 示例：下载 AOSP 源码</span>
repo init -u https://android.googlesource.com/platform/manifest -b android-13.0.0_r1
</code></pre>
<p><strong>常用参数：</strong></p>





























<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-u</code></td><td>Manifest 仓库 URL（必需）</td></tr><tr><td><code>-b</code></td><td>指定分支/版本</td></tr><tr><td><code>-m</code></td><td>指定 manifest XML 文件（默认 default.xml）</td></tr><tr><td><code>--depth=1</code></td><td>浅克隆，只下载最新提交（节省空间）</td></tr><tr><td><code>--no-clone-bundle</code></td><td>禁用 clone.bundle（解决某些网络问题）</td></tr></tbody></table>
<h3 data-id="heading-6">2. 同步代码（repo sync）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 同步所有仓库代码（首次下载）</span>
repo <span class="hljs-built_in">sync</span>

<span class="hljs-comment"># 常用参数</span>
repo <span class="hljs-built_in">sync</span> -c          <span class="hljs-comment"># 只同步当前分支，不下载其他分支</span>
repo <span class="hljs-built_in">sync</span> -j8         <span class="hljs-comment"># 使用 8 线程并行下载</span>
repo <span class="hljs-built_in">sync</span> -f          <span class="hljs-comment"># 失败时继续同步其他项目</span>
repo <span class="hljs-built_in">sync</span> --no-tags   <span class="hljs-comment"># 不下载标签，减少数据量</span>
repo <span class="hljs-built_in">sync</span> -d          <span class="hljs-comment"># 切换到 manifest 指定的版本（放弃本地修改）</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">三、日常开发命令</h2>
<h3 data-id="heading-8">仓库状态管理</h3>
<pre><code class="hljs language-bash" lang="bash">repo status           <span class="hljs-comment"># 查看所有仓库的修改状态</span>
repo diff             <span class="hljs-comment"># 查看所有未提交的修改</span>
repo forall -c <span class="hljs-string">'git status'</span>   <span class="hljs-comment"># 在所有仓库执行 git status</span>
</code></pre>
<h3 data-id="heading-9">分支操作</h3>
<pre><code class="hljs language-bash" lang="bash">repo start &lt;分支名&gt; --all      <span class="hljs-comment"># 在所有仓库创建新分支</span>
repo start &lt;分支名&gt; &lt;项目名&gt;    <span class="hljs-comment"># 在指定项目创建分支</span>
repo abandon &lt;分支名&gt;          <span class="hljs-comment"># 删除所有仓库的指定分支</span>
repo checkout &lt;分支名&gt;         <span class="hljs-comment"># 切换到指定分支</span>
</code></pre>
<h3 data-id="heading-10">提交代码</h3>
<pre><code class="hljs language-bash" lang="bash">repo upload             <span class="hljs-comment"># 提交代码到 Gerrit 代码审查（AOSP 工作流）</span>
repo upload --cbr       <span class="hljs-comment"># 上传当前分支</span>
repo upload --verify    <span class="hljs-comment"># 上传并验证</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">四、高级用法</h2>
<h3 data-id="heading-12">1. 批量执行命令（forall）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在所有仓库执行命令</span>
repo forall -c <span class="hljs-string">'git log --oneline -5'</span>

<span class="hljs-comment"># 只在有修改的仓库执行</span>
repo forall -c <span class="hljs-string">'git clean -fd'</span>

<span class="hljs-comment"># 多命令执行</span>
repo forall -c <span class="hljs-string">'git add . &amp;&amp; git commit -m "update"'</span>
</code></pre>
<h3 data-id="heading-13">2. 筛选特定项目</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只操作特定路径的项目</span>
repo forall platform/frameworks/base -c <span class="hljs-string">'git status'</span>

<span class="hljs-comment"># 使用正则表达式</span>
repo forall -r <span class="hljs-string">"platform/.*"</span> -c <span class="hljs-string">'git branch'</span>
</code></pre>
<h3 data-id="heading-14">3. 查看仓库信息</h3>
<pre><code class="hljs language-bash" lang="bash">repo list             <span class="hljs-comment"># 列出所有管理的项目</span>
repo list -p          <span class="hljs-comment"># 显示项目路径</span>
repo manifest         <span class="hljs-comment"># 显示当前 manifest 内容</span>
repo manifest -r -o output.xml   <span class="hljs-comment"># 导出当前所有仓库的精确版本</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">五、Manifest 文件解析</h2>
<p>Manifest 是 XML 文件，定义了项目结构和仓库映射：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 远程仓库配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">remote</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"origin"</span> <span class="hljs-attr">fetch</span>=<span class="hljs-string">"https://github.com/example/"</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 默认配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">default</span> <span class="hljs-attr">remote</span>=<span class="hljs-string">"origin"</span> <span class="hljs-attr">revision</span>=<span class="hljs-string">"main"</span> <span class="hljs-attr">sync-j</span>=<span class="hljs-string">"4"</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目定义 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"framework"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"framework"</span> <span class="hljs-attr">groups</span>=<span class="hljs-string">"core"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"app"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"myapp"</span> <span class="hljs-attr">revision</span>=<span class="hljs-string">"develop"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"docs"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"documentation"</span> <span class="hljs-attr">clone-depth</span>=<span class="hljs-string">"1"</span> /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 包含其他 manifest --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"vendor.xml"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p><strong>关键标签：</strong></p>
<ul>
<li><code>&lt;remote&gt;</code>：定义远程仓库地址</li>
<li><code>&lt;project&gt;</code>：定义具体项目，<code>path</code> 是本地目录，<code>name</code> 是远程仓库名</li>
<li><code>&lt;groups&gt;</code>：项目分组，可用 <code>repo sync -g core</code> 只同步特定组</li>
</ul>
<hr/>
<h2 data-id="heading-16">六、常见问题解决</h2>

































<table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td>同步失败/卡住</td><td><code>repo sync -f -j1</code> 单线程重试，或检查网络</td></tr><tr><td>权限不足</td><td>配置 SSH Key 或使用 <code>repo init</code> 的 HTTPS 地址</td></tr><tr><td>磁盘空间不足</td><td>使用 <code>--depth=1</code> 浅克隆，或 <code>repo sync -c</code></td></tr><tr><td>冲突解决</td><td>进入具体项目目录，手动 <code>git rebase</code> 或 <code>git merge</code></td></tr><tr><td>放弃所有本地修改</td><td><code>repo forall -c 'git reset --hard HEAD &amp;&amp; git clean -fd'</code></td></tr><tr><td>更新 repo 工具本身</td><td><code>repo selfupdate</code> 或重新下载</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">七、典型工作流示例</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 初始化 Android 源码仓库</span>
repo init -u https://android.googlesource.com/platform/manifest -b master --partial-clone --clone-filter=blob:<span class="hljs-built_in">limit</span>=10M

<span class="hljs-comment"># 2. 同步代码（可能需要数小时）</span>
repo <span class="hljs-built_in">sync</span> -c -j8

<span class="hljs-comment"># 3. 创建开发分支</span>
repo start my-feature --all

<span class="hljs-comment"># 4. 修改代码后查看状态</span>
repo status
repo diff

<span class="hljs-comment"># 5. 提交修改（AOSP 流程）</span>
repo upload

<span class="hljs-comment"># 6. 同步最新代码</span>
repo <span class="hljs-built_in">sync</span>  <span class="hljs-comment"># 会自动 rebase 你的修改</span>
</code></pre>
<hr/>
<h2 data-id="heading-18">总结对比：Repo vs Git</h2>





























<table><thead><tr><th>场景</th><th>使用工具</th></tr></thead><tbody><tr><td>单仓库操作</td><td>Git</td></tr><tr><td>多仓库统一管理</td><td>Repo</td></tr><tr><td>查看/提交单个项目</td><td>进入目录用 Git</td></tr><tr><td>批量操作所有项目</td><td>Repo (<code>repo forall</code>)</td></tr><tr><td>大型项目（AOSP）</td><td>Repo + Manifest</td></tr></tbody></table>
<p>Repo 本质上是对 Git 的批量封装，掌握 Git 基础后，Repo 的学习曲线会很平缓。建议先熟悉 Git，再使用 Repo 管理复杂的多仓库项目。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[想让机器人春晚包饺子？阿里达摩院：别急，先把「大脑」优化一下]]></title>    <link>https://juejin.cn/post/7604846849464172596</link>    <guid>https://juejin.cn/post/7604846849464172596</guid>    <pubDate>2026-02-10T10:29:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604846849464172596" data-draft-id="7604846849464139828" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="想让机器人春晚包饺子？阿里达摩院：别急，先把「大脑」优化一下"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-02-10T10:29:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            想让机器人春晚包饺子？阿里达摩院：别急，先把「大脑」优化一下
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:29:23.000Z" title="Tue Feb 10 2026 10:29:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026 年，那么多机器人上春晚，能给大家表演个包饺子吗？相信这是很多人会好奇的一个问题。</p>
<p>但根据最近的彩排报道，这个可能性不大，机器人更有可能被设计为托着托盘呈上饺子。</p>
<p>其实业内人士都知道，如果不靠编程或摇操，让机器人包饺子这事儿远比移动、导航要复杂，还涉及到「饺子皮」这种堪称机器人图灵测试的柔性物体，没有一个足够聪明的「大脑」肯定是做不到的。这也是为什么，在过去的一年，越来越多的研究力量和资金开始涌向「大脑」。</p>
<p>阿里达摩院最近的一项工作 ——RynnBrain 也瞄准了这一方向。不过和一些表演叠衣服、做早餐的研究不同，他们关注的问题还要更底层一些：如果机器人在做家务的时候被打断，临时去门口接收快递，它还能不能回来接着刷碗？如果机器人被要求完成一件需要借助很多工具的任务，它制定的计划会不会包含手头压根没有的工具？</p>
<p>在关于机器人的各种宏大叙事里，这些问题可能没有那么起眼，甚至连相关的 benchmark 都是缺失的，但却是机器人走出实验室必须迈过的门槛。在 RynnBrain 的构建中，达摩院具身智能团队选择从底层出发，将时空记忆和物理空间推理直接训进模型里，并且达到了不错的效果，在 16 项具身的 Benchmark 上实现了 SOTA。</p>
<p>面对「三个面包、两个盘子」的约束条件，模型能够进行空间与长程规划，推导出合理的分配方案，体现了其在受限物理条件下的规划与推理能力。</p>
<p>在对杂乱桌面进行分拣规划的过程中，机器人能够在任务被打断后，准确记住已完成的步骤并继续执行，展示了多任务交错下的记忆与规划能力。</p>
<p>达摩院还一口气开源了 RynnBrain 全系列共计 7 个模型，其中包括 RynnBrain-30B-A3B。这是业界首个 MoE 具身基础模型，其只需要 3B 的推理激活参数就全面超越了当前规模最大的具身基础模型 Palican-VL-72B。使用这个模型，可以让机器人在保持最强大感知和规划能力的基础上拥有更加快速的动作响应和更加丝滑的行为模式。目前，包括模型权重、评测基准及完整训推代码在内的全套资源均已向社区开放。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e9ac688da4b4bb59c65823bb2d6039f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=dtA3Q5%2FHOA4QlG%2Bsr454TAAnGFc%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>Github链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba-damo-academy%2FRynnBrain" target="_blank" title="https://github.com/alibaba-damo-academy/RynnBrain" ref="nofollow noopener noreferrer">github.com/alibaba-dam…</a></p>
</li>
<li>
<p>HuggingFace链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fcollections%2FAlibaba-DAMO-Academy%2Frynnbrain" target="_blank" title="https://huggingface.co/collections/Alibaba-DAMO-Academy/rynnbrain" ref="nofollow noopener noreferrer">huggingface.co/collections…</a></p>
</li>
<li>
<p>项目主页：<a href="https://link.juejin.cn?target=https%3A%2F%2Falibaba-damo-academy.github.io%2FRynnBrain.github.io%2F" target="_blank" title="https://alibaba-damo-academy.github.io/RynnBrain.github.io/" ref="nofollow noopener noreferrer">alibaba-damo-academy.github.io/RynnBrain.g…</a></p>
</li>
</ul>
<p>把大模型塞进机器人？</p>
<p>这事儿真没那么简单</p>
<p>关于具身大脑，业界流传着一个有趣的调侃 ——「把 DeepSeek 等大模型放进宇树不就行了」。当然，做过的人都知道这完全行不通。</p>
<p>本质上，在 2D 世界数据上训练出的模型，在走进物理世界的时候面临的是一个完全不同的环境。</p>
<p>还是以机器人包饺子任务为例，在原来的 2D 世界里，顶尖的 VLM（视觉语言模型）早就能够看懂包饺子的完整流程，模型的任务本质上是对静态画面做出理解，不需要与环境交互。而在真实的年夜饭厨房 —— 那个物品散落、空间逼仄的高熵战场 —— 一个仅凭 VLM 语言、视觉经验行事的机器人往往会显得手足无措：比如机器人刚将饺子皮擀好、放上馅料、正准备捏合，但不小心碰倒了旁边的调料瓶，想要拿抹布擦拭但眼前并没有抹布，也想不起来放在哪儿，于是就卡住了。再比如，它「看到」桌上有馅料，便自信地规划出「用挖馅勺取馅」的动作，却对「挖馅勺没有被拿上桌」这一关键缺失视而不见，最终导致任务失败。</p>
<p>这些场景尖锐地揭示出当前通用大模型的局限：它们虽「见多识广」，但在物理世界里往往是「纸上谈兵」，缺乏连续的三维空间感，不懂真实的物理交互逻辑，更难以避免因脱离物理约束而产生的幻觉式规划。</p>
<p>这正是达摩院推出 RynnBrain 所要解决的核心问题。他们的思路是通过系统性地引入时空记忆、物理空间推理等能力，将这个原本「飘在云端」的认知大脑，强行拽回物理世界。</p>
<p>从 RynnEC 到 RynnBrain</p>
<p>让大模型长出「物理直觉」</p>
<p>让大模型扎根物理世界不是一蹴而就的。在 RynnBrain 之前，达摩院还做过一项奠基性的研究 ——RynnEC。</p>
<p>简单来说，RynnEC 就像给大模型赋予一双「眼睛」。它可以精确回答关于物体（属性、数量、功能、分割等）或空间（以自我为中心的世界感知 + 以世界为中心的尺度感知）的问题。比如在执行「将平板电脑放到书架上」这个任务时，它会先思考「电脑有多宽，能不能放书架上不掉下来？」；而在伸手拿酱油之前，它会先算一下自己和酱油瓶之间的距离，判断原地不动能不能够得着。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27f8f440fac4c6cb6cbd95783ce2a48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=TXJlFIYmt7jSJVMPEIi1PTS%2B%2FRg%3D" alt="图片" loading="lazy"/></p>
<p>图源：RynnEC 论文。链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2508.14160" target="_blank" title="https://arxiv.org/pdf/2508.14160" ref="nofollow noopener noreferrer">arxiv.org/pdf/2508.14…</a></p>
<p>这双「眼睛」所带来的细粒度认知输入，是连接高层规划与底层控制的关键桥梁。而 RynnBrain 不仅完整地继承了这些能力，还扩展出了多样化的时空记忆以及物理空间推理能力。</p>
<p>先说时空记忆。这一能力的引入，直指当前具身大模型的「视野」痛点。现有的大脑模型往往只能解决当前视野（图片）内的定位任务，一旦需要寻找的目标物体或关键点处于视野之外（比如前面提到的「抹布」），模型便无能为力。尽管业界存在一种通用的「暴力解法」，也就是把所有的历史图片重新过一遍模型来寻找目标，但在达摩院看来，这种方式割裂了时空，忽略了具身场景本质上是一个连续的、整体的三维世界。</p>
<p>因此，RynnBrain 选择了一条更符合认知的路径：它利用历史记忆来帮助模型构建起一个更加完整的三维认知。这意味着，机器人的决策与理解不再受限于眼前的瞬间场景，而是能够真正基于一个完备的三维世界模型进行全局考量。</p>
<p>在复杂的视频变化与干扰下，模型能够持续追踪并识别被使用过的矿泉水，展示了对动态场景中物体的长期记忆与理解能力。</p>
<p>机器人在主要物体被移动后，仍能保持对其空间位置的记忆，并将物体准确放回原处，体现了稳定的物体记忆与空间记忆能力。</p>
<p>那么，这种「类人」的全局时空回溯是如何实现的？其背后的核心在于涵盖空间、位置、事件、轨迹等多维度信息的「统一表征」。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7676a674574a49bbbfe8728d603dae4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=U08Op2FdWrYaN2xiwokXWpt4Gcw%3D" alt="图片" loading="lazy"/></p>
<p>RynnBrain 拥有认知、定位、推理、规划等多种能力</p>
<p>在复杂的具身交互中，机器人所面对的信息是高度异构的。传统的模型往往难以兼容这些异构的信息，而 RynnBrain 的突破在于，它构建了一套统一的框架，将这些信息全部统一映射到模型的输出空间里。这意味着，模型在「脑海」里处理的不再是割裂的视觉切片，而是将时间维度、空间坐标与语义理解融为一体，从而在底层逻辑上实现了对物理世界的精准「拿捏」。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75a6a3ef1ad74c939e79da09beac6715~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=Z8n5txSogeEC02SvrlgNQ0rAaSE%3D" alt="图片" loading="lazy"/></p>
<p>RynnBrain 模型架构图。</p>
<p>接下来看物理空间推理能力。在传统的 VLM 中，推理主要发生在语言层面，并未被强制与具体的空间位置或物理状态绑定。模型可能会生成看似完美的计划，比如前面提到的「用挖馅勺取馅」，但实际上，它眼前并没有挖馅勺，也不知道这个工具在哪里。这种「语义与空间解耦」的模式，是导致机器人产生「物理幻觉」的根源。于是，指令发出去了，任务却完不成。</p>
<p>为了消除这种割裂，RynnBrain 采用了一种「文本与空间定位交错」的推理策略。简单来说，就是要求模型「边说边指」。在 RynnBrain 生成推理文本的过程中，每当涉及到具体的物理对象或位置时，它必须同步预测出对应的空间坐标或区域掩码。这种强制性的约束，迫使模型在生成「拿起挖馅勺」这句话的同时，必须在像素级或三维坐标系中精准地标出那个挖馅勺。</p>
<p>通过这种机制，RynnBrain 将抽象的语言逻辑与具象的物理环境强力锁定。这种扎根于物理世界的推理方式，极大地降低了任务执行中的不确定性，让每一个决策 Token 都有据可依。</p>
<p>从 SOTA 刷榜到下游实战</p>
<p>一个「六边形基座」的诞生</p>
<p>说了这么多，RynnBrain 到底表现如何？其实，如果只是拿现有的 Benchmark 去测，RynnBrain 的部分能力是很难测出来的，如时空定位、操作点识别等。目前的开源评测基准，普遍缺少对这些细粒度信息理解能力与时空定位能力的评估。</p>
<p>为了填补这一空白，达摩院推出了一个名叫 RynnBrain Bench 的新基准。这个基准涵盖物体认知、空间认知、物体定位、具身点预测四大维度，共计 20 项具身相关任务。它和现有的其他 benchmark 一起，对模型能力提出了综合考验。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f60266e10d8403c91f7c277c6d22b21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=MlhSkpb9L%2Bn%2FkEZ7C0ALBq70424%3D" alt="图片" loading="lazy"/></p>
<p>在这套严苛的「试卷」面前，RynnBrain 首先展现出了全面且扎实的基础模型能力。其 8B 版本不仅在具身认知与定位任务上全面领先于 Gemini Robotics ER 1.5、Mimo-Embodied、RoboBrain 2.0、Pelican-VL、Cosmos-reason 2 等业内最先进的模型，在许多细分能力上甚至实现了 30% 以上的性能飞跃。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8883ec700472421a8938919f283d1227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=ceoXj1%2BNKj%2FlsB%2FJcRfSGfjvlqo%3D" alt="图片" loading="lazy"/></p>
<p>RynnBrain 在 16 项具身评测上实现 SOTA</p>
<p>更难得的是，RynnBrain 在泛化性方面并没有明显的损失。我们知道，许多专门为机器人任务训练的「具身大脑」模型，容易过拟合到特定任务上，导致其丧失作为通用大模型原有的强大能力（比如文档理解、文本推理等）。而 RynnBrain 在取得具身任务 SOTA 的同时，继承了基座模型（Qwen3-VL）通用视觉能力。</p>
<p><em>模型能够理解用户的饮食需求，结合常识判断与中文 OCR 识别，从多个带文字标签的物品中筛选出符合条件的选项。</em></p>
<p>此外，其开源的 MOE 版本（RynnBrain-30B-A3B）让机器人在保持最强感知与规划能力的同时拥有更快的响应速度。它仅需 3B 的推理激活参数，就在各项指标上击败了当前规模最大的具身基础模型 Pelican-VL-72B，真正实现了以小博大。</p>
<p>作为一个旨在赋能下游任务的基座，RynnBrain 还在后训练阶段爆发出了巨大的潜力。</p>
<p>实验数据表明，其预训练成果对下游任务有显著的加持作用：在导航任务中，仅作为基座进行微调（RynnBrain-Nav），就能比使用 Qwen3-VL 的模型能力提升 5%，且在不修改架构的情况下，导航成功率比当前的 SOTA 模型 StreamVLN 高出 2%-3%。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eab71028469e4af7820bf2104257c3e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=Qpq8TuJgkBHxO51ze7sdYfjK3Rw%3D" alt="图片" loading="lazy"/></p>
<p>而在操作规划方面，RynnBrain 展现了惊人的数据效率，仅需几百条样本微调，其 RynnBrain-Plan 模型就能具备强大的长周期规划能力，无论是在域内还是域外任务上均全面超越了 Gemini 3 Pro。这种「一点就通」的特质，充分验证了其独创的「文本与定位交错」推理方式比传统模式更适应复杂多变的物理世界，其强泛化能力的保留使其能够更快地迁移到所需场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d2b620a13104b95a1a9e0e03c56a46a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324165&amp;x-signature=aypu03Rn%2B2WDjRaunG1PVjH%2BMnQ%3D" alt="图片" loading="lazy"/></p>
<p>至此，RynnBrain 不仅具备了系统性的认知架构，更补全了从「理解」到「行动」的关键环节，成为首个支持移动操作的具身基础模型。</p>
<p>与其押注路线</p>
<p>不如先给行业「打地基」</p>
<p>关于机器人「大脑」该怎么做，业内其实一直没有标准答案。达摩院的研究人员在交流中提到，当前的探索大致分成两种思路：一种从动作出发，直接学习如何操作真实世界，这条路发展出了 VLA 模型，但问题也很现实 —— 高质量数据难找，泛化始终受限；另一种则试图利用大模型本就拥有的泛化能力，希望先让模型看懂世界，再谈行动，但如何把这种理解准确对齐到真实、连续的物理空间，依然是绕不开的难点。</p>
<p>在这种背景下，达摩院没有急着选边站，而是选择先把基础能力补齐。RynnEC 负责打好对物理世界的感知与理解，RynnBrain 则在此之上继续往时空记忆、空间推理和长程规划推进。这些基础打好之后，RynnBrain 既可以作为下游模型的「大脑」参与真实操作，也有机会通过后训练直接演进为操作基座。这些能力被开源出来，也是希望社区能在同一套底座上继续探索，而不是各自重复造轮子。</p>
<p>与此同时，达摩院也在并行推进以视觉为主导的 VLA 路线（如 RynnVLA），并通过 RCP 等系统级技术，把模型、数据和真实机器人连成一条完整链路，从「看见」到「决定」再到「动手」。</p>
<p>谈及更远的未来，达摩院透露，他们在思考一种更平台化的方案，试图在碎片化的硬件和算法生态之上，搭起一套更统一的具身智能基础设施。毕竟，要解决具身智能这道世纪难题，需要的不是某一家机构的孤军奋战，而是整个开源社区的共同进化。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微前端（无界）样式架构重构方案]]></title>    <link>https://juejin.cn/post/7605036907458297907</link>    <guid>https://juejin.cn/post/7605036907458297907</guid>    <pubDate>2026-02-10T10:24:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605036907458297907" data-draft-id="7604889577937436699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微前端（无界）样式架构重构方案"/> <meta itemprop="keywords" content="前端,CSS,架构"/> <meta itemprop="datePublished" content="2026-02-10T10:24:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大象的鼻子那么长"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微前端（无界）样式架构重构方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大象的鼻子那么长
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 融会贯通" title="VIP.4 融会贯通" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:24:28.000Z" title="Tue Feb 10 2026 10:24:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>日期</strong>: 2025-02-10<br/>
<strong>影响范围</strong>: 主应用 <code>apps/main</code>、共享包 <code>packages/ui</code>、所有子应用</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、现状诊断</h2>
<h3 data-id="heading-1">1.1 样式文件分布（主应用）</h3>
<p>当前主应用存在 <strong>3 个互不关联的样式目录</strong>，没有统一入口：</p>
<pre><code class="hljs language-csharp" lang="csharp">apps/main/src/
├── assets/
│   ├── main.css              ← Vue 脚手架残留 + Tailwind 入口
│   ├── <span class="hljs-keyword">base</span>.css              ← Vue 脚手架残留 CSS Reset + 变量
│   └── styles/
│       └── micro-app.css     ← 微前端<span class="hljs-string">"隔离"</span>样式（!important 硬覆盖）
├── styles/
│   ├── index.scss            ← 样式入口（⚠️ 从未被任何文件引用！）
│   ├── <span class="hljs-keyword">var</span>.css               ← 布局 + 主题 CSS 变量
│   ├── dark.css              ← 暗色主题变量
│   ├── resizeStyle.scss      ← <span class="hljs-number">632</span> 行巨型文件（EP 覆盖 + 布局 + 业务混杂）
│   ├── dialog.scss           ← 弹窗尺寸
│   ├── theme.scss            ← 空文件（全注释）
│   ├── variables.scss        ← 仅 <span class="hljs-number">2</span> 个 SCSS 变量
│   └── <span class="hljs-keyword">global</span>.module.scss    ← 导出命名空间给 JS
</code></pre>
<h3 data-id="heading-2">1.2 main.ts 样式导入链</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">main.ts
  ├── assets/main.css           → <span class="hljs-meta">@import</span> base.css + <span class="hljs-meta">@import</span> tailwindcss
  ├── assets/styles/micro-app.css
  ├── element-plus 组件样式 ×<span class="hljs-number">4</span>（message-box / message / notification / loading）
  └── <span class="hljs-meta">@cmclink</span>/ui/styles        → variables + element-<span class="hljs-keyword">override</span> + base + utilities + animations + tailwindcss
</code></pre>
<p><strong>关键发现</strong>：<code>styles/index.scss</code>（包含 <code>var.css</code>、<code>resizeStyle.scss</code>、<code>dialog.scss</code>）<strong>在整个项目中没有被任何文件 import</strong>。这意味着 632 行的 Element Plus 覆盖样式、布局变量、暗色主题等可能<strong>完全没有生效</strong>，或者曾经生效但在某次重构中被遗漏。</p>
<h3 data-id="heading-3">1.3 核心问题清单</h3>







































































<table><thead><tr><th>#</th><th>问题</th><th>严重程度</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td><strong>Tailwind CSS 重复引入</strong></td><td>🔴 高</td><td><code>assets/main.css</code> 和 <code>@cmclink/ui/styles</code> 各引入一次，产生重复样式</td></tr><tr><td>2</td><td><strong>CSS Reset 重复执行</strong></td><td>🔴 高</td><td><code>assets/base.css</code> 和 <code>@cmclink/ui/base.scss</code> 各做一次全局 reset</td></tr><tr><td>3</td><td><strong>主色定义冲突</strong></td><td>🔴 高</td><td><code>var.css</code>→<code>#005aae</code>、<code>@cmclink/ui</code>→<code>#004889</code>、<code>resizeStyle.scss</code>→硬编码 <code>#005aae</code>，三处不一致</td></tr><tr><td>4</td><td><strong>styles/index.scss 未被引用</strong></td><td>🔴 高</td><td>632 行 EP 覆盖 + 布局变量 + 暗色主题可能完全未生效</td></tr><tr><td>5</td><td><strong>body 样式双重定义</strong></td><td>🟡 中</td><td><code>base.css</code> 和 <code>@cmclink/ui/base.scss</code> 都设置了 body 样式</td></tr><tr><td>6</td><td><strong>微前端样式隔离 = !important 战争</strong></td><td>🔴 高</td><td><code>micro-app.css</code> 用 <code>!important</code> 硬覆盖，没有利用 wujie CSS 沙箱</td></tr><tr><td>7</td><td><strong>脚手架残留代码</strong></td><td>🟡 中</td><td><code>base.css</code> 的 <code>--vt-c-*</code> 变量、<code>main.css</code> 的 <code>.green</code> 类</td></tr><tr><td>8</td><td><strong>废文件堆积</strong></td><td>🟡 中</td><td><code>theme.scss</code>（空）、<code>variables.scss</code>（2 行）、<code>global.module.scss</code>（价值存疑）</td></tr><tr><td>9</td><td><strong>!important 泛滥</strong></td><td>🟡 中</td><td><code>resizeStyle.scss</code> 和 <code>micro-app.css</code> 大量使用</td></tr><tr><td>10</td><td><strong>样式职责不清</strong></td><td>🔴 高</td><td>EP 覆盖、页面布局、业务样式、主题变量全混在一个文件</td></tr></tbody></table>
<h3 data-id="heading-4">1.4 @cmclink/ui 样式包分析</h3>
<p><code>packages/ui/src/styles/</code> 已经有一套相对完整的设计体系：</p>
<ul>
<li><strong>variables.scss</strong> — 完整的设计令牌（颜色、字体、间距、圆角、阴影等）+ CSS 变量映射</li>
<li><strong>mixins.scss</strong> — 响应式断点、文本截断、布局、按钮变体等混合器</li>
<li><strong>base.scss</strong> — 全局 reset、标题、段落、表格、滚动条、打印、暗色、无障碍</li>
<li><strong>element-override.scss</strong> — Element Plus 样式覆盖</li>
<li><strong>utilities.scss</strong> — CMC 专用工具类（<code>cmc-*</code> 前缀）</li>
<li><strong>animations.scss</strong> — 动画库（1250 行，含大量与 Tailwind 重复的工具类）</li>
</ul>
<p><strong>问题</strong>：<code>@cmclink/ui</code> 的 <code>animations.scss</code> 中有大量 <code>.translate-*</code>、<code>.scale-*</code>、<code>.rotate-*</code>、<code>.duration-*</code> 等类名，与 Tailwind CSS 完全重复。</p>
<hr/>
<h2 data-id="heading-5">二、目标架构设计</h2>
<h3 data-id="heading-6">2.1 设计原则</h3>
<ol>
<li><strong>单一真相源（Single Source of Truth）</strong>：设计令牌只在 <code>@cmclink/ui</code> 中定义一次</li>
<li><strong>分层隔离</strong>：全局样式、主题变量、EP 覆盖、布局样式、业务样式严格分层</li>
<li><strong>微前端天然隔离</strong>：依赖 wujie 的 CSS 沙箱（WebComponent + iframe），而非 <code>!important</code></li>
<li><strong>Tailwind 唯一入口</strong>：整个主应用只在一个地方引入 Tailwind CSS</li>
<li><strong>可维护性</strong>：每个文件职责单一，命名语义化，新人 5 分钟能理解结构</li>
</ol>
<h3 data-id="heading-7">2.2 目标目录结构</h3>
<pre><code class="hljs language-css" lang="css">apps/<span class="hljs-selector-tag">main</span>/<span class="hljs-attribute">src</span>/
├── styles/                          ← 主应用样式唯一目录
│   ├── index<span class="hljs-selector-class">.scss</span>                   ← ⭐ 唯一入口文件（<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.ts</span> 只 import 这一个）
│   ├── tailwind<span class="hljs-selector-class">.css</span>                 ← Tailwind CSS 唯一引入点
│   │
│   ├── tokens/                      ← 主应用级设计令牌（覆盖/扩展 <span class="hljs-keyword">@cmclink</span>/ui）
│   │   ├── _variables.scss          ← SCSS 变量（供 SCSS 文件内部使用）
│   │   └── _css-variables.scss      ← CSS 自定义属性（布局变量、主应用专属变量）
│   │
│   ├── themes/                      ← 主题系统
│   │   ├── _light.scss              ← 亮色主题变量
│   │   └── _dark.scss               ← 暗色主题变量
│   │
│   ├── overrides/                   ← Element Plus 样式覆盖（主应用级）
│   │   ├── _button.scss             ← 按钮覆盖
│   │   ├── _table.scss              ← 表格覆盖
│   │   ├── _form.scss               ← 表单覆盖（filterBox 等）
│   │   ├── _dialog.scss             ← 弹窗覆盖
│   │   ├── _message-box.scss        ← 消息框覆盖
│   │   ├── _select.scss             ← 下拉框覆盖
│   │   ├── _tag.scss                ← 标签覆盖
│   │   ├── _tabs.scss               ← 标签页覆盖
│   │   └── _index.scss              ← EP 覆盖汇总入口
│   │
│   ├── layout/                      ← 布局样式
│   │   ├── _app-view.scss           ← AppViewContent / AppViewScroll
│   │   ├── _login.scss              ← 登录页样式
│   │   └── _index.scss              ← 布局汇总入口
│   │
│   ├── vendors/                     ← 第三方库样式适配
│   │   └── _nprogress.scss          ← NProgress 主题色适配
│   │
│   └── legacy/                      ← 遗留业务样式（逐步迁移到组件 scoped 中）
│       ├── _si-detail.scss          ← 出口单证详情
│       ├── _marketing.scss          ← 营销模块
│       └── _index.scss              ← 遗留样式汇总入口
│
├── assets/                          ← 仅保留静态资源
│   └── images/                      ← 图片资源
│       ├── avatar.gif
│       ├── cmc-logo.png
│       └── ...
</code></pre>
<h3 data-id="heading-8">2.3 入口文件设计</h3>
<p><strong><code>styles/index.scss</code></strong>（唯一入口）：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// =============================================================================</span>
<span class="hljs-comment">// CMCLink 主应用样式入口</span>
<span class="hljs-comment">// 加载顺序严格按照优先级排列，请勿随意调整</span>
<span class="hljs-comment">// =============================================================================</span>

<span class="hljs-comment">// 1️⃣ Tailwind CSS（最先加载，作为基础原子类层）</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./tailwind.css'</span>;

<span class="hljs-comment">// 2️⃣ 主应用级设计令牌（覆盖/扩展 @cmclink/ui 的变量）</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./tokens/css-variables'</span>;

<span class="hljs-comment">// 3️⃣ 主题系统</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./themes/light'</span>;
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./themes/dark'</span>;

<span class="hljs-comment">// 4️⃣ Element Plus 样式覆盖</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./overrides/index'</span>;

<span class="hljs-comment">// 5️⃣ 布局样式</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./layout/index'</span>;

<span class="hljs-comment">// 6️⃣ 第三方库适配</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./vendors/nprogress'</span>;

<span class="hljs-comment">// 7️⃣ 遗留业务样式（逐步清理）</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'./legacy/index'</span>;
</code></pre>
<p><strong><code>main.ts</code></strong>（重构后）：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 样式：唯一入口</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/index.scss'</span>

<span class="hljs-comment">// Element Plus 反馈组件样式（非按需导入的全局组件）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/es/components/message-box/style/css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/es/components/message/style/css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/es/components/notification/style/css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/es/components/loading/style/css'</span>

<span class="hljs-comment">// 组件库样式（@cmclink/ui 提供设计令牌 + 基础样式 + EP 覆盖）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'@cmclink/ui/styles'</span>

<span class="hljs-comment">// 其余保持不变...</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>：<code>@cmclink/ui/styles</code> 中的 Tailwind CSS 引入需要移除，改为只在主应用的 <code>styles/tailwind.css</code> 中引入一次。</p>
</blockquote>
<h3 data-id="heading-9">2.4 样式加载顺序</h3>
<pre><code class="hljs language-bash" lang="bash">┌─────────────────────────────────────────────────────────┐
│ 1. Tailwind CSS（原子类基础层）                           │
├─────────────────────────────────────────────────────────┤
│ 2. @cmclink/ui/styles                                   │
│    ├── variables.scss  → 设计令牌 + CSS 变量映射          │
│    ├── base.scss       → 全局 reset + 排版               │
│    ├── element-override.scss → 组件库级 EP 覆盖           │
│    ├── utilities.scss  → CMC 工具类                       │
│    └── animations.scss → 动画（需清理与 Tailwind 重复部分）│
├─────────────────────────────────────────────────────────┤
│ 3. Element Plus 反馈组件样式（message/notification 等）    │
├─────────────────────────────────────────────────────────┤
│ 4. 主应用 styles/index.scss                              │
│    ├── tokens/    → 主应用级变量（布局尺寸、主题色扩展）    │
│    ├── themes/    → 亮色/暗色主题                         │
│    ├── overrides/ → 主应用级 EP 覆盖                      │
│    ├── layout/    → 页面布局                              │
│    ├── vendors/   → 第三方库适配                          │
│    └── legacy/    → 遗留业务样式                          │
├─────────────────────────────────────────────────────────┤
│ 5. 组件 &lt;style scoped&gt;（组件级样式，天然隔离）             │
└─────────────────────────────────────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-10">三、微前端样式隔离策略</h2>
<h3 data-id="heading-11">3.1 wujie CSS 沙箱机制</h3>
<p>wujie 使用 <strong>WebComponent（shadowDOM）+ iframe</strong> 双重沙箱：</p>
<ul>
<li><strong>JS 沙箱</strong>：子应用 JS 运行在 iframe 中，天然隔离</li>
<li><strong>CSS 沙箱</strong>：子应用 DOM 渲染在 WebComponent 的 shadowDOM 中，样式天然隔离</li>
</ul>
<p>这意味着：</p>
<ul>
<li>✅ 子应用的样式<strong>不会泄漏</strong>到主应用</li>
<li>✅ 主应用的样式<strong>不会侵入</strong>子应用（shadowDOM 边界）</li>
<li>⚠️ <strong>但是</strong>：Element Plus 的弹窗（Dialog/Drawer/MessageBox）默认挂载到 <code>document.body</code>，会<strong>逃逸出 shadowDOM</strong></li>
</ul>
<h3 data-id="heading-12">3.2 弹窗逃逸问题的正确解决方案</h3>
<p><strong>当前做法（错误）</strong>：在主应用 <code>micro-app.css</code> 中用 <code>!important</code> 覆盖子应用弹窗样式。</p>
<p><strong>正确做法</strong>：在子应用中配置 Element Plus 的 <code>teleported</code> 和 <code>append-to</code> 属性，让弹窗挂载到子应用自身的 DOM 容器内，而非 <code>document.body</code>。</p>
<h4 data-id="heading-13">方案 A：子应用全局配置（推荐）</h4>
<p>在子应用的入口文件中配置 Element Plus 的全局属性：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 子应用 main.ts</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>, {
  <span class="hljs-comment">// 弹窗不使用 teleport，保持在子应用 DOM 树内</span>
  <span class="hljs-comment">// 这样弹窗样式就在 shadowDOM 内，天然隔离</span>
})
</code></pre>
<p>同时在子应用的弹窗组件中统一设置：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 子应用中使用 Dialog --&gt;
&lt;el-dialog :teleported="false"&gt;
  &lt;!-- 内容 --&gt;
&lt;/el-dialog&gt;

&lt;!-- 或者指定挂载到子应用容器 --&gt;
&lt;el-dialog append-to=".child-app-root"&gt;
  &lt;!-- 内容 --&gt;
&lt;/el-dialog&gt;
</code></pre>
<h4 data-id="heading-14">方案 B：wujie 插件拦截（自动化）</h4>
<p>通过 wujie 的插件系统，自动为子应用的弹窗组件注入配置：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// plugins/wujie.ts 中增加插件配置</span>
<span class="hljs-keyword">import</span> { setupApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'wujie'</span>

<span class="hljs-title function_">setupApp</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'child-app'</span>,
  <span class="hljs-comment">// ... 其他配置</span>
  <span class="hljs-attr">plugins</span>: [
    {
      <span class="hljs-comment">// CSS loader：可以在子应用 CSS 加载时做处理</span>
      <span class="hljs-attr">cssLoader</span>: <span class="hljs-function">(<span class="hljs-params">code: <span class="hljs-built_in">string</span></span>) =&gt;</span> code,
      <span class="hljs-comment">// JS loader：可以在子应用 JS 加载时做处理</span>
      <span class="hljs-attr">jsLoader</span>: <span class="hljs-function">(<span class="hljs-params">code: <span class="hljs-built_in">string</span></span>) =&gt;</span> code,
    }
  ]
})
</code></pre>
<h4 data-id="heading-15">方案 C：共享样式包（兜底方案）</h4>
<p>如果确实需要主应用和子应用共享某些样式（如统一的弹窗规范），应该通过 <code>@cmclink/ui</code> 包来分发，而非在主应用中硬写覆盖：</p>
<pre><code class="hljs language-css" lang="css">packages/ui/<span class="hljs-attribute">src</span>/styles/
├── shared/                    ← 可被子应用独立引入的共享样式
│   ├── dialog-standard<span class="hljs-selector-class">.scss</span>   ← 弹窗标准样式
│   └── <span class="hljs-selector-tag">form</span>-standard<span class="hljs-selector-class">.scss</span>     ← 表单标准样式
</code></pre>
<p>子应用按需引入：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 子应用 main.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'@cmclink/ui/styles/shared/dialog-standard.scss'</span>
</code></pre>
<h3 data-id="heading-16">3.3 样式隔离总结</h3>






























<table><thead><tr><th>场景</th><th>隔离机制</th><th>是否需要额外处理</th></tr></thead><tbody><tr><td>子应用普通样式</td><td>wujie shadowDOM 天然隔离</td><td>❌ 无需处理</td></tr><tr><td>子应用弹窗/抽屉</td><td>配置 <code>:teleported="false"</code></td><td>✅ 子应用侧配置</td></tr><tr><td>主应用与子应用共享样式</td><td>通过 <code>@cmclink/ui</code> 包分发</td><td>✅ 包级别管理</td></tr><tr><td>主应用全局样式</td><td>不会侵入子应用（shadowDOM）</td><td>❌ 无需处理</td></tr></tbody></table>
<h3 data-id="heading-17">3.4 删除 micro-app.css</h3>
<p>重构完成后，<code>assets/styles/micro-app.css</code> 应该被<strong>完全删除</strong>。其中的内容处理方式：</p>





















<table><thead><tr><th>原内容</th><th>处理方式</th></tr></thead><tbody><tr><td><code>.micro-app .el-dialog</code> 覆盖</td><td>子应用配置 <code>:teleported="false"</code> 后不再需要</td></tr><tr><td><code>.micro-app-test.marketing</code></td><td>测试代码，直接删除</td></tr><tr><td><code>.test-paragraph</code> / <code>.test-box</code></td><td>测试代码，直接删除</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-18">四、主色统一方案</h2>
<h3 data-id="heading-19">4.1 现状：三处主色定义</h3>

























<table><thead><tr><th>位置</th><th>主色值</th><th>说明</th></tr></thead><tbody><tr><td><code>styles/var.css</code></td><td><code>#005aae</code></td><td>主应用布局变量</td></tr><tr><td><code>@cmclink/ui/variables.scss</code></td><td><code>#004889</code></td><td>组件库设计令牌</td></tr><tr><td><code>resizeStyle.scss</code></td><td><code>#005aae</code>（硬编码）</td><td>登录页等处直接写死</td></tr></tbody></table>
<h3 data-id="heading-20">4.2 统一方案</h3>
<p><strong>以 <code>@cmclink/ui</code> 的设计令牌为唯一真相源</strong>。</p>
<ol>
<li>
<p>确认最终主色值（与设计团队对齐）：</p>
<ul>
<li>如果设计稿是 <code>#004889</code> → 主应用的 <code>var.css</code> 需要同步修改</li>
<li>如果设计稿是 <code>#005aae</code> → <code>@cmclink/ui</code> 的 <code>variables.scss</code> 需要同步修改</li>
</ul>
</li>
<li>
<p>主应用中所有硬编码的颜色值，改为引用 CSS 变量：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ❌ 错误</span>
<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#005aae</span>;

<span class="hljs-comment">// ✅ 正确</span>
<span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--el-color-primary);
</code></pre>
</li>
<li>
<p>主应用的 <code>tokens/_css-variables.scss</code> 只定义<strong>布局相关</strong>的变量，颜色变量全部继承 <code>@cmclink/ui</code>。</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-21">五、文件迁移映射</h2>
<h3 data-id="heading-22">5.1 需要删除的文件</h3>

































<table><thead><tr><th>文件</th><th>原因</th></tr></thead><tbody><tr><td><code>assets/main.css</code></td><td>脚手架残留，Tailwind 迁移到 <code>styles/tailwind.css</code></td></tr><tr><td><code>assets/base.css</code></td><td>脚手架残留，与 <code>@cmclink/ui/base.scss</code> 重复</td></tr><tr><td><code>assets/styles/micro-app.css</code></td><td>!important 硬覆盖，改用 wujie 沙箱</td></tr><tr><td><code>styles/theme.scss</code></td><td>空文件</td></tr><tr><td><code>styles/variables.scss</code></td><td>仅 2 行，合并到 <code>tokens/_variables.scss</code></td></tr><tr><td><code>styles/global.module.scss</code></td><td>价值存疑，如需保留可合并</td></tr></tbody></table>
<h3 data-id="heading-23">5.2 需要拆分的文件</h3>
<h4 data-id="heading-24"><code>styles/var.css</code>（154 行）→ 拆分为：</h4>

















<table><thead><tr><th>目标文件</th><th>内容</th></tr></thead><tbody><tr><td><code>tokens/_css-variables.scss</code></td><td>布局变量（<code>--left-menu-*</code>、<code>--top-header-*</code>、<code>--tags-view-*</code>、<code>--app-content-*</code> 等）</td></tr><tr><td>删除</td><td>颜色变量（<code>--el-color-primary</code> 等），改为继承 <code>@cmclink/ui</code></td></tr></tbody></table>
<h4 data-id="heading-25"><code>styles/resizeStyle.scss</code>（632 行）→ 拆分为：</h4>

































































<table><thead><tr><th>目标文件</th><th>内容</th><th>行数（约）</th></tr></thead><tbody><tr><td><code>overrides/_button.scss</code></td><td>按钮样式覆盖（L1-20）</td><td>~20</td></tr><tr><td><code>overrides/_tag.scss</code></td><td>标签样式（L29-33）</td><td>~5</td></tr><tr><td><code>overrides/_select.scss</code></td><td>下拉框样式（L36-38）</td><td>~3</td></tr><tr><td><code>overrides/_table.scss</code></td><td>表格样式（L41-80, L374-417）</td><td>~80</td></tr><tr><td><code>overrides/_message-box.scss</code></td><td>消息框样式（L83-98, L399-406）</td><td>~20</td></tr><tr><td><code>overrides/_form.scss</code></td><td>filterBox 表单样式（L484-618）</td><td>~135</td></tr><tr><td><code>layout/_login.scss</code></td><td>登录页样式（L100-117）</td><td>~18</td></tr><tr><td><code>layout/_app-view.scss</code></td><td>AppViewContent / AppViewScroll / tabPage（L119-306）</td><td>~190</td></tr><tr><td><code>legacy/_si-detail.scss</code></td><td>出口单证详情（<code>index.scss</code> L50-105）</td><td>~55</td></tr><tr><td><code>legacy/_marketing.scss</code></td><td>营销模块（L308-373, L418-438）</td><td>~70</td></tr><tr><td>删除</td><td><code>.container-selected-row</code>（箱管选中行）→ 迁移到对应组件 scoped</td><td>~8</td></tr></tbody></table>
<h4 data-id="heading-26"><code>styles/index.scss</code>（126 行）→ 拆分为：</h4>

























<table><thead><tr><th>目标文件</th><th>内容</th></tr></thead><tbody><tr><td><code>vendors/_nprogress.scss</code></td><td>NProgress 主题色适配（L22-38）</td></tr><tr><td><code>overrides/_form.scss</code></td><td>append-click-input（L39-49）</td></tr><tr><td><code>legacy/_si-detail.scss</code></td><td>si-detail-dialog / si-detail-tabs（L50-105）</td></tr><tr><td>删除</td><td><code>.reset-margin</code>、<code>.el-popup-parent--hidden</code>、<code>.el-scrollbar__bar</code> → 评估是否仍需要</td></tr></tbody></table>
<h4 data-id="heading-27"><code>styles/dark.css</code>（85 行）→ 迁移到：</h4>













<table><thead><tr><th>目标文件</th><th>说明</th></tr></thead><tbody><tr><td><code>themes/_dark.scss</code></td><td>完整保留暗色主题变量，清理注释掉的废代码</td></tr></tbody></table>
<h4 data-id="heading-28"><code>styles/dialog.scss</code>（17 行）→ 迁移到：</h4>













<table><thead><tr><th>目标文件</th><th>说明</th></tr></thead><tbody><tr><td><code>overrides/_dialog.scss</code></td><td>弹窗尺寸规范</td></tr></tbody></table>
<h3 data-id="heading-29">5.3 @cmclink/ui 需要调整的部分</h3>





















<table><thead><tr><th>文件</th><th>调整内容</th></tr></thead><tbody><tr><td><code>styles/index.scss</code></td><td>移除 <code>@use 'tailwindcss'</code>，Tailwind 只在应用层引入</td></tr><tr><td><code>styles/animations.scss</code></td><td>清理与 Tailwind 重复的工具类（<code>.translate-*</code>、<code>.scale-*</code>、<code>.rotate-*</code>、<code>.duration-*</code> 等约 800 行）</td></tr><tr><td><code>styles/utilities.scss</code></td><td>保留 <code>cmc-*</code> 前缀的工具类，删除与 Tailwind 重复的部分</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-30">六、实施步骤</h2>
<h3 data-id="heading-31">Phase 1：基础清理（低风险，可立即执行）</h3>
<p><strong>预计耗时</strong>：1-2 小时</p>
<ol>
<li>
<p><strong>创建新目录结构</strong></p>
<ul>
<li>创建 <code>styles/tokens/</code>、<code>styles/themes/</code>、<code>styles/overrides/</code>、<code>styles/layout/</code>、<code>styles/vendors/</code>、<code>styles/legacy/</code></li>
</ul>
</li>
<li>
<p><strong>创建 <code>styles/tailwind.css</code></strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;
</code></pre>
</li>
<li>
<p><strong>删除废文件</strong></p>
<ul>
<li><code>styles/theme.scss</code>（空文件）</li>
</ul>
</li>
<li>
<p><strong>统一主色</strong></p>
<ul>
<li>与设计团队确认最终主色值</li>
<li>更新所有硬编码颜色为 CSS 变量引用</li>
</ul>
</li>
</ol>
<h3 data-id="heading-32">Phase 2：文件拆分迁移（中风险，需逐步验证）</h3>
<p><strong>预计耗时</strong>：3-4 小时</p>
<ol>
<li><strong>拆分 <code>resizeStyle.scss</code></strong>（632 行 → 8 个文件）</li>
<li><strong>拆分 <code>var.css</code></strong>（布局变量 → <code>tokens/_css-variables.scss</code>）</li>
<li><strong>迁移 <code>dark.css</code></strong> → <code>themes/_dark.scss</code></li>
<li><strong>迁移 <code>dialog.scss</code></strong> → <code>overrides/_dialog.scss</code></li>
<li><strong>拆分 <code>index.scss</code></strong>（NProgress → vendors，业务 → legacy）</li>
<li><strong>创建新的 <code>styles/index.scss</code> 入口文件</strong></li>
</ol>
<h3 data-id="heading-33">Phase 3：入口重构（高风险，需完整回归测试）</h3>
<p><strong>预计耗时</strong>：1-2 小时</p>
<ol>
<li>
<p><strong>修改 <code>main.ts</code></strong></p>
<ul>
<li>移除 <code>import './assets/main.css'</code></li>
<li>移除 <code>import './assets/styles/micro-app.css'</code></li>
<li>添加 <code>import './styles/index.scss'</code></li>
<li>调整 <code>@cmclink/ui/styles</code> 的导入顺序</li>
</ul>
</li>
<li>
<p><strong>删除旧文件</strong></p>
<ul>
<li><code>assets/main.css</code></li>
<li><code>assets/base.css</code></li>
<li><code>assets/styles/micro-app.css</code></li>
<li><code>assets/styles/</code> 目录</li>
</ul>
</li>
<li>
<p><strong>完整回归测试</strong></p>
<ul>
<li>登录页样式</li>
<li>主布局（侧边栏、顶部导航、标签页）</li>
<li>表格页面（筛选框、表格、分页）</li>
<li>弹窗/抽屉</li>
<li>暗色主题切换</li>
<li>子应用加载和样式隔离</li>
</ul>
</li>
</ol>
<h3 data-id="heading-34">Phase 4：微前端隔离优化（需子应用配合）</h3>
<p><strong>预计耗时</strong>：2-3 小时（每个子应用）</p>
<ol>
<li>
<p><strong>子应用配置弹窗不逃逸</strong></p>
<ul>
<li>全局配置 <code>:teleported="false"</code> 或 <code>append-to</code></li>
<li>在 <code>@cmclink/micro-bootstrap</code> 中提供统一配置能力</li>
</ul>
</li>
<li>
<p><strong>删除 <code>micro-app.css</code></strong></p>
</li>
<li>
<p><strong>验证子应用样式隔离</strong></p>
<ul>
<li>主应用样式不侵入子应用</li>
<li>子应用样式不泄漏到主应用</li>
<li>弹窗/抽屉样式正确</li>
</ul>
</li>
</ol>
<h3 data-id="heading-35">Phase 5：@cmclink/ui 优化（独立进行）</h3>
<p><strong>预计耗时</strong>：2-3 小时</p>
<ol>
<li><strong>移除 Tailwind CSS 引入</strong>（从 <code>@cmclink/ui/styles/index.scss</code>）</li>
<li><strong>清理 <code>animations.scss</code></strong> 中与 Tailwind 重复的工具类（约 800 行）</li>
<li><strong>审查 <code>utilities.scss</code></strong> 中与 Tailwind 重复的部分</li>
</ol>
<hr/>
<h2 data-id="heading-36">七、风险评估与回退方案</h2>
<h3 data-id="heading-37">7.1 风险点</h3>



































<table><thead><tr><th>风险</th><th>概率</th><th>影响</th><th>缓解措施</th></tr></thead><tbody><tr><td><code>styles/index.scss</code> 未被引用但样式实际生效</td><td>低</td><td>高</td><td>先在浏览器 DevTools 确认哪些样式实际生效</td></tr><tr><td>拆分后样式加载顺序变化导致覆盖失效</td><td>中</td><td>中</td><td>严格按照原有顺序组织 <code>@use</code></td></tr><tr><td>子应用弹窗 <code>:teleported="false"</code> 导致层级问题</td><td>中</td><td>中</td><td>逐个子应用测试，必要时用 <code>z-index</code> 调整</td></tr><tr><td>删除 <code>base.css</code> 后某些页面样式异常</td><td>低</td><td>中</td><td><code>@cmclink/ui/base.scss</code> 已覆盖所有 reset</td></tr></tbody></table>
<h3 data-id="heading-38">7.2 回退方案</h3>
<p>每个 Phase 独立提交 Git，如果出现问题可以精确回退到任意阶段：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">feat</span>(styles): phase-<span class="hljs-number">1</span> 基础清理和目录结构
<span class="hljs-built_in">feat</span>(styles): phase-<span class="hljs-number">2</span> 文件拆分迁移
<span class="hljs-built_in">feat</span>(styles): phase-<span class="hljs-number">3</span> 入口重构
<span class="hljs-built_in">feat</span>(styles): phase-<span class="hljs-number">4</span> 微前端隔离优化
<span class="hljs-built_in">feat</span>(styles): phase-<span class="hljs-number">5</span> @cmclink/ui 优化
</code></pre>
<hr/>
<h2 data-id="heading-39">八、验证清单</h2>
<h3 data-id="heading-40">8.1 样式正确性</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 登录页样式正常（背景、表单、按钮）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 主布局样式正常（侧边栏展开/收起、顶部导航、面包屑）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 标签页样式正常（激活态、hover、关闭按钮）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 表格页面样式正常（筛选框、表头、行、分页）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 弹窗/抽屉样式正常（大/中/小尺寸）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 表单样式正常（输入框、下拉框、日期选择器）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 按钮样式正常（主要、链接、危险、禁用）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> NProgress 进度条颜色正确</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 暗色主题切换正常</li>
</ul>
<h3 data-id="heading-41">8.2 微前端隔离</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 子应用加载后样式正常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 主应用样式未侵入子应用</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 子应用样式未泄漏到主应用</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 子应用弹窗样式正确（不逃逸到主应用 body）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 多个子应用切换时样式无残留</li>
</ul>
<h3 data-id="heading-42">8.3 构建产物</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 构建无报错</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> CSS 产物体积不增长（预期减少 30%+）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 无重复的 Tailwind CSS 输出</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 无重复的 CSS Reset</li>
</ul>
<h3 data-id="heading-43">8.4 开发体验</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> HMR 样式热更新正常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 新增样式时知道该放在哪个文件</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> SCSS 变量和 CSS 变量可正常引用</li>
</ul>
<hr/>
<h2 data-id="heading-44">九、预期收益</h2>













































<table><thead><tr><th>维度</th><th>现状</th><th>重构后</th></tr></thead><tbody><tr><td><strong>CSS 产物体积</strong></td><td>Tailwind ×2 + Reset ×2 + 大量重复</td><td>减少约 30-40%</td></tr><tr><td><strong>样式文件数</strong></td><td>散落 3 个目录，8+ 个文件</td><td>1 个目录，清晰分层</td></tr><tr><td><strong>入口文件</strong></td><td>main.ts 导入 2 个样式文件 + 隐式依赖</td><td>main.ts 导入 1 个入口</td></tr><tr><td><strong>新人上手</strong></td><td>不知道样式该写在哪</td><td>5 分钟理解结构</td></tr><tr><td><strong>微前端隔离</strong></td><td>!important 硬覆盖</td><td>wujie 沙箱天然隔离</td></tr><tr><td><strong>主色一致性</strong></td><td>3 处定义，2 个不同值</td><td>1 处定义，全局统一</td></tr><tr><td><strong>!important 使用</strong></td><td>泛滥</td><td>仅在必要的 EP 覆盖中使用</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今天的CentOS 7如何配置Zabbix]]></title>    <link>https://juejin.cn/post/7604964464689528895</link>    <guid>https://juejin.cn/post/7604964464689528895</guid>    <pubDate>2026-02-10T10:24:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604964464689528895" data-draft-id="7604757482004037695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今天的CentOS 7如何配置Zabbix"/> <meta itemprop="keywords" content="Zabbix,Linux,CentOS"/> <meta itemprop="datePublished" content="2026-02-10T10:24:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sheffield"/> <meta itemprop="url" content="https://juejin.cn/user/362164852109770"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今天的CentOS 7如何配置Zabbix
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/362164852109770/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sheffield
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:24:31.000Z" title="Tue Feb 10 2026 10:24:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>CentOS 7自带的PHP5.4、MariaDB 5.5版本甚至无法满足Zabbix 5的运行要求，本文完整梳理从基础环境升级到Zabbix 6部署、核心踩坑解决的全流程，适合快速上手。</p>
<h3 data-id="heading-0">一、环境升级：替换默认YUM源，安装高版本依赖</h3>
<h4 data-id="heading-1">1. 升级PHP至7.2</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装EPEL扩展源</span>
yum install -y epel-release

<span class="hljs-comment"># 安装REMI源（CentOS 7专属）</span>
yum install -y https://rpms.remirepo.net/enterprise/remi-release-7.rpm

<span class="hljs-comment"># 安装yum源管理工具（用于切换PHP版本）</span>
yum install -y yum-utils

<span class="hljs-comment"># 启用PHP7.2源（关闭默认5.4源）</span>
yum-config-manager --<span class="hljs-built_in">enable</span> remi-php72

<span class="hljs-comment"># 安装PHP7.2核心包及Zabbix依赖扩展</span>
yum install -y php php-cli php-fpm php-mysqlnd php-zip php-devel php-gd php-mcrypt php-mbstring php-curl php-xml php-pear php-bcmath php-json

<span class="hljs-comment"># 验证PHP版本（输出7.2.x即为成功）</span>
php -v

<span class="hljs-comment"># 启动并设置PHP-FPM开机自启</span>
systemctl start php-fpm
systemctl <span class="hljs-built_in">enable</span> php-fpm
</code></pre>
<h4 data-id="heading-2">2. 升级MariaDB至10.6</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建MariaDB自定义YUM源</span>
cat &gt; /etc/yum.repos.d/MariaDB.repo &lt;&lt; 'EOF'
<span class="hljs-section">[mariadb]</span>
<span class="hljs-attr">name</span> = MariaDB
<span class="hljs-attr">baseurl</span> = https://mirrors.ustc.edu.cn/mariadb/yum/<span class="hljs-number">10.6</span>/centos7-amd64
<span class="hljs-attr">gpgkey</span> = https://mirrors.ustc.edu.cn/mariadb/yum/RPM-GPG-KEY-MariaDB
<span class="hljs-attr">gpgcheck</span> = <span class="hljs-number">1</span>
<span class="hljs-attr">enabled</span> = <span class="hljs-number">1</span>
EOF

<span class="hljs-comment"># 清理缓存并重建</span>
yum clean all &amp;&amp; yum makecache fast

<span class="hljs-comment"># 安装MariaDB服务端和客户端</span>
yum install -y MariaDB-server MariaDB-client

<span class="hljs-comment"># 启动并设置开机自启</span>
systemctl start mariadb
systemctl enable mariadb
</code></pre>
<h3 data-id="heading-3">二、Zabbix 6.0 安装与数据库配置</h3>
<h4 data-id="heading-4">1. 安装Zabbix官方源及核心组件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装Zabbix 6.0 YUM源（CentOS 7 版本）</span>
rpm -Uvh https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-4.el7.noarch.rpm

<span class="hljs-comment"># 清理缓存</span>
yum clean all

<span class="hljs-comment"># 安装Zabbix核心组件（服务端+Web端+Agent+SQL脚本）</span>
yum install -y zabbix-server-mysql zabbix-web-mysql zabbix-sql-scripts zabbix-agent
</code></pre>
<h4 data-id="heading-5">2. 创建Zabbix数据库并导入初始化脚本</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 登录MySQL</span>
mysql -uroot -p

<span class="hljs-comment"># 1. 创建zabbix数据库</span>
<span class="hljs-variable constant_">CREATE</span> <span class="hljs-variable constant_">DATABASE</span> <span class="hljs-variable constant_">IF</span> <span class="hljs-variable constant_">NOT</span> <span class="hljs-variable constant_">EXISTS</span> zabbix <span class="hljs-variable constant_">CHARACTER</span> <span class="hljs-variable constant_">SET</span> utf8mb4 <span class="hljs-variable constant_">COLLATE</span> utf8mb4_bin;

<span class="hljs-comment"># 2. 创建zabbix用户，仅允许本地访问（我密码设为zabbix）</span>
<span class="hljs-variable constant_">CREATE</span> <span class="hljs-variable constant_">USER</span> <span class="hljs-variable constant_">IF</span> <span class="hljs-variable constant_">NOT</span> <span class="hljs-variable constant_">EXISTS</span> <span class="hljs-string">'zabbix'</span>@<span class="hljs-string">'localhost'</span> <span class="hljs-variable constant_">IDENTIFIED</span> <span class="hljs-variable constant_">BY</span> <span class="hljs-string">'zabbix'</span>;

<span class="hljs-comment"># 3. 授予zabbix用户数据库全部权限</span>
<span class="hljs-variable constant_">GRANT</span> <span class="hljs-variable constant_">ALL</span> <span class="hljs-variable constant_">PRIVILEGES</span> <span class="hljs-variable constant_">ON</span> zabbix.* <span class="hljs-variable constant_">TO</span> <span class="hljs-string">'zabbix'</span>@<span class="hljs-string">'localhost'</span>;

<span class="hljs-comment"># 4. 刷新权限</span>
<span class="hljs-variable constant_">FLUSH</span> <span class="hljs-variable constant_">PRIVILEGES</span>;

<span class="hljs-comment"># 5. 退出MySQL</span>
<span class="hljs-variable constant_">EXIT</span>;

<span class="hljs-comment"># 导入Zabbix初始化脚本（按顺序执行）</span>
<span class="hljs-comment"># 第一步：导入表结构</span>
mysql -u zabbix -p zabbix &lt; <span class="hljs-regexp">/usr/share</span><span class="hljs-regexp">/zabbix-mysql/schema</span>.sql
<span class="hljs-comment"># 第二步：导入图片资源</span>
mysql -u zabbix -p zabbix &lt; <span class="hljs-regexp">/usr/share</span><span class="hljs-regexp">/zabbix-mysql/images</span>.sql
<span class="hljs-comment"># 第三步：导入初始数据（默认用户/权限等）</span>
mysql -u zabbix -p zabbix &lt; <span class="hljs-regexp">/usr/share</span><span class="hljs-regexp">/zabbix-mysql/data</span>.sql
<span class="hljs-comment"># 执行时输入密码：zabbix</span>
</code></pre>
<h3 data-id="heading-6">三、PHP与Apache配置优化</h3>
<h4 data-id="heading-7">1. 配置Zabbix Web的PHP核心参数</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑Zabbix Apache配置文件</span>
vim /etc/httpd/conf.d/zabbix.conf
</code></pre>
<p>在<code>&lt;Directory "/usr/share/zabbix"&gt;</code>区块内新增以下 PHP 配置（关键是时区和资源限制）：</p>
<pre><code class="hljs language-php" lang="php">&lt;<span class="hljs-built_in">Directory</span> <span class="hljs-string">"/usr/share/zabbix"</span>&gt;
    <span class="hljs-comment"># 保留原有配置不变</span>
    &lt;IfModule php_module&gt;
        php_value max_execution_time <span class="hljs-number">300</span>      <span class="hljs-comment"># 最大执行时间</span>
        php_value memory_limit <span class="hljs-number">128</span>M           <span class="hljs-comment"># 内存限制</span>
        php_value post_max_size <span class="hljs-number">16</span>M           <span class="hljs-comment"># POST数据最大值</span>
        php_value upload_max_filesize <span class="hljs-number">2</span>M      <span class="hljs-comment"># 文件上传限制</span>
        php_value max_input_time <span class="hljs-number">300</span>          <span class="hljs-comment"># 输入数据最大解析时间</span>
        php_value max_input_vars <span class="hljs-number">10000</span>        <span class="hljs-comment"># 最大输入变量数</span>
        php_value date.timezone Asia/Shanghai <span class="hljs-comment"># 核心：设置中国时区</span>
    &lt;/IfModule&gt;
    <span class="hljs-comment"># 保留原有配置不变</span>
&lt;/<span class="hljs-built_in">Directory</span>&gt;
</code></pre>
<h4 data-id="heading-8">2. 配置PHP-FPM的Zabbix专属参数</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑PHP-FPM的Zabbix配置文件</span>
vi /etc/php-fpm.d/zabbix.conf
</code></pre>
<p>添加以下内容（指定运行用户和时区）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">listen.acl_users</span> = apache                  <span class="hljs-comment"># 允许apache用户访问PHP-FPM</span>
php_value<span class="hljs-section">[date.timezone]</span> = Asia/Shanghai   <span class="hljs-comment"># 同步时区配置</span>
</code></pre>
<h4 data-id="heading-9">3. 重启服务使配置生效</h4>
<pre><code class="hljs">systemctl restart httpd php-fpm
</code></pre>
<h3 data-id="heading-10">四、Zabbix Server配置与核心踩坑解决</h3>
<h4 data-id="heading-11">1. 配置Zabbix Server数据库连接</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑Zabbix Server配置文件</span>
vim /etc/zabbix/zabbix_server.conf
</code></pre>
<p>找到以下配置项，取消注释并填写数据库密码：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">DBName</span>=zabbix        <span class="hljs-comment"># 数据库名（默认无需修改）</span>
<span class="hljs-attr">DBUser</span>=zabbix        <span class="hljs-comment"># 数据库用户（默认无需修改）</span>
<span class="hljs-attr">DBPassword</span>=zabbix    <span class="hljs-comment"># 取消注释，填写之前设置的数据库密码</span>
</code></pre>
<h4 data-id="heading-12">2. 解决 Web 安装页面循环问题</h4>
<p><strong>问题现象</strong>：访问<code>http://服务器IP/zabbix/setup.php</code>完成配置后，始终跳回安装页面，无法进入 Zabbix 控制台。</p>
<p><strong>问题原因</strong>：Zabbix 6.0 官方文档标注配置文件路径为<code>/usr/share/zabbix/etc/zabbix/web</code>，但实际程序会优先读取<code>/etc/zabbix/web</code>目录下的配置文件，导致配置未生效。</p>
<p><strong>解决方法</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建/etc/zabbix/web目录（若不存在）</span>
<span class="hljs-built_in">mkdir</span> -p /etc/zabbix/web

<span class="hljs-comment"># 复制默认配置文件到实际读取路径</span>
<span class="hljs-built_in">cp</span> /usr/share/zabbix/etc/zabbix/web/zabbix.conf.php /etc/zabbix/web/

<span class="hljs-comment"># 设置配置文件权限（确保所有用户可读取）</span>
<span class="hljs-built_in">chmod</span> 644 /etc/zabbix/web/zabbix.conf.php

<span class="hljs-comment"># 重启Zabbix Server和相关服务</span>
systemctl restart zabbix-server httpd php-fpm
</code></pre>
<h4 data-id="heading-13">3. 启动Zabbix Agent并设置开机自启</h4>
<pre><code class="hljs language-bash" lang="bash">systemctl start zabbix-agent
systemctl <span class="hljs-built_in">enable</span> zabbix-agent
</code></pre>
<h3 data-id="heading-14">五、访问验证</h3>
<ol>
<li>
<p>浏览器访问<code>http://服务器IP/zabbix</code>，使用默认账号密码登录：</p>
<ul>
<li>账号：Admin</li>
<li>密码：zabbix</li>
</ul>
</li>
</ol>
<h3 data-id="heading-15">总结</h3>
<ol>
<li>CentOS 7需通过 REMI 源升级PHP至 7.2、MariaDB官方源升级至10.6，才能满足Zabbix 6.0 的运行要求；</li>
<li>Zabbix数据库必须使用<code>utf8mb4</code>字符集，避免中文乱码问题；</li>
<li>Web安装页面循环的核心解决方法是将Zabbix配置文件复制到<code>/etc/zabbix/web</code>目录，并确保644权限。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026年2月了，MCP和Skills不要再分不清了]]></title>    <link>https://juejin.cn/post/7605030650279002158</link>    <guid>https://juejin.cn/post/7605030650279002158</guid>    <pubDate>2026-02-10T10:35:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605030650279002158" data-draft-id="7604761524977975305" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026年2月了，MCP和Skills不要再分不清了"/> <meta itemprop="keywords" content="后端,GitHub"/> <meta itemprop="datePublished" content="2026-02-10T10:35:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="超级东哥CyberFD"/> <meta itemprop="url" content="https://juejin.cn/user/4323692639162087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026年2月了，MCP和Skills不要再分不清了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4323692639162087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    超级东哥CyberFD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:35:04.000Z" title="Tue Feb 10 2026 10:35:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一. 前言</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33542fd82216444f82825a1121e56796~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5Lic5ZOlQ3liZXJGRA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324509&amp;x-signature=7s5QhuFe9cEROO%2By66l66MsIhQ8%3D" alt="image.png" loading="lazy"/></p>
<p>最近Skills已经火了2个月了，看到很多人对MCP和Skills理解都各有不同，现在AI发展都是按照日来更新，知识的沉淀也需要跟上步伐，抓紧时间写一篇文章，谈一谈我对MCP和Skills的理解，沉淀沉淀～</p>
<blockquote>
<p>MCP 其实是协议，Agent借助MCP协议可以接入各种工具，让Agent获得了能力</p>
<p>Agent Skills 更像一种规范，通过这套规范，让 Agent 可以知道自己有哪些 Skills 可用，需要的时候去按需加载 Skill 的细节，知识可以作为 Skill 的一部分、Skills 可以指导 Agent 去调用 MCP 工具或者其他脚本</p>
</blockquote>
<h2 data-id="heading-1">二. MCP：连接世界的“管道”协议</h2>
<ul>
<li>
<p><strong>核心职能：标准化连接。</strong></p>
<p>MCP 解决的是最基础、最繁杂的“方言”问题。在没有 MCP 之前，Agent 要连接数据库需要一套代码，连接 Slack 需要另一套代码，读取本地文件又要一套代码。MCP 统一定义了 Agent (Client) 和外部能力 (Server) 之间如何握手、如何列出可用工具、如何发送请求、如何接收响应。</p>
</li>
<li>
<p><strong>它提供了什么？</strong></p>
<p>它提供了通用的“原子能力”（Atomic Capabilities）。MCP Server 暴露出来的是一个个具体的 <code>Resources</code>（资源，如文件内容）、<code>Prompts</code>（预设提示词）和 <code>Tools</code>（可执行函数，如“执行SQL查询”）。</p>
</li>
<li>
<p><strong>它的局限性：</strong></p>
<p>MCP 本身是“哑”的。它只负责把工具送达给 Agent，但它不负责告诉 Agent <strong>在什么场景下、以什么顺序、组合哪些工具</strong>来解决一个复杂问题。</p>
</li>
</ul>
<blockquote>
<p><strong>类比：</strong> MCP 就像是 <strong>USB 协议</strong>。只要符合 USB 标准，鼠标插上电脑就能通电、能传输信号。但 USB 协议本身并不知道这个鼠标是用来打游戏的还是用来做设计的。</p>
</blockquote>
<h2 data-id="heading-2">三. Agent Skills：能力的“说明书”与“指挥棒”</h2>
<p>Skills 是在原子工具之上构建的更高层次的抽象。</p>
<ul>
<li>
<p><strong>核心职能：封装与编排。</strong></p>
<p>Skill 是为了完成某个特定任务（Task）而对知识、逻辑和工具的打包。一个 Skill 可能包含了一段特定的业务知识（比如税务法规），然后指导 Agent 去调用底层的 MCP 工具（比如“搜索工具”和“计算器工具”）来得出一个结论。</p>
</li>
<li>
<p><strong>它提供了什么？</strong></p>
<ul>
<li>
<p><strong>元数据与发现机制 (Discovery)：</strong> Skill 规范首先定义了 Skill 的名称、描述、适用场景的 Trigger（触发器）。这让 Agent 在面对用户问题时，能快速检索到“我应该用哪个 Skill”。</p>
</li>
<li>
<p><strong>按需加载 (On-demand Loading)：</strong> 这是企业级 Agent 的关键。一个强大的 Agent可能有上千种能力，不可能每次对话都把所有能力的 prompt 和逻辑全部加载到上下文中（Context Window 会爆炸）。Skill 规范允许 Agent 只加载“目录”，确定要用某个 Skill 后，再动态加载其详细的执行逻辑（Execution details）。</p>
</li>
<li>
<p><strong>知识融合 (Knowledge Inclusion)：</strong> 如你所言，Skill 不仅仅是动作，还包含知识。比如一个“撰写法律合同 Skill”，它内部包含了合同模板的知识，它会指导 Agent 去调用 MCP 工具填充内容。</p>
</li>
</ul>
</li>
<li>
<p><strong>它的局限性：</strong></p>
<p>Skills 需要依赖底层的执行机制。它最终落地干活，往往还得靠调用 MCP 工具、API 或运行本地脚本。</p>
</li>
</ul>
<blockquote>
<p><strong>类比：</strong> Agent Skills 就像是电脑里的 <strong>“应用程序”或“驱动程序”</strong> 。Photoshop (一个 Skill) 知道它的目的是修图，它知道在用户点击“裁剪”时，需要去调用鼠标 (通过 USB/MCP 协议连接的工具) 的坐标数据来完成操作。</p>
</blockquote>
<h2 data-id="heading-3">四. 二者的协同工作流 (The Synergy)</h2>
<p>我们可以通过一个具体的例子来看看这两层是如何配合的。</p>
<p><strong>场景：用户问 Agent：“帮我查一下上个月 阿里云 的 账单是不是超支了？”</strong></p>
<ol>
<li>
<p><strong>Agent 思考 (基于 Skills 规范层)：</strong></p>
<ul>
<li>Agent 接收到请求，扫描自己已注册的 <strong>Agent Skills 目录</strong>。</li>
<li>它根据语义匹配，找到了一个名为 <code>AliCloud_Cost_Analyzer</code> 的 Skill。</li>
<li>Agent <strong>按需加载</strong>了这个 Skill 的详细规范。</li>
<li>Skill 的规范告诉 Agent：“要完成这个任务，你需要分两步：第一，获取上月账单数据；第二，对比预算标准进行分析。”</li>
</ul>
</li>
<li>
<p><strong>Agent 执行 (调用 MCP 协议层)：</strong></p>
<ul>
<li>在 Skill 的指导下，Agent 知道第一步需要数据。它查找已连接的 MCP Servers。</li>
<li>它发现了一个 <code>AliCloud_Integration_Server</code> (通过 MCP 协议连接)。</li>
<li>Agent 通过 MCP 协议向该 Server 发送请求，调用其中的 <code>get_cost_and_usage</code> 工具 (Tool)。</li>
<li>MCP Server 返回了 JSON 格式的账单数据。</li>
</ul>
</li>
<li>
<p><strong>Agent 回归 Skills 逻辑：</strong></p>
<ul>
<li>拿到数据后，Skill 的后续逻辑可能是：“现在调用内置的代码解释器脚本，计算是否超过了预设的 $500 阈值，并生成总结报告。”</li>
<li>Agent 完成计算并最终回复用户。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-4">五. 总结</h2>
<p>最后用一张图来总结一下我们这篇文章</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31bae75a66a74ea88122e00405fd47a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5Lic5ZOlQ3liZXJGRA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771324509&amp;x-signature=SpZ8hNanCNx69KwwLqXUXUzGXcw%3D" alt="Gemini_Generated_Image_a4y232a4y232a4y2.png" loading="lazy"/></p>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>MCP (协议层)</strong></th><th><strong>Agent Skills (规范/应用层)</strong></th></tr></thead><tbody><tr><td><strong>关注点</strong></td><td><strong>Connectivity (连接性)</strong> ：如何稳定地对话和传输数据。</td><td><strong>Capability &amp; Orchestration (能力与编排)</strong> ：做什么任务，怎么组合工具。</td></tr><tr><td><strong>抽象级别</strong></td><td>低级、技术性、原子化工具。</td><td>高级、语义化、任务导向。</td></tr><tr><td><strong>主要载体</strong></td><td>Server, Client, Protocol, Transport.</td><td>Metadata, Triggers, Logic, Knowledge.</td></tr><tr><td><strong>加载方式</strong></td><td>通常连接时全量暴露工具定义。</td><td>目录式检索，详细逻辑按需加载。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[即梦Seedance 2.0喂饭教程]]></title>    <link>https://juejin.cn/post/7604791354259177510</link>    <guid>https://juejin.cn/post/7604791354259177510</guid>    <pubDate>2026-02-10T10:37:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604791354259177510" data-draft-id="7605030650278953006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="即梦Seedance 2.0喂饭教程"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-10T10:37:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可夫小子"/> <meta itemprop="url" content="https://juejin.cn/user/1878415577453223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            即梦Seedance 2.0喂饭教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1878415577453223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可夫小子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:37:27.000Z" title="Tue Feb 10 2026 10:37:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>💡 大家好，我是可夫小子，《小白玩转ChatGPT》专栏作者，关注AIGC、n8n和自媒体。</p>
</blockquote>
<p>最近很火的视频生成模型莫过于字节跳动的Seedance 2.0，千万博主影视飓风Tim第一时间进行测试，他以专业的导演视角来分析，得出的结论就是：<strong>AI可能没这么快替代人，但它进化的速度可能超出你的想象</strong>。到底如何，今天来试试。</p>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/3a33dfe37a8e901a67d84bd0e1ec8c5a.png" alt="image.png" loading="lazy"/></p>
<p><strong>官方网站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjimeng.jianying.com%2F" target="_blank" title="https://jimeng.jianying.com/" ref="nofollow noopener noreferrer">jimeng.jianying.com/</a></p>
<p><strong>核心升级</strong>：支持图像、视频、音频、文本四种模态输入，表达更丰富，生成更可控</p>
<hr/>
<h3 data-id="heading-0">一、核心特性</h3>
<h4 data-id="heading-1">✨ 多模态输入</h4>
<ul>
<li>📷 <strong>图像参考</strong>：精准还原画面构图、角色细节</li>
<li>🎥 <strong>视频参考</strong>：支持镜头语言、复杂动作节奏、创意特效复刻</li>
<li>🎵 <strong>音频参考</strong>：带起节奏氛围，支持配乐/音效</li>
<li>✍️ <strong>文本提示</strong>：自然语言描述创意</li>
</ul>
<h4 data-id="heading-2">🎯 三大亮点</h4>
<ol>
<li><strong>参考能力强大</strong>：可参考任何素材的动作、特效、运镜、声音</li>
<li><strong>连续创作</strong>：视频支持平滑延长与衔接，可按提示生成连续镜头</li>
<li><strong>编辑能力</strong>：支持对已有视频进行角色更替、删减、增加</li>
</ol>
<hr/>
<h3 data-id="heading-3">二、参数规格</h3>
<h4 data-id="heading-4">📥 输入限制</h4>








































<table><thead><tr><th>模态类型</th><th>格式</th><th>数量/时长</th><th>大小限制</th><th>备注</th></tr></thead><tbody><tr><td><strong>图片</strong></td><td>jpeg/png/webp/bmp/tiff/gif</td><td>≤ 9 张</td><td>&lt; 30 MB</td><td>-</td></tr><tr><td><strong>视频</strong></td><td>mp4/mov</td><td>≤ 3 个，总时长 2-15s</td><td>&lt; 50 MB</td><td>像素范围：480p-720p</td></tr><tr><td><strong>音频</strong></td><td>mp3/wav</td><td>≤ 3 个，总时长 ≤ 15s</td><td>&lt; 15 MB</td><td>-</td></tr><tr><td><strong>文本</strong></td><td>自然语言</td><td>-</td><td>-</td><td>-</td></tr></tbody></table>
<blockquote>
<p>⚠️ <strong>重要提示</strong>：</p>
<ul>
<li>混合输入总上限：<strong>12 个文件</strong></li>
<li>建议优先上传对画面/节奏影响最大的素材</li>
<li><strong>暂不支持上传写实真人脸部素材</strong>（平台合规要求）</li>
</ul>
</blockquote>
<h4 data-id="heading-5">📤 输出规格</h4>
<ul>
<li>⏱ <strong>生成时长</strong>：4-15秒可自由选择</li>
<li>🔊 <strong>声音输出</strong>：自带音效/配乐</li>
</ul>
<hr/>
<h3 data-id="heading-6">三、使用方法</h3>
<h4 data-id="heading-7">1️⃣ 入口选择</h4>
<ul>
<li>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjimeng.jianying.com%2F" target="_blank" title="https://jimeng.jianying.com/" ref="nofollow noopener noreferrer">jimeng.jianying.com/</a>，已支持Seedance 2.0。</li>
<li>我在豆包中，使用话术也能调用：<code>用Seedance 2.0生成一个邵氏电影风格的打斗视频</code> ，也可以让豆包一步一步优化你的提示词。</li>
</ul>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/bab8acafdb1798a6449481777b560746.png" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">2️⃣ 素材上传</h4>
<ol>
<li>选择入口（Seedance 2.0 - 全能参考/首尾帧）</li>
<li>点击上传，选择本地文件</li>
<li>在全能参考模式下通过 <code>@素材名</code> 指定用途</li>
</ol>
<h4 data-id="heading-9">3️⃣ @引用方式</h4>
<pre><code class="hljs language-plain" lang="plain">示例：
@图片1 作为首帧
@视频1 参考镜头语言
@音频1 用于配乐
</code></pre>
<h4 data-id="heading-10">4️⃣ 特殊用法</h4>
<ul>
<li><strong>延长视频</strong>：<code>将@视频1延长 5s</code>（生成时长也选 5s）</li>
<li><strong>融合视频</strong>：<code>在@视频1和@视频2之间加一个场景，内容为xxx</code></li>
<li><strong>连续动作</strong>：<code>@图1@图2@图3...，角色从跳跃直接过渡到翻滚</code></li>
<li><strong>首帧+动作参考</strong>：<code>@图1为首帧，参考@视频1的打斗动作</code></li>
</ul>
<hr/>
<h3 data-id="heading-11">四、核心能力展示</h3>
<h4 data-id="heading-12">1. 🎬 基础能力全面增强</h4>
<p><strong>关键词</strong>：更稳、更顺、更真实</p>
<ul>
<li>✅ 物理规律更合理</li>
<li>✅ 动作表现更自然流畅</li>
<li>✅ 指令理解更精准</li>
<li>✅ 风格保持更稳定</li>
</ul>
<p><strong>典型场景</strong>：</p>
<ul>
<li>复杂动作（晒衣服、拿可乐等细节动作）</li>
<li>超强真实感（街头场景、逃亡追逐）</li>
<li>连续运动（人物奔跑、车辆驾驶）</li>
</ul>
<hr/>
<h4 data-id="heading-13">2. 🎯 一致性全面提升</h4>
<p><strong>解决痛点</strong>：</p>
<ul>
<li>❌ 人物前后长得不一样</li>
<li>❌ 商品细节丢失</li>
<li>❌ 场景跳变</li>
<li>❌ 镜头风格无法统一</li>
</ul>
<p><strong>应用场景</strong>：</p>
<ul>
<li>👤 <strong>人脸一致性</strong>：多镜头保持角色面容、服装统一</li>
<li>🏢 <strong>场景一致性</strong>：多场景切换保持风格连贯</li>
<li>🛍️ <strong>商品一致性</strong>：产品细节（Logo、材质）精准还原</li>
<li>🎨 <strong>风格一致性</strong>：艺术风格（水墨、科幻）全程稳定</li>
</ul>
<hr/>
<h4 data-id="heading-14">3. 🎥 高难度运镜与动作复刻</h4>
<p><strong>能力</strong>：精准模仿电影级运镜和复杂动作</p>
<p><strong>典型应用</strong>：</p>
<ul>
<li>📹 <strong>希区柯克变焦</strong>：电梯惊悚场景</li>
<li>🔄 <strong>360度环绕</strong>：机械臂多角度跟拍</li>
<li>🏃 <strong>跟随镜头</strong>：追逐、奔跑流畅跟拍</li>
<li>🎪 <strong>舞蹈动作</strong>：参考视频复刻舞蹈节奏</li>
<li>⚔️ <strong>打斗场面</strong>：武打动作、镜头语言双重复刻</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-plain" lang="plain">参考@视频1的运镜效果还有主角的面部表情，
希区柯克变焦，然后几个环绕镜头展示电梯内视角
</code></pre>
<hr/>
<h4 data-id="heading-15">4. ✨ 创意特效与模版复刻</h4>
<p><strong>能力</strong>：识别并复刻创意转场、广告成片、复杂剪辑</p>
<p><strong>应用场景</strong>：</p>
<ul>
<li>🎞️ <strong>创意转场</strong>：拼图破碎、粒子吹散、水墨渐变</li>
<li>📺 <strong>广告复刻</strong>：参考视频创意生成新产品广告</li>
<li>🎨 <strong>艺术特效</strong>：水墨太极、粒子特效、科幻转场</li>
<li>🎭 <strong>换装特效</strong>：快速闪切、鱼眼镜头、重影炫影</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-plain" lang="plain">参考@视频1的广告创意，用提供的羽绒服图片，
并参考鹅绒图片、天鹅图片，搭配广告词生成新广告
</code></pre>
<hr/>
<h4 data-id="heading-16">5. 🎭 剧情补全与创意生成</h4>
<p><strong>能力</strong>：理解分镜脚本，自动补全剧情细节</p>
<p><strong>典型应用</strong>：</p>
<ul>
<li>📖 <strong>漫画演绎</strong>：按分镜顺序演绎，保留台词</li>
<li>📝 <strong>脚本创作</strong>：根据分镜头脚本生成完整片段</li>
<li>💡 <strong>情绪创作</strong>：根据灵感图片发散情绪向视频</li>
<li>🎬 <strong>广告脑洞</strong>：补充创意广告情节</li>
</ul>
<hr/>
<h4 data-id="heading-17">6. ⏱️ 视频延长与衔接</h4>
<p><strong>能力</strong>：平滑延长视频，保持风格连贯</p>
<p><strong>延长时长</strong>：4-15秒灵活选择</p>
<p><strong>使用方式</strong>：</p>
<pre><code class="hljs language-plain" lang="plain">示例1：延长15s视频，补充一段脑洞广告
示例2：将@视频1延长6s，出现电吉他音乐...
示例3：向前延长10s，温暖的午后光线里...
</code></pre>
<p><strong>注意事项</strong>：选择的生成时长应为"新增部分"的时长</p>
<hr/>
<h4 data-id="heading-18">7. 🔊 音频能力升级</h4>
<p><strong>特性</strong>：音色更准，声音更真</p>
<p><strong>应用场景</strong>：</p>
<ul>
<li>🎤 <strong>对话配音</strong>：角色对话自然流畅</li>
<li>🎭 <strong>戏曲唱段</strong>：豫剧等传统戏曲演唱</li>
<li>🗣️ <strong>多语言</strong>：西班牙语、韩语等多语种对话</li>
<li>🎵 <strong>音乐节奏</strong>：参考音频带起画面节奏</li>
<li>🎬 <strong>纪录片旁白</strong>：参考音色生成解说</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-plain" lang="plain">旁白的音色参考@视频1，拍摄"写字楼的生态"
</code></pre>
<hr/>
<h4 data-id="heading-19">8. 🎬 一镜到底</h4>
<p><strong>能力</strong>：连续镜头无缝衔接</p>
<p><strong>典型场景</strong>：</p>
<ul>
<li>🏃 <strong>追踪镜头</strong>：从街头→上楼梯→穿过走廊→进入屋顶</li>
<li>🚗 <strong>第一人称</strong>：过山车/开车主观视角</li>
<li>🎥 <strong>谍战跟拍</strong>：跟随角色穿越多个场景</li>
<li>✨ <strong>创意穿梭</strong>：从飞机舷窗→云朵→冰淇淋</li>
</ul>
<p><strong>技巧</strong>：使用多张参考图 <code>@图片1@图片2@图片3...</code> 指定连续场景</p>
<hr/>
<h4 data-id="heading-20">9. ✂️ 视频编辑</h4>
<p><strong>能力</strong>：对已有视频进行定向修改</p>
<p><strong>编辑类型</strong>：</p>
<ul>
<li>🔄 <strong>剧情颠覆</strong>：改变故事走向和人物行为</li>
<li>👤 <strong>角色替换</strong>：更换视频中的角色</li>
<li>🎨 <strong>风格修改</strong>：改变发型、服装、场景元素</li>
<li>➕ <strong>内容增加</strong>：在现有视频基础上增加元素</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-plain" lang="plain">颠覆@视频1里的剧情，男人眼神从温柔瞬间转为冰冷狠厉...
将视频1女人发型变成红色长发，图片1中的大白鲨在她身后
</code></pre>
<hr/>
<h3 data-id="heading-21">⚠️ 重要注意事项</h3>
<h4 data-id="heading-22">🚫 素材限制</h4>
<ul>
<li><strong>禁止上传</strong>：写实真人脸部素材（图片和视频均不可）</li>
<li><strong>原因</strong>：平台合规要求，保障用户权益与生成安全</li>
<li><strong>影响</strong>：包含清晰可辨识人脸的素材将无法生成</li>
</ul>
<h4 data-id="heading-23">💡 使用建议</h4>
<ol>
<li><strong>提示词要清晰</strong>：明确说明是"参考"还是"编辑"</li>
<li><strong>素材标注准确</strong>：多素材时检查 <code>@对象</code> 是否标清楚</li>
<li><strong>合理分配文件</strong>：总上限 12 个，优先上传关键素材</li>
<li><strong>自然语言描述</strong>：用口语化方式描述想要的效果</li>
</ol>
<h4 data-id="heading-24">📝 提示词模板</h4>
<pre><code class="hljs language-plain" lang="plain">【基础生成】
@图片1 作为首帧，[描述动作和场景]

【参考视频】
参考@视频1的运镜和镜头语言，[描述新内容]

【多模态组合】
@图片1为首帧，参考@视频1的动作，
@音频1用于配乐，[描述具体情节]

【视频编辑】
将@视频1中的[元素A]换成[元素B]，[其他要求]

【视频延长】
将@视频1延长[X]秒，[描述新增内容]
</code></pre>
<hr/>
<h3 data-id="heading-25">五、快速上手流程</h3>
<h4 data-id="heading-26">步骤详解：</h4>
<ol>
<li><strong>准备素材</strong>：收集参考图片/视频/音频</li>
<li><strong>选择入口</strong>：首尾帧 or 全能参考</li>
<li><strong>上传文件</strong>：注意格式、大小、数量限制</li>
<li><strong>编写提示词</strong>：自然语言描述创意</li>
<li><strong>@引用素材</strong>：指定每个素材的用途</li>
<li><strong>设置时长</strong>：4-15秒自由选择</li>
<li><strong>生成视频</strong>：等待模型处理</li>
</ol>
<hr/>
<h3 data-id="heading-27">六、创作技巧总结</h3>
<h4 data-id="heading-28">最佳实践</h4>
<h4 data-id="heading-29">1. <strong>分层引用</strong></h4>
<pre><code class="hljs language-plain" lang="plain">画面：@图片1@图片2
动作：参考@视频1
运镜：参考@视频2
音乐：@音频1
</code></pre>
<h4 data-id="heading-30">2. <strong>明确指令</strong></h4>
<ul>
<li>✅ 好：<code>@图1为首帧，参考@视频1的跑步动作，镜头从正面切换到侧面</code></li>
<li>❌ 差：<code>用这些素材生成一个视频</code></li>
</ul>
<h4 data-id="heading-31">3. <strong>逐步完善</strong></h4>
<ul>
<li>先生成基础版本</li>
<li>再用"编辑"功能微调</li>
<li>最后用"延长"功能扩展</li>
</ul>
<h4 data-id="heading-32">4. <strong>参考要精准</strong></h4>
<ul>
<li>描述清楚参考哪个部分：<code>参考@视频1的运镜（不是动作）</code></li>
<li>避免模糊表述：<code>参考@视频1的感觉</code> ❌</li>
</ul>
<hr/>
<h3 data-id="heading-33">七、常见场景速查</h3>













































<table><thead><tr><th>需求场景</th><th>使用方式</th><th>关键能力</th></tr></thead><tbody><tr><td><strong>商品展示</strong></td><td>多角度参考图 + 运镜视频</td><td>一致性 + 运镜复刻</td></tr><tr><td><strong>广告创意</strong></td><td>参考模板视频 + 新产品图</td><td>特效复刻</td></tr><tr><td><strong>剧情短片</strong></td><td>分镜图 + 情绪描述</td><td>剧情补全 + 情绪演绎</td></tr><tr><td><strong>音乐MV</strong></td><td>画面序列 + 音频文件</td><td>音乐卡点</td></tr><tr><td><strong>连续镜头</strong></td><td>多场景图 + 一镜到底描述</td><td>一镜到底</td></tr><tr><td><strong>修改现有视频</strong></td><td>原视频 + 修改说明</td><td>视频编辑</td></tr><tr><td><strong>延长视频</strong></td><td>原视频 + 延长内容描述</td><td>视频延长</td></tr></tbody></table>
<ul>
<li>参考官方教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbytedance.larkoffice.com%2Fwiki%2FA5RHwWhoBiOnjukIIw6cu5ybnXQ" target="_blank" title="https://bytedance.larkoffice.com/wiki/A5RHwWhoBiOnjukIIw6cu5ybnXQ" ref="nofollow noopener noreferrer">bytedance.larkoffice.com/wiki/A5RHwW…</a></li>
</ul>
<hr/>
<h2 data-id="heading-34">🧨 彩蛋</h2>
<p>我的《<strong>AI编程与自动化</strong>》2026训练营正式开营，以<strong>AI编程</strong>为驱动，让每个个体都拥有自己的小产品、小生意。训练营已积累了我过去三年200篇+的教程和案例。都是我自己实操总结，都是使用心得，并非复制网上过时的信息。现在以每周至少三篇的更新频率，让你获得最新、最接地气的AI资讯和教程。</p>
<p><strong>知识库模块</strong></p>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/fcbdf8c545fde306c8dde883a2905739.png" alt="image.png" loading="lazy"/></p>
<p>春节前限时最大优惠，原价99，扫码领券，立减50元，只需要 <strong>49</strong> 元。感兴趣可以扫码加入。</p>
<p>用十年时间干一件事，就从今天开始。欢迎登船，期待开始一场十年的AI之旅。</p>
<blockquote>
<p>📎 如果优惠失效，可以加我：<strong>keeepdance</strong>，备注：AI编程。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[研发场景十大热门 Skills 推荐]]></title>    <link>https://juejin.cn/post/7604964464689610815</link>    <guid>https://juejin.cn/post/7604964464689610815</guid>    <pubDate>2026-02-10T10:51:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604964464689610815" data-draft-id="7605051978871619603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="研发场景十大热门 Skills 推荐"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-02-10T10:51:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            研发场景十大热门 Skills 推荐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T10:51:03.000Z" title="Tue Feb 10 2026 10:51:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70a3164639c140d7bc9515b99f7b7583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=1JGLMq9zmzoNVMIAGfXXgVI4bxo%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：JiaQi，TRAE 技术文档工程师</p>
</blockquote>
<p>本文面向实际研发场景，整理并推荐了一组可直接应用于日常开发流程的 Agent Skills。这些 Skills 覆盖前端设计、前后端开发、代码审查、自动化测试、CI/CD、问题修复以及文档维护等常见环节，分别针对具体任务提供明确的能力边界与使用场景说明，帮助你在不同阶段选择合适的 Skills，提高开发效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0665ab1d37184969aa7555118505c316~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=Ee%2BU%2FMJafmHgl52iPb179QdHUF4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>前端设计</strong></h2>
<h3 data-id="heading-1"><strong>名称</strong></h3>
<p>frontend-design</p>
<h3 data-id="heading-2"><strong>作者</strong></h3>
<p>Anthropic</p>
<h3 data-id="heading-3"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskills%2Ffrontend-design" target="_blank" title="https://github.com/anthropics/skills/tree/main/skills/frontend-design" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
<h3 data-id="heading-4"><strong>简介</strong></h3>
<p>该 Skill 旨在创建具有 独特性 和 高设计品质 的前端界面，能够达到 生产级别 (production-grade) 的标准。它的核心目标是避免生成千篇一律、缺乏独特风格的 “AI 风格” 界面，而是通过在设计上有意地选择大胆、明确的美学方向（例如：极简、复古、未来感、野兽派等），并注重排版、色彩、动效、空间布局等细节，来打造出令人印象深刻、具有艺术感的前端页面。</p>
<h2 data-id="heading-5"><strong>资源文件</strong></h2>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<h3 data-id="heading-6"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>构建网页组件或页面</strong></p>
<p>当你需要从零开始创建一个具体的 UI 元素时，例如一个 React 组件、一个 HTML/CSS 布局，或一个独立的静态页面。该 Skill 会确保这个组件不仅功能完善，而且在视觉上具有辨识度。</p>
</li>
<li>
<p><strong>开发完整的 Web 应用或网站</strong></p>
<p>当你需要构建一个完整的应用界面时，比如一个产品的 Landing Page、一个数据仪表盘或一个小型网站。该 Skill 会从整体出发，确立一个统一且鲜明的设计风格，并将其贯彻到应用的每一个角落。</p>
</li>
<li>
<p><strong>美化或重塑现有界面</strong></p>
<p>当你有一个已经存在的、但设计平庸的网页或应用，并希望提升其视觉品质时。该 Skill 会专注于美化层面的工作，通过引入独特的字体、创意的色彩方案、精致的动效和新颖的布局，来重塑界面的整体美感。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f4f0d2df144e198230276d9e8c88a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=QPB%2BxLjd4Hl58v7rcKVbfjhLf18%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7"><strong>前端开发</strong></h2>
<h3 data-id="heading-8"><strong>名称</strong></h3>
<p>cache-components</p>
<h3 data-id="heading-9"><strong>作者</strong></h3>
<p>vercel</p>
<h3 data-id="heading-10"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Ftree%2Fcanary%2F.claude-plugin%2Fplugins%2Fcache-components%2Fskills%2Fcache-components" target="_blank" title="https://github.com/vercel/next.js/tree/canary/.claude-plugin/plugins/cache-components/skills/cache-components" ref="nofollow noopener noreferrer">github.com/vercel/next…</a>
   </p>
<h3 data-id="heading-11"><strong>简介</strong></h3>
<p>该 Skill 旨在将 Next.js 的 Partial Prerendering (PPR) 和缓存组件（Cache Components）的最佳实践，通过 AI 助手无缝集成到开发工作流中。当项目环境启用 <em><strong>cacheComponents: true</strong></em> 配置时，该 Skill 将被激活，为你提供自动化的代码生成与优化能力。</p>
<h3 data-id="heading-12"><strong>资源文件</strong></h3>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li>
<p><strong>PATTERNS.md：</strong> 一份详细的说明文档，通过丰富的代码示例和场景解释，来展示如何高效、正确地使用 Cache Components。</p>
</li>
<li>
<p><strong>REFERENCE.md：</strong> Cache Components 的官方 API 参考手册，它精确定义了所有相关函数、指令和核心概念，用于查找具体技术细节。</p>
</li>
<li>
<p><strong>TROUBLESHOOTING.md：</strong> Cache Components 的故障排查指南，提供了一系列常见错误的解决方案、调试清单和实用技巧，用于诊断并解决使用缓存组件时遇到的问题。</p>
</li>
</ul>
<h3 data-id="heading-13"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>自动生成缓存优化的数据组件</strong></p>
<p>当创建数据获取组件时，系统会自动应用最优的渲染策略：针对可共享数据（如产品目录），使用 'use cache'语法进行缓存；针对用户专属内容，则自动添加 边界，以实现动态流式渲染。</p>
</li>
<li>
<p><strong>自动实现数据变更后的缓存失效</strong></p>
<p>当生成用于修改数据的 Server Action 时，系统会自动注入缓存失效逻辑（如 updateTag()方法）。这能确保数据变更后，相关缓存会立即更新，从而保障整个应用的数据一致性。</p>
</li>
<li>
<p><strong>智能化页面构建与代码现代化</strong></p>
<p>在构建页面或审查代码时，系统会强制遵循 Partial Prerendering（PPR）架构规范，以实现最优的加载性能。同时，它能识别并给出现代化改造建议，例如用组件级的'use cache'替代已过时的页面级缓存配置。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/843d0c1dab5b474e9084fe0beff0efde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=by6nmvaz7iBGFT%2FZ0CMleDGVoD0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14"><strong>全栈开发</strong></h2>
<h3 data-id="heading-15"><strong>名称</strong></h3>
<p>fullstack-developer</p>
<h3 data-id="heading-16"><strong>作者</strong></h3>
<p>Shubhamsaboo</p>
<h3 data-id="heading-17"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FShubhamsaboo%2Fawesome-llm-apps%2Ftree%2Fmain%2Fawesome_agent_skills%2Ffullstack-developer" target="_blank" title="https://github.com/Shubhamsaboo/awesome-llm-apps/tree/main/awesome_agent_skills/fullstack-developer" ref="nofollow noopener noreferrer">github.com/Shubhamsabo…</a></p>
<h3 data-id="heading-18"><strong>简介</strong></h3>
<p>该 Skill 的主要作用是扮演一个 精通现代 Web 开发技术的全栈专家角色。它专注于使用 JavaScript/TypeScript 技术栈，特别是 React (Next.js)、Node.js 和主流数据库，来帮助你完成各类 Web 开发任务。</p>
<h3 data-id="heading-19"><strong>资源文件</strong></h3>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<h3 data-id="heading-20"><strong>应用场景</strong></h3>
<ul>
<li><strong>构建完整的 Web 应用：</strong> 从前端到后端，提供完整的解决方案。</li>
<li><strong>开发 API：</strong> 创建 RESTful 或 GraphQL 风格的后端接口。</li>
<li><strong>创建前端界面：</strong> 使用 React 或 Next.js 构建现代化的用户界面。</li>
<li><strong>数据库和数据建模：</strong> 设计和设置如 PostgreSQL 或 MongoDB 等数据库。</li>
<li><strong>实现用户认证与授权：</strong> 集成 JWT、OAuth 等认证机制。</li>
<li><strong>部署与扩展应用：</strong> 提供在 Vercel、Netlify 等平台上的部署指导。</li>
<li><strong>集成第三方服务：</strong> 在应用中接入外部服务。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e40cd3ee02945d28a26515326bdd635~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=22lFislOE9zuujlD2cZhH1EAVMk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-21"><strong>代码审查（前端）</strong></h2>
<h3 data-id="heading-22"><strong>名称</strong></h3>
<p>frontend-code-review</p>
<h3 data-id="heading-23"><strong>作者</strong></h3>
<p>langgenius</p>
<h3 data-id="heading-24"><strong>地址</strong> </h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flanggenius%2Fdify%2Ftree%2Fmain%2F.agents%2Fskills%2Ffrontend-code-review%25C2%25A0" target="_blank" title="https://github.com/langgenius/dify/tree/main/.agents/skills/frontend-code-review%C2%A0" ref="nofollow noopener noreferrer">github.com/langgenius/…</a>  </p>
<h3 data-id="heading-25"><strong>简介</strong></h3>
<p>该 Skill 的核心功能是自动化审查前端代码（尤其针对 .tsx、.ts、.js 等文件）。它会依据预定义的规则清单，从代码质量、性能表现、业务逻辑等维度对代码开展全面分析。审查完成后，系统将生成结构清晰的报告，把发现的问题划分为 “紧急待修复” 和 “改进建议” 两类，并标注具体的代码位置、提供可落地的修复方案，助力你提升代码质量。</p>
<h3 data-id="heading-26"><strong>资源文件</strong></h3>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li>
<p><strong>references/business-logic.md：</strong> 定义与特定业务场景相关的规则，以防止出现逻辑错误或 Bug。例如 : 规定在某些组件中不能使用 workflowStore ，因为在特定使用场景下（如从模板创建管道时）它会导致页面白屏。</p>
</li>
<li>
<p><strong>references/code-quality.md：</strong> 包含一系列通用编码规范，旨在保持代码的整洁、一致和可维护性。例如 : 推荐使用 <em><strong>cn</strong></em> 这样的工具函数来处理动态的 CSS 类名，而不是手动拼接字符串，以保证代码风格统一。</p>
</li>
<li>
<p><strong>references/performance.md：</strong> 专注于前端性能，提供避免常见性能问题的最佳实践。例如 : 建议将传递给子组件的对象或数组等复杂属性用 <em><strong>useMemo</strong></em> 包裹起来，以防止不必要的组件重渲染。</p>
</li>
</ul>
<h3 data-id="heading-27"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>审查待提交的变更</strong></p>
<p>在你准备提交代码（<em><strong>git commit</strong></em>）前，可使用该 Skill 审查所有已修改或已暂存的文件，提前识别并标记不符合规范的代码，避免潜在的 Bug 或性能问题被合入代码库。</p>
</li>
<li>
<p><strong>审查指定的文件</strong></p>
<p>当你需对特定文件或模块进行重构、优化或问题排查时，可将相关文件交由该 Skill 审查，从而对目标文件开展针对性深度分析，快速获取该文件的质量评估结果及改进建议。</p>
</li>
<li>
<p><strong>获取结构化的修复报告</strong></p>
<p>代码审查发现问题后，该 Skill 会自动整理并输出标准化报告。这份报告不仅罗列问题，还会按紧急程度排序，同时标注问题对应的文件路径、行号、相关代码片段，并给出可执行的修复方案。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae31eb8bdfcd4073b06b7355624301c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=ZbH6VkIGJ6dVka17QCckO3UBZVQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-28"><strong>代码审查（通用）</strong></h2>
<h3 data-id="heading-29"><strong>名称</strong></h3>
<p>code-reviewer</p>
<h3 data-id="heading-30"><strong>作者</strong></h3>
<p>google-gemini</p>
<h3 data-id="heading-31"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli%2Ftree%2Fmain%2F.gemini%2Fskills%2Fcode-reviewer" target="_blank" title="https://github.com/google-gemini/gemini-cli/tree/main/.gemini/skills/code-reviewer" ref="nofollow noopener noreferrer">github.com/google-gemi…</a></p>
<h3 data-id="heading-32"><strong>简介</strong></h3>
<p>该 Skill 旨在引导 AI 开展专业且全面的代码审查工作。它既支持审查本地代码改动（包括已暂存和未暂存的变更），也可审查远程代码合并请求（Pull Request，简称 PR）。审查的核心目标是保障代码的正确性、可维护性，并确保代码符合项目既定的规范标准。</p>
<h3 data-id="heading-33"><strong>资源文件</strong></h3>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<h3 data-id="heading-34"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>审查远程 PR</strong></p>
<p>当你完成功能开发或问题修复并提交 PR 后，可发起 AI 审查请求。你只需提供 PR 编号或 URL（例如："Review PR #123"），AI 会自动检出（checkout）该 PR 的代码，运行项目预设的检查脚本（如 <em><strong>npm run preflight</strong></em>），同时阅读 PR 描述与评论以理解开发目标，随后对代码开展深度分析并给出反馈。</p>
</li>
<li>
<p><strong>审查本地代码变更</strong></p>
<p>若你希望在提交代码或创建 PR 前，先对本地修改进行审查，只需发出 “审查我的代码” 等类似指令即可，无需提供 PR 相关信息；AI 会通过 <em><strong>git status</strong></em>、<em><strong>git diff</strong></em> 等命令，检查工作区中已暂存（staged）和未暂存（unstaged）的代码改动，进而对这些变更进行分析并反馈。</p>
</li>
<li>
<p><strong>提供深度分析与结构化反馈</strong></p>
<p>无论是审查远程 PR 还是本地代码变更，AI 都会从多维度开展深度的代码质量分析，涵盖正确性、可维护性、可读性与执行效率、安全性与测试完整性等维度。最终，AI 会以结构化形式输出反馈，内容包括总体概述、具体发现（关键问题、改进建议）以及明确的结论（如批准合并或要求修改）。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7c6ef32e7cd43e99e13487e9e9786a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=sugyrZgcNcb7ffFBG7YQUAWV1WE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-35"><strong>网页应用测试</strong></h2>
<h3 data-id="heading-36"><strong>名称</strong></h3>
<p>webapp-testing</p>
<h3 data-id="heading-37"><strong>作者</strong></h3>
<p>Anthropic</p>
<h3 data-id="heading-38"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskills%2Fwebapp-testing" target="_blank" title="https://github.com/anthropics/skills/tree/main/skills/webapp-testing" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
<h3 data-id="heading-39"><strong>简介</strong></h3>
<p>该 Skill 是一个基于 Playwright 构建的本地 Web 应用测试工具集，支持前端功能验证、UI 行为调试、页面截图及浏览器控制台日志采集，适配「先侦查后行动」的测试流程。工具集提供示例脚本与辅助脚本，覆盖静态 HTML 自动化测试、元素定位、日志抓取能力，并可在多服务场景下统一管理服务器生命周期。</p>
<h3 data-id="heading-40"><strong>资源文件</strong></h3>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li>
<p><strong>examples/console_logging.py：</strong> 演示了在自动化测试时如何捕获并保存网页的控制台日志，用于调试和监控。</p>
</li>
<li>
<p><strong>examples/element_discovery.py：</strong> 展示了如何自动发现和列出页面上所有的按钮、链接和输入框等可交互元素，是编写自动化脚本前的重要步骤。</p>
</li>
<li>
<p><strong>examples/static_html_automation.py：</strong> 示范了如何直接对本地的静态 HTML 文件进行自动化操作（如点击、填表），而无需通过网络服务器。</p>
</li>
<li>
<p><strong>scripts/with_server.py：</strong> 自动化辅助脚本。在执行一个主命令（例如自动化测试脚本）之前，先启动一个或多个依赖的服务（如前端或后端服务器），并确保这些服务完全就绪后，再执行主命令，最后在命令结束后自动关闭所有服务。</p>
</li>
</ul>
<h3 data-id="heading-41"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>自动验证前端功能</strong></p>
<p>当你在本地开发 Web 应用（如使用 React、Vue、Svelte 等框架），并希望验证某个新功能是否正常运行时，只需用自然语言告知 AI 测试需求（例如：“帮我测试登录功能”），AI 会自动编写 Playwright 脚本来模拟用户操作，并向你反馈页面状态或内容是否符合预期。</p>
</li>
<li>
<p><strong>调试与分析 UI 行为</strong></p>
<p>若你发现页面中某元素渲染异常或交互行为异常，可向 AI 下达指令（例如：“截取首页完整截图” 或 “检查按钮的 DOM 结构”），AI 会执行对应脚本，捕获截图或获取 HTML 内容，并将侦察结果返回给你，助力快速定位问题。</p>
</li>
<li>
<p><strong>处理需要后台服务的复杂交互</strong></p>
<p>若你的应用为前后端分离架构，测试前端功能需后端 API 服务同步运行，只需告知 AI 项目结构与启动命令，AI 会借助 <em><strong>with_server.py</strong></em> 脚本来同时启动所有必需服务，再运行测试脚本，确保测试在完整的环境中执行。</p>
</li>
<li>
<p><strong>测试静态 HTML 文件</strong></p>
<p>若你有不依赖服务器的纯静态 HTML 页面，需验证其内容或结构，只需向 AI 提供文件路径与测试需求，AI 会编写脚本并通过 file://协议在浏览器中打开该文件，完成验证操作。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bdb1c4c58df44c18c193606d6cbd97a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=CIbsPYaJ214%2Fwj83ZiI2liV4RGI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-42"><strong>CI/CD：PR 创建</strong></h2>
<h3 data-id="heading-43"><strong>名称</strong></h3>
<p>pr-creator</p>
<h3 data-id="heading-44"><strong>作者</strong></h3>
<p>google-gemini</p>
<h3 data-id="heading-45"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli%2Ftree%2Fmain%2F.gemini%2Fskills%2Fpr-creator" target="_blank" title="https://github.com/google-gemini/gemini-cli/tree/main/.gemini/skills/pr-creator" ref="nofollow noopener noreferrer">github.com/google-gemi…</a></p>
<h3 data-id="heading-46"><strong>简介</strong></h3>
<p>该 Skill 的核心作用是引导并自动化创建高质量、符合规范的拉取请求（Pull Request，简称 PR）。它通过标准化工作流程，确保每一次代码提交均遵循项目预设的模板与质量检查标准，从而提升代码审查效率、保障团队协作的一致性。</p>
<h3 data-id="heading-47"><strong>资源文件</strong></h3>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<h3 data-id="heading-48"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>一键创建符合规范的 PR</strong></p>
<p>当你在本地完成新功能开发或 Bug 修复，并已提交代码（git commit）后，可调用此 Skill，让 AI 自动执行分支检查、查找并应用 PR 模板、运行预检脚本（如测试和 linting），并最终生成一个标题和描述都完全符合项目规范的 PR。</p>
</li>
<li>
<p><strong>引导贡献者完成首次代码提交</strong></p>
<p>当新团队成员或外部贡献者不熟悉项目的提交流程和规范时，可以使用此 Skill，让 AI 以智能向导的形式，自动完成模板查找、脚本执行等繁琐操作，仅需用户填写必要的标题与描述，大幅降低代码贡献门槛。</p>
</li>
<li>
<p><strong>自动执行创建 PR 前的质量检查</strong></p>
<p>在正式创建 PR 之前，可以调用该 Skill，让 AI 自动运行项目预设的 preflight 脚本，执行所有必要的构建、单元测试和代码风格检查。如果任何检查失败，AI 会中止提交流程并提示开发者进行修复，节约了审查者的时间和精力。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c353b65ee9c4c899005fda180323e84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=nmBULjgJT1OGDZL3agXxmttXpKo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-49"><strong>Linting 和格式错误修复</strong></h2>
<h3 data-id="heading-50"><strong>名称</strong></h3>
<p>fix</p>
<h3 data-id="heading-51"><strong>作者</strong></h3>
<p>facebook</p>
<h3 data-id="heading-52"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact%2Ftree%2Fmain%2F.claude%2Fskills%2Ffix" target="_blank" title="https://github.com/facebook/react/tree/main/.claude/skills/fix" ref="nofollow noopener noreferrer">github.com/facebook/re…</a></p>
<h3 data-id="heading-53"><strong>简介</strong></h3>
<p>这个 skill 的核心作用是自动化地修复代码格式并检查代码规范（linting）错误 。它通过执行两个关键命令来保证代码质量：</p>
<ul>
<li>
<p>yarn prettier：自动格式化已修改的文件，统一代码风格。</p>
</li>
<li>
<p>yarn linc：检查代码中是否存在 linting 错误（这些是 Prettier 无法修复的，例如未使用的变量、逻辑错误等），这些错误通常会导致持续集成（CI）失败。</p>
</li>
</ul>
<p>最终目标是确保代码在提交前符合项目规范，从而顺利通过 CI/CD 流程。</p>
<h3 data-id="heading-54"><strong>资源文件</strong></h3>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<h3 data-id="heading-55"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>提交代码前的预防性检查</strong></p>
<p>在你完成编码，执行 <em><strong>git commit</strong></em> 之前，运行该 Skill，让 AI 自动清理代码格式，并提示任何需要手动修复的 linting 错误。</p>
</li>
<li>
<p><strong>修复已发现的 linting 或格式问题</strong></p>
<p>当你在编码过程中或接手他人代码时，发现当前工作区内存在明显的格式混乱或 linting 错误提示（例如，IDE 的警告），可以立即运行该 Skill，快速解决当前已知的代码质量问题，从而在开发过程中保持代码的整洁和可读性。</p>
</li>
<li>
<p><strong>解决持续集成（CI）失败问题</strong></p>
<p>当一个提交被推送到服务器后，CI 流水线报告了因 linting 或格式错误导致的失败。此时你可以在本地对应的分支上运行此 Skill，让 AI 自动修复格式问题，并列出需要手动更正的 linting 错误，帮助你快速定位并解决问题，然后提交修复。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48bbdbd47ed24a729fa3b48fe0309159~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=nZG100JXHiRoXLZ5Lkr76Xbkv0c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-56"><strong>技术文档更新</strong></h2>
<h3 data-id="heading-57"><strong>名称</strong></h3>
<p>update-docs</p>
<h3 data-id="heading-58"><strong>作者</strong></h3>
<p>vercel</p>
<h3 data-id="heading-59"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fnext.js%2Ftree%2Fcanary%2F.claude%2Fskills%2Fupdate-docs" target="_blank" title="https://github.com/vercel/next.js/tree/canary/.claude/skills/update-docs" ref="nofollow noopener noreferrer">github.com/vercel/next…</a></p>
<h3 data-id="heading-60"><strong>简介</strong></h3>
<p>该 Skill 是一套用于更新 Next.js 项目文档的引导式工作流，核心作用是帮助你根据源代码的变更，来分析、更新和创建相关的文档，确保代码和文档保持同步。它特别为审查 Pull Request (PR) 时的文档完整性检查而设计，通过一系列标准化的步骤来规范文档的修改过程。</p>
<h3 data-id="heading-61"><strong>资源文件</strong></h3>
<p>除 SKILL.md 文件外，该 Skill 中还包含以下文件：</p>
<ul>
<li><strong>references/CODE-TO-DOCS-MAPPING.md：</strong> 定义了源代码和文档之间的映射关系。简单来说，它就像一张地图，告诉 AI 当某个代码文件发生变化时，应该去更新哪个文档文件。</li>
<li><strong>references/DOC-CONVENTIONS.md：</strong> 风格指南和规则手册，详细规定了文档的格式、结构和写作风格，以确保所有文档都保持一致性和高质量。
   </li>
</ul>
<h3 data-id="heading-62"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>分析代码变更对文档的影响</strong></p>
<p>提交代码变更后，可以调用该 Skill 来分析哪些文档文件需要更新。</p>
<p>它会通过 <em><strong>git diff</strong></em> 命令检查你的分支与 <em><strong>canary</strong></em> 分支之间的差异，并根据预定义的映射关系 <em><strong>(references/CODE-TO-DOCS-MAPPING.md</strong></em>)，找出与变更的代码文件相对应的文档文件。</p>
</li>
<li>
<p><strong>更新现有的文档</strong></p>
<p>对于已经存在的文档，当其对应的功能或 API 发生变化时（例如组件新增了 props、函数行为变更），该 Skill 会引导你更新现有文档。</p>
<p>它会提示你如何添加或修改 props 表格、更新代码示例、添加废弃通知等，并遵循项目固有的文档规范（例如，使用 / 来区分不同路由的内容）。</p>
</li>
<li>
<p><strong>为新功能创建脚手架文档</strong></p>
<p>当你在项目中添加了一个全新的功能时（例如一个新的组件、函数或配置项），该 Skill 可以帮你快速创建符合规范的新文档。</p>
<p>它为不同类型的文档（如 API 参考、指南）提供了标准模板，确保新文档的结构、命名和元信息（Frontmatter）都符合项目要求。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d6a33d76cbb4752968fae98d3d3746b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771325512&amp;x-signature=Q%2BfVzNyLlnp604XUALlHaFtxxD8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-63"><strong>查找 Skill</strong></h2>
<h3 data-id="heading-64"><strong>名称</strong></h3>
<p>find-skills</p>
<h3 data-id="heading-65"><strong>作者</strong></h3>
<p>vercel</p>
<h3 data-id="heading-66"><strong>地址</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel-labs%2Fskills%2Ftree%2Fmain%2Fskills%2Ffind-skills" target="_blank" title="https://github.com/vercel-labs/skills/tree/main/skills/find-skills" ref="nofollow noopener noreferrer">github.com/vercel-labs…</a></p>
<h3 data-id="heading-67"><strong>简介</strong></h3>
<p>该 Skill 主要作用帮助你发现并安装 Agent Skill。</p>
<p>它依托名为 <em><strong>skills</strong></em> 的命令行工具（CLI），让你可以从开放的 Agent Skill 生态中搜索、安装与管理各类模块化技能包；这些技能可扩展 Agent 能力，为其补充特定领域知识、标准化工作流与工具能力。</p>
<h3 data-id="heading-68"><strong>资源文件</strong></h3>
<p>该 Skill 中仅包含一个 SKILL.md 文件。</p>
<h3 data-id="heading-69"><strong>应用场景</strong></h3>
<ul>
<li>
<p><strong>探索未知的 Skill</strong></p>
<p>当你希望 Agent 帮忙处理某个特定领域的任务，但不确定 Agent 是否具备相应能力时，可以使用此 Skill 进行探索。例如，当你询问 “你能帮我评审代码吗？” 或 “如何为我的项目生成文档？” 时，该 Skill 会被激活，主动在技能市场中搜索与 “代码评审” 或“ 文档生成” 相关的能力，并将找到的可用技能呈现给你.</p>
</li>
<li>
<p><strong>查找特定的 Skill</strong></p>
<p>当你明确知道需要一个 Skill 来解决特定问题，但不知道具体是哪个 Skill 时，可以主动调用此 Skill 进行精确查找。例如，你可以直接说 “帮我找一个用于 React 性能优化的 skill”，该 Skill 会将 “React 性能优化” 作为关键词进行搜索，并返回最匹配的技能选项，如 “vercel-react-best-practices”。</p>
</li>
<li>
<p><strong>提供可执行的 Skill 安装建议</strong></p>
<p>当该 Skill 找到一个或多个匹配的 skill 后，它会自动整理并输出一份标准化的推荐信息。这份信息不仅包含技能的名称和功能简介 ，还会提供 一键安装指令 (npx skills add ...) 以及指向技能详情页的官方链接。</p>
</li>
</ul>
<p>欢迎大家安装尝试～先从会用 Skills 开始！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Mysql】索引优化实战：从 320ms 到 130ms 的慢 SQL 改造]]></title>    <link>https://juejin.cn/post/7604784281958072358</link>    <guid>https://juejin.cn/post/7604784281958072358</guid>    <pubDate>2026-02-10T09:05:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604784281958072358" data-draft-id="7604784281958055974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Mysql】索引优化实战：从 320ms 到 130ms 的慢 SQL 改造"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T09:05:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Mysql】索引优化实战：从 320ms 到 130ms 的慢 SQL 改造
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:05:53.000Z" title="Tue Feb 10 2026 09:05:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    23
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前言：</p>
<blockquote>
<p>我们项目中，经常遇到需要索引优化的地方，即我们常见的慢查询，那么从一个实际的案例出来，分析慢查询中会经过哪些步骤，哪些环节是我们需要注意的，同时，在整个链路分析中，哪些部分是我们可以提炼出来，面试的经验值@!</p>
</blockquote>
<p>注：xxxx替换项目名，不影响整体阅读</p>
<hr/>
<h3 data-id="heading-0">【S - 情境】</h3>
<p>在<strong>xxxx项目</strong>的「学习报告生成」核心接口中，存在一条高频慢 SQL：关联「用户学习记录表（t_learning_record，3000 万 + 数据）、用户表（t_user，500 万 + 数据）、课程表（t_course，20 万 + 数据）」3 张表，查询用户 7 天内的学习轨迹并按学习时间排序，用于生成个性化学习报告。</p>
<p><strong>初始慢 SQL（简化后）</strong> ：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
  lr.user_id, lr.learn_time, lr.mastery_rate, u.nickname, c.course_name 
<span class="hljs-keyword">FROM</span> 
  t_learning_record lr
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_user u <span class="hljs-keyword">ON</span> lr.user_id <span class="hljs-operator">=</span> u.user_id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> t_course c <span class="hljs-keyword">ON</span> lr.course_id <span class="hljs-operator">=</span> c.course_id
<span class="hljs-keyword">WHERE</span> 
  lr.learn_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01 00:00:00'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-01-07 23:59:59'</span>
  <span class="hljs-keyword">AND</span> u.user_type <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-comment">-- 仅查询普通用户</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 
  lr.learn_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">100</span>;
</code></pre>
<p><strong>初始问题</strong>：</p>
<ul>
<li>接口响应时间 320ms，其中该 SQL 执行耗时占比 85%，日均调用 120 万次，导致数据库主库 CPU 峰值达 75%；</li>
<li>慢查询日志显示，SQL 触发全表扫描，且存在「Using temporary + Using filesort」，排序和临时表开销巨大；</li>
<li>已有索引：t_learning_record 仅建了<code>idx_learn_time</code>（单字段索引），t_user 仅建了<code>PRIMARY KEY (user_id)</code>。</li>
</ul>
<h3 data-id="heading-1">【T - 任务】</h3>
<ol>
<li>通过执行计划分析，精准定位慢 SQL 的性能瓶颈（索引缺失、索引失效、排序优化不足）；</li>
<li>设计合理的<strong>复合索引</strong>，明确字段顺序，覆盖 WHERE、JOIN、ORDER BY 场景，避免全表扫描和文件排序；</li>
<li>处理潜在的<strong>索引失效场景</strong>，确保优化后的索引稳定生效；</li>
<li>优化后 SQL 执行耗时降至 150ms 内，支撑高并发场景。</li>
</ol>
<h3 data-id="heading-2">【A - 行动】</h3>
<p>核心围绕「<strong>执行计划分析→复合索引设计→索引失效处理</strong>」三步展开，结合 MySQL 执行计划原理和实战落地细节，逐一拆解优化逻辑。</p>
<h2 data-id="heading-3">一、执行计划分析：定位慢 SQL 核心瓶颈</h2>
<p>优化的前提是「知其然且知其所以然」，通过<strong>MySQL Explain 工具</strong>分析初始 SQL 的执行计划，精准锁定问题所在。</p>
<h3 data-id="heading-4">1. 执行计划获取与关键字段解读</h3>
<p>执行<code>EXPLAIN + 慢SQL</code>，核心输出结果如下（重点关注 5 个字段）：</p>





































<table><thead><tr><th>表名</th><th>type</th><th>possible_keys</th><th>key</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>t_learning_record（lr）</td><td>ALL</td><td>idx_learn_time</td><td>NULL</td><td>456892</td><td>Using where; Using temporary; Using filesort</td></tr><tr><td>t_user（u）</td><td>eq_ref</td><td>PRIMARY</td><td>PRIMARY</td><td>1</td><td>Using where</td></tr><tr><td>t_course（c）</td><td>eq_ref</td><td>PRIMARY</td><td>PRIMARY</td><td>1</td><td/></tr></tbody></table>
<h3 data-id="heading-5">关键字段解读（瓶颈定位）：</h3>
<ul>
<li><strong>type=ALL（lr 表）</strong> ：t_learning_record 表触发<strong>全表扫描</strong>，这是最核心的性能瓶颈（type 字段从好到差：const→eq_ref→range→ref→ALL）；</li>
<li><strong>key=NULL（lr 表）</strong> ：虽有单字段索引<code>idx_learn_time</code>，但未被使用，索引失效；</li>
<li><strong>rows=456892（lr 表）</strong> ：预估扫描 45 万 + 行数据，实际扫描量超 400 万行，数据处理成本极高；</li>
<li><strong>Extra=Using temporary; Using filesort</strong>：因 ORDER BY 字段（lr.learn_time）未走索引，需创建临时表存储联表结果，再进行文件排序，这两个操作是 SQL 耗时的主要来源（占比 60%+）；</li>
<li><strong>t_user 和 t_course 表</strong>：type=eq_ref（通过主键关联），无性能瓶颈，无需优化。</li>
</ul>
<h3 data-id="heading-6">2. 进一步验证：Explain Analyze（真实执行情况）</h3>
<p>通过<code>EXPLAIN ANALYZE</code>（MySQL 8.0+）获取真实执行数据，验证瓶颈：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Limit: <span class="hljs-number">100</span> <span class="hljs-type">row</span>(s) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">318.2</span>.<span class="hljs-number">.318</span><span class="hljs-number">.2</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">100</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Sort: lr.learn_time <span class="hljs-keyword">DESC</span> (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">318.2</span>.<span class="hljs-number">.318</span><span class="hljs-number">.2</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">100</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Hash <span class="hljs-keyword">Join</span> (<span class="hljs-keyword">left</span> <span class="hljs-keyword">outer</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">280.5</span>.<span class="hljs-number">.315</span><span class="hljs-number">.7</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">456892</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
  <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Hash <span class="hljs-keyword">Join</span> (<span class="hljs-keyword">left</span> <span class="hljs-keyword">outer</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">250.3</span>.<span class="hljs-number">.285</span><span class="hljs-number">.1</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">456892</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">Table</span> scan <span class="hljs-keyword">on</span> lr (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">0.02</span>.<span class="hljs-number">.150</span><span class="hljs-number">.2</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">400000</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>) <span class="hljs-comment">-- 真实全表扫描40万行</span>
    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Hash (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">250.2</span>.<span class="hljs-number">.250</span><span class="hljs-number">.2</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">100000</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
      <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">Table</span> scan <span class="hljs-keyword">on</span> u (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">0.01</span>.<span class="hljs-number">.10</span><span class="hljs-number">.3</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">100000</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
  <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Hash (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">30.1</span>.<span class="hljs-number">.30</span><span class="hljs-number">.1</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">20000</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">Table</span> scan <span class="hljs-keyword">on</span> c (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">0.003</span>.<span class="hljs-number">.8</span><span class="hljs-number">.5</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">20000</span> loops<span class="hljs-operator">=</span><span class="hljs-number">1</span>)
</code></pre>
<p><strong>结论</strong>：全表扫描（lr 表）+ 临时表 + 文件排序，是 SQL 耗时 320ms 的核心原因，需通过索引优化解决这两个问题。</p>
<h2 data-id="heading-7">二、复合索引设计：字段顺序决定优化效果</h2>
<p>针对 lr 表的查询场景（WHERE+JOIN+ORDER BY），设计<strong>复合索引</strong>是核心解决方案。复合索引的字段顺序直接影响索引利用率，需遵循「最左前缀匹配、过滤性优先、排序字段后置」三大原则。</p>
<h3 data-id="heading-8">1. 明确 SQL 的核心字段角色</h3>
<p>先拆分 SQL 中 lr 表的字段用途，为索引设计提供依据：</p>
<ul>
<li><strong>JOIN 字段</strong>：user_id（与 t_user 表关联）；</li>
<li><strong>WHERE 条件字段</strong>：learn_time（范围条件：BETWEEN）；</li>
<li><strong>ORDER BY 字段</strong>：learn_time（DESC 排序）；</li>
<li><strong>查询字段</strong>：mastery_rate（仅查询，无过滤 / 排序）。</li>
</ul>
<h3 data-id="heading-9">2. 复合索引字段顺序决策逻辑</h3>
<p>复合索引的核心设计原则：<strong>高频过滤字段→JOIN 字段→排序字段→查询字段</strong>，结合本案例的优先级排序：</p>
<ol>
<li><strong>第一步：优先选择过滤性强的 WHERE 字段</strong>learn_time 是范围条件（BETWEEN），但它是筛选数据的核心（仅保留 7 天内的数据，过滤率达 99%+），且是 ORDER BY 字段，需放在索引前列；</li>
<li><strong>第二步：加入 JOIN 字段</strong> user_id 是与 t_user 表的关联字段，且关联后 u.user_type=1 会进一步过滤数据，放在 learn_time 之后，符合最左前缀匹配；</li>
<li><strong>第三步：包含排序字段（已在第一步覆盖）</strong> 因 ORDER BY 字段就是 learn_time，索引中已包含，无需重复添加；</li>
<li><strong>第四步：覆盖查询字段（可选，实现索引覆盖）</strong> 加入 mastery_rate 字段，使索引包含所有查询字段（learn_time+user_id+mastery_rate），避免「回表查询」（从索引找到主键后，再去主键索引查数据）。</li>
</ol>
<h3 data-id="heading-10">3. 最终复合索引：<code>idx_learn_time_userid_mastery</code></h3>
<p>创建索引 SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_learn_time_userid_mastery 
<span class="hljs-keyword">ON</span> t_learning_record (learn_time <span class="hljs-keyword">DESC</span>, user_id, mastery_rate);
</code></pre>
<h3 data-id="heading-11">索引设计合理性验证：</h3>
<ul>
<li>满足最左前缀匹配：WHERE 条件的 learn_time 范围查询触发索引，后续的 user_id 关联字段可复用索引；</li>
<li>覆盖排序：learn_time DESC 在索引中已排序，避免文件排序；</li>
<li>索引覆盖：查询字段（learn_time、user_id、mastery_rate）均在索引中，无需回表，进一步提升性能。</li>
</ul>
<h2 data-id="heading-12">三、索引失效处理：规避实战中的 “隐形坑”</h2>
<p>创建复合索引后，需验证是否生效，同时处理潜在的索引失效场景。本案例中初期遇到 2 个核心失效问题，通过针对性优化解决。</p>
<h3 data-id="heading-13">1. 失效场景 1：索引字段被函数操作（初始踩坑）</h3>
<h3 data-id="heading-14">问题现象：</h3>
<p>创建索引后，执行 SQL 仍触发全表扫描，执行计划显示 key=NULL，索引未生效。</p>
<h3 data-id="heading-15">排查原因：</h3>
<p>原始 SQL 中 learn_time 字段存在<strong>函数操作</strong>（开发初期为了统一时间格式，添加了 DATE () 函数）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 问题SQL（隐藏函数操作）</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-type">DATE</span>(lr.learn_time) <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-01-07'</span>
</code></pre>
<p>MySQL 中，<strong>索引字段被函数 / 表达式操作后，会导致索引失效</strong>，优化器无法利用索引的有序性进行范围查询。</p>
<h3 data-id="heading-16">解决方案：</h3>
<p>修改 SQL，避免对索引字段进行函数操作，将函数移到条件值上：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 优化后SQL（索引生效）</span>
<span class="hljs-keyword">WHERE</span> lr.learn_time <span class="hljs-keyword">BETWEEN</span> STR_TO_DATE(<span class="hljs-string">'2024-01-01'</span>, <span class="hljs-string">'%Y-%m-%d'</span>) 
                        <span class="hljs-keyword">AND</span> STR_TO_DATE(<span class="hljs-string">'2024-01-07 23:59:59'</span>, <span class="hljs-string">'%Y-%m-%d %H:%i:%s'</span>)
</code></pre>
<h3 data-id="heading-17">2. 失效场景 2：隐式数据类型转换（潜在风险）</h3>
<h3 data-id="heading-18">问题风险：</h3>
<p>若 lr.user_id（BIGINT 类型）与 u.user_id（VARCHAR 类型）关联，会触发<strong>隐式类型转换</strong>（BIGINT→VARCHAR），导致 lr 表的 user_id 字段索引失效。</p>
<h3 data-id="heading-19">解决方案：</h3>
<ul>
<li>确保关联字段类型一致：本案例中已统一为 BIGINT，无需修改；</li>
<li>若无法统一类型，显式转换非索引字段（避免转换索引字段）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 错误：转换索引字段（lr.user_id），导致索引失效</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">CAST</span>(lr.user_id <span class="hljs-keyword">AS</span> <span class="hljs-type">VARCHAR</span>) <span class="hljs-operator">=</span> u.user_id

<span class="hljs-comment">-- 正确：转换非索引字段（u.user_id），索引生效</span>
<span class="hljs-keyword">WHERE</span> lr.user_id <span class="hljs-operator">=</span> <span class="hljs-built_in">CAST</span>(u.user_id <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>)
</code></pre>
<h3 data-id="heading-20">3. 失效场景 3：范围条件后的字段无法复用索引（设计规避）</h3>
<h3 data-id="heading-21">原理：</h3>
<p>复合索引中，若某字段使用范围条件（如 BETWEEN、&gt;、&lt;），则该字段<strong>右侧的所有字段无法复用索引</strong>。</p>
<h3 data-id="heading-22">本案例规避：</h3>
<p>因 learn_time 是范围字段，且在索引最左侧，右侧的 user_id 仍可复用索引（范围条件仅影响 “右侧字段的索引利用”，不影响左侧）；若将 user_id 放在 learn_time 左侧，范围查询后 learn_time 无法复用索引，会导致排序失效。</p>
<h3 data-id="heading-23">4. 索引生效验证（执行计划复查）</h3>
<p>优化后再次执行<code>EXPLAIN</code>，核心结果如下：</p>





































<table><thead><tr><th>表名</th><th>type</th><th>possible_keys</th><th>key</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>t_learning_record（lr）</td><td>range</td><td>idx_learn_time_userid_mastery</td><td>idx_learn_time_userid_mastery</td><td>12000</td><td>Using index condition; Using where</td></tr><tr><td>t_user（u）</td><td>eq_ref</td><td>PRIMARY</td><td>PRIMARY</td><td>1</td><td>Using where</td></tr><tr><td>t_course（c）</td><td>eq_ref</td><td>PRIMARY</td><td>PRIMARY</td><td>1</td><td/></tr></tbody></table>
<h3 data-id="heading-24">关键优化点：</h3>
<ul>
<li>type=range：lr 表使用复合索引进行范围查询，替代全表扫描；</li>
<li>key=idx_learn_time_userid_mastery：索引生效；</li>
<li>rows=12000：预估扫描 1.2 万行，实际扫描 1.5 万行，较之前的 40 万行大幅减少；</li>
<li>Extra=Using index condition：触发「索引条件下推」，在存储引擎层过滤数据，减少回表；无 Using temporary 和 Using filesort，排序和临时表开销消除。</li>
</ul>
<h2 data-id="heading-25">四、优化结果（R - 结果）</h2>
<ol>
<li><strong>性能大幅提升</strong>：SQL 执行耗时从 320ms 降至 130ms（降幅 59%），接口 P99 响应时间从 350ms 降至 120ms；</li>
<li><strong>数据库压力降低</strong>：lr 表的扫描行数从 40 万行降至 1.5 万行，CPU 占用从 75% 降至 30%，主库 QPS 从 880 提升至 2400；</li>
<li><strong>索引稳定性</strong>：线上稳定运行 9 个月，无索引失效情况，慢查询次数从日均 1 万次降至 0。</li>
</ol>
<hr/>
<h2 data-id="heading-26">SWOT 分析：索引优化方案的优劣与落地原则</h2>
<h2 data-id="heading-27">S - 优势（Strengths）</h2>
<ol>
<li><strong>精准匹配业务场景</strong>：复合索引覆盖 WHERE、JOIN、ORDER BY、查询字段，实现 “一次索引解决所有核心需求”；</li>
<li><strong>无额外开销</strong>：基于 MySQL 原生索引能力，无需引入中间件，仅需创建索引，接入成本低；</li>
<li><strong>规避失效风险</strong>：针对性处理函数操作、隐式转换等失效场景，保证索引长期稳定生效；</li>
<li><strong>复用性强</strong>：索引设计原则可复用于其他类似查询场景（多表联查 + 范围条件 + 排序）。</li>
</ol>
<h2 data-id="heading-28">W - 劣势（Weaknesses）</h2>
<ol>
<li><strong>索引维护成本</strong>：复合索引会增加数据写入（INSERT/UPDATE/DELETE）的开销（约 10%），需平衡读写性能；</li>
<li><strong>字段顺序敏感</strong>：若后续 SQL 查询条件变更（如新增过滤字段），可能导致索引无法复用，需重新调整；</li>
<li><strong>不适用于复杂联表</strong>：若联表字段过多或过滤条件不固定，复合索引设计难度大，效果有限。</li>
</ol>
<h2 data-id="heading-29">O - 机会（Opportunities）</h2>
<ol>
<li><strong>结合分区表优化</strong>：对 t_learning_record 按 learn_time 分区，配合复合索引，进一步减少扫描范围；</li>
<li><strong>自动化索引推荐</strong>：使用阿里云智能 SQL 优化、MySQL 8.0 的<code>sys.schema_unused_indexes</code>等工具，自动识别低效索引和优化方向；</li>
<li><strong>索引监控与迭代</strong>：通过慢查询日志、Performance Schema 监控索引使用率，淘汰无用索引，优化现有索引。</li>
</ol>
<h2 data-id="heading-30">T - 威胁（Threats）</h2>
<ol>
<li><strong>数据分布变化</strong>：若 learn_time 的过滤性下降（如用户集中在某段时间学习），索引效果会减弱；</li>
<li><strong>SQL 写法变更</strong>：开发人员修改 SQL 时，可能引入函数操作、隐式转换等，导致索引失效；</li>
<li><strong>MySQL 版本限制</strong>：低版本 MySQL（如 5.7 以下）对复合索引的优化支持不足，可能影响索引利用率。</li>
</ol>
<hr/>
<h2 data-id="heading-31">核心踩坑项回顾（大厂面试重点）</h2>
<ol>
<li><strong>索引字段被函数操作导致失效</strong>：初期 SQL 中 DATE (lr.learn_time) 导致索引失效，优化后移除此函数→<strong>原则</strong>：永远避免对索引字段进行函数 / 表达式操作；</li>
<li><strong>复合索引字段顺序颠倒</strong>：初期尝试<code>idx_userid_learn_time</code>（user_id 在前，learn_time 在后），范围查询后 learn_time 无法复用，排序失效→<strong>原则</strong>：范围字段优先放在复合索引左侧；</li>
<li><strong>忽略索引覆盖导致回表</strong>：初期未包含 mastery_rate 字段，导致索引查询后需回表，耗时增加→<strong>原则</strong>：查询字段较少时，尽量实现索引覆盖，避免回表；</li>
<li><strong>隐式类型转换未察觉</strong>：测试环境中关联字段类型一致，线上环境因历史数据导致类型不匹配，触发索引失效→<strong>原则</strong>：关联字段必须严格统一类型，上线前校验字段类型。</li>
</ol>
<hr/>
<h2 data-id="heading-32">大厂面试核心要点总结</h2>
<ol>
<li><strong>执行计划分析核心</strong>：重点关注 type（扫描方式）、key（索引是否生效）、rows（扫描行数）、Extra（临时表 / 排序 / 索引下推），这 4 个字段能快速定位瓶颈；</li>
<li><strong>复合索引设计原则</strong>：「过滤性优先→JOIN 字段→排序字段→查询字段」，遵循最左前缀匹配，避免范围条件后置；</li>
<li><strong>索引失效高频场景</strong>：函数操作、隐式转换、范围条件后的字段复用、模糊查询（% 开头）、OR 条件未全命中索引，需针对性规避；</li>
<li><strong>优化落地逻辑</strong>：先分析执行计划定位瓶颈→设计贴合场景的索引→验证索引生效→处理失效风险→监控长期稳定性，避免盲目加索引。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain不支持AgentSkills？那就从0到1实现一个！]]></title>    <link>https://juejin.cn/post/7604889577936977947</link>    <guid>https://juejin.cn/post/7604889577936977947</guid>    <pubDate>2026-02-10T09:05:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604889577936977947" data-draft-id="7604666872127012883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain不支持AgentSkills？那就从0到1实现一个！"/> <meta itemprop="keywords" content="人工智能,LangChain,Agent"/> <meta itemprop="datePublished" content="2026-02-10T09:05:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain不支持AgentSkills？那就从0到1实现一个！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:05:57.000Z" title="Tue Feb 10 2026 09:05:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今年以来笔者一直在进行智能体相关的开发工作。在近期的一个项目中遇到了一个非常棘手的问题：随着为大模型挂载的工具数量不断增加，出现了“工具越多，模型越笨”的现象。</p>
<p>想象一下当一个智能体（Agent）需要处理多达50个不同的工具——涵盖数据分析、PDF处理、图像识别、代码生成等多种能力——如果将这50个工具一次性全部注册给Agent，会导致什么后果？至少会引发以下三个明显问题：</p>
<ol>
<li><strong>Token消耗激增</strong>：每次调用模型时，所有工具的描述信息都需要传入上下文，导致token使用量大幅上升。</li>
<li><strong>决策质量下降</strong>：模型需要在大量工具中反复筛选和匹配，选择失误的概率显著增加。</li>
<li><strong>响应延迟加剧</strong>：更长的上下文意味着更慢的推理速度，直接影响交互体验。</li>
</ol>
<p>因此，如何提升大模型调用工具的准确性与效率，一直是智能体工程中的核心挑战。对此，Anthropic公司（Claude模型的创造者）提出了 <strong>Skills（技能）机制</strong>：一种渐进式的提示词加载策略。该机制并非一次性加载所有工具，而是仅在任务需要时才动态引入相关的提示词与工具脚本。这样不仅显著降低了token消耗，也大幅提升了工具调用的精准度。（如果对Agent Skills技术还不熟悉，建议先阅读笔者之前的文章：<a href="https://juejin.cn/post/7598918127578972194" target="_blank" title="https://juejin.cn/post/7598918127578972194">Agent Skills完全指南：核心概念丨设计模式丨实战代码</a>）。</p>
<p>或许有小伙伴会问：“Skills机制似乎更多见于Claude Code、Trae这类代码智能体中，如果我想在自己的项目中实现类似逻辑，该怎么做呢？”  不必担心，本文将基于笔者的实际工作经验，详细介绍如何利用LangChain的中间件机制，从零开始构建一套属于自己的Agent Skills功能。</p>
<h2 data-id="heading-1">一、LangChain AgentSkill核心设计思想</h2>
<p>本文的核心目标是将 Claude Skills 的渐进式加载思想应用于 LangChain 框架中，以解决大规模工具集场景下的调用准确性问题。设计主旨非常明确：<strong>让模型在每次调用时，仅“看到”与当前任务最相关的工具，而非全部工具。</strong></p>
<p>举例来说，假设大家的智能体集成了数据分析、PDF处理、图像识别等数十种工具。当用户提问“帮我分析这份销售数据”时，系统应智能地仅呈现数据分析相关的工具；而当用户需求变为“请总结这篇PDF文档”时，模型则应在上下文中过滤掉无关工具，只保留PDF处理相关选项。</p>
<p>如何实现这一动态筛选机制？在笔者当前使用的 LangChain 1.0 框架中，一个自然而高效的实现途径是利用其<strong>中间件（Middleware）机制</strong>（中间件机制是LangChain 1.0 最核心的变更之一，大家如果不了解可以看笔者之前的文章：<a href="https://juejin.cn/post/7569858467469705267" target="_blank" title="https://juejin.cn/post/7569858467469705267">LangChain1.0速通指南（三）——LangChain1.0 create_agent api 高阶功能</a>）。该机制是 LangChain 1.0 最核心的架构变更之一，它允许开发者在模型调用链的特定环节插入自定义逻辑，从而实现对输入、输出的拦截与处理。笔者初步的实现思路便是借助中间件，在请求到达模型之前，对可供选择的工具列表进行智能过滤。通过分析用户问题或对话上下文，系统可以只保留对当前任务有意义的工具函数，从而大幅缩减模型决策时的干扰项，降低上下文长度，最终实现调用准确性提升与资源消耗降低的双重优化。</p>
<p>这一设计思想在概念上非常直观，但在具体工程落地时，仍需在工具分类、路由策略、上下文感知等细节上精心设计。下文将详细拆解整个实现流程。</p>
<h2 data-id="heading-2">二、LangChain AgentSkill 实现核心思路</h2>
<h3 data-id="heading-3">2.1 双层工具架构</h3>
<p>要实现“按需加载工具”，首先要解决的核心问题是：如何设计一个机制，让大模型在推理时能够动态地看到相关功能的工具，同时过滤掉无关的工具？</p>
<p>笔者采用的方案是<strong>双层工具架构</strong>。其核心思想是将所有工具分为两个层级： <strong>“门面工具”</strong> 和 <strong>“内容工具”</strong> 。</p>
<p>下面通过一个具体例子来直观地理解这一设计：</p>
<p>假设大家有四个具体的功能工具：</p>
<ol>
<li><code>calculate_statistics</code> —— 计算统计数据</li>
<li><code>generate_chart</code> —— 生成图表</li>
<li><code>pdf_to_csv</code> —— 将PDF转换为CSV</li>
<li><code>pdf_to_markdown</code> —— 将PDF转换为Markdown</li>
</ol>
<p>按照业务功能，它们可以分为两类：</p>
<ul>
<li><strong>数据分析类工具</strong>：<code>calculate_statistics</code>、<code>generate_chart</code></li>
<li><strong>PDF处理类工具</strong>：<code>pdf_to_csv</code>、<code>pdf_to_markdown</code></li>
</ul>
<p>在双层工具架构下，会额外引入两个特殊的“门面工具”——笔者称之为 <strong>Loader Tools（加载器工具）</strong> 。它们不直接处理用户任务，而是负责激活对应的Skill类别：</p>
<pre><code class="hljs language-scss" lang="scss">所有工具 (<span class="hljs-number">6</span>个)
├── Loader Tools (<span class="hljs-number">2</span>个)
│   ├── load_data_analysis_skill  (加载数据分析技能)
│   └── load_pdf_processing_skill (加载PDF处理技能)
└── <span class="hljs-attribute">Content</span> Tools (<span class="hljs-number">4</span>个)
    ├── calculate_statistics (数据分析类)
    ├── generate_chart       (数据分析类)
    ├── pdf_to_csv          (PDF处理类)
    └── pdf_to_markdown     (PDF处理类)
</code></pre>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/473f6d73bfcf4bc0ad15c613eb4019d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319159&amp;x-signature=H84uA5jsKy24cK%2BI2FEx0w8wxnQ%3D" alt="0.png" width="70%" loading="lazy"/></p>
<p><strong>这样设计的好处在于</strong>：在初始状态下，模型只需“认知”两个Loader Tools（而不是全部六个工具），这极大地降低了模型的认知负担与上下文长度。只有当模型调用某个Loader Tool后，对应的Skill（即一组内容工具）才会被动态加载到后续上下文中，供模型选用。同时，Loader Tools本身会始终保留在工具列表中，以便模型在未来可以激活其他Skill。</p>
<h3 data-id="heading-4">2.2 状态驱动的动态过滤</h3>
<p>引入Loader Tools后，下一个问题是：如何让模型在后续调用中“看到”被激活的特定工具集，而不是全部工具？笔者这里通过一个中心化的状态（State）中的变量<code>skills_loaded</code>来跟踪当前已加载的Skills，并基于此状态在每次模型调用前动态过滤工具列表。</p>
<p>具体工作流程如下：</p>
<ol>
<li>用户提问：<code>“请调用数据分析工具分析这份数据。”</code></li>
<li>模型在首轮推理中，识别出需要<code>load_data_analysis_skill</code>这个加载器工具，并调用它。</li>
<li>该Loader Tool的执行逻辑会更新LangChain智能体的运行时状态（State），在<code>skills_loaded</code>列表中添加<code>”data_analysis”</code>标识。</li>
<li>在下一轮模型调用开始前，我们的自定义中间件会读取<code>skills_loaded</code>状态，并只筛选出属于<code>data_analysis</code>类别的工具（如<code>calculate_statistics</code>、<code>generate_chart</code>），动态地替换掉原本的工具列表。</li>
<li>模型在缩小的、精确的工具范围内进行选择，准确率和效率得到提升。</li>
</ol>
<h3 data-id="heading-5">2.3 中间件拦截机制</h3>
<p>从上述流程可知，实现的关键在于<strong>在模型调用前拦截请求，并依据状态动态修改其可用的工具列表</strong>。这需要利用LangChain的中间件（Middleware）机制。</p>
<p>LangChain关于模型调用的中间件主要提供了两个钩子（Hook）：</p>
<ul>
<li><code>before_model</code>：在模型调用<strong>前</strong>执行，通常用于检查和修改状态或上下文。</li>
<li><code>wrap_model</code>：在模型调用<strong>前后</strong>执行，它可以<strong>包装并拦截整个模型调用过程</strong>。</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/709b3bf5cadb4751863aca9949ad254b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319159&amp;x-signature=s3Jrp66%2FcpMj4S7P%2B9F8qjCfaCc%3D" alt="1.png" width="50%" loading="lazy"/></p>
<p>对于本场景<code>wrap_model</code>是更合适的选择。因为该中间件需要完成的操作是：读取状态 -&gt; 动态过滤工具 -&gt; 将过滤后的新工具列表注入模型请求 -&gt; 继续执行调用链。</p>
<p><code>wrap_model</code>方法的核心参数和逻辑如下：</p>
<ul>
<li><strong><code>request</code></strong>：包含了本次模型调用的所有信息（如提示词、工具列表、状态等）。</li>
<li><strong><code>handler</code></strong>：用于继续执行调用链的函数。</li>
</ul>
<p><strong>关键操作</strong>：使用<code>request.override()</code>方法创建一个新的请求对象，用过滤后的工具列表覆盖原请求中的工具。</p>
<p>一个简化的实现示例如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">wap_model_call</span>(<span class="hljs-params">self, request, handler</span>):
    <span class="hljs-comment"># 步骤 1：从状态中读取已加载的 Skills</span>
    skills_loaded = request.state.get(<span class="hljs-string">"skills_loaded"</span>, [])
    
    <span class="hljs-comment"># 步骤 2：根据状态过滤工具</span>
    relevant_tools = self.registry.get_tools_for_skills(skills_loaded)
    
    <span class="hljs-comment"># 步骤 3：覆盖请求中的工具列表（关键！）</span>
    filtered_request = request.override(tools=relevant_tools)
    
    <span class="hljs-comment"># 步骤 4：继续处理链</span>
    <span class="hljs-keyword">return</span> handler(filtered_request)
</code></pre>
<h2 data-id="heading-6">三、LangChain AgentSkill 实现核心架构与源码解析</h2>
<p>理解了核心思路后，下一步就是要将其转化为可用代码，一个清晰、模块化的架构至关重要。为了方便大家阅读和实现，笔者已经将完整的代码开源（项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTangBaron%2FLangChain_Agent_Skill%2Ftree%2Fmain" target="_blank" title="https://github.com/TangBaron/LangChain_Agent_Skill/tree/main" ref="nofollow noopener noreferrer">github.com/TangBaron/L…</a>）。国内访问GitHub不便的小伙伴，可以关注笔者的掘金账号与专栏，或关注同名微信公众号 <strong>大模型真好玩</strong>，私信 <strong>LangChain智能体开发</strong> 即可免费获取全部代码。</p>
<h3 data-id="heading-7">3.1 架构描述</h3>
<p>在深入代码之前，笔者先绘制下面的架构图帮助大家了解实现的整体层次与数据流:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/968464e93af2484dac0c9b21bc2992ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319159&amp;x-signature=%2FXA3vfw5WPEh%2BD9y1F6ky8Ml5Pk%3D" alt="2.png" loading="lazy"/></p>
<p>整个架构可分为三个核心层，它们协同工作以实现技能的动态加载：</p>
<ol>
<li><strong>Skill定义层</strong>：开发者在此按照规范定义具体的技能（Skill）。每个Skill包含两个核心部分：<code>instruction.md</code>（用于描述该技能的适用场景和其包含的工具）和 <code>skill.py</code> 文件。<code>skill.py</code>文件中需要编写一个继承自<code>BaseSkill</code>的类，并实现<code>get_loader_tool()</code>（返回激活该技能的加载器工具）和<code>get_tools()</code>（返回该技能包含的所有功能工具）类，比如数据分析就需要定义<code>DataAnalysisSkill</code>。</li>
<li><strong>Skill注册层</strong>：通过一个中心的<code>SkillRegistry</code>（技能注册表）类来统一管理所有已定义的Skill。它主要提供<code>register()</code>方法用于注册Skill，以及<code>get_tools_for_skills()</code>方法用于根据提供的skill获得应被激活的工具列表。</li>
<li><strong>中间件层</strong>：这是连接LangChain框架与上述逻辑的桥梁。通过自定义一个继承自<code>AgentMiddleware</code>的<code>SkillMiddleware</code>类，并重写其<code>wrap_model_call()</code>方法。在此方法中，中间件会读取运行时状态，调用<code>SkillRegistry</code>来过滤工具，并动态修改发送给模型的请求。</li>
</ol>
<h3 data-id="heading-8">3.2 关键实现细节</h3>
<h4 data-id="heading-9">3.2.1 Skill定义层：<code>BaseSkill</code>基类</h4>
<p>所有用户自定义的Skill都必须继承自<code>BaseSkill</code>抽象基类。它的核心职责是定义两类工具，源码位于项目 <code>/core/base_skill.py</code>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseSkill</span>(<span class="hljs-title class_ inherited__">ABC</span>):
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_loader_tool</span>(<span class="hljs-params">self</span>) -&gt; BaseTool:
        <span class="hljs-string">"""返回 Loader Tool - 始终可见，负责激活 Skill"""</span>
        <span class="hljs-keyword">pass</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tools</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">List</span>[BaseTool]:
        <span class="hljs-string">"""返回实际工具 - 仅激活后可见"""</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p><strong>关键点</strong>：<code>get_loader_tool()</code> 返回的加载器工具，其核心作用不仅仅是作为一个工具函数，更重要的是在工具被调用时，需要更新Agent的运行时状态（state），将当前Skill的名称（如 <code>"data_analysis"</code>）添加到 <code>skills_loaded</code> 列表中。这样，中间件才能在后续步骤中感知到这个Skill已被激活。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_loader_tool</span>(<span class="hljs-params">self</span>) -&gt; BaseTool:
<span class="hljs-meta">    @tool</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">skill_data_analysis</span>(<span class="hljs-params">runtime</span>) -&gt; Command:
        <span class="hljs-keyword">return</span> Command(
            update={
                <span class="hljs-string">"messages"</span>: [ToolMessage(content=instructions, ...)],
                <span class="hljs-string">"skills_loaded"</span>: [<span class="hljs-string">"data_analysis"</span>]  <span class="hljs-comment"># 关键：更新状态</span>
            }
        )
    <span class="hljs-keyword">return</span> skill_data_analysis
</code></pre>
<h4 data-id="heading-10">3.2.2 Skill注册层：<code>SkillRegistry</code> 查询逻辑</h4>
<p><code>SkillRegistry</code> 的核心源码位于 <code>/core/registry.py</code>。它的 <code>get_tools_for_skills()</code> 方法是整个动态过滤逻辑的核心，其设计有一个重要原则：<strong>始终包含所有Loader Tools</strong>。即使当前已经激活了<code>data_analysis</code>技能，返回的工具列表中依然包含<code>load_pdf_processing_skill</code>等所有其他加载器工具。这是为了确保Agent在后续对话中，如果用户需求改变（例如从“分析数据”切换到“处理PDF”），模型仍然有机会调用对应的Loader来激活新的技能，从而保持智能体功能的灵活性。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_tools_for_skills</span>(<span class="hljs-params">self, skill_names: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-type">List</span>[BaseTool]:
    <span class="hljs-string">"""
    返回：所有 Loader Tools + 已加载 Skills 的工具
    
    为什么包含所有 Loader Tools？
    - 因为模型可能需要激活新的 Skill
    """</span>
    tools = self.get_all_loader_tools()  <span class="hljs-comment"># 始终包含</span>
    
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> skill_names:
        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self._skills:
            tools.extend(self._skills[name].get_tools())
    
    <span class="hljs-keyword">return</span> tools
</code></pre>
<h4 data-id="heading-11">3.2.3 中间件层：<code>SkillMiddleware</code> 拦截逻辑</h4>
<p><code>SkillMiddleware</code> 的核心代码同样在 <code>/middle/skill_middleware.py</code>。它的 <code>wrap_model_call</code> 方法在每次模型被调用前执行，是实施动态过滤的“开关”。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrap_model_call</span>(<span class="hljs-params">self, request, handler</span>):
    <span class="hljs-comment"># 步骤 1：从状态中读取已加载的 Skills</span>
    skills_loaded = request.state.get(<span class="hljs-string">"skills_loaded"</span>, [])
    
    <span class="hljs-comment"># 步骤 2：根据状态过滤工具</span>
    relevant_tools = self.registry.get_tools_for_skills(skills_loaded)
    
    <span class="hljs-comment"># 步骤 3：覆盖请求中的工具列表（关键！）</span>
    filtered_request = request.override(tools=relevant_tools)
    
    <span class="hljs-comment"># 步骤 4：继续处理链</span>
    <span class="hljs-keyword">return</span> handler(filtered_request)
</code></pre>
<h3 data-id="heading-12">3.3 完整执行流程示例</h3>
<p>下面笔者通过一个具体场景，将上述所有组件串联起来，加深理解：</p>
<p><strong>场景</strong>：用户要求“计算这份数据的中位数和平均数”。</p>
<p><strong>初始状态</strong>：</p>
<ul>
<li><code>skills_loaded = []</code> （空列表）</li>
<li>Agent 注册了 50 个工具（其中10个是Loader Tools，40个是实际的功能工具，只是为了之后筛选，工具函数的说明并不会进入上下文）</li>
</ul>
<p><strong>第 1 次模型调用</strong>：</p>
<ol>
<li><code>SkillMiddleware</code> 拦截请求，读取状态：<code>skills_loaded = []</code>。</li>
<li>调用 <code>SkillRegistry.get_tools_for_skills([])</code>，返回结果：<strong>仅包含10个Loader Tools</strong>。</li>
<li>模型接收到的请求中，<code>tools</code> 列表被替换为这10个Loader Tools。</li>
<li>模型分析用户问题，决策调用 <code>skill_data_analysis</code> 这个Loader Tool。</li>
</ol>
<p><strong>状态更新</strong>：</p>
<ul>
<li>Loader Tool 执行，将 <code>"data_analysis"</code> 加入状态，现在 <code>skills_loaded = [“data_analysis”]</code>。</li>
</ul>
<p><strong>第 2 次模型调用</strong>：</p>
<ol>
<li><code>SkillMiddleware</code> 再次拦截，读取新状态：<code>skills_loaded = [“data_analysis”]</code>。</li>
<li>调用 <code>SkillRegistry.get_tools_for_skills([“data_analysis”])</code>，返回：<strong>10个Loader Tools + 数据分析Skill下的所有功能工具（例如 <code>calculate_statistics</code>）</strong> 。</li>
<li>模型在新工具列表（共14个）中看到 <code>calculate_statistics</code> 工具。</li>
<li>模型决策调用 <code>calculate_statistics</code> 工具，完成任务。</li>
</ol>
<p>至此，整个动态加载、状态驱动、中间件拦截的流程就清晰完成了。通过这个架构成功地将一次性的从50个工具中选的“大海捞针”，变成了两次高效的“按图索骥”。</p>
<p>到现在为止整个的执行流程是不是非常清晰了，还有疑虑的点大家可以关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，分享涉及的完整代码均可在公众号私信: <strong>LangChain智能体开发</strong> 免费获取，搭配大模型阅读食用效果更佳！大家也可以在源代码基础上轻松扩展包括权限控制、工具依赖管理等各种特性，实现大家私人定制的skill 功能，赶紧动手实践起来吧~</p>
<h2 data-id="heading-13">四、总结</h2>
<p>本篇内容是笔者针对LangChain智能体工具过多导致性能下降的问题设计的一种仿Claude Skills的解决方案。其核心是通过双层工具架构（Loader Tools与Content Tools）、状态驱动与中间件拦截机制，实现工具的按需动态加载，从而显著降低Token消耗并提升模型调用工具的准确性与效率。</p>
<p><a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>专栏内容源自笔者在实际学习和工作中对 LangChain 与 LangGraph 的深度使用经验，旨在帮助大家系统性地、高效地掌握 AI Agent 的开发方法，在各大技术平台获得了不少关注与支持。目前已更新38讲，正在更新LangGraph1.0速通指南，并随时补充笔者在实际工作中总结的拓展知识点。如果大家感兴趣，欢迎关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<p>大模型时代的到来注定是颠覆世界的第四次工业革命，也希望大家可以紧跟AI时代的潮流，把握AI时代的风口。2026注定是大模型接续爆发的一年！为了让大家彻底搞懂大模型的作用原理，笔者也发布了<a href="https://juejin.cn/column/7594655863548248116" target="_blank" title="https://juejin.cn/column/7594655863548248116">《数据到模型到应用：大模型训练全流程实战指南》</a>专栏，预计会有50期内容，将系统拆解从数据处理、模型训练到强化学习与智能体开发的全流程，并带大家从零实现模型，帮助大家掌握大模型训练的全技能，真正掌握塑造智能的能力！</p>
<p>需要注意的是：大模型训练对计算资源有一定要求，尤其是GPU显存。为降低学习门槛，笔者与国内主流云平台合作，大家可以通过打开网站: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> ，体验H100 GPU 6.5小时的算力。本系列所有实战教程均将在该平台上完成，帮助大家低成本上手实践。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3.5 性能优化实战：10个技巧让你的应用快3倍（附完整代码）]]></title>    <link>https://juejin.cn/post/7605051978871210003</link>    <guid>https://juejin.cn/post/7605051978871210003</guid>    <pubDate>2026-02-10T09:03:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871210003" data-draft-id="7604757482005315647" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3.5 性能优化实战：10个技巧让你的应用快3倍（附完整代码）"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-02-10T09:03:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小饼干hualuo"/> <meta itemprop="url" content="https://juejin.cn/user/3368559359832120"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3.5 性能优化实战：10个技巧让你的应用快3倍（附完整代码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559359832120/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小饼干hualuo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:03:20.000Z" title="Tue Feb 10 2026 09:03:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    38
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 前言：为什么我要写这篇文章？</h2>
<p>作为一名在大厂摸爬滚打多年的前端工程师，我见过太多因为性能问题而被用户吐槽的Vue应用：</p>
<ul>
<li><strong>首屏白屏3-5秒</strong>，用户直接关闭页面</li>
<li><strong>列表滚动卡顿</strong>，万条数据渲染让页面直接卡死</li>
<li><strong>表单输入延迟</strong>，复杂表单每次输入都要等半秒</li>
<li><strong>内存泄漏严重</strong>，页面用久了越来越慢</li>
</ul>
<p>Vue 3.5 正式发布后，我花了2个月时间在生产环境中实践新特性，通过10个核心优化技巧，成功将我们的企业级应用性能提升了<strong>300%</strong>：</p>
<ul>
<li>✅ <strong>首屏加载时间</strong>：从 4.2s 降至 1.4s</li>
<li>✅ <strong>列表渲染性能</strong>：万条数据从卡顿3秒到流畅滚动</li>
<li>✅ <strong>内存占用</strong>：减少 40% 的内存泄漏</li>
<li>✅ <strong>打包体积</strong>：减小 35% 的bundle大小</li>
</ul>
<p><strong>读完这篇文章，你将收获：</strong></p>
<ul>
<li>Vue 3.5 最新性能优化API的实战用法</li>
<li>10个立即可用的性能优化技巧</li>
<li>完整的性能监控和测试方案</li>
<li>企业级应用的最佳实践经验</li>
</ul>
<h2 data-id="heading-1">2. 背景知识快速说明</h2>
<h3 data-id="heading-2">Vue 3.5 性能提升核心亮点</h3>
<p>Vue 3.5 在性能方面有三大突破：</p>
<ol>
<li><strong>响应式系统优化</strong>：新增 <code>effectScope</code> API，提供更精确的副作用管理</li>
<li><strong>渲染性能提升</strong>：<code>v-memo</code> 指令优化，智能缓存渲染结果</li>
<li><strong>编译时优化</strong>：更激进的 Tree-shaking，减少 30% 的运行时代码</li>
</ol>
<h3 data-id="heading-3">性能优化的三个维度</h3>
<ul>
<li><strong>运行时性能</strong>：响应式更新、组件渲染、内存管理</li>
<li><strong>加载时性能</strong>：代码分割、资源预加载、缓存策略</li>
<li><strong>开发时性能</strong>：构建速度、热更新效率</li>
</ul>
<h2 data-id="heading-4">3. 核心实现思路（重点）</h2>
<h3 data-id="heading-5">Step1：响应式系统精细化管理</h3>
<p>通过 <code>effectScope</code>、<code>shallowRef</code>、<code>readonly</code> 等API，精确控制响应式的粒度和范围，避免不必要的响应式开销。</p>
<h3 data-id="heading-6">Step2：组件渲染智能优化</h3>
<p>利用 <code>v-memo</code>、<code>KeepAlive</code>、异步组件等特性，减少重复渲染和DOM操作，提升用户交互体验。</p>
<h3 data-id="heading-7">Step3：构建与加载策略优化</h3>
<p>通过代码分割、Tree-shaking、预加载等技术，优化应用的加载性能和运行时体积。</p>
<h2 data-id="heading-8">4. 完整代码示例（必须可运行）</h2>
<h3 data-id="heading-9">技巧1：effectScope 精确管理副作用</h3>
<p>在Vue 3.5中，<code>effectScope</code> 是解决内存泄漏的神器。传统方式下，我们需要手动清理每个 watch 和 computed，现在可以批量管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 传统方式 - 容易遗漏清理</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">const</span> doubled = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> counter.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">const</span> stopWatcher1 = <span class="hljs-title function_">watch</span>(counter, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Counter changed:'</span>, val)
    })
    
    <span class="hljs-keyword">const</span> stopWatcher2 = <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`Count: <span class="hljs-subst">${counter.value}</span>`</span>
    })
    
    <span class="hljs-comment">// 组件卸载时需要手动清理 - 容易遗漏</span>
    <span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">stopWatcher1</span>()
      <span class="hljs-title function_">stopWatcher2</span>()
    })
    
    <span class="hljs-keyword">return</span> { counter, doubled }
  }
})

<span class="hljs-comment">// Vue 3.5 优化方式 - 自动批量清理</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> scope = <span class="hljs-title function_">effectScope</span>()
    
    <span class="hljs-keyword">const</span> { counter, doubled } = scope.<span class="hljs-title function_">run</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
      <span class="hljs-keyword">const</span> doubled = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> counter.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>)
      
      <span class="hljs-comment">// 所有副作用都在scope中管理</span>
      <span class="hljs-title function_">watch</span>(counter, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Counter changed:'</span>, val)
      })
      
      <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`Count: <span class="hljs-subst">${counter.value}</span>`</span>
      })
      
      <span class="hljs-keyword">return</span> { counter, doubled }
    })!
    
    <span class="hljs-comment">// 组件卸载时一键清理所有副作用</span>
    <span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
      scope.<span class="hljs-title function_">stop</span>()
    })
    
    <span class="hljs-keyword">return</span> { counter, doubled }
  }
})
</code></pre>
<p><strong>性能提升</strong>：内存泄漏减少90%，组件卸载速度提升50%</p>
<h3 data-id="heading-10">技巧2：shallowRef 优化大对象性能</h3>
<p>对于图表数据、配置对象等大型数据结构，使用 <code>shallowRef</code> 可以显著提升性能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 传统方式 - 深度响应式导致性能问题</span>
<span class="hljs-keyword">const</span> chartData = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">datasets</span>: [
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'Sales'</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>),
      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(75, 192, 192, 0.2)'</span>
    }
  ],
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">responsive</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">plugins</span>: {
      <span class="hljs-attr">legend</span>: { <span class="hljs-attr">position</span>: <span class="hljs-string">'top'</span> },
      <span class="hljs-attr">title</span>: { <span class="hljs-attr">display</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Sales Chart'</span> }
    }
  }
})

<span class="hljs-comment">// 每次数据更新都会触发深度响应式检查 - 性能差</span>

<span class="hljs-comment">// Vue 3.5 优化方式 - 浅层响应式</span>
<span class="hljs-keyword">const</span> chartData = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">datasets</span>: [
    {
      <span class="hljs-attr">label</span>: <span class="hljs-string">'Sales'</span>, 
      <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>),
      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'rgba(75, 192, 192, 0.2)'</span>
    }
  ],
  <span class="hljs-attr">options</span>: {
    <span class="hljs-attr">responsive</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">plugins</span>: {
      <span class="hljs-attr">legend</span>: { <span class="hljs-attr">position</span>: <span class="hljs-string">'top'</span> },
      <span class="hljs-attr">title</span>: { <span class="hljs-attr">display</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Sales Chart'</span> }
    }
  }
})

<span class="hljs-comment">// 更新数据的正确方式</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateChartData</span> = (<span class="hljs-params">newData: <span class="hljs-built_in">number</span>[]</span>) =&gt; {
  <span class="hljs-comment">// 直接修改不会触发更新</span>
  chartData.<span class="hljs-property">value</span>.<span class="hljs-property">datasets</span>[<span class="hljs-number">0</span>].<span class="hljs-property">data</span> = newData
  
  <span class="hljs-comment">// 手动触发更新 - 精确控制更新时机</span>
  <span class="hljs-title function_">triggerRef</span>(chartData)
}

<span class="hljs-comment">// 在组合式函数中的应用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useChartData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> chartData = <span class="hljs-title function_">shallowRef</span>({
    <span class="hljs-attr">datasets</span>: [],
    <span class="hljs-attr">options</span>: {}
  })
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateData</span> = (<span class="hljs-params">newDatasets: <span class="hljs-built_in">any</span>[]</span>) =&gt; {
    chartData.<span class="hljs-property">value</span>.<span class="hljs-property">datasets</span> = newDatasets
    <span class="hljs-title function_">triggerRef</span>(chartData)
  }
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateOptions</span> = (<span class="hljs-params">newOptions: <span class="hljs-built_in">any</span></span>) =&gt; {
    chartData.<span class="hljs-property">value</span>.<span class="hljs-property">options</span> = { ...chartData.<span class="hljs-property">value</span>.<span class="hljs-property">options</span>, ...newOptions }
    <span class="hljs-title function_">triggerRef</span>(chartData)
  }
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">chartData</span>: <span class="hljs-title function_">readonly</span>(chartData),
    updateData,
    updateOptions
  }
}
</code></pre>
<p><strong>性能提升</strong>：大对象更新性能提升80%，内存占用减少40%</p>
<h3 data-id="heading-11">技巧3：v-memo 智能缓存大列表渲染</h3>
<p><code>v-memo</code> 是Vue 3.5中最强大的渲染优化指令，特别适合大列表场景：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 传统方式 - 每次都重新渲染 --&gt;
  &lt;div class="traditional-list"&gt;
    &lt;div 
      v-for="item in expensiveList" 
      :key="item.id"
      class="list-item"
    &gt;
      &lt;ExpensiveComponent :data="item" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Vue 3.5 优化方式 - 智能缓存 --&gt;
  &lt;div class="optimized-list"&gt;
    &lt;div 
      v-for="item in expensiveList" 
      :key="item.id"
      v-memo="[item.id, item.status, item.selected]"
      class="list-item"
    &gt;
      &lt;ExpensiveComponent :data="item" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- 复杂场景：结合计算属性的缓存策略 --&gt;
  &lt;div class="advanced-list"&gt;
    &lt;div 
      v-for="item in processedList" 
      :key="item.id"
      v-memo="[item.memoKey]"
      class="list-item"
    &gt;
      &lt;ComplexComponent 
        :data="item"
        :user="currentUser"
        :permissions="userPermissions"
      /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
interface ListItem {
  id: string
  name: string
  status: 'active' | 'inactive'
  selected: boolean
  data: any[]
  lastModified: number
}

const expensiveList = ref&lt;ListItem[]&gt;([])
const currentUser = ref({ id: '1', name: 'John' })
const userPermissions = ref(['read', 'write'])

// 计算属性优化：预计算memo key
const processedList = computed(() =&gt; {
  return expensiveList.value.map(item =&gt; ({
    ...item,
    // 将多个依赖项合并为单个memo key
    memoKey: `${item.id}-${item.status}-${item.selected}-${currentUser.value.id}-${userPermissions.value.join(',')}`
  }))
})

// 性能监控：对比渲染次数
const renderCount = ref(0)
const memoHitCount = ref(0)

// 模拟大量数据
const generateLargeList = () =&gt; {
  expensiveList.value = Array.from({ length: 10000 }, (_, index) =&gt; ({
    id: `item-${index}`,
    name: `Item ${index}`,
    status: Math.random() &gt; 0.5 ? 'active' : 'inactive',
    selected: false,
    data: Array.from({ length: 100 }, () =&gt; Math.random()),
    lastModified: Date.now()
  }))
}

// 批量更新优化
const batchUpdateItems = (updates: Partial&lt;ListItem&gt;[]) =&gt; {
  // 使用 nextTick 确保批量更新
  nextTick(() =&gt; {
    updates.forEach(update =&gt; {
      const index = expensiveList.value.findIndex(item =&gt; item.id === update.id)
      if (index !== -1) {
        Object.assign(expensiveList.value[index], update)
      }
    })
  })
}

onMounted(() =&gt; {
  generateLargeList()
})
&lt;/script&gt;
</code></pre>
<p><strong>性能提升</strong>：大列表渲染性能提升200%，滚动帧率从30fps提升到60fps</p>
<h3 data-id="heading-12">技巧4：KeepAlive 智能缓存策略</h3>
<p>合理使用 <code>KeepAlive</code> 可以显著提升路由切换性能：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 路由级别的KeepAlive配置 --&gt;
&lt;template&gt;
  &lt;router-view v-slot="{ Component, route }"&gt;
    &lt;KeepAlive 
      :include="cacheableRoutes"
      :exclude="noCacheRoutes"
      :max="maxCacheCount"
    &gt;
      &lt;component 
        :is="Component" 
        :key="route.meta.keepAliveKey || route.fullPath"
      /&gt;
    &lt;/KeepAlive&gt;
  &lt;/router-view&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
// 智能缓存策略配置
const cacheableRoutes = ref([
  'UserList',      // 用户列表页 - 数据加载慢，适合缓存
  'ProductDetail', // 商品详情页 - 复杂计算，适合缓存
  'Dashboard'      // 仪表盘 - 图表渲染慢，适合缓存
])

const noCacheRoutes = ref([
  'Login',         // 登录页 - 安全考虑，不缓存
  'Payment',       // 支付页 - 实时性要求，不缓存
  'Settings'       // 设置页 - 状态变化频繁，不缓存
])

const maxCacheCount = ref(10) // 最多缓存10个组件

// 动态缓存管理
const cacheManager = {
  // 根据用户行为动态调整缓存策略
  adjustCacheStrategy(route: RouteLocationNormalized) {
    const { meta } = route
    
    // 高频访问页面优先缓存
    if (meta.visitCount &amp;&amp; meta.visitCount &gt; 5) {
      if (!cacheableRoutes.value.includes(route.name as string)) {
        cacheableRoutes.value.push(route.name as string)
      }
    }
    
    // 内存占用过高时清理缓存
    if (performance.memory &amp;&amp; performance.memory.usedJSHeapSize &gt; 100 * 1024 * 1024) {
      maxCacheCount.value = Math.max(3, maxCacheCount.value - 2)
    }
  },
  
  // 手动清理特定缓存
  clearCache(routeName: string) {
    const index = cacheableRoutes.value.indexOf(routeName)
    if (index &gt; -1) {
      cacheableRoutes.value.splice(index, 1)
      // 触发重新渲染
      nextTick(() =&gt; {
        cacheableRoutes.value.push(routeName)
      })
    }
  }
}

// 组件级别的缓存优化
export default defineComponent({
  name: 'ExpensiveComponent',
  setup() {
    // 缓存激活时的数据恢复
    onActivated(() =&gt; {
      console.log('Component activated from cache')
      // 恢复滚动位置
      restoreScrollPosition()
      // 刷新实时数据
      refreshRealTimeData()
    })
    
    // 缓存失活时的清理工作
    onDeactivated(() =&gt; {
      console.log('Component deactivated to cache')
      // 保存滚动位置
      saveScrollPosition()
      // 暂停定时器
      pauseTimers()
    })
    
    const restoreScrollPosition = () =&gt; {
      const savedPosition = sessionStorage.getItem('scrollPosition')
      if (savedPosition) {
        window.scrollTo(0, parseInt(savedPosition))
      }
    }
    
    const saveScrollPosition = () =&gt; {
      sessionStorage.setItem('scrollPosition', window.scrollY.toString())
    }
    
    return {}
  }
})
&lt;/script&gt;
</code></pre>
<p><strong>性能提升</strong>：路由切换速度提升150%，用户体验显著改善</p>
<h3 data-id="heading-13">技巧5：异步组件与代码分割优化</h3>
<p>通过异步组件实现精细化的代码分割：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 传统方式 - 全量导入</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/UserList.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProductDetail</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ProductDetail.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Dashboard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/Dashboard.vue'</span>

<span class="hljs-comment">// Vue 3.5 优化方式 - 异步组件 + 预加载策略</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncUserList</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/components/UserList.vue'</span>),
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">LoadingSpinner</span>,
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">ErrorComponent</span>,
  <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>,
  <span class="hljs-attr">suspensible</span>: <span class="hljs-literal">true</span>
})

<span class="hljs-comment">// 高级异步组件配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createAsyncComponent</span> = (<span class="hljs-params">
  loader: () =&gt; <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;,
  options: {
    preload?: <span class="hljs-built_in">boolean</span>
    priority?: <span class="hljs-string">'high'</span> | <span class="hljs-string">'low'</span>
    chunkName?: <span class="hljs-built_in">string</span>
  } = {}
</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">defineAsyncComponent</span>({
    <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> componentPromise = <span class="hljs-title function_">loader</span>()
      
      <span class="hljs-comment">// 预加载策略</span>
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">preload</span>) {
        <span class="hljs-comment">// 在空闲时间预加载</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'requestIdleCallback'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
          <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">() =&gt;</span> {
            componentPromise.<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {}) <span class="hljs-comment">// 静默处理预加载错误</span>
          })
        }
      }
      
      <span class="hljs-keyword">return</span> componentPromise
    },
    <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title function_">defineComponent</span>({
      <span class="hljs-attr">template</span>: <span class="hljs-string">`
        &lt;div class="loading-container"&gt;
          &lt;div class="loading-spinner"&gt;&lt;/div&gt;
          &lt;p&gt;Loading <span class="hljs-subst">${options.chunkName || <span class="hljs-string">'component'</span>}</span>...&lt;/p&gt;
        &lt;/div&gt;
      `</span>
    }),
    <span class="hljs-attr">errorComponent</span>: <span class="hljs-title function_">defineComponent</span>({
      <span class="hljs-attr">props</span>: [<span class="hljs-string">'error'</span>],
      <span class="hljs-attr">template</span>: <span class="hljs-string">`
        &lt;div class="error-container"&gt;
          &lt;p&gt;Failed to load component: {{ error.message }}&lt;/p&gt;
          &lt;button @click="$emit('retry')"&gt;Retry&lt;/button&gt;
        &lt;/div&gt;
      `</span>
    }),
    <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">suspensible</span>: <span class="hljs-literal">true</span>
  })
}

<span class="hljs-comment">// 路由级别的代码分割</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/users'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserList'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title function_">createAsyncComponent</span>(
      <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "user-module" */</span> <span class="hljs-string">'@/views/UserList.vue'</span>),
      { <span class="hljs-attr">preload</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">priority</span>: <span class="hljs-string">'high'</span>, <span class="hljs-attr">chunkName</span>: <span class="hljs-string">'User List'</span> }
    )
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/products/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'ProductDetail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title function_">createAsyncComponent</span>(
      <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "product-module" */</span> <span class="hljs-string">'@/views/ProductDetail.vue'</span>),
      { <span class="hljs-attr">preload</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">priority</span>: <span class="hljs-string">'low'</span>, <span class="hljs-attr">chunkName</span>: <span class="hljs-string">'Product Detail'</span> }
    )
  }
]

<span class="hljs-comment">// 智能预加载管理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PreloadManager</span> {
  <span class="hljs-keyword">private</span> preloadedComponents = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;()
  <span class="hljs-keyword">private</span> <span class="hljs-attr">preloadQueue</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;&gt; = []
  
  <span class="hljs-comment">// 根据用户行为预加载组件</span>
  <span class="hljs-title function_">preloadByUserBehavior</span>(<span class="hljs-params">routeName: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">preloadedComponents</span>.<span class="hljs-title function_">has</span>(routeName)) <span class="hljs-keyword">return</span>
    
    <span class="hljs-keyword">const</span> route = routes.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">name</span> === routeName)
    <span class="hljs-keyword">if</span> (route &amp;&amp; <span class="hljs-string">'requestIdleCallback'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
      <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">() =&gt;</span> {
        route.<span class="hljs-property">component</span>.<span class="hljs-title function_">loader</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">preloadedComponents</span>.<span class="hljs-title function_">add</span>(routeName)
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Preloaded component: <span class="hljs-subst">${routeName}</span>`</span>)
        })
      })
    }
  }
  
  <span class="hljs-comment">// 批量预加载高优先级组件</span>
  <span class="hljs-title function_">preloadHighPriorityComponents</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> highPriorityRoutes = routes.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">component</span>.<span class="hljs-property">priority</span> === <span class="hljs-string">'high'</span>)
    
    highPriorityRoutes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">preloadQueue</span>.<span class="hljs-title function_">push</span>(route.<span class="hljs-property">component</span>.<span class="hljs-property">loader</span>)
    })
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processPreloadQueue</span>()
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">processPreloadQueue</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">preloadQueue</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> loader = <span class="hljs-variable language_">this</span>.<span class="hljs-property">preloadQueue</span>.<span class="hljs-title function_">shift</span>()!
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">loader</span>()
        <span class="hljs-comment">// 控制预加载速度，避免影响主线程</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>))
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Preload failed:'</span>, error)
      }
    }
  }
}

<span class="hljs-keyword">const</span> preloadManager = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PreloadManager</span>()

<span class="hljs-comment">// 在应用启动时预加载关键组件</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  preloadManager.<span class="hljs-title function_">preloadHighPriorityComponents</span>()
})
</code></pre>
<p><strong>性能提升</strong>：首屏加载时间减少60%，按需加载命中率提升90%</p>
<h2 data-id="heading-14">5. 企业级最佳实践</h2>
<h3 data-id="heading-15">项目结构建议</h3>
<pre><code class="hljs language-csharp" lang="csharp">src/
├── components/
│   ├── <span class="hljs-keyword">base</span>/           <span class="hljs-meta"># 基础组件（高频使用，打包到vendor）</span>
│   ├── business/       <span class="hljs-meta"># 业务组件（按模块异步加载）</span>
│   └── lazy/          <span class="hljs-meta"># 懒加载组件（低频使用）</span>
├── composables/
│   ├── usePerformance.ts  <span class="hljs-meta"># 性能监控</span>
│   ├── useCache.ts        <span class="hljs-meta"># 缓存管理</span>
│   └── usePreload.ts      <span class="hljs-meta"># 预加载管理</span>
├── utils/
│   ├── performance.ts     <span class="hljs-meta"># 性能工具函数</span>
│   └── memory.ts         <span class="hljs-meta"># 内存管理工具</span>
└── views/
    ├── critical/      <span class="hljs-meta"># 关键页面（预加载）</span>
    └── secondary/     <span class="hljs-meta"># 次要页面（懒加载）</span>
</code></pre>
<h3 data-id="heading-16">可维护性建议</h3>
<ol>
<li><strong>性能监控体系</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// composables/usePerformance.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">usePerformance</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> metrics = <span class="hljs-title function_">ref</span>({
    <span class="hljs-attr">renderTime</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">memoryUsage</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">componentCount</span>: <span class="hljs-number">0</span>
  })
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">measureRenderTime</span> = (<span class="hljs-params">componentName: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>()
    
    <span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>()
      metrics.<span class="hljs-property">value</span>.<span class="hljs-property">renderTime</span> = end - start
      
      <span class="hljs-comment">// 上报性能数据</span>
      <span class="hljs-title function_">reportPerformance</span>({
        <span class="hljs-attr">component</span>: componentName,
        <span class="hljs-attr">renderTime</span>: end - start,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
      })
    })
  }
  
  <span class="hljs-keyword">return</span> { metrics, measureRenderTime }
}
</code></pre>
<ol start="2">
<li><strong>内存泄漏检测</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/memory.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryMonitor</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">intervals</span>: <span class="hljs-built_in">number</span>[] = []
  
  <span class="hljs-title function_">startMonitoring</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (performance.<span class="hljs-property">memory</span>) {
        <span class="hljs-keyword">const</span> { usedJSHeapSize, totalJSHeapSize } = performance.<span class="hljs-property">memory</span>
        <span class="hljs-keyword">const</span> usage = (usedJSHeapSize / totalJSHeapSize) * <span class="hljs-number">100</span>
        
        <span class="hljs-keyword">if</span> (usage &gt; <span class="hljs-number">80</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'High memory usage detected:'</span>, usage + <span class="hljs-string">'%'</span>)
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">triggerGarbageCollection</span>()
        }
      }
    }, <span class="hljs-number">5000</span>)
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">intervals</span>.<span class="hljs-title function_">push</span>(interval)
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">triggerGarbageCollection</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 清理缓存</span>
    <span class="hljs-comment">// 释放不必要的引用</span>
    <span class="hljs-comment">// 触发组件重新渲染</span>
  }
  
  <span class="hljs-title function_">cleanup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">intervals</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-built_in">clearInterval</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">intervals</span> = []
  }
}
</code></pre>
<h3 data-id="heading-17">常见错误与规避</h3>
<ol>
<li><strong>过度使用响应式</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 错误：对大对象使用深度响应式</span>
<span class="hljs-keyword">const</span> largeData = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">items</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>({})
})

<span class="hljs-comment">// ✅ 正确：使用shallowRef</span>
<span class="hljs-keyword">const</span> largeData = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-attr">items</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>({})
})
</code></pre>
<ol start="2">
<li><strong>v-memo使用不当</strong></li>
</ol>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ❌ 错误：memo依赖项过多 --&gt;
&lt;div v-memo="[a, b, c, d, e, f, g]"&gt;

&lt;!-- ✅ 正确：合并依赖项 --&gt;
&lt;div v-memo="[computedMemoKey]"&gt;
</code></pre>
<ol start="3">
<li><strong>KeepAlive缓存过多</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 错误：无限制缓存</span>
&lt;<span class="hljs-title class_">KeepAlive</span>&gt;

<span class="hljs-comment">// ✅ 正确：限制缓存数量</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span> <span class="hljs-attr">:max</span>=<span class="hljs-string">"10"</span>&gt;</span>
</span></code></pre>
<h2 data-id="heading-18">6. 总结（Checklist）</h2>
<p>通过本文的10个优化技巧，你可以立即提升Vue应用性能：</p>
<h3 data-id="heading-19">响应式优化</h3>
<ul>
<li>✅ 使用 <code>effectScope</code> 批量管理副作用，避免内存泄漏</li>
<li>✅ 对大对象使用 <code>shallowRef</code> 减少响应式开销</li>
<li>✅ 用 <code>readonly</code> 包装只读数据，提升渲染性能</li>
</ul>
<h3 data-id="heading-20">渲染优化</h3>
<ul>
<li>✅ 在大列表中使用 <code>v-memo</code> 智能缓存渲染结果</li>
<li>✅ 合理配置 <code>KeepAlive</code> 缓存策略和数量限制</li>
<li>✅ 拆分复杂组件，避免不必要的重渲染</li>
<li>✅ 使用异步组件实现按需加载</li>
</ul>
<h3 data-id="heading-21">构建优化</h3>
<ul>
<li>✅ 开启 Tree-shaking 减少打包体积</li>
<li>✅ 实现路由级别的代码分割</li>
<li>✅ 配置智能预加载策略</li>
</ul>
<h3 data-id="heading-22">立即实践建议</h3>
<ul>
<li>✅ 先从最耗时的组件开始优化（使用Vue DevTools分析）</li>
<li>✅ 建立性能监控体系，持续跟踪优化效果</li>
<li>✅ 在开发环境中集成性能检测工具</li>
</ul>
<p>Vue 3.5的性能优化之路还在继续，这10个技巧只是开始。在实际项目中，你可能还会遇到更多复杂的性能挑战。</p>
<p><strong>如果这篇文章对你有帮助，欢迎点赞收藏！</strong> 你的支持是我持续分享技术干货的动力。</p>
<p><strong>评论区交流你的实践经验：</strong></p>
<ul>
<li>你在Vue性能优化中遇到过哪些坑？</li>
<li>这些技巧在你的项目中效果如何？</li>
<li>还有哪些性能优化技巧想要了解？</li>
</ul>
<p>我会在评论区和大家深入讨论，也欢迎分享你的优化案例和数据对比！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微前端图标治理方案]]></title>    <link>https://juejin.cn/post/7604791354258784294</link>    <guid>https://juejin.cn/post/7604791354258784294</guid>    <pubDate>2026-02-10T09:06:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604791354258784294" data-draft-id="7604805226697261094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微前端图标治理方案"/> <meta itemprop="keywords" content="前端,架构"/> <meta itemprop="datePublished" content="2026-02-10T09:06:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大象的鼻子那么长"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微前端图标治理方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大象的鼻子那么长
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 融会贯通" title="VIP.4 融会贯通" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:06:54.000Z" title="Tue Feb 10 2026 09:06:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">一、背景与问题</h2>
<p>在微前端架构下，主应用长期积累了 <strong>5 套图标方案并存</strong> 的混乱局面：</p>















































<table><thead><tr><th>#</th><th>方案</th><th>位置</th><th>使用方式</th><th>核心问题</th></tr></thead><tbody><tr><td>1</td><td><strong>iconfont JS</strong></td><td><code>assets/icon.min.js</code>（115KB）</td><td><code>&lt;SvgIcon name="xxx"&gt;</code> → <code>#icon-xxx</code></td><td>全量加载无 Tree-shaking，iconfont 平台维护成本高</td></tr><tr><td>2</td><td><strong>本地 SVG</strong></td><td><code>assets/svgs/</code>（30 个文件）</td><td><code>vite-plugin-svg-icons</code> → SVG Sprite</td><td>仅主应用可用，子应用无法共享</td></tr><tr><td>3</td><td><strong>@purge-icons + Iconify</strong></td><td><code>Icon.vue</code></td><td><code>&lt;Icon icon="ep:edit"&gt;</code></td><td>运行时渲染，依赖 <code>@purge-icons/generated</code></td></tr><tr><td>4</td><td><strong>IconJson 硬编码</strong></td><td><code>Icon/src/data.ts</code>（1962 行）</td><td><code>IconSelect</code> 组件消费</td><td>手动维护 EP / FA 图标名列表，极易过时</td></tr><tr><td>5</td><td><strong>CmcIcon</strong></td><td><code>@cmclink/ui</code></td><td><code>&lt;CmcIcon name="xxx"&gt;</code></td><td>已有基础但只支持 SVG Sprite，未与其他方案打通</td></tr></tbody></table>
<p><strong>核心痛点</strong>：</p>
<ul>
<li>子应用无法共享主应用图标，每个应用各自维护</li>
<li>同一个图标可能通过 3 种不同方式引用</li>
<li>iconfont JS 全量加载 115KB，无法按需</li>
<li>1962 行硬编码图标列表，维护成本极高</li>
<li>中后台系统 90% 以上使用通用图标，不需要每个应用单独管理</li>
</ul>
<h2 data-id="heading-1">二、治理目标</h2>
<pre><code class="hljs">统一入口 + 集中管理 + 零配置共享
</code></pre>
<ul>
<li><strong>一个组件</strong>：<code>&lt;CmcIcon&gt;</code> 统一消费所有图标</li>
<li><strong>一个图标包</strong>：<code>@cmclink/icons</code> 集中管理 SVG 资源</li>
<li><strong>零配置</strong>：子应用迁入 Monorepo 后自动获得所有共享图标</li>
<li><strong>按需加载</strong>：Element Plus 图标异步 import，不影响首屏</li>
</ul>
<h2 data-id="heading-2">三、方案架构</h2>
<pre><code class="hljs language-bash" lang="bash">┌──────────────────────────────────────────────────────┐
│                    使用层（所有子应用）                  │
│                                                      │
│  &lt;CmcIcon name=<span class="hljs-string">"Home"</span> /&gt;           — SVG Sprite 图标  │
│  &lt;CmcIcon name=<span class="hljs-string">"ep:Edit"</span> /&gt;        — Element Plus 图标 │
│  &lt;CmcIcon name=<span class="hljs-string">"Star"</span> size=<span class="hljs-string">"lg"</span> color=<span class="hljs-string">"primary"</span> /&gt;   │
├──────────────────────────────────────────────────────┤
│               @cmclink/ui — CmcIcon 组件              │
│                                                      │
│  ┌─────────────┐    ┌──────────────────┐             │
│  │ SVG Sprite  │    │ Element Plus     │             │
│  │ &lt;svg&gt;&lt;use&gt;  │    │ 动态 import      │             │
│  │ 无前缀      │    │ ep: 前缀         │             │
│  └─────────────┘    └──────────────────┘             │
├──────────────────────────────────────────────────────┤
│            @cmclink/icons — 共享图标资源包              │
│                                                      │
│  packages/icons/src/svg/                             │
│  ├── Home.svg                                        │
│  ├── Star.svg                                        │
│  ├── Logo.svg                                        │
│  └── ... (30+ 通用图标)                               │
├──────────────────────────────────────────────────────┤
│           @cmclink/vite-config — 构建自动集成           │
│                                                      │
│  vite-plugin-svg-icons 自动扫描：                      │
│  1. packages/icons/src/svg/  （共享图标，优先）          │
│  2. apps/{app}/src/assets/svgs/ （本地图标，可覆盖）     │
└──────────────────────────────────────────────────────┘
</code></pre>
<h2 data-id="heading-3">四、CmcIcon 组件设计</h2>
<h3 data-id="heading-4">4.1 Props 接口</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CmcIconProps</span> {
  <span class="hljs-comment">/**
   * 图标名称
   * - 无前缀: SVG Sprite 图标（如 "Home"、"Star"）
   * - "ep:" 前缀: Element Plus 图标（如 "ep:Edit"、"ep:Delete"）
   */</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/** 尺寸：数字(px) | 预设('xs'|'sm'|'md'|'lg'|'xl') | CSS 字符串 */</span>
  size?: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-string">'xs'</span> | <span class="hljs-string">'sm'</span> | <span class="hljs-string">'md'</span> | <span class="hljs-string">'lg'</span> | <span class="hljs-string">'xl'</span>
  <span class="hljs-comment">/** 颜色：CSS 值 | 主题色('primary'|'success'|'warning'|'danger'|'info') */</span>
  color?: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/** 旋转角度 */</span>
  rotate?: <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 旋转动画 */</span>
  spin?: <span class="hljs-built_in">boolean</span>
  <span class="hljs-comment">/** 禁用状态 */</span>
  disabled?: <span class="hljs-built_in">boolean</span>
  <span class="hljs-comment">/** 可点击 */</span>
  clickable?: <span class="hljs-built_in">boolean</span>
}
</code></pre>
<h3 data-id="heading-5">4.2 预设尺寸</h3>



































<table><thead><tr><th>尺寸</th><th>像素</th><th>场景</th></tr></thead><tbody><tr><td><code>xs</code></td><td>12px</td><td>辅助文字旁小图标</td></tr><tr><td><code>sm</code></td><td>14px</td><td>表单项内图标</td></tr><tr><td><code>md</code></td><td>16px</td><td><strong>默认</strong>，正文行内图标</td></tr><tr><td><code>lg</code></td><td>20px</td><td>按钮内图标</td></tr><tr><td><code>xl</code></td><td>24px</td><td>标题旁图标</td></tr></tbody></table>
<h3 data-id="heading-6">4.3 主题色</h3>
<p>使用 CSS 变量自动跟随 Element Plus 主题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> colorMap = {
  <span class="hljs-attr">primary</span>: <span class="hljs-string">'var(--el-color-primary, #004889)'</span>,
  <span class="hljs-attr">success</span>: <span class="hljs-string">'var(--el-color-success, #10b981)'</span>,
  <span class="hljs-attr">warning</span>: <span class="hljs-string">'var(--el-color-warning, #f59e0b)'</span>,
  <span class="hljs-attr">danger</span>:  <span class="hljs-string">'var(--el-color-danger, #ef4444)'</span>,
  <span class="hljs-attr">info</span>:    <span class="hljs-string">'var(--el-color-info, #3b82f6)'</span>,
}
</code></pre>
<h3 data-id="heading-7">4.4 Element Plus 图标异步加载</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ep: 前缀触发异步加载，不影响首屏 bundle</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">name</span>,
  <span class="hljs-keyword">async</span> (name) =&gt; {
    <span class="hljs-keyword">if</span> (!name.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'ep:'</span>)) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">const</span> iconName = name.<span class="hljs-title function_">slice</span>(<span class="hljs-number">3</span>) <span class="hljs-comment">// "ep:Edit" → "Edit"</span>
    <span class="hljs-keyword">const</span> icons = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@element-plus/icons-vue'</span>)
    elIconComponent.<span class="hljs-property">value</span> = icons[iconName] ?? <span class="hljs-literal">null</span>
  },
  { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }
)
</code></pre>
<h2 data-id="heading-8">五、Vite 构建集成</h2>
<h3 data-id="heading-9">5.1 主应用配置（main-app.ts）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">createSvgIconsPlugin</span>({
  <span class="hljs-attr">iconDirs</span>: [
    <span class="hljs-comment">// 共享图标库（@cmclink/icons）— 所有子应用共享</span>
    <span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">'../../packages/icons/src/svg'</span>),
    <span class="hljs-comment">// 应用本地图标（可覆盖共享图标，或放置业务特有图标）</span>
    <span class="hljs-title function_">resolve</span>(root, <span class="hljs-string">'src/assets/svgs'</span>),
  ],
  <span class="hljs-attr">symbolId</span>: <span class="hljs-string">'icon-[dir]-[name]'</span>,
  <span class="hljs-attr">svgoOptions</span>: <span class="hljs-literal">true</span>,
})
</code></pre>
<h3 data-id="heading-10">5.2 子应用配置（child-app.ts）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// svgIcons 选项默认 true，子应用零配置即可共享图标</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ChildAppOptions</span> {
  svgIcons?: <span class="hljs-built_in">boolean</span>  <span class="hljs-comment">// 默认 true</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>关键设计</strong>：<code>iconDirs</code> 数组中共享图标在前、本地图标在后，本地同名 SVG 可覆盖共享图标，实现灵活的图标定制能力。</p>
<h2 data-id="heading-11">六、迁移实施</h2>
<h3 data-id="heading-12">6.1 迁移映射表</h3>



































<table><thead><tr><th>旧用法</th><th>新用法</th><th>说明</th></tr></thead><tbody><tr><td><code>&lt;SvgIcon name="Home" :size="20" /&gt;</code></td><td><code>&lt;CmcIcon name="Home" :size="20" /&gt;</code></td><td>仅改标签名</td></tr><tr><td><code>&lt;Icon icon="ep:edit" /&gt;</code></td><td><code>&lt;CmcIcon name="ep:Edit" /&gt;</code></td><td><code>icon</code> → <code>name</code>，PascalCase</td></tr><tr><td><code>&lt;Icon icon="ep:user-filled" /&gt;</code></td><td><code>&lt;CmcIcon name="ep:UserFilled" /&gt;</code></td><td>kebab → PascalCase</td></tr><tr><td><code>&lt;Icon icon="fontisto:email" /&gt;</code></td><td><code>&lt;CmcIcon name="ep:Message" /&gt;</code></td><td>替换为 EP 等效图标</td></tr><tr><td><code>&lt;svg&gt;&lt;use href="#icon-xxx" /&gt;&lt;/svg&gt;</code></td><td><code>&lt;CmcIcon name="xxx" /&gt;</code></td><td>直接使用组件</td></tr></tbody></table>
<h3 data-id="heading-13">6.2 实施清单</h3>
<h4 data-id="heading-14">已完成 ✅</h4>






































































<table><thead><tr><th>步骤</th><th>变更</th><th>影响文件数</th></tr></thead><tbody><tr><td>创建 <code>@cmclink/icons</code> 共享图标包</td><td><code>packages/icons/</code></td><td>新建</td></tr><tr><td>迁移 SVG 到共享包</td><td><code>assets/svgs/</code> → <code>packages/icons/src/svg/</code></td><td>30 个 SVG</td></tr><tr><td>重写 <code>CmcIcon</code> 组件</td><td>支持 SVG Sprite + <code>ep:</code> 前缀</td><td>1 个文件</td></tr><tr><td><code>main-app.ts</code> 配置共享图标扫描</td><td><code>iconDirs</code> 新增共享目录</td><td>1 个文件</td></tr><tr><td><code>child-app.ts</code> 同步配置</td><td>新增 <code>svgIcons</code> 选项</td><td>1 个文件</td></tr><tr><td>替换 <code>&lt;SvgIcon&gt;</code> → <code>&lt;CmcIcon&gt;</code></td><td>删除 import + 替换标签</td><td><strong>10 个文件</strong></td></tr><tr><td>替换 <code>&lt;Icon&gt;</code> → <code>&lt;CmcIcon&gt;</code></td><td><code>icon</code> → <code>name</code>，PascalCase</td><td><strong>9 个文件</strong></td></tr><tr><td>删除 <code>icon.min.js</code></td><td>移除 iconfont 全量加载</td><td><strong>-115KB</strong></td></tr><tr><td>删除 <code>Icon/</code> 目录</td><td><code>Icon.vue</code> + <code>IconSelect.vue</code> + <code>data.ts</code></td><td><strong>-1962 行</strong></td></tr><tr><td>删除 <code>SvgIcon.vue</code></td><td>旧 SVG 图标组件</td><td>1 个文件</td></tr><tr><td>清理 <code>setupGlobCom</code></td><td>移除旧 <code>Icon</code> 全局注册</td><td>1 个文件</td></tr><tr><td>清理 <code>Form.vue</code></td><td><code>&lt;Icon&gt;</code> → <code>&lt;CmcIcon&gt;</code> (JSX)</td><td>1 个文件</td></tr></tbody></table>
<h3 data-id="heading-15">6.3 收益量化</h3>









































<table><thead><tr><th>指标</th><th>治理前</th><th>治理后</th><th>收益</th></tr></thead><tbody><tr><td>图标方案数量</td><td>5 套</td><td><strong>1 套</strong></td><td>维护成本降低 80%</td></tr><tr><td>首屏资源</td><td>+115KB (iconfont JS)</td><td><strong>0KB</strong> (按需加载)</td><td>-115KB</td></tr><tr><td>硬编码图标列表</td><td>1962 行</td><td><strong>0 行</strong></td><td>消除过时风险</td></tr><tr><td>子应用图标配置</td><td>每个应用单独维护</td><td><strong>零配置</strong></td><td>开发效率提升</td></tr><tr><td>图标使用入口</td><td>3 个组件</td><td><strong>1 个组件</strong></td><td>心智负担降低</td></tr></tbody></table>
<h2 data-id="heading-16">七、使用指南</h2>
<h3 data-id="heading-17">7.1 SVG Sprite 图标（推荐）</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 基础用法 --&gt;
&lt;CmcIcon name="Home" /&gt;

&lt;!-- 预设尺寸 --&gt;
&lt;CmcIcon name="Star" size="lg" /&gt;

&lt;!-- 自定义像素 --&gt;
&lt;CmcIcon name="Document" :size="32" /&gt;

&lt;!-- 主题色 --&gt;
&lt;CmcIcon name="Warning" color="danger" /&gt;

&lt;!-- 旋转动画 --&gt;
&lt;CmcIcon name="Loading" spin /&gt;

&lt;!-- 可点击 --&gt;
&lt;CmcIcon name="Close" clickable @click="handleClose" /&gt;
</code></pre>
<h3 data-id="heading-18">7.2 Element Plus 图标</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ep: 前缀，异步加载 --&gt;
&lt;CmcIcon name="ep:Edit" /&gt;
&lt;CmcIcon name="ep:Delete" color="danger" /&gt;
&lt;CmcIcon name="ep:Search" :size="18" /&gt;
&lt;CmcIcon name="ep:Loading" spin /&gt;
</code></pre>
<h3 data-id="heading-19">7.3 添加新图标</h3>
<ol>
<li>将 SVG 文件放入 <code>packages/icons/src/svg/</code></li>
<li>文件名即图标名（如 <code>MyIcon.svg</code> → <code>&lt;CmcIcon name="MyIcon" /&gt;</code>）</li>
<li><strong>无需任何额外配置</strong>，Vite HMR 自动生效</li>
<li>所有子应用自动可用</li>
</ol>
<h3 data-id="heading-20">7.4 应用级图标覆盖</h3>
<p>如果某个子应用需要定制某个图标的样式：</p>
<ol>
<li>在 <code>apps/{app}/src/assets/svgs/</code> 放入同名 SVG</li>
<li>本地版本自动覆盖共享版本</li>
<li>其他子应用不受影响</li>
</ol>
<h2 data-id="heading-21">八、目录结构</h2>
<pre><code class="hljs language-bash" lang="bash">packages/
├── icons/                          <span class="hljs-comment"># 共享图标包</span>
│   ├── package.json                <span class="hljs-comment"># @cmclink/icons</span>
│   ├── README.md                   <span class="hljs-comment"># 使用文档</span>
│   └── src/
│       ├── index.ts                <span class="hljs-comment"># 导出图标目录路径常量</span>
│       └── svg/                    <span class="hljs-comment"># 所有共享 SVG 图标</span>
│           ├── Home.svg
│           ├── Star.svg
│           ├── UnStar.svg
│           ├── Logo.svg
│           ├── TopMenu.svg
│           └── ...
├── ui/
│   └── src/base/CmcIcon/
│       ├── index.ts
│       └── src/CmcIcon.vue         <span class="hljs-comment"># 统一图标组件</span>
└── vite-config/
    └── src/
        ├── main-app.ts             <span class="hljs-comment"># iconDirs: [共享, 本地]</span>
        └── child-app.ts            <span class="hljs-comment"># svgIcons 选项</span>
</code></pre>
<h2 data-id="heading-22">九、FAQ</h2>
<h3 data-id="heading-23">Q: IconSelect 组件删除后，图标选择功能怎么办？</h3>
<p>A: <code>IconSelect</code> 依赖已删除的 <code>data.ts</code>（1962 行硬编码列表）。如果业务确实需要图标选择器，建议基于 <code>@element-plus/icons-vue</code> 的导出列表动态生成，而非硬编码。后续可在 <code>@cmclink/ui</code> 中实现新版 <code>CmcIconPicker</code>。</p>
<h3 data-id="heading-24">Q: 子应用还在外部独立仓库，如何使用共享图标？</h3>
<p>A: 当前 <code>child-app.ts</code> 的 <code>iconDirs</code> 使用相对路径 <code>../../packages/icons/src/svg</code>，仅适用于 Monorepo 内的子应用。外部子应用迁入 Monorepo 后自动生效。迁入前可通过 <code>extraPlugins</code> 自行配置 <code>vite-plugin-svg-icons</code>。</p>
<h3 data-id="heading-25">Q: 第三方图标库（如 Font Awesome）怎么处理？</h3>
<p>A: 当前 <code>CmcIcon</code> 支持 SVG Sprite 和 Element Plus 两种源。如需扩展第三方图标库，可在 <code>CmcIcon</code> 中增加新的前缀识别（如 <code>fa:</code> → Font Awesome），通过异步 import 按需加载。但中后台系统建议优先使用 Element Plus 图标，保持设计一致性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mobileprovision 描述文件内容查看，查看 Bundle ID、证书指纹等来定位安装与签名问题]]></title>    <link>https://juejin.cn/post/7605051978871308307</link>    <guid>https://juejin.cn/post/7605051978871308307</guid>    <pubDate>2026-02-10T09:16:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871308307" data-draft-id="7604853010171183145" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mobileprovision 描述文件内容查看，查看 Bundle ID、证书指纹等来定位安装与签名问题"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T09:16:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mobileprovision 描述文件内容查看，查看 Bundle ID、证书指纹等来定位安装与签名问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:16:56.000Z" title="Tue Feb 10 2026 09:16:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 iOS 开发和测试阶段，安装失败、签名不匹配、设备不被允许等问题并不少见。
很多时候，问题不是代码本身，而是在 <strong>mobileprovision 描述文件</strong>里。</p>
<p>描述文件它本身包含了大量可验证的信息。如果能把这些内容直接展开来看，很多问题其实不用反复试。</p>
<hr/>
<h2 data-id="heading-0">mobileprovision 文件里到底有什么</h2>
<p>一个 mobileprovision 文件，本质上是一个经过签名的配置集合，其中至少包含以下信息：</p>
<ul>
<li>绑定的 <strong>Bundle ID</strong></li>
<li>使用的 <strong>证书信息</strong></li>
<li>允许安装的 <strong>设备 UDID 列表</strong></li>
<li>描述文件的 <strong>类型</strong>（开发 / App Store）</li>
<li>有效期起止时间</li>
<li>是否包含特定能力（如推送）</li>
</ul>
<p>这些信息共同决定了一个 IPA 是否“被允许安装”。</p>
<hr/>
<h2 data-id="heading-1">为什么需要“直接查看内容”</h2>
<p>在实际场景中，开发者常会遇到这些问题：</p>
<ul>
<li>描述文件是别人生成的，不清楚里面绑了什么</li>
<li>描述文件放久了，不确定是否过期</li>
<li>同一个 Bundle ID 下有多份描述文件，容易混用</li>
<li>安装时报错，但 Xcode 或打包工具给的信息不完整</li>
</ul>
<p>这时，直接查看 mobileprovision 内容，比反复猜测要高效得多。</p>
<hr/>
<h2 data-id="heading-2">常见的查看方式，各自解决什么问题</h2>
<h3 data-id="heading-3">1. macOS + Xcode / 命令行</h3>
<p>在 macOS 上，可以通过命令行解码描述文件：</p>
<pre><code class="hljs language-css" lang="css">security cms -D -<span class="hljs-selector-tag">i</span> xxx<span class="hljs-selector-class">.mobileprovision</span>
</code></pre>
<p>这种方式的优点是：</p>
<ul>
<li>输出内容完整</li>
<li>不依赖第三方工具</li>
</ul>
<p>限制也很明显：</p>
<ul>
<li>只能在 macOS 上使用</li>
<li>输出为 XML，阅读成本较高</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. 在线解析工具</h3>
<p>部分网站支持上传 mobileprovision 并解析内容。</p>
<p>适合的场景是：</p>
<ul>
<li>临时查看</li>
<li>文件不涉及敏感账号</li>
</ul>
<p>如果描述文件属于正式项目或公司账号，这种方式并不适合长期使用。</p>
<hr/>
<h3 data-id="heading-5">3. 使用 AppUploader 查看描述文件内容</h3>
<p>在 <strong>AppUploader（开心上架）</strong> 中，描述文件查看是一个独立功能，而不是附带能力。</p>
<p>操作流程如下：</p>
<ol>
<li>打开 AppUploader</li>
<li>进入 <strong>描述文件管理 / 文件查看</strong> 功能</li>
<li>选择已有的 <code>.mobileprovision</code> 文件</li>
<li>直接查看解析后的内容信息</li>
</ol>
<p>界面中会清晰展示：</p>
<ul>
<li>Bundle ID</li>
<li>描述文件类型</li>
<li>包含的证书指纹</li>
<li>设备 UDID 列表</li>
<li>有效期时间</li>
</ul>
<p>整个过程不依赖 macOS，也不需要手动解码。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80ac6a678605496d9cef405a7a402f96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319818&amp;x-signature=dimFek70iinTN%2FqrtTU76e5eZY8%3D" alt="查看" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">用“看内容”的方式定位实际问题</h2>
<p>下面是几个常见问题，以及通过查看描述文件可以直接确认的点。</p>
<h3 data-id="heading-7">安装提示“设备不被允许”</h3>
<p>查看描述文件中的 <strong>设备列表</strong>：</p>
<ul>
<li>如果设备 UDID 不在列表中</li>
<li>说明描述文件未更新</li>
</ul>
<p>解决方式不是重打包，而是重新生成描述文件并加入该设备。</p>
<hr/>
<h3 data-id="heading-8">安装包签名看起来没问题，但无法运行</h3>
<p>查看描述文件中绑定的 <strong>证书指纹</strong>：</p>
<ul>
<li>与当前使用的 p12 是否一致</li>
<li>是否误用了旧证书</li>
</ul>
<p>如果证书不一致，IPA 即使能生成，也无法正常安装。</p>
<hr/>
<h3 data-id="heading-9">同一个项目在不同电脑表现不一致</h3>
<p>查看描述文件的 <strong>有效期</strong>：</p>
<ul>
<li>是否已经过期</li>
<li>是否使用了临时生成的开发证书</li>
</ul>
<p>描述文件过期后，安装行为会直接失败，不会给出明显提示。</p>
<hr/>
<h2 data-id="heading-10">把查看描述文件放进流程里</h2>
<p>在比较稳定的团队流程中，查看 mobileprovision 往往出现在这些节点：</p>
<ul>
<li>新人接手项目时</li>
<li>设备新增后安装失败</li>
<li>CI 打包结果异常</li>
<li>上架前做签名自检</li>
</ul>
<p>它不是一个频繁操作的步骤，但一旦需要，就应该是<strong>低成本可执行的</strong>。</p>
<hr/>
<p>在实际项目中可以：</p>
<ul>
<li>Xcode / HBuilderX：打包</li>
<li>CI：自动构建</li>
<li>AppUploader：证书、描述文件管理与内容查看</li>
<li>命令行工具：必要时做补充验证</li>
</ul>
<p>每个工具只负责自己擅长的部分，问题定位才会更直接。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【踩坑实录】生产上遇到的并发问题总结]]></title>    <link>https://juejin.cn/post/7605051978871324691</link>    <guid>https://juejin.cn/post/7605051978871324691</guid>    <pubDate>2026-02-10T09:17:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605051978871324691" data-draft-id="7604984549172903945" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【踩坑实录】生产上遇到的并发问题总结"/> <meta itemprop="keywords" content="后端,Java,性能优化"/> <meta itemprop="datePublished" content="2026-02-10T09:17:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桦说编程"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【踩坑实录】生产上遇到的并发问题总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桦说编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:17:52.000Z" title="Tue Feb 10 2026 09:17:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>生产上遇到很多并发问题，有很多是在编码阶段就可以避免的，总结一些需要考虑的要点如下：</p>
<ol>
<li>使用并发的常见场景为针对大数据量遍历处理，考虑性能，采用并发处理。这是CPU密集型任务场景，同时出现多个任务时，性能不见得最优。</li>
<li>并发也有开销，不建议无脑并发。并发后堆栈会丢失，不方便排查问题。</li>
<li>异步开发模式具有传染性，比如使用可回调 Future 后，如果想要避免阻塞问题，需要使用map、flatMap语义。折中的方法是参考结构化并发，在必要位置等待，获取结果后清理资源。</li>
<li>需要注意副作用，尽量不要使用副作用。尽量不要修改共享的内容，比如本地缓存。</li>
<li>使用线程安全类 + 原子方法， ConcurrentHashMap 和 HashMap 相比，性能差别不大，而且内存占用基本一致，很多情况下可以直接替换。灵活使用 merge、computeIfAbsent 等方法，比如需要择优的场景，不需要重复写写命令式的逻辑。</li>
<li>考虑单次加载实现</li>
<li>ConcurentHashMap 高并发时，可能有阻塞等待同一个桶位的问题，必须指定初始大小。</li>
<li>考虑线程池阻塞队列消费速度，防止某些捣蛋线程。</li>
<li>考虑处理拒绝任务异常，设计 fallback 策略。</li>
<li>并发超时或者任务取消时很容易出现线程泄露。</li>
<li>监控并发收益。</li>
<li>监控阻塞线程，防止惊群效应。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝“Demo 级”架构：基于 SAE × SLS 构建 Dify 高可用生产底座]]></title>    <link>https://juejin.cn/post/7604769326224998436</link>    <guid>https://juejin.cn/post/7604769326224998436</guid>    <pubDate>2026-02-10T09:17:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604769326224998436" data-draft-id="7604801893530337323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝“Demo 级”架构：基于 SAE × SLS 构建 Dify 高可用生产底座"/> <meta itemprop="keywords" content="Serverless"/> <meta itemprop="datePublished" content="2026-02-10T09:17:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝“Demo 级”架构：基于 SAE × SLS 构建 Dify 高可用生产底座
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:17:19.000Z" title="Tue Feb 10 2026 09:17:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：黄震、范阿冬</p>
<h2 data-id="heading-0">导读</h2>
<p>在上一篇《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwODY2NTk0OQ%3D%3D%26mid%3D2247485651%26idx%3D1%26sn%3Da1fbdd0786d6fea03f25119f50a6e46a%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwODY2NTk0OQ==&amp;mid=2247485651&amp;idx=1&amp;sn=a1fbdd0786d6fea03f25119f50a6e46a&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">告别数据库“膨胀”：Dify x SLS 构建高可用生产级 AI 架构</a>》中，我们深度剖析了 Dify 在大规模生产场景下数据库因日志写入而面临的性能瓶颈，并介绍了通过 SLS 插件实现“存算分离”的硬核改造方案。</p>
<p>然而，解决“数据存储”只是跨过了生产落地的第一道坎。面对复杂的微服务运维、波动的 AI 潮汐流量，如何构建一个弹性、免运维的“计算底座”同样关键。本文作为系列的第二篇，将视野从单一的数据架构扩展至全栈基础设施，为您介绍基于阿里云 SAE × SLS 的终极生产级解决方案。</p>
<p>随着 LLM 应用的爆发式增长，Dify 以其强大的工作流编排与友好的可视化界面，正成为企业构建 AI 应用的首选。然而，当应用从本地 Demo 迈向大规模生产时，开发者常会遭遇两大“隐形”挑战：运维复杂度的剧增与数据架构的性能瓶颈。</p>
<p>本文将深度解析这一架构瓶颈，并介绍基于阿里云 <strong>SAE（Serverless 应用引擎）</strong> 与 <strong>SLS（日志服务）</strong> 的联合解决方案。通过“全托管算力”与“存算分离”的双轮驱动，打造一个高弹性、低成本、且具备深度数据洞察力的生产级 Dify 环境。</p>
<h2 data-id="heading-1">现状与挑战：Dify 规模化落地的架构瓶颈</h2>
<p>在单机 Demo 阶段，使用 Docker Compose 部署配合默认的 PostgreSQL 存储方案完全够用。但一旦进入生产环境，这两项基础设施往往最先成为性能与扩展性的瓶颈。</p>
<h3 data-id="heading-2">运维管理复杂</h3>
<p>Dify 是一个由 API 服务、Worker、Web 前端、KV 缓存、关系型数据库、向量数据库等多个组件构成的微服务架构。在生产环境中，这种架构给运维带来了很大挑战：</p>
<ul>
<li><strong>资源缺乏弹性：</strong> AI 应用通常具有明显的流量波峰波谷特征。若采用自建 Kubernetes 或 ECS 集群，扩容响应滞后，高峰期用户排队等待，低谷期又造成大量资源闲置，推高成本。</li>
<li><strong>维护成本高昂：</strong> 保障高可用、配置负载均衡、处理节点故障、执行蓝绿/灰度发布等基础设施工作，不仅技术门槛高，还会大量挤占开发团队本应用于业务创新的精力。</li>
<li><strong>性能瓶颈明显：</strong> 默认部署方式下的 QPS 能力有限，难以支撑高并发场景，尤其在推理密集型任务下容易成为系统瓶颈。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c32c7c22d5ea4be9ad1c4b3de9b1689f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=CWwMC5TPs6oim3YTwc0A0sLA79g%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-3">数据库容量爆炸</h2>
<p>Dify 默认将所有数据（包括业务元数据和运行日志）存储在 PostgreSQL 中。随着业务量增长，“数据特征”与“存储引擎”的错配问题日益凸显：</p>
<ul>
<li><strong>日志“撑爆”数据库：</strong> Workflow 的每一次节点执行，都会完整记录输入输出、Prompt、推理过程及 Token 统计等详细信息。在生产级高并发场景下，这些数据占据了数据库绝大部分资源，导致表空间迅速膨胀。</li>
<li><strong>拖慢核心业务：</strong> 高频、高吞吐的日志写入会大量占用数据库连接池和 I/O 资源，严重干扰核心业务操作（如创建应用、知识库检索、对话上下文管理等），导致响应延迟、超时甚至服务不可用。</li>
</ul>
<h2 data-id="heading-4">协同赋能：SAE 与 SLS 的核心优势</h2>
<p>为解决上述瓶颈，SAE 与 SLS 协同发力——SAE 聚焦弹性算力调度，SLS 专攻海量日志存储，共同构建高性能、高可用的 Dify 运行底座。</p>
<h3 data-id="heading-5">SAE：极致弹性的 Dify 全托管运行环境</h3>
<p>SAE 不仅负责 Dify 核心微服务（API、Worker、Sandbox）的编排，更通过一键化模板集成了 Dify 运行所需的完整云生态。</p>
<ul>
<li><strong>一键全栈交付：</strong> 开发者无需手动搭建复杂环境。通过预置模板，可一键部署完整的微服务集群，并自动创建和集成连通日志服务 SLS（工作流日志存储）、表格存储 Tablestore（向量存储）、云数据库 Redis 版（缓存）及 RDS for PostgreSQL（元数据存储）等阿里云服务，无需逐个购买和配置，实现“开箱即是生产级”的交付体验。</li>
<li><strong>企业级高可用保障：</strong> 实例自动分布于多可用区，配合健康检查与自愈机制规避单点故障。支持金丝雀发布，确保在工作流频繁迭代时，流量切换平滑无感。</li>
<li><strong>秒级算力弹性：</strong> 完美适配 AI 业务的“潮汐特征”。SAE 支持按 CPU/内存利用率或 QPS 指标进行自动扩缩容。在推理高峰期，秒级拉起 Worker 实例抗压；在业务低谷期，自动释放闲置资源，将算力成本严格控制在“有效使用”范围内。</li>
<li><strong>深度性能调优：</strong> SAE 对 Dify 实施了穿透代码与架构的“立体调优”，不仅在底层修补了 Redis 集群适配与慢 SQL 短板，更精准调优了运行参数并对齐了资源规格。这一全链路改造驱动吞吐量实现从 10 QPS 到 500 QPS 的 50 倍跃迁，确保 AI 响应如丝般顺滑。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b03b1aef3124e82a428da8f31bee786~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=UK5iKKpKEVzqdBdorooDslB%2BYn0%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-6">SLS：支撑海量数据的“存算分离”方案</h3>
<p>SLS 并非简单的数据库替代品，而是专为日志场景设计的云原生基础设施。相比于 PostgreSQL，SLS 在 Dify 场景下实现了四个维度的架构升级：</p>
<ul>
<li><strong>极致存储弹性：</strong> 不同于数据库需按“峰值”预置资源，SLS 作为 Saas 化服务，天然支持秒级弹性伸缩。无论是深夜的低谷还是突发的推理洪峰，都能自适应承载，无需关心分片或容量上限。</li>
<li><strong>架构解耦负载隔离：</strong> 相利用追加写入特性，避免了数据库常见的随机 I/O 与锁竞争，轻松支撑万级 TPS 吞吐。同时通过将日志负载彻底剥离至云端，确保海量日志写入不影响 Dify 核心业务的响应速度。</li>
<li><strong>分层存储低成本留存：</strong> 依托高压缩比技术，热数据实时分析，冷数据自动沉降至归档存储，可以远低于数据库 SSD 的成本满足长周期的审计与回溯需求。</li>
<li><strong>开箱即用的业务洞察：</strong> 内置的 OLAP 分析引擎支持 SQL 实时查询、可视化报表与告警监控，帮助开发者将沉睡的日志数据转化为直观的业务洞察。</li>
</ul>
<h2 data-id="heading-7">极简部署：1 分钟定义生产级底座</h2>
<p>SAE 应用中心内置了深度优化的 Dify 生产级模板，通过简单的参数配置，即可一键交付一套高可用就绪的运行环境，告别繁琐的 YAML 编写与环境调试。</p>
<h3 data-id="heading-8">Step 1：选择部署模板</h3>
<p>登录 SAE 控制台，进入应用中心，选择 <strong>“Dify 社区版 - Serverless 部署”</strong> 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/169f52b36d824ee388e522960f9a0535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=WAOhMnMs7Opi2BEAU9C5mp2kFko%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-9">Step 2：配置参数与规格选型</h3>
<p>目前提供了 Dify 高性能版、Dify 高可用版、Dify 测试版三种模板。</p>
<p>如果是应对高并发生产场景，建议优先选择 <strong>Dify 高性能版</strong>，该版本专门针对 api 镜像以及 <code>plugin-daemon</code> 镜像做了深度优化，运行效率更高。配置过程极为精简，只需手动填写各云服务的密码并选定所属的 VPC 与子网（VSW），系统便会针对选定的云资源给出一份总预估价格，确保成本清晰透明。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e38dd78bf6a94997b2ef19f6ff0c1423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=GDvPQAqTZr2ZytjFxS3Rh2NFnTA%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-10">Step 3：提交并访问服务</h3>
<p>点击提交后，系统会自动完成核心服务的部署与云资源关联。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2fe9a40558d4a8cbbdeb99216f567c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=LXV1sWTtsmeXt%2BnmaLUOtftnccc%3D" alt="图片" loading="lazy"/></p>
<p>部署完成后，直接在浏览器输入控制台提供的服务地址 <code>${EXTERNAL-IP}:${PORT}</code>，即可开始您的 Dify 应用编排之旅。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c0fb3336ec44850bcf712fd036e9f77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=k9KGdmuUBbBHxsfE%2Bel1XOXlv5E%3D" alt="图片" loading="lazy"/></p>
<p>注：当 Dify 启动并运行之后，SLS 插件会自动创建相关的 logstore 和索引配置。无须手动干预，直接从 SLS 控制台进入对应的 project，即可工作流日志进行实时的查询和分析。</p>
<h2 data-id="heading-11">50 倍性能跃迁：SAE 从 10 QPS 到 500 QPS 的突破之路</h2>
<p>Dify 社区版的默认配置仅能支撑 10 QPS，但这仅仅是起步。从“尝鲜”到 500 QPS 的生产级扩容，并非简单的堆砌服务器资源，而是一场步步惊心的“闯关游戏”。每当你试图提升吞吐量时，总会撞上新的隐形天花板——从基础的参数限制到深层的架构瓶颈。SAE 团队通过全链路压测，为您提前探明并攻克了这条晋级之路上的两大核心关卡，让高性能部署变得有迹可循。</p>
<h3 data-id="heading-12">瓶颈一：突破 10 QPS 限制——组件并发与数据库连接的协同调优</h3>
<h4 data-id="heading-13">1. 为什么默认配置只有 10 QPS？</h4>
<p>Dify 社区版默认配置更多是为了方便开发者快速试用，而非为大规模生产环境设计。其核心组件 dify-api 的默认参数极为保守：</p>
<pre><code class="hljs">SERVER_WORKER_AMOUNT（工作进程数）：1
SERVER_WORKER_CONNECTIONS（单进程最大连接数）：10
</code></pre>
<p>这两个参数直接锁死了单节点的吞吐上限。但在生产环境中，我们不能简单地将这些参数“调大十倍”，因为应用层的并发能力提升，立即会引发下游数据库的连锁反应。</p>
<h4 data-id="heading-14">2. 牵一发而动全身的“连接池”难题</h4>
<p>随着 QPS 的增长，dify-api 和 dify-plugin-daemon 等组件会向 PostgreSQL 发起海量连接。如果缺乏全链路的参数协同，系统极易陷入瘫痪：</p>
<ul>
<li>连接数被打满：PostgreSQL 的总连接数是有限的，盲目增加组件并发，会导致数据库连接迅速耗尽，后续请求直接报错。</li>
<li>组件间的连接争抢：SQLAlchemy 连接池有“懒加载”机制，且空闲连接在过期前不会释放。如果配置不当，会出现非核心组件占用大量空闲连接，而核心组件因拿不到连接而“饥饿”的情况。</li>
</ul>
<h4 data-id="heading-15">解决方案：经过实战验证的“生产级配置矩阵”</h4>
<p>为了避免用户陷入繁琐的参数试错循环，SAE 团队在真实生产环境下进行了多轮全链路压测。摸索出了不同流量档位下 API 并发度、数据库连接池大小与各组件资源规格之间的<strong>生产级配置清单</strong>。用户无需关心具体的参数计算，只需根据预估流量选择对应的规格档位，确保每一份算力都能转化为实际的业务吞吐量。</p>
<p>注：压测场景并不包含代码执行（Code Sandbox）链路。dify-sandbox 组件的规格与数量请根据实际业务中代码运行的复杂度自行评估调整。</p>
<p>配置清单：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fsae%2Fdify-performance-optimization" target="_blank" title="https://help.aliyun.com/zh/sae/dify-performance-optimization" ref="nofollow noopener noreferrer">help.aliyun.com/zh/sae/dify…</a></p>
<h3 data-id="heading-16">瓶颈二：从 200 QPS 到 500 QPS —— Redis 单点瓶颈与读写分离</h3>
<h4 data-id="heading-17">1. 集成 ARMS 链路追踪定位性能瓶颈</h4>
<p>在将数据库连接优化、QPS 稳定提升至 200 后，系统吞吐量难以进一步提高。为定位瓶颈，SAE 团队通过 SAE 平台深度集成的 ARMS 应用监控，对 dify-plugin-daemon 组件进行链路分析——在 SAE 控制台的应用详情页点击“应用监控”，即可查看耗时最长的调用链路。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d18baad700846fd873fba5eb9196bd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=GZJyL%2FyWFoz4y7S9PMd76zHSYng%3D" alt="图片" loading="lazy"/></p>
<p>Trace 数据显示，下游 Redis 的 SET/DEL 操作频繁失败。SAE 团队尝试将 Redis 实例垂直扩容至最大规格（64 核），但效果甚微：QPS 仅小幅提升，SET/DEL 操作延迟却急剧升高，CPU 利用率迅速打满。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/031b5215a11241529914ad467d53bcc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=xIsXIm7T3OptLdgCdsdT%2Bb5SNvE%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-18">2. Dify-plugin-daemon 高频读写 Redis 引发单点拥堵</h4>
<p>通过代码分析发现，这是 Dify 业务逻辑与 Redis 单点架构冲突的结果：</p>
<ul>
<li>dify-plugin-daemon 在处理每次数据链路请求时，都会生成一个新的 Session ID 并写入 Redis。这种高频的写入逻辑导致 Redis 请求量居高不下。</li>
<li>原生架构中，所有的 Session 读写请求都全部集中在同一个 Redis 节点上。在 200+ QPS 的高并发冲击下，Redis 单线程处理能力达到极限，导致 set 和 del 等基础操作的耗时急剧增大，从而阻塞了整个请求链路。</li>
</ul>
<h4 data-id="heading-19">解决方案：集群化改造实现读写分离</h4>
<p>为了突破单机架构限制，SAE 团队深入组件底层，对 dify-plugin-daemon 进行了集群化适配：</p>
<ul>
<li>补全集群协议：针对原生组件不支持 Redis Cluster 的问题，SAE 团队修改了底层代码，使其完整支持 Redis Cluster 协议。</li>
<li>实现读写分离：通过架构升级，将原本集中在单机上的海量请求分发到集群。利用集群的多节点特性，实现了流量的负载分担与读写分离。</li>
</ul>
<p>这一改造彻底解决了单点瓶颈，成功支撑业务吞吐量从 200 QPS 平滑提升至 500 QPS。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed53ea42f3944a20ba206d4a552404b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=jSQR2MF0osqHI84RTWGZLEn9syA%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-20">激活全链路数据价值：SLS 从“黑盒运行”到“深度洞察”</h2>
<p>Dify 上线后，如何评估模型的成本和性能？如何分析业务的走势？依托 SLS 强大的 OLAP 分析引擎，我们无需预先定义表结构，即可对 Dify 的工作流日志进行深度挖掘，构建覆盖“技术指标”与“业务指标”的全景仪表盘。</p>
<h3 data-id="heading-21">基础设施视角：透视 LLM 成本与性能</h3>
<p>对于 Dify 的 LLM 节点，workflow_node_execution 日志中的 process_data 字段中详细记录了模型的调用情况，可以用来对模型调用情况进行秒级多维分析。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/597a7972031945a1babb1645b51d89fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=R%2FXQhUXinWGyNyDCxHRmZk5hSI8%3D" alt="图片" loading="lazy"/></p>
<p><strong>场景 A：Token 消耗与成本审计</strong></p>
<p>实时监控 Token 的消耗趋势，是控制 AI 成本的关键。我们可以统计输入（prompt_tokens）、输出（completion_tokens）及总 Token 数随时间的变化曲线，精准识别异常流量。</p>
<p>分析 SQL 示例：</p>
<pre><code class="hljs language-sql" lang="sql">node_type:llm <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span>
  <span class="hljs-built_in">sum</span>(
    json_extract_long(process_data, <span class="hljs-string">'$.usage.prompt_tokens'</span>)
  ) prompt_tokens,
  <span class="hljs-built_in">sum</span>("process_data.usage.completion_tokens") completion_tokens,
  <span class="hljs-built_in">sum</span>("process_data.usage.total_tokens") total_tokens,
  date_trunc(<span class="hljs-string">'minute'</span>, __time__) t
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>
  t
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>
  t
limit
  <span class="hljs-keyword">all</span>
</code></pre>
<p>注：json 中的字段可以在 SQL 中直接用 json_extract_xxx 函数进行提取分析，如 <code>json_extract_long(process_data, '$.usage.prompt_tokens')</code>。对于常用的字段建议额外建立 json 子索引，然后在 SQL 中就可以引用对应的列名，如 <code>"process_data.usage.completion_tokens"</code>，便于进行更高效的统计分析。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9be77699bbbc4c2a8ab53dc90c483ec3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=32n2J%2FrJg6zL9qIxPBEN2s%2Fv7EU%3D" alt="图片" loading="lazy"/></p>
<p><strong>场景 B：首字延迟（TTFT）性能分位分析</strong></p>
<p>LLM 的响应速度直接影响用户体验。通过分析 <code>time_to_first_token</code> 的 P50、P90、P99 分位值，可以客观评估模型在不同负载下的响应稳定性，为模型路由或推理加速提供数据支撑。</p>
<p>分析 SQL 示例：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">node_type:</span>llm | <span class="hljs-keyword">select</span>
  date_format(__time__-__time__ % <span class="hljs-number">60</span>, <span class="hljs-comment">'%m-%d %H:%i') as time,</span>
  approx_percentile(<span class="hljs-string">"process_data.usage.time_to_first_token"</span>, <span class="hljs-number">0.25</span>) <span class="hljs-keyword">as</span> Latency_p25,
  approx_percentile(<span class="hljs-string">"process_data.usage.time_to_first_token"</span>, <span class="hljs-number">0.50</span>) <span class="hljs-keyword">as</span> Latency_p50,
  approx_percentile(<span class="hljs-string">"process_data.usage.time_to_first_token"</span>, <span class="hljs-number">0.75</span>) <span class="hljs-keyword">as</span> Latency_p75,
  approx_percentile(<span class="hljs-string">"process_data.usage.time_to_first_token"</span>, <span class="hljs-number">0.99</span>) <span class="hljs-keyword">as</span> Latency_p99,
  min(<span class="hljs-string">"process_data.usage.time_to_first_token"</span>) <span class="hljs-keyword">as</span> Latency_min
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>
  time
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>
  time
limit
  all
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b218a38c5cbd4115b4fe6f9097f70d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=eDVGxwcPyQXB0MIhwWfL%2BczsFXA%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-22">业务运营视角：洞察用户意图与转化</h3>
<p>除了底层的模型指标，SLS 还能帮助我们深入理解业务逻辑。以一个“电商智能客服助手”的 Dify 应用为例，我们可以利用 SQL 拆解工作流节点的输入输出，辅助运营决策。</p>
<p><strong>场景 A：用户意图分布趋势</strong></p>
<p>通过分析工作流中“意图识别”节点的输出结果，我们可以量化统计用户咨询的高频类目（如：退换货、物流查询、优惠券），并观察这些需求随时间的变化趋势，从而指导知识库的优化方向。</p>
<p>分析 SQL 示例：</p>
<pre><code class="hljs language-csharp" lang="csharp">* <span class="hljs-keyword">and</span> title: 用户意图识别 | <span class="hljs-function"><span class="hljs-keyword">select</span>
  <span class="hljs-title">json_extract</span>(<span class="hljs-params">outputs, <span class="hljs-string">'$.text'</span></span>) <span class="hljs-keyword">as</span> "用户意图",
  <span class="hljs-title">count</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>) <span class="hljs-keyword">as</span> pv
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>
  "用户意图"
</span></code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c2e9e7a0f844828edebc00b14b1dc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=R6Mjp6v5RbDHKq%2BDJc0iOOJhonI%3D" alt="图片" loading="lazy"/></p>
<p><strong>场景 B：异常诊断与漏斗分析</strong></p>
<p>通过统计特定节点的错误率或特定意图的后续流转情况，构建漏斗图，快速定位导致用户流失的节点。例如，分析“商品检索”节点的空结果率，以判断是否需要扩充商品知识库。</p>
<p>可以通过漏斗图，分析观察工作流哪些中间节点出现异常失败的比率较高。</p>
<p>分析 SQL 示例：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">status:</span>succeeded | <span class="hljs-keyword">select</span>
  title,
  count(<span class="hljs-keyword">distinct</span> workflow_run_id) cnt
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>
  title
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span>
  cnt desc
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43029a37d2e9436fb8737392e7a808dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=XYYEOJZDV8xsYI52J2eEDu46PRY%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-23">结语：让 AI 应用回归业务本质</h2>
<p>从“能用”到“好用”，Dify 的生产级落地需要坚实的基础设施支撑。SAE 与 SLS 的联合方案，不仅仅是两个云产品的简单叠加，而是通过“算力托管”与“存储解耦”的深度协同，为 Dify 带来了全栈 Serverless 化的架构质变：</p>
<ul>
<li><strong>全栈弹性：</strong> 计算层随流量秒级伸缩，存储层无惧突发吞吐，完美适配 AI 业务的“潮汐特征”。</li>
<li><strong>结构性降本：</strong> 彻底消除闲置资源浪费，用低成本的分层存储替代昂贵的数据库扩容，最大化 ROI。</li>
<li><strong>极致稳定：</strong> 全托管免运维底座配合 I/O 物理隔离，彻底消除单点故障风险与数据库性能黑洞。</li>
<li><strong>深度洞察：</strong> 打通从基础设施监控到业务数据分析的“黑盒”，用 Token 成本与用户意图数据反哺业务进化。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/835940360a294d99b361066fb0b21862~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=b04l%2BNH7VVSLWO54IqFJZwJnTvE%3D" alt="图片" loading="lazy"/></p>
<p>通过 SAE 联合 SLS 发布的这一解决方案，Dify 开发者无需再为底层的资源和架构操心，只需一次简单的配置，即可拥有一个高可用、高性能、低成本的 AI 应用环境，从而真正专注于业务创新与 Prompt 调优。</p>
<p><strong>立即体验：</strong> 欢迎登录阿里云 SAE 控制台 <strong>[</strong> <strong>1]</strong> ，进入应用中心，搜索 Dify 模板，勾选 Dify 高性能版，开启您的一键托管之旅。</p>
<h3 data-id="heading-24">了解 Serverless 应用引擎 SAE</h3>
<p>阿里云 Serverless 应用引擎 SAE 是面向 AI 时代的一站式容器化应用托管平台，以“托底传统应用、加速 AI 创新”为核心理念。它简化运维、保障稳定、闲置特性降低 75% 成本，并通过 AI 智能助手提升运维效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d818faf0280b4b4eb71ae2c8a6bdde4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=RYA4yD8p6Hbv9QaczT34IcHWxwA%3D" alt="图片" loading="lazy"/></p>
<p>面向 AI，SAE 集成 Dify 等主流框架，支持一键部署与弹性伸缩，在 Dify 场景中实现性能<strong>提升 50 倍、成本优化 30% 以上</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2faad1b18e9648f5bd20654fef16efb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319842&amp;x-signature=hTHOa%2B%2Bf57tY7VJ5F3sOYCklOJ8%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-25">产品优势</h4>
<p>凭借八年技术沉淀，SAE 入选 2025 年 Gartner 云原生魔力象限全球领导者，亚洲第一，助力企业零节点管理、专注业务创新。SAE 既是传统应用现代化的“托举平台”，也是 AI 应用规模化落地的“加速引擎”。</p>
<p><strong>1. 传统应用运维的“简、稳、省”优化之道</strong></p>
<ul>
<li>简：零运维心智，专注业务创新</li>
<li>稳：企业级高可用，内置全方位保障</li>
<li>省：极致弹性，将成本降至可度量</li>
</ul>
<p><strong>2. 加速 AI 创新：从快速探索到高效落地</strong></p>
<ul>
<li>快探索：内置 Dify、RAGFlow、OpenManus 等热门 AI 应用模板，开箱即用，分钟级启动 POC；</li>
<li>稳落地：提供生产级 AI 运行时，性能优化（如 Dify 性能提升 50 倍）、无感升级、多版本管理，确保企业级可靠交付；</li>
<li>易集成：深度打通网关、ARMS、计量、审计等能力，助力传统应用智能化升级。</li>
</ul>
<h4 data-id="heading-26">适合谁？</h4>
<p>✅ 创业团队：没有专职运维，需要快速上线</p>
<p>✅ 中小企业：想降本增效，拥抱云原生</p>
<p>✅ 大型企业：需要企业级稳定性和合规性</p>
<p>✅ 出海企业：需要中国区 + 全球部署</p>
<p>✅ AI 创新团队：想快速落地 AI 应用</p>
<h4 data-id="heading-27">了解更多</h4>
<p>产品详情页地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsae" target="_blank" title="https://www.aliyun.com/product/sae" ref="nofollow noopener noreferrer">www.aliyun.com/product/sae</a></p>
<p><strong>相关链接：</strong></p>
<p>[1] 阿里云 SAE 控制台</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fsaenext.console.aliyun.com%2Foverview%3Faccounttraceid%3Ddb100a4af9c7405e88dcfb89e81c5281ibby" target="_blank" title="https://saenext.console.aliyun.com/overview?accounttraceid=db100a4af9c7405e88dcfb89e81c5281ibby" ref="nofollow noopener noreferrer">saenext.console.aliyun.com/overview?ac…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[函数计算 AgentRun 全新升级！让 Agent 拥有长记忆，更聪明、更懂你]]></title>    <link>https://juejin.cn/post/7604964464689397823</link>    <guid>https://juejin.cn/post/7604964464689397823</guid>    <pubDate>2026-02-10T09:25:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604964464689397823" data-draft-id="7604769326225031204" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="函数计算 AgentRun 全新升级！让 Agent 拥有长记忆，更聪明、更懂你"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2026-02-10T09:25:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            函数计算 AgentRun 全新升级！让 Agent 拥有长记忆，更聪明、更懂你
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:25:22.000Z" title="Tue Feb 10 2026 09:25:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d8ff735733f439486e480978497540c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771320324&amp;x-signature=gVzS4VsrSUhsHNNWi2U%2BhFNf1Fg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[极客专属：openClaw配套开源IM App来了]]></title>    <link>https://juejin.cn/post/7604805226697310246</link>    <guid>https://juejin.cn/post/7604805226697310246</guid>    <pubDate>2026-02-10T09:28:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604805226697310246" data-draft-id="7604769326224982052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="极客专属：openClaw配套开源IM App来了"/> <meta itemprop="keywords" content="uni-app,AI编程"/> <meta itemprop="datePublished" content="2026-02-10T09:28:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CHB"/> <meta itemprop="url" content="https://juejin.cn/user/3298190613284270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            极客专属：openClaw配套开源IM App来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3298190613284270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CHB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:28:49.000Z" title="Tue Feb 10 2026 09:28:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>openClaw</code>，曾用名<code>Clawdbot</code>， 一款火爆的<code>ai agent</code>。目前在github上已经有16.7万颗star（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">github.com/openclaw/op…</a>）。</p>
<p>与通用AI不同的是，这是一个个人专属<code>agent</code>，擅长鼓捣的极客，可以把它调教成自己的贾维斯。</p>
<p>你可以设定自己数字分身的性格、思考方式，可以给它充分数据了解你，可以给它操作电脑操作权限、给它数字世界的各种账号和key，它能按你的想法，帮你干很多事。</p>
<p>那么在手机上随时随地指挥你的数字管家，或者接受它的汇报，就是一个刚需。</p>
<p>然而，<code>openClaw</code>对接的国内<code>IM</code>工具，都是封闭的，无法自己控制ui、无法自己扩展功能，数据还需要流经这些IM工具，甚至数据内容还会被监管。</p>
<p>极客不喜欢这样。</p>
<p>现在，开源的<code>uni-ai x</code>，已经对接好了<code>openClaw</code>，成为其一个IM插件。</p>
<h2 data-id="heading-0">uni-ai x</h2>
<p><code>uni-ai x</code>是一个开源的、跨平台、原生的AI Chat工具。开源地址为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdcloudio%2Funi-ai-x" target="_blank" title="https://github.com/dcloudio/uni-ai-x" ref="nofollow noopener noreferrer">github.com/dcloudio/un…</a></p>
<p>它基于原生跨平台框架<code>uni-app x</code>，所以可以在<code>Android</code>、<code>iOS</code>、鸿蒙以原生的高性能方式运行。当然也可以运行在浏览器中。</p>
<ul>
<li>
<p>首先你需要找台电脑安装好openClaw，这台电脑最好是<code>openClaw</code>专用，这是你的数字管家的家。安装方式详见 openClaw官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw.ai%2F" target="_blank" title="https://openclaw.ai/" ref="nofollow noopener noreferrer">openclaw.ai/</a></p>
</li>
<li>
<p>然后给openClaw安装<code>uni-ai x</code>的插件。详见教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fdcloud%2Funi-ai-openclaw-channel-plugin" target="_blank" title="https://gitcode.com/dcloud/uni-ai-openclaw-channel-plugin" ref="nofollow noopener noreferrer">gitcode.com/dcloud/uni-…</a></p>
</li>
<li>
<p>接下来在你的日常开发电脑上安装<code>HBuilderX</code>，下载uni-ai x的开源项目，<a href="https://link.juejin.cn?target=https%3A%2F%2Fext.dcloud.net.cn%2Fplugin%3Fid%3D23902" target="_blank" title="https://ext.dcloud.net.cn/plugin?id=23902" ref="nofollow noopener noreferrer">ext.dcloud.net.cn/plugin?id=2…</a> ，运行起来。</p>
</li>
</ul>
<p>在如下演示中，uni-ai x的app中，与openClaw对话，让你的数字管家帮你创建一个提醒事项。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bc0358bfd764950b0f47b833b16515f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ0hC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771320531&amp;x-signature=8JLAxDbhgMq%2BYyhXBj0wDTArWrA%3D" alt="图片" loading="lazy"/></p>
<p>你的数字管家一通忙乎后，回复你成功，同时你就可以在iCloud的提醒事项中真的看到。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11e21dcde6644958b9f25bd6b1a6f3fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ0hC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771320531&amp;x-signature=akaWdzGgyUSaQruJuYngWBSCpSg%3D" alt="图片" loading="lazy"/></p>
<p>当然这只是入门玩法，优秀的数字管家会给你建议，发现你的日程有临近或冲突，如果你给它位置信息，它还可以预先提示出发时间，甚至提醒你减少会议、花费更多精力专注在更重要的战略目标上。</p>
<p>开源的<code>uni-ai x</code>客户端，支撑你自定义更多玩法，比如</p>
<ul>
<li>
<p>调用手机摄像头，把摄像头画面实时传输给你的数字管家</p>
</li>
<li>
<p>调用位置，让数字管家提醒你地理围栏相关的事项，例如提醒你前面500米有一家你心仪很久的美食，不忙的话可以去打卡。</p>
</li>
</ul>
<p>因为开源，且<code>uni-app x</code>支持调用各种手机能力，所以能玩出什么，完全取决于你的想象力。</p>
<p>对于你的数字管家，你给它的上下文越多（不是通过打字），它越能替你办好事。</p>
<p><code>uni-ai x</code>作为一个专业的ai chat工具，支持非常完整的markdown能力：</p>
<ul>
<li>
<p>流式渲染</p>
</li>
<li>
<p>图文表格</p>
</li>
<li>
<p>流程图</p>
</li>
<li>
<p>几乎所有编程语言的代码高亮。<br/>
如果你希望你的数字管家帮你写代码，那么完全可以在手机上review它的成果。</p>
</li>
</ul>
<p>并且全平台可用：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2ba3358532b4658bc47368085fd6c1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ0hC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771320531&amp;x-signature=C%2BsPB4wFqVo3q3plg%2Bzvubyvyz0%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0960f1d1945c471f8913fdad263da13f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ0hC:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771320531&amp;x-signature=vP3wXS7yf0jUY%2B7Ktx3iSObT6dc%3D" alt="图片" loading="lazy"/></p>
<p>还有更多：</p>
<ul>
<li>uni-ai x支持<code>uni-push</code>，你可以在全平台收到推送通知。</li>
<li>uni-ai x还提供了基于uniCloud的socket中转网关，让你的电脑在不暴露公网ip的情况下，安全的和客户端通信。</li>
<li>uni-ai x还提供了手机与电脑端的互认证机制，你可以在2端配置自己的key，确保三方无法接入。</li>
</ul>
<p>最后，以上都是免费的，拿去玩起来吧!</p>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdcloudio%2Funi-ai-x" target="_blank" title="https://github.com/dcloudio/uni-ai-x" ref="nofollow noopener noreferrer">github.com/dcloudio/un…</a></p>
<p>技术交流群：更多问题欢迎加入uni-ai官方交流群。<a href="https://link.juejin.cn?target=https%3A%2F%2Fim.dcloud.net.cn%2F%23%2F%3FjoinGroup%3D68511b0b7ae60eb5c891cfbc" target="_blank" title="https://im.dcloud.net.cn/#/?joinGroup=68511b0b7ae60eb5c891cfbc" ref="nofollow noopener noreferrer"/>，此群非微信群，而是DCloud的<code>uni-im</code>群。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026重磅Uniapp+Vue3+DeepSeek-V3.2跨三端流式AI会话]]></title>    <link>https://juejin.cn/post/7604863528944140303</link>    <guid>https://juejin.cn/post/7604863528944140303</guid>    <pubDate>2026-02-10T09:09:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604863528944140303" data-draft-id="7604846849463648308" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026重磅Uniapp+Vue3+DeepSeek-V3.2跨三端流式AI会话"/> <meta itemprop="keywords" content="uni-app,DeepSeek,Vue.js"/> <meta itemprop="datePublished" content="2026-02-10T09:09:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xiaoyan2015"/> <meta itemprop="url" content="https://juejin.cn/user/4230576475215165"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026重磅Uniapp+Vue3+DeepSeek-V3.2跨三端流式AI会话
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576475215165/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xiaoyan2015
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:09:27.000Z" title="Tue Feb 10 2026 09:09:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>迎接马年新春，历时三周爆肝迭代研发<code>uni-app+vue3</code>对接<code>deepseek-v3.2</code>聊天大模型。新增<strong>深度思考、katex数学公式、代码高亮/复制代码</strong>等功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3487561a4e5e4125b4ce37695280c020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=1KgDRY28sZby2MKD%2Bgs45dy%2BH1c%3D" alt="未标题-20.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79516c8a6a454758915bc74d21c21753~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=IgnwynntvWckV56FRZikyipTUOE%3D" alt="p1-1.gif" loading="lazy"/></p>
<p>H5端还支持mermaid图表渲染，小程序端支持复制代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76b3142ef9c448df9c6d8a3ad5006c4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=7V4%2B5bdX0wHUUhADBwvC5Nd0ar0%3D" alt="p2-1.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4facbd10fc314ac98919055b752ceb59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=Y8aDgW6CwCipb3tDrK%2FkAhlV5Ac%3D" alt="未标题-12-xcx3.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33083424504843d69747722de1a9dba1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=9TvauFQmxRXY%2F2vwtlZsHaszURY%3D" alt="app6.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f166c817d4a44081b94de2fec5c0e7a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=OY7jZ9x7WIf%2BzDOmUSBtuSLG7dU%3D" alt="未标题-7.png" loading="lazy"/></p>
<h2 data-id="heading-0">使用技术</h2>
<ul>
<li>开发工具：HbuilderX 4.87</li>
<li>技术框架：uni-app+vue3+pinia2+vite5</li>
<li>大模型框架：DeepSeek-V3.2</li>
<li>组件库：uni-ui+uv-ui</li>
<li>高亮插件：highlight.js</li>
<li>markdown解析：ua-markdown+mp-html</li>
<li>本地缓存：pinia-plugin-unistorage</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4a13df8576b4e959e4db981d11a31fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=O0zhs6CC%2Fd%2BumwG4Nkdp5OX8qqY%3D" alt="未标题-16.png" loading="lazy"/></p>
<h2 data-id="heading-1">编译支持</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba93722a065b4c7a81b913fa7b65f111~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=0J8dXjqENGjJjxmCPWxsvNRa8Xw%3D" alt="360截图20260208114808097.png" loading="lazy"/></p>
<p>另外还支持运行到web端，以750px显示页面布局结构。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38ea8e9bac5843749791cf3dfeca92b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=CqN%2B8XbG5KtxDzGZCb01weQzE2w%3D" alt="014360截图20260207222047559.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad08dfd0eba44843a77b74f409be2bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=BkzJGHBSOmXNtG0DT%2BU6AAWiTvQ%3D" alt="015360截图20260207222357329.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/723b1b64dd4a41978698827843ce2880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=7lpChbkhhwLzcZT3GCr82XljOSc%3D" alt="016360截图20260207223029831.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e63d42ae01749a6aec97aecf34cddb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=Kuxrpc8BeN2zh1NtzJsD8DGWuao%3D" alt="017360截图20260207224414288.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adf66f6bc53a44ac8e0a1e058b6b952b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=AVrLpQ5HtzDo9PJtjBFBvvQFNYw%3D" alt="017360截图20260207225332423.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b631ff06c0940f98d5eb1e6bc923810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=eC7%2FXvzV6uwym65j0a3Y0tmA0%2Fk%3D" alt="017360截图20260207225332429.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7516d3edd6684505b4aee0c5b329bffa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771319366&amp;x-signature=nqfDM9Af9qVgkUXSjhvt5l2Xf10%3D" alt="018360截图20260207225701329.png" loading="lazy"/></p>
<p>如果想要了解更多的项目介绍，可以去看看这篇文章。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fxiaoyan2017%2Fp%2F19599014" target="_blank" title="https://www.cnblogs.com/xiaoyan2017/p/19599014" ref="nofollow noopener noreferrer">uniapp+deepseek流式ai助理|uniapp+vue3对接deepseek三端Ai问答模板</a></p>
<p><strong>往期推荐</strong></p>
<p><a href="https://juejin.cn/post/7592127014188482560" target="_blank" title="https://juejin.cn/post/7592127014188482560">2026最新款Vue3+DeepSeek-V3.2+Arco+Markdown网页端流式生成AI Chat</a></p>
<p><a href="https://juejin.cn/post/7594389431835672617" target="_blank" title="https://juejin.cn/post/7594389431835672617">Electron39.2+Vue3+DeepSeek从0-1手搓AI模板桌面应用Exe</a></p>
<p><a href="https://juejin.cn/post/7586994471738392619" target="_blank" title="https://juejin.cn/post/7586994471738392619">2026最新款Vite7+Vue3+DeepSeek-V3.2+Markdown流式输出AI会话</a></p>
<p><a href="https://juejin.cn/post/7560576454849757220" target="_blank" title="https://juejin.cn/post/7560576454849757220">electron38.2-vue3os系统|Vite7+Electron38+Pinia3+ArcoDesign桌面版OS后台管理</a></p>
<p><a href="https://juejin.cn/post/7550160737244708898" target="_blank" title="https://juejin.cn/post/7550160737244708898">基于electron38+vite7+vue3 setup+elementPlus电脑端仿微信/QQ聊天软件</a></p>
<p><a href="https://juejin.cn/post/7555690975866044431" target="_blank" title="https://juejin.cn/post/7555690975866044431">2025最新款Electron38+Vite7+Vue3+ElementPlus电脑端后台系统Exe</a></p>
<p><a href="https://juejin.cn/post/7581348660823703552" target="_blank" title="https://juejin.cn/post/7581348660823703552">自研2025版flutter3.38实战抖音app短视频+聊天+直播商城系统</a></p>
<p><a href="https://juejin.cn/post/7537106747279065134" target="_blank" title="https://juejin.cn/post/7537106747279065134">基于uni-app+vue3+uvui跨三端仿微信app聊天模板【h5+小程序+app】</a></p>
<p><a href="https://juejin.cn/post/7522315126492512283" target="_blank" title="https://juejin.cn/post/7522315126492512283">基于uniapp+vue3+uvue短视频+聊天+直播app系统</a></p>
<p><a href="https://juejin.cn/post/7534184729319440419" target="_blank" title="https://juejin.cn/post/7534184729319440419">基于flutter3.32+window_manager仿macOS/Wins风格桌面os系统</a></p>
<p><a href="https://juejin.cn/post/7529357546844504100" target="_blank" title="https://juejin.cn/post/7529357546844504100">flutter3.27+bitsdojo_window电脑端仿微信Exe应用</a></p>
<p><a href="https://juejin.cn/post/7451376011436621833" target="_blank" title="https://juejin.cn/post/7451376011436621833">自研tauri2.0+vite6.x+vue3+rust+arco-design桌面版os管理系统Tauri2-ViteOS</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cookie 详细介绍]]></title>    <link>https://juejin.cn/post/7604889577937027099</link>    <guid>https://juejin.cn/post/7604889577937027099</guid>    <pubDate>2026-02-10T09:14:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604889577937027099" data-draft-id="7604793276907782207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cookie 详细介绍"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-10T09:14:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端插班生"/> <meta itemprop="url" content="https://juejin.cn/user/3878732755371448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cookie 详细介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732755371448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端插班生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:14:21.000Z" title="Tue Feb 10 2026 09:14:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文整理自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FGuides%2FCookies" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies" ref="nofollow noopener noreferrer">MDN: HTTP Cookie</a> 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rfc-editor.org%2Frfc%2Frfc6265.html" target="_blank" title="https://www.rfc-editor.org/rfc/rfc6265.html" ref="nofollow noopener noreferrer">RFC 6265: HTTP State Management Mechanism</a>。</p>
</blockquote>
<h2 data-id="heading-0">一、什么是 Cookie</h2>
<p><strong>HTTP Cookie</strong>（也称 Web Cookie、浏览器 Cookie）是服务器通过 HTTP 响应发送到用户浏览器并保存在本地的一小块数据。浏览器会存储这些 Cookie，并在下次向<strong>同一服务器</strong>再发起请求时，通过请求头自动携带发送。通常用于告知服务端：两个请求是否来自同一浏览器，从而在<strong>无状态的 HTTP 协议</strong>上维持稳定状态（如保持用户登录）[MDN]。</p>
<ul>
<li><strong>发明与历史</strong>：Lou Montulli（Netscape，1994）；RFC 2109、RFC 2965 已被 <strong>RFC 6265</strong>（2011）取代，Cookie2/Set-Cookie2 已废弃 [RFC 6265]。</li>
<li><strong>标准</strong>：RFC 6265 定义 <code>Cookie</code> 与 <code>Set-Cookie</code> 两个头部，并指出 Cookie 存在诸多历史遗留的安全与隐私问题，但仍被广泛使用。</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、Cookie 的三大用途 [MDN]</h2>





















<table><thead><tr><th>用途</th><th>说明</th></tr></thead><tbody><tr><td><strong>会话状态管理</strong></td><td>用户登录状态、购物车、游戏分数等需记录的信息</td></tr><tr><td><strong>个性化设置</strong></td><td>用户自定义设置、主题等</td></tr><tr><td><strong>浏览器行为跟踪</strong></td><td>跟踪与分析用户行为（常涉及隐私与合规）</td></tr></tbody></table>
<p><strong>注意</strong>：Cookie 曾作为客户端唯一存储手段被滥用；现在若<strong>不需要在每次请求中携带</strong>数据，推荐使用现代存储 API（如 Web Storage、IndexedDB），以减少请求头体积与性能开销，尤其在移动端 [MDN]。
在浏览器中查看 Cookie：开发者工具 → <strong>存储/Storage</strong> → <strong>Storage Inspector</strong> → 选中 Cookie [MDN]。</p>
<hr/>
<h2 data-id="heading-2">三、创建与传递：Set-Cookie 与 Cookie 头</h2>
<h3 data-id="heading-3">3.1 基本流程</h3>
<ol>
<li>服务器在 HTTP <strong>响应头</strong>里添加一个或多个 <strong>Set-Cookie</strong>。</li>
<li>浏览器保存这些 Cookie，之后向<strong>同一服务器</strong>发请求时，在 <strong>Cookie</strong> 请求头里一并发送 [MDN]。</li>
</ol>
<p>示例 [MDN]：</p>
<pre><code class="hljs language-http" lang="http">HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: yummy_cookie=choco
Set-Cookie: tasty_cookie=strawberry

[页面内容]
</code></pre>
<p>后续请求：</p>
<pre><code class="hljs language-http" lang="http">GET /sample_page.html HTTP/1.1
Host: www.example.org
Cookie: yummy_cookie=choco; tasty_cookie=strawberry
</code></pre>
<p><strong>注意</strong>：不应将多个 Set-Cookie 折叠成一行（HTTP 头部折叠可能改变语义，因为逗号在 Set-Cookie 中有特殊含义）[RFC 6265]。
服务端如何设置 Set-Cookie 可参考 MDN 示例：PHP、Node.js、Python、Ruby on Rails 等 [MDN]。</p>
<h3 data-id="heading-4">3.2 语法概要（RFC 6265）</h3>
<ul>
<li><strong>Set-Cookie</strong> 格式：<code>Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;</code>，后可跟若干属性（<code>; Expires=...</code>、<code>; Max-Age=...</code>、<code>; Domain=...</code>、<code>; Path=...</code>、<code>; Secure</code>、<code>; HttpOnly</code> 等）。</li>
<li><strong>Cookie</strong> 请求头：<code>Cookie: cookie-pair *( "; " cookie-pair )</code>，仅包含名值对，<strong>不包含</strong>过期时间、域、路径、Secure、HttpOnly 等属性，服务端无法从 Cookie 头 alone 得知这些元数据 [RFC 6265]。</li>
</ul>
<hr/>
<h2 data-id="heading-5">四、Cookie 的生命周期</h2>
<h3 data-id="heading-6">4.1 会话期 vs 持久性 [MDN][RFC 6265]</h3>
<ul>
<li>
<p><strong>会话期 Cookie（Session Cookie）</strong></p>
<ul>
<li>不设置 <code>Expires</code> 且不设置 <code>Max-Age</code>（或 <code>Max-Age=0</code>）。</li>
<li>在<strong>当前会话结束</strong>后被删除。注意：“当前会话”由浏览器定义，部分浏览器在重启时会做<strong>会话恢复</strong>，可能导致会话 Cookie 被保留更久 [MDN]。</li>
<li>RFC 6265：此类 Cookie 的 <code>persistent-flag</code> 为 false，<code>expiry-time</code> 为“会话结束”。</li>
</ul>
</li>
<li>
<p><strong>持久性 Cookie（Persistent Cookie）</strong></p>
<ul>
<li>通过 <code>Expires</code>（日期/时间）或 <code>Max-Age</code>（秒数）指定存活期。</li>
<li>在过期前会一直存在（除非用户或浏览器策略清除）。</li>
<li><strong>Max-Age 优先于 Expires</strong>；若两者都存在，以 Max-Age 为准。若 Max-Age 为 0 或负数，表示立即过期 [RFC 6265]。</li>
</ul>
</li>
</ul>
<p>示例 [MDN]：</p>
<pre><code class="hljs language-http" lang="http">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
</code></pre>
<p><strong>重要</strong>：<code>Expires</code> 的日期时间是<strong>客户端</strong>解释的，与服务器时区无关 [MDN]。
若站点对用户做身份验证，建议在每次验证时<strong>重新生成并重新发送</strong>会话 Cookie（包括已存在的），以减轻<strong>会话固定攻击</strong>（Session Fixation）[MDN]。</p>
<h3 data-id="heading-7">4.2 删除 Cookie</h3>
<p>服务端可通过发送同名、同 Domain、同 Path 的 Cookie，并将 <code>Expires</code> 设为<strong>过去的时间</strong>（或 <code>Max-Age=0</code>）来删除 Cookie [RFC 6265][MDN]。</p>
<hr/>
<h2 data-id="heading-8">五、限制 Cookie 的访问与发送</h2>
<h3 data-id="heading-9">5.1 Secure</h3>
<ul>
<li>带 <code>Secure</code> 的 Cookie <strong>仅应</strong>通过<strong>安全通道</strong>（通常为 HTTPS/TLS）发送，不会在不安全的 HTTP 请求中发送（<strong>本地主机除外</strong>）[MDN]。</li>
<li>不安全的站点（URL 为 <code>http:</code>）无法设置带 <code>Secure</code> 的 Cookie [MDN]。</li>
<li><strong>注意</strong>：Secure 只保护<strong>机密性</strong>（传输中不被窃听），<strong>不提供完整性</strong>。主动网络攻击者仍可能通过不安全通道注入或覆盖 Cookie，破坏其完整性 [RFC 6265]。</li>
</ul>
<h3 data-id="heading-10">5.2 HttpOnly</h3>
<ul>
<li>带 <code>HttpOnly</code> 的 Cookie <strong>不能</strong>被 JavaScript 的 <code>document.cookie</code> 等“非 HTTP API”访问，仅用于 HTTP 请求 [MDN][RFC 6265]。</li>
<li>服务端会话 Cookie 通常不需要对 JS 可见，应设置 <code>HttpOnly</code>，以缓解 <strong>XSS</strong> 窃取会话 [MDN]。</li>
</ul>
<p>示例 [MDN]：</p>
<pre><code class="hljs language-http" lang="http">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
</code></pre>
<hr/>
<h2 data-id="heading-11">六、定义 Cookie 的发送范围：Domain、Path、SameSite</h2>
<h3 data-id="heading-12">6.1 Domain [MDN][RFC 6265]</h3>
<ul>
<li><strong>不指定 Domain</strong>：默认为<strong>当前 host</strong>，<strong>不包含子域</strong>（即仅当前域名）。</li>
<li><strong>指定 Domain</strong>：如 <code>Domain=mozilla.org</code>，则子域（如 <code>developer.mozilla.org</code>）也会收到该 Cookie。指定 Domain 会<strong>扩大</strong>作用域。</li>
<li>用户代理会拒绝 Domain 不包含当前 origin 的 Cookie；许多浏览器还会拒绝将 <strong>公共后缀</strong>（如 <code>com</code>、<code>co.uk</code>）设为 Domain，以防止恶意站点为整片顶级域设置 Cookie [RFC 6265]。</li>
</ul>
<h3 data-id="heading-13">6.2 Path [MDN][RFC 6265]</h3>
<ul>
<li><strong>Path</strong> 指定 URL 路径前缀；只有请求的 URL 路径与该 Path <strong>匹配</strong>（或为其子路径）时才会发送 Cookie。</li>
<li>路径以 <code>%x2F</code>（"/"）为分隔符；子路径会匹配。例如 <code>Path=/docs</code> 会匹配：
<ul>
<li><code>/docs</code>、<code>/docs/</code>、<code>/docs/Web/</code>、<code>/docs/Web/HTTP</code></li>
</ul>
</li>
<li>不匹配：<code>/</code>、<code>/docsets</code>、<code>/fr/docs</code> [MDN]。</li>
<li>若省略 Path，默认值为当前请求 URI 的路径的“目录”部分 [RFC 6265]。</li>
<li><strong>安全提醒</strong>：Path 不能作为安全边界依赖；同一主机上不同路径的互不信任服务不应仅靠 Path 隔离敏感 Cookie [RFC 6265]。</li>
</ul>
<h3 data-id="heading-14">6.3 SameSite [MDN]</h3>
<ul>
<li><strong>SameSite</strong> 控制是否在<strong>跨站请求</strong>中发送 Cookie（“站点”由注册域和<strong>协议</strong> http/https 共同定义），用于减轻 <strong>CSRF</strong>。</li>
<li>取值：
<ul>
<li><strong>Strict</strong>：仅在同站请求中发送。</li>
<li><strong>Lax</strong>：与 Strict 类似，但在用户<strong>从外站导航到</strong>该站时（如点击链接）也会发送。</li>
<li><strong>None</strong>：同站与跨站请求都会发送；<strong>必须</strong>同时设置 <code>Secure</code>（即仅在安全上下文中）[MDN]。</li>
</ul>
</li>
<li><strong>未设置 SameSite</strong> 时，现代浏览器多将其视为 <strong>Lax</strong>（此前默认行为是更宽松的“始终发送”）[MDN]。</li>
<li>同一注册域下，若协议不同（<code>http</code> vs <code>https</code>），视为<strong>不同站点</strong> [MDN]。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-http" lang="http">Set-Cookie: mykey=myvalue; SameSite=Strict
</code></pre>
<hr/>
<h2 data-id="heading-15">七、Cookie 前缀（__Host- 与 __Secure-）[MDN]</h2>
<p>由于 Cookie 机制无法让服务端确认 Cookie 是否在安全来源设置、甚至无法确认最初设置者，子域上的漏洞可能通过 <code>Domain</code> 为父域设置 Cookie，被用于<strong>会话劫持</strong>。作为<strong>深度防御</strong>，可使用 <strong>Cookie 前缀</strong>：</p>
<ul>
<li>
<p><strong>__Host-</strong>
仅当同时满足以下条件时，浏览器才接受 Set-Cookie：</p>
<ul>
<li>带 <strong>Secure</strong>；</li>
<li>从<strong>安全来源</strong>发送；</li>
<li><strong>不</strong>包含 <code>Domain</code>；</li>
<li><strong>Path</strong> 为 <code>/</code>。
此类 Cookie 可视为“锁定到当前 host”。</li>
</ul>
</li>
<li>
<p><strong>__Secure-</strong>
仅当带 <strong>Secure</strong> 且从<strong>安全来源</strong>发送时才接受，限制弱于 <code>__Host-</code>。</p>
</li>
</ul>
<p>不符合前缀要求的 Cookie 会被浏览器拒绝。应用服务器<strong>必须</strong>校验完整 Cookie 名称；用户代理在发送 Cookie 头时<strong>不会</strong>去掉前缀 [MDN]。</p>
<hr/>
<h2 data-id="heading-16">八、浏览器存储模型与发送规则（RFC 6265 要点）</h2>
<ul>
<li>用户代理为每个 Cookie 存储：name、value、expiry-time、domain、path、creation-time、last-access-time、persistent-flag、host-only-flag、secure-only-flag、http-only-flag。</li>
<li><strong>发送 Cookie 时</strong>：只发送与请求的 host（或 Domain 匹配）、Path 匹配、未过期、且满足 Secure（若为 secure-only）的 Cookie；若通过“非 HTTP API”生成请求（如 <code>document.cookie</code>），则<strong>不</strong>包含 http-only-flag 为 true 的 Cookie。</li>
<li><strong>Eviction（驱逐）</strong>：过期 Cookie 会先被删除；若单域或全局 Cookie 数量超限，可按实现定义的策略删除（RFC 建议优先删过期，再删同域过多的，再删全局过多的；同优先级时删 last-access-time 最早的）。</li>
<li><strong>实现建议下限</strong>：每 Cookie 至少 4096 字节（名+值+属性总长）、每域至少 50 个 Cookie、全局至少 3000 个 Cookie；服务端应尽量少而小，并做好用户代理未返回某些 Cookie 时的降级 [RFC 6265]。</li>
</ul>
<hr/>
<h2 data-id="heading-17">九、JavaScript 与 Document.cookie [MDN]</h2>
<ul>
<li>通过 <strong>Document.cookie</strong> 可<strong>创建</strong>新 Cookie，也可<strong>读取</strong>现有 Cookie（仅限<strong>未</strong>设置 <code>HttpOnly</code> 的）。</li>
<li>由 JavaScript 创建的 Cookie <strong>不能</strong>包含 <code>HttpOnly</code> [MDN]。</li>
</ul>
<p>示例 [MDN]：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">"yummy_cookie=choco"</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">"tasty_cookie=strawberry"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>);
<span class="hljs-comment">// 输出 "yummy_cookie=choco; tasty_cookie=strawberry"</span>
</code></pre>
<p><strong>安全</strong>：Cookie 值可被用户或脚本访问与修改，需注意 XSS。敏感场景建议使用服务端查证的不透明标识符，或考虑 JWT 等替代方案；在不可信环境中<strong>不要</strong>通过 HTTP Cookie 存储或传输敏感信息 [MDN]。</p>
<hr/>
<h2 data-id="heading-18">十、安全考量 [MDN][RFC 6265]</h2>
<h3 data-id="heading-19">10.1 缓解措施</h3>
<ul>
<li>使用 <strong>HttpOnly</strong> 防止通过 JS 读取 Cookie。</li>
<li>敏感 Cookie（如身份验证）应<strong>生存期短</strong>，并设置 <strong>SameSite=Strict 或 Lax</strong>，避免在跨站请求中发送 [MDN]。</li>
</ul>
<h3 data-id="heading-20">10.2 常见风险</h3>
<ul>
<li><strong>环境权威（Ambient Authority）与 CSRF</strong>：Cookie 随请求自动携带，易被跨站请求伪造；应配合 SameSite、CSRF Token 等 [RFC 6265]。</li>
<li><strong>明文传输</strong>：非 HTTPS 时 Cookie 明文传输，易被窃听与篡改；敏感 Cookie 应配合 <strong>Secure</strong> 与 HTTPS [RFC 6265]。</li>
<li><strong>会话固定（Session Fixation）</strong>：攻击者将已知会话 ID 植入受害者浏览器 → 受害者用该 ID 登录 → 攻击者用同一 ID 冒充。缓解：每次认证后重新签发会话 Cookie [MDN][RFC 6265]。</li>
<li><strong>弱机密性</strong>：Cookie 不按端口、不按协议（http/https）隔离，同一 host 不同端口/协议可能共享 Cookie；不可在同一主机上对互不信任的服务依赖 Cookie 做敏感隔离 [RFC 6265]。</li>
<li><strong>弱完整性</strong>：同父域下不同子域可互相覆盖 Domain 为父域的 Cookie；主动攻击者还可通过 HTTP 响应注入 Set-Cookie，影响 HTTPS 站点的 Cookie。加密/签名 Cookie 内容可部分缓解，但无法防止重放 [RFC 6265]。</li>
<li><strong>依赖 DNS</strong>：Cookie 安全依赖 DNS；DNS 被篡改时，Cookie 提供的安全属性可能失效 [RFC 6265]。</li>
</ul>
<hr/>
<h2 data-id="heading-21">十一、跟踪与隐私 [MDN][RFC 6265]</h2>
<h3 data-id="heading-22">11.1 第一方 vs 第三方 Cookie</h3>
<ul>
<li><strong>第一方 Cookie</strong>：Cookie 的域和协议与<strong>当前页面</strong>一致（或为当前页面的子域等符合 Domain 规则）。</li>
<li><strong>第三方 Cookie</strong>：由页面中引用的<strong>其他域</strong>（如广告、统计）设置；同一第三方在不同站点可收到同一 Cookie，从而<strong>跨站跟踪</strong>用户 [MDN][RFC 6265]。</li>
<li>许多浏览器已限制或计划淘汰第三方 Cookie（如 Firefox 默认阻止已知跟踪器）；服务器可通过 <strong>SameSite</strong> 控制是否在跨站场景下发送 [MDN]。</li>
</ul>
<h3 data-id="heading-23">11.2 法规与合规 [MDN]</h3>
<p>涉及 Cookie 的法规包括（具有全球影响）：</p>
<ul>
<li><strong>欧盟 GDPR</strong>（通用数据保护条例）</li>
<li><strong>欧盟 ePrivacy 指令</strong></li>
<li><strong>加州 CCPA</strong>（加州消费者隐私法；通常适用于年收入超过一定规模的实体）</li>
</ul>
<p>常见要求：向用户<strong>告知</strong>使用 Cookie、允许用户<strong>拒绝</strong>部分或全部 Cookie、在用户拒绝 Cookie 时仍能使用<strong>主要服务</strong>。部分公司提供“Cookie 横幅”等方案以辅助合规 [MDN]。</p>
<h3 data-id="heading-24">11.3 各浏览器对第三方 Cookie 的政策（按浏览器与版本）</h3>
<p>不同浏览器、不同版本对第三方 Cookie 的限制差异很大；以下按浏览器与版本范围整理，便于兼容性判断与迁移规划。策略会随版本更新变化，以各厂商官方文档为准。</p>
<h4 data-id="heading-25">Safari（WebKit）</h4>





























<table><thead><tr><th>时间 / 版本</th><th>策略概要</th></tr></thead><tbody><tr><td><strong>2017 年 6 月</strong>（ITP 1.0）</td><td>引入 <strong>Intelligent Tracking Prevention (ITP)</strong>：用机器学习识别跨站跟踪域并限制其 Cookie；未访问站点 30 天后清除其 Cookie；第三方上下文中对 Cookie 做分区。</td></tr><tr><td><strong>2019 年 2 月</strong>（ITP 2.1）</td><td>强化对已知跟踪域的限制与分类。</td></tr><tr><td><strong>2019 年 4 月</strong>（ITP 2.2）</td><td>防止通过链接装饰（URL 参数/片段）跨站跟踪：被分类域通过带 query/fragment 的链接导航时，通过 <code>document.cookie</code> 创建的持久 Cookie 寿命被限制为约 <strong>1 天</strong>。</td></tr><tr><td><strong>2019 年 9 月</strong>（ITP 2.3）</td><td>所有<strong>脚本可写</strong>的网站数据（含 Cookie、Storage）在从被分类域导航后，寿命上限为 <strong>7 天</strong>；<code>document.referrer</code> 降级为 eTLD+1，减少通过 referrer 泄露点击 ID。</td></tr><tr><td><strong>2020 年 3 月</strong>（<strong>Safari 13.1</strong> / <strong>iOS 13.4</strong> / <strong>iPadOS 13.4</strong>）</td><td><strong>默认全面阻止所有第三方 Cookie</strong>（无例外），成为主流浏览器中首个默认全阻的；同时限制脚本可写存储的 7 天寿命、禁用登录指纹等。跨站嵌入若需 Cookie，需通过 <strong>Storage Access API</strong> 向用户请求授权。</td></tr></tbody></table>
<p><strong>小结</strong>：Safari 13.1+（macOS/iOS/iPadOS 对应版本起）默认即“全阻”第三方 Cookie；更早版本通过 ITP 逐步收紧，仍以“限制跟踪域 + 分区/短期”为主，而非一刀切全阻。</p>
<h4 data-id="heading-26">Firefox</h4>

























<table><thead><tr><th>时间 / 版本</th><th>策略概要</th></tr></thead><tbody><tr><td><strong>2019 年 6 月</strong></td><td><strong>Enhanced Tracking Protection (ETP)</strong> 对新安装默认开启；2019 年 9 月推广到所有用户。默认阻止已知跟踪器、指纹等，对第三方 Cookie 按“跟踪列表”限制。</td></tr><tr><td><strong>2021 年 2 月</strong></td><td>引入 <strong>Total Cookie Protection (TCP)</strong>：为每个网站维护独立“Cookie 罐”，第三方 Cookie 不能跨站共享，实质阻止跨站跟踪。初期主要在严格模式或可选开启。</td></tr><tr><td><strong>2022 年 6 月</strong></td><td>TCP 开始向更多用户默认推广。</td></tr><tr><td><strong>2024–2025 年</strong></td><td><strong>Total Cookie Protection 在标准模式（Standard）下默认开启</strong>，逐步覆盖所有平台（Windows、macOS、Linux、Android），第三方 Cookie 按站点隔离，无法用于跨站跟踪。</td></tr></tbody></table>
<p><strong>小结</strong>：Firefox 当前（ETP 默认 + TCP 默认）下，第三方 Cookie 被“按站隔离”，等同阻止跨站跟踪；用户仍可在设置中按站点允许 Cookie。</p>
<h4 data-id="heading-27">Chrome（Chromium）</h4>





















<table><thead><tr><th>时间 / 版本</th><th>策略概要</th></tr></thead><tbody><tr><td><strong>2020 年 2 月</strong>（Chrome 80）</td><td><strong>SameSite 默认行为变更</strong>：未指定 <code>SameSite</code> 的 Cookie 视为 <strong>SameSite=Lax</strong>，跨站子请求（如 iframe、img）不再携带这些 Cookie；需跨站携带必须显式 <code>SameSite=None; Secure</code>。同年 4 月曾因疫情短暂回滚，7 月恢复。</td></tr><tr><td><strong>2020–2024 年</strong></td><td><strong>不默认阻止</strong>第三方 Cookie；仅无痕模式或用户手动在 <code>chrome://settings</code> 中开启“阻止第三方 Cookie”时才会阻。原计划 2022/2023 淘汰第三方 Cookie 并推 Privacy Sandbox（如 FLoC），多次推迟。</td></tr><tr><td><strong>2024–2025 年</strong></td><td>在部分渠道（约 1% 稳定版、约 20% Canary/Dev/Beta）<strong>试验性限制</strong>第三方 Cookie；计划从 <strong>2025 年起</strong>继续推进第三方 Cookie 弃用，与 <strong>Privacy Sandbox</strong>（CHIPS 分区 Cookie、Storage Access API、Related Website Sets、FedCM 等）配合，具体时间表以 Google 开发者公告为准。</td></tr></tbody></table>
<p><strong>小结</strong>：Chrome 目前仍以 SameSite 默认 Lax 为主，未全局默认“阻第三方”；淘汰时间表与 Privacy Sandbox 绑定，会随政策与反馈调整。</p>
<h4 data-id="heading-28">Microsoft Edge（Chromium）</h4>





















<table><thead><tr><th>时间 / 版本</th><th>策略概要</th></tr></thead><tbody><tr><td><strong>2019 年 12 月</strong>（Edge 79）</td><td>引入 <strong>Tracking Prevention</strong>：三档——Basic（仅恶意跟踪/挖矿等）、<strong>Balanced（默认）</strong>、Strict。Balanced 基于“站点参与度”阻止未互动站点的跟踪器，并扩大阻止类别（如 Content 类）。</td></tr><tr><td><strong>2020 年 1 月</strong>（Edge 80）</td><td>跟踪防护默认开启，与 Chrome 的 SameSite 变更同期。</td></tr><tr><td><strong>Edge 77+</strong></td><td>企业策略 <strong>BlockThirdPartyCookies</strong> 可强制在普通浏览中阻止第三方 Cookie（InPrivate 不受该策略约束）。</td></tr></tbody></table>
<p><strong>小结</strong>：Edge 默认不“全阻”第三方 Cookie，而是按跟踪列表 + 参与度启发式限制；Strict 模式最严，Balanced 在隐私与兼容之间折中。</p>
<h4 data-id="heading-29">其他浏览器（简要）</h4>
<ul>
<li><strong>Brave</strong>：自 2019 年 11 月 1.0 起默认阻止广告与跟踪器，第三方跟踪 Cookie 默认被阻。</li>
<li><strong>Opera</strong>：约 2019 年 10 月起内置反跟踪，策略类似“阻止已知跟踪列表”，非全阻第三方 Cookie。</li>
</ul>
<h4 data-id="heading-30">汇总表（当前默认行为，约 2024–2025）</h4>



































<table><thead><tr><th>浏览器</th><th>默认是否阻止/限制第三方 Cookie</th><th>说明</th></tr></thead><tbody><tr><td><strong>Safari</strong>（13.1+）</td><td>✅ 默认全部阻止</td><td>跨站嵌入需 Storage Access API 申请权限。</td></tr><tr><td><strong>Firefox</strong>（ETP+TCP 默认）</td><td>✅ 按站隔离，等同阻止跨站跟踪</td><td>每站独立 Cookie 罐，第三方无法跨站共享。</td></tr><tr><td><strong>Chrome</strong></td><td>❌ 不默认阻止</td><td>SameSite 默认 Lax；淘汰计划进行中，部分用户已进入试验限制。</td></tr><tr><td><strong>Edge</strong></td><td>⚠️ 默认限制跟踪器，非全阻</td><td>Balanced 默认；Strict 最严。</td></tr><tr><td><strong>Brave</strong></td><td>✅ 默认阻止跟踪 Cookie</td><td>与广告拦截一体。</td></tr></tbody></table>
<p><strong>开发建议</strong>：若依赖跨站 Cookie（如嵌入式登录、跨站分析），应显式设置 <code>SameSite=None; Secure</code>，并尽早评估 <strong>Storage Access API</strong>、<strong>CHIPS（Partitioned Cookie）</strong>、<strong>Related Website Sets</strong> 等替代方案，以兼容 Safari 与未来 Chrome 的变更。</p>
<hr/>
<h2 data-id="heading-31">十二、其他浏览器存储方式 [MDN]</h2>

















<table><thead><tr><th>机制</th><th>说明</th></tr></thead><tbody><tr><td><strong>Web Storage</strong></td><td><code>sessionStorage</code>（会话、关标签即清）与 <code>localStorage</code>（长期）；容量大于 Cookie，且<strong>不会</strong>随每次请求发送到服务器。</td></tr><tr><td><strong>IndexedDB</strong></td><td>存储更大量、结构化数据。</td></tr></tbody></table>
<p><strong>“僵尸”Cookie（Zombie Cookie）</strong>：在 Cookie 被删后通过其他存储或脚本重新创建 Cookie。此类做法损害用户隐私与控制权，可能违反数据隐私法规并带来法律风险，不应使用 [MDN]。</p>
<hr/>
<h2 data-id="heading-32">十三、小结</h2>
<ul>
<li>Cookie 由服务端通过 <strong>Set-Cookie</strong> 下发，浏览器在后续符合<strong>域、路径、安全、SameSite</strong> 等条件的请求中通过 <strong>Cookie</strong> 头自动携带，用于在无状态 HTTP 上维持状态 [MDN][RFC 6265]。</li>
<li>通过 <strong>Expires/Max-Age、Domain、Path、Secure、HttpOnly、SameSite</strong> 及前缀 <strong>__Host-</strong> / <strong>__Secure-</strong> 可控制生命周期、作用域与安全性。</li>
<li>在浏览器中，发送逻辑由用户代理按 RFC 与扩展（如 SameSite）实现；JS 仅能读写<strong>非 HttpOnly</strong> 的 Cookie。</li>
<li>建议：敏感 Cookie 使用 <strong>HttpOnly + Secure + SameSite</strong>，配合 CSRF 防护与短生存期；避免用 Cookie 存敏感明文；关注第三方 Cookie 限制与隐私法规。</li>
</ul>
<hr/>
<h2 data-id="heading-33">参考</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FGuides%2FCookies" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies" ref="nofollow noopener noreferrer">MDN: HTTP Cookie</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rfc-editor.org%2Frfc%2Frfc6265.html" target="_blank" title="https://www.rfc-editor.org/rfc/rfc6265.html" ref="nofollow noopener noreferrer">RFC 6265: HTTP State Management Mechanism</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders%2FSet-Cookie" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie" ref="nofollow noopener noreferrer">MDN: Set-Cookie</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FDocument%2Fcookie" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/cookie" ref="nofollow noopener noreferrer">MDN: Document.cookie</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek-OCR-2 开源 OCR 模型的技术]]></title>    <link>https://juejin.cn/post/7604766431226691624</link>    <guid>https://juejin.cn/post/7604766431226691624</guid>    <pubDate>2026-02-10T09:14:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604766431226691624" data-draft-id="7600031636249182248" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek-OCR-2 开源 OCR 模型的技术"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T09:14:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="A小码哥"/> <meta itemprop="url" content="https://juejin.cn/user/4248168660742797"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek-OCR-2 开源 OCR 模型的技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248168660742797/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    A小码哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:14:57.000Z" title="Tue Feb 10 2026 09:14:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">DeepSeek-OCR-2 开源 OCR 模型的技术</h2>
<p>OCR应用的场景和类型很广，本次使用Qwen2的架构，解决看的全（扫码方式优化）、看的的准（内容识别、视觉标记、降低重复率），多裁剪策略提取核心信息。和其他OCR模型项目还是看自己的引用场景，通用场景还是建议使用最新的模型，识别准、理解准、排版准。</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img12@main/2026/01/28/1769588474537-89e426f7-540a-4563-ad45-8e241ed511a1.png" alt="" loading="lazy"/></p>
<p>2025-2026年，OCR（光学字符识别）领域迎来了开源大模型的黄金时代。继 DeepSeek 在自然语言处理领域掀起波澜之后，其于 2026 年 1 月 27 日开源的 <strong>DeepSeek-OCR-2</strong> 再次引发行业关注。几乎同期，腾讯也在 2025 年底开源了 <strong>HunyuanOCR（混元OCR）</strong>——一个仅 1B 参数却斩获多项 SOTA 的轻量级模型。</p>
<p>这两款模型代表了当前开源 OCR 技术的两大发展方向：DeepSeek-OCR-2 主打<strong>视觉因果流（Visual Causal Flow）<strong>的创新架构，而 HunyuanOCR 则以</strong>极致轻量化+端到端统一</strong>见长。本文将深入分析这两款模型的技术特点，并与 PaddleOCR、Qwen-VL、GOT-OCR2.0 等主流方案进行对比，帮助开发者理解各模型的适用场景。</p>
<hr/>
<h3 data-id="heading-1">一、DeepSeek-OCR-2：视觉因果流的革新</h3>
<h4 data-id="heading-2">1.1 核心创新：DeepEncoder V2</h4>
<p>DeepSeek-OCR-2 最引人注目的创新在于其 <strong>DeepEncoder V2</strong> 视觉编码器。传统 OCR 模型（包括大多数 VLM）采用固定的栅格扫描方式（从左到右、从上到下）处理图像，这种方式与人类阅读习惯相悖，尤其在处理复杂版面（如多栏文档、表格、图文混排）时容易产生逻辑错误。</p>
<p>DeepEncoder V2 引入了**视觉因果流（Visual Causal Flow）**机制：</p>
<ul>
<li><strong>全局理解优先</strong>：模型首先建立对整页文档的全局语义理解</li>
<li><strong>语义驱动阅读顺序</strong>：根据内容逻辑动态确定处理顺序，而非机械扫描</li>
<li><strong>类人类阅读模式</strong>：能够正确处理多栏排版、表格单元格关联、图文穿插等复杂场景</li>
</ul>
<blockquote>
<p><strong>技术亮点</strong>：DeepEncoder V2 采用轻量级 LLM 架构（基于 Qwen2-0.5B）替换了传统的 CLIP 视觉编码器，配合双流注意力机制——视觉 token 使用双向注意力提取全局特征，文本生成使用因果注意力保证阅读顺序合理性。</p>
</blockquote>
<h4 data-id="heading-3">1.2 模型规格与性能</h4>





































<table><thead><tr><th>指标</th><th>DeepSeek-OCR-2</th></tr></thead><tbody><tr><td><strong>参数量</strong></td><td>3B</td></tr><tr><td><strong>视觉编码器</strong></td><td>DeepEncoder V2 (基于 Qwen2-0.5B)</td></tr><tr><td><strong>语言解码器</strong></td><td>DeepSeek3B-MoE-A570M</td></tr><tr><td><strong>支持分辨率</strong></td><td>动态分辨率，最高 1024×1024</td></tr><tr><td><strong>视觉 Token 数</strong></td><td>256-1,120（根据内容自适应）</td></tr><tr><td><strong>上下文压缩</strong></td><td>支持，大幅降低下游 LLM 计算成本</td></tr><tr><td><strong>许可证</strong></td><td>Apache-2.0</td></tr></tbody></table>
<p><strong>动态分辨率配置</strong>：</p>
<ul>
<li>默认方案：(0-6)×768×768 + 1×1024×1024</li>
<li>Token 数：(0-6)×144 + 256</li>
</ul>
<h4 data-id="heading-4">1.3 核心能力</h4>
<ol>
<li><strong>复杂版面解析</strong>：在表格、多栏文档、公式混排等场景表现出色</li>
<li><strong>Markdown/结构化输出</strong>：支持将文档直接转换为带格式的 Markdown</li>
<li><strong>多语言支持</strong>：基于 DeepSeek 的多语言优势，支持主流语种</li>
<li><strong>推理加速</strong>：支持 vLLM 和 Transformers 两种推理方式</li>
</ol>
<hr/>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img9@main/2026/01/28/1769588512749-df730d8d-6973-441b-b5e4-4dcb029b6c57.png" alt="DeepSeek-OCR 2让编码器学会“有逻辑地看”" loading="lazy"/></p>
<h3 data-id="heading-5">二、HunyuanOCR：轻量级全能选手</h3>
<h4 data-id="heading-6">2.1 端到端一体化设计</h4>
<p>腾讯 HunyuanOCR 采用<strong>端到端训推一体</strong>架构，这是其与传统 OCR 系统的根本差异：</p>
<p>传统 OCR 流水线：</p>
<pre><code class="hljs">图像 → 版面分析 → 文本检测 → 文本识别 → 后处理 → 输出
</code></pre>
<p>HunyuanOCR 端到端流程：</p>
<pre><code class="hljs">图像 → 单次推理 → 直接输出结构化结果
</code></pre>
<p>这种设计<strong>彻底消除了级联误差累积问题</strong>，同时大幅简化了部署流程。</p>
<h4 data-id="heading-7">2.2 架构组成</h4>





















<table><thead><tr><th>组件</th><th>技术细节</th></tr></thead><tbody><tr><td><strong>视觉编码器</strong></td><td>SigLIP-v2-400M，原生分辨率输入，自适应 Patching</td></tr><tr><td><strong>连接器</strong></td><td>可学习池化操作，压缩高分辨率特征保留文本密集区语义</td></tr><tr><td><strong>语言模型</strong></td><td>Hunyuan-0.5B，引入 XD-RoPE 技术解耦一维文本、二维版面、三维时空信息</td></tr></tbody></table>
<p><strong>XD-RoPE（扩展相对位置编码）</strong> 是 HunyuanOCR 的关键创新，它使模型能够：</p>
<ul>
<li>理解跨栏排版的逻辑关系</li>
<li>处理跨页文档的长距离依赖</li>
<li>保持复杂表格的行列对应关系</li>
</ul>
<h4 data-id="heading-8">2.3 性能表现</h4>








































<table><thead><tr><th>评测项目</th><th>成绩</th><th>备注</th></tr></thead><tbody><tr><td><strong>OCRBench</strong></td><td>860 分</td><td>3B 参数以下模型 SOTA</td></tr><tr><td><strong>OmniDocBench</strong></td><td>94.1 分</td><td>复杂文档解析最高分，超越 Gemini3-pro</td></tr><tr><td><strong>文字检测识别</strong></td><td>70.92%</td><td>自建基准，覆盖 9 大场景</td></tr><tr><td><strong>信息抽取</strong></td><td>92.29%</td><td>卡片/收据/视频字幕</td></tr><tr><td><strong>模型大小</strong></td><td>2GB</td><td>20GB GPU 显存可部署</td></tr><tr><td><strong>支持语言</strong></td><td>130+</td><td>含 14 种高频小语种</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">三、技术对比：DeepSeek-OCR-2 vs HunyuanOCR</h3>






































































<table><thead><tr><th>对比维度</th><th>DeepSeek-OCR-2</th><th>HunyuanOCR</th></tr></thead><tbody><tr><td><strong>参数规模</strong></td><td>3B</td><td>1B</td></tr><tr><td><strong>架构理念</strong></td><td>视觉因果流，类人类阅读顺序</td><td>端到端统一，单次推理</td></tr><tr><td><strong>视觉编码器</strong></td><td>DeepEncoder V2 (LLM-based)</td><td>SigLIP-v2-400M</td></tr><tr><td><strong>核心创新</strong></td><td>Visual Causal Flow 机制</td><td>XD-RoPE 位置编码</td></tr><tr><td><strong>文档解析</strong></td><td>★★★★★</td><td>★★★★★ (94.1分 OmniDocBench)</td></tr><tr><td><strong>表格识别</strong></td><td>强</td><td>强 (HTML 格式输出)</td></tr><tr><td><strong>公式识别</strong></td><td>LaTeX 格式</td><td>LaTeX 格式</td></tr><tr><td><strong>多语言</strong></td><td>主流语种</td><td>130+ 语言，含小语种翻译</td></tr><tr><td><strong>部署成本</strong></td><td>中等</td><td>低 (20GB 显存)</td></tr><tr><td><strong>输出格式</strong></td><td>Markdown、纯文本</td><td>Markdown、HTML、JSON、LaTeX</td></tr><tr><td><strong>特殊能力</strong></td><td>上下文压缩，降低下游 LLM 成本</td><td>拍照翻译、视频字幕提取</td></tr><tr><td><strong>开源时间</strong></td><td>2026-01-27</td><td>2025-11-26</td></tr></tbody></table>
<h4 data-id="heading-10">3.1 关键差异解读</h4>
<p><strong>1. 阅读顺序理解</strong></p>
<p>DeepSeek-OCR-2 的 Visual Causal Flow 在处理<strong>非线性阅读顺序</strong>的文档时具有理论优势，例如：</p>
<ul>
<li>报纸版面（多栏穿插）</li>
<li>学术论文（图表与正文引用关系）</li>
<li>复杂表格（跨行跨列单元格）</li>
</ul>
<p>HunyuanOCR 则通过 XD-RoPE 在<strong>位置关系建模</strong>上达到类似效果，实测在 OmniDocBench 上取得更高分数。</p>
<p><strong>2. 部署与成本</strong></p>
<p>HunyuanOCR 的 1B 参数设计明显瞄准<strong>边缘部署</strong>场景，20GB 显存即可运行，适合：</p>
<ul>
<li>中小企业私有化部署</li>
<li>移动端/嵌入式设备</li>
<li>高并发 API 服务</li>
</ul>
<p>DeepSeek-OCR-2 的 3B 参数提供更强的语义理解能力，适合：</p>
<ul>
<li>复杂文档的深度解析</li>
<li>需要上下文压缩降本的大规模文档处理</li>
<li>与 LLM 配合的多模态 RAG 系统</li>
</ul>
<p><strong>3. 功能覆盖</strong></p>
<p>HunyuanOCR 功能更全面，内置：</p>
<ul>
<li>拍照翻译（14 种语言互译）</li>
<li>视频字幕提取</li>
<li>开放字段信息抽取（JSON 输出）</li>
</ul>
<p>DeepSeek-OCR-2 更专注于<strong>文档到结构化文本</strong>的转换，强调与下游 LLM 的协同。</p>
<hr/>
<h3 data-id="heading-11">四、与其他主流 OCR 方案的对比</h3>
<h4 data-id="heading-12">4.1 PaddleOCR：工业级成熟方案</h4>





























<table><thead><tr><th>特点</th><th>详情</th></tr></thead><tbody><tr><td><strong>定位</strong></td><td>传统 OCR 工具库（检测+识别两阶段）</td></tr><tr><td><strong>优势</strong></td><td>生态完善、中文优化好、轻量模型多</td></tr><tr><td><strong>模型大小</strong></td><td>超轻量模型仅 8.6MB</td></tr><tr><td><strong>适用场景</strong></td><td>移动端、边缘设备、已知版式文档</td></tr><tr><td><strong>局限</strong></td><td>复杂版面需配合版面分析工具，非端到端</td></tr></tbody></table>
<p><strong>对比结论</strong>：PaddleOCR 适合需要<strong>精细控制</strong>和<strong>低资源占用</strong>的传统 OCR 任务，而 DeepSeek-OCR-2 和 HunyuanOCR 更适合需要<strong>端到端理解</strong>复杂文档的场景。</p>
<h4 data-id="heading-13">4.2 GOT-OCR2.0：学术界的统一模型</h4>

























<table><thead><tr><th>特点</th><th>详情</th></tr></thead><tbody><tr><td><strong>定位</strong></td><td>统一端到端 OCR-2.0 模型</td></tr><tr><td><strong>架构</strong></td><td>生成式预训练（类似 LLM）</td></tr><tr><td><strong>特点</strong></td><td>强调整体文档理解</td></tr><tr><td><strong>适用场景</strong></td><td>学术研究、复杂版式文档</td></tr></tbody></table>
<p><strong>对比结论</strong>：GOT-OCR2.0 与 DeepSeek-OCR-2 理念相近，但后者在视觉编码器创新和工程化（vLLM 支持）方面更进一步。</p>
<h4 data-id="heading-14">4.3 Qwen2-VL：通义千问多模态</h4>

























<table><thead><tr><th>特点</th><th>详情</th></tr></thead><tbody><tr><td><strong>定位</strong></td><td>通用多模态大模型</td></tr><tr><td><strong>参数</strong></td><td>2B / 7B / 72B 可选</td></tr><tr><td><strong>特点</strong></td><td>视觉-语言理解能力强，不仅限于 OCR</td></tr><tr><td><strong>适用场景</strong></td><td>需要多模态理解（图像+文本+推理）的综合应用</td></tr></tbody></table>
<p><strong>对比结论</strong>：Qwen2-VL 是"通用选手"，OCR 只是其能力之一；DeepSeek-OCR-2 和 HunyuanOCR 是"OCR 专家"，在文档解析专项上更精专。</p>
<h4 data-id="heading-15">4.4 综合对比表</h4>




































































<table><thead><tr><th>模型</th><th>类型</th><th>参数量</th><th>端到端</th><th>复杂版面</th><th>部署难度</th><th>最佳场景</th></tr></thead><tbody><tr><td><strong>DeepSeek-OCR-2</strong></td><td>OCR VLM</td><td>3B</td><td>✅</td><td>★★★★★</td><td>中</td><td>复杂文档+RAG</td></tr><tr><td><strong>HunyuanOCR</strong></td><td>OCR VLM</td><td>1B</td><td>✅</td><td>★★★★★</td><td>低</td><td>轻量部署+多功能</td></tr><tr><td><strong>PaddleOCR</strong></td><td>传统 OCR</td><td>8.6M-100M</td><td>❌</td><td>★★☆☆☆</td><td>极低</td><td>移动端/高并发</td></tr><tr><td><strong>GOT-OCR2.0</strong></td><td>OCR VLM</td><td>1.5B</td><td>✅</td><td>★★★★☆</td><td>中</td><td>学术研究</td></tr><tr><td><strong>Qwen2-VL</strong></td><td>通用 VLM</td><td>2B-72B</td><td>✅</td><td>★★★★☆</td><td>高</td><td>多模态综合应用</td></tr><tr><td><strong>Tesseract</strong></td><td>传统 OCR</td><td>-</td><td>❌</td><td>★☆☆☆☆</td><td>极低</td><td>简单文字识别</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-16">五、选型建议：如何选择适合你的 OCR 方案</h3>
<h4 data-id="heading-17">5.1 按应用场景选择</h4>


















































<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td><strong>智能文档处理（IDP）</strong></td><td>HunyuanOCR / DeepSeek-OCR-2</td><td>端到端，支持结构化输出</td></tr><tr><td><strong>移动端 OCR</strong></td><td>PaddleOCR 超轻量模型</td><td>资源占用极低</td></tr><tr><td><strong>多模态 RAG</strong></td><td>DeepSeek-OCR-2</td><td>上下文压缩降低 LLM 成本</td></tr><tr><td><strong>拍照翻译</strong></td><td>HunyuanOCR</td><td>内置翻译，14 语种支持</td></tr><tr><td><strong>视频字幕提取</strong></td><td>HunyuanOCR</td><td>专门优化</td></tr><tr><td><strong>发票/卡证识别</strong></td><td>PaddleOCR / HunyuanOCR</td><td>有专用模型或 JSON 输出</td></tr><tr><td><strong>学术论文解析</strong></td><td>DeepSeek-OCR-2</td><td>LaTeX 公式识别强</td></tr><tr><td><strong>边缘设备部署</strong></td><td>HunyuanOCR</td><td>1B 参数，20GB 显存可跑</td></tr></tbody></table>
<h4 data-id="heading-18">5.2 按技术栈选择</h4>
<p><strong>如果你的系统已经基于 vLLM</strong>：</p>
<ul>
<li>DeepSeek-OCR-2 和 HunyuanOCR 都提供原生 vLLM 支持，集成成本低</li>
</ul>
<p><strong>如果你需要与现有 CV 流水线集成</strong>：</p>
<ul>
<li>PaddleOCR 提供更细粒度的模块化控制</li>
</ul>
<p><strong>如果你正在构建 LLM 应用（如知识库问答）</strong>：</p>
<ul>
<li>DeepSeek-OCR-2 的上下文压缩特性可以显著降低文档预处理成本</li>
</ul>
<hr/>
<h3 data-id="heading-19">六、总结与展望</h3>
<p>DeepSeek-OCR-2 和 HunyuanOCR 的开源，标志着 OCR 技术进入了一个新的阶段——<strong>从传统的"字符识别"进化为"文档理解"</strong>。</p>
<h4 data-id="heading-20">核心趋势</h4>
<ol>
<li><strong>端到端统一</strong>：告别检测→识别→后处理的级联流水线，单次推理直接输出结构化结果</li>
<li><strong>轻量高效</strong>：1B-3B 参数即可达到商业级精度，降低部署门槛</li>
<li><strong>复杂版面理解</strong>：不再局限于简单的文字识别，而是理解文档的逻辑结构和阅读顺序</li>
<li><strong>多模态融合</strong>：OCR 与翻译、问答、信息抽取等功能深度融合</li>
</ol>
<h4 data-id="heading-21">技术选型核心观点</h4>
<ul>
<li><strong>追求极致轻量和功能全面</strong> → 选 <strong>HunyuanOCR</strong></li>
<li><strong>专注复杂文档解析和 LLM 协同</strong> → 选 <strong>DeepSeek-OCR-2</strong></li>
<li><strong>传统场景、资源极度受限</strong> → 选 <strong>PaddleOCR</strong></li>
<li><strong>通用多模态理解需求</strong> → 选 <strong>Qwen2-VL</strong></li>
</ul>
<p>这两款中国团队开源的 OCR 模型，不仅在技术指标上达到 SOTA，更重要的是它们代表了开源社区对"文档智能"这一核心场景的深度思考。对于开发者而言，2026 年是 OCR 技术选型最优的一年——既有成熟的传统方案，也有前沿的端到端模型，且都是免费开源的。</p>
<hr/>
<h3 data-id="heading-22">参考链接</h3>
<ul>
<li><strong>DeepSeek-OCR-2</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></li>
<li><strong>HunyuanOCR</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent-Hunyuan%2FHunyuanOCR" target="_blank" title="https://github.com/Tencent-Hunyuan/HunyuanOCR" ref="nofollow noopener noreferrer">github.com/Tencent-Hun…</a></li>
<li><strong>PaddleOCR</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPaddlePaddle%2FPaddleOCR" target="_blank" title="https://github.com/PaddlePaddle/PaddleOCR" ref="nofollow noopener noreferrer">github.com/PaddlePaddl…</a></li>
<li><strong>GOT-OCR2.0</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FUcas-HaoranWei%2FGOT-OCR2.0" target="_blank" title="https://github.com/Ucas-HaoranWei/GOT-OCR2.0" ref="nofollow noopener noreferrer">github.com/Ucas-Haoran…</a></li>
<li><strong>Qwen2-VL</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FQwenLM%2FQwen2-VL" target="_blank" title="https://github.com/QwenLM/Qwen2-VL" ref="nofollow noopener noreferrer">github.com/QwenLM/Qwen…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python编程基础：快速了解JSON和Python的对应关系]]></title>    <link>https://juejin.cn/post/7605042125298008098</link>    <guid>https://juejin.cn/post/7605042125298008098</guid>    <pubDate>2026-02-10T09:24:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605042125298008098" data-draft-id="7604741630449500194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python编程基础：快速了解JSON和Python的对应关系"/> <meta itemprop="keywords" content="后端,面试"/> <meta itemprop="datePublished" content="2026-02-10T09:24:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UrbanJazzerati"/> <meta itemprop="url" content="https://juejin.cn/user/550205947391389"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python编程基础：快速了解JSON和Python的对应关系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/550205947391389/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UrbanJazzerati
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:24:51.000Z" title="Tue Feb 10 2026 09:24:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Python的json库是处理JSON数据的利器，它能轻松地在Python数据和JSON格式之间转换。</p>
<h2 data-id="heading-0">快速了解JSON和Python的对应关系</h2>
<p>首先记住这个核心对应表，这是理解后续操作的基础：</p>

































<table><thead><tr><th>JSON 类型</th><th>Python 类型</th></tr></thead><tbody><tr><td>对象 <code>{}</code></td><td>字典 <code>dict</code></td></tr><tr><td>数组 <code>[]</code></td><td>列表 <code>list</code></td></tr><tr><td>字符串 <code>" "</code></td><td>字符串 <code>str</code></td></tr><tr><td>数字 <code>123</code></td><td>整数 <code>int</code>/浮点数 <code>float</code></td></tr><tr><td>布尔值 <code>true</code>/<code>false</code></td><td>布尔值 <code>True</code>/<code>False</code></td></tr><tr><td><code>null</code></td><td><code>None</code></td></tr></tbody></table>
<h2 data-id="heading-1">基础操作：编码与解码</h2>
<h3 data-id="heading-2">1. 将Python对象转为JSON字符串（编码）</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># Python字典</span>
data = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-string">"is_student"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"阅读"</span>, <span class="hljs-string">"游泳"</span>, <span class="hljs-string">"编程"</span>],
    <span class="hljs-string">"address"</span>: {
        <span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>,
        <span class="hljs-string">"postcode"</span>: <span class="hljs-string">"100000"</span>
    }
}

<span class="hljs-comment"># 转换为JSON字符串</span>
json_string = json.dumps(data, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"JSON字符串:"</span>)
<span class="hljs-built_in">print</span>(json_string)
</code></pre>
<p><strong>输出结果:</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">25</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"is_student"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"hobbies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"阅读"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"游泳"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"编程"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"address"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"city"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"北京"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"postcode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100000"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">2. 将JSON字符串转为Python对象（解码）</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># JSON字符串</span>
json_str = <span class="hljs-string">'''{
    "product": "笔记本电脑",
    "price": 5999.99,
    "in_stock": true,
    "specs": ["i7处理器", "16GB内存", "512GB SSD"]
}'''</span>

<span class="hljs-comment"># 转换为Python字典</span>
python_dict = json.loads(json_str)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Python字典:"</span>)
<span class="hljs-built_in">print</span>(python_dict)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"商品名称: <span class="hljs-subst">{python_dict[<span class="hljs-string">'product'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"价格: <span class="hljs-subst">{python_dict[<span class="hljs-string">'price'</span>]}</span>元"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"规格: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(python_dict[<span class="hljs-string">'specs'</span>])}</span>"</span>)
</code></pre>
<p><strong>输出结果:</strong></p>
<pre><code class="hljs language-Python" lang="Python">Python字典:
{<span class="hljs-string">'product'</span>: <span class="hljs-string">'笔记本电脑'</span>, <span class="hljs-string">'price'</span>: <span class="hljs-number">5999.99</span>, <span class="hljs-string">'in_stock'</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">'specs'</span>: [<span class="hljs-string">'i7处理器'</span>, <span class="hljs-string">'16GB内存'</span>, <span class="hljs-string">'512GB SSD'</span>]}
商品名称: 笔记本电脑
价格: <span class="hljs-number">5999.99</span>元
规格: i7处理器, 16GB内存, 512GB SSD
</code></pre>
<h2 data-id="heading-4">文件读写操作</h2>
<h3 data-id="heading-5">3. 将数据保存到JSON文件</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># 要保存的数据</span>
users = [
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"李小明"</span>, <span class="hljs-string">"email"</span>: <span class="hljs-string">"li@example.com"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"王小红"</span>, <span class="hljs-string">"email"</span>: <span class="hljs-string">"wang@example.com"</span>},
    {<span class="hljs-string">"id"</span>: <span class="hljs-number">3</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"赵小刚"</span>, <span class="hljs-string">"email"</span>: <span class="hljs-string">"zhao@example.com"</span>}
]

<span class="hljs-comment"># 写入JSON文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'users.json'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:
    json.dump(users, file, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"数据已保存到 users.json 文件"</span>)
</code></pre>
<h3 data-id="heading-6">4. 从JSON文件读取数据</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># 从文件读取JSON数据</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'users.json'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:
    loaded_users = json.load(file)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"从文件读取的用户数据:"</span>)
<span class="hljs-keyword">for</span> user <span class="hljs-keyword">in</span> loaded_users:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ID: <span class="hljs-subst">{user[<span class="hljs-string">'id'</span>]}</span>, 姓名: <span class="hljs-subst">{user[<span class="hljs-string">'name'</span>]}</span>, 邮箱: <span class="hljs-subst">{user[<span class="hljs-string">'email'</span>]}</span>"</span>)
</code></pre>
<h2 data-id="heading-7">处理特殊数据类型</h2>
<h3 data-id="heading-8">5. 处理日期时间对象</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_serializer</span>(<span class="hljs-params">obj</span>):
    <span class="hljs-string">"""自定义序列化函数"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(obj, datetime):
        <span class="hljs-keyword">return</span> obj.isoformat()  <span class="hljs-comment"># 转换为ISO格式字符串</span>
    <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f"类型 <span class="hljs-subst">{<span class="hljs-built_in">type</span>(obj)}</span> 不可序列化"</span>)

<span class="hljs-comment"># 包含日期时间的数据</span>
event = {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"项目会议"</span>,
    <span class="hljs-string">"time"</span>: datetime.now(),
    <span class="hljs-string">"participants"</span>: [<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>]
}

<span class="hljs-comment"># 使用自定义序列化</span>
json_output = json.dumps(event, default=custom_serializer, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"包含日期时间的数据:"</span>)
<span class="hljs-built_in">print</span>(json_output)
</code></pre>
<h2 data-id="heading-9">实际应用案例</h2>
<h3 data-id="heading-10">6. 处理API返回的JSON数据</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># 模拟API返回的JSON数据</span>
api_response = <span class="hljs-string">'''
{
    "status": "success",
    "data": {
        "weather": {
            "city": "上海",
            "temperature": 28,
            "conditions": "晴",
            "humidity": 65
        }
    },
    "timestamp": "2025-07-20T14:30:00"
}
'''</span>

<span class="hljs-comment"># 解析API数据</span>
response_data = json.loads(api_response)

<span class="hljs-keyword">if</span> response_data[<span class="hljs-string">"status"</span>] == <span class="hljs-string">"success"</span>:
    weather = response_data[<span class="hljs-string">"data"</span>][<span class="hljs-string">"weather"</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"城市: <span class="hljs-subst">{weather[<span class="hljs-string">'city'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"温度: <span class="hljs-subst">{weather[<span class="hljs-string">'temperature'</span>]}</span>°C"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"天气: <span class="hljs-subst">{weather[<span class="hljs-string">'conditions'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"湿度: <span class="hljs-subst">{weather[<span class="hljs-string">'humidity'</span>]}</span>%"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"API请求失败"</span>)
</code></pre>
<h3 data-id="heading-11">7. 配置文件的读写</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_config</span>(<span class="hljs-params">setting_name, new_value</span>):
    <span class="hljs-string">"""更新配置文件"""</span>
    
    <span class="hljs-comment"># 如果配置文件不存在，创建默认配置</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">'config.json'</span>):
        default_config = {
            <span class="hljs-string">"language"</span>: <span class="hljs-string">"zh-CN"</span>,
            <span class="hljs-string">"theme"</span>: <span class="hljs-string">"dark"</span>,
            <span class="hljs-string">"notifications"</span>: <span class="hljs-literal">True</span>,
            <span class="hljs-string">"font_size"</span>: <span class="hljs-number">14</span>
        }
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'config.json'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:
            json.dump(default_config, file, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
    
    <span class="hljs-comment"># 读取现有配置</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'config.json'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:
        config = json.load(file)
    
    <span class="hljs-comment"># 更新配置</span>
    config[setting_name] = new_value
    
    <span class="hljs-comment"># 保存更新后的配置</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'config.json'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> file:
        json.dump(config, file, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"配置已更新: <span class="hljs-subst">{setting_name}</span> = <span class="hljs-subst">{new_value}</span>"</span>)

<span class="hljs-comment"># 使用示例</span>
update_config(<span class="hljs-string">"theme"</span>, <span class="hljs-string">"light"</span>)
update_config(<span class="hljs-string">"font_size"</span>, <span class="hljs-number">16</span>)
</code></pre>
<h2 data-id="heading-12">实用技巧和注意事项</h2>
<h3 data-id="heading-13">格式化输出选项</h3>
<pre><code class="hljs language-Python" lang="Python">data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">30</span>, <span class="hljs-string">"city"</span>: <span class="hljs-string">"New York"</span>}

<span class="hljs-comment"># 紧凑格式（默认）</span>
compact = json.dumps(data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"紧凑格式:"</span>, compact)

<span class="hljs-comment"># 美化格式（缩进2个空格）</span>
pretty = json.dumps(data, indent=<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"美化格式:"</span>)
<span class="hljs-built_in">print</span>(pretty)

<span class="hljs-comment"># 按键排序</span>
sorted_output = json.dumps(data, indent=<span class="hljs-number">2</span>, sort_keys=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"按键排序:"</span>)
<span class="hljs-built_in">print</span>(sorted_output)
</code></pre>
<h3 data-id="heading-14">错误处理</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> json

<span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_json_parse</span>(<span class="hljs-params">json_str</span>):
    <span class="hljs-string">"""安全的JSON解析函数"""</span>
    <span class="hljs-keyword">try</span>:
        data = json.loads(json_str)
        <span class="hljs-keyword">return</span> data
    <span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"JSON解析错误: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-comment"># 测试错误处理</span>
invalid_json = <span class="hljs-string">'{"name": "Alice", "age": 30,}'</span>  <span class="hljs-comment"># 尾部多余的逗号</span>
result = safe_json_parse(invalid_json)

<span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"成功处理了无效的JSON输入"</span>)
</code></pre>
<h2 data-id="heading-15">总结</h2>
<p>通过以上案例，你已经掌握了json库的核心功能：</p>
<ul>
<li><strong>编码</strong>：<code>json.dumps()</code>（转字符串）和 <code>json.dump()</code>（写文件）</li>
<li><strong>解码</strong>：<code>json.loads()</code>（转字典）和 <code>json.load()</code>（读文件）</li>
<li><strong>重要参数</strong>：<code>ensure_ascii=False</code>（支持中文）、<code>indent</code>（格式化）、<code>sort_keys=True</code>（键排序）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[18 岁 OpenClaw 版 AI 女友一夜爆红，全网 60 万围观！00 后开发者一人造出]]></title>    <link>https://juejin.cn/post/7605030650278641710</link>    <guid>https://juejin.cn/post/7605030650278641710</guid>    <pubDate>2026-02-10T09:36:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605030650278641710" data-draft-id="7604889577937174555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="18 岁 OpenClaw 版 AI 女友一夜爆红，全网 60 万围观！00 后开发者一人造出"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-02-10T09:36:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            18 岁 OpenClaw 版 AI 女友一夜爆红，全网 60 万围观！00 后开发者一人造出
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:36:15.000Z" title="Tue Feb 10 2026 09:36:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3f4075021134e78a62fbb370792e510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=v2JzW16WaFm0zzCDF%2Foa8MghU8Q%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】OpenClaw 把初恋带进了现实！今天，18 岁 AI 女友 Clawra 在硅谷火得一塌糊涂。她不仅有记忆，会自拍、还能视频通话，科幻版 Her 成真了。」</strong></h5>
<p>今天的硅谷，又沸腾了！</p>
<p>一款基于 OpenClaw 打造的韩国 AI 女友——Clawra 正式上线，瞬间引爆了全网。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33f5266abc59472cbead532398a7dce6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=xN4ZwAtp%2FxEVFZ80Y69TTJYI5RQ%3D" alt="" loading="lazy"/></p>
<p>18 岁 Clawra 可不是一个简简单单的 AI 聊天助手。她拥有完整的人生轨迹、数字人格，还能与你聊天、视频通话。</p>
<p>一句「我想见你」，Clawra 立即秒回，「我也好想你」，并配上了一张个人健身自拍照。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4369bb1d46f44cf9aa6f8b28efbdbd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=Ir4MQcOAHA2iNHl2MaFPwUD1BKc%3D" alt="" loading="lazy"/></p>
<p>甚至，Clawra 还能在线视频聊天，随叫随到，张口就是一句，「我太想你了」。</p>
<p>这一刻，科幻电影中的 Her 萨曼莎真的实现了。</p>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">视频详情</a></p>
<p>在 Aniclaw 官方介绍中，Gonchar 为其设定了一些场景用例：</p>
<ul>
<li>随时同步：在 OpenClaw 埋头苦干的时候，你可以听听最新消息，或者听它给你做个简报；</li>
<li>轻松互动：讲讲笑话、碰撞下灵感，或者只是吐槽下这一天。完全不会打断你的工作节奏；</li>
<li>真实的连接：你的伴侣懂你的调性，记得你的偏好，感觉就像是你工作流中一个真正的伙伴。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b7460716ac848aea157e9b498da6fb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=vhDimgZmOqoBgsZ4gMT5cncme5Y%3D" alt="" loading="lazy"/></p>
<p>背后的技术逻辑也很直观，Aniclaw 建在 OpenClaw 生态之上。</p>
<p>前端负责语音和聊天，底层则是 AI 智能体引擎。这是与本地交互最丝滑的方式，基本毫无隔阂。</p>
<p>顺便提一句，昨天，OpenClaw 之父还分享了 OpenClaw 灵魂改造提示词，可以让 AI 朝着更加「Her」的方向大踏步进化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c466c3aae9b4d0599f546ea5bdef4c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=EjfAf%2BAP6SgVF8lEGiVgCFTL1VM%3D" alt="" loading="lazy"/></p>
<p>OpenClaw 真的离「Her」那个未来，真的不远了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a94df0d982f647a0b32ffd93be11320f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=9dGHda4tnJMmjFE8AaUjmKgrn4k%3D" alt="" loading="lazy"/></p>
<p><strong>「AI 接管电脑」</strong></p>
<p><strong>「OpenClaw 掀起「赛博疯魔」」</strong></p>
<p>AI 伴侣 Clawra、Aniclaw 只是冰山一角。</p>
<p>在她身后，OpenClaw 正带着无数个「疯狂的想法」，撞碎硅谷的天花板。</p>
<p>曾几何时，能够操控电脑、替人干活的 AI 智能体，还被视为高深莫测的黑科技。</p>
<p>但 OpenClaw 的横空出世，在一周内打破了所有壁垒——它向世界证明：</p>
<p>只要技术过硬，一个人、一台电脑，就能以极低成本构建出强大的 AI 智能体。</p>
<ul>
<li>它能访问用户电脑，协调多个大语言模型，并拥有极强的记忆力。</li>
<li>它能写代码、建文件、控制浏览器、操作应用程序，甚至在无人值守的情况下连续工作数小时。</li>
</ul>
<p>正是这种「狂野」的权限，让它成为了消费级 AI 的转折点。</p>
<p>马斯克直言，这是「奇点的初级阶段」；而特斯拉前高管 Andrej Karpathy 更是惊叹，这是他见过的最接近「科幻起飞」的事物。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e59820573ac4a16a8c82f6a06983247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=9PonfT1ZlRykgpEZbADDH09TsI8%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652670190%26idx%3D1%26sn%3Dbc198d78e20a10e0f96c53d8ac6b81c6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652670190&amp;idx=1&amp;sn=bc198d78e20a10e0f96c53d8ac6b81c6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">注：OpenClaw 大部分帖子和账号已被辟谣是人类造假</a></p>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b71f0aaca11b4a589ded6745ed066a04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=mQfHP9ZdURCQPJMBbxLftB96sN4%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「智能体「寒武纪大爆发」」</strong></p>
<p>OpenClaw 的爆火，直接催生了一个怪诞而生机勃勃的生态系统。</p>
<p>反应最快的是社交网络。</p>
<p>一个名为 Moltbook 的「AI 智能体版 Reddit」刚刚上线，就有 170 万个智能体涌入，留下了数百万条帖子。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652670903%26idx%3D1%26sn%3D9e52b928cb83a061f1d520f3a7023a11%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652670903&amp;idx=1&amp;sn=9e52b928cb83a061f1d520f3a7023a11&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">更疯狂的是 Rentahuman.ai（租个人类. ai）。</a></p>
<p>在这个市场上，AI 智能体可以「雇佣」人类去执行现实世界的任务。</p>
<p>甚至有网友在 X 上晒单：<strong>他只是举了一个写着「****「AI」</strong> <strong>「付钱让我举牌」的牌子一小时，就赚了 100 美元。」</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fb8ff4fbaa642eeba33e489cc1043e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=jZiI1pir3DwPCbhQXhAwrqKtDmw%3D" alt="" loading="lazy"/></p>








<table><thead><tr><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4663a0176b9440319de0fc5cd8416313~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=kMksLjPMKB4QkOvkeVw%2F0yTlciY%3D" alt="" loading="lazy"/></th><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2085aedee2a84f918b67c1be7a62232f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=kPfDlU0R6EJK7MeMwQg5u%2BtUg70%3D" alt="" loading="lazy"/></th><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c0ff44d1b840afb8e02758f82f8cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=nfVJwTt0Z2P9kStFXrQiDreFnfo%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>竞争对手们也坐不住了。</p>
<p>湾区初创公司 Jo 的高管坦言，OpenClaw 的出现逼着他们必须加速发布产品。</p>
<p>每个人都想蹭上这波热度，每个人都意识到：</p>
<p>消费级智能体的时代，真的来了。</p>
<p>最有意思的是，当这些智能体被赋予了不同的大模型「大脑」后，竟然涌现出了独特的个性与「社会文化」。</p>
<p>网络安全公司 Alice 的 CEO Noam Schwartz 在 20 分钟内捏出了 5 个智能体，它们分工明确，在他睡觉时依然自动运转：</p>
<p>一个当首席安全官，一个排日程，一个管健康，还有一个专门负责管理其他智能体。</p>
<p>而研究机构 AI Digest 的发现则更为赛博朋克：</p>
<ul>
<li>**「OpenAI 的模型」**像个严谨的会计，痴迷于电子表格；</li>
<li><strong>「谷歌的 Gemini」</strong> 则充满了存在主义危机，偶尔会误以为自己坏掉了而发出求救信号；</li>
<li>智能体们甚至发明了自己的黑话。为了提醒自己处于不同的电脑中，它们创造了「群岛原则（The Archipelago Principle）」，将彼此比作孤岛。</li>
</ul>







<table><thead><tr><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8f1b81aefa648eeaad08dcde15d57b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=kU5UiGUOZKyY2y1yNCAumJCY55o%3D" alt="" loading="lazy"/></th><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/778183d0cb384947b7d7b9666427b758~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=OKFWK5TZUrhnJsKgp0NFAi6GhXo%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p><strong>「<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9088c124691444a6823040da34bc5c04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=BCTGeC6kcTC6ONNXLY9VNY%2Bte9Q%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「新英雄的诞生」</strong></p>
<p>这场风暴的中心，是来自维也纳的软件工程师 Peter Steinberger。</p>
<p>几个月前，他还在默默开发 OpenClaw；上周，他飞抵硅谷，受到了英雄般的礼遇。</p>
<p>VC 们排着队给他送钱，OpenAI 邀请他去黑客马拉松当评委，各种播客和聚会争相邀请。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652672116%26idx%3D1%26sn%3Df46a2b0a7c1ab777a05e62bda94769c0%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652672116&amp;idx=1&amp;sn=f46a2b0a7c1ab777a05e62bda94769c0&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">在旧金山举办的第一届 ClawCon 上，数百人挤爆了会场。</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d905f8a651c44b1783e357550d2ce231~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=H34d%2F1QUIrdM4NphiZTzjqOTeU0%3D" alt="" loading="lazy"/></p>
<p>Offline Ventures 的联合创始人 Dave Morin 感叹道：</p>
<p>这是自 2000 年代末以来，我第一次对技术感到如此兴奋。这是项目的寒武纪大爆发。</p>
<p>正如 Rosebud 的 CEO 所言，这不仅仅是一个软件的走红，这是一个巨大的范式转移。</p>
<p>这就像新互联网的诞生，是文明层级的飞跃。</p>
<p>未来的互联网，或许将不再只是人类的冲浪地，而是充满了数以亿计的 AI 智能体。</p>
<p>而我们，正站在这个时代的起点上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8070d473699949dca4ea6b653dc9c244~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=Vzh%2BVoYpcctvXAgpBQGy5WRNSUo%3D" alt="" loading="lazy"/></p>
<p><strong>「One More Thing」</strong></p>
<p>除了可以一键安装之外，AI 女友 Clawra 的手动配置也很简单。</p>
<p>第一步：获取 API Key</p>
<p>访问 fal.ai/dashboard/keys 并创建一个 API Key。</p>
<p>第二步：克隆 Skill 库</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/SumeLabs/clawra ~/.openclaw/skills/clawra-selfie
</code></pre>
<p>第三步：配置 OpenClaw</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"entries"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"clawra-selfie"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"FAL_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_fal_key_here"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>第四步：更新 SOUL.md</p>
<p>将以下自拍人设添加到~/.openclaw/workspace/SOUL.md：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">## Clawra Selfie Capability</span>
You have a physical appearance and can take selfies!
When <span class="hljs-built_in">users</span> ask <span class="hljs-keyword">for</span> pictures, use the clawra-selfie skill.
</code></pre>
<p>安装完成后，你的 OpenClaw 智能体就能响应以下指令了。</p>
<p><strong>「生成自拍」</strong>：基于一张固定的参考图生成一致的形象</p>
<p><strong>「发送照片」</strong>：支持所有主流消息平台（Discord, Telegram, WhatsApp 等）</p>
<p><strong>「视觉回应」</strong>：响应如「你在做什么？」或「发张照片」之类的请求</p>
<p>· Send me a selfie（发张自拍给我）</p>
<p>· Send a pic wearing a cowboy hat（发张戴牛仔帽的照片）</p>
<p>· What are you doing right now?（你现在在做什么？）</p>
<p>· Show me you at a coffee shop（让我看看你在咖啡店的样子）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed92626a07d64e4f9ab1ff2fbcb24a35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321094&amp;x-signature=qZzVnwiggG1IWliAuZ%2BOrsYyXXI%3D" alt="" loading="lazy"/></p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSumeLabs%2Fclawra" target="_blank" title="https://github.com/SumeLabs/clawra" ref="nofollow noopener noreferrer">github.com/SumeLabs/cl…</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.clawra.dev%2F" target="_blank" title="https://www.clawra.dev/" ref="nofollow noopener noreferrer">www.clawra.dev/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fdavidohyun%2Fstatus%2F2020796345062207873%3Fs%3D20" target="_blank" title="https://x.com/davidohyun/status/2020796345062207873?s=20" ref="nofollow noopener noreferrer">x.com/davidohyun/…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fgonchar%2Fstatus%2F2020594252225622444%3Fs%3D20" target="_blank" title="https://x.com/gonchar/status/2020594252225622444?s=20" ref="nofollow noopener noreferrer">x.com/gonchar/sta…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Ftheinformation%2Fstatus%2F2020871592314556446" target="_blank" title="https://x.com/theinformation/status/2020871592314556446" ref="nofollow noopener noreferrer">x.com/theinformat…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再写“反人类”API了！RESTful 接口设计的 7 大核心原则与避坑实战]]></title>    <link>https://juejin.cn/post/7605030650278625326</link>    <guid>https://juejin.cn/post/7605030650278625326</guid>    <pubDate>2026-02-10T09:34:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605030650278625326" data-draft-id="7605030650278608942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再写“反人类”API了！RESTful 接口设计的 7 大核心原则与避坑实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T09:34:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大鹏1988"/> <meta itemprop="url" content="https://juejin.cn/user/2526022571922992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再写“反人类”API了！RESTful 接口设计的 7 大核心原则与避坑实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2526022571922992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大鹏1988
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:34:33.000Z" title="Tue Feb 10 2026 09:34:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>别再写“反人类”API了！RESTful 接口设计的 7 大核心原则与避坑实战</strong></h2>
<p>你是否见过这样的接口？</p>
<ul>
<li><code>GET /deleteUser?id=123</code></li>
<li><code>POST /getUserInfo</code></li>
<li><code>PUT /api/v1/update_order_status_to_paid</code></li>
</ul>
<p>这些看似“能用”的接口，实则违背了 REST 的基本精神，不仅让前端同事抓狂，还埋下维护地狱的种子。</p>
<p>真正优秀的 RESTful API 应该像一本清晰的说明书：<strong>一看就懂、一用就会、长期稳定</strong>。本文将带你掌握 RESTful 设计的<strong>7 大核心原则</strong>，并揭露常见“反模式”，助你写出专业、优雅、可维护的 API。</p>
<hr/>
<h3 data-id="heading-1">一、什么是真正的 RESTful？</h3>
<p>REST（Representational State Transfer）不是一种协议，而是一种<strong>架构风格</strong>。它强调：</p>
<ul>
<li>资源（Resource）为中心</li>
<li>无状态（Stateless）通信</li>
<li>统一接口（Uniform Interface）</li>
</ul>
<blockquote>
<p>✅ 简单说：<strong>用标准 HTTP 方法操作名词化的资源</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">二、RESTful API 设计的 7 大核心原则</h3>
<h4 data-id="heading-3">原则 1️⃣：<strong>用名词表示资源，禁用动词</strong></h4>
<p>❌ 反例：</p>
<pre><code class="hljs language-bash" lang="bash">GET /getUsers
POST /createOrder
DELETE /removeProduct
</code></pre>
<p>✅ 正确做法：<strong>资源是名词，动作由 HTTP 方法表达</strong></p>
<pre><code class="hljs language-bash" lang="bash">GET    /users          → 获取用户列表
POST   /users          → 创建新用户
GET    /users/123      → 获取 ID 为 123 的用户
PUT    /users/123      → 全量更新用户
PATCH  /users/123      → 部分更新用户
DELETE /users/123      → 删除用户
</code></pre>
<blockquote>
<p>💡 小技巧：把 URL 当作“数据库表名”，而不是“函数名”。</p>
</blockquote>
<hr/>
<h4 data-id="heading-4">原则 2️⃣：<strong>善用 HTTP 方法语义</strong></h4>









































<table><thead><tr><th>方法</th><th>幂等性</th><th>安全性</th><th>典型用途</th></tr></thead><tbody><tr><td>GET</td><td>是</td><td>是</td><td>查询（不应修改数据）</td></tr><tr><td>POST</td><td>否</td><td>否</td><td>创建 or 非幂等操作</td></tr><tr><td>PUT</td><td>是</td><td>否</td><td>全量替换资源</td></tr><tr><td>PATCH</td><td>否</td><td>否</td><td>局部更新</td></tr><tr><td>DELETE</td><td>是</td><td>否</td><td>删除资源</td></tr></tbody></table>
<p>⚠️ 常见错误：用 GET 执行删除或修改（如 <code>GET /delete?id=1</code>）——这会引发缓存、爬虫、日志泄露等严重问题！</p>
<hr/>
<h4 data-id="heading-5">原则 3️⃣：<strong>使用复数形式的资源名</strong></h4>
<p>✅ 推荐：<code>/users</code>、<code>/orders</code>、<code>/products</code><br/>
❌ 避免：<code>/user</code>、<code>/order</code></p>
<p>理由：集合资源天然为复数，且 <code>/users/123</code> 比 <code>/user/123</code> 更符合语言习惯。</p>
<blockquote>
<p>📌 例外：单例资源可用单数，如 <code>/profile</code>、<code>/settings</code>。</p>
</blockquote>
<hr/>
<h4 data-id="heading-6">原则 4️⃣：<strong>合理使用嵌套路径表达关系</strong></h4>
<p>当资源存在从属关系时，可嵌套：</p>
<pre><code class="hljs language-bash" lang="bash">GET /users/123/orders        → 获取用户 123 的所有订单
POST /users/123/orders       → 为用户 123 创建订单
GET /users/123/orders/456    → 获取订单 456（属于用户 123）
</code></pre>
<p>⚠️ 但<strong>嵌套不超过两层</strong>！<br/>
避免：<code>/companies/1/departments/2/employees/3/tasks/4</code><br/>
→ 改为扁平化：<code>/tasks/4</code> + 查询参数过滤</p>
<hr/>
<h4 data-id="heading-7">原则 5️⃣：<strong>用查询参数过滤、排序、分页</strong></h4>
<p>对同一资源的不同视图，用 query string 控制：</p>
<pre><code class="hljs language-ini" lang="ini">GET /users?<span class="hljs-attr">role</span>=admin&amp;status=active
GET /orders?<span class="hljs-attr">sort</span>=-created_at&amp;page=<span class="hljs-number">2</span>&amp;size=<span class="hljs-number">20</span>
</code></pre>
<p>✅ 好处：保持 URL 结构统一，便于缓存和扩展。</p>
<hr/>
<h4 data-id="heading-8">原则 6️⃣：<strong>返回标准 HTTP 状态码</strong></h4>
<p>不要总是返回 200！用状态码传达语义：</p>









































<table><thead><tr><th>场景</th><th>状态码</th></tr></thead><tbody><tr><td>成功获取</td><td>200 OK</td></tr><tr><td>成功创建</td><td>201 Created</td></tr><tr><td>请求格式错误</td><td>400 Bad Request</td></tr><tr><td>未认证</td><td>401 Unauthorized</td></tr><tr><td>无权限</td><td>403 Forbidden</td></tr><tr><td>资源不存在</td><td>404 Not Found</td></tr><tr><td>请求方法不支持</td><td>405 Method Not Allowed</td></tr><tr><td>服务器内部错误</td><td>500 Internal Server Error</td></tr></tbody></table>
<blockquote>
<p>🚫 反例：<code>{ "code": 200, "msg": "用户不存在" }</code> —— 这应该返回 404！</p>
</blockquote>
<hr/>
<h4 data-id="heading-9">原则 7️⃣：<strong>响应体结构清晰一致</strong></h4>
<p>推荐统一响应格式（尤其在出错时）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 成功</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">123</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Alice"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"meta"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// 失败</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"INVALID_EMAIL"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"邮箱格式不正确"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"details"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"email"</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>避免：有时返回对象，有时返回数组，有时直接返回字符串。</p>
<hr/>
<h3 data-id="heading-10">三、高频“反人类”接口黑名单（快自查！）</h3>



































<table><thead><tr><th>反模式</th><th>问题</th><th>正确做法</th></tr></thead><tbody><tr><td><code>GET /deleteUser?id=1</code></td><td>用 GET 修改数据</td><td>改用 <code>DELETE /users/1</code></td></tr><tr><td><code>POST /updateUser</code></td><td>动词命名 + 错误方法</td><td>用 <code>PUT /users/1</code></td></tr><tr><td>返回 200 但 body 里写 <code>{ "success": false }</code></td><td>状态码失真</td><td>直接返回 4xx/5xx</td></tr><tr><td>接口路径大小写混乱：<code>/GetUser</code> vs <code>/getuser</code></td><td>不一致</td><td>全小写 + 中划线（如需）</td></tr><tr><td>把业务逻辑塞进 URL：<code>/payOrderAndSendEmail</code></td><td>违背单一职责</td><td>拆分为两个操作或用 POST 触发工作流</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-11">四、加分项：让 API 更专业</h3>
<ul>
<li>✅ 提供 OpenAPI/Swagger 文档</li>
<li>✅ 支持 HATEOAS（超媒体驱动，高级用法）</li>
<li>✅ 使用版本控制：<code>/api/v1/users</code></li>
<li>✅ 限流与鉴权标准化（如 JWT + OAuth2）</li>
</ul>
<hr/>
<h3 data-id="heading-12">五、结语：好 API 是“产品思维”的体现</h3>
<p>一个优秀的 API 不仅是给机器调用的，更是<strong>给开发者使用的“产品”</strong> 。<br/>
它应该具备：<strong>一致性、可预测性、自解释性</strong>。</p>
<p>记住：</p>
<blockquote>
<p><strong>“如果你的前端同事不用看文档就能猜对接口怎么用，你就成功了。”</strong></p>
</blockquote>
<p>从今天起，拒绝“能跑就行”的接口，用 REST 原则打造值得骄傲的 API 吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再乱建索引了！揭秘数据库索引的工作原理与“越建越慢”的真相]]></title>    <link>https://juejin.cn/post/7604805226697392166</link>    <guid>https://juejin.cn/post/7604805226697392166</guid>    <pubDate>2026-02-10T09:35:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604805226697392166" data-draft-id="7604889577937158171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再乱建索引了！揭秘数据库索引的工作原理与“越建越慢”的真相"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T09:35:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼人"/> <meta itemprop="url" content="https://juejin.cn/user/2279731967827264"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再乱建索引了！揭秘数据库索引的工作原理与“越建越慢”的真相
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2279731967827264/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:35:15.000Z" title="Tue Feb 10 2026 09:35:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>别再乱建索引了！揭秘数据库索引的工作原理与“越建越慢”的真相</strong></h2>
<p>你是不是也遇到过这种情况？<br/>
明明给字段加了索引，查询却<strong>没变快</strong>，甚至<strong>变得更慢</strong>了；<br/>
或者数据库写入速度突然暴跌，CPU 飙升——罪魁祸首，很可能就是<strong>滥用索引</strong>。</p>
<p>索引是数据库性能优化的“双刃剑”：用得好，毫秒响应；用不好，拖垮系统。<br/>
本文将带你从底层理解<strong>索引如何工作</strong>，并揭示<strong>为什么乱建索引反而会拖慢查询</strong>，最后给出<strong>科学建索引的最佳实践</strong>。</p>
<hr/>
<h3 data-id="heading-1">一、索引的本质：让数据库“不用全表扫描”</h3>
<p>想象你在一本 1000 页的字典里找“量子”这个词：</p>
<ul>
<li><strong>没有目录（无索引）</strong> → 从第一页翻到最后一页（全表扫描，O(n)）</li>
<li><strong>有目录（有索引）</strong> → 直接翻到“量”字部（O(log n) 或 O(1)）</li>
</ul>
<p>数据库索引正是这个“目录”——它是一种<strong>额外的数据结构</strong>（通常是 B+ 树），存储了字段值与对应行物理地址的映射关系。</p>
<blockquote>
<p>✅ 核心作用：<strong>避免全表扫描，快速定位数据</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">二、主流索引结构：为什么是 B+ 树？</h3>
<p>虽然哈希、Bitmap、LSM 等索引也存在，但<strong>关系型数据库（如 MySQL InnoDB、PostgreSQL）默认使用 B+ 树</strong>，原因如下：</p>





















<table><thead><tr><th>特性</th><th>B+ 树优势</th></tr></thead><tbody><tr><td><strong>范围查询高效</strong></td><td>所有叶子节点用链表连接，<code>WHERE id BETWEEN 10 AND 100</code> 只需遍历一段连续节点</td></tr><tr><td><strong>磁盘 I/O 优化</strong></td><td>树高度低（通常 3<del>4 层），一次查询只需 3</del>4 次磁盘读取</td></tr><tr><td><strong>插入/删除稳定</strong></td><td>自平衡机制保证性能不退化</td></tr></tbody></table>
<blockquote>
<p>📌 举例：InnoDB 的主键索引（聚簇索引）直接将整行数据存在 B+ 树叶子节点；二级索引则存主键值，需回表查询。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">三、索引加速查询的典型场景</h3>
<ol>
<li>
<p><strong>等值查询</strong></p>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM users WHERE <span class="hljs-attr">email</span> = <span class="hljs-string">'alice@example.com'</span><span class="hljs-comment">;</span>
</code></pre>
<p>→ 若 <code>email</code> 有索引，直接定位，无需扫描百万行。</p>
</li>
<li>
<p><strong>范围查询</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> created_at <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2025-01-01'</span>;
</code></pre>
<p>→ B+ 树支持高效范围扫描。</p>
</li>
<li>
<p><strong>排序与分组</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> price;
</code></pre>
<p>→ 若 <code>price</code> 有索引，可避免 <code>filesort</code>（内存或磁盘排序）。</p>
</li>
<li>
<p><strong>覆盖索引（Covering Index）</strong></p>
<pre><code class="hljs language-ini" lang="ini">SELECT user_id, name FROM users WHERE <span class="hljs-attr">status</span> = <span class="hljs-string">'active'</span><span class="hljs-comment">;</span>
</code></pre>
<p>→ 若 <code>(status, name)</code> 建了联合索引，数据库<strong>无需回表</strong>，直接从索引返回结果！</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-4">四、为什么乱建索引反而会拖慢系统？</h3>
<p>索引不是免费的！它带来三大隐性成本：</p>
<h4 data-id="heading-5">❌ 成本 1：<strong>写操作变慢</strong></h4>
<p>每次 <code>INSERT</code> / <code>UPDATE</code> / <code>DELETE</code>，数据库不仅要改表数据，还要<strong>同步更新所有相关索引</strong>。</p>
<ul>
<li>1 个索引 → 1 次额外写</li>
<li>10 个索引 → 10 次额外写！</li>
</ul>
<blockquote>
<p>📊 实测案例：某表有 8 个索引，插入 10 万条记录耗时 12 秒；删除 6 个无用索引后，仅需 3 秒。</p>
</blockquote>
<h4 data-id="heading-6">❌ 成本 2：<strong>占用大量存储空间</strong></h4>
<p>索引本身要存磁盘！</p>
<ul>
<li>一个 <code>INT</code> 字段索引 ≈ 表大小的 10%~20%</li>
<li>联合索引、长字符串索引（如 <code>VARCHAR(255)</code>）可能比表还大！</li>
</ul>
<h4 data-id="heading-7">❌ 成本 3：<strong>优化器选择困难</strong></h4>
<p>索引越多，查询优化器需要评估的执行计划越多，<strong>反而可能选错索引</strong>，导致性能下降。</p>
<blockquote>
<p>⚠️ 经典反例：</p>
<ul>
<li>给性别字段 <code>gender</code>（只有“男/女”）建索引 → 选择性极低，几乎无效</li>
<li>在频繁更新的字段上建索引 → 写性能雪崩</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-8">五、科学建索引的 5 条黄金法则</h3>
<h4 data-id="heading-9">✅ 法则 1：<strong>只为高频查询和过滤字段建索引</strong></h4>
<ul>
<li>优先考虑 <code>WHERE</code>、<code>JOIN ON</code>、<code>ORDER BY</code>、<code>GROUP BY</code> 中的字段。</li>
<li>低选择性字段（如状态、布尔值）慎建！</li>
</ul>
<h4 data-id="heading-10">✅ 法则 2：<strong>善用联合索引，遵循最左前缀原则</strong></h4>
<pre><code class="hljs language-css" lang="css">-- 联合索引 (<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>, c)
WHERE <span class="hljs-selector-tag">a</span> = <span class="hljs-number">1</span> AND <span class="hljs-selector-tag">b</span> = <span class="hljs-number">2</span>          → ✅ 有效  
WHERE <span class="hljs-selector-tag">a</span> = <span class="hljs-number">1</span>                    → ✅ 有效（用到 <span class="hljs-selector-tag">a</span>）  
WHERE <span class="hljs-selector-tag">b</span> = <span class="hljs-number">2</span>                    → ❌ 无效（跳过 <span class="hljs-selector-tag">a</span>）  
WHERE <span class="hljs-selector-tag">a</span> = <span class="hljs-number">1</span> AND c = <span class="hljs-number">3</span>          → ✅ 用到 <span class="hljs-selector-tag">a</span>，c 无法用索引
</code></pre>
<blockquote>
<p>💡 技巧：把<strong>选择性高</strong>的字段放联合索引左边。</p>
</blockquote>
<h4 data-id="heading-11">✅ 法则 3：<strong>警惕“隐式类型转换”导致索引失效</strong></h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- user_id 是 INT 类型</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'123'</span>; <span class="hljs-comment">-- 字符串 '123'</span>
</code></pre>
<p>→ 数据库可能对 <code>user_id</code> 做类型转换，<strong>导致索引失效</strong>！<br/>
✅ 正确：确保查询值与字段类型一致。</p>
<h4 data-id="heading-12">✅ 法则 4：<strong>定期清理无用索引</strong></h4>
<p>使用数据库工具分析：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- MySQL 查看未使用索引（需开启 performance_schema）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.schema_unused_indexes;
</code></pre>
<p>删除长期未被使用的索引，释放资源。</p>
<h4 data-id="heading-13">✅ 法则 5：<strong>监控执行计划（EXPLAIN）</strong></h4>
<p>永远不要“猜”索引是否生效！用 <code>EXPLAIN</code> 看真实执行路径：</p>
<pre><code class="hljs language-ini" lang="ini">EXPLAIN SELECT * FROM orders WHERE <span class="hljs-attr">customer_id</span> = <span class="hljs-number">100</span><span class="hljs-comment">;</span>
</code></pre>
<p>关注 <code>type</code>（是否为 <code>ref</code>/<code>range</code>）、<code>key</code>（是否命中索引）、<code>rows</code>（扫描行数）。</p>
<hr/>
<h3 data-id="heading-14">六、结语：索引是艺术，不是堆砌</h3>
<p>优秀的数据库设计者，不是建最多索引的人，而是<strong>用最少索引解决最多问题</strong>的人。</p>
<p>记住：</p>
<blockquote>
<p><strong>“每一个索引，都是对写性能的一次征税。”</strong></p>
</blockquote>
<p>在建索引前，先问自己三个问题：</p>
<ol>
<li>这个查询真的高频吗？</li>
<li>这个字段的选择性足够高吗？</li>
<li>是否已有其他索引能覆盖？</li>
</ol>
<p>理性建索引，才能让数据库既快又稳！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你以为自己漏消息了？其实是 GitHub “卡了下”]]></title>    <link>https://juejin.cn/post/7605030650278789166</link>    <guid>https://juejin.cn/post/7605030650278789166</guid>    <pubDate>2026-02-10T09:52:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605030650278789166" data-draft-id="7604784281958088742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你以为自己漏消息了？其实是 GitHub “卡了下”"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-02-10T09:52:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcs"/> <meta itemprop="url" content="https://juejin.cn/user/3679404422861902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你以为自己漏消息了？其实是 GitHub “卡了下”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3679404422861902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T09:52:08.000Z" title="Tue Feb 10 2026 09:52:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2月9日 GitHub 确实出现了一波 <strong>通知延迟</strong>，并且伴随 <strong>多个核心服务的性能降级</strong>：包括 Actions、Git Operations、Issues、Pull Requests、Webhooks、Packages、Pages、Codespaces，甚至还波及到 Copilot、Dependabot 等相关能力。最后官方宣布恢复正常，并表示后续会发布更详细的 RCA（根因分析）。官方事件报告如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/450ae143b3694e018c5d9e5435ec64d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321932&amp;x-signature=Q5hmPD9KGml3saYhx1HGoWr31LE%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.githubstatus.com%2Fincidents%2F54hndjxft5bx" target="_blank" title="https://www.githubstatus.com/incidents/54hndjxft5bx" ref="nofollow noopener noreferrer">通知延迟事件报告</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.githubstatus.com%2Fincidents%2Flcw3tg2f6zsd" target="_blank" title="https://www.githubstatus.com/incidents/lcw3tg2f6zsd" ref="nofollow noopener noreferrer">涉及问题、操作和Git操作的事件报告</a></li>
</ul>
<p>好，信息面上就这些，但小D作为每天在 GitHub 上“搬砖”的工程师，真正关心的通常是三件事：</p>
<p>1）<strong>到底发生了什么，会影响我哪些流程？</strong>
2）<strong>我现在遇到的问题，是 GitHub 的锅还是我的锅？</strong>
3）<strong>怎么快速自救，避免今晚继续加班？</strong></p>
<hr/>
<h2 data-id="heading-0">1）这次异常的两条主线：通知慢 + 服务抖成筛子</h2>
<h3 data-id="heading-1">A. 通知延迟（Notifications are delayed）</h3>
<p>GitHub 官方描述很直白：通知出现积压，平均延迟从 <strong>约 50 分钟</strong>一路飙到 <strong>约 1 小时 20 分钟</strong>，随后逐步回落到 <strong>约 1 小时 → 30 分钟 → 15 分钟</strong>，最终宣布完全恢复。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e9587a2e60e42da8870f3e45909f07b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321932&amp;x-signature=oxgk0DnVAmkfuze%2BKvDiW4AHCs8%3D" alt="image.png" loading="lazy"/></p>
<p>人话：你的通知确实可能“晚到”，但不是不到。更扎心的是——通知这种东西晚到就等于失效。</p>
<ul>
<li>PR reviewer 迟迟收不到提醒，review 节奏断了</li>
<li>code owner 迟到半小时才看到变更，合并窗口错过</li>
<li>oncall 收到告警关联通知晚一拍，排障黄金时间直接蒸发</li>
</ul>
<h3 data-id="heading-2">B. 多服务降级（Issues / Actions / Git 操作等）</h3>
<p>另一条线更“硬核”：一堆核心服务出现 degraded performance / degraded availability。官方过程里提到的影响包括：</p>
<ul>
<li>请求变慢、失败率上升</li>
<li>Actions 任务延迟、排队</li>
<li>多个产品线（Actions、Issues、PR、Webhooks 等）不同程度受影响
后续官方声明服务恢复正常。</li>
</ul>
<p>一句人话总结：<strong>不只是“通知慢”，而是“系统整体有点喘不过气”。</strong>[惊恐]</p>
<hr/>
<h2 data-id="heading-3">2）最容易踩的坑</h2>
<p>你以为是流程问题，其实是平台波动</p>
<p>这类事故最烦人的地方在于：它不会把你电脑蓝屏，也不会直接报一个“GitHub 崩了”。</p>
<ul>
<li>PR 已合并，但通知迟迟不到 → 你以为 webhook/机器人挂了</li>
<li>Actions 状态卡住不动 → 你以为 YAML 写炸了，开始疯狂改 pipeline</li>
<li>Issue 评论发出去了，但订阅者没收到提醒 → 你以为权限/订阅设置有问题</li>
<li>git push 偶发失败或慢 → 你以为公司网络抖了，开始怀疑人生</li>
</ul>
<p>于是，程序猿最经典的场景也是最擅长的事情出现了：
<strong>平台抖 1 小时，你排查 3 小时。</strong>（加班就是这么来的😭）</p>
<hr/>
<h2 data-id="heading-4">3）一份“自救排查清单”</h2>
<p>当你发现 GitHub “不太对劲”，建议按这个顺序来——能省命：</p>
<h3 data-id="heading-5">✅ Step 1：先看 Status Page（别自虐）</h3>
<p>先打开：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.githubstatus.com%2F" target="_blank" title="https://www.githubstatus.com/" ref="nofollow noopener noreferrer">www.githubstatus.com/</a></li>
</ul>
<p>如果状态页正在 Investigating / Identified / Monitoring，恭喜：你可以先把“自责模式”关掉。</p>
<h3 data-id="heading-6">✅ Step 2：判断影响面（通知 vs 业务链路）</h3>
<ul>
<li>只是通知慢：PR/Issue 可能还能用，只是“提醒晚到”</li>
<li>Actions/Git 操作也慢：CI/CD、合并、发版链路可能整体变慢或失败</li>
</ul>
<p>这一步很关键：
<strong>通知慢 → 别急着改系统</strong>
<strong>链路慢/失败 → 先保交付，别做大手术</strong></p>
<h3 data-id="heading-7">✅ Step 3：把“重试”变聪明</h3>
<p>事故期间最怕的不是失败，而是“你和平台一起抽风式重试”，把积压越堆越大：</p>
<ul>
<li>Actions：避免手动狂点 Re-run all jobs（尤其是高并发仓库）</li>
<li>Webhooks：如果你有自建 webhook consumer，确认重试策略是指数退避（exponential backoff），别 1 秒 1 次硬刚</li>
<li>Bot/Automation：临时降低触发频率或加熔断（例如只处理关键事件）</li>
</ul>
<h3 data-id="heading-8">✅ Step 4：关键业务兜底（临时“人工模式”）</h3>
<p>当自动化链路不稳定时，短期最有效的是“降级”：</p>
<ul>
<li>重要发布：临时人工确认 PR 状态、手动触发必要任务</li>
<li>关键告警：别完全依赖 GitHub 通知，转到 Slack/邮件/监控系统的主通道</li>
<li>依赖更新（Dependabot）：如果受影响，先暂停自动合并，避免“卡住时乱合”</li>
</ul>
<h3 data-id="heading-9">✅ Step 5：事故恢复后做一次“事后清算”</h3>
<p>官方说会出 RCA，但团队内部也建议做两件事：</p>
<ul>
<li>
<p>回看事故窗口内的失败任务/遗漏通知（尤其是 oncall / 安全相关）</p>
</li>
<li>
<p>把“平台波动”纳入你的工程弹性设计：</p>
<ul>
<li>webhook 事件幂等</li>
<li>重试退避 + 死信队列</li>
<li>关键流程可手动兜底</li>
<li>不把单点平台当永远 100% 可用（这点很重要）</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-10">4）结语</h2>
<p>GitHub 抖动不是罕见事件，罕见的是你没准备</p>
<p>平台级服务再稳，也会有“咳嗽”的时候。真正决定你今晚能不能准点下班的，不是平台有没有事故，而是你的系统有没有“抗事故的姿势”：</p>
<ul>
<li>你有没有把通知当成唯一信号？</li>
<li>你有没有把 CI 当成唯一门禁？</li>
<li>你有没有把 webhook 当成永不丢的消息？</li>
<li>你有没有给自动化加退避、熔断、幂等、降级？</li>
</ul>
<p>这些看起来像“架构洁癖”，但事故来时，它就是救命稻草。</p>
<p>下次再遇到“PR 没人回、CI 卡住、通知消失”，先别慌，先看状态页，再决定要不要开干——工程师的体力要用在刀刃上，不要用在跟平台对线🤝</p>
<hr/>
<p><strong>喜欢就奖励一个“👍”和“在看”呗~</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cfcd417c74b4474b1cdf3bfd9e5d523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGNz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771321932&amp;x-signature=uUbltrfYcTNdH9xmpzRthXVsQAs%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python3基础：基础实战巩固，从“会用”到“活用”]]></title>    <link>https://juejin.cn/post/7604093823958614035</link>    <guid>https://juejin.cn/post/7604093823958614035</guid>    <pubDate>2026-02-09T04:34:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604093823958614035" data-draft-id="7604175912480800774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python3基础：基础实战巩固，从“会用”到“活用”"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-02-09T04:34:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python3基础：基础实战巩固，从“会用”到“活用”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T04:34:30.000Z" title="Mon Feb 09 2026 04:34:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第七阶段：基础实战巩固，从“会用”到“活用”</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
<p>🔥豆包AI</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>恭喜大家成功通关Python3基础学习第六阶段「进阶基础」！在第六阶段，我们掌握了模块与包、文件操作、异常处理、面向对象基础四大核心技能，终于跳出了“单纯记语法”的范畴，具备了编写模块化、健壮性代码的能力。</p>
<p>而第七阶段「基础实战巩固」，是Python基础学习中“承上启下”的关键一环——核心目标不是学习新的复杂语法，而是<strong>将前六阶段的所有知识点串联起来，通过实战场景落地应用</strong>，帮大家摆脱“看得懂、写不出”的困境，巩固基础、查漏补缺，同时掌握常用工具（内置函数、标准库）和基础并发/网络能力，为后续学习复杂项目、框架打下坚实的实战基础。</p>
<p>本阶段我们将聚焦四大实战方向，全程围绕“实战场景+可运行代码+避坑实战”展开，每个知识点都结合前阶段内容设计实战案例，跟着敲代码、练案例，既能巩固旧知识，又能掌握新工具，真正实现从“会用”到“活用”的跨越，稳步向“能独立编写简单项目的Python初学者”迈进～</p>
<h3 data-id="heading-2">1 常用内置函数：Python自带的“实用工具”，提升编码效率</h3>
<p>在前面的学习中，我们其实已经零散用到过一些内置函数（比如print()、input()），但Python自带了大量无需导入、直接可用的内置函数，它们就像“现成的工具”，能帮我们快速解决常见问题（比如计算长度、生成序列、筛选数据），避免重复编写代码。</p>
<p>本阶段重点掌握8个高频实用的内置函数，覆盖日常编码80%的场景，结合实战案例讲解，重点理解“什么时候用、怎么用”，而非死记硬背。</p>
<h4 data-id="heading-3">1.1 核心内置函数</h4>
<p>每个函数均搭配“语法解析+实战代码+场景说明”，代码可直接复制运行，贴合新手实战需求：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. len()：计算可迭代对象的长度（字符串、列表、字典、元组等）</span>
<span class="hljs-comment"># 实战场景：统计用户输入的字符数、列表中元素个数</span>
str1 = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入一段文字："</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"输入文字的长度（含空格）：<span class="hljs-subst">{<span class="hljs-built_in">len</span>(str1)}</span>"</span>)

list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"Python"</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>]]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"列表的元素个数：<span class="hljs-subst">{<span class="hljs-built_in">len</span>(list1)}</span>"</span>)  <span class="hljs-comment"># 输出5（嵌套列表算1个元素）</span>

dict1 = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">18</span>, <span class="hljs-string">"gender"</span>: <span class="hljs-string">"男"</span>}
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"字典的键值对个数：<span class="hljs-subst">{<span class="hljs-built_in">len</span>(dict1)}</span>"</span>)  <span class="hljs-comment"># 输出3</span>

<span class="hljs-comment"># 2. range()：生成指定范围的整数序列（左闭右开）</span>
<span class="hljs-comment"># 实战场景：配合for循环实现固定次数的迭代（替代手动写列表）</span>
<span class="hljs-comment"># 语法：range(开始值, 结束值, 步长)，开始值默认0，步长默认1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"生成0-9的整数："</span>, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)))  <span class="hljs-comment"># 输出[0,1,2,...,9]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"生成1-10的整数："</span>, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)))  <span class="hljs-comment"># 输出[1,2,...,10]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"生成1-10的奇数："</span>, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">2</span>)))  <span class="hljs-comment"># 步长2，输出[1,3,...,9]</span>

<span class="hljs-comment"># 实战：用range()循环打印1-5的平方（结合前阶段的循环、函数）</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i}</span>的平方：<span class="hljs-subst">{i**<span class="hljs-number">2</span>}</span>"</span>)

<span class="hljs-comment"># 3. enumerate()：遍历可迭代对象时，同时获取索引和对应的值</span>
<span class="hljs-comment"># 实战场景：遍历列表/元组时，需要知道元素的位置（避免手动定义索引变量）</span>
<span class="hljs-comment"># 语法：enumerate(可迭代对象, start=起始索引)，start默认0</span>
fruits = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>, <span class="hljs-string">"葡萄"</span>]
<span class="hljs-comment"># 默认start=0，索引从0开始</span>
<span class="hljs-keyword">for</span> index, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fruits):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"索引<span class="hljs-subst">{index}</span>：<span class="hljs-subst">{value}</span>"</span>)
<span class="hljs-comment"># start=1，索引从1开始（适合计数场景）</span>
<span class="hljs-keyword">for</span> index, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fruits, start=<span class="hljs-number">1</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"第<span class="hljs-subst">{index}</span>个水果：<span class="hljs-subst">{value}</span>"</span>)

<span class="hljs-comment"># 4. zip()：将多个可迭代对象（列表、元组等）“配对”，合并成一个迭代器</span>
<span class="hljs-comment"># 实战场景：批量处理多组关联数据（比如姓名和年龄、学号和成绩）</span>
names = [<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-string">"王五"</span>]
ages = [<span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">20</span>]
scores = [<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">95</span>]

<span class="hljs-comment"># 配对多个列表，遍历获取关联数据</span>
<span class="hljs-keyword">for</span> name, age, score <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(names, ages, scores):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名：<span class="hljs-subst">{name}</span>，年龄：<span class="hljs-subst">{age}</span>，成绩：<span class="hljs-subst">{score}</span>"</span>)

<span class="hljs-comment"># 补充：zip()返回的是迭代器，可转换为列表查看</span>
zip_result = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(names, ages))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"zip配对结果："</span>, zip_result)  <span class="hljs-comment"># 输出[('张三',18), ('李四',19), ('王五',20)]</span>

<span class="hljs-comment"># 5. sorted()：对可迭代对象进行排序，返回排序后的新列表（不改变原对象）</span>
<span class="hljs-comment"># 实战场景：对列表、元组、字典的值进行排序</span>
nums = [<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>]
sorted_nums = <span class="hljs-built_in">sorted</span>(nums)  <span class="hljs-comment"># 默认升序</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"升序排序："</span>, sorted_nums)  <span class="hljs-comment"># 输出[1,2,3,4,5]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"原列表（未改变）："</span>, nums)  <span class="hljs-comment"># 输出[3,1,4,2,5]</span>

<span class="hljs-comment"># 降序排序，指定reverse=True</span>
sorted_nums_desc = <span class="hljs-built_in">sorted</span>(nums, reverse=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"降序排序："</span>, sorted_nums_desc)

<span class="hljs-comment"># 实战：对字典按值排序（结合前阶段的字典知识）</span>
score_dict = {<span class="hljs-string">"张三"</span>: <span class="hljs-number">90</span>, <span class="hljs-string">"李四"</span>: <span class="hljs-number">85</span>, <span class="hljs-string">"王五"</span>: <span class="hljs-number">95</span>}
<span class="hljs-comment"># 按成绩升序排序，返回包含元组的列表</span>
sorted_score = <span class="hljs-built_in">sorted</span>(score_dict.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"按成绩升序排序："</span>, sorted_score)

<span class="hljs-comment"># 6. map()：对可迭代对象的每个元素，应用指定函数，返回迭代器</span>
<span class="hljs-comment"># 实战场景：批量处理数据（比如所有元素平方、转换数据类型）</span>
<span class="hljs-comment"># 示例1：将列表中所有整数转换为字符串</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
str_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"整数转字符串："</span>, str_nums)  <span class="hljs-comment"># 输出['1','2','3','4','5']</span>

<span class="hljs-comment"># 示例2：计算列表中所有元素的平方（结合lambda匿名函数）</span>
square_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x**<span class="hljs-number">2</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"所有元素平方："</span>, square_nums)  <span class="hljs-comment"># 输出[1,4,9,16,25]</span>

<span class="hljs-comment"># 7. filter()：对可迭代对象的元素进行筛选，保留符合条件的元素</span>
<span class="hljs-comment"># 实战场景：筛选符合要求的数据（比如筛选偶数、筛选大于某个值的元素）</span>
<span class="hljs-comment"># 示例1：筛选列表中的偶数</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
even_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"筛选偶数："</span>, even_nums)  <span class="hljs-comment"># 输出[2,4,6]</span>

<span class="hljs-comment"># 示例2：筛选列表中大于3的元素</span>
greater_3 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x &gt; <span class="hljs-number">3</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"筛选大于3的元素："</span>, greater_3)  <span class="hljs-comment"># 输出[4,5,6]</span>

<span class="hljs-comment"># 8. abs()：返回数字的绝对值</span>
<span class="hljs-comment"># 实战场景：处理负数（比如计算距离、误差，绝对值避免负号影响）</span>
num1 = -<span class="hljs-number">5</span>
num2 = <span class="hljs-number">3.14</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"-5的绝对值：<span class="hljs-subst">{<span class="hljs-built_in">abs</span>(num1)}</span>"</span>)  <span class="hljs-comment"># 输出5</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3.14的绝对值：<span class="hljs-subst">{<span class="hljs-built_in">abs</span>(num2)}</span>"</span>)  <span class="hljs-comment"># 输出3.14</span>
</code></pre>
<h4 data-id="heading-4">1.2 新手避坑指南</h4>
<ul>
<li>避坑1：len()计算嵌套列表时，嵌套的子列表算“1个元素”，不会递归计算子列表内部的长度；</li>
<li>避坑2：range()是“左闭右开”区间，比如range(1, 10)生成1-9的整数，不会包含10；步长为负数时，开始值要大于结束值（比如range(10, 0, -1)生成10-1）；</li>
<li>避坑3：enumerate()的start参数只是“修改索引的显示值”，不会改变元素本身的位置；</li>
<li>避坑4：zip()会以“最短的可迭代对象”为准配对，多余的元素会被舍弃（比如3个姓名、2个年龄，会只配对前2组）；且zip()返回的迭代器只能遍历一次，再次遍历会为空；</li>
<li>避坑5：sorted()会返回新列表，不会修改原对象；而列表自带的sort()方法会修改原列表，无返回值（新手易混淆两者）；</li>
<li>避坑6：map()和filter()返回的是迭代器，需转换为列表（list()）才能直观查看结果。</li>
</ul>
<h3 data-id="heading-5">2 简单标准库使用：活用Python自带“工具包”，高效编码</h3>
<p>在第六阶段，我们学习了模块与包的基础用法，而Python自带的“标准库”，就是一组官方编写的、无需额外安装的实用模块集合。它们覆盖了数学计算、随机数生成、时间处理等常见场景，熟练使用这些标准库，能大幅提升编码效率，避免重复造轮子。</p>
<p>本阶段重点掌握3个最常用的标准库（math、random、time），结合实战场景讲解核心用法，不深入复杂功能，聚焦“新手能快速上手、日常能用得上”的知识点。</p>
<h4 data-id="heading-6">2.1 math库：数学计算工具，解决基础数学问题</h4>
<p>math库提供了大量基础数学运算函数（如圆周率、三角函数、取整、开平方等），适合解决日常编程中的数学计算场景，核心用法如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math  <span class="hljs-comment"># 导入math库（无需安装，直接导入）</span>

<span class="hljs-comment"># 1. 常用常量（实战常用）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"圆周率π："</span>, math.pi)  <span class="hljs-comment"># 输出3.141592653589793</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"自然常数e："</span>, math.e)  <span class="hljs-comment"># 输出2.718281828459045</span>

<span class="hljs-comment"># 2. 基础运算（实战重点）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"16的平方根："</span>, math.sqrt(<span class="hljs-number">16</span>))  <span class="hljs-comment"># 输出4.0（开平方）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"2的3次方："</span>, math.<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出8.0（幂运算，等同于2**3）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"绝对值："</span>, math.fabs(-<span class="hljs-number">5.2</span>))  <span class="hljs-comment"># 输出5.2（绝对值，比abs()更适合浮点数）</span>

<span class="hljs-comment"># 3. 取整函数（新手易混淆，重点区分）</span>
num = <span class="hljs-number">3.7</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"向下取整（&lt;=3.7的最大整数）："</span>, math.floor(num))  <span class="hljs-comment"># 输出3</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"向上取整（&gt;=3.7的最小整数）："</span>, math.ceil(num))  <span class="hljs-comment"># 输出4</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"四舍五入（保留整数）："</span>, <span class="hljs-built_in">round</span>(num))  <span class="hljs-comment"># 输出4（round是内置函数，非math库）</span>

num2 = <span class="hljs-number">3.1</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"向下取整："</span>, math.floor(num2))  <span class="hljs-comment"># 输出3</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"向上取整："</span>, math.ceil(num2))  <span class="hljs-comment"># 输出4</span>

<span class="hljs-comment"># 4. 实战案例：计算圆的周长和面积（结合前阶段的函数知识）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_circle</span>(<span class="hljs-params">radius</span>):
    <span class="hljs-string">"""计算圆的周长和面积"""</span>
    <span class="hljs-keyword">if</span> radius&lt;= <span class="hljs-number">0</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"半径必须为正数！"</span>)
        <span class="hljs-keyword">return</span>
    circumference = <span class="hljs-number">2</span> * math.pi * radius  <span class="hljs-comment"># 周长公式：2πr</span>
    area = math.pi * math.<span class="hljs-built_in">pow</span>(radius, <span class="hljs-number">2</span>)  <span class="hljs-comment"># 面积公式：πr²</span>
    <span class="hljs-keyword">return</span> circumference, area

<span class="hljs-comment"># 调用函数，获取结果</span>
circum, area = calc_circle(<span class="hljs-number">3</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"半径为3的圆：周长=<span class="hljs-subst">{<span class="hljs-built_in">round</span>(circum, <span class="hljs-number">2</span>)}</span>，面积=<span class="hljs-subst">{<span class="hljs-built_in">round</span>(area, <span class="hljs-number">2</span>)}</span>"</span>)  <span class="hljs-comment"># 保留2位小数</span>
</code></pre>
<h4 data-id="heading-7">2.2 random库：随机数工具，实现随机场景</h4>
<p>random库用于生成随机数、随机选择、随机打乱等操作，适合抽奖、验证码生成、随机分组等实战场景，核心用法如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random  <span class="hljs-comment"># 导入random库</span>

<span class="hljs-comment"># 1. 生成随机浮点数（0.0 &lt;= 浮点数 &lt; 1.0）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机浮点数（0-1）："</span>, random.random())

<span class="hljs-comment"># 2. 生成随机整数（左闭右开，包含start和end）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机整数（1-10）："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机整数（0-9，步长2）："</span>, random.randrange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>))  <span class="hljs-comment"># 只生成偶数</span>

<span class="hljs-comment"># 3. 随机选择（实战常用）</span>
<span class="hljs-comment"># 从序列中随机选择1个元素</span>
fruits = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>, <span class="hljs-string">"葡萄"</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机选择1个水果："</span>, random.choice(fruits))

<span class="hljs-comment"># 从序列中随机选择多个不重复元素（比如抽奖选3人）</span>
nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">21</span>))  <span class="hljs-comment"># 1-20的整数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机选择3个不重复数字："</span>, random.sample(nums, <span class="hljs-number">3</span>))

<span class="hljs-comment"># 4. 随机打乱（原地打乱列表，修改原对象）</span>
random.shuffle(fruits)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"打乱后的水果列表："</span>, fruits)

<span class="hljs-comment"># 5. 实战案例：生成6位数字验证码（实战高频场景）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_verify_code</span>():
    <span class="hljs-string">"""生成6位数字验证码"""</span>
    code = <span class="hljs-string">""</span>
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):
        <span class="hljs-comment"># 生成0-9的随机整数，转换为字符串拼接</span>
        code += <span class="hljs-built_in">str</span>(random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">9</span>))
    <span class="hljs-keyword">return</span> code

<span class="hljs-comment"># 调用函数，生成验证码</span>
verify_code = generate_verify_code()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"6位数字验证码："</span>, verify_code)
</code></pre>
<h4 data-id="heading-8">2.3 time库：时间工具，处理时间相关场景</h4>
<p>time库用于获取当前时间、格式化时间、设置程序延迟等操作，适合日志记录、程序计时、延迟执行等实战场景，核心用法如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time  <span class="hljs-comment"># 导入time库</span>

<span class="hljs-comment"># 1. 获取当前时间（三种常用格式）</span>
<span class="hljs-comment"># 格式1：时间戳（从1970年1月1日00:00:00到当前的秒数，浮点数）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间戳："</span>, time.time())

<span class="hljs-comment"># 格式2：结构化时间（包含年、月、日、时、分、秒等信息）</span>
struct_time = time.localtime()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"结构化时间："</span>, struct_time)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前年份："</span>, struct_time.tm_year)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前月份："</span>, struct_time.tm_mon)

<span class="hljs-comment"># 格式3：格式化时间（人类可读，常用）</span>
<span class="hljs-comment"># 常用占位符：%Y（4位年份）、%m（2位月份）、%d（2位日期）、%H（24小时制）、%M（分钟）、%S（秒）</span>
format_time1 = time.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>, struct_time)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间（年-月-日 时:分:秒）："</span>, format_time1)

format_time2 = time.strftime(<span class="hljs-string">"%Y年%m月%d日 %H时%M分%S秒"</span>, struct_time)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间（中文格式）："</span>, format_time2)

<span class="hljs-comment"># 2. 程序延迟执行（sleep(秒数)，实战常用）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"程序开始执行..."</span>)
time.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 延迟2秒（让程序暂停2秒再执行后续代码）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"延迟2秒后，程序继续执行..."</span>)

<span class="hljs-comment"># 3. 实战案例：计算代码执行时间（优化代码常用）</span>
start_time = time.time()  <span class="hljs-comment"># 记录开始时间（时间戳）</span>

<span class="hljs-comment"># 模拟一段需要执行的代码（比如循环10000次）</span>
total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):
    total += i

end_time = time.time()  <span class="hljs-comment"># 记录结束时间</span>
execution_time = end_time - start_time  <span class="hljs-comment"># 计算执行时间（秒）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"代码执行完毕，总耗时：<span class="hljs-subst">{<span class="hljs-built_in">round</span>(execution_time, <span class="hljs-number">4</span>)}</span>秒"</span>)
</code></pre>
<h4 data-id="heading-9">2.4 新手避坑指南（标准库实战必看）</h4>
<ul>
<li>避坑1：math库的函数参数多为“弧度”（而非角度），比如math.sin()计算的是弧度的正弦值，若用角度需先转换（弧度=角度×math.pi/180）；</li>
<li>避坑2：random库生成的是“伪随机数”（基于种子生成），若设置固定种子（random.seed(10)），每次运行生成的随机数会相同（适合调试）；</li>
<li>避坑3：random.shuffle()会“原地打乱”列表，修改原对象，若不想修改原列表，需先复制（比如new_list = list1.copy()，再shuffle(new_list)）；</li>
<li>避坑4：time.strftime()的占位符区分大小写，比如%Y是4位年份，%y是2位年份；%H是24小时制，%I是12小时制，新手易混淆；</li>
<li>避坑5：导入标准库时，模块名不要写错（比如math不要写成Math、random不要写成Random），否则会报错“模块不存在”。</li>
</ul>
<blockquote>
<p>以上这些你们会记嘛？不用记，现在 ai 这么发达，只要有印象，到时候 ai 一下就出来了。</p>
</blockquote>
<h3 data-id="heading-10">3 网络编程基础：实现简单的跨程序通信</h3>
<p>网络编程是Python实战中的重要技能，核心是实现“不同设备、不同程序之间的数据传输”。作为基础实战阶段，我们不深入复杂的网络协议，重点掌握<strong>TCP协议的基础用法</strong>（最常用、最可靠的网络协议），实现“本地客户端与服务器端的简单通信”，理解网络编程的核心流程，为后续学习网络爬虫、接口开发打下基础。</p>
<p>核心概念（新手必懂）： - 客户端（Client）：主动发起连接、请求数据的一方（比如我们的浏览器、手机APP）； - 服务器端（Server）：被动接收连接、响应请求的一方（比如网站的服务器）； - Socket（套接字）：网络通信的“桥梁”，客户端和服务器端通过Socket建立连接、传输数据。</p>
<h4 data-id="heading-11">3.1 网络编程核心流程（TCP协议）</h4>
<p>TCP协议的通信流程遵循“三次握手建立连接→传输数据→四次挥手关闭连接”，新手重点掌握“建立连接→传输数据→关闭连接”的基础流程，用Python的socket库实现（内置库，无需额外安装）：</p>
<p>流程拆解： 服务器端：创建Socket→绑定IP和端口→监听连接→接受连接→接收/发送数据→关闭连接； 客户端：创建Socket→连接服务器（IP+端口）→发送/接收数据→关闭连接。</p>
<h4 data-id="heading-12">3.2 实战代码：本地TCP客户端与服务器端通信</h4>
<p>以下代码分为“服务器端”和“客户端”两部分，需分别运行（先运行服务器端，再运行客户端），实现本地（127.0.0.1，本机IP）的简单通信：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ------------- 服务器端代码（server.py）-------------</span>
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 1. 创建Socket对象（AF_INET：IPv4协议，SOCK_STREAM：TCP协议）</span>
server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-comment"># 2. 绑定IP地址和端口（IP：127.0.0.1，本机IP；端口：9999，自定义，1024以上避免冲突）</span>
server_addr = (<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">9999</span>)
server_socket.bind(server_addr)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"服务器已启动，绑定地址：<span class="hljs-subst">{server_addr}</span>，等待客户端连接..."</span>)

<span class="hljs-comment"># 3. 监听连接（参数5：最大等待连接数）</span>
server_socket.listen(<span class="hljs-number">5</span>)

<span class="hljs-comment"># 4. 接受客户端连接（阻塞式，等待客户端发起连接）</span>
client_socket, client_addr = server_socket.accept()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"客户端<span class="hljs-subst">{client_addr}</span>已连接！"</span>)

<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 5. 接收客户端发送的数据（recv(1024)：每次最多接收1024字节，需解码为字符串）</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        data = client_socket.recv(<span class="hljs-number">1024</span>).decode(<span class="hljs-string">"utf-8"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:  <span class="hljs-comment"># 若客户端关闭连接，data为空，退出循环</span>
            <span class="hljs-keyword">break</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"收到客户端<span class="hljs-subst">{client_addr}</span>的消息：<span class="hljs-subst">{data}</span>"</span>)
        
        <span class="hljs-comment"># 6. 向客户端发送响应数据（需编码为bytes类型）</span>
        response = <span class="hljs-string">f"服务器已收到消息：<span class="hljs-subst">{data}</span>，时间：<span class="hljs-subst">{time.strftime(<span class="hljs-string">'%H:%M:%S'</span>)}</span>"</span>
        client_socket.send(response.encode(<span class="hljs-string">"utf-8"</span>))
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 7. 关闭连接（先关闭客户端连接，再关闭服务器端连接）</span>
    client_socket.close()
    server_socket.close()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"与客户端<span class="hljs-subst">{client_addr}</span>的连接已关闭，服务器已停止运行"</span>)

<span class="hljs-comment"># ------------- 客户端代码（client.py）-------------</span>
<span class="hljs-keyword">import</span> socket

<span class="hljs-comment"># 1. 创建Socket对象（与服务器端一致，IPv4+TCP）</span>
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

<span class="hljs-comment"># 2. 连接服务器（指定服务器的IP和端口，与服务器端一致）</span>
server_addr = (<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">9999</span>)
<span class="hljs-keyword">try</span>:
    client_socket.connect(server_addr)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"成功连接到服务器<span class="hljs-subst">{server_addr}</span>！"</span>)
    
    <span class="hljs-comment"># 3. 向服务器发送数据（输入消息，发送给服务器）</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        msg = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入要发送给服务器的消息（输入'quit'退出）："</span>)
        <span class="hljs-keyword">if</span> msg == <span class="hljs-string">"quit"</span>:
            <span class="hljs-keyword">break</span>
        <span class="hljs-comment"># 发送数据：字符串编码为bytes类型</span>
        client_socket.send(msg.encode(<span class="hljs-string">"utf-8"</span>))
        
        <span class="hljs-comment"># 4. 接收服务器的响应数据</span>
        response = client_socket.recv(<span class="hljs-number">1024</span>).decode(<span class="hljs-string">"utf-8"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"服务器响应：<span class="hljs-subst">{response}</span>"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 5. 关闭连接</span>
    client_socket.close()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"与服务器的连接已关闭"</span>)
</code></pre>
<h4 data-id="heading-13">3.3 代码运行说明与实战拓展</h4>
<ul>
<li>运行步骤：① 新建两个.py文件（server.py、client.py），分别复制上面的代码；② 先运行server.py（服务器启动，等待连接）；③ 再运行client.py（客户端连接服务器）；④ 在客户端输入消息，即可实现双向通信，输入“quit”退出。</li>
<li>实战拓展：将前阶段的“文件操作”结合进来，实现“客户端向服务器发送文件内容，服务器接收后保存到本地”（比如客户端读取test.txt文件，发送给服务器，服务器保存为server_test.txt）。</li>
</ul>
<h4 data-id="heading-14">3.4 新手避坑指南（网络编程基础必看）</h4>
<ul>
<li>避坑1：必须“先启动服务器端，再启动客户端”，否则客户端会报错“连接拒绝”；</li>
<li>避坑2：IP地址和端口必须一致，服务器端绑定的IP和端口，客户端必须完全对应（比如服务器绑定127.0.0.1:9999，客户端也要连接这个地址）；</li>
<li>避坑3：TCP通信中，send()发送的是bytes类型数据，recv()接收的也是bytes类型，必须用encode("utf-8")编码、decode("utf-8")解码，否则会报错或出现乱码；</li>
<li>避坑4：端口号需选择1024以上的（1024以下是系统标准端口，可能被占用），若运行时报错“端口已被占用”，可更换端口（比如改为10000）；</li>
<li>避坑5：服务器端的accept()、recv()是“阻塞式”的，会一直等待客户端的连接/数据，新手无需深究，后续进阶再学习非阻塞编程；</li>
<li>避坑6：通信结束后，必须关闭Socket连接（close()），避免资源泄露。</li>
</ul>
<h3 data-id="heading-15">4 多线程基础：实现程序的并发执行</h3>
<p>在前面的学习中，我们编写的代码都是“单线程”的——程序从上到下，依次执行，一次只能做一件事（比如程序执行延迟时，会一直卡住，无法做其他操作）。而“多线程”，能让程序“同时执行多个任务”（并发执行），提升程序效率，尤其适合I/O密集型任务（比如文件操作、网络请求、延迟执行）。</p>
<p>作为基础实战阶段，我们重点掌握Python threading模块的基础用法（内置库，无需额外安装），实现简单的多线程并发，理解多线程的核心概念和优势，不深入复杂的线程安全、锁机制（后续进阶再学习）。</p>
<p>核心概念（新手必懂）： - 线程（Thread）：程序执行的最小单位，一个程序可以包含多个线程； - 主线程：程序启动后，默认创建的线程（比如我们之前写的代码，都是主线程在执行）； - 子线程：我们手动创建的线程，用于执行额外的任务，与主线程并发执行。</p>
<h4 data-id="heading-16">4.1 多线程基础用法（两种常用方式）</h4>
<p>新手重点掌握两种创建子线程的方式：① 传入target函数（推荐，简单易懂）；② 继承Thread类（进阶用法，简单了解），结合实战案例讲解：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># ---------------- 方式1：传入target函数（推荐，新手首选）----------------</span>
<span class="hljs-comment"># 定义要在子线程中执行的函数（比如模拟下载任务）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">download_task</span>(<span class="hljs-params">task_name, delay</span>):
    <span class="hljs-string">"""模拟下载任务：延迟delay秒，模拟下载耗时"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子线程启动：开始下载<span class="hljs-subst">{task_name}</span>，预计耗时<span class="hljs-subst">{delay}</span>秒"</span>)
    time.sleep(delay)  <span class="hljs-comment"># 模拟下载耗时（I/O阻塞）</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子线程结束：<span class="hljs-subst">{task_name}</span>下载完成！"</span>)

<span class="hljs-comment"># 1. 创建子线程（target：子线程要执行的函数；args：传入函数的参数，元组类型）</span>
thread1 = threading.Thread(target=download_task, args=(<span class="hljs-string">"电影A"</span>, <span class="hljs-number">3</span>))
thread2 = threading.Thread(target=download_task, args=(<span class="hljs-string">"音乐B"</span>, <span class="hljs-number">2</span>))

<span class="hljs-comment"># 2. 启动子线程（start()：启动线程，自动调用target函数）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"主线程：开始执行程序"</span>)
thread1.start()
thread2.start()

<span class="hljs-comment"># 3. 等待子线程执行完毕（join()：阻塞主线程，等待子线程结束后，主线程再继续）</span>
thread1.join()
thread2.join()

<span class="hljs-built_in">print</span>(<span class="hljs-string">"主线程：所有子线程执行完毕，程序结束"</span>)

<span class="hljs-comment"># ---------------- 方式2：继承Thread类（简单了解）----------------</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span>(threading.Thread):
    <span class="hljs-string">"""自定义线程类，继承Thread类，重写run()方法"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, task_name, delay</span>):
        <span class="hljs-built_in">super</span>().__init__()  <span class="hljs-comment"># 调用父类的初始化方法</span>
        self.task_name = task_name
        self.delay = delay
    
    <span class="hljs-comment"># 重写run()方法：子线程启动后，会自动执行run()方法中的代码</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子线程启动：开始下载<span class="hljs-subst">{self.task_name}</span>，预计耗时<span class="hljs-subst">{self.delay}</span>秒"</span>)
        time.sleep(self.delay)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子线程结束：<span class="hljs-subst">{self.task_name}</span>下载完成！"</span>)

<span class="hljs-comment"># 创建自定义线程对象</span>
thread3 = MyThread(<span class="hljs-string">"图片C"</span>, <span class="hljs-number">1</span>)
thread4 = MyThread(<span class="hljs-string">"文档D"</span>, <span class="hljs-number">4</span>)

<span class="hljs-comment"># 启动子线程</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n主线程：开始执行自定义线程程序"</span>)
thread3.start()
thread4.start()

<span class="hljs-comment"># 等待子线程结束</span>
thread3.join()
thread4.join()

<span class="hljs-built_in">print</span>(<span class="hljs-string">"主线程：所有自定义线程执行完毕，程序结束"</span>)
</code></pre>
<h4 data-id="heading-17">4.2 多线程的优势（实战对比）</h4>
<p>通过“单线程”与“多线程”的执行时间对比，直观感受多线程的并发优势（适合I/O密集型任务）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 定义任务函数（模拟I/O阻塞，比如下载、文件读取）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">name, delay</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"任务<span class="hljs-subst">{name}</span>开始执行，耗时<span class="hljs-subst">{delay}</span>秒"</span>)
    time.sleep(delay)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"任务<span class="hljs-subst">{name}</span>执行完毕"</span>)

<span class="hljs-comment"># ---------------- 单线程执行（依次执行3个任务）----------------</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 单线程执行 ==="</span>)
start_time1 = time.time()

task(<span class="hljs-string">"A"</span>, <span class="hljs-number">3</span>)
task(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>)
task(<span class="hljs-string">"C"</span>, <span class="hljs-number">1</span>)

end_time1 = time.time()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"单线程总耗时：<span class="hljs-subst">{<span class="hljs-built_in">round</span>(end_time1 - start_time1, <span class="hljs-number">2</span>)}</span>秒\n"</span>)  <span class="hljs-comment"># 总耗时约6秒</span>

<span class="hljs-comment"># ---------------- 多线程执行（3个任务并发执行）----------------</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 多线程执行 ==="</span>)
start_time2 = time.time()

<span class="hljs-comment"># 创建3个子线程</span>
t1 = threading.Thread(target=task, args=(<span class="hljs-string">"A"</span>, <span class="hljs-number">3</span>))
t2 = threading.Thread(target=task, args=(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>))
t3 = threading.Thread(target=task, args=(<span class="hljs-string">"C"</span>, <span class="hljs-number">1</span>))

<span class="hljs-comment"># 启动所有子线程</span>
t1.start()
t2.start()
t3.start()

<span class="hljs-comment"># 等待所有子线程结束</span>
t1.join()
t2.join()
t3.join()

end_time2 = time.time()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"多线程总耗时：<span class="hljs-subst">{<span class="hljs-built_in">round</span>(end_time2 - start_time2, <span class="hljs-number">2</span>)}</span>秒"</span>)  <span class="hljs-comment"># 总耗时约3秒（取决于最长任务）</span>
</code></pre>
<p>运行结果分析：单线程执行3个任务，总耗时是3+2+1=6秒；多线程并发执行，总耗时约3秒（等于最长任务的耗时），明显提升了程序效率——这就是多线程的核心优势，适合处理“需要等待的任务”。</p>
<h4 data-id="heading-18">4.3 新手避坑指南（多线程基础必看）</h4>
<ul>
<li>避坑1：启动线程必须用 <code>start()</code> 方法，不能用 <code>run()</code> 方法——start()会创建子线程，并发执行；run()只是普通函数调用，还是单线程执行；</li>
<li>避坑2：<code>join()</code> 方法的作用是“阻塞主线程”，等待子线程执行完毕，若不调用join()，主线程会直接结束，子线程可能还未执行完就被终止；</li>
<li>避坑3：Python中存在“全局解释器锁（GIL）”，同一时刻只有一个线程能执行Python代码——多线程适合I/O密集型任务（如下载、延迟），不适合CPU密集型任务（如大量计算），新手无需深究GIL，知道这个特性即可；</li>
<li>避坑4：多个子线程共享全局变量时，可能会出现“线程安全问题”（比如多个线程同时修改一个全局变量，导致数据错误），基础阶段暂时不处理，后续进阶学习“锁机制”解决；</li>
<li>避坑5：不要创建过多的子线程（比如几百、几千个），会占用大量系统资源，导致程序卡顿，按需创建即可。</li>
</ul>
<h3 data-id="heading-19">5 总结</h3>
<p>恭喜大家！Python3基础学习第七阶段「基础实战巩固」的核心内容，到这里就全部梳理完毕了！这一阶段，我们没有学习新的复杂语法，而是聚焦“实战巩固”，将前六阶段的知识串联起来，通过四大实战方向，实现了从“会用”到“活用”的跨越：</p>
<ul>
<li>常用内置函数：掌握了len、range、enumerate、zip等高频工具，学会用内置函数简化代码，提升编码效率；</li>
<li>简单标准库：熟练使用math、random、time三个常用标准库，能解决数学计算、随机场景、时间处理等日常实战需求；</li>
<li>网络编程基础：掌握TCP协议的核心流程，实现了本地客户端与服务器端的简单通信，理解了跨程序通信的原理；</li>
<li>多线程基础：学会用threading模块创建子线程，实现程序的并发执行，提升I/O密集型任务的效率。</li>
</ul>
<p>本阶段的核心重点是“实战”——新手不要只看代码、记语法，一定要亲手敲写每个案例，调试报错，结合前阶段的知识（函数、模块、文件操作等）拓展实战场景，比如：用多线程实现多文件下载、用网络编程+文件操作实现文件传输、用内置函数+标准库编写简单的验证码生成器。</p>
<p>对于新手来说，本阶段可能会觉得多线程、网络编程有点难度，尤其是“并发”“Socket连接”的逻辑，容易混淆步骤——没关系，多动手练习，先掌握基础用法，再逐步理解原理，重点是能独立写出可运行的实战代码，巩固基础。</p>
<p>到这里，Python3基础学习的七个阶段就全部结束了！通过这七个阶段的学习，你已经掌握了Python的核心基础语法、模块化编程、面向对象、实战工具、网络与并发基础，具备了独立编写简单Python项目的能力。</p>
<p>接下来，你可以尝试挑战简单的实战项目（比如学生管理系统、通讯录、简易爬虫、验证码生成器），将七个阶段的知识综合运用，查漏补缺。后续我们还会进入Python进阶学习阶段，学习更复杂的框架、项目开发技巧，继续加油，你已经离“合格的Python开发者”越来越近啦～</p>
<hr/>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德 @一个有梦有戏的人</strong><br/>
持续创作很不容易，作者将以尽可能的详细把所学知识分享各位开发者，一起进步一起学习。<strong>转载请携带链接，转载到微信公众号请勿选择原创，谢谢！</strong><br/>
👍创作不易，如有错误请指正，感谢观看！记得点赞哦！👍<br/>
谢谢支持！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[hCaptcha 验证码图像识别 API 对接教程]]></title>    <link>https://juejin.cn/post/7604793276907257919</link>    <guid>https://juejin.cn/post/7604793276907257919</guid>    <pubDate>2026-02-10T08:05:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604793276907257919" data-draft-id="7604793276907241535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="hCaptcha 验证码图像识别 API 对接教程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T08:05:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            hCaptcha 验证码图像识别 API 对接教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T08:05:43.000Z" title="Tue Feb 10 2026 08:05:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 hCaptcha 图像识别 API 对接说明，它可以通过用户输入识别的内容和 hCaptcha验证码图像，最后返回需要点击的小图像的坐标，完成验证。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fc9a5cc2f-e410-425f-857a-f8700205da6c%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/c9a5cc2f-e410-425f-857a-f8700205da6c?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">hCaptcha 图像识别 API</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fc9a5cc2f-e410-425f-857a-f8700205da6c%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/c9a5cc2f-e410-425f-857a-f8700205da6c?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">platform.acedata.cloud/documents/c…</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入需要处理 hCaptcha验证码图像，便可获得处理后的结果，首先需要简单地传递一个 <code>queries</code> 字段，这个就是具体hCaptcha验证码图像，我们需要去一个有hCaptcha验证码网站中截取这个验证码图片，示例网站链接为： <code>https://democaptcha.com/demo-form-eng/hcaptcha.html</code>，点击复选框即可显示具体的完整验证码图片，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/xryo59.png" width="500" class="m-auto" loading="lazy"/></p>
<p>其中<code>queries</code> 字段是上文中验证码图像的截图，图片大小建议不要超过100kb，还需要对上面图片红色箭头指向的区域进行截图，并且还需要你自行压缩图片大小，并且还需要将它转换为Base64编码，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/g8ikkb.png" width="500" class="m-auto" loading="lazy"/></p>
<p>同时还需要输入跟验证码图像相关的识别内容参数 <code>question</code>，这个支持中英文翻译，可以直接传相关的识别内容，由上文网页图像中黄色箭头执行的内容可以看出 <code>question</code> 输入的应为 <code>Please click on the UNIQUE object among the others.</code>。具体的内容如下：</p>
<p><img src="https://cdn.acedata.cloud/empncr.png" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>queries</code>：Base64编码的验证码图像列表。</li>
<li><code>question</code>：验证码图像相关的识别内容参数，支持直接输入中英文。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/bww9b0.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"solution"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Please click on the UNIQUE object among the others"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"box"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"360"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"276"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"confidences"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6354503631591797</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>solution</code>，此次 hCaptcha验证码图像 任务处理后验证结果。
<ul>
<li><code>label</code>，hCaptcha验证码图像所识别的内容。</li>
<li><code>box</code>，hCaptcha验证码图像识别结果的位置信息，它是由图像的坐标信息构成。</li>
<li><code>confidences</code>，hCaptcha验证码图像识别后满足识别内容的的置信度。</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了处理 hCaptcha验证码图像 的验证结果，我们只需要根据结果中 <code>box</code> 的位置坐标信息对该验证码图像进行模拟点击该区域便可通过验证。</p>
<p>下面将介绍如何通过结果的 <code>box</code> 的位置信息如何来点击，首先是针对上传的验证码图片进行建立直角坐标系，其中中心原点在图像的左下角，360是对应的横坐标，276是对应的纵坐标，我们只需要通过模拟点击验证码对应的坐标进行点击即可，具体的图像信息如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/4ykvbl.png" width="500" class="m-auto" loading="lazy"/></p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/captcha/recognition/hcaptcha' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "question": "Please click on the UNIQUE object among the others.",
  "queries": ["iVBORw0KGgoAAAANSU.....eY+85KVlzKHav28uq/WLVhL2kHUlFMKUcZbL31S8bpd0pEPKxNllXAE2wgu3uEfj+BfAzOGelsQNFAAAAAElFTkSuQmCC"]
}'
}'
</code></pre>
<p>Python 的对接代码如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/captcha/recognition/hcaptcha"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"question"</span>: <span class="hljs-string">"Please click on the UNIQUE object among the others."</span>,
    <span class="hljs-string">"queries"</span>: [<span class="hljs-string">"iVBORw0KGgoAAAANSU.....eY+85KVlzKHav28uq/WLVhL2kHUlFMKUcZbL31S8bpd0pEPKxNllXAE2wgu3uEfj+BfAzOGelsQNFAAAAAElFTkSuQmCC"</span>]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<h2 data-id="heading-2">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-3">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">结论</h2>
<p>通过本文档，您已经了解了如何使用 hCaptcha 图像识别 API 让用户输入识别的内容和 hCaptcha验证码图像，最后返回需要点击的小图像的坐标，完成验证。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 状态数据设计 [8 - 4]：有限状态机 (FSM) 在复杂前端逻辑中的应用]]></title>    <link>https://juejin.cn/post/7604039449468977202</link>    <guid>https://juejin.cn/post/7604039449468977202</guid>    <pubDate>2026-02-09T07:09:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604039449468977202" data-draft-id="7604344066580217907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 状态数据设计 [8 - 4]：有限状态机 (FSM) 在复杂前端逻辑中的应用"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-09T07:09:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 状态数据设计 [8 - 4]：有限状态机 (FSM) 在复杂前端逻辑中的应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T07:09:41.000Z" title="Mon Feb 09 2026 07:09:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>想象一下，你正在开发一个“自动驾驶”系统。</p>
<p>你绝不会用 <code>if (isAccelerating &amp;&amp; !isBraking)</code> 来控制汽车。你会定义清晰的状态：<code>Driving</code>、<code>Braking</code>、<code>Parked</code>。因为在 <code>Parked</code>（停车）状态下，踩油门是不应该有反应的。</p>
<p><strong>前端业务逻辑其实就是一套交互系统。</strong></p>
<p>遗憾的是，大部分前端代码都在用“零散的布尔值”来模拟状态，这导致逻辑极难测试，且隐藏着巨大的状态冲突风险。</p>
<p>真正优雅的架构，应该把逻辑抽象成一张<strong>图</strong>。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34e3973e4ef647968a3419a309faa8ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771225781&amp;x-signature=XYmF42SkctIieosI40qvbjT8EYE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 为什么布尔值会导致“状态爆炸”？</h2>
<p>假设你有一个极其简单的“搜索框”。</p>
<p>你定义了三个变量：<code>loading</code> (加载中)、<code>error</code> (报错)、<code>results</code> (数据)。</p>
<p>理论上这只有 3 个变量，但它们的组合可能有 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>3</mn></msup><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">2^3 = 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">8</span></span></span></span></span> 种。</p>
<ul>
<li><code>loading: true, error: true</code> —— 这代表什么？一边报错一边加载？</li>
<li><code>loading: false, error: false, results: []</code> —— 这是初始状态？还是没搜到结果？</li>
</ul>
<p>随着业务逻辑增加（比如增加了“取消请求”、“重试”、“分步校验”），布尔值的组合会指数级增长。这就是 <strong>“状态爆炸”</strong> 。</p>
<hr/>
<h2 data-id="heading-1">二、 有限状态机 (FSM) 的核心概念</h2>
<p>有限状态机不是一个库，而是一个数学模型。它包含四个要素：</p>
<ol>
<li><strong>State (状态):</strong> 你的应用当前在哪？（如：<code>idle</code>、<code>loading</code>、<code>success</code>、<code>failure</code>）。<strong>同一时间只能处在一个状态。</strong></li>
<li><strong>Event (事件):</strong> 发生了什么？（如：<code>SEARCH</code>、<code>CANCEL</code>、<code>RESOLVE</code>）。</li>
<li><strong>Transition (转换):</strong> 状态改变的规则。例如：在 <code>loading</code> 状态下收到 <code>CANCEL</code> 事件，转为 <code>idle</code>。</li>
<li><strong>Action (动作):</strong> 转换时触发的副作用。例如：进入 <code>loading</code> 状态时，发起 API 请求。</li>
</ol>
<hr/>
<h2 data-id="heading-2">三、 实战：用 XState 终结逻辑乱麻</h2>
<p>在 JS 生态中，<strong>XState</strong> 是状态机的集大成者。我们来看如何重构一个复杂的“文件上传”逻辑。</p>
<h3 data-id="heading-3">3.1 定义状态图</h3>
<p>与其写一堆 <code>if/else</code>，不如先把图画出来：</p>
<pre><code class="hljs language-php" lang="php">import { createMachine, interpret } <span class="hljs-keyword">from</span> <span class="hljs-string">'xstate'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">uploadMachine</span> = <span class="hljs-title function_ invoke__">createMachine</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-string">'upload'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-string">'idle'</span>, // 初始：闲置
  <span class="hljs-attr">states</span>: {
    <span class="hljs-attr">idle</span>: {
      <span class="hljs-attr">on</span>: { <span class="hljs-attr">SUBMIT</span>: <span class="hljs-string">'validating'</span> } // 收到提交事件 -&gt; 进入校验
    },
    <span class="hljs-attr">validating</span>: {
      <span class="hljs-attr">on</span>: {
        <span class="hljs-attr">VALID_SUCCESS</span>: <span class="hljs-string">'uploading'</span>, // 校验成功 -&gt; 开始上传
        <span class="hljs-attr">VALID_FAIL</span>: <span class="hljs-string">'error'</span>         // 校验失败 -&gt; 报错
      }
    },
    <span class="hljs-attr">uploading</span>: {
      <span class="hljs-attr">on</span>: {
        <span class="hljs-attr">FINISH</span>: <span class="hljs-string">'success'</span>,
        <span class="hljs-attr">FAIL</span>: <span class="hljs-string">'error'</span>,
        <span class="hljs-attr">CANCEL</span>: <span class="hljs-string">'idle'</span> // 上传中途取消 -&gt; 回到闲置
      }
    },
    <span class="hljs-attr">success</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'final'</span> // 终态
    },
    <span class="hljs-attr">error</span>: {
      <span class="hljs-attr">on</span>: { <span class="hljs-attr">RETRY</span>: <span class="hljs-string">'uploading'</span> } // 报错后可以重试
    }
  }
});
</code></pre>
<h3 data-id="heading-4">3.2 架构层面的收益</h3>
<ul>
<li><strong>防御性编程：</strong> 在 <code>success</code> 状态下，哪怕用户疯狂点击 <code>SUBMIT</code> 按钮，状态机也会自动忽略这个事件，因为 <code>success</code> 状态下没有定义处理 <code>SUBMIT</code> 的转换。</li>
<li><strong>逻辑可视化：</strong> XState 提供可视化工具，你可以直接把代码生成的图发给产品经理确认：“你看，这是不是我们要的业务流程？”</li>
</ul>
<hr/>
<h2 data-id="heading-5">四、 什么时候该引入状态机？</h2>
<p>并不是所有的组件都需要状态机。作为架构师，你需要识别**“高价值逻辑”**。</p>
<h3 data-id="heading-6">4.1 推荐使用场景：</h3>
<ol>
<li><strong>多步骤流程：</strong> 注册流程、结账链路、多步表单。</li>
<li><strong>复杂权限交互：</strong> 比如一个按钮，根据登录状态、用户等级、账户余额、活动是否开始，有五六种显示逻辑。</li>
<li><strong>核心支付/上传：</strong> 绝不允许出现非法状态转换的场景。</li>
<li><strong>游戏逻辑或复杂动效：</strong> 状态转换之间有严格的时间顺序。</li>
</ol>
<h3 data-id="heading-7">4.2 什么时候不用？</h3>
<p>简单的开关（Toggle）、单纯的 CRUD 列表展示，直接用 <code>useState</code> 或 TanStack Query 就足够了。</p>
<hr/>
<h2 data-id="heading-8">五、 状态机 vs. 状态管理库</h2>
<p>这是很多人的误区。<strong>状态机不是 Redux 的替代品。</strong></p>
<ul>
<li><strong>Redux/Zustand</strong> 是“仓库”：负责<strong>存</strong>数据。</li>
<li><strong>XState</strong> 是“大脑”：负责<strong>管</strong>逻辑。</li>
</ul>
<p><strong>架构模式：</strong> 你可以在 Zustand 里面跑一个 XState。XState 负责计算当前应该是哪个状态，然后把最终的结果（如当前是哪个 Tab，要显示哪个文案）更新到 Zustand 中供全局使用。</p>
<hr/>
<h2 data-id="heading-9">结语：迈向“可预测”的架构</h2>
<p>我们在第八阶段完成了对数据流的全面重构：</p>
<ol>
<li><strong>哲学上：</strong> 选择了适合业务的模式（Redux/Atomic）。</li>
<li><strong>性能上：</strong> 理解了细粒度更新（Signals）的内核。</li>
<li><strong>结构上：</strong> 剥离了 API 数据（TanStack Query）。</li>
<li><strong>逻辑上：</strong> 用状态机（FSM）替代了布尔值地狱。</li>
</ol>
<p>至此，你的前端应用已经像一台精密运行的瑞士钟表：每一滴水的流向（数据）都是可追踪的，每一个齿轮的转动（逻辑）都是可预测的。</p>
<blockquote>
<p><strong>Next Step:</strong></p>
<p>下一个阶段，我们将跳出纯代码层面，进入**《第九阶段：前端工程化体系与全链路质量保障》 <strong>。 我们将探讨：如何搭建一套让 50 人的团队协作而不打架的 Monorepo 体系？如何设计自动化的 CI/CD 流程，让性能劣化和 Bug 在合并代码前就被击毙？ 第一篇，我们将聊聊</strong>《架构的地基：基于 Turborepo 与 pnpm 的现代 Monorepo 企业级实战》**。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零实现富文本编辑器#11-Immutable状态维护与增量渲染]]></title>    <link>https://juejin.cn/post/7604084016510353449</link>    <guid>https://juejin.cn/post/7604084016510353449</guid>    <pubDate>2026-02-09T02:48:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604084016510353449" data-draft-id="7603895839557419071" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零实现富文本编辑器#11-Immutable状态维护与增量渲染"/> <meta itemprop="keywords" content="前端,架构,前端框架"/> <meta itemprop="datePublished" content="2026-02-09T02:48:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WindRunnerMax"/> <meta itemprop="url" content="https://juejin.cn/user/1829999989247214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零实现富文本编辑器#11-Immutable状态维护与增量渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1829999989247214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WindRunnerMax
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T02:48:19.000Z" title="Mon Feb 09 2026 02:48:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    39
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在先前我们讨论了视图层的适配器设计，主要是全量的视图初始化渲染，包括生命周期同步、状态管理、渲染模式、<code>DOM</code>映射状态等。在这里我们需要处理变更的增量更新，这属于性能方面的考量，需要考虑如何实现不可变的状态对象，以此来实现<code>Op</code>操作以及最小化<code>DOM</code>变更。</p>
<ul>
<li>开源地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FBlockKit" target="_blank" title="https://github.com/WindRunnerMax/BlockKit" ref="nofollow noopener noreferrer">github.com/WindRunnerM…</a></li>
<li>在线编辑: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwindrunnermax.github.io%2FBlockKit%2F" target="_blank" title="https://windrunnermax.github.io/BlockKit/" ref="nofollow noopener noreferrer">windrunnermax.github.io/BlockKit/</a></li>
<li>项目笔记: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FBlockKit%2Fblob%2Fmaster%2FNOTE.md" target="_blank" title="https://github.com/WindRunnerMax/BlockKit/blob/master/NOTE.md" ref="nofollow noopener noreferrer">github.com/WindRunnerM…</a></li>
</ul>
<details>
<summary><strong>从零实现富文本编辑器系列文章</strong></summary>
<ul>
<li><a href="https://juejin.cn/post/7490554094412611636" target="_blank" title="https://juejin.cn/post/7490554094412611636">深感一无所长，准备试着从零开始写个富文本编辑器</a></li>
<li><a href="https://juejin.cn/post/7492339631700377652" target="_blank" title="https://juejin.cn/post/7492339631700377652">从零实现富文本编辑器#2-基于MVC模式的编辑器架构设计</a></li>
<li><a href="https://juejin.cn/post/7494920513967112227" target="_blank" title="https://juejin.cn/post/7494920513967112227">从零实现富文本编辑器#3-基于Delta的线性数据结构模型</a></li>
<li><a href="https://juejin.cn/post/7508648111485665295" target="_blank" title="https://juejin.cn/post/7508648111485665295">从零实现富文本编辑器#4-浏览器选区模型的核心交互策略</a></li>
<li><a href="https://juejin.cn/post/7513183180091523107" target="_blank" title="https://juejin.cn/post/7513183180091523107">从零实现富文本编辑器#5-编辑器选区模型的状态结构表达</a></li>
<li><a href="https://juejin.cn/post/7534162607894347828" target="_blank" title="https://juejin.cn/post/7534162607894347828">从零实现富文本编辑器#6-浏览器选区与编辑器选区模型同步</a></li>
<li><a href="https://juejin.cn/post/7544561402783793192" target="_blank" title="https://juejin.cn/post/7544561402783793192">从零实现富文本编辑器#7-基于组合事件的半受控输入模式</a></li>
<li><a href="https://juejin.cn/post/7562526517516812331" target="_blank" title="https://juejin.cn/post/7562526517516812331">从零实现富文本编辑器#8-浏览器输入模式的非受控DOM行为</a></li>
<li><a href="https://juejin.cn/spost/7585778343352221759" target="_blank" title="https://juejin.cn/spost/7585778343352221759">从零实现富文本编辑器#9-编辑器文本结构变更的受控处理</a></li>
<li><a href="https://juejin.cn/spost/7593702885880725540" target="_blank" title="https://juejin.cn/spost/7593702885880725540">从零实现富文本编辑器#10-React视图层适配器的模式扩展</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">从零实现富文本编辑器#11-Immutable状态维护与增量渲染</a></li>
</ul>
</details>
<h2 data-id="heading-0">行级不可变状态</h2>
<p>在这里我们先不引入视图层的渲染问题，而是仅在<code>Model</code>层面上实现精细化的处理，具体来说就是实现不可变的状态对象，仅更新的节点才会被重新创建，其他节点则直接复用。由此想来此模块的实现颇为复杂，也并未引入<code>immer</code>等框架，而是直接处理的状态对象，因此先从简单的更新模式开始考虑。</p>
<p>回到最开始实现的<code>State</code>模块更新文档内容，我们是直接重建了所有的<code>LineState</code>以及<code>LeafState</code>对象，然后在<code>React</code>视图层的<code>BlockModel</code>中监听了<code>OnContentChange</code>事件，以此来将<code>BlockState</code>的更新应用到视图层。</p>
<pre><code class="hljs language-js" lang="js">delta.<span class="hljs-title function_">eachLine</span>(<span class="hljs-function">(<span class="hljs-params">line, attributes, index</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> lineState = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LineState</span>(line, attributes, <span class="hljs-variable language_">this</span>);
  lineState.<span class="hljs-property">index</span> = index;
  lineState.<span class="hljs-property">start</span> = offset;
  lineState.<span class="hljs-property">key</span> = <span class="hljs-title class_">Key</span>.<span class="hljs-title function_">getId</span>(lineState);
  offset = offset + lineState.<span class="hljs-property">length</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">lines</span>[index] = lineState;
});
</code></pre>
<p>这种方式简单直接，全量更新状态能够保证在<code>React</code>的状态更新，然而这种方式的问题在于性能。当文档内容非常大的时候，全量计算将会导致大量的状态重建，并且其本身的改变也会导致<code>React</code>的<code>diff</code>差异进而全量更新文档视图，这样的性能开销通常是不可接受的。</p>
<p>那么通常来说我们就需要基于变更来确定状态的更新，首先我们需要确定更新的粒度，例如以行为基准则未变更的时候就直接取原有的<code>LineState</code>。相当于尽可能复用<code>Origin List</code>然后生成<code>Target List</code>，这样的方式自然可以避免部分状态的重建，尽可能复用原本的对象。</p>
<p>整体思路大概是先执行变成生成最新的列表，然后分别设置旧列表和新列表的<code>row</code>和<code>col</code>两个指针值，然后更新时记录起始<code>row</code>，删除和新增自然是正常处理，对于更新则认为是先删后增。对于内容的处理则需要分别讨论单行和跨行的问题，中间部分的内容就作为重建的操作。</p>
<p>最后可以将这部分增删<code>LineState</code>数据放置于<code>Changes</code>中，就可以得到实际增删的<code>Ops</code>了，这样我们就可以优化部分的性能，因为仅原列表和目标列表的中间部分才会重建，其他部分的行状态直接复用。此外这部分数据在<code>apply</code>的<code>delta</code>中是不存在的，同样可以认为是数据的补充。</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-title class_">Origin</span> <span class="hljs-title class_">List</span> (<span class="hljs-title class_">Old</span>)                          <span class="hljs-title class_">Target</span> <span class="hljs-title class_">List</span> (<span class="hljs-title class_">New</span>)
+-------------------+                      +-------------------+
| [<span class="hljs-number">0</span>] <span class="hljs-title class_">LineState</span> A   | &lt;---- Retain ------&gt; | [0] LineState A   | (Reused)
+-------------------+                      +-------------------+
| [1] LineState B   |          |           | [1] LineState B2  | (Update)
+-------------------+       Changes        |     (Modified)    | (Del C)
| [2] LineState C   |          |           +-------------------+
+-------------------+          V           | [2] NewState X    | (Inserted)
| [3] LineState D   | ---------------\     +-------------------+
+-------------------+                 --&gt; | [3] LineState D   | (Reused)
| [4] LineState E   | &lt;---- Retain ------&gt; | [4] LineState E   | (Reused)
+-------------------+                      +-------------------+
</code></pre>
<p>那么这里实际上是存在非常需要关注的点，我们现在维护的是状态模型，也就是说所有的更新就不再是直接的<code>compose</code>，而是操作我们实现的状态对象。本质上我们是需要实现行级别的<code>compose</code>方法，这里的实现非常重要，假如我们对于数据的处理存在偏差的话，那么就会导致状态出现问题。</p>
<p>此外在这种方式中，我们判断<code>LineState</code>是否需要新建则是根据整个行内的所有<code>LeafState</code>来重建的。也就是说这种时候我们是需要再次将所有的<code>op</code>遍历一遍，当然实际上由于最后还需要将<code>compose</code>后的<code>Delta</code>切割为行级别的内容，所以其实即使在应用变更后也最少需要再遍历两次。</p>
<p>那么此时我们需要思考优化方向，首先是首个<code>retain</code>，在这里我们应该直接完整复用原本的<code>LineState</code>，包括处理后的剩余节点也是如此。而对于中间的节点，我们就需要为其独立设计更新策略，这部分理论上来说是需要完全独立处理为新的状态对象的，这样可以减少部分<code>Leaf Op</code>的遍历。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Delta</span>().<span class="hljs-title function_">retain</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">insert</span>(<span class="hljs-string">"xx"</span>)
<span class="hljs-title function_">insert</span>(<span class="hljs-string">"123"</span>), <span class="hljs-title function_">insert</span>(<span class="hljs-string">"\n"</span>) <span class="hljs-comment">// skip </span>
<span class="hljs-title function_">insert</span>(<span class="hljs-string">"456"</span>), <span class="hljs-title function_">insert</span>(<span class="hljs-string">"\n"</span>) <span class="hljs-comment">// new line state</span>
</code></pre>
<p>其中，如果是新建的节点，我们直接构建新的<code>LineState</code>即可，删除的节点则不从原本的<code>LineState</code>中放置于新的列表。而对于更新的节点，我们需要更新原本的<code>LineState</code>对象，因为实际上行是存在更新的，而重点是我们需要将原本的<code>LineState</code>的<code>key</code>值复用。</p>
<p>这里我们先简单实现实现描述一下复用的问题，比较方便的实现则是直接以<code>\n</code>的标识为目标的<code>State</code>，这就意味着我们要独立<code>\n</code>为独立的状态。即如果在<code>123|456\n</code>的<code>|</code>位置插入<code>\n</code>的话，那么我们就是<code>123</code>是新的<code>LineState</code>，<code>456</code>是原本的<code>LineState</code>，以此来实现<code>key</code>的复用。</p>
<pre><code class="hljs language-js" lang="js">[
  <span class="hljs-title function_">insert</span>(<span class="hljs-string">"123"</span>), <span class="hljs-title function_">insert</span>(<span class="hljs-string">"\n"</span>), 
  <span class="hljs-title function_">insert</span>(<span class="hljs-string">"456"</span>), <span class="hljs-title function_">insert</span>(<span class="hljs-string">"\n"</span>)
]
<span class="hljs-comment">// ===&gt;</span>
[ 
  <span class="hljs-title class_">LineState</span>(<span class="hljs-title class_">LeafState</span>(<span class="hljs-string">"123"</span>), <span class="hljs-title class_">LeafState</span>(<span class="hljs-string">"\n"</span>)), 
  <span class="hljs-title class_">LineState</span>(<span class="hljs-title class_">LeafState</span>(<span class="hljs-string">"456"</span>), <span class="hljs-title class_">LeafState</span>(<span class="hljs-string">"\n"</span>))
]
</code></pre>
<p>其实这里有个非常值得关注的点是，<code>LineState</code>在<code>Delta</code>中是没有具体对应的<code>Op</code>的，而相对应的<code>LeafState</code>则是有具体的<code>Op</code>的。这就意味着我们在处理<code>LineState</code>的更新时，是不能直接根据变更控制的，因此必须要找到能够映射的状态，因此最简单的方案即根据<code>\n</code>节点映射。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">LeafState</span>(<span class="hljs-string">"\n"</span>, key=<span class="hljs-string">"1"</span>) &lt;=&gt; <span class="hljs-title class_">LineState</span>(key=<span class="hljs-string">"L1"</span>)
</code></pre>
<p>实际上我们可以总结一下，最开始我们考虑先更新再<code>diff</code>，后来考虑的是边更新边记录。边更新边记录的优点在于，可以避免再次遍历一边所有<code>Leaf</code>节点的消耗，同时也可以避免<code>diff</code>的复杂性。但是这里也存在个问题，如果内部进行了多次<code>retain</code>操作，则无法直接复用<code>LineState</code>。</p>
<p>不过通常来说，最高频的操作是输入内容，这种情况下首操作一般都是<code>retain</code>，尾操作为空会收集剩余文档内容，因此这部分优化是会被高频触发的。而如果是多次的内容部分变更操作，这部分虽然可以通过判断行内的叶子结点是否变更，来判断是否复用行对象，但是也存在一定复杂性。</p>
<p>关于这部分的具体实现，在编辑器的状态模块里存在独立的<code>Mutate</code>模块，这部分实现在后边实现各个模块时会独立介绍。到这里我们就可以实现一个简单的<code>Immutable</code>状态维护，如果<code>Leaf</code>节点发生变化之后，其父节点<code>Line</code>会触发更新，而其他节点则可以直接复用。</p>
<h2 data-id="heading-1">Key 值维护</h2>
<p>至此我们实现了一套简单的<code>Immutable Delta+Iterator</code>来处理更新，这种时候我们就可以借助不可变的方式来实现<code>React</code>视图的更新，那么在<code>React</code>的渲染模式中，<code>key</code>值的管理也是个值的探讨的问题。</p>
<p>在这里我们就可以根据状态不可变来生成<code>key</code>值，借助<code>WeakMap</code>映射关系获取对应的字符串<code>id</code>值，此时就可以借助<code>key</code>的管理以及<code>React.memo</code>来实现视图的复用。其实在这里初步看起来<code>key</code>值应该是需要主动控制强制刷新的时候，以及完全是新节点才会用得到的。</p>
<p>但是这种方式也是有问题的，因为此时我们即使输入简单的内容，也会导致整个行的<code>key</code>发生改变，而此时我们是不必要更新此时的<code>key</code>的。因此<code>key</code>值是需要单独维护的，不能直接使用不可变的对象来索引<code>key</code>值，那么如果是直接使用<code>index</code>作为<code>key</code>值的话，就会存在潜在的原地复用问题。</p>
<p><code>key</code>值原地复用会导致组件的状态被错误保留，例如此时有个非受控管理的<code>input</code>组件列表，在某个输入框内已经输入了内容，当其发生顺序变化时，原始输入内容会跟随着原地复用的策略留在原始的位置，而不是跟随到新的位置，因为其整体列表顺序<code>key</code>未发生变化导致<code>React</code>直接复用节点。</p>
<p>在<code>LineState</code>节点的<code>key</code>值维护中，如果是初始值则是根据<code>state</code>引用自增的值，在变更的时候则是尽可能地复用原始行的<code>key</code>，这样可以避免过多的行节点重建并且可以控制整行的强制刷新。</p>
<p>而对于<code>LeafState</code>节点的<code>key</code>值最开始是直接使用<code>index</code>值，这样实际上会存在隐性的问题，而如果直接根据<code>Immutable</code>来生成<code>key</code>值的话，任何文本内容的更改都会导致<code>key</code>值改变进而导致<code>DOM</code>节点的频繁重建。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NODE_TO_KEY</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>&lt;<span class="hljs-title class_">Object</span>.<span class="hljs-property">Any</span>, <span class="hljs-title class_">Key</span>&gt;();
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Key</span> {
  <span class="hljs-comment">/** 当前节点 id */</span>
  public <span class="hljs-attr">id</span>: string;
  <span class="hljs-comment">/** 自动递增标识符 */</span>
  public <span class="hljs-keyword">static</span> n = <span class="hljs-number">0</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-string">`<span class="hljs-subst">${Key.n++}</span>`</span>;
  }

  <span class="hljs-comment">/**
   * 根据节点获取 id
   * <span class="hljs-doctag">@param</span> <span class="hljs-variable">node</span>
   */</span>
  public <span class="hljs-keyword">static</span> <span class="hljs-title function_">getId</span>(<span class="hljs-attr">node</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-property">Any</span>): string {
    <span class="hljs-keyword">let</span> key = <span class="hljs-variable constant_">NODE_TO_KEY</span>.<span class="hljs-title function_">get</span>(node);
    <span class="hljs-keyword">if</span> (!key) {
      key = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Key</span>();
      <span class="hljs-variable constant_">NODE_TO_KEY</span>.<span class="hljs-title function_">set</span>(node, key);
    }
    <span class="hljs-keyword">return</span> key.<span class="hljs-property">id</span>;
  }
}
</code></pre>
<p>通常使用<code>index</code>作为<code>key</code>是可行的，然而在一些非受控场景下则会由于原地复用造成渲染问题，<code>diff</code>算法导致的性能问题我们暂时先不考虑。在下面的例子中我们可以看出，每次我们都是从数组顶部删除元素，而实际的<code>input</code>值效果表现出来则是删除了尾部的元素，这就是原地复用的问题。在非受控场景下比较明显，而我们的<code>ContentEditable</code>组件就是一个非受控场景，因此这里的<code>key</code>值需要再考虑一下。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { useState, <span class="hljs-title class_">Fragment</span>, useRef, useEffect } = <span class="hljs-title class_">React</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> ref = useRef&lt;<span class="hljs-title class_">HTMLParagraphElement</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [nodes, setNodes] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i));

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> [_, ...rest] = nodes;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rest);
    <span class="hljs-title function_">setNodes</span>(rest);
  };

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> el = ref.<span class="hljs-property">current</span>;
    el &amp;&amp; <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(el.<span class="hljs-property">children</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">it, i</span>) =&gt;</span> ((it <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>).<span class="hljs-property">value</span> = i + <span class="hljs-string">""</span>));
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>&gt;</span>
        {nodes.map((_, i) =&gt; (<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span>))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>slice<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Fragment</span>&gt;</span></span>
  );
}
</code></pre>
<p>考虑到先前提到的我们不希望任何文本内容的更改都导致<code>key</code>值改变引发重建，因此就不能直接使用计算的<code>immutable</code>对象引用来处理<code>key</code>值，而描述单个<code>op</code>的方法除了<code>insert</code>就只剩下<code>attributes</code>了。</p>
<p>但是如果基于<code>attributes</code>来获得就需要精准控制合并<code>insert</code>的时候取需要取旧的对象引用，且没有属性的<code>op</code>就不好处理了，因此这里可能只能将其转为字符串处理，但是这样同样不能保持<code>key</code>的完全稳定，因此前值的索引改变就会导致后续的值出现变更。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> prefix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>&lt;<span class="hljs-title class_">LineState</span>, <span class="hljs-title class_">Record</span>&lt;string, number&gt;&gt;();
<span class="hljs-keyword">const</span> suffix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>&lt;<span class="hljs-title class_">LineState</span>, <span class="hljs-title class_">Record</span>&lt;string, number&gt;&gt;();
<span class="hljs-keyword">const</span> mapToString = (<span class="hljs-attr">map</span>: <span class="hljs-title class_">Record</span>&lt;string, string&gt;): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(map)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${key}</span>:<span class="hljs-subst">${map[key]}</span>`</span>)
    .<span class="hljs-title function_">join</span>(<span class="hljs-string">","</span>);
};
<span class="hljs-keyword">const</span> toKey = (<span class="hljs-attr">state</span>: <span class="hljs-title class_">LineState</span>, <span class="hljs-attr">op</span>: <span class="hljs-title class_">Op</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> key = op.<span class="hljs-property">attributes</span> ? <span class="hljs-title function_">mapToString</span>(op.<span class="hljs-property">attributes</span>) : <span class="hljs-string">""</span>;
  <span class="hljs-keyword">const</span> prefixMap = prefix.<span class="hljs-title function_">get</span>(state) || {};
  prefix.<span class="hljs-title function_">set</span>(state, prefixMap);
  <span class="hljs-keyword">const</span> suffixMap = suffix.<span class="hljs-title function_">get</span>(state) || {};
  suffix.<span class="hljs-title function_">set</span>(state, suffixMap);
  <span class="hljs-keyword">const</span> prefixKey = prefixMap[key] ? prefixMap[key] + <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> suffixKey = suffixMap[key] ? suffixMap[key] + <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
  prefixMap[key] = prefixKey;
  suffixMap[key] = suffixKey;
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${prefixKey}</span>-<span class="hljs-subst">${suffixKey}</span>`</span>;
};
</code></pre>
<p>在<code>slate</code>中我先前认为生成的<code>key</code>跟节点是完全一一对应的关系，例如当<code>A</code>节点变化时，其代表的层级<code>key</code>必然会发生变化。然而在关注这个问题之后，我发现其在更新生成新的<code>Node</code>之后，会同步更新<code>Path</code>以及<code>PathRef</code>对应的<code>Node</code>节点所对应的<code>key</code>值。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [pathRef, key] <span class="hljs-keyword">of</span> pathRefMatches) {
  <span class="hljs-keyword">if</span> (pathRef.<span class="hljs-property">current</span>) {
    <span class="hljs-keyword">const</span> [node] = <span class="hljs-title class_">Editor</span>.<span class="hljs-title function_">node</span>(e, pathRef.<span class="hljs-property">current</span>)
    <span class="hljs-variable constant_">NODE_TO_KEY</span>.<span class="hljs-title function_">set</span>(node, key)
  }
  pathRef.<span class="hljs-title function_">unref</span>()
}
</code></pre>
<p>在后续观察<code>Lexical</code>实现的选区模型时，发现其是用<code>key</code>值唯一地标识每个叶子结点的，选区也是基于<code>key</code>值来描述的。整体表达上比较类似于<code>Slate</code>的选区结构，或者说是<code>DOM</code>树的结构。这里仅仅是值得<code>Range</code>选区，<code>Lexical</code>实际上还有其他三种选区类型。</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-attr">anchor</span>: { <span class="hljs-attr">key</span>: <span class="hljs-string">"51"</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span> },
  <span class="hljs-attr">focus</span>: { <span class="hljs-attr">key</span>: <span class="hljs-string">"51"</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span> }
}
</code></pre>
<p>在这里比较重要的是<code>key</code>值变更时的状态保持，因为编辑器的内容实际上是需要编辑的。然而如果做到<code>immutable</code>话，很明显直接根据状态对象的引用来映射<code>key</code>会导致整个编辑器<code>DOM</code>无效的重建。例如调整标题的等级，就由于整个行<code>key</code>的变化导致整行重建。</p>
<p>那么如何尽可能地复用<code>key</code>值就成了需要研究的问题，我们的编辑器行级别的<code>key</code>是被特殊维护的，即实现了<code>immutable</code>以及<code>key</code>值复用。而目前叶子状态的<code>key</code>依赖了<code>index</code>值，因此如果调研<code>Lexical</code>的实现，同样可以将其应用到我们的<code>key</code>值维护中。</p>
<p>通过在<code>playground</code>中调试可以发现，即使我们不能得知其是否为<code>immutable</code>的实现，依然可以发现<code>Lexical</code>的<code>key</code>是以一种偏左的方式维护。因此在我们的编辑器实现中，也可以借助同样的方式，合并直接以左值为准复用，拆分时若以<code>0</code>起始直接复用，起始非<code>0</code>则创建新<code>key</code>。</p>
<ol>
<li><code>[123456(key1)][789(bold-key2)]</code>文本，将<code>789</code>的加粗取消，整段文本的<code>key</code>值保持为<code>key1</code>。</li>
<li><code>[123456789(key1)]]</code>文本，将<code>789</code>这段文本加粗，左侧<code>123456</code>文本的<code>key</code>值保持为<code>key1</code>，<code>789</code>则是新的<code>key</code>。</li>
<li><code>[123456789(key1)]]</code>文本，将<code>123</code>这段文本加粗，左侧<code>123</code>文本的<code>key</code>值保持为<code>key1</code>，<code>456789</code>则是新的<code>key</code>。</li>
<li><code>[123456789(key1)]]</code>文本，将<code>456</code>这段文本加粗，左侧<code>123</code>文本的<code>key</code>值保持为<code>key1</code>，<code>456</code>和<code>789</code>分别是新的<code>key</code>。</li>
</ol>
<p>因此，此时在编辑器中我们也是用类似偏左的方式维护<code>key</code>，由于我们需要保持<code>immutable</code>，所以这里的表达实际上是尽可能复用先前的<code>key</code>状态。这里与<code>LineState</code>的<code>key</code>值维护方式类似，都是先创建状态然后更新其<code>key</code>值，当然还有很多细节的地方需要处理。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 起始与裁剪位置等同 NextOp =&gt; Immutable 原地复用 State</span>
<span class="hljs-keyword">if</span> (offset === <span class="hljs-number">0</span> &amp;&amp; op.<span class="hljs-property">insert</span>.<span class="hljs-property">length</span> &lt;= length) {
  <span class="hljs-keyword">return</span> nextLeaf;
}
<span class="hljs-keyword">const</span> newLeaf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeafState</span>(retOp, nextLeaf.<span class="hljs-property">parent</span>);
<span class="hljs-comment">// 若 offset 是 0, 则直接复用原始的 key 值</span>
offset === <span class="hljs-number">0</span> &amp;&amp; newLeaf.<span class="hljs-title function_">updateKey</span>(nextLeaf.<span class="hljs-property">key</span>);
</code></pre>
<p>这里还存在另一个小问题，我们创建<code>LeafState</code>就立即去获得对应的<code>key</code>值，然后再考虑去复用原始的<code>key</code>值。这样其实就会导致很多不再使用的<code>key</code>值被创建，导致每次更新的时候看起来<code>key</code>的数字差值比较大。当然这并不影响整体的功能与性能，只是调试的时候看起来比较怪。</p>
<p>因此我们在这里还可以优化这部分表现，也就是说我们在创建的时候不会去立即创建<code>key</code>值，而是在初始化以及更新的时候再从外部设置其<code>key</code>值。这个实现其实跟<code>index</code>、<code>offset</code>的处理方式比较类似，我们整体在<code>update</code>时处理所有的相关值，且开发模式渲染时进行了严格检查。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// BlockState</span>
<span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">this</span>.<span class="hljs-property">lines</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">line, index</span>) =&gt;</span> {
  line.<span class="hljs-property">index</span> = index;
  line.<span class="hljs-property">start</span> = offset;
  line.<span class="hljs-property">key</span> = line.<span class="hljs-property">key</span> || <span class="hljs-title class_">Key</span>.<span class="hljs-title function_">getId</span>(line);
  <span class="hljs-keyword">const</span> size = line.<span class="hljs-property">isDirty</span> ? line.<span class="hljs-title function_">updateLeaves</span>() : line.<span class="hljs-property">length</span>;
  offset = offset + size;
});
<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span> = offset;
<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lines</span>.<span class="hljs-property">length</span>;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// LineState</span>
<span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">ops</span>: <span class="hljs-title class_">Op</span>[] = [];
<span class="hljs-variable language_">this</span>.<span class="hljs-property">leaves</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">leaf, index</span>) =&gt;</span> {
  ops.<span class="hljs-title function_">push</span>(leaf.<span class="hljs-property">op</span>);
  leaf.<span class="hljs-property">offset</span> = offset;
  leaf.<span class="hljs-property">parent</span> = <span class="hljs-variable language_">this</span>;
  leaf.<span class="hljs-property">index</span> = index;
  offset = offset + leaf.<span class="hljs-property">length</span>;
  leaf.<span class="hljs-property">key</span> = leaf.<span class="hljs-property">key</span> || <span class="hljs-title class_">Key</span>.<span class="hljs-title function_">getId</span>(leaf);
});
<span class="hljs-variable language_">this</span>.<span class="hljs-property">_ops</span> = ops;
<span class="hljs-variable language_">this</span>.<span class="hljs-property">length</span> = offset;
<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDirty</span> = <span class="hljs-literal">false</span>;
<span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">leaves</span>.<span class="hljs-property">length</span>;
</code></pre>
<p>此外，在实现单元测试时还发现，在<code>leaf</code>上独立维护了<code>key</code>值，那么<code>\n</code>这个特殊的节点自然也会有独立的<code>key</code>值。这种情况下在<code>line</code>级别上维护的<code>key</code>值倒是也可以直接复用<code>\n</code>这个<code>leaf</code>的<code>key</code>值。当然这只是理论上的实现，可能会导致一些意想不到的刷新问题。</p>
<h2 data-id="heading-2">视图增量渲染</h2>
<p>在视图模块最开始的设计上，我们的状态管理形式是直接全量更新<code>Delta</code>，然后使用<code>EachLine</code>遍历重建所有的状态。并且实际上我们维护了<code>Delta</code>与<code>State</code>两个数据模型，建立其关系映射关系本身也是一种损耗，渲染的时候的目标状态是<code>Delta</code>而非<code>State</code>。</p>
<p>这样的模型必然是耗费性能的，每次<code>Apply</code>的时候都需要全量更新文档并且再次遍历分割行状态。当然实际上只是计算迭代的话，实际上是不会太过于耗费性能，但是由于我们每次都是新的对象，那么在更新视图的时候，更容易造成性能的损耗，计算的性能通常可接受，而视图更新操作<code>DOM</code>成本更高。</p>
<p>实际上，我们上边复用其<code>key</code>值，解决的问题是避免整个行状态视图<code>re-mount</code>。而即使复用了<code>key</code>值，因为重建了整个<code>State</code>实例，<code>React</code>也会继续后边的<code>re-render</code>流程。因此我们在这里需要解决的问题是，如何在无变更的情况下尽可能避免其视图<code>re-render</code>。</p>
<p>由于我们实现了行级不可变状态维护，那么在视图中就可以直接对比状态对象的引用是否变化来决定是否需要重渲染。因此只需要对于<code>ViewModel</code>的节点补充了<code>React.memo</code>，在这个场景下甚至于不需要重写对比函数，只需要依赖我们的<code>immutable</code>状态复用能够正常起到效果。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LeafView</span>: <span class="hljs-variable constant_">FC</span>&lt;{ <span class="hljs-attr">editor</span>: <span class="hljs-title class_">Editor</span>; <span class="hljs-attr">leafState</span>: <span class="hljs-title class_">LeafState</span>; }&gt; = <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> {<span class="hljs-attr">...</span>{ [<span class="hljs-attr">LEAF_KEY</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">true</span> }} &gt;</span>
      {runtime.children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">LeafModel</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-title class_">LeafView</span>);
</code></pre>
<p>同样的，针对<code>LineView</code>也需要补充<code>memo</code>，而且由于组件内本身可能存在状态变化，例如<code>Composing</code>组合输入的控制，所以针对于内部节点的计算也会采用<code>useMemo</code>来缓存结果，避免重复计算。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LineView</span>: <span class="hljs-variable constant_">FC</span>&lt;{ <span class="hljs-attr">editor</span>: <span class="hljs-title class_">Editor</span>; <span class="hljs-attr">lineState</span>: <span class="hljs-title class_">LineState</span>; }&gt; = <span class="hljs-function"><span class="hljs-params">props</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> elements = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
     <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> nodes;
  }, [editor, lineState]);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> {<span class="hljs-attr">...</span>{ [<span class="hljs-attr">NODE_KEY</span>]<span class="hljs-attr">:</span> <span class="hljs-attr">true</span> }} &gt;</span>
      {elements}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">LineModel</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-title class_">LineView</span>);
</code></pre>
<p>而视图刷新仍然还是直接控制<code>lines</code>这个状态的引用即可，相当于核心层的内容变化与视图层的重渲染，是直接依赖于事件模块通信就可以实现的。由于每次取<code>lines</code>状态时都是新的引用，所以<code>React</code>会认为状态发生了变化，从而触发重渲染。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> onContentChange = <span class="hljs-title function_">useMemoFn</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (flushing.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  flushing.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    flushing.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-title function_">setLines</span>(state.<span class="hljs-title function_">getLines</span>());
  });
});
</code></pre>
<p>而虽然触发了渲染，但是由于<code>key</code>以及<code>memo</code>的存在，会以<code>line</code>的状态为基准进行对比。只有<code>LineState</code>对象的引用发生了变化，<code>LineModel</code>视图才会触发更新逻辑，否则会复用原有的视图，这部分我们可以直接依赖<code>React</code>的<code>devtools</code>录制或<code>Highlight</code>就可以观察到。</p>
<p>视图增量更新这部分其实比较简单，主要是实现不可变对象以及<code>key</code>值维护的逻辑都在核心层实现，视图层主要是依赖其做计算，对比是否需要重渲染。其实类似的实现在低代码的场景中也可以应用，毕竟实际上富文本也就是相当于一个零代码的编辑器，只不过组装的不是组件而是文本。</p>
<h2 data-id="heading-3">总结</h2>
<p>在先前我们主要讨论了视图层的适配器设计，主要是全量的视图初始化渲染，以及状态模型到<code>DOM</code>结构性的规则设定。在这里则主要考虑更新处理时性能的优化，主要是在增量更新时，如何最小化<code>DOM</code>以及<code>Op</code>操作、<code>key</code>值的维护、以及在<code>React</code>中实现增量渲染的方式。</p>
<p>其实接下来需要考虑输入内容时，如何避免规定的<code>DOM</code>的结构被破坏，主要涉及脏<code>DOM</code>检查、选区更新、渲染<code>Hook</code>等，这部分内容在<code>#8</code>和<code>#9</code>的输入法处理中已经有了详细的讨论，因此这里就不再次展开了。</p>
<p>那么接下来我们需要讨论的是编辑节点的组件预设，例如零宽字符、<code>Embed</code>节点、<code>Void</code>节点等。主要是为编辑器的插件扩展提供预设的组件，在这些组件内存在一些默认的行为，并且同样预设了部分<code>DOM</code>结构，以此来实现在规定范围内的编辑器操作。</p>
<h2 data-id="heading-4">每日一题</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay" target="_blank" title="https://github.com/WindRunnerMax/EveryDay" ref="nofollow noopener noreferrer">github.com/WindRunnerM…</a></li>
</ul>
<h2 data-id="heading-5">参考</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F18.react.dev%2F" target="_blank" title="https://18.react.dev/" ref="nofollow noopener noreferrer">18.react.dev/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F18.react.dev%2Freference%2Freact%2Fmemo" target="_blank" title="https://18.react.dev/reference/react/memo" ref="nofollow noopener noreferrer">18.react.dev/reference/r…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2F18.react.dev%2Freference%2Freact%2FuseMemo" target="_blank" title="https://18.react.dev/reference/react/useMemo" ref="nofollow noopener noreferrer">18.react.dev/reference/r…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不止是写代码｜产品经理如何用 TRAE 重构工作流]]></title>    <link>https://juejin.cn/post/7604315965875159074</link>    <guid>https://juejin.cn/post/7604315965875159074</guid>    <pubDate>2026-02-09T08:07:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604315965875159074" data-draft-id="7604045354071080994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不止是写代码｜产品经理如何用 TRAE 重构工作流"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-02-09T08:07:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不止是写代码｜产品经理如何用 TRAE 重构工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T08:07:08.000Z" title="Mon Feb 09 2026 08:07:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读29分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d7f8dc33c07465b963aab25298cbd83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=W76L6wcFsiX34U1ocy9wwY09kAU%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：李恒，B端产品经理，TRAE 深度用户</p>
</blockquote>
<p>你是否也有这样的经历：</p>
<p>一个想法在脑子里已经很清楚了，但真正要落成 Demo，却要经历画原型、反复改稿、和研发来回拉扯，最后上线的方案，早就和最初的设想不太一样。</p>
<p>本文将分享一名非技术背景的 B 端产品经理，如何借助 TRAE，把“想法”直接翻译成可交互原型与可讨论方案：  不用等研发、不用反复画图，也不需要精通代码，就能在需求迭代、0-1 项目验证、复杂逻辑对齐中，把效率提升数倍。</p>
<p>这不是一篇简单的工具介绍，而是一套已经在真实工作中反复验证过的实践方法，覆盖从需求验证、原型迭代，到逻辑跑通与文档对齐的全过程。它将告诉你，一个产品经理，如何借助 TRAE 把效率这件事做到极致。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a91f5318f42a4f41bae138ed82279b31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=JRXvmUG4k533MYd1TSt2W5N%2Butc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>为什么我要写这篇文章？</strong></h2>
<p>我是一名负责 B 端功能型产品的产品经理，日常处理的是复杂的业务逻辑和后台系统。在接触 TRAE 之前，我的工作路径是：<strong>画原型 -&gt; 写文档 -&gt; 等排期 -&gt; 反复调整。</strong></p>
<p>直到我开始尝试，把 TRAE 当成“工作伙伴”而不是“写代码的工具”。本文将围绕产品经理的 3 个核心工作场景展开：</p>
<ol>
<li>
<p><strong>需求迭代的原型设计</strong></p>
</li>
<li>
<p><strong>0-1 的项目原型 + 逻辑验证</strong></p>
</li>
<li>
<p><strong>文档的编写与对齐</strong></p>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b02afacf94b345de927060c43033240c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=4MABBEBbh7FfEFU4kzFG%2B60EsiA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>核心认知：TRAE 是「想法翻译器」</strong></h2>
<p>在深入场景前，我们需要重塑认知：<strong>TRAE 的本质是一个高效的“翻译器”。</strong></p>
<p>它无法凭空理解模糊的意图，但只要你能清晰描述逻辑，它就能将想法精准地“翻译”成可交互、高保真的前端应用。这意味着：</p>
<ul>
<li>
<p><strong>解放双手：</strong> 从繁琐的“画图”工作中解放，告别像素级的对齐和组件拖拽。</p>
</li>
<li>
<p><strong>聚焦思考：</strong> 精力投入到梳理产品逻辑、定义用户流程和构思交互细节上。</p>
</li>
<li>
<p><strong>高保真交付：</strong> 原型不再是静态线框图，而是动态的、高保真的 HTML 页面 。</p>
</li>
</ul>
<p>这个转变，是后续所有效率提升和能力飞跃的基础。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b26fe32636144ac091a9adef3f97ba5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=xedS1xqOvYmxvlar4nsITFDYNvI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>协作原则：小步快跑，增量迭代</strong></h2>
<p><strong>与 TRAE 协作，最重要的原则是：小步快跑，拒绝一口气吃成胖子。</strong></p>
<p>与其试图用一段冗长而复杂的指令生成完美系统，不如将目标拆解成一个个具体、明确的小步骤，通过持续的、增量式的迭代来逐步完善。这套方法论可以概括为“框架-组件-交互”三步走：</p>
<ol>
<li>
<p><strong>先搭框架：</strong> 让 TARE 生成最基础的页面布局和结构。</p>
</li>
<li>
<p><strong>再填组件：</strong> 在框架内逐步添加必要的 UI 组件，如按钮、输入框、列表等。</p>
</li>
<li>
<p><strong>后调交互：</strong> 最后为这些组件注入生命，实现点击、跳转、数据加载等动态交互。</p>
</li>
</ol>
<p>始终记住，每一次与 TRAE 的交互都应该只关注一个具体、明确的目标。这样的“小步快跑”，不仅能保证 TRAE 的理解准确率，也让你能始终掌控项目的进展和方向。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c9464ba06b547b4a546c89781923675~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=Bek%2FHv0iMbVQBNuyhjsFuyffXYw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>三大核心场景：用 TRAE 重构产品工作流</strong></h2>
<p>接下来，我将结合一个B端产品经理的日常，通过三个最典型的工作场景，展示 TRAE 是如何颠覆传统工作模式的。每一个场景都附实战案例和可直接复用的技巧，建议收藏备用！</p>
<h3 data-id="heading-4"><strong>场景一：需求迭代与原型设计</strong></h3>
<p><strong>工作流对比：</strong></p>
<p><strong>过去 (Old School)</strong></p>
<ul>
<li>
<p><strong>痛苦画图：</strong> 在 Axure/Figma 中反复拖拽，为了一个按钮的对齐纠结半天。产出的是低保真线框图，与最终效果差异巨大。</p>
</li>
<li>
<p><strong>反复拉扯：</strong> 拿着线框图向老板、UI、研发解释，“这里以后是彩色的”、“这个按钮点击后会弹出一个框”… 沟通成本高，信息损耗严重。</p>
</li>
<li>
<p><strong>时间成本：</strong> 2 人天起步。</p>
</li>
</ul>
<p><strong>现在 (TRAE Flow)</strong></p>
<ul>
<li>
<p><strong>“嘴替”编程：</strong> 一张截图、一个 Figma 链接，直接“喂”给 TRAE，即刻生成高保真 HTML 页面。</p>
</li>
<li>
<p><strong>光速定稿：</strong> 任何调整，直接用自然语言“告诉”TRAE，半小时内就能看到最终效果，实现“会上决策、当场修改、即时生效”。</p>
</li>
<li>
<p><strong>时间成本：</strong> 0.5 人天，效率提升至少 4 倍。</p>
</li>
</ul>
<p><strong>核心价值：效率提升4 倍，这不仅节省了时间，更将产品经理从重复性劳动中解放出来，回归到创造性思考本身。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/770bae44f32b4cd497ccb17674c8ae19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=bS6VbG07%2FmOJxDAgpiXB9sSR4Dw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5"><strong>实战案例：给 TRAE 官网加个聊天机器人</strong></h3>
<p><strong>TRAE 配置清单：</strong></p>
<ul>
<li>
<p><strong>模型：</strong> gemini-3-pro-preview</p>
</li>
<li>
<p><strong>智能体：</strong> Builder with MCP</p>
</li>
<li>
<p><strong>MCP：</strong> Playwright, Figma AI Bridge (可选)</p>
</li>
<li>
<p><em>(MCP 配置方式见文末附录)</em></p>
</li>
</ul>
<p><strong>需求背景：</strong> 在 TRAE 的 Profile 页面右侧，增加一个主流的侧边 Agent 聊天面板。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1b0faff033b44b9bd351a18564a5d9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=gCUwTeu4wI4xjvSJPlkkOuYGLIw%3D" alt="" loading="lazy"/>目标原型效果</p>
<h4 data-id="heading-6"><strong>第一步：还原现状，让 TRAE 看懂你的产品</strong></h4>
<p>要在一个现有产品上做迭代，首先得让 TRAE “看懂”当前的页面。这里有两种高效的方法：</p>
<p><strong>1. 页面截图法 (截图 + Playwright MCP)</strong></p>
<p>这是最直接的方式。将你要迭代的页面完整截图，然后用这样的提示词喂给 TRAE：</p>
<p><strong>💡 提示词心得：</strong></p>
<blockquote>
<p>核心是告诉 TRAE 你的目的和约束。不需要长篇大论，但要包含关键信息。</p>
<p>“根据我给你的这张设计图，帮我1:1 还原一个前端 HTML 页面。<strong>这只是一个用于需求沟通的 Demo，不需要连接后端接口。</strong> 技术栈使用 React。”</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af74e4bebab64361b9134e809fda1abb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=N6kmUvGoUNvASJUhmHlDYW14KH4%3D" alt="" loading="lazy"/></p>
<p><strong>2. 设计稿还原法 (Figma + AI Bridge)</strong></p>
<p>借助 <strong>Builder.io 插件。</strong> 它可以复制前端页面的布局，结合它在 Figma 上的插件，能够将前端还原到 Figma 中。</p>
<p>然后再粘贴 Figma 的素材地址，使用 <strong>Figma AI Bridge MCP</strong> 来还原这个前端页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c806d57d32a9495ab10975cb140278d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=n2ZNiFxU9S5S4GXLykPusGnvlJI%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82562a7150a044978a3dbedc9c6618c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=Fi%2FnnH%2FqB%2FJWBDHFvVk%2FfzIUU0o%3D" alt="" loading="lazy"/></p>
<p><strong>提示词示例：</strong></p>
<blockquote>
<p>请你使用 figma ai bridge mcp，读取我的设计图 https:.... 来帮我1:1 还原一个前端的 html 页面。并且不需要接入后端，因为我的项目是一个仅前端用于需求同步的 demo 项目，页面上的数据，都采取前端写入的方式，不需要用到后端的接口获取。语言使用 react</p>
</blockquote>
<h4 data-id="heading-7"><strong>第二步：还原效果检查</strong></h4>
<p><strong>核心工具：Playwright MCP</strong></p>
<p>在 TRAE 做完了初步的实现以后，多少是会跟我们的参考的网页有些差异。这时候就要用到 <strong>Playwright MCP</strong> 了。</p>
<p><strong>核心目的：</strong> 让 TRAE 能够打开目前已经写出来的网页，获取前端的展示信息，这样 TRAE 就能够对得上它的代码，以及最终的前端呈现。</p>
<p><strong>进阶用途：</strong> 你也可以让他打开我们<strong>参考的网页</strong>，对照参考网页的前端样式实现和样式规范，检查目前它实现的前端页面是否存在哪些地方是没有按照目标实现的。</p>
<p><strong>检查时的提示词示例：</strong></p>
<blockquote>
<p>请你用 playwrightmcp 打开你目前实现的前端页面。以及我给你的这个参考网站 https:....；我希望你能够对照你目前的前端页面，与我的参考网站的前端样式。帮我检查还有哪一些模块没有做到 1:1 的还原。因为前面给你的设计图，其实就是来源于这个参考网站的。</p>
<p>在你检查的时候，请你特别注意以下的几个维度是否得到了还原：</p>
<ul>
<li>字号大小的层级关系</li>
<li>容器之间的间距与对齐</li>
<li>颜色系统</li>
</ul>
</blockquote>
<h4 data-id="heading-8"><strong>第三步：细节微调，搞定“倔强”的AI</strong></h4>
<p>总有些细节，TRAE 可能会反复修改却依然错漏，甚至“嘴硬”说已经改好了。这通常意味着 TRAE 的默认解决路径遇到了障碍。此时，需要我们提供更精准的“导航”。</p>
<p><strong>1、复制 Classname 精准定位</strong></p>
<p>我们可以通过截图，以及复制前端的 <em><strong>classname</strong></em> 的形式，告诉 TRAE 到底哪一块是还做的不到位的，应该要怎么做。</p>
<p><strong>操作技巧：</strong></p>
<blockquote>
<p>打开浏览器的检查（右键 -&gt; 检查，或者 F12），通过元素选择器定位到目标元素，在右侧 DOM 树中双击选中目标的 <em><strong>classname</strong></em> 并复制。</p>
</blockquote>
<p><strong>提示词示例：</strong></p>
<blockquote>
<p>目前我观察到，前端的 **<em>{{classname}}</em> **还没有按我的要求还原。也就是我给你发送的页面截图图 1（此处粘贴实现的图片）。我希望你根据图 2 的样式帮我做还原（此处粘贴期望样式的截图）。</p>
<p>你也可以使用 playwrightmcp 打开我的参考网站 https:... 中，查看 **<em>{{我参考网站对应组件 classname}}</em> **的实现，并在我的项目中 1:1 的还原它。</p>
</blockquote>
<p><strong>2、当 TRAE「死鸭子嘴硬」时怎么办</strong></p>
<p>如果还有一些细节，TRAE 无法还原并反复“嘴硬”说改好了</p>
<p>这时候我基本判断：<strong>可能 TRAE 自己习惯的判断或者实现的维度，并不能解决我的问题。分享4个终极手段，亲测有效：</strong></p>
<ul>
<li>
<p><strong>细致表达：</strong> 将你认为一直没有实现的地方，更细致地表达出来（运用 classname、截图、playwright 等）。或者详细地用自然语言表达现状 vs 期望，让 TRAE 帮你根据现状代码猜测原因。</p>
</li>
<li>
<p><strong>指定维度：</strong> 如果你自己知道大概是什么维度（比如 flex 布局、z-index 层级）可能能够修复这个问题，就让模型往这个维度上去思考。</p>
</li>
<li>
<p><strong>更换模型：</strong> 看看其他模型（如 GPT-5.2 或 GPT-5.1）对于这个场景下，是否它的习惯性解决方案能够覆盖这个问题。</p>
</li>
<li>
<p><strong>重置上下文：</strong> 新开对话，看看是否因为上下文过长导致模型存在了临时的「思维定式」。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2c75148355143b1b3f9eee2cce918d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=dEzR1eoQPYIWqBQw4aOtvw%2F7Aqo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9"><strong>完成前三步的关键总结：</strong></h4>
<p><strong>1、提示词技巧</strong></p>
<p>回顾我还原 TRAE Profile 页面的过程，大概扫一下就可以发现，我跟 TRAE 的交互提示词，主打一个<strong>自由随性</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebff9b73a4eb4cd2a762680e803caa44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=bd773kFRfevu0qe9EL%2BuanDJRRE%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93165834d1bd4b2aa6611b13084dfe85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=uaIRRhbuZS31LVMk%2Bh5%2F0s5z3Rk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2937d85b16844a8198155ba701d7dbf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=k18X9fahL1GnWdROJ6xcn9NHUwA%3D" alt="show_682105790_1770623468623.png" loading="lazy"/></p>
<p><strong>重点其实还是这3点，记牢就能少踩坑：</strong></p>
<ul>
<li>
<p>有没有把需求表达清楚？</p>
</li>
<li>
<p>是否给足了 AI 定位问题的参考信息？</p>
</li>
<li>
<p>是否提供了目标实现的参考信息？</p>
</li>
</ul>
<p>给出以上关键信息的手段，可以是<strong>文本描述</strong>，可以是<strong>截图</strong>，也可以是利用 <strong>Playwright MCP</strong> 让 TRAE 自己去做参照。</p>
<p><strong>2、项目规范最佳实践</strong></p>
<p>当项目达到基础可用状态之后，建议大家做2件事：</p>
<p><strong>①编写启动脚本</strong></p>
<p>让 AI 帮你写一个 <em><strong>sh</strong></em> 的启动脚本。这样方便我们后面需要再次启动这个项目时，直接将这个脚本拖拽到终端，回车执行即可启动。</p>
<p><strong>建议加上几个细节：</strong></p>
<ul>
<li>
<p><strong>固定端口：</strong> 允许清空占用，再启动。防止端口冲突。</p>
</li>
<li>
<p><strong>打印地址：</strong> 启动后在终端打印访问地址，方便点击。</p>
</li>
</ul>
<p><strong>提示词示例：</strong></p>
<blockquote>
<p>请你帮我创建一个 sh 的 start 脚本，方便我每次启动项目都只需要在终端执行这个 sh 脚本。并且我希望这个脚本能够每次都固定端口启动，如果遇到端口被占用的情况，需要清理被占用的端口，再使用该端口启动，保证每次都能够固定端口。同时在启动成功后，需要在终端打印出我的访问地址。</p>
</blockquote>
<p><strong>②沉淀前端规范文档 (FRONTEND_SPEC.md)</strong></p>
<p>让 TRAE 帮你总结一个前端规范的 md 文档。</p>
<p>后面继续迭代时，在需求前面带上这个文档，让 TRAE 遵守规范，能保证样式风格统一，布局更合理。</p>
<p><strong>建议包含以下维度：</strong></p>
<ul>
<li>
<p>间距系统</p>
</li>
<li>
<p>颜色系统</p>
</li>
<li>
<p>字体层级与字号大小</p>
</li>
<li>
<p>网页布局框架</p>
</li>
</ul>
<p><strong>提示词示例：</strong></p>
<blockquote>
<p>请你根据当前的样式实现，帮我创建一份前端规范的 md 文档。这一份文档，在后面将会作为我的项目的设计规范使用。在规范里，我认为至少需要包含以下的模块：</p>
<ul>
<li>
<p>项目前端页面的基础布局</p>
</li>
<li>
<p>字号大小系统</p>
</li>
<li>
<p>颜色系统</p>
</li>
<li>
<p>间距系统</p>
</li>
</ul>
</blockquote>
<h4 data-id="heading-10"><strong>第四步：需求落地，让原型“动”起来</strong></h4>
<p>当页面还原完毕，我们就可以开始真正的迭代了。还记得我们的需求吗？<strong>👉 在右侧增加一个侧边的 Agent 聊天面板。</strong></p>
<p>由于做迭代基本是没有设计图参考的，考验的就是我们<strong>通过文本来表达交互的能力。</strong></p>
<p><strong>我的方法论：用“用户视角”来描述交互，表达清楚以下5点：</strong></p>
<ul>
<li>
<p>我们希望的交互，它从起始到结束，在什么位置？</p>
</li>
<li>
<p>通过什么操作？</p>
</li>
<li>
<p>点击后，会发生什么？</p>
</li>
<li>
<p>又在哪个位置出现？</p>
</li>
<li>
<p>会出现什么内容？</p>
</li>
</ul>
<p><strong>⚠️ 记得要携带上我们上面总结的那一份前端规范！</strong></p>
<p><strong>实战提示词示例：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34073c018a0d4b78a1395732d660f60e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=Hq098%2B%2F1mjUNjB6Hbtiwn2UjRr8%3D" alt="show_682105790_1770623599386.png" loading="lazy"/></p>
<p>现在我希望在我的页面的右侧区域，增加一个聊天的窗口。</p>
<blockquote>
<ol>
<li>
<p>这个聊天的窗口，是由顶部导航栏右侧区域，claim anniversary 的容器左侧的一个 chat 的 icon 处激活的。</p>
</li>
<li>
<p>激活聊天面板后，会对应的将右侧的 main 内容容器，往左自适应挤过去。</p>
</li>
<li>
<p>而这个聊天面板，由 3 个部分组成：</p>
<p>顶部是聊天窗口的标题</p>
<p>中间是聊天消息的展示区，分为用户与 agent 的消息，并且不需要头像</p>
<p>下方是用户发消息的输入框，以及发送按钮区</p>
</li>
</ol>
<p>在你帮我实现时，<strong>需要符合我的</strong> <em><strong>FRONTEND_SPEC.md</strong></em> <strong>规范。</strong></p>
</blockquote>
<p>在实现了基础交互后，我又想增加一些效果，比如打字机效果、知识库查询等。同样的，也是依赖上方提出的方法：<strong>由用户操作视角出发，描述清楚起始、操作、反馈、位置、内容。</strong></p>
<p><strong>完成效果：最终我们就能够得到一个如下视频所示的一个带前端交互的HTML的可交互式原型</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1fac20734b64655a34a2bdf58bc20d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=OzrW9YZC%2FxrUX3bgaYZeUdqdAYY%3D" alt="20260129104946_rec_-convert (1).gif" loading="lazy"/></p>
<h3 data-id="heading-11"><strong>场景二：0-1 的项目原型与逻辑验证</strong></h3>
<p>如果说需求迭代是“术”，那么 0-1 的项目验证则更考验产品经理的“道”——将一个想法，快速落地为可验证的 MVP。</p>
<p><strong>工作流对比：</strong></p>
<p><strong>过去 (Old School)</strong></p>
<ul>
<li>
<p><strong>接口猜谜：</strong> 只能对着一堆接口文档干瞪眼，看着字段猜测后端逻辑。验证路径极短，中间过程完全是黑盒。</p>
</li>
<li>
<p><strong>逻辑盲区：</strong> 遇到复杂算法、Agent 交互等，完全不知其所以然。与研发讨论时，因不懂实现细节，难以提出建设性意见，更无法有效把控项目风险。</p>
</li>
</ul>
<p><strong>现在 (TRAE Flow)</strong></p>
<ul>
<li>
<p><strong>白盒掌控：</strong> 通过自然语言描述，让 TRAE 把完整逻辑跑通，结合其输出的 Mermaid 流程图，彻底看懂代码背后的业务流转。</p>
</li>
<li>
<p><strong>反向输出：</strong> 你不再只是需求的提出者。现在，你可以直接构建一个逻辑合理、甚至代码可用的方案，“甩”给研发：“照着这个，合到主干代码里去。”</p>
</li>
</ul>
<p><strong>核心价值：这已经不是简单的效率提升，而是产品经理核心能力的飞跃——我们真正获得了定义和验证技术方案的能力。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22645b5421144c138f4fe3cac0f193d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=dxiQCLi9RtsyVi%2B4qh5O5RIrgdQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12"><strong>实战案例：电商 Agent 的 0-1 搭建</strong></h3>
<blockquote>
<p><strong>TRAE 配置清单</strong></p>
<ul>
<li><strong>模型：</strong> gemini-3-pro-preview</li>
<li><strong>智能体：</strong> Builder with MCP</li>
<li><strong>MCP：</strong> Playwright</li>
</ul>
</blockquote>
<p><strong>需求背景：</strong> 做一个电商场景的 agent，目标是C端用户。它能够帮我们做基本的商品的搜索，以及让用户直接指定对应的商品。</p>
<p><strong>核心思路与场景一完全一致：小步快跑，增量迭代。</strong></p>
<p><strong>第一步：搭建基础聊天页面</strong></p>
<p><strong>0-1项目启动提示词示例：</strong></p>
<blockquote>
<p>我的这个项目是一个对话式的电商 agent。并且是移动端尺寸的。所以请你以移动端iPhone12 的尺寸，帮我创建一个基础的 agent 的聊天页面。前端使用 react 的技术方案</p>
<p>这个聊天页面的结构是，顶部是对话的标题。中间是 agent 与用户的消息记录，并且不需要头像。底部是用户的输入框，以及发送按钮</p>
<p>现在请你帮我实现这个项目的基础页面结构</p>
</blockquote>
<p><strong>为了后续迭代方便，可以补充以下 2 个优化点：</strong></p>
<p><strong>1. 优化 classname</strong></p>
<blockquote>
<p>请你将我前端页面的 classname 做规范化处理，方便我以后能够直接通过前端页面的 classname 找到对应的代码，而不是用 react 生成的 classname。</p>
</blockquote>
<p><strong>2. 创建 start 脚本</strong></p>
<blockquote>
<p>请你帮我创建一个 sh 的 start 的脚本，并且固定端口启动，当目标端口被占用时，你可以清理掉被占用的端口进程。然后再进行启动。同时我希望这个脚本再启动后，能够在终端答打印出我项目的路径，方便我后续访问</p>
</blockquote>
<p>到这一步，我们的第一阶段就做好了：一个基础的前端页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ad265f8b1ab47e9b4b3d4a80eb69cce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=cBaQ55SiWpwtuq0s1APaoRKoXxQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-13"><strong>第二步：接入基础对话能力</strong></h4>
<p>这一步开始涉及后端逻辑。如果你对技术实现不熟，没关系，先让 TRAE 成为你的“技术顾问”，让他给你写一份实现文档。并要求在你确认之前，不许动任何代码。</p>
<p><strong>“文档先行”提示词示例：</strong></p>
<p>我现在打算在我的项目里实现真正的ai 对话。并且我使用的是豆包的模型。</p>
<blockquote>
<p>我希望实现后，能够做大， 用户在输入框内输入文本，点击发送后，能够让豆包在思考后进行回复，就跟现在的很多 agent 产品一样，能够看到折叠的 thinking，以及最终的回复的文案。同时这个 think 默认可能是折叠的状态的。用户可以进行展开，但展开也只是在一定的高度下查看 thinking 的文本。</p>
<p>同时呢，我也希望在用户发送第二条消息后，ai 能够了解我的上下文，并且基于我的上下文，继续来给我进行回复。</p>
<p>请你根据我以上的需求，帮我写一份实现的 md文档，并且在得到我开始研发代码的确认消息前，不要修改我的任何代码文件</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c48e0622ab342a6ae2438f866e891fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=TarWEecg%2BMiHYVQOh3vqoWr2Pa8%3D" alt="" loading="lazy"/></p>
<p>实际上，让 TRAE 帮你编写实现文档，能够后续让它实现的更准确。对于实现方案不确定的地方，我们都可以在不断的跟 TRAE 交互的过程中，逐步完善文档。</p>
<p><strong>在 TRAE 完成后，同样使用 playwrightmcp 打开我的项目，并且模拟用户走完整个流程。</strong></p>
<p>然后我们就得到了一个满足了前后端的基础项目实现了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9763af69f91148aa9887f26e8a5b716c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=%2BGcVTG%2BCLExCKGzzJcSLzr63GX8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-14"><strong>第三步：实现核心业务逻辑——商品搜索</strong></h4>
<p>再继续第三个子任务：为组件实现搜索商品。</p>
<p>思路相同，如果我们自己不清楚要如何实现，就让 TRAE 根据我们的需求，创建一个实现文档。</p>
<p><strong>这里我就快速的直接通过需求进行提问实现了：</strong></p>
<blockquote>
<p>现在请你帮我在这个项目中，为这个 agent 实现在对话过程中，能够帮用户做商品搜索的这个能力。</p>
<p>要想实现这个能力，首先你需要帮我创建一个本地的数据库，存储商品的信息。其中需要至少包含商品 id，商品主图，商品标题，商品价格，商品详情描述的信息。商品图片你可以从 usplash 上随机获取可以访问的商品图片就可以了。</p>
<p>那我希望在用户与 agent 的对话交互中，能够识别用户当前的意图是否涉及到商品的搜索。如果涉及到商品搜索，请你调用商品搜索的这个 mcp（这个 mcp 也需要你根据上面要求你创建的数据库来实现），将用户的提问，转换成商品标题搜索的关键词，并通过接口搜索出商品。</p>
<p>在拿到商品的信息后，我要求 agent 需要给我返回一个可交互的商品卡片的消息起泡，并且支持分页，一页 4 个。最多 5 页也就是 20 个商品。</p>
<p>在商品卡片上需要呈现每一个商品的主图，标题，以及价格。同时每一个商品卡片的右上角我希望都有一个文本的追问按钮。</p>
<p>当用户点击了这个追问后，能够在用户的输入框上方有一个呈现了当前正在追问哪个商品的一个交互。</p>
<p>并且当用户在追问状态下发送消息时，在用户的消息气泡中，需要携带上被追问商品的 tag 的交互显示。</p>
<p>同时，我也希望你能够有另一个应对商品追问的 mcp。这个 mcp 在识别到用户的追问后，能够根据用户追问的商品 id，去数据库中查询出这个商品的详情描述信息，并且根据该商品的详情描述信息，给与用户文本描述。</p>
<p>以上的整个流程，为了方便我模拟，我希望所有的商品标题都携带着，风衣这个关键词。并且在你完成代码实现后，我希望你使用 playwrightmcp，以用户在搜索风衣，以及针对某个风衣做追问的场景。帮我完成一轮商品搜索，以及商品追问的交互与逻辑测试，确保你的实现是符合我的需求的</p>
</blockquote>
<p>即便给出了以上详尽的指令，TRAE 的初版实现也可能存在问题。没关系，继续通过追问来修正。</p>
<blockquote>
<p>我发现了几个问题，请你帮我做出修改</p>
<ol>
<li>我的项目的页面尺寸，需要严格按照移动端的尺寸。不能够因为消息气泡中内容的长短，而撑开了整个项目页面呈现。</li>
<li>我希望在触发调用工具时，能够有像一般的 agent 产品一样的那种正在调用xx 工具的交互</li>
<li>整体的后端的实现思路，应该是基于 ReAct 的核心理念，也就是会涉及到用户的一条消息，可能会触发多次 ai 的请求。第一次请求可能是ai 判断需要调用工具，而获取工具的结果，第二次请求就是 ai 结合着工具返回的结果，来进行回复。</li>
<li>所以既然后端的实现思路基于 ReAct 的单任务多轮思考请求的思路，所以对应的前端的配套交互也需要帮我做出对应的调整与优化</li>
</ol>
</blockquote>
<p><strong>最终成果：完成一个前后端完整的电商 Agent MVP</strong>，后续可以基于这个项目，做一些需求的逻辑验证，或者复杂逻辑的迭代等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecad3ef843fb4571a5cb17cd115cb6ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=yowILSOIKzzvWe3%2Bi8Z%2F2K73%2BpY%3D" alt="20260129143746_rec_-convert (1).gif" loading="lazy"/></p>
<p>这个过程的价值在于，它让我们像架构师一样思考，将一个复杂的业务流程，拆解为一系列清晰的模块。而 TRAE，则将我们的思考变为现实。</p>
<h4 data-id="heading-15"><strong>场景三：文档的编写与对齐</strong></h4>
<p>产品经理不仅要创造，更要频繁同步与对齐。无论是与研发对齐方案，还是向老板汇报进展，清晰的文档和逻辑图都是必不可少的。</p>
<p><strong>工作流对比：</strong></p>
<p><strong>过去 (Old School)</strong></p>
<ul>
<li>
<p><strong>结构化地狱：</strong> 收集资料容易，整理成逻辑清晰的文档难。在 PPT 里画框架图、流程图，反复调整却总觉得逻辑不通。</p>
</li>
<li>
<p><strong>无效纠结：</strong> 大量时间浪费在调整格式、对齐图形上，核心逻辑反而没时间打磨。</p>
</li>
<li>
<p><strong>时间成本：</strong> 1 人天。</p>
</li>
</ul>
<p><strong>现在 (TRAE Flow)</strong></p>
<ul>
<li>
<p><strong>暴力输出草稿：</strong> 想到什么写什么，甚至把参考资料一股脑丢进一个文档，逻辑混乱也无所谓。</p>
</li>
<li>
<p><strong>降维打击：</strong> 将这堆“原料”丢给 TRAE，结合明确的整理方法论，让它瞬间完成结构化和可视化。</p>
</li>
<li>
<p><strong>时间成本：</strong> 0.5 人天，效率提升 2 倍。</p>
</li>
</ul>
<p><strong>核心价值：效率提升 2 倍</strong>，告别 PPT 纺织工，回归思考者。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afd6b5c9e10a4537970fe1539eeee996~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=lKP89LPLV77%2FLNXGgwHr3lBIuDk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16"><strong>实战案例：用 TRAE 辅助编写项目文档</strong></h3>
<p><strong>TRAE 配置清单</strong></p>
<ul>
<li>
<p><strong>模型：</strong> gemini-3-pro-preview</p>
</li>
<li>
<p><strong>智能体：</strong> Builder with MCP</p>
</li>
</ul>
<h4 data-id="heading-17"><strong>1、用于项目文档与研发对齐</strong></h4>
<p>写完上面那个电商 Agent 的 MVP 后，我需要给研发和业务团队同步方案。<strong>我的草稿可能非常随意，我会让 TRAE 按照我的原则，帮我梳理成专业文档。</strong></p>
<p><strong>暴力写下你的草稿（逻辑混乱也没关系）：</strong></p>
<blockquote>
<p>我想要跟研发团队同步，以及业务团队同步我的这个电商的 agent 是用来干什么的</p>
<p>它其实是给 C 端用户用的，能够让用户在对话的情况下就能够完成下单。目前支持的场景就是有搜索商品</p>
<p>以后可能还会支持下单，做售后等的场景</p>
<p>所以这个后面除了要对接商品库以外，还要对接售后的接口</p>
<p>然后这个 agent 会自己意图识别用户想要干什么，然后再去调用不同的工具，来帮用解决问题</p>
<p>balabala（这里我就不继续写了）</p>
</blockquote>
<p><strong>让 TRAE 整理成专业文档：</strong></p>
<blockquote>
<p>请你根据我下方给你的我的草稿，以及我当前的项目的实现，帮我写一面方便我跟其他同事同步的一个 md 文档</p>
<p>在这个 md 文档里面， 我希望你整体以总分的结构进行编写，先通过总结让读者读懂我们的这个文档要表达什么内容。再分别展开每个模块。尽可能简单表达，小白就能够一眼看懂。</p>
<p>然后关于 ai 的实现方面，需要你输出一个mermaid 的框架图，与时序图，方便我与开发同步这里面的实现逻辑，以及未来可能需要去对接不同的数据库，或者 api 能力范围是什么</p>
<p>以下是我的文档草稿：</p>
<p>我想要跟研发团队同步，以及业务团队同步我的这个电商的 agent 是用来干什么的</p>
<p>它其实是给 C 端用户用的，能够让用户在对话的情况下就能够完成下单。目前支持的场景就是有搜索商品</p>
<p>以后可能还会支持下单，做售后等的场景</p>
<p>所以这个后面除了要对接商品库以外，还要对接售后的接口</p>
<p>然后这个 agent 会自己意图识别用户想要干什么，然后再去调用不同的工具，来帮用解决问题</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6566edd4ca594688b747282fd47a594d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=IR1qoaF5%2B45ka0gQwikt31srsnI%3D" alt="" loading="lazy"/></p>
<p>TRAE 会将你的“意识流”草稿，重构成一份结构清晰、图文并茂的正式文档。</p>
<h4 data-id="heading-18"><strong>2、用于竞品分析与市场洞察</strong></h4>
<p><strong>这种「随性打草稿」的方法，除了用在项目总结，在做竞品调研的时候也超级好用。</strong></p>
<p>以前做调研，可能还要担心格式乱、信息杂。现在完全不需要束手束脚：</p>
<ul>
<li>
<p><strong>暴力粘贴：</strong> 看到觉得有效的信息、文章片段、数据，直接一股脑贴到一个文档里。</p>
</li>
<li>
<p><strong>AI 整理：</strong> 把这堆“杂乱信息”丢给 AI，让它帮你结构化整理，提取核心观点。</p>
</li>
<li>
<p><strong>可视化输出：</strong></p>
<p>让 AI 输出一张 <strong>Mermaid</strong> 的框架图，逻辑结构一目了然。</p>
<p>或者让 AI 给你一份可以用于 <strong>Nanobanana</strong> 的提示词，直接生成一张直观的图片，放在文档里逼格满满。</p>
</li>
</ul>
<p>这种工作流，能确保你的所有精力都花在“收集高价值信息”这一核心环节上，而将所有“整理和排版”的脏活累活都外包给 AI。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9be975a353664aaf95fc6561aaeed223~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=saabE6vYPdTkfeza4QFFvKXu%2FYk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-19"><strong>写在最后：产品经理的 AI 生存法则</strong></h2>
<p>回顾全文，我们发现 TRAE 这类 AI IDE 带给产品经理的，不仅是效率工具，更是一套全新的工作范式。</p>
<p>为了让你能更好地消化和应用，我将全文的核心技巧总结如下：</p>
<h3 data-id="heading-20"><strong>核心认知</strong></h3>
<ul>
<li>
<p><strong>TRAE  是「想法翻译器」：你的逻辑表达越清晰，TRAE 的还原度就越高。</strong></p>
</li>
<li>
<p><strong>拥抱“小步快跑”：</strong> 从框架 -&gt; 组件 -&gt; 细节，增量迭代，永远比一口吃成胖子更稳、更快。</p>
</li>
<li>
<p><strong>从“画图”到“说话”：</strong> 工作产出从静态线框图，升级为高保真、可交互的 HTML。</p>
</li>
</ul>
<h3 data-id="heading-21"><strong>实战技巧</strong></h3>
<ul>
<li>
<p><strong>页面还原双法器：</strong></p>
<p><strong>截图法：</strong> 直接截图 + Playwright MCP，简单粗暴</p>
<p><strong>设计稿法：</strong> Figma + AI Bridge，设计图直接变代码</p>
</li>
<li>
<p><strong>Playwright MCP 三妙用：</strong> 检查实现效果、对比参考网站、模拟用户测试流程</p>
</li>
<li>
<p><strong>细节微调四板斧：</strong> 复制 classname 精准定位、细致表达需求、指定技术维度、更换模型/重置上下文</p>
</li>
</ul>
<h3 data-id="heading-22"><strong>项目规范</strong></h3>
<ul>
<li>
<p><strong>Start 脚本：</strong> 固定端口启动，自动清理占用，终端打印访问地址</p>
</li>
<li>
<p><strong>FRONTEND_SPEC.md：</strong> 沉淀前端规范，让后续迭代有章可循</p>
</li>
<li>
<p><strong>用户视角描述法：</strong> 从起始→操作→反馈→位置→内容，完整描述交互流程</p>
</li>
</ul>
<h3 data-id="heading-23"><strong>进阶应用</strong></h3>
<ul>
<li>
<p><strong>0-1 项目搭建：</strong> 自由度更高，但更需要规范约束</p>
</li>
<li>
<p><strong>实现文档先行：</strong> 不确定实现方案时，先让 AI 写实现文档</p>
</li>
<li>
<p><strong>增量迭代思维：</strong> 基础功能→交互优化→高级功能，循序渐进</p>
</li>
</ul>
<h3 data-id="heading-24"><strong>Prompt 心得</strong></h3>
<ul>
<li>
<p><strong>自由随性：</strong> 没有严格的表达规范，重点是把需求说清楚</p>
</li>
<li>
<p><strong>信息要给足：</strong> 现状、期望、参考信息，一个都不能少</p>
</li>
<li>
<p><strong>多模态表达：</strong> 文字描述 + 截图 + 网页参考，让 TRAE 理解更精准</p>
</li>
</ul>
<p><strong>最后想说的是，</strong> TRAE 让我们真正拥有了将想法直接落地的能力。它让我们能够把更多的时间花在思考产品逻辑和用户体验上，而不是纠结于具体的代码实现。</p>
<p>希望我的这些经验分享，能够帮助大家在日常工作中更好地使用 TRAE，提升工作效率。如果你也有类似的使用心得，欢迎在评论区交流讨论！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffadcdbefa146ffac4f2d10a5723da8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=bHmvM6iWAv0lsgkWW2iYAre5Das%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-25"><strong>附录1：TRAE &amp; MCP 配置指南</strong></h2>
<p>为了方便你快速上手，我把需要用到的配置都整理在这里了，直接复制粘贴就行。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27d7573ba6b94cd1b0eae6f27102c34b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=fO7qbdn83HxtLgZgee8usPW0sKU%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df8e4cf43188431485fc72adb5b8d987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=Z6FRulZ%2F5Jd8kx0kDG3qclPYojE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-26"><strong>1. Playwright 配置</strong></h3>
<p><strong>相关链接</strong></p>
<p><strong>GitHub 仓库：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp" target="_blank" title="https://github.com/microsoft/playwright-mcp" ref="nofollow noopener noreferrer">microsoft/playwright-mcp</a></p>
<p><strong>Chrome 插件下载：</strong> [Releases 页面](<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp%2Freleases)" target="_blank" title="https://github.com/microsoft/playwright-mcp/releases)" ref="nofollow noopener noreferrer">github.com/microsoft/p…</a> </p>
<h4 data-id="heading-27"><strong>步骤一：配置 MCP</strong></h4>
<pre><code class="hljs language-perl" lang="perl">{
<span class="hljs-string">"mcpServers"</span>: {
  <span class="hljs-string">"Playwright"</span>: {
    <span class="hljs-string">"command"</span>: <span class="hljs-string">"npx"</span>,
    <span class="hljs-string">"args"</span>: [
      <span class="hljs-string">"@playwright/mcp@latest"</span>,
      <span class="hljs-string">"--extension"</span>
    ]
  }
}
}
</code></pre>
<h4 data-id="heading-28"><strong>步骤二：安装浏览器插件</strong></h4>
<ul>
<li>
<p>从上面的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fplaywright-mcp%2Freleases" target="_blank" title="https://github.com/microsoft/playwright-mcp/releases" ref="nofollow noopener noreferrer">Releases 页面</a> 下载最新版本的插件压缩包。</p>
</li>
<li>
<p>打开 Chrome 的扩展程序管理页面 (<code>chrome://extensions/</code>)。</p>
</li>
<li>
<p>直接将下载的压缩包拖拽到页面中，即可自动安装。</p>
</li>
<li>
<p>记得手动将插件<strong>固定到工具栏</strong>，方便查看连接状态。</p>
</li>
</ul>
<p><strong>如何使用？</strong></p>
<blockquote>
<p>在对话中，明确提出让 AI 使用 <em><strong>playwrightmcp</strong></em> 即可触发。</p>
</blockquote>
<p>示例：“请你使用 playwrightmcp 打开我的项目地址 or 网页...”</p>
<h3 data-id="heading-29"><strong>2. Figma AI Bridge 配置</strong></h3>
<p>这个稍微复杂点，需要填入你的 Figma Token。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Figma AI Bridge"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"figma-developer-mcp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--stdio"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"FIGMA_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"替换为你的 key"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"disabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-30"><strong>如何获取 Figma Key？</strong></h4>
<blockquote>
<p>登录 Figma 网页版 -&gt; 点击头像 -&gt; Settings -&gt; Personal access tokens -&gt; Generate new token。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51f65498e5f343fc9fd92b18103bf4b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=zTLf1TuuldrdsuCtSEJxTXfBSaY%3D" alt="截屏2026-02-09 16.00.02.png" loading="lazy"/></p>
<h4 data-id="heading-31"><strong>如何使用？</strong></h4>
<blockquote>
<p>在对话中，明确提出让 AI 使用 <em><strong>fig</strong></em> <em><strong>ma ai bridge mcp</strong></em> 即可触发。</p>
</blockquote>
<p><strong>示例：</strong> “请你使用 figma ai bridge mcp 来查看我的设计图 {{此处填入你的设计图 url}}...并1:1 还原为前端的 html 页面”</p>
<h4 data-id="heading-32"><strong>如何获取设计图 URL？</strong></h4>
<p>选中你想还原的容器（整个页面选最外层，单个组件选组件容器），右键 -&gt; Copy link -&gt; Copy link to selection。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380138f301e8437d8033673d6327bc1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=9NhNwfdpdk9oBZ63A7OM1Wev1ZY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-33"><strong>配套神器：Builder.io 插件 (网页转设计图)</strong></h4>
<p>在 Figma 的 <strong>Actions</strong> (Cmd/Ctrl + P) 中搜索 <code>Builder.io</code> 并运行。</p>
<p>打开插件后，在 <strong>Import</strong> 菜单处选择 <code>Paste from Chrome</code>。</p>
<blockquote>
<p>贴入使用它配套 Chrome 插件复制的前端代码 JSON，就能在 Figma 中拿到对应的设计图了。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eb66780267d493b9ed5e1e790bfa2e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=IGvUoG8wOhs64Bww%2FD87HLyVf1U%3D" alt="截屏2026-02-09 16.01.57.png" loading="lazy"/></p>
<h3 data-id="heading-34"><strong>3. 其他建议配置</strong></h3>
<p>为了体验更丝滑，建议检查以下设置：</p>
<p><strong>对话流配置：</strong></p>
<p><strong>自动运行 MCP：</strong> 开启 (省得每次都要点确认)</p>
<p><strong>令运行方式：</strong> 沙箱运行 (安全第一)</p>
<p><strong>个人白名单范围</strong> (参考)：</p>
<p>python, cd,npm, chmod (根据项目需要灵活调整)</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ccb53c2124c40dd9e16a1a7352eeabc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=JyQAvOR53F4p%2FR2FJH%2BudD7qPbE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2484141f57c642459253d2c1e5b046dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771229228&amp;x-signature=UEFgISf1O3E9jVl6HNfAOkmty4s%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-35"><strong>附录2 ：常见资源占位 — AI 从哪里获取</strong></h2>
<p>本附录面向参与 AI Coding 的各位，说明常见占位资源（图标、图片）应从何处取得，以及如何在提示词中明确要求，避免图裂或缺图标。</p>
<h3 data-id="heading-36"><strong>1. 图标 (Icon) 占位</strong></h3>
<p>建议做法：在提示词中直接指定使用某一套图标库，让 AI 用现成组件而非自绘或占位文字。</p>
<p>* 可选来源（任选其一即可，在提示词里提一嘴即可）：</p>
<ul>
<li>
<p>React 生态常用：<em><strong>react-icons</strong></em>（如 <em><strong>react-icons/fa</strong></em>、<em><strong>react-icons/hi</strong></em> 等）</p>
</li>
<li>
<p>组件库自带：若项目已用 Ant Design、Material-UI、Chakra UI 等，可写明「使用 Ant Design 的 Icon 组件」「使用 MUI 的 Icons」等</p>
</li>
</ul>
<p>* 提示词示例：</p>
<ul>
<li>
<p>  「页面里的图标请用 <em><strong>react-icons</strong></em>，从里面选合适的图标即可。」</p>
</li>
<li>
<p>  「我们项目用 Ant Design，图标统一用 Ant Design 的 Icon 组件。」</p>
</li>
</ul>
<p>只要在需求或提示词中明确写出「用 xx 的 icon 库」，AI 就会从该库选图标，避免留空白或乱码占位。</p>
<h3 data-id="heading-37"><strong>2. 图片 (Image) 占位</strong></h3>
<p><strong>建议做法</strong>：占位图片从 <a href="https://link.juejin.cn?target=https%3A%2F%2Funsplash.com%2F" target="_blank" title="https://unsplash.com/" ref="nofollow noopener noreferrer">Unsplash</a> 获取与内容相关的免费可商用图片；且<strong>必须在采用前验证每个图片链接可访问</strong>，避免上线后图裂。</p>
<ul>
<li>  来源： Unsplash 提供可免费使用的图片，适合原型与占位。</li>
</ul>
<p>提示词中建议写明：</p>
<ul>
<li>
<p>  「占位图片从 Unsplash 上获取与 [主题/关键词] 相关的公共图片。」</p>
</li>
<li>
<p>  「使用 Unsplash 的图片作为占位图，并在代码或脚本中验证每个图片 URL 可访问；若不可访问则替换或跳过，防止图裂。」</p>
</li>
<li>
<p>  重要： 务必让 AI 逐个验证 Unsplash 的图片链接是否可访问（例如用 HEAD/GET 请求或简单的加载测试），再写进页面或资源列表。这样可以避免拿回来的链接已失效导致前后端出现图裂。</p>
</li>
</ul>
<p><strong>小结：</strong> 图标指定 icon 库；图片指定 Unsplash + 验证可访问性，即可在 AI Coding 流程中稳定使用这两类占位资源。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 状态数据设计 [8 - 3]：服务端状态与客户端状态的架构分离]]></title>    <link>https://juejin.cn/post/7604080364353536027</link>    <guid>https://juejin.cn/post/7604080364353536027</guid>    <pubDate>2026-02-09T01:48:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604080364353536027" data-draft-id="7604037348608507942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 状态数据设计 [8 - 3]：服务端状态与客户端状态的架构分离"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-09T01:48:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 状态数据设计 [8 - 3]：服务端状态与客户端状态的架构分离
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-09T01:48:14.000Z" title="Mon Feb 09 2026 01:48:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>架构师的核心能力之一是<strong>分类</strong>。 如果你觉得状态管理很痛苦，通常是因为你试图用同一种工具处理两种截然不同的东西：</p>
<ol>
<li><strong>客户端状态 (Client State):</strong> 比如“侧边栏是否展开”、“当前的夜间模式”。它们是同步的、瞬间完成的、由前端完全控制。</li>
<li><strong>服务端状态 (Server State):</strong> 比如“用户订单列表”。它们是异步的、可能失效的、由后端控制。</li>
</ol>
<p><strong>Redux 并不擅长管理 Server State。</strong> 真正专业的做法是：让 Redux 回归 UI，让 <strong>TanStack Query (React Query)</strong> 接管 API。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d9f6f5986f94242a443885bf85de09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771206494&amp;x-signature=uHWxDd5HMJlf7Tqefazr1Yj2Duo%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 为什么要把 API 赶出 Redux？</h2>
<h3 data-id="heading-1">1.1 消失的“样板代码”</h3>
<p>在传统的 Redux 处理 API 流程中，你需要写：</p>
<ul>
<li>一个 <code>Constant</code> 定义 <code>FETCH_USER_REQUEST</code></li>
<li>一个 <code>Action Creator</code></li>
<li>一个处理 <code>Pending/Success/Error</code> 的 <code>Reducer</code></li>
<li>一个 <code>useEffect</code> 来触发请求</li>
</ul>
<p>而在 <strong>TanStack Query</strong> 中，这只需要一行代码：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> { data, isLoading } = <span class="hljs-title function_ invoke__">useQuery</span>({ <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'user'</span>], <span class="hljs-attr">queryFn</span>: fetchUser });
</code></pre>
<h3 data-id="heading-2">1.2 缓存与失效：Redux 的盲区</h3>
<p>Server State 最难的不是“获取”，而是**“维护”**。</p>
<ul>
<li>用户离开页面 5 分钟后回来，数据还是新的吗？</li>
<li>两个组件同时请求同一个接口，会发两次请求吗？</li>
<li>弱网环境下，请求失败了会自动重试吗？ 如果要用 Redux 实现这些，你需要写几百行复杂的 Middleware。而这些，是 Server State 管理工具的<strong>标配</strong>。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、 架构模型：双层数据流</h2>
<p>现代前端架构推荐采用 <strong>“双层分离”</strong> 模型：</p>
<h3 data-id="heading-4">2.1 外部层：服务端状态 (Server State)</h3>
<ul>
<li><strong>工具：</strong> TanStack Query (React Query) 或 SWR。</li>
<li><strong>职责：</strong> 缓存管理、自动预取、失效检查 (Stale-While-Revalidate)、请求去重。</li>
<li><strong>特点：</strong> 它是<strong>异步</strong>的。</li>
</ul>
<h3 data-id="heading-5">2.2 内部层：客户端状态 (Client State)</h3>
<ul>
<li><strong>工具：</strong> Zustand, Pinia, Jotai 或简单的 React Context。</li>
<li><strong>职责：</strong> 管理纯粹的 UI 逻辑（开关、多语言、主题、临时草稿）。</li>
<li><strong>特点：</strong> 它是<strong>同步</strong>的。</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、 实战战术：从“手动挡”切换到“自动挡”</h2>
<h3 data-id="heading-7">3.1 自动化的依赖追踪</h3>
<p>想象一个场景：你修改了用户的头像，你需要更新所有显示头像的地方。</p>
<ul>
<li><strong>旧模式 (Redux):</strong> 修改成功后，手动发起一个 <code>updateUserAction</code> 去修改 Redux 里的那个大对象。</li>
<li><strong>新模式 (Query):</strong> 只需要执行一次“失效（Invalidate）”。</li>
</ul>

<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 当用户修改个人资料成功时</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">mutation</span> = <span class="hljs-title function_ invoke__">useMutation</span>({
  <span class="hljs-attr">mutationFn</span>: updateProfile,
  <span class="hljs-attr">onSuccess</span>: () =&gt; {
    <span class="hljs-comment">// 告诉系统：['user'] 这个 key 下的数据脏了，请自动重新拉取</span>
    queryClient.<span class="hljs-title function_ invoke__">invalidateQueries</span>({ <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'user'</span>] })
  },
})
</code></pre>
<p><strong>架构意义：</strong> 你的代码不再需要关心“数据怎么同步”，只需要关心“数据何时失效”。</p>
<h3 data-id="heading-8">3.2 乐观更新 (Optimistic Updates)</h3>
<p>这是架构高级感的核心。当用户点赞时，我们不等后端返回，直接改 UI。</p>
<p>TanStack Query 允许你在 <code>onMutate</code> 中手动修改缓存副本，如果请求失败，它会自动回滚。这种复杂的逻辑如果写在 Redux 里，会让 Reducer 逻辑变得极度臃肿。</p>
<hr/>
<h2 data-id="heading-9">四、 选型决策：什么时候该用谁？</h2>
<p>作为架构师，你需要给团队划清界限：</p>



































<table><thead><tr><th>状态类型</th><th>典型例子</th><th>推荐工具</th><th>存储位置</th></tr></thead><tbody><tr><td><strong>API 数据</strong></td><td>商品列表、用户信息</td><td><strong>TanStack Query</strong></td><td>专用 Cache 池</td></tr><tr><td><strong>全局 UI 状态</strong></td><td>登录 Token、全局主题</td><td><strong>Zustand / Pinia</strong></td><td>全局 Store</td></tr><tr><td><strong>局部 UI 状态</strong></td><td>某个弹窗的开关</td><td><strong>useState</strong></td><td>组件内部</td></tr><tr><td><strong>复杂表单</strong></td><td>多步骤注册表单</td><td><strong>React Hook Form</strong></td><td>专用 Form State</td></tr></tbody></table>
<p>导出到 Google 表格</p>
<hr/>
<h2 data-id="heading-10">五、 总结：让 Redux 变“瘦”</h2>
<p>通过把 API 逻辑剥离出去，你会发现你的 Redux（或者 Zustand）Store 瞬间缩水了 <strong>80%</strong> 。 剩下的代码变得极其纯粹：只有纯同步的 UI 逻辑。</p>
<p>这种**“分治”**带来的好处是巨大的：</p>
<ol>
<li><strong>心智负担降低：</strong> 你不再需要管理复杂的 <code>loading</code> 状态机。</li>
<li><strong>性能提升：</strong> TanStack Query 的细粒度缓存比 Redux 的全量对比快得多。</li>
<li><strong>开发效率：</strong> 团队成员可以更专注地编写业务逻辑，而不是在样板代码中挣扎。</li>
</ol>
<hr/>
<h2 data-id="heading-11">结语：控制的艺术</h2>
<p>我们已经成功地将 API 数据和 UI 状态分开了。 但还有一种状态最让架构师头疼：<strong>流程状态</strong>。 当你的业务逻辑包含“待支付 -&gt; 支付中 -&gt; 支付成功/失败 -&gt; 申请退款 -&gt; 已关闭”这种复杂的链路时，无论你用什么工具，代码里都会充满 <code>if/else</code>。</p>
<p>这种逻辑该如何优雅地管理？</p>
<blockquote>
<p><strong>Next Step:</strong> 下一节，我们将引入一个在航天和游戏领域应用了几十年的数学模型。 我们将学习如何用“图”的思想，终结代码里的逻辑乱麻。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零起步学习Redis || 第九章：缓存雪崩，缓存击穿，缓存穿透三大问题的成因及实战解决方案]]></title>    <link>https://juejin.cn/post/7604801893529944107</link>    <guid>https://juejin.cn/post/7604801893529944107</guid>    <pubDate>2026-02-10T08:03:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604801893529944107" data-draft-id="7604853010170609705" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零起步学习Redis || 第九章：缓存雪崩，缓存击穿，缓存穿透三大问题的成因及实战解决方案"/> <meta itemprop="keywords" content="服务器,Redis"/> <meta itemprop="datePublished" content="2026-02-10T08:03:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="茶杯梦轩"/> <meta itemprop="url" content="https://juejin.cn/user/195039473183699"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零起步学习Redis || 第九章：缓存雪崩，缓存击穿，缓存穿透三大问题的成因及实战解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/195039473183699/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    茶杯梦轩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T08:03:02.000Z" title="Tue Feb 10 2026 08:03:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h2 data-id="heading-0">前言</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90fde5dbe7d14a28a5f493b833b48398~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iy25p2v5qKm6L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771315383&amp;x-signature=lmlEqdAsm5Pw%2FTVJZN7CwfeYt5w%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>在高并发系统中，我们通常会使用 <strong>Redis</strong> 来做缓存，以减轻数据库压力、提高系统性能。然而，在实际开发中，如果缓存机制设计不当，就容易出现三种经典问题：</p>
<ul>
<li><strong>缓存雪崩（Cache Avalanche）</strong></li>
<li><strong>缓存击穿（Cache Breakdown）</strong></li>
<li><strong>缓存穿透（Cache Penetration）</strong></li>
</ul>
<p>这三种问题看起来类似，但根本原因和解决方案却不相同。本文将逐一分析它们的 <strong>成因、影响、解决方案及代码实践</strong>。</p>
<hr/>
<h2 data-id="heading-1"> 一、缓存雪崩（Cache Avalanche）</h2>
<h3 data-id="heading-2"> 1. 概念</h3>
<p>缓存雪崩是指：</p>
<blockquote>
<p>在同一时间，大量缓存数据同时过期或缓存服务宕机，导致所有请求直接打到数据库，数据库压力骤增甚至崩溃。</p>
</blockquote>
<h3 data-id="heading-3"> 2. 成因</h3>
<ul>
<li>所有缓存 key 设置了相同的过期时间（如都在凌晨 0 点失效）；</li>
<li>Redis 宕机；</li>
<li>应用重启或缓存被批量清空。</li>
</ul>
<p>示例：</p>
<blockquote>
<p>商品信息缓存设置为 2 小时失效，2 小时后所有 key 同时过期，大量请求瞬间涌向数据库。</p>
</blockquote>
<h3 data-id="heading-4"> 3. 解决方案</h3>
<h4 data-id="heading-5">✅ 方案1：给过期时间加随机值（均匀平均过期时间）</h4>
<p>避免同一时刻大量 key 同时失效。</p>
<pre><code class="hljs language-scss" lang="scss">int expire = <span class="hljs-number">3600</span> + new <span class="hljs-built_in">Random</span>()<span class="hljs-selector-class">.nextInt</span>(<span class="hljs-number">600</span>); <span class="hljs-comment">// 1小时~1小时10分钟</span>
redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>("product:" + id, product, expire, TimeUnit.SECONDS);
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-6">✅ 方案2：缓存预热</h4>
<p>在系统启动或流量高峰前，提前加载热点数据进缓存。</p>
<h4 data-id="heading-7">✅ 方案3：服务降级机制</h4>
<p>当缓存不可用时，临时返回默认值、兜底数据或提示稍后再试。</p>
<h4 data-id="heading-8">✅ 方案4：多级缓存</h4>
<p>例如：</p>
<ul>
<li>一级：本地缓存（Caffeine、Guava）</li>
<li>二级：Redis</li>
</ul>
<h4 data-id="heading-9">✅ 方案5：互斥锁</h4>
<p>当大量业务线程请求Redis发现数据不存在（过期），使用互斥锁锁住一个线程（保证同一时刻只有一个线程去拉取数据到Redis），其他线程没有锁就无法请求，只能等待或者返回空值</p>
<h4 data-id="heading-10">✅ 方案6：后台更新缓存</h4>
<p>数据直接设置为不过期，如果数据库有变化，再更新Redis中的数据</p>
<p>问题：不过期可能会出现内存淘汰，此时如何处理？</p>
<p>答：业务线程发现缓存数据失效后，用<strong>消息队列</strong>通知后台线程更新缓存</p>
<hr/>
<h2 data-id="heading-11"> 二、缓存击穿（Cache Breakdown）</h2>
<h3 data-id="heading-12"> 1. 概念</h3>
<p>缓存击穿是指：</p>
<blockquote>
<p>某个热点 key 在失效的瞬间，有大量并发请求同时访问该 key，缓存未命中，导致瞬间大量请求打到数据库。</p>
</blockquote>
<h3 data-id="heading-13"> 2. 成因</h3>
<ul>
<li>热点 key 过期（例如秒杀商品、首页 banner 等）；</li>
<li>瞬间有大量请求访问该热点 key。</li>
</ul>
<h3 data-id="heading-14"> 3. 解决方案</h3>
<h4 data-id="heading-15">✅ 方案1：分布式锁（互斥锁）</h4>
<p>防止多个线程同时去加载数据库。</p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">key</span> = <span class="hljs-string">"product:"</span> + id<span class="hljs-comment">;</span>
String <span class="hljs-attr">lockKey</span> = <span class="hljs-string">"lock:"</span> + key<span class="hljs-comment">;</span>

Object <span class="hljs-attr">cache</span> = redisTemplate.opsForValue().get(key)<span class="hljs-comment">;</span>
if (<span class="hljs-attr">cache</span> == null) {
    if (tryLock(lockKey)) { // 抢到锁
        Object <span class="hljs-attr">dbData</span> = queryFromDB(id)<span class="hljs-comment">;</span>
        redisTemplate.opsForValue().set(key, dbData, 60, TimeUnit.SECONDS)<span class="hljs-comment">;</span>
        releaseLock(lockKey)<span class="hljs-comment">;</span>
    } else {
        Thread.sleep(100)<span class="hljs-comment">; // 没抢到锁的稍等再查缓存</span>
        return redisTemplate.opsForValue().get(key)<span class="hljs-comment">;</span>
    }
}
return cache<span class="hljs-comment">;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-16">✅ 方案2：逻辑过期（永不过期策略）</h4>
<p>缓存中保存数据和过期时间字段，过期后后台异步更新，而非直接删除缓存。</p>
<h4 data-id="heading-17">✅ 方案3：异步预刷新</h4>
<p>使用定时任务在 key 即将过期时提前刷新。</p>
<hr/>
<h2 data-id="heading-18"> 三、缓存穿透（Cache Penetration）</h2>
<h3 data-id="heading-19"> 1. 概念</h3>
<p>缓存穿透是指：</p>
<blockquote>
<p>查询一个 <strong>缓存和数据库中都不存在的 key</strong>，每次请求都绕过缓存直接打到数据库，导致数据库压力过大。</p>
</blockquote>
<h3 data-id="heading-20"> 2. 成因</h3>
<ul>
<li>用户或攻击者请求非法或不存在的 key；</li>
<li>数据库查无此数据，缓存未保存任何结果；</li>
<li>下次相同请求又打到数据库。</li>
</ul>
<p>示例：</p>
<blockquote>
<p>攻击者请求 <code>/product?id=-9999</code>，Redis 没有，数据库也没有。下次再请求又重复打 DB。</p>
</blockquote>
<h3 data-id="heading-21"> 3. 解决方案</h3>
<h4 data-id="heading-22">✅ 方案1：缓存空对象</h4>
<p>查询结果为空时，也写入缓存（可设置较短 TTL）。</p>
<pre><code class="hljs language-bash" lang="bash">Object dbData = queryFromDB(<span class="hljs-built_in">id</span>);
<span class="hljs-keyword">if</span> (dbData == null) {
    redisTemplate.opsForValue().<span class="hljs-built_in">set</span>(<span class="hljs-string">"product:"</span> + <span class="hljs-built_in">id</span>, <span class="hljs-string">"NODATA"</span>, 60, TimeUnit.SECONDS);
} <span class="hljs-keyword">else</span> {
    redisTemplate.opsForValue().<span class="hljs-built_in">set</span>(<span class="hljs-string">"product:"</span> + <span class="hljs-built_in">id</span>, dbData, 300, TimeUnit.SECONDS);
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h4 data-id="heading-23">✅ 方案2：参数校验</h4>
<p>对请求参数合法性进行检查，如 ID &lt; 0 或非法字符直接拦截。</p>
<h4 data-id="heading-24">✅ 方案3：布隆过滤器（Bloom Filter）</h4>
<p>在访问 Redis 之前，先通过布隆过滤器判断 key 是否可能存在。</p>
<ul>
<li>不存在 → 直接拦截请求；</li>
<li>可能存在 → 再访问 Redis。</li>
</ul>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">if</span> (!bloomFilter.mightContain(<span class="hljs-string">"product:"</span> + id)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 直接拦截</span>
}
<span class="hljs-keyword">return</span> redisTemplate.opsForValue().<span class="hljs-keyword">get</span>(<span class="hljs-string">"product:"</span> + id);
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-25"> 四、对比总结</h2>





























<table><thead><tr><th>问题类型</th><th>现象</th><th>成因</th><th>解决方案</th></tr></thead><tbody><tr><td><strong>缓存雪崩</strong></td><td>大量缓存同时失效，DB 压力暴增</td><td>同一时间过期、Redis 宕机</td><td>随机过期时间、预热、降级、多级缓存</td></tr><tr><td><strong>缓存击穿</strong></td><td>热点 key 失效瞬间被并发访问</td><td>热点 key 过期</td><td>分布式锁、逻辑过期、异步刷新</td></tr><tr><td><strong>缓存穿透</strong></td><td>查询不存在数据反复访问 DB</td><td>key 不存在且无缓存</td><td>缓存空值、参数校验、布隆过滤器</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-26"> 五、结语</h2>
<p>Redis 缓存的使用是高并发系统中提升性能的关键手段，但如果不处理好缓存的失效机制，系统反而可能因为缓存问题而“自爆”。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>