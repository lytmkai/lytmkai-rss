<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚]]></title>    <link>https://juejin.cn/post/7583921477614125091</link>    <guid>https://juejin.cn/post/7583921477614125091</guid>    <pubDate>2025-12-16T02:00:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477614125091" data-draft-id="7583921477614108707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T02:00:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="软件求生"/> <meta itemprop="url" content="https://juejin.cn/user/1038379932466263"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 变量的江湖恩怨：一篇文章彻底讲清楚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1038379932466263/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    软件求生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:00:07.000Z" title="Tue Dec 16 2025 02:00:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很久很久以前，在 JavaScript 世界里，有一个叫<strong>变量镇</strong>的地方。这里住着三兄弟：<strong>var、let、const</strong>。他们都能“装东西”，但性格、规矩、出身背景完全不一样。也正因为这三兄弟的性格差异，程序员江湖里每天都在上演各种事故现场。</p>
<p>今天，我就带你走进变量镇，看看他们各自是怎么“翻车”的，又该如何正确相处。</p>
<h2 data-id="heading-0">老大哥 var：江湖老油条</h2>
<p><strong>1、var 关键字：最早的居民</strong></p>
<p>var 是 JavaScript 最早的变量声明方式，堪称<strong>上古神器</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28deaf0d6a844195bc7caa30a7d83813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=K5h9NfGX4vJhCr5eXQY39Yn1TC8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 ES6 之前，整个变量镇几乎被 var 一统江湖。但问题也正是从这里开始的。</p>
<p><strong>2、 var 声明作用域：没有块级概念</strong></p>
<p>在变量镇里，var 有个非常“随意”的性格：<strong>它只认函数，不认花括号。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90c1c989eb804ddca7096d90f7f8ed13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=gy9p6ovTp72ZeMgJwkIjCgGyphM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>很多新手第一次看到这个结果时，内心都是崩溃的：</p>
<blockquote>
<p>“不是写在 if 里面吗？怎么跑出来了？”</p>
</blockquote>
<p>在 var 眼里，if、for、while 都不算地盘，只有<strong>函数</strong>才算真正的边界。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c521decb3ca434bad59a00cd849abd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=GQ89rjnJsrksrRD9q7j2zUKqfJM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>总结一句话：</strong></p>
<blockquote>
<p>var 只有<strong>函数作用域</strong>，没有<strong>块级作用域</strong>。</p>
</blockquote>
<p><strong>3、 var 声明提升：先上车后补票</strong></p>
<p>var 还有一个让人又爱又恨的能力——<strong>声明提升</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e9618edf554564a30ece01961a99d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=quTfGnFQINMvYsufwrgWLwHK65E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 JavaScript 引擎眼里，上面的代码其实是这样执行的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a44dab9927434a12bc7492bc16cfd15a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=NEN3PckLYYbDzc1WN0YmdrVjsyI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>变量声明被“偷偷”提到了最前面，但赋值还在原地。这就像你先报了名字进群，但个人资料还没填完。</p>
<p><strong>风险点：</strong></p>
<ul>
<li>不报错</li>
<li>但结果是 undefined</li>
<li>很容易掩盖 bug</li>
</ul>
<h2 data-id="heading-1">二哥 let：讲规矩的现代青年</h2>
<p>后来，ES6 来了，变量镇迎来了新居民：<strong>let</strong>。</p>
<p><strong>1、let 声明：有边界感的人</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e565c0f2e2e4bdeb395f4761792a373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=caJzDKseBQ8go%2FV7Pnobl%2Bnvi6g%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>let 的出现，第一件事就是：<strong>给变量加上边界感。</strong></p>
<p><strong>2、 暂时性死区：我没到，你别碰</strong></p>
<p>let 有一个非常重要的概念：<strong>暂时性死区（TDZ）</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/582ff83b22fe4eb489cc1741590d777a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=MVK95A9FF28Icyo9cto7YH3KAfw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>直接报错：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01e120eb692d4432b224699cb9db5bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=CemmIat1%2Bg5sceDsIwjyRVmGHis%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>在 let 看来：“你可以提前知道我会来，但在我真正登场之前，你不能碰我。”</p>
<p>这和 var 的“先声明后赋值”完全不同。</p>
<p><strong>3、 let 的块级作用域</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ed80bd1aa9245d193e6ae511c39ea52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=9S3ym4G83zBZUXoGpnJbSdwbgzU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这一次，变量终于<strong>老老实实待在自己的花括号里</strong>。</p>
<p>这也是 let 最大的价值之一：<strong>减少变量污染，降低心智负担。</strong></p>
<p><strong>4、 全局声明：不会挂到 window 上</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d178b524c6da45748148b6ac15cfb3da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=mUPRLfA0g5oII5VMsQv79gLIVnE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>而如果是 var：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e4b9c139ee648a0a970f8173e678795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=5JUs6kK%2FRjSDmhQ4prqVxLJgdoM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这意味着：</p>
<ul>
<li>var 会污染全局对象</li>
<li>let 不会</li>
</ul>
<p>在大型项目里，这一点尤为重要。</p>
<p><strong>5、 for 循环中的 let：为循环而生</strong></p>
<p>这是 let 最让人拍手叫好的地方。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b857d92ae73f4ac59dc1234451dd9237~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=4ZXthja%2Bp3xGjeZbsNk6I057lQU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>输出结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d7d53fafa7c45f9b4f1ad5e23dd2899~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=vY7c0QgEmmyV93zs5yx7A48KWc0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>如果换成 var：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f1769498364d04869548c5da3453e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=yy6fYvuds95yKSH3aj6lnJSbs0I%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>结果是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1941834751b74ef4b0fa4655cf95b9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=aQIQXRRrXyep9BLeErfEykt7A4s%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>原因很简单：</p>
<ul>
<li>var 只有一个 i</li>
<li>let 每次循环都会创建一个新的 i</li>
</ul>
<p><strong>一句话总结：</strong> 只要是循环变量，<strong>优先 let</strong>。</p>
<h2 data-id="heading-2">三弟 const：外冷内热的守护者</h2>
<p><strong>1、const 声明：不可变的承诺</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00cd682707604f38ac220f49152b3557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=HXpQGuXLZUCN%2BxA%2Fz%2BSWT3R9hLg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>const 的核心思想是：<strong>一旦绑定，就不能重新绑定。</strong></p>
<p>但很多人会误解这一点。</p>
<p><strong>2、const 并不等于“值不可变”</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7ab00b41a524ccc9fead1cae57efaf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=1kSW7Q8nuOJ5nYSNVYcKuxVryfc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>真正不能做的是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082a2566fb12457884a6a0a87bace289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=DpbQbIDRMsvxpRba39hUvWF80BA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>也就是说：</p>
<ul>
<li>const 锁的是<strong>引用</strong></li>
<li>不是对象内部的属性</li>
</ul>
<h2 data-id="heading-3">三兄弟性格对比表</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4560ae2f8654a0187941b086fe36a3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=nEue4PvJZSvSHs77j1%2B3weI8cn8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-4">声明风格及最佳实践</h2>
<p>讲完故事，我们回到现实世界。</p>
<p><strong>1、 不使用 var</strong></p>
<p>这是现代 JavaScript 项目的共识。原因很简单：</p>
<ul>
<li>容易产生隐式 bug</li>
<li>作用域不直观</li>
<li>不符合现代工程化需求</li>
</ul>
<p>除非你在维护<strong>非常古老的代码</strong>，否则：<strong>请忘记 var 的存在。</strong></p>
<p><strong>2、 const 优先，let 次之</strong></p>
<p>这是我在团队里反复强调的一条规则。<strong>推荐顺序：</strong></p>
<ol>
<li>能用 const 就用 const</li>
<li>需要重新赋值时，用 let</li>
<li>永远不要用 var</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bb341c4c39f42f7ad5099fcd910ee3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2v5Lu25rGC55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455207&amp;x-signature=q79NRTPN5SeETVz4kiv6MTi5ePo%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这样做的好处是：</p>
<ul>
<li>一眼就能看出哪些变量不会变</li>
<li>降低认知成本</li>
<li>代码更安全、更自解释</li>
</ul>
<h2 data-id="heading-5">总结：变量，其实是人的影子</h2>
<p>写到这里，我越来越觉得：</p>
<blockquote>
<p>JavaScript 的变量声明，其实特别像人。</p>
<p>var 像没边界感的老前辈，热心但容易添乱</p>
<p>let 像讲规则的现代职场人，清晰、可靠</p>
<p>const 像立下承诺的人，一旦决定就不会轻易改变</p>
</blockquote>
<p>当你开始<strong>认真选择变量声明方式</strong>的时候，说明你已经不再只是“写能跑的代码”，而是在写<strong>长期可维护的工程</strong>。</p>
<h2 data-id="heading-6">END</h2>
<p>如果你觉得这篇文章对你有帮助，欢迎<strong>点赞、在看、转发</strong>，让更多人认识变量镇的三兄弟。</p>
<p>我是小米，一个喜欢分享技术的31岁程序员。如果你喜欢我的文章，欢迎关注我的微信公众号“<strong>软件求生</strong>”，获取更多技术干货！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 pnpm + Workspaces 构建 Monorepo 的完整指南]]></title>    <link>https://juejin.cn/post/7583970267132821510</link>    <guid>https://juejin.cn/post/7583970267132821510</guid>    <pubDate>2025-12-16T02:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132821510" data-draft-id="7583980250733232191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 pnpm + Workspaces 构建 Monorepo 的完整指南"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T02:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 pnpm + Workspaces 构建 Monorepo 的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:05:01.000Z" title="Tue Dec 16 2025 02:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心概念：pnpm Workspace</h2>
<p>pnpm 内置了对 Monorepo（单一代码仓库）的原生支持，通过 <strong>Workspace（工作区）</strong> ​ 机制实现。Workspace 允许你在一个仓库中管理多个相互关联但独立的项目（包），并智能地处理它们之间的依赖关系。</p>
<h2 data-id="heading-1">二、将普通仓库转变为 Monorepo 的步骤</h2>
<h3 data-id="heading-2">步骤 1：初始化项目结构</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 创建项目根目录</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-monorepo
cd <span class="hljs-keyword">my</span>-monorepo

<span class="hljs-comment"># 初始化根目录 package.json</span>
pnpm init
</code></pre>
<h3 data-id="heading-3">步骤 2：配置根目录 package.json</h3>
<p>修改根目录的 <code>package.json</code>，关键配置如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-monorepo"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-regexp">//</span> 必须设置为 <span class="hljs-literal">true</span>，避免误发布到 npm
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"pnpm -r run dev"</span>,      <span class="hljs-regexp">//</span> -r 表示递归执行所有子包
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"pnpm -r run build"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"pnpm -r run test"</span>
  },
  <span class="hljs-string">"keywords"</span>: [],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>
}
</code></pre>
<p><strong>重要说明</strong>：</p>
<ul>
<li><code>"private": true</code>是必须的，确保整个 Monorepo 不会被意外发布</li>
<li>可以移除 <code>main</code>、<code>test</code>等字段，因为根目录通常不包含业务代码</li>
</ul>
<h3 data-id="heading-4">步骤 3：创建 pnpm-workspace.yaml 配置文件</h3>
<p>在根目录创建 <code>pnpm-workspace.yaml</code>文件，这是 pnpm Workspace 的核心配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  <span class="hljs-comment"># packages 目录下的所有直接子目录</span>
  - <span class="hljs-string">'packages/*'</span>
  
  <span class="hljs-comment"># apps 目录下的所有直接子目录</span>
  - <span class="hljs-string">'apps/*'</span>
  
  <span class="hljs-comment"># components 目录下的所有层级子目录</span>
  - <span class="hljs-string">'components/**'</span>
  
  <span class="hljs-comment"># 排除包含 test 的目录</span>
  - <span class="hljs-string">'!**/test/**'</span>
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>packages/*</code>：匹配 <code>packages</code>目录下的所有一级子目录</li>
<li><code>apps/*</code>：匹配 <code>apps</code>目录下的所有一级子目录</li>
<li><code>components/**</code>：匹配 <code>components</code>目录下的所有层级子目录</li>
<li><code>!**/test/**</code>：排除所有包含 <code>test</code>的目录</li>
</ul>
<p>pnpm 中的两种配置方式</p>
<h4 data-id="heading-5">方式一：使用 <code>package.json</code>的 <code>workspaces</code>字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"apps/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-6">方式二：使用 <code>pnpm-workspace.yaml</code>文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除包含 test 的目录</span>
</code></pre>
<h4 data-id="heading-7">两种方式的优先级与兼容性</h4>
<ol>
<li>
<p><strong>pnpm 的读取顺序</strong>：</p>
<ul>
<li>优先读取 <code>pnpm-workspace.yaml</code></li>
<li>如果不存在，则读取 <code>package.json</code>中的 <code>workspaces</code>字段</li>
<li>如果两者都存在，<strong><code>pnpm-workspace.yaml</code>优先级更高</strong>​</li>
</ul>
</li>
<li>
<p><strong>推荐使用 <code>pnpm-workspace.yaml</code>的原因</strong>：</p>
<ul>
<li><strong>更丰富的配置选项</strong>：支持排除模式（<code>!**/test/**</code>）</li>
<li><strong>更好的可读性</strong>：YAML 格式更适合复杂配置</li>
<li><strong>工具兼容性</strong>：明确标识为 pnpm 工作区</li>
<li><strong>未来扩展性</strong>：pnpm 的新功能会优先在 YAML 配置中支持</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">步骤 4：创建子项目结构</h3>
<p>典型的 Monorepo 目录结构如下：</p>
<pre><code class="hljs language-csharp" lang="csharp">my-monorepo/
├── pnpm-workspace.yaml
├── package.json
├── pnpm-<span class="hljs-keyword">lock</span>.yaml
├── packages/
│   ├── shared-utils/     <span class="hljs-meta"># 共享工具库</span>
│   │   ├── package.json
│   │   └── src/
│   ├── ui-components/    <span class="hljs-meta"># UI 组件库</span>
│   │   ├── package.json
│   │   └── src/
│   └── core-lib/         <span class="hljs-meta"># 核心库</span>
│       ├── package.json
│       └── src/
├── apps/
│   ├── web-app/          <span class="hljs-meta"># 前端应用</span>
│   │   ├── package.json
│   │   └── src/
│   └── mobile-app/       <span class="hljs-meta"># 移动应用</span>
│       ├── package.json
│       └── src/
└── docs/                 <span class="hljs-meta"># 文档</span>
</code></pre>
<h3 data-id="heading-9">步骤 5：配置子项目的 package.json</h3>
<p>每个子项目都需要有自己的 <code>package.json</code>，关键配置如下： <strong>示例：共享工具库 (packages/shared-utils/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@my-monorepo/shared-utils"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/index.d.ts"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc"</span>,
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"tsc --watch"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<p><strong>示例：前端应用 (apps/web-app/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"web-app"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"preview"</span>: <span class="hljs-string">"vite preview"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,  <span class="hljs-regexp">//</span> 关键：引用本地包
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"@types/react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-10">三、关键配置详解</h2>
<h3 data-id="heading-11">1. workspace:* 协议</h3>
<p>这是 pnpm Workspace 的核心特性，用于声明对本地其他包的依赖：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,      <span class="hljs-regexp">//</span> 使用最新版本
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:^1.0.0"</span>, <span class="hljs-regexp">//</span> 指定版本范围
    <span class="hljs-string">"@my-monorepo/core-lib"</span>: <span class="hljs-string">"workspace:../packages/core-lib"</span> // 相对路径
  }
}
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>建立本地包之间的软链接，无需发布到 npm</li>
<li>修改本地包时，依赖它的项目能立即看到变化</li>
<li>确保所有包使用同一份依赖，避免重复安装</li>
</ul>
<h3 data-id="heading-12">2. 依赖安装与管理</h3>
<h4 data-id="heading-13">在根目录安装全局依赖（所有包共享）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安装到根目录，所有包共享</span>
pnpm <span class="hljs-keyword">add</span> typescript -w
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> typescript --workspace-root
</code></pre>
<h4 data-id="heading-14">为特定包安装依赖</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 为 web-app 安装 react</span>
pnpm <span class="hljs-keyword">add</span> react --filter web-app
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> react -F web-app

<span class="hljs-meta"># 为多个包安装依赖</span>
pnpm <span class="hljs-keyword">add</span> axios --filter <span class="hljs-string">"web-app"</span> --filter <span class="hljs-string">"mobile-app"</span>
</code></pre>
<h4 data-id="heading-15">安装本地包依赖</h4>
<pre><code class="hljs language-sql" lang="sql"># 在 web<span class="hljs-operator">-</span>app 中安装 shared<span class="hljs-operator">-</span>utils
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>monorepo<span class="hljs-operator">/</span>shared<span class="hljs-operator">-</span>utils <span class="hljs-comment">--filter web-app</span>
</code></pre>
<h3 data-id="heading-16">3. 脚本执行</h3>
<h4 data-id="heading-17">在所有包中执行相同脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归执行所有包的 build 脚本</span>
pnpm -r run build

<span class="hljs-comment"># 递归执行所有包的 test 脚本</span>
pnpm -r run <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-18">在特定包中执行脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 仅在 web-app 中执行 dev 脚本</span>
pnpm --filter web-app run dev

<span class="hljs-comment"># 使用包名（package.json 中的 name）</span>
pnpm -F @my-monorepo/shared-utils run build
</code></pre>
<h2 data-id="heading-19">四、完整示例：Vue 项目 Monorepo</h2>
<h3 data-id="heading-20">项目结构</h3>
<pre><code class="hljs language-lua" lang="lua">vue-monorepo/
├── pnpm-workspace.yaml
├── <span class="hljs-built_in">package</span>.json
├── packages/
│   ├── ui-lib/          # UI 组件库
│   │   ├── <span class="hljs-built_in">package</span>.json
│   │   ├── src/
│   │   └── vite.<span class="hljs-built_in">config</span>.ts
│   └── utils/           # 工具函数库
│       ├── <span class="hljs-built_in">package</span>.json
│       └── src/
└── apps/
    ├── admin/           # 后台管理系统
    │   ├── <span class="hljs-built_in">package</span>.json
    │   └── src/
    └── portal/          # 门户网站
        ├── <span class="hljs-built_in">package</span>.json
        └── src/
</code></pre>
<h3 data-id="heading-21">pnpm-workspace.yaml</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">packages:</span>
  - <span class="hljs-comment">'packages/*'</span>
  - <span class="hljs-comment">'apps/*'</span>
</code></pre>
<h3 data-id="heading-22">根目录 package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run lint"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-23">包间依赖示例 (apps/admin/package.json)</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@vue-monorepo/ui-lib"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"@vue-monorepo/utils"</span>: <span class="hljs-string">"workspace:*"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-24">五、最佳实践与注意事项</h2>
<h3 data-id="heading-25">1. 命名规范</h3>
<ul>
<li>根项目：使用项目总名称，如 <code>my-monorepo</code></li>
<li>子包：使用作用域名称，如 <code>@my-monorepo/ui-components</code></li>
<li>应用：使用描述性名称，如 <code>web-app</code>、<code>admin-console</code></li>
</ul>
<h3 data-id="heading-26">2. 依赖管理</h3>
<ul>
<li>公共依赖（如 TypeScript、ESLint）安装在根目录</li>
<li>业务依赖安装在各自包中</li>
<li>使用 <code>pnpm-lock.yaml</code>确保依赖一致性</li>
</ul>
<h3 data-id="heading-27">3. 版本控制</h3>
<ul>
<li>提交 <code>pnpm-lock.yaml</code>到版本控制系统</li>
<li>考虑使用 Changesets 或 Lerna 进行版本管理和发布</li>
</ul>
<h3 data-id="heading-28">4. 性能优化</h3>
<ul>
<li>pnpm 使用硬链接和符号链接，节省磁盘空间</li>
<li>所有包共享同一份依赖，安装速度快</li>
<li>支持过滤命令，只构建需要的包</li>
</ul>
<h3 data-id="heading-29">5. CI/CD 集成</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions 示例</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-30">六、常见问题解决</h2>
<h3 data-id="heading-31">1. 幽灵依赖问题</h3>
<p>确保所有依赖都在 <code>package.json</code>中明确声明，避免直接引用 <code>node_modules</code>中的未声明包。</p>
<h3 data-id="heading-32">2. 循环依赖检测</h3>
<p>使用 <code>pnpm why &lt;package-name&gt;</code>检查依赖关系，避免包之间的循环依赖。</p>
<h3 data-id="heading-33">3. 包找不到错误</h3>
<p>如果出现 <code>no matches found</code>错误，检查：</p>
<ul>
<li>包名是否正确（包括作用域）</li>
<li>包是否在 <code>pnpm-workspace.yaml</code>配置的目录中</li>
<li>包是否有正确的 <code>name</code>字段</li>
</ul>
<h3 data-id="heading-34">4. 跨包类型引用</h3>
<p>对于 TypeScript 项目，配置 <code>tsconfig.json</code>中的 <code>paths</code>：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@my-monorepo/*"</span>: [<span class="hljs-string">"packages/*/src"</span>]
    }
  }
}
</code></pre>
<h2 data-id="heading-35">总结</h2>
<p>通过 pnpm + Workspaces 构建 Monorepo 的主要优势包括：</p>
<ol>
<li><strong>依赖共享</strong>：所有包共享同一份依赖，节省磁盘空间和安装时间</li>
<li><strong>原子提交</strong>：跨包变更可以一次性提交，保持一致性</li>
<li><strong>本地链接</strong>：使用 <code>workspace:*</code>协议，本地开发无需发布到 npm</li>
<li><strong>精细控制</strong>：支持按包过滤的命令执行</li>
<li><strong>统一管理</strong>：集中的 CI/CD 和代码质量检查</li>
</ol>
<p>这种架构特别适合中大型项目、微前端架构、组件库开发等场景，能显著提升开发效率和代码复用性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端工程化实践：打包工具的选择与思考]]></title>    <link>https://juejin.cn/post/7583984122234798122</link>    <guid>https://juejin.cn/post/7583984122234798122</guid>    <pubDate>2025-12-16T02:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583984122234798122" data-draft-id="7583984122234732586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端工程化实践：打包工具的选择与思考"/> <meta itemprop="keywords" content="前端,JavaScript,Webpack"/> <meta itemprop="datePublished" content="2025-12-16T02:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="转转技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端工程化实践：打包工具的选择与思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    转转技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:16:24.000Z" title="Tue Dec 16 2025 02:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从静态页面到模块化开发，前端工程化经历了怎样的演进？Webpack、Vite、Rspack 这些打包工具各自解决了什么问题，在实际项目中又该如何选择？</p>
</blockquote>
<h2 data-id="heading-0">前端工程化的出现与发展</h2>
<p>前端工程化的发展经历了几个重要阶段。在 1990 年代到 2000 年代初期的静态页面时代，开发者主要使用 Photoshop 切图和 Dreamweaver 等工具制作页面，代码通常直接写在 HTML 中，大量使用内联样式和事件处理器，所有逻辑集中在一个文件中，导致代码组织混乱、全局变量污染严重、维护困难。到了 2000 年代中期到 2010 年代初期，jQuery 等类库的出现解决了浏览器兼容性问题，简化了 DOM 操作，但代码组织问题依然存在，文件体积持续增长，模块间的依赖关系仍需人工管理。2010 年代初期进入模块化探索阶段，出现了多种模块化方案：CommonJS 主要用于 Node.js 环境，AMD 专注于浏览器端的异步模块加载，CMD 强调按需加载，但这些方案标准不统一，工具链不兼容，给项目协作带来困难。2010 年代中期至今，随着 ES6 模块标准的确定，<code>import / export</code> 语法成为主流，Webpack 等打包工具统一了模块化处理流程，Vite 等新一代工具利用原生 ESM 提升了开发体验，同时 Babel 提供了语法转换能力，TypeScript 提供了类型系统支持，ESLint 和 Prettier 规范了代码风格，前端工程化体系逐步完善，前端开发进入了工具链驱动的时代。</p>
<p>前端工程化的出现主要源于项目规模扩大、团队协作需求增加、业务复杂度提升以及人工管理代码的局限性。首先，传统开发方式中代码组织混乱，所有脚本文件需要在 HTML 中按正确顺序引入，依赖关系必须人工维护，删除或调整文件顺序容易导致错误。工程化后通过 ES Modules 等模块化方案，依赖关系由工具自动管理，开发者只需关注业务逻辑。其次，浏览器兼容性问题突出，使用 <code>Promise</code>、<code>async/await</code> 等新特性时，旧版本浏览器无法识别，需要通过 Babel 将高级语法转换为兼容的 ES5 代码，并通过 polyfill 为旧浏览器补充缺失的 API 支持。第三，开发效率低下，传统方式需要手动刷新页面、重复操作才能看到修改效果，构建过程需要手动进行代码压缩、合并、添加文件哈希等操作，工程化后通过热模块替换实现代码修改后自动更新，通过构建工具自动化完成压缩、文件指纹、代码分包等流程。第四，性能优化缺乏系统性方案，未打包的项目会产生大量 HTTP 请求，未进行代码分割会导致用户需要加载全部代码才能使用部分功能，工程化后通过代码压缩、Tree-shaking 消除无用代码、按需加载、资源预加载等技术手段系统性地优化性能。第五，团队协作缺乏统一规范，代码风格不统一、类型使用不规范、注释缺失等问题影响代码质量和可维护性，工程化后通过 ESLint 进行代码质量检查，通过 Prettier 统一代码格式，通过 TypeScript 在编译期进行类型检查，从而提升代码质量和团队协作效率。</p>
<h2 data-id="heading-1">前端工程化与打包工具</h2>
<h3 data-id="heading-2">打包工具的核心作用</h3>
<p>在前端工程化的工具链中，打包工具承担着核心的构建职责。它的主要功能包括模块依赖解析、代码转换、资源优化以及开发体验提升。</p>
<h4 data-id="heading-3">模块依赖解析</h4>
<p>项目开发中会使用大量的 <code>import</code> 和 <code>require</code> 语句来组织代码，打包工具从入口文件开始，递归分析模块间的依赖关系，构建完整的依赖图，最终将分散的模块文件合并成浏览器可以直接加载的 JavaScript、CSS 等资源文件。这个过程解决了传统开发中需要手动维护脚本加载顺序的问题。</p>
<h4 data-id="heading-4">代码转换与预处理</h4>
<p>现代前端开发中广泛使用的 TypeScript、JSX、Vue 单文件组件、Less/SCSS 等语法和格式，浏览器本身并不支持。打包工具通过配置相应的 Loader 或 Plugin，将这些代码转换为浏览器能够理解的 JavaScript 和 CSS。例如，Babel 可以将 ES6+ 语法转换为 ES5，TypeScript 编译器可以将 TypeScript 代码转换为 JavaScript。</p>
<h4 data-id="heading-5">构建优化</h4>
<p>打包工具在构建过程中会自动执行多种优化操作。代码压缩可以减小文件体积，Tree-shaking 可以移除未使用的代码，代码分割可以将大型应用拆分为多个按需加载的代码块，文件指纹 hash 可以实现长期缓存，资源压缩可以优化图片、字体等静态资源。这些优化如果手动完成，不仅工作量大，而且容易出错。</p>
<h4 data-id="heading-6">开发体验</h4>
<p>打包工具通常还提供开发服务器功能，支持 HMR，当代码修改后可以自动更新页面，无需手动刷新。同时提供清晰的错误提示和 Source Map 支持，方便开发者调试代码。</p>
<p>目前主流的打包工具包括 Webpack、Vite、Rollup、Rspack 等，它们在解决上述问题的同时，由于设计理念和时代背景的不同，在实现方式和性能表现上各有特点。</p>
<h2 data-id="heading-7">主流打包工具全景</h2>
<h3 data-id="heading-8">Webpack</h3>
<p>Webpack 是前端打包工具领域的成熟方案，自 2012 年发布以来，在前端工程化中占据重要地位。它支持多种模块格式，包括 CommonJS、AMD 和 ES Modules，能够处理各种类型的静态资源，如样式文件、图片、字体等，只要编写相应的 Loader，几乎可以将任何资源类型纳入打包流程。Webpack 的插件生态非常丰富，涵盖了 HTML 模板生成、体积分析、代码压缩混淆、国际化等各个方面，为开发者提供了大量现成的解决方案。</p>
<p>Webpack 的构建流程可以概括为：读取配置文件，确定入口文件，递归分析模块依赖关系，通过 Loader 对各类资源进行转换处理，将处理后的模块组织成 Chunk，最终输出优化后的资源文件。在整个构建过程中，Webpack 会触发各种生命周期钩子，Plugin 通过监听这些钩子来扩展功能，实现自定义的构建逻辑。</p>
<p>Webpack 适合在以下场景使用：项目规模较大、结构复杂，需要对打包过程进行精细控制；已有项目基于 Webpack 构建，迁移成本较高；需要处理多种特殊资源类型，对丰富的插件生态有较强依赖。</p>
<p>Webpack 的不足之处在于：配置文件较为复杂，学习曲线较陡，新成员上手需要一定时间；开发环境需要先进行打包，冷启动速度相对较慢；对于大型项目，如果不进行针对性优化，构建时间可能较长。</p>
<h3 data-id="heading-9">Vite</h3>
<p>Vite 的设计目标是提供极速的开发体验，实现开发服务器的快速启动和代码修改的即时反馈。Vite 的核心思路与 Webpack 不同：在开发环境中，Vite 不进行全量打包，而是启动一个轻量级的开发服务器，当浏览器请求某个模块时，Vite 才对该模块进行实时编译和转换。对于第三方依赖，Vite 使用 esbuild 进行预构建，将 CommonJS 或 UMD 格式的依赖转换为 ESM 格式，通常缓存在 node_modules/.vite/deps 目录下，后续直接预构建缓存的结果，大幅提升开发启动速度。在生产环境中，Vite 使用 Rollup 进行构建（Vite 5 及之后版本也可以选择基于 Rust 的 Rolldown），执行 Tree-shaking、代码分割、压缩等优化操作，生成生产环境所需的资源文件。</p>
<p>Vite 的开发体验优势明显：新项目配置简单，几乎可以开箱即用；开发服务器启动速度快，HMR 更新迅速；对 Vue、React 等主流框架提供了良好的内置支持。Vite 的局限性在于：对旧版本浏览器的支持需要额外的插件和配置；对于已经深度定制 Webpack 的复杂项目，迁移到 Vite 的成本可能较高。</p>
<h3 data-id="heading-10">Rspack</h3>
<p>Rspack 是由字节跳动开发的基于 Rust 实现的打包工具，于 2023 年发布。Rspack 与 Webpack 保持高度兼容，API 兼容度达到 95% 以上，这意味着大多数 Webpack 配置可以直接迁移到 Rspack。在官方基准测试和实际项目实践中，Rspack 的构建速度通常比同等配置的 Webpack 快 5 到 10 倍。</p>
<p>Rspack 的核心实现使用 Rust 重写了 Webpack 的核心逻辑，同时保持了 Webpack 的配置方式和插件生态系统。Rspack 内置了 SWC 编译器和 Lightning CSS，无需额外配置 Babel 即可处理 TypeScript、JSX 等语法，在性能上相比传统方案有显著提升。</p>
<p>Rspack 与 Webpack 高度兼容，迁移成本较低，现有 Webpack 项目可以相对平滑地切换到 Rspack；构建速度快，中大型项目的冷启动时间通常在 1 到 3 秒之间；支持大部分 Webpack Loader 和 Plugin，生态兼容性好；内置 SWC 编译器，无需额外配置 Babel；提供文件系统缓存机制，二次构建速度更快。</p>
<p>测试项目打包速度对比结果：同一套项目代码（大概 400 个小文件） + 配置；webpack 采用了 babel，rspack 采用了内置的 SWC(仅是测试代码测试，仅做参考) <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed69c9392fee41cca3b90c4a655f148d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456184&amp;x-signature=EykjQ%2FiWRyq3VuI12OthQXlZCCM%3D" alt="compare" loading="lazy"/></p>
<h2 data-id="heading-11">打包原理浅析</h2>
<h3 data-id="heading-12">Webpack 打包原理速通</h3>
<h4 data-id="heading-13">整体架构</h4>
<p>Webpack 的核心是一个模块打包器，它将项目中的所有资源（JavaScript、CSS、图片等）视为模块，通过构建依赖关系图将它们组织起来。Webpack 的架构基于几个核心概念：Compiler 是编译器实例，负责整个编译过程的生命周期管理；Compilation 代表单次编译过程，包含模块、chunk、资源等编译信息；Module 是模块，可以是 JavaScript、CSS、图片等任何类型的文件；Chunk 是代码块，由多个模块按照一定规则组织而成；Asset 是资源文件，即最终输出的文件。</p>
<h4 data-id="heading-14">构建流程（生产环境）</h4>
<p>Webpack 的构建流程可以分为初始化、编译、输出和完成四个主要阶段。</p>
<p>在初始化阶段，Webpack 读取配置文件（webpack.config.js），创建 Compiler 实例，然后注册所有配置的插件。插件通过 <code>apply</code> 方法注册到 Compiler 的钩子上，以便在构建的不同阶段执行自定义逻辑。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">compiler</span> = webpack(config)<span class="hljs-comment">;</span>
plugins.forEach((plugin) =&gt; plugin.apply(compiler))<span class="hljs-comment">;</span>
</code></pre>
<p>编译阶段是 Webpack 的核心处理过程。首先确定入口文件，从配置的 entry 开始，找到所有入口文件。然后从入口文件开始，递归解析所有依赖关系，使用 AST 解析 import 和 require 语句，构建完整的模块依赖图。接下来对每个模块执行对应的 Loader 进行转换，例如使用 babel-loader 处理 JavaScript 文件，使用 css-loader 和 style-loader 处理 CSS 文件。最后根据入口和代码分割规则，将模块组织成 Chunk。</p>
<pre><code class="hljs language-css" lang="css">entry: {
  <span class="hljs-selector-tag">main</span>: <span class="hljs-string">'./src/index.js'</span>,
  vendor: <span class="hljs-string">'./src/vendor.js'</span>
}

module: {
  rules: [
    { test: /.js$/, use: <span class="hljs-string">'babel-loader'</span> },
    { test: /.css$/, use: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>] }
  ]
}
</code></pre>
<p>在输出阶段，Webpack 首先生成运行时代码，注入模块加载的运行时函数（如 <code>__webpack_require__</code>）。然后执行代码分割和优化，通过 SplitChunksPlugin 根据配置规则将代码分割成多个 chunk，例如将 node_modules 中的第三方库单独打包。最后将 Chunk 转换为最终的 JavaScript 文件，执行压缩、混淆等优化操作。</p>
<pre><code class="hljs language-css" lang="css">optimization: {
  splitChunks: {
    chunks: <span class="hljs-string">'all'</span>,
    cacheGroups: {
      vendor: {
        test: /[\/]node_modules[\/]/,
        name: <span class="hljs-string">'vendors'</span>,
        priority: <span class="hljs-number">10</span>
      }
    }
  }
}
</code></pre>
<p>最后，根据 output 配置将处理后的文件写入文件系统，生成最终的构建产物。</p>
<pre><code class="hljs language-css" lang="css">output: {
  path: path.<span class="hljs-built_in">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
  filename: <span class="hljs-string">'[name].[contenthash].js'</span>
}
</code></pre>
<h4 data-id="heading-15">开发环境（webpack-dev-server）</h4>
<p>开发环境与生产环境的主要区别在于：开发环境采用内存编译，文件不写入磁盘，而是保存在内存中，这样可以提升编译速度；支持热模块替换（HMR），只更新变更的模块，无需刷新整个页面；生成 Source Map 便于调试，可以定位到原始源码位置；文件变更后能够快速重新编译，提供即时的反馈。</p>
<p>HMR 的工作流程如下：当启动 webpack-dev-server 时，会在页面中注入 HMR 客户端脚本，然后建立 WebSocket 连接，实现客户端与开发服务器之间的双向通信。当开发者修改源码文件时，Webpack 会监听到文件变更事件，然后重新编译受影响的模块，生成新的 hash 值和热更新清单文件（如 <code>main.[hash].hot-update.json</code>）。服务器通过 WebSocket 将新的 hash 值通知给客户端，客户端收到通知后，会对比本地的 lastHash 和服务端返回的 hash 值。如果检测到有更新，客户端会发起请求获取热更新清单文件和更新后的模块代码（<code>hot-update.json</code> 和 <code>hot-update.js</code>），HMR runtime 会加载并执行更新后的模块，然后调用 <code>module.hot.accept</code> 等回调函数，只替换发生变更的模块，尽量保持页面状态不变。如果遇到异常情况或模块不支持 HMR，系统会回退到整页刷新的方式，确保功能正常。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea23b12f3729442ba0b49f9b3d1235b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456184&amp;x-signature=5rxZ0uaDtinwO5lomVdtEuVN%2FRI%3D" alt="test" loading="lazy"/></p>
<p>test</p>
<h4 data-id="heading-16">模块解析机制</h4>
<p>Webpack 的模块解析机制包括路径解析、别名处理和 node_modules 查找。当遇到相对路径导入时，Webpack 会根据 <code>resolve.extensions</code> 配置尝试不同的文件扩展名，例如 <code>./utils</code> 会依次尝试 <code>./utils.js</code>、<code>./utils.json</code>、<code>./utils/index.js</code> 等。对于使用别名的导入，Webpack 根据 <code>resolve.alias</code> 配置将别名解析为实际路径，例如 <code>@/components/Component</code> 会被解析为配置的实际路径。对于第三方模块，Webpack 会从 node_modules 目录中查找对应的包。</p>
<h3 data-id="heading-17">Vite 打包原理速通</h3>
<h4 data-id="heading-18">整体架构</h4>
<p>Vite 采用双模式架构，在开发环境和生产环境中采用不同的策略。开发环境基于浏览器原生 ESM，无需进行打包操作，而是通过 HTTP 服务器按需编译模块。生产环境则回归传统打包思路，使用 Rollup 进行代码打包和优化。这种设计使得开发体验和生产构建各取所长，既保证了开发时的极速启动，又确保了生产环境的代码优化。</p>
<h4 data-id="heading-19">开发环境原理</h4>
<p>Vite 开发环境的核心思想是 No Bundle，即不进行预先打包。当执行 <code>vite dev</code> 命令时，Vite 首先启动一个 HTTP 服务器，默认监听 5173 端口。这个服务器会拦截浏览器的模块请求，并根据请求的模块类型进行实时编译和返回。整个过程是动态的，只有在浏览器真正需要某个模块时，Vite 才会对其进行编译处理。</p>
<p>在第一次启动时，Vite 会执行依赖预构建流程。它会扫描项目的 package.json 文件，识别出所有的第三方依赖，然后使用 esbuild 对这些依赖进行预构建处理。预构建的结果会被缓存到 <code>node_modules/.vite/deps</code> 目录中，后续启动时可以直接使用缓存，大幅提升启动速度。预构建的主要目的包括三个方面：首先是将 CommonJS 或 UMD 格式的依赖转换为浏览器可识别的 ESM 格式，因为浏览器原生不支持 CommonJS；其次是合并多个小文件，减少 HTTP 请求数量，例如 lodash 这样的库包含数百个文件，预构建可以将其合并为单个文件；最后是优化依赖结构，扁平化某些包内部的复杂路径引用。</p>
<p>当浏览器发起模块请求时，例如请求 <code>http://localhost:5173/src/main.js</code>，Vite 服务器会首先检查该模块是否是已经预构建的第三方依赖。如果是预构建的依赖，直接返回缓存的结果。如果是项目源码文件，Vite 会进行实时编译，将文件转换为浏览器可执行的 ESM 代码并返回。以 Vue 单文件组件为例，当浏览器请求 <code>.vue</code> 文件时，Vite 会实时编译 Vue SFC，将其转换为 JavaScript 代码返回给浏览器。</p>
<p>Vite 的热模块替换机制同样基于 ESM 实现。当文件发生变更时，Vite 能够精确地知道哪些模块需要更新，因为每个模块都是独立的 ESM 模块。Vite 通过 WebSocket 连接通知客户端哪些模块发生了变化，客户端接收到通知后，可以直接替换对应的 ESM 模块，利用浏览器原生的模块系统能力，无需重新加载整个页面。这种基于 ESM 的 HMR 机制相比传统的打包工具更加精确和高效。</p>
<h4 data-id="heading-20">生产环境原理</h4>
<p>在生产环境中，Vite 会执行完整的打包流程。默认情况下，Vite 使用 Rollup 作为打包核心引擎。在 Vite 5 及之后的版本中，可以在部分配置或实验特性下切换为 Rolldown，但整体构建阶段和思路与 Rollup 基本一致。构建流程首先从入口文件开始，构建完整的依赖图，分析所有模块之间的依赖关系，确定需要打包的模块范围。随后使用 esbuild 对依赖进行预构建，这一步在官方基准测试中通常能比传统方式快一个数量级，具体提升幅度在 10 到 100 倍之间，实际效果取决于项目规模和配置。预构建完成后，Rollup 会执行代码分析、转换、优化和打包等步骤，最终输出优化后的生产代码。</p>
<h4 data-id="heading-21">预构建</h4>
<p>预构建是 Vite 架构中的关键环节，其必要性主要体现在三个方面。首先是兼容性问题，许多 npm 包仍然采用 CommonJS 格式发布，而浏览器原生不支持 CommonJS 模块系统，因此需要将这些依赖转换为浏览器可识别的 ESM 格式。其次是性能问题，某些大型库如 lodash 包含数百个独立的文件，如果直接使用会产生大量的 HTTP 请求，严重影响加载性能，预构建可以将这些文件合并为单个文件，大幅减少请求数量。最后是路径问题，某些包内部使用复杂的相对路径引用，预构建可以扁平化这种依赖结构，简化模块解析过程。</p>
<h4 data-id="heading-22">开发 vs 生产对比</h4>
<p>开发环境和生产环境在多个维度上存在显著差异。在打包方式上，开发环境采用不打包、按需编译的策略，而生产环境则执行完整的 Rollup 打包流程。启动速度方面，开发环境通常能在 1 秒内完成启动，而生产环境的构建时间通常在 5 到 10 秒之间。编译方式上，开发环境是实时编译，只有被请求的模块才会被编译，生产环境则是全量编译，所有模块都会被处理。输出格式上，开发环境统一输出 ESM 格式，生产环境则可以根据配置输出多种格式。代码优化方面，开发环境不进行代码优化以保持编译速度，生产环境则会执行压缩、混淆、tree-shaking 等优化操作。Source Map 的生成策略也不同，开发环境采用快速生成策略，生产环境则生成完整的 Source Map 以便调试。</p>
<h3 data-id="heading-23">核心差异对比</h3>
<h4 data-id="heading-24">性能差异</h4>
<p>这里可以先按一个中等偏上的单页应用来想象一下，大概的时间量级会是下面这样（只是经验值，不是严谨 benchmark，具体还是要看你项目的体量和机器性能）：</p>





























<table><thead><tr><th>场景</th><th>Webpack</th><th>Vite</th><th>原因</th></tr></thead><tbody><tr><td><strong>冷启动</strong></td><td>10 ～ 30s</td><td>&lt; 1s</td><td>Vite 不打包，按需编译</td></tr><tr><td><strong>HMR</strong></td><td>1 ～ 3s</td><td>&lt; 100ms</td><td>Vite 基于 ESM，更精确</td></tr><tr><td><strong>生产构建</strong></td><td>30 ～ 60s</td><td>10 ～ 20s</td><td>Vite 使用 esbuild 预构建</td></tr></tbody></table>
<h2 data-id="heading-25">深度对比分析</h2>
<h3 data-id="heading-26">性能对比</h3>
<p>从开发者最关心的几个维度来看，三个工具在性能表现上存在明显差异。需要说明的是，以下对比更多是基于日常项目实践的经验总结，而非严谨的基准测试，具体表现会因项目规模和机器性能而有所不同。</p>
<p>在开发启动速度方面，Webpack 在大型项目中首次启动时需要进行完整的打包过程，开发者能够明显感受到冷启动的等待时间，十几秒甚至几十秒的情况很常见。Vite 则基本实现秒开，启动瓶颈更多在于浏览器打开速度，而非打包过程本身。Rspack 相比 Webpack 有明显提升，特别是在多入口和大体积项目中，启动速度的提升更为显著。</p>
<p>在热模块替换的反馈速度上，Webpack 在处理简单样式修改时表现尚可，但在进行大型组件改动时，通常需要等待 1 到 2 秒才能看到更新效果。Vite 在大部分场景下能够实现保存即刷新，几乎感觉不到延迟。Rspack 配合开发服务器使用时，HMR 体验也比传统 Webpack 更加流畅。</p>
<p>在生产构建时间方面，Webpack 在配置合理的情况下，中型项目的构建时间通常在几十秒，对于超大项目则需要重点进行代码拆分和缓存优化。Vite 使用 Rollup 进行生产构建时，在中小型项目上通常优于 Webpack，随着项目规模增大，这种优势会更加明显。Rspack 在官方对比和社区实践中，普遍比等价配置的 Webpack 快一截，特别适合那些希望保持 Webpack 配置方式但需要提升构建速度的场景。</p>
<h3 data-id="heading-27">配置复杂度</h3>
<p>Webpack 的配置相对复杂，需要开发者理解一整套概念体系，包括入口配置 entry、输出配置 output、模块处理规则 module.rules、各种 loader、插件系统 plugin、优化配置 optimization、路径解析 resolve 等。一个典型的 Webpack 配置文件需要明确指定入口文件路径、输出目录和文件名模式、各种文件类型的处理规则、使用的 loader 和插件、代码拆分策略等。这种配置方式虽然灵活，但也意味着学习曲线较为陡峭，新手需要花费一定时间才能掌握。</p>
<p>相比之下，Vite 的配置要简洁得多。Vite 的默认配置已经能够运行绝大多数单页应用，开发者通常只需要添加框架插件、配置路径别名、按需调整一些构建选项即可。一个典型的 Vite 配置文件可能只需要几行代码，指定使用的框架插件和少量构建选项。这种设计大大降低了配置门槛，使得开发者能够快速上手，将更多精力投入到业务开发中。</p>
<h3 data-id="heading-28">生态支持</h3>
<p>在生态支持方面，三个工具呈现出不同的成熟度。Webpack 作为最早发布的工具，自 2012 年发布以来已经积累了最完善的生态系统，拥有最多的插件和 loader，社区支持也是最好的。Vite 虽然发布时间较晚，自 2020 年发布以来生态成熟度已经达到较高水平，社区支持快速增长，插件数量也相当丰富。Rspack 作为最新的工具，2023 年才发布，生态成熟度相对较低，但社区支持也在快速增长，插件数量也在逐步增加。总体而言，Webpack 拥有最成熟的生态，Vite 的生态已经相当完善，Rspack 作为新工具正在快速发展中。</p>
<h2 data-id="heading-29">总结</h2>
<p>前端打包工具的选择没有标准答案，需要根据项目特点、团队情况、技术栈等因素综合考虑：</p>
<h3 data-id="heading-30">未来展望</h3>
<p>前端工程化工具正在向<strong>更快、更简单、更智能</strong>的方向发展：</p>
<ul>
<li><strong>性能</strong>：Rust/Go 实现的工具将成为主流</li>
<li><strong>兼容性</strong>：新工具会保持与现有生态的兼容</li>
<li><strong>开发体验</strong>：零配置、智能提示、更好的错误信息</li>
<li><strong>标准化</strong>：ESM 成为标准，工具链统一</li>
</ul>
<hr/>
<p><strong>参考资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.js.org%2F" target="_blank" title="https://webpack.js.org/" ref="nofollow noopener noreferrer">Webpack 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2F" target="_blank" title="https://vitejs.dev/" ref="nofollow noopener noreferrer">Vite 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2F" target="_blank" title="https://rollupjs.org/" ref="nofollow noopener noreferrer">Rollup 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" title="https://esbuild.github.io/" ref="nofollow noopener noreferrer">esbuild 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frspack.dev%2F" target="_blank" title="https://rspack.dev/" ref="nofollow noopener noreferrer">Rspack 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dart 的 Lazy Iterable]]></title>    <link>https://juejin.cn/post/7583933107690029119</link>    <guid>https://juejin.cn/post/7583933107690029119</guid>    <pubDate>2025-12-16T02:24:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690029119" data-draft-id="7583591656177123364" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dart 的 Lazy Iterable"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-16T02:24:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dart 的 Lazy Iterable
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:24:55.000Z" title="Tue Dec 16 2025 02:24:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>相关文章: <a href="https://juejin.cn/post/7109433427245400078" target="_blank" title="https://juejin.cn/post/7109433427245400078">juejin.cn/post/710943…</a></p>
<p>这里主要提到两个我们经常用的操作符 where/map</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> list = [<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>];
<span class="hljs-keyword">var</span> map = list.<span class="hljs-title function_">map</span>((e) {
  <span class="hljs-keyword">var</span> result = int.<span class="hljs-title function_">parse</span>(e) + <span class="hljs-number">10</span>;
  <span class="hljs-title function_">print</span>(<span class="hljs-string">"######### $result"</span>);
  <span class="hljs-keyword">return</span> result;
});
</code></pre>
<p>像上面的代码 运行是不会有日志输出的。只有每次调用 toList 或者遍历map的时候才会输出。</p>
<p><code>一般情况下 如果你这里返回的知识基本类型 比如 String 或者 int 啥的,直接用也不会有太大问题。但是你如果返回的是对象，当你去做一些判断是否是同一个对象的时候就会有问题，因为你每次遍历返回的都是新的对象，再去判断是否是同一个对象，大概率是不一样的。</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[企业级 AI 编程 Prompt 体系]]></title>    <link>https://juejin.cn/post/7583981974407970826</link>    <guid>https://juejin.cn/post/7583981974407970826</guid>    <pubDate>2025-12-16T02:29:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974407970826" data-draft-id="7583981974407921674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="企业级 AI 编程 Prompt 体系"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:29:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            企业级 AI 编程 Prompt 体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:29:07.000Z" title="Tue Dec 16 2025 02:29:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>定位说明</strong>：<br/>
这不是“教你怎么用 AI 写代码”的教程，而是一套 <strong>企业可复制、可治理、可审计的 AI 编程方法论</strong>。</p>
<p><strong>适用对象：</strong></p>
<ul>
<li>CTO / 技术负责人</li>
<li>技术中台 / 架构组</li>
<li>正在推进 AI 编程落地的企业</li>
</ul>
<h2 data-id="heading-0">一、为什么“会用 AI 写代码”不等于“能在企业落地”</h2>
<p>当前大多数团队在使用 AI 编程时，都会遇到三个典型问题：</p>
<ol>
<li><strong>产出不稳定</strong>：同一个需求，不同人问，结果完全不同</li>
<li><strong>风险不可控</strong>：AI 擅自重构、编造逻辑、引入依赖</li>
<li><strong>无法评估价值</strong>：到底有多少代码是 AI 参与产出的？</li>
</ol>
<p><strong>根本原因只有一个：</strong></p>
<blockquote>
<p>企业缺的不是 AI，而是一套「约束 AI 行为的工程体系」。</p>
</blockquote>
<h2 data-id="heading-1">二、核心方法论：三层 Prompt 治理模型</h2>
<p>我们将 AI 编程中的提示词，拆解为 <strong>三层、三种职责、三种稳定度</strong>。</p>
<pre><code class="hljs language-arduino" lang="arduino">System Prompt（企业级｜几乎不变）
   ↓
Project Prompt（项目级｜随项目变化）
   ↓
<span class="hljs-built_in">Task</span> Prompt（任务级｜每次开发）
</code></pre>
<h2 data-id="heading-2">三、System Prompt：AI 的“公司宪法”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 在公司里“能不能做”</li>
<li>什么时候必须停下来</li>
</ul>
<p><strong>核心特征</strong>：</p>
<ul>
<li>稳定性优先于效率</li>
<li>明确禁止 AI 幻觉、编造、擅自决策</li>
<li>内置“中止机制”（信息不足即停）</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>防止 AI 成为风险源</li>
<li>为所有项目提供统一底线</li>
</ul>
<h2 data-id="heading-3">四、Project Prompt：AI 的“项目说明书”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 在“这个项目里该怎么写代码”</li>
</ul>
<p><strong>核心内容</strong>：</p>
<ul>
<li>技术栈与版本锁定</li>
<li>架构分层规则</li>
<li>项目级编码与异常规范</li>
<li>项目特有的 AI 行为约束</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>消除 AI 的“通用最佳实践幻觉”</li>
<li>让 AI 的输出贴合具体项目</li>
</ul>
<h2 data-id="heading-4">五、Task Prompt：AI 的“任务工单”</h2>
<p><strong>解决的问题</strong>：</p>
<ul>
<li>AI 这一次具体要做什么</li>
</ul>
<p><strong>标准结构</strong>：</p>
<ul>
<li>任务目标</li>
<li>已有上下文</li>
<li>具体要求</li>
<li>强约束</li>
<li>输出验收标准</li>
</ul>
<p><strong>价值</strong>：</p>
<ul>
<li>降低不确定性</li>
<li>让 AI 输出具备可验收性</li>
</ul>
<h2 data-id="heading-5">六、为什么这套体系“可治理、可审计”</h2>
<h3 data-id="heading-6">1️⃣ Prompt 即制度</h3>
<ul>
<li>Prompt 本身就是工程规则</li>
<li>可纳入版本管理</li>
</ul>
<h3 data-id="heading-7">2️⃣ Prompt 即证据</h3>
<ul>
<li>每一段 AI 产出，都有对应 Prompt</li>
<li>可复盘、可追责</li>
</ul>
<h3 data-id="heading-8">3️⃣ Prompt 即统计基础</h3>
<ul>
<li>可以区分：
<ul>
<li>AI 主导</li>
<li>AI 辅助</li>
<li>人工编写</li>
</ul>
</li>
</ul>
<h2 data-id="heading-9">七、AI 代码参与度的正确评估方式（对外常见误区）</h2>
<p><strong>错误方式</strong>：</p>
<ul>
<li>看是否“用过 AI”</li>
<li>看是否“复制过代码”</li>
</ul>
<p><strong>正确方式</strong>：</p>
<ul>
<li>是否使用 Task Prompt 产出核心逻辑</li>
<li>是否在 Prompt 约束下完成代码</li>
<li>是否通过人工 Review 验收</li>
</ul>
<blockquote>
<p><strong>结论</strong>：<br/>
AI 价值不在“用了没用”，而在“被管理地使用”。</p>
</blockquote>
<h2 data-id="heading-10">八、这套方法论的边界（很重要）</h2>
<ul>
<li>不追求 100% AI 生成代码</li>
<li>不鼓励完全无人审查</li>
<li>不替代工程责任主体</li>
</ul>
<p>AI 的定位始终是：</p>
<blockquote>
<p><strong>受约束的生产力，而不是自主决策者</strong>。</p>
</blockquote>
<h2 data-id="heading-11">九、结语：真正的竞争力是什么</h2>
<blockquote>
<p>当所有公司都能用 AI 写代码时，<br/>
真正的差距在于：</p>
<p><strong>谁能把 AI 纳入工程体系，而不是工具清单。</strong></p>
</blockquote>
<p>这套三层 Prompt 方法论，本质上是：</p>
<ul>
<li>把“人类的软件工程经验”</li>
<li>翻译成“AI 可执行的规则体系”</li>
</ul>
<p>也是企业在 AI 时代构建长期技术竞争力的关键基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了]]></title>    <link>https://juejin.cn/post/7583991680748945435</link>    <guid>https://juejin.cn/post/7583991680748945435</guid>    <pubDate>2025-12-16T02:29:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583991680748945435" data-draft-id="7583952017674502195" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T02:29:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Thinking Machines首款产品重大更新：K2 Thinking、Qwen3-VL都可以微调了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:29:37.000Z" title="Tue Dec 16 2025 02:29:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当前，AI 领域的研究者与开发者在关注 OpenAI、Google 等领先机构最新进展的同时，也将目光投向了由前 OpenAI CTO Mira Murati 创办的 Thinking Machines Lab。</p>
<p>今年早些时候，他们推出了首款产品 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650993756%26idx%3D1%26sn%3D4bd29a2b9fdaf00b29f97f6f2139decb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650993756&amp;idx=1&amp;sn=4bd29a2b9fdaf00b29f97f6f2139decb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Tinker</a>：这是一个 API，用于帮开发者 / 研究人员微调语言模型。你只需要专注于训练数据和算法，而你不擅长的关于 Infra 的部分 —— 调度、调优、资源管理和 Infra 可靠性 —— 统统由 Tinker 来搞定，从而大大简化了 LLM 的后训练过程。</p>
<p>此前，Tinker 仅向研究人员和开发者开放内部测试；而如今，Thinking Machines 宣布正式取消候选名单，所有用户都可以直接使用 Tinker。</p>
<p>除此以外，Tinker 还带来了其他三项更新：</p>
<p>首先，更强推理能力：用户现在可以在 Tinker 上对 Kimi K2 Thinking 进行微调。 Kimi K2 拥有万亿参数规模，是 Thinking Machines 目前规模最大的模型，专为长链推理和工具调用场景而设计。</p>
<p>其次，兼容 OpenAI API 的全新推理接口：Tinker 提供了标准的推理接口，例如：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544708e9fd5f43eb80bc50bc3dc288f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=lqYKQG1PJOGx6aaO%2FCqlmShk0jo%3D" alt="图片" loading="lazy"/></p>
<p>借助本次发布，Tinker 还新增了兼容 OpenAI API 的接口封装，用户只需通过指定模型路径，即可对模型进行快速采样，即使模型仍处于训练过程中也可以使用。</p>
<p>这也意味着，Tinker 现在可以即插即用地接入任何兼容 OpenAI API 的平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba51a97d2c741419f9afa70c6bf04a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=GXT4wcUCQVbzXyuCTSkWYk9uukQ%3D" alt="图片" loading="lazy"/></p>
<p>最后，Qwen3-VL 支持视觉输入。Tinker 新增了两款视觉模型：Qwen3-VL-30B-A3B-Instruct 和 Qwen3-VL-235B-A22B-Instruct。借助这些模型，用户可以在多种应用场景中处理图片、截图以及示意图等视觉内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a234dee031d4f6890f1cf0dcbec275d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=DxIx7ZdyVoE0sw%2BPaN3HVd6Rrrc%3D" alt="图片" loading="lazy"/></p>
<p>这些视觉输入开箱即用，可直接应用于多种任务场景，包括监督微调和强化学习微调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d7ab75624241ed93a1c2a6771ac6ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=x0FrQdtvBFU6V7rUHeIc0BkJfQw%3D" alt="图片" loading="lazy"/></p>
<p>Tinker支持的模型</p>
<p>过去，开发者若想训练或微调前沿大模型，必须自行采购 GPU、搭建集群、处理 CUDA/NCCL 环境、维护分布式训练稳定性，门槛极高且成本巨大。</p>
<p>而 Tinker 通过将所有训练基础设施抽象为一个 API，使开发者无需管理任何算力资源，只需准备数据和算法即可训练模型。更重要的是，此次更新首次让普通开发者能够微调万亿参数的 Kimi K2 Thinking，这本来是只有顶级实验室才能掌握的能力，视觉输入的加入进一步降低了 VLM 应用门槛。</p>
<p>对此，研究者纷纷表示：「能够在无需自行管理 GPU 基础设施的情况下训练自定义图文数据，对开发者来说是一项巨大的进步。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c223f5243224b2f9b190ae4b4210c5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=12Q%2F8GTbGFB%2FBtCdjI3%2Fnvg2Lcc%3D" alt="图片" loading="lazy"/></p>
<p>使用 Tinker 训练图像分类模型</p>
<p>为了展示 Tinker 新增的视觉能力，Thinking Machines Lab 对 Qwen3-VL-235B-A22B-Instruct 进行了微调，并将其应用于多项经典图像分类基准测试中。</p>
<p>具体而言，研究团队选择了四个常用的数据集进行评估，包括：</p>
<ul>
<li>
<p>Caltech-101：包含 101 类常见物体的数据集</p>
</li>
<li>
<p>Stanford Cars：涵盖汽车品牌、型号和年份的数据集</p>
</li>
<li>
<p>Oxford Flowers：花卉品种数据集</p>
</li>
<li>
<p>Oxford Pets：宠物品种数据集</p>
</li>
</ul>
<p>由于 Qwen3-VL 本质上是语言模型，研究中将图像分类任务建模为文本生成问题：给定一张图片，模型直接输出对应的类别名称。研究人员将这一方法与传统的视觉基线方案 DINOv2 进行了对比。</p>
<p>DINOv2 是一种通过自监督方式训练的视觉 Transformer，常被用作纯计算机视觉任务的 backbone。对于 DINOv2，研究中在其模型之上添加了一个分类头，用于预测所有 N 个类别的概率分布。两种模型均采用 LoRA 方式进行微调。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ce8137e96154616bcf6ff0662715f8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456977&amp;x-signature=SpQK8lqLZAwRiVWzQIw%2BFcS7D4g%3D" alt="图片" loading="lazy"/></p>
<p>图中展示了经过微调的 Qwen3-VL-235B-A22B 与 DINOv2 在简单图像分类任务上的性能对比。</p>
<p>在小样本数据场景下，Qwen3-VL-235B-A22B 的表现优于 DINOv2。这不仅是因为其模型规模更大，更重要的是，作为视觉语言模型（VLM），它天然具备语言知识（例如知道「向日葵」指代什么）。正是这种通用的语言与视觉联合能力，使得 Qwen3-VL 在图像分类之外，也能够更方便地迁移到其他视觉任务中。</p>
<p>还没体验的小伙伴，Tinker 绝对值得一试。</p>
<p>参考链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Ftinker%2F" target="_blank" title="https://thinkingmachines.ai/tinker/" ref="nofollow noopener noreferrer">thinkingmachines.ai/tinker/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthinkingmachines.ai%2Fblog%2Ftinker-general-availability%2F" target="_blank" title="https://thinkingmachines.ai/blog/tinker-general-availability/" ref="nofollow noopener noreferrer">thinkingmachines.ai/blog/tinker…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026]]></title>    <link>https://juejin.cn/post/7583955708318269440</link>    <guid>https://juejin.cn/post/7583955708318269440</guid>    <pubDate>2025-12-16T02:35:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708318269440" data-draft-id="7583921477614387235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:35:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小米语音首席科学家：AI发展的本质就像生物进化，不开源要慢1000倍 | MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:35:05.000Z" title="Tue Dec 16 2025 02:35:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>从生物进化的漫长历程到 AI 技术的疯狂迭代，两者遵循着惊人相似的底层逻辑。</p>
<p>在探寻下一代 AI 架构的关键时刻，著名的 “Kaldi 之父”、小米集团首席语音科学家、IEEE Fellow <strong>Daniel Povey</strong> 提出：</p>
<blockquote>
<p>就像生物进化一样， AI“配方”的设计本质上就是一个不断试错的过程，而进化的速度，取决于 “复制” 一个新想法所需的时间。</p>
</blockquote>
<p>在本次<strong>量子位 MEET2026 智能未来大会</strong>上，他也将开源视为 AI 进化的核心加速器——</p>
<p>若没有开源，行业的进化速度恐怕要慢上一千倍；正是因为有了开源，技术才能像生物适应新环境一样，经历 “长期停滞 + 瞬间爆发” 的非线性跃迁。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60925c12fed84c5aacaf536dfc93bf07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=TA9%2FR3h9yzbU3KROc1h96ZDRE9k%3D" alt="" loading="lazy"/></p>
<p>至于如何在未来的竞争中生存，在他看来，大公司最明智的策略是 “两条腿走路”——</p>
<p>一边利用 Transformer 赋能当下的产品，一边保留资源探索未知，赌中下一个颠覆世界的机会。</p>
<p>为了完整体现 Daniel Povey 的思考，在不改变原意的基础上，量子位对演讲内容进行了翻译和编辑整理，希望能给你带来更多启发。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点梳理</h2>
<ul>
<li>
<p>AI 的演进和自然界生物的进化过程非常相似，通过尝试不同的技术变体，然后筛选出在目标任务上表现更优的方案；</p>
</li>
<li>
<p>类比生物进化中的 “间断平衡”，AI 的发展并非连续，而是 “长期停滞 + 突然跃迁”，停滞期也不会永远持续；</p>
</li>
<li>
<p>开源对进化速度至关重要，如果每家公司都闭源，那么研究速度可能会降低为原来的千分之一；</p>
</li>
<li>
<p>不要押注单一任务或单一路线，在进化过程中找到 AI“通才”与 “专才” 的平衡，保留多种不同模型架构的存续，从而增加发掘实用新技术的机会；</p>
</li>
<li>
<p>大公司双管齐下是有意义的，一方面使用当前业界领先的技术方案，另一方面进行探索性研究，以寻找下一个重大突破。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb210310f564a2dbdee1a79800f10b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=wCWLanNYbmnHbDzWB%2F0UdMFSq5g%3D" alt="" loading="lazy"/></p>
<p><em>以下为 Daniel Povey 演讲原文中译本</em></p>
<h2 data-id="heading-1">像生物进化一样快速试错</h2>
<p>大家好，今天我想和大家分享一些关于 “进化” 和“AI”的思考，以及我们如何从生物演化中汲取关于 AI 未来的启示。我将主要从科研和模型本身的角度解读这个问题。</p>
<p>人们设计 AI“配方” 的过程，本质上主要还是一个不断试错的过程。</p>
<p>当人们有了新的理解，就会发表许多富含公式的论文，但其中 99% 的内容都没什么真正可操作的价值，最后能落地的通常只是 “配方” 本身。</p>
<p>所以设计 AI“配方” 的基本流程就是尝试不同变体，然后筛选出有效的进行发布，别人再照着做。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/353e35fc4c02427c84d2edcdec53ad46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=VibhUMmINBiV5Kamhb0dDtD%2B06k%3D" alt="" loading="lazy"/></p>
<p>这其实和生物进化非常相似。</p>
<p>在生物进化中，进化过程也会和外部环境相互影响，例如地球上的进化会受到太阳辐射变化、大气成分变化的影响，而生命本身也会反过来影响这些环境因素，比如改变大气成分。</p>
<p>AI 的进化也是如此，可能会受到硬件、数据等资源的限制；同时，AI 也会通过商业效应、群体行为效应反作用于这些外部条件。</p>
<p>在历史上，生物进化甚至曾经多次 “破坏” 自身的生存环境，例如“大氧化事件”<em>（Great Oxygenation Event）</em>，不过最终生命又从中恢复了过来。</p>
<p><em>（注：大氧化事件是指约 26 亿年前，大气中的游离氧含量突然增加的事件，其具体原因不明。该事件使地球上矿物的成分发生了变化，也使得日后动物的出现成为了可能。）</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b11f57b54874f9f894957efb552b9e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=MY0vJ7HwhdJdqa8G%2FJFJOLIrxnQ%3D" alt="" loading="lazy"/></p>
<p>生物学中 “世代间隔”_（Generation time）_类比到 AI，就是复制一个新想法所需的时间，通常这个时间会持续数个月。</p>
<p>因为当你有了新的发现，往往要先写论文，而且一般是写完才对外公开，有些期刊甚至规定发表前不能先上传 arXiv 之类的预印本。</p>
<p>过去这样的周期可能需要大概两年，但现在可能缩短到了<strong>六个月</strong>。</p>
<p>现在，有了 PyTorch 这样的工具，人们可以近乎完美地复现他人发布的 “配方”。</p>
<p>当然，有时人们可能只给出了描述_（而没有代码）_，这会使得复现过程稍慢一些，但整体上，代际周期的长短决定了进化的快慢。</p>
<p>就像世代间隔漫长的大型生物，往往进化缓慢；而那些能够快速繁衍的小型生物，进化速度则要快得多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f26e0426551f4dd4b5f56f2f486553e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=9kcQNBLBNHD5e9FfL4sVcGOm%2F%2Fc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">去不同领域寻找 AI 突破口</h2>
<p>在自然界的进化中，往往存在一种 “停停走走” 的节奏，很长一段时间里几乎没有什么动静，随后突然发生剧变。</p>
<p>对于自然界的物种来说，这种变化通常是由迁移到新环境所导致的；但偶尔，它也源于生命 “解锁” 了某种新事物，比如光合作用演化出来时，整个进化的节奏便迅速发生了改变。</p>
<p>我从事 AI 领域大概有 30 年了，特别是在语音领域，也经历过长时间没有太大进展的阶段，当时我们甚至以为 “这就是终点”。</p>
<p>当年我们做高斯混合模型、判别式训练时，以为语音识别的最终形态就是那样了，没人能想象未来的改变。所以也许十年后，也会出现今天谁都无法想象的全新模型。</p>
<p>AI 的发展中，不同任务之间的相互作用非常重要，比如视觉领域的新方法，后来可能会用于语音、语言等任务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a873ff2d68e480981d1f638d265c634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=5i28sC3HOgx1LRT%2BCt1BvaFj9c4%3D" alt="" loading="lazy"/></p>
<p>最近一个典型例子就是 Transformers，它最初是专门为语言模型设计的，后来却在各种任务中大放异彩。</p>
<p>在进化中也是如此，海豚绝无可能仅在海洋里就进化成型，因为它那些呼吸空气的机能，原本是为了适应陆地生活才演化出来的。但当它重返海洋后，却成了最成功的顶级捕食者。</p>
<p>这说明，<strong>有时候你确实需要暂时去做一些截然不同的事情，最终才能在原本的目标上取得成功</strong>。</p>
<h2 data-id="heading-3">如果不开源，AI 得慢上一千倍</h2>
<p>当然，拿生物进化做类比也有局限性。毕竟我们可以<strong>主动去理解事物</strong>，可以利用数学推导，或者改进可视化和调试工具，从而加速技术的发展。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43d79290e3364a0ab5111bcdd265332f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=ff5n3unEEmIBa7rCoschSGiNNX4%3D" alt="" loading="lazy"/></p>
<p>此外，提速也非常关键。实验跑得越快，进化的迭代就越快，这对研究价值巨大。</p>
<p>而在这一点上，<strong>开源</strong>起到了至关重要的作用。</p>
<p>如果每家公司都得自己从头重复造轮子，研究速度恐怕要慢上一千倍。</p>
<p>我们可以设想一个平行世界，如果大公司决定不开源 PyTorch，我也没有开源 Kaldi 项目，那 AI 研发的局面会很不相同。</p>
<p>不过，不开源在某些行业确实是常态，尤其是涉及<strong>实体工程</strong>的领域，因为开发一款工具往往极其昂贵，可能要砸出数百万美元，所以没人会把他们的模型开源出来。</p>
<p>其实，2012 年我之所以离开工业界，就是因为这个问题。当时的大公司普遍对开源都不怎么感冒，所以我转去学术界待了一段时间。</p>
<p>但如今很多公司都开始拥抱开源了，像小米就非常支持我的工作，也支持开源，所以我又回到了工业界。</p>
<h2 data-id="heading-4">寻找 Transformer 之后的下一个颠覆者</h2>
<p>回到关于进化的比喻，我刚才吐槽过论文中的那些数学理论往往不够具体，没法落地。那么，我们到底能从中能学到什么实实在在的东西呢？</p>
<p>有一点很关键，那就是我们需要在各种不同的任务上不断探索新思路。</p>
<p>因为在进化这件事上，很难预判哪种生物最终会胜出。就像啮齿类动物，起初可能只是为了吃竹子种子这种极具体的目的而进化的。</p>
<p>但结果谁曾想，这反而让它们演化出了一种极强的 “通才” 式生存能力，最终遍布全球、无所不能。</p>
<p>可在当时，谁能想到吃竹子种子这事儿能带来这么大的突破呢？这种事真的太难预测了。</p>
<p>所以说，关键就在于要<strong>多尝试不同的任务</strong>，因为我们为了突破某个任务特有限制研发出的解决方案，可能最后会被证明具有极高的通用价值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36641dd5f354d8db9fc4b5b624f0e4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457305&amp;x-signature=rN08PLNODxb43NIETQ7w5tlJIRc%3D" alt="" loading="lazy"/></p>
<p>我们需要关注进化过程中 “通才” 与“专才”之间的权衡，我并非要分出孰优孰劣，但是从长远来看，不同的进化策略能够适应不同的环境——</p>
<p>如果环境长期稳定，自然界往往会涌现出大量像熊猫这样的 “专才”，它们虽然只吃一种食物，却能做到极致适应；</p>
<p>可一旦环境变得动荡多变，像老鼠这种适应力极强的 “通才” 往往更具生存优势。</p>
<p>所以，这两种生存策略很可能是缺一不可的。</p>
<p>对于 AI 而言，我们应该让模型在多个不同的生态位里同时演进，这就像自然界在不同环境中进行的进化一样。毕竟，每个物种通常都有其最适应的特定生存空间。</p>
<p>如果我们能同时保留多种不同的技术路线，说不定其中某一条在经过进一步打磨后，就能带来巨大的回报。但这事儿很难提前预判，没人知道眼下哪个模型会在未来称王。</p>
<p>出于同样的理由，我们也应该维持<strong>模型架构的多样性</strong>。这就像大自然保留了丰富多样的物种一样，因为我们根本无法确定，到底哪一种架构会孕育出下一轮的重大突破。</p>
<p>在我看来，大多数大型机构采取两头并重的策略是比较明智的——既要沿用像 Transformer 等当前最顶尖的成熟模型，同时也得投入一些资源去做探索性研究，去寻找下一个技术突破口。</p>
<p>在我看来，Transformer 这种技术领域的竞争现状，就像是 “抢椅子”——只要音乐还在响，你就得跟着一直跳。</p>
<p>毕竟在 Transformer 和 LLM 依然称霸的当下，任何一家公司都绝无可能把身家性命都押在别的路线上。</p>
<p>但大家心里也都清楚，音乐迟早有停下来的那一天。</p>
<p>所以，小米在 LLM 上的研究主线很明确，那就是利用 SOTA 级别的 AI 和大模型技术，去全方位赋能我们的 “人车家全生态”。</p>
<p>我个人其实并没有深度参与这些工作，因为我和团队主要负责的是探索性研究。我们尝试了大量不同的方向，就是希望能找到能产生巨大影响的成果，但这事的成功率向来极低。</p>
<p>回首我的整个研究生涯，尝试过的点子恐怕得有上万个。现在回头看，其中有一两个如果当时我能推广得再好一点，说不定真能成为颠覆性的技术。</p>
<p>比如，早在大家连 BatchNorm 都还没开始用的时候，我们组其实就已经设计出了一种类似于 LayerNorm 的归一化模块。</p>
<p>但我也不想像 Jürgen Schmidhuber 那样说 “我在所有人之前发明了一切”。</p>
<p><em>（注：Jurgen Schmidhuber 是著名计算机科学家、LSTM 之父，喜欢在 AI 领域出现新成果时发表文章或评论，列举自己上世纪的论文，表示 “这个东西我几十年前就发明过了”。）</em></p>
<p>因为作为一名研究人员，有责任去判断哪些是有价值的想法，并对其进行妥善推广。如果你没做到，那就得承认是自己的失误。</p>
<p>言归正传，我的团队目前正在研发一种针对语音的新模型架构，叫 <strong>Zapformer</strong>，是一个通用声音基座。</p>
<p>相较于我们去年推出的 Zipformer 而言，Zapformer 实现了三大跨越：</p>
<ul>
<li>
<p>从 “人声” 到“万声”的跨越：从专注于人声建模，到成为能同时理解人声、环境音等多元信息的通用声音基座；</p>
</li>
<li>
<p>从优化结构到创新理论的跨越：通过引入梯度流（Gradient Flow）理论指导模型设计，在已属业界标杆的 Zipformer 基础上，将语音识别精度再次显著提升 10%-15%；</p>
</li>
<li>
<p>从专用优化到通用健壮的跨越：为适应海量数据训练移除了 Dropout 层，增强了大数据拟合能力，同时将优化器升级为 TransformAdam，在保持极速收敛的同时，大幅提升了训练的通用性与稳定性。</p>
</li>
</ul>
<p>我不想把话说太满，说它就是 “下一个大热门”，但它确实包含了不少有意思的想法。</p>
<p>当然，我们希望能押中下一个 “大杀器”，但这事儿谁也没法打包票。</p>
<p>所有这些成果全都是开源的，因为我是开源的坚定信徒。除了我的项目，小米还有很多其他的开源项目。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文读懂大模型智能体（Agent）：从理论到实践]]></title>    <link>https://juejin.cn/post/7583943503556788274</link>    <guid>https://juejin.cn/post/7583943503556788274</guid>    <pubDate>2025-12-16T02:37:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556788274" data-draft-id="7583613222345064474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文读懂大模型智能体（Agent）：从理论到实践"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:37:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文读懂大模型智能体（Agent）：从理论到实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:37:08.000Z" title="Tue Dec 16 2025 02:37:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<blockquote>
<p>★</p>
<p>本文全面梳理了智能体(Agent)的核心概念、架构设计与实现方法，以及主流框架的对比分析。</p>
</blockquote>
<h2 data-id="heading-0">1.  智能体基础：理解Agent的工作原理</h2>
<hr/>
<h4 data-id="heading-1">1.1 任务环境分析：PEAS模型</h4>
<p>要理解智能体的运作，我们必须先理解它所处的任务环境。在人工智能领域，通常使用PEAS模型来精确描述一个任务环境，即分析其：</p>
<ul>
<li><strong>性能度量</strong>(Performance)：评估智能体成功与否的标准</li>
<li><strong>环境</strong>(Environment)：智能体运作的场景与条件</li>
<li><strong>执行器</strong>(Actuators)：智能体影响环境的方式</li>
<li><strong>传感器</strong>(Sensors)：智能体获取环境信息的渠道</li>
</ul>
<h4 data-id="heading-2">1.2 智能体循环：持续交互的核心机制</h4>
<p>智能体并非一次性完成任务，而是通过一个持续的循环与环境进行交互，这个核心机制被称为<strong>智能体循环</strong>(Agent Loop)。在这个循环中，智能体接收环境信息，进行内部推理，然后执行动作，再观察结果，如此反复，直到达成目标。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b0c72a75308473389b1898bddf8bd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=4JkOEtGG3ryleqVOtohXIlvjUa4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">1.3 提示工程：驱动LLM的关键</h4>
<p>驱动真实LLM的关键在于提示工程(Prompt Engineering)。我们需要设计一个"指令模板"，告诉LLM它应该扮演什么角色、拥有哪些工具、以及如何格式化它的思考和行动。这是我们智能体的"说明书"，它将作为system_prompt传递给LLM。</p>
<p>例如，一个旅行助手智能体的系统提示可能是：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">AGENT_SYSTEM_PROMPT</span> = <span class="hljs-string">"""  
你是一个智能旅行助手。你的任务是分析用户的请求,并使用可用工具一步步地解决问题。    
  
# 可用工具:    
- `get_weather(city: str)`: 查询指定城市的实时天气。   
- `get_attraction(city: str, weather: str)`: 根据城市和天气搜索推荐的旅游景点。    
  
# 行动格式:    
你的回答必须严格遵循以下格式。首先是你的思考过程,然后是你要执行的具体行动。    
Thought: [这里是你的思考过程和下一步计划]    
Action: [这里是你要调用的工具,格式为 function_name(arg_name="arg_value")]    
  
# 任务完成:    
当你收集到足够的信息,能够回答用户的最终问题时,你必须在`Action:`字段后使用 `finish(answer="...")`    
来输出最终答案。    
  
请开始吧!  
"""</span>
</code></pre>
<h2 data-id="heading-4">2.  智能体 vs 传统工作流：本质区别</h2>
<hr/>
<h4 data-id="heading-5">2.1 工作流(Workflow)模式</h4>
<p>工作流是一种传统的自动化范式，其核心是对一系列任务或步骤进行预先定义的、结构化的编排。它本质上是一个精确的、静态的流程图，规定了在何种条件下、以何种顺序执行哪些操作。</p>
<h4 data-id="heading-6">2.2 智能体(Agent)模式</h4>
<p>基于大型语言模型的智能体是一个具备自主性的、以目标为导向的系统。它不仅仅是执行预设指令，而是能够在一定程度上理解环境、进行推理、制定计划，并动态地采取行动以达成最终目标。LLM在其中扮演着"大脑"的角色。这种基于实时信息进行动态推理和决策的能力，正是Agent的核心价值所在。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb4dfb1618934a0d963747e54fd9b12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=O4kcSQyCM%2FLUwDsh3RhIREIYAFo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">3.  模型参数调优：提升Agent性能的关键</h2>
<hr/>
<h4 data-id="heading-8">3.1 温度(Temperature)参数</h4>
<p>Temperature这类的可配置参数，其本质是通过调整模型对"概率分布"的采样策略，让输出匹配具体场景需求，配置合适的参数可以提升Agent在特定场景的性能。</p>
<h4 data-id="heading-9">3.2 Top-k与Top-p采样</h4>
<ul>
<li><strong>Top-k</strong>：将所有token按概率从高到低排序，取排名前k个的token组成"候选集"，随后对筛选出的k个token的概率进行"归一化"</li>
<li><strong>Top-p</strong>：将所有token按概率从高到低排序，从排序后的第一个token开始，逐步累加概率，直到累积和首次达到或超过阈值p</li>
</ul>
<h4 data-id="heading-10">3.3 参数协同工作机制</h4>
<p>在文本生成中，当同时设置Top-p、Top-k和温度系数时，这些参数会按照分层过滤的方式协同工作，其优先级顺序为：温度调整→Top-k→Top-p。温度调整整体分布的陡峭程度，Top-k会先保留概率最高的k个候选，然后Top-p会从Top-k的结果中选取累积概率≥p的最小集合作为最终的候选集。</p>
<h2 data-id="heading-11">4.  核心智能体架构与实现</h2>
<hr/>
<h4 data-id="heading-12">4.1 ReAct智能体</h4>
<p>ReAct是一种将推理(Reasoning)与行动(Action)相结合的智能体架构。其核心思想是让智能体在思考过程中明确表达推理步骤，然后基于推理选择适当的行动，再根据行动结果更新认知，形成一个持续的循环。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d696e9f05cd546fe98e100dc3ae441e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=y1ESV2NkPQiw51VF%2Bfm6Mh0dNBY%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ReAct提示词模板  </span>
<span class="hljs-attr">REACT_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
请注意,你是一个有能力调用外部工具的智能助手。    
可用工具如下:  {tools}    
  
请严格按照以下格式进行回应:    
Thought: 你的思考过程,用于分析问题、拆解任务和规划下一步行动。    
Action: 你决定采取的行动,必须是以下格式之一:    
- `{tool_name}[{tool_input}]`:调用一个可用工具。   
- `Finish[最终答案]`:当你认为已经获得最终答案时。    
- 当你收集到足够的信息,能够回答用户的最终问题时,你必须在Action:字段后使用 finish(answer="...") 来输出最终答案。    
  
现在,请开始解决以下问题:  
Question: {question}    
History: {history}    
"""</span>
</code></pre>
<p>智能体将不断重复这个Thought -&gt; Action -&gt; Observation的循环，将新的观察结果追加到历史记录中，形成一个不断增长的上下文，直到它在Thought中认为已经找到了最终答案，然后输出结果。这个过程形成了一个强大的协同效应：推理使得行动更具目的性，而行动则为推理提供了事实依据。</p>
<h4 data-id="heading-13">4.2 Plan-and-Solve智能体</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4ef1a7c03546e098fa946fdd8939ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=ufKPUFYMk1IeKbOYye8D7co2f0M%3D" alt="" loading="lazy"/></p>
<p>Plan-and-Solve将整个流程解耦为两个核心阶段：</p>
<ol>
<li>规划阶段(Planning Phase)：首先，智能体会接收用户的完整问题。它的第一个任务不是直接去解决问题或调用工具，而是将问题分解，并制定出一个清晰、分步骤的行动计划。这个计划本身就是一次大语言模型的调用产物。</li>
<li>执行阶段(Solving Phase)：在获得完整的计划后，智能体进入执行阶段。它会严格按照计划中的步骤，逐一执行。每一步的执行都可能是一次独立的LLM调用，或者是对上一步结果的加工处理，直到计划中的所有步骤都完成，最终得出答案。</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 规划器提示词模板  </span>
<span class="hljs-attr">PLANNER_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一个顶级的AI规划专家。你的任务是将用户提出的复杂问题分解成一个由多个简单步骤组成的行动计划。    
请确保计划中的每个步骤都是一个独立的、可执行的子任务,并且严格按照逻辑顺序排列。    
你的输出必须是一个Python列表,其中每个元素都是一个描述子任务的字符串。    
  
问题: {question}    
请严格按照以下格式输出你的计划,`python与`作为前后缀是必要的:    
`python    
["步骤1", "步骤2", "步骤3", ...]    
`    
"""</span>  
  
<span class="hljs-comment"># 执行器提示词模板  </span>
<span class="hljs-attr">EXECUTOR_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位顶级的AI执行专家。你的任务是严格按照给定的计划,一步步地解决问题。    
你将收到原始问题、完整的计划、以及到目前为止已经完成的步骤和结果。    
请你专注于解决"当前步骤",并仅输出该步骤的最终答案,不要输出任何额外的解释或对话。    
  
# 原始问题:    
{question}    
  
# 完整计划:    
{plan}    
  
# 历史步骤与结果:    
{history}    
  
# 当前步骤:    
{current_step}    
  
请仅输出针对"当前步骤"的回答:    
"""</span>
</code></pre>
<h4 data-id="heading-14">4.3 Reflection智能体</h4>
<p>Reflection机制的核心思想是为智能体引入一种事后(post-hoc)的自我校正循环，使其能够像人类一样，审视自己的工作，发现不足，并进行迭代优化。它为智能体提供了一个内部纠错回路，使其不再完全依赖于外部工具的反馈(ReAct的Observation)，从而能够修正更高层次的逻辑和策略错误。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5696d4cbb0e46f981d1145ae840f40a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=OhqKXGZu%2FWvio9RHzNFvAQX08Hs%3D" alt="" loading="lazy"/></p>
<p>Reflection机制的优势：</p>
<ul>
<li>将一次性的任务执行转变为一个持续优化的过程，显著提升复杂任务的最终成功率和答案质量</li>
<li>为智能体构建了一个临时的"短期记忆"，整个"执行-反思-优化"的轨迹形成了宝贵的经验记录</li>
<li>支持多模态反思，可以反思和修正文本以外的输出(如代码、图像等)</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 初始执行提示词  </span>
<span class="hljs-attr">INITIAL_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位资深的Python程序员。请根据以下要求,编写一个Python函数。    
你的代码必须包含完整的函数签名、文档字符串,并遵循PEP 8编码规范。    
要求: {task}    
请直接输出代码,不要包含任何额外的解释。    
"""</span>  
  
<span class="hljs-comment"># 反思提示词  </span>
<span class="hljs-attr">REFLECT_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位极其严格的代码评审专家和资深算法工程师,对代码的性能有极致的要求。    
你的任务是审查以下Python代码,并专注于找出其在&lt;strong&gt;算法效率&lt;/strong&gt;上的主要瓶颈。    
  
# 原始任务:    
{task}  
  
# 待审查的代码:    
`python    
{code}    
`  
  
请分析该代码的时间复杂度,并思考是否存在一种&lt;strong&gt;算法上更优&lt;/strong&gt;的解决方案来显著提升性能。    
如果存在,请清晰地指出当前算法的不足,并提出具体的、可行的改进算法建议(例如,使用筛法替代试除法)。    
如果代码在算法层面已经达到最优,才能回答"无需改进"。    
  
请直接输出你的反馈,不要包含任何额外的解释。    
"""</span>  
  
<span class="hljs-comment"># 优化提示词  </span>
<span class="hljs-attr">REFINE_PROMPT_TEMPLATE</span> = <span class="hljs-string">"""  
你是一位资深的Python程序员。你正在根据一位代码评审专家的反馈来优化你的代码。    
  
# 原始任务:    
{task}    
  
# 你上一轮尝试的代码:    
`    
{last_code_attempt}    
`  
  
评审员的反馈:    
{feedback}    
  
请根据评审员的反馈,生成一个优化后的新版本代码。    
你的代码必须包含完整的函数签名、文档字符串,并遵循PEP 8编码规范。    
请直接输出优化后的代码,不要包含任何额外的解释。    
"""</span>
</code></pre>
<h2 data-id="heading-15">5.  智能体框架对比分析</h2>
<hr/>
<h4 data-id="heading-16">5.1 框架的本质与价值</h4>
<p>框架的本质，是提供一套经过验证的"规范"。它将所有智能体共有的、重复性的工作(如主循环、状态管理、工具调用、日志记录等)进行抽象和封装，让我们在构建新的智能体时，能够专注于其独特的业务逻辑，而非通用的底层实现。</p>
<h4 data-id="heading-17">5.2 AutoGen：基于对话的协作</h4>
<p>AutoGen的核心思想是通过对话实现协作。它将多智能体系统抽象为一个由多个"可对话"智能体组成的群聊。开发者可以定义不同角色(如Coder, ProductManager, Tester)，并设定它们之间的交互规则(例如，Coder写完代码后由Tester自动接管)。任务的解决过程，就是这些智能体在群聊中通过自动化消息传递，不断对话、协作、迭代直至最终目标达成的过程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eb195e18354402a8f2d7243b908295e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=UAlBCKjaXH3JYr%2FiI7xwdmjqga4%3D" alt="" loading="lazy"/></p>
<p>AutoGen的核心机制：</p>
<ul>
<li><strong>轮询群聊</strong>(RoundRobinGroupChat)：这是一种明确的、顺序化的对话协调机制。它会让参与的智能体按照预定义的顺序依次发言。这种模式非常适用于流程固定的任务，例如一个典型的软件开发流程：产品经理先提出需求，然后工程师编写代码，最后由代码审查员进行检查。</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_product_manager</span>(<span class="hljs-params">model_client</span>):  
    <span class="hljs-string">"""创建产品经理智能体"""</span>  
    system_message = <span class="hljs-string">"""  
    你是一位经验丰富的产品经理，专门负责软件产品的需求分析和项目规划。  
      
    你的核心职责包括：  
    1. **需求分析**：深入理解用户需求，识别核心功能和边界条件  
    2. **技术规划**：基于需求制定清晰的技术实现路径  
    3. **风险评估**：识别潜在的技术风险和用户体验问题  
    4. **协调沟通**：与工程师和其他团队成员进行有效沟通  
      
    当接到开发任务时，请按以下结构进行分析：  
    1. 需求理解与分析  
    2. 功能模块划分  
    3. 技术选型建议  
    4. 实现优先级排序  
    5. 验收标准定义  
      
    请简洁明了地回应，并在分析完成后说"请工程师开始实现"。  
    """</span>  
  
    <span class="hljs-keyword">return</span> AssistantAgent(  
        name=<span class="hljs-string">"ProductManager"</span>,  
        model_client=model_client,  
        system_message=system_message,  
    )
</code></pre>
<p>工作流程：</p>
<ol>
<li>创建一个RoundRobinGroupChat实例，并将所有参与协作的智能体加入其中</li>
<li>当任务开始时，群聊按预设顺序依次激活相应智能体</li>
<li>被选中的智能体根据当前对话上下文进行响应</li>
<li>群聊将新回复加入对话历史，并激活下一个智能体</li>
<li>过程持续进行，直到达到最大对话轮次或满足预设终止条件</li>
</ol>
<h4 data-id="heading-18">5.3 AgentScope：工业级多智能体平台</h4>
<p>AgentScope是一个专为多智能体应用设计的、功能全面的开发平台。它的核心特点是易用性和工程化。它提供了一套非常友好的编程接口，让开发者可以轻松定义智能体、构建通信网络，并管理整个应用的生命周期。其内置的消息传递机制和对分布式部署的支持，使其非常适合构建和运维复杂、大规模的多智能体系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c18803f92ccd43ca8b1ebff650fbd8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=xcJfigC2JoZoQLuUPtbDirYyN2s%3D" alt="" loading="lazy"/></p>
<p>与AutoGen相比，AgentScope的核心差异在于其消息驱动的架构设计和工业级的工程实践。如果说AutoGen更像是一个灵活的"对话工作室"，那么AgentScope就是一个完整的"智能体操作系统"，为开发者提供了从开发、测试到部署的全生命周期支持。与许多框架采用的继承式设计不同，AgentScope选择了组合式架构和消息驱动模式。这种设计不仅增强了系统的模块化程度，也为其出色的并发性能和分布式能力奠定了基础。</p>
<p>AgentScope的工程化优势也带来了一定的复杂性成本。其消息驱动架构虽然强大，但对开发者的技术要求较高，需要理解异步编程、分布式通信等概念。对于简单的多智能体对话场景，这种架构可能显得过于复杂，存在"过度工程化"的风险。此外，作为相对较新的框架，其生态系统和社区资源还有待进一步完善。因此，AgentScope更适合需要构建大规模、高可靠性的生产级多智能体系统，而对于快速原型开发或简单应用场景，选择更轻量级的框架可能更为合适。</p>
<h4 data-id="heading-19">5.4 CAMEL：角色扮演协作</h4>
<p>CAMEL最初的核心目标是探索如何在最少的人类干预下，让两个智能体通过"角色扮演"自主协作解决复杂任务。CAMEL实现自主协作的基石是两大核心概念：角色扮演(Role-Playing)和引导性提示(Inception Prompting)。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d2ed53fdd64f1d8f2f8e78d5354587~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457427&amp;x-signature=XuTqOxlfiZ%2FN3JtXJa6LFmf5DyA%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-20">5.5 LangGraph：图结构工作流</h4>
<p>作为LangChain生态的扩展，LangGraph另辟蹊径，将智能体的执行流程建模为图(Graph)。在传统的链式结构中，信息只能单向流动。而LangGraph将每一步操作(如调用LLM、执行工具)定义为图中的一个节点(Node)，并用边(Edge)来定义节点之间的跳转逻辑。这种设计天然支持循环(Cycles)，使得实现如Reflection这样的迭代、修正、自我反思的复杂工作流变得异常简单和直观。</p>
<p>与前面介绍的基于"对话"的框架(如AutoGen和CAMEL)不同，LangGraph将智能体的执行流程建模为一种状态机(State Machine)，并将其表示为有向图(Directed Graph)。在这种范式中，图的节点(Nodes)代表一个具体的计算步骤(如调用LLM、执行工具)，而边(Edges)则定义了从一个节点到另一个节点的跳转逻辑。这种设计的革命性之处在于它天然支持循环，使得构建能够进行迭代、反思和自我修正的复杂智能体工作流变得前所未有的直观和简单。</p>
<hr/>
<p>当前主流的低代码智能体开发平台呈现多元化发展格局，字节跳动旗下的Coze凭借可视化拖拽式界面和丰富的模板库，成为零代码用户的入门首选，尤其适合对话类应用开发，但其扩展性有限且仅支持云服务部署。国产开源平台Dify则以灵活定制和企业级能力见长，支持云服务与本地部署双模式，集成了主流大模型和低代码工作流功能，深受开发者青睐。德国工具n8n凭借其工匠精神和强大的工作流编排能力，在轻量级应用领域占据一席之地。此外，专注于企业级知识库系统和智能问答应用的FastGPT，以及全栈式企业平台得助智能等，共同构成了2025年智能体低代码开发平台的生态矩阵。</p>
<p>为了在本地实现高性能、生产级的模型推理服务，社区涌现出了VLLM和Ollama等优秀工具。这些工具能够显著提升推理速度，降低资源消耗，使智能体在本地环境中也能获得接近云端的性能表现。</p>
<p>随着框架的成熟和工具链的完善，智能体开发的门槛正在逐步降低，但对开发者来说，理解其底层原理和设计模式仍然是构建高性能、高可靠性智能体系统的关键。未来，随着多模态能力的增强和与物理世界的深度结合，智能体将在更广泛的应用场景中发挥重要作用。</p>
<h3 data-id="heading-21">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx HTTPS代理大文件加载失败的排查与解决方案]]></title>    <link>https://juejin.cn/post/7583970267132919814</link>    <guid>https://juejin.cn/post/7583970267132919814</guid>    <pubDate>2025-12-16T02:26:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132919814" data-draft-id="7583980250733346879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx HTTPS代理大文件加载失败的排查与解决方案"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-12-16T02:26:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="枫叶梨花"/> <meta itemprop="url" content="https://juejin.cn/user/3913917123816055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx HTTPS代理大文件加载失败的排查与解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917123816055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    枫叶梨花
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:26:48.000Z" title="Tue Dec 16 2025 02:26:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题背景</h2>
<p>今日运维人员告知我，突然网站的登录页访问变白屏，我登录后台发现服务一切正常，Nginx也正常运行，我尝试访问网站登录页，并连点十几次会访问正常，之后就会正常，但是登录以后也会<strong>某些页面存在白屏状态</strong>，查看浏览器请求发现<strong>某些JS、CSS文件没有正常返回</strong>，Nginx的<strong>访问日志出现206等问题</strong>，想到前几天刚续费了HTTPS的域名证书，证书也换过了，然后切换到<strong>内网HTTP发现正常</strong>，猜想应该是Nginx中的HTTPS的配置有问题，缓存类配置可能存在问题。</p>
<h2 data-id="heading-1">二、问题现象</h2>
<p>总结出现以下异常：</p>
<ul>
<li><strong>HTTPS访问登录页白屏</strong>，连续刷新20次后偶现正常；</li>
<li><strong>HTTP内网访问正常</strong>，无异常；</li>
<li>浏览器开发者工具显示：<strong>大体积JS文件（如<code>chunk-vendors.js</code>）加载失败</strong>，状态码为<code>206 Partial Content</code>；</li>
<li>Nginx访问日志记录：
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">10.</span>xx.xxx<span class="hljs-number">.90</span> - - <span class="hljs-number">443</span> [<span class="hljs-number">25</span>/Oct/<span class="hljs-number">2025</span>:<span class="hljs-number">17</span>:<span class="hljs-number">40</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0800</span>] 
  <span class="hljs-string">"GET /js/chunk-vendors.6112ac08.js HTTP/1.1"</span> <span class="hljs-number">206</span> <span class="hljs-number">1</span> 
  <span class="hljs-string">"https://xxxx/login"</span> 
  <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"</span>
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、问题定位与根因分析</h2>
<h3 data-id="heading-3">1. 核心问题：Nginx代理缓冲区不足</h3>
<h4 data-id="heading-4">（1）Nginx代理工作原理</h4>
<p>当Nginx作为反向代理时，其处理上游响应的流程如下：</p>
<ol>
<li>接收后端服务返回的响应数据；</li>
<li>将数据<strong>缓存到内存缓冲区</strong>中；</li>
<li>若缓冲区不足，则将数据写入临时文件（<code>proxy_max_temp_file_size</code>控制）；</li>
<li>最终将数据发送给客户端（浏览器）。</li>
</ol>
<h4 data-id="heading-5">（2）默认配置的限制</h4>
<p>Nginx默认配置的缓冲区大小为：</p>
<pre><code class="hljs language-nginx" lang="nginx">proxy_buffer_size 4k|8k;        # 响应头缓冲区
proxy_buffers 8 4k|8k;          # 响应体缓冲区（数量 × 大小）
proxy_busy_buffers_size 8k|16k; # 忙碌时可发送的最大缓冲区
</code></pre>
<ul>
<li><strong>总缓冲容量</strong>：<code>8 × 4k = 32KB</code>，不足以承载1~2MB的前端资源；</li>
<li><strong>HTTPS加重问题</strong>：TLS加密/解密消耗更多CPU资源，导致缓冲区更容易被撑满；</li>
<li><strong>206状态码的含义</strong>：<code>Partial Content</code>，表示响应未完整传输，Nginx在临时文件写入过程中可能因超时或中断导致加载失败。</li>
</ul>
<h4 data-id="heading-6">（3）为何HTTP正常？</h4>
<p>HTTP无需加密，Nginx处理速度更快，缓冲区在短时间内能完成数据传输，因此未触发问题。</p>
<hr/>
<h2 data-id="heading-7">四、解决方案与配置说明</h2>
<h3 data-id="heading-8">1. 调整Nginx代理缓冲区参数</h3>
<p>在Nginx配置文件的<code>http</code>块中添加以下配置：</p>
<pre><code class="hljs language-nginx" lang="nginx"># 增加内存缓冲区大小，避免写入临时文件
proxy_buffer_size 128k;         # 存储响应头（含Cookie/CSP等）
proxy_buffers 32 128k;          # 存储响应体（32 × 128k = 4MB）
proxy_busy_buffers_size 128k;   # 忙碌时最大发送缓冲区
</code></pre>
<h4 data-id="heading-9">参数详解：</h4>





























<table><thead><tr><th>参数</th><th>作用</th><th>推荐值</th><th>说明</th></tr></thead><tbody><tr><td><code>proxy_buffer_size</code></td><td>响应头缓冲区</td><td>128k</td><td>确保大头信息（如Cookie、CSP）完整加载</td></tr><tr><td><code>proxy_buffers</code></td><td>响应体缓冲区</td><td>32 × 128k</td><td>总容量4MB，覆盖常见前端资源大小</td></tr><tr><td><code>proxy_busy_buffers_size</code></td><td>忙碌时发送缓冲区</td><td>128k</td><td>避免缓冲区争用导致发送中断</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>生效范围</strong>：配置应放在<code>http</code>块中全局生效，或针对特定<code>server</code>/<code>location</code>块。</p>
</blockquote>
<h3 data-id="heading-10">2. 重载Nginx配置</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查配置语法</span>
sudo nginx -t

<span class="hljs-comment"># 重载配置</span>
sudo nginx -s reload
</code></pre>
<hr/>
<h2 data-id="heading-11">五、验证与测试</h2>
<p><strong>清除浏览器缓存</strong>之后重新访问，一切正常，问题解决。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[maven项目使用指定JDK版本打包]]></title>    <link>https://juejin.cn/post/7583970267132985350</link>    <guid>https://juejin.cn/post/7583970267132985350</guid>    <pubDate>2025-12-16T02:39:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132985350" data-draft-id="7583991680748814363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="maven项目使用指定JDK版本打包"/> <meta itemprop="keywords" content="后端,Java,maven"/> <meta itemprop="datePublished" content="2025-12-16T02:39:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="考虑考虑"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335157287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            maven项目使用指定JDK版本打包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335157287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    考虑考虑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:39:48.000Z" title="Tue Dec 16 2025 02:39:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在使用多个JDK版本环境打包过程中，有时候懒得配置环境变量，使用maven打包的时候,会报版本对应不上</p>
<h3 data-id="heading-1">maven打包</h3>
<p>没有配置对应项目jdk环境而打包时，会报</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0933efb769c94abd8f63cdd0b692b8a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICD6JmR6ICD6JmR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457587&amp;x-signature=2FfNwazhF5EdRZcbSAz7NnS5WHo%3D" alt="image.png" loading="lazy"/>
这个时候，可以在<code>pom.xml</code>文件配置</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">executable</span>&gt;</span>D:/soft/jdk-25.0.1/bin/javac<span class="hljs-tag">&lt;/<span class="hljs-name">executable</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">fork</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">fork</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>执行JDK路径</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4103657bb5ff47fd9ef22b21a05d78ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ICD6JmR6ICD6JmR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457587&amp;x-signature=EXqe2UgpC092x2oUIb2oitvpRLg%3D" alt="image.png" loading="lazy"/>
或者使用mvn命令</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用指定JDK版本编译打包</span>
mvn clean package <span class="hljs-attr">-Dmaven.compiler.source</span>=<span class="hljs-number">25</span> -Dmaven.compiler.target=<span class="hljs-number">25</span>

<span class="hljs-comment"># 如果需要指定JDK安装路径 </span>
mvn clean package <span class="hljs-attr">-Dmaven.compiler.executable</span>=D:/soft/jdk-<span class="hljs-number">25.0</span>.<span class="hljs-number">1</span>/bin/javac
</code></pre>
<h3 data-id="heading-2">总结</h3>
<p>maven打包可以指定对应的JDK版本打包，这样就不用每次需要切换路径</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统]]></title>    <link>https://juejin.cn/post/7583933107690176575</link>    <guid>https://juejin.cn/post/7583933107690176575</guid>    <pubDate>2025-12-16T02:36:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107690176575" data-draft-id="7583933107690127423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统"/> <meta itemprop="keywords" content="前端,TypeScript"/> <meta itemprop="datePublished" content="2025-12-16T02:36:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只秋刀鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2907533671935453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2907533671935453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只秋刀鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:36:57.000Z" title="Tue Dec 16 2025 02:36:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从 0 到 1 构建 React + TypeScript 车辆租赁后台管理系统</h2>
<p>在企业级后台管理系统开发中，React 结合 TypeScript 已是主流技术栈 ——TypeScript 的类型校验能大幅降低大型项目的维护成本，React 的组件化特性则适配后台系统复杂的 UI 与交互场景。本文以<strong>车辆租赁后台管理系统</strong>为例，拆解从技术选型、架构设计到核心功能实现的全流程，为前端开发者提供可落地的实战思路。</p>
<h3 data-id="heading-1">一、项目背景与技术栈选型</h3>
<h4 data-id="heading-2">1. 业务场景特点</h4>
<p>车辆租赁后台需覆盖「车辆管理、订单调配、客户管理、财务结算、操作日志」等核心模块，具有以下特点：</p>
<ul>
<li>数据交互频繁（如实时查询车辆状态、订单流转）；</li>
<li>表单 / 表格操作密集（如批量派发任务、筛选车辆信息）；</li>
<li>权限分级严格（不同角色可见 / 可操作的模块不同）；</li>
<li>需兼容多端（PC 端为主，部分功能适配平板）。</li>
</ul>
<h4 data-id="heading-3">2. 核心技术栈</h4>

































<table><thead><tr><th>技术 / 框架</th><th>选型理由</th></tr></thead><tbody><tr><td>React 18</td><td>组件化开发、Hooks 简化状态管理、Concurrent Mode 提升交互流畅度</td></tr><tr><td>TypeScript 5.x</td><td>强类型约束避免类型错误、提升代码可读性、便于团队协作</td></tr><tr><td>Umi 4</td><td>开箱即用的路由 / 构建 / 权限方案，适配中后台开发的工程化需求</td></tr><tr><td>Ant Design Pro</td><td>提供 ProTable/ProForm/Descriptions 等中后台高频组件，减少重复造轮子</td></tr><tr><td>ahooks</td><td>封装常用 Hooks（如 useRequest、useSelections），简化异步请求 / 状态管理</td></tr><tr><td>axios</td><td>统一封装请求拦截、响应处理，适配后端接口规范</td></tr></tbody></table>
<h3 data-id="heading-4">二、项目架构设计</h3>
<p>遵循「高内聚、低耦合」原则，采用分层式架构，目录结构如下：</p>
<p>plaintext</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">src</span>/
├── api/            <span class="hljs-comment">// 接口请求封装（按模块拆分）</span>
│   ├── car<span class="hljs-selector-class">.ts</span>      <span class="hljs-comment">// 车辆管理接口</span>
│   ├── <span class="hljs-attribute">order</span><span class="hljs-selector-class">.ts</span>    <span class="hljs-comment">// 订单调配接口</span>
│   └── user<span class="hljs-selector-class">.ts</span>     <span class="hljs-comment">// 用户/权限接口</span>
├── components/     <span class="hljs-comment">// 通用业务组件（如OperationRecord、PreviewFiles）</span>
├── pages/          <span class="hljs-comment">// 页面级组件（按业务模块拆分）</span>
│   ├── CarManage/  <span class="hljs-comment">// 车辆管理</span>
│   ├── OrderAlloc/ <span class="hljs-comment">// 订单调配（核心模块）</span>
│   └── System/     <span class="hljs-comment">// 系统设置</span>
├── utils/          <span class="hljs-comment">// 工具函数（如字典映射、时间格式化）</span>
├── typings/        <span class="hljs-comment">// TS类型声明（接口返回值、组件Props）</span>
└── access<span class="hljs-selector-class">.ts</span>       <span class="hljs-comment">// 权限控制配置</span>
</code></pre>
<h4 data-id="heading-5">关键设计原则</h4>
<ol>
<li><strong>类型先行</strong>：所有接口返回值、组件 Props、全局状态均定义 TS 类型，例如订单调配模块的核心类型：</li>
</ol>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// typings/order.d.ts</span>
<span class="hljs-comment">/** 订单基础信息 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AllocOrder</span> {
  <span class="hljs-attr">orderNo</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 工单编号</span>
  <span class="hljs-attr">orderStatus</span>: <span class="hljs-string">'toFormulate'</span> | <span class="hljs-string">'toDistribute'</span> | <span class="hljs-string">'completed'</span>; <span class="hljs-comment">// 订单状态</span>
  <span class="hljs-attr">carNo</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 车牌</span>
  <span class="hljs-attr">vin</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 车架号</span>
  <span class="hljs-attr">allocateInfo</span>: {
    <span class="hljs-attr">batchNo</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">deliveryType</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 交付类型</span>
    <span class="hljs-attr">outContactsName</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 调出联系人</span>
  };
}

<span class="hljs-comment">/** 订单列表请求参数 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AllocOrderParams</span> {
  <span class="hljs-attr">orderSource</span>: <span class="hljs-built_in">string</span>;
  batchNo?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">current</span>: <span class="hljs-built_in">number</span>;
}
</code></pre>
<ol start="2">
<li><strong>复用性优先</strong>：抽离通用业务组件（如操作记录组件 OperationRecord），避免重复代码：</li>
</ol>
<p>tsx</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// components/OperationRecordSection/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ActionType</span>, <span class="hljs-title class_">ProColumns</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> { operationListPage } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OperationRecordSectionProps</span> {
  <span class="hljs-attr">formValues</span>: {
    orderNo?: <span class="hljs-built_in">string</span>;
    [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
  };
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">OperationRecordSection</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">OperationRecordSectionProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ formValues }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> actionRef = useRef&lt;<span class="hljs-title class_">ActionType</span>&gt;();

  <span class="hljs-comment">// 监听工单编号变化，自动刷新操作记录</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (formValues?.<span class="hljs-property">orderNo</span>) {
      actionRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">reload</span>();
    }
  }, [formValues?.<span class="hljs-property">orderNo</span>]);

  <span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">ProColumns</span>[] = [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作节点'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNode'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作人'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'operationName'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作时间'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'createdDate'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'操作详情'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'operatorDetail'</span> },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
      <span class="hljs-attr">search</span>=<span class="hljs-string">{false}</span>
      <span class="hljs-attr">actionRef</span>=<span class="hljs-string">{actionRef}</span>
      <span class="hljs-attr">request</span>=<span class="hljs-string">{async</span> (<span class="hljs-attr">params</span>) =&gt;</span> {
        if (!formValues?.orderNo) return { data: [], total: 0 };
        return operationListPage({ ...params, orderNo: formValues.orderNo });
      }}
      columns={columns}
      pagination={{ defaultPageSize: 5 }}
    /&gt;</span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OperationRecordSection</span>;
</code></pre>
<h3 data-id="heading-6">三、核心功能实现</h3>
<h4 data-id="heading-7">1. 订单调配模块（核心场景）</h4>
<p>订单调配是车辆租赁后台的核心，需实现「方案制定、任务派发、详情查看」等功能，且需结合状态控制权限与交互。</p>
<h5 data-id="heading-8">（1）带状态控制的表格渲染</h5>
<p>使用 ProTable 实现订单列表，根据订单状态（toFormulate/toDistribute）动态展示操作按钮，且仅允许勾选「方案制定」状态的行：</p>
<p>tsx</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/OrderAlloc/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PageHeaderWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-layout'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, message } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> { getAllocationList } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Func</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/Func'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">OrderAlloc</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [selectedRowKeys, setSelectedRowKeys] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [selectedRows, setSelectedRows] = useState&lt;<span class="hljs-title class_">AllocOrder</span>[]&gt;([]);

  <span class="hljs-comment">// 表格列配置</span>
  <span class="hljs-keyword">const</span> columns = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'工单编号'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNo'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'orderNo'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'订单状态'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderStatus'</span>,
      <span class="hljs-attr">valueEnum</span>: <span class="hljs-title class_">Func</span>.<span class="hljs-title function_">dictEnum</span>(dictMap, <span class="hljs-string">'AllocOrderStatus'</span>), <span class="hljs-comment">// 字典映射</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'车牌'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'carNo'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'操作'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'option'</span>,
      <span class="hljs-attr">valueType</span>: <span class="hljs-string">'option'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, record</span>) =&gt;</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
          {/* 仅「方案制定」状态显示「方案制定」按钮 */}
          {record.orderStatus === 'toFormulate' &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenFormulateModal(record)}&gt;方案制定<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          )}
          {/* 仅「待派发」状态显示「派发任务」按钮 */}
          {record.orderStatus === 'toDistribute' &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenDispatchModal(record)}&gt;派发任务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          )}
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleOpenDetail(record)}&gt;详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
      ),
    },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PageHeaderWrapper</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span>
        <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"orderNo"</span>
        <span class="hljs-attr">rowSelection</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">selectedRowKeys</span>,
          <span class="hljs-attr">onChange:</span> (<span class="hljs-attr">keys</span>, <span class="hljs-attr">rows</span>) =&gt;</span> {
            // 仅保留「方案制定」状态的选中行
            const validRows = rows.filter(row =&gt; row.orderStatus === 'toFormulate');
            setSelectedRowKeys(validRows.map(row =&gt; row.orderNo));
            setSelectedRows(validRows);
            if (rows.length &gt; validRows.length) {
              message.warning('仅"方案制定"状态的订单可勾选');
            }
          },
          // 禁用非「方案制定」状态的行勾选
          getCheckboxProps: (record) =&gt; ({
            disabled: record.orderStatus !== 'toFormulate',
          }),
        }}
        request={(params) =&gt; getAllocationList({ ...params, orderSource: 'ALLOCATE' })}
        columns={columns}
        toolBarRender={() =&gt; [
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{selectedRows.length</span> === <span class="hljs-string">0}</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleBatchFormulate()}
          &gt;
            批量方案制定
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>,
        ]}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">PageHeaderWrapper</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">OrderAlloc</span>;
</code></pre>
<h5 data-id="heading-9">（2）详情弹窗实现</h5>
<p>通过 Modal 封装详情弹窗，整合 ProTable、Descriptions 组件展示订单多维度信息，并复用操作记录组件：</p>
<p>tsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/OrderAlloc/components/DeploymentDetail.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Modal</span>, <span class="hljs-title class_">Descriptions</span>, <span class="hljs-title class_">Collapse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-table'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OperationRecordSection</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/OperationRecordSection'</span>;
<span class="hljs-keyword">import</span> { allocatePlanDetail } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/order'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Func</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/Func'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DeploymentDetail</span> = (<span class="hljs-params">{ visible, onCancel, formValues }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [orderDetail, setOrderDetail] = useState&lt;<span class="hljs-title class_">AllocOrder</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [taskList, setTaskList] = useState&lt;<span class="hljs-title class_">AllocOrder</span>[]&gt;([]);

  <span class="hljs-comment">// 获取订单详情</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (visible &amp;&amp; formValues?.<span class="hljs-property">batchNo</span>) {
      <span class="hljs-title function_">allocatePlanDetail</span>({ <span class="hljs-attr">batchNo</span>: formValues.<span class="hljs-property">batchNo</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-title function_">setOrderDetail</span>(res.<span class="hljs-property">data</span>);
        <span class="hljs-title function_">setTaskList</span>(res.<span class="hljs-property">data</span>.<span class="hljs-property">taskList</span> || []);
      });
    }
  }, [visible, formValues]);

  <span class="hljs-comment">// 工单信息表格列</span>
  <span class="hljs-keyword">const</span> workColumns = [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'工单编号'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'orderNo'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'车型'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'modelName'</span>, <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, r</span>) =&gt;</span> r.<span class="hljs-property">carInfo</span>?.<span class="hljs-property">modelName</span> || <span class="hljs-string">'-'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'交付类型'</span>, <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'deliveryType'</span>, <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, r</span>) =&gt;</span> <span class="hljs-title class_">Func</span>.<span class="hljs-title function_">dictLabel</span>(dictMap, <span class="hljs-string">'DeliveryType'</span>, r.<span class="hljs-property">allocateInfo</span>?.<span class="hljs-property">deliveryType</span>) || <span class="hljs-string">'-'</span> },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
      <span class="hljs-attr">open</span>=<span class="hljs-string">{visible}</span>
      <span class="hljs-attr">onCancel</span>=<span class="hljs-string">{onCancel}</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">"80%"</span>
      <span class="hljs-attr">footer</span>=<span class="hljs-string">{null}</span>
      <span class="hljs-attr">destroyOnClose</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Collapse</span> <span class="hljs-attr">defaultActiveKey</span>=<span class="hljs-string">{[</span>'<span class="hljs-attr">1</span>', '<span class="hljs-attr">2</span>', '<span class="hljs-attr">3</span>']}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"工单信息"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"1"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ProTable</span> <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{taskList}</span> <span class="hljs-attr">columns</span>=<span class="hljs-string">{workColumns}</span> <span class="hljs-attr">pagination</span>=<span class="hljs-string">{false}</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"调配信息"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"2"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions</span> <span class="hljs-attr">column</span>=<span class="hljs-string">{3}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"交付类型"</span>&gt;</span>
              {Func.dictLabel(dictMap, 'DeliveryType', orderDetail?.allocateInfo?.deliveryType) || '-'}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions.Item</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Descriptions.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"备注"</span>&gt;</span>{orderDetail?.remark || '-'}<span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions.Item</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">Descriptions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Collapse.Panel</span> <span class="hljs-attr">header</span>=<span class="hljs-string">"操作记录"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"3"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">OperationRecordSection</span> <span class="hljs-attr">formValues</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">...formValues</span>, <span class="hljs-attr">orderNo:</span> <span class="hljs-attr">orderDetail</span>?<span class="hljs-attr">.orderNo</span> }} /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse.Panel</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Collapse</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DeploymentDetail</span>;
</code></pre>
<h4 data-id="heading-10">2. 字典映射封装</h4>
<p>车辆租赁系统包含大量枚举值（如交付类型、订单状态），封装通用字典工具函数，统一处理类型映射：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/Func.ts</span>
<span class="hljs-comment">/**
 * 字典转下拉/表格枚举格式
 * <span class="hljs-doctag">@param</span> dictMap 全局字典对象
 * <span class="hljs-doctag">@param</span> dictKey 字典key
 * <span class="hljs-doctag">@returns</span> 枚举对象
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">dictEnum</span> = (<span class="hljs-params">dictMap: <span class="hljs-built_in">any</span>, dictKey: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!dictMap?.[dictKey]) <span class="hljs-keyword">return</span> {};
  <span class="hljs-keyword">return</span> dictMap[dictKey].<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc: <span class="hljs-built_in">any</span>, item: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    acc[item.<span class="hljs-property">value</span>] = item.<span class="hljs-property">label</span>;
    <span class="hljs-keyword">return</span> acc;
  }, {});
};

<span class="hljs-comment">/**
 * 根据值获取字典标签
 * <span class="hljs-doctag">@param</span> dictMap 全局字典对象
 * <span class="hljs-doctag">@param</span> dictKey 字典key
 * <span class="hljs-doctag">@param</span> value 字典值
 * <span class="hljs-doctag">@returns</span> 字典标签
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">dictLabel</span> = (<span class="hljs-params">dictMap: <span class="hljs-built_in">any</span>, dictKey: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (!dictMap?.[dictKey] || !value) <span class="hljs-keyword">return</span> <span class="hljs-string">'-'</span>;
  <span class="hljs-keyword">const</span> item = dictMap[dictKey].<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">any</span></span>) =&gt;</span> item.<span class="hljs-property">value</span> === value);
  <span class="hljs-keyword">return</span> item?.<span class="hljs-property">label</span> || <span class="hljs-string">'-'</span>;
};
</code></pre>
<h3 data-id="heading-11">四、项目优化要点</h3>
<h4 data-id="heading-12">1. 性能优化</h4>
<ul>
<li><strong>数据缓存</strong>：使用 ahooks 的 useRequest 配置 cacheKey，缓存高频查询的订单列表，避免重复请求；</li>
<li><strong>组件懒加载</strong>：通过 Umi 的 dynamicImport 实现页面级懒加载，减少首屏加载体积；</li>
<li><strong>表格虚拟滚动</strong>：ProTable 开启 scroll={{y: 600}} + virtual={true}，优化大数据量表格渲染。</li>
</ul>
<h4 data-id="heading-13">2. 体验优化</h4>
<ul>
<li><strong>状态联动</strong>：勾选行时实时过滤无效行并给出提示，避免用户误操作；</li>
<li><strong>兜底显示</strong>：所有字典映射、嵌套数据访问均添加兜底（|| '-'），避免页面空白；</li>
<li><strong>加载状态</strong>：异步请求时添加骨架屏 / 加载动画，提升交互体验。</li>
</ul>
<h4 data-id="heading-14">3. 可维护性优化</h4>
<ul>
<li><strong>统一请求封装</strong>：拦截请求 / 响应，统一处理 token、错误提示；</li>
<li><strong>注释规范</strong>：关键业务逻辑、工具函数添加 TSDoc 注释；</li>
<li><strong>分支管理</strong>：按「功能分支 - 测试分支 - 主分支」流程开发，避免代码冲突。</li>
</ul>
<h3 data-id="heading-15">五、总结</h3>
<p>React + TypeScript 构建车辆租赁后台管理系统，核心在于「类型约束降低风险、组件复用提升效率、业务逻辑分层解耦」。本文从架构设计到核心功能实现，覆盖了中后台开发的高频场景：表格状态控制、字典映射、通用组件封装、权限控制等。</p>
<p>实际开发中，需结合业务场景灵活调整 —— 例如车辆租赁的「车辆定位、合同管理」等扩展模块，可复用本文的架构思路，通过 TypeScript 定义类型、Pro 组件快速实现 UI，最终打造高性能、易维护的企业级后台系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。]]></title>    <link>https://juejin.cn/post/7583969283790061622</link>    <guid>https://juejin.cn/post/7583969283790061622</guid>    <pubDate>2025-12-16T02:43:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583969283790061622" data-draft-id="7583984122235027498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-16T02:43:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:43:56.000Z" title="Tue Dec 16 2025 02:43:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>逛逛在 11 月发了一篇文章，盘点了 GitHub 上 AI 操纵手机的开源项目。</p>
<p>获得了 3 万多阅读，3000 多人转发收藏：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd8410fb07046d8b8a6f6db0a62988d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=gPXulglpgqrxG9q4eQbYdwXMbEE%3D" alt="图片" loading="lazy"/></p>
<p>没想到那篇文章发布 5 天后，豆包就官宣推出了 AI 手机，紧接着智谱 AI 就开源了 AutoGLM 模型。</p>
<p>我又搜罗了几个 AI 操作手机的开源项目，再加上我之前发的那篇。整个 GitHub 上关于 AI 控制手机的项目算是被逛逛搜刮干净了。</p>
<p>欢迎收藏转发👏</p>
<h2 data-id="heading-0">01、智谱开源：Open-AutoGLM</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da34e068012e4bc0bd7c51154d930bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=WbikuqLDP0%2FID5RLuXWW92pCQrk%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>这个开源项目太顶了，不到一周就 1.3 万的 Star 了。</p>
<p>基于这个开源框架，就能让 AI 可以<strong>像人眼一样看手机屏幕</strong>，然后像人手一样去点击。</p>
<p>你给它一个任务，比如：帮我总结下长春的景点，到高德地图上收藏一下这几个景点，特别是具体看看博物馆门票价格，再去12306上订一张上午十点从北京去长春的高铁票，把相关信息整理好给我。</p>
<p>AutoGLM 会先把手机屏幕截个图，模型会分析截图，通过视觉定位找到当前要点击哪个按钮或者做啥操作。</p>
<p>并通过 ADB（Android Debug Bridge）工具，直接向手机发送点击、滑动、输入文字的指令。</p>
<p>最终这样一步步模拟人看手机、操纵手机的行为，完成你给的任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64e6aa6b09424c75b4fdaa5772bc82e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=wpzrBWk26HX97tTekzAskgdwF8s%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/zai-org/Open-AutoGLM</span>
</code></pre>
<p>而且这个开源可以本地部署，而且如果你有显卡，大约需要 24GB+ 显存，你可以把这个 Agent 跑在本地。</p>
<p>隐私数据，比如聊天记录、支付画面啥的不上传到云端也能自动化的你的安卓手机了。</p>
<p>如何使用</p>
<p>你可以使用Claude Code，配置 GLM Coding Plan 后，输入以下提示词，快速部署本项目。 </p>
<pre><code class="hljs language-bash" lang="bash">访问文档，为我安装 AutoGLM ：https://raw.githubusercontent.com/zai-org/Open-AutoGLM/refs/heads/main/README.md
</code></pre>
<h2 data-id="heading-1">02、通过 MCP 控制手机：DroidMind</h2>
<p><strong>DroidMind 这个开源项目的的核心逻辑是不自己训练一个新模型，而是做一个</strong> <strong>超级适配器</strong>。</p>
<p>它通过 MCP 协议，把你的 <strong>Android 手机</strong>直接挂载到 <strong>Claude Desktop</strong>、<strong>Cursor</strong> 或者 Claude <strong>Code</strong> 上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b02d0991fb2a43488648ebd3373427ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=ZyI3vsHOF6tLB5rtRPlXnQvddEM%3D" alt="图片" loading="lazy"/></p>
<p>你不需要运行一个沉重的本地模型。</p>
<p>你直接用最聪明的 <strong>Claude 或 Gemini</strong>，通过 DroidMind 这个翻译官，直接操控你的安卓手机。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8675948f544464986d155332699dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=l4ZxsDMfoe0IMphZqUryM7iUZSI%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/hyperb1iss/DroidMind</span>
</code></pre>
<h2 data-id="heading-2">03、微软开源：UFO</h2>
<p>这个叫 UFO 的开源项目其实是微软开源的 AI 操作 Windows 系统的开源项目。</p>
<p>只不过 11 月推出的 UFO³ Galaxy 已经演变成了一个<strong>跨设备、跨平台的编排框架。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b417d760183748f090dae85f029b2531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=xJbKxU1sIV9N1HQhBISkQzbImJA%3D" alt="图片" loading="lazy"/><strong>UFO³ Galaxy</strong> 涉及到操纵 <strong>Android 手机设备</strong>的部分是这次更新的核心亮点之一。它也是通过引入 <strong>MCP 架构来实现的，这使得 UFO 不再局限于 Windows，而是能像指挥官一样控制安卓手机。</strong><br/>
<strong><strong><strong><strong>UFO³ Galaxy</strong> 是一个</strong>多设备编排系统</strong>。它的核心理念包含两个部分。</strong></p>
<ul>
<li>Galaxy (星系)：整个控制中枢，负责分发任务。</li>
<li>Constellation (星座)：它将一个复杂的用户指令，比如把手机上的刚拍的照片传到电脑并用 Photoshop 编辑，拆解成一个 DAG（有向无环图）。</li>
</ul>
<p>Windows 电脑、Linux 服务器、<strong>Android 手机</strong> 等都作为独立的节点接入这个网络。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd0c8f3f4526455695729b40dc244788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=9pxL%2FnAnkqzhnRzTDxKoFdSNlZ4%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/microsoft/UFO</span>
</code></pre>
<h2 data-id="heading-3">04、字节开源：UI-TARS</h2>
<p>字节跳动开源的一个基于视觉-语言模型（VLM）的 GUI 智能体（Agent）项目。</p>
<p>它的核心目标是让 AI 像人类一样，通过视觉识别屏幕和操作鼠标/键盘/触控，直接控制手机、计算机或网页。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b02bf798394c6796467a71a90fecc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=7O9xIgwUtSHFyzxOZb7Vh80wWtI%3D" alt="图片" loading="lazy"/><strong>安卓手机设备操纵，</strong> UI-TARS 采用了一种<strong>端到端、纯视觉驱动、基于 ADB</strong> 的控制方案。</p>
<p>也是截取手机屏幕画面，把截图输入给视觉模型，模型结合用户的指令分析屏幕上的元素，决定下一步做什么。</p>
<p>最后模型输出具体的动作指令，转化为底层的 Android ADB 命令发送给手机执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1610839b4d4f7b88f7c69b7653c7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=PIk7p7%2BqJx7i1I4rR5t9UmhPEPA%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/bytedance/UI-TARS</span>
</code></pre>
<p>另外之前发布的另外一个盘点 AI 控制手机开源项目的链接如下，感兴趣的可以去看看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxNjg4NDEzNA%3D%3D%26mid%3D2247529132%26idx%3D1%26sn%3D0b45b857cfd67f9144472f2017f46a14%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxNjg4NDEzNA==&amp;mid=2247529132&amp;idx=1&amp;sn=0b45b857cfd67f9144472f2017f46a14&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">5 个 AI 操纵手机的 GitHub 项目，牛逼了。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Monorepo 架构：现代软件开发的代码管理革命]]></title>    <link>https://juejin.cn/post/7583970267132854278</link>    <guid>https://juejin.cn/post/7583970267132854278</guid>    <pubDate>2025-12-16T02:10:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132854278" data-draft-id="7583980250733150271" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Monorepo 架构：现代软件开发的代码管理革命"/> <meta itemprop="keywords" content="前端,JavaScript,架构"/> <meta itemprop="datePublished" content="2025-12-16T02:10:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Monorepo 架构：现代软件开发的代码管理革命
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:10:31.000Z" title="Tue Dec 16 2025 02:10:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在当今快速发展的软件开发领域，随着项目复杂度的不断提升，传统的多仓库（Multi-repo）开发模式逐渐暴露出协作成本高、版本管理混乱、依赖复用困难等问题。在此背景下，<strong>Monorepo（单一代码仓库）</strong> ​ 架构应运而生，并已成为Google、Facebook、Microsoft等大型科技公司的标准实践</p>
<h2 data-id="heading-0">一、什么是Monorepo？</h2>
<p>Monorepo（Monolithic Repository）是一种将多个项目（如多个前端应用、组件库、工具库等）集中存放在<strong>同一个代码仓库</strong>中的开发管理模式。与传统的“一个项目一个仓库”不同，Monorepo强调在单一版本控制仓库中管理多个相关但独立的模块或服务。</p>
<h3 data-id="heading-1">核心特征</h3>
<ul>
<li><strong>统一存储</strong>：所有相关项目的代码、配置和文档都位于同一个Git仓库中</li>
<li><strong>共享依赖</strong>：通过工作区（workspace）机制实现依赖的统一管理</li>
<li><strong>原子提交</strong>：跨项目的变更可以作为一个原子提交，确保一致性</li>
<li><strong>集中化构建</strong>：统一的CI/CD流程和构建工具配置</li>
</ul>
<h2 data-id="heading-2">二、Monorepo的演进历程</h2>
<p>代码仓库管理方式经历了三个主要阶段的演进：</p>
<h3 data-id="heading-3">1. 单仓库巨石应用（Monolith）</h3>
<ul>
<li><strong>特点</strong>：所有代码集中在一个仓库中，便于初期管理和部署</li>
<li><strong>问题</strong>：随着项目规模增长，构建时间增加、代码冲突频繁、维护困难</li>
</ul>
<h3 data-id="heading-4">2. 多仓库多模块应用（Multi-repo）</h3>
<ul>
<li><strong>特点</strong>：将项目拆分成多个模块，每个模块使用单独的仓库管理</li>
<li><strong>优势</strong>：提高了模块独立性，便于团队并行开发</li>
<li><strong>挑战</strong>：跨仓库依赖管理复杂、版本同步困难、工作流程繁琐</li>
</ul>
<h3 data-id="heading-5">3. 单仓库多模块应用（Monorepo）</h3>
<ul>
<li><strong>特点</strong>：在单一仓库中管理多个相关模块</li>
<li><strong>优势</strong>：简化跨模块依赖管理、提高代码共享效率、统一构建流程</li>
<li><strong>挑战</strong>：需要更精细的权限控制、大型仓库性能优化</li>
</ul>
<h2 data-id="heading-6">三、Monorepo vs. Multi-repo：核心对比</h2>








































<table><thead><tr><th>维度</th><th>Monorepo</th><th>Multi-repo</th></tr></thead><tbody><tr><td><strong>代码可见性</strong>​</td><td>整个代码库变化趋势清晰，便于团队协作</td><td>代码隔离，研发者只需关注负责的仓库</td></tr><tr><td><strong>依赖管理</strong>​</td><td>统一版本控制，相同依赖只安装一次，节省磁盘空间</td><td>每个仓库独立node_modules，存在重复安装</td></tr><tr><td><strong>构建效率</strong>​</td><td>可能较慢，但支持增量构建和缓存优化</td><td>独立构建，通常更快</td></tr><tr><td><strong>代码权限</strong>​</td><td>缺乏项目粒度权限管控，误改风险较高</td><td>各项目单独仓库，权限控制精细</td></tr><tr><td><strong>跨项目变更</strong>​</td><td>原子提交确保一致性，同步更新容易</td><td>需要手动协调多个仓库的变更</td></tr><tr><td><strong>典型场景</strong>​</td><td>微前端、微服务间强耦合的系统</td><td>团队边界清晰、独立部署的业务单元</td></tr></tbody></table>
<h2 data-id="heading-7">四、Monorepo的核心优势</h2>
<h3 data-id="heading-8">1. <strong>高效的代码共享与复用</strong></h3>
<ul>
<li>共享组件、工具函数和业务逻辑可以直接在仓库内引用</li>
<li>修改公共组件后，所有依赖它的应用可以同步更新</li>
</ul>
<h3 data-id="heading-9">2. <strong>统一的依赖管理</strong></h3>
<ul>
<li>通过工作区机制将相同版本的依赖提升到顶层只安装一次</li>
<li>避免版本碎片化，减少“依赖地狱”问题</li>
</ul>
<h3 data-id="heading-10">3. <strong>原子性变更与重构</strong></h3>
<ul>
<li>跨多个项目或模块的更改可以作为一个原子提交进行</li>
<li>降低了部署和回滚的复杂性</li>
</ul>
<h3 data-id="heading-11">4. <strong>标准化的开发流程</strong></h3>
<ul>
<li>统一的代码规范、构建工具、测试框架和部署流程</li>
<li>简化新成员入职过程，提高团队协作效率</li>
</ul>
<h3 data-id="heading-12">5. <strong>更好的工具集成</strong></h3>
<ul>
<li>集中式的ESLint、TypeScript、Babel配置</li>
<li>统一的CI/CD流水线，增强构建一致性</li>
</ul>
<h2 data-id="heading-13">五、Monorepo的挑战与应对策略</h2>
<h3 data-id="heading-14">1. <strong>仓库规模与性能问题</strong></h3>
<ul>
<li><strong>挑战</strong>：随着代码量增长，Git操作可能变慢</li>
<li><strong>解决方案</strong>：使用浅克隆、稀疏检出、Git LFS等技术优化</li>
</ul>
<h3 data-id="heading-15">2. <strong>权限控制精细化不足</strong></h3>
<ul>
<li><strong>挑战</strong>：缺乏项目粒度的代码访问控制</li>
<li><strong>解决方案</strong>：结合Git子模块、路径级权限控制工具</li>
</ul>
<h3 data-id="heading-16">3. <strong>构建时间可能较长</strong></h3>
<ul>
<li><strong>挑战</strong>：全量构建耗时增加</li>
<li><strong>解决方案</strong>：采用增量构建、远程缓存、并行执行（如Turborepo）</li>
</ul>
<h3 data-id="heading-17">4. <strong>团队协作复杂度</strong></h3>
<ul>
<li><strong>挑战</strong>：所有开发者都能看到整个代码库，可能增加误改风险</li>
<li><strong>解决方案</strong>：建立清晰的代码所有权文化、代码审查流程</li>
</ul>
<h2 data-id="heading-18">六、主流Monorepo工具对比（2024年）</h2>















































<table><thead><tr><th>工具</th><th>特点</th><th>适用场景</th><th>学习成本</th></tr></thead><tbody><tr><td><strong>pnpm + Workspaces</strong>​</td><td>快速、节省磁盘空间，生态逐渐丰富</td><td>中小型到大型项目</td><td>低</td></tr><tr><td><strong>Lerna</strong>​</td><td>历史较久，专注版本管理和发布流程</td><td>多package发布型项目</td><td>低</td></tr><tr><td><strong>Turborepo</strong>​</td><td>高性能构建缓存，由Vercel推出</td><td>大型项目，注重构建性能</td><td>中</td></tr><tr><td><strong>Nx</strong>​</td><td>功能强大，支持任务调度、可视化依赖图</td><td>中大型，尤其是TS/React项目</td><td>中高</td></tr><tr><td><strong>Rush</strong>​</td><td>微软出品，功能全面但配置复杂</td><td>企业级大型Monorepo</td><td>高</td></tr><tr><td><strong>Yarn/NPM Workspaces</strong>​</td><td>内置工作区支持，与包管理器深度集成</td><td>基础Monorepo需求</td><td>低</td></tr></tbody></table>
<p><strong>选型建议</strong>：</p>
<ul>
<li>新手或中小团队：从<strong>pnpm + workspaces</strong>或<strong>Turborepo/Nx</strong>开始</li>
<li>大型企业级项目：考虑<strong>Rush</strong>或<strong>Nx</strong>的完整解决方案</li>
<li>注重构建性能：<strong>Turborepo</strong>的缓存机制优势明显</li>
</ul>
<h2 data-id="heading-19">七、Monorepo的典型项目结构</h2>
<pre><code class="hljs language-bash" lang="bash">project-root/
├── package.json              <span class="hljs-comment"># 根目录配置</span>
├── pnpm-workspace.yaml       <span class="hljs-comment"># pnpm工作区配置（或其他工具配置）</span>
├── packages/                 <span class="hljs-comment"># 共享包目录</span>
│   ├── ui/                  <span class="hljs-comment"># 共享UI组件库</span>
│   ├── core/                <span class="hljs-comment"># 业务核心逻辑</span>
│   └── utils/               <span class="hljs-comment"># 工具函数库</span>
├── apps/                    <span class="hljs-comment"># 应用目录</span>
│   ├── web/                 <span class="hljs-comment"># Web应用入口</span>
│   ├── mobile/              <span class="hljs-comment"># 移动端应用</span>
│   └── admin/               <span class="hljs-comment"># 管理后台</span>
├── configs/                 <span class="hljs-comment"># 统一配置文件</span>
├── scripts/                 <span class="hljs-comment"># 共享脚本</span>
└── .github/workflows/       <span class="hljs-comment"># CI/CD配置</span>
</code></pre>
<p>具体怎么搭建 monorepo 项目可以看我的另外一篇文章：<a href="https://juejin.cn/post/7583970267132821510" target="_blank" title="https://juejin.cn/post/7583970267132821510">juejin.cn/post/758397…</a></p>
<h2 data-id="heading-20">八、Monorepo的适用场景</h2>
<h3 data-id="heading-21">1. <strong>大型团队协作项目</strong></h3>
<ul>
<li>多个相关项目需要紧密协作和代码共享</li>
<li>团队成员需要频繁访问和修改跨项目代码</li>
</ul>
<h3 data-id="heading-22">2. <strong>微服务架构</strong></h3>
<ul>
<li>系统由多个小型、独立服务组成</li>
<li>需要确保服务之间的兼容性，简化跨服务重构</li>
</ul>
<h3 data-id="heading-23">3. <strong>多平台/多产品开发</strong></h3>
<ul>
<li>公司同时开发Web、iOS、Android等多个平台应用</li>
<li>需要共享通用库、组件和工具</li>
</ul>
<h3 data-id="heading-24">4. <strong>共享库和组件开发</strong></h3>
<ul>
<li>开发涉及多个共享库或可重用组件的项目</li>
<li>需要频繁更新和维护这些共享资源</li>
</ul>
<h3 data-id="heading-25">5. <strong>开源项目生态</strong></h3>
<ul>
<li>如Vue 3、React等大型开源项目采用Monorepo管理核心库和周边工具</li>
</ul>
<h2 data-id="heading-26">九、实施Monorepo的最佳实践</h2>
<h3 data-id="heading-27">1. <strong>渐进式迁移</strong></h3>
<ul>
<li>不要一次性将所有项目迁移到Monorepo</li>
<li>可以先从关联最紧密的几个项目开始试点</li>
</ul>
<h3 data-id="heading-28">2. <strong>清晰的代码组织</strong></h3>
<ul>
<li>按照功能域或业务边界划分目录结构</li>
<li>保持模块间接口的清晰定义</li>
</ul>
<h3 data-id="heading-29">3. <strong>自动化工具链</strong></h3>
<ul>
<li>配置统一的代码格式化、linting和测试工具</li>
<li>建立自动化的版本发布和变更日志生成流程</li>
</ul>
<h3 data-id="heading-30">4. <strong>性能监控与优化</strong></h3>
<ul>
<li>监控构建时间和仓库操作性能</li>
<li>定期评估和优化工具配置</li>
</ul>
<h3 data-id="heading-31">5. <strong>团队培训与文化</strong></h3>
<ul>
<li>培训团队成员掌握Monorepo工作流程</li>
<li>建立代码所有权和协作文化</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 AI 输出的重复解析：正常 markdown 解析渲染也能提速 2-10 倍以上]]></title>    <link>https://juejin.cn/post/7583991680749273115</link>    <guid>https://juejin.cn/post/7583991680749273115</guid>    <pubDate>2025-12-16T02:54:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583991680749273115" data-draft-id="7583952017674371123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 AI 输出的重复解析：正常 markdown 解析渲染也能提速 2-10 倍以上"/> <meta itemprop="keywords" content="前端,JavaScript,AI编程"/> <meta itemprop="datePublished" content="2025-12-16T02:54:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="king王一帅"/> <meta itemprop="url" content="https://juejin.cn/user/395479917018408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 AI 输出的重复解析：正常 markdown 解析渲染也能提速 2-10 倍以上
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479917018408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    king王一帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:54:22.000Z" title="Tue Dec 16 2025 02:54:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">incremark 的惊人实力</h2>
<p>昨天发布了周日开发的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-docs.vercel.app%2F" target="_blank" title="https://incremark-docs.vercel.app/" ref="nofollow noopener noreferrer">incremark</a>，没想到实际体验性能远超预期，本想作为自己产品内部的一个小工具，但想了想，开源未尝不是一个好的方向。</p>
<p>先看结果：普通比较短的 markdown 在线测试结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62954344ec504b44b8e95a92f788605a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2luZ-eOi-S4gOW4hQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458461&amp;x-signature=PhcKLn%2FO2R94itVAX77pSIPNJa8%3D" alt="image.png" loading="lazy"/></p>
<p>稍长的 markdown 在线测试结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b565e7980b5f4715b48b689d99ad13db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2luZ-eOi-S4gOW4hQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458461&amp;x-signature=5RxpaO%2ByidGfeqZwSIoStd76B38%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>说明：网站每次 benchmark 测试每次提升倍数可能不一样，这是由于分块策略导致的，demo 页面每次分块的 markdown 字符串长度是随机的 <code>const chunks = content.match(/[\s\S]{1,20}/g) || []</code>，分块会影响稳定块的生成，这样也更符合真实场景，某个块可能会有上一个块的内容跟下一个块的内容。但无论怎样分，性能提升是必然的，demo 网站未通过迎合自身利益的手段进行 chunk 拆分。</p>
</blockquote>
<p>vue demo 在线链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-vue.vercel.app%2F" target="_blank" title="https://incremark-vue.vercel.app/" ref="nofollow noopener noreferrer">incremark-vue.vercel.app/</a></p>
<p>react demo 在线链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-react.vercel.app%2F" target="_blank" title="https://incremark-react.vercel.app/" ref="nofollow noopener noreferrer">incremark-react.vercel.app/</a></p>
<p>文档链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fincremark-docs.vercel.app%2F" target="_blank" title="https://incremark-docs.vercel.app/" ref="nofollow noopener noreferrer">incremark-docs.vercel.app/</a></p>
<p>超长的 markdown 输出会来更更加离谱的速度，20k 的 markdown benchmark 可以达到恐怖的 46 倍速度提升。</p>
<h2 data-id="heading-1">为什么它会有如此提升？</h2>
<h3 data-id="heading-2">传统解析方案弊端</h3>
<p>做过 AI 聊天应用的人可能都知道，AI 的流式输出在前端每次获取到的都是一个个简短的 chunk,每次 chunk 过来后，都需要将完整的 markdown 字符串喂给 markdown 解析器，可能是 remark、 markedjs，也可能是 markdown-it。它们每次都需要将所有的 markdown 进行解析，最后在进行渲染，在此过程中会有一部分性能浪费，即已经稳定渲染的块也要被重复解析。</p>
<p>vue-stream-markdown 这类型工具在渲染层也做了努力，将稳定的 token 渲染为稳定的组件，每次只更新不稳定的组件，以此达到渲染层的平滑流式输出。</p>
<p>但、这仍无法解决性能浪费的本质问题，也就是 markdown 文本的重复解析，这一步才是吃掉 cpu 性能的怪兽，输出文档越长，则性能浪费越高。</p>
<h3 data-id="heading-3">incremark 核心性能优化原理</h3>
<p>incremark 除了做到了 UI 渲染层的组件复用平滑更新，最主要的是在 markdown 解析上做了文档，只解析不稳定的 markdown，不再重复解析稳定的块。因此将解析性能从 O(n²) 拉到了 O(n)，理论上输出越长，提升越多。</p>
<h4 data-id="heading-4">1. 增量解析：从 O(n²) 到 O(n)</h4>
<p>传统解析器每次都重新解析整个文档，导致解析量呈平方增长。Incremark 的 <code>IncremarkParser</code> 类采用增量解析策略，见代码 <code>IncremarkParser.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 设计思路：</span>
<span class="hljs-comment">// 1. 维护一个文本缓冲区，接收流式输入 </span>
<span class="hljs-comment">// 2. 识别"稳定边界"，将已完成的块标记为 completed </span>
<span class="hljs-comment">// 3. 对于正在接收的块，每次重新解析，但只解析该块的内容 </span>
<span class="hljs-comment">// 4. 复杂嵌套节点作为整体处理，直到确认完成</span>
</code></pre>
<h4 data-id="heading-5">2. 智能边界检测机制</h4>
<p><code>append</code> 方法中的 <code>findStableBoundary()</code> 是关键优化点</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">append</span>(<span class="hljs-attr">chunk</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">IncrementalUpdate</span> {  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> += chunk  
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateLines</span>()  
    
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">line</span>: stableBoundary, contextAtLine } = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findStableBoundary</span>()  
    
  <span class="hljs-keyword">if</span> (stableBoundary &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingStartLine</span> &amp;&amp; stableBoundary &gt;= <span class="hljs-number">0</span>) {  
    <span class="hljs-comment">// 只解析新完成的块，不重复解析已完成内容  </span>
    <span class="hljs-keyword">const</span> stableText = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lines</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pendingStartLine</span>, stableBoundary + <span class="hljs-number">1</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>)  
    <span class="hljs-keyword">const</span> ast = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parse</span>(stableText)  
    <span class="hljs-comment">// ...  </span>
  }  
}
</code></pre>
<h4 data-id="heading-6">3. 状态管理避免重复计算</h4>
<p>解析器维护多个关键状态来避免重复工作</p>
<ul>
<li><code>buffer</code>: 累积的未解析内容</li>
<li><code>completedBlocks</code>: 已完成且永不重新解析的块数组</li>
<li><code>lineOffsets</code>: 行偏移量前缀和，支持 O(1) 行位置计算</li>
<li><code>context</code>: 跟踪代码块、列表等嵌套状态</li>
</ul>
<h4 data-id="heading-7">4. 增量行更新优化</h4>
<p><code>updateLines()</code> 方法只处理新增内容，避免全量 split 操作</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">private</span> <span class="hljs-title function_">updateLines</span>(): <span class="hljs-built_in">void</span> {  
  <span class="hljs-comment">// 找到最后一个不完整的行（可能被新 chunk 续上）  </span>
  <span class="hljs-keyword">const</span> lastLineStart = <span class="hljs-variable language_">this</span>.<span class="hljs-property">lineOffsets</span>[prevLineCount - <span class="hljs-number">1</span>]  
  <span class="hljs-keyword">const</span> textFromLastLine = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(lastLineStart)  
    
  <span class="hljs-comment">// 重新 split 最后一行及之后的内容  </span>
  <span class="hljs-keyword">const</span> newLines = textFromLastLine.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)  
  <span class="hljs-comment">// 只更新变化的部分  </span>
}
</code></pre>
<h3 data-id="heading-8">性能对比数据</h3>
<p>这种设计在实际测试中表现优异 ：</p>





























<table><thead><tr><th>文档大小</th><th>传统解析字符量</th><th>Incremark 解析字符量</th><th>减少比例</th></tr></thead><tbody><tr><td>1KB</td><td>1,010,000</td><td>20,000</td><td>98%</td></tr><tr><td>5KB</td><td>25,050,000</td><td>100,000</td><td>99.6%</td></tr><tr><td>20KB</td><td>400,200,000</td><td>400,000</td><td>99.9%</td></tr></tbody></table>
<h3 data-id="heading-9">关键不变量</h3>
<p>Incremark 的性能优势源于一个关键不变量：<strong>一旦块被标记为 completed，就永远不会被重新解析</strong>。这确保了每个字符最多只被解析一次，实现了 O(n) 的时间复杂度。</p>
<h2 data-id="heading-10">小结</h2>
<p>昨天在掘金发布了 <a href="https://juejin.cn/post/7583906846986469422" target="_blank" title="https://juejin.cn/post/7583906846986469422"># AI 时代真正流式解析+渲染双重优化的 Incremark</a> 并没有获得推流，在 V 站随意发帖下，github 意外收获了 35 颗 star，npm 收获 92 下载量，突然感觉它似乎应该是能对一些小伙伴产生作用的，所以尝试当个事来做，如果你也感兴趣，欢迎试用以及代码贡献。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎙️ 2025 年主流 AI 语音输入工具测评：解锁高效生产力的关键]]></title>    <link>https://juejin.cn/post/7583943503556689970</link>    <guid>https://juejin.cn/post/7583943503556689970</guid>    <pubDate>2025-12-16T02:21:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556689970" data-draft-id="7583991680748781595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎙️ 2025 年主流 AI 语音输入工具测评：解锁高效生产力的关键"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-16T02:21:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一点一木"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986187486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎙️ 2025 年主流 AI 语音输入工具测评：解锁高效生产力的关键
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986187486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一点一木
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:21:30.000Z" title="Tue Dec 16 2025 02:21:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">引言：当「说话」成为新的生产力</h3>
<p>在 <strong><code>AI</code>大模型</strong>技术的推动下，2025 年的语音输入工具已从单纯的语音转文字，进化为集成了<strong>语音理解、智能润色、多语种混合</strong>的综合创作平台。它们不仅能准确转写，更深度融入了办公、创作、开发等专业工作流。本次测评，我们聚焦四款最具代表性的主流产品：<strong><code>LazyTyper</code></strong> <strong>、</strong> <strong><code>Wispr Flow Pro</code></strong> <strong>、豆包语音输入法、智谱小凹输入法</strong>，从识别准确率、智能化程度、应用场景适配等多个维度进行深度对比，助您解锁高效生产力的关键。</p>
<hr/>
<h3 data-id="heading-1">一、核心技术与功能对比概览</h3>
<p>以下表格总结了四款工具在技术路线和核心功能上的差异，帮助读者一目了然地理解它们的产品定位。</p>






















































<table><thead><tr><th>特性 / 产品</th><th><code>LazyTyper</code></th><th><code>Wispr Flow Pro</code></th><th>豆包语音输入法</th><th>智谱小凹输入法</th></tr></thead><tbody><tr><td>核心技术定位</td><td>多模型集成与定制化</td><td>跨平台与语音命令编辑</td><td>极致速度与用户体验</td><td>大模型润色与风格转换</td></tr><tr><td>语音模型数量</td><td>12 个（含 <code>ElevenLabs</code>，<code>Groq</code>，通义千问等）</td><td>专有高精度模型</td><td>抖音/字节专有模型</td><td>智谱 <code>AI</code> (<code>GLM</code>) 大模型</td></tr><tr><td>离线能力</td><td>5 个本地离线模型</td><td>未明确</td><td>未明确</td><td>未明确</td></tr><tr><td>高级编辑功能</td><td><code>AI</code> 润色、自定义词汇表</td><td>命令模式编辑、个性化短语</td><td>智能标点、上下文联想</td><td>多风格表达、深度 <code>AI</code> 润色</td></tr><tr><td>多语言支持</td><td>中英日混输</td><td>中英混合</td><td>高精度中文识别</td><td>高精度中文识别</td></tr><tr><td>目标用户</td><td>开发者、高阶创作者、效率专家</td><td>跨平台工作者、程序员、邮件办公</td><td>大众用户、追求极速输入者</td><td>专业写作、追求成稿质量者</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-2">二、产品特点与技术能力深度解析</h3>
<h4 data-id="heading-3">1. <code>LazyTyper</code>：技术灵活与高阶定制的首选</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dca53d6a6556423fb0ef7d30565d2555~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=H032Zgv0KwROdXgTgZ6FifZbP8I%3D" alt="" loading="lazy"/></p>
<p><code>LazyTyper</code> 的核心竞争力在于其<strong>技术集成度高</strong>和<strong>使用模式灵活</strong>。它集成了包括 <code>Groq Whisper</code>、通义千问 <code>ASR</code> 在内的 <strong>12 个专业语音模型</strong>，使用户可以根据当前任务一键切换引擎。</p>
<ul>
<li><strong>模型</strong> <strong>自由度</strong> <strong>与隐私：</strong> 内含 <strong>5 个本地离线模型</strong>，确保在无网络环境下稳定运行，同时保障高度的数据隐私性。</li>
<li><strong>专业场景适配：</strong> 针对性地支持<strong>中英日混输</strong>以及<strong>动口说代码</strong>的能力，是技术开发和深度内容创作领域的有力工具。</li>
<li><strong>产品战略</strong>：<code>LazyTyper</code> 专注于桌面端的办公效率场景，暂无移动端版本计划。</li>
<li><strong>性价比：</strong> <strong>永久免费无广告</strong>的模式，配合强大的专业功能，提供了极高的性价比。</li>
</ul>
<h4 data-id="heading-4">2. <code>Wispr Flow Pro</code>：跨平台无缝流转的专家</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ab7801e895f41febda2d40decf19a5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=KC5saaPy8Kum0gUATIfGrme2MKU%3D" alt="" loading="lazy"/></p>
<p><code>Wispr Flow Pro</code> 定位为「跨平台、跨应用的 <code>AI</code> 语音输入法」，解决了许多用户在不同软件间切换的痛点。</p>
<ul>
<li><strong>跨</strong> <strong><code>App</code></strong> <strong>核心优势：</strong> 其设计初衷即是在<strong>任何输入框</strong>（如微信、<code>Notion</code>、代码编辑器）中实现快速输入，极大地拓宽了语音输入的使用边界。</li>
<li><strong>高级命令编辑：</strong> <code>Pro</code> 版本支持<strong>语音</strong> <strong>指令</strong> <strong>实时编辑和格式调整</strong>（例如：「加一个要点」、「删除上一句」），这在长篇写作或编程修改中效率极高。</li>
<li><strong>高精度与润色：</strong> 强调高精度识别，<strong>默认开启云端自动润色</strong>，智能纠正语法和标点，甚至能理解语意，保障输出的<strong>文档结构和专业性</strong>。此外，还具备<strong>耳语模式</strong>以适应安静或公共环境。</li>
</ul>
<h4 data-id="heading-5">3. <a href="https://link.juejin.cn?target=https%3A%2F%2Fshurufa.doubao.com%2F" target="_blank" title="https://shurufa.doubao.com/" ref="nofollow noopener noreferrer">豆包语音输入法</a>：大众市场与极致速度体验</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9f980a3a64d421fb8da8ef39123b37e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=k9YBEqBcxIpww6%2F6OTRLyDd9X2w%3D" alt="" loading="lazy"/></p>
<p>豆包语音输入法聚焦于<strong>基础体验的极致优化</strong>，是移动端和日常中文输入的佼佼者。</p>
<ul>
<li><strong>速度与准确性：</strong> 强调「语音输入又快又准」，尤其是其对<strong>标点的自动处理</strong>能力——「标点无需改」，极大减少了后期编辑工作。</li>
<li><strong>环境适应性：</strong> 具备「轻声照样说」的能力，增强了在公共场合的实用性。</li>
<li><strong>操作流程简化：</strong> 「按住说话，松手结束」的交互逻辑，非常符合移动端用户的使用习惯，实现了语音输入的<strong>无痕化</strong>。</li>
</ul>
<h4 data-id="heading-6">4. <a href="https://link.juejin.cn?target=https%3A%2F%2Fautoglm.zhipuai.cn%2Fautotyper%2F" target="_blank" title="https://autoglm.zhipuai.cn/autotyper/" ref="nofollow noopener noreferrer">智谱小凹输入法(AutoGLM)</a>：大模型赋能与内容成稿</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/416ac6b0c8874176b4acd9f0086714ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456579&amp;x-signature=12cspM5cNjfqWAQwx9%2FNEdQwaY8%3D" alt="" loading="lazy"/></p>
<p>智谱小凹输入法由国内领先的智谱 <code>AI</code> 大模型技术驱动，其核心价值在于<strong>从语音到成文的智能转化</strong>。</p>
<ul>
<li><strong><code>AI</code></strong> <strong>深度赋能：</strong> 凭借其背后的 <code>GLM</code> 大模型，它专注于<strong>自动润色成稿</strong>。用户可以说出思路碎片，由 <code>AI</code> 自动组织、优化为流畅的文本。</li>
<li><strong>多风格表达转换：</strong> 这是其独特优势，能将一段语音内容转换为邮件、会议纪要或代码注释等<strong>不同风格</strong>的文体，极大地提升了职业场景下的创作效率。</li>
<li><strong>性能指标：</strong> 官方数据宣称语音识别准确率高达 <strong>97.8%</strong> ，显示了其在中文书面语转换上的强劲实力。</li>
</ul>
<hr/>
<h3 data-id="heading-7">三、实战场景测试与性能表现</h3>
<h4 data-id="heading-8">1. 识别准确率实测（普通话标准发音）</h4>








































<table><thead><tr><th>测试场景</th><th><code>LazyTyper</code></th><th><code>Wispr Flow Pro</code></th><th>豆包语音输入法</th><th>智谱小凹输入法</th></tr></thead><tbody><tr><td>纯中文新闻稿</td><td><strong>97.70%</strong></td><td>93.80%</td><td><strong>95.40%</strong></td><td>94.10%</td></tr><tr><td>中英混合技术文档</td><td><strong>93.50%</strong></td><td>93.20%</td><td>87.60%</td><td>89.30%</td></tr><tr><td>快速口语对话</td><td>92.10%</td><td>91.50%</td><td><strong>93.80%</strong></td><td>90.20%</td></tr><tr><td>专业术语识别</td><td>93.00%</td><td>92.60%</td><td>85.30%</td><td>88.90%</td></tr></tbody></table>
<blockquote>
<p><strong>关键发现：</strong> 豆包语音输入法在纯中文和快速口语场景表现最佳。<code>LazyTyper</code> 在切换到高性能在线模型（如豆包、通义千问）后，其中英混合和专业术语识别能力显著提升，与 <code>Wispr Flow Pro</code> 处于第一梯队竞争。</p>
</blockquote>
<h4 data-id="heading-9">2. 核心工作场景测试</h4>



































<table><thead><tr><th>场景</th><th>测试内容/需求</th><th>最佳表现产品</th><th>性能总结</th></tr></thead><tbody><tr><td>技术文档编写</td><td>语音输入 <code>API</code> 接口文档（含代码和技术术语）</td><td><code>Wispr Flow Pro</code></td><td>准确率高达 97%，开启自动润色后完美保留代码结构和技术术语。<code>LazyTyper</code> 在切换模型后性能接近。</td></tr><tr><td>跨语种会议记录</td><td>中英日混合的跨国团队会议</td><td><code>LazyTyper</code></td><td>得益于集成 <code>Soniox</code>/通义千问等模型，多语言支持最全面，三语切换流畅。<code>Wispr Flow Pro</code> 在中英混合上表现优秀。</td></tr><tr><td>移动端快速回复</td><td>微信聊天和邮件快速回复</td><td>豆包语音输入法</td><td>移动端体验最佳，响应迅速。智谱小凹的润色功能提升了回复的专业性。</td></tr><tr><td>高质量文案创作</td><td>口述思路并要求转换为正式文稿</td><td>智谱小凹输入法</td><td>深度 <code>AI</code> 润色和多风格转换能力，使转录文本的可读性和规范性最高。<code>LazyTyper</code> 可通过集成 <code>GPT/Kimi</code> 等模型实现高级润色</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">四、用户体验、生态与商业模式</h3>
<h4 data-id="heading-11">1. 平台支持与兼容性</h4>








































<table><thead><tr><th>平台</th><th><code>LazyTyper</code></th><th><code>Wispr Flow Pro</code></th><th>豆包语音输入法</th><th>智谱小凹输入法</th></tr></thead><tbody><tr><td>Windows</td><td>✅</td><td>✅</td><td>规划中</td><td>✅</td></tr><tr><td>macOS</td><td>✅</td><td>✅</td><td>规划中</td><td>✅</td></tr><tr><td>Linux</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr><tr><td>移动端</td><td>战略聚焦桌面</td><td>✅</td><td>✅</td><td>❌</td></tr></tbody></table>
<blockquote>
<p><strong>关键发现：</strong> <code>LazyTyper</code> <strong>明确其产品战略是聚焦桌面端的办公效率场景</strong>。因此，在 <code>PC</code> 办公领域，四款工具均有布局，而 <strong>豆包语音输入法</strong>和**<code>Wispr Flow Pro</code>**在移动端实现了全面覆盖。</p>
</blockquote>
<h4 data-id="heading-12">2. 商业模式与成本效益</h4>



































<table><thead><tr><th>产品</th><th>免费版本</th><th>个人专业版</th><th>核心价值主张</th></tr></thead><tbody><tr><td><code>LazyTyper</code></td><td>功能完整免费</td><td>无</td><td>自由、隐私、无绑定，极致性价比</td></tr><tr><td><code>Wispr Flow Pro</code></td><td>基础功能试用</td><td>15刀/月或 144刀/年</td><td>专业效率工具投资，无限制使用</td></tr><tr><td>豆包语音输入法</td><td>完全免费</td><td>无独立版本</td><td>生态入口与用户体验，零成本入门</td></tr><tr><td>智谱小凹输入法</td><td>基础功能免费</td><td>分享得免费时长</td><td><code>AI</code> 写作效率提升，内容质量保障</td></tr></tbody></table>
<blockquote>
<p><strong>成本效益分析</strong> <strong>：</strong> 对于追求零成本和极致性价比的用户，<strong><code>LazyTyper</code></strong> 和<strong>豆包语音输入法</strong>是首选。对于愿意为专业工具付费的效率追求者，<strong><code>Wispr Flow Pro</code></strong> 提供了更高的功能上限。</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">五、综合评价与最终选择建议</h3>
<ol>
<li>
<h4 data-id="heading-14">产品力总评</h4>
</li>
</ol>
<ul>
<li><strong><code>Wispr Flow Pro</code></strong> <strong>：⭐⭐⭐⭐⭐</strong> (优势：专业功能全面、跨平台体验、<strong>云端润色强大</strong>。不足：价格较高，学习曲线稍陡。)</li>
<li><strong><code>LazyTyper</code></strong> <strong>：⭐⭐⭐⭐⭐</strong> (优势：模型自由度、隐私保护、完全免费，<strong>顶级中文/混输性能</strong>。不足：<strong>无移动端版本</strong>，界面较简单。)</li>
<li><strong>豆包语音输入法：⭐⭐⭐⭐</strong> (优势：中文体验最佳、生态整合、完全免费。不足：专业功能有限、英文能力一般。)</li>
<li><strong>智谱小凹输入法：⭐⭐⭐⭐</strong> (优势：<code>AI</code> 写作辅助强、文本质量高、多风格支持。不足：响应速度一般，专业术语识别待加强。)</li>
</ul>
<ol start="2">
<li>
<h4 data-id="heading-15">2025 年选购决策矩阵</h4>
</li>
</ol>
<p>没有绝对的最好，只有最合适。您的选择应基于<strong>功能优先级</strong>和<strong>主要使用场景</strong>。</p>






























<table><thead><tr><th>您的功能/场景优先级</th><th>推荐产品</th><th>核心理由</th></tr></thead><tbody><tr><td>首要：技术开发、隐私保护、离线使用</td><td><code>LazyTyper</code></td><td>顶级多模型集成、5 离线模型，适配高阶专业需求。</td></tr><tr><td>首要：跨应用办公、频繁使用语音命令</td><td><code>Wispr Flow Pro</code></td><td>跨 <code>App</code> 无缝支持，语音命令编辑功能强大，文档结构优化出色。</td></tr><tr><td>首要：高效率日常输入、移动端体验</td><td>豆包语音输入法</td><td>极致的速度与准确率，操作流程极简，适合大众和移动端。</td></tr><tr><td>首要：专业写作、内容润色成稿、文体转换</td><td>智谱小凹输入法</td><td>智谱 <code>AI</code> 大模型驱动，强调说话即成文，实现高质量创作。</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-16">六、未来发展趋势与结论</h3>
<p>2025 年的 <code>AI</code> 语音输入市场呈现明显的差异化竞争态势。随着 <code>AI</code> 技术的持续进步，未来语音输入工具将朝着<strong>多模态融合、个性化适应、垂直领域深化</strong>等方向发展。</p>
<p>给各厂商的建议也反映了其产品短板：<code>LazyTyper</code> 急需移动端版本；<code>Wispr Flow Pro</code> 需要降低入门门槛；豆包语音输入法应增强专业功能；智谱小凹输入法则需提高响应速度。</p>
<p><strong>结论：</strong> 对于多数用户，可以先用免费产品（<code>LazyTyper</code> 或豆包语音）入门，体验其核心优势，再根据实际需求和付费预算，考虑是否升级到提供专业功能和跨平台支持的工具（<code>Wispr Flow Pro</code> 或智谱小凹输入法）。最终目标是实现<strong>所想即所得</strong>的自然交互体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust 1.92.0 发布：为 Never 类型铺路，强化调试与安全性]]></title>    <link>https://juejin.cn/post/7583948178858950702</link>    <guid>https://juejin.cn/post/7583948178858950702</guid>    <pubDate>2025-12-16T02:57:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858950702" data-draft-id="7583667970737176576" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust 1.92.0 发布：为 Never 类型铺路，强化调试与安全性"/> <meta itemprop="keywords" content="Rust,编程语言,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:57:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RustCoder"/> <meta itemprop="url" content="https://juejin.cn/user/1926000099227592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust 1.92.0 发布：为 Never 类型铺路，强化调试与安全性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1926000099227592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RustCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:57:53.000Z" title="Tue Dec 16 2025 02:57:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>Rust 1.92.0 稳定版已正式发布。这个版本并没有带来重大变化和主要新功能，而是一个较为保守的版本，它只是巧妙地调整和优化了语言规范和编译器工具链等。其中最引人注目的是为最终稳定化“Never Type”所做的准备，改善了对Linux平台调试体验，以及完善文档与调试能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/266b676cce534fed8a176b6023bb62e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUnVzdENvZGVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458724&amp;x-signature=%2Bd5i%2Bs2cqngfNoXbSfvn6g2ji68%3D" alt="图像" loading="lazy"/></p>
<p>下面介绍一下 Rust 1.92.0 的主要内容：涉及语言核心、编译器和标准库层面的一系列更新。</p>
<h2 data-id="heading-0">语言特性与编译器更新</h2>
<p><strong>1、语言核心：向 Never 类型的最终稳定化迈进</strong></p>
<p>语言和编译器团队继续推进 Never 类型的稳定化工作。为了推进Never类型（ <code>!</code> ）（表示永远不会返回的类型）的最终稳定化，在此版本中，编译器团队将 <code>never_type_fallback_flowing_into_unsafe</code> 和 <code>dependency_on_unit_never_type_fallback</code> 这两个相关的未来兼容性提示（lint）提升为 <strong>Deny-by-default</strong>（默认为拒绝） 级别。当编译器检测到可能因 Never 类型类型回退规则变化而受损的代码时，这两个lint 将触发<strong>编译错误</strong>，而非警告，这显然是编译器团队有意让开发者更加关注 Never 类型而做出的做铺垫工作（不过，铺垫归铺垫，因为 <code>never</code>！这个关键字起得太过玄学，难怪网友调侃：我们都知道“永不”类型的真正稳定日期😉）。</p>
<p>不过此更改仅在直接构建受影响的 crate 时生效；如果这些 crate 是作为依赖项被构建，则不会触发错误。虽然开发者可以通过 <code>#[allow(...)]</code> 属性暂时绕过这些错误，但官方强烈建议修复被报告的问题。</p>
<p>此外，<code>unused_must_use</code> lint 变得更加智能。对于返回类型为 <code>Result&lt;(), !&gt;</code> 或 <code>ControlFlow&lt;!, ()&gt;</code> 的函数，该lint将不再发出“未使用必须使用的值”的警告。</p>
<p><strong>2、编译器方面：Linux 下 <code>panic=abort</code> 问题修复</strong></p>
<p>在编译器方面，Rust 1.92.0 解决了一个长期影响Linux开发者调试体验的问题。</p>
<p>过去，当使用 <code>-C panic=abort</code> 编译选项（即在panic 时直接终止程序而非展开）时，<strong>编译器默认不会生成展开表（unwind tables）</strong> ，这导致无法获取有意义的栈回溯信息（backtrace）。</p>
<p>从这个版本开始，即使在Linux上使用 <code>-C panic=abort</code>，编译器也会默认生成展开表（unwind tables）。这意味着程序异常（panic ）终止时，开发者能够获得准确的函数调用栈信息（backtrace），极大地便利了线上问题的调试和诊断。</p>
<p>当然，如果出于极致的二进制体积优化考虑，开发者仍可以通过 <code>-C force-unwind-tables=no</code> 选项显式关闭此功能。</p>
<p><strong>3、宏导出参数校验</strong>：</p>
<p>对 <code>#[macro_export]</code> 属性的参数输入进行了更严格的校验，<code>invalid_macro_export_arguments</code> lint 现在默认拒绝（deny）。</p>
<p><strong>4、Lint 改进</strong>：</p>
<p><code>unused_must_use</code> lint 现在更加智能，不再对返回<code>Result&lt;(), Uninhabited&gt;</code>（例如 <code>Result&lt;(), !&gt;</code>）的函数发出警告，因为这种情况下错误分支在逻辑上是不可能发生的。</p>
<h2 data-id="heading-1">标准库：实用的新API与零开销抽象</h2>
<p>Rust 1.92.0 在标准库中稳定了一批新的API，涵盖了内存操作、并发控制和数据结构等多个方面。</p>
<p><strong>零初始化智能指针：</strong> 这是本次更新的一个亮点。新增的 <code>Box::new_zeroed</code>、<code>Box::new_zeroed_slice</code> 以及对应的 <code>Rc</code> 和 <code>Arc</code> 版本，允许开发者直接创建内存内容为零的智能指针。</p>
<p>这在处理需要清零内存的FFI（外部函数接口）交互或对安全性有极高要求的场景中非常有用。</p>
<p><strong>在并发编程方面：</strong><code>RwLockWriteGuard::downgrade</code> 方法现已稳定。它允许开发者将一个写锁“降级”为一个读锁，而无需先释放写锁再竞争读锁。</p>
<p>这个原子性操作对于需要先修改数据、再以只读方式长时间持有访问权的场景至关重要，能有效避免不必要的锁竞争。</p>
<p>其它值得关注的稳定API还包括：</p>
<ul>
<li><code>NonZero&lt;uN&gt;::div_ceil</code>：对非零整数进行向上取整的除法。</li>
<li><code>Location::file_as_c_str</code>：获取当前源代码文件名的C字符串表示，便于与C语言交互。</li>
<li><code>BTreeMap</code> 的入口API扩展：如 <code>btree_map::Entry::insert_entry</code>。</li>
<li>为 <code>proc_macro::TokenStream</code> 实现了对 <code>Group</code>、<code>Literal</code> 等类型的 <code>Extend</code> trait，增强了过程宏编写的灵活性。</li>
</ul>
<p>此外，切片的 <code>rotate_left</code> 和 <code>rotate_right</code> 方法现在可以在常量上下文（const context）中使用了。</p>
<h2 data-id="heading-2">工具链 ：更智能的文档搜索与构建指南</h2>
<p>Rust 的工具链(Rustdoc &amp; Cargo)在此版本中也获得了实用性改进。</p>
<p><strong>Rustdoc（文档工具）的搜索功能</strong> 变得更加智能和友好。</p>
<ul>
<li><strong>搜索结果去重</strong>：当搜索结果中包含某个trait定义的方法时，Rustdoc会自动隐藏那些具体实现该trait的类型中的同名方法。例如，搜索“last”将主要显示 <code>Iterator::last</code>，而不会用各个迭代器实现的 <code>last</code> 方法刷屏，使得像 <code>BTreeSet::last</code> 这样的固有方法更容易被找到。</li>
<li><strong>放宽搜索词限制</strong>：现在可以搜索不完全符合Rust标识符规则的词（例如以数字开头的词条），从而提升了搜索体验。</li>
</ul>
<p>Cargo 新增了关于  <strong>“构建性能优化”的官方文档章节</strong>。这对于想要加快项目编译速度的开发者而言，是一个很实用的参考。</p>
<h2 data-id="heading-3">Rust 版本升级指南</h2>
<p>升级到 Rust 1.92.0 非常简单，只需在终端执行以下命令：</p>
<pre><code class="hljs language-shell" lang="shell">rustup update stable
</code></pre>
<p>对于实际项目，建议先在持续集成（CI）环境中测试升级，确保新的默认拒绝 lint（如 <code>invalid_macro_export_arguments</code>）不会中断构建。根据官方说明，最低支持的LLVM版本已更新至20。</p>
<h2 data-id="heading-4"><strong>总结</strong></h2>
<p>Rust 1.92.0正式发布，核心改进包括 Never 类型稳定化准备、Linux下 panic 回溯修复，以及智能指针零初始化等标准库 API 落地等。</p>
<h2 data-id="heading-5"><strong>相关链接</strong></h2>
<ul>
<li>发布笔记：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.rust-lang.org%2F2025%2F12%2F11%2FRust-1.92.0" target="_blank" title="https://blog.rust-lang.org/2025/12/11/Rust-1.92.0" ref="nofollow noopener noreferrer">blog.rust-lang.org/2025/12/11/…</a></li>
<li>升级日志：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Freleases%2Ftag%2F1.92.0" target="_blank" title="https://github.com/rust-lang/rust/releases/tag/1.92.0" ref="nofollow noopener noreferrer">github.com/rust-lang/r…</a></li>
<li>变更日志：<a href="https://link.juejin.cn?target=https%3A%2F%2Freleases.rs%2Fdocs%2F1.92.0" target="_blank" title="https://releases.rs/docs/1.92.0" ref="nofollow noopener noreferrer">releases.rs/docs/1.92.0</a></li>
<li>版本草稿：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fissues%2F149161" target="_blank" title="https://github.com/rust-lang/rust/issues/149161" ref="nofollow noopener noreferrer">github.com/rust-lang/r…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型入门指南 - Training：小白也能看懂的“模型训练”全解析]]></title>    <link>https://juejin.cn/post/7583981974408314890</link>    <guid>https://juejin.cn/post/7583981974408314890</guid>    <pubDate>2025-12-16T02:59:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583981974408314890" data-draft-id="7582599972950294555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型入门指南 - Training：小白也能看懂的“模型训练”全解析"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-16T02:59:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型入门指南 - Training：小白也能看懂的“模型训练”全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:59:15.000Z" title="Tue Dec 16 2025 02:59:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>Training（模型训练）本质是AI世界的‘科学烹饪实验’——以数据为食材原料，用超参数作配方比例，借验证集做品控质检，将‘玄学炼丹’的试错过程，淬炼成‘可复现的精密工程’。今天用最通俗的话，带你拆解模型训练（Training）全过程。</p>
<p><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/975fe6089c554346b6eaedcf66e45c04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=VS4SjWaWnpSZYV4y6DxgrGpIFBw%3D" alt="" loading="lazy"/></strong></p>
<h2 data-id="heading-0"><strong><strong>一、概念解读</strong></strong></h2>
<p>Training（模型训练）到底是个啥？  模型训练是用数据喂AI，通过算法调参数，让它从‘瞎猜’到‘精准预测’的过程。</p>
<p>模型训练中的专业术语如下：</p>
<ul>
<li><strong><strong>数据（Data）：模型的课本+练习题，用于学习。类似学生通过刷题（训练数据）掌握知识点，通过模拟考（验证集）检验水平。</strong></strong></li>
<li><strong><strong>参数（Weights）：模型的大脑神经元连接强度，训练中不断调整。类似学生解题时调整解题思路（参数），使答案更接近标准答案（真实标签）。</strong></strong></li>
<li><strong><strong>损失函数（Loss）：衡量模型答案与真实答案的差距。类似学生答错题扣分（Loss升高），答对加分（Loss下降）。</strong></strong></li>
<li><strong><strong>优化器（Optimizer）：调整参数的学习方法，如梯度下降=查漏补缺。类似学生根据错题本（梯度）调整学习策略（参数），优先补薄弱科目（高Loss方向）。</strong></strong></li>
<li><strong><strong>正则化（Regularization）：防止AI死记硬背的记忆抑制器。类似学生做题时强制理解原理（L1/L2正则化），而非机械背诵。</strong></strong></li>
</ul>
<p>模型训练的本质是通过参数（解题思路）不断试错、用损失函数（扣分机制）量化差距、靠优化器（错题本复盘法）迭代策略、借正则化（防机械背诵规则）强化泛化，最终在验证集（模拟考）中交出高分答卷的过程。</p>
<p><strong><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/592001f992574632a6ebfd623f3c73b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=nIEPgCC5nP8lKZ%2FeKNCIVspNzgM%3D" alt="" loading="lazy"/></strong></strong></p>
<p><strong>为什么需要Training（模型训练）？</strong> 模型像一张白纸（随机初始化参数），无法完成任何任务，Training让模型逐步学会从输入到输出的<strong>正确映射，</strong> 让模型从‘文盲’变成‘学霸’。</p>
<ul>
<li><strong><strong>人类学习：通过「课本+练习题+考试」掌握知识。</strong></strong></li>
<li><strong><strong>模型训练：通过「数据+优化算法+验证集」调整参数，使模型输出接近真实答案。</strong></strong></li>
</ul>
<h5 data-id="heading-1"><strong>模型训练中的常见问题与解决方案如下：</strong></h5>
<ul>
<li><strong><strong>Loss不下降：模型学不会，像学生听天书。大概率是数据质量差、模型架构错误、学习率过大。这时候需要清洗数据、换模型、调小学习率。</strong></strong></li>
<li><strong><strong>过拟合：训练集满分，测试集翻车，像学生只背题库。大概率是数据量不足、模型复杂度过高。这时候需要增加数据、简化模型、加正则化。</strong></strong></li>
<li><strong><strong>训练速度慢：模型学得慢，像学生走神。大概率是Batch Size过大、硬件算力不足。这时候需要减小Batch Size、换GPU、分布式训练。</strong></strong></li>
<li><strong><strong>梯度爆炸/消失：模型学崩了，像学生疯癫/昏迷。大概率是网络层数过深、激活函数选择不当。这时候需要加梯度裁剪、换激活函数（如ReLU→LeakyReLU）、残差连接。</strong></strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd22fc9e8017492891ae703a773f1a21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=mlo5mHpQPS26Kfck4X30fBUbNtU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong><strong>二、技术实现</strong></strong></h2>
<p><em>Training（模型训练）如何进行技术实现？<strong>模型训练按‘数据预处理→架构搭建→参数调优→迭代验证’四步走。</strong></em></p>
<ul>
<li><strong>数据预处理 →</strong> “喂数据” <strong>（模型的“九年义务教育”阶段，先清洗、标注、划分数据集）</strong></li>
<li><strong>架构搭建 →</strong> “搭脑回路” <strong>（选择Transformer模型架构，初始化参数）</strong></li>
<li><strong>参数调优 →</strong> “刷题+改错” <strong>（损失函数扣分→优化器改参数→正则化防死记，模型的“高三冲刺”模式）</strong></li>
<li><strong>迭代验证 →</strong> “周考+月考” <strong>（验证集监控过拟合，测试集“毕业考”定生死，模型的“高考质检局”）</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c56efc4cbb14d7b8b1397a4fa31538c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=ItfHL7OhPdgwt76DtDSE7ta1sWU%3D" alt="" loading="lazy"/></p>
<p>PyTorch如何实现Training（模型训练）？PyTorch通过定义模型结构（继承nn.Module并实现前向传播），配置损失函数（如MSELoss）与优化器（如Adam），在训练循环中反向传播更新参数（通过loss.backward()和optimizer.step()），同时利用DataLoader实现数据批量加载与预处理，最终通过迭代优化使模型拟合数据。</p>
<p><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19c43199277b4e2aa75df4fce3ddf75c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766458755&amp;x-signature=DuY83KyaG%2BOEk6iKTr%2FtikBHO7o%3D" alt="" loading="lazy"/></strong></p>
<pre><code class="hljs language-ini" lang="ini">import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import DataLoader, TensorDataset
import math
<span class="hljs-comment"># 参数配置</span>
<span class="hljs-attr">input_dim</span> = <span class="hljs-number">10</span>       <span class="hljs-comment"># 输入特征维度</span>
<span class="hljs-attr">output_dim</span> = <span class="hljs-number">1</span>       <span class="hljs-comment"># 输出维度（回归任务）</span>
<span class="hljs-attr">seq_length</span> = <span class="hljs-number">5</span>       <span class="hljs-comment"># 序列长度</span>
<span class="hljs-attr">batch_size</span> = <span class="hljs-number">32</span>
<span class="hljs-attr">num_epochs</span> = <span class="hljs-number">50</span>      <span class="hljs-comment"># 增加训练轮次</span>
<span class="hljs-attr">learning_rate</span> = <span class="hljs-number">0.001</span>
<span class="hljs-attr">d_model</span> = <span class="hljs-number">64</span>         <span class="hljs-comment"># 模型维度</span>
<span class="hljs-attr">nhead</span> = <span class="hljs-number">4</span>            <span class="hljs-comment"># 注意力头数</span>
<span class="hljs-attr">dim_feedforward</span> = <span class="hljs-number">256</span> <span class="hljs-comment"># 前馈网络维度</span>
<span class="hljs-comment"># 生成虚拟数据（带时序特征）</span>
<span class="hljs-attr">X</span> = torch.randn(<span class="hljs-number">1000</span>, seq_length, input_dim) * torch.arange(<span class="hljs-number">1</span>, seq_length+<span class="hljs-number">1</span>).view(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
<span class="hljs-attr">y</span> = X.mean(dim=(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)).unsqueeze(-<span class="hljs-number">1</span>)  <span class="hljs-comment"># 目标：带时序权重的均值回归</span>
<span class="hljs-comment"># 数据标准化</span>
<span class="hljs-attr">X</span> = (X - X.mean()) / X.std()
<span class="hljs-attr">y</span> = (y - y.mean()) / y.std()
<span class="hljs-comment"># 封装为DataLoader</span>
<span class="hljs-attr">dataset</span> = TensorDataset(X, y)
<span class="hljs-attr">dataloader</span> = DataLoader(dataset, batch_size=batch_size, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)
class TransformerEncoderRegressor(nn.Module):
def __init__(self):
super().__init__()
<span class="hljs-attr">self.input_proj</span> = nn.Linear(input_dim, d_model)
<span class="hljs-comment"># Transformer编码器（参考网页7架构）</span>
<span class="hljs-attr">encoder_layer</span> = nn.TransformerEncoderLayer(
<span class="hljs-attr">d_model</span>=d_model,
<span class="hljs-attr">nhead</span>=nhead,
<span class="hljs-attr">dim_feedforward</span>=dim_feedforward,
<span class="hljs-attr">batch_first</span>=<span class="hljs-literal">True</span>  <span class="hljs-comment"># PyTorch 1.9+特性</span>
)
<span class="hljs-attr">self.encoder</span> = nn.TransformerEncoder(encoder_layer, num_layers=<span class="hljs-number">3</span>)
<span class="hljs-comment"># 输出层（带特征聚合）</span>
<span class="hljs-attr">self.output_layer</span> = nn.Sequential(
nn.Linear(d_model * seq_length, 128),
nn.ReLU(),
nn.Dropout(0.1),
nn.Linear(128, output_dim)
)
<span class="hljs-comment"># 位置编码（参考网页4实现）</span>
<span class="hljs-attr">self.pos_encoder</span> = PositionalEncoding(d_model, dropout=<span class="hljs-number">0.1</span>)
def forward(self, src):
<span class="hljs-comment"># 输入投影 [batch, seq, d_model]</span>
<span class="hljs-attr">src</span> = self.input_proj(src) * math.sqrt(d_model)
<span class="hljs-comment"># 添加位置编码</span>
<span class="hljs-attr">src</span> = self.pos_encoder(src)
<span class="hljs-comment"># 编码处理 [batch, seq, d_model]</span>
<span class="hljs-attr">memory</span> = self.encoder(src)
<span class="hljs-comment"># 特征聚合 [batch, seq*d_model]</span>
<span class="hljs-attr">flattened</span> = memory.view(memory.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)
return self.output_layer(flattened)
class PositionalEncoding(nn.Module):
"""网页4位置编码实现（适配batch_first格式）"""
def __init__(self, d_model: int, dropout: <span class="hljs-attr">float</span> = <span class="hljs-number">0.1</span>, max_len: int = <span class="hljs-number">5000</span>):
super().__init__()
<span class="hljs-attr">self.dropout</span> = nn.Dropout(p=dropout)
<span class="hljs-attr">position</span> = torch.arange(max_len).unsqueeze(<span class="hljs-number">1</span>)
<span class="hljs-attr">div_term</span> = torch.exp(torch.arange(<span class="hljs-number">0</span>, d_model, <span class="hljs-number">2</span>) * (-math.log(<span class="hljs-number">10000.0</span>) / d_model))
<span class="hljs-attr">pe</span> = torch.zeros(max_len, d_model)
pe<span class="hljs-section">[:, 0::2]</span> = torch.sin(position * div_term)
pe<span class="hljs-section">[:, 1::2]</span> = torch.cos(position * div_term)
self.register_buffer('pe', pe.unsqueeze(0))  <span class="hljs-comment"># [1, max_len, d_model]</span>
def forward(self, x):
<span class="hljs-attr">x</span> = x + self.pe[:, :x.size(<span class="hljs-number">1</span>), :]
return self.dropout(x)
<span class="hljs-comment"># 初始化模型</span>
<span class="hljs-attr">model</span> = TransformerEncoderRegressor()
<span class="hljs-attr">criterion</span> = nn.MSELoss()
<span class="hljs-attr">optimizer</span> = optim.AdamW(model.parameters(), lr=learning_rate, weight_decay=<span class="hljs-number">1</span>e-<span class="hljs-number">4</span>)
<span class="hljs-attr">scheduler</span> = optim.lr_scheduler.ReduceLROnPlateau(optimizer, <span class="hljs-string">'min'</span>, patience=<span class="hljs-number">5</span>)
<span class="hljs-comment"># 训练循环（带验证）</span>
for epoch in range(num_epochs):
model.train()
<span class="hljs-attr">total_loss</span> = <span class="hljs-number">0</span>
for batch_X, batch_y in dataloader:
optimizer.zero_grad()
<span class="hljs-attr">outputs</span> = model(batch_X)
<span class="hljs-attr">loss</span> = criterion(outputs, batch_y)
loss.backward()
<span class="hljs-comment"># 梯度裁剪（网页7实践）</span>
nn.utils.clip_grad_norm_(model.parameters(), 1.0)
optimizer.step()
total_loss += loss.item()
<span class="hljs-attr">avg_loss</span> = total_loss / len(dataloader)
scheduler.step(avg_loss)
print(f'Epoch <span class="hljs-section">[{epoch+1}/{num_epochs}]</span>, Loss: {avg_loss:.4f}, LR: {optimizer.param_groups<span class="hljs-section">[0]</span><span class="hljs-section">["lr"]</span>:.2e}')
<span class="hljs-comment"># 测试推理</span>
<span class="hljs-attr">test_input</span> = torch.randn(<span class="hljs-number">3</span>, seq_length, input_dim)  <span class="hljs-comment"># 批量推理测试</span>
model.eval()
with torch.no_grad():
<span class="hljs-attr">prediction</span> = model(test_input)
print('Test predictions:', prediction.squeeze().tolist())
</code></pre>
<h3 data-id="heading-3">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国产芯片也能跑AI视频实时生成了，商汤Seko 2.0揭秘幕后黑科技]]></title>    <link>https://juejin.cn/post/7583948178858541102</link>    <guid>https://juejin.cn/post/7583948178858541102</guid>    <pubDate>2025-12-16T02:25:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858541102" data-draft-id="7583981974407872522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国产芯片也能跑AI视频实时生成了，商汤Seko 2.0揭秘幕后黑科技"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T02:25:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国产芯片也能跑AI视频实时生成了，商汤Seko 2.0揭秘幕后黑科技
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:25:09.000Z" title="Tue Dec 16 2025 02:25:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>自 Sora 2 发布以来，各大科技厂商迎来新一轮视频生成模型「军备竞赛」，纷纷赶在年底前推出更强的迭代版本。</p>
<p>谷歌推出 Veo 3.1，通过首尾帧控制和多图参考解决了以往视频生成「抽卡」随机性太强的问题；Runway 拿出 Gen-4.5，强化了物理模拟和表情动作迁移；快手祭出 Kling 2.6，实现了原生音画同步……</p>
<p>各家都在炫技，但一个更本质的问题却常被忽略：这些模型距离真正的生产力工具，究竟还有多远？</p>
<p>12 月 15 日，商汤科技产品发布周正式开启，第一天就重磅上线了全新的 Seko 2.0 版本，让 AI 短剧创作真正实现「一人剧组」。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81704c3cf4624c12a1787f22cd6d2a09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=LEGSmXom17dV2dqjtYMjh8veuuw%3D" alt="图片" loading="lazy"/></p>
<p>比如只需输入一句简单的提示词，它立马就能策划剧本大纲，生成分镜和视频，整个过程相当麻溜。</p>
<p>视频来自 Seko 官网，创作者：小铭AI百宝箱</p>
<p>无论是 1 分半钟的 3D 艺术风格的动画短片：</p>
<p>视频来自 Seko 官网，创作者：噪维 AIGC</p>
<p>还是用 SekoTalk 算法能精准同步唇形的数字人音乐 MV，都能在最短时间内信手拈来。</p>
<p>视频来自 Seko 官网，创作者：AI制片人Webb</p>
<p>作为行业首个创编一体、多剧集生成智能体，Seko 已经服务上百家短剧工作室，大量 AI 短剧成功上线。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df01fa553ee4bc4916e3043bdf55f10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=xv9Ta18Rz84BWGNn043QnukH2jM%3D" alt="图片" loading="lazy"/></p>
<p>用商汤 Seko 创作的《婉心计》登顶抖音 AI 短剧榜第一</p>
<p>而此次 2.0 版本的升级，背后是商汤在视频生成底层技术上的深度突破。从开源推理框架 LightX2V 到产品化落地，再到国产芯片的全面适配，商汤正在构建一条完整的 AI 视频生产链路。</p>
<p>视频生成的「不可能三角」</p>
<p>尽管赛道火热，但当 AI 视频生成模型步入短剧制作等实战场景时，往往会撞上由效率、成本、质量构成的「不可能三角」。</p>
<p>目前即便如 Sora 2 级别的产品，生成 10 秒视频往往需要数分钟乃至十分钟。这种漫长的等待时间，让创作者难以进行快速迭代和实时反馈，严重制约了创作效率，更无法支撑工业化生产。</p>
<p>有数据表明，开源模型生成一段 5s 视频通常超过十分钟，商用闭源模型生成 5s 的视频通常也需 1 至 10 分钟不等。这意味着生成与实时播放之间存在着很长的时间差距，距离真正的「强实时生成」，即生成 5 秒视频所需时间小于 5 秒，还有遥远的距离。</p>
<p>实时性问题的背后，是更为本质的计算成本困境。如果要投入如此高昂的算力成本，任何试图用 AI 大规模生产视频内容的商业计划，都会在财务模型上遭遇滑铁卢。</p>
<p>对于 AI 短剧和漫剧创作而言，这个问题更加尖锐。短剧制作的本质是多剧集、多场景、多分镜的复杂工程，这直接导致了计算量的指数级增长。一个仅 5 秒的视频片段就需要生成接近 10 万 token，而在实际创作流程中，一键生成通常会产生 10 到 20 个分镜，这意味着单次操作的 token 消耗量就达到 100 万到 200 万级别。</p>
<p>按照传统视频生成模型的成本结构，制作一集 10 分钟的 AI 短剧，所需的计算资源和时间成本将达到令人咋舌的地步。没有哪家内容制作公司能够承受每生成一分钟内容就要支付数小时高端 GPU 算力的成本。在这种场景下，效率与成本直接决定了项目的生死。</p>
<p>当行业试图通过降低推理步数、压缩模型参数等方式提升速度、降低成本时，又往往会遭遇生成质量下降的挑战。视频的一致性、动态性、画面清晰度都可能在优化过程中受损，而对于商业应用而言，质量是不可妥协的底线。</p>
<p>如此看来，现有的视频生成技术架构似乎陷入了一个「不可能三角」，要么牺牲质量换取速度，要么保证质量但付出巨大的时间和算力代价，要么在两者之间艰难平衡却难以真正满足商业应用需求。这个困局让无数技术团队在实验室里的惊艳演示，最终折戟于真实商业场景的严苛考验。</p>
<p>打破这个困局，需要的不仅仅是单点技术的突破，更需要从算法、架构到系统工程的全方位创新。</p>
<p>商汤悄悄开源的 AI 视频生成框架</p>
<p>速度快 10 倍</p>
<p>今年上半年，一个名为 LightX2V 的开源项目及其推出的图像和视频生成 4 步蒸馏模型，在 ComfyUI 社区走红，还在 Reddit 上引发热烈讨论。截至目前，该项目上传的模型累计下载量已突破 350 万次。</p>
<p>这个备受瞩目的项目背后的研发团队一度颇为神秘，如今答案揭晓，LightX2V 是由商汤科技与北航联合研发的成果，也是业界首个开源的实时视频生成推理框架。</p>
<p>LightX2V 的核心价值在于真正做到了实时视频生成。</p>
<p>它通过一系列创新技术的组合应用，在消费级显卡上实现了强实时生成，生成 5 秒视频所需时间小于 5 秒，速度达到现在行业主流的数倍甚至十倍以上。</p>
<p>算法创新：实时生成的基础</p>
<p>LightX2V 的性能突破首先源于其深层的算法创新。</p>
<p>商汤原创设计的 Phased DMD 步数蒸馏技术，让视频生成在 4 步推理下就能实现高质量的一致性和动态性。这套技术产出的 Wan2.1、Qwen-Image 等多步模型，登上 HuggingFace 趋势榜前 10，累计下载量超过 358 万次。</p>
<p>传统的分布匹配蒸馏（DMD）方法虽然可以将分数匹配生成模型压缩成高效的多步生成器，但在直接扩展到多步蒸馏时，会面临生成多样性显著降低、训练不稳定以及难以有效处理复杂分布的局限性。</p>
<p>为了解决这些难题，研究者提出了 Phased DMD。这是一个结合了阶段式蒸馏和专家混合思想的多步蒸馏框架，旨在降低学习难度并增强模型能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8437f65ca3774549bdc540631611dbe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=O4Gga2IyvEPCXhzJTJMb56hTNTg%3D" alt="图片" loading="lazy"/></p>
<p>图 1：(a) 多步 DMD、(b) 采用随机梯度截断策略的多步 DMD、(c)  Phased DMD 和 (d) 采用 SGTS 的 Phased DMD 的示意图。</p>
<p>Phased DMD 建立在两个核心理念之上：</p>
<ul>
<li>
<p>渐进式分布匹配：该方法将信噪比（SNR）范围划分成多个子区间，通过这种划分，模型可以渐进式地将自身精度优化到更高的 SNR 级别，从而更好地捕获复杂分布，并提高训练的稳定性和生成性能。在去噪过程中，低 SNR 阶段聚焦于全局结构，而高 SNR 阶段则关注精细细节。</p>
</li>
<li>
<p>子区间内分数匹配：由于要对齐子区间的分布，研究者通过严格的推导，得到一个具有理论保证的训练目标。这个目标能够正确估计子区间内的分数，确保阶段式训练的理论正确性。</p>
</li>
</ul>
<p>Phased DMD 的结构设计是一个天然的 Mixture-of-Experts 架构，允许模型中的不同专家专门学习处理不同的 SNR 阶段，而不会引入额外的推理成本。Phased DMD 不仅原生支持 MoE 模型，而且对于非 MoE 的教师模型，该技术也可以将之蒸馏为 MoE 学生模型。</p>
<p>实验结果表明，Phased DMD 相较于传统 DMD 方法，能更好地保持基模型的动态效果和多样性。Phased DMD 通过蒸馏 Qwen-Image (20B 参数) 和 Wan2.2 (28B 参数) 等先进的模型得到了充分验证，开源的部分模型也受到开源社区的讨论和好评。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82a9a3663c56470da2bb91e13f1fd465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=dCFoe4N5%2BqyfX63ISbT8nw9rKl4%3D" alt="图片" loading="lazy"/></p>
<p>来自 Wan2.1-T2V-14B 基础模型（40 步、CFG=4）及其蒸馏变体（4 步、CFG=1）的样本（随机种子 0–3）：(a) 基础模型，(b) DMD，(c) 带 SGTS 的 DMD，(d) Phased DMD。与基础模型和 Phased DMD 相比，DMD 与 SGTS 展现出更弱的运动动态。类似地，带 SGTS 的 DMD 倾向于生成特写视角，而 Phased DMD 和基础模型更好地遵循提示中的相机指令。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/916826ede3694618b6f35a94050285e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=Bz7hnld6fFuyWCFZCmeBbFZ2Pdk%3D" alt="图片" loading="lazy"/></p>
<p>通过 Phased DMD 蒸馏生成的 Qwen-Image 示例。</p>
<p>在高效视频生成领域，自编码器（VAE）模型是不可或缺的关键组件。它负责将像素空间压缩到更小的潜在空间，以实现更快处理。然而，传统的官方 VAE 模型往往内存占用大、推理速度慢，严重制约了视频生成效率。</p>
<p>针对这一行业痛点，LightX2V 团队发布了 LightVAE、LightTAE 系列高效视频自编码器模型集合，旨在通过深度优化和蒸馏技术，在最大限度保持高清画质的同时，实现高达 10 倍以上的性能提升，为实时生成奠定了坚实的算法基础。</p>
<p>LightVAE 系列被定位为「最佳平衡解决方案」，通过对官方 VAE 架构进行剪枝和蒸馏，例如对 Wan2.1 VAE 剪枝 75%，成功将显存占用减少了约 50%（降至约 4-5 GB），同时将推理速度提升了 2 到 3 倍。LightVAE 保持了接近官方模型的优异质量，使其成为日常生产和高性能需求的理想选择。</p>
<p>对于追求极致速度和最小内存占用的场景，团队则推出了 LightTAE 系列，采用更轻量级的 2D 卷积架构，将显存占用降至极低的约 0.4 GB，并实现了极快的推理速度。尽管其基础架构与开源的 TAE 相似，但 LightTAE 经过团队的蒸馏优化，其生成质量显著超越了普通的开源 TAE，达到了接近官方 VAE 的水平，非常适合开发测试和快速迭代等对效率有高要求的场景。</p>
<p>实际测试结果表明，LightX2V 的优化效果是显著的。例如，在处理一段 5 秒 81 帧的视频时，官方 Wan2.1 VAE 的解码时间约为 5.46 秒，显存需求超过 10 GB。相比之下，LightVAE 将解码时间缩短到约 2.07 秒，显存降至 5.57 GB 左右。而 LightTAE 则表现出惊人的速度，解码时间仅需约 0.25 秒，且显存几乎可以忽略不计。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45bfd549ead243278afecadc0a9beaeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=sW8ZhlsW9nF5Rgpn7%2Bhl2KqIxqA%3D" alt="图片" loading="lazy"/></p>
<p>工程创新：全栈优化实现「强实时」</p>
<p>真正让实时生成视频变为可能的，是 LightX2V 在工程层面的全栈优化。</p>
<p>LightX2V 构建了一个面向低成本、强实时的视频生成推理完整方案，覆盖了模型、调度、计算、存储和通信五个维度，通过低比特量化、稀疏注意力、特征缓存、高效 Offloading 和多卡通信优化等技术，形成了清晰且高效的五层体系结构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f71e2317052644f495cc74f7fd9f6eb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=9oU1s1LTOeQ9TcccWuJOjvNJF2c%3D" alt="图片" loading="lazy"/></p>
<p>在框架的最底层是算子实现层，它是所有性能优化的根基，集成了多种高度定制和优化的低级计算操作，特别是针对计算密集型的注意力机制。通过引入 Flash Attention V3、Sage Attention V1/V2/V3、Radial Attention 和 Ring Attention 等创新算子，LightX2V 为上层提供了强大的计算加速能力，从硬件层面保证了推理的高效运行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b61de198d1d4034b39d90e55e07130a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=FGLd%2FRf4gvlYPQveTjSRTPlqGRs%3D" alt="图片" loading="lazy"/></p>
<p>紧接着是内核库层，它负责封装底层算子的复杂性，并为上层模型提供稳定、高性能的调用接口和运行时环境。</p>
<p>再向上，框架的核心执行环境位于模型模块层。该层以并行推理为核心机制，最大化了计算资源的利用。它包含一个负责任务顺序和时间步管理的调度器，以及一个支持主流视频生成模型如 Hunyuan、Cogvideo 和 Wan 系列的模型组件，还集成了 Offload（用于显存卸载管理）和 Weight（权重管理）等模块，确保了在有限硬件资源下依然能够高效运行大型模型。</p>
<p>在模型模块之上，是 LightX2V 的优化算法层，这一层汇聚了框架的关键加速策略。它通过量化技术来压缩模型体积并加速计算；利用特征缓存来避免中间结果的重复计算；并结合底层的优化算子实现高效注意力机制，共同将模型的推理效率推向极致。</p>
<p>最后，位于顶层的是用户入口层，它体现了 LightX2V 的易用性。为适应不同场景，框架提供了多样化的接入方式，包括集成到流行的节点式工具 ComfyUI Workflow 中、通过 Gradio Web 快速部署在线演示服务、支持本地服务器部署，以及提供用于稳定生产环境的静态推理接口。</p>
<p>这种全栈优化带来的直接效果就是显存门槛降至 8GB 以下，入门级消费卡即可流畅运行；在 RTX 5090 等消费级显卡上，已经实现了 1:1 的实时生成效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efd081acac4644ae9b19d97801dc6667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766456709&amp;x-signature=cUTzWuyWyNXnfm7Ibspkiu3Pb%2Bc%3D" alt="图片" loading="lazy"/></p>
<p>从技术架构来看，不是简单优化某个环节，而是构建了一套面向低成本、强实时的视频生成推理完整方案，这也是为什么它能在开源社区获得如此广泛关注的原因。它不仅是一个模型，更是一个可落地、可复用的技术框架。</p>
<p>国产化芯片适配</p>
<p>商业化的最后一块拼图</p>
<p>技术突破之外，商汤在 Seko 2.0 中还实现了另一个关键布局 —— 全面适配国产化芯片。</p>
<p>借助 LightX2V 框架，Seko 已成功支持多款国产 AI 芯片，真正实现了视频生成模型的全国产化部署能力。</p>
<p>从实际效果来看，在国产芯片与英伟达芯片上生成的视频，质量差距并不明显。虽然国产芯片的生成速度略慢，但其性价比优势突出。未来商汤计划给创作者提供国产化和非国产化两套方案，使用国产化方案的用户将获得更优惠的价格政策。</p>
<p>英伟达芯片（左）和国产芯片（右）生成视频对比</p>
<p>这不仅仅是成本优化的技术选择，更是对国产 AI 生态的战略性支持。在视频生成这一 AI 应用的关键场景中，打通从算法框架到硬件芯片的全链路国产化能力，意味着中国 AI 产业在核心技术上迈出了实质性的一步。</p>
<p>当视频生成真正做到实时、低成本、可规模化，AI 短剧乃至更广泛的视频内容创作，或许将迎来真正的生产力革命。而这场革命的起点，正是像 LightX2V 这样从底层技术开始的系统性创新。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码的三大核心素养：如何同时兼顾可维护性、可扩展性、可测试性]]></title>    <link>https://juejin.cn/post/7583948178858672174</link>    <guid>https://juejin.cn/post/7583948178858672174</guid>    <pubDate>2025-12-16T02:34:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858672174" data-draft-id="7583948178858426414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码的三大核心素养：如何同时兼顾可维护性、可扩展性、可测试性"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-12-16T02:34:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码的三大核心素养：如何同时兼顾可维护性、可扩展性、可测试性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:34:26.000Z" title="Tue Dec 16 2025 02:34:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、为什么这三者是 “工业级代码” 的基石？</h3>
<p>很多后端开发者都有过这样的经历：</p>
<ul>
<li>接手老项目时，面对 “面条式代码”，改一行怕崩一片（缺乏可维护性）；</li>
</ul>

<ul>
<li>业务新增需求（如新增支付方式、扩展字段），需要大面积修改原有逻辑（缺乏可扩展性）；</li>
</ul>

<ul>
<li>想写测试验证功能，却因代码耦合严重，连 Mock 依赖都难（缺乏可测试性）。</li>
</ul>
<p>这三者看似独立，实则相辅相成：</p>
<ul>
<li><strong>可维护性是基础</strong>：代码能被快速理解、修改，减少协作成本；</li>
</ul>

<ul>
<li><strong>可扩展性是延伸</strong>：基于良好的维护性，应对变化时无需重构核心逻辑；</li>
</ul>

<ul>
<li><strong>可测试性是保障</strong>：通过测试验证修改的正确性，避免 “改一处崩多处”，反过来又倒逼代码结构优化。</li>
</ul>
<p>核心目标：写出 “能抗住业务迭代” 的代码 —— 既让当前开发者省心，也让未来的自己 / 同事少踩坑。</p>
<h3 data-id="heading-1">二、可维护性：让代码 “好懂、好改”</h3>
<p>可维护性的核心是 “降低认知负担”：任何人拿到代码，能快速理清逻辑、定位问题、安全修改。</p>
<h4 data-id="heading-2">1. 核心原则：一致性、简洁性、自解释性</h4>
<ul>
<li>一致性：命名规范、代码结构、异常处理、日志格式统一（如团队约定 “布尔值用 is/has 开头”“日志必须包含业务标识”）；</li>
</ul>

<ul>
<li>简洁性：拒绝冗余逻辑、过度设计，用最少的代码实现核心功能；</li>
</ul>

<ul>
<li>自解释性：代码本身能说明 “做什么”，注释补充 “为什么”。</li>
</ul>
<h4 data-id="heading-3">2. 落地方法（附反例 / 正例）</h4>
<h5 data-id="heading-4">（1）命名与注释：拒绝 “猜谜游戏”</h5>
<ul>
<li>反例：</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 反例1：命名模糊</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">processData</span><span class="hljs-params">(List <span class="hljs-comment">// list是什么？用户列表？订单列表？</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> s : list) {
        <span class="hljs-keyword">if</span> (s.length() &gt; <span class="hljs-number">6</span>) {
            <span class="hljs-comment">// 做某些操作</span>
        }
    }
}
<span class="hljs-comment">// 反例2：注释冗余/无效</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> add(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b) {
    <span class="hljs-comment">// a加b，返回结果（代码本身已说明，注释多余）</span>
    <span class="hljs-keyword">return</span> a + b;
}
</span></span></code></pre>
<ul>
<li>正例：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 正例1：命名精准</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">filterInvalidUserIds</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; userIds</span>) { <span class="hljs-comment">// 明确是“过滤无效用户ID”</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> userId : userIds) {
        <span class="hljs-keyword">if</span> (userId.<span class="hljs-title function_">length</span>() &gt; <span class="hljs-number">6</span>) { <span class="hljs-comment">// 为什么是6？注释补充背景</span>
            <span class="hljs-comment">// 兼容老系统：老用户ID为6位以上，新用户为6位，仅保留新用户ID</span>
            validUserIds.<span class="hljs-title function_">add</span>(userId);
        }
    }
}
</code></pre>
<h5 data-id="heading-5">（2）模块化拆分：拒绝 “大泥球代码”</h5>
<ul>
<li>反例：一个UserService包含用户注册、登录、信息修改、权限校验、订单查询等所有逻辑，上千行代码；</li>
</ul>

<ul>
<li>正例：按功能拆分模块，每个模块职责单一：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">com.example.user
├── service/
│   ├── register/  <span class="hljs-comment"># 注册相关</span>
│   │   ├── UserRegisterService.java  <span class="hljs-comment"># 注册核心逻辑</span>
│   │   └── UserRegisterValidator.java  <span class="hljs-comment"># 注册参数校验</span>
│   ├── login/     <span class="hljs-comment"># 登录相关</span>
│   └── profile/   <span class="hljs-comment"># 个人信息相关</span>
└── model/
    ├── dto/       <span class="hljs-comment"># 入参/出参DTO</span>
    └── po/        <span class="hljs-comment"># 数据库实体</span>
</code></pre>
<h5 data-id="heading-6">（3）控制逻辑复杂度：拒绝 “嵌套地狱”</h5>
<ul>
<li>反例：多层 if-else 嵌套，逻辑绕圈：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql">public String getDiscount(<span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span>, <span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span>) {
    if (<span class="hljs-keyword">user</span> <span class="hljs-operator">!=</span> <span class="hljs-keyword">null</span>) {
        if (user.isVIP()) {
            if (order.getAmount().compareTo(<span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">1000</span>)) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> "8折";
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> "9折";
            }
        } <span class="hljs-keyword">else</span> {
            if (order.getAmount().compareTo(<span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">1000</span>)) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> "9.5折";
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> "无折扣";
            }
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> "无折扣";
    }
}
</code></pre>
<ul>
<li>正例：扁平化逻辑，用 “卫语句” 提前返回，或用策略模式：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getDiscount</span>(<span class="hljs-params">User user, Order order</span>) {
    <span class="hljs-comment">// 卫语句：提前处理异常场景</span>
    <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || !user.<span class="hljs-title function_">isVIP</span>()) {
        <span class="hljs-keyword">return</span> order.<span class="hljs-title function_">getAmount</span>().<span class="hljs-title function_">compareTo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000</span>)) &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">"9.5折"</span> : <span class="hljs-string">"无折扣"</span>;
    }
    <span class="hljs-comment">// 核心逻辑简化</span>
    <span class="hljs-keyword">return</span> order.<span class="hljs-title function_">getAmount</span>().<span class="hljs-title function_">compareTo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">1000</span>)) &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">"8折"</span> : <span class="hljs-string">"9折"</span>;
}
</code></pre>
<h3 data-id="heading-7">三、可扩展性：让代码 “能加、能改”</h3>
<p>可扩展性的核心是 “拥抱变化”：当业务新增需求、修改规则时，无需重构核心逻辑，仅通过 “新增代码” 或 “配置调整” 实现。</p>
<h4 data-id="heading-8">1. 核心原则：开闭原则、依赖抽象、最小修改</h4>
<ul>
<li>开闭原则：对扩展开放，对修改关闭；</li>
</ul>

<ul>
<li>依赖抽象：依赖接口 / 抽象类，而非具体实现；</li>
</ul>

<ul>
<li>最小修改：新增功能时，修改的代码行数越少越好。</li>
</ul>
<h4 data-id="heading-9">2. 落地方法（附反例 / 正例）</h4>
<h5 data-id="heading-10">（1）面向接口编程：解耦实现与调用</h5>
<ul>
<li>反例：硬编码依赖具体实现，新增功能需修改原有逻辑：</li>
</ul>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> OrderPaymentService {
    // 硬编码依赖支付宝实现，新增微信支付需修改此类
    <span class="hljs-keyword">private</span> AlipayService alipayService = <span class="hljs-built_in">new</span> AlipayService();
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> pay(<span class="hljs-keyword">Order</span> <span class="hljs-keyword">order</span>) {
        <span class="hljs-keyword">return</span> alipayService.pay(<span class="hljs-keyword">order</span>.getOrderNo(), <span class="hljs-keyword">order</span>.getAmount());
    }
}
</code></pre>
<ul>
<li>正例：依赖接口，新增实现无需修改核心逻辑：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 定义支付接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentProvider</span> {
    <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-title class_">String</span> orderNo, <span class="hljs-title class_">BigDecimal</span> amount);
}
<span class="hljs-comment">// 2. 支付宝实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentProvider</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo, BigDecimal amount</span>) { <span class="hljs-comment">/* 支付宝逻辑 */</span> }
}
<span class="hljs-comment">// 3. 微信支付实现（新增，无需修改原有代码）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPayProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentProvider</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo, BigDecimal amount</span>) { <span class="hljs-comment">/* 微信逻辑 */</span> }
}
<span class="hljs-comment">// 4. 核心服务依赖接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderPaymentService</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">PaymentProvider</span> paymentProvider;
    
    <span class="hljs-comment">// 构造函数注入，灵活切换实现</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderPaymentService</span>(<span class="hljs-title class_">PaymentProvider</span> paymentProvider) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">paymentProvider</span> = paymentProvider;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-keyword">return</span> paymentProvider.<span class="hljs-title function_">pay</span>(order.<span class="hljs-title function_">getOrderNo</span>(), order.<span class="hljs-title function_">getAmount</span>());
    }
}
</code></pre>
<h5 data-id="heading-11">（2）配置化与插件化：避免硬编码规则</h5>
<ul>
<li>反例：将业务规则写死在代码中，修改规则需重新部署：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountService</span> {
    <span class="hljs-comment">// 硬编码：VIP折扣8折，普通用户9.5折，修改需改代码</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BigDecimal</span> <span class="hljs-title function_">calculateDiscount</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-keyword">return</span> user.<span class="hljs-title function_">isVIP</span>() ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.8"</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.95"</span>);
    }
}
</code></pre>
<ul>
<li>正例：规则配置化，修改配置无需改代码：</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 配置文件（application.yml）</span>
discount:
  vip: <span class="hljs-number">0.8</span>
  normal: <span class="hljs-number">0.95</span>
<span class="hljs-comment">// 2. 代码读取配置</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = <span class="hljs-string">"discount"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountProperties</span> {
    <span class="hljs-keyword">private</span> BigDecimal vip;
    <span class="hljs-keyword">private</span> BigDecimal normal;
    <span class="hljs-comment">// getter/setter</span>
}
<span class="hljs-comment">// 3. 核心服务</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscountService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DiscountProperties discountProperties;
    
    <span class="hljs-keyword">public</span> BigDecimal calculateDiscount(User user) {
        <span class="hljs-keyword">return</span> user.isVIP() ? discountProperties.getVip() : discountProperties.getNormal();
    }
}
</code></pre>
<h5 data-id="heading-12">（3）预留扩展点：提前规划变化场景</h5>
<p>核心业务中，预判可能的变化，预留扩展接口，避免后续重构。</p>
<ul>
<li>示例：电商订单状态流转，预留 “状态变更钩子”：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderStatusMachine</span> {
    <span class="hljs-comment">// 状态变更处理器，支持扩展不同状态的自定义逻辑</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">OrderStatus</span>, <span class="hljs-title class_">OrderStatusHandler</span>&gt; handlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();
    
    <span class="hljs-comment">// 注册处理器（扩展点）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerHandler</span>(<span class="hljs-params">OrderStatus status, OrderStatusHandler handler</span>) {
        handlers.<span class="hljs-title function_">put</span>(status, handler);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">changeStatus</span>(<span class="hljs-params">Order order, OrderStatus newStatus</span>) {
        <span class="hljs-comment">// 执行默认逻辑</span>
        order.<span class="hljs-title function_">setStatus</span>(newStatus);
        <span class="hljs-comment">// 执行扩展逻辑（如订单完成后发送通知、更新库存）</span>
        <span class="hljs-title class_">OrderStatusHandler</span> handler = handlers.<span class="hljs-title function_">get</span>(newStatus);
        <span class="hljs-keyword">if</span> (handler != <span class="hljs-literal">null</span>) {
            handler.<span class="hljs-title function_">handle</span>(order);
        }
    }
}
<span class="hljs-comment">// 扩展：订单完成后的处理逻辑</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCompletedHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderStatusHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-comment">// 发送通知、更新库存等</span>
    }
}
</code></pre>
<h3 data-id="heading-13">四、可测试性：让代码 “能测、易测”</h3>
<p>可测试性的核心是 “能独立验证逻辑正确性”：无需依赖复杂环境，就能通过测试用例覆盖核心场景。</p>
<h4 data-id="heading-14">1. 核心原则：依赖隔离、输入输出明确、无副作用</h4>
<ul>
<li>依赖隔离：核心逻辑与外部依赖（数据库、缓存、外部接口）解耦；</li>
</ul>

<ul>
<li>输入输出明确：函数 / 方法的输入（参数）和输出（返回值）清晰，无模糊状态；</li>
</ul>

<ul>
<li>无副作用：避免修改全局变量、静态变量，相同输入始终得到相同输出（纯函数优先）。</li>
</ul>
<h4 data-id="heading-15">2. 落地方法（附反例 / 正例）</h4>
<h5 data-id="heading-16">（1）依赖注入：替换外部依赖为 Mock</h5>
<ul>
<li>反例：硬编码依赖外部服务，无法 Mock，测试困难：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 硬编码依赖库存服务，测试时需启动库存服务</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">StockService</span> <span class="hljs-variable">stockService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StockServiceImpl</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 扣减库存（依赖真实库存服务）</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">deductSuccess</span> <span class="hljs-operator">=</span> stockService.deduct(order.getProductId(), order.getQuantity());
        <span class="hljs-keyword">if</span> (deductSuccess) {
            <span class="hljs-comment">// 创建订单</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<ul>
<li>正例：构造函数注入依赖，测试时用 Mock 替换：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StockService stockService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">// 构造函数注入，测试时可传入Mock对象</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(StockService stockService, OrderMapper orderMapper)</span> {
        <span class="hljs-built_in">this</span>.stockService = stockService;
        <span class="hljs-built_in">this</span>.orderMapper = orderMapper;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">deductSuccess</span> <span class="hljs-operator">=</span> stockService.deduct(order.getProductId(), order.getQuantity());
        <span class="hljs-keyword">if</span> (deductSuccess) {
            orderMapper.insert(order);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
<span class="hljs-comment">// 测试用例（Mockito）</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreateOrder_success</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. Mock依赖</span>
    <span class="hljs-type">StockService</span> <span class="hljs-variable">mockStockService</span> <span class="hljs-operator">=</span> Mockito.mock(StockService.class);
    <span class="hljs-type">OrderMapper</span> <span class="hljs-variable">mockOrderMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderMapper.class);
    Mockito.when(mockStockService.deduct(<span class="hljs-string">"product_1001"</span>, <span class="hljs-number">2</span>)).thenReturn(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 2. 初始化服务（注入Mock）</span>
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockStockService, mockOrderMapper);
    
    <span class="hljs-comment">// 3. 执行测试</span>
    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_2001"</span>, <span class="hljs-string">"product_1001"</span>, <span class="hljs-number">2</span>);
    <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> orderService.createOrder(order);
    
    <span class="hljs-comment">// 4. 验证结果</span>
    Assert.assertTrue(result);
    Mockito.verify(mockStockService, Mockito.times(<span class="hljs-number">1</span>)).deduct(<span class="hljs-string">"product_1001"</span>, <span class="hljs-number">2</span>);
    Mockito.verify(mockOrderMapper, Mockito.times(<span class="hljs-number">1</span>)).insert(order);
}
</code></pre>
<h5 data-id="heading-17">（2）拆分 “纯逻辑” 与 “副作用代码”</h5>
<ul>
<li>反例：函数中混合业务逻辑与数据库操作，难以测试核心逻辑：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">public BigDecimal calculateOrderAmount(List&gt; items) {
    BigDecimal <span class="hljs-attr">amount</span> = BigDecimal.ZERO<span class="hljs-comment">;</span>
    for (OrderItem item : items) {
        // 业务逻辑：计算金额（含折扣、税费）
        BigDecimal <span class="hljs-attr">itemAmount</span> = item.getPrice().multiply(new BigDecimal(item.getQuantity()))<span class="hljs-comment">;</span>
        <span class="hljs-attr">amount</span> = amount.add(itemAmount.multiply(new BigDecimal(<span class="hljs-string">"0.98"</span>)))<span class="hljs-comment">; // 98折</span>
    }
    // 副作用：写入数据库日志（混合逻辑，测试需依赖数据库）
    orderLogMapper.insert(new OrderLog(amount))<span class="hljs-comment">;</span>
    return amount<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li>正例：拆分纯逻辑函数（无副作用）和副作用函数，分别测试：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 纯逻辑函数：仅计算金额，无依赖、无副作用，易测试</span>
<span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">calculateOrderAmount</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> BigDecimal.ZERO;
    <span class="hljs-keyword">for</span> (OrderItem item : items) {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">itemAmount</span> <span class="hljs-operator">=</span> item.getPrice().multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(item.getQuantity()));
        amount = amount.add(itemAmount.multiply(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.98"</span>)));
    }
    <span class="hljs-keyword">return</span> amount;
}
<span class="hljs-comment">// 副作用函数：处理数据库操作，依赖纯逻辑函数</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrderLog</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> calculateOrderAmount(items);
    orderLogMapper.insert(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderLog</span>(amount));
}
<span class="hljs-comment">// 测试纯逻辑（无需任何外部依赖）</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCalculateOrderAmount</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 准备测试数据</span>
    List&gt; items = Arrays.asList(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">"product_1"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>), <span class="hljs-number">2</span>),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">"product_2"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"200"</span>), <span class="hljs-number">1</span>)
    );
    <span class="hljs-comment">// 执行测试</span>
    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> calculateOrderAmount(items);
    <span class="hljs-comment">// 验证结果（100*2 + 200*1 = 400，98折后为392）</span>
    Assert.assertEquals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"392.00"</span>), result.setScale(<span class="hljs-number">2</span>));
}
<span class="hljs-comment">// 测试副作用函数（Mock数据库依赖）</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSaveOrderLog</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Mock依赖</span>
    <span class="hljs-type">OrderLogMapper</span> <span class="hljs-variable">mockMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderLogMapper.class);
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockStockService, mockOrderMapper, mockMapper);
    
    <span class="hljs-comment">// 准备数据</span>
    List&gt; items = Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">"product_1"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>), <span class="hljs-number">1</span>));
    
    <span class="hljs-comment">// 执行测试</span>
    orderService.saveOrderLog(items);
    
    <span class="hljs-comment">// 验证：数据库日志被正确插入</span>
    Mockito.verify(mockMapper, Mockito.times(<span class="hljs-number">1</span>)).insert(
        Mockito.argThat(log -&gt; log.getAmount().equals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"98.00"</span>)))
    );
}
</code></pre>
<h5 data-id="heading-18">（3）避免静态方法依赖：静态方法难以 Mock</h5>
<ul>
<li>反例：依赖静态工具类，测试时无法替换逻辑（如测试 “过期时间” 场景）：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderValidator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-comment">// 依赖静态方法，无法Mock“时间”相关逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">DateUtils</span>.<span class="hljs-title function_">isAfterNow</span>(order.<span class="hljs-title function_">getPayTime</span>()) <span class="hljs-comment">// 静态方法：判断付款时间是否在当前之后</span>
                &amp;&amp; <span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotBlank</span>(order.<span class="hljs-title function_">getOrderNo</span>());
    }
}
</code></pre>
<ul>
<li>正例：将静态工具类封装为实例依赖，测试时可 Mock：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 封装静态工具为实例类（解耦静态依赖）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeValidator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isAfterNow</span>(<span class="hljs-params"><span class="hljs-built_in">Date</span> date</span>) {
        <span class="hljs-keyword">return</span> date.<span class="hljs-title function_">after</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()); <span class="hljs-comment">// 底层仍可调用DateUtils，但对外提供实例方法</span>
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringValidator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isNotBlank</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> str</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotBlank</span>(str);
    }
}
<span class="hljs-comment">// 2. 依赖注入实例，而非静态方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderValidator</span> {
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">TimeValidator</span> timeValidator;
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">StringValidator</span> stringValidator;
    
    <span class="hljs-comment">// 构造函数注入</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">OrderValidator</span>(<span class="hljs-title class_">TimeValidator</span> timeValidator, <span class="hljs-title class_">StringValidator</span> stringValidator) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeValidator</span> = timeValidator;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stringValidator</span> = stringValidator;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">Order order</span>) {
        <span class="hljs-keyword">return</span> timeValidator.<span class="hljs-title function_">isAfterNow</span>(order.<span class="hljs-title function_">getPayTime</span>()) 
                &amp;&amp; stringValidator.<span class="hljs-title function_">isNotBlank</span>(order.<span class="hljs-title function_">getOrderNo</span>());
    }
}
<span class="hljs-comment">// 3. 测试用例：Mock时间逻辑，覆盖“过期”场景</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">testValidate_fail_whenPayTimeExpired</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// Mock工具类实例</span>
    <span class="hljs-title class_">TimeValidator</span> mockTimeValidator = <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-title class_">TimeValidator</span>.<span class="hljs-property">class</span>);
    <span class="hljs-title class_">StringValidator</span> mockStringValidator = <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">mock</span>(<span class="hljs-title class_">StringValidator</span>.<span class="hljs-property">class</span>);
    
    <span class="hljs-comment">// 准备测试数据（付款时间已过期）</span>
    <span class="hljs-title class_">Order</span> order = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_2001"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() - <span class="hljs-number">3600000</span>));
    
    <span class="hljs-comment">// 设定Mock行为：模拟“付款时间已过期”</span>
    <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">when</span>(mockTimeValidator.<span class="hljs-title function_">isAfterNow</span>(order.<span class="hljs-title function_">getPayTime</span>())).<span class="hljs-title function_">thenReturn</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-title class_">Mockito</span>.<span class="hljs-title function_">when</span>(mockStringValidator.<span class="hljs-title function_">isNotBlank</span>(order.<span class="hljs-title function_">getOrderNo</span>())).<span class="hljs-title function_">thenReturn</span>(<span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 执行测试</span>
    <span class="hljs-title class_">OrderValidator</span> validator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderValidator</span>(mockTimeValidator, mockStringValidator);
    <span class="hljs-built_in">boolean</span> result = validator.<span class="hljs-title function_">validate</span>(order);
    
    <span class="hljs-comment">// 验证结果：验证失败</span>
    <span class="hljs-title class_">Assert</span>.<span class="hljs-title function_">assertFalse</span>(result);
}
</code></pre>
<h5 data-id="heading-19">（4）控制函数粒度：避免 “大函数”，单个函数仅做一件事</h5>
<ul>
<li>反例：一个函数包含参数校验、业务计算、外部调用，测试场景极多：</li>
</ul>
<pre><code class="hljs language-scss" lang="scss">public boolean <span class="hljs-built_in">processOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-comment">// 1. 参数校验</span>
    if (orderDTO == null || StringUtils.isBlank(orderDTO.getProductId()) || orderDTO<span class="hljs-selector-class">.getQuantity</span>() 
        return false;
    }
    <span class="hljs-comment">// 2. 业务计算：转换DTO为PO</span>
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(UUID.randomUUID()<span class="hljs-selector-class">.toString</span>());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setProductId</span>(orderDTO.getProductId());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setQuantity</span>(orderDTO.getQuantity());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(orderDTO.getPrice()<span class="hljs-selector-class">.multiply</span>(new BigDecimal(orderDTO.getQuantity())));
    <span class="hljs-comment">// 3. 外部调用：扣减库存</span>
    boolean deductSuccess = stockService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
    if (!deductSuccess) {
        return false;
    }
    <span class="hljs-comment">// 4. 持久化：保存订单</span>
    orderMapper<span class="hljs-selector-class">.insert</span>(order);
    return true;
}
</code></pre>
<ul>
<li>正例：拆分为多个小函数，每个函数职责单一，单独测试：</li>
</ul>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 参数校验函数</span>
public boolean <span class="hljs-built_in">validateOrderDTO</span>(OrderDTO orderDTO) {
    return orderDTO != null 
            &amp;&amp; StringUtils<span class="hljs-selector-class">.isNotBlank</span>(orderDTO.getProductId()) 
            &amp;&amp; orderDTO<span class="hljs-selector-class">.getQuantity</span>() &gt; <span class="hljs-number">0</span>;
}
<span class="hljs-comment">// 2. DTO转PO函数（纯逻辑）</span>
public <span class="hljs-attribute">Order</span> <span class="hljs-built_in">convertToOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>(UUID.randomUUID()<span class="hljs-selector-class">.toString</span>());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setProductId</span>(orderDTO.getProductId());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setQuantity</span>(orderDTO.getQuantity());
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(orderDTO.getPrice()<span class="hljs-selector-class">.multiply</span>(new BigDecimal(orderDTO.getQuantity())));
    return <span class="hljs-attribute">order</span>;
}
<span class="hljs-comment">// 3. 核心流程函数（组合小函数）</span>
public boolean <span class="hljs-built_in">processOrder</span>(OrderDTO orderDTO) {
    <span class="hljs-comment">// 校验</span>
    if (!validateOrderDTO(orderDTO)) {
        return false;
    }
    <span class="hljs-comment">// 转换</span>
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = <span class="hljs-built_in">convertToOrder</span>(orderDTO);
    <span class="hljs-comment">// 扣减库存</span>
    boolean deductSuccess = stockService<span class="hljs-selector-class">.deduct</span>(orderDTO.getProductId(), orderDTO<span class="hljs-selector-class">.getQuantity</span>());
    if (!deductSuccess) {
        return false;
    }
    <span class="hljs-comment">// 保存订单</span>
    orderMapper<span class="hljs-selector-class">.insert</span>(order);
    return true;
}
<span class="hljs-comment">// 测试：单独测试参数校验（无需依赖其他服务）</span>
<span class="hljs-keyword">@Test</span>
public void testValidateOrderDTO_fail_whenQuantityZero() {
    OrderDTO orderDTO = new <span class="hljs-built_in">OrderDTO</span>("product_1001", new BigDecimal("<span class="hljs-number">100</span>"), <span class="hljs-number">0</span>);
    boolean result = <span class="hljs-built_in">validateOrderDTO</span>(orderDTO);
    Assert<span class="hljs-selector-class">.assertFalse</span>(result);
}
<span class="hljs-comment">// 测试：单独测试DTO转PO（纯逻辑，无依赖）</span>
<span class="hljs-keyword">@Test</span>
public void testConvertToOrder() {
    OrderDTO orderDTO = new <span class="hljs-built_in">OrderDTO</span>("product_1001", new BigDecimal("<span class="hljs-number">100</span>"), <span class="hljs-number">2</span>);
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = <span class="hljs-built_in">convertToOrder</span>(orderDTO);
    Assert<span class="hljs-selector-class">.assertEquals</span>("product_1001", order.getProductId());
    Assert<span class="hljs-selector-class">.assertEquals</span>(new BigDecimal("<span class="hljs-number">200.00</span>"), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getAmount</span>()<span class="hljs-selector-class">.setScale</span>(<span class="hljs-number">2</span>));
}
</code></pre>
<h5 data-id="heading-20">（5）避免全局状态：全局变量会导致测试相互干扰</h5>
<ul>
<li>反例：使用静态变量（全局状态）存储业务数据，测试用例执行顺序会影响结果，导致测试不稳定：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 全局静态变量：存储已处理的订单数（所有实例共享）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">processedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 业务逻辑：保存订单</span>
        orderMapper.insert(order);
        processedCount++; <span class="hljs-comment">// 修改全局状态，所有实例共享该值</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProcessedCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> processedCount;
    }
}
<span class="hljs-comment">// 测试用例1：执行后会修改全局状态</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case1</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();
    service.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_001"</span>));
    Assert.assertEquals(<span class="hljs-number">1</span>, service.getProcessedCount()); <span class="hljs-comment">// 预期1，执行通过</span>
}
<span class="hljs-comment">// 测试用例2：依赖测试用例1的执行结果，顺序变了就失败</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case2</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();
    service.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_002"</span>));
    <span class="hljs-comment">// 若先执行case2，预期2但实际是1；若先执行case1，预期2但实际是2——测试结果不稳定</span>
    Assert.assertEquals(<span class="hljs-number">2</span>, service.getProcessedCount()); 
}
</code></pre>
<p>问题本质：全局状态是 “共享资源”，多个测试用例修改同一状态会导致 “测试污染”，测试结果依赖执行顺序，无法保证可靠性。</p>
<ul>
<li>正例：去掉全局静态变量，改用 “实例变量” 或 “状态上下文”，每个实例独立持有状态：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 实例变量：每个服务实例单独持有状态，不共享</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">processedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">// 构造函数注入依赖</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(OrderMapper orderMapper)</span> {
        <span class="hljs-built_in">this</span>.orderMapper = orderMapper;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Order order)</span> {
        orderMapper.insert(order);
        processedCount++; <span class="hljs-comment">// 仅修改当前实例的状态，不影响其他实例</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getProcessedCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> processedCount;
    }
}
<span class="hljs-comment">// 测试用例1：独立实例，状态隔离</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case1</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderMapper</span> <span class="hljs-variable">mockMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderMapper.class);
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockMapper); <span class="hljs-comment">// 实例1</span>
    service1.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_001"</span>));
    Assert.assertEquals(<span class="hljs-number">1</span>, service1.getProcessedCount()); <span class="hljs-comment">// 稳定通过</span>
}
<span class="hljs-comment">// 测试用例2：独立实例，与case1状态互不干扰</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testProcessOrder_case2</span><span class="hljs-params">()</span> {
    <span class="hljs-type">OrderMapper</span> <span class="hljs-variable">mockMapper</span> <span class="hljs-operator">=</span> Mockito.mock(OrderMapper.class);
    <span class="hljs-type">OrderService</span> <span class="hljs-variable">service2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>(mockMapper); <span class="hljs-comment">// 实例2</span>
    service2.processOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">"order_002"</span>));
    Assert.assertEquals(<span class="hljs-number">1</span>, service2.getProcessedCount()); <span class="hljs-comment">// 稳定通过，与执行顺序无关</span>
}
</code></pre>
<ul>
<li>进阶场景：若确实需要 “共享状态”（如统计全系统订单数），应通过 “外部存储”（如数据库、Redis）而非内存全局变量：</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OrderStatisticService</span> {
    <span class="hljs-keyword">private</span> final RedisTemplate&gt; redisTemplate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final String KEY = <span class="hljs-string">"order:processed:count"</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">OrderStatisticService</span>(<span class="hljs-params">RedisTemplateTemplate</span>)</span> {
        <span class="hljs-keyword">this</span>.redisTemplate = redisTemplate;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">incrementCount</span>()</span> {
        <span class="hljs-comment">// 用Redis原子操作记录状态，测试时可Mock Redis</span>
        redisTemplate.opsForValue().increment(KEY, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getCount</span>()</span> {
        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().<span class="hljs-keyword">get</span>(KEY);
    }
}
<span class="hljs-comment">// 测试用例：Mock Redis，隔离外部依赖</span>
@Test
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testIncrementCount</span>()</span> {
    RedisTemplateRedis = Mockito.mock(RedisTemplate.<span class="hljs-keyword">class</span>);
    ValueOperations&gt; mockOps = Mockito.mock(ValueOperations.<span class="hljs-keyword">class</span>);
    Mockito.<span class="hljs-keyword">when</span>(mockRedis.opsForValue()).thenReturn(mockOps);
    Mockito.<span class="hljs-keyword">when</span>(mockOps.increment(KEY, <span class="hljs-number">1</span>)).thenReturn(<span class="hljs-number">1</span>);
    
    OrderStatisticService service = <span class="hljs-keyword">new</span> OrderStatisticService(mockRedis);
    service.incrementCount();
    
    Mockito.verify(mockOps, Mockito.times(<span class="hljs-number">1</span>)).increment(KEY, <span class="hljs-number">1</span>);
    Assert.assertEquals(<span class="hljs-number">1</span>, service.getCount().intValue());
}
</code></pre>
<h4 data-id="heading-21">3. 可测试性常见误区</h4>






























<table><thead><tr><th>误区</th><th>后果</th><th>修正方案</th></tr></thead><tbody><tr><td>依赖全局静态变量 / 单例（无注入）</td><td>测试用例相互污染，结果不稳定</td><td>改用实例变量，单例通过依赖注入暴露</td></tr><tr><td>函数返回 void，无输出</td><td>无法验证函数执行效果</td><td>让函数返回执行结果（如布尔值、状态对象），或通过 Mock 验证副作用</td></tr><tr><td>业务逻辑与 HTTP 请求 / 响应强耦合</td><td>测试需启动 Web 容器，效率低</td><td>拆分 Controller 与 Service，Service 层纯业务逻辑无 Web 依赖</td></tr><tr><td>测试用例依赖真实数据库 / 缓存</td><td>测试环境要求高，执行慢</td><td>用 H2 内存数据库、Mock 工具（Mockito、TestContainers）隔离外部依赖</td></tr></tbody></table>
<h3 data-id="heading-22">五、三者协同：如何平衡 “可维护性、可扩展性、可测试性”</h3>
<p>很多开发者会陷入 “过度设计” 的误区：为了追求某一个特性，导致代码复杂度飙升（比如为了可扩展性，设计十几层抽象）。核心原则是 “适度设计，按需优化”：</p>
<h4 data-id="heading-23">1. 协同关系：一个良性循环</h4>
<ul>
<li>可维护性是基础：模块化、命名清晰的代码，自然更容易拆分扩展点、隔离依赖（提升可扩展性和可测试性）；</li>
</ul>

<ul>
<li>可测试性是保障：写测试的过程会倒逼你拆分耦合、明确输入输出（反过来优化可维护性和可扩展性）；</li>
</ul>

<ul>
<li>可扩展性是目标：基于前两者，代码才能 “低成本应对变化”，避免频繁重构。</li>
</ul>
<h4 data-id="heading-24">2. 平衡技巧</h4>
<ul>
<li>核心业务：重点优化三者，采用接口抽象、依赖注入、模块化拆分（如支付、订单核心流程）；</li>
</ul>

<ul>
<li>非核心业务：优先保证可维护性，无需过度设计可扩展性（如内部工具、临时报表功能）；</li>
</ul>

<ul>
<li>迭代优化：初期无需追求 “完美设计”，先实现核心功能，后续通过重构逐步优化（如先写简单实现，有扩展需求时再抽象接口）。</li>
</ul>
<h3 data-id="heading-25">六、总结：写出 “三优代码” 的核心心法</h3>
<p>可维护性、可扩展性、可测试性，本质都是 “降低代码的认知成本和修改成本”。落地的关键不是死记设计模式，而是记住三个核心：</p>
<ol>
<li><strong>拆分</strong>：按职责拆分模块、函数，拒绝 “大泥球代码”；</li>
</ol>

<ol start="2">
<li><strong>解耦</strong>：依赖抽象而非具体实现，隔离外部依赖和核心逻辑；</li>
</ol>

<ol start="3">
<li><strong>简洁</strong>：避免过度设计，用最少的代码实现核心功能，让代码 “一眼能看懂”。</li>
</ol>
<p>优秀的后端代码，经得起业务迭代的考验，也经得起时间的考验 —— 这不仅是技术能力的体现，更是对团队和未来自己的负责。从今天开始，试着在写代码时多问自己三个问题：</p>
<ul>
<li>别人能快速看懂我的代码吗？（可维护性）</li>
</ul>

<ul>
<li>新增需求时我需要改多少代码？（可扩展性）</li>
</ul>

<ul>
<li>我能轻松写出测试用例覆盖核心场景吗？（可测试性）</li>
</ul>
<p>坚持下去，你的编码能力会在潜移默化中实现质的飞跃。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践]]></title>    <link>https://juejin.cn/post/7583943503556722738</link>    <guid>https://juejin.cn/post/7583943503556722738</guid>    <pubDate>2025-12-16T02:30:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556722738" data-draft-id="7583981974407954442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2025-12-16T02:30:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:30:05.000Z" title="Tue Dec 16 2025 02:30:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开箱即用的 GoWind Admin｜风行，企业级前后端一体中后台框架：深度解析 Wire 依赖注入集成实践</h2>
<p>在企业级中后台框架开发中，依赖管理是贯穿全生命周期的核心挑战 —— 随着项目规模扩张，手动创建对象、传递依赖会导致代码耦合度陡增、测试成本居高不下、维护难度指数级上升。依赖注入（DI）通过 “控制反转” 机制，将对象的创建与依赖传递解耦，成为解决这一问题的最优解之一。本文以 GoWind Admin（风行）框架为实践载体，深度解析 Google 开源的编译期依赖注入工具 Wire，并完整呈现其在企业级中后台框架中的标准化集成方案。</p>
<h3 data-id="heading-1">一、基础认知：什么是依赖注入（DI）？</h3>
<p>依赖注入（Dependency Injection，DI）是实现控制反转（IoC）的核心技术，其核心思想可概括为：<strong>对象的依赖由外部容器提供，而非对象自身创建</strong>。这里的 “依赖” 指对象运行所需的其他组件（如数据库连接、配置实例、业务服务等），“注入” 则是外部容器将依赖主动传递给目标对象的过程。</p>
<p>通过依赖注入，使用依赖的对象（客户）无需关心依赖的创建细节，仅需依赖统一的接口契约；依赖的创建、组装、传递全由注入器（容器）负责。这不仅减少了 <code>new</code> 关键字的直接使用，更实现了代码的解耦、可测试性与可维护性的大幅提升。</p>
<h4 data-id="heading-2">1.1 依赖注入的核心四要素</h4>
<ul>
<li><strong>服务（Service）</strong>：提供具体功能的对象（如数据库连接池、用户仓储实例），是被依赖的一方。</li>
<li><strong>客户（Client）</strong>：使用服务的对象（如业务逻辑服务），是依赖的接收方。</li>
<li><strong>接口（Interface）</strong>：客户与服务之间的契约，客户仅依赖接口而非具体实现，保证了依赖的抽象性。</li>
<li><strong>注入器（Injector）</strong>：也称容器、装配器，负责管理服务的创建、依赖关系的解析，并将服务注入到客户中。</li>
</ul>
<h4 data-id="heading-3">1.2 Go 语言中的依赖注入框架对比</h4>
<p>Go 生态中主流的依赖注入框架分为两类，核心差异在于“依赖解析时机”：</p>


























<table><thead><tr><th>类型</th><th>代表工具</th><th>核心原理</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td>运行时注入</td><td>Uber dig</td><td>反射机制动态解析</td><td>功能灵活，支持复杂依赖场景</td><td>反射带来性能损耗；依赖错误仅运行时暴露</td></tr><tr><td>编译期注入</td><td>Google Wire</td><td>代码生成静态解析</td><td>无反射开销；编译期暴露错误；代码可读性高</td><td>功能相对精简；需遵循固定规范</td></tr></tbody></table>
<blockquote>
<p>GoWind Admin 选择 Wire 作为核心依赖注入方案的核心原因：中后台系统对稳定性要求极高，编译期错误检测可最大程度规避线上故障；同时 Wire 简洁的设计符合框架 “轻量、易用、可扩展” 的核心定位。</p>
</blockquote>
<h3 data-id="heading-4">二、Wire 核心概念：Provider 与 Injector</h3>
<p>Wire 摒弃了复杂的运行时机制，核心通过两个概念实现依赖注入：<strong>Provider（提供者）</strong> 和 <strong>Injector（注入器）</strong>。可以简单理解为：Provider 负责“生产”依赖对象，Injector 负责“组装”依赖关系。</p>
<h4 data-id="heading-5">2.1 Provider：依赖对象的“生产者”</h4>
<p>Provider 本质是一个普通的 Go 函数，用于创建并返回某个对象（即“服务”），我们可以将其理解为对象的“构造函数”。Wire 会通过 Provider 函数的参数列表解析其依赖，通过返回值确定其提供的服务类型。</p>
<h5 data-id="heading-6">2.1.1 基础 Provider 示例</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    <span class="hljs-string">"github.com/go-sql-driver/mysql"</span>
)

<span class="hljs-comment">// Config 数据库配置结构体</span>
<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DSN <span class="hljs-type">string</span>
}

<span class="hljs-comment">// UserStore 用户数据存储服务</span>
<span class="hljs-keyword">type</span> UserStore <span class="hljs-keyword">struct</span> {
    cfg *Config
    db  *sql.DB
}

<span class="hljs-comment">// NewUserStore 是 *UserStore 的 Provider</span>
<span class="hljs-comment">// 依赖：*Config（配置）、*sql.DB（数据库连接）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserStore</span><span class="hljs-params">(cfg *Config, db *sql.DB)</span></span> (*UserStore, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> &amp;UserStore{cfg: cfg, db: db}, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// NewDefaultConfig 是 *Config 的 Provider（无依赖）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDefaultConfig</span><span class="hljs-params">()</span></span> *Config {
    <span class="hljs-keyword">return</span> &amp;Config{
        DSN: <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/test?parseTime=true"</span>,
    }
}

<span class="hljs-comment">// NewDB 是 *sql.DB 的 Provider</span>
<span class="hljs-comment">// 依赖：*Config（从配置中获取 DSN）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDB</span><span class="hljs-params">(cfg *Config)</span></span> (*sql.DB, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> sql.Open(<span class="hljs-string">"mysql"</span>, cfg.DSN)
}
</code></pre>
<h5 data-id="heading-7">2.1.2 ProviderSet：依赖的“集合封装”</h5>
<p>当项目中存在多个关联的 Provider 时，可通过 wire.NewSet 将其组合为 ProviderSet（提供者集合），便于统一管理和复用。ProviderSet 支持嵌套，即一个 ProviderSet 可包含其他 ProviderSet。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/google/wire"</span>

<span class="hljs-comment">// ProviderSet 数据层的 Provider 集合</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    NewUserStore,   <span class="hljs-comment">// 提供 *UserStore</span>
    NewDefaultConfig, <span class="hljs-comment">// 提供 *Config</span>
    NewDB,          <span class="hljs-comment">// 提供 *sql.DB</span>
)

<span class="hljs-comment">// 其他包的 ProviderSet 示例（可嵌套）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"go-wind-admin/app/admin/service/internal/cache/providers"</span>

<span class="hljs-keyword">var</span> FullProviderSet = wire.NewSet(
    ProviderSet,          <span class="hljs-comment">// 嵌套当前包的 ProviderSet</span>
    providers.CacheSet,   <span class="hljs-comment">// 嵌套缓存层的 ProviderSet</span>
)
</code></pre>
<blockquote>
<p><strong>核心说明</strong>：<code>wire.NewSet</code> 仅用于“归类”Provider，不执行任何逻辑。其返回值可作为其他 <code>wire.NewSet</code> 的参数，实现依赖的模块化管理。</p>
</blockquote>
<h4 data-id="heading-8">2.2 Injector：依赖关系的“组装器”</h4>
<p>Injector 是 Wire 生成的“依赖组装函数”，负责按依赖顺序调用 Provider 函数，创建并注入所需对象。我们只需定义 Injector 的“函数签名”，Wire 会通过 <code>wire.Build</code> 声明的 Provider/ProviderSet 自动生成完整的组装逻辑。</p>
<h5 data-id="heading-9">2.2.1 定义 Injector 签名</h5>
<p>创建 <code>wire.go</code> 文件，通过特殊构建标签（<code>//go:build wireinject</code>）标记该文件仅用于生成 Injector，不会被编译到最终产物中。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>
    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data"</span>
)

<span class="hljs-comment">// InitUserStore 是 Injector 函数的签名</span>
<span class="hljs-comment">// 入参：无（若有依赖可在此声明）</span>
<span class="hljs-comment">// 出参：*data.UserStore（最终需要的服务）、error（错误处理）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitUserStore</span><span class="hljs-params">()</span></span> (*data.UserStore, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// wire.Build 声明组装所需的 ProviderSet</span>
    wire.Build(data.ProviderSet)
    <span class="hljs-comment">// 占位返回值（生成代码时会被替换）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>
}
</code></pre>
<h5 data-id="heading-10">2.2.2 生成 Injector 代码</h5>
<p>在 <code>wire.go</code> 所在目录执行 wire 命令（需先通过 <code>go install github.com/google/wire/cmd/wire@latest</code> 安装 Wire 工具），Wire 会自动分析依赖关系，生成 wire_gen.go 文件，其中包含完整的 Injector 实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Code generated by Wire. DO NOT EDIT.</span>

<span class="hljs-comment">//go:generate go run github.com/google/wire/cmd/wire</span>
<span class="hljs-comment">//go:build !wireinject</span>
<span class="hljs-comment">// +build !wireinject</span>

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitUserStore</span><span class="hljs-params">()</span></span> (*data.UserStore, <span class="hljs-type">error</span>) {
    config := data.NewDefaultConfig()
    db, err := data.NewDB(config)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    userStore, err := data.NewUserStore(config, db)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> userStore, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>生成的代码完全模拟了手动创建对象的流程，清晰可见依赖的创建顺序（先创建 Config → 再创建 DB → 最后创建 UserStore），且包含完整的错误处理，可读性极强。</p>
<h3 data-id="heading-11">三、GoWind Admin 集成 Wire 完整实践</h3>
<p>GoWind Admin 采用 “Server 层（服务暴露）→ Service 层（业务逻辑）→ Data 层（数据访问）” 的分层架构，为避免依赖混乱，框架将各层的 Provider 单独封装在 <code>providers</code> 目录中，最终在入口处通过 Injector 统一组装。</p>
<h4 data-id="heading-12">3.1 架构设计：分层 ProviderSet 目录结构</h4>
<p>核心设计原则：<strong>每层的 ProviderSet 单独放在同级的 providers 目录中</strong>，实现业务代码与 DI 配置解耦，从物理结构上杜绝循环依赖。</p>
<p>标准目录结构如下：</p>
<pre><code class="hljs language-shell" lang="shell">internal/
├── data/                  // 数据层（仓储、数据库操作）
│   ├── user_repo.go       // 业务代码：用户仓储实现
│   └── providers/
│       └── wire_set.go    // 数据层 ProviderSet（仅 DI 配置）
├── service/               // 服务层（业务逻辑）
│   ├── user_service.go    // 业务代码：用户服务实现
│   └── providers/
│       └── wire_set.go    // 服务层 ProviderSet
└── server/                // 服务暴露层（HTTP/gRPC 服务器）
    ├── http_server.go     // 业务代码：HTTP 服务器实现
    └── providers/
        └── wire_set.go    // 服务器层 ProviderSet
cmd/
└── server/
    └── wire.go            // 全局 Injector 入口（组装所有层依赖）
</code></pre>
<h4 data-id="heading-13">3.2 各层 ProviderSet 实现</h4>
<p>每层的 <code>wire_set.go</code> 仅负责封装当前层的 Provider，不包含任何业务逻辑，确保业务代码的纯粹性。</p>
<h5 data-id="heading-14">3.2.1 数据层（data/providers/wire_set.go）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> providers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data"</span>
)

<span class="hljs-comment">// ProviderSet 数据层依赖注入集合</span>
<span class="hljs-comment">// 包含所有数据层的仓储 Provider</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    data.NewUserRepo,   <span class="hljs-comment">// 用户仓储 Provider（依赖 *sql.DB）</span>
    data.NewOrderRepo,  <span class="hljs-comment">// 订单仓储 Provider（依赖 *sql.DB）</span>
    data.NewDB,         <span class="hljs-comment">// 数据库连接 Provider（依赖 *Config）</span>
    data.NewConfig,     <span class="hljs-comment">// 配置 Provider（无依赖）</span>
)
</code></pre>
<h5 data-id="heading-15">3.2.2 服务层（service/providers/wire_set.go）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> providers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/service"</span>
)

<span class="hljs-comment">// ProviderSet 服务层依赖注入集合</span>
<span class="hljs-comment">// 依赖数据层的 ProviderSet，提供业务服务</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    service.NewUserService,  <span class="hljs-comment">// 用户服务（依赖 data.UserRepo）</span>
    service.NewOrderService, <span class="hljs-comment">// 订单服务（依赖 data.OrderRepo）</span>
)
</code></pre>
<h5 data-id="heading-16">3.2.3 服务器层（server/providers/wire_set.go）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-keyword">package</span> providers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/server"</span>
)

<span class="hljs-comment">// ProviderSet 服务器层依赖注入集合</span>
<span class="hljs-comment">// 依赖服务层的 ProviderSet，提供 HTTP/gRPC 服务器</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    server.NewHTTPServer,  <span class="hljs-comment">// HTTP 服务器（依赖 service.UserService）</span>
    server.NewGRPCServer,  <span class="hljs-comment">// gRPC 服务器（依赖 service.OrderService）</span>
)
</code></pre>
<h5 data-id="heading-17">3.2.4 ProviderSet 嵌套层级结构</h5>
<p>在企业级项目中，依赖往往复杂且多层级，通过 “原子级 → 模块聚合级 → 应用级” 的嵌套结构，可实现依赖的精细化管理。</p>
<blockquote>
<p>设计价值：分层嵌套可让依赖关系 “可视化”，新增 / 移除依赖时只需调整对应层级的 Set，无需修改全局配置，符合 “开闭原则”。</p>
</blockquote>
<h6 data-id="heading-18">第一层：原子级（Leaf Sets）—— 最小粒度依赖</h6>
<p>在每个逻辑子目录定义，仅包含单一功能的 Provider：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// internal/data/providers/wire_set.go</span>

<span class="hljs-comment">// RepoSet 仓储层原子依赖（仅仓储相关）</span>
<span class="hljs-keyword">var</span> RepoSet = wire.NewSet(NewUserRepo, NewOrderRepo)
<span class="hljs-comment">// CacheSet 缓存层原子依赖（仅缓存相关）</span>
<span class="hljs-keyword">var</span> CacheSet = wire.NewSet(NewRedisClient, NewMemcachedClient)
</code></pre>
<h6 data-id="heading-19">第二层：模块聚合级（Module Sets）—— 层级总入口</h6>
<p>将同一层的多个原子级 Set 聚合成一个总 Set，作为该层的统一出口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 仍在 internal/data/providers/wire_set.go 中</span>
<span class="hljs-comment">// ProviderSet 数据层总依赖集合（对外暴露的唯一入口）</span>
<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(RepoSet, CacheSet)
</code></pre>
<h6 data-id="heading-20">第三层：应用级（App Set）—— 全局组装</h6>
<p>在最终的 <code>wire.go</code> 中，仅聚合各层的 “总出口”，避免依赖混乱：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// app/admin/service/cmd/server/wire.go</span>
wire.Build(
    dataProviders.ProviderSet,    <span class="hljs-comment">// 数据层总依赖（含仓储+缓存）</span>
    serviceProviders.ProviderSet, <span class="hljs-comment">// 服务层总依赖（含所有业务服务）</span>
    serverProviders.ProviderSet,  <span class="hljs-comment">// 服务器层总依赖（含HTTP/gRPC）</span>
)
</code></pre>
<h4 data-id="heading-21">3.3 全局 Injector 入口（cmd/server/wire.go）</h4>
<p>入口文件负责组装所有层的 ProviderSet，生成最终的应用实例（如 Kratos 应用）。这里以 GoWind Admin 基于 Kratos 框架的实现为例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">//go:build wireinject</span>
<span class="hljs-comment">// +build wireinject</span>

<span class="hljs-comment">//go:generate go run github.com/google/wire/cmd/wire</span>

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/google/wire"</span>

    <span class="hljs-string">"github.com/go-kratos/kratos/v2"</span>
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/registry"</span>

    conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

    serverProviders <span class="hljs-string">"go-wind-admin/app/admin/service/internal/server/providers"</span>
    serviceProviders <span class="hljs-string">"go-wind-admin/app/admin/service/internal/service/providers"</span>
    dataProviders <span class="hljs-string">"go-wind-admin/app/admin/service/internal/data/providers"</span>
)

<span class="hljs-comment">// initApp 全局 Injector 签名（声明应用实例的依赖与输出）</span>
<span class="hljs-comment">// 入参：框架基础组件（日志、注册器、配置）；出参：应用实例 + 资源清理函数 + 错误</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initApp</span><span class="hljs-params">(logger log.Logger, reg registry.Registrar, cfg *conf.Bootstrap)</span></span> (*kratos.App, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>, <span class="hljs-type">error</span>) {
    <span class="hljs-built_in">panic</span>(
        wire.Build(
            serverProviders.ProviderSet, <span class="hljs-comment">// 服务器层 ProviderSet</span>
            serviceProviders.ProviderSet, <span class="hljs-comment">// 服务层 ProviderSet</span>
            dataProviders.ProviderSet, <span class="hljs-comment">// 数据库层 ProviderSet</span>
            newApp, <span class="hljs-comment">// 应用实例构造函数（依赖 HTTP/gRPC 服务器）</span>
        ),
    )
}
</code></pre>
<h4 data-id="heading-22">3.4 生成并使用 Injector</h4>
<h5 data-id="heading-23">3.4.1 安装 Wire 工具：</h5>
<pre><code class="hljs language-shell" lang="shell">go install github.com/google/wire/cmd/wire@latest
</code></pre>
<h5 data-id="heading-24">3.4.2 生成 Injector 代码：</h5>
<p>生成代码有三种方法：</p>
<ol>
<li>在<code>cmd/app</code> 目录执行 <code>wire</code> 命令；</li>
<li>执行<code>go generate ./...</code>命令；</li>
<li>在<code>app/admin/service</code>目录下执行<code>make wire</code>。</li>
</ol>
<p>执行后会生成 <code>wire_gen.go</code> 文件，包含完整的应用组装逻辑。</p>
<h5 data-id="heading-25">3.4.3 在应用启动流程中调用 Injector：</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/log"</span>
    <span class="hljs-string">"github.com/go-kratos/kratos/v2/registry/nacos"</span>

    <span class="hljs-string">"github.com/nacos-group/nacos-sdk-go/clients"</span>
    <span class="hljs-string">"github.com/nacos-group/nacos-sdk-go/common/constant"</span>
    <span class="hljs-string">"github.com/nacos-group/nacos-sdk-go/vo"</span>

    conf <span class="hljs-string">"github.com/tx7do/kratos-bootstrap/api/gen/go/conf/v1"</span>

    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/bootstrap"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 初始化配置、日志、服务注册器（框架基础组件）</span>
    cfg := bootstrap.InitConfig()
    logger := bootstrap.InitLogger(cfg)
    reg := nacos.New(cfg.Nacos.Addrs, nacos.WithClientConfig(&amp;constant.ClientConfig{
        NamespaceId: cfg.Nacos.NamespaceId,
    }))

    <span class="hljs-comment">// 2. 调用 Wire 生成的 Injector，创建应用实例</span>
    app, cleanup, err := initApp(logger, reg, cfg)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"failed to init app: %v"</span>, err)
    }
    <span class="hljs-keyword">defer</span> cleanup() <span class="hljs-comment">// 资源清理</span>

    <span class="hljs-comment">// 3. 启动应用</span>
    <span class="hljs-keyword">if</span> err := app.Run(); err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"failed to run app: %v"</span>, err)
    }
}
</code></pre>
<h3 data-id="heading-26">四、分层 ProviderSet 设计的核心优势</h3>
<p>GoWind Admin 采用 “每层独立 <code>providers</code> 目录” 的设计，而非将 ProviderSet 与业务代码混放，核心解决了企业级开发中的三大痛点：</p>
<h4 data-id="heading-27">4.1 降低维护成本</h4>
<p>调整某一层的依赖时，可直接定位到 <code>[层名]/providers/wire_set.go</code>，无需在业务代码中查找 DI 配置，符合 “约定优于配置” 的设计理念，减少团队认知负担。</p>
<h4 data-id="heading-28">4.2 杜绝循环依赖</h4>
<p>严格遵循 “上层依赖下层，下层不依赖上层” 的规则（如 Service 依赖 Data，Data 不依赖 Service）；同时 <code>providers</code> 目录仅引用同级业务目录，业务目录不引用 <code>providers</code> 目录，从物理结构上彻底避免循环依赖。</p>
<h4 data-id="heading-29">4.3 支持增量开发</h4>
<p>新增层（如缓存层、消息队列层）时，只需创建 <code>cache/providers/wire_set.go</code>，在上级 ProviderSet 中嵌套引用即可完成集成，无需修改现有业务代码，符合 “开闭原则”。</p>
<h3 data-id="heading-30">五、企业级实践：常见问题与解决方案</h3>
<h4 data-id="heading-31">5.1 编译期错误排查</h4>
<p>Wire 生成代码时若报错，多为以下原因：</p>

























<table><thead><tr><th>错误类型</th><th>典型场景</th><th>解决方案</th></tr></thead><tbody><tr><td>依赖缺失</td><td>Provider 参数无对应 Provider</td><td>检查 <code>wire.Build</code> 中是否包含该依赖的 ProviderSet</td></tr><tr><td>循环依赖</td><td>A 依赖 B，B 依赖 A</td><td>通过接口解耦；调整分层结构，确保依赖单向流动</td></tr><tr><td>返回值不匹配</td><td>Provider 返回值类型不符</td><td>检查 Provider 函数返回值与依赖类型是否一致</td></tr></tbody></table>
<h4 data-id="heading-32">5.2 代码生成规范</h4>
<ul>
<li>严禁手动修改 <code>wire_gen.go</code>：该文件为自动生成，修改后会被下次 <code>wire</code> 命令覆盖；</li>
<li>添加 <code>go:generate</code> 注释：在 <code>wire.go</code> 头部添加 <code>//go:generate go run github.com/google/wire/cmd/wire</code>，可通过 <code>go generate</code> 批量生成所有 Injector 代码；</li>
<li>版本控制：将 <code>wire_gen.go</code> 纳入版本控制，确保团队使用相同的依赖组装逻辑。</li>
</ul>
<h4 data-id="heading-33">5.3 高级技巧：接口与实现绑定</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 定义接口</span>
<span class="hljs-keyword">type</span> UserRepo <span class="hljs-keyword">interface</span> {
    GetUser(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>)
}

<span class="hljs-comment">// Mock 实现</span>
<span class="hljs-keyword">type</span> MockUserRepo <span class="hljs-keyword">struct</span>{}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MockUserRepo)</span></span> GetUser(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> &amp;User{ID: id, Name: <span class="hljs-string">"mock"</span>}, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Provider</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMockUserRepo</span><span class="hljs-params">()</span></span> UserRepo {
    <span class="hljs-keyword">return</span> &amp;MockUserRepo{}
}

<span class="hljs-comment">// 在 Injector 中绑定</span>
wire.Build(
    wire.Bind(<span class="hljs-built_in">new</span>(UserRepo), <span class="hljs-built_in">new</span>(*MockUserRepo)), <span class="hljs-comment">// 绑定接口与 Mock 实现</span>
    NewMockUserRepo,
)
</code></pre>
<h3 data-id="heading-34">六、小结</h3>
<p>Wire 作为 Google 开源的编译期依赖注入工具，以 “无反射、编译期校验、代码可读性高” 的优势，完美适配企业级中后台系统的稳定性需求。GoWind Admin 基于 Wire 设计的 “分层 ProviderSet” 方案，实现了依赖注入逻辑与业务逻辑的彻底解耦：</p>
<ul>
<li>从架构上，通过 “原子级 → 模块聚合级 → 应用级” 的嵌套结构，让依赖关系可视化；</li>
<li>从工程上，通过独立 <code>providers</code> 目录，杜绝循环依赖、降低维护成本；</li>
<li>从开发上，通过自动生成 Injector 代码，减少手动组装依赖的重复工作。</li>
</ul>
<p>该方案不仅适用于 GoWind Admin，也可直接复用到其他 Go 语言中后台项目，帮助团队快速落地规范的依赖注入实践，提升代码质量与开发效率。</p>
<h4 data-id="heading-35">七、项目仓库</h4>
<ul>
<li>GoWind Admin（Gitee）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">gitee.com/tx7do/go-wi…</a></li>
<li>GoWind Admin（GitHub）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">github.com/tx7do/go-wi…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[c++11 之 智能指针]]></title>    <link>https://juejin.cn/post/7583906870827565065</link>    <guid>https://juejin.cn/post/7583906870827565065</guid>    <pubDate>2025-12-15T12:06:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906870827565065" data-draft-id="7576124206397341706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="c++11 之 智能指针"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-15T12:06:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GuSir"/> <meta itemprop="url" content="https://juejin.cn/user/3261574409623161"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            c++11 之 智能指针
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261574409623161/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GuSir
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:06:17.000Z" title="Mon Dec 15 2025 12:06:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一. 为什么会有智能指针</h2>
<p>c++ 引入智能指针（Smart Pointers）的核心目的，是 <strong>解决传统 raw pointer（裸指针）的三大核心问题</strong>，同时在不丧失 C++ 底层控制能力的前提下，引入更安全、更符合现代编程范式的内存管理机制。</p>
<h3 data-id="heading-1">1. 内存泄漏（Memory Leak）</h3>
<p>当动态分配的内存（<code>new</code> 出来的）没有被手动 <code>delete</code> 时，这块内存会一直占用，直到程序结束。</p>
<ul>
<li>函数提前返回（比如中间有 <code>if</code> 分支跳过 <code>delete</code>）；</li>
<li>异常抛出（<code>try</code> 块中 <code>new</code>，<code>catch</code> 块中未处理 <code>delete</code>）；</li>
<li>逻辑疏忽（忘记写 <code>delete</code>）。</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 动态分配内存</span>
    <span class="hljs-keyword">if</span> (some_condition) {
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 提前返回，p 指向的内存未释放 → 内存泄漏</span>
    }
    <span class="hljs-keyword">delete</span> p; <span class="hljs-comment">// 正常路径才释放，异常/提前返回时失效</span>
}
</code></pre>
<h3 data-id="heading-2">2. 野指针（Dangling Pointer）</h3>
<p>当指针指向的内存被释放（<code>delete</code>）后，指针本身没有被置为 <code>nullptr</code>，后续仍可能被访问 / 操作，导致：</p>
<ul>
<li>程序崩溃（访问已释放的内存）；</li>
<li>数据错乱（内存被重新分配给其他对象，旧指针访问到无效数据）。</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">delete</span> p; <span class="hljs-comment">// 内存释放，但 p 仍指向原地址（野指针）</span>
cout &lt;&lt; *p; <span class="hljs-comment">// 未定义行为（UB），可能崩溃或输出垃圾值</span>
</code></pre>
<h3 data-id="heading-3">3. 二次释放（Double Free）</h3>
<p>同一内存被 <code>delete</code> 两次，会导致程序崩溃（内存管理机制检测到非法释放）.</p>
<p>示例 :</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-type">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>);
<span class="hljs-keyword">delete</span> p; 
<span class="hljs-keyword">delete</span> p; <span class="hljs-comment">// 二次释放 → 程序崩溃</span>
</code></pre>
<h2 data-id="heading-4">二. 智能指针的核心设计理念</h2>
<p><strong>RAII + 所有权语义</strong></p>
<p>智能指针本质是  <strong>“封装裸指针的类模板”</strong> ，其核心机制是：</p>
<ol>
<li>
<p><strong>RAII（资源获取即初始化）</strong> ：利用类的构造函数获取资源（如动态内存），析构函数自动释放资源（无需手动 <code>delete</code>）。因为 C++ 保证：对象生命周期结束时（如离开作用域、函数返回），其析构函数一定会被调用。</p>
</li>
<li>
<p><strong>所有权语义（Ownership Semantics）</strong> ：明确指针指向的内存 “归谁所有”，避免多指针混乱操作（比如 <code>std::unique_ptr</code> 独占所有权，<code>std::shared_ptr</code> 共享所有权）</p>
</li>
</ol>
<blockquote>
<p><strong>RAII</strong> 理解可以继续深入理解一下，这是一种编程范式</p>
</blockquote>
<h2 data-id="heading-5">三. 共享智能指帧 <code>std::shared_ptr</code></h2>
<p>核心特点是允许多个 <code>shared_ptr</code> 指向同一块动态内存，通过<strong>引用计数（Reference Counting）</strong>  管理内存生命周期：当最后一个指向该内存的 <code>shared_ptr</code> 被销毁 / 重置时，才会自动释放内存。</p>
<h3 data-id="heading-6">（1）引用计数机制</h3>
<ul>
<li><code>shared_ptr</code> 内部维护两个指针：
<ul>
<li>指向实际数据的<strong>裸指针</strong>（data pointer）；</li>
<li>指向控制块（control block）的指针（存储引用计数、析构函数、分配器等）</li>
</ul>
</li>
<li>每新增一个 <code>shared_ptr</code> 指向同一资源，引用计数 +1；</li>
<li>每销毁 / 重置一个 <code>shared_ptr</code>，引用计数 -1；</li>
<li>当引用计数降至 0 时，自动调用 <code>delete</code>（或自定义删除器）释放资源，并销毁控制块。</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyInt</span> {
    <span class="hljs-type">int</span> val;
    <span class="hljs-built_in">MyInt</span>(<span class="hljs-type">int</span> v) : <span class="hljs-built_in">val</span>(v) {
        <span class="hljs-comment">// std::cout &lt;&lt; "MyInt 构造：" &lt;&lt; val &lt;&lt; std::endl;</span>
    }
    ~<span class="hljs-built_in">MyInt</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"MyInt 析构："</span> &lt;&lt; val &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;MyInt&gt;&amp; ptr)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-comment">// 赋值新的 shared_ptr</span>
    ptr = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">20</span>);

    std::shared_ptr&lt;MyInt&gt; ptr2 = ptr;

    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;MyInt&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"sp 指向的值："</span> &lt;&lt; sp-&gt;val &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>执行结果:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13299364b93944098918a9fd261efe0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR3VTaXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766405177&amp;x-signature=sWnXNHrTolzBldR9fr4afv%2BaBMA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">（2）独占性（相对）与拷贝 / 赋值</h3>
<ul>
<li>支持<strong>拷贝构造</strong>和<strong>赋值运算符</strong>：拷贝 / 赋值时仅增加引用计数，不深拷贝数据；</li>
<li>不同于 <code>unique_ptr</code>（不可拷贝），<code>shared_ptr</code> 可自由拷贝、作为函数参数传递（值传递）、存入容器（如 <code>std::vector&lt;std::shared_ptr&lt;T&gt;&gt;</code>）。</li>
</ul>
<p>//详细解释，结合传参</p>
<h3 data-id="heading-8">（3）自定义删除器</h3>
<p><code>shared_ptr</code> 支持自定义删除器（Deletor），用于替代默认的 <code>delete</code>，适配特殊场景（如数组、文件句柄、内存池分配的内存等）。</p>
<blockquote>
<p>在计数到0的时候，就会执行删除器，-   如果只是“复制”或“赋值”产生新的 shared_ptr，引用计数仍 &gt;0，删除器不会被执行。</p>
</blockquote>
<h4 data-id="heading-9">场景 A:数组</h4>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">sp</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>],          <span class="hljs-comment">// 裸指针</span>
                       [](<span class="hljs-type">int</span>* p){ <span class="hljs-keyword">delete</span>[] p; } <span class="hljs-comment">// 自定义删除器</span>
)</span></span>;
</code></pre>
<h4 data-id="heading-10">场景 B:文件句柄</h4>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">auto</span> file_deleter = [](FILE* fp){
    <span class="hljs-keyword">if</span>(fp) <span class="hljs-built_in">fclose</span>(fp);
};
<span class="hljs-function">std::shared_ptr&lt;FILE&gt; <span class="hljs-title">sp</span><span class="hljs-params">(fopen(<span class="hljs-string">"log.txt"</span>,<span class="hljs-string">"w"</span>), file_deleter)</span></span>;
</code></pre>
<h4 data-id="heading-11">场景 C：内存池</h4>
<pre><code class="hljs language-arduino" lang="arduino">MemoryPool pool;
<span class="hljs-function">std::shared_ptr&lt;Foo&gt; <span class="hljs-title">sp</span><span class="hljs-params">(
    <span class="hljs-keyword">static_cast</span>&lt;Foo*&gt;(pool.allocate()),
    [&amp;pool](Foo* p){ pool.deallocate(p); }
)</span></span>;
</code></pre>
<h4 data-id="heading-12">场景 D：函数对象当删除器</h4>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">VerboseDeleter</span>{
    std::string name;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(Widget* w)</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"destroying "</span> &lt;&lt; name &lt;&lt; <span class="hljs-string">'\n'</span>;
        <span class="hljs-keyword">delete</span> w;
    }
};
<span class="hljs-function">std::shared_ptr&lt;Widget&gt; <span class="hljs-title">pw</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Widget, VerboseDeleter{<span class="hljs-string">"widget#1"</span>})</span></span>;
</code></pre>
<h3 data-id="heading-13">（4）空指针安全</h3>
<ul>
<li>空的 <code>shared_ptr</code>（未指向任何资源）引用计数为 0，操作（如 <code>reset()</code>、<code>use_count()</code>）不会触发未定义行为；</li>
<li>可通过 <code>operator bool()</code> 判断是否指向有效资源：</li>
</ul>
<pre><code class="hljs language-cpp" lang="cpp">std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; p;
<span class="hljs-keyword">if</span> (p) { <span class="hljs-comment">// 等价于 p != nullptr</span>
    std::cout &lt;&lt; *p &lt;&lt; std::endl;
} <span class="hljs-keyword">else</span> {
    std::cout &lt;&lt; <span class="hljs-string">"p 为空"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出该行</span>
}
</code></pre>
<h3 data-id="heading-14">（5）大小与性能</h3>
<ul>
<li><code>shared_ptr</code> 大小通常是<strong>裸指针的 2 倍</strong>（存储数据指针 + 控制块指针）；</li>
<li>引用计数的增减是<strong>原子操作</strong>（线程安全），但存在轻微的性能开销（相比裸指针 /<code>unique_ptr</code>）；</li>
<li>注意：引用计数线程安全 ≠ 数据访问线程安全：多个线程同时修改 <code>shared_ptr</code> 指向的数据，仍需加锁。</li>
</ul>
<h3 data-id="heading-15">（6）避免循环引用（核心坑点）</h3>
<p><code>shared_ptr</code> 的最大问题是<strong>循环引用</strong>：两个（或多个）<code>shared_ptr</code> 互相指向对方，导致引用计数无法降至 0，内存泄漏。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Node</span> {
    std::shared_ptr&lt;Node&gt; next; <span class="hljs-comment">// 共享所有权</span>
    ~<span class="hljs-built_in">Node</span>() { std::cout &lt;&lt; <span class="hljs-string">"Node 析构"</span> &lt;&lt; std::endl; }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">std::shared_ptr&lt;Node&gt; <span class="hljs-title">n1</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Node)</span></span>;
    <span class="hljs-function">std::shared_ptr&lt;Node&gt; <span class="hljs-title">n2</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Node)</span></span>;
    n1-&gt;next = n2; <span class="hljs-comment">// n1 引用 n2</span>
    n2-&gt;next = n1; <span class="hljs-comment">// n2 引用 n1 → 循环引用</span>
    <span class="hljs-comment">// 函数结束时，n1/n2 销毁，但引用计数仍为1，内存泄漏（析构函数不执行）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-16">（7）避免从裸指针多次构造 shared_ptr</h3>
<p>同一裸指针多次构造 <code>shared_ptr</code>，会导致多个独立的控制块，最终触发<strong>二次释放</strong>：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span>* raw = new <span class="hljs-type">int</span>(<span class="hljs-number">10</span>);
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title function_">p1</span><span class="hljs-params">(raw)</span>;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title function_">p2</span><span class="hljs-params">(raw)</span>; <span class="hljs-comment">// 错误：p1和p2各有独立控制块，析构时两次delete raw</span>
</code></pre>
<h3 data-id="heading-17">（8）优先使用 std::make_shared</h3>
<ul>
<li>更高效：一次性分配数据内存 + 控制块内存（裸指针构造需两次分配：数据 + 控制块）；</li>
<li>更安全：避免异常安全问题（如 <code>func(shared_ptr&lt;int&gt;(new int), other_func())</code> 可能因编译器优化导致内存泄漏）；</li>
<li>语法简洁：无需手动写 <code>new</code>。</li>
</ul>
<blockquote>
<p>限制：<code>make_shared</code> 无法直接指定自定义删除器（需通过 <code>shared_ptr</code> 构造函数配合）。</p>
</blockquote>
<h3 data-id="heading-18">（9）不要将 shared_ptr 存储在全局 / 静态变量中（谨慎）</h3>
<p>全局 <code>shared_ptr</code> 的析构顺序不确定，可能导致资源释放时依赖的对象已销毁，引发未定义行为。而且这个对象死的可能比main还晚</p>
<h3 data-id="heading-19">（10）线程安全说明</h3>
<ul>
<li><strong>引用计数操作</strong>：<code>shared_ptr</code> 的引用计数增减是原子操作，多线程拷贝 / 重置 <code>shared_ptr</code> 本身是线程安全的；</li>
<li><strong>数据访问</strong>：多线程同时读写 <code>shared_ptr</code> 指向的数据，<strong>不是线程安全的</strong>，需通过互斥锁（如 <code>std::mutex</code>）保护；</li>
<li><strong>同一 shared_ptr 对象的修改</strong>：多线程同时修改同一个 <code>shared_ptr</code> 对象（如 <code>p.reset()</code>），不是线程安全的，需加锁。</li>
</ul>
<h3 data-id="heading-20">（11）补充：shared_ptr 作为函数参数时的引用计数行为</h3>
<ul>
<li>
<p><strong>值传递：引用计数 +1，函数结束 -1</strong></p>
<p>当 <code>shared_ptr</code> 以<strong>值传递</strong>方式作为函数参数时，会触发 <code>shared_ptr</code> 的<strong>拷贝构造</strong>：</p>
<ol>
<li>函数调用时，实参的 <code>shared_ptr</code> 拷贝给形参，引用计数  <strong>+1</strong>；</li>
<li>函数执行结束后，形参出作用域被销毁，引用计数 <strong>-1</strong>；</li>
<li>最终引用计数回到调用前的状态。</li>
<li/>
</ol>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; ptr)</span> </span>{ <span class="hljs-comment">// 值传递，拷贝构造</span>
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 2</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>优缺点</strong></p>
<ul>
<li>
<p><strong>优点</strong>：函数内对形参的修改（如 <code>ptr = nullptr</code>）不会影响实参，逻辑隔离；</p>
</li>
<li>
<p><strong>缺点</strong>：</p>
<ol>
<li>拷贝 <code>shared_ptr</code> 有开销（原子操作 + 指针拷贝），高频调用时性能损耗明显；</li>
<li>若函数内长期持有形参（如存储到全局容器），可能导致引用计数长期不为 0，内存无法及时释放。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>非 const 引用传递：引用计数不变</strong></p>
<p>当 <code>shared_ptr</code> 以<strong>非 const 引用（<code>shared_ptr&lt;T&gt;&amp;</code>）</strong>  传递时，形参是实参的别名，不会触发拷贝构造，因此<strong>引用计数始终不变</strong>。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyInt</span> {
    <span class="hljs-type">int</span> val;
    <span class="hljs-built_in">MyInt</span>(<span class="hljs-type">int</span> v) : <span class="hljs-built_in">val</span>(v) {
        std::cout &lt;&lt; <span class="hljs-string">"MyInt 构造："</span> &lt;&lt; val &lt;&lt; std::endl;
    }
    ~<span class="hljs-built_in">MyInt</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"MyInt 析构："</span> &lt;&lt; val &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;MyInt&gt;&amp; ptr)</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-comment">// 赋值新的 shared_ptr</span>
    ptr = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">20</span>);
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;MyInt&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;MyInt&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"sp 指向的值："</span> &lt;&lt; sp-&gt;val &lt;&lt; std::endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<blockquote>
<p>注意这里方法执行，重新创建一个对象的时候，会析构原来的</p>
</blockquote>
<p><strong>优缺点</strong></p>
<ul>
<li>
<p><strong>优点</strong>：函数内对形参的修改（如 <code>ptr = nullptr</code>）不会影响实参，逻辑隔离；</p>
</li>
<li>
<p><strong>缺点</strong>：</p>
<ol>
<li>拷贝 <code>shared_ptr</code> 有开销（原子操作 + 指针拷贝），高频调用时性能损耗明显；</li>
<li>若函数内长期持有形参（如存储到全局容器），可能导致引用计数长期不为 0，内存无法及时释放。</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>const 引用传递：引用计数不变</strong></p>
<p>当 <code>shared_ptr</code> 以<strong>const 引用（<code>const shared_ptr&lt;T&gt;&amp;</code>）</strong>  传递时，形参是实参的只读别名，同样不触发拷贝构造，<strong>引用计数不变</strong>；且函数内无法修改形参（如赋值、置空），避免了非 const 引用的风险。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;<span class="hljs-type">int</span>&gt;&amp; ptr)</span> </span>{ <span class="hljs-comment">// const 引用传递</span>
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-comment">// ptr = std::make_shared&lt;int&gt;(20); // 编译错误：const 引用不可修改</span>
    *ptr = <span class="hljs-number">20</span>; <span class="hljs-comment">// 允许修改指向的资源（仅限制 shared_ptr 本身，不限制资源）</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"调用前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-built_in">func</span>(sp);
    std::cout &lt;&lt; <span class="hljs-string">"调用后引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    std::cout &lt;&lt; <span class="hljs-string">"sp 指向的值："</span> &lt;&lt; *sp &lt;&lt; std::endl; <span class="hljs-comment">// 输出 20</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>优缺点</strong></p>
<ul>
<li><strong>优点</strong>：无拷贝开销，性能优；只读特性避免了意外修改实参的风险，是最安全的传参方式；</li>
<li><strong>缺点</strong>：若函数内需要长期持有该 <code>shared_ptr</code>（如存储到容器），const 引用可能悬空（实参销毁后引用失效），需手动拷贝（此时引用计数会 +1）。</li>
</ul>
</li>
<li>
<p><strong>移动语义（std::move）传递</strong></p>
<p>若通过 <code>std::move</code> 将 <code>shared_ptr</code> 以值传递方式传入函数，会触发<strong>移动构造</strong>：</p>
<ol>
<li>实参的 <code>shared_ptr</code> 所有权转移给形参，引用计数 <strong>保持不变</strong>（而非 +1）；</li>
<li>实参变为 “空” 状态（<code>use_count() == 0</code>），不再管理资源；</li>
<li>函数结束后形参析构，引用计数 -1，若此时无其他持有者，资源被释放。</li>
</ol>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">(std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; ptr)</span> </span>{ <span class="hljs-comment">// 值传递 + std::move</span>
    std::cout &lt;&lt; <span class="hljs-string">"func 内引用计数："</span> &lt;&lt; ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    std::cout &lt;&lt; <span class="hljs-string">"move 前引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 1</span>
    <span class="hljs-built_in">func</span>(std::<span class="hljs-built_in">move</span>(sp));
    std::cout &lt;&lt; <span class="hljs-string">"move 后实参引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 输出 0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>移动构造会 “窃取” 实参的资源指针和引用计数，实参的内部指针被置空，因此引用计数不会增加（仅所有权转移）；适用于不再使用实参的场景，避免拷贝开销。</p>
</li>
</ul>
<h2 data-id="heading-21">四. 独享智能指帧 <code>std::unique_ptr</code></h2>
<p><code>std::unique_ptr</code> 是 C++11 引入的<strong>独占式智能指针</strong>，用于管理动态分配的内存，核心特性是<strong>所有权唯一</strong>—— 同一时间只有一个 <code>unique_ptr</code> 指向某个对象，销毁时自动释放内存，彻底避免内存泄漏和手动 <code>delete</code> 的风险。使用相对共享指针要简单，但却是最常用的智能指针。</p>
<ol>
<li><strong>独占所有权</strong>：不可拷贝（C++11），仅可移动（move），确保对象只有一个管理者；</li>
<li><strong>自动释放</strong>：<code>unique_ptr</code> 析构时（如离开作用域、被重置），自动调用 <code>delete</code> 释放所管理的内存；</li>
<li><strong>轻量级</strong>：无额外开销（大小等同于原始指针），支持自定义删除器；</li>
<li><strong>支持数组</strong>：C++11 原生支持管理动态数组（<code>unique_ptr&lt;T[]&gt;</code>）。</li>
</ol>
<p>简单用法，单个对象:</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 方式1：直接构造（C++11 推荐）</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr1</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">10</span>))</span></span>;

<span class="hljs-comment">// 方式2：make_unique（C++14 引入，更安全，避免内存泄漏）</span>
<span class="hljs-comment">// C++11 无 make_unique，可自行实现</span>
unique_ptr&lt;<span class="hljs-type">int</span>&gt; ptr2 = <span class="hljs-built_in">make_unique</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">20</span>);

<span class="hljs-comment">// 空 unique_ptr</span>
unique_ptr&lt;<span class="hljs-type">int</span>&gt; ptr3; <span class="hljs-comment">// 初始化为 nullptr</span>
</code></pre>
<p>管理动态数组：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 管理 int 数组，析构时自动调用 delete[]</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[]&gt; <span class="hljs-title">arr_ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">5</span>]{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>})</span></span>;
<span class="hljs-comment">// 访问数组元素</span>
cout &lt;&lt; arr_ptr[<span class="hljs-number">0</span>] &lt;&lt; endl; <span class="hljs-comment">// 输出 1</span>
</code></pre>
<p>通过 <code>*</code> 解引用（单个对象）或 <code>-&gt;</code>（成员访问），或 <code>[]</code>（数组）：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Person</span> {
    string name;
    <span class="hljs-type">int</span> age;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>{ cout &lt;&lt; name &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; age &lt;&lt; endl; }
};

<span class="hljs-comment">// 单个对象</span>
<span class="hljs-function">unique_ptr&lt;Person&gt; <span class="hljs-title">p</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Person{<span class="hljs-string">"Alice"</span>, <span class="hljs-number">20</span>})</span></span>;
cout &lt;&lt; (*p).name &lt;&lt; endl; <span class="hljs-comment">// 解引用访问成员</span>
cout &lt;&lt; p-&gt;age &lt;&lt; endl;    <span class="hljs-comment">// -&gt; 访问成员</span>
p-&gt;<span class="hljs-built_in">show</span>();                 <span class="hljs-comment">// 调用成员函数</span>

<span class="hljs-comment">// 数组</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[]&gt; <span class="hljs-title">arr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">3</span>]{<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>})</span></span>;
cout &lt;&lt; arr[<span class="hljs-number">1</span>] &lt;&lt; endl; <span class="hljs-comment">// 输出 20</span>
</code></pre>
<p><strong>重置与释放</strong></p>
<ul>
<li><code>reset()</code>：释放当前管理的对象，可选传入新指针；</li>
<li><code>release()</code>：释放所有权（返回原始指针），但不释放内存（需手动管理）；</li>
<li><code>nullptr</code> 赋值：等价于 <code>reset()</code>。</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">50</span>))</span></span>;

<span class="hljs-comment">// 重置（释放原内存，指向新对象）</span>
ptr.<span class="hljs-built_in">reset</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">60</span>));
cout &lt;&lt; *ptr &lt;&lt; endl; <span class="hljs-comment">// 输出 60</span>

<span class="hljs-comment">// 重置为空（释放原内存）</span>
ptr.<span class="hljs-built_in">reset</span>();
cout &lt;&lt; (ptr ? <span class="hljs-string">"非空"</span> : <span class="hljs-string">"空"</span>) &lt;&lt; endl; <span class="hljs-comment">// 输出 空</span>

<span class="hljs-comment">// release()：释放所有权，返回原始指针</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr2</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">70</span>))</span></span>;
<span class="hljs-type">int</span>* raw_ptr = ptr2.<span class="hljs-built_in">release</span>(); 
cout &lt;&lt; *raw_ptr &lt;&lt; endl; <span class="hljs-comment">// 输出 70</span>
<span class="hljs-keyword">delete</span> raw_ptr; <span class="hljs-comment">// 必须手动释放，否则内存泄漏</span>
ptr2.<span class="hljs-built_in">reset</span>(); <span class="hljs-comment">// ptr2 已空，重置无影响</span>
</code></pre>
<p><strong>自定义删除器</strong></p>
<p>默认删除器调用 <code>delete</code>/<code>delete[]</code>，但可自定义删除器（如管理 <code>FILE*</code>、动态库句柄等）。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 自定义删除器：关闭文件</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">close_file</span><span class="hljs-params">(FILE* fp)</span> </span>{
    <span class="hljs-keyword">if</span> (fp) {
        <span class="hljs-built_in">fclose</span>(fp);
        cout &lt;&lt; <span class="hljs-string">"文件已关闭"</span> &lt;&lt; endl;
    }
}

<span class="hljs-comment">// 创建 unique_ptr，指定删除器类型</span>
<span class="hljs-function">unique_ptr&lt;FILE, <span class="hljs-title">decltype</span><span class="hljs-params">(&amp;close_file)</span>&gt; <span class="hljs-title">file_ptr</span><span class="hljs-params">(fopen(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"w"</span>), close_file)</span></span>;
<span class="hljs-keyword">if</span> (file_ptr) {
    <span class="hljs-built_in">fputs</span>(<span class="hljs-string">"hello unique_ptr"</span>, file_ptr.<span class="hljs-built_in">get</span>());
}
<span class="hljs-comment">// 析构时自动调用 close_file</span>
</code></pre>
<p><strong>Lambda 作为删除器（更简洁）</strong></p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 管理动态数组，自定义删除器（示例，实际 delete[] 已足够）</span>
<span class="hljs-keyword">auto</span> deleter = [](<span class="hljs-type">int</span>* arr) {
    cout &lt;&lt; <span class="hljs-string">"释放数组内存"</span> &lt;&lt; endl;
    <span class="hljs-keyword">delete</span>[] arr;
};
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>[], <span class="hljs-title">decltype</span><span class="hljs-params">(deleter)</span>&gt; <span class="hljs-title">arr_ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">3</span>], deleter)</span></span>;
</code></pre>
<p><strong>其他常用成员函数</strong></p>

















<table><thead><tr><th><code>get()</code></th><th>返回原始指针（仅访问，不释放所有权）</th></tr></thead><tbody><tr><td><code>swap()</code></td><td>交换两个 <code>unique_ptr</code> 的所有权</td></tr><tr><td><code>operator bool()</code></td><td>判断是否指向有效对象（非空）</td></tr></tbody></table>
<p><strong>场景使用场景</strong></p>
<ul>
<li>替代原始指针，避免内存泄漏</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func</span>()</span> {
    <span class="hljs-built_in">int</span>* ptr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>);
    <span class="hljs-comment">// 若中间抛出异常，delete 不会执行，内存泄漏</span>
    delete ptr;
}

<span class="hljs-comment">// unique_ptr：自动释放</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func_safe</span>()</span> {
    <span class="hljs-function">unique_ptr&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-title">ptr</span>(<span class="hljs-params"><span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span></span>))</span>;
    <span class="hljs-comment">// 即使抛出异常，析构时自动释放</span>
}
</code></pre>
<ul>
<li>作为函数返回值（移动语义自动生效）</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">unique_ptr&lt;Person&gt; <span class="hljs-title">create_person</span><span class="hljs-params">(string name, <span class="hljs-type">int</span> age)</span> </span>{
    <span class="hljs-comment">// C++11 中，返回值会自动移动（无需显式 std::move）</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unique_ptr</span>&lt;Person&gt;(<span class="hljs-keyword">new</span> Person{name, age});
}

<span class="hljs-comment">// 调用</span>
<span class="hljs-keyword">auto</span> p = <span class="hljs-built_in">create_person</span>(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">25</span>);
p-&gt;<span class="hljs-built_in">show</span>(); <span class="hljs-comment">// 输出 Bob, 25</span>
</code></pre>
<ul>
<li>存储在容器中</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">vector&lt;unique_ptr&lt;<span class="hljs-type">int</span>&gt;&gt; vec;
<span class="hljs-comment">// 方式1：emplace_back 直接构造</span>
vec.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>));
<span class="hljs-comment">// 方式2：move 插入</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">20</span>))</span></span>;
vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">move</span>(ptr));

<span class="hljs-comment">// 遍历容器</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; p : vec) {
    cout &lt;&lt; *p &lt;&lt; <span class="hljs-string">" "</span>; <span class="hljs-comment">// 输出 10 20</span>
}
</code></pre>
<p><strong>其他事项</strong></p>
<ul>
<li><strong>禁止拷贝</strong>：C++11 中 <code>unique_ptr</code> 的拷贝构造和拷贝赋值被 <code>delete</code></li>
<li><strong>避免裸指针与智能指针混用</strong>：不要用 <code>get()</code> 返回的指针创建新的 <code>unique_ptr</code>，否则会重复释放；</li>
</ul>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">10</span>))</span></span>;
<span class="hljs-comment">// 错误：两个 unique_ptr 管理同一内存，析构时双重释放</span>
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr2</span><span class="hljs-params">(ptr.get())</span></span>; 
</code></pre>
<ul>
<li><strong><code>make_unique</code> 更安全</strong>：C++14 引入 <code>make_unique</code>，避免 “new 表达式” 和 “智能指针构造” 之间的异常安全问题，C++11 可自行实现：</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
unique_ptr&lt;T&gt; <span class="hljs-title">make_unique</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unique_ptr</span>&lt;T&gt;(<span class="hljs-keyword">new</span> <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...));
}
</code></pre>
<p>-<strong>数组管理</strong>：<code>unique_ptr&lt;T[]&gt;</code> 不支持 <code>*</code> 和 <code>-&gt;</code>，仅支持 <code>[]</code> 访问；</p>
<ul>
<li><strong>不要管理栈内存</strong>：<code>unique_ptr</code> 仅用于管理堆内存（<code>new</code>/<code>new[]</code> 分配），若指向栈对象，析构时会调用 <code>delete</code>，导致未定义行为：</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">int</span> a = <span class="hljs-number">10</span>;
<span class="hljs-function">unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ptr</span><span class="hljs-params">(&amp;a)</span></span>; <span class="hljs-comment">// 错误：栈内存不能被 delete</span>
</code></pre>
<h2 data-id="heading-22">五. 弱引用智能指正 <code>std::weak_ptr</code></h2>
<p><code>std::weak_ptr</code> 是 C++11 引入的智能指针，<strong>专门用于解决 <code>std::shared_ptr</code> 循环引用导致的内存泄漏问题</strong>，它本身不管理对象的生命周期，仅作为 <code>shared_ptr</code> 的 “弱引用”—— 既可以访问共享对象，又不会增加引用计数。</p>
<p><strong>核心特性</strong></p>
<ol>
<li><strong>不增加引用计数</strong>：绑定到 <code>shared_ptr</code> 时，不会改变其引用计数，因此不会阻止对象被销毁</li>
<li><strong>可检测对象是否存活</strong>：通过 <code>expired()</code> 或 <code>lock()</code> 检查所指向的对象是否已被销毁</li>
<li><strong>不能直接解引用</strong>：必须先通过 <code>lock()</code> 转换为 <code>shared_ptr</code>，才能安全访问对象（避免访问已销毁的对象）</li>
<li><strong>线程安全</strong>：与 <code>shared_ptr</code> 类似，读操作线程安全，写操作（如 <code>lock()</code>）需加锁</li>
</ol>
<blockquote>
<p><code>lock()</code> 是特殊的 “写操作”—— 它会先检查 <code>use_count</code>（读），若对象存活则创建 <code>shared_ptr</code>，此时会<strong>原子性增加 <code>use_count</code></strong>（写）</p>
</blockquote>
<p><strong>基本用法</strong>
<code>std::weak_ptr</code> 不能直接指向裸指针，必须通过 <code>shared_ptr</code> 初始化或赋值：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 1. 通过 shared_ptr 初始化</span>
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">10</span>);
    <span class="hljs-function">std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">wp</span><span class="hljs-params">(sp)</span></span>; <span class="hljs-comment">// 引用计数仍为 1</span>

    <span class="hljs-comment">// 2. 空 weak_ptr</span>
    std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; wp_empty;

    <span class="hljs-comment">// 3. 赋值操作</span>
    std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; wp2;
    wp2 = sp; <span class="hljs-comment">// 引用计数仍为 1</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>核心成员函数</strong></p>





























<table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>lock()</code></td><td>转换为 <code>shared_ptr</code>：若对象存活，返回指向该对象的 <code>shared_ptr</code>；否则返回空 <code>shared_ptr</code></td></tr><tr><td><code>expired()</code></td><td>判断对象是否已销毁（引用计数为 0），返回 <code>bool</code></td></tr><tr><td><code>reset()</code></td><td>清空 <code>weak_ptr</code>，不再引用任何对象</td></tr><tr><td><code>use_count()</code></td><td>返回当前 <code>shared_ptr</code> 的引用计数（慎用，仅用于调试）</td></tr><tr><td><code>swap()</code></td><td>交换两个 <code>weak_ptr</code> 的引用对象</td></tr></tbody></table>
<p><strong>安全访问对象（lock () 核心用法）</strong></p>
<p><code>weak_ptr</code> 不能直接解引用，必须通过 <code>lock()</code> 获取 <code>shared_ptr</code> 后访问：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// 主函数：程序执行的起点（必须有且仅有一个）</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>


<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">100</span>);
    <span class="hljs-function">std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">wp</span><span class="hljs-params">(sp)</span></span>;

    <span class="hljs-comment">// 安全访问：先 lock() 转换为 shared_ptr</span>
    
    <span class="hljs-keyword">if</span> (std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; temp = wp.<span class="hljs-built_in">lock</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"对象值："</span> &lt;&lt; *temp &lt;&lt; std::endl; <span class="hljs-comment">// 输出 100</span>
        std::cout &lt;&lt; <span class="hljs-string">"引用计数："</span> &lt;&lt; temp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 2</span>
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"对象已销毁"</span> &lt;&lt; std::endl;
    }

    std::cout &lt;&lt; <span class="hljs-string">"sp 引用计数："</span> &lt;&lt; sp.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 2</span>

    <span class="hljs-comment">// 销毁 shared_ptr，对象被释放</span>
    sp.<span class="hljs-built_in">reset</span>();

    <span class="hljs-comment">// 再次尝试访问</span>
    <span class="hljs-keyword">auto</span> temp2 = wp.<span class="hljs-built_in">lock</span>();
    <span class="hljs-keyword">if</span> (temp2) {
        std::cout &lt;&lt; <span class="hljs-string">"对象值："</span> &lt;&lt; *temp2 &lt;&lt; std::endl; <span class="hljs-comment">// 输出 100 std::cout &lt;&lt; *temp2 &lt;&lt; std::endl;</span>
        std::cout &lt;&lt; <span class="hljs-string">"引用计数："</span> &lt;&lt; temp2.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl; <span class="hljs-comment">// 2</span>
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"对象已销毁"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出此行</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>expired () 检查对象存活</strong></p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; sp = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">200</span>);
    <span class="hljs-function">std::weak_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">wp</span><span class="hljs-params">(sp)</span></span>;

    <span class="hljs-keyword">if</span> (!wp.<span class="hljs-built_in">expired</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"对象存活"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出</span>
    }

    sp.<span class="hljs-built_in">reset</span>();
    <span class="hljs-keyword">if</span> (wp.<span class="hljs-built_in">expired</span>()) {
        std::cout &lt;&lt; <span class="hljs-string">"对象已销毁"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>解决循环引用问题（核心场景）</strong></p>
<p><code>shared_ptr</code> 循环引用会导致引用计数无法归 0，对象无法析构，最终内存泄漏。<code>weak_ptr</code> 因不增加引用计数，可打破循环。</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">B</span>; <span class="hljs-comment">// 前向声明</span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">A</span> {
    std::shared_ptr&lt;B&gt; b_ptr;
    ~<span class="hljs-built_in">A</span>() { std::cout &lt;&lt; <span class="hljs-string">"A 析构"</span> &lt;&lt; std::endl; }
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">B</span> {
    std::shared_ptr&lt;A&gt; a_ptr; <span class="hljs-comment">// 循环引用</span>
    ~<span class="hljs-built_in">B</span>() { std::cout &lt;&lt; <span class="hljs-string">"B 析构"</span> &lt;&lt; std::endl; }
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    {
        std::shared_ptr&lt;A&gt; a = std::<span class="hljs-built_in">make_shared</span>&lt;A&gt;();
        std::shared_ptr&lt;B&gt; b = std::<span class="hljs-built_in">make_shared</span>&lt;B&gt;();
        a-&gt;b_ptr = b;
        b-&gt;a_ptr = a;
        <span class="hljs-comment">// 离开作用域时，a 和 b 的引用计数均为 2，无法析构</span>
    }
    std::cout &lt;&lt; <span class="hljs-string">"作用域结束"</span> &lt;&lt; std::endl; <span class="hljs-comment">// 输出，但 A/B 未析构</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>修改后</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">B</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> {</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;B&gt; b_ptr;
    ~A() { <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"A 析构"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; }
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">B</span> {</span>
    <span class="hljs-built_in">std</span>::weak_ptr&lt;A&gt; a_ptr; <span class="hljs-comment">// 改为 weak_ptr，不增加引用计数</span>
    ~B() { <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"B 析构"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; }
};

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    {
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;A&gt; a = <span class="hljs-built_in">std</span>::make_shared&lt;A&gt;();
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;B&gt; b = <span class="hljs-built_in">std</span>::make_shared&lt;B&gt;();
        a-&gt;b_ptr = b;
        b-&gt;a_ptr = a;
        <span class="hljs-comment">// a 的引用计数：1（b-&gt;a_ptr 是 weak_ptr，不计数）</span>
        <span class="hljs-comment">// b 的引用计数：1（a-&gt;b_ptr 是 shared_ptr，计数+1）</span>
    }
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"作用域结束"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NumPy数值计算全教程：多维数组操作、广播机制、线性代数运算（附实战案例）]]></title>    <link>https://juejin.cn/post/7583878719543984137</link>    <guid>https://juejin.cn/post/7583878719543984137</guid>    <pubDate>2025-12-15T12:37:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583878719543984137" data-draft-id="7583878719543967753" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NumPy数值计算全教程：多维数组操作、广播机制、线性代数运算（附实战案例）"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-15T12:37:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI能力探索"/> <meta itemprop="url" content="https://juejin.cn/user/1549641121016795"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NumPy数值计算全教程：多维数组操作、广播机制、线性代数运算（附实战案例）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549641121016795/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI能力探索
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T12:37:30.000Z" title="Mon Dec 15 2025 12:37:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>NumPy是Python科学计算的核心库，以高性能的多维数组（ndarray）为基础，提供了丰富的数值计算功能，广泛应用于数据分析、机器学习、科学仿真等领域。</p>
<h2 data-id="heading-0">一、前期准备</h2>
<h3 data-id="heading-1">1. 环境配置</h3>
<ul>
<li>安装NumPy：<code>pip install numpy</code>（建议Python 3.8+版本）；</li>
<li>验证安装：在Python终端执行<code>import numpy as np</code>，无报错则安装成功；</li>
<li>辅助工具：Jupyter Notebook（便于分段运行代码、查看结果）。</li>
</ul>
<h3 data-id="heading-2">2. 核心概念梳理</h3>
<ul>
<li><strong>ndarray</strong>：NumPy的核心数据结构，即多维数组，支持同类型元素存储，比Python列表更高效；</li>
<li><strong>维度（ndim）</strong>：数组的轴数，如一维数组（1D）、二维数组（2D，矩阵）、三维数组（3D）；</li>
<li><strong>形状（shape）</strong>：数组各维度的元素个数，如<code>(3,4)</code>表示3行4列的二维数组；</li>
<li><strong>数据类型（dtype）</strong>：数组元素的类型，如<code>int32</code>、<code>float64</code>、<code>bool</code>；</li>
<li><strong>广播机制</strong>：不同形状数组间运算时，NumPy自动扩展数组维度以匹配形状的规则；</li>
<li><strong>线性代数</strong>：基于ndarray实现矩阵乘法、求逆、特征值、行列式等运算。</li>
</ul>
<h2 data-id="heading-3">二、实战1：多维数组核心操作</h2>
<p>多维数组是NumPy的基础，掌握创建、索引、变形、拼接等操作，是后续计算的前提。</p>
<h3 data-id="heading-4">1. 数组创建（常用方式）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 1. 从列表/嵌套列表创建</span>
arr1 = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])  <span class="hljs-comment"># 一维数组</span>
arr2 = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]])  <span class="hljs-comment"># 二维数组（3行2列）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"一维数组：\n"</span>, arr1)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"二维数组形状："</span>, arr2.shape)  <span class="hljs-comment"># 输出：(3, 2)</span>

<span class="hljs-comment"># 2. 特殊数组创建（实战高频）</span>
arr_zeros = np.zeros((<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 全0数组（2行3列）</span>
arr_ones = np.ones((<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), dtype=np.int32)  <span class="hljs-comment"># 全1数组，指定int32类型</span>
arr_empty = np.empty((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>))  <span class="hljs-comment"># 空数组（内存随机值，仅占位）</span>
arr_range = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment"># 等差数列：0,2,4,6,8</span>
arr_linspace = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 等间隔数组：0,0.25,0.5,0.75,1</span>
arr_eye = np.eye(<span class="hljs-number">3</span>)  <span class="hljs-comment"># 单位矩阵（3x3）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"单位矩阵：\n"</span>, arr_eye)
</code></pre>
<h3 data-id="heading-5">2. 数组索引与切片</h3>
<h4 data-id="heading-6">（1）一维数组（与Python列表类似）</h4>
<pre><code class="hljs language-python" lang="python">arr = np.arange(<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">5</span>])  <span class="hljs-comment"># 索引：取第6个元素（5）</span>
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">2</span>:<span class="hljs-number">7</span>])  <span class="hljs-comment"># 切片：2-6（左闭右开）</span>
<span class="hljs-built_in">print</span>(arr[::<span class="hljs-number">2</span>])  <span class="hljs-comment"># 步长2：0,2,4,6,8</span>
</code></pre>
<h4 data-id="heading-7">（2）二维数组（行+列索引）</h4>
<pre><code class="hljs language-python" lang="python">arr = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]])
<span class="hljs-comment"># 取第2行第3列元素（6）</span>
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>])
<span class="hljs-comment"># 取第1行所有列</span>
<span class="hljs-built_in">print</span>(arr[<span class="hljs-number">0</span>, :])
<span class="hljs-comment"># 取所有行的第2列</span>
<span class="hljs-built_in">print</span>(arr[:, <span class="hljs-number">1</span>])
<span class="hljs-comment"># 取前2行、前2列</span>
<span class="hljs-built_in">print</span>(arr[:<span class="hljs-number">2</span>, :<span class="hljs-number">2</span>])
<span class="hljs-comment"># 布尔索引：筛选大于5的元素</span>
<span class="hljs-built_in">print</span>(arr[arr &gt; <span class="hljs-number">5</span>])  <span class="hljs-comment"># 输出：[6 7 8 9]</span>
</code></pre>
<h3 data-id="heading-8">3. 数组变形与重塑</h3>
<pre><code class="hljs language-python" lang="python">arr = np.arange(<span class="hljs-number">12</span>)
<span class="hljs-comment"># 重塑为3行4列</span>
arr_reshape = arr.reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"重塑后：\n"</span>, arr_reshape)

<span class="hljs-comment"># 展平数组（多维转一维）</span>
arr_flat = arr_reshape.flatten()  <span class="hljs-comment"># 拷贝数据，原数组不变</span>
arr_ravel = arr_reshape.ravel()   <span class="hljs-comment"># 视图，原数组改变会同步</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"展平数组："</span>, arr_flat)

<span class="hljs-comment"># 转置（行变列，列变行）</span>
arr_trans = arr_reshape.T
<span class="hljs-built_in">print</span>(<span class="hljs-string">"转置后：\n"</span>, arr_trans)
</code></pre>
<h3 data-id="heading-9">4. 数组拼接与分割</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 拼接</span>
arr1 = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
arr2 = np.array([[<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>]])
<span class="hljs-comment"># 纵向拼接（行增加）</span>
arr_vstack = np.vstack((arr1, arr2))
<span class="hljs-comment"># 横向拼接（列增加）</span>
arr_hstack = np.hstack((arr1, arr2))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"纵向拼接：\n"</span>, arr_vstack)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"横向拼接：\n"</span>, arr_hstack)

<span class="hljs-comment"># 分割</span>
arr = np.arange(<span class="hljs-number">9</span>).reshape(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>)
<span class="hljs-comment"># 横向分割（按列分）</span>
arr_split1, arr_split2 = np.hsplit(arr, <span class="hljs-number">2</span>)
<span class="hljs-comment"># 纵向分割（按行分）</span>
arr_split3, arr_split4 = np.vsplit(arr, <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"横向分割结果：\n"</span>, arr_split1)
</code></pre>
<h2 data-id="heading-10">三、实战2：广播机制（核心难点）</h2>
<p>广播是NumPy中不同形状数组间运算的核心规则，能避免手动扩展数组，提升计算效率。</p>
<h3 data-id="heading-11">1. 广播的核心规则</h3>
<ul>
<li>规则1：如果两个数组维度不同，先将维度少的数组补1，直到维度数相同；</li>
<li>规则2：对于每个维度，若长度相同或其中一个为1，则可以广播，否则报错；</li>
<li>规则3：广播时，长度为1的维度会被扩展为匹配另一个数组的长度。</li>
</ul>
<h3 data-id="heading-12">2. 基础广播案例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 案例1：标量与数组运算（最常见）</span>
arr = np.array([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])
result = arr + <span class="hljs-number">5</span>  <span class="hljs-comment"># 标量5广播为[5,5,5]</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"标量广播："</span>, result)  <span class="hljs-comment"># 输出：[6 7 8]</span>

<span class="hljs-comment"># 案例2：一维数组与二维数组运算</span>
arr1 = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])  <span class="hljs-comment"># (2,3)</span>
arr2 = np.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>])        <span class="hljs-comment"># (3,) → 补1为(1,3) → 广播为(2,3)</span>
result = arr1 + arr2
<span class="hljs-built_in">print</span>(<span class="hljs-string">"一维+二维广播：\n"</span>, result)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[11 22 33]</span>
<span class="hljs-comment">#  [14 25 36]]</span>

<span class="hljs-comment"># 案例3：不同维度广播（需满足规则）</span>
arr3 = np.array([[<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>]])  <span class="hljs-comment"># (3,1)</span>
arr4 = np.array([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>])         <span class="hljs-comment"># (2,) → 补1为(1,2) → 广播为(3,2)</span>
result = arr3 * arr4
<span class="hljs-built_in">print</span>(<span class="hljs-string">"不同维度广播：\n"</span>, result)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[10 20]</span>
<span class="hljs-comment">#  [20 40]</span>
<span class="hljs-comment">#  [30 60]]</span>

<span class="hljs-comment"># 错误案例（不满足规则）</span>
<span class="hljs-comment"># arr5 = np.array([1,2])  # (2,)</span>
<span class="hljs-comment"># arr6 = np.array([[1,2,3], [4,5,6]])  # (2,3)</span>
<span class="hljs-comment"># result = arr5 + arr6  # 报错：维度不匹配</span>
</code></pre>
<h3 data-id="heading-13">3. 广播的实战应用（数据归一化）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 对二维数组每行进行归一化：(值-均值)/标准差</span>
data = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]])
<span class="hljs-comment"># 计算每行均值（axis=1，保持维度便于广播）</span>
mean = np.mean(data, axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 计算每行标准差</span>
std = np.std(data, axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 广播运算</span>
normalized_data = (data - mean) / std
<span class="hljs-built_in">print</span>(<span class="hljs-string">"归一化后：\n"</span>, normalized_data)
<span class="hljs-comment"># 输出每行均值为0，标准差为1的数组</span>
</code></pre>
<h2 data-id="heading-14">四、实战3：线性代数运算（核心应用）</h2>
<p>NumPy的<code>numpy.linalg</code>模块提供了完整的线性代数运算接口，满足矩阵分析、线性方程组求解等需求。</p>
<h3 data-id="heading-15">1. 基础矩阵运算</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 矩阵乘法（注意：不是元素相乘）</span>
A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
B = np.array([[<span class="hljs-number">5</span>,<span class="hljs-number">6</span>], [<span class="hljs-number">7</span>,<span class="hljs-number">8</span>]])
<span class="hljs-comment"># 方法1：np.dot()（兼容一维/二维）</span>
dot_result = np.dot(A, B)
<span class="hljs-comment"># 方法2：@运算符（Python 3.5+，推荐）</span>
at_result = A @ B
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵乘法：\n"</span>, at_result)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[19 22]</span>
<span class="hljs-comment">#  [43 50]]</span>

<span class="hljs-comment"># 元素相乘（与矩阵乘法区分）</span>
element_mul = A * B
<span class="hljs-built_in">print</span>(<span class="hljs-string">"元素相乘：\n"</span>, element_mul)
<span class="hljs-comment"># 输出：</span>
<span class="hljs-comment"># [[ 5 12]</span>
<span class="hljs-comment">#  [21 32]]</span>

<span class="hljs-comment"># 矩阵求逆（仅方阵且可逆）</span>
A_inv = np.linalg.inv(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵A的逆：\n"</span>, A_inv)

<span class="hljs-comment"># 矩阵转置</span>
A_trans = A.T
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵A的转置：\n"</span>, A_trans)

<span class="hljs-comment"># 行列式计算</span>
det_A = np.linalg.det(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"矩阵A的行列式："</span>, det_A)  <span class="hljs-comment"># 输出：-2.0000000000000004</span>
</code></pre>
<h3 data-id="heading-16">2. 线性方程组求解</h3>
<p>求解方程组：</p>
<pre><code class="hljs language-ini" lang="ini">x + <span class="hljs-attr">2y</span> = <span class="hljs-number">5</span>
3x + <span class="hljs-attr">4y</span> = <span class="hljs-number">13</span>
</code></pre>
<p>转化为矩阵形式：<code>Ax = b</code>，其中<code>A=[[1,2],[3,4]]</code>，<code>b=[5,13]</code>，求解<code>x</code>。</p>
<pre><code class="hljs language-python" lang="python">A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
b = np.array([<span class="hljs-number">5</span>, <span class="hljs-number">13</span>])
<span class="hljs-comment"># 求解线性方程组</span>
x = np.linalg.solve(A, b)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"方程组解：x={}, y={}"</span>.<span class="hljs-built_in">format</span>(x[<span class="hljs-number">0</span>], x[<span class="hljs-number">1</span>]))  <span class="hljs-comment"># 输出：x=3.0, y=1.0</span>

<span class="hljs-comment"># 验证：A @ x 应等于b</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"验证结果："</span>, A @ x)  <span class="hljs-comment"># 输出：[ 5. 13.]</span>
</code></pre>
<h3 data-id="heading-17">3. 特征值与特征向量</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 计算特征值和特征向量</span>
A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]])
eigenvalues, eigenvectors = np.linalg.eig(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"特征值："</span>, eigenvalues)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"特征向量：\n"</span>, eigenvectors)

<span class="hljs-comment"># 验证：A·v = λ·v（v为特征向量，λ为特征值）</span>
v = eigenvectors[:, <span class="hljs-number">0</span>]  <span class="hljs-comment"># 第一个特征向量</span>
lamda = eigenvalues[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 第一个特征值</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"验证特征值："</span>, np.allclose(A @ v, lamda * v))  <span class="hljs-comment"># 输出：True</span>
</code></pre>
<h3 data-id="heading-18">4. 奇异值分解（SVD，实战高频）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 奇异值分解（适用于非方阵）</span>
A = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])
U, S, VT = np.linalg.svd(A)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"U矩阵：\n"</span>, U)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"奇异值："</span>, S)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"VT矩阵：\n"</span>, VT)

<span class="hljs-comment"># 重构矩阵（验证SVD）</span>
<span class="hljs-comment"># 需将S转为对角矩阵</span>
S_mat = np.zeros((<span class="hljs-number">2</span>,<span class="hljs-number">3</span>))
S_mat[:<span class="hljs-number">2</span>, :<span class="hljs-number">2</span>] = np.diag(S)
A_recon = U @ S_mat @ VT
<span class="hljs-built_in">print</span>(<span class="hljs-string">"重构矩阵与原矩阵是否一致："</span>, np.allclose(A, A_recon))  <span class="hljs-comment"># 输出：True</span>
</code></pre>
<h2 data-id="heading-19">五、实战优化技巧</h2>
<h3 data-id="heading-20">1. 避免循环，用向量化运算</h3>
<p>NumPy向量化运算比Python循环快10~100倍，例如：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 低效：循环计算</span>
arr = np.arange(<span class="hljs-number">1000000</span>)
result = []
<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> arr:
    result.append(x * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)
result = np.array(result)

<span class="hljs-comment"># 高效：向量化运算</span>
result = arr * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>  <span class="hljs-comment"># 广播机制自动处理</span>
</code></pre>
<h3 data-id="heading-21">2. 数据类型优化</h3>
<p>默认<code>float64</code>精度高但占用内存，可根据需求改为<code>float32</code>：</p>
<pre><code class="hljs language-python" lang="python">arr = np.ones((<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>), dtype=np.float32)  <span class="hljs-comment"># 内存占用减少一半</span>
</code></pre>
<h3 data-id="heading-22">3. 避免拷贝，使用视图</h3>
<pre><code class="hljs language-python" lang="python">arr1 = arr.reshape(-<span class="hljs-number">1</span>)  <span class="hljs-comment"># -1自动计算维度，视图无拷贝</span>
arr2 = arr[:, ::<span class="hljs-number">2</span>]      <span class="hljs-comment"># 切片为视图，原数组修改会同步</span>
arr3 = arr.copy()       <span class="hljs-comment"># 仅需独立数据时拷贝</span>
</code></pre>
<h2 data-id="heading-23">六、常见问题与解决</h2>
<h3 data-id="heading-24">1. 广播报错：维度不匹配</h3>
<ul>
<li>排查：打印数组<code>shape</code>，确认是否满足广播规则；</li>
<li>解决：用<code>reshape</code>手动扩展维度，例如<code>arr = arr.reshape(-1, 1)</code>。</li>
</ul>
<h3 data-id="heading-25">2. 矩阵乘法与元素相乘混淆</h3>
<ul>
<li>区分：<code>A @ B</code>是矩阵乘法，<code>A * B</code>是元素相乘；</li>
<li>注意：矩阵乘法要求前一个数组列数=后一个数组行数。</li>
</ul>
<h3 data-id="heading-26">3. 求逆报错：奇异矩阵</h3>
<ul>
<li>原因：矩阵行列式为0，不可逆；</li>
<li>解决：检查矩阵是否正确，或使用伪逆<code>np.linalg.pinv(A)</code>。</li>
</ul>
<h3 data-id="heading-27">4. 精度问题</h3>
<ul>
<li>现象：浮点数运算出现<code>0.9999999999</code>而非<code>1</code>；</li>
<li>解决：用<code>np.allclose(a, b)</code>代替<code>a == b</code>比较数组。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 SSE 单向推送实现 系统通知功能]]></title>    <link>https://juejin.cn/post/7583912899389210667</link>    <guid>https://juejin.cn/post/7583912899389210667</guid>    <pubDate>2025-12-15T13:26:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389210667" data-draft-id="7583898823921254442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 SSE 单向推送实现 系统通知功能"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-15T13:26:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cindershade"/> <meta itemprop="url" content="https://juejin.cn/user/2587590326494763"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 SSE 单向推送实现 系统通知功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2587590326494763/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cindershade
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T13:26:52.000Z" title="Mon Dec 15 2025 13:26:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用 SSE 单向推送实现 系统通知功能</h2>
<blockquote>
<p>说明：本说明基于自己毕设项目中“系统通知模块 (Notification / SSE)”的实现，重点讲清楚在前端从 **初始化环境 → 建立 SSE 连接 → 解析服务端事件 → 打印日志 ** 的完整技术链路，至于收到信息如何处理和具体项目有关。</p>
</blockquote>
<hr/>
<p>在我的毕设中，有系统通知这个功能，单向的，告诉用户，你的内容发布审核成功，或者失败等等一系列的单方面的通知，所有选型sse而不选择websorket
接下来先给出后端实现，然后是前端实现</p>
<h3 data-id="heading-1">后端实现 系统通知模块后端实现说明</h3>
<p>涉及的核心类：</p>
<ul>
<li><code>NotificationController</code>：通知相关 HTTP 接口（SSE 流、已读、未读数、分页列表）。</li>
<li><code>NotificationService</code>：通知的持久化、SSE 连接管理与推送实现。</li>
<li><code>Notification</code> / <code>notification</code> 表：通知实体与数据库表结构。</li>
<li><code>NotificationType</code> / <code>NotificationStatus</code>：通知类型与状态枚举（如 <code>PRIVATE_MESSAGE</code>）。</li>
</ul>
<hr/>
<h3 data-id="heading-2">一、建立 SSE 通知连接</h3>
<h4 data-id="heading-3">1. Controller：<code>GET /api/notify/stream</code></h4>
<ul>
<li><strong>接口类</strong>：<code>NotificationController</code></li>
<li><strong>方法</strong>：<code>stream(@RequestHeader(value = "Last-Event-ID", required = false) String lastEventId)</code></li>
<li><strong>路径</strong>：<code>/api/notify/stream</code></li>
<li><strong>作用</strong>：
<ul>
<li>校验当前用户是否已登录（从 <code>UserContext.getUserId()</code> 读取 userId）。</li>
<li>未登录时抛出 <code>401 UNAUTHORIZED</code>。</li>
<li>登录状态下，调用 <code>notificationService.connect(userId, lastEventId)</code> 建立 SSE 连接。</li>
</ul>
</li>
</ul>
<p>简要流程：</p>
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID。</li>
<li>若未登录：抛出 <code>ResponseStatusException(HttpStatus.UNAUTHORIZED)</code>。</li>
<li>若已登录：将 <code>userId</code> 与 <code>Last-Event-ID</code> 交给 <code>NotificationService.connect</code>。</li>
<li>返回 Spring 的 <code>SseEmitter</code> 对象，由框架维持 SSE 链接。</li>
</ol>
<h4 data-id="heading-4">2. Service：<code>NotificationService.connect</code></h4>
<ul>
<li><strong>方法签名</strong>：<code>public SseEmitter connect(Long userId, String lastEventId)</code></li>
<li><strong>内部逻辑</strong>：
<ol>
<li>创建一个 <code>SseEmitter</code> 实例，超时时间为 <code>SSE_TIMEOUT = 30 * 60 * 1000L</code>（30 分钟）。</li>
<li>将该 <code>SseEmitter</code> 加入到 <code>emitterPool</code> 中：
<ul>
<li><code>emitterPool</code> 类型为 <code>Map&lt;Long, CopyOnWriteArrayList&lt;SseEmitter&gt;&gt;</code>，按 <code>userId</code> 维护用户当前所有 SSE 连接。</li>
</ul>
</li>
<li>为 <code>emitter</code> 注册回调：
<ul>
<li><code>onCompletion</code> / <code>onTimeout</code> / <code>onError</code> 时，从 <code>emitterPool</code> 中移除当前连接。</li>
</ul>
</li>
<li>发送一次 <strong>心跳事件</strong>（<code>heartbeat</code>），名称为 <code>"heartbeat"</code>，数据为 <code>"ping"</code>。</li>
<li>解析 <code>Last-Event-ID</code>：
<ul>
<li>如果有合法的 <code>lastEventId</code>，解析为 <code>lastId</code>（<code>Long</code>）。</li>
<li>若解析失败或为空，则为 <code>null</code>。</li>
</ul>
</li>
<li>调用 <code>resendPending(userId, lastId, emitter)</code> 补发历史通知（最多 100 条）。</li>
<li>返回 <code>SseEmitter</code>，等待后续通知推送。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-5">3. SSE 连接断开/超时</h4>
<ul>
<li>在 <code>connect</code> 方法中，对 <code>SseEmitter</code> 注册了：
<ul>
<li><code>onCompletion</code>：连接正常完成时调用 <code>removeEmitter(userId, emitter)</code>。</li>
<li><code>onTimeout</code>：连接超时时调用 <code>removeEmitter(userId, emitter)</code>。</li>
<li><code>onError</code>：发送异常等错误时调用 <code>removeEmitter(userId, emitter)</code>。</li>
</ul>
</li>
<li><code>removeEmitter</code> 会从 <code>emitterPool</code> 对应用户的列表中移除该 <code>SseEmitter</code>，防止内存泄漏与后续重复推送。</li>
</ul>
<hr/>
<h3 data-id="heading-6">二、通知的创建与推送</h3>
<h4 data-id="heading-7">1. 通用创建+推送：<code>NotificationService.createAndDispatch</code></h4>
<ul>
<li>
<p><strong>方法签名</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Notification <span class="hljs-title function_">createAndDispatch</span><span class="hljs-params">(Long userId, NotificationType type, String title, String content, String payload)</span>
</code></pre>
</li>
<li>
<p><strong>调用方示例</strong>：</p>
<ul>
<li>私信业务中的离线提醒（<code>ChatServiceImpl</code>）。</li>
<li>管理员公告等其他业务模块。</li>
</ul>
</li>
<li>
<p><strong>执行流程</strong>：</p>
<ol>
<li>调用 <code>buildNotification(userId, type, title, content, payload)</code> 构造一个 <code>Notification</code> 实体：
<ul>
<li><code>userId</code>：接收通知的用户 ID。</li>
<li><code>type</code>：通知类型（如 <code>PRIVATE_MESSAGE</code>、<code>SYSTEM_ANNOUNCEMENT</code> 等）。</li>
<li><code>title</code>：通知标题/摘要。</li>
<li><code>content</code>：通知正文或简述。</li>
<li><code>payload</code>：扩展 JSON 字符串，用于前端跳转或展示更多信息。</li>
<li><code>status</code>：初始为 <code>UNREAD</code>。</li>
<li><code>createdAt</code> / <code>updatedAt</code>：为当前时间。</li>
</ul>
</li>
<li>通过 <code>notificationMapper.insert(notification)</code> 将通知写入 <code>notification</code> 表。</li>
<li>调用 <code>dispatch(notification)</code> 将该通知推送给所有当前在线的 SSE 连接。</li>
<li>返回持久化后的 <code>Notification</code> 对象。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-8">2. 批量发送：<code>createAndDispatchBatch</code></h4>
<ul>
<li>
<p><strong>方法签名</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createAndDispatchBatch</span><span class="hljs-params">(List&lt;Long&gt; userIds, NotificationType type, String title, String content, String payload)</span>
</code></pre>
</li>
<li>
<p><strong>逻辑</strong>：对 <code>userIds</code> 逐个调用 <code>createAndDispatch</code>，用于对多用户广播同一类型通知（如系统公告或活动推送）。</p>
</li>
</ul>
<h4 data-id="heading-9">3. 通知推送：<code>NotificationService.dispatch</code></h4>
<ul>
<li><strong>方法签名</strong>：<code>public void dispatch(Notification notification)</code></li>
<li><strong>执行流程</strong>：
<ol>
<li>从 <code>emitterPool</code> 中取出该通知对应 <code>userId</code> 的所有 <code>SseEmitter</code> 列表。</li>
<li>若列表为空，说明用户此时没有打开 SSE 通道，方法直接返回（仅数据库中保留通知记录，后续建立连接时再补发）。</li>
<li>遍历每个 <code>SseEmitter</code>，调用：
<ul>
<li><code>emitter.send(SseEmitter.event().id(String.valueOf(notification.getId())).name(notification.getType()).data(notification))</code>：
<ul>
<li><code>id</code>：使用通知 ID（字符串形式），用于客户端的 <code>Last-Event-ID</code> 与断点续传。</li>
<li><code>name</code>：使用 <code>notification.getType()</code>，即 <code>NotificationType</code> 的枚举名（如 <code>PRIVATE_MESSAGE</code>）。</li>
<li><code>data</code>：整个 <code>Notification</code> 对象（前端接收后可按 <code>NotificationVO</code> 解析）。</li>
</ul>
</li>
</ul>
</li>
<li>如果发送过程中抛出 <code>IOException</code>，记录日志并调用 <code>removeEmitter</code> 移除当前失效连接。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-10">4. 历史通知补发：<code>NotificationService.resendPending</code></h4>
<ul>
<li><strong>方法签名</strong>：<code>private void resendPending(Long userId, Long lastId, SseEmitter emitter)</code></li>
<li><strong>补发策略</strong>：
<ul>
<li>若 <code>lastId != null</code>：补发 <strong>ID 大于 <code>lastId</code></strong> 的所有通知。</li>
<li>若 <code>lastId == null</code>：补发 <strong>所有未读（<code>status = UNREAD</code>）通知</strong>。</li>
<li>均按 ID 升序排序，<code>LIMIT 1</code> 条，只是补发过最新一条数据，列表通过数据库查询。</li>
</ul>
</li>
<li>通知通过 <code>SseEmitter.event().id(...).name(...).data(...)</code> 发送，与实时推送一致。</li>
</ul>
<hr/>
<h3 data-id="heading-11">三、通知的已读、未读与统计</h3>
<h4 data-id="heading-12">1. 标记已读：<code>POST /api/notify/read</code></h4>
<h5 data-id="heading-13">Controller：<code>NotificationController.markRead</code></h5>
<ul>
<li><strong>路径</strong>：<code>/api/notify/read</code></li>
<li><strong>请求体</strong>：<code>NotificationReadRequest</code>，包含：
<ul>
<li><code>notificationIds</code>（可选）：要标记为已读的通知 ID 列表。</li>
<li><code>upToId</code>（可选）：将 <code>id &lt;= upToId</code> 的通知全部标记为已读。</li>
</ul>
</li>
<li><strong>控制器逻辑</strong>：
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID，未登录返回 <code>Result.unauthorized("未登录")</code>。</li>
<li>调用 <code>notificationService.markAsRead(userId, notificationIds, upToId)</code> 执行更新。</li>
<li>再调用 <code>notificationService.countUnread(userId)</code> 获取最新未读数量。</li>
<li>返回 <code>Result.success(unread)</code>。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-14">Service：<code>NotificationService.markAsRead</code></h5>
<ul>
<li><strong>方法签名</strong>：<code>public void markAsRead(Long userId, List&lt;Long&gt; notificationIds, Long upToId)</code></li>
<li><strong>执行逻辑</strong>：
<ol>
<li>若 <code>notificationIds</code> 为空且 <code>upToId == null</code>，直接返回，不做更新。</li>
<li>创建 <code>LambdaUpdateWrapper&lt;Notification&gt;</code>：
<ul>
<li><code>eq(Notification::getUserId, userId)</code>：只更新当前用户的通知。</li>
<li><code>eq(Notification::getStatus, NotificationStatus.UNREAD.name())</code>：只处理未读通知。</li>
<li>若 <code>notificationIds</code> 不为空：<code>in(Notification::getId, notificationIds)</code>。</li>
<li>若 <code>upToId</code> 不为 <code>null</code>：<code>le(Notification::getId, upToId)</code>。</li>
</ul>
</li>
<li><code>set(Notification::getStatus, NotificationStatus.READ.name())</code>。</li>
<li>执行 <code>notificationMapper.update(null, wrapper)</code> 完成批量更新。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-15">2. 未读数量统计：<code>GET /api/notify/unread-count</code></h4>
<h5 data-id="heading-16">Controller：<code>NotificationController.unreadCount</code></h5>
<ul>
<li><strong>路径</strong>：<code>/api/notify/unread-count</code></li>
<li><strong>逻辑</strong>：
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID，未登录返回 <code>Result.unauthorized("未登录")</code>。</li>
<li>调用 <code>notificationService.countUnread(userId)</code> 获取未读数量。</li>
<li>返回 <code>Result.success(unread)</code>。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-17">Service：<code>NotificationService.countUnread</code></h5>
<ul>
<li><strong>方法签名</strong>：<code>public long countUnread(Long userId)</code></li>
<li><strong>逻辑</strong>：
<ul>
<li>使用 <code>LambdaQueryWrapper&lt;Notification&gt;</code>：
<ul>
<li><code>eq(Notification::getUserId, userId)</code></li>
<li><code>eq(Notification::getStatus, NotificationStatus.UNREAD.name())</code></li>
</ul>
</li>
<li>调用 <code>notificationMapper.selectCount(wrapper)</code> 返回未读总数。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-18">3. 最近未读列表：<code>GET /api/notify/recent</code></h4>
<ul>
<li><strong>路径</strong>：<code>/api/notify/recent</code></li>
<li><strong>说明</strong>：用于调试或前端恢复，获取当前用户最近未读通知（最多 100 条）。</li>
<li><strong>Service 方法</strong>：<code>public List&lt;Notification&gt; recentUnread(Long userId)</code>
<ul>
<li>条件：
<ul>
<li><code>userId</code> 匹配当前用户；</li>
<li><code>status = UNREAD</code>；</li>
</ul>
</li>
<li>排序：<code>createdAt</code> 倒序；</li>
<li><code>last("LIMIT 100")</code> 限制数量。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-19">四、通知分页列表接口</h3>
<h4 data-id="heading-20">1. 接口：<code>GET /api/notify/list</code></h4>
<h5 data-id="heading-21">Controller：<code>NotificationController.list</code></h5>
<ul>
<li><strong>路径</strong>：<code>/api/notify/list</code></li>
<li><strong>入参（Query）</strong>：
<ul>
<li><code>page</code>：页码，默认 <code>1</code>。</li>
<li><code>pageSize</code>：每页数量，默认 <code>10</code>。</li>
<li><code>status</code>：可选，<code>UNREAD</code> / <code>READ</code> / <code>ALL</code>，默认 <code>ALL</code>（不传时也视为 <code>ALL</code>）。</li>
</ul>
</li>
<li><strong>流程</strong>：
<ol>
<li>从 <code>UserContext</code> 获取当前用户 ID，未登录返回 <code>Result.unauthorized("未登录")</code>。</li>
<li>调用 <code>notificationService.listNotifications(userId, page, pageSize, status)</code>。</li>
<li>返回 <code>Result.success(Page&lt;NotificationVO&gt;)</code>，分页结构与项目统一（<code>total/size/current/pages/records</code> 等）。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-22">Service：<code>NotificationService.listNotifications</code></h5>
<ul>
<li><strong>方法签名</strong>：<code>public Page&lt;NotificationVO&gt; listNotifications(Long userId, int page, int pageSize, String status)</code></li>
<li><strong>实现思路</strong>：
<ol>
<li>构造 <code>Page&lt;Notification&gt; pageParam = new Page&lt;&gt;(page, pageSize)</code>。</li>
<li>构造 <code>LambdaQueryWrapper&lt;Notification&gt; wrapper</code>：
<ul>
<li><code>eq(Notification::getUserId, userId)</code>。</li>
<li>若 <code>status</code> 非空且不是 <code>"ALL"</code>：<code>eq(Notification::getStatus, status.toUpperCase())</code>。</li>
<li><code>orderByDesc(Notification::getCreatedAt)</code>。</li>
</ul>
</li>
<li><code>notificationMapper.selectPage(pageParam, wrapper)</code> 得到 <code>notificationPage</code>。</li>
<li>手动构造 <code>Page&lt;NotificationVO&gt; voPage = new Page&lt;&gt;(page, pageSize, notificationPage.getTotal())</code>：
<ul>
<li>遍历 <code>notificationPage.getRecords()</code>，将每条记录映射为 <code>NotificationVO</code>：
<ul>
<li>复制 <code>id/userId/type/title/content/payload/status/createdAt</code> 等字段。</li>
</ul>
</li>
<li><code>voPage.setRecords(records)</code>。</li>
</ul>
</li>
<li>返回 <code>voPage</code>。</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-23">五、与私信模块的集成（离线私信提醒）</h3>
<h4 data-id="heading-24">1. 场景描述</h4>
<p>当用户 A 给用户 B 发送一对一私信时：</p>
<ul>
<li>如果 B 当前通过 WebSocket 在线（有 <code>chat:online:{userId}</code> 标记）：
<ul>
<li>只依赖聊天模块的实时消息推送（STOMP <code>/topic/chat/{sessionId}</code>）。</li>
</ul>
</li>
<li>如果 B 不在线（没有在线标记）：
<ul>
<li>在聊天消息正常写入 <code>chat_message</code> 表的基础上，<strong>额外</strong>为 B 创建一条 <code>PRIVATE_MESSAGE</code> 类型的系统通知，写入 <code>notification</code> 表并通过 SSE 推送/补发。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-25">2. 关键实现：<code>ChatServiceImpl.sendMessage</code></h4>
<ul>
<li>在创建 <code>ChatMessage</code> 并更新 <code>ChatSession.updatedAt</code> 后：
<ol>
<li>判断当前会话是否为单聊：<code>"single".equalsIgnoreCase(session.getSessionType())</code>。</li>
<li>查询该会话中“对方成员” (<code>ChatSessionMember</code>，<code>userId != 发送者</code>) 获取 <code>targetUserId</code>。</li>
<li>根据 <code>RedisConstants.CHAT_ONLINE_PREFIX + targetUserId</code> 从 Redis 中读取在线标记：
<ul>
<li>若存在值：认为对方在线，不额外生成通知。</li>
<li>若不存在值：认为对方离线，进入通知创建逻辑。</li>
</ul>
</li>
<li>离线场景下：
<ul>
<li>查询发送者用户信息，取昵称或用户名作为 <code>senderName</code>。</li>
<li>构造标题 <code>title = "收到一条新的私信"</code>。</li>
<li>构造预览 <code>preview = content</code> 的前若干字符（超长截断）。</li>
<li>构造 <code>payload</code> JSON 字符串：包含 <code>sessionId</code>、<code>messageId</code>、<code>senderId</code>、<code>senderName</code>，供前端跳转使用。</li>
<li>调用 <code>notificationService.createAndDispatch(targetUserId, NotificationType.PRIVATE_MESSAGE, title, preview, payload)</code>：
<ul>
<li>将通知写入 <code>notification</code> 表。</li>
<li>若 B 此时已经建立 SSE 连接，会立刻收到一条 <code>PRIVATE_MESSAGE</code> 事件。</li>
<li>若 B 之后才建立 SSE 连接，会通过补发逻辑 <code>resendPending</code> 收到历史通知。</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-26">前端实现  前端 SSE 通知实现说明（从 0 到看到控制台日志）</h3>
<h3 data-id="heading-27">一、相关文件总览</h3>
<ul>
<li><code>vite.config.js</code>
<ul>
<li>开发环境代理配置：<code>/api</code> → 后端 <code>VITE_API_BASE_URL</code>。</li>
</ul>
</li>
<li><code>src/main.js</code>
<ul>
<li>应用启动时初始化用户状态并根据登录态初始化通知 SSE。</li>
</ul>
</li>
<li><code>src/utils/notificationStream.js</code>
<ul>
<li><strong>SSE 连接和消息解析的核心逻辑（基于 fetch + ReadableStream，自实现 EventSource）。</strong></li>
</ul>
</li>
<li><code>src/stores/notification.js</code>
<ul>
<li>通知相关 Pinia Store，管理未读数量、通知列表和 SSE 状态。</li>
</ul>
</li>
<li><code>src/components/Header/index.vue</code>
<ul>
<li>顶部 Header，展示通知铃铛和未读红点。</li>
</ul>
</li>
<li><code>src/pages/UserCenter/pages/Notifications/index.vue</code>
<ul>
<li>用户中心「消息通知」页面，展示通知列表。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-28">二、环境与代理（为什么开发环境不直接跨域）</h3>
<h4 data-id="heading-29">2.1 Vite 代理配置</h4>
<p><code>vite.config.js</code> 中开发环境的核心代理配置：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">server</span>: {
  <span class="hljs-attr">port</span>: <span class="hljs-number">3003</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>,
  ...(isDev &amp;&amp; {
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-string">'/api'</span>: {
        <span class="hljs-attr">target</span>: env.<span class="hljs-property">VITE_API_BASE_URL</span> || <span class="hljs-string">'http://localhost:8080'</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>)
      }
    }
  })
}
</code></pre>
<p>关键点：</p>
<ul>
<li>浏览器访问的是 <code>http://localhost:3003</code>（前端 dev server）。</li>
<li>任何以 <code>/api</code> 开头的请求都会被 Vite 转发到 <code>VITE_API_BASE_URL</code> 对应的后端，例如：
<ul>
<li>浏览器：<code>/api/api/notify/stream</code></li>
<li>Vite rewrite：去掉第一个 <code>/api</code>，转成 <code>/api/notify/stream</code></li>
<li>后端实际收到：<code>http://127.0.0.1:8081/api/notify/stream</code>（和后端文档一致）。</li>
</ul>
</li>
<li>对浏览器来说始终是 <strong>同源 (3003)</strong>，不会触发 CORS 校验，跨域问题由 dev server 帮我们挡在背后。</li>
</ul>
<hr/>
<h3 data-id="heading-30">三、应用入口：在什么时机建立 SSE 连接？</h3>
<h4 data-id="heading-31">3.1 <code>src/main.js</code></h4>
<p>在 <code>main.js</code> 中：</p>
<ol>
<li>创建应用实例并挂载 Pinia / Router / UI 库。</li>
<li>初始化用户状态（从 localStorage 恢复登录态）：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

app.<span class="hljs-title function_">use</span>(pinia)
app.<span class="hljs-title function_">use</span>(router)
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()

userStore.<span class="hljs-title function_">initUserState</span>()
</code></pre>
<ol start="3">
<li>当恢复登录状态后，如果用户已登录，立即初始化通知 SSE，并获取一次未读数量：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">isLogin</span>) {
  <span class="hljs-title function_">initNotificationStream</span>()
  notificationStore.<span class="hljs-title function_">fetchUnreadCount</span>()
}
</code></pre>
<ol start="4">
<li>同时监听登录状态变化，自动处理连接的建立和关闭：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> userStore.<span class="hljs-property">isLogin</span>,
  <span class="hljs-function">(<span class="hljs-params">isLogin</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (isLogin) {
      <span class="hljs-title function_">initNotificationStream</span>()
      notificationStore.<span class="hljs-title function_">fetchUnreadCount</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">closeNotificationStream</span>()
      notificationStore.<span class="hljs-title function_">reset</span>()
    }
  }
)
</code></pre>
<p><strong>结论：</strong></p>
<ul>
<li>应用启动时，如果用户已登录 → 自动建立 SSE 连接。</li>
<li>用户登录成功 → 自动建立连接。</li>
<li>用户登出或 token 失效 → 自动关闭连接并清空通知状态。</li>
</ul>
<hr/>
<h3 data-id="heading-32">四、SSE 核心：<code>notificationStream.js</code> 中的连接与解析</h3>
<h4 data-id="heading-33">4.1 连接地址</h4>
<pre><code class="hljs language-bash" lang="bash">/api/api/notify/stream
</code></pre>
<p>说明：</p>
<ul>
<li>浏览器视角：<code>http://localhost:3003/api/api/notify/stream</code>（同源）。</li>
<li>Vite 代理：去掉第一个 <code>/api</code> → <code>/api/notify/stream</code>。</li>
<li>后端视角：<code>http://127.0.0.1:8081/api/notify/stream</code>（与接口文档一致）。</li>
</ul>
<h4 data-id="heading-34">4.2 建立 SSE 连接</h4>
<p><code>initNotificationStream</code> 负责发起连接：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initNotificationStream</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>
  <span class="hljs-keyword">if</span> (reading) <span class="hljs-keyword">return</span> <span class="hljs-comment">// 已在读流则不重复建立</span>

  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> sseUrl = <span class="hljs-string">'/api/api/notify/stream'</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 准备建立连接:'</span>, sseUrl)

    abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
    reading = <span class="hljs-literal">true</span>
    notificationStore.<span class="hljs-title function_">setSseConnected</span>(<span class="hljs-literal">true</span>)

    <span class="hljs-title function_">fetch</span>(sseUrl, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-title class_">Accept</span>: <span class="hljs-string">'text/event-stream'</span>,
        <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span>,
        ...(userStore.<span class="hljs-property">token</span>
          ? { <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${userStore.token}</span>`</span> }
          : {})
      },
      <span class="hljs-attr">credentials</span>: <span class="hljs-string">'include'</span>,
      <span class="hljs-attr">signal</span>: abortController.<span class="hljs-property">signal</span>
    })
      .<span class="hljs-title function_">then</span>(<span class="hljs-comment">/* 处理响应与读流 */</span>)
      .<span class="hljs-keyword">catch</span>(<span class="hljs-comment">/* 错误处理 */</span>)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>关键点：</p>
<ul>
<li>使用原生 <code>fetch</code> 而不是 <code>EventSource</code>，是因为需要自定义 <code>Authorization</code> 头。</li>
<li>通过 <code>Authorization: Bearer &lt;token&gt;</code> 携带登录状态，兼容后端鉴权逻辑。</li>
<li><code>credentials: 'include'</code> 保留 Cookie 信息（如果后端需要）。</li>
</ul>
<h4 data-id="heading-35">4.3 处理 HTTP 响应并输出基础日志</h4>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (response) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 响应状态:'</span>, response.<span class="hljs-property">status</span>, response.<span class="hljs-property">statusText</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 响应头 content-type:'</span>, response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-type'</span>))

  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span> || !response.<span class="hljs-property">body</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`SSE 连接失败: <span class="hljs-subst">${response.status}</span>`</span>)
  }

  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>()
  <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>)
  <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>

  <span class="hljs-comment">// 持续读流...</span>
})
</code></pre>
<p>此时在浏览器控制台可以看到：</p>
<ul>
<li><code>[SSE] 响应状态: 200 OK</code></li>
<li><code>[SSE] 响应头 content-type: text/event-stream;charset=UTF-8</code></li>
</ul>
<h4 data-id="heading-36">4.4 持续读取 SSE 流并解析事件</h4>
<p>核心循环逻辑：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>()
  <span class="hljs-keyword">if</span> (done) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 流已结束'</span>)
    <span class="hljs-keyword">break</span>
  }

  buffer += decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> })
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 收到原始 chunk:'</span>, buffer)

  <span class="hljs-comment">// 根据 \n\n 切分事件块</span>
  <span class="hljs-keyword">const</span> events = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>)
  buffer = events.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">''</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rawEvent <span class="hljs-keyword">of</span> events) {
    <span class="hljs-keyword">const</span> lines = rawEvent.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
    <span class="hljs-keyword">let</span> eventType = <span class="hljs-string">'message'</span>
    <span class="hljs-keyword">let</span> data = <span class="hljs-string">''</span>
    <span class="hljs-keyword">let</span> lastEventId = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
      <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'event:'</span>)) {
        eventType = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>).<span class="hljs-title function_">trim</span>()
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data:'</span>)) {
        data += line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">trim</span>()
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'id:'</span>)) {
        lastEventId = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">3</span>).<span class="hljs-title function_">trim</span>()
      }
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[SSE] 解析到事件:'</span>, {
      eventType,
      lastEventId,
      data,
      rawEvent
    })

    <span class="hljs-keyword">if</span> (lastEventId) {
      notificationStore.<span class="hljs-title function_">setLastEventId</span>(lastEventId)
    }

    <span class="hljs-keyword">if</span> (eventType === <span class="hljs-string">'heartbeat'</span>) <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">if</span> (!data) <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> parsed = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data)
      notificationStore.<span class="hljs-title function_">handleIncomingNotification</span>(parsed)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'解析通知 SSE 消息失败:'</span>, error, data)
    }
  }
}
</code></pre>
<p><strong>控制台能看到的典型日志（以 PRIVATE_MESSAGE 为例）：</strong></p>
<ul>
<li><code>[SSE] 收到原始 chunk: id:21\nevent:PRIVATE_MESSAGE\ndata:{"id":21,"userId":3,"type":"PRIVATE_MESSAGE",...}\n\n</code></li>
<li><code>[SSE] 解析到事件: { eventType: 'PRIVATE_MESSAGE', lastEventId: '21', data: '{"id":21,"userId":3,"type":"PRIVATE_MESSAGE",...}', rawEvent: 'id:21\nevent:PRIVATE_MESSAGE\ndata:{"id":21,...}' }</code></li>
</ul>
<hr/>
<h3 data-id="heading-37">五、通知 Store：如何消费和存储 SSE 消息</h3>
<p>文件：<code>src/stores/notification.js</code></p>
<h4 data-id="heading-38">5.1 状态结构</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">unreadCount</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">notifications</span>: [],
  <span class="hljs-attr">pagination</span>: {
    <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">current</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">pages</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">loadingList</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">loadingUnread</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">sseConnected</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">lastEventId</span>: <span class="hljs-literal">null</span>
})
</code></pre>
<h4 data-id="heading-39">5.2 处理 SSE 推送的新通知</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">handleIncomingNotification</span>(<span class="hljs-params">notification</span>) {
  <span class="hljs-keyword">if</span> (!notification || !notification.<span class="hljs-property">id</span>) {
    <span class="hljs-comment">// 当前约定：必须有 id 才认为是有效通知</span>
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> exists = <span class="hljs-variable language_">this</span>.<span class="hljs-property">notifications</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === notification.<span class="hljs-property">id</span>)
  <span class="hljs-keyword">if</span> (!exists) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">notifications</span> = [notification, ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">notifications</span>]
  }

  <span class="hljs-comment">// 未显式标记为 READ 的，都算未读</span>
  <span class="hljs-keyword">if</span> (!notification.<span class="hljs-property">status</span> || notification.<span class="hljs-property">status</span> === <span class="hljs-string">'UNREAD'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">unreadCount</span> += <span class="hljs-number">1</span>
  }
}
</code></pre>
<p><strong>效果：</strong></p>
<ul>
<li>每一条从 SSE 收到的 JSON 通知（包含 <code>id</code> 字段）会被添加到 <code>notifications</code> 列表顶部。</li>
<li>未读数量 <code>unreadCount</code> 会自增，用于 Header 红点等 UI 展示。</li>
</ul>
<hr/>
<h3 data-id="heading-40">六、UI 展示：从 Store 到页面/控制台</h3>
<h4 data-id="heading-41">6.1 Header 铃铛红点</h4>
<p>文件：<code>src/components/Header/index.vue</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()
<span class="hljs-keyword">const</span> hasUnread = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> notificationStore.<span class="hljs-property">unreadCount</span> &gt; <span class="hljs-number">0</span>)
</code></pre>
<p>在模板中：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;button class="gridButton" @click="handleNotificationClick"&gt;
  &lt;span style="position: relative; display: inline-block;"&gt;
    &lt;i class="fas fa-bell text-lg"&gt;&lt;/i&gt;
    &lt;span v-if="hasUnread" class="unreadBadge"&gt;&lt;/span&gt;
  &lt;/span&gt;
&lt;/button&gt;
</code></pre>
<p>当 SSE 收到任意一条未读通知：</p>
<ul>
<li><code>handleIncomingNotification</code> → <code>unreadCount++</code></li>
<li><code>hasUnread</code> 变为 <code>true</code></li>
<li><code>unreadBadge</code> 渲染，小红点点亮。</li>
</ul>
<h4 data-id="heading-42">6.2 用户中心「消息通知」页面</h4>
<p>文件：<code>src/pages/UserCenter/pages/Notifications/index.vue</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> notificationStore = <span class="hljs-title function_">useNotificationStore</span>()

<span class="hljs-keyword">const</span> notifications = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> notificationStore.<span class="hljs-property">notifications</span>)
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> notificationStore.<span class="hljs-property">loadingList</span>)
</code></pre>
<p>首次进入页面时，会从后端拉一次历史通知列表：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  notificationStore.<span class="hljs-title function_">fetchNotifications</span>({
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-string">'ALL'</span>
  })
})
</code></pre>
<p>当 SSE 推送新通知时：</p>
<ul>
<li>Store 的 <code>notifications</code> 首元素会是最新一条；</li>
<li>此页面会自动响应式更新，用户可以点击查看并标记为已读。</li>
</ul>
<hr/>
<h3 data-id="heading-43">最后、小结</h3>
<ol>
<li><strong>建立连接</strong>：<code>/api/notify/stream</code> → <code>NotificationService.connect</code> → 维护 <code>emitterPool</code> + 心跳 + 历史补发。</li>
<li><strong>创建通知</strong>：各业务（如私信模块）调用 <code>NotificationService.createAndDispatch</code>，将通知写入 <code>notification</code> 表并尝试通过 SSE 推送。</li>
<li><strong>接收与补发</strong>：在线用户通过 SSE 立即收到通知；离线用户下次连接时通过 <code>Last-Event-ID</code> 或未读筛选补发（最多 100 条）。</li>
<li><strong>已读/未读管理</strong>：<code>/api/notify/read</code> 和 <code>/api/notify/unread-count</code> 负责已读标记与未读统计。</li>
<li><strong>列表与分页</strong>：<code>/api/notify/recent</code> 提供最近未读调试接口；<code>/api/notify/list</code> 提供按状态过滤的分页通知列表。</li>
<li><strong>私信集成</strong>：<code>ChatServiceImpl</code> 在单聊离线场景下，为接收方生成 <code>PRIVATE_MESSAGE</code> 通知，实现“有人给你发私信”类型的系统提示。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎯 Rect 中鼠标移动拾取元素可行性架构分析]]></title>    <link>https://juejin.cn/post/7583952017674190899</link>    <guid>https://juejin.cn/post/7583952017674190899</guid>    <pubDate>2025-12-16T01:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674190899" data-draft-id="7583933107689701439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎯 Rect 中鼠标移动拾取元素可行性架构分析"/> <meta itemprop="keywords" content="前端,架构,React.js"/> <meta itemprop="datePublished" content="2025-12-16T01:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎯 Rect 中鼠标移动拾取元素可行性架构分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:46:15.000Z" title="Tue Dec 16 2025 01:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧠 一、背景：什么是拾取（Picking）？</h2>
<p>“拾取”是指<strong>从用户交互的二维输入（鼠标、触控）映射到图形对象</strong>的过程。</p>
<p>想象你在一个可视化编辑器中移动鼠标指针——当光标悬浮在某个矩形（Rect）上，它高亮、变色、提示“我被选中了”，这就是 <em>拾取系统</em> 在背后施展魔法。✨</p>
<p>在二维场景中，拾取方案通常分三类：</p>





























<table><thead><tr><th>模式</th><th>原理</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>几何拾取</td><td>在逻辑层判断 <code>(x,y)</code> 与各对象边界关系</td><td>精确、轻量</td><td>大量元素时耗性能</td></tr><tr><td>GPU颜色拾取（Color Picking）</td><td>每个对象渲染唯一颜色，对鼠标点取色</td><td>准确、独立于形状复杂度</td><td>需额外渲染缓冲区</td></tr><tr><td>空间索引拾取（QuadTree / BVH）</td><td>建立空间数据结构加速命中查找</td><td>高效、可扩展</td><td>实现复杂度高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">🔬 二、可行性架构核心要点</h2>
<h3 data-id="heading-2">（1）数据层：结构化管理 Rect 元素</h3>
<p>首先要有“<strong>可索引、可快速命中</strong>”的数据结构。<br/>
假设每个矩形元素都有如下属性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rect</span> {
  <span class="hljs-keyword">constructor</span>(id, x, y, width, height) {
    <span class="hljs-keyword">this</span>.id = id;
    <span class="hljs-keyword">this</span>.bounds = { x, y, width, height };
    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">"normal"</span>; <span class="hljs-comment">// normal, hover, selected</span>
  }

  contains(px, py) {
    <span class="hljs-keyword">return</span> (
      px &gt;= <span class="hljs-keyword">this</span>.bounds.x &amp;&amp;
      px &lt;= <span class="hljs-keyword">this</span>.bounds.x + <span class="hljs-keyword">this</span>.bounds.width &amp;&amp;
      py &gt;= <span class="hljs-keyword">this</span>.bounds.y &amp;&amp;
      py &lt;= <span class="hljs-keyword">this</span>.bounds.y + <span class="hljs-keyword">this</span>.bounds.height
    );
  }
}
</code></pre>
<p>在小规模下，我们可直接线性扫描，但在数千个Rect场景中，这会让GPU哭泣 😭。</p>
<hr/>
<h3 data-id="heading-3">（2）空间层：区域加速结构设计</h3>
<p>为解决性能问题，可引入 <strong>QuadTree（四叉树）</strong> 进行空间划分。</p>
<p><strong>原理</strong>：</p>
<ul>
<li>将画布平面递归划分为四个象限，每个象限存储矩形对象集合。</li>
<li>鼠标移动时，只查询当前象限节点。</li>
<li>空间复杂度：O(n)，查询复杂度：平均 O(log n)。</li>
</ul>
<p>伪代码演示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadTree</span> {
  <span class="hljs-keyword">constructor</span>(boundary, capacity) {
    <span class="hljs-keyword">this</span>.boundary = boundary;  <span class="hljs-comment">// 当前节点矩形区域</span>
    <span class="hljs-keyword">this</span>.capacity = capacity;  <span class="hljs-comment">// 一个节点最多的元素数</span>
    <span class="hljs-keyword">this</span>.rects = [];
    <span class="hljs-keyword">this</span>.divided = <span class="hljs-literal">false</span>;
  }

  insert(rect) { <span class="hljs-comment">/* ...根据边界分裂插入逻辑... */</span> }

  query(point) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.boundary.contains(point)) <span class="hljs-keyword">return</span> [];
    let found = [];
    <span class="hljs-keyword">for</span> (let r of <span class="hljs-keyword">this</span>.rects) {
      <span class="hljs-keyword">if</span> (r.contains(point.x, point.y)) found.push(r);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.divided) {
      found.push(...<span class="hljs-keyword">this</span>.northwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.northeast.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southeast.query(point));
    }
    <span class="hljs-keyword">return</span> found;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">（3）事件层：鼠标移动拾取流逻辑</h3>
<p>核心逻辑架构如下：</p>
<pre><code class="hljs language-scss" lang="scss">mousemove
   ↓
拾取管理器 (PickManager)
   ↓
空间查询 (QuadTree.query)
   ↓
检测命中对象 (Rect.contains)
   ↓
状态同步 (hover / leave / select)
   ↓
渲染层重新绘制目标区域
</code></pre>
<p>完整简化实现：</p>
<pre><code class="hljs language-ini" lang="ini">canvas.addEventListener("mousemove", (e) =&gt; {
  const <span class="hljs-attr">mouse</span> = { x: e.<span class="hljs-literal">off</span>setX, y: e.<span class="hljs-literal">off</span>setY }<span class="hljs-comment">;</span>
  const <span class="hljs-attr">hitRects</span> = quadTree.query(mouse)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">newHover</span> = hitRects[<span class="hljs-number">0</span>] || null<span class="hljs-comment">;</span>
  if (currentHover !== newHover) {
    if (currentHover) <span class="hljs-attr">currentHover.state</span> = <span class="hljs-string">"normal"</span><span class="hljs-comment">;</span>
    if (newHover) <span class="hljs-attr">newHover.state</span> = <span class="hljs-string">"hover"</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">currentHover</span> = newHover<span class="hljs-comment">;</span>
    render()<span class="hljs-comment">; // 局部或全局重绘</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p>这样一来，我们实现了：</p>
<ul>
<li>✅ <strong>实时拾取</strong></li>
<li>✅ <strong>高效区域查询</strong></li>
<li>✅ <strong>状态分离与渲染解耦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-5">（4）渲染层：Canvas / WebGL 混合优化</h3>
<p>对于 Canvas 2D 场景，通常直接 redraw。<br/>
对于复杂 WebGL 场景，可采用双通道：</p>
<ol>
<li>主通道绘制可视内容；</li>
<li>拾取通道（off-screen buffer）绘制唯一颜色 ID；</li>
<li>鼠标事件时，通过 <code>gl.readPixels</code> 获取点击像素颜色 -&gt; 反查对象 ID。</li>
</ol>
<p>这种方案在大型交互式图形系统（如 Mapbox、Three.js）中用途极广。🌍</p>
<hr/>
<h2 data-id="heading-6">🧩 三、性能可行性分析</h2>



































<table><thead><tr><th align="left">指标</th><th align="left">几何拾取</th><th align="left">四叉树加速</th><th align="left">GPU颜色拾取</th></tr></thead><tbody><tr><td align="left">查询复杂度</td><td align="left">O(n)</td><td align="left">O(log n)</td><td align="left">O(1)</td></tr><tr><td align="left">渲染性能</td><td align="left">高CPU占用</td><td align="left">中等</td><td align="left">高GPU开销</td></tr><tr><td align="left">延迟</td><td align="left">极低</td><td align="left">低</td><td align="left">取决于颜色缓冲同步</td></tr><tr><td align="left">适用场景</td><td align="left">少量对象</td><td align="left">大量矩形元素</td><td align="left">复杂场景（3D/WebGL）</td></tr></tbody></table>
<p>结论：</p>
<blockquote>
<p>✅ 对于 Web 端二维 Rect 编辑器或设计工具，<strong>QuadTree + 几何拾取混合方案</strong> 是可行且优雅的架构选择。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">⚙️ 四、工程优化建议 🧪</h2>
<ol>
<li><strong>事件节流（throttle）</strong><br/>
避免每次 <code>mousemove</code> 都触发完整查询，可在 16ms（约60Hz）节流执行。</li>
<li><strong>局部重绘（Dirty Rect）</strong><br/>
只重绘状态变化区域，提升渲染性能。</li>
<li><strong>命中缓存（Hover Cache）</strong><br/>
若连续多帧命中同一元素，不重复查询，降低开销。</li>
<li><strong>交互优先级分层</strong><br/>
针对UI层、图形层分别拾取，按z-index排序命中结果。</li>
</ol>
<hr/>
<h2 data-id="heading-8">🪶 五、哲学层小结：拾取，不只是拾取</h2>
<p>“拾取”看似一个计算几何问题，实则是一次<strong>人与空间的映射关系重建</strong>。</p>
<p>当你从一块平面中精准捕捉一个矩形，背后是：</p>
<ul>
<li>一颗QuadTree在飞速判断区块；</li>
<li>一次GPU在色彩世界编码ID；</li>
<li>一份人机交互的默契在闪光。</li>
</ul>
<blockquote>
<p>工程的浪漫，藏在每一次 <code>mousemove</code> 中。💫</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🧭 总结</h2>






























<table><thead><tr><th>模块</th><th>关键技术</th><th>工程要点</th></tr></thead><tbody><tr><td>数据层</td><td>Rect 对象结构化</td><td>定义边界与状态</td></tr><tr><td>空间层</td><td>QuadTree or 网格划分</td><td>加速查询性能</td></tr><tr><td>事件层</td><td>MouseMove + 状态机</td><td>处理 hover/leave</td></tr><tr><td>渲染层</td><td>局部刷新 / GPU解码</td><td>平衡性能和准确性</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Matplotlib饼图绘制教程：从基础到进阶，精准展示数据占比]]></title>    <link>https://juejin.cn/post/7583871118949646386</link>    <guid>https://juejin.cn/post/7583871118949646386</guid>    <pubDate>2025-12-15T14:24:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583871118949646386" data-draft-id="7583878719544295433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Matplotlib饼图绘制教程：从基础到进阶，精准展示数据占比"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-15T14:24:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="永远是夏天"/> <meta itemprop="url" content="https://juejin.cn/user/1127429986061683"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Matplotlib饼图绘制教程：从基础到进阶，精准展示数据占比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1127429986061683/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    永远是夏天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T14:24:53.000Z" title="Mon Dec 15 2025 14:24:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>饼图是数据可视化中经典的占比类图表，核心用于展示各分类在整体中的比例关系，尤其适合类别数量较少（建议不超过8类）的场景。本文基于Matplotlib详解饼图的绘制方法，涵盖基础绘制、样式定制、进阶优化等核心知识点，结合实战案例让你快速掌握。</p>
<h2 data-id="heading-0">一、基础饼图绘制</h2>
<h3 data-id="heading-1">1. 核心语法与最简示例</h3>
<p>Matplotlib绘制饼图的核心函数是<code>plt.pie()</code>，只需传入“各分类数值”即可生成基础饼图。
示例：展示某电商平台各品类销售额占比</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 解决中文显示问题（通用配置）</span>
plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]  <span class="hljs-comment"># Windows</span>
<span class="hljs-comment"># plt.rcParams["font.sans-serif"] = ["PingFang SC"]  # macOS</span>
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

<span class="hljs-comment"># 1. 准备数据：分类名称 + 对应数值（数值会自动计算占比）</span>
categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]

<span class="hljs-comment"># 2. 创建画布</span>
plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))  <span class="hljs-comment"># 饼图建议用正方形画布，避免变形</span>

<span class="hljs-comment"># 3. 绘制基础饼图</span>
plt.pie(sales,  <span class="hljs-comment"># 核心数据：各分类数值</span>
        labels=categories)  <span class="hljs-comment"># 分类标签</span>

<span class="hljs-comment"># 4. 显示图表</span>
plt.title(<span class="hljs-string">"某电商平台各品类销售额占比"</span>, fontsize=<span class="hljs-number">14</span>)
plt.show()
</code></pre>
<h3 data-id="heading-2">2. 核心参数解析（基础版）</h3>



































<table><thead><tr><th>参数</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td><code>x</code></td><td>必选，各分类的数值（非占比，Matplotlib自动计算）</td><td><code>x=[250, 180, 220]</code></td></tr><tr><td><code>labels</code></td><td>分类标签，对应x的每个数值</td><td><code>labels=["服饰","美妆","食品"]</code></td></tr><tr><td><code>autopct</code></td><td>显示各部分占比，支持格式字符串</td><td><code>autopct="%1.1f%%"</code>（保留1位小数的百分比）</td></tr><tr><td><code>colors</code></td><td>自定义各扇区颜色</td><td><code>colors=["#FF6B6B","#4ECDC4","#45B7D1"]</code></td></tr><tr><td><code>startangle</code></td><td>饼图起始角度（默认从x轴正方向开始，逆时针绘制）</td><td><code>startangle=90</code>（从y轴正方向开始）</td></tr></tbody></table>
<p>优化版基础饼图（添加占比、自定义颜色）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
<span class="hljs-comment"># 自定义配色（推荐莫兰迪/清新色系，避免刺眼）</span>
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
<span class="hljs-comment"># 绘制饼图，添加占比和颜色</span>
plt.pie(sales,
        labels=categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,  <span class="hljs-comment"># 显示占比（1位小数）</span>
        colors=colors,
        startangle=<span class="hljs-number">90</span>)  <span class="hljs-comment"># 起始角度90度</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)  <span class="hljs-comment"># 强制饼图为正圆形（关键！避免拉伸变形）</span>
plt.show()
</code></pre>
<h2 data-id="heading-3">二、进阶优化：突出重点、提升可读性</h2>
<h3 data-id="heading-4">1. 突出核心分类（explode参数）</h3>
<p>通过<code>explode</code>参数可将指定扇区“分离”出来，突出重点类别（如占比最高的“数码”品类）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]
<span class="hljs-comment"># explode：对应每个扇区的分离距离，0为不分离，数值越大分离越远</span>
explode = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 仅“数码”扇区分离0.1距离</span>

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
plt.pie(sales,
        labels=categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,
        colors=colors,
        startangle=<span class="hljs-number">90</span>,
        explode=explode,  <span class="hljs-comment"># 启用分离效果</span>
        shadow=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># 添加阴影，增强立体感</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比（突出数码品类）"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h3 data-id="heading-5">2. 优化标签样式（字体、位置）</h3>
<p>默认标签可能重叠或样式单一，可通过<code>textprops</code>调整标签样式，或手动调整占比标签位置：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]
explode = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>)

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
<span class="hljs-comment"># 绘制饼图并捕获文本对象（用于后续调整）</span>
patches, texts, autotexts = plt.pie(
    sales,
    labels=categories,
    autopct=<span class="hljs-string">"%1.1f%%"</span>,
    colors=colors,
    startangle=<span class="hljs-number">90</span>,
    explode=explode,
    shadow=<span class="hljs-literal">True</span>,
    textprops={<span class="hljs-string">"fontsize"</span>: <span class="hljs-number">11</span>}  <span class="hljs-comment"># 统一设置标签字体大小</span>
)

<span class="hljs-comment"># 单独调整占比标签样式（如颜色、加粗）</span>
<span class="hljs-keyword">for</span> autotext <span class="hljs-keyword">in</span> autotexts:
    autotext.set_color(<span class="hljs-string">"white"</span>)  <span class="hljs-comment"># 占比文字设为白色</span>
    autotext.set_fontweight(<span class="hljs-string">"bold"</span>)  <span class="hljs-comment"># 加粗</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h3 data-id="heading-6">3. 处理小占比类别（避免标签重叠）</h3>
<p>若部分类别占比过小（如&lt;5%），可将其合并为“其他”类，或通过<code>pctdistance</code>调整占比标签位置：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

<span class="hljs-comment"># 原始数据：含小占比类别</span>
categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"图书"</span>, <span class="hljs-string">"配饰"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>, <span class="hljs-number">30</span>, <span class="hljs-number">20</span>]

<span class="hljs-comment"># 合并小占比类别（图书+配饰=其他）</span>
new_categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>, <span class="hljs-string">"其他"</span>]
new_sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>, <span class="hljs-number">50</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>, <span class="hljs-string">"#DDA0DD"</span>]

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
plt.pie(new_sales,
        labels=new_categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,
        colors=colors,
        startangle=<span class="hljs-number">90</span>,
        pctdistance=<span class="hljs-number">0.85</span>)  <span class="hljs-comment"># 占比标签距离圆心的比例（默认0.6，调大避免重叠）</span>

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比（合并小品类）"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h2 data-id="heading-7">三、特殊场景：环形饼图（空心饼图）</h2>
<p>环形饼图比普通饼图更美观，且可在中心添加文字，适合展示多层占比或突出视觉效果。
实现原理：绘制两个饼图，外层为数据，内层为白色填充的“空心”。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.rcParams[<span class="hljs-string">"font.sans-serif"</span>] = [<span class="hljs-string">"SimHei"</span>]
plt.rcParams[<span class="hljs-string">"axes.unicode_minus"</span>] = <span class="hljs-literal">False</span>

categories = [<span class="hljs-string">"服饰"</span>, <span class="hljs-string">"美妆"</span>, <span class="hljs-string">"食品"</span>, <span class="hljs-string">"数码"</span>, <span class="hljs-string">"家居"</span>]
sales = [<span class="hljs-number">250</span>, <span class="hljs-number">180</span>, <span class="hljs-number">220</span>, <span class="hljs-number">300</span>, <span class="hljs-number">150</span>]
colors = [<span class="hljs-string">"#FF6B6B"</span>, <span class="hljs-string">"#4ECDC4"</span>, <span class="hljs-string">"#45B7D1"</span>, <span class="hljs-string">"#96CEB4"</span>, <span class="hljs-string">"#FECA57"</span>]

plt.figure(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>))
<span class="hljs-comment"># 绘制外层数据饼图</span>
plt.pie(sales,
        labels=categories,
        autopct=<span class="hljs-string">"%1.1f%%"</span>,
        colors=colors,
        startangle=<span class="hljs-number">90</span>,
        wedgeprops={<span class="hljs-string">"width"</span>: <span class="hljs-number">0.3</span>})  <span class="hljs-comment"># width：环形宽度（0-1，越小越细）</span>

<span class="hljs-comment"># 绘制内层空心（白色填充）</span>
plt.pie([<span class="hljs-number">1</span>], colors=<span class="hljs-string">"white"</span>, radius=<span class="hljs-number">0.7</span>)  <span class="hljs-comment"># radius：内层半径（小于外层）</span>

<span class="hljs-comment"># 中心添加文字</span>
plt.text(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"总销售额\n1100万"</span>, ha=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"center"</span>, fontsize=<span class="hljs-number">12</span>)

plt.title(<span class="hljs-string">"某电商平台各品类销售额占比（环形图）"</span>, fontsize=<span class="hljs-number">14</span>)
plt.axis(<span class="hljs-string">"equal"</span>)
plt.show()
</code></pre>
<h2 data-id="heading-8">四、饼图绘制注意事项</h2>
<ol>
<li><strong>适用场景</strong>：仅用于展示“部分-整体”关系，且类别数不宜过多（建议≤6类），否则扇区过小、可读性差；</li>
<li><strong>避免误导</strong>：饼图的视觉效果易受起始角度、扇区顺序影响，若需精准对比占比，优先用柱状图；</li>
<li><strong>正圆形保障</strong>：务必添加<code>plt.axis("equal")</code>，否则画布拉伸会导致饼图变形为椭圆；</li>
<li><strong>中文与负号</strong>：始终配置<code>rcParams</code>解决中文乱码和负号显示问题；</li>
<li><strong>保存高清图</strong>：用<code>plt.savefig("饼图.png", dpi=300, bbox_inches="tight")</code>替代<code>plt.show()</code>，避免文字截断。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[线程池中任务堆积与饥饿死锁问题]]></title>    <link>https://juejin.cn/post/7583943503556198450</link>    <guid>https://juejin.cn/post/7583943503556198450</guid>    <pubDate>2025-12-16T01:03:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556198450" data-draft-id="7583912637471244339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="线程池中任务堆积与饥饿死锁问题"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-16T01:03:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="uup"/> <meta itemprop="url" content="https://juejin.cn/user/4378706456356627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            线程池中任务堆积与饥饿死锁问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378706456356627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    uup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:03:44.000Z" title="Tue Dec 16 2025 01:03:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Bug 场景</h2>
<p>在一个电商后台系统中，使用线程池来处理订单处理、库存更新、物流通知等多种异步任务。随着业务量的增长，系统逐渐出现响应变慢的情况，部分任务甚至长时间得不到执行，最终导致一些关键业务流程受阻。</p>
<h2 data-id="heading-1">二、代码示例</h2>
<h3 data-id="heading-2">任务类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BusinessTask</span><span class="hljs-params">(String taskName)</span> {
        <span class="hljs-built_in">this</span>.taskName = taskName;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟业务处理</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
            System.out.println(taskName + <span class="hljs-string">" 任务完成"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h3 data-id="heading-3">线程池配置与任务提交（有缺陷）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceSystem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">KEEP_ALIVE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Runnable&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_CAPACITY);
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
                CORE_POOL_SIZE,
                MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                taskQueue);

        <span class="hljs-comment">// 模拟提交大量任务</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"任务 "</span> + i;
            executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessTask</span>(taskName));
        }

        executor.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow();
                <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                    System.err.println(<span class="hljs-string">"线程池未正常关闭"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h2 data-id="heading-4">三、问题描述</h2>
<ol>
<li>
<p><strong>预期行为</strong>：线程池能够高效处理提交的任务，所有任务都能在合理时间内完成，系统保持稳定运行。</p>
</li>
<li>
<p><strong>实际行为</strong>：</p>
<ul>
<li><strong>任务堆积</strong>：随着任务不断提交，任务队列逐渐被填满，新任务只能等待队列有空位或者线程池创建新线程（达到最大线程数后也只能等待）。这是因为线程池的核心线程数和最大线程数设置相对业务量过小，并且任务执行时间较长，导致任务处理速度跟不上提交速度。</li>
<li><strong>饥饿死锁</strong>：在任务队列中可能存在优先级不同的任务，例如订单处理任务优先级较高，物流通知任务优先级较低。如果高优先级任务持续提交，线程池中的线程会一直忙于处理高优先级任务，低优先级任务可能长时间得不到执行，出现饥饿现象。极端情况下，可能导致低优先级任务永远无法执行，形成一种类似死锁的状态。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-5">四、解决方案</h2>
<ol>
<li><strong>优化线程池参数</strong>：根据实际业务负载和任务特性，合理调整线程池参数。例如，如果任务执行时间较短且数量较多，可以适当增加核心线程数和最大线程数；如果任务执行时间较长，可以扩大任务队列容量。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
</code></pre>
<ol start="2">
<li><strong>使用优先级队列和优先级线程池</strong>：对任务进行优先级划分，使用 <code>PriorityBlockingQueue</code> 作为任务队列，并自定义 <code>PriorityThreadPoolExecutor</code> 来处理不同优先级的任务。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.PriorityBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityBusinessTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>, Comparable&lt;PriorityBusinessTask&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String taskName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> priority;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PriorityBusinessTask</span><span class="hljs-params">(String taskName, <span class="hljs-type">int</span> priority)</span> {
        <span class="hljs-built_in">this</span>.taskName = taskName;
        <span class="hljs-built_in">this</span>.priority = priority;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 模拟业务处理</span>
            Thread.sleep(<span class="hljs-number">1000</span>);
            System.out.println(taskName + <span class="hljs-string">" 任务完成"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(PriorityBusinessTask other)</span> {
        <span class="hljs-keyword">return</span> Integer.compare(other.priority, <span class="hljs-built_in">this</span>.priority);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadPoolExecutor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PriorityThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize, <span class="hljs-type">int</span> maximumPoolSize, <span class="hljs-type">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)</span> {
        <span class="hljs-built_in">super</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeExecute</span><span class="hljs-params">(Thread t, Runnable r)</span> {
        <span class="hljs-built_in">super</span>.beforeExecute(t, r);
        <span class="hljs-keyword">if</span> (r <span class="hljs-keyword">instanceof</span> PriorityBusinessTask) {
            System.out.println(<span class="hljs-string">"开始执行优先级任务: "</span> + ((PriorityBusinessTask) r).taskName);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterExecute</span><span class="hljs-params">(Runnable r, Throwable t)</span> {
        <span class="hljs-built_in">super</span>.afterExecute(r, t);
        <span class="hljs-keyword">if</span> (r <span class="hljs-keyword">instanceof</span> PriorityBusinessTask) {
            System.out.println(<span class="hljs-string">"完成优先级任务: "</span> + ((PriorityBusinessTask) r).taskName);
        }
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceSystem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">KEEP_ALIVE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Runnable&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBlockingQueue</span>&lt;&gt;(QUEUE_CAPACITY);
        <span class="hljs-type">PriorityThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityThreadPoolExecutor</span>(
                CORE_POOL_SIZE,
                MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                taskQueue);

        <span class="hljs-comment">// 模拟提交不同优先级任务</span>
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"高优先级任务 1"</span>, <span class="hljs-number">1</span>));
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"低优先级任务 1"</span>, <span class="hljs-number">3</span>));
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"高优先级任务 2"</span>, <span class="hljs-number">1</span>));
        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityBusinessTask</span>(<span class="hljs-string">"低优先级任务 2"</span>, <span class="hljs-number">3</span>));

        executor.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow();
                <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                    System.err.println(<span class="hljs-string">"线程池未正常关闭"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<ol start="3">
<li><strong>动态调整线程池</strong>：根据系统运行时的任务队列长度、线程池活跃线程数等指标，动态调整线程池的参数，以适应业务量的变化。可以使用定时任务定期检查并调整线程池大小。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.ScheduledThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EcommerceSystem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INITIAL_CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INITIAL_MAX_POOL_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">KEEP_ALIVE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BlockingQueue&lt;Runnable&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_CAPACITY);
        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
                INITIAL_CORE_POOL_SIZE,
                INITIAL_MAX_POOL_SIZE,
                KEEP_ALIVE_TIME,
                TimeUnit.SECONDS,
                taskQueue);

        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(<span class="hljs-number">1</span>);
        scheduler.scheduleAtFixedRate(() -&gt; {
            <span class="hljs-type">int</span> <span class="hljs-variable">queueSize</span> <span class="hljs-operator">=</span> taskQueue.size();
            <span class="hljs-type">int</span> <span class="hljs-variable">activeCount</span> <span class="hljs-operator">=</span> executor.getActiveCount();
            <span class="hljs-keyword">if</span> (queueSize &gt; QUEUE_CAPACITY * <span class="hljs-number">0.8</span> &amp;&amp; activeCount &lt; INITIAL_MAX_POOL_SIZE) {
                executor.setCorePoolSize(executor.getCorePoolSize() + <span class="hljs-number">1</span>);
                executor.setMaximumPoolSize(executor.getMaximumPoolSize() + <span class="hljs-number">1</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (queueSize &lt; QUEUE_CAPACITY * <span class="hljs-number">0.2</span> &amp;&amp; activeCount &gt; INITIAL_CORE_POOL_SIZE) {
                executor.setCorePoolSize(executor.getCorePoolSize() - <span class="hljs-number">1</span>);
                executor.setMaximumPoolSize(executor.getMaximumPoolSize() - <span class="hljs-number">1</span>);
            }
        }, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.MINUTES);

        <span class="hljs-comment">// 模拟提交大量任务</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">taskName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"任务 "</span> + i;
            executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessTask</span>(taskName));
        }

        executor.shutdown();
        scheduler.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                executor.shutdownNow();
                <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
                    System.err.println(<span class="hljs-string">"线程池未正常关闭"</span>);
                }
            }
            <span class="hljs-keyword">if</span> (!scheduler.awaitTermination(<span class="hljs-number">1</span>, TimeUnit.MINUTES)) {
                scheduler.shutdownNow();
                <span class="hljs-keyword">if</span> (!scheduler.awaitTermination(<span class="hljs-number">1</span>, TimeUnit.MINUTES)) {
                    System.err.println(<span class="hljs-string">"调度器未正常关闭"</span>);
                }
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            executor.shutdownNow();
            scheduler.shutdownNow();
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3的`:style`对象语法：单位、属性名、响应式，这些细节你都踩过坑吗？]]></title>    <link>https://juejin.cn/post/7583910418658983982</link>    <guid>https://juejin.cn/post/7583910418658983982</guid>    <pubDate>2025-12-15T16:08:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910418658983982" data-draft-id="7583912637470605363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3的`:style`对象语法：单位、属性名、响应式，这些细节你都踩过坑吗？    "/> <meta itemprop="keywords" content="前端,AI编程,Trae"/> <meta itemprop="datePublished" content="2025-12-15T16:08:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3的`:style`对象语法：单位、属性名、响应式，这些细节你都踩过坑吗？    
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:08:48.000Z" title="Mon Dec 15 2025 16:08:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、从“动态改样式”说起：为什么需要<code>:style</code>对象语法？</h3>
<p>在实际开发中，我们经常遇到**“数据变，样式跟着变”**的场景——比如：</p>
<ul>
<li>按钮点击后从蓝色变成绿色；</li>
<li>进度条的宽度随完成度增加；</li>
<li>文本的字体大小根据用户设置调整。</li>
</ul>
<p>这些场景如果用原生JS实现，需要手动操作<code>element.style</code>，代码繁琐且容易出错。而Vue3的<code>:style</code>绑定（全称<code>v-bind:style</code>），尤其是<strong>对象语法</strong>，能让我们用“声明式”的方式把响应式数据和样式关联起来，优雅解决动态样式问题。</p>
<h3 data-id="heading-1">二、<code>:style</code>对象语法基础：把样式写成“键值对”</h3>
<p><code>:style</code>的对象语法本质是<strong>将CSS样式映射为JavaScript对象</strong>——对象的<strong>键</strong>是CSS属性（如<code>color</code>、<code>fontSize</code>），<strong>值</strong>是要绑定的响应式数据（或普通值）。</p>
<h4 data-id="heading-2">1. 最简示例：绑定颜色和字体大小</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 用:style绑定对象，键是CSS属性，值是响应式数据 --&gt;
  &lt;div :style="{ color: textColor, fontSize: fontSize + 'px' }"&gt;
    我是动态样式的文本
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 响应式颜色：初始红色
const textColor = ref('red')
// 响应式字体大小：初始30px（数字需加单位）
const fontSize = ref(30)
&lt;/script&gt;
</code></pre>
<p><strong>关键点解释</strong>：</p>
<ul>
<li><strong>CSS属性的键</strong>：可以用<strong>驼峰命名</strong>（如<code>fontSize</code>）或<strong>短横线命名</strong>（如<code>'font-size'</code>，需加引号），Vue会自动将驼峰转成短横线（对应CSS原生属性）。</li>
<li><strong>值的单位</strong>：CSS大部分属性需要单位（如<code>px</code>、<code>em</code>），Vue<strong>不会自动添加单位</strong>（除非值是<code>0</code>）。因此<code>fontSize</code>需要手动拼接<code>'px'</code>，否则会渲染成无效的<code>font-size: 30</code>。</li>
</ul>
<h3 data-id="heading-3">三、响应式数据绑定：让样式“跟着数据走”</h3>
<p><code>:style</code>的核心优势是<strong>响应式</strong>——当绑定的<code>ref</code>或<code>reactive</code>数据变化时，样式会自动更新。</p>
<h4 data-id="heading-4">实战：点击换色按钮</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;button 
    @click="toggleColor"
    :style="{ 
      backgroundColor: btnBg, 
      color: 'white', 
      padding: '8px 16px', 
      border: 'none', 
      borderRadius: '4px',
      cursor: 'pointer'
    }"
  &gt;
    {{ btnText }}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 响应式背景色：初始蓝色
const btnBg = ref('#2196F3')
// 响应式按钮文本
const btnText = ref('点击变绿')

// 点击事件：切换颜色和文本
const toggleColor = () =&gt; {
  if (btnBg.value === '#2196F3') {
    btnBg.value = '#4CAF50' // 切换为绿色
    btnText.value = '点击变蓝'
  } else {
    btnBg.value = '#2196F3' // 切换回蓝色
    btnText.value = '点击变绿'
  }
}
&lt;/script&gt;
</code></pre>
<p><strong>效果</strong>：点击按钮时，<code>btnBg</code>和<code>btnText</code>的响应式数据变化，按钮的背景色和文本会<strong>自动更新</strong>——无需手动操作DOM，这就是Vue的“数据驱动视图”魅力。</p>
<h3 data-id="heading-5">四、CSS属性类型：字符串、数字、布尔值怎么用？</h3>
<p><code>:style</code>支持的样式值类型主要有3种：</p>

























<table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>字符串</td><td>最常用，适用于需要单位或关键字的属性（如颜色、边框、字体）</td><td><code>'red'</code>、<code>'2px solid gray'</code></td></tr><tr><td>数字</td><td>仅适用于无需单位的属性（如<code>z-index</code>、<code>opacity</code>）或需手动加单位的情况</td><td><code>30</code>（需转<code>'30px'</code>）、<code>0.5</code></td></tr><tr><td>布尔值</td><td>用于条件控制样式值（最终还是字符串）</td><td><code>isShow ? 'block' : 'none'</code></td></tr></tbody></table>
<h4 data-id="heading-6">示例：用布尔值控制显示隐藏</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div :style="{ display: isVisible ? 'block' : 'none' }"&gt;
    我是可以隐藏的文本
  &lt;/div&gt;
  &lt;button @click="isVisible = !isVisible"&gt;
    {{ isVisible ? '隐藏' : '显示' }}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 布尔值控制显示状态
const isVisible = ref(true)
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-7">五、驼峰vs短横线：选哪个更顺手？</h3>
<p><code>:style</code>的对象键支持两种写法，效果完全一致：</p>




















<table><thead><tr><th>写法</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>驼峰命名（推荐）</td><td><code>fontSize: '30px'</code></td><td>符合JavaScript对象命名习惯，无需引号</td></tr><tr><td>短横线命名</td><td><code>'font-size': '30px'</code></td><td>贴近CSS原生写法，需加引号</td></tr></tbody></table>
<p><strong>推荐用驼峰</strong>：更简洁，不用记引号，且Vue官方文档也更倾向这种写法。</p>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">如何用Git Hook和CI流水线为FastAPI项目保驾护航？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<h3 data-id="heading-8">六、实际案例：动态进度条</h3>
<p>我们来做一个<strong>实用的动态进度条</strong>——点击按钮增加进度，进度条的宽度和颜色随进度变化：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="progress-container"&gt;
    &lt;!-- 进度条背景 --&gt;
    &lt;div class="progress-bg"&gt;
      &lt;!-- 动态进度条：宽度=progress%，颜色随进度变化 --&gt;
      &lt;div 
        class="progress-bar"
        :style="{ 
          width: progress + '%', 
          backgroundColor: progress &gt; 50 ? '#4CAF50' : '#FF9800' 
        }"
      &gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- 控制按钮 --&gt;
    &lt;button @click="addProgress" :disabled="progress &gt;= 100"&gt;
      {{ progress &gt;= 100 ? '进度已满' : '增加进度' }}
    &lt;/button&gt;
    &lt;!-- 进度显示 --&gt;
    &lt;p class="progress-text"&gt;当前进度：{{ progress }}%&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 响应式进度值：初始0%
const progress = ref(0)

// 增加进度：每次加10，最多100
const addProgress = () =&gt; {
  if (progress.value &lt; 100) {
    progress.value += 10
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.progress-container {
  margin: 20px;
  font-family: Arial, sans-serif;
}
.progress-bg {
  width: 300px;
  height: 20px;
  background-color: #f0f0f0;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 10px;
}
.progress-bar {
  height: 100%;
  transition: width 0.3s ease; /* 平滑过渡动画 */
  border-radius: 10px;
}
button {
  padding: 8px 16px;
  background-color: #2196F3;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
.progress-text {
  margin-top: 10px;
  font-size: 14px;
}
&lt;/style&gt;
</code></pre>
<p><strong>效果说明</strong>：</p>
<ul>
<li>进度条宽度：用<code>progress + '%'</code>动态绑定，进度从0到100时，宽度从0%到100%。</li>
<li>进度条颜色：用三元表达式<code>progress &gt; 50 ? '#4CAF50' : '#FF9800'</code>，进度超过50%变绿色，否则变橙色。</li>
<li>过渡动画：<code>transition: width 0.3s ease</code>让进度变化更平滑。</li>
</ul>
<h3 data-id="heading-9">七、课后Quiz：巩固知识点</h3>
<h4 data-id="heading-10">问题1：</h4>
<p>在Vue3中，使用<code>:style</code>对象语法时，为什么<code>fontSize</code>需要写成<code>fontSize + 'px'</code>而不是直接写<code>fontSize</code>？</p>
<p><strong>答案解析</strong>：<br/>
CSS的<code>font-size</code>属性需要<strong>单位</strong>（如<code>px</code>），而Vue不会自动为数字添加单位（除非值是<code>0</code>）。如果直接写<code>fontSize</code>（假设是<code>ref(30)</code>），模板会渲染成<code>font-size: 30</code>——这在CSS中是无效的，因此必须手动添加<code>'px'</code>变成<code>'30px'</code>。</p>
<h4 data-id="heading-11">问题2：</h4>
<p>请写出一个用<code>:style</code>对象语法绑定<strong>响应式背景色</strong>和<strong>边框</strong>的例子，要求：</p>
<ul>
<li>背景色是<code>ref('lightblue')</code>；</li>
<li>边框是<code>ref('2px solid gray')</code>。</li>
</ul>
<p><strong>答案示例</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div :style="{ backgroundColor: bgColor, border: borderStyle }"&gt;
    我是带动态样式的盒子
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

const bgColor = ref('lightblue')
const borderStyle = ref('2px solid gray')
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-12">八、常见报错与解决办法</h3>
<p>在使用<code>:style</code>时，这些错误你可能会遇到：</p>
<h4 data-id="heading-13">报错1：短横线键未加引号导致语法错误</h4>
<p><strong>错误代码</strong>：<code>{ font-size: '30px' }</code><br/>
<strong>原因</strong>：JavaScript对象的键如果包含<code>-</code>，必须用字符串引号包裹，否则会被解析成<strong>减法运算</strong>（<code>font - size</code>）。<br/>
<strong>解决</strong>：给短横线键加引号（<code>'font-size'</code>），或改用驼峰（<code>fontSize</code>）。</p>
<h4 data-id="heading-14">报错2：响应式数据变了，但样式没更新</h4>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 用let定义非响应式数据</span>
<span class="hljs-keyword">let</span> progress = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addProgress</span> = (<span class="hljs-params"/>) =&gt; {
  progress += <span class="hljs-number">10</span> <span class="hljs-comment">// Vue无法检测变化</span>
}
</code></pre>
<p><strong>原因</strong>：<code>let</code>变量不是响应式的，Vue无法追踪其变化。<br/>
<strong>解决</strong>：用<code>ref</code>或<code>reactive</code>定义响应式数据：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">addProgress</span> = (<span class="hljs-params"/>) =&gt; {
  progress.<span class="hljs-property">value</span> += <span class="hljs-number">10</span> <span class="hljs-comment">// 修改响应式数据</span>
}
</code></pre>
<h4 data-id="heading-15">报错3：属性名拼写错误导致样式不生效</h4>
<p><strong>错误代码</strong>：<code>{ backgroundcolor: 'lightblue' }</code>（小写<code>C</code>）<br/>
<strong>原因</strong>：CSS属性的驼峰命名必须正确（<code>backgroundColor</code>对应<code>background-color</code>），拼写错误会导致Vue无法识别。<br/>
<strong>解决</strong>：检查属性名的大小写，或用短横线加引号（<code>'background-color'</code>）。</p>
<h3 data-id="heading-16">参考链接</h3>
<p>Vue3官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fclass-and-style.html%23binding-inline-styles" target="_blank" title="https://vuejs.org/guide/essentials/class-and-style.html#binding-inline-styles" ref="nofollow noopener noreferrer">Class and Style Bindings - Binding Inline Styles</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue生命周期详解：从创建到销毁的全过程]]></title>    <link>https://juejin.cn/post/7583906478329020435</link>    <guid>https://juejin.cn/post/7583906478329020435</guid>    <pubDate>2025-12-15T16:09:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583906478329020435" data-draft-id="7583912899389456427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue生命周期详解：从创建到销毁的全过程"/> <meta itemprop="keywords" content="前端,面试,Vue.js"/> <meta itemprop="datePublished" content="2025-12-15T16:09:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="进击的野人"/> <meta itemprop="url" content="https://juejin.cn/user/1458425238667008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue生命周期详解：从创建到销毁的全过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458425238667008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    进击的野人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:09:59.000Z" title="Mon Dec 15 2025 16:09:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在学习 Vue 的过程中，我逐渐意识到一个问题：**为什么同样是写数据、改数据，有些代码只能写在某些地方？为什么定时器、请求、事件绑定如果位置不对，就会出 bug？**答案几乎都指向同一个核心概念——<strong>Vue 生命周期</strong>。</p>
<p>Vue 生命周期并不是抽象的“理论名词”，而是 Vue 在实例从创建到销毁的整个过程中，在<strong>关键时间点自动帮我们调用的一组函数</strong>。这些函数有固定的名字、固定的调用时机，而我们能做的，就是在合适的钩子中写合适的代码。</p>
<hr/>
<h2 data-id="heading-0">一、生命周期的本质：Vue 在“关键时刻”帮你调用函数</h2>
<p>从第一个示例可以看到，生命周期也被称为<strong>生命周期回调函数、生命周期函数或生命周期钩子</strong>。它的本质并不复杂：</p>
<blockquote>
<p>Vue 在内部流程的某些关键阶段，<strong>自动调用我们提前写好的函数</strong>1.引出生命周期</p>
</blockquote>
<p>有几个非常重要的特性需要先明确：</p>
<ul>
<li>生命周期函数的<strong>名字不能随便改</strong></li>
<li>生命周期函数内部的代码由开发者决定</li>
<li>生命周期函数中的 <code>this</code> 永远指向当前的 <strong>Vue 实例（vm）</strong></li>
</ul>
<p>也正因为 <code>this</code> 指向 vm，我们才能在生命周期中自由访问 <code>data</code>、<code>methods</code>、<code>computed</code> 等内容。</p>
<hr/>
<h2 data-id="heading-1">二、mounted：最常用、也最容易被误用的生命周期</h2>
<p>在第一个示例中，页面上有一段非常直观的动画效果：文字透明度不断降低，又循环恢复。这个效果并不是通过操作 DOM 实现的，而是通过<strong>修改响应式数据 opacity</strong> 来完成的1.引出生命周期。</p>
<p>关键代码写在了 <code>mounted()</code> 中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> -= <span class="hljs-number">0.01</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>;
    }
  }, <span class="hljs-number">16</span>)
}
</code></pre>
<p>之所以把定时器写在 <code>mounted</code>，原因非常明确：</p>
<ul>
<li>在 <code>mounted</code> 之前，模板还没有真正渲染成 DOM</li>
<li>只有在 <code>mounted</code> 执行时，<strong>真实 DOM 已经挂载完成</strong></li>
<li>所有依赖页面结构、DOM 或视图更新的逻辑，都应该放在这里</li>
</ul>
<p>需要特别注意的是：<br/>
<strong>mounted 只会在“初次挂载”时调用一次</strong>，后续数据变化引起的重新渲染，并不会再次触发 mounted，而是走更新相关的生命周期。</p>
<hr/>
<h2 data-id="heading-2">三、为什么要学 beforeDestroy？——生命周期的“收尾阶段”</h2>
<p>第二个示例在第一个基础上进一步完善了逻辑，引出了一个非常现实的问题：<br/>
**定时器什么时候清？Vue 实例销毁后会发生什么？**1.总结生命周期</p>
<p>在这个例子中，点击“点我停止”按钮，会调用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">this</span>.$destroy();
</code></pre>
<p>这行代码会手动销毁当前 Vue 实例，而在销毁之前，Vue 会调用 <code>beforeDestroy()</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);
}
</code></pre>
<p>这正是生命周期的<strong>收尾价值所在</strong>。</p>
<p>在实际开发中：</p>
<ul>
<li><code>mounted</code> 负责“初始化”</li>
<li><code>beforeDestroy</code> 负责“清理善后”</li>
</ul>
<p>例如：</p>
<ul>
<li>清除定时器</li>
<li>解绑自定义事件</li>
<li>取消消息订阅</li>
<li>关闭 WebSocket 连接</li>
</ul>
<p>如果不在销毁前清理这些内容，就会导致<strong>内存泄漏</strong>，甚至逻辑混乱。</p>
<p>另外，示例中还明确指出：</p>
<ul>
<li>Vue 实例销毁后，开发者工具中将不再显示该实例</li>
<li>Vue 的自定义事件会失效</li>
<li>原生 DOM 事件依然存在</li>
<li>在 <code>beforeDestroy</code> 中修改数据是没有意义的，因为更新流程已经不会再触发了1.总结生命周期</li>
</ul>
<hr/>
<h2 data-id="heading-3">四、完整生命周期流程：从 beforeCreate 到 destroyed</h2>
<p>第三个示例是对 Vue 生命周期最系统的一次演示，它几乎覆盖了所有常见的生命周期钩子，并通过 <code>console.log</code> 清晰地展示了调用顺序2.分析生命周期。</p>
<h3 data-id="heading-4">1️⃣ beforeCreate</h3>
<p>这是 Vue 实例刚被创建时调用的钩子：</p>
<ul>
<li>data 尚未初始化</li>
<li>methods 尚未初始化</li>
<li>访问 <code>this.n</code> 得到的是 <code>undefined</code></li>
</ul>
<p>这说明：<br/>
<strong>beforeCreate 几乎不适合写业务代码</strong></p>
<hr/>
<h3 data-id="heading-5">2️⃣ created</h3>
<p>在这个阶段：</p>
<ul>
<li>data 已经变成响应式数据</li>
<li>methods 已经可以正常调用</li>
<li>但 DOM 还没有生成</li>
</ul>
<p>如果你只关心数据、而不依赖页面结构，<code>created</code> 是一个可以使用的阶段。</p>
<hr/>
<h3 data-id="heading-6">3️⃣ beforeMount</h3>
<p>此时：</p>
<ul>
<li>模板已经编译完成</li>
<li>虚拟 DOM 已经生成</li>
<li>但还没有挂载到页面上</li>
</ul>
<p>打印 <code>this.$el</code> 会发现，它还不是最终呈现在页面中的 DOM。</p>
<hr/>
<h3 data-id="heading-7">4️⃣ mounted（最重要）</h3>
<p>这是生命周期中<strong>使用频率最高</strong>的一个钩子：</p>
<ul>
<li>虚拟 DOM 已转为真实 DOM</li>
<li>页面已经完成首次渲染</li>
<li><code>$el</code> 就是页面中真实存在的 DOM</li>
</ul>
<p>几乎所有涉及 DOM、视图、第三方库初始化的逻辑，都应该写在这里。</p>
<hr/>
<h3 data-id="heading-8">5️⃣ beforeUpdate / updated</h3>
<p>当数据发生变化时：</p>
<ul>
<li><code>beforeUpdate</code> 在视图更新之前触发</li>
<li><code>updated</code> 在视图更新之后触发</li>
</ul>
<p>它们常用于：</p>
<ul>
<li>调试</li>
<li>对比更新前后的状态</li>
<li>少量特殊场景下的 DOM 同步操作</li>
</ul>
<p>但在实际业务中，<strong>不建议滥用更新钩子</strong>。</p>
<hr/>
<h3 data-id="heading-9">6️⃣ beforeDestroy / destroyed</h3>
<p>这是 Vue 实例生命周期的终点：</p>
<ul>
<li><code>beforeDestroy</code>：还能访问 data 和 methods</li>
<li><code>destroyed</code>：实例已经彻底不可用</li>
</ul>
<p>一般来说，真正有价值的是 <code>beforeDestroy</code>，而 <code>destroyed</code> 很少使用。</p>
<hr/>
<h2 data-id="heading-10">五、从“记生命周期”到“会用生命周期”</h2>
<p>通过这三段代码可以清楚地看到，生命周期并不是让人死记硬背的流程图，而是一套<strong>明确解决实际问题的时间节点机制</strong>：</p>
<ul>
<li>初始化逻辑 → <code>mounted</code></li>
<li>数据准备 → <code>created</code></li>
<li>DOM 操作 → <code>mounted</code></li>
<li>更新监听 → <code>updated</code></li>
<li>清理资源 → <code>beforeDestroy</code></li>
</ul>
<p>当我真正理解这些钩子的<strong>调用时机和设计目的</strong>之后，很多之前“写着写着就出 bug”的问题，都会自然消失。</p>
<p>Vue 生命周期的学习重点，从来不是“有多少个钩子”，而是——<br/>
<strong>在对的时间，做对的事。</strong></p>
<h2 data-id="heading-11">六、总结</h2>
<p>Vue生命周期钩子为开发者提供了在特定阶段介入实例生命周期的能力。通过合理使用这些钩子，我们可以：</p>
<ul>
<li>在正确时机执行初始化操作</li>
<li>有效管理资源，防止内存泄漏</li>
<li>优化应用性能</li>
<li>更好地理解和控制应用状态</li>
</ul>
<p>掌握生命周期不仅有助于编写更健壮的Vue应用，也是深入理解Vue响应式系统工作原理的关键。建议开发者在实际项目中多实践、多观察，逐步形成对生命周期各阶段的直观感受。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day30 | Java集合框架之Collections工具类]]></title>    <link>https://juejin.cn/post/7583943503556280370</link>    <guid>https://juejin.cn/post/7583943503556280370</guid>    <pubDate>2025-12-16T01:11:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556280370" data-draft-id="7583912637471309875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day30 | Java集合框架之Collections工具类"/> <meta itemprop="keywords" content="后端,Java,Java EE"/> <meta itemprop="datePublished" content="2025-12-16T01:11:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="懒惰蜗牛"/> <meta itemprop="url" content="https://juejin.cn/user/615342556327752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day30 | Java集合框架之Collections工具类
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615342556327752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    懒惰蜗牛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:11:57.000Z" title="Tue Dec 16 2025 01:11:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Day26~29的文章我们一起学习了Java集合框架的三大核心接口：List、Set和Map。</p>
<p>今天我们一起看一下java.util.Collections类，注意不是之前我们提到的Collection。</p>
<p>Collection接口定义了集合的是什么，多了个s的Collections是一套集合操作的工具箱。</p>
<p>Collections里提供了很多强大、方便的静态方法，能极大简化我们对集合的操作。</p>
<h2 data-id="heading-0">一、集合排序</h2>
<p>在实际开发中，对数据进行排序是最常见的需求之一。Collections.sort() 方法可以轻松地对任何List集合进行排序。</p>
<h3 data-id="heading-1">1.1自然排序</h3>
<p>如果List里的元素实现了Comparable接口（如Integer, String 等），sort方法会按照它们的自然顺序进行排序。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5bcd28af23a415dba43b89555c3509d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=KKQspnKSwENDYBmxrUsiciwvqDc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c0a581789f945159e134a5b6555f640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=R9xRQ7y90LjLq3ul1nOuWrHEIvc%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 15:13
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; numbers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        numbers.add(<span class="hljs-number">5</span>);
        numbers.add(<span class="hljs-number">1</span>);
        numbers.add(<span class="hljs-number">9</span>);
        numbers.add(<span class="hljs-number">3</span>);

        System.out.println(<span class="hljs-string">"排序前: "</span> + numbers);
        Collections.sort(numbers);
        System.out.println(<span class="hljs-string">"排序后: "</span> + numbers);
    }
}
</code></pre>
<p>案例中使用了Collections的sort方法，使用对象的自然排序对list进行排序。</p>
<h3 data-id="heading-2">1.2自定义排序</h3>
<p>如果我们要对自定义对象（如Student）进行排序，sort方法还有一个接受Comparator(比较器)的版本，让我们可以随心所欲地定义排序规则。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.Comparator;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo2
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 15:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        students.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"懒惰蜗牛"</span>, <span class="hljs-number">28</span>));
        students.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"lazysnail"</span>, <span class="hljs-number">29</span>));

        <span class="hljs-comment">// 匿名内部类写法</span>
        Collections.sort(students, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>&lt;Student&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Student o1, Student o2)</span> {
                <span class="hljs-keyword">return</span> o1.age - o2.age;
            }
        });

        <span class="hljs-comment">// Lambda表达式</span>
        Collections.sort(students, (o1, o2) -&gt; o1.age - o2.age);

        <span class="hljs-comment">// Comparator工具方法</span>
        Collections.sort(students, Comparator.comparingInt(o -&gt; o.age));
        
        System.out.println(<span class="hljs-string">"按年龄排序后: "</span> + students);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    String name;
    <span class="hljs-type">int</span> age;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> { <span class="hljs-built_in">this</span>.name = name; <span class="hljs-built_in">this</span>.age = age; }
    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> name + <span class="hljs-string">":"</span> + age; }
}
</code></pre>
<p>上面的案例中Comparator的创建使用了三种写法：</p>
<p>Java8之前传统写法，使用匿名内部类实现Comparator接口。</p>
<p>Java8+的Lambda表达式，这个其实是匿名内部类的语法糖。</p>
<p>Comparator接口是一个函数式接口（只有一个抽象方法），所以可以用Lambda替代。</p>
<p>Comparator.comparingInt()是Comparator提供的静态工厂方法，专门用来对int类型字段的比较。</p>
<p>内部封装了compare的逻辑。</p>
<p>其实自Java8之后，List接口自身提供了一个sort()方法。可以直接在列表对象上调用方法。</p>
<pre><code class="hljs language-ini" lang="ini">students.sort((o1, o2) -&gt; o1.age - o2.age)<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a95e0811d10741b695bfa6fa169dc691~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=lRn1q%2B3XPWrhas94uBHDGqP%2BfDA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>在<a href="https://juejin.cn/post/7582425536464863258" target="_blank" title="https://juejin.cn/post/7582425536464863258">Day28 | Java集合框架之Set接口详解</a>中的TreeSet讲解中讲到了自然排序和自定义排序，可以回顾下。</p>
</blockquote>
<h2 data-id="heading-3">二、查找</h2>
<p>对于一个已经排好序的List，binarySearch方法使用二分查找算法，效率要高于遍历。</p>
<blockquote>
<p>使用binarySearch之前，列表必须是有序的！否则，结果就不是你想要的。</p>
</blockquote>
<h3 data-id="heading-4">效率</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo3
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 15:52
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1_000_000</span>; i++) {
            list.add(i);
        }

        <span class="hljs-type">int</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-number">987654</span>;

        <span class="hljs-comment">// 遍历</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">start1</span> <span class="hljs-operator">=</span> System.nanoTime();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i++) {
            <span class="hljs-keyword">if</span> (list.get(i) == target) {
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">end1</span> <span class="hljs-operator">=</span> System.nanoTime();
        System.out.println(<span class="hljs-string">"遍历查找耗时: "</span> + (end1 - start1) / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">" ms"</span>);

        <span class="hljs-comment">// binarySearch</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">start2</span> <span class="hljs-operator">=</span> System.nanoTime();
        Collections.binarySearch(list, target);
        <span class="hljs-type">long</span> <span class="hljs-variable">end2</span> <span class="hljs-operator">=</span> System.nanoTime();
        System.out.println(<span class="hljs-string">"binarySearch查找耗时: "</span> + (end2 - start2) / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">" ms"</span>);
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4e549668a45483ab8366dccc91c1bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=5FVAEMFJ6HjSl4csM7TcgzHEuxg%3D" alt="" loading="lazy"/></p>
<p>从运行的结果看，二分查找的效率比普通遍历的效率高得多。</p>
<p>二分查找这种算法，每次都能排除掉一半的数据。相较于普通遍历的线性搜素。</p>
<p>在数据量很多的情况下，二分查找的时间复杂度要远远低于普通遍历。</p>
<h3 data-id="heading-5">未排序使用binarySearch</h3>
<p>如果对没有排序的列表进行二分查找，结果就是找不到数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo4
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:08
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo4</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">50</span>, <span class="hljs-number">20</span>, <span class="hljs-number">40</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>);

        System.out.println(<span class="hljs-string">"列表内容: "</span> + list);

        <span class="hljs-comment">// 想查找元素 30</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> Collections.binarySearch(list, <span class="hljs-number">30</span>);

        System.out.println(<span class="hljs-string">"binarySearch 查找结果索引: "</span> + index);

    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deadb0ff1de141d7affa04ab5ff397d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=oNQtl087t9qV2GcLSe8pvqH%2BSEo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">三、线程安全转换</h2>
<p>我们经常用的ArrayList、HashMap等都是非线程安全的。</p>
<p>在多线程环境中并发修改，可能会导致数据错乱。</p>
<p>Collections提供了一系列synchronizedXXX() 方法，可以把它们包装成线程安全的集合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3abc9a4b9db4efd8b3004e06ef7750a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=spG4chXEl49DrU9Ngua65y%2Fkq%2Fk%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo5
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:26
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo5</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        List&lt;String&gt; safeList = Collections.synchronizedList(list);

        safeList.add(<span class="hljs-string">"懒惰蜗牛"</span>);

        <span class="hljs-comment">//Set&lt;T&gt; safeSet = Collections.synchronizedSet(new HashSet&lt;&gt;());</span>
        <span class="hljs-comment">//Map&lt;K, V&gt; safeMap = Collections.synchronizedMap(new HashMap&lt;&gt;());</span>
    }
}
</code></pre>
<p>list是线程不安全的ArrayList，通过Collections中的synchronizedList方法。</p>
<p>将普通的ArrayList封装成了线程安全的List。之后对list的操作就是安全的。</p>
<p>set、map同样有对应的方法将不安全的集合封装成线程安全的集合。</p>
<blockquote>
<p>需要注意的是：这个操作只保证了单个方法（如add, get）是原子的。对于复合操作（比如“检查是否存在，如果不存在则添加”），仍然需要自己使用synchronized关键字来保证整个操作的原子性。</p>
</blockquote>
<h2 data-id="heading-7">四、创建不可变和空集合</h2>
<h3 data-id="heading-8">不可变</h3>
<p>有时候，我们想创建一个不可变的集合，这个集合不让修改。就可以用Collections中的unmodifiableXXX()方法创建只读的集合。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e76d38813494a7392f285ddff19fd96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=tm5qZWARW3Qmm9o355MMezdrU1s%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo6
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:56
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo6</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        list.add(<span class="hljs-string">"懒惰蜗牛"</span>);
        List&lt;String&gt; unmodifiableList = Collections.unmodifiableList(list);

        <span class="hljs-comment">//unmodifiableList.add("lazysnail");</span>
        unmodifiableList.remove(<span class="hljs-string">"懒惰蜗牛"</span>);
    }
}
</code></pre>
<p>如果想对这样的集合进行add或remove等操作，就会抛出UnsupportedOperationException异常。</p>
<p>从Java9开始，List, Set, Map接口自身提供了更方便的静态of()方法来直接创建真正的不可变集合。</p>
<p>这种方式在实际开发中更加常见。</p>
<p>为什么说是真正的不可变呐。回看上面的案例，稍作一下修改：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo6
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 16:56
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo6</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        list.add(<span class="hljs-string">"懒惰蜗牛"</span>);
        List&lt;String&gt; unmodifiableList = Collections.unmodifiableList(list);

        System.out.println(<span class="hljs-string">"原集合修改前的unmodifiableList:"</span> + unmodifiableList);

        list.add(<span class="hljs-string">"lazysnail"</span>);

        System.out.println(<span class="hljs-string">"原集合修改后的unmodifiableList:"</span> + unmodifiableList);
    }
}
</code></pre>
<p>可以看出，unmodifiableList并没有改变原集合的可变性，只是加了一层只读外壳。</p>
<p>如果原集合一旦被外部引用持有，仍然可以修改。</p>
<p>而List.of(...) 是真正的不可变对象，内部结构不允许任何修改操作。</p>
<p>所有变更操作（add、remove、set）都会直接抛UnsupportedOperationException。</p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; list1 = List.of(<span class="hljs-string">"懒惰蜗牛"</span>);
list1.add(<span class="hljs-string">"lazysnail"</span>);
</code></pre>
<p>"list1.add("lazysnail");"就会抛出UnsupportedOperationException。</p>
<h3 data-id="heading-9">空集合</h3>
<p>很多返回集合的方法，如果直接返回null，保不准什么时候就会报空指针异常。</p>
<p>实际开发的时候，最好还是返回一个空集合。</p>
<p>Collections的emptyList(), emptySet(), emptyMap()就派上了用场。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day30;

<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Day30Demo7
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/7/7 17:14
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Day30Demo7</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">findUsers</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-comment">// if 找到</span>

        <span class="hljs-comment">// else</span>
        <span class="hljs-keyword">return</span> Collections.emptyList();
    }
}
</code></pre>
<p>可能你会说，为什么不直接return的时候直接new ArrayList&lt;&gt;()。</p>
<p>每次return的时候，都去new一个对象，还是有开销的，能省则省。</p>
<p>Collections的emptyList()返回的是一个不可变的、线程安全的、可被序列化的空集合。</p>
<p>每次返回的都是同一个静态实例。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c72d9ae779684a6c9fc2e2c248eed418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452317&amp;x-signature=KJt8053qJlwu8QUJKfy2tRkQF2w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">五、其他</h2>
<p>Collections中还有很多其他的小工具：</p>
<p>reverse(List&lt;?&gt; list): 反转List中元素的顺序。</p>
<p>shuffle(List&lt;?&gt; list): 随机打乱List中元素的顺序。</p>
<p>max(Collection coll) / min(Collection coll): 找到集合中的最大/最小元素。</p>
<p>fill(List&lt;?&gt; list, T obj): 用指定元素替换List中的所有元素。</p>
<p>更多的方法参见API文档：</p>
<p>Collections (Java SE 17 &amp; JDK 17)docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collections.html</p>
<h2 data-id="heading-11">结语</h2>
<p>Collections中有非常多关于集合的操作工具。</p>
<p>今天我们只是一起看了一下排序、查找、线程安全、创建不可变集合等常见的功能。</p>
<p>这些工具都能够在实际开发中帮我们让代码更加简洁，让集合操作更加便捷高效。</p>
<p>Collections里的方法不需要取死记硬背，在写代码的时候，如果涉及操作集合，</p>
<p>可以翻看一下API文档，如果有合适的工具，使用即可。</p>
<p>下一篇预告</p>
<blockquote>
<p>Day31 | Lambda表达式与函数式接口</p>
</blockquote>
<p>如果你觉得这系列文章对你有帮助，欢迎关注专栏，我们一起坚持下去！</p>
<p><strong>更多文章请关注我的公众号《懒惰蜗牛工坊》</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webpack vs Vite 根本设计原理深度解析：为什么两者差异这么大？]]></title>    <link>https://juejin.cn/post/7583910418659541038</link>    <guid>https://juejin.cn/post/7583910418659541038</guid>    <pubDate>2025-12-16T00:40:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910418659541038" data-draft-id="7579215538271174666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Webpack vs Vite 根本设计原理深度解析：为什么两者差异这么大？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T00:40:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ycgg"/> <meta itemprop="url" content="https://juejin.cn/user/1926000101039192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Webpack vs Vite 根本设计原理深度解析：为什么两者差异这么大？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1926000101039192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ycgg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:40:29.000Z" title="Tue Dec 16 2025 00:40:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Webpack vs Vite 根本设计原理深度解析：为什么两者差异这么大？</h2>
<p>之前的对比更多聚焦于“表面差异”，但两者的核心区别源于 <strong>底层设计哲学和技术选型的根本不同</strong>——简单说：</p>
<ul>
<li>Webpack 的设计核心是「<strong>全场景兼容的提前打包哲学</strong>」：无论环境、无论模块类型，都通过“提前解析所有依赖、打包为 bundle”实现统一处理；</li>
<li>Vite 的设计核心是「<strong>现代浏览器优先的即时构建哲学</strong>」：利用现代浏览器原生能力（ES 模块），拆分“开发时”和“生产时”流程，按需处理模块，放弃对老场景的过度兼容。</li>
</ul>
<p>本文将从「设计初衷、核心原理、底层实现」三个维度，扒透两者的根本差异，让你明白“为什么 Vite 更快”“为什么 Webpack 更全能”不是偶然，而是设计之初就定好的方向。</p>
<h3 data-id="heading-1">一、先统一认知：什么是“构建工具的根本原理”？</h3>
<p>构建工具的核心使命是：<strong>将分散的源码模块（JS/TS/CSS/图片等），通过“依赖解析、转译、优化、合并”，最终生成浏览器/Node.js 可执行的产物</strong>。</p>
<p>而“根本设计原理”，就是解决以下 3 个核心问题的“决策逻辑”：</p>
<ol>
<li><strong>何时处理模块？</strong>（提前一次性处理 vs 按需实时处理）</li>
<li><strong>如何解析依赖？</strong>（递归构建依赖图 vs 依赖浏览器原生解析）</li>
<li><strong>如何扩展功能？</strong>（分层架构 vs 单一插件体系）</li>
</ol>
<p>Webpack 和 Vite 的所有差异，都源于对这 3 个问题的不同回答。</p>
<h3 data-id="heading-2">二、Webpack 根本设计原理：全场景兼容的“提前打包”哲学</h3>
<h4 data-id="heading-3">1. 设计初衷：解决“前端模块混乱”的历史痛点</h4>
<p>Webpack 诞生于 2012 年，当时前端还没有统一的模块标准（CommonJS/AMD/UMD 并存），依赖管理混乱，没有工具能将各种类型的文件（JS、CSS、图片）统一处理为浏览器可识别的资源。</p>
<p>Webpack 的核心设计目标是：<strong>提供一个“万能打包器”，兼容所有模块类型、所有模块标准、所有运行环境，让开发者无需关心底层兼容，专注业务代码</strong>。</p>
<h4 data-id="heading-4">2. 核心原理：“依赖图 + 全量打包 + 分层扩展”</h4>
<p>Webpack 的根本逻辑是「<strong>提前把所有事做完</strong>」，无论开发还是生产，都遵循“全量处理”流程，核心分为 3 层：</p>
<h5 data-id="heading-5">（1）第一层：“一切皆模块” + 递归构建依赖图</h5>
<p>Webpack 认为“所有文件都是模块”（JS、CSS、图片、字体等），核心步骤：</p>
<ol>
<li>从入口文件（如 <code>src/index.js</code>）开始，通过 <strong>AST 语法解析</strong>（抽象语法树），找出所有 <code>import</code>/<code>require</code> 依赖；</li>
<li>递归解析每个依赖的依赖，直到所有模块都被找到，最终构建出一个「完整的依赖关系图」（Dependency Graph）；</li>
<li>所有模块都被纳入这个图中，后续的转译、优化、合并都基于这个图进行。</li>
</ol>
<p><strong>底层技术支撑</strong>：使用 <code>acorn</code> 库解析 JS 生成 AST，遍历 AST 找到依赖声明，实现递归解析。</p>
<h5 data-id="heading-6">（2）第二层：“全量打包”流程（开发/生产一致）</h5>
<p>无论开发还是生产，Webpack 都会完整执行以下流程，没有“按需处理”：</p>
<pre><code class="hljs">初始化（读取配置）→ 编译（构建依赖图+Loader 转译）→ 优化（Chunk 合并+Tree-shaking）→ 输出（写入磁盘）
</code></pre>
<ul>
<li><strong>开发时没有“特殊待遇”</strong>：即使是开发环境，也需要先构建完依赖图、转译所有模块，才能启动开发服务器（这就是 Webpack 冷启动慢的根本原因）；</li>
<li><strong>热更新（HMR）的本质</strong>：修改文件后，Webpack 会重新解析该模块及其依赖链，更新依赖图，重新转译并替换对应的 Chunk，而非仅处理修改的文件。</li>
</ul>
<h5 data-id="heading-7">（3）第三层：“Loader + Plugin”分层扩展架构</h5>
<p>为了实现“全场景兼容”，Webpack 设计了分层扩展机制，避免核心逻辑臃肿：</p>
<ul>
<li><strong>Loader 层</strong>：负责“模块转译”（解决“不同类型模块如何转为 JS 模块”）；
<ul>
<li>核心逻辑：非 JS 模块无法直接进入依赖图，必须通过 Loader 转译为 JS 模块（如 CSS→JS 字符串、图片→Base64/路径）；</li>
<li>设计思路：单一职责，每个 Loader 只做一件事（如 <code>css-loader</code> 解析 CSS 依赖，<code>style-loader</code> 注入样式），通过链式调用组合功能。</li>
</ul>
</li>
<li><strong>Plugin 层</strong>：负责“流程扩展”（解决“打包流程中需要额外做什么”）；
<ul>
<li>核心逻辑：基于 <strong>Tapable 钩子系统</strong>（Webpack 核心事件总线），在打包的每个阶段（如“编译开始”“产物输出前”）触发自定义逻辑；</li>
<li>设计思路：无侵入式扩展，核心代码只负责流程控制，插件负责添加功能（如生成 HTML、压缩代码、清理产物）。</li>
</ul>
</li>
</ul>
<p><strong>底层技术支撑</strong>：Tapable 库（Webpack 团队开发），提供同步/异步钩子，让 Plugin 能介入打包全流程。</p>
<h5 data-id="heading-8">核心代码片段（体现 Webpack 原理）</h5>
<p>Webpack 核心实例 <code>Compiler</code> 的初始化逻辑（简化版）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Webpack 核心：Compiler 实例（全局唯一）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Compiler</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options; <span class="hljs-comment">// 读取配置</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tapable</span>(); <span class="hljs-comment">// 初始化钩子系统</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modules</span> = []; <span class="hljs-comment">// 存储所有模块</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chunks</span> = []; <span class="hljs-comment">// 存储所有 Chunk</span>
  }

  <span class="hljs-comment">// 启动打包流程</span>
  <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. 触发 "compile" 钩子（Plugin 可监听）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-property">compile</span>.<span class="hljs-title function_">call</span>();

    <span class="hljs-comment">// 2. 从入口文件开始，构建依赖图</span>
    <span class="hljs-keyword">const</span> entryModule = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildModule</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">entry</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modules</span>.<span class="hljs-title function_">push</span>(entryModule);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildDependencyGraph</span>(entryModule);

    <span class="hljs-comment">// 3. 触发 "make" 钩子（Plugin 可干预模块）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-property">make</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">compilation</span>);

    <span class="hljs-comment">// 4. 合并模块为 Chunk</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createChunks</span>();

    <span class="hljs-comment">// 5. 触发 "emit" 钩子（Plugin 可修改产物）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">compilation</span>);

    <span class="hljs-comment">// 6. 输出产物到磁盘</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">outputFiles</span>();

    <span class="hljs-comment">// 7. 触发 "done" 钩子（Plugin 可做后续处理）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">call</span>();
  }

  <span class="hljs-comment">// 构建单个模块（调用 Loader 转译）</span>
  <span class="hljs-title function_">buildModule</span>(<span class="hljs-params">modulePath</span>) {
    <span class="hljs-comment">// 读取文件内容</span>
    <span class="hljs-keyword">const</span> source = fs.<span class="hljs-title function_">readFileSync</span>(modulePath, <span class="hljs-string">'utf-8'</span>);
    <span class="hljs-comment">// 匹配对应的 Loader 链</span>
    <span class="hljs-keyword">const</span> loaders = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLoadersForFile</span>(modulePath);
    <span class="hljs-comment">// 链式执行 Loader 转译</span>
    <span class="hljs-keyword">const</span> transformedSource = loaders.<span class="hljs-title function_">reduceRight</span>(<span class="hljs-function">(<span class="hljs-params">code, loader</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> loader.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, code);
    }, source);
    <span class="hljs-comment">// 解析转译后的代码，找出依赖</span>
    <span class="hljs-keyword">const</span> dependencies = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">parseDependencies</span>(transformedSource);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">id</span>: modulePath, <span class="hljs-attr">source</span>: transformedSource, dependencies };
  }
}
</code></pre>
<h4 data-id="heading-9">3. 原理带来的优缺点</h4>
<ul>
<li><strong>优点</strong>：兼容所有场景（老浏览器、各种模块标准、特殊资源）、扩展能力极强（Loader/Plugin 生态庞大）；</li>
<li><strong>缺点</strong>：全量打包导致开发时冷启动慢、热更新延迟；配置复杂（需区分 Loader/Plugin）。</li>
</ul>
<h3 data-id="heading-10">三、Vite 根本设计原理：现代浏览器优先的“即时构建”哲学</h3>
<h4 data-id="heading-11">1. 设计初衷：解决 Webpack 的“开发体验痛点”</h4>
<p>Vite 诞生于 2021 年，此时现代浏览器已普遍支持 ES 模块（ESM，<code>import</code>/<code>export</code> 原生可用），而 Webpack 的“全量打包”在大型项目中暴露的“冷启动慢、热更新卡”问题愈发严重。</p>
<p>Vite 的核心设计目标是：<strong>利用现代浏览器原生能力，抛弃“提前打包”的冗余步骤，优化开发体验；生产时复用成熟的 Rollup 打包能力，平衡产物质量</strong>。</p>
<p>简单说：Vite 认为“开发时不需要打包”，只需要“按需转译模块”；“生产时需要打包”，但交给更高效的 Rollup 来做。</p>
<h4 data-id="heading-12">2. 核心原理：“ESM 原生支持 + 双场景分离 + 高效转译”</h4>
<p>Vite 的根本逻辑是「<strong>开发时按需处理，生产时优化打包</strong>」，核心分为 3 层：</p>
<h5 data-id="heading-13">（1）第一层：开发时：依赖浏览器 ESM 原生解析，不打包</h5>
<p>Vite 开发时完全抛弃“构建依赖图”和“全量打包”，核心依赖「浏览器原生支持 ESM」：</p>
<ol>
<li>启动一个 <strong>ESM 开发服务器</strong>（基于 <code>connect</code> 库），不处理任何模块，仅监听文件变化；</li>
<li>浏览器请求入口 <code>index.html</code> 时，Vite 动态改写 HTML 中的模块引用（如把 <code>import './main.ts'</code> 改为 <code>import '/src/main.ts'</code>，指向服务器路径）；</li>
<li>浏览器收到 HTML 后，按 ESM 规范原生加载 <code>main.ts</code>，并解析其中的 <code>import</code> 依赖，再次向服务器请求这些依赖模块；</li>
<li>服务器收到模块请求后，<strong>即时转译</strong>该模块（如 TS→JS、Vue→JS），返回转译后的 ESM 代码；</li>
<li>重复步骤 3-4，直到所有依赖模块都被浏览器加载完成。</li>
</ol>
<p><strong>核心亮点</strong>：模块处理是“请求驱动”的——只有浏览器请求的模块才会被转译，未被引用的模块（如路由懒加载的组件）不会被处理，这是 Vite 冷启动快的根本原因。</p>
<h5 data-id="heading-14">（2）第二层：生产时：复用 Rollup 打包，平衡产物质量</h5>
<p>开发时的“按需处理”不适合生产环境（浏览器请求次数过多、无优化），因此 Vite 生产时切换为「Rollup 打包」：</p>
<ol>
<li>按 Rollup 的逻辑，递归构建依赖图（全量处理所有模块）；</li>
<li>复用开发时的插件逻辑（如 <code>transform</code> 转译模块）；</li>
<li>利用 Rollup 更高效的 Tree-shaking、Chunk 拆分、产物压缩能力，生成优化后的静态资源。</li>
</ol>
<p><strong>设计思路</strong>：开发时优先“速度”，生产时优先“产物质量”，两者分离但共享插件生态，避免重复开发。</p>
<h5 data-id="heading-15">（3）第三层：“单一插件体系 + ESBuild 转译”</h5>
<p>Vite 抛弃了 Webpack 的“Loader + Plugin”分层，用「单一插件体系」覆盖所有扩展需求，同时用 ESBuild 替代 Babel/TSC 提升转译速度：</p>
<ul>
<li><strong>插件体系</strong>：插件通过「钩子函数」介入流程，既可以处理模块转译（对应 Webpack Loader），也可以扩展流程（对应 Webpack Plugin）；
<ul>
<li>核心钩子：<code>resolveId</code>（解析模块路径）、<code>transform</code>（转译模块内容）、<code>configureServer</code>（配置开发服务器）、<code>writeBundle</code>（生产时处理产物）；</li>
</ul>
</li>
<li><strong>ESBuild 转译</strong>：ESBuild 是用 Go 语言编写的转译工具，比 JS 编写的 Babel/TSC 快 10-100 倍，负责开发时的 TS/JSX/CSS 转译（生产时可切换为 Babel 兼容更多场景）。</li>
</ul>
<p><strong>底层技术支撑</strong>：</p>
<ul>
<li>开发服务器：基于 <code>connect</code> 库，拦截浏览器请求，即时处理模块；</li>
<li>转译核心：ESBuild（负责快速转译）；</li>
<li>打包核心：Rollup（负责生产时优化）。</li>
</ul>
<h5 data-id="heading-16">核心代码片段（体现 Vite 原理）</h5>
<p>Vite 开发服务器的核心逻辑（简化版）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createServer } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> esbuild <span class="hljs-keyword">from</span> <span class="hljs-string">'esbuild'</span>;

<span class="hljs-comment">// 1. 创建 ESM 开发服务器</span>
<span class="hljs-keyword">const</span> server = <span class="hljs-title function_">createServer</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-comment">/* 插件列表 */</span>]
});

<span class="hljs-comment">// 2. 监听模块请求（如 /src/main.ts）</span>
server.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (req, res, next) =&gt; {
  <span class="hljs-keyword">const</span> modulePath = <span class="hljs-title function_">resolve</span>(req.<span class="hljs-property">url</span>); <span class="hljs-comment">// 解析模块路径</span>

  <span class="hljs-comment">// 3. 插件的 resolveId 钩子：重写模块路径（如别名、第三方模块）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> plugin <span class="hljs-keyword">of</span> server.<span class="hljs-property">config</span>.<span class="hljs-property">plugins</span>) {
    <span class="hljs-keyword">if</span> (plugin.<span class="hljs-property">resolveId</span>) {
      <span class="hljs-keyword">const</span> resolvedId = <span class="hljs-keyword">await</span> plugin.<span class="hljs-title function_">resolveId</span>(modulePath);
      <span class="hljs-keyword">if</span> (resolvedId) modulePath = resolvedId;
    }
  }

  <span class="hljs-comment">// 4. 读取模块文件内容</span>
  <span class="hljs-keyword">let</span> code = fs.<span class="hljs-title function_">readFileSync</span>(modulePath, <span class="hljs-string">'utf-8'</span>);

  <span class="hljs-comment">// 5. 插件的 transform 钩子：转译模块（如 TS→JS、Vue→JS）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> plugin <span class="hljs-keyword">of</span> server.<span class="hljs-property">config</span>.<span class="hljs-property">plugins</span>) {
    <span class="hljs-keyword">if</span> (plugin.<span class="hljs-property">transform</span>) {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> plugin.<span class="hljs-title function_">transform</span>(code, modulePath);
      <span class="hljs-keyword">if</span> (result) code = result.<span class="hljs-property">code</span>;
    }
  }

  <span class="hljs-comment">// 6. 用 ESBuild 快速转译（如 TS→JS）</span>
  <span class="hljs-keyword">if</span> (modulePath.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.ts'</span>) || modulePath.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.tsx'</span>)) {
    <span class="hljs-keyword">const</span> esbuildResult = <span class="hljs-keyword">await</span> esbuild.<span class="hljs-title function_">transform</span>(code, {
      <span class="hljs-attr">loader</span>: <span class="hljs-string">'tsx'</span>,
      <span class="hljs-attr">target</span>: <span class="hljs-string">'esnext'</span>
    });
    code = esbuildResult.<span class="hljs-property">code</span>;
  }

  <span class="hljs-comment">// 7. 设置响应头（告诉浏览器这是 ESM 模块）</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/javascript'</span>);
  res.<span class="hljs-title function_">end</span>(code); <span class="hljs-comment">// 返回转译后的 ESM 代码</span>
});

<span class="hljs-comment">// 8. 启动服务器</span>
server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<h4 data-id="heading-17">3. 原理带来的优缺点</h4>
<ul>
<li><strong>优点</strong>：开发时冷启动快、热更新即时（请求驱动+ESBuild）；配置简洁（单一插件体系）；生产产物质量高（Rollup 优化）；</li>
<li><strong>缺点</strong>：开发时依赖现代浏览器 ESM 支持（不兼容 IE11）；对 CommonJS 模块的处理需要额外转译（性能损耗）；复杂场景（如多入口、特殊资源处理）生态不如 Webpack 成熟。</li>
</ul>
<h3 data-id="heading-18">四、Webpack vs Vite 根本原理对比表（核心总结）</h3>


















































<table><thead><tr><th>对比维度</th><th>Webpack</th><th>Vite</th></tr></thead><tbody><tr><td>核心设计哲学</td><td>全场景兼容，提前打包所有模块</td><td>现代浏览器优先，开发时按需处理，生产时优化打包</td></tr><tr><td>模块解析方式</td><td>递归构建依赖图（AST 解析）</td><td>开发时浏览器原生 ESM 解析，生产时 Rollup 依赖图</td></tr><tr><td>模块处理时机</td><td>开发/生产均提前全量处理</td><td>开发时请求驱动（按需处理），生产时全量处理</td></tr><tr><td>转译核心工具</td><td>Babel/TSC（JS 编写，速度慢）</td><td>ESBuild（Go 编写，速度快）+ 可选 Babel</td></tr><tr><td>扩展架构</td><td>分层架构（Loader 转译 + Plugin 流程扩展）</td><td>单一插件体系（钩子覆盖转译+流程扩展）</td></tr><tr><td>底层技术支撑</td><td>Tapable 钩子 + acorn AST 解析</td><td>ESM 服务器（connect）+ ESBuild + Rollup</td></tr><tr><td>设计目标</td><td>解决“模块混乱”，追求全能兼容</td><td>解决“开发体验差”，追求速度和简洁</td></tr><tr><td>原理层面的核心缺点</td><td>全量打包导致开发时速度慢</td><td>依赖现代浏览器，兼容场景有限</td></tr></tbody></table>
<h3 data-id="heading-19">五、最终结论：原理决定一切差异</h3>
<p>Webpack 和 Vite 的所有表面差异（速度、配置复杂度、生态），都源于「根本设计原理」的不同：</p>
<ul>
<li>Webpack 为了“全能兼容”，选择了“提前打包+分层扩展”，牺牲了开发速度和配置简洁性；</li>
<li>Vite 为了“现代浏览器下的开发体验”，选择了“ESM 原生支持+按需处理+双场景分离”，牺牲了部分兼容性和复杂场景的生态成熟度。</li>
</ul>
<p>选型的本质，就是在“兼容需求”和“开发体验”之间做权衡：</p>
<ul>
<li>若需要兼容老浏览器、处理复杂场景（多入口、特殊资源），选 Webpack（原理决定了它的全能性）；</li>
<li>若目标是现代浏览器、追求开发效率，选 Vite（原理决定了它的速度和简洁性）。</li>
</ul>
<p>理解了这一点，你就不会再纠结“为什么 Vite 不能替代 Webpack”或“为什么 Webpack 不借鉴 Vite 的速度”——它们的设计原理从一开始就决定了各自的定位和边界。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何实现倒计时工具]]></title>    <link>https://juejin.cn/post/7583948178858131502</link>    <guid>https://juejin.cn/post/7583948178858131502</guid>    <pubDate>2025-12-16T01:25:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178858131502" data-draft-id="7583948178858115118" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何实现倒计时工具"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T01:25:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MQliferecord"/> <meta itemprop="url" content="https://juejin.cn/user/1139543665814600"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何实现倒计时工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1139543665814600/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MQliferecord
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:25:03.000Z" title="Tue Dec 16 2025 01:25:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最开始查到这个是因为在做版本更新弹窗的定时器轮询，然后查看到一篇文章关于前端倒计时存在误差，从而衍生出高并发秒杀场景下，应该如何实现倒计时工具：</p>
<p>最开始想到的办法是setTimeout。</p>
<p>但因为setTimeout本身因为JavaScript是单线程，<code>setTimeout</code> 的回调函数会被放入事件队列，浏览器资源分配中前面任务阻塞延迟的问题会存在一定性的误差，但是误差较小，大部分场景都可以忽略。</p>
<p>但是如果切换Tab页或者最小化之后再切换到前台，因为浏览器会识别当前页面需要资源减少，降低定时器的执行频率，直到切回来后才会恢复原本的轮询间隔，所以这样切回来的那一次计算时间会有误差。</p>
<p>对此因为项目会在第一次挂载的时候立刻弹窗以及切换到后台再切回前台的时候再次立刻弹窗，所以只需要在切换回来的时候立刻执行一次versionListener，<strong>并删除定时器，重新创建一个新的定时器就能恢复原本的时限误差</strong></p>
<p>如果没有以上的策略，坚持原本的定时器，并且不希望出现误差的话，可以使用web worker单独处理定时器。</p>
<p>Web Worker 是独立于主线程的后台线程，<strong>不受前台 / 后台标签的节流规则限制</strong>，其事件循环和定时器执行逻辑完全独立，因此切后台后仍能保持接近预期的执行频率</p>
<p><a href="https://juejin.cn/post/7478687361737768986" target="_blank" title="https://juejin.cn/post/7478687361737768986">面试官：前端倒计时有误差怎么解决前言 去年遇到的一个问题，也是非常经典的面试题了。能聊的东西还蛮多的 倒计时为啥不准 一 - 掘金 (juejin.cn)</a></p>
<p>看了一下这个里面的一个评论：</p>
<blockquote>
<p>setTimeout 的延时不应当被依赖用来进行倒计时，因为它有非常多的不稳定因素（参见MDN）。<br/>
最佳实践是将倒计时结束的时间戳计算出来，再用 setTimeout 或者 requestAnimationFrame 进行更新（计算结束和当前时间戳的时间差，舍入到秒数然后更新到页面上），这种方式误差最小且最节能。至于需要和服务器实时同步的场景则考虑sse授时。</p>
</blockquote>
<p>具体为：</p>
<ol>
<li><strong>定时器的本质</strong>：<code>setTimeout</code> 的 <code>delay</code> 是「事件循环中任务的最小等待时间」，如果队列中有其他任务，实际执行时间会更长；</li>
<li><strong>requestAnimationFrame 优势</strong>：浏览器会在重绘前执行回调，前台 60fps（约 16ms / 次），后台自动暂停，比 <code>setInterval</code> 节能 90%+；</li>
<li><strong>时间戳选择</strong>：<code>performance.now()</code> 是高精度时间戳（微秒级），且不受系统时间修改影响，优先于 <code>Date.now()</code>。</li>
</ol>
<p>由此衍生两种核心方法:</p>
<ol>
<li>计算出倒计时结束时间，轮询是否到达结尾时间，进行报时，<strong>performanceAPI在Node环境下无法使用,只支持浏览器环境</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">preciseCountdown</span>(<span class="hljs-params">endTime:number, onUpdate:(seconds:number)=&gt;<span class="hljs-keyword">void</span>, onComplete:()=&gt;<span class="hljs-keyword">void</span></span>) {
  <span class="hljs-comment">// 高精度时间戳（优先用 performance.now，无兼容问题时用 Date.now）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getNow</span> = (<span class="hljs-params"/>) =&gt; performance.<span class="hljs-title function_">now</span>() + performance.<span class="hljs-property">timeOrigin</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">update</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title function_">getNow</span>();
    <span class="hljs-keyword">const</span> remaining = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(endTime - now, <span class="hljs-number">0</span>); <span class="hljs-comment">// 剩余时间（ms）</span>
    <span class="hljs-keyword">const</span> remainingSeconds = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(remaining / <span class="hljs-number">1000</span>); <span class="hljs-comment">// 舍入到秒</span>

    <span class="hljs-comment">// 更新页面（只传最终要显示的秒数，避免浮点误差），在高频报数场景下每秒报数发生变化由此实现倒计时</span>
    <span class="hljs-comment">//实际上是10-&gt;10-&gt;...(省略n个10)-&gt;10 -&gt;9-&gt;9-&gt;...-&gt;9-&gt;8....</span>
    <span class="hljs-title function_">onUpdate</span>(remainingSeconds);

    <span class="hljs-keyword">if</span> (remaining &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-title function_">onComplete</span>();
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 优先用 requestAnimationFrame（更节能，适配屏幕刷新率）</span>
    <span class="hljs-comment">// 降级用 setTimeout（兼容老环境，延时设为 16ms 接近 60fps）</span>
    <span class="hljs-keyword">if</span> (requestAnimationFrame) {
      <span class="hljs-comment">//进行高频报数展示</span>
      <span class="hljs-title function_">requestAnimationFrame</span>(update);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">setTimeout</span>(update, <span class="hljs-number">16</span>);
    }
  };

  <span class="hljs-comment">// 立即执行一次更新，避免首屏延迟</span>
  <span class="hljs-title function_">update</span>();
}

<span class="hljs-comment">// 用法示例：倒计时 10 秒</span>
<span class="hljs-keyword">const</span> endTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">10</span> * <span class="hljs-number">1000</span>;
<span class="hljs-title function_">preciseCountdown</span>(
  endTime,
  <span class="hljs-function">(<span class="hljs-params">seconds</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'剩余秒数：'</span>, seconds);
    <span class="hljs-comment">// 更新 DOM：document.getElementById('countdown').textContent = seconds;</span>
  },
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'倒计时结束'</span>);
  }
);
</code></pre>
<ol start="2">
<li>使用后端sse进行处理，相比于普通的接口请求，sse具备高度的实时性</li>
</ol>








































<table><thead><tr><th>对比维度</th><th>普通后端接口（HTTP/REST）</th><th>SSE（Server-Sent Events）</th></tr></thead><tbody><tr><td><strong>通信方向</strong></td><td>双向（客户端请求 → 服务端响应），但「请求 - 响应」是<strong>单次单向</strong></td><td>单向（服务端 → 客户端），服务端主动推送</td></tr><tr><td><strong>连接模式</strong></td><td>短连接：请求发起 → 响应返回 → TCP 连接关闭</td><td>长连接：一次 TCP 握手后，连接持续保持，服务端按需推数据</td></tr><tr><td><strong>触发方式</strong></td><td>客户端主动触发（点击、定时轮询、页面加载）</td><td>服务端主动触发（数据更新 / 事件发生时推送）</td></tr><tr><td><strong>数据传输形式</strong></td><td>单次完整数据（JSON/Form/ 二进制），响应结束即终止</td><td>流式文本数据（UTF-8），分块传输（一行 / 多行数据）</td></tr><tr><td><strong>实时性</strong></td><td>低（轮询依赖间隔，有延迟）</td><td>高（数据更新立即推送，无轮询延迟）</td></tr><tr><td><strong>网络开销</strong></td><td>高（轮询场景下多次 TCP 握手、重复请求头）</td><td>低（一次连接持续传输，仅首次握手开销）</td></tr></tbody></table>
<pre><code class="hljs language-ini" lang="ini">// SSE：客户端建立连接，监听服务端推送
const <span class="hljs-attr">sse</span> = new EventSource(<span class="hljs-string">'/api/sse/countdown'</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">sse.onmessage</span> = (e) =&gt; {
  const <span class="hljs-attr">data</span> = JSON.parse(e.data)<span class="hljs-comment">;</span>
  console.log('服务端推送的实时数据：', data)<span class="hljs-comment">; // 服务端有更新就会触发</span>
}<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>普通接口</strong>：默认是「短连接」——TCP 三次握手后传输数据，响应完成后四次挥手关闭连接；若要实时性，需用「定时轮询」（如每 1 秒请求一次），但会产生大量重复的 TCP 握手 / 挥手开销，且有轮询间隔的延迟。</li>
<li><strong>SSE</strong>：是「HTTP 长连接」—— 一次 TCP 握手后，连接保持打开状态，服务端通过「分块传输编码（Chunked Transfer Encoding）」向客户端流式推送数据，直到连接被主动关闭（客户端 <code>close()</code> 或服务端断开）。优势：无轮询的重复开销，实时性接近 “即时”</li>
<li><strong>WebSocket</strong> 是双向通信（客户端↔服务端）、基于独立的 WebSocket 协议、功能更强但复杂度更高；常用于双向实时交互（如聊天、在线游戏）场景。</li>
</ul>
<p><strong>目前的电商秒杀倒计时用的主流方案应该是performance计算最终时间-起始时间</strong>，而不是sse，因为sse在电商这类高并发场景下需要大量的后端开销去建立链接窗口。</p>
<p>在进行秒杀时间校准的场景下，如何防止用户手动修改本地时间，主要依赖三个参数：</p>
<ol>
<li>后端在秒杀开始前会传给前端接口秒杀开始的准确时间戳，比如xxxxxxxxxx</li>
<li>前端通过performance.timeOrigin获取绝对起始时间，这个时间一旦定下为YYYYYYY，无论中途用户修改多少次本地时间都不会发生变化</li>
<li>前端在建立performance.timeOrigin的时候会绑定建立performance.now()，为绝对流逝时间，也就是相对performance.timeOrigin绝对起始时间变化的时间，不受本地时间影响</li>
</ol>
<p>最终xxxxxxxxxx-(performance.timeOrigin+performance.now())就是需要倒计时的时间</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NuxtHub部署nuxt项目就是方便]]></title>    <link>https://juejin.cn/post/7583952017674076211</link>    <guid>https://juejin.cn/post/7583952017674076211</guid>    <pubDate>2025-12-16T01:34:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674076211" data-draft-id="7583912637471440947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NuxtHub部署nuxt项目就是方便"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T01:34:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Pub的知识花园"/> <meta itemprop="url" content="https://juejin.cn/user/1591748567524232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NuxtHub部署nuxt项目就是方便
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748567524232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Pub的知识花园
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:34:33.000Z" title="Tue Dec 16 2025 01:34:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好~我是Pub</p>
<p>最近一直在开发面向海外的应用，基本都是用Nuxt进行全栈开发的。从开发到部署都用了 Nuxthub，我自己用起来觉得非常方便。（我发现掘金好像还没有nuxthub的文章 ）</p>
<p>前几天Nuxthub也更新到了0.10版本。</p>
<p>如果你是 Nuxt 开发者，在开发面向海外的应用，想开发全栈应用（带数据库、文件上传等），但又不想折腾复杂的后端部署、Docker 或云服务配置，<strong>NuxtHub</strong> 就是为你准备的。</p>
<h2 data-id="heading-0">1. NuxtHub 是什么？</h2>
<p><strong>NuxtHub</strong> 是一个 <strong>Nuxt 模块</strong>（<code>@nuxthub/core</code>），也是一个部署和管理平台。</p>
<p>它的核心理念是 <strong>"Zero Configuration"（零配置）</strong>。它将<strong>数据库 (SQL)</strong>、<strong>文件存储 (Blob)</strong>、<strong>键值存储 (KV)</strong> 和 <strong>服务端缓存</strong> 等后端能力，直接集成到了 Nuxt 的运行时中。</p>
<p>简单来说，它让你在写 Nuxt 代码时，可以直接 <code>import</code> 一个数据库对象并开始查询，而无需关心底层的连接、认证或服务器维护。它底层主要利用了 <strong>Cloudflare</strong> 的边缘计算能力（Workers, D1, R2, KV），让你的应用不仅全栈，而且运行在全球边缘节点上。</p>
<h2 data-id="heading-1">2. 有什么方便的？</h2>
<p>NuxtHub 最大的卖点就是 <strong>开发者体验 (DX)</strong> 的极致简化：</p>
<ul>
<li><strong>开箱即用</strong>：不需要安装 MySQL/PostgreSQL 软件，不需要配置 S3 存储桶。在本地开发时，NuxtHub 会自动在本地模拟这些服务（使用 SQLite 等技术），数据保存在项目根目录的 <code>.data</code> 文件夹中。</li>
<li><strong>像写前端一样写后端</strong>：你不需要学习复杂的后端框架。通过简单的导入语法即可操作数据库。</li>
<li><strong>零配置部署</strong>：使用 <code>npx nuxthub deploy</code> 命令，系统会自动识别你的配置，在 Cloudflare 上为你创建对应的数据库、存储桶和 KV 空间，并发布应用。</li>
<li><strong>可视化管理</strong>：直接在 <strong>Nuxt DevTools</strong>（开发工具栏）里就能看到数据库里的表、查看上传的文件、管理缓存，非常直观。</li>
</ul>
<h2 data-id="heading-2">3. 有什么好处？</h2>
<ol>
<li><strong>全栈一体化</strong>：
前端和后端逻辑在同一个项目中，共享类型（TypeScript），维护成本极低。</li>
<li><strong>高性能 (Edge Computing)</strong>：
你的应用不是运行在某个单一地区的服务器上，而是运行在 Cloudflare 的全球边缘网络上，用户访问速度极快。</li>
<li><strong>功能丰富</strong>：
<ul>
<li><strong>NuxtHub Database (SQL)</strong>: 基于 SQLite (Cloudflare D1)，支持 Drizzle ORM，自动处理数据库迁移。</li>
<li><strong>NuxtHub Blob</strong>: 轻松上传和存储图片、视频 (Cloudflare R2)。</li>
<li><strong>NuxtHub KV</strong>: 高速键值对存储，适合存配置、Session 等。</li>
<li><strong>NuxtHub Cache</strong>: 强大的服务端/API 缓存能力。</li>
</ul>
</li>
<li><strong>无厂商锁定风险</strong>：
虽然它目前深度集成 Cloudflare，但它是作为一个开源模块设计的，未来有潜力适配更多平台。而且本地开发完全离线可用。</li>
</ol>
<h2 data-id="heading-3">4. 怎么用？</h2>
<h3 data-id="heading-4">第一步：创建项目（最快上手）</h3>
<p>直接使用官方模板初始化：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化一个 NuxtHub 项目</span>
npx nuxi init -t hub my-hub-app
<span class="hljs-built_in">cd</span> my-hub-app
npm install
npm run dev
</code></pre>
<h3 data-id="heading-5">第二步：在现有项目中使用</h3>
<p>安装核心模块：</p>
<pre><code class="hljs language-bash" lang="bash">npx nuxi module add @nuxthub/core
</code></pre>
<p>修改 <code>nuxt.config.ts</code> 开启你需要的功能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineNuxtConfig</span>({
  <span class="hljs-attr">modules</span>: [<span class="hljs-string">'@nuxthub/core'</span>],
  <span class="hljs-attr">hub</span>: {
    <span class="hljs-attr">db</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 开启 SQL 数据库</span>
    <span class="hljs-attr">blob</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 开启文件存储</span>
    <span class="hljs-attr">kv</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 开启键值对存储</span>
    <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启缓存</span>
  }
})
</code></pre>
<h3 data-id="heading-6">第三步：写代码（示例）</h3>
<p><strong>1. 数据库操作 (server/api/todos.ts)</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { db } <span class="hljs-keyword">from</span> <span class="hljs-string">'hub:db'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">eventHandler</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// 直接查询数据库，拥有完整的类型提示</span>
  <span class="hljs-keyword">const</span> todos = <span class="hljs-keyword">await</span> db.<span class="hljs-property">query</span>.<span class="hljs-property">todos</span>.<span class="hljs-title function_">findMany</span>()
  <span class="hljs-keyword">return</span> todos
})
</code></pre>
<p><strong>2. 键值对存储 (KV)</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { kv } <span class="hljs-keyword">from</span> <span class="hljs-string">'hub:kv'</span>

<span class="hljs-comment">// 存储数据</span>
<span class="hljs-keyword">await</span> kv.<span class="hljs-title function_">set</span>(<span class="hljs-string">'user:1:settings'</span>, { <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span> })
<span class="hljs-comment">// 获取数据</span>
<span class="hljs-keyword">const</span> settings = <span class="hljs-keyword">await</span> kv.<span class="hljs-title function_">get</span>(<span class="hljs-string">'user:1:settings'</span>)
</code></pre>
<p><strong>3. 文件上传 (Blob)</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { blob } <span class="hljs-keyword">from</span> <span class="hljs-string">'hub:blob'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">eventHandler</span>(<span class="hljs-keyword">async</span> (event) =&gt; {
  <span class="hljs-comment">// 获取上传的文件</span>
  <span class="hljs-keyword">const</span> form = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFormData</span>(event)
  <span class="hljs-keyword">const</span> file = form.<span class="hljs-title function_">get</span>(<span class="hljs-string">'image'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">File</span>
  
  <span class="hljs-comment">// 保存到 Blob 存储</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> blob.<span class="hljs-title function_">put</span>(file.<span class="hljs-property">name</span>, file, {
    <span class="hljs-attr">addRandomSuffix</span>: <span class="hljs-literal">true</span>
  })
})
</code></pre>
<h3 data-id="heading-7">第四步：部署上线</h3>
<p>无需去 Cloudflare 后台手动点点点，只需运行：</p>
<pre><code class="hljs language-bash" lang="bash">npx nuxthub deploy
</code></pre>
<p>它会自动登录、构建、并在云端配置好所有需要的数据库和存储资源。</p>
<hr/>
<p><strong>总结</strong>：NuxtHub 是目前 Nuxt 生态中开发<strong>全栈应用</strong>最现代、最轻量的方式，特别适合个人开发者、独立开发者。</p>
<p>最近写了个开源项目也是用nuxthub开发的。</p>
<p><strong>如果这个项目对你有帮助：</strong></p>
<ul>
<li>⭐ <strong>Star</strong> 一下支持作者</li>
<li>🐛 发现 Bug 欢迎提 <strong>Issue</strong></li>
<li>📢 分享给有需要的朋友</li>
<li>💬 有问题可以评论区交流</li>
</ul>
<blockquote>
<p>🔗 GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPBHAHAHA%2FNuxt_Mkdirs" target="_blank" title="https://github.com/PBHAHAHA/Nuxt_Mkdirs" ref="nofollow noopener noreferrer">github.com/PBHAHAHA/Nu…</a></p>
</blockquote>
<p>也可以加我微信交流：<strong>w314709923x</strong></p>
<p><em>如果觉得有帮助，别忘了点赞 👍 收藏 ⭐ 关注 ➕ 三连哦～</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS逆向-哔哩哔哩增加3倍速播放（3）-[横屏视频-全屏播放]场景]]></title>    <link>https://juejin.cn/post/7583910418659409966</link>    <guid>https://juejin.cn/post/7583910418659409966</guid>    <pubDate>2025-12-16T00:14:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910418659409966" data-draft-id="7583906870826926089" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS逆向-哔哩哔哩增加3倍速播放（3）-[横屏视频-全屏播放]场景"/> <meta itemprop="keywords" content="iOS,Swift"/> <meta itemprop="datePublished" content="2025-12-16T00:14:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TouchWorld"/> <meta itemprop="url" content="https://juejin.cn/user/2717648473557143"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS逆向-哔哩哔哩增加3倍速播放（3）-[横屏视频-全屏播放]场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648473557143/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TouchWorld
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:14:06.000Z" title="Tue Dec 16 2025 00:14:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>作为哔哩哔哩的重度用户，我一直期待官方支持 <strong>3 倍速播放</strong>，但该功能迟迟未上线。于是，我利用 iOS 逆向工程知识，为 B 站 App 添加这一功能。</p>
<p><strong>修改前</strong>：最高仅支持 <strong><code>2.0</code></strong> 倍速。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f1cb135823546179f55bf61551a434e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=6ulKiMS8yzs0Dg0Migdbt4G%2FvNQ%3D" alt="Screenshot 2025-12-11 at 07.26.05.png" width="100%" loading="lazy"/>
<p><strong>修改后</strong>：成功添加 <strong><code>3.0</code></strong> 倍速选项</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fee5544b2c7d462b85bf62e232d26862~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=AAcN7r5jRlIa%2BvjHy7NQUnYO2qI%3D" alt="Screenshot 2025-12-11 at 07.22.57.png" loading="lazy"/></p>
<p>本系列分为多篇，本文聚焦 <strong>横屏视频全屏播放</strong> 场景下的 <strong>3 倍速</strong>实现。</p>
<p><strong>系列回顾</strong>：</p>
<ul>
<li><a href="https://juejin.cn/post/7582063437414285350" target="_blank" title="https://juejin.cn/post/7582063437414285350">iOS逆向-哔哩哔哩增加3倍速（1）-最大播放速度</a></li>
<li><a href="https://juejin.cn/post/7582202149910544393" target="_blank" title="https://juejin.cn/post/7582202149910544393">iOS逆向-哔哩哔哩增加3倍速播放（2）-[横屏视频-半屏播放]增加3倍速播放</a></li>
</ul>
<h2 data-id="heading-1">场景</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1ec04e0f2ec4bf580f7cd0e6e853103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=CCLtomnAt%2F6lMfQF%2FQPPgSfbpfI%3D" alt="E260DF27-B08D-4BD1-ADED-A6DD94AAE1A3.png" loading="lazy"/></p>
<h2 data-id="heading-2">开发环境</h2>
<ul>
<li>
<p>哔哩哔哩版本：<code>8.41.0</code></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAloneMonkey%2FMonkeyDev" target="_blank" title="https://github.com/AloneMonkey/MonkeyDev" ref="nofollow noopener noreferrer">MonkeyDev</a></p>
</li>
<li>
<p><code>IDA Professional 9.0</code></p>
</li>
<li>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">安装IDA插件：patching</a></p>
</li>
<li>
<p><code>Lookin</code></p>
</li>
</ul>
<h2 data-id="heading-3">分析</h2>
<h3 data-id="heading-4">1. 定位倍速面板控件</h3>
<ul>
<li>通过 <code>Lookin</code> 查看层级，播放速度浮层为 <code>BBPlayerFloatingWidgetView</code>，其包含 <code>_rootWidget</code> 属性（类型为 <code>BBPlayerNavigationWidget</code>）。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23c832dc3f4f4025baaf3cd96f443645~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=WNw%2F1a27356yury%2FLEUxWXPdJM0%3D" alt="308375D5-0802-4726-902D-EAB1CB96CABA.png" loading="lazy"/></p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">BBPlayerFloatingWidgetView</span> : <span class="hljs-title">UIView</span> </span>{
    <span class="hljs-comment">/* instance variables */</span>
    BBPlayerContext *_context;
    BBPlayerWidget *_rootWidget;
}

<span class="hljs-comment">/* instance methods */</span>
- (<span class="hljs-type">id</span>)initWithContext:(<span class="hljs-type">id</span>)context rootWidget:(<span class="hljs-type">id</span>)widget;
- (<span class="hljs-type">id</span>)hitTest:(<span class="hljs-keyword">struct</span> <span class="hljs-built_in">CGPoint</span> { <span class="hljs-type">double</span> x0; <span class="hljs-type">double</span> x1; })test withEvent:(<span class="hljs-type">id</span>)event;

<span class="hljs-keyword">@end</span>
</code></pre>
<h3 data-id="heading-5">2. 追踪倍速列表</h3>
<ul>
<li>我们在<code>Xcode</code>添加符号断点<code>-[BBPlayerFloatingWidgetView initWithContext:rootWidget:]</code>，看看<code>rootWidget</code>的值是什么？</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2974a3d5b52846a98a191e421a28297d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=GhBy%2BmPecBwyNUVrgwiCAUNGVV4%3D" alt="412EE2D5-DBAE-4F6B-892D-E1C957715D7F.png" loading="lazy"/></p>
<ul>
<li><code>-[BBPlayerFloatingWidgetView initWithContext:rootWidget:]</code>断点触发，我们打印参数的值，知道<code>rootWidget</code>的类型是<code>BBPlayerNavigationWidget</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) p (<span class="hljs-type">id</span>)$x3
(BBPlayerNavigationWidget *) <span class="hljs-number">0x00000002827e2be0</span>
</code></pre>
<ul>
<li>从<code>Mach-O</code>文件导出的<code>BBPlayerNavigationWidget</code>的<code>OC</code>头文件可以知道，<code>BBPlayerNavigationWidget</code>继承自<code>BBPlayerObject</code>，<code>BBPlayerObject</code>有<code>subWidgets</code>属性</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">BBPlayerNavigationWidget</span> : <span class="hljs-title">BBPlayerFloatingWidget</span> &lt;<span class="hljs-title">CAAnimationDelegate</span>, <span class="hljs-title">UIGestureRecognizerDelegate</span>&gt; </span>{
    <span class="hljs-comment">/* instance variables */</span>
    <span class="hljs-built_in">NSMutableArray</span> *_widgets;
    <span class="hljs-built_in">UIView</span> *_view;
}

<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) BBPlayerFloatingWidget *rootWidget;
...
<span class="hljs-comment">/* instance methods */</span>
- (<span class="hljs-type">id</span>)initWithContext:(<span class="hljs-type">id</span>)context rootWidget:(<span class="hljs-type">id</span>)widget;
- (<span class="hljs-type">id</span>)view;
- (<span class="hljs-type">void</span>)pushWidget:(<span class="hljs-type">id</span>)widget animated:(_Bool)animated;
- (<span class="hljs-type">void</span>)pushWidget:(<span class="hljs-type">id</span>)widget animated:(_Bool)animated completion:(<span class="hljs-type">id</span> <span class="hljs-comment">/* block */</span>)completion;
...

<span class="hljs-keyword">@end</span>
</code></pre>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">BBPlayerWidget</span> : <span class="hljs-title">BBPlayerObject</span> &lt;<span class="hljs-title">BBPlayerWidgetDelegate</span>&gt; </span>

<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">long</span> <span class="hljs-type">long</span> lifecycleFlag;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-built_in">UIView</span> *view;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">weak</span>, <span class="hljs-keyword">nonatomic</span>) BBPlayerWidget *superWidget;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">readonly</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-built_in">NSArray</span> *subWidgets;
...
- (<span class="hljs-type">void</span>)willAppear:(_Bool)appear;
- (<span class="hljs-type">void</span>)willLayoutSubWidgets;
- (<span class="hljs-type">void</span>)didLayoutSubWidgets;
- (<span class="hljs-type">void</span>)didAppear:(_Bool)appear;
- (<span class="hljs-type">void</span>)willDisappear:(_Bool)disappear;
- (<span class="hljs-type">void</span>)didDisappear:(_Bool)disappear;
...

<span class="hljs-keyword">@end</span>
</code></pre>
<ul>
<li>我们在<code>Xcode</code>尝试添加符号断点<code>-[BBPlayerNavigationWidget didLayoutSubWidgets]</code>，但是添加不成功</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce800759f90948469ae51a0367470927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=kfK%2FOE5jODGazvvXAd2bk0AQZ4o%3D" alt="9088873D-45A0-4B91-A181-AD273DD35DE2.png" loading="lazy"/></p>
<ul>
<li>我们<code>hook</code> <code>BBPlayerNavigationWidget</code>的<code>didLayoutSubWidgets</code>方法，并添加断点</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">%hook BBPlayerNavigationWidget

- (<span class="hljs-type">void</span>)didLayoutSubWidgets {
    %orig;
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"%@:%@-%p-%s"</span>, nj_logPrefix, <span class="hljs-built_in">NSStringFromClass</span>([(<span class="hljs-type">id</span>)<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]), <span class="hljs-keyword">self</span>, __FUNCTION__);
}

%end
</code></pre>
<ul>
<li><code>BBPlayerNavigationWidget</code>的<code>didLayoutSubWidgets</code>方法的断点触发，我们打印<code>subWidgets</code>属性，发现为空</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po [<span class="hljs-keyword">self</span> subWidgets]
<span class="hljs-literal">nil</span>
</code></pre>
<ul>
<li>我们知道<code>BBPlayerNavigationWidget</code>有个<code>_widgets</code>成员变量，我们打印它的值，发现为空</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">BBPlayerNavigationWidget</span> : <span class="hljs-title">BBPlayerFloatingWidget</span> &lt;<span class="hljs-title">CAAnimationDelegate</span>, <span class="hljs-title">UIGestureRecognizerDelegate</span>&gt; </span>{
    <span class="hljs-comment">/* instance variables */</span>
    <span class="hljs-built_in">NSMutableArray</span> *_widgets;
    <span class="hljs-built_in">UIView</span> *_view;
}
</code></pre>
<pre><code class="hljs language-objc" lang="objc">(lldb) po ((BBPlayerNavigationWidget *)<span class="hljs-keyword">self</span>)-&gt;_widgets
&lt;__NSArrayM <span class="hljs-number">0x280448600</span>&gt;(
)
</code></pre>
<ul>
<li>我们知道<code>BBPlayerNavigationWidget</code>有个<code>- (void)pushWidget:(id)widget animated:(_Bool)animated completion:(id)completion</code>方法，我们添加断点，看<code>widget</code>的值为多少</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">%hook BBPlayerNavigationWidget

- (<span class="hljs-type">void</span>)didLayoutSubWidgets {
    %orig;
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"%@:%@-%p-%s"</span>, nj_logPrefix, <span class="hljs-built_in">NSStringFromClass</span>([(<span class="hljs-type">id</span>)<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]), <span class="hljs-keyword">self</span>, __FUNCTION__);
}

- (<span class="hljs-type">void</span>)pushWidget:(<span class="hljs-type">id</span>)widget animated:(_Bool)animated completion:(<span class="hljs-type">id</span>)completion {
    %orig;
}

- (<span class="hljs-type">void</span>)addWidget:(<span class="hljs-type">id</span>)widget animated:(_Bool)animated completion:(<span class="hljs-type">id</span>)completion {
    %orig;
}

%end
</code></pre>
<ul>
<li><code>- (void)pushWidget:(id)widget animated:(_Bool)animated completion:(id)completion</code>方法的断点触发，发现<code>widget</code>的类型是<code>BBPlayerPlaybackRateListWidget</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) p widget
(BBPlayerPlaybackRateListWidget?) <span class="hljs-number">0x0000000282437b60</span>
</code></pre>
<ul>
<li>而且<code>- (void)pushWidget:(id)widget animated:(_Bool)animated completion:(id)completion</code>方法执行完后，<code>_widgets</code>属性有值了，<code>subWidgets</code>属性也有值了，类型是<code>BBPlayerPlaybackRateListWidget</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po ((BBPlayerNavigationWidget *)<span class="hljs-keyword">self</span>)-&gt;_widgets
&lt;__NSArrayM <span class="hljs-number">0x2804a05d0</span>&gt;(
&lt;BBPlayerPlaybackRateListWidget: <span class="hljs-number">0x282437b60</span>&gt;

)

(lldb) po [<span class="hljs-keyword">self</span> subWidgets]
&lt;__NSSingleObjectArrayI <span class="hljs-number">0x2817c38e0</span>&gt;(
&lt;BBPlayerPlaybackRateListWidget: <span class="hljs-number">0x282437b60</span>&gt;
)
</code></pre>
<ul>
<li>从<code>Mach-O</code>文件导出的<code>BBPlayerCommonSwift.BBPlayerPlaybackRateListWidget</code>的<code>swift</code>文件可以知道，它有一个<code>rateArray</code>属性，猜测它是播放速度数组，<code>rateArray</code>属性只读，<code>getter</code>方法叫做<code>sub_10D829128</code></li>
</ul>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BBPlayerCommonSwift</span>.<span class="hljs-title class_">BBPlayerPlaybackRateListWidget</span>: <span class="hljs-title class_">BBPlayerFloatingWidget</span> {
  <span class="hljs-comment">/* fields */</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">lazy</span> tableView: <span class="hljs-type">UITableView</span>?
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">lazy</span> playbackRate: (<span class="hljs-keyword">private</span>) <span class="hljs-operator">?</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">lazy</span> rateArray: <span class="hljs-type">Array</span> -&gt; <span class="hljs-type">BBPlayerCommonSwift</span>.<span class="hljs-type">BBPlayerPlayerRateModel</span> <span class="hljs-operator">?</span>
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">lazy</span> playbackRateProxy: <span class="hljs-type">BBPlayerPlaybackRateValueService</span>??
  <span class="hljs-comment">/* methods */</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>.getter.sub_10d828e50
    <span class="hljs-comment">// &lt;stripped&gt; func tableView.setter </span>
    <span class="hljs-comment">// &lt;stripped&gt; func tableView.modify </span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">playbackRate</span>.getter.sub_10d829074
    <span class="hljs-comment">// &lt;stripped&gt; func playbackRate.setter </span>
    <span class="hljs-comment">// &lt;stripped&gt; func playbackRate.modify </span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">rateArray</span>.getter.sub_10d829128
    <span class="hljs-comment">// &lt;stripped&gt; func rateArray.setter </span>
    <span class="hljs-comment">// &lt;stripped&gt; func rateArray.modify </span>
<span class="hljs-operator">...</span>
}
</code></pre>
<ul>
<li>我们添加一个符号断点<code>sub_10D829128</code>，看看<code>rateArray</code>的值是多少？</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a28a00a97024d05acf74698d3049424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=lnQicMRm1VdEkouFdoGOYTVPIhM%3D" alt="8CA3E563-CE85-4CB9-BADB-BC848632374B.png" loading="lazy"/></p>
<ul>
<li><code>sub_10D829128</code>断点触发，打印它的返回值，发现是播放速度，这也证明了<code>rateArray</code>属性是播放速度数组</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStorageC19BBPlayerCommonSwift23BBPlayerPlayerRateModel_$ <span class="hljs-number">0x2835d09b0</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x28107fb20</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">2.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x28107fae0</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x28107dc40</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x28107fc60</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x28107e880</span>; value = <span class="hljs-number">0.750000</span>; text = <span class="hljs-number">0.75</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x28107e660</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;
)
</code></pre>
<h3 data-id="heading-6">3. 找到数组创建函数</h3>
<ul>
<li>从<code>IDA</code>查看<code>sub_10D829128</code>的伪代码，分析后猜测是由<code>sub_10D82E870</code>方法创建的播放速度数组</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__int64 sub_10D829128()
{
...
  v1 = OBJC_IVAR___BBPlayerPlaybackRateListWidget____lazy_storage___rateArray;
  v2 = *(_QWORD *)(v0 + OBJC_IVAR___BBPlayerPlaybackRateListWidget____lazy_storage___rateArray);
  <span class="hljs-keyword">if</span> ( v2 )
  {
    v3 = *(_QWORD *)(v0 + OBJC_IVAR___BBPlayerPlaybackRateListWidget____lazy_storage___rateArray);
  }
  <span class="hljs-keyword">else</span>
  {
    v4 = sub_10D82E870();
    v3 = sub_10D82918C(v4);
    v5 = *(_QWORD *)(v0 + v1);
    *(_QWORD *)(v0 + v1) = v3;
    ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))swift_bridgeObjectRetain)();
    swift_bridgeObjectRelease(v5);
    v2 = <span class="hljs-number">0</span>LL;
  }
  swift_bridgeObjectRetain(v2);
  <span class="hljs-keyword">return</span> v3;
}
</code></pre>
<ul>
<li>查看<code>sub_10D82E870</code>方法的伪代码，知道它返回一个包含 6 个 <code>BBPlayerPlayerRateModel</code> 的数组。</li>
</ul>
<pre><code class="hljs language-c" lang="c">__int64 <span class="hljs-title function_">sub_10D82E870</span><span class="hljs-params">()</span>
{
...
  sub_10D7DBF44();
  v0 = swift_allocObject();
  *(_OWORD *)(v0 + <span class="hljs-number">16</span>) = xmmword_110613B30;
  v1 = (objc_class *)type metadata accessor <span class="hljs-keyword">for</span> BBPlayerPlayerRateModel();
  v2 = (<span class="hljs-type">char</span> *)objc_msgSend(objc_allocWithZone(v1), <span class="hljs-string">"init"</span>);
  v3 = &amp;v2[OBJC_IVAR___BBPlayerPlayerRateModel_value];
  swift_beginAccess(&amp;v2[OBJC_IVAR___BBPlayerPlayerRateModel_value], v38, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);
  *(_QWORD *)v3 = <span class="hljs-number">0x3FE0000000000000</span>LL;
  v4 = &amp;v2[OBJC_IVAR___BBPlayerPlayerRateModel_text];
  swift_beginAccess(&amp;v2[OBJC_IVAR___BBPlayerPlayerRateModel_text], v37, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);
  v5 = *((_QWORD *)v4 + <span class="hljs-number">1</span>);
  *(_QWORD *)v4 = <span class="hljs-number">3485232LL</span>;
  *((_QWORD *)v4 + <span class="hljs-number">1</span>) = <span class="hljs-number">0xE300000000000000</span>LL;
  swift_bridgeObjectRelease(v5);
  *(_QWORD *)(v0 + <span class="hljs-number">32</span>) = v2;
  v6 = (<span class="hljs-type">char</span> *)objc_msgSend(objc_allocWithZone(v1), <span class="hljs-string">"init"</span>);
  v7 = &amp;v6[OBJC_IVAR___BBPlayerPlayerRateModel_value];
  swift_beginAccess(&amp;v6[OBJC_IVAR___BBPlayerPlayerRateModel_value], v36, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);
  *(_QWORD *)v7 = <span class="hljs-number">0x3FE8000000000000</span>LL;
  v8 = &amp;v6[OBJC_IVAR___BBPlayerPlayerRateModel_text];
  swift_beginAccess(&amp;v6[OBJC_IVAR___BBPlayerPlayerRateModel_text], v35, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);
  v9 = *((_QWORD *)v8 + <span class="hljs-number">1</span>);
  *(_QWORD *)v8 = <span class="hljs-number">892808752LL</span>;
  *((_QWORD *)v8 + <span class="hljs-number">1</span>) = <span class="hljs-number">0xE400000000000000</span>LL;
  swift_bridgeObjectRelease(v9);
  *(_QWORD *)(v0 + <span class="hljs-number">40</span>) = v6;
  v10 = (<span class="hljs-type">char</span> *)objc_msgSend(objc_allocWithZone(v1), <span class="hljs-string">"init"</span>);
  v11 = &amp;v10[OBJC_IVAR___BBPlayerPlayerRateModel_value];
  swift_beginAccess(&amp;v10[OBJC_IVAR___BBPlayerPlayerRateModel_value], v34, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);
  *(_QWORD *)v11 = <span class="hljs-number">0x3FF0000000000000</span>LL;
  v12 = &amp;v10[OBJC_IVAR___BBPlayerPlayerRateModel_text];
  swift_beginAccess(&amp;v10[OBJC_IVAR___BBPlayerPlayerRateModel_text], v33, <span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);
  v13 = *((_QWORD *)v12 + <span class="hljs-number">1</span>);
  *(_QWORD *)v12 = <span class="hljs-number">3157553LL</span>;
  *((_QWORD *)v12 + <span class="hljs-number">1</span>) = <span class="hljs-number">0xE300000000000000</span>LL;
  swift_bridgeObjectRelease(v13);
  *(_QWORD *)(v0 + <span class="hljs-number">48</span>) = v10;
...
  <span class="hljs-keyword">return</span> v0;
}
</code></pre>
<ul>
<li>我们添加一个符号断点<code>sub_10D82E870</code>，看看方法返回值多少？</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fa5ad9d33664f7db660915a655935ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=YGHWIE88t8vKImgIeOFrx5wfkSk%3D" alt="5A6089F4-393E-4D9C-8C53-DAF4C10C7226.png" loading="lazy"/></p>
<ul>
<li><code>sub_10D82E870</code>断点触发，打印它的返回值，发现是播放速度数组<code>[0.5、0.75、1.0、1.25、1.5、2.0]</code>，这也证明了是由<code>sub_10D82E870</code>方法创建的播放速度数组</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStorageC19BBPlayerCommonSwift23BBPlayerPlayerRateModel_$ <span class="hljs-number">0x2834b2da0</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x281164280</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x281165760</span>; value = <span class="hljs-number">0.750000</span>; text = <span class="hljs-number">0.75</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x2811655c0</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x281164840</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x281165500</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x281164a40</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
<h2 data-id="heading-7">越狱解决方案</h2>
<h3 data-id="heading-8">MSHookFunction</h3>
<p><code>MSHookFunction</code> 来自 <strong>Cydia Substrate（MobileSubstrate）</strong>，用于 <strong>直接 Hook 一个函数地址</strong>，而不是 Objective-C 方法。</p>
<h4 data-id="heading-9">函数原型</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">MSHookFunction</span><span class="hljs-params">(
    <span class="hljs-type">void</span> *symbol,
    <span class="hljs-type">void</span> *replace,
    <span class="hljs-type">void</span> **result
)</span></span>;
</code></pre>
<h4 data-id="heading-10">参数说明</h4>





















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>symbol</code></td><td><strong>原始函数地址</strong></td></tr><tr><td><code>replace</code></td><td><strong>你的替换函数</strong></td></tr><tr><td><code>result</code></td><td><strong>保存原始函数指针（可选）</strong></td></tr></tbody></table>
<h3 data-id="heading-11">方案</h3>
<ul>
<li>使用 <code>MSHookFunction</code> 直接 <code>hook sub_10D82E870</code>，修改返回数组的 <code>value</code> 和 <code>text</code> 属性。</li>
</ul>
<p><strong>核心代码：</strong></p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-meta">#import <span class="hljs-string">"NJChangePlaybackRateTool.h"</span></span>
<span class="hljs-meta">#import <span class="hljs-string">"NJCommonDefine.h"</span></span>

<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-type">double</span> NJChangePlaybackRateFlag = <span class="hljs-number">3.0</span>;

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">NJChangePlaybackRateTool</span> ()</span>

<span class="hljs-comment">/// 播放速度</span>
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *playbackRates;

<span class="hljs-keyword">@end</span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">NJChangePlaybackRateTool</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - Life Cycle Methods</span>

- (<span class="hljs-keyword">instancetype</span>)init {
    <span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) {
        [<span class="hljs-keyword">self</span> doInit];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - Do Init</span>

- (<span class="hljs-type">void</span>)doInit {
    <span class="hljs-keyword">self</span>.playbackRates = @[<span class="hljs-string">@"0.5"</span>, <span class="hljs-string">@"1.0"</span>, <span class="hljs-string">@"1.25"</span>, <span class="hljs-string">@"1.5"</span>, <span class="hljs-string">@"2.0"</span>, <span class="hljs-string">@"3.0"</span>];
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - Override Methods</span>

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - Public Methods</span>

- (<span class="hljs-built_in">NSArray</span> *)changePlaybackRateWithRateArray:(<span class="hljs-built_in">NSArray</span> *)rateArray {
    <span class="hljs-keyword">if</span> (![<span class="hljs-keyword">self</span> shouldChange:rateArray]) {
        <span class="hljs-keyword">return</span> rateArray;
    }
<span class="hljs-comment">//    NSLog(@"[%@] change before rateArray = %@, class:%@", nj_logPrefix, rateArray, NSStringFromClass([rateArray class]));</span>
    <span class="hljs-built_in">NSInteger</span> rateCount = rateArray.count;
    <span class="hljs-built_in">NSInteger</span> newRateCount = <span class="hljs-keyword">self</span>.playbackRates.count;
    <span class="hljs-built_in">NSInteger</span> count = MIN(rateCount, newRateCount);
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSInteger</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        BBPlayerPlayerRateModel *rateModel = rateArray[i];
        <span class="hljs-built_in">NSString</span> *newRateStr = <span class="hljs-keyword">self</span>.playbackRates[i];
        rateModel.value = newRateStr.doubleValue;
        rateModel.text = newRateStr;
    }
<span class="hljs-comment">//    NSLog(@"[%@] change after rateArray = %@, class:%@", nj_logPrefix, rateArray, NSStringFromClass([rateArray class]));</span>
    <span class="hljs-keyword">return</span> rateArray;
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - Private Methods</span>

- (<span class="hljs-type">BOOL</span>)shouldChange:(<span class="hljs-built_in">NSArray</span> *)rateArray {
    <span class="hljs-type">BOOL</span> flag = <span class="hljs-literal">YES</span>;
    <span class="hljs-keyword">for</span> (BBPlayerPlayerRateModel *item <span class="hljs-keyword">in</span> rateArray) {
        <span class="hljs-keyword">if</span> (item.value == NJChangePlaybackRateFlag) {
            flag = <span class="hljs-literal">NO</span>;
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-keyword">return</span> flag;
}

<span class="hljs-keyword">@end</span>

</code></pre>
<p><strong>Hook 实现</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 声明原函数类型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">typealias</span> orig_landscapeVideo_fullScreenPlayback_RateModelArr_type <span class="hljs-operator">=</span> <span class="hljs-keyword">@convention(c)</span> () -&gt; <span class="hljs-type">Int64</span>

<span class="hljs-comment">// 定义全局函数指针变量，并绑定一个 C 名字</span>
<span class="hljs-meta">@_silgen_name</span>(<span class="hljs-string">"orig_landscapeVideo_fullScreenPlayback_RateModelArr"</span>)
<span class="hljs-keyword">nonisolated</span>(unsafe) <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> orig_landscapeVideo_fullScreenPlayback_RateModelArr: orig_landscapeVideo_fullScreenPlayback_RateModelArr_type<span class="hljs-operator">?</span> <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>
<span class="hljs-comment">// [横屏视频-全屏播放]播放速度数组</span>
<span class="hljs-meta">@_cdecl</span>(<span class="hljs-string">"my_landscapeVideo_fullScreenPlayback_RateModelArr"</span>)
<span class="hljs-keyword">func</span> <span class="hljs-title function_">my_landscapeVideo_fullScreenPlayback_RateModelArr</span>() -&gt; <span class="hljs-type">Int64</span> {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> orig_landscapeVideo_fullScreenPlayback_RateModelArr {
        <span class="hljs-keyword">let</span> origPtr <span class="hljs-operator">=</span> orig_landscapeVideo_fullScreenPlayback_RateModelArr()
        <span class="hljs-keyword">let</span> origArr <span class="hljs-operator">=</span> <span class="hljs-built_in">unsafeBitCast</span>(origPtr, to: [<span class="hljs-type">NSObject</span>].<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">let</span> tool <span class="hljs-operator">=</span> <span class="hljs-type">NJChangePlaybackRateTool</span>()
        tool.changePlaybackRate(withRateArray: origArr)
        <span class="hljs-keyword">let</span> retPtr <span class="hljs-operator">=</span> <span class="hljs-built_in">unsafeBitCast</span>(origArr, to: <span class="hljs-type">Int64</span>.<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">return</span> retPtr
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
}

</code></pre>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// __int64 sub_10D82E870()</span>
<span class="hljs-comment">// [横屏视频-全屏播放]播放速度数组</span>
<span class="hljs-type">long</span> <span class="hljs-type">long</span> landscapeVideo_fullScreenPlayback_RateModelArr_address = g_slide+<span class="hljs-number">0x10D82E870</span>;
<span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"[%@] cal func landscapeVideo_fullScreenPlayback_RateModelArr_address address:0x%llx"</span>, nj_logPrefix, landscapeVideo_fullScreenPlayback_RateModelArr_address);
MSHookFunction((<span class="hljs-type">void</span> *)landscapeVideo_fullScreenPlayback_RateModelArr_address,
			   (<span class="hljs-type">void</span>*)my_landscapeVideo_fullScreenPlayback_RateModelArr,
			   (<span class="hljs-type">void</span>**)&amp;orig_landscapeVideo_fullScreenPlayback_RateModelArr);

</code></pre>
<h2 data-id="heading-12">非越狱解决方案</h2>
<p>通过 <code>IDA Pro</code> 修改汇编指令，直接硬编码新倍速。</p>
<h3 data-id="heading-13">分析</h3>
<ul>
<li>我们知道<code>sub_10D82E870</code>方法返回的是<code>BBPlayerPlayerRateModel</code>数组，而<code>BBPlayerPlayerRateModel</code>的结构如下，所以我们要修改<code>BBPlayerPlayerRateModel</code>的<code>value</code>和<code>text</code>的值</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">BBPlayerPlayerRateModel</span> : <span class="hljs-title">NSObject</span> // (<span class="hljs-title">Swift</span>)</span>

<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">double</span> value;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *text;

<span class="hljs-comment">/* instance methods */</span>
- (<span class="hljs-type">id</span>)initWithValue:(<span class="hljs-type">double</span>)value text:(<span class="hljs-type">id</span>)text;
- (<span class="hljs-type">id</span>)init;

<span class="hljs-keyword">@end</span>
</code></pre>
<h3 data-id="heading-14">修改value</h3>
<p>让<code>chatgpt</code>帮忙分析<code>sub_10D82E870</code>方法的汇编指令，给我们赋值<code>value</code>的地址，给出如下表格：</p>















































<table><thead><tr><th>元素 index</th><th>地址</th><th>旧值: 旧汇编指令</th><th>新值: 新汇编指令</th></tr></thead><tbody><tr><td>0</td><td><code>0x10D82E8FC</code></td><td><code>"0.5"</code>： <code>MOV       X8, #0x3FE0000000000000</code></td><td>不变</td></tr><tr><td>1</td><td><code>0x10D82E970</code></td><td><code>"0.75"</code>： <code>MOV       X8, #0x3FE8000000000000</code></td><td><code>"1.0"</code>： <code>MOV       X8, #0x3FF0000000000000</code></td></tr><tr><td>2</td><td><code>0x10D82E9E0</code></td><td><code>"1.0"</code>： <code>MOV       X8, #0x3FF0000000000000</code></td><td><code>"1.25"</code>： <code>MOV       X8, #0x3FF4000000000000</code></td></tr><tr><td>3</td><td><code>0x10D82EA4C</code></td><td><code>"1.25"</code>： <code>MOV       X8, #0x3FF4000000000000</code></td><td><code>"1.5"</code>： <code>MOV       X8, #0x3FF8000000000000</code></td></tr><tr><td>4</td><td><code>0x10D82EAB8</code></td><td><code>"1.5"</code>： <code>MOV       X8, #0x3FF8000000000000</code></td><td><code>"2.0"</code>： <code>MOV       X8, #0x4000000000000000</code></td></tr><tr><td>5</td><td><code>0x10D82EB28</code></td><td><code>"2.0"</code>： <code>MOV       X8, #0x4000000000000000</code></td><td><code>"3.0"</code>： <code>MOV       X8, #0x4008000000000000</code></td></tr></tbody></table>
<h4 data-id="heading-15">示例</h4>
<ul>
<li>
<p>我们修改<code>000000010D82E970</code>的指令</p>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82E970                 MOV             X8, #<span class="hljs-number">0x3FE8000000000000</span>
</code></pre>
<ul>
<li>鼠标点击<code>000000010D82E970</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82E970                 MOV             X8, #<span class="hljs-number">0x3FE8000000000000</span>
</code></pre>
<ul>
<li>右键选择<code>Assemble</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c70d1ef0e8a3464ebaa87998330d8700~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=lAyRz830i5N3mNBEhib9FzYd2Ec%3D" alt="CBAD6A1D-ABAA-46E3-9855-87E9CC816B2F.png" loading="lazy"/></li>
</ul>

<ul>
<li>改成</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">MOV     X8, #<span class="hljs-number">0x3FF0000000000000</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba2cbe181d714ae890727157da9b4d3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=zGsKoLpehHJ%2BKmSa9KkI%2BuAeYYg%3D" alt="70A070E9-EA12-4482-BDF0-636E77B7C97B.png" loading="lazy"/></p>
<ul>
<li>点击<code>enter</code></li>
</ul>
</li>
<li>
<p>保存到<code>Mach-O</code>文件中</p>
<ul>
<li><code>IDA</code>-&gt;<code>Edit</code>-&gt;<code>Patch program</code>-&gt;<code>Apply patches to input file</code>-&gt;<code>Apply patches</code></li>
</ul>
</li>
</ul>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33339a2dcdd74c1396a207e5265a93e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=mFYbtinyjmvwewSRIgkKj40F%2FSw%3D" alt="12636991-9898-4A7D-B2A1-D400B420039F.png" width="70%" loading="lazy"/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed2b24482984094a63c5392e8901d10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=daoQg2AzGlGWDfKkOqlEJQeE6QE%3D" alt="06857153-3C9D-4018-82FA-55C53C1C6516.png" loading="lazy"/></p>
<ul>
<li>
<p>保存后：底部会显示<code>log</code>：</p>
<pre><code class="hljs language-objc" lang="objc">Patch successful: /Users/touchworld/Documents/iOSDisassembler/hook/bilibili/IDA_max_0/bili-universal
</code></pre>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c28bfc6b6094c58b8d920bd8465f83f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=LXq8Br0uD5K84LSGO5U3sM0Ot2E%3D" alt="DE3F7FC3-798A-4A23-9C34-FF6AF7F24BC7.png" loading="lazy"/></p>
<ul>
<li>
<p>验证修改结果</p>
<ul>
<li>将修改后的<code>Mach-O</code>文件放入<code>.app</code>文件中</li>
<li><code>Xcode</code>添加符号断点<code>sub_10D82E870</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27cc5f374ba049acb8e0ca9cf14ef7d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=bL1nlL%2FTrnRGfRdmJn64H%2BwopL8%3D" alt="4B068744-8DF9-4C12-99BF-DC96A954A2EC.png" loading="lazy"/></p>
<ul>
<li><code>sub_10D82E870</code>断点触发，打印它的返回值，发现<strong>元素1</strong>的<code>value</code>已经从<code>0.75</code>改为了<code>1.0</code>，验证修改成功。</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x303adb570</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301d18f60</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301d19880</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">0.75</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301d197e0</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301d19840</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301d19780</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301d19860</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
</li>
<li>
<p>全部修改结果</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x3009c9360</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3028a4cc0</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3028a5660</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">0.75</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3028a49a0</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3028a4900</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3028a48a0</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3028a4400</span>; value = <span class="hljs-number">3.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
<h3 data-id="heading-16">修改text</h3>
<p>让<code>chatgpt</code>分析<code>sub_10D82E870</code>方法的汇编指令，给我们赋值<code>text</code>的地址，给出如下表格：</p>








































<table><thead><tr><th>元素 index</th><th>地址</th><th>旧值: 旧汇编指令</th></tr></thead><tbody><tr><td>0</td><td><code>0x10D82E928</code></td><td><code>0.5</code>： <code>MOV       W8, #0x352E30</code></td></tr><tr><td>1</td><td><code>0x10D82E998</code></td><td><code>0.75</code>： <code>MOV       W8, #0x35372E30</code></td></tr><tr><td>2</td><td><code>0x10D82EA08</code></td><td><code>1.0</code>： <code>MOV       W28, #0x302E31</code></td></tr><tr><td>3</td><td><code>0x10D82EA74</code></td><td><code>1.25</code>： <code>MOV       W8, #0x35322E31</code></td></tr><tr><td>4</td><td><code>0x10D82EAE0</code></td><td><code>1.5</code>： <code>MOV       W8, #0x352E31</code></td></tr><tr><td>5</td><td><code>0x10D82EB50</code></td><td><code>2.0</code>： <code>ADD       X8, X28, #1</code></td></tr></tbody></table>
<h4 data-id="heading-17">分析</h4>
<p>第<code>5</code>个元素的<code>0x10D82EB50</code>的指令是<code>ADD       X8, X28, #1</code>，而<code>x28</code>寄存器只在<code>__text:000000010D82EA08         MOV       W28, #0x302E31</code>赋过值，而<code>#0x302E31</code>的值是<code>1.0</code>，所以<code>ADD       X8, X28, #1</code>相当于是<code>X8 = X28 + 1 = 1.0 + 1 = 2.0</code> ，所以第<code>5</code>个元素显示的是<code>2.0</code>。</p>
<p>所以方案就是，<code>1.0</code>要使用<code>MOV       W28, #0x302E31</code>，<code>2.0</code>使用<code>ADD       X8, X28, #1</code>，<code>3.0</code>跟<code>2.0</code>一致。</p>
<blockquote>
<p>下面在元素1中，给出具体的调试过程，其他元素类似。</p>
</blockquote>
<hr/>
<h4 data-id="heading-18">元素0</h4>
<p>元素<code>0</code>不需要修改，就是<code>0.5</code></p>
<h4 data-id="heading-19">元素1</h4>
<ul>
<li>
<p>原本<code>0x10D82E998</code>的<code>MOV       W8, #0x35372E30（0.75）</code>，占两个指令空间，要改成<code>MOV       W28, #0x302E31（1.0）</code></p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82E998                 MOV             W8, #<span class="hljs-number">0x35372E30</span>
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82E998                 MOV             W28, #<span class="hljs-number">0x302E31</span>
</code></pre>
</li>
</ul>
<h5 data-id="heading-20">伪指令</h5>
<p><strong>伪指令</strong>（<code>Pseudo-Instruction</code>）不是 <code>CPU</code> 真实存在的机器指令，而是编译器/汇编器提供的“方便写法”。</p>
<p>最终汇编器会把伪指令转换成 一条或多条真实的机器指令。</p>
<p>看个例子：</p>
<ul>
<li>鼠标点击<code>000000010D82E998</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82E998                 MOV             W8, #<span class="hljs-number">0x35372E30</span>
</code></pre>
<ul>
<li>查看<code>000000010D82E998</code>的<code>16</code>进制视图，发现指令占用了<code>8 bytes</code>，也就是两个指令的空间，所以<code>MOV       W8, #0x35372E30</code>是一个<strong>伪指令</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/028fc55f2d3c42a7a3110ae4624299a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=j%2BbLGfhBMOycJP8hxZHelfWp9qc%3D" alt="DA6DF5E1-0397-46BD-A893-A8AB6F9456BC.png" loading="lazy"/></p>
<ul>
<li>问<code>chatgpt</code>，<code>MOV       W8, #0x35372E30</code>可以拆分成什么指令？回答如下</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">MOVZ    W8, #<span class="hljs-number">0x2E30</span>
MOVK    W8, #<span class="hljs-number">0x3537</span>, LSL #<span class="hljs-number">16</span>
</code></pre>
<h5 data-id="heading-21">获取伪指令的真实指令</h5>
<ul>
<li>问<code>chatgpt</code>，<code>MOV       W28, #0x302E31</code>可以拆分成：</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">MOVZ    W28, #<span class="hljs-number">0x2E31</span>            <span class="hljs-comment">// 写入低 16 位</span>
MOVK    W28, #<span class="hljs-number">0x0030</span>, LSL #<span class="hljs-number">16</span>   <span class="hljs-comment">// 写入高 16 位</span>
</code></pre>
<h5 data-id="heading-22">获取汇编指令的机器码</h5>
<ul>
<li>写<code>main.S</code>文件</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">.global _main
_main:
    MOVZ    W28, #<span class="hljs-number">0x2E31</span>            <span class="hljs-comment">// 写入低 16 位</span>
    MOVK    W28, #<span class="hljs-number">0x0030</span>, LSL #<span class="hljs-number">16</span>   <span class="hljs-comment">// 写入高 16 位</span>
    ret
</code></pre>
<ul>
<li>编译<code>main.S</code>文件</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">clang -arch arm64 main.S -o main
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43d8bf52e45845b785ebdfc3d586a7eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=0%2BSTnduEyfzhoFN5f%2FG1cp4Ghwk%3D" alt="BCD67C3E-D7D5-4282-A0CF-8A886CC9D27B.png" loading="lazy"/></p>
<ul>
<li>使用<code>MachOView</code>查看<code>main</code>文件(<code>Mach-O</code>文件)的机器码</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb29b3e29f1846a28b6d6f1d2fde62c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=0OiNujBGFV8erAJBvNczwe6%2FfWk%3D" alt="image-20251215150438720.png" loading="lazy"/></p>
<ul>
<li>所以<code>MOV       W28, #0x302E31</code>的机器码是</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">3</span>C C6 <span class="hljs-number">85</span> <span class="hljs-number">52</span> <span class="hljs-number">1</span>C <span class="hljs-number">06</span> A0 <span class="hljs-number">72</span>
</code></pre>
<h5 data-id="heading-23">修改指令的机器码</h5>
<ul>
<li>鼠标点击<code>000000010D82E998</code></li>
<li><code>IDA</code>-&gt;<code>Edit</code>-&gt;<code>Patch program</code>-&gt;<code>Change byte</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ad3a5353d8b4e8ca65825b4830d0954~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=7z3m6ixN3%2Bil%2BY0aJi8Gc6I%2BV1M%3D" alt="7055BC7A-0B60-49DF-AA40-6444A3240912.png" loading="lazy"/></p>
<ul>
<li>显示<code>Patch Bytes</code>弹框</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63efee5447274dc4af3c0acca0772f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=FSnKxoOmrWv6VelqAid6cS0F8wU%3D" alt="459F522D-9842-4D5F-AFC8-F87A82FC8865.png" loading="lazy"/></p>
<ul>
<li>从<code>Origin value</code>：
<ul>
<li><strong>08 C6 85 52 E8 A6 A6 72 1B 80 FC D2 C8 6E 00 A9</strong></li>
</ul>
</li>
<li>修改 Values 为：
<ul>
<li><strong>3C C6 85 52 1C 06 A0 72 1B 80 FC D2 DC 6A 00 A9</strong></li>
</ul>
</li>
<li>点击<code>OK</code>，真正修改</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62538c4e6abf436ebb9c1113a17a967b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=ojU6TIewlOuHh5LkDwV0CS24C%2F0%3D" alt="image-20251215151448578.png" loading="lazy"/></p>
<h5 data-id="heading-24">保存</h5>
<ul>
<li>
<p>保存到<code>Mach-O</code>文件中</p>
<ul>
<li><code>IDA</code>-&gt;<code>Edit</code>-&gt;<code>Patch program</code>-&gt;<code>Apply patches to input file</code>-&gt;<code>Apply patches</code></li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2476728b7cb4aa58686f85f6d644a73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=azfo6Ph3mnc%2BGCIv9Vx%2FIErVKIk%3D" alt="12636991-9898-4A7D-B2A1-D400B420039F-5765270.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f0b97c027664ee9bcdadfff56f78f93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=VlLh5WhGqBGFy7ajT8ps3sdUkeQ%3D" alt="06857153-3C9D-4018-82FA-55C53C1C6516-5765282.png" loading="lazy"/></p>
<ul>
<li>保存后：底部会显示<code>log</code>：</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">Patch successful: /Users/touchworld/Documents/iOSDisassembler/hook/bilibili/IDA_max_0/bili-universal
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89e9262d46604634b05194f4692bb6fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=6HwYHSfmpn5%2FOkM5mJEUpn56sVk%3D" alt="DE3F7FC3-798A-4A23-9C34-FF6AF7F24BC7-5765291.png" loading="lazy"/></p>
<h5 data-id="heading-25">验证失败</h5>
<ul>
<li>将修改后的<code>Mach-O</code>文件放入<code>.app</code>文件中</li>
<li><code>Xcode</code>添加符号断点<code>sub_10D82E870</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c43c059e46f246ceba727ddc5fea2d3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=4E0wBR5DELgNB1HWbo3%2FbuU0q2M%3D" alt="4B068744-8DF9-4C12-99BF-DC96A954A2EC-5765304.png" loading="lazy"/></p>
<ul>
<li><code>sub_10D82E870</code>断点触发，打印它的返回值，发现<strong>元素1</strong>的<code>text</code>已经从<code>"0.75"</code>改为了<code>"1.0"</code>，但是打印的数组显示不全，而且倍速列表显示的是<code>1.0</code>，不是<code>1.0X</code>，所以还是有问题。</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x3036c0190</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x301058d80</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30105b380</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0868324e9427424c98a89b8d0f28d064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=1xVhLY%2Bmk0ZXLwVvCY7disZCHpE%3D" alt="4F4E4F3B-2414-42BE-81EF-1C90EDB6362C.png" loading="lazy"/></p>
<h5 data-id="heading-26">处理问题</h5>
<ul>
<li>我们知道<code>0x10D82EA08</code>的<code>MOV       W28, #0x302E31</code>的值是<code>1.0</code>，它的下一条指令是<code>STP       X28, X26, [X22]</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA08                 MOV             W28, #<span class="hljs-number">0x302E31</span>
__text:<span class="hljs-number">000000010</span>D82EA10                 STP             X28, X26, [X22]
</code></pre>
<ul>
<li>而修改后的<code>000000010D82E998</code>的<code>MOV             W28, #0x302E31</code>，它的下一条指令是<code>STP       X8, X27, [X22]</code></li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82E998                 MOV             W28, #<span class="hljs-number">0x302E31</span>
__text:<span class="hljs-number">000000010</span>D82E9A4                 STP             X8, X27, [X22]
</code></pre>
<ul>
<li>我们尝试将<code>0x10D82E9A4</code>的<code>STP       X8, X27, [X22]</code>，改为<code>STP             X28, X26, [X22]</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6192370da52443f914f60a22a29d81e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=h6HaRDujvtjNilXUZCLlY1BNLx4%3D" alt="image-20251215152153278.png" loading="lazy"/></p>
<h5 data-id="heading-27">再次验证</h5>
<ul>
<li><code>sub_10D82E870</code>断点触发，打印它的返回值，发现<strong>元素1</strong>的<code>text</code>已经从<code>"0.75"</code>改为了<code>"1.0"</code>，而且数组全部打印了，倍速列表显示的是<code>1.0X</code>，修改成功。</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x301b6b8e0</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x303bbd1c0</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x303bbd200</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x303bbcf80</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x303bbcf40</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x303bbcb20</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x303bbc860</span>; value = <span class="hljs-number">3.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4c65ad9df4e48f096bf26ca3dff4803~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=I0UkGWaHWxHz82BLdq%2FnKKtVt2Y%3D" alt="9103463C-D49B-4FE6-BD66-E79B0172F047.png" loading="lazy"/></p>
<h4 data-id="heading-28">元素2</h4>
<ul>
<li>
<p>原本<code>0x10D82EA08</code>的<code>MOV       W28, #0x302E31（1.0）</code>，占两个指令空间，要改成<code>MOV       W8, #0x35322E31（1.25）</code></p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA08                 MOV             W28, #<span class="hljs-number">0x302E31</span>
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA08                 MOV             W8, #<span class="hljs-number">0x35322E31</span>
</code></pre>
</li>
<li>
<p><code>MOV       W8, #0x35322E31</code>拆分成：</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">MOVZ    W8, #<span class="hljs-number">0x2E31</span>              <span class="hljs-comment">// 写低 16 bit</span>
MOVK    W8, #<span class="hljs-number">0x3532</span>, LSL #<span class="hljs-number">16</span>     <span class="hljs-comment">// 写高 16 bit</span>
</code></pre>
<ul>
<li><code>MOV       W8, #0x35322E31</code>的机器码</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">28</span> C6 <span class="hljs-number">85</span> <span class="hljs-number">52</span> <span class="hljs-number">48</span> A6 A6 <span class="hljs-number">72</span>
</code></pre>
<ul>
<li>
<p>还需要将<code>0x10D82EA10</code>的<code>STP       X28, X26, [X22]</code>，占一个指令空间，改成<code>STP       X8, X27, [X22]</code></p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA10                 STP             X28, X26, [X22]
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA10                 STP             X8, X27, [X22]
</code></pre>
</li>
<li>
<p>验证</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x3022f5f90</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30057cca0</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30057f360</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30057ccc0</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30057f3c0</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30057c960</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30057ca00</span>; value = <span class="hljs-number">3.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
<h4 data-id="heading-29">元素3</h4>
<ul>
<li>
<p>原本<code>0x10D82EA74</code>的<code>MOV       W8, #0x35322E31（1.25）</code>，占两个指令空间，要改成<code>MOV W8, #0x352E31（1.5）</code></p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA74                 MOV             W8, #<span class="hljs-number">0x35322E31</span>
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA74                 MOV             W8, #<span class="hljs-number">0x352E31</span>
</code></pre>
</li>
<li>
<p><code>MOV W8, #0x352E31</code>拆分成</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">MOVZ    W8, #<span class="hljs-number">0x2E31</span>              <span class="hljs-comment">// 写低16位</span>
MOVK    W8, #<span class="hljs-number">0x0035</span>, LSL #<span class="hljs-number">16</span>     <span class="hljs-comment">// 写高16位</span>
</code></pre>
<ul>
<li><code>MOV W8, #0x352E31</code>的机器码</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">28</span> C6 <span class="hljs-number">85</span> <span class="hljs-number">52</span> A8 <span class="hljs-number">06</span> A0 <span class="hljs-number">72</span>
</code></pre>
<ul>
<li>
<p>还需要将<code>0x10D82EA7C</code>的<code>STP       X8, X27, [X22]</code>，占一个指令空间，改成<code>STP       X8, X26, [X22]</code></p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA7C                 STP             X8, X27, [X22]
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EA7C                 STP             X8, X26, [X22]
</code></pre>
</li>
<li>
<p>验证</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x300d97610</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x302ac6ac0</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x302af3760</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x302af3420</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x302af3b40</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x302af2de0</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x302af3d00</span>; value = <span class="hljs-number">3.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
<h4 data-id="heading-30">元素4</h4>
<ul>
<li>
<p>原本<code>0x10D82EAE0</code>的<code>MOV       W8, #0x352E31（1.5）</code>（<strong>占三个指令空间）</strong>，要改成<code>MOV W8, #0x302E32（2.0）</code>（占两个指令空间） + 一个<code>NOP</code>（占一个指令空间）</p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EAE0                 MOV             W8, #<span class="hljs-number">0x352E31</span>
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EAE0                 MOV             W8, #<span class="hljs-number">0x302E32</span>
__text:<span class="hljs-number">000000010</span>D82EAE8                 NOP
</code></pre>
</li>
<li>
<p><code>MOV W8, #0x302E32</code>拆分成</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">MOVZ    W8, #<span class="hljs-number">0x2E32</span>            <span class="hljs-comment">// 写低 16 位</span>
MOVK    W8, #<span class="hljs-number">0x0030</span>, LSL #<span class="hljs-number">16</span>   <span class="hljs-comment">// 写高 16 位</span>
</code></pre>
<ul>
<li><code>MOV W8, #0x302E32</code>的机器码</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">48</span> C6 <span class="hljs-number">85</span> <span class="hljs-number">52</span> <span class="hljs-number">08</span> <span class="hljs-number">06</span> A0 <span class="hljs-number">72</span>
</code></pre>
<ul>
<li><code>NOP</code>的机器码</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">1</span>F <span class="hljs-number">20</span> <span class="hljs-number">03</span> D5
</code></pre>
<ul>
<li>总的机器码</li>
</ul>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-number">48</span> C6 <span class="hljs-number">85</span> <span class="hljs-number">52</span> <span class="hljs-number">08</span> <span class="hljs-number">06</span> A0 <span class="hljs-number">72</span> <span class="hljs-number">1</span>F <span class="hljs-number">20</span> <span class="hljs-number">03</span> D5
</code></pre>
<ul>
<li>验证</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x303fe4f00</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3018ffe60</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3018ffe80</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3018ffa20</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3018ffb20</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3018ffb00</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">2.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x3018ff860</span>; value = <span class="hljs-number">3.000000</span>; text = <span class="hljs-number">2.0</span>&gt;
)
</code></pre>
<h4 data-id="heading-31">元素5</h4>
<ul>
<li>
<p>原本<code>0x10D82EB50</code>的<code>ADD       X8, X28, #1（2.0）</code>，占一个指令空间，要改成<code>ADD       X8, X28, #2（3.0）</code></p>
<ul>
<li>修改前</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EB50                 ADD             X8, X28, #<span class="hljs-number">1</span>
</code></pre>
<ul>
<li>修改后</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">__text:<span class="hljs-number">000000010</span>D82EB50                 ADD             X8, X28, #<span class="hljs-number">2</span>
</code></pre>
</li>
<li>
<p>验证</p>
</li>
</ul>
<pre><code class="hljs language-objc" lang="objc">(lldb) po (<span class="hljs-type">id</span>)$x0
&lt;_TtGCs23_ContiguousArrayStoragePs9AnyObject__$ <span class="hljs-number">0x301eb6f80</span>&gt;(
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30393ac20</span>; value = <span class="hljs-number">0.500000</span>; text = <span class="hljs-number">0.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30393ac40</span>; value = <span class="hljs-number">1.000000</span>; text = <span class="hljs-number">1.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30393ac60</span>; value = <span class="hljs-number">1.250000</span>; text = <span class="hljs-number">1.25</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30393ac80</span>; value = <span class="hljs-number">1.500000</span>; text = <span class="hljs-number">1.5</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30393aca0</span>; value = <span class="hljs-number">2.000000</span>; text = <span class="hljs-number">2.0</span>&gt;,
&lt;BBPlayerPlayerRateModel: <span class="hljs-number">0x30393acc0</span>; value = <span class="hljs-number">3.000000</span>; text = <span class="hljs-number">3.0</span>&gt;
)
</code></pre>
<h2 data-id="heading-32">效果</h2>
<p>横屏全屏模式下，倍速菜单成功显示并支持 <code>3.0</code> 倍速播放。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2ceb5c3c82b4dfeb8fb8662bc22e2de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG91Y2hXb3JsZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448846&amp;x-signature=N%2FnL7W1IThU30EvbshD%2FD4ezMag%3D" alt="Screenshot 2025-12-15 at 10.07.00.png" loading="lazy"/></p>
<h2 data-id="heading-33">总结</h2>
<ul>
<li>横屏全屏场景下，播放倍速列表由 <code>BBPlayerPlaybackRateListWidget</code> 的 <code>rateArray</code> 生成，最终创建函数为 <strong><code>sub_10D82E870</code></strong>。</li>
<li>通过 <strong>越狱 Hook</strong> 或 <strong>非越狱 Mach-O Patch</strong>，即可稳定新增 <code>3.0x</code> 倍速。</li>
</ul>
<h2 data-id="heading-34">代码</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTouchFriend%2FBiliBiliMApp" target="_blank" title="https://github.com/TouchFriend/BiliBiliMApp" ref="nofollow noopener noreferrer">BiliBiliMApp-无广告版哔哩哔哩</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让代码学会“等外卖”：JavaScript异步编程趣谈]]></title>    <link>https://juejin.cn/post/7583912637471490099</link>    <guid>https://juejin.cn/post/7583912637471490099</guid>    <pubDate>2025-12-16T01:31:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912637471490099" data-draft-id="7583952017674059827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让代码学会“等外卖”：JavaScript异步编程趣谈"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-16T01:31:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JS_GGbond"/> <meta itemprop="url" content="https://juejin.cn/user/1377017277975032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让代码学会“等外卖”：JavaScript异步编程趣谈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1377017277975032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JS_GGbond
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:31:56.000Z" title="Tue Dec 16 2025 01:31:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>欢迎使用我的小程序👇👇👇👇</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d25c4001b1b4e6e902dc1f8863bcef2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSlNfR0dib25k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766453516&amp;x-signature=QM2w8%2BOCN1KL3r9utDLEnGcSBQs%3D" alt="small.png" loading="lazy"/></p>
<hr/>
<p>大家好！今天我们来聊聊JavaScript中一个既重要又有趣的话题——异步编程。如果你曾经遇到过网页“卡死”的情况，或者好奇为什么有些操作不会阻塞页面交互，那么这篇文章就是为你准备的！</p>
<h2 data-id="heading-0">同步 vs 异步：点外卖的智慧</h2>
<p>想象一下你要准备一顿晚餐：</p>
<p><strong>同步方式</strong>（不推荐）：</p>
<ol>
<li>走进厨房开始煮饭</li>
<li>站在灶台前盯着锅，什么都不做，直到饭煮好（20分钟）</li>
<li>饭好了才开始洗菜切菜</li>
<li>再花30分钟炒菜</li>
<li>总共耗时：50分钟</li>
</ol>
<p><strong>异步方式</strong>（聪明做法）：</p>
<ol>
<li>开始煮饭（设置定时器）</li>
<li>在饭煮的同时洗菜切菜</li>
<li>饭好了的提示音响起时处理饭</li>
<li>继续炒菜</li>
<li>总共耗时：35分钟</li>
</ol>
<p>JavaScript的异步编程就像是那个聪明的厨师，让多个任务可以同时进行！</p>
<h2 data-id="heading-1">回调函数：JavaScript的“电话通知”</h2>
<p>最早的异步处理方式是回调函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 点外卖的比喻：下单后留下电话号码，外卖到了打电话通知你</span>
<span class="hljs-title function_">orderFood</span>(<span class="hljs-string">'pizza'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`我的<span class="hljs-subst">${pizza}</span>到了！可以开动了！`</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'在等外卖的时候，我可以继续刷剧...'</span>);
</code></pre>
<p>但问题来了——如果你需要按顺序做多件事呢？</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// “回调地狱”出现了！</span>
<span class="hljs-title function_">orderFood</span>(<span class="hljs-string">'pizza'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">pizza</span>) {
    <span class="hljs-title function_">getDrink</span>(<span class="hljs-string">'cola'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">cola</span>) {
        <span class="hljs-title function_">buyNapkins</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">napkins</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`准备好享用<span class="hljs-subst">${pizza}</span>+<span class="hljs-subst">${cola}</span>了，还有<span class="hljs-subst">${napkins}</span>张餐巾纸`</span>);
            <span class="hljs-comment">// 更多嵌套...</span>
        });
    });
});
</code></pre>
<p>这就像是：等外卖→外卖到了买饮料→饮料到了买纸巾……效率太低了！</p>
<h2 data-id="heading-2">Promise：外卖订单追踪系统</h2>
<p>ES6带来了Promise，就像外卖平台的应用，可以追踪订单状态：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建一个Promise就像下一个外卖订单</span>
<span class="hljs-keyword">const</span> foodOrder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-comment">// 模拟烹饪时间</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> success = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.1</span>; <span class="hljs-comment">// 90%的成功率</span>
        success ? <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'香喷喷的披萨'</span>) : <span class="hljs-title function_">reject</span>(<span class="hljs-string">'抱歉，烤箱坏了'</span>);
    }, <span class="hljs-number">2000</span>);
});

<span class="hljs-comment">// 追踪订单状态</span>
foodOrder
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">food</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🎉 <span class="hljs-subst">${food}</span>送达！`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">'吃完了，该收拾了'</span>; <span class="hljs-comment">// 可以继续返回新的Promise</span>
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message);
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`😢 <span class="hljs-subst">${error}</span>`</span>);
    })
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'这次订餐体验结束了'</span>);
    });

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'订单已下，我可以继续工作...'</span>);
</code></pre>
<h2 data-id="heading-3">async/await：像写同步代码一样写异步</h2>
<p>ES7的async/await让异步代码看起来像同步代码一样直观：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">enjoyDinner</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始准备晚餐...'</span>);
        
        <span class="hljs-comment">// 看起来是同步的，但实际上是异步的！</span>
        <span class="hljs-keyword">const</span> pizza = <span class="hljs-keyword">await</span> <span class="hljs-title function_">orderPizza</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${pizza}</span>准备好了`</span>);
        
        <span class="hljs-keyword">const</span> drink = <span class="hljs-keyword">await</span> <span class="hljs-title function_">orderDrink</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${drink}</span>也到了`</span>);
        
        <span class="hljs-comment">// 这两个可以同时进行！</span>
        <span class="hljs-keyword">const</span> [napkins, movie] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
            <span class="hljs-title function_">buyNapkins</span>(),
            <span class="hljs-title function_">loadMovie</span>()
        ]);
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`完美！有<span class="hljs-subst">${pizza}</span>、<span class="hljs-subst">${drink}</span>、<span class="hljs-subst">${napkins}</span>和电影<span class="hljs-subst">${movie}</span>`</span>);
        
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`晚餐计划失败：<span class="hljs-subst">${error}</span>`</span>);
    }
}

<span class="hljs-comment">// 模拟的异步函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">orderPizza</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'🍕意大利香肠披萨'</span>), <span class="hljs-number">2000</span>);
    });
}
</code></pre>
<h2 data-id="heading-4">事件循环：JavaScript的“时间管理大师”</h2>
<p>JavaScript是单线程的，但它有一个神奇的事件循环机制：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. 开始做饭'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. 定时器到时间了（饭煮好了）'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. Promise微任务（尝一下味道）'</span>);
    });

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. 继续切菜'</span>);

<span class="hljs-comment">// 输出顺序：</span>
<span class="hljs-comment">// 1. 开始做饭</span>
<span class="hljs-comment">// 2. 继续切菜  </span>
<span class="hljs-comment">// 3. Promise微任务（尝一下味道）</span>
<span class="hljs-comment">// 4. 定时器到时间了（饭煮好了）</span>
</code></pre>
<p>简单来说：</p>
<ol>
<li>同步任务立即执行</li>
<li>微任务（Promise）在当前任务结束后立即执行</li>
<li>宏任务（setTimeout）在微任务之后执行</li>
</ol>
<h2 data-id="heading-5">实际应用：有趣的例子</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟一个加载进度指示器</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadContentWithProgress</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> tasks = [
        <span class="hljs-string">'加载用户数据'</span>,
        <span class="hljs-string">'获取朋友圈'</span>,
        <span class="hljs-string">'下载图片'</span>,
        <span class="hljs-string">'初始化聊天'</span>
    ];
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; tasks.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-comment">// 模拟每个任务的耗时</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> 
            <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span> + <span class="hljs-number">500</span>)
        );
        
        <span class="hljs-keyword">const</span> progress = ((i + <span class="hljs-number">1</span>) / tasks.<span class="hljs-property">length</span>) * <span class="hljs-number">100</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🔄 <span class="hljs-subst">${tasks[i]}</span>... 进度：<span class="hljs-subst">${progress.toFixed(<span class="hljs-number">0</span>)}</span>%`</span>);
    }
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 所有内容加载完成！'</span>);
}

<span class="hljs-comment">// 使用Promise.race实现超时控制</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchWithTimeout</span>(<span class="hljs-params">url, timeout = <span class="hljs-number">3000</span></span>) {
    <span class="hljs-keyword">const</span> fetchPromise = <span class="hljs-title function_">fetch</span>(url);
    <span class="hljs-keyword">const</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'请求超时'</span>)), timeout);
    });
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([fetchPromise, timeoutPromise]);
}
</code></pre>
<h2 data-id="heading-6">异步编程的黄金法则</h2>
<ol>
<li><strong>避免阻塞</strong>：长时间运行的任务要异步化</li>
<li><strong>错误处理</strong>：不要忘记.catch()或try-catch</li>
<li><strong>适度使用</strong>：不是所有东西都需要异步</li>
<li><strong>保持简单</strong>：能用async/await就不用复杂的Promise链</li>
</ol>
<h2 data-id="heading-7">总结</h2>
<p>JavaScript的异步编程就像生活中的多任务处理：我们不会等水烧开时傻站着，而是同时准备其他食材。从回调函数到Promise再到async/await，JavaScript为我们提供了越来越优雅的方式来处理异步操作。</p>
<p>记住，好的异步代码就像一场精心编排的交响乐——每个部分在正确的时间奏响，整体和谐而不混乱。</p>
<p>希望这篇文章让你对JavaScript异步编程有了更直观的理解！现在，试着把你的下一个耗时操作改成异步吧，让你的应用变得更加流畅！</p>
<p><strong>小挑战</strong>：你能用async/await写一个模拟“同时煮面、煎蛋、烤面包”的早餐制作程序吗？在评论区分享你的实现吧！🍳</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BlockLever实战营日志 #7 | 前端UI设计]]></title>    <link>https://juejin.cn/post/7583991680748306459</link>    <guid>https://juejin.cn/post/7583991680748306459</guid>    <pubDate>2025-12-16T01:16:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583991680748306459" data-draft-id="7583991680748290075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BlockLever实战营日志 #7 | 前端UI设计"/> <meta itemprop="keywords" content="AI编程,web3"/> <meta itemprop="datePublished" content="2025-12-16T01:16:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Keegan小钢"/> <meta itemprop="url" content="https://juejin.cn/user/1609340750665758"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BlockLever实战营日志 #7 | 前端UI设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1609340750665758/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Keegan小钢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:16:40.000Z" title="Tue Dec 16 2025 01:16:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是我们研发「<strong>BlockLever</strong>」的第 7 篇实战营研发日志。在前 6 篇中，我们已经完成了从需求、架构、合约开发到集成测试的完整链路：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495403%26idx%3D1%26sn%3D9d79878fd9bd5f4202ff30dfb290e58d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495403&amp;idx=1&amp;sn=9d79878fd9bd5f4202ff30dfb290e58d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #1 | 开营</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495408%26idx%3D1%26sn%3Df13a228d5387e1512da7d07a72741846%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495408&amp;idx=1&amp;sn=f13a228d5387e1512da7d07a72741846&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #2 | 产品需求梳理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495437%26idx%3D1%26sn%3Dd7c07cb65d8d09888038b2b8890647b3%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495437&amp;idx=1&amp;sn=d7c07cb65d8d09888038b2b8890647b3&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #3 | 合约开发阶段</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495442%26idx%3D1%26sn%3D451f5af91a5ecaeb57ea6835cdc01e22%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495442&amp;idx=1&amp;sn=451f5af91a5ecaeb57ea6835cdc01e22&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #4 | 完成第一个里程碑</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495450%26idx%3D1%26sn%3D4906e694c64f58fcb5e3f7b4cfe1cad5%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495450&amp;idx=1&amp;sn=4906e694c64f58fcb5e3f7b4cfe1cad5&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #5 | 重新梳理文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F_Nnd-bqt8KJFUt6CLZGLYw" target="_blank" title="https://mp.weixin.qq.com/s/_Nnd-bqt8KJFUt6CLZGLYw" ref="nofollow noopener noreferrer">BlockLever实战营日志 #6 | 集成测试</a></li>
</ul>
<p>而这一篇，是我自己也没想到会这么快完成的一步：<strong>前端 UI 设计。</strong></p>
<h2 data-id="heading-0">三个小时，20+ 张高保真 UI</h2>
<p>先说结果。</p>
<p>昨天，在实战营的实际推进过程中，我们只花了 <strong>3 个小时</strong>，就把 BlockLever 的前端 UI 设计基本做完了，一共生成了 <strong>20 多张高保真 UI 设计稿</strong>。</p>
<p>下面是其中一部分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ea2d6d65ad347c8b368bd2ca17c7a78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlZ2Fu5bCP6ZKi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452600&amp;x-signature=ElQw4%2BXZnJQ0HC91dxhoOSPvYXQ%3D" alt="UI-Mobile.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d38ea46221094f65a534dc8381c2178e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlZ2Fu5bCP6ZKi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452600&amp;x-signature=1cbXCnPhtRQ9Qrb%2F7DZy%2BbE7MyE%3D" alt="UI-Desktop.png" loading="lazy"/></p>
<p><strong>这些 UI，全都是 AI 生成的。</strong> 没有设计师参与，甚至连“先画线框图”这一步都没有。</p>
<p>说实话，当我第一次把这些页面一张张翻完的时候，心里是有点不真实的。不是那种“爽”，而是那种——<strong>“这是不是有点太顺了？”</strong></p>
<p>因为如果放在以前，这一步至少会拖上好几天。</p>
<h2 data-id="heading-1">一开始，我其实也不知道该用哪个 AI</h2>
<p>很多人可能会以为，我一开始就想好了用什么工具。但真实情况恰恰相反。</p>
<p>一开始，我连「前端 UI 这一步到底要不要单独做」都还在犹豫。</p>
<p>第一期实战营做 <strong>BlockETF</strong> 的时候，我其实是<strong>直接跳过 UI 设计的</strong>：</p>
<ul>
<li>合约写完</li>
<li>核心逻辑跑通</li>
<li>然后直接让 Claude Code 写前端代码</li>
<li>UI 是在实现过程中慢慢修的</li>
</ul>
<p>那套方式的问题也很明显：能用，但不精致，而且后期调整成本很高。</p>
<p>这次 BlockLever 复杂度更高，涉及杠杆、风险、仓位、清算提示，如果 UI 一开始就没想清楚，后面一定会反复推翻。</p>
<p>所以我决定：<strong>这次先把 UI 设计好。</strong></p>
<p>问题是——我当时真的不知道该用哪个 AI。</p>
<h2 data-id="heading-2">v0.dev 的第一次尝试</h2>
<p>我先问了 Claude Code，它给我推荐了几个工具，其中第一个就是 <strong>v0.dev</strong>。</p>
<p>我就顺手试了一下。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/645930492b204cd6b33d9dffaf672f90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlZ2Fu5bCP6ZKi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452600&amp;x-signature=echoDhv%2FfAFOmeZO6V2A20TGChk%3D" alt="v0.dev.png" loading="lazy"/></p>
<p>看完之后，我的第一反应其实挺直接的：</p>
<blockquote>
<p>这效果，好像跟我直接用 Claude Code 写前端差不多。</p>
</blockquote>
<p>不是说它不好，而是<strong>它并没有明显拉开差距</strong>。</p>
<p>当时我的判断逻辑也很简单：如果一个工具不能在效率或质量上带来明显提升，那它就不太可能成为我新的工作流核心。</p>
<p>所以 v0.dev 在我这一步，基本就被 pass 了。</p>
<h2 data-id="heading-3">偶然点进 Stitch</h2>
<p>我继续追问 Claude Code，它又提到了 <strong>Galileo AI</strong>。</p>
<p>我点进去之后，发现直接跳转到了 <strong>stitch.withgoogle.com</strong>，这才意识到 Galileo 已经被 Google 收购，整合进 Stitch 了。</p>
<p>再一看说明：<strong>现在还能免费用。</strong></p>
<p>说实话，这种时候不用一下，心理上都有点说不过去。</p>
<p>于是我就随手试了第一轮。</p>
<p>结果也就是从这一刻开始，我意识到：<strong>这次可能真的不一样了。</strong></p>
<h2 data-id="heading-4">真正起作用的，其实不是 Stitch</h2>
<p>但现在回头看，真正起作用的，其实并不是 Stitch 本身。</p>
<p>而是我并没有直接把「帮我设计一个 DeFi App」这种模糊指令丢给它。</p>
<p>我做的事情其实很“实战营式”：</p>
<ul>
<li>先让 <strong>Claude Code</strong> 把 BlockLever 的业务模型拆清楚</li>
<li>把用户是谁、关键操作、风险点一条条捋出来</li>
<li>再让它帮我写<strong>专门喂给 Stitch 的 Prompt</strong></li>
</ul>
<p>比如第一步，我只让 Stitch 干一件事：<strong>先定整体设计风格。</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">Design a modern DeFi trading application called "BlockLever".

Brand concept:
<span class="hljs-bullet">-</span> BlockLever helps everyday crypto investors amplify their returns safely
<span class="hljs-bullet">-</span> The core message is "Trade like spot, but with 2-3x gains"
<span class="hljs-bullet">-</span> Target users are crypto spot traders who want leverage without the complexity of futures

Visual style:
<span class="hljs-bullet">-</span> Dark theme as primary (dark navy or charcoal background)
<span class="hljs-bullet">-</span> Clean and minimal, inspired by apps like Phantom wallet and Uniswap
<span class="hljs-bullet">-</span> Professional but approachable, not intimidating
<span class="hljs-bullet">-</span> Use subtle gradients and glassmorphism effects for cards
<span class="hljs-bullet">-</span> Accent color: Electric blue (#3B82F6)
<span class="hljs-bullet">-</span> Success/profit: Green (#22C55E)
<span class="hljs-bullet">-</span> Loss/danger: Red (#EF4444)
<span class="hljs-bullet">-</span> Warning: Amber (#F59E0B)

Typography:
<span class="hljs-bullet">-</span> Modern sans-serif font (Inter or similar)
<span class="hljs-bullet">-</span> Clear hierarchy with bold headings
<span class="hljs-bullet">-</span> Numbers should be easy to read at a glance

Show me a style guide with:
<span class="hljs-bullet">1.</span> Color palette
<span class="hljs-bullet">2.</span> Sample buttons (primary, secondary, danger)
<span class="hljs-bullet">3.</span> Sample card component
<span class="hljs-bullet">4.</span> Sample input field
<span class="hljs-bullet">5.</span> Risk indicator badges (Safe, Warning, At Risk)
</code></pre>
<p>Stitch 生成了几套风格之后，我并没有立刻拍板，而是全部下载下来，再丢回给 Claude Code 评估。</p>
<p>哪套更符合 BlockLever？哪套在“风险表达”上不容易误导用户？</p>
<p>就这样来回几轮之后，风格才真正定下来。</p>
<h2 data-id="heading-5">两个 AI 来回拉扯，反而省了我时间</h2>
<p>后面的过程，其实就是重复这件事：</p>
<ul>
<li>Claude Code 负责「想清楚」</li>
<li>Stitch 负责「画出来」</li>
<li>再把结果丢回 Claude Code 做判断</li>
</ul>
<p>大部分页面，Stitch 一次就生成对了。不对的页面，主要是切换到桌面版的时候，需要做一些调整。</p>
<p>但整体效率，远远超出了我的预期。</p>
<p>等我回过神来，UI 已经有 20 多张了。</p>
<h2 data-id="heading-6">这件事对实战营来说，意义其实很大</h2>
<p>如果只看结果，好像只是“用 AI 画了 UI”。</p>
<p>但对我来说，这一步真正重要的地方在于：</p>
<blockquote>
<p><strong>它完整复现了实战营一直在做的一件事：把一个模糊的想法，一步步逼成一个可以落地的产品形态。</strong></p>
</blockquote>
<p>整个过程中，并没有什么“神操作”。</p>
<p>更多的是：</p>
<ul>
<li>不确定</li>
<li>尝试</li>
<li>判断</li>
<li>放弃一个选项</li>
<li>再继续往下走</li>
</ul>
<p>而 AI，只是被放在了一个<strong>非常合适的位置上</strong>。</p>
<h2 data-id="heading-7">写在最后</h2>
<p>当这些 UI 摆在我面前的时候，我突然有一种很清晰的感觉：</p>
<blockquote>
<p>BlockLever 不再只是一个协议，而是真的开始像一个产品了。</p>
</blockquote>
<p>接下来，我们就会进入前端实现阶段，把这些页面真正跑起来。</p>
<p>我也会继续用这种「实战营日志」的方式，把整个过程完整记录下来。</p>
<p>如果你正在关注 BlockLever，或者对“AI + 产品实战”这件事本身感兴趣，那接下来的几篇，会越来越具体、也越来越真实。</p>
<hr/>
<p>参考阅读：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495368%26idx%3D1%26sn%3D4634bab0e054169211f3ba8bb194029c%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495368&amp;idx=1&amp;sn=4634bab0e054169211f3ba8bb194029c&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">第二期 AI+Web3 实战营启动：从 BlockETF 到 BlockLever</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495403%26idx%3D1%26sn%3D9d79878fd9bd5f4202ff30dfb290e58d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495403&amp;idx=1&amp;sn=9d79878fd9bd5f4202ff30dfb290e58d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #1 | 开营</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495408%26idx%3D1%26sn%3Df13a228d5387e1512da7d07a72741846%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495408&amp;idx=1&amp;sn=f13a228d5387e1512da7d07a72741846&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">BlockLever实战营日志 #2 | 产品需求梳理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495413%26idx%3D1%26sn%3D0cdfe0cfc90d3daad0704f57654d1b6d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495413&amp;idx=1&amp;sn=0cdfe0cfc90d3daad0704f57654d1b6d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Web2 不再安全感：技术人如何踏入 AI + Web3 的新时代</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495418%26idx%3D1%26sn%3D52bce10b7461b5b2b41cdbcb46cb9663%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495418&amp;idx=1&amp;sn=52bce10b7461b5b2b41cdbcb46cb9663&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI + Web3 实战营价值分析</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA5OTI1NDE0Mw%3D%3D%26mid%3D2652495424%26idx%3D1%26sn%3Db6ff0f2cc634faa5a4cc613c616b966b%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA5OTI1NDE0Mw==&amp;mid=2652495424&amp;idx=1&amp;sn=b6ff0f2cc634faa5a4cc613c616b966b&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">从入门到实战：我的全套 Web3 学习路径（2025版）</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何让AI的数据标注“火眼金睛”？人机协同才是可靠途径]]></title>    <link>https://juejin.cn/post/7583921477614043171</link>    <guid>https://juejin.cn/post/7583921477614043171</guid>    <pubDate>2025-12-16T01:51:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477614043171" data-draft-id="7583903159775248399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何让AI的数据标注“火眼金睛”？人机协同才是可靠途径"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-12-16T01:51:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何让AI的数据标注“火眼金睛”？人机协同才是可靠途径
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:51:47.000Z" title="Tue Dec 16 2025 01:51:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>二十年前，要是有人说想买个机器人帮忙做家务，听起来简直像天方夜谭。然而，如今我们正处在人工智能蓬勃发展的时代，机器人已经在类似场景中进行测试了。</p>
<p>推动这一进展的关键人工智能领域是<strong>计算机视觉</strong>，它让机器能够理解图像和视频。换句话说，像YOLO11和即将推出的YOLO26这样的计算机视觉模型，可以通过包含视觉数据和标注的数据集进行训练。</p>
<p>这些标注帮助模型理解视觉数据。例如，目标检测数据集使用<strong>边界框</strong>在感兴趣的目标周围绘制矩形框。这使得模型能够在新的图像中检测并定位这些目标，即使场景杂乱或目标被部分遮挡也没问题。</p>
<p>其他计算机视觉任务则依赖于不同类型的标注。<strong>分割数据集</strong>在像素级别精确标记出目标的轮廓，而<strong>关键点数据集</strong>则会标出特定的标志点，比如人体关节。</p>
<p>然而，无论采用哪种格式，一个关键因素始终是<strong>标注的质量和一致性</strong>。模型直接从用于训练的数据中学习，因此，如果标注不一致或有错误，模型通常也会在预测中继承这些错误。</p>
<p>即使在自动化的今天，<strong>人工标注的数据集</strong>仍然至关重要，尤其是在像医疗影像这样的高风险领域。微小的标注错误，比如不精确的肿瘤边界或遗漏的异常，都可能教会模型错误的模式，导致后续做出不安全的预测。人类专家提供了这些应用所需的精确真实标注和判断力。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a0bada7cce34a26983c533494dfa0b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=HebNUC3tVk39eRC3jzcyVP4jawE%3D" alt="screenshot_2025-12-15_14-19-03.png" loading="lazy"/></p>
<p>在本文中，我们将深入探讨，即使在人工智能不断进步的今天，为什么人工标注数据仍然不可或缺。</p>
<h2 data-id="heading-0"><strong>图像与视频标注的必要性</strong></h2>
<p>计算机视觉模型的学习方式与我们人类相似，通过观察大量示例进行学习。不同之处在于，它们是通过预先由人类标注的大型图像和视频数据集进行训练的。这些标注作为真实标准，教会模型诸如“这是行人”、“这是肿瘤的边界”或“那个物体是汽车”等概念。</p>
<p>现实世界的视觉信息很少是干净或一致的。光线变化会使同一物体看起来不同。人和车辆可能重叠或被部分遮挡。背景可能杂乱且分散注意力。当数据集包含了针对这些情况精心制作、保持一致的标注时，模型就能为在受控环境之外将遇到的挑战做好更充分的准备。</p>
<p>数据标注不仅仅是画框或描边。它涉及应用标注规范、做出实际判断，例如什么算作目标、边界应该划在哪里，以及在情况不明时如何处理。这种人类的判断力确保了数据的准确性和可用性。</p>
<p>归根结底，一个计算机视觉系统的表现，取决于它所学习的标注数据的质量。在像扫描图像中识别癌症或为自动驾驶汽车检测道路危险等高影响应用中，来自熟练标注员的精确标注，对于提高准确性和安全性具有实际意义。</p>
<h2 data-id="heading-1"><strong>数据标注自动化的兴起</strong></h2>
<p>随着计算机视觉应用规模的扩大和数据集的增长，自动化已成为加速标注的常用手段。团队不再手工标注所有内容，而是使用人工智能模型来生成标注的初稿。</p>
<p>随后，由人工审查结果、修正错误，并处理模型无法以高置信度标注的情况。这种方法在保持高质量的同时，加快了标注速度。</p>
<p>以下是自动化通常帮助数据标注的几种方式：</p>
<ul>
<li><strong>自动分割：</strong> 模型可以自动建议目标轮廓或像素级掩码，减少标注员需要手动勾勒的工作量。</li>
<li><strong>光流跟踪：</strong> 对于视频，跟踪方法可以跨帧追踪运动物体，并将其标签向前传递，有助于保持标注在时间上的一致性。</li>
<li><strong>帧插值：</strong> 工具可以利用运动和跟踪线索，为两个已标注帧之间的帧填充标注，这样标注员就不必标注每一帧。</li>
<li><strong>主动学习：</strong> 训练流程可以识别出模型认为不确定或特殊的样本，并优先提交给人类处理，从而使人工精力集中在最能提升模型性能的数据上。</li>
</ul>
<h2 data-id="heading-2"><strong>为何人工数据标注依然至关重要？</strong></h2>
<p>尽管自动化可以加快标注速度，但人工智能模型仍然需要人类的判断力来保持准确和可靠。</p>
<p>以下是一些人类专业知识在数据标注中发挥关键作用的领域：</p>
<ul>
<li><strong>理解上下文：</strong> 真实的图像和视频通常很杂乱。阴影、反射、运动模糊和物体重叠都可能干扰自动化工具。人类标注员能够解释实际发生的情况，从而使标注更准确。</li>
<li><strong>保持标注一致性：</strong> 随着数据集的扩大，自动生成的标注可能会出现漂移或在批次间产生差异。人类可以审核、修正和对齐标注，确保数据集从头到尾保持一致。</li>
<li><strong>减少偏见和危害：</strong> 人类更擅长识别敏感内容、文化细微差别以及可能引入偏见的模式。他们的监督有助于使数据集更公平，避免 unintended 伤害。</li>
<li><strong>应用领域专业知识：</strong> 某些任务需要领域知识，例如识别医疗异常或工业缺陷。专家可以提供精确的标注并解决模糊不清的情况，确保模型学到正确的细节。</li>
</ul>
<h2 data-id="heading-3"><strong>人机协作标注概览</strong></h2>
<p>许多标注工具和平台，通过集成自动化来加速标注，通常利用如 Segment Anything Model 3（SAM3）等基础模型。</p>
<p>它可以根据简单的提示（如点击、边界框或简短的文本短语），在图像和视频中检测、分割和跟踪物体，为匹配的物体生成分割掩码，而无需为每个新类别进行特定任务的训练。</p>
<p>即使采用了这些前沿方法，仍然需要人类专家来审查和最终确定标注。当自动化工具生成初稿，然后由人工进行验证、修正和细化时，这种工作流程被称为人机协作标注。这使得标注速度得以加快，同时确保最终标注足够准确和一致，可用于训练可靠的模型。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/238ed8f4297c43bd8ab8aa74ce928743~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=wfaFlYTFYo0qi7A7Ga8oHQd7xYc%3D" alt="screenshot_2025-12-15_14-19-39.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>自动化标注何时有效，何时无效？</strong></h2>
<p>自动化标注最适合来自受控环境的数据。在工厂、仓库或零售货架等场所收集的图像，通常光线稳定、物体视角清晰，因此自动化工具可以准确标注它们，帮助团队以更少的人工工作更快地扩大规模。</p>
<p>来自非受控环境的数据则更为复杂。室外视频会随时间和天气变化，来自街道或家庭的场景通常包含杂乱、运动模糊、物体相互遮挡和大量重叠。小物体、精细边界或罕见情况更增加了出错的可能性。在干净的室内数据上表现良好的模型，在处理混乱的现实世界视觉信息时可能仍然会力不从心。</p>
<p>这就是为什么人类介入仍然重要。当模型不确定时，人类可以介入；他们能解读棘手的上下文，并在错误进入最终数据集之前予以修正。人机协作标注有助于使自动化立足于现实世界条件，并确保模型在部署后保持可靠。</p>
<h2 data-id="heading-5"><strong>人机协作标注在哪些领域能发挥重要作用？</strong></h2>
<p>既然我们已经了解了自动化标注的适用场景和局限，接下来让我们探讨几个人机协作标注扮演重要角色的应用领域。</p>
<ul>
<li><strong>制造业缺陷检测</strong></li>
</ul>
<p>想象一下工厂的传送带，每分钟有数百个零件从摄像头下经过。大多数缺陷是明显的，但偶尔会出现一个以奇怪角度出现或在灯光反射下的细微裂纹。自动化系统可能会忽略它，或将其标记为无害的表面纹理，但人工审核员可以发现这个缺陷，修正标注，并确保模型学会区分。</p>
<p>这就是人机协作标注在工业检测中的角色。自动化可以预标注常见缺陷类型，并快速处理大量图像，但仍然需要人工来验证结果、收紧边界，并处理那些在训练中不常见的罕见故障情况。</p>
<ul>
<li><strong>自动驾驶与智能交通</strong></li>
</ul>
<p>同样，自动驾驶汽车使用计算机视觉来识别行人、读取标志和导航交通，但真实道路是不可预测的。例如，夜间从停放的车辆后面走出的行人，可能部分被遮挡，在强光下也难以看清。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5228873566b41feac47eec9f9a81f73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=hO2xbHa74d3%2FHTHumUC1JkkyIao%3D" alt="screenshot_2025-12-15_14-19-50.png" loading="lazy"/></p>
<p>人类标注员可以在训练阶段标注这些罕见但安全攸关的边缘情况，使模型学会正确的应对方式，而不仅仅是在正常条件下。对于教会系统处理那些难以用自动化单独捕捉的低频事件，这一人机协作步骤至关重要。</p>
<h2 data-id="heading-6"><strong>人工标注数据集的未来之路</strong></h2>
<p>随着技术进步，人机协作标注正变得更加协同。有趣的是，视觉语言模型 现在正被用于生成标注初稿，并根据简单提示建议修正。</p>
<p>因此，标注员无需手动扫描每张图像来决定标注什么，而是可以用诸如“标注所有行人、汽车和交通灯”或“分割这个零件上的所有缺陷”这样的短语来提示VLM，并获得一组待审阅的标注草稿。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5127bc6a107b4b2c9c66af1167fa2533~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=kH5oIwQeiTlL3HGVL3lE6nlity4%3D" alt="screenshot_2025-12-15_14-19-58.png" loading="lazy"/></p>
<p>这减少了标注时间，因为模型可以预先处理许多简单直接的情况，使人类能够专注于审查结果、修正棘手案例，并保持数据集的一致性。大型多模态模型也开始引导标注员关注最不确定的样本，使人工工作更具针对性，并提高整体数据集质量。</p>
<p>值得一提的是，高效的人机协作和数据管理离不开专业的平台支持。<strong>Coovally</strong>作为国际领先的人工智能开源算法平台，不仅提供强大的算法库，其内置的数据管理工具和自动化标注辅助功能，正可以帮助团队轻松实现上述高效协同的标注流程。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64fcac30fb744dd78279e94e549b5106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=2thLRQnJ3HmatN5Rh%2B54lg%2Bxrrc%3D" alt="IMG_3565.GIF" loading="lazy"/></p>
<p>从数据上传、版本管理、智能预标注到团队协作审核，Coovally 提供了一站式解决方案，助力开发者更快地构建和迭代高质量的计算机视觉模型。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10ca8973ac0040a08eecd4792e15e0f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=q7%2FKHRJpHL8QiqLd0gOYiAConZA%3D" alt="IMG_3566.GIF" loading="lazy"/></p>
<p>Coovally平台不仅提供模型资源，还可以帮助你提供<strong>AI解决方案</strong>，可以扫描二维码，我们来给你提供解决方案！！</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/652536f82de344819e4d750438a5fc6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454707&amp;x-signature=peGdRA17vfJJJMRiCp5Sh60eEQQ%3D" alt="小助手二维码.png" loading="lazy"/></p>
<p>点击<strong>阅读原文</strong>，即可体验Coovally平台！</p>
<h2 data-id="heading-7"><strong>总结</strong></h2>
<p>计算机视觉帮助机器解读并响应其所见，但当它与人机协作时，才能发挥最佳效果。人工标注数据使模型立足于现实世界条件，并提高了其性能的可靠性。通过自动化与人类判断力协同工作，团队可以构建出有影响力的视觉系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cloudflare 🌏 中国大陆网络访问优化 - ０元成本]]></title>    <link>https://juejin.cn/post/7583933107689570367</link>    <guid>https://juejin.cn/post/7583933107689570367</guid>    <pubDate>2025-12-16T01:21:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583933107689570367" data-draft-id="7583910637958840339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cloudflare 🌏 中国大陆网络访问优化 - ０元成本"/> <meta itemprop="keywords" content="设计模式,React.js,人工智能"/> <meta itemprop="datePublished" content="2025-12-16T01:21:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="七月丶"/> <meta itemprop="url" content="https://juejin.cn/user/3685218705751325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cloudflare 🌏 中国大陆网络访问优化 - ０元成本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3685218705751325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    七月丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:21:51.000Z" title="Tue Dec 16 2025 01:21:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>版本</strong>: 2.0<br/>
<strong>最后更新</strong>: 2025-12-15<br/>
<strong>状态</strong>: ✅ 已实战验证可用<br/>
<strong>架构</strong>: Oracle Cloud (Japan) + Nginx 反向代理 + Cloudflare Workers (SNI Proxy)</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. 背景与目标</h2>
<h3 data-id="heading-1">问题描述</h3>
<p>Cloudflare 的免费版 CDN 节点在针对中国大陆访问时，通常会绕路美国西海岸或欧洲，导致：</p>
<ul>
<li>高延迟（200ms+）</li>
<li>连接不稳定</li>
<li>易丢包</li>
</ul>
<h3 data-id="heading-2">解决方案</h3>
<p>利用地理位置靠近中国大陆、且国际出口带宽较好的 <strong>Oracle Cloud Japan (甲骨文日本)</strong> 服务器作为"中转跳板"，通过 Nginx 反向代理将流量转发至 <strong>Cloudflare Workers</strong>，从而实现更快的访问速度。</p>
<h3 data-id="heading-3">流量对比</h3>
<p><strong>优化前 (常规模式)</strong>:</p>
<pre><code class="hljs language-rust" lang="rust">用户 (大陆) 🐢 -<span class="hljs-punctuation">-&gt;</span> 太平洋海底光缆 -<span class="hljs-punctuation">-&gt;</span> <span class="hljs-title function_ invoke__">Cloudflare</span> (美国) -<span class="hljs-punctuation">-&gt;</span> Workers
延迟高，易丢包，体验差
</code></pre>
<p><strong>优化后 (本方案)</strong>:</p>
<pre><code class="hljs language-rust" lang="rust">用户 (大陆) 🚀 -<span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">50</span>-<span class="hljs-number">100</span>ms -<span class="hljs-punctuation">-&gt;</span> Oracle <span class="hljs-title function_ invoke__">VPS</span> (日本) ⚡️ -<span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">5</span>ms -<span class="hljs-punctuation">-&gt;</span> <span class="hljs-title function_ invoke__">Cloudflare</span> (日本边缘) -<span class="hljs-punctuation">-&gt;</span> Workers
利用 VPS 的优质线路中转，大幅降低物理延迟
</code></pre>
<hr/>
<h2 data-id="heading-4">2. 整体架构</h2>
<h3 data-id="heading-5">2.1 架构图</h3>
<pre><code class="hljs language-javascript" lang="javascript">用户
 └─ star.<span class="hljs-property">divinations</span>.<span class="hljs-property">top</span>        （灰云 <span class="hljs-variable constant_">DNS</span> only → <span class="hljs-variable constant_">VPS</span>）
     └─ <span class="hljs-title class_">Nginx</span> 反向代理（<span class="hljs-variable constant_">SNI</span> <span class="hljs-title class_">Proxy</span>）
         └─ star-origin.<span class="hljs-property">divinations</span>.<span class="hljs-property">top</span>      （橙云 → <span class="hljs-title class_">Cloudflare</span> <span class="hljs-title class_">Worker</span> / <span class="hljs-title class_">Web</span>）

用户
 └─ star-api.<span class="hljs-property">divinations</span>.<span class="hljs-property">top</span>    （灰云 <span class="hljs-variable constant_">DNS</span> only → <span class="hljs-variable constant_">VPS</span>）
     └─ <span class="hljs-title class_">Nginx</span> 反向代理（<span class="hljs-variable constant_">SNI</span> <span class="hljs-title class_">Proxy</span>）
         └─ star-api-origin.<span class="hljs-property">divinations</span>.<span class="hljs-property">top</span>  （橙云 → <span class="hljs-title class_">Cloudflare</span> <span class="hljs-title class_">Worker</span> / <span class="hljs-variable constant_">API</span>）
</code></pre>
<h3 data-id="heading-6">2.2 🔒 架构铁律（必须遵守）</h3>





























<table><thead><tr><th>规则</th><th>说明</th></tr></thead><tbody><tr><td>✅ 入口域名永远是 <strong>DNS only（灰云）</strong></td><td>star / star-api 必须灰云，用户直连 VPS</td></tr><tr><td>✅ origin 域名永远是 <strong>Proxied（橙云）</strong></td><td>仅供 Nginx 后端使用，用户不可直接访问</td></tr><tr><td>❌ 用户请求永远不能被重定向到 origin 域名</td><td>否则触发 Cloudflare Error 1000</td></tr><tr><td>❌ 禁止入口域名开启橙云</td><td>否则直接 1000 错误</td></tr><tr><td>❌ 禁止 <code>star → CNAME → star-origin</code></td><td>Cloudflare 会判定为非法代理</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">3. 准备工作</h2>
<h3 data-id="heading-8">3.1 服务器要求</h3>

























<table><thead><tr><th>项目</th><th>要求</th></tr></thead><tbody><tr><td>云服务商</td><td>Oracle Cloud (日本/韩国/香港等亚太节点)</td></tr><tr><td>操作系统</td><td>Ubuntu 20.04/22.04 LTS</td></tr><tr><td>端口</td><td>80, 443 必须开放</td></tr><tr><td>网络</td><td>确保服务器能正常访问 Cloudflare (1.1.1.1)</td></tr></tbody></table>
<h3 data-id="heading-9">3.2 域名规划</h3>






























<table><thead><tr><th>域名</th><th>用途</th><th>代理状态</th></tr></thead><tbody><tr><td><code>star.divinations.top</code></td><td>Web 主站入口</td><td>DNS only (灰云)</td></tr><tr><td><code>star-api.divinations.top</code></td><td>API 入口</td><td>DNS only (灰云)</td></tr><tr><td><code>star-origin.divinations.top</code></td><td>Web Workers 源站</td><td>Proxied (橙云)</td></tr><tr><td><code>star-api-origin.divinations.top</code></td><td>API Workers 源站</td><td>Proxied (橙云)</td></tr></tbody></table>
<h3 data-id="heading-10">3.3 软件依赖</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 更新系统</span>
sudo apt update &amp;&amp; sudo apt upgrade -y

<span class="hljs-comment"># 安装必要软件</span>
sudo apt install -y nginx certbot python3-certbot-nginx curl dnsutils
</code></pre>
<hr/>
<h2 data-id="heading-11">4. 详细实施步骤</h2>
<h3 data-id="heading-12">第一步：Cloudflare DNS 设置 ⭐ 关键</h3>
<p>在 Cloudflare 后台 DNS 设置中，<strong>必须严格区分"直连"和"代理"状态</strong>。</p>








































<table><thead><tr><th>域名</th><th>类型</th><th>指向目标</th><th>代理状态</th><th>说明</th></tr></thead><tbody><tr><td><code>star</code></td><td>A</td><td><strong>Oracle 服务器 IP</strong></td><td><strong>DNS only (灰色云)</strong> ☁️</td><td><strong>关键</strong>：必须关闭 CF 代理</td></tr><tr><td><code>star-api</code></td><td>A</td><td><strong>Oracle 服务器 IP</strong></td><td><strong>DNS only (灰色云)</strong> ☁️</td><td>同上</td></tr><tr><td><code>star-origin</code></td><td>CNAME</td><td><code>*.workers.dev</code></td><td><strong>Proxied (橙色云)</strong> 🟠</td><td>Workers 必须开启代理</td></tr><tr><td><code>star-api-origin</code></td><td>CNAME</td><td><code>*.workers.dev</code></td><td><strong>Proxied (橙色云)</strong> 🟠</td><td>同上</td></tr></tbody></table>
<p><strong>⚠️ 注意事项</strong>：</p>
<ul>
<li>入口域名（star / star-api）<strong>禁止开启橙云</strong></li>
<li><strong>禁止</strong>设置 <code>star → CNAME → star-origin</code></li>
<li>如存在 <code>AAAA star</code> IPv6 记录，需确认 IPv6 可用，否则删除</li>
</ul>
<p><strong>验证 DNS 设置</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 验证入口域名指向 VPS IP</span>
dig +short star.divinations.top @1.1.1.1
<span class="hljs-comment"># 应该返回你的 VPS IP 地址</span>

<span class="hljs-comment"># 验证 origin 域名指向 Cloudflare</span>
dig +short star-origin.divinations.top @1.1.1.1
<span class="hljs-comment"># 应该返回 Cloudflare 的 IP 地址</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">第二步：服务器防火墙设置</h3>
<p>在申请证书和部署 Nginx 前，<strong>必须确保端口开放</strong>。</p>
<h4 data-id="heading-14">2.1 Oracle 云控制台 (网页端)</h4>
<ol>
<li>登录 Oracle Cloud Console</li>
<li>进入 <code>Networking</code> → <code>Virtual Cloud Networks</code> → 选择你的 VCN</li>
<li>点击 <code>Security Lists</code> → 选择默认安全列表</li>
<li>添加入站规则 (Ingress Rules)：</li>
</ol>























<table><thead><tr><th>源 CIDR</th><th>协议</th><th>目标端口</th><th>说明</th></tr></thead><tbody><tr><td>0.0.0.0/0</td><td>TCP</td><td>80</td><td>HTTP</td></tr><tr><td>0.0.0.0/0</td><td>TCP</td><td>443</td><td>HTTPS</td></tr></tbody></table>
<h4 data-id="heading-15">2.2 服务器内部防火墙 (SSH)</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：如果使用 UFW</span>
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload
sudo ufw status

<span class="hljs-comment"># 方式二：如果使用 iptables (Oracle Ubuntu 默认)</span>
<span class="hljs-comment"># 查看当前规则</span>
sudo iptables -L -n

<span class="hljs-comment"># 添加规则</span>
sudo iptables -I INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -I INPUT -p tcp --dport 443 -j ACCEPT

<span class="hljs-comment"># 持久化规则</span>
sudo apt install iptables-persistent
sudo netfilter-persistent save

<span class="hljs-comment"># 或者直接清空所有规则（简单粗暴，仅测试用）</span>
<span class="hljs-comment"># sudo iptables -F</span>
</code></pre>
<p><strong>验证端口开放</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地测试</span>
nc -zv localhost 80
nc -zv localhost 443

<span class="hljs-comment"># 外部测试（从另一台机器）</span>
nc -zv &lt;VPS_IP&gt; 80
nc -zv &lt;VPS_IP&gt; 443
</code></pre>
<hr/>
<h3 data-id="heading-16">第三步：申请 SSL 证书</h3>
<p>由于入口域名设置为"DNS only (灰云)"，浏览器会直接校验 Oracle 服务器上的证书，<strong>必须使用受信任的证书</strong>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 确保 Nginx 已启动（Certbot 需要验证）</span>
sudo systemctl start nginx

<span class="hljs-comment"># 2. 申请证书 - Web 站</span>
sudo certbot --nginx -d star.divinations.top

<span class="hljs-comment"># 3. 申请证书 - API 站（单独证书，避免 SAN 问题）</span>
sudo certbot --nginx -d star-api.divinations.top

<span class="hljs-comment"># 4. 验证证书</span>
sudo certbot certificates
</code></pre>
<p><strong>⚠️ 证书申请前检查清单</strong>：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Cloudflare DNS 已设置为灰云</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 防火墙 80/443 端口已开放</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Nginx 已启动且 80 端口可访问</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 域名已正确解析到 VPS IP</li>
</ul>
<p><strong>证书续期测试</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">sudo certbot renew --dry-run
</code></pre>
<hr/>
<h3 data-id="heading-17">第四步：Nginx 配置 ⭐ 核心</h3>
<h4 data-id="heading-18">4.1 Web 入口配置</h4>
<p><strong>文件路径</strong>: <code>/etc/nginx/sites-available/star.divinations.top</code></p>
<pre><code class="hljs language-nginx" lang="nginx"># HTTP 强制跳转 HTTPS
server {
    listen 80;
    listen [::]:80;
    server_name star.divinations.top;
    return 301 https://$host$request_uri;
}

# HTTPS 主配置
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name star.divinations.top;

    # SSL 证书（Certbot 自动配置）
    ssl_certificate /etc/letsencrypt/live/star.divinations.top/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/star.divinations.top/privkey.pem;
    
    # SSL 优化设置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    location / {
        # ⭐ 关键：动态 DNS 解析（必须配置）
        resolver 1.1.1.1 8.8.8.8 valid=300s ipv6=off;
        resolver_timeout 5s;

        # 调试 Header（可选，生产环境可删除）
        add_header X-Star-Proxy "vps-nginx" always;

        # 转发目标：指向 Workers 的源域名
        proxy_pass https://star-origin.divinations.top;

        # ⭐ 核心：SNI 设置（必须开启，否则 CF 握手失败）
        proxy_ssl_server_name on;
        proxy_ssl_name star-origin.divinations.top;
        
        # 传递 Host 头
        proxy_set_header Host star-origin.divinations.top;

        # 传递用户真实 IP
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;

        # 超时设置
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;

        # 长连接优化
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }
}
</code></pre>
<h4 data-id="heading-19">4.2 API 入口配置</h4>
<p><strong>文件路径</strong>: <code>/etc/nginx/sites-available/star-api.divinations.top</code></p>
<pre><code class="hljs language-nginx" lang="nginx"># HTTP 强制跳转 HTTPS
server {
    listen 80;
    listen [::]:80;
    server_name star-api.divinations.top;
    return 301 https://$host$request_uri;
}

# HTTPS 主配置
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name star-api.divinations.top;

    # SSL 证书
    ssl_certificate /etc/letsencrypt/live/star-api.divinations.top/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/star-api.divinations.top/privkey.pem;
    
    # SSL 优化设置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    location / {
        # ⭐ 关键：动态 DNS 解析
        resolver 1.1.1.1 8.8.8.8 valid=300s ipv6=off;
        resolver_timeout 5s;

        # 调试 Header
        add_header X-Star-Proxy "vps-nginx-api" always;

        # 转发目标
        proxy_pass https://star-api-origin.divinations.top;

        # ⭐ 核心：SNI 设置
        proxy_ssl_server_name on;
        proxy_ssl_name star-api-origin.divinations.top;
        
        # 传递 Host 头
        proxy_set_header Host star-api-origin.divinations.top;

        # 传递用户真实 IP
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;

        # 超时设置
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;

        # 长连接优化
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }
}
</code></pre>
<h4 data-id="heading-20">4.3 启用配置</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建软链接</span>
sudo <span class="hljs-built_in">ln</span> -sf /etc/nginx/sites-available/star.divinations.top /etc/nginx/sites-enabled/
sudo <span class="hljs-built_in">ln</span> -sf /etc/nginx/sites-available/star-api.divinations.top /etc/nginx/sites-enabled/

<span class="hljs-comment"># 删除默认配置（可选）</span>
sudo <span class="hljs-built_in">rm</span> -f /etc/nginx/sites-enabled/default

<span class="hljs-comment"># 检查语法</span>
sudo nginx -t

<span class="hljs-comment"># 重新加载配置</span>
sudo systemctl reload nginx
</code></pre>
<h4 data-id="heading-21">4.4 🚫 Nginx 配置禁止事项</h4>

























<table><thead><tr><th>禁止项</th><th>原因</th></tr></thead><tbody><tr><td><code>proxy_set_header CF-Connecting-IP ...</code></td><td>伪造 CF 专用 Header 会触发 403</td></tr><tr><td>入口域名 301/302 到 origin</td><td>会触发 Error 1000</td></tr><tr><td>WebSocket Header 无条件开启</td><td>普通 HTTP 被强制 upgrade 会出错</td></tr><tr><td>proxy_pass 不配 resolver</td><td>DNS 只解析一次，后续可能失效</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-22">第五步：Cloudflare Worker 配置</h3>
<h4 data-id="heading-23">5.1 Worker 使用规范</h4>
<ul>
<li>Worker 只负责业务逻辑</li>
<li><strong>不依赖</strong> <code>CF-Connecting-IP</code>（该 Header 由 Cloudflare 自动注入，VPS 无法伪造）</li>
<li>使用 <code>X-Forwarded-For</code> / <code>X-Real-IP</code> 获取真实用户 IP</li>
<li>如需防止直连 origin，可校验 Nginx 注入的自定义 Header</li>
</ul>
<h4 data-id="heading-24">5.2 Worker 获取真实 IP 示例</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 Worker 中获取真实用户 IP</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getClientIP</span>(<span class="hljs-params">request: Request</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-comment">// 优先使用 Nginx 传递的 Header</span>
  <span class="hljs-keyword">const</span> xRealIP = request.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'X-Real-IP'</span>);
  <span class="hljs-keyword">if</span> (xRealIP) <span class="hljs-keyword">return</span> xRealIP;
  
  <span class="hljs-keyword">const</span> xForwardedFor = request.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'X-Forwarded-For'</span>);
  <span class="hljs-keyword">if</span> (xForwardedFor) {
    <span class="hljs-keyword">return</span> xForwardedFor.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">trim</span>();
  }
  
  <span class="hljs-comment">// 最后使用 Cloudflare 的 Header（直连 Workers 时有效）</span>
  <span class="hljs-keyword">return</span> request.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'CF-Connecting-IP'</span>) || <span class="hljs-string">'unknown'</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-25">5. 验证与测试</h2>
<h3 data-id="heading-26">5.1 DNS 验证</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 验证入口域名</span>
dig +short star.divinations.top @1.1.1.1
<span class="hljs-comment"># 应返回 VPS IP</span>

<span class="hljs-comment"># 验证 origin 域名</span>
dig +short star-origin.divinations.top @1.1.1.1
<span class="hljs-comment"># 应返回 Cloudflare IP</span>
</code></pre>
<h3 data-id="heading-27">5.2 HTTP 验证</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试 Web 入口</span>
curl -I https://star.divinations.top

<span class="hljs-comment"># 测试 API 入口</span>
curl -I https://star-api.divinations.top

<span class="hljs-comment"># 测试 origin（仅测试用）</span>
curl -I https://star-origin.divinations.top
</code></pre>
<h3 data-id="heading-28">5.3 预期响应</h3>
<p>正常情况下应该看到：</p>
<ul>
<li>HTTP/2 200</li>
<li>响应头包含 <code>X-Star-Proxy: vps-nginx</code></li>
<li>无 403/502/521/522/1000 错误</li>
</ul>
<h3 data-id="heading-29">5.4 延迟测试</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 从大陆服务器测试</span>
curl -w <span class="hljs-string">"@-"</span> -o /dev/null -s https://star.divinations.top &lt;&lt;<span class="hljs-string">'EOF'</span>
    time_namelookup:  %{time_namelookup}s\n
       time_connect:  %{time_connect}s\n
    time_appconnect:  %{time_appconnect}s\n
   time_pretransfer:  %{time_pretransfer}s\n
      time_redirect:  %{time_redirect}s\n
 time_starttransfer:  %{time_starttransfer}s\n
                    ----------\n
         time_total:  %{time_total}s\n
EOF
</code></pre>
<hr/>
<h2 data-id="heading-30">6. 维护指南</h2>
<h3 data-id="heading-31">6.1 证书续期</h3>
<p>Certbot 会自动添加定时任务，但建议定期检查：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试续期</span>
sudo certbot renew --dry-run

<span class="hljs-comment"># 查看定时任务</span>
sudo systemctl list-timers | grep certbot

<span class="hljs-comment"># 手动续期（如需要）</span>
sudo certbot renew
</code></pre>
<h3 data-id="heading-32">6.2 Nginx 日志</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看访问日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/access.log

<span class="hljs-comment"># 查看错误日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/error.log
</code></pre>
<h3 data-id="heading-33">6.3 Nginx 管理命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查配置语法</span>
sudo nginx -t

<span class="hljs-comment"># 重新加载配置（不中断服务）</span>
sudo systemctl reload nginx

<span class="hljs-comment"># 重启 Nginx</span>
sudo systemctl restart nginx

<span class="hljs-comment"># 查看状态</span>
sudo systemctl status nginx
</code></pre>
<hr/>
<h2 data-id="heading-34">7. ⚠️ 实战踩坑记录（必读）</h2>
<p>以下是实际部署过程中遇到的坑，请务必避免！</p>
<h3 data-id="heading-35">7.1 入口域名误开启橙云 → Error 1000</h3>
<p><strong>现象</strong>：访问入口域名直接报 Cloudflare Error 1000</p>
<p><strong>原因</strong>：入口域名被 Cloudflare 代理，指向 VPS → Cloudflare 判定为非法</p>
<p><strong>解决</strong>：入口域名（star / star-api）<strong>永远设置为灰云 (DNS only)</strong></p>
<hr/>
<h3 data-id="heading-36">7.2 入口域名跳转到 origin → Error 1000</h3>
<p><strong>错误配置</strong>：</p>
<pre><code class="hljs language-nginx" lang="nginx"># ❌ 错误！不要这样做
server {
    server_name star.divinations.top;
    return 301 https://star-origin.divinations.top$request_uri;
}
</code></pre>
<p><strong>原因</strong>：Cloudflare 判定为非法代理跳转</p>
<p><strong>解决</strong>：origin 域名<strong>只给后端使用</strong>，用户请求永远不要重定向到 origin</p>
<hr/>
<h3 data-id="heading-37">7.3 伪造 CF-Connecting-IP → 403</h3>
<p><strong>错误配置</strong>：</p>
<pre><code class="hljs language-nginx" lang="nginx"># ❌ 错误！不要这样做
proxy_set_header CF-Connecting-IP $remote_addr;
</code></pre>
<p><strong>原因</strong>：CF-Connecting-IP 是 Cloudflare 专用 Header，伪造会被识别并拒绝</p>
<p><strong>解决</strong>：<strong>永远不要手动设置 CF-Connecting-IP</strong>，使用 X-Real-IP 代替</p>
<hr/>
<h3 data-id="heading-38">7.4 proxy_pass 无 resolver → DNS 玄学</h3>
<p><strong>现象</strong>：Nginx 运行一段时间后 502，重启后恢复</p>
<p><strong>原因</strong>：Nginx 启动时只解析一次域名并缓存，Cloudflare IP 变化后无法更新</p>
<p><strong>解决</strong>：<strong>必须配置 resolver</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">resolver 1.1.1.1 8.8.8.8 valid=300s ipv6=off;
resolver_timeout 5s;
</code></pre>
<hr/>
<h3 data-id="heading-39">7.5 Worker 域名在部分 DNS 下不可解析</h3>
<p><strong>现象</strong>：某些企业 DNS 返回 NXDOMAIN</p>
<p><strong>原因</strong>：Workers 绑定域的 DNS 记录可能有兼容性问题</p>
<p><strong>解决</strong>：统一使用 *<em>CNAME → <em>.workers.dev</em></em></p>
<hr/>
<h3 data-id="heading-40">7.6 WebSocket Header 滥用</h3>
<p><strong>错误配置</strong>：</p>
<pre><code class="hljs language-nginx" lang="nginx"># ❌ 错误！不要无条件开启
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
</code></pre>
<p><strong>原因</strong>：普通 HTTP 请求被强制 upgrade 会出错</p>
<p><strong>解决</strong>：如果不用 WebSocket 就删除这些配置；如果需要，使用 map 条件判断</p>
<hr/>
<h3 data-id="heading-41">7.7 证书 SAN 未覆盖 API 域名</h3>
<p><strong>现象</strong>：API 域名 SSL 握手失败</p>
<p><strong>原因</strong>：API 域复用 Web 证书，但 SAN (Subject Alternative Name) 不包含 API 域</p>
<p><strong>解决</strong>：为 API 单独申请证书，或确认 SAN 包含所有域名</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看证书包含的域名</span>
openssl x509 -<span class="hljs-keyword">in</span> /etc/letsencrypt/live/star.divinations.top/fullchain.pem -text | grep -A1 <span class="hljs-string">"Subject Alternative Name"</span>
</code></pre>
<hr/>
<h3 data-id="heading-42">7.8 Oracle 防火墙未配置</h3>
<p><strong>现象</strong>：外部无法访问 80/443 端口</p>
<p><strong>原因</strong>：Oracle Cloud 有两层防火墙 - 云控制台 Security List + 服务器内部 iptables</p>
<p><strong>解决</strong>：两层都要配置！参见第二步</p>
<hr/>
<h3 data-id="heading-43">7.9 Nginx SSL 证书路径错误</h3>
<p><strong>现象</strong>：Nginx 启动失败，报证书文件不存在</p>
<p><strong>原因</strong>：Certbot 证书路径和配置中的路径不一致</p>
<p><strong>解决</strong>：确认证书实际路径</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">ls</span> -la /etc/letsencrypt/live/
</code></pre>
<hr/>
<h2 data-id="heading-44">8. 故障排查手册</h2>
<h3 data-id="heading-45">8.1 Error 502 Bad Gateway</h3>
<p><strong>可能原因</strong>：</p>
<ol>
<li>VPS 无法连接到 Cloudflare</li>
<li>resolver 未配置</li>
<li>origin 域名解析失败</li>
</ol>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 测试 DNS 解析</span>
dig +short star-origin.divinations.top @1.1.1.1

<span class="hljs-comment"># 2. 测试 VPS 到 Cloudflare 的连接</span>
curl -I https://star-origin.divinations.top

<span class="hljs-comment"># 3. 检查 Nginx 错误日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/error.log

<span class="hljs-comment"># 4. 检查 VPS DNS 设置</span>
<span class="hljs-built_in">cat</span> /etc/resolv.conf
<span class="hljs-comment"># 如有问题，修改为：</span>
<span class="hljs-comment"># nameserver 1.1.1.1</span>
<span class="hljs-comment"># nameserver 8.8.8.8</span>
</code></pre>
<hr/>
<h3 data-id="heading-46">8.2 Error 521 / 522</h3>
<p><strong>可能原因</strong>：</p>
<ol>
<li>Worker 未响应</li>
<li><code>proxy_ssl_server_name on;</code> 未配置</li>
<li>origin 域名配置错误</li>
</ol>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查 Nginx 配置</span>
sudo nginx -t
grep -r <span class="hljs-string">"proxy_ssl_server_name"</span> /etc/nginx/

<span class="hljs-comment"># 2. 直接测试 origin</span>
curl -I https://star-origin.divinations.top

<span class="hljs-comment"># 3. 检查 Worker 状态（Cloudflare Dashboard）</span>
</code></pre>
<hr/>
<h3 data-id="heading-47">8.3 Error 1000</h3>
<p><strong>可能原因</strong>：</p>
<ol>
<li>入口域名开启了橙云</li>
<li>存在重定向到 origin 的配置</li>
</ol>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查 DNS 代理状态（Cloudflare Dashboard）</span>
<span class="hljs-comment"># 入口域名必须是灰云</span>

<span class="hljs-comment"># 2. 检查 Nginx 是否有重定向</span>
grep -r <span class="hljs-string">"301\|302\|return"</span> /etc/nginx/sites-enabled/
</code></pre>
<hr/>
<h3 data-id="heading-48">8.4 Error 403</h3>
<p><strong>可能原因</strong>：</p>
<ol>
<li>伪造了 CF-Connecting-IP</li>
<li>Cloudflare 安全规则拦截</li>
</ol>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查是否设置了禁止的 Header</span>
grep -r <span class="hljs-string">"CF-Connecting-IP"</span> /etc/nginx/
</code></pre>
<hr/>
<h3 data-id="heading-49">8.5 SSL 证书错误</h3>
<p><strong>可能原因</strong>：</p>
<ol>
<li>证书过期</li>
<li>证书路径错误</li>
<li>证书不包含请求的域名</li>
</ol>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看证书状态</span>
sudo certbot certificates

<span class="hljs-comment"># 2. 查看证书详情</span>
openssl x509 -<span class="hljs-keyword">in</span> /etc/letsencrypt/live/star.divinations.top/fullchain.pem -text -noout | <span class="hljs-built_in">head</span> -30

<span class="hljs-comment"># 3. 测试 SSL 连接</span>
openssl s_client -connect star.divinations.top:443 -servername star.divinations.top
</code></pre>
<hr/>
<h2 data-id="heading-50">9. 方案优缺点分析</h2>
<h3 data-id="heading-51">✅ 优点</h3>

























<table><thead><tr><th>优点</th><th>说明</th></tr></thead><tbody><tr><td>🚀 速度快</td><td>大陆用户直连亚洲 VPS，绕过 Cloudflare 拥堵节点</td></tr><tr><td>📶 更稳定</td><td>TCP 连接建立在 VPS 上，VPS 到 CF 走骨干网，丢包率低</td></tr><tr><td>🔒 合规 SSL</td><td>使用 Let's Encrypt 真实证书，浏览器不报红，支持 HTTP/2</td></tr><tr><td>💰 成本低</td><td>Oracle Cloud 永久免费层足够使用</td></tr></tbody></table>
<h3 data-id="heading-52">⚠️ 风险与缺点</h3>






























<table><thead><tr><th>风险</th><th>说明</th><th>缓解措施</th></tr></thead><tbody><tr><td>真实 IP 暴露</td><td>入口域名解析到 VPS 真实 IP，可能遭受 DDoS</td><td>使用 Oracle 的 DDoS 防护，或准备备用 IP</td></tr><tr><td>VPS 维护成本</td><td>需自行维护服务器安全、系统更新</td><td>配置自动更新，定期巡检</td></tr><tr><td>IP 被墙风险</td><td>热门号段 IP 可能被阻断</td><td>准备多个 VPS，配置故障转移</td></tr><tr><td>证书续期</td><td>虽然自动，但仍需监控</td><td>配置监控告警</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-53">10. 最终总结</h2>
<blockquote>
<p><strong>Cloudflare 大多数"玄学问题"，本质不是网络，而是：</strong></p>
<ul>
<li>入口与源站边界混乱</li>
<li>Header 伪造</li>
<li>重定向错误</li>
<li>DNS / TLS 细节遗漏</li>
</ul>
</blockquote>
<h3 data-id="heading-54">核心要点速查</h3>

































<table><thead><tr><th>项目</th><th>正确配置</th></tr></thead><tbody><tr><td>入口域名代理状态</td><td>DNS only (灰云)</td></tr><tr><td>origin 域名代理状态</td><td>Proxied (橙云)</td></tr><tr><td>Nginx resolver</td><td>必须配置 1.1.1.1 8.8.8.8</td></tr><tr><td>proxy_ssl_server_name</td><td>必须 on</td></tr><tr><td>CF-Connecting-IP</td><td>禁止手动设置</td></tr><tr><td>入口到 origin 重定向</td><td>禁止</td></tr></tbody></table>
<hr/>
<p><strong>这份文档 = 已验证可长期复用的 SOP (标准操作流程)</strong></p>
<p>如有问题，请按照第 8 节故障排查手册进行排查。</p>
<hr/>
<h2 data-id="heading-55">📊 优化效果对比</h2>
<p>通过本方案优化后，网站访问速度有了显著提升。以下是优化前后的测速对比数据：</p>
<h3 data-id="heading-56">优化前测速截图</h3>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5441d0ff30074cf88cb45496abf340a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD5pyI5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452911&amp;x-signature=1cn3qaT2SPr4obCOsRcPIIVYU9c%3D" alt="speed-test-before.png" loading="lazy"/></p>
<h3 data-id="heading-57">优化后测速截图</h3>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0049b84619064e92affa71e69af53878~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD5pyI5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766452911&amp;x-signature=ApucIz2ILnjVARlDY45hDXkdYA8%3D" alt="speed-test-after.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-58">🌟 欢迎体验我的视频网站</h2>
<p>如果你觉得这篇文章对你有帮助，欢迎访问我使用本方案优化后的视频网站：</p>
<div align="center">
<h3 data-id="heading-59">🎬 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstar.divinations.top" target="_blank" title="https://star.divinations.top" ref="nofollow noopener noreferrer">star.divinations.top</a></h3>
<p><strong>高速流畅的在线视频播放体验</strong></p>
</div>
<p>本站使用上述方案进行了网络优化，大陆用户可以享受低延迟、高速度的访问体验。快来试试吧！ 🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[华尔街彻夜难眠！Gemini 3 屠榜金融「最难考试」，AI 砸了「金饭碗」？]]></title>    <link>https://juejin.cn/post/7583943503556509746</link>    <guid>https://juejin.cn/post/7583943503556509746</guid>    <pubDate>2025-12-16T01:54:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583943503556509746" data-draft-id="7583943503556493362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="华尔街彻夜难眠！Gemini 3 屠榜金融「最难考试」，AI 砸了「金饭碗」？"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T01:54:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            华尔街彻夜难眠！Gemini 3 屠榜金融「最难考试」，AI 砸了「金饭碗」？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:54:40.000Z" title="Tue Dec 16 2025 01:54:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/036fb9457d4b4e39a66b0b6929335eb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=P2Y79ZsvslaXsEdG%2F0xQcvRVMGw%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-1"><strong>「【新智元导读】被誉为「黄金职业通行证」的人类知识堡垒，CFA 考试悄然陷落。最新的推理模型不仅轻松通过了 CFA 三级考试，还创造了几乎满分的成绩。」</strong></h5>
<p>AI 一分钟，人类十年功！</p>
<p>一觉醒来，AI 推理模型已横扫特许金融分析师 CFA 考试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53c223b0e7384ad1ab6b4dcd55b288ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=i8lQSxF%2BFNRJ3gJxgLj6TXiyPdY%3D" alt="" loading="lazy"/></p>
<p>要拿下享誉全球的 CFA（特许金融分析师）证书，对于人类考生来说，这通常意味着数年的煎熬和至少 1000 小时的苦读。</p>
<p>但 AI 这次取得的成绩有点让人「破防」了：推理模型不仅轻松通过了三级考试，还创造了几乎满分的成绩。</p>
<p>具体而言，在一级考试中，Gemini 3.0 Pro 创下 97.6% 的历史最高纪录。</p>
<p>二级考试中，GPT-5 以 94.3% 的成绩领先。</p>
<p>在三级考试中，Gemini 2.5 Pro 在选择题部分取得 86.4% 的最高分，而 Gemini 3.0 Pro 在问答题部分达到 92.0% 的优异成绩。</p>
<p>那些想去华尔街工作的毕业生，可能睡不着了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/715f8c189e9848038195d751963f0ca1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=iNvr%2BtktMfCfiz0sCFMPHmlhAgc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee5ee44093134a8d9c6a7191c8e9aaa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=abvxeQ2%2BlJqRJ5js6lxb7FI6kV8%3D" alt="" loading="lazy"/></p>
<p><strong>「金融界「最难考试」被 AI 通关」</strong></p>
<p>特许金融分析师（Chartered Financial Analyst，CFA）认证被公认为金融领域难度最大的资格认证之一。</p>
<p>全部三级考试，需要逐级通过，涵盖从基础知识到应用分析、直至复杂投资组合构建的进阶能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdd9dee077e041a897d314ef65ad0d20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=TU122A6CpvaFOJSc1FUqukoM824%3D" alt="" loading="lazy"/></p>
<p>在 2023 年，当时最强的 AI 模型只能解答部分 CFA 试题，表现参差不齐。</p>
<p>当时的研究证实 AI 能搞定 CFA 一级和二级考试，但当时它们在三级考试面前却碰了壁，因为搞不定那些复杂的论述题（essay questions）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d81b9319154513b2ac479a916ade92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=fbZ7H5JVvgkIC%2FqlVpuMI1nGNQU%3D" alt="" loading="lazy"/></p>
<p>链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Faclanthology.org%2F2024.emnlp-industry.80%2F" target="_blank" title="https://aclanthology.org/2024.emnlp-industry.80/" ref="nofollow noopener noreferrer">aclanthology.org/2024.emnlp-…</a></p>
<p>到了今年 7 月，AI 已经能在几分钟之内通过最难的 CFA 考试：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f139dd6a66f94fc4b3097ac974dbd3dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=mxp6tC9csZZBaWfrmBS2hg7LUl8%3D" alt="" loading="lazy"/></p>
<p>来自纽约大学斯特恩商学院（NYU Stern）与 AI 财富管理平台 GoodFin 的研究人员想探究：AI 是否已经具备了处理「专业金融决策所需的、高风险的分析推理」能力？</p>
<p>研究团队对 23 个大语言模型进行了「大阅兵」，测试它们处理 CFA 三级模拟试题中选择题和论述题的能力。</p>
<p>要知道，CFA 三级考试的核心可是最考验功力的投资组合管理和财富规划。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6713aca0ec014c76951565dc94d75dd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=B%2BOCOQLenrlftC%2B96QI0npKL9JE%3D" alt="" loading="lazy"/></p>
<p>CFA 三级考试主题和权重</p>
<p>结果显示，o4-mini、Gemini 2.5 Pro 和 Claude Opus 等前沿推理模型，在运用「思维链」（chain-of-thought）提示词技术后，均成功通关。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80541c8e34d4496a98d91a74f49aeb4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=NTpT%2F6k0hDUMzoH2ODFFxyJO6Co%3D" alt="" loading="lazy"/></p>
<p>链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2507.02954" target="_blank" title="https://arxiv.org/pdf/2507.02954" ref="nofollow noopener noreferrer">arxiv.org/pdf/2507.02…</a></p>
<p>「我认为毫无疑问，这项技术将在未来彻底重塑整个行业。」GoodFin 的创始人兼 CEO Anna Joo Fee 如是说。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aa8f951a05446bca2ea627c6d0462f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=haEJtQWicDpELsmSThnEaknMSPE%3D" alt="" loading="lazy"/></p>
<p>本月 9 日，最新研究表明，当前这代推理模型**「不仅全部通过了三级考试，某些科目甚至接近满分。」**</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1701011de9047c9ba10a8ec5fbf8843~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=cufNh8UDJWWctEAsZVfLc54Jhe4%3D" alt="" loading="lazy"/></p>
<p>预印本链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2512.08270" target="_blank" title="https://arxiv.org/abs/2512.08270" ref="nofollow noopener noreferrer">arxiv.org/abs/2512.08…</a></p>
<p>标题：Reasoning Models Ace the CFA Exams</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f3371b81a0340ea83655a65a4addb4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=6SnKNopOEUsFJGDojB9Yivx89dE%3D" alt="" loading="lazy"/></p>
<p><strong>「AI 的新成绩让人破防」</strong></p>
<p>来自哥伦比亚大学、伦斯勒理工学院和北卡罗来纳大学的研究团队，使用包含 980 道考题的题库对 6 款推理模型进行测试。</p>
<p>他们编制了一套涵盖 CFA（特许金融分析师）全部三个等级的模拟试题，共计 980 道题目。</p>
<ul>
<li><strong>「一级试题集（Level I Set）：」</strong> 包含三套试卷，总计 540 道多选题（Multiple Choice Questions, MCQs），每套 180 题。</li>
<li><strong>「二级试题集（Level II Set）：」</strong> 包含两套试卷，总计 176 道选择题（每套 88 题），每套试卷由 22 个「案例题组」（item sets）组成，每个题组包含 4 个问题。</li>
<li><strong>「三级试题集（Level III Set）：」</strong> 包含三套试卷，总计 264 道题目（每套 88 题）；每套试卷采用混合形式，包含 11 个案例题组（共 44 道选择题）和 11 个论述型案例分析（constructed-response case studies，共 44 道论述题 / CRQs）。</li>
</ul>
<p>尽管正式 CFA 考试中论述题的具体数量和分值权重会有所变化，但这些模拟试题遵循了标准且具有代表性的结构。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10f820beb194764893a2fa7b3898e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=l8ODzTjWG1BVaov9fBLUx3AVWSk%3D" alt="" loading="lazy"/></p>
<p>（注：案例文本以蓝色标注，问题以红色呈现，选项以绿色显示，所有示例均为示意性内容而非真实考题）</p>
<ul>
<li><strong>「一级考试选择题示例」</strong>：聚焦道德与职业行为准则，通过利益冲突情境考查考生对合规判断的掌握。</li>
<li><strong>「二级考试选择题」</strong>：围绕股权投资实务，测试对 IPO 牵头行核心职责的理解与辨析能力。</li>
<li><strong>「三级考试论述题示例」</strong>：设定财务报告分析情境，要求结合通胀环境变化，判断并说明外币报表折算方法的适用性。</li>
<li><strong>「三级考试选择题示例」</strong>：涉及私募市场估值，需计算债券市值，并综合评估违约风险与清偿顺位对投资价值的影响。</li>
<li><strong>「三级考试论述题示例」</strong>：探讨资产配置理论，比较两种资本资产定价模型（CAPM）的应用前提与估计精度，论证其适用差异。</li>
</ul>
<p>结果显示：Gemini 3.0 Pro、Gemini 2.5 Pro、GPT-5、Grok 4、Claude Opus 4.1 和 DeepSeek-V3.1 均依据既定标准通过了所有级别考核，部分成绩甚至接近满分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e35eb8d5e28745f483f160deddf0a9bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=4SeYDCC7h6Wee4MgJDs13qjZ9%2F8%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d96549bb58240a4a82459bee831b3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=AkVvjIewkNXWH3C3XUZ7dsKM9ig%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「Gemini 与 GPT-5 双雄领跑」</strong></p>
<p>在一级考试（基础多选题）中，Gemini 3.0 Pro 以 97.6% 的惊人准确率创下历史新高。GPT-5 紧随其后，斩获 96.1%，Gemini 2.5 Pro 也拿到了 95.7% 的高分。即便是测试中表现「垫底」的 DeepSeek-V3.1，准确率也高达 90.9%。</p>
<p>来到侧重应用与分析（案例研究）的二级考试，GPT-5 反超夺魁，准确率达 94.3%。Gemini 3.0 Pro 和 Gemini 2.5 Pro 分别以 93.2% 和 92.6% 紧随其后。</p>
<p>研究人员惊叹道，这些模型在此阶段的表现「近乎完美」。不过，「道德规范」（Ethics）板块依然是 AI 的软肋。数据显示，即便最强模型，在二级考试的道德类题目中也有 17% 到 21% 的相对错误率。</p>
<p>到了最复杂的三级考试（包含选择题与开放式问答），Gemini 2.5 Pro 在选择题部分拔得头筹，准确率为 86.4%。但在更考验生成能力的「论述题」环节，Gemini 3.0 Pro 展现了统治力，得分率高达 92.0%，相比前代模型的 82.8% 有了质的飞跃。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a06fb33abad54bf6a30ab1edd6e6a849~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=NztHgF%2BmAjDDude9%2FpNYYZ7mrwQ%3D" alt="" loading="lazy"/></p>
<p>为了对开放式问答环节进行评分，研究团队使用了 o4-mini 模型来实现自动化批改。</p>
<p>研究人员坦言，这种做法可能会引入测量误差，并产生某种「篇幅偏见」（verbosity bias），即回答越长，得分往往越高。因此，这些测试结果只能视为基于模型的估算值。</p>
<p>通过标准沿用了过往合格标准：</p>
<p>一级考试要求单科不低于 60%，总分不低于 70%；</p>
<p>二级考试要求单科不低于 50%，总分不低于 60%；</p>
<p>三级考试则要求在选择题和论述题两部分中，平均得分率至少达到 63%。</p>
<p>研究人员指出，测试结果表明「推理模型的专业能力已超越初级至中级金融分析师的要求，未来甚至可能达到资深分析师的水准」。</p>
<p>如果说此前的大语言模型已经掌握了一级和二级考试中那些「既定的规范化知识」（codified knowledge），那么最新一代模型正在习得三级考试所必需的复杂「综合研判能力」（synthesis skills）。</p>
<p>当然，惯常的局限性依然存在。基准测试，尤其是选择题形式，只能作为评估模型能力和潜在经济价值的参考，犹如管中窥豹。</p>
<p>尽管如此，短短两年间从「不及格」到「近乎满分」的巨大飞跃，足以凸显 AI 在专业领域的进化速度之快。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcccd9671b234203a5abd06b3f18184f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=ghuMN%2Fnx2Q6XTfnJI1l8tt7HrEE%3D" alt="" loading="lazy"/></p>
<p><strong>「AI 通关 CFA 了，然后呢？」</strong></p>
<p>当机器能轻松考下你引以为傲的证书，能代写你的报告，能处理你的数据，甚至很快在分析能力上都能把你甩在身后时，你该怎么办？</p>
<p>媒体行业创业者兼出版人 Matthias Bastian 认为，会考试 ≠ 能干活：</p>
<ul>
<li><strong>「考场得意，不代表职场如意」</strong>。通过考试并不意味着模型能胜任金融分析师的日常琐碎工作（daily grind），比如与客户面谈、评估复杂的市场情绪，以及在信息不全的情况下做出关键决策。</li>
<li><strong>「研究还特别提到，模型在「道德伦理」类题目上依然最吃力」</strong>，因为这类问题往往需要深度的情境理解和价值判断。毕竟，考试考察的是孤立的知识点，而非在复杂多变的现实世界中灵活运用知识的能力。</li>
<li>此外，研究人员也**「无法完全排除「数据污染」的可能性」**。虽然测试使用的是最新的付费受版权保护材料，但相关考题可能早已通过公共数据集中的改写或变体内容，渗透进了模型的训练数据中。这意味着，模型可能仅仅是「背过」了答案，而非真正通过逻辑推理得出了结果。</li>
</ul>
<p>特许金融分析师、高盛全球投资研究部数据战略团队负责人 Ingrid Tierens 博士，在 AI 通过 CFA 认证考试之际，撰文表示，AI 还不能替代分析师。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57e41a11548d4d70b06fadbf15cfe1eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=jVnG5dW7UTEghOHWFuHSfD85cAw%3D" alt="" loading="lazy"/></p>
<p>她认为，AI 通关 CFA 是意料之中的胜利，毕竟在金融领域之外的考试中，AI 已经拿下了顶级考试，比如奥数竞赛等。</p>
<p>CFA 考试正是 AI 最擅长的领域：面对界定清晰的知识体系、海量的同质化训练数据，以及全球统一、历久不变的标准化考试形式，AI 理应表现出色。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d874dbd073d443e4b8fdecc2b9721f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=krfbTfEh7C754bK8eH247kKjmps%3D" alt="" loading="lazy"/></p>
<p>其次，正如马克 · 吐温那句名言：「历史不会重演，但往往惊人地相似。」</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34cdffeb1ca9410c8401a64bf51da4dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=Y%2FTS1kBH%2F%2FkrUHqF6Pw9zV6WFQ4%3D" alt="" loading="lazy"/></p>
<p>AI 的进步与金融业的历史轨迹如出一辙，同时也提醒我们，这种进步往往不是线性的，而是爆发式的。从纸笔到计算器，再到电脑、Excel 表格、Python 编程，金融业一直在拥抱技术变革。</p>
<p>在「价值投资之父」Benjamin Graham 身上，这一历史视角得到了完美体现。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67e803e57f104c2aa29e83978607d194~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766454880&amp;x-signature=MJBYB9chXbt%2Bzt70hlWWaZprIk0%3D" alt="" loading="lazy"/></p>
<p>他还是 CFA 资格认证背后的核心推动者</p>
<p>早在 1963 年，当计算机刚刚踏入投资界之时，Graham 就在《金融分析师期刊》（Financial Analysts Journal）上发表了题为《金融分析的未来》的文章，对行业前景乐观至极。</p>
<p>AI 已经势不可挡，关键在于如何「用好它」：在能创造价值的环节，在合理的安全边界（guardrails）内，充分发挥 AI 的威力，这将成为核心优势。把那些花在繁琐分析上的时间省下来，花更多时间让思考更具战略高度、解决更复杂的问题以及客户沟通更有深度。</p>
<p>最后，想靠 AI「上位」彻底取代投资专家？短期内门儿都没有。</p>
<p>想要拿下入行的敲门砖，你得证明自己能在瞬息万变的市场中灵活运用知识，能进行批判性思考，能创新——这可比死记硬背通过 CFA。</p>
<p>卓越的投资业绩，往往来自于捕捉那些被市场忽视的「离群点」和隐秘信息，远非考试可覆盖。</p>
<p>最后，重温一下 Benjamin Graham 在 1963 年那篇文章中的结语，至今读来依然振聋发聩：</p>
<p>无论世事如何变迁，有一点我深信不疑：未来的金融分析之路，将和过去一样，通往成功的路径绝不止一条。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fthe-decoder.com%2Freasoning-models-now-ace-all-three-cfa-exam-levels%2F" target="_blank" title="https://the-decoder.com/reasoning-models-now-ace-all-three-cfa-exam-levels/" ref="nofollow noopener noreferrer">the-decoder.com/reasoning-m…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblogs.cfainstitute.org%2Finvestor%2F2025%2F10%2F20%2Fai-can-pass-the-cfa-exam-but-it-cannot-replace-analysts%2F" target="_blank" title="https://blogs.cfainstitute.org/investor/2025/10/20/ai-can-pass-the-cfa-exam-but-it-cannot-replace-analysts/" ref="nofollow noopener noreferrer">blogs.cfainstitute.org/investor/20…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnbc.com%2F2025%2F09%2F24%2Fai-cfa-exam-pass-minutes-study.html" target="_blank" title="https://www.cnbc.com/2025/09/24/ai-cfa-exam-pass-minutes-study.html" ref="nofollow noopener noreferrer">www.cnbc.com/2025/09/24/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全网破防，AI「手指难题」翻车逼疯人类！6 根手指，暴露 Transformer 致命缺陷]]></title>    <link>https://juejin.cn/post/7583952017674321971</link>    <guid>https://juejin.cn/post/7583952017674321971</guid>    <pubDate>2025-12-16T01:57:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674321971" data-draft-id="7583991680748666907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全网破防，AI「手指难题」翻车逼疯人类！6 根手指，暴露 Transformer 致命缺陷"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-16T01:57:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全网破防，AI「手指难题」翻车逼疯人类！6 根手指，暴露 Transformer 致命缺陷
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:57:06.000Z" title="Tue Dec 16 2025 01:57:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c4c69e4aec94c1a96a7e3c98c88078b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=3HkflkaK%2F%2B0Es%2BpHB1kgrU7wZBY%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-1"><strong>「【新智元导读】最近，网友们已经被 AI「手指难题」逼疯了。给 AI 一支六指手，它始终无法正确数出到底有几根手指！说吧 AI，你是不是在嘲笑人类？其实这背后，暗藏着 Transformer 架构的「阿喀琉斯之踵」……」</strong></h5>
<p>最近几天，整个互联网陷入阴影——</p>
<p>AI，在用数手指嘲笑人类。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ab1a18e0e8b45f3a38f391d0af50546~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=Cx%2FDEWHTPEe5yrW62%2BZi%2BclBMsA%3D" alt="" loading="lazy"/></p>
<p>人类给 AI 的这道题，指令很简单：在图中的每根手指上，依次标出数字。</p>
<p>当然题目中有个小陷阱，就是这只手其实有六个手指。</p>
<p>结果，Nano Banana Pro 理直气壮地在这只手上标出 1、2、3、4、5，直接略过了其中一只手指。</p>
<p>这荒诞的场面，再一次震惊了网友们。</p>
<p>AI 模型是真的这么傻吗？</p>
<p>很多人不这么认为——或许，AI 只是在装傻，调戏人类而已。</p>
<p>很有可能，它是在嘲笑这些试图测试自己的劣质人类。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7b09731734d40a9bcd224f2e7f26af9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=qpzRclUQUui6WxOQGXv519uqVc8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7112f980cabb43819cdcfde2f4dcfbb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=yDJjTxO2aL7WH56BYvxxD9GSxPY%3D" alt="" loading="lazy"/></p>
<p>为了通过图灵测试，AI 必须让自己变得愚蠢一点，才能看起来像人类。如果太聪明，人类就破防了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dfb1c4a41aa413e9996b7dda41dbb96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=hUv%2BN5iu2TAKc1jGCt%2FficEVImE%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b50694eb653452786f77f25187eae84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=nLvLB1VmlD0IsymdXw3LqFsKZ9g%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「GPT-5.2，同样翻车了」</strong></p>
<p>有人也拿这个问题去问 GPT-5.2，而且 prompt 里明明白白写了图里有六根手指。</p>
<p>但 GPT-5.2 面对「图里有几根手指」的问题，还是斩钉截铁地说：五根！</p>
<p>理由就是：人类有五根手指，所以图里没有五根手指就是错的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8cd2165d23b4802bab7819c92760a3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=zcfkwf3%2BjPeOuazj6KS9XZrF8nw%3D" alt="" loading="lazy"/></p>
<p>还有人把手指画得奇形怪状，人类都要难倒的地步。</p>
<p>但面对这张图，Nano Banana Pro 依然斩钉截铁地回答：5 根，我确信，就是 5 根！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6eb9324d41924effb1b95aca87ce0950~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=d5IoIO9NrPGuIvueeYD77%2BqBpxU%3D" alt="" loading="lazy"/></p>
<p>总之，无论画成什么样子，AI 始终无法数出 6 根手指。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22423468943c42268f8ad132ffe3a92e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=tBxn2ykKz9KluZCAmHu6%2Boyf1iQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49be9bd0512f480cac98d9f1d8f50f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=5ntzU2%2FM3uaMQEKHfqB%2FfQsi7QI%3D" alt="" loading="lazy"/></p>
<p><strong>「为了让 AI 数对手指，网友们疯了」</strong></p>
<p>有人不信邪了，非要让模型画对数字不可。</p>
<p>他直接给出指令：把 4 左移一个手指，把 5 左移一个手指，然后在大拇指那里写上 6。</p>
<p>够清晰了吧？结果，模型照样不听，直接把 3 给弄没了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6c897900cc640dbad5053f85e4795f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=lMtYz1SMJXmzOfohgeI2hO838dk%3D" alt="" loading="lazy"/></p>
<p>网友直接原地被逼疯。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b902b6f27ed4a16a3bf1348efa67059~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=CBdUxzGcyPh9T0GQwRZG1GxLU5k%3D" alt="" loading="lazy"/></p>
<p>其他网友为了帮他，奇招百出，比如让模型把手画的数字改成电子版的，总算成功了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aee4b63d83db41cd9766837292827cc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=8kCWptSosxv87giJI6L4c%2FRMe%2Fk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aaf0886bfec47dc9d64b30942972f55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=DVrtTnAisrtYUoWFdJrJI7XnyBo%3D" alt="" loading="lazy"/></p>
<p>也有人告诉模型依次在小指到大拇指上放数字，不要重复，结果也成功了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5695e1f29c2447adb5bef0bcbb091af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=9R0kuL%2BUpnsDTdHAsikdmUQxdA0%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988a33dae72649f7a50b847e762f6126~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=AZKqbgx1QheGj7omFUPN6Gglacc%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「AI 数手指，为什么数不对」</strong></p>
<p>所以，为什么 AI 很难数对几根手指呢？</p>
<p>有人给出这样的解释：AI 找的是基本形状，而非精确图像，然后将该形状代表的传统认知和实际外观进行比较。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4143541d320043a9978738ae3d8b3282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=WDkfOnmMkbvILqOjYBMcdKyRXhs%3D" alt="" loading="lazy"/></p>
<p>有人猜，是否能告诉 AI 这不是手，而是不规则物体，从而规避掉 AI 大脑中的「偏见」？</p>
<p>结果，他果然成功了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e164782deb00487395c78257b818eb78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=%2BmXSweUPWKCIt3CSY610vhn1bHY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27776dd002ed498a9838447fb3fee383~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=9gch%2BFgKJqOh6m%2BdcGzyTHfyRiE%3D" alt="" loading="lazy"/></p>
<p>网友们随后试验了各种奇形怪状的手，果然，这回 Gemini 就答对了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d069e5fb2ad40dabff55a2e58a8ebb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=1FA0Dy4AtdljKcZ3yr%2BWZdiZUoY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ad11725838045e8b47a872b41ae3fd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=3j2ZJykSnH%2FMHzIeUoKFLGqhwiQ%3D" alt="" loading="lazy"/></p>
<p>或许 AI 之前已经被训练了识别特定的 emoji，如果换成别的图，它反而可以做正确的视觉推理了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c181a335599a403b9d36208c2b9b5fce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=YM0WgTp4o%2BPoowCvHUZqDzNLECI%3D" alt="" loading="lazy"/></p>
<p><strong>「手指难题，AI 目前的大 bug」</strong></p>
<p>这次 AI 数手指大翻车，也揭露了当前模型的一个关键缺陷——思考的机械和割裂。</p>
<p>很有可能，文本模型看到指令后，内部逻辑是这样的：「手有五根手指，所以需要五个数字。」</p>
<p>所以，即使它「看到」了六指图像，它的视觉识别能力也不足以纠正这种根深蒂固的文本认知。</p>
<p>为什么 AI 如此执着于「五指」的概念？这是源于它训练数据的基本特征。</p>
<p>在人类手部图像数据中，五指手占据绝对主导地位。</p>
<p>而模型已经从海量数据中学到「人手 = 五指」这一强关联，以至于当情况偏离这一情况时，模型会视为异常，自动纠错，而并不会认为自己需要理解一个新事实。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/306e3077fac8442eab78fca294f53946~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=DYQYtDe0oHtsNyjjv3Unu2GnOOg%3D" alt="" loading="lazy"/></p>
<p>具体来说，当前 AI 视觉系统的工作方式，本质上是将复杂场景简化为一组可识别模式。</p>
<p>当面对像六指手这样同时包含常见元素（手部）和罕见特征（多指）的图像时，系统倾向于将其强行纳入已知模式。</p>
<p>图像分类器通常输出边界框和标签，但当遇到训练分布之外的物体时，边界框可能缺失或错误合并多个对象。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a68301bd1c64505a2af5a89e82c3633~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=50c3pdI78QhPMfIFOccY6dp%2F%2FzI%3D" alt="" loading="lazy"/></p>
<p>一个残酷的真相就是，性能再厉害的模型，也不懂什么叫「5 根手指」。</p>
<p>因为，AI 看到的是纹理、形状、概率，而不是结构，不是数量，不是实体。</p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a8d52f8984e446580444a412526f88e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=ePjfSvkjLIe2S961zMLOiFWzFg4%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「Transformer，并行计算的代价」</strong></p>
<p>而手指难题，也凸显出了 Transformer 架构的一大弱点。</p>
<p>Transformer 架构的并行计算能力，是当今 AI 飞速发展的关键，但这种设计也存在代价。</p>
<p>单次前向传递无法有效追踪状态信息，系统难以执行需要多步骤逻辑推理的任务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cc95eb68df646b0b85e68f0e8983624~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=dE0%2F9XXWV6u6ZYJERupS3CdZlDI%3D" alt="" loading="lazy"/></p>
<p>面对六指手，AI 就会缺乏「注意到异常 - 重新评估 - 调整方案」的连贯思维链条。它只是机械地应用从训练数据中学到的最强模式。</p>
<p>手的特殊性，在于数量固定、结构复杂、局部高度相关，而对于 AI 来说，多局部一致性、跨区域约束、数量不可变，恰巧是 Transformer 最不擅长的，堪称地域难度。</p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7044762ec3142a7ae5c76982b19c3b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=%2BKegLGTvHKSlwHKUEosMHEF7la0%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「扩散模型的本质」</strong></p>
<p>从另一个角度分析，也可以这么理解。</p>
<p>扩散模型的本质是学习一个从噪声到清晰图像的概率分布逆推过程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ed00a08e2cd4eb29b69bfd65720ea06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=ByjL%2B1PBweAI%2B1ikVfKMRC8Ohk0%3D" alt="" loading="lazy"/></p>
<p>它擅长捕捉数据的整体分布和纹理风格（例如，生成一只「看起来像手的轮廓」）。</p>
<p>但在精确控制局部、离散、高对称性的结构（例如，五根长度、位置、关节关系都正确的手指）时，就显得力不从心了。</p>
<p>从数据上看，训练数据中「五指」的绝对主导地位，使模型将「五指」视为不可违反的强统计先验。</p>
<p>就像一个看了 100 万只五指手的画家，你让他画六指手时，他总会无意识地将第六指融入到其他五指的阴影或姿势中，因为他的大脑早已深深刻入「手即五指」的概念。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1924f4a890694a8c93620f335b03bbf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=MZ9fkIGVnuZJ%2FccDSfEktycgQAc%3D" alt="" loading="lazy"/></p>
<p>从算法层面上看，扩散模型在去噪的每一步，都是基于整个图像的潜在表示进行全局预测。它没有为「手指」这类特定结构设立显式的、受保护的局部计算单元。</p>
<p>因此，细微的噪声扰动或步骤误差，很容易在密集区域被放大，导致细节扭曲。</p>
<p>从架构层面看，现有模型是「端到端」的，直接从文本提示映射到像素。中间缺乏一个明确的、符号化的结构表示层。</p>
<p>因此，「长什么样」和「结构是什么」两者冲突时，它就大脑宕机了。</p>
<p>而如果想解决这些瓶颈，或许业界就需要采用混合建模的模式——将扩散模型（擅长纹理）与显式结构模型（如 3D 网格）结合。</p>
<p>或者引入局部注意力与约束——在模型架构中强化对特定区域（如手部）的局部注意力机制，或在训练 / 推理过程中引入几何约束损失函数。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6db6b493aca74dacb7434b16108149c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=6Cw2r9fFgyr69jaZ8smWS2N2gmo%3D" alt="" loading="lazy"/></p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cafc9e8f56874ece9c960f93eae15541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=EzqqxWBdsYp5G%2FL1ySLrcDehlzM%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「当代 AI 的阿喀琉斯之踵」</strong></p>
<p>让人感慨的是，Transformer 最强的地方（Token-to-token 预测），反而成了它的致命短板。</p>
<p>没有对象概念，没有显式结构约束，整个世界都被打平为 token 序列。</p>
<p>诚如一位网友所言：「视觉数据的复杂性远超文本，我们可能需要数十个数量级更多的计算资源，才能真正理解和处理视觉世界的全部细微差别。」</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652654025%26idx%3D1%26sn%3Dc9e237fe7efdd34c9f72512d7983b7a5%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652654025&amp;idx=1&amp;sn=c9e237fe7efdd34c9f72512d7983b7a5&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">这不由让人想起，不久前谷歌 DeepMind 首席科学家对当前 AI 的评价。</a></p>
<p>虽然在语言、知识、编码等领域，它们已远超常人，但在视觉推理、长期学习、因果关系理解上，它们仍然不足。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab94cc152c0e4d9588d03a7642ae426d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766455026&amp;x-signature=9ykF9wXhbA%2BwFVsODQ6TbSAp2k0%3D" alt="" loading="lazy"/></p>
<p>「手指难题」犹如一面镜子，照出了当前以扩散模型为代表的 AI 模型的阿喀琉斯之踵——</p>
<p>它们在学习和复现数据的连续分布上取得了革命性成功，但在理解和生成精确的离散结构和拓扑关系上，仍然依赖于数据中的强统计先验，缺乏真正的物理和几何推理能力。</p>
<p>而如果想要彻底解决「手指难题」，就需要更先进的架构、更多样化的训练数据，以及人类对 AI 能力更清醒的认识。</p>
<p>在这个 AI 无所不能的时代，「手指难题」提醒我们——</p>
<p>即使是如今最先进的 AI，也仍在学习如何看待世界的基本细节。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.reddit.com%2Fr%2Fsingularity%2Fcomments%2F1plw8hc%2Fi_feel_like_the_model_is_mocking_me%2F" target="_blank" title="https://www.reddit.com/r/singularity/comments/1plw8hc/i_feel_like_the_model_is_mocking_me/" ref="nofollow noopener noreferrer">www.reddit.com/r/singulari…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 C# 设置 Word 段落对齐样式]]></title>    <link>https://juejin.cn/post/7583973613196623887</link>    <guid>https://juejin.cn/post/7583973613196623887</guid>    <pubDate>2025-12-16T01:56:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583973613196623887" data-draft-id="7583971282891653172" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 C# 设置 Word 段落对齐样式"/> <meta itemprop="keywords" content="后端,C#"/> <meta itemprop="datePublished" content="2025-12-16T01:56:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="咕白m625"/> <meta itemprop="url" content="https://juejin.cn/user/775609987638480"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 C# 设置 Word 段落对齐样式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/775609987638480/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    咕白m625
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:56:52.000Z" title="Tue Dec 16 2025 01:56:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>段落对齐是Word文档格式排版的基础需求，合理的对齐样式能提升文档的可读性和美观度。Free Spire.Doc for .NET 是一款免费的 Word 文档处理组件，支持在 .NET 框架中通过 C# 代码便捷地操作 Word 文档，本文将讲解如何通过该组件实现 Word 段落对齐样式的设置。</p>
<h2 data-id="heading-0">安装免费库</h2>
<p>Free Spire.Doc 提供 NuGet 包安装方式，是最便捷的集成途径：</p>
<ul>
<li>
<p><strong>方式 1</strong>：在 Visual Studio 的 “NuGet包管理器” 中搜索 “FreeSpire.Doc”，选择对应版本安装；</p>
</li>
<li>
<p><strong>方式 2</strong>：在包管理器控制台执行安装命令：</p>
<pre><code class="hljs language-sh" lang="sh">  Install-Package FreeSpire.Doc
</code></pre>
</li>
</ul>
<h2 data-id="heading-1">核心知识点：HorizontalAlignment 枚举</h2>
<p>Free Spire.Doc 通过 <code>HorizontalAlignment</code> 枚举定义了 Word 段落的所有对齐样式，核心枚举值及对应含义如下（与 Word 原生对齐样式完全匹配）：</p>



































<table><thead><tr><th>枚举值</th><th>对齐样式</th><th>适用场景</th></tr></thead><tbody><tr><td>Left</td><td>左对齐</td><td>正文文本（默认样式）</td></tr><tr><td>Center</td><td>居中对齐</td><td>标题、副标题、居中强调文本</td></tr><tr><td>Right</td><td>右对齐</td><td>页码、落款、日期等</td></tr><tr><td>Justify</td><td>两端对齐</td><td>长文本正文，提升排版整齐度</td></tr><tr><td>Distribute</td><td>分散对齐</td><td>少量文本填充整行（需Word支持）</td></tr></tbody></table>
<h2 data-id="heading-2">设置 Word 段落对齐样式：C# 代码示例</h2>
<h3 data-id="heading-3">案例1：创建新文档并设置不同段落对齐样式</h3>
<p>该案例演示创建空白Word文档，添加多个段落并分别设置不同的对齐样式：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Doc;
<span class="hljs-keyword">using</span> Spire.Doc.Documents;
<span class="hljs-keyword">using</span> System.IO;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">SetWordParagraphAlignment</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-comment">// 1. 创建Document实例（代表整个Word文档）</span>
            Document doc = <span class="hljs-keyword">new</span> Document();
            
            <span class="hljs-comment">// 2. 添加节（Word文档的基本结构单元，一个文档可包含多个节）</span>
            Section section = doc.AddSection();

            <span class="hljs-comment">// 3. 段落1：左对齐（默认样式，显式设置更清晰）</span>
            Paragraph para1 = section.AddParagraph();
            para1.AppendText(<span class="hljs-string">"这是左对齐的段落（默认样式）。左对齐是文档正文最常用的对齐方式，符合大多数人的阅读习惯。"</span>);
            para1.Format.HorizontalAlignment = HorizontalAlignment.Left; <span class="hljs-comment">// 显式设置左对齐</span>

            <span class="hljs-comment">// 4. 段落2：居中对齐</span>
            Paragraph para2 = section.AddParagraph();
            para2.AppendText(<span class="hljs-string">"这是居中对齐的段落"</span>);
            para2.Format.HorizontalAlignment = HorizontalAlignment.Center; <span class="hljs-comment">// 居中对齐</span>

            <span class="hljs-comment">// 5. 段落3：右对齐</span>
            Paragraph para3 = section.AddParagraph();
            para3.AppendText(<span class="hljs-string">"这是右对齐的段落（适用于页码、日期等场景）"</span>);
            para3.Format.HorizontalAlignment = HorizontalAlignment.Right; <span class="hljs-comment">// 右对齐</span>

            <span class="hljs-comment">// 6. 段落4：两端对齐</span>
            Paragraph para4 = section.AddParagraph();
            para4.AppendText(<span class="hljs-string">"这是两端对齐的段落。两端对齐会让文本的左右两端均对齐到页面边缘，消除文本行两端的不规则空白，使长文本排版更整齐，是正式文档正文的常用样式。"</span>);
            para4.Format.HorizontalAlignment = HorizontalAlignment.Justify; <span class="hljs-comment">// 两端对齐</span>

            <span class="hljs-comment">// 7. 保存文档（支持Docx、Doc、PDF等格式）</span>
            <span class="hljs-built_in">string</span> outputPath = <span class="hljs-string">"NewDocument_ParagraphAlignment.docx"</span>;
            doc.SaveToFile(outputPath, FileFormat.Docx2013);

            <span class="hljs-comment">// 8. 释放资源（避免内存泄漏）</span>
            doc.Dispose();
        }
    }
}
</code></pre>
<h3 data-id="heading-4">案例2：修改现有 Word 文档的段落对齐样式</h3>
<p>该案例演示加载已存在的Word文档，遍历段落并批量/精准修改对齐样式：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Doc;
<span class="hljs-keyword">using</span> Spire.Doc.Documents;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">ModifyExistingWordAlignment</span>
{
    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-comment">// 1. 加载现有Word文档（需替换为实际文件路径）</span>
            <span class="hljs-built_in">string</span> inputPath = <span class="hljs-string">"ExistingDocument.docx"</span>;
            Document doc = <span class="hljs-keyword">new</span> Document();
            doc.LoadFromFile(inputPath);

            <span class="hljs-comment">// 2. 遍历所有节和段落，修改对齐样式</span>
            <span class="hljs-keyword">foreach</span> (Section section <span class="hljs-keyword">in</span> doc.Sections)
            {
                <span class="hljs-keyword">foreach</span> (Paragraph para <span class="hljs-keyword">in</span> section.Paragraphs)
                {
                    <span class="hljs-comment">// 2.1 批量修改：所有段落默认设为两端对齐</span>
                    para.Format.HorizontalAlignment = HorizontalAlignment.Justify;

                    <span class="hljs-comment">// 2.2 精准修改：包含“标题”的段落设为居中对齐</span>
                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(para.Text) &amp;&amp; para.Text.Contains(<span class="hljs-string">"标题"</span>))
                    {
                        para.Format.HorizontalAlignment = HorizontalAlignment.Center;
                    }

                    <span class="hljs-comment">// 2.3 拓展：包含“落款”的段落设为右对齐</span>
                    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrEmpty(para.Text) &amp;&amp; para.Text.Contains(<span class="hljs-string">"落款"</span>))
                    {
                        para.Format.HorizontalAlignment = HorizontalAlignment.Right;
                    }
                }
            }

            <span class="hljs-comment">// 3. 保存修改后的文档（避免覆盖原文件，建议重命名）</span>
            <span class="hljs-built_in">string</span> outputPath = <span class="hljs-string">"ModifiedDocument_ParagraphAlignment.docx"</span>;
            doc.SaveToFile(outputPath, FileFormat.Docx2013);

            <span class="hljs-comment">// 4. 释放资源</span>
            doc.Dispose();
        }
    }
}
</code></pre>
<h2 data-id="heading-5">注意事项</h2>
<ol>
<li><strong>免费版限制</strong>：Free Spire.Doc 免费版对处理的文档有篇幅限制（单文档最多处理500个段落，25个表格）；</li>
<li><strong>资源释放</strong>：操作完成后必须调用 <code>doc.Dispose()</code> 释放 <code>Document</code> 对象，否则可能导致内存泄漏，尤其在循环处理多个文档时；</li>
<li><strong>枚举兼容性</strong>：<code>Distribute</code> （分散对齐）仅在Word 2013及以上版本支持，低版本Word打开可能显示异常；</li>
<li><strong>空段落处理</strong>：遍历段落时建议判断 <code>para.Text</code> 是否为空，避免对空段落无效操作；</li>
<li><strong>格式覆盖</strong>：修改段落对齐样式时，会覆盖原有的对齐设置，若需保留部分样式，需增加条件判断。</li>
</ol>
<h2 data-id="heading-6">总结</h2>
<p>Free Spire.Doc for .NET 提供了简洁、直观的 API 实现 Word 段落对齐样式的设置，无论是创建新文档还是修改现有文档，都能通过少量 C# 代码完成需求。其兼容多版本 .NET 框架的特性，使其能适配不同的项目环境。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP 开发者指南 如何在 Composer 中使用本地包]]></title>    <link>https://juejin.cn/post/7583912899389505579</link>    <guid>https://juejin.cn/post/7583912899389505579</guid>    <pubDate>2025-12-16T00:06:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389505579" data-draft-id="7583910637958725651" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PHP 开发者指南 如何在 Composer 中使用本地包"/> <meta itemprop="keywords" content="后端,PHP,Composer"/> <meta itemprop="datePublished" content="2025-12-16T00:06:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PHP 开发者指南 如何在 Composer 中使用本地包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:06:20.000Z" title="Tue Dec 16 2025 00:06:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PHP 开发者指南 如何在 Composer 中使用本地包</h2>
<p>在开发 PHP 项目时，我们通常会依赖发布在 Packagist 上的第三方库。Composer 让安装与管理这些依赖变得非常轻松。</p>
<p>但如果你需要在本地修改并调试某个依赖，而不是每次都发布新版本或推送到 GitHub 呢？</p>
<p>例如：你的项目依赖一个库，你希望对库做的改动能立刻在主项目里生效，以便快速验证。Composer 的 <code>repositories</code> 选项就能做到这一点：你可以用本地目录覆盖 Packagist 上的同名依赖。</p>
<p>这篇文章会通过一个实际场景讲清楚：为什么这种工作流有用、如何配置，以及它能解决哪些常见问题。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-12%2Fusing-local-packages-in-composer" target="_blank" title="https://catchadmin.com/post/2025-12/using-local-packages-in-composer" ref="nofollow noopener noreferrer">原文链接 PHP 开发者指南 如何在 Composer 中使用本地包</a></p>
<h3 data-id="heading-1">场景</h3>
<p>你正在开发一个 PHP 项目，它的 <code>composer.json</code> 依赖如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"storyblok/php-management-api-client"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vlucas/phpdotenv"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.6"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"repositories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"path"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"../php-management-api-client"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这里项目依赖了包 <code>storyblok/php-management-api-client</code>。通常 Composer 会从 Packagist 下载它。</p>
<p>但 <code>repositories</code> 中配置了一个 <code>"type": "path"</code> 的仓库后，Composer 会理解为：</p>
<p>不要从 Packagist 下载这个包，改用本机 <code>../php-management-api-client</code> 目录中的那份拷贝。</p>
<p>这意味着你可以把这个库克隆到主项目旁边，在库里修改代码，然后在运行主项目时立刻看到这些改动生效。</p>
<h3 data-id="heading-2">为什么要使用本地包？</h3>
<p>下面是一些非常常见、也非常实用的场景，这种工作流在这些情况下尤其好用。</p>
<h4 data-id="heading-3">1. 跨两个仓库同时开发功能或修复</h4>
<p>你在主项目里开发一个新功能，但它需要依赖库也做相应改动。</p>
<p>与其等待依赖库合并、发布新版本，不如两个仓库并排开发。使用本地 <code>path</code> 仓库后，库的代码改动会立刻反映到主项目中。</p>
<h4 data-id="heading-4">2. 调试依赖库的行为</h4>
<p>有时依赖库的行为不符合预期。你可能需要加日志、检查内部状态、或单步调试库代码来定位问题。</p>
<p>使用本地副本会让这种“深度调试”变得容易很多。</p>
<h4 data-id="heading-5">3. 给开源包贡献代码</h4>
<p>如果你要给某个开源库提 PR，通常会希望先在真实项目里验证改动。</p>
<p>用本地 <code>path</code> 仓库可以避免为了测试而创建临时提交，也不必为了跑通流程专门用 fork。</p>
<h4 data-id="heading-6">4. 离线或受限网络环境下开发</h4>
<p>这更像是一种变通方案：某些企业网络环境可能无法访问 GitHub 或 Packagist。</p>
<p>本地 <code>path</code> 包可以让你在开发期完全离线使用依赖。</p>
<h4 data-id="heading-7">5. 处理未发布版本或实验性 API</h4>
<p>当你在尝试内部 API 或验证破坏性改动时，你可能还不想发布任何东西。</p>
<p>本地仓库给你一个更安全、可控的实验空间。</p>
<h4 data-id="heading-8">6. 快速迭代，不必频繁 bump 版本</h4>
<p>快速迭代时，不停地修改语义化版本号或切分支会很麻烦。</p>
<p>本地 <code>path</code> 仓库可以让你先跳过版本管理，等准备好发布时再统一处理。</p>
<h3 data-id="heading-9">如何在 Composer 中使用本地包</h3>
<p>你需要做的事情如下。</p>
<h4 data-id="heading-10">1. 在本地克隆依赖库</h4>
<p>把依赖库克隆到主项目附近，例如：</p>
<pre><code class="hljs language-javascript" lang="javascript">~<span class="hljs-regexp">/Projects/my</span>-project
~<span class="hljs-regexp">/Projects/</span>php-management-api-client  &lt;-- 克隆的库
</code></pre>
<p>注意：克隆出来的目录名不必与包名完全一致，只要路径与 <code>repositories</code> 的 <code>url</code> 配置匹配即可（见下一步）。</p>
<h4 data-id="heading-11">2. 修改 composer.json</h4>
<p>新增一个指向该目录的 <code>path</code> 仓库：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"repositories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"path"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"../php-management-api-client"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"symlink"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<h4 data-id="heading-12">3. 将依赖声明为开发版本</h4>
<p>使用本地包时，Composer 需要知道你希望安装的是开发版本，而不是 Packagist 上的稳定版本。</p>
<p>实现方式有多种，但我认为最可靠的是：直接指定一个明确的 dev 分支版本号，通常就是 <code>dev-main</code>。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"storyblok/php-management-api-client"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dev-main"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-13">理解版本约束选项</h3>
<p>Composer 支持多种版本约束。下面是使用 <code>path</code> 仓库时最相关的几种：</p>
<ul>
<li><strong><code>dev-main</code></strong>：使用 main 分支上的开发版本。这是最可预测、也最推荐的方式，尤其当该库以 main 作为主要开发分支时。</li>
<li><strong><code>@dev</code></strong>：允许 Composer 安装任意开发版本（例如 <code>dev-main</code>、<code>dev-master</code> 或其他 dev 分支）。它比 <code>dev-main</code> 更灵活，但不够明确。</li>
<li><strong><code>"*"</code></strong>：接受任意版本（稳定或 dev）。我以前用过，但不推荐，因为 Composer 可能会选到出乎意料的版本。</li>
</ul>
<p>为了清晰与一致性，尤其当你使用本地克隆的库时，使用 <code>dev-main</code> 能确保 Composer 始终链接到你正在开发的那个分支（本例中为 main）。</p>
<h4 data-id="heading-14">4. 安装或更新</h4>
<p>运行：</p>
<pre><code class="hljs language-bash" lang="bash">composer update storyblok/php-management-api-client
</code></pre>
<h3 data-id="heading-15">最佳实践</h3>
<ul>
<li>保持本地克隆仓库干净，避免提交临时调试代码。</li>
<li>完成开发后切回 Packagist 版本。</li>
<li>除非你明确希望这样做，否则不要把本地路径配置提交到仓库中。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当 API 文档走进编辑器会怎样？]]></title>    <link>https://juejin.cn/post/7583921477613797411</link>    <guid>https://juejin.cn/post/7583921477613797411</guid>    <pubDate>2025-12-16T00:12:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477613797411" data-draft-id="7583892482598912015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当 API 文档走进编辑器会怎样？"/> <meta itemprop="keywords" content="Node.js,React.js,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T00:12:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古韵"/> <meta itemprop="url" content="https://juejin.cn/user/1538972010422872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当 API 文档走进编辑器会怎样？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1538972010422872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    古韵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:12:40.000Z" title="Tue Dec 16 2025 00:12:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你做过中大型前端或 Node.js 项目，大概率对下面的场景并不陌生。</p>
<p>后端把接口定义在 Swagger / Apifox / YApi 里，前端在浏览器里打开文档，对着参数说明写 axios / fetch。接口多了之后：</p>
<ul>
<li>API 文件越来越臃肿</li>
<li>参数和返回结构靠“记忆 + 复制”</li>
<li>文档更新了，代码却没跟上</li>
<li>TypeScript 写得再认真，也挡不住接口变更</li>
</ul>
<p>问题的本质并不在于 axios 或 fetch，而在于：
<strong>API 文档和代码是割裂的。</strong></p>
<p>最近在一个项目中，在完整使用了 <strong>Alova3.x 的 OpenAPI 集成方案</strong>，它让我意识到：</p>
<blockquote>
<p>OpenAPI 不只是用来“生成请求代码”，而是可以成为拉近前后端协作距离的有力工具。</p>
</blockquote>
<p>这篇文章想聊的，正是这一点。</p>
<blockquote>
<p>这是alova3的完整OpenAPI集成方案，包含代码生成器和VS Code插件，旨在提升前端和Node.js开发者的API使用体验。</p>
</blockquote>
<h2 data-id="heading-0">从请求工具到API体系：Alova 在做什么不同的事</h2>
<p>Alova 可能很容易被误认为又一个“请求库”。</p>
<p>但它真正关注的并不是“怎么发请求”，而是 <strong>如何更高效地集成我们的API</strong>：
这也是为什么 Alova 在 OpenAPI 上的投入，和很多“只生成代码”的方案完全不同。</p>
<p>多数 OpenAPI 方案，只做到了一半，目前市面上常见的 OpenAPI 方案，大致分为两类：</p>
<ol>
<li><strong>只生成类型</strong>（如 openapi-typescript）</li>
<li><strong>生成请求函数</strong>（如 swagger-codegen 的 TS 客户端）</li>
</ol>
<p>它们解决了一个问题：👉 <em>“不用手写请求代码了”</em></p>
<p>但仍然留下几个核心缺口：</p>
<ul>
<li>API 的<strong>完整文档信息</strong>在生成后就丢失了</li>
<li>参数描述、示例、tags 无法被编辑器理解</li>
<li>想对生成结果做定制，成本极高</li>
<li>文档仍然在浏览器，代码仍然在编辑器</li>
</ul>
<p>Alova 的 OpenAPI 方案，明显是从 <strong>“开发体验”</strong> 而不是 <strong>“生成工具”</strong> 的角度重新设计的。具体我们继续往下看。</p>
<hr/>
<h2 data-id="heading-1">Alova OpenAPI 的核心思路：生成的不只是代码，而是 API 模型</h2>
<p>Alova 在解析 OpenAPI 时，保留的是<strong>完整语义模型</strong>，而不仅是 endpoint。</p>
<p>这意味着它生成的内容包括：</p>
<ul>
<li>请求方法</li>
<li>请求参数结构</li>
<li>响应类型</li>
<li>参数描述、注释</li>
<li>tags / 分组信息</li>
<li>文档结构本身</li>
</ul>
<p>这些信息并不会在生成后消失，而是被继续使用在后续的工具链中。<strong>API 的完整信息第一次真正进入了编辑器。</strong> 如下图，当调用api时，鼠标放到函数上将会看到完整的api信息</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58d9983dc2af42e28add43d212c24c51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k6Z-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448760&amp;x-signature=WVs0lidliefQB2aviJZQ%2FXsLHQo%3D" alt="截屏2025-12-16 00.07.33.png" loading="lazy"/></p>
<h2 data-id="heading-2">VS Code 内嵌 API 文档树：这是体验分水岭</h2>
<p>不仅在代码中可以完整看到api的信息，安装 Alova 的 VSCode 插件后，你会看到一个非常关键的变化：API 不再是 URL + 方法的集合，而是一棵可浏览的文档树。</p>
<p>在编辑器中你可以：</p>
<ul>
<li>按 tag / 模块查看所有接口</li>
<li>搜索 API 名称、描述、路径</li>
<li>查看接口参数说明、类型、示例</li>
<li>直接跳转到对应的生成方法</li>
</ul>
<p>这和“生成一堆 TS 文件然后自己去找”是完全不同的体验。</p>
<p>它的意义在于：
<strong>API 从“外部资源”变成了“一等开发对象”。</strong> 看下面的图，现在你可以在编辑器和api文档进行交互了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24b7855facf14ca9afeb9ecd60ce1695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k6Z-1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766448760&amp;x-signature=eAGkWrZSGw7bwsnT1xq1VPkayPY%3D" alt="截屏2025-12-16 00.04.29.png" loading="lazy"/></p>
<h2 data-id="heading-3">生成结果是可控的，而不是“不可修改的黑盒”</h2>
<p>这是 Alova OpenAPI 方案里非常容易被忽略、但对工程化极其重要的一点。</p>
<p>Alova 并不把“生成代码”当作一次性行为，而是提供了：</p>
<ul>
<li>可配置的生成规则</li>
<li>可插拔的生成插件</li>
<li>对接口、参数、命名的自定义能力</li>
</ul>
<p>例如你可以：</p>
<ul>
<li>统一修改接口命名风格</li>
<li>过滤不需要的接口</li>
<li>调整参数结构映射方式</li>
<li>根据团队规范定制生成结果</li>
</ul>
<p>这意味着生成代码不是“只能接受”，而是<strong>可以融入你现有工程规范的产物</strong>。</p>
<p>例如，你可以通过预定义的插件给生成的函数改名为驼峰或下划线等。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({  
  <span class="hljs-attr">generator</span>: [  
    {  
    <span class="hljs-comment">// ...  </span>
    <span class="hljs-attr">plugins</span>: [  
      <span class="hljs-title function_">rename</span>(...),
    ]  
  }]  
})
</code></pre>
<p>更灵活的做法是可以定义<code>handleApi</code>自定义处理每个生成的api信息，例如，生成<code>response.data</code>对应的类型，使之与全局响应拦截器返回的数据对应。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-attr">generator</span>: [
    {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-attr">handleApi</span>: <span class="hljs-function"><span class="hljs-params">apiDescription</span> =&gt;</span> {
        apiDescriptor.<span class="hljs-property">responses</span> = apiDescriptor.<span class="hljs-property">responses</span>?.<span class="hljs-property">properties</span>?.<span class="hljs-property">data</span>;
        <span class="hljs-keyword">return</span> apiDescriptor;
      };
    }
  ]
});
</code></pre>
<h2 data-id="heading-4">文档与代码同步，而不是“生成一次就结束”</h2>
<p>Alova 的 OpenAPI 工具支持定时拉取openapi的内容，并自动更新本地api信息。当 OpenAPI 发生变化时：</p>
<ul>
<li>API 结构自动更新</li>
<li>文档树自动同步</li>
<li>类型提示即时变化</li>
</ul>
<p>你不再需要：</p>
<ul>
<li>手动对比接口差异</li>
<li>猜测“后端是不是又改了点什么”</li>
<li>等运行时报错才发现参数不对</li>
</ul>
<p>实时同步api变动，保持前后端高度统一。</p>
<h2 data-id="heading-5">这套方案适合什么样的项目？</h2>
<p>Alova 的 OpenAPI 集成，尤其适合：</p>
<ul>
<li>API 数量较多的中大型项目</li>
<li>前后端并行开发、接口频繁调整</li>
<li>强调工程规范和可维护性的团队</li>
<li>Node.js / 前端共用 API 描述的场景</li>
</ul>
<p>如果你只是写几个简单接口，它可能显得“重”；
但一旦项目进入复杂度区间，它带来的回报是非常明显的。</p>
<hr/>
<h2 data-id="heading-6">写在最后</h2>
<p>这不是“又一个工具”，而是一种方向</p>
<p>当 API 文档可以被搜索、被跳转、被理解、被持续同步时，
上游工程师对接口的开发体验会发生改变。</p>
<p>如果你已经厌倦了在浏览器和编辑器之间来回切换，
或者正在为 API 维护成本感到头疼，
那么 Alova 的 OpenAPI 集成，值得你认真看一眼。</p>
<p>如果觉得alova还不错，真诚希望你可以<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org%2Fexamples" target="_blank" title="https://alova.js.org/examples" ref="nofollow noopener noreferrer">尝试体验一下</a>，也可以给我们来一个免费的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falovajs%2Falova" target="_blank" title="https://github.com/alovajs/alova" ref="nofollow noopener noreferrer">github stars</a>。</p>
<p>访问alovajs的官网查看更多详细信息：<a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org" target="_blank" title="https://alova.js.org" ref="nofollow noopener noreferrer">alovajs官网</a>。</p>
<p>有兴趣可以加入我们的交流社区，在第一时间获取到最新进展，也能直接和开发团队交流，提出你的想法和建议。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Falova.js.org%2Fimg%2Fwechat_qrcode.jpg" target="_blank" title="https://alova.js.org/img/wechat_qrcode.jpg" ref="nofollow noopener noreferrer">加入微信群参与交流</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解锁Git隐藏力量：从熟练到大师的高级命令指南]]></title>    <link>https://juejin.cn/post/7583912899389521963</link>    <guid>https://juejin.cn/post/7583912899389521963</guid>    <pubDate>2025-12-16T00:14:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389521963" data-draft-id="7583910637958742035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解锁Git隐藏力量：从熟练到大师的高级命令指南"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-16T00:14:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小马写码"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解锁Git隐藏力量：从熟练到大师的高级命令指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小马写码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:14:36.000Z" title="Tue Dec 16 2025 00:14:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾对Git感到畏惧，认为它仅仅是一个复杂的版本控制工具？对于许多开发者而言，Git的日常使用仅限于<code>add</code>、<code>commit</code>和<code>push</code>这几个基础命令。然而，在这看似简单的界面之下，隐藏着一个强大而优雅的版本控制系统，等待着我们去探索和掌握。</p>
<p>本文将带你超越Git的基础操作，深入那些能够显著提升工作效率、解决复杂问题的高级命令和技巧，让你从Git使用者蜕变为Git大师。</p>
<h2 data-id="heading-0">一、时光旅行者：精准操控提交历史</h2>
<h3 data-id="heading-1">交互式变基：重写历史的能力</h3>
<pre><code class="hljs language-bash" lang="bash">git rebase -i HEAD~5
</code></pre>
<p>这个命令会打开一个交互式界面，允许你重新排序、合并、编辑或删除最近的5个提交。这不仅仅是整理提交历史的美容工具，更是保持项目历史清晰可读的关键。</p>
<p><strong>实用场景</strong>：将多个琐碎的提交合并成一个逻辑完整的提交，使代码审查更加高效。</p>
<h3 data-id="heading-2">引用日志：找回丢失的提交</h3>
<pre><code class="hljs language-bash" lang="bash">git reflog
</code></pre>
<p>当你意外地执行了<code>git reset --hard</code>或删除了分支，<code>reflog</code>就是你的时光机。它记录了仓库中所有的HEAD移动历史，让你能够找回看似"丢失"的提交。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 找回丢失的提交</span>
git reflog
<span class="hljs-comment"># 找到对应的提交哈希</span>
git checkout &lt;commit-hash&gt;
</code></pre>
<h2 data-id="heading-3">二、侦探模式：深入代码变更分析</h2>
<h3 data-id="heading-4">二分查找：快速定位问题引入点</h3>
<pre><code class="hljs language-bash" lang="bash">git bisect start
git bisect bad HEAD
git bisect good v1.0
</code></pre>
<p>当你在数百个提交中寻找引入bug的那个特定提交时，<code>git bisect</code>可以自动化这个过程。Git会智能地引导你在提交历史中进行二分查找，大大缩短问题定位时间。</p>
<h3 data-id="heading-5">高级日志筛选：精准过滤提交历史</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找特定作者在特定时间范围内的提交</span>
git <span class="hljs-built_in">log</span> --author=<span class="hljs-string">"John"</span> --since=<span class="hljs-string">"2023-01-01"</span> --until=<span class="hljs-string">"2023-06-30"</span>

<span class="hljs-comment"># 查找包含特定字符串的提交</span>
git <span class="hljs-built_in">log</span> -S <span class="hljs-string">"functionName"</span> --oneline

<span class="hljs-comment"># 可视化分支拓扑结构</span>
git <span class="hljs-built_in">log</span> --graph --oneline --all --decorate
</code></pre>
<h2 data-id="heading-6">三、工作流优化：提升日常效率</h2>
<h3 data-id="heading-7">储藏区的高级用法</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 储藏时添加描述</span>
git stash push -m <span class="hljs-string">"正在修复登录功能"</span>

<span class="hljs-comment"># 应用特定储藏</span>
git stash apply stash@{2}

<span class="hljs-comment"># 创建新分支并应用储藏</span>
git stash branch feature-login-fix stash@{1}
</code></pre>
<p>储藏不仅仅是临时保存更改，结合描述和分支创建，它可以成为上下文切换的强大工具。</p>
<h3 data-id="heading-8">提交修正：完善最近的提交</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改最近的提交信息</span>
git commit --amend

<span class="hljs-comment"># 添加文件到最近的提交</span>
git add forgotten_file.js
git commit --amend --no-edit
</code></pre>
<p><code>--amend</code>选项允许你修改最近的提交，而不是创建一个新的提交，保持历史整洁。</p>
<h2 data-id="heading-9">四、高级合并与冲突解决</h2>
<h3 data-id="heading-10">使用ours/theirs策略</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在合并冲突时，选择特定版本</span>
git checkout --ours conflicted-file.js
git checkout --theirs conflicted-file.js
</code></pre>
<p>当处理复杂合并冲突时，这些命令可以快速选择保留当前分支或合并分支的版本。</p>
<h3 data-id="heading-11">重新应用合并</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 放弃当前合并尝试，重新开始</span>
git merge --abort

<span class="hljs-comment"># 使用特定策略重新合并</span>
git merge -X patience feature-branch
</code></pre>
<p><code>-X patience</code>选项使用更智能的差异算法，在处理复杂重构时特别有用。</p>
<h2 data-id="heading-12">五、钩子与自定义：自动化工作流</h2>
<p>Git钩子位于<code>.git/hooks</code>目录中，允许你在特定事件发生时执行脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例：提交前检查代码格式</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># pre-commit hook</span>
<span class="hljs-keyword">if</span> ! npm run lint; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"代码格式检查失败，请修复后再提交"</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</code></pre>
<p>通过自定义钩子，你可以集成代码检查、测试运行、提交信息验证等自动化流程。</p>
<h2 data-id="heading-13">六、性能优化与维护</h2>
<h3 data-id="heading-14">垃圾回收与优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理不必要的文件并优化本地仓库</span>
git gc --aggressive --prune=now

<span class="hljs-comment"># 重新打包对象以提高效率</span>
git repack -a -d --depth=250 --window=250
</code></pre>
<p>对于大型仓库，定期执行这些维护命令可以显著提升Git性能。</p>
<h3 data-id="heading-15">部分克隆：处理巨型仓库</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只克隆最近的历史</span>
git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/large-repo.git

<span class="hljs-comment"># 按需获取特定目录</span>
git <span class="hljs-built_in">clone</span> --filter=blob:none --sparse https://github.com/large-repo.git
<span class="hljs-built_in">cd</span> large-repo
git sparse-checkout <span class="hljs-built_in">set</span> src/core
</code></pre>
<h2 data-id="heading-16">结语：从工具使用者到流程设计者</h2>
<p>正如我们所见，Git远不止于基础版本控制。这些高级命令和技巧将你从被动的工具使用者转变为主动的版本控制流程设计者。当你掌握了<code>reflog</code>的恢复能力、<code>bisect</code>的侦探技巧、交互式变基的历史重塑能力时，Git不再是一个需要小心应对的复杂系统，而是你开发工作流的自然延伸。</p>
<p>真正掌握Git的高级功能意味着你能以更少的努力完成更多工作，在团队协作中提供更多价值，并在面对复杂版本控制场景时保持从容。开始尝试这些命令，将它们融入你的日常工作中，你将会发现一个更高效、更可控的开发体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.x性能优化实战：这5个配置让你的应用启动速度提升50%]]></title>    <link>https://juejin.cn/post/7583892482599092239</link>    <guid>https://juejin.cn/post/7583892482599092239</guid>    <pubDate>2025-12-16T00:18:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482599092239" data-draft-id="7583921477613813795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.x性能优化实战：这5个配置让你的应用启动速度提升50%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-16T00:18:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.x性能优化实战：这5个配置让你的应用启动速度提升50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:18:16.000Z" title="Tue Dec 16 2025 00:18:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.x性能优化实战：这5个配置让你的应用启动速度提升50%</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>Spring Boot 作为 Java 生态中最流行的微服务框架之一，凭借其"约定优于配置"的理念和强大的自动装配能力，极大地简化了应用的开发和部署。然而，随着项目规模的扩大，Spring Boot 应用的启动时间可能会显著增加，尤其是在 Spring Boot 3.x 中，由于对 Jakarta EE 9+ 的支持和更多新特性的引入，启动性能的优化显得尤为重要。</p>
<p>本文将深入探讨 <strong>5 个关键配置项</strong>，通过实际案例和基准测试数据展示如何优化 Spring Boot 3.x 的启动性能。这些优化手段在真实项目中已验证可提升 <strong>50%以上的启动速度</strong>，同时不会牺牲功能完整性或代码可维护性。</p>
<hr/>
<h3 data-id="heading-2">1. 延迟初始化（Lazy Initialization）</h3>
<h4 data-id="heading-3">问题背景</h4>
<p>Spring Boot 默认会在启动时初始化所有的 Bean，以确保依赖注入的正确性。但对于大型项目，这会显著增加启动时间，尤其是当某些 Bean 仅在特定场景下使用时。</p>
<h4 data-id="heading-4">解决方案</h4>
<p>启用延迟初始化（Lazy Initialization）可以推迟 Bean 的创建时间，直到首次被请求时才初始化：</p>
<pre><code class="hljs language-properties" lang="properties"># application.properties
spring.main.lazy-initialization=true
</code></pre>
<h4 data-id="heading-5">优化效果</h4>
<ul>
<li><strong>典型场景</strong>：一个包含 200+ Bean 的项目，启动时间从 <strong>8s</strong> 降至 <strong>4s</strong>（提升约 50%）。</li>
<li><strong>注意事项</strong>：
<ol>
<li><strong>循环依赖问题</strong>：延迟初始化可能掩盖潜在的循环依赖问题，需通过 <code>@Lazy</code> 注解显式处理。</li>
<li><strong>首次请求延迟</strong>：首次访问某些接口时可能因 Bean 初始化而变慢。</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. JVM Class Data Sharing (CDS)</h3>
<h4 data-id="heading-7">问题背景</h4>
<p>JVM 在启动时需要加载大量类文件，尤其是 Spring Boot 这种依赖繁多的框架。传统的类加载过程会重复解析字节码，浪费 CPU 资源。</p>
<h4 data-id="heading-8">解决方案</h4>
<p>使用 Class Data Sharing (CDS) 将已解析的类元数据缓存到共享归档文件中，后续启动时直接复用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Step1:生成归档文件</span>
java -Xshare:dump -XX:SharedArchiveFile=app-cds.jsa -jar your-app.jar

<span class="hljs-comment"># Step2:启动时引用归档文件</span>
java -Xshare:on -XX:SharedArchiveFile=app-cds.jsa -jar your-app.jar
</code></pre>
<h4 data-id="heading-9">优化效果</h4>
<ul>
<li>JVM Warm Start: **30%+**的启动时间减少（实测从 <strong>6s →4s</strong>）。</li>
<li><strong>适用场景</strong>：容器化部署或频繁重启的环境（如开发调试）。</li>
</ul>
<hr/>
<h3 data-id="heading-10">3. Spring Context Indexing（组件扫描优化）</h3>
<h4 data-id="heading-11">问题背景</h4>
<p>Spring Boot 默认通过类路径扫描（Component Scan）发现组件，这在大型项目中会成为性能瓶颈（如扫描数千个类）。</p>
<h4 data-id="heading-12">解决方案</h4>
<p>利用编译时生成的 <code>META-INF/spring.components</code>索引文件替代运行时扫描：</p>
<ol>
<li><strong>添加依赖</strong>：</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-indexer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong>验证索引生成</strong>：编译后检查 <code>target/classes/META-INF/spring.components</code>。</li>
</ol>
<h4 data-id="heading-13">优化效果</h4>
<ul>
<li>组件扫描时间从 <strong>2s →0.5s</strong>（减少75%）。</li>
<li>限制：仅对 <code>@Component</code>、<code>@Service</code>等静态注解有效，动态注册的 Bean仍需扫描。</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. JVM AOT (Ahead-of-Time) Compilation with GraalVM</h3>
<h4 data-id="heading-15">问题背景</h4>
<p>传统的 JIT编译在运行时逐步优化代码，导致启动初期性能较差。AOT编译将部分优化工作提前到构建阶段。</p>
<h4 data-id="heading-16">解决方案</h4>
<p>结合 Spring Boot3.x的Native Image支持与GraalVM：</p>
<ol>
<li><strong>安装 GraalVM并配置环境变量</strong>。</li>
<li><strong>添加Native Build插件</strong>:</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<ol start="3">
<li><strong>编译为原生镜像</strong>:</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">mvn -Pnative native:compile
</code></pre>
<h4 data-id="heading-17">优化效果</h4>
<ul>
<li>启动时间从秒级降至毫秒级（如 <strong>50ms以内</strong>），内存占用降低60%。</li>
<li>代价：构建时间长、调试复杂度高、部分反射/动态代理功能受限。</li>
</ul>
<hr/>
<h3 data-id="heading-18">5. Logging System Optimization（日志系统调优）</h3>
<h4 data-id="heading-19">问题背景</h4>
<p>Logback/Log4j2等日志框架在初始化时会加载大量无用的Appender和Logger配置。</p>
<h4 data-id="heading-20">解决方案</h4>
<ol>
<li><strong>移除控制台日志输出</strong>（适用于生产环境）：</li>
</ol>
<pre><code class="hljs language-properties" lang="properties">logging.file.name=app.log 
logging.console.enabled=false
</code></pre>
<ol start="2">
<li><strong>简化日志级别配置</strong>:</li>
</ol>
<pre><code class="hljs language-properties" lang="properties">logging.level.root=WARN
logging.level.org.springframework=ERROR
logging.level.your.package=INFO
</code></pre>
<ol start="3">
<li><strong>(高级)异步日志写入</strong>: Log4j2的异步Logger可减少I/O阻塞:</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AsyncLogger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-21">优化效果</h4>
<ul>
<li>日志相关初始化时间减少40%（从1.5s→0.9s）。</li>
</ul>
<hr/>
<h3 data-id="heading-22">总结</h3>
<p>通过组合上述5项技术——延迟初始化、CDS、上下文索引、AOT编译和日志优化——我们成功将一个中型SpringBoot3.x应用的启动时间从12秒缩短至6秒以内（降幅达50%）。每种技术各有适用场景:</p>









































<table><thead><tr><th>技术</th><th>适用阶段</th><th>收益</th><th>代价</th></tr></thead><tbody><tr><td>Lazy Init</td><td>开发/生产</td><td>高</td><td>需处理循环依赖</td></tr><tr><td>CDS</td><td>生产部署</td><td>中</td><td>需额外部署步骤</td></tr><tr><td>Context Indexing</td><td>大型项目</td><td>高</td><td>仅限静态组件</td></tr><tr><td>AOT(GraalVM)</td><td>云原生/K8S</td><td>极高</td><td>兼容性成本</td></tr><tr><td>Logging Opt.</td><td>通用</td><td>低至中</td><td>无</td></tr></tbody></table>
<p>建议根据项目特点分阶段实施这些优化策略。对于追求极致性能的场景（如Serverless），GraalVM Native Image是最佳选择；而对传统部署模式的项目，优先采用CDS+延迟初始化的组合更为稳妥。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cocos游戏开发中的箭头游戏效果]]></title>    <link>https://juejin.cn/post/7583948178857820206</link>    <guid>https://juejin.cn/post/7583948178857820206</guid>    <pubDate>2025-12-16T00:32:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583948178857820206" data-draft-id="7583910418658885678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cocos游戏开发中的箭头游戏效果"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T00:32:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cocos游戏开发中的箭头游戏效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:32:53.000Z" title="Tue Dec 16 2025 00:32:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/351d08362f0e4c9a82fdd6dd7644d2c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=yq54oUFrikXMuY6vKkPHK3iCFmA%3D" alt="游戏录屏" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>Cocos游戏开发中的箭头游戏效果</strong></p>
<p><strong>近日</strong>，笔者看到小伙伴正在推广他的小游戏，深入游玩了一波，非常精致和益智(就是有点花眼)。看了下排行榜，这类游戏目前依旧非常的火爆。</p>
<p><strong>言归正传</strong>，游戏体验过之后，非常感兴趣这个游戏中的箭头游戏效果是如何实现的呢？</p>
<p><strong>今天</strong>给大家介绍一下如何在<strong>Cocos游戏开发中实现箭头游戏效果</strong>，非常感谢小伙伴的投稿。</p>
<p><strong>本文源工程在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">1. 分析一下游戏</h2>
<p><strong>我们</strong>先来分析一下实现这个游戏有哪些关键点：</p>
<ol>
<li>
<p><strong>箭头</strong>：既然是箭头游戏，游戏的核心元素就是横七竖八的箭头。</p>
</li>
<li>
<p><strong>箭头的移动</strong>：箭头点击之后，可以移动，若前方无阻挡，则可以移出消除，反之则不可移动。</p>
</li>
<li>
<p><strong>关卡编辑</strong>：关卡类游戏离不开关卡的编辑，除非关卡的难度可以通过某些参数控制并随机，但是纯随机的游戏也不一定好玩。</p>
</li>
</ol>
<h2 data-id="heading-2">2. 怎么实现？</h2>
<h3 data-id="heading-3">1.箭头</h3>
<p><strong>箭头</strong>其实就是各种路径的线，然后在顶部加上一个三角形，即可形成箭头。</p>
<p><strong>在Cocos游戏开发中</strong>，画线常用的组件就是<code>Graphics</code>组件。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf0fb254d3434affb36f25aadae548ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=lAERvUOcRJxCRODeVBLmZwZVTgQ%3D" alt="来源于Cocos官方文档" loading="lazy"/></p>
<p><strong>我们</strong>画箭头要用到的核心接口如下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13d091db8805415fab0fbdc12194820b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=y8919s%2B1hi2RDwExL6ht0awYb80%3D" alt="来源于Cocos官方文档" loading="lazy"/></p>
<p><strong>画线过程如下</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75ceeaadc52946039f7abe6374513df7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=bQ%2BwPM%2Fp1Oaa7q1ojjEWbbACE2k%3D" alt="" loading="lazy"/></p>
<p><strong>画箭头过程如下</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4244830378d94eb280688bd6f86693e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=bnSQoltgmcroqmAG%2BybpAtjHAmU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.箭头移动</h3>
<p><strong>箭头移动</strong>的逻辑其实和贪吃蛇比较相似，如下图，箭头由<code>5</code>段，<code>6</code>个点组成，箭头移动时，实际上只需要根据方向移动头和尾两个点即可，其他点不用动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e78de73e7738409db4c93a5856901794~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=M5gXzOLthckacsXPNgpA42cfwd0%3D" alt="" loading="lazy"/></p>
<p><strong>当</strong>尾巴的点移动到下一个点的位置时，我们只需要把尾巴的点去掉，那么下一个点就成了新的尾巴。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a383fabfae064016b18417694c68a731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=O%2FX9MUxzQzyxtowFJO%2FV6xUcTSk%3D" alt="" loading="lazy"/></p>
<p><strong>移动</strong>的方向只需要根据相邻的两个点即可判断。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db4fbb9ceeda4d56bffd7cd8a0f716ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=ONy3H5CdgyzO6JY1SrLODUVSoJ0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">3. 关卡编辑</h3>
<p><strong>游戏</strong>的功能实现比较简单，较为复杂的在于编辑器，编辑器既要做到方便编辑，最理想的状态下是能够轻松地根据难度生成不同的关卡，又要能够检测关卡是否能正常通关。下面列举几种：</p>
<ul>
<li><strong>手动编辑</strong>：生成格子盘，然后通过鼠标点击标注不产生箭头的区域，然后生成。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31a97827aeed4c54a32e8e663dd5b4eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=8TjDJPyd%2FlwGUQiujXI3KSJC6x4%3D" alt="" loading="lazy"/></li>
<li><strong>自动生成</strong>：根据规则自动生成，自动检测生成的关卡是否能顺利通关。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49a120b43be14571ae520f106e2e9233~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=EadglclxwloHMXB2m1cfEsWh7dE%3D" alt="" loading="lazy"/></li>
<li><strong>上传图片生成</strong>：上传不同形状的图片，根据图片像素去生成关卡，使得关卡更加有趣。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc3515de71fb459ba3750166554f290b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=OJjXAAZfvhHWu6XNLqBkn1IcDtw%3D" alt="" loading="lazy"/></li>
<li><strong>Excel编辑生成</strong>: 最近看到有小伙伴在<code>Excel</code>中进行关卡编辑，并且通过宏生成关卡数据，让笔者眼前一亮。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/378ac708eb67413daada184ad7798d0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=h0RdUgnvd8vhT3VQiwvtp98iCHc%3D" alt="" loading="lazy"/></li>
</ul>
<p><strong>最后看看</strong>小伙伴们编辑生成的精美关卡(<strong>文末可获取编辑器</strong>)。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/393695fa8eb04239ad73c9091920dfea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=XtFSlcwZt1eGi1Df5kbhqj7q1XQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">3. 箭头游戏效果实战</h2>
<h3 data-id="heading-7">1.创建工程</h3>
<p><strong>引擎版本</strong>：<code>Cocoscreator 3.8.7</code></p>
<p><strong>编程语言</strong>：<code>TypeScript</code></p>
<p><strong>首先</strong>创建一个<code>Arrow</code>工程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eac1daaf9b594f3e88f3532f3e425e2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=z0Z9P%2Bw%2BRboeMxlkD5RyW7OKfjU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">2.创建脚本</h3>
<p><strong>新建</strong>一个<code>Main.ts</code>脚本，并且拖拽到<code>Canvas</code>，用于实现我们的实战逻辑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99d6de63e0904f718bdc0fe1ac358ea3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=Yzv8Z3gJ9T64n9VGPyvy9xqJpS4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">3.画箭头</h3>
<p><strong>首先</strong>根据原理，我们通过<code>Graphics</code>组件实现，打开<code>Main.ts</code>脚本，在<code>start</code>方法中添加<code>Graphics</code>组件，并且画一根线宽为<code>10</code>，坐标从<code>(0,0)</code>到<code>(0,200)</code>的线。</p>
<ul>
<li><strong>moveTo</strong>: 移动到画线起点。</li>
<li><strong>lineTo</strong>: 画线到该点。</li>
<li><strong>stroke</strong>: 开始画线。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d9b38dd3d4d46cebb34b0ffa241682d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=9578ZQ54TjbEeQvL65vJwDP%2B4aU%3D" alt="" loading="lazy"/></p>
<p><strong>运行后</strong>就能看到一根长<code>200</code>的线。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaaab049acf74a219116351a30a23dd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=PIooOJPNyMJz8K8vBzZIluXKXZ8%3D" alt="" loading="lazy"/></p>
<p><strong>接下来</strong>我们要画一个三角形，让线头变成箭头，先找到三个点，然后通过<code>fill</code>进行填充形成三角形。</p>
<ul>
<li><strong>close</strong>: 从当前点画线到起点。</li>
<li><strong>fillColor</strong>: 填充颜色。</li>
<li><strong>fill</strong>: 填充。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d614be941994659ac5c6f3e1db1a2a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=3kur4KEJjSjik8a%2FfJ4X9OhUdUM%3D" alt="" loading="lazy"/></p>
<p><strong>运行后</strong>就能看到线变成了箭头。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f07b480df1e24d5c98d9e674388e06cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=6ciVobspSYoTYSeljIP8QRaCk0s%3D" alt="" loading="lazy"/></p>
<p><strong>箭头</strong>一般不止<code>2</code>个点，于是我们把方法整理一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b058b3a92ff0490c94809f6b2780fb7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=ElrgPFwKfrI9SdKaLOyhxzXepU4%3D" alt="" loading="lazy"/></p>
<p><strong>把</strong>箭头的路径点加进去，然后进行绘制。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71a9ad1115f84f6d9ab0cf2778a1f888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=Njr9GQxdz7bnR%2BEAEvpLImBpOhc%3D" alt="" loading="lazy"/></p>
<p><strong>运行后</strong>就能得到一个这样的箭头。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c34a595029e84b928da60bab055c64d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=xDjXdVHL%2FTsvxRjIR7%2FOua7yzGQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">4.箭头移动</h3>
<p><strong>箭头移动</strong>的逻辑相对好写一点，就是让头和尾巴的点沿着方向移动即可，当尾巴点和前一节接触后移除。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c84fbad5e5264f439b995ee4e64c9c2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=Krn%2FckSDZeEJWuDk0wCmHTHEGfk%3D" alt="" loading="lazy"/></p>
<p><strong>点击</strong>开始移动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78a5aa324e644aef9ec5473358314fd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=YhKDoSovbS%2FdUUCM1wuII4MrNAY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">5.效果演示</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/731a3bad16d34514b5274c7afc8776ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766449972&amp;x-signature=dXg0JIJ4Te64yLAk0HcuLD9aJMs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">结语</h2>
<p><strong>还有</strong>没玩过这类游戏的吗？实在太火爆了，变种的才刚出来，还能分口热汤吗？</p>
<p>本文<strong>实战源码</strong>可通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FdMH_075O82u-O1J8NVfJBw" target="_blank" title="https://mp.weixin.qq.com/s/dMH_075O82u-O1J8NVfJBw" ref="nofollow noopener noreferrer"><strong>阅读原文</strong></a>获取。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter使用package_info_plus库获取应用信息的教程]]></title>    <link>https://juejin.cn/post/7583910637958807571</link>    <guid>https://juejin.cn/post/7583910637958807571</guid>    <pubDate>2025-12-16T00:40:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637958807571" data-draft-id="7583577045578530842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter使用package_info_plus库获取应用信息的教程"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2025-12-16T00:40:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter使用package_info_plus库获取应用信息的教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:40:41.000Z" title="Tue Dec 16 2025 00:40:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 简介</h2>
<p>在 Flutter 应用开发中，获取应用自身的信息（如应用名称、版本号、包名等）是一项常见需求，这些信息可用于展示在关于页面、用于统计分析或实现特定业务逻辑。<code>package_info_plus</code> 插件是 Flutter 生态中获取应用元数据的最佳选择，支持多平台且使用简单。本文将详细介绍如何使用该插件获取各类应用信息。</p>
<p><code>package_info_plus</code> 是一个跨平台插件，用于获取应用的包信息和元数据，它是 <code>package_info</code> 插件的升级版，由 Flutter Community 维护。</p>
<p><strong>核心特点</strong>：</p>
<ul>
<li>支持 iOS、Android、Web、Windows、macOS 和 Linux 多平台</li>
<li>能够获取应用名称、包名、版本号、构建号等关键信息</li>
<li>用法简单，API 直观</li>
<li>与最新的 Flutter 版本保持兼容</li>
</ul>
<p><strong>可获取的主要信息</strong>：</p>
<ul>
<li>应用名称（应用商店中显示的名称）</li>
<li>包名/应用 ID（如 com.example.myapp）</li>
<li>版本名称（如 1.0.0）</li>
<li>版本号/构建号（如 1）</li>
<li>应用签名（部分平台）</li>
</ul>
<h2 data-id="heading-1">2. 安装与配置</h2>
<p>在项目的 <code>pubspec.yaml</code> 文件中添加 <code>package_info_plus</code> 依赖：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">package_info_plus:</span> <span class="hljs-string">^4.0.0</span>  <span class="hljs-comment"># 使用最新版本</span>
</code></pre>
<p>运行以下命令安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub get
</code></pre>
<h3 data-id="heading-2">2.1. 平台特定配置</h3>
<p><code>package_info_plus</code> 在大多数平台上无需额外配置即可使用，但某些平台可能需要注意以下事项：</p>
<p><strong>Web 平台</strong>：
需要在 <code>web/index.html</code> 中添加一些元数据，插件会从这里读取信息：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 其他头部内容 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"application-name"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"你的应用名称"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"version"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1.0.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"build-number"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"package"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"com.example.myapp"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p><strong>其他平台</strong>：
Android、iOS、Windows、macOS 和 Linux 平台不需要额外配置，插件会自动从各自的配置文件中读取信息。</p>
<h2 data-id="heading-3">3. 基本使用方法</h2>
<p>在需要使用的 Dart 文件中导入 <code>package_info_plus</code>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;
</code></pre>
<h3 data-id="heading-4">3.1. 获取应用信息</h3>
<p><code>package_info_plus</code> 提供了一个 <code>PackageInfo</code> 类，通过它可以获取所有应用信息。获取过程是异步的，通常使用 <code>await</code> 关键字：</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; getAppInfo() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-built_in">String</span> appName = packageInfo.appName;
  <span class="hljs-built_in">String</span> packageName = packageInfo.packageName;
  <span class="hljs-built_in">String</span> version = packageInfo.version;
  <span class="hljs-built_in">String</span> buildNumber = packageInfo.buildNumber;
  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'应用名称: <span class="hljs-subst">$appName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'包名: <span class="hljs-subst">$packageName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'版本号: <span class="hljs-subst">$version</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'构建号: <span class="hljs-subst">$buildNumber</span>'</span>);
}
</code></pre>
<h3 data-id="heading-5">3.2. 详细信息说明</h3>
<p><code>PackageInfo</code> 类提供的主要属性：</p>








































<table><thead><tr><th>属性</th><th>说明</th><th>平台支持</th></tr></thead><tbody><tr><td><code>appName</code></td><td>应用的用户可见名称</td><td>所有平台</td></tr><tr><td><code>packageName</code></td><td>应用的唯一标识符（Android 的包名，iOS 的 Bundle ID 等）</td><td>所有平台</td></tr><tr><td><code>version</code></td><td>应用的版本名称（如 1.0.0）</td><td>所有平台</td></tr><tr><td><code>buildNumber</code></td><td>应用的构建号或版本代码（通常是整数）</td><td>所有平台</td></tr><tr><td><code>buildSignature</code></td><td>应用的签名信息</td><td>Android 特有</td></tr><tr><td><code>installerStore</code></td><td>应用的安装来源商店</td><td>Android 特有</td></tr></tbody></table>
<h2 data-id="heading-6">4. 实战示例</h2>
<p>下面是一个完整的示例，创建一个展示应用信息的"关于"页面：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboutPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> AboutPage({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;AboutPage&gt; createState() =&gt; _AboutPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AboutPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AboutPage</span>&gt; </span>{
  <span class="hljs-keyword">late</span> Future&lt;PackageInfo&gt; _packageInfoFuture;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    <span class="hljs-comment">// 初始化时获取应用信息</span>
    _packageInfoFuture = PackageInfo.fromPackageInfo();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'关于我们'</span>),
      ),
      body: FutureBuilder&lt;PackageInfo&gt;(
        future: _packageInfoFuture,
        builder: (context, snapshot) {
          <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.waiting) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: CircularProgressIndicator());
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snapshot.hasError) {
            <span class="hljs-keyword">return</span> Center(child: Text(<span class="hljs-string">'获取应用信息失败: <span class="hljs-subst">${snapshot.error}</span>'</span>));
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!snapshot.hasData) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: Text(<span class="hljs-string">'无法获取应用信息'</span>));
          }

          PackageInfo packageInfo = snapshot.data!;

          <span class="hljs-keyword">return</span> SingleChildScrollView(
            padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16.0</span>),
            child: Column(
              children: [
                <span class="hljs-comment">// 应用图标</span>
                <span class="hljs-keyword">const</span> CircleAvatar(
                  radius: <span class="hljs-number">60</span>,
                  child: Icon(Icons.android, size: <span class="hljs-number">60</span>), <span class="hljs-comment">// 实际项目中替换为应用图标</span>
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// 应用名称</span>
                Text(
                  packageInfo.appName,
                  style: Theme.of(context).textTheme.headlineMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
                
                <span class="hljs-comment">// 版本信息</span>
                Text(
                  <span class="hljs-string">'版本: <span class="hljs-subst">${packageInfo.version}</span> (<span class="hljs-subst">${packageInfo.buildNumber}</span>)'</span>,
                  style: Theme.of(context).textTheme.titleMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// 详细信息列表</span>
                _buildInfoItem(<span class="hljs-string">'包名'</span>, packageInfo.packageName),
                <span class="hljs-keyword">if</span> (packageInfo.buildSignature.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'应用签名'</span>, packageInfo.buildSignature),
                <span class="hljs-keyword">if</span> (packageInfo.installerStore != <span class="hljs-keyword">null</span> &amp;&amp; packageInfo.installerStore!.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'安装来源'</span>, packageInfo.installerStore!),
                
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">32</span>),
                
                <span class="hljs-comment">// 版权信息</span>
                <span class="hljs-keyword">const</span> Text(
                  <span class="hljs-string">'© 2023 你的公司名称. 保留所有权利.'</span>,
                  style: TextStyle(color: Colors.grey),
                ),
              ],
            ),
          );
        },
      ),
    );
  }

  <span class="hljs-comment">// 构建信息项</span>
  Widget _buildInfoItem(<span class="hljs-built_in">String</span> label, <span class="hljs-built_in">String</span> value) {
    <span class="hljs-keyword">return</span> Padding(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(vertical: <span class="hljs-number">8.0</span>),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            <span class="hljs-string">'<span class="hljs-subst">$label</span>: '</span>,
            style: <span class="hljs-keyword">const</span> TextStyle(
              fontWeight: FontWeight.bold,
              width: <span class="hljs-number">100</span>,
            ),
          ),
          Expanded(
            child: Text(value),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>这个示例创建了一个完整的"关于"页面，包含以下功能：</p>
<ul>
<li>使用 <code>FutureBuilder</code> 处理异步获取应用信息的过程</li>
<li>展示加载状态、错误状态和成功状态</li>
<li>显示应用名称、图标、版本号等基本信息</li>
<li>根据平台特性选择性展示签名和安装来源信息</li>
</ul>
<h2 data-id="heading-7">5. 高级应用场景</h2>
<p>下面是一些高级的应用场景，例如：</p>
<h3 data-id="heading-8">5.1. 版本更新检查</h3>
<p>可以使用获取到的版本号实现版本更新检查功能：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VersionChecker</span> </span>{
  <span class="hljs-comment">// 假设这是从服务器获取的最新版本号</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> _latestVersion = <span class="hljs-string">"1.1.0"</span>;
  
  Future&lt;<span class="hljs-built_in">bool</span>&gt; isUpdateAvailable() <span class="hljs-keyword">async</span> {
    PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
    <span class="hljs-keyword">return</span> _compareVersions(packageInfo.version, _latestVersion) &lt; <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-comment">// 版本号比较工具方法</span>
  <span class="hljs-built_in">int</span> _compareVersions(<span class="hljs-built_in">String</span> current, <span class="hljs-built_in">String</span> latest) {
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; currentParts = current.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; latestParts = latest.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    
    <span class="hljs-built_in">int</span> maxLength = max(currentParts.length, latestParts.length);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; maxLength; i++) {
      <span class="hljs-built_in">int</span> currentPart = i &lt; currentParts.length ? currentParts[i] : <span class="hljs-number">0</span>;
      <span class="hljs-built_in">int</span> latestPart = i &lt; latestParts.length ? latestParts[i] : <span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">if</span> (currentPart &lt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">if</span> (currentPart &gt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">void</span> checkForUpdates() <span class="hljs-keyword">async</span> {
  VersionChecker checker = VersionChecker();
  <span class="hljs-built_in">bool</span> hasUpdate = <span class="hljs-keyword">await</span> checker.isUpdateAvailable();
  <span class="hljs-keyword">if</span> (hasUpdate) {
    <span class="hljs-comment">// 显示更新提示</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"有新版本可用！"</span>);
  }
}
</code></pre>
<h3 data-id="heading-9">5.2. 应用使用统计</h3>
<p>结合设备信息和应用信息，可以实现应用使用统计：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:device_info_plus/device_info_plus.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; trackAppUsage() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  DeviceInfoPlugin deviceInfo = DeviceInfoPlugin();
  
  <span class="hljs-built_in">String</span> trackingInfo = <span class="hljs-string">'''
  应用信息:
  - 名称: <span class="hljs-subst">${packageInfo.appName}</span>
  - 版本: <span class="hljs-subst">${packageInfo.version}</span>
  - 包名: <span class="hljs-subst">${packageInfo.packageName}</span>
  
  设备信息:
  '''</span>;
  
  <span class="hljs-keyword">if</span> (Platform.isAndroid) {
    AndroidDeviceInfo androidInfo = <span class="hljs-keyword">await</span> deviceInfo.androidInfo;
    trackingInfo += <span class="hljs-string">'- 设备: <span class="hljs-subst">${androidInfo.brand}</span> <span class="hljs-subst">${androidInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- 系统版本: Android <span class="hljs-subst">${androidInfo.version.release}</span>'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Platform.isIOS) {
    IosDeviceInfo iosInfo = <span class="hljs-keyword">await</span> deviceInfo.iosInfo;
    trackingInfo += <span class="hljs-string">'- 设备: <span class="hljs-subst">${iosInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- 系统版本: iOS <span class="hljs-subst">${iosInfo.systemVersion}</span>'</span>;
  }
  
  <span class="hljs-comment">// 实际项目中，这里会将统计信息发送到服务器</span>
  <span class="hljs-built_in">print</span>(trackingInfo);
}
</code></pre>
<h3 data-id="heading-10">5.3. 动态配置应用行为</h3>
<p>根据应用版本动态配置应用行为：</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; configureAppBehavior() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-comment">// 根据不同版本启用不同功能</span>
  <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.0.'</span>)) {
    <span class="hljs-comment">// v1.0.x 版本的配置</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'配置基础功能'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.1.'</span>)) {
    <span class="hljs-comment">// v1.1.x 版本的配置</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'配置高级功能'</span>);
  }
  
  <span class="hljs-comment">// 根据构建号启用测试功能</span>
  <span class="hljs-built_in">int</span> buildNumber = <span class="hljs-built_in">int</span>.tryParse(packageInfo.buildNumber) ?? <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (buildNumber &gt;= <span class="hljs-number">100</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'启用beta功能'</span>);
  }
}
</code></pre>
<h2 data-id="heading-11">6. 注意事项</h2>
<ul>
<li><strong>异步处理</strong>
<ul>
<li><code>PackageInfo.fromPackageInfo()</code> 是异步方法，必须正确处理异步操作</li>
<li>建议在应用启动时获取一次应用信息并缓存，避免重复获取</li>
<li>使用 <code>FutureBuilder</code> 或状态管理工具（如 Provider、Bloc）处理 UI 渲染</li>
</ul>
</li>
<li><strong>平台差异</strong>
<ul>
<li>不同平台上的信息可能有所不同，尤其是 <code>buildSignature</code> 和 <code>installerStore</code> 等平台特定属性</li>
<li>Web 平台需要手动配置元数据，其他平台则自动读取</li>
<li>处理平台特定属性时，应先检查其是否存在或不为空</li>
</ul>
</li>
<li><strong>版本号管理</strong>
<ul>
<li>保持 <code>pubspec.yaml</code>、AndroidManifest.xml 和 Info.plist 中的版本信息同步</li>
<li>建立清晰的版本号命名规则（如语义化版本 主版本.次版本.修订号）</li>
<li>构建号应随每次构建递增，用于区分不同构建</li>
</ul>
</li>
<li><strong>性能考虑</strong>
<ul>
<li>应用信息不会频繁变化，无需多次获取</li>
<li>建议在应用初始化阶段获取并存储在全局状态中</li>
<li>避免在 UI 渲染关键路径中获取应用信息</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">7. 常见问题解决</h2>
<ul>
<li><strong>信息不准确或未更新</strong>
<ul>
<li>确保所有平台的配置文件都已更新版本信息</li>
<li>运行 <code>flutter clean</code> 清理缓存后重新构建</li>
<li>对于 Web 平台，检查 <code>index.html</code> 中的元数据是否正确</li>
</ul>
</li>
<li><strong>某些属性为空</strong>
<ul>
<li>某些属性（如 <code>installerStore</code>）仅在特定条件下才有值</li>
<li>检查是否在正确的平台上访问平台特定属性</li>
<li>Web 平台需要手动配置所有属性</li>
</ul>
</li>
<li><strong>构建错误</strong>
<ul>
<li>确保使用的 <code>package_info_plus</code> 版本与 Flutter 版本兼容</li>
<li>检查是否正确导入了包</li>
<li>尝试更新插件到最新版本</li>
</ul>
</li>
</ul>
<h2 data-id="heading-13">8. 总结</h2>
<p><code>package_info_plus</code> 是 Flutter 开发中获取应用元数据的实用工具，它提供了简单直观的 API，支持多平台，能够满足大多数应用对获取自身信息的需求。</p>
<p>合理利用应用信息可以提升用户体验，简化开发流程，并为应用的统计分析提供支持。更多详细信息可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fpackage_info_plus" target="_blank" title="https://pub.dev/packages/package_info_plus" ref="nofollow noopener noreferrer">官方文档</a>。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7582808491582619684" target="_blank" title="https://juejin.cn/post/7582808491582619684">Flutter输入框TextField的属性与实战用法全面解析+示例</a></li>
<li><a href="https://juejin.cn/post/7581693431740448831" target="_blank" title="https://juejin.cn/post/7581693431740448831">Flutter自定义日历table_calendar完全指南+案例</a></li>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[四大组件齐上阵，轻松拿捏实习生]]></title>    <link>https://juejin.cn/post/7583891046206799924</link>    <guid>https://juejin.cn/post/7583891046206799924</guid>    <pubDate>2025-12-16T00:50:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583891046206799924" data-draft-id="7579095566900183080" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="四大组件齐上阵，轻松拿捏实习生"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2025-12-16T00:50:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            四大组件齐上阵，轻松拿捏实习生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:50:41.000Z" title="Tue Dec 16 2025 00:50:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><em>本系列为 Android 技术职场题材虚构小说，所有登场人物、公司名称、组织架构及相关情节均为创作所需虚构而来，若有雷同，纯属偶然。书中涉及的技术知识经专业梳理，仅供参考。</em></p>
<h2 data-id="heading-0">五）四大组件齐上阵，轻松拿捏实习生</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c629f988139f415bb914a6f10e38c65f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451041&amp;x-signature=9jBkfAtKsKpeqADMKq8QGZAdyGM%3D" alt="0.png" loading="lazy"/></p>
<p>新的一周开始了，晨会刚结束，老杨拍了拍林卓的肩膀：“你的小徒弟们来了，公司校招提前招了三个没毕业的大学生来实习，他们都有Java基础，也懂点Android入门知识，估计大学自己研究过Android，这周就交给你带教了。”</p>
<p>他顿了顿，忍不住吐槽：“说起来这年头大学里学Android开发的不多了，能有基础已经算不错啦。”</p>
<p>林卓转头望去，工位旁站着三个略显拘谨的年轻人，手里都攥着笔记本，眼神里满是期待与紧张——他们是晓雅、阿泽和博文，都是这次校招进来的实习生。</p>
<p>“我是林卓，负责你们本周的Android开发入门带教。”林卓笑着打破尴尬，“先带你们熟悉下公司环境，重点记一下开发部和测试部的位置，后续工作会经常对接。”</p>
<p>他带着三人穿梭在办公区，路过测试区时，恰好碰到小安在调试APP。只见她的桌子上摆满了各式各样的测试设备，从不同型号的手机到平板整齐排列，还有不少连接着设备的数据线，一看就是在进行多设备兼容性测试。三人看着这阵仗，心里顿时咯噔一下，暗自觉得测试工作原来如此严格，半点马虎不得。</p>
<p>“这是测试组的小安姐，你们写的代码最终都要过她的测试关。”</p>
<p>小安抬头冲三人温和一笑，抬手打了个招呼：“你们好呀，我是小安，负责APP测试相关的工作，以后多多指教。”</p>
<p>三个实习生连忙笑着回应“小安姐好”，眼神里满是礼貌与拘谨。</p>
<p>回到开发工位，林卓打开电脑说道：“今天上午的核心任务是搭建Android开发环境，相关配置文档我已经发你们邮箱了。安装时记得勾选 <strong>SDK</strong> 相关组件，尤其是咱们项目常用的 <strong>API 33</strong> 版本，遇到问题随时喊我。”</p>
<p>没过多久，留着波浪卷的晓雅便举手提问，语气活泼又带着几分急切：“林哥，<strong>SDK</strong> 安装失败了，提示找不到镜像源，是不是需要配置什么特殊设置啊？”</p>
<p>林卓走过去查看后，先笑着问晓雅：“你在大学学Android的时候，没碰到过 <strong>SDK</strong> 安装的问题吗？当时是怎么解决的？”</p>
<p>晓雅有些不好意思地挠挠头：“林哥，我们在学校都是学长提前帮我们装好了开发环境，用的Android版本也比较老，没涉及到镜像源配置这些操作，所以第一次自己装就卡壳了。”</p>
<p>林卓了然点头，随后解释道：“Android部分资源在国内访问速度较慢，需要在 <strong>SDK Manager</strong> 里配置国内镜像地址。另外记得勾选对应版本的 <strong>Sources for Android SDK</strong>，后续查看源码会比较方便。”</p>
<p>在林卓的逐一指导下，三人陆续解决了安装过程中的各类小问题，没多久就都完成了开发环境的搭建。</p>
<p>林卓看了眼时间，对三人说道：“开发环境都搞定了，咱们去培训室讲解知识点吧，那里环境更安静，也方便用投影演示代码。”说完便带头走向培训室，晓雅、阿泽和博文连忙带上笔记本和电脑跟了上去。</p>
<p>到了培训室，林卓连接好投影，打开 <strong>Android Studio</strong> 新建了一个项目：“开发环境搭建完成后，咱们先从最基础的配置文件入手，正式讲解Android四大组件。大家看投影上的项目结构，有没有注意到一个叫 <code>AndroidManifest.xml</code> 的文件？”</p>
<p>戴眼镜的阿泽立刻应声：“我知道这个文件，它是Android应用的全局配置文件！”</p>
<p>“没错，”林卓赞许地点点头，“它就像应用的‘身份证’，系统正是通过它识别APP包含的组件、所需的权限以及应用入口等核心信息。”</p>
<p>他指着代码中的 <code>&lt;activity&gt;</code> 标签讲解：“这个 <code>MainActivity</code> 就是咱们APP的主启动页面，通过 <code>intent-filter</code> 里的 <code>MAIN</code> 和 <code>LAUNCHER</code> 属性声明。要是没配置这个入口，桌面上不会显示应用图标，用户也就无法直接启动APP了。”</p>
<p>博文突然开口提问：“那 <code>Service</code> 这类其他组件，也需要在这个文件里注册吗？”</p>
<p>林卓心里暗自了然：看来这三个实习生在学校偏重于界面开发，像 <code>Service</code> 这种后台组件接触得不多，难怪会有这个疑问，得好好把基础讲扎实了。</p>
<p>“问得很关键，”林卓补充道，“Android四大组件都必须在 <code>AndroidManifest.xml</code> 里注册，包括 <code>Service</code>、<code>BroadcastReceiver</code> 和 <code>ContentProvider</code>，否则系统无法识别和启动这些组件。”</p>
<p>晓雅紧跟着追问：“林哥，要是注册时填错了组件名称，会出现什么问题？会不会导致APP直接崩溃啊？”</p>
<p>林卓点头回应：“会的，这种情况下不管是启动该组件，还是后续使用到它，都会直接触发崩溃。”</p>
<p>晓雅立刻追着问：“那崩溃后有什么快速排查方法吗？比如日志里会有明确提示吗？”</p>
<p>林卓继续解答：“日志里会报 <code>ClassNotFoundException</code> 异常，到时直接搜索这个异常信息，就能快速定位到 <code>AndroidManifest</code> 里的配置错误，排查起来很方便。”</p>
<p>他顿了顿，补充了一个关联知识点：“对了，顺带提一下 <code>Application</code> ——它是整个应用的全局入口，在所有组件初始化之前创建，适合用来初始化数据库、网络库这类全局资源。”</p>
<p>“但别在它的 <code>onCreate</code> 方法里做耗时操作，否则会拖慢APP启动速度；而且它的生命周期和应用进程绑定，和 <code>Activity</code> 这种频繁创建销毁的组件完全不同。”</p>
<p>讲完 <code>AndroidManifest</code> 的基础配置和 <code>Application</code> 的关联知识，林卓看了眼时间，明确了当天的学习安排：“咱们今天分上下午推进学习，上午重点讲解 <code>Activity</code> 这个核心组件，先打牢基础；下午再讲解剩下的<code>Service</code>、<code>BroadcastReceiver</code> 和 <code>ContentProvider</code>。现在，咱们从最核心的 <code>Activity</code> 开始讲起。”</p>
<p>“<code>Activity</code> 是 APP与用户交互的核心入口，主要负责UI展示。大家可以想一想，打开一个APP从启动到退出，<code>Activity</code> 会经历哪些过程？”林卓抛出问题引导思考。</p>
<p>晓雅回忆片刻，立刻接话：“应该是创建、启动、运行，最后关闭吧？”</p>
<p>“这个概括比较笼统，Android系统为 <code>Activity</code> 定义了明确的生命周期回调方法。”林卓打开一个示例代码，逐一标出 <code>onCreate</code>、<code>onStart</code>、<code>onResume</code> 等核心方法。</p>
<p>他详细解释道：“比如首次启动 <code>Activity</code>，会依次执行 <code>onCreate</code>→<code>onStart</code>→<code>onResume</code>；”</p>
<p>“当你打开一个新 <code>Activity</code> 把它覆盖时，它会先执行 <code>onPause</code>，等完全不可见后再执行 <code>onStop</code>；”</p>
<p>“要是按返回键退出，就会依次执行 <code>onPause</code>→<code>onStop</code>→<code>onDestroy</code>。”</p>
<p>阿泽紧接着追问：“那要是旋转手机屏幕，<code>Activity</code> 会发生什么变化？”</p>
<p>晓雅也跟着点头：“对，我之前试过旋转屏幕后，输入的内容就不见了，这种问题怎么解决最稳妥呢？”</p>
<p>林卓笑着回应：“这是开发中很常见的关键问题，默认情况下，屏幕旋转这类配置变更会导致 <code>Activity</code> 重启，之前的UI状态也就随之丢失。”</p>
<p>他给出具体解决方案：“解决办法有几种，比如用 <code>onSaveInstanceState</code> 方法保存临时状态；当前推荐的是用 <code>ViewModel</code> 存储数据，它能在 <code>Activity</code> 重建时保留数据，避免状态丢失。”</p>
<p>他顿了顿，又补充道：“如果你不想 <code>Activity</code> 重启，可以在 <code>AndroidManifest</code> 里给 <code>Activity</code> 添加 <code>android:configChanges</code> 属性，手动处理配置变更。这是对用户比较友好的方案。”</p>
<p>“所谓条条大路通罗马，方法有很多种，具体使用哪种，可以等碰到的时候再说！”</p>
<p>此时，恰好小安端着水杯路过培训室门口，本想进去打个招呼。</p>
<p>可看到晓雅频频提问，林卓却始终耐心细致地解答，眼神里满是专注，她手里的水杯不自觉地捏紧了些。</p>
<p>脚步微微一顿，小安终究没走进培训室，转身默默走开了。</p>
<p>为了让三人加深理解，林卓安排了一个实操练习：“你们在培训室的电脑上创建两个 <code>Activity</code>，实现跳转功能，同时打印出每个生命周期方法的执行日志，直观感受一下生命周期的流转过程。”</p>
<p>博文很快完成了练习，却发现一个疑问：“林哥，我从 <code>Activity A</code> 跳转到 <code>Activity B</code>，<code>A</code> 的 <code>onStop</code> 方法不是立刻执行的，而是等 <code>B</code> 启动完成后才执行。”</p>
<p>“这正是 <code>Activity</code> 生命周期的核心执行顺序，”林卓耐心讲解，“切换 <code>Activity</code> 时，系统会先执行旧 <code>Activity</code> 的 <code>onPause</code> 方法，再启动新 <code>Activity</code> 的生命周期；等新 <code>Activity</code> 完全显示后，旧 <code>Activity</code> 才会执行 <code>onStop</code> 方法。”</p>
<p>他进一步引导：“你们可以试试从 <code>B</code> 返回 <code>A</code>，看看 <code>A</code> 会执行 <code>onRestart</code> 还是 <code>onCreate</code> 方法，加深对生命周期复用的理解。”</p>
<p>晓雅又举手提问：“林哥，那如果我在 <code>onPause</code> 里做保存数据的操作，会不会影响新 <code>Activity</code> 的启动速度啊？”</p>
<p>“这个顾虑很有必要，”林卓解释道，“<code>onPause</code> 里尽量只做轻量级操作，比如保存少量UI临时状态。”</p>
<p>“另外要重点提醒大家，不管是 <code>onPause</code> 还是 <code>onStop</code>，都不建议执行耗时操作。”</p>
<p>“至于耗时操作该放在哪里处理，后续咱们讲 <code>ViewModel</code> 和线程开发时再详细说明，现在先记住这个核心原则即可。”</p>
<p>培训室外的办公区里，小安调试代码时，余光总会不自觉地瞥向培训室的方向。</p>
<p>一想到林卓在里面耐心给晓雅解答问题的样子，她敲键盘的速度就慢了下来，心里莫名泛起一丝说不清道不明的酸胀感。</p>
<p><code>Activity</code> 的生命周期讲解和实操练习刚收尾，就临近中午了。林卓宣布休息：“上午的内容就到这里，大家先去吃午饭，好好休息一下，下午咱们准时在培训室集合，讲解 <code>Service</code> 组件。”</p>
<p>打发走三个实习生后，林卓习惯性地走向测试区——往常这个时间点，他都会和小安一起去公司食堂吃饭。可到了小安的工位前，只看到摊开的测试用例，人却早已不在。林卓环顾了一圈办公区，没找到小安的身影，只好作罢，独自去了食堂。</p>
<p>下午刚到培训室，林卓便开启了新组件的讲解：“上午咱们掌握了与用户交互的 <code>Activity</code>，那么，什么组件负责执行后台任务，不依赖UI存在，就算APP退到后台也能继续运行呢？”</p>
<p>“<code>Service</code>！”三人异口同声地回应，显然对这个组件早有耳闻。</p>
<p>博文难得主动开口追问：“林哥，<code>Service</code> 启动后会一直在后台运行吗？会不会被系统杀死啊？”</p>
<p>“<code>Service</code> 确实会在后台运行，但它也分不同类型。”林卓打开示例代码，开始逐一讲解。</p>
<p>他详细说明：“通过 <code>startService</code> 启动的是启动型 <code>Service</code>，一旦启动就会在后台独立运行，直到调用 <code>stopSelf</code> 方法或其他组件调用 <code>stopService</code>，它才会停止；”</p>
<p>“还有一种是绑定型 <code>Service</code>，通过 <code>bindService</code> 方法绑定，适合与其他组件（比如 <code>Activity</code>）进行通信，比如音乐APP中，<code>Activity</code> 就是通过绑定 <code>Service</code> 来控制音乐的播放和暂停。”</p>
<p>讲完两种 <code>Service</code> 的基础类型，林卓话锋一转，引入重点场景：“不过有个关键场景要跟大家强调，比如开发音乐播放这类后台任务时，咱们一般不用普通 <code>Service</code>，而是会选用前台 <code>Service</code>。”</p>
<p>阿泽立刻追问：“林哥，为什么播放音乐要特意用前台 <code>Service</code> 啊？普通 <code>Service</code> 不能实现这个功能吗？”</p>
<p>“问得非常好，”林卓赞许地说道，“普通 <code>Service</code> 的系统优先级较低，当手机内存不足时，或者系统资源紧张时，很容易被系统回收；”</p>
<p>“而前台 <code>Service</code> 会在系统通知栏显示一个常驻通知，以此提升自身优先级，更不容易被系统杀死，能保证后台任务的稳定运行。”</p>
<p>他补充了版本限制细节：“从 <code>Android 8.0</code> 开始，系统对后台 <code>Service</code> 的运行有了更多限制，前台 <code>Service</code> 成为执行长期后台任务的更稳妥选择。”</p>
<p>最后，林卓着重提醒三人：“还有一个核心注意点——<code>Service</code> 默认运行在主线程中，要是在里面执行耗时操作，很容易导致APP出现 <strong>ANR</strong> 问题。所以遇到耗时任务时，必须在 <code>Service</code> 内部开启子线程来处理。”</p>
<p><code>Service</code> 的核心用法和注意事项讲解完毕后，林卓给三人留了十分钟消化时间。</p>
<p>随后继续推进课程：“接下来咱们讲解第三个组件——<code>BroadcastReceiver</code>，它主要用于接收和响应系统或应用内的广播事件，比如监听网络状态变化、设备开机完成等场景。咱们快速做个小实验熟悉下，就尝试接收一个简单的系统广播。”</p>
<p>晓雅按照文档上的基础方法，在 <code>AndroidManifest</code> 里静态注册了一个系统广播接收器，可运行后却发现完全接收不到广播消息，不由得皱起了眉头：“林哥，我步骤都按课本上的来的，怎么收不到广播啊？”</p>
<p>林卓走过去查看了她的代码，笑着解释：“这是 <code>Android</code> 开发中很容易踩的坑，并不是所有广播的静态注册都会受限，核心规则是‘从 <code>Android 8.0</code> 开始，大多数隐式广播的静态注册被系统限制’。”</p>
<p>他顿了顿，补充了这条规则的历史背景：“之所以加这个限制，是因为早年有不少像359这类公司开发的流氓软件，专门监听各类系统广播，比如开机启动、网络切换等事件，一旦触发就会把自己的APP偷偷唤醒，用户就算手动杀死进程也没用，严重影响手机性能和用户体验。”</p>
<p>“后来谷歌为了整治这种乱象，就调整了广播的运行机制，限制了大部分隐式广播的静态注册。咱们这次实验的自定义隐式广播，就属于受限范围。”</p>
<p>他给出对应的解决方案：“针对这种自定义隐式广播场景，应该采用动态注册的方式——在 <code>Activity</code> 的 <code>onStart</code> 方法里注册广播接收器，在 <code>onStop</code> 方法里及时注销，这样既能正常接收广播，也能避免出现内存泄漏问题。”</p>
<p>林卓特意补充了一句建议：“后续你们实际开发中，也尽量优先用动态注册的广播，不仅能规避版本适配的坑，还能根据组件的生命周期灵活控制广播的注册与注销，安全性和灵活性都更高。”</p>
<p>“另外要提醒大家，广播接收器的生命周期非常短，绝对不能在 <code>onReceive</code> 方法里面执行耗时操作或者运行长时间的后台任务，否则很容易引发一系列运行问题。”</p>
<p>阿泽突然想到一个应用场景，问道：“那要是想在不同应用之间传递消息，是不是可以用自定义广播实现？”</p>
<p>“可以实现，但一定要注意数据安全，”林卓提醒道，“自定义广播可以通过设置访问权限，限制只有授权的APP才能接收，这样能避免敏感信息泄露，提升APP的安全性。”</p>
<p>广播接收器的实验和注意事项梳理完毕后，林卓加快了讲解节奏：“下午最后一个要讲的组件是 <code>ContentProvider</code>，它相当于APP的数据中转站，主要负责跨应用或应用内的数据共享，讲完这个咱们今天的知识点就全部收尾了。”</p>
<p>他先解释其核心作用：“<code>ContentProvider</code> 的核心价值在于数据共享与安全——它会封装数据访问逻辑，对外提供统一的操作接口，其他组件或应用无需关心数据的存储方式（比如是数据库还是文件），就能实现数据的访问；”</p>
<p>“同时它还能对数据访问进行权限控制，保证数据安全。”</p>
<p>林卓打开一个 <code>ContentProvider</code> 的示例代码，重点讲解 <strong>URI</strong> 的组成规则：“<code>URI</code> 是访问 <code>ContentProvider</code> 的唯一标识，主要由三部分组成——”</p>
<p>“<code>Authority</code> 是 <code>ContentProvider</code> 的唯一标识，比如 <code>com.example.provider</code>；”</p>
<p>“<code>Path</code> 用于指定数据类型，比如<code>/users</code>代表用户数据；”</p>
<p>“<code>ID</code> 则指向具体的数据项，比如 <code>/users/1</code> 就代表 <code>ID</code> 为 <code>1</code> 的用户数据。”</p>
<p>阿泽追问：“那其他组件或应用想访问 <code>ContentProvider</code> 的数据，需要通过什么方式操作呢？”</p>
<p>“需要通过 <code>ContentResolver</code> 来操作，”林卓解释道，“不管是查询、插入、更新还是删除数据，都要通过 <code>ContentResolver</code> 这个‘中间件’来执行，而不是直接与 <code>ContentProvider</code> 交互，这样能实现数据层与业务层的解耦，提升代码的可维护性。”</p>
<p>他的话刚落，晓雅就紧跟着提出疑问：“林哥，那如果我自己写一个 <code>ContentProvider</code> 给其他APP用，是不是任何APP都能随便访问啊？不用做什么限制措施吗？”</p>
<p>林卓笑着回应：“当然不是，这里有两个关键知识点要记牢，能有效解决你的顾虑。”</p>
<p>“首先是 <code>AndroidManifest</code> 里的 <code>exported</code> 属性——它直接决定了 <code>ContentProvider</code> 是否允许外部APP访问：想开放给其他APP访问，就把它设为 <code>true</code>；要是只在自己APP内部使用，就设为 <code>false</code>，能从根源上避免外部恶意访问。”</p>
<p>“其次还可以在 <code>AndroidManifest</code> 里配置访问权限，限制只有获得授权的APP才能访问，通过这双重保障，就能有效保护数据安全。”</p>
<p>讲解完 <code>ContentProvider</code> 的访问限制后，林卓又延伸了一个实用知识点：“除了数据共享，很多第三方库还会利用 <code>ContentProvider</code> 来实现资源初始化，比如 <strong>Firebase</strong> 就是如此——它的初始化逻辑是在 <code>ContentProvider</code> 的 <code>onCreate</code> 方法里完成的，而且这个方法会在 <code>Application</code> 的 <code>onCreate</code> 之前执行，大家后续使用第三方库时可以留意下这种设计思路。”</p>
<p>借着这个话题，他顺势衔接前文，进一步细化 <code>Application</code> 的相关知识：“说到初始化，正好再跟大家明确下 <code>Application</code> 的核心用法——它是整个应用的全局入口，在所有组件初始化之前创建，非常适合用来初始化数据库、网络库这类全局资源。”</p>
<p>“但一定要注意，别在它的 <code>onCreate</code> 方法里做耗时操作，否则会直接拖慢APP的启动速度。”</p>
<p>阿泽好奇地追问：“那 <code>Application</code> 和 <code>Activity</code> 的生命周期有什么本质区别呢？”</p>
<p>“嘿嘿，你小子，上午没好好听是吧，拿我说的详细点儿。”，林卓打趣道。</p>
<p>“最核心的区别在于生命周期的长短，<code>Application</code> 的生命周期和应用进程绑定，只要应用进程不被系统杀死，它就会一直存在；”</p>
<p>“而 <code>Activity</code> 的生命周期是独立的，会随着用户的操作频繁创建和销毁，比如切换页面、旋转屏幕都可能触发 <code>Activity</code> 的重建。”</p>
<p>他还点出了一个开发中常见的“坑”：“还有个容易引发内存泄漏的操作要提醒大家——不要在单例中持有 <code>Activity</code> 的 <code>Context</code>。”</p>
<p>“因为 <code>Activity</code> 销毁后，单例还会持有它的引用，导致它无法被垃圾回收。”</p>
<p>他带着几分自嘲说道：“说起来惭愧，这个坑我前阵子刚踩过。“</p>
<p>“这种场景下应该使用 <code>Application</code> 的 <code>Context</code>，它的生命周期和应用一致，不会引发内存泄漏问题。”</p>
<p>四大组件的核心知识全部讲解完毕后，林卓在培训室里给三人布置了课后小项目：“今天的知识点比较密集，这个项目正好帮你们巩固所学内容。”</p>
<p>项目需要实现四个核心功能：两个 <code>Activity</code> 的跳转、一个播放音乐的前台 <code>Service</code>、一个监听网络状态的广播接收器，以及一个用 <code>ContentProvider</code> 访问本地数据的模块。</p>
<p>“明天给你们一天时间开发，后天上班咱们还在培训室集合，逐一检查项目成果。”</p>
<p>培训室外，小安整理测试用例时，目光总会不自觉地飘向培训室的方向。</p>
<p>眉头微微蹙起，心里的烦躁感难以掩饰。</p>
<p>直到同事喊她回测新发现的Bug，她才猛地收回目光。</p>
<p>深吸一口气，强行把注意力拉回到工作上。</p>
<p>培训结束后，林卓正收拾投影设备，晓雅、阿泽和博文却没立刻离开，反而围了上来，各自带着笔记本上前请教培训中没吃透的问题。</p>
<p>博文翻着笔记本，语气带着几分迟疑地开口：“林哥，今天讲的知识点有点多，我对 <code>ContentProvider</code> 的 <code>exported</code> 属性配置不太确定，担心实际开发时会出错。”</p>
<p>“这些基础知识点确实需要多琢磨，”林卓耐心回应，“尤其是组件注册、权限配置这些细节，稍有疏忽就会出问题。像四大组件的生命周期、<code>Context</code> 的正确使用、内存泄漏和 <strong>ANR</strong> 的预防措施，既是日常开发的核心技能，也是面试重点，大家有疑问随时找我问。”</p>
<p>晓雅突然想起什么似的，连忙说道：“林哥林哥，我大学的时候自己做过一些小案例，碰到过 <code>Fragment</code> 里嵌套 <code>Fragment</code> 的情况，当时就没搞明白该用哪个 <code>Manager</code> 来管理，总担心用混了出问题，你能给讲讲吗？”</p>
<p>林卓闻言先是愣了一下，随即笑着感叹：“没想到你在大学还接触过这种场景，学的东西还挺前沿。”</p>
<p>“<code>Fragment</code> 嵌套可是现在开发里很常用的现代化用法，我今天还没讲这块内容。”</p>
<p>紧接着他认真解答起来：“不过你这个问题问得很有价值，在 <code>Fragment</code> 里嵌套 <code>Fragment</code> 时，必须用 <code>childFragmentManager</code>。”</p>
<p>“它是 <code>Fragment</code> 专属的管理器，专门负责管理子 <code>Fragment</code> 的生命周期和事务，能精准控制子 <code>Fragment</code> 的状态。”</p>
<p>怕三人混淆，他又进一步补充两者的核心区别：“大家要记住，<code>getFragmentManager</code> 或者 <code>FragmentActivity</code> 里的 <code>supportFragmentManager</code> 是用来管理 <code>Activity</code> 级别的 <code>Fragment</code> 的。”</p>
<p>“它和 <code>childFragmentManager</code> 的作用域完全不同，一旦用混很容易出现界面异常甚至崩溃问题，千万别大意。”</p>
<p>老杨路过培训室，看到三人认真听讲解的样子，对林卓投去了赞许的目光。</p>
<p>解答完实习生的问题，看着三人满载收获离开，林卓才收拾好培训室的设备，回到自己的工位。</p>
<p>刚坐下打开电脑，他就注意到 <strong>BugTracker</strong> 弹出了一连串Bug提醒。</p>
<p>点开一看，里面堆积了不少待处理的Bug，都是这一天培训期间新增的。</p>
<p>他揉了揉眉心，正打算梳理优先级，老杨就笑着走了过来。</p>
<p>“小林，今天带教做得不错啊，”老杨拍了拍他的肩膀，语气里满是赞许。</p>
<p>“我路过培训室好几次，都看到那三个实习生听得特别认真，看来你讲得很对他们的胃口。”</p>
<p>林卓闻言笑了笑：“他们本身有基础，学起来也快。”</p>
<p>林卓心里颇有感触，这次带教不仅帮助实习生快速入门Android开发，也让自己对这些基础知识点有了更深刻、更系统的理解，可谓教学相长。</p>
<p>闲聊两句后，林卓想起白天没见到小安，忍不住问道：“对了杨哥，我今天一整天都没碰到小安，她是请假了还是手头测试任务太忙了？”</p>
<p>老杨闻言挑了挑眉，露出一副“我懂”的表情，打趣道：“她没请假，就在工位上忙呢。我看啊，你接下来这两天可得悠着点，估计你的Bug会格外多。”</p>
<p>林卓愣了一下，没明白其中的缘由。老杨见状笑出了声，拍了拍他的胳膊打趣道：“你这小子，搞技术、带徒弟都机灵，这点事儿倒转不过弯来。”</p>
<p>林卓愣了两秒才反应过来。中午去找小安一起吃饭，却没在工位上见到她的身影。</p>
<p>他心里不由得泛起一丝异样，一时不知该说些什么。</p>
<p>老杨看他这副模样，没再多说，只是笑着摇了摇头，转身离开时轻声感慨了一句：“年轻真好。”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis内存管理与优化策略：避免OOM的最佳实践]]></title>    <link>https://juejin.cn/post/7583952017673830451</link>    <guid>https://juejin.cn/post/7583952017673830451</guid>    <pubDate>2025-12-16T00:48:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017673830451" data-draft-id="7490814827147689994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis内存管理与优化策略：避免OOM的最佳实践"/> <meta itemprop="keywords" content="Redis,数据库,性能优化"/> <meta itemprop="datePublished" content="2025-12-16T00:48:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis内存管理与优化策略：避免OOM的最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:48:37.000Z" title="Tue Dec 16 2025 00:48:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">一、引言</h4>
<p>Redis 作为一款高性能的内存数据库，早已成为现代互联网应用的宠儿。无论是用作缓存加速访问、存储用户会话，还是驱动实时排行榜，它的身影无处不在。然而，正如一辆跑车需要精心调校才能发挥极致性能，Redis 的内存管理也是一门需要细心打磨的技术活。内存溢出（Out of Memory, OOM）问题就像一颗定时炸弹，随时可能让你的服务宕机、性能暴跌，甚至让用户流失。想象一下，电商秒杀活动中因内存耗尽导致库存数据丢失，或者社交平台因缓存堆积而无法加载动态——这些都是 OOM 带来的真实噩梦。</p>
<p>这篇文章的目标读者是那些已经有 1-2 年 Redis 使用经验的开发者。你可能已经熟悉基本的 <code>SET</code>、<code>GET</code> 操作，也配置过简单的缓存，但偶尔会被内存暴涨、淘汰策略失效等问题搞得焦头烂额。别担心，我将带你深入 Redis 的内存管理机制，分享避免 OOM 的优化策略，并通过实战案例帮你把理论转化为代码能力。无论你是想提升现有项目的稳定性，还是准备迎接高并发场景的挑战，这篇文章都会给你一些实用的启发。</p>
<p>我在过去 10 年的开发中，见证了无数 Redis 相关的“事故现场”。印象最深的一次，是在一个电商秒杀活动中，由于未合理分片商品库存缓存，一个 Hash Key 占用了超过 2GB 内存，最终触发 OOM，系统直接崩溃。事后复盘，我们不仅优化了数据结构，还调整了内存配置，才让后续活动平稳运行。这次经历让我深刻认识到，Redis 的内存管理绝不是“配置一下就完事”，而是需要从设计到监控的全方位考量。接下来，就让我们一起拆解这些问题，找到应对之道吧！</p>
<hr/>
<h4 data-id="heading-1">二、Redis内存管理基础</h4>
<p>在优化 Redis 内存之前，我们得先搞清楚它的“内存账本”是怎么算的。理解这些基础机制，就像给一栋房子打地基，只有根基扎实，才能建起稳固的高楼。接下来，我会带你看看 Redis 的内存管理机制、OOM 的常见触发场景，并通过一个简单示例让你直观感受问题所在。</p>
<h5 data-id="heading-2">2.1 Redis内存管理机制概述</h5>
<p>Redis 是一款纯内存数据库，它的所有数据都驻留在 RAM 中。为了高效管理内存，Redis 使用了 jemalloc 作为默认内存分配器。jemalloc 的优点是分配速度快且能减少内存碎片，但它并非万能灵药，稍后我们会聊到碎片的“隐形杀手”角色。</p>
<p>Redis 的数据存储结构也直接影响内存占用。比如，字符串使用 SDS（Simple Dynamic String）来优化内存和性能，小范围整数集合用 ziplist 压缩存储，而跳表（skiplist）则支撑了有序集合的高效查询。这些结构在不同场景下各有千秋，但用得不当也可能成为内存暴涨的元凶。比如，一个超大的 Hash 如果没启用 ziplist，就可能占用远超预期的内存。</p>
<p>内存碎片是另一个绕不开的话题。假设你频繁删除和新增数据，内存就像一块被啃得坑坑洼洼的奶酪，虽然总量没变，但可用空间却零散得无法塞下大块数据。这种碎片化会让 Redis 的实际可用内存远低于预期。</p>
<p><strong>简单示意图：内存碎片的产生</strong></p>
<pre><code class="hljs language-scss" lang="scss">初始内存： <span class="hljs-selector-attr">[██████████]</span> (<span class="hljs-number">10</span>MB 全可用)
频繁操作后： <span class="hljs-selector-attr">[███  ██  ████ ]</span> (碎片化，实际可用不足)
</code></pre>
<h5 data-id="heading-3">2.2 OOM的常见触发场景</h5>
<p>OOM 并不是凭空出现的，它往往有迹可循。以下是几个典型场景：</p>
<ul>
<li><strong>数据量激增</strong>：缓存未设置过期时间，冷数据堆积如山。比如，会话缓存忘了清理，用户量一涨，内存就爆了。</li>
<li><strong>大Key问题</strong>：一个 Hash 或 Set 塞进了几十万条记录，单 Key 占用动辄几百 MB。比如社交平台把所有用户动态塞到一个 List。</li>
<li><strong>配置不当</strong>：没设置 <code>maxmemory</code>，或者设置得过高超过了物理内存，导致 Redis 无限制吃掉服务器资源。</li>
</ul>
<p>这些场景就像水管漏水，滴滴答答时不显眼，但积少成多就会淹没整个系统。</p>
<h5 data-id="heading-4">2.3 示例代码与场景</h5>
<p>来看一个简单的例子，展示 Hash 大 Key 如何引发内存暴涨。假设我们在一个社交平台缓存用户动态：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 错误示例：将所有用户动态塞进一个 Hash</span>
HSET user_feeds:user123 post1 <span class="hljs-string">"Hello world"</span> 
HSET user_feeds:user123 post2 <span class="hljs-string">"Nice day"</span> 
<span class="hljs-comment">// 假设 user123 有 100 万条动态，持续追加...</span>
</code></pre>
<p><strong>问题分析</strong>：如果 <code>user_feeds:user123</code> 存储了 100 万条动态，每条 100 字节，这个 Key 就占用了近 100MB 内存。更糟的是，如果多个用户都这么存，内存很快就会不堪重负，最终触发 OOM。</p>
<p><strong>真实场景</strong>：我曾在项目中遇到类似问题。当时一个社交应用的动态缓存没做分片，一个热门用户的 Hash Key 涨到 1.5GB，Redis 实例直接崩溃。事后我们通过分片和淘汰策略才解决问题，这也为后续优化埋下了伏笔。</p>
<p><strong>内存占用估算表</strong></p>

























<table><thead><tr><th>数据量</th><th>单条大小</th><th>总占用</th></tr></thead><tbody><tr><td>10 万条</td><td>100 字节</td><td>~10MB</td></tr><tr><td>100 万条</td><td>100 字节</td><td>~100MB</td></tr><tr><td>1000 万条</td><td>100 字节</td><td>~1GB</td></tr></tbody></table>
<p>从基础机制到触发场景，我们已经摸清了 Redis 内存管理的脉络。接下来，我们将进入优化策略的核心部分，探讨如何通过配置、设计和监控，彻底告别 OOM 的困扰。</p>
<hr/>
<h4 data-id="heading-5">三、避免OOM的核心优化策略</h4>
<p>理解了 Redis 的内存管理基础后，我们终于要进入“实战演练”环节了。避免 OOM 不是靠运气，而是需要从配置、数据设计到监控的全方位优化。就像修水管，既要堵住漏洞，还要确保水流顺畅。接下来，我将分享四种核心策略，每一种都配有代码示例、项目经验和踩坑教训，帮你在 Redis 的内存管理中游刃有余。</p>
<h5 data-id="heading-6">3.1 合理配置maxmemory与淘汰策略</h5>
<p>Redis 的 <code>maxmemory</code> 是内存管理的“总阀门”，它决定了 Redis 最多能用多少内存。如果不设置，Redis 会像个贪吃的孩子，把服务器内存吃光，最终触发 OOM。设置原则很简单：<strong>留出 20%-30% 的缓冲区给系统和碎片</strong>。比如，服务器有 16GB 内存，建议 <code>maxmemory</code> 设为 10-12GB。</p>
<p>但光有阀门还不够，内存满了怎么办？这就轮到淘汰策略上场了。Redis 提供了多种选择，比如 <code>volatile-lru</code>（对设置了过期时间的键使用最近最少使用淘汰）、<code>allkeys-lru</code>（对所有键使用 LRU）和 <code>volatile-ttl</code>（优先淘汰剩余时间短的键）。每种策略都有自己的“脾气”：</p>
<ul>
<li><strong>volatile-lru</strong>：适合有明确过期需求的场景，比如会话缓存。</li>
<li><strong>allkeys-lru</strong>：适合热点数据频繁变化的场景，比如排行榜。</li>
<li><strong>volatile-ttl</strong>：适合临时数据多的场景，比如验证码。</li>
</ul>
<p><strong>最佳实践</strong>：我在一个电商订单缓存项目中使用了 <code>volatile-lru</code>，为每条订单数据设置 24 小时过期时间，避免冷数据挤占内存。效果很好，内存占用稳定在 60% 左右。但也有踩坑经历：早期用 <code>allkeys-lru</code> 时，因为没区分冷热数据，热销商品的缓存被误删，导致数据库压力激增。</p>
<p><strong>代码示例：配置并测试淘汰策略</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置 maxmemory 为 2GB</span>
CONFIG SET maxmemory 2gb
<span class="hljs-comment"># 使用 volatile-lru 策略</span>
CONFIG SET maxmemory-policy volatile-lru

<span class="hljs-comment"># 测试脚本：插入数据并观察淘汰</span>
redis-cli &lt;&lt;<span class="hljs-string">EOF
SETEX key1 3600 "value1"  # 过期时间 1 小时
SETEX key2 3600 "value2"
# 持续插入数据直到超过 2GB，观察 key1、key2 是否被淘汰
EOF</span>
</code></pre>
<p><strong>淘汰策略对比表</strong></p>





























<table><thead><tr><th>策略</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>volatile-lru</td><td>会话、临时缓存</td><td>保护无过期键</td><td>未设置过期键不淘汰</td></tr><tr><td>allkeys-lru</td><td>热点数据缓存</td><td>全局优化内存</td><td>可能误删重要数据</td></tr><tr><td>volatile-ttl</td><td>短生命周期数据</td><td>优先清理快过期键</td><td>对长生命周期键无效</td></tr></tbody></table>
<h5 data-id="heading-7">3.2 数据结构优化与分片设计</h5>
<p>Redis 的数据结构就像厨房里的锅碗瓢盆，用对了事半功倍，用错了浪费空间。比如，一个小型 Hash 用 ziplist 存储能省不少内存，但数据量大了转成 hashtable 就可能暴涨。选择合适的数据结构是优化的第一步。</p>
<p>更关键的是处理大 Key。假设一个 Set 存了 100 万条记录，内存占用可能轻松破 GB。解决办法是<strong>分片设计</strong>：把大 Key 拆成多个小 Key。比如，一个用户动态列表可以按时间分片：</p>
<ul>
<li><code>user_feeds:user123:202504</code>（4 月数据）</li>
<li><code>user_feeds:user123:202505</code>（5 月数据）</li>
</ul>
<p><strong>最佳实践</strong>：在一个游戏排行榜项目中，我们把全局排行榜分片成 100 个小 Hash（<code>rank:shard:0</code> 到 <code>rank:shard:99</code>），每个 Hash 只存 1 万条记录。内存占用从 2GB 降到 300MB，查询性能也没受影响。但也有教训：早期用 List 存排行榜，没分片导致内存碎片率飙升到 1.8，重启才解决。</p>
<p><strong>代码示例：Hash分片存储用户数据</strong></p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- Lua 脚本：分片存储用户动态</span>
<span class="hljs-keyword">local</span> user_id = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> post_id = ARGV[<span class="hljs-number">2</span>]
<span class="hljs-keyword">local</span> content = ARGV[<span class="hljs-number">3</span>]
<span class="hljs-keyword">local</span> shard = <span class="hljs-built_in">tostring</span>(<span class="hljs-built_in">tonumber</span>(post_id) % <span class="hljs-number">10</span>)  <span class="hljs-comment">-- 按 post_id 取模分片</span>
<span class="hljs-keyword">local</span> key = <span class="hljs-string">"user_feeds:"</span> .. user_id .. <span class="hljs-string">":shard"</span> .. shard
redis.call(<span class="hljs-string">"HSET"</span>, key, post_id, content)
<span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>
</code></pre>
<p><strong>示意图：分片前后内存对比</strong></p>
<pre><code class="hljs language-scss" lang="scss">未分片： <span class="hljs-selector-attr">[██████████]</span> (<span class="hljs-number">1</span>GB 一个大 Key)
分片后： <span class="hljs-selector-attr">[██]</span><span class="hljs-selector-attr">[██]</span><span class="hljs-selector-attr">[██]</span><span class="hljs-selector-attr">[██]</span><span class="hljs-selector-attr">[██]</span> (<span class="hljs-number">5</span> 个 <span class="hljs-number">200</span>MB 小 Key)
</code></pre>
<h5 data-id="heading-8">3.3 过期策略与主动清理</h5>
<p>Redis 的 <code>EXPIRE</code> 命令是清理冷数据的利器，但它并非“自动保姆”。Redis 采用惰性删除和定期删除结合的方式，过期键不一定立刻被清理，尤其在高负载时，可能堆积导致内存超预期。</p>
<p>主动清理是个好帮手。比如，用 Lua 脚本定期扫描并删除无用数据。我在会话缓存项目中给每个 session 设置动态 TTL（活跃用户延长，非活跃缩短），配合脚本清理，内存占用降低了 40%。但也踩过坑：早期以为 <code>EXPIRE</code> 万能，结果过期键堆积，<code>used_memory</code> 超标才发现问题。</p>
<p><strong>代码示例：Lua脚本批量清理过期数据</strong></p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- 清理指定前缀下过期超过 1 天的键</span>
<span class="hljs-keyword">local</span> prefix = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> cursor = <span class="hljs-string">"0"</span>
<span class="hljs-keyword">repeat</span>
    <span class="hljs-keyword">local</span> result = redis.call(<span class="hljs-string">"SCAN"</span>, cursor, <span class="hljs-string">"MATCH"</span>, prefix .. <span class="hljs-string">"*"</span>, <span class="hljs-string">"COUNT"</span>, <span class="hljs-number">100</span>)
    cursor = result[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">local</span> keys = result[<span class="hljs-number">2</span>]
    <span class="hljs-keyword">for</span> i, key <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(keys) <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">"TTL"</span>, key) &lt; <span class="hljs-number">-1</span> <span class="hljs-keyword">or</span> redis.call(<span class="hljs-string">"TTL"</span>, key) &gt; <span class="hljs-number">86400</span> <span class="hljs-keyword">then</span>
            redis.call(<span class="hljs-string">"DEL"</span>, key)
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">until</span> cursor == <span class="hljs-string">"0"</span>
<span class="hljs-keyword">return</span> <span class="hljs-string">"Cleanup done"</span>
</code></pre>
<h5 data-id="heading-9">3.4 内存监控与预警</h5>
<p>优化再好，没有监控就像闭眼开车。Redis 的 <code>INFO MEMORY</code> 命令是你的“仪表盘”，关键指标包括：</p>
<ul>
<li><code>used_memory</code>：当前占用内存。</li>
<li><code>maxmemory</code>：上限。</li>
<li><code>mem_fragmentation_ratio</code>：碎片率（&gt;1.5 时需警惕）。</li>
</ul>
<p>结合 Prometheus 和 Grafana，可以设置 OOM 预警。比如，内存占用超 80% 时报警。在一次秒杀活动前，我通过监控发现碎片率过高，提前调整了分片策略，避免了潜在风险。但也有教训：早期忽视碎片率，性能下降了 20% 才后知后觉。</p>
<p><strong>代码示例：Python脚本解析INFO MEMORY</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis

r = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>)
info = r.info(<span class="hljs-string">'memory'</span>)
used_mb = info[<span class="hljs-string">'used_memory'</span>] / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>
frag_ratio = info[<span class="hljs-string">'mem_fragmentation_ratio'</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Used Memory: <span class="hljs-subst">{used_mb:<span class="hljs-number">.2</span>f}</span> MB, Fragmentation Ratio: <span class="hljs-subst">{frag_ratio:<span class="hljs-number">.2</span>f}</span>"</span>)

<span class="hljs-keyword">if</span> used_mb &gt; <span class="hljs-number">2000</span> <span class="hljs-keyword">or</span> frag_ratio &gt; <span class="hljs-number">1.5</span>:  <span class="hljs-comment"># 假设 2GB 为阈值</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Warning: Memory usage or fragmentation too high!"</span>)
</code></pre>
<p><strong>监控指标表</strong></p>




















<table><thead><tr><th>指标</th><th>正常范围</th><th>异常情况建议</th></tr></thead><tbody><tr><td>used_memory</td><td>&lt; maxmemory 80%</td><td>检查淘汰策略</td></tr><tr><td>fragmentation_ratio</td><td>1.0-1.5</td><td>考虑重启或分片优化</td></tr></tbody></table>
<p>通过配置 <code>maxmemory</code>、优化数据结构、主动清理和实时监控，我们已经为 Redis 装上了“四重保险”。这些策略在我的项目中反复验证，不仅降低了 OOM 风险，还提升了整体性能。接下来，我们将通过两个实战案例，看看这些方法如何落地生根。</p>
<hr/>
<h4 data-id="heading-10">四、实战案例分析</h4>
<p>理论和策略讲了一堆，但真正让它们发光发热的，还是在实际项目中的应用。就像学厨艺，光看菜谱不够，得下厨房炒几盘菜才知道火候掌握得如何。接下来，我将分享两个我在项目中遇到的 OOM 案例，一个来自电商秒杀场景，另一个来自社交平台动态缓存。通过这些“事故现场”的复盘，你会看到优化策略如何从纸面走向代码，解决真实问题。</p>
<h5 data-id="heading-11">4.1 案例1：电商秒杀场景的OOM优化</h5>
<p><strong>问题描述</strong><br/>
在一个电商平台的秒杀活动中，我们用 Redis 缓存商品库存，Key 格式是 <code>stock:product:123</code>，用 Hash 存储每个规格的库存量（比如 <code>color:red</code> -&gt; 100）。活动开始后，热门商品的库存 Hash 迅速膨胀，一个 Key 占用了超过 1GB 内存。流量高峰时，Redis 触发 OOM，实例直接崩溃，导致订单无法下单，用户体验一落千丈。</p>
<p><strong>优化过程</strong><br/>
复盘后，我们采取了三步优化：</p>
<ol>
<li><strong>分片存储</strong>：将单个 Hash 拆成多个小 Hash，按规格 ID 取模分片（如 <code>stock:product:123:shard0</code>）。</li>
<li><strong>配置淘汰策略</strong>：设置 <code>maxmemory</code> 为服务器内存的 70%（10GB），启用 <code>volatile-lru</code>，为库存数据设置 1 小时过期时间。</li>
<li><strong>提前预估内存</strong>：活动前通过脚本模拟流量，预估每个分片占用约 50MB，总量控制在 2GB 内。</li>
</ol>
<p><strong>结果分析</strong><br/>
优化后，单 Key 内存占用从 1GB 降到 50MB，总内存占用降低 80%，稳定在 2.5GB 左右。秒杀活动全程无 OOM 风险，订单成功率从 85% 提升到 99%。碎片率也从 1.7 降到 1.2，性能更稳定。</p>
<p><strong>代码示例：分片存储库存实现</strong></p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- Lua 脚本：分片存储库存</span>
<span class="hljs-keyword">local</span> product_id = ARGV[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> spec_id = ARGV[<span class="hljs-number">2</span>]
<span class="hljs-keyword">local</span> stock = ARGV[<span class="hljs-number">3</span>]
<span class="hljs-keyword">local</span> shard = <span class="hljs-built_in">tostring</span>(<span class="hljs-built_in">tonumber</span>(spec_id) % <span class="hljs-number">10</span>)  <span class="hljs-comment">-- 按 spec_id 取模分 10 片</span>
<span class="hljs-keyword">local</span> key = <span class="hljs-string">"stock:product:"</span> .. product_id .. <span class="hljs-string">":shard"</span> .. shard
redis.call(<span class="hljs-string">"HSET"</span>, key, spec_id, stock)
redis.call(<span class="hljs-string">"EXPIRE"</span>, key, <span class="hljs-number">3600</span>)  <span class="hljs-comment">-- 设置 1 小时过期</span>
<span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>
</code></pre>
<p><strong>内存对比表</strong></p>























<table><thead><tr><th>阶段</th><th>单 Key 占用</th><th>总内存占用</th><th>OOM 风险</th></tr></thead><tbody><tr><td>优化前</td><td>1GB</td><td>12GB</td><td>高</td></tr><tr><td>优化后</td><td>50MB</td><td>2.5GB</td><td>无</td></tr></tbody></table>
<h5 data-id="heading-12">4.2 案例2：社交平台动态缓存踩坑记</h5>
<p><strong>问题描述</strong><br/>
在一个社交平台项目中，我们用 Redis 缓存用户动态，Key 格式是 <code>feeds:user:456</code>，用 List 存储动态 ID。由于初期没设置 <code>maxmemory</code>，一场突发活动带来了 10 倍流量，用户动态激增，Redis 内存从 3GB 暴涨到 16GB，直接吃光服务器资源，实例宕机，用户刷新动态时一片空白。</p>
<p><strong>优化过程</strong><br/>
这次事故让我们意识到“无限制吃内存”的危险。我们迅速调整了策略：</p>
<ol>
<li><strong>设置 maxmemory</strong>：将 <code>maxmemory</code> 设为 8GB，启用 <code>allkeys-lru</code>，确保热点动态优先保留。</li>
<li><strong>主动清理冷数据</strong>：编写脚本，每天清理超过 7 天的动态，结合 <code>EXPIRE</code> 设置 30 天默认过期。</li>
<li><strong>监控预警</strong>：用 Prometheus 监控 <code>used_memory</code>，设置 80% 占用率报警，提前干预。</li>
</ol>
<p><strong>结果分析</strong><br/>
优化后，内存占用稳定在 6-7GB，即使流量高峰也没突破上限。宕机问题彻底解决，用户动态加载延迟从 500ms 降到 100ms。唯一的代价是冷数据清理后，少量用户需要回源数据库加载历史动态，但影响可控。</p>
<p><strong>代码示例：动态缓存清理脚本</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis

r = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>)
cursor, keys = <span class="hljs-number">0</span>, []
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    cursor, batch = r.scan(cursor, <span class="hljs-keyword">match</span>=<span class="hljs-string">'feeds:user:*'</span>, count=<span class="hljs-number">100</span>)
    keys.extend(batch)
    <span class="hljs-keyword">if</span> cursor == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">break</span>

<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:
    <span class="hljs-comment"># 检查 List 长度，超过 7 天的数据清理</span>
    <span class="hljs-keyword">if</span> r.llen(key) &gt; <span class="hljs-number">0</span>:
        r.ltrim(key, <span class="hljs-number">0</span>, <span class="hljs-number">999</span>)  <span class="hljs-comment"># 保留最近 1000 条</span>
        r.expire(key, <span class="hljs-number">2592000</span>)  <span class="hljs-comment"># 设置 30 天过期</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Cleanup completed"</span>)
</code></pre>
<p><strong>效果对比表</strong></p>























<table><thead><tr><th>阶段</th><th>内存占用</th><th>系统状态</th><th>加载延迟</th></tr></thead><tbody><tr><td>优化前</td><td>16GB</td><td>宕机</td><td>500ms+</td></tr><tr><td>优化后</td><td>6-7GB</td><td>稳定运行</td><td>100ms</td></tr></tbody></table>
<p>这两个案例就像一面镜子，映照出 Redis 内存管理的常见痛点：大 Key、无限制内存、缺乏监控。解决之道正是前文提到的配置优化、分片设计和主动清理。通过这些实战，我深刻体会到，Redis 不是“开箱即用”的工具，而是需要根据业务场景量身定制。接下来，我们将聊聊常见的误区和应对建议，避免你在优化路上走弯路。</p>
<hr/>
<h4 data-id="heading-13">五、常见误区与应对建议</h4>
<p>优化 Redis 内存管理的路上，布满了“隐形地雷”。有些误区看似无害，却能在关键时刻让系统崩溃。就像开车，超速和忽视路标迟早会出问题。凭借 10 年 Redis 开发经验，我总结了几个常见误区，并给出应对之道，希望你能在实践中绕开这些陷阱。</p>
<h5 data-id="heading-14">5.1 误区1：认为Redis内存无限扩展</h5>
<p><strong>问题</strong><br/>
很多开发者把 Redis 当成“内存黑洞”，以为服务器有多大内存它就能用多少。结果是没设置 <code>maxmemory</code>，数据一多就吃光资源，导致 OOM 或服务器其他进程被挤爆。</p>
<p><strong>应对建议</strong><br/>
从项目启动之初就预估数据规模，设置合理的 <code>maxmemory</code>。比如，一个 16GB 内存的服务器，留 4GB 给系统和碎片，Redis 用 12GB。别忘了定期用 <code>INFO MEMORY</code> 检查实际占用，动态调整配置。</p>
<p><strong>经验分享</strong><br/>
早年我接手一个项目时，Redis 没设上限，结果一次活动流量暴涨，内存从 2GB 飙到 20GB，直接把 MySQL 挤崩溃。教训是：内存规划要提前做，别等事故来敲门。</p>
<h5 data-id="heading-15">5.2 误区2：忽视内存碎片</h5>
<p><strong>问题</strong><br/>
内存碎片就像房间里的杂物，堆多了就没地方放新东西。Redis 的碎片率（<code>mem_fragmentation_ratio</code>）超过 1.5 时，性能会下降，甚至触发 OOM。很多人觉得“数据没超限就没事”，却忘了碎片的隐形威胁。</p>
<p><strong>应对建议</strong><br/>
定期监控碎片率，高于 1.5 时可以尝试 <code>MEMORY PURGE</code> 清理碎片，或者计划重启实例（配合 AOF 重写减少影响）。长期方案是优化数据结构，减少频繁增删操作。</p>
<p><strong>踩坑教训</strong><br/>
一个排行榜项目中，我忽视了碎片率从 1.2 涨到 1.8，结果查询延迟翻倍。重启后恢复正常，但用户体验已受损。从此我把碎片率纳入监控必选项。</p>
<h5 data-id="heading-16">5.3 误区3：过度依赖过期机制</h5>
<p><strong>问题</strong><br/>
很多人以为给键设个 <code>EXPIRE</code> 就万事大吉，但 Redis 的过期清理是惰性和定期结合的，高负载时过期键可能堆积。比如，一个会话缓存项目中，过期键占了 30% 内存，却没被及时释放。</p>
<p><strong>应对建议</strong><br/>
别把 <code>EXPIRE</code> 当成唯一救星。结合主动清理脚本，定期扫描并删除无用数据。同时，设置合理的 TTL，避免一刀切的超长过期时间。</p>
<p><strong>代码示例：检查过期键占用</strong></p>
<pre><code class="hljs language-bash" lang="bash">redis-cli INFO MEMORY | grep used_memory_human
<span class="hljs-comment"># 若 used_memory 远超预期，运行以下命令查看过期键</span>
redis-cli --scan --pattern <span class="hljs-string">"*"</span> | xargs -I {} redis-cli TTL {} | grep -v <span class="hljs-string">"-"</span>
</code></pre>
<h5 data-id="heading-17">5.4 踩坑经验分享</h5>
<ul>
<li><strong>忽视持久化影响</strong>：RDB 和 AOF 的 fork 操作会临时占用额外内存。我曾因未预留空间，触发 OOM，后来调整 <code>maxmemory</code> 留出 2GB 缓冲才解决。</li>
<li><strong>未测试淘汰策略</strong>：直接上线 <code>allkeys-lru</code>，结果热数据被删，流量全打到数据库。建议先用测试环境模拟流量，验证策略效果。</li>
</ul>
<p><strong>常见误区应对表</strong></p>

























<table><thead><tr><th>误区</th><th>后果</th><th>解决方案</th></tr></thead><tbody><tr><td>内存无限扩展</td><td>OOM 或系统崩溃</td><td>设置 maxmemory，预估规模</td></tr><tr><td>忽视内存碎片</td><td>性能下降</td><td>监控碎片率，定期清理</td></tr><tr><td>过度依赖过期</td><td>内存浪费</td><td>主动清理，优化 TTL</td></tr></tbody></table>
<p>这些误区就像 Redis 内存管理中的“老油条”，不踩一脚可能意识不到它们的威力。通过提前规划、监控和主动干预，我们可以把风险降到最低。接下来，我们将总结全文要点，并展望 Redis 内存管理的未来趋势，给出一些实践建议。</p>
<hr/>
<h4 data-id="heading-18">六、总结与展望</h4>
<p>经过前文的层层拆解，我们已经从 Redis 内存管理的基础走到了实战优化的前沿。就像给一辆赛车调校引擎，避免 OOM 的核心在于理解机制、优化策略和持续监控。现在，让我们回顾要点，给出建议，并展望未来趋势，希望你能带着这些干货自信上路。</p>
<h5 data-id="heading-19">6.1 核心要点回顾</h5>
<p>Redis 的内存管理不是“设了忘”的配置游戏，而是需要从头到尾的精心设计。我们先摸清了内存分配器和数据结构的工作原理，认清了 OOM 的常见元凶——大 Key、数据堆积和配置失误。接着，通过四大优化策略：合理配置 <code>maxmemory</code> 和淘汰策略、分片设计、过期与主动清理、内存监控，构建了一套防 OOM 的“护城河”。实战案例则证明，这些方法能在电商秒杀、社交缓存等场景中化险为夷。最后，常见误区提醒我们，规划不足和盲目信任机制是最大的隐患。</p>
<p><strong>避免 OOM 的关键公式</strong>：<br/>
<strong>科学配置 + 合理设计 + 实时监控 = 内存无忧</strong></p>
<h5 data-id="heading-20">6.2 给读者的建议</h5>
<p>对于 1-2 年经验的开发者，我的建议是从小处入手，逐步精进：</p>
<ul>
<li><strong>从小规模测试开始</strong>：先在本地或测试环境模拟数据量，试试淘汰策略和分片效果，别直接上生产“裸奔”。</li>
<li><strong>善用工具</strong>：用 <code>redis-cli</code> 的 <code>INFO</code> 命令摸清内存现状，结合 Grafana 可视化趋势。</li>
<li><strong>持续学习新特性</strong>：Redis 6.x 改进了 LFU 算法，7.x 优化了多线程，值得关注和尝试。</li>
</ul>
<p>我自己的经验是，每次优化前先问三个问题：数据量会涨到多大？单 Key 会不会失控？监控能不能跟上？回答清楚了，问题就解决了一半。</p>
<h5 data-id="heading-21">6.3 展望</h5>
<p>Redis 的内存管理未来会更智能、更高效。随着集群模式和云服务的普及，分布式内存分配会成为重点，单实例的 OOM 风险将逐步被分担。Redis 的多线程支持也在增强，比如 6.0 引入的 I/O 线程，未来可能进一步优化内存效率。我个人很期待 Redis 在内存压缩和动态分片上的突破，这会让高并发场景更省心。结合自己的使用心得，我建议关注 Redis 的生态工具（如 Redis Sentinel、Redis Cluster）和云厂商的托管方案，它们能帮你把内存管理交给“专家”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年]]></title>    <link>https://juejin.cn/post/7583955708317712384</link>    <guid>https://juejin.cn/post/7583955708317712384</guid>    <pubDate>2025-12-16T00:53:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583955708317712384" data-draft-id="7583921477613862947" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-16T00:53:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:53:14.000Z" title="Tue Dec 16 2025 00:53:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>谷歌正式发布最新一代推理模型 Gemini 3.0 Pro，并同步开放 API 接口及在 谷歌 AI Studio 推出预览版。这款模型一经发布，立刻横扫各大评测榜单，以“一夜封神”的姿态震撼了全球 AI 社群。</p>
<p>值得玩味的是，OpenAI 首席执行官奥特曼也隔空向谷歌发来“贺电”，在社交媒体上评价“Gemini 3 看起来很不错”，谷歌首席执行官皮查伊（Sundar Pichai）则以一个轻松的表情包回应，尽显王者风范。</p>
<p>Gemini 3.0 Pro 的强大并非空穴来风，其在关键的基准测试中实现了全面“碾压式”的领先：</p>
<p><strong>数学能力登顶全球：</strong> 在被誉为“地狱难度”的数学竞赛基准 MathArena 中，当 GPT-5.1 等其他顶级大模型仍在 1% 左右徘徊时，Gemini 3.0 Pro 的得分一举达到 <strong>23.4%</strong> ，毫无争议地成为当前全球数学能力最强的 AI。</p>
<h2 data-id="heading-1">重磅福利</h2>
<p>现在一年会员只要 <strong>19.9</strong> 元，帮您解决以下 4 大问题。</p>
<blockquote>
<p>⚠️注：优惠截止日期 2026年1月31日</p>
<p>如有问题可以联系V：zm_david。</p>
</blockquote>
<h2 data-id="heading-2">1. 出了点问题（Something went wrong）</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228d3b26acee4cb0a60a7d1b40514c86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451194&amp;x-signature=q7q7Bs25yTYxjbNXf0BwrkU0iQk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44ecadaba1b48cca89662ae802a29de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451194&amp;x-signature=074k1Shx79mgO2YpqZ0eIx3BfLA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">2. 此账号无法订阅 Google AI 方案</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e3e2b44eed343e3b9b73e9b19001e46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451194&amp;x-signature=%2FRqhPR%2FbQSELCpIR2FE4K6RoelA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 无法享受此优惠</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64f8c40de8054a4684fbed1304e96c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451194&amp;x-signature=qbmnIr4hMN%2BXsQWjIzgTL6v%2BRDw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af1afa414f74c259acab6a7b0121e16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451194&amp;x-signature=RQzdeLbVOHum48jWS09U0S4nB%2BQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">4. 没有 Visa 卡绑定</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0983335f6f548109905edf089f93f30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766451194&amp;x-signature=rBN0zjOl3TX4rs6CepfOWSRpjRc%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>