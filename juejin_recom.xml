<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[èŠ±ä¸€å¤©ç ”ç©¶äº† 565 ä¸ª Skillsï¼Œæˆ‘çš„ Clawdbot æ¯” ChatGPT æ›´æ‡‚æˆ‘ï¼]]></title>    <link>https://juejin.cn/post/7600562816458850346</link>    <guid>https://juejin.cn/post/7600562816458850346</guid>    <pubDate>2026-01-29T11:01:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600562816458850346" data-draft-id="7600560664407998527" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="èŠ±ä¸€å¤©ç ”ç©¶äº† 565 ä¸ª Skillsï¼Œæˆ‘çš„ Clawdbot æ¯” ChatGPT æ›´æ‡‚æˆ‘ï¼"/> <meta itemprop="keywords" content="AIGC,AIç¼–ç¨‹,Agent"/> <meta itemprop="datePublished" content="2026-01-29T11:01:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­Ÿå¥AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            èŠ±ä¸€å¤©ç ”ç©¶äº† 565 ä¸ª Skillsï¼Œæˆ‘çš„ Clawdbot æ¯” ChatGPT æ›´æ‡‚æˆ‘ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­Ÿå¥AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:01:36.000Z" title="Thu Jan 29 2026 11:01:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å­Ÿå¥ã€‚</p>
<p>æ˜¨å¤©ï¼Œæˆ‘èŠ±äº†ä¸€æ•´å¤©æ—¶é—´ç ”ç©¶ Clawdbotï¼ˆç°å·²æ›´åä¸º Moltbotï¼‰å®˜æ–¹çš„ 565 ä¸ª Skillsï¼Œè¯´å®è¯çœ‹å¾—çœ¼èŠ±ç¼­ä¹±ã€‚</p>
<p>æœ€ç»ˆï¼Œæˆ‘ä»ä¸­æŒ‘é€‰äº† 20 å¤šä¸ªé€‚åˆè‡ªå·±çš„ skillï¼Œå…¨éƒ¨è£…åˆ°äº†æˆ‘çš„ AI åŠ©ç†èº«ä¸Šï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/906817c8608947ad8b3c79b98644c47b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=oqCzuhFzG7DCyKV%2Fb0bNdmiCbK0%3D" alt="" loading="lazy"/></p>
<p>ä»Šå¤©å°±æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„å®‰è£…è¿‡ç¨‹å’Œå¿ƒå¾—ï¼Œç…§ç€åšä½ ä¹Ÿèƒ½æ‰“é€ ä¸€ä¸ªçœŸæ­£æ‡‚ä½ çš„ç§äººåŠ©ç†ã€‚</p>
<h2 data-id="heading-0">00 å…ˆè®©åŠ©ç†è®¤è¯†ä½ </h2>
<p>åœ¨è£…ä»»ä½• skill ä¹‹å‰ï¼Œ<strong>ç¬¬ä¸€æ­¥åº”è¯¥æ˜¯è®©åŠ©ç†äº†è§£ä½ è¿™ä¸ªäººã€‚</strong></p>
<p>æ¯”å¦‚ï¼Œè¿™æ˜¯æˆ‘åŠ©ç†çš„è®°å¿†æ–‡ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3c34ac71b514858a8f268ca2417af98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=eYO2Tyua%2BNahbrmKQPvkKhTQEd8%3D" alt="" loading="lazy"/></p>
<p>æˆ‘æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•â€”â€”æ‰¾å‡ ç¯‡æˆ‘ä¹‹å‰å†™è¿‡ä¸ªäººç»å†çš„å…¬ä¼—å·æ–‡ç« ï¼Œç›´æ¥å‘ç»™å®ƒï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d6514b9b2844718a9991c8d4d230edc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=FprIhu%2BpoVkjCSrxWVbQ6f%2FldrQ%3D" alt="" loading="lazy"/></p>
<p>å®ƒä¼šè‡ªåŠ¨æå–å…³é”®ä¿¡æ¯ï¼Œç”Ÿæˆé•¿æœŸè®°å¿†ã€‚è¿™æ ·ä»¥åå®ƒå›ç­”é—®é¢˜ã€å¸®ä½ åšå†³ç­–æ—¶ï¼Œéƒ½æ˜¯åŸºäºå¯¹ä½ çš„äº†è§£æ¥çš„ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d698b93754ff4c938df05a3067adbfa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=2nPMTvmd5vMnFhZudI21IQu7XQA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">01 é‚®ä»¶ç®¡ç†ï¼šgog</h2>
<p>ç¬¬ä¸€ä¸ªè£…çš„ skill æ˜¯ gogï¼Œç”¨æ¥è¿æ¥ Gmailã€‚</p>
<p>åªéœ€è¦é€šè¿‡ Google Cloud Console ç”Ÿæˆä¸€ä¸ª OAuth token ç»™å®ƒå°±è¡Œï¼Œä¸ä¼šæ“ä½œçš„è¯å¯ä»¥è®© AI ä¸€æ­¥æ­¥æ•™ä½ ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Ftree%2Fmain%2Fskills%2Fsteipete%2Fgog%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/tree/main/skills/steipete/gog/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. è·å– Google OAuth credentialsï¼ˆä» Google Cloud Consoleï¼‰</span>
<span class="hljs-comment"># 2. é…ç½®è®¤è¯</span>
gog auth credentials /path/to/client_secret.json
gog auth add you@gmail.com --services gmail,calendar,drive,contacts,docs,sheets
gog auth list
</code></pre>
<p>è£…å®Œä¹‹åï¼Œæˆ‘ç°åœ¨å®Œå…¨è®©å®ƒå¸®æˆ‘çœ‹é‚®ä»¶ã€ç­›é€‰é‡è¦ä¿¡æ¯ã€å¤„ç†å›å¤ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c411b210602044bc9b4d93ce1cea13e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=WVjBek%2Bk9EHbA4mxCjiNjeZN1iY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">02 è‡ªåŠ¨æ›´æ–° &amp; æ–‡æ¡£åŒæ­¥</h2>
<p>æ¥ç€è£…äº†ä¸¤ä¸ªåŸºç¡€ skillï¼šï¼š</p>
<p><strong>è‡ªåŠ¨æ›´æ–°</strong>â€”â€”è®©å®ƒèƒ½å®šæ—¶è‡ªå·±æ›´æ–°ç‰ˆæœ¬ï¼Œä¸ç”¨æˆ‘æ“å¿ƒï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Ftree%2Fmain%2Fskills%2Fmaximeprades%2Fauto-updater%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/tree/main/skills/maximeprades/auto-updater/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f9557b34e0a44b6aec3895eff5d78a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=o10EIkM2wj6aDy5WKmWXcJNaZHw%3D" alt="" loading="lazy"/></p>
<p><strong>æ–‡æ¡£åŒæ­¥</strong>â€”â€”è®©å®ƒæ›´äº†è§£è‡ªå·±çš„èƒ½åŠ›è¾¹ç•Œï¼Œåç»­ä½ å¯ä»¥ç”¨å®ƒæ¥æ“æ§ Clawdbot æœ¬èº«ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Ftree%2Fmain%2Fskills%2Faranej%2Fclawd-docs-v2%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/tree/main/skills/aranej/clawd-docs-v2/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eee7b5528c57464abfaf6550169b6f3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=b9sChewLUxj6IfqLKcDkWfed2vM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">03 PDF è§£æï¼šè§£é”æ–‡ä»¶ç†è§£èƒ½åŠ›</h2>
<p>æˆ‘çš„ç¾å›½å…¬å¸åˆšå¥½æ³¨å†Œä¸‹æ¥äº†ï¼Œæˆ‘è®©å®ƒå¸®æˆ‘å­˜å‚¨å…¬å¸çš„é‡è¦æ–‡ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa5b324fcfc34aa583464820c5472356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=2n5aE2bfmII7qHAdsVlSELv7MtA%3D" alt="" loading="lazy"/></p>
<p>ç»“æœå®ƒå‘Šè¯‰æˆ‘çœ‹ä¸äº† PDFã€‚è¡Œå§ï¼Œé‚£å°±è®©å®ƒè‡ªå·±è£…ä¸€ä¸ª PDF è§£æçš„ skillï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fsteipete%2Fmarkdown-converter%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/steipete/markdown-converter/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1cdc54c4fa6497d8b8e13d9b4c6d1b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=PHswbhLb8gUhBPF2K7mkjDUoNkM%3D" alt="" loading="lazy"/></p>
<p>è£…å®Œä¹‹åï¼Œè‹±æ–‡çš„å…¬å¸æ³¨å†Œæ–‡ä»¶ã€ç¨åŠ¡æ–‡ä»¶å®ƒéƒ½èƒ½ç›´æ¥è¯»å–å’Œç†è§£ï¼Œçœå¾—è‡ªå·±ä¸€é¡µé¡µå•ƒè‹±æ–‡äº†ã€‚</p>
<h2 data-id="heading-4">04 æ¯æ—¥å›é¡¾ &amp; å®šæ—¶æé†’</h2>
<p><strong>æ¯æ—¥å›é¡¾</strong>è¿™ä¸ª skill æˆ‘è§‰å¾—æŒºæœ‰æ„æ€ï¼Œæ¯å¤©è‡ªåŠ¨ç”Ÿæˆä¸€å¼ å›é¡¾å¡ç‰‡ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fdbhurley%2Fdaily-recap%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/dbhurley/daily-recap/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b42059447b1e4a5ebcda739257d3b5b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=wpHGFlaVV1a%2Fo4r%2B%2BV27g3YWw7k%3D" alt="" loading="lazy"/></p>
<p>å› ä¸ºå®ƒä¾èµ–å›¾ç‰‡ç”Ÿæˆèƒ½åŠ›ï¼Œæ‰€ä»¥åˆé¡ºå¸¦è£…äº† Nano Banana Proï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fsteipete%2Fnano-banana-pro%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/steipete/nano-banana-pro/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p>æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼Œè¿˜æ˜¯å¾ˆä¸é”™çš„ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5171cb7edfc5496fade68696a0f6aed6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=KoYpkxYNLrwqzAp%2Fuk%2FVFcZ5Y%2Fk%3D" alt="" loading="lazy"/></p>
<p>å¦å¤–è¿˜è£…äº†é‚®ä»¶æ™¨æŠ¥å’Œå®šæ—¶æé†’ï¼Œè®©å®ƒæ¯å¤©ä¸»åŠ¨ç»™æˆ‘æ¨å…³é”®ä¿¡æ¯ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fam-will%2Fmorning-email-rollup%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/am-will/morning-email-rollup/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fjulianengel%2Fremind-me%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/julianengel/remind-me/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15b8ed74c05941b6b1b6337c71753b96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=UvdfD%2F%2FkxIvp%2FEBLVd87iDcLqGg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">05 ç¤¾äº¤åª’ä½“ï¼šTwitter é˜…è¯»</h2>
<p>è£…äº† Bird è¿™ä¸ª skillï¼Œå¯ä»¥ç›´æ¥è¯»å–æˆ‘ Twitter ä¸Šçš„ä¿¡æ¯æµï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fsteipete%2Fbird%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/steipete/bird/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac5d2551f35b4706bb0d78621521b31a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=0JDrbes5lXOmXaglD715XdWzrBc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">06 å» AI å‘³å„¿</h2>
<p>è¿™ä¸¤ä¸ª skill æˆ‘è§‰å¾—ç‰¹åˆ«å®ç”¨â€”â€”<strong>ä¸“é—¨ç”¨æ¥æ¶ˆé™¤ AI ç”Ÿæˆæ–‡æœ¬çš„ç—•è¿¹ï¼š</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fitsflow%2Fde-ai-ify%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/itsflow/de-ai-ify/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fbiostartechnology%2Fhumanizer%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/biostartechnology/humanizer/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64143b5e17a74bc7a2c1daa373c7285f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=L0kJiyvYSbfM2J94trMzoY7N26s%3D" alt="" loading="lazy"/></p>
<p>å†™å…¬ä¼—å·ã€å†™é‚®ä»¶çš„æ—¶å€™ç‰¹åˆ«å¥½ç”¨ï¼Œè®© AI å¸®ä½ å†™åˆç¨¿ï¼Œå†ç”¨è¿™ä¿© skill æŠŠ"AI å‘³å„¿"å»æ‰ã€‚</p>
<h2 data-id="heading-7">07 ä¸ªäººæˆé•¿ç±»</h2>
<p>è¿™å‡ ä¸ª skill æ˜¯æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„ï¼š</p>
<p>â€¢ èŠ’æ ¼è§‚å¯Ÿè€…ï¼šç”¨æŸ¥ç†Â·èŠ’æ ¼çš„å¤šå…ƒæ€ç»´æ¨¡å‹æ¥å®¡è§†ä½ çš„å†³ç­–</p>
<p>â€¢ è‡ªä¿¡ä¸è‡ªçˆ±ï¼šå¸®ä½ è®°å½•å°æˆå°±ã€å»ºç«‹æ­£å‘åé¦ˆ</p>
<p>â€¢ å¿ƒç†ç–å¯¼æ¨¡å¼ï¼šCBTã€ACT ç­‰ä¸“ä¸šå¿ƒç†æ¡†æ¶</p>
<p>â€¢ æ¯å‘¨å¤ç›˜ï¼šè‡ªåŠ¨ç”Ÿæˆä¸€å‘¨çš„å·¥ä½œä¸æ€è€ƒæ€»ç»“</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fjdrhyne%2Fmunger-observer%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/jdrhyne/munger-observer/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fjhillin8%2Fself-love-confidence%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/jhillin8/self-love-confidence/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fthesethrose%2Ftherapy-mode%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/thesethrose/therapy-mode/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fitsflow%2Fweekly-synthesis%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/itsflow/weekly-synthesis/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfce92fde6b449439e436c8f4475f0ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=afg1crTpxADcqVx0FkANMUrB1oY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">08 YouTube è§†é¢‘ç†è§£</h2>
<p>è£…äº†ä¸¤ä¸ª YouTube ç›¸å…³çš„ skillï¼Œå¯ä»¥ç›´æ¥è¯»å–è§†é¢‘å­—å¹•å’Œå†…å®¹ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fsteipete%2Fvideo-transcript-downloader%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/steipete/video-transcript-downloader/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fmichaelgathara%2Fyoutube-watcher%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/michaelgathara/youtube-watcher/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f3f75822cc2429383e74e100a7d16bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=22LKRhXbPo8gtugJvzaRZpYLl1Y%3D" alt="" loading="lazy"/></p>
<p>ä»¥åçœ‹åˆ°å¥½çš„è‹±æ–‡æŠ€æœ¯è§†é¢‘ï¼Œç›´æ¥ä¸¢é“¾æ¥ç»™å®ƒï¼Œå‡ ç§’é’Ÿå°±èƒ½æ‹¿åˆ°å®Œæ•´çš„å†…å®¹æ‘˜è¦ã€‚</p>
<h2 data-id="heading-9">09 æµç¨‹å›¾ç»˜åˆ¶</h2>
<p>å‘ç°äº†ä¸€ä¸ªç”»æµç¨‹å›¾çš„ skillï¼ŒåŸºäº Excalidrawï¼Œç›´æ¥ç”¨æ–‡å­—æè¿°å°±èƒ½ç”Ÿæˆä¸“ä¸šçš„æµç¨‹å›¾ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fswiftlysingh%2Fexcalidraw-flowchart%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/swiftlysingh/excalidraw-flowchart/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8835bb84fe74b6eae538d06b3a69ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=f8yHo%2BogXawmXS7tE0K5ta9fdw4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">10 è¥é”€ä¸“å®¶ï¼šåšå‡ºæµ·äº§å“å¿…å¤‡</h2>
<p>è¿™ä¸ª skill æˆ‘å¼ºçƒˆæ¨èç»™æ‰€æœ‰åšæµ·å¤–äº§å“çš„æœ‹å‹â€”â€”<strong>è¥é”€ä¸“å®¶æ¨¡å—</strong>ï¼Œé‡Œé¢åŒ…å« 23 ä¸ªå­æ¨¡å—ï¼Œè¦†ç›– SEOã€æ–‡æ¡ˆã€è½¬åŒ–ç‡ä¼˜åŒ–ã€ä»˜è´¹æŠ•æ”¾ã€å®šä»·ç­–ç•¥ç­‰ç­‰ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fjchopard69%2Fmarketing-skills%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/jchopard69/marketing-skills/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Fblob%2Fmain%2Fskills%2Fthesethrose%2Fmarketing-mode%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/blob/main/skills/thesethrose/marketing-mode/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10d55526ff284412ba5562ac5251ab5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=2Imc7xtj4H3VndHIQTCqNDirzVo%3D" alt="" loading="lazy"/></p>
<p>åšå‡ºæµ·çš„åŒå­¦åº”è¯¥çŸ¥é“ï¼ŒSEOã€SEMã€Affiliate è¿™äº›ä¸œè¥¿é›¶é›¶æ•£æ•£çš„ï¼Œæœ‰ä¸ªç³»ç»ŸåŒ–çš„è¥é”€é¡¾é—®åœ¨æ—è¾¹éšæ—¶èƒ½é—®ï¼Œå¤ªé¦™äº†ã€‚</p>
<h2 data-id="heading-11">11 Todo ç®¡ç†</h2>
<p>æœ€åè£…äº†ä¸€ä¸ª Todo ç®¡ç†çš„ skillï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmoltbot%2Fskills%2Ftree%2Fmain%2Fskills%2Fjdrhyne%2Ftodo-tracker%2FSKILL.md" target="_blank" title="https://github.com/moltbot/skills/tree/main/skills/jdrhyne/todo-tracker/SKILL.md" ref="nofollow noopener noreferrer">github.com/moltbot/skiâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03820d8b0ba14d3a9d9bec2b7d0e9a1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770289295&amp;x-signature=ahczh7yJwqmhpzEkrN4M3WvnCJs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">å†™åœ¨æœ€å</h2>
<p>ä»¥ä¸Šå°±æ˜¯æˆ‘é…ç½®çš„æ‰€æœ‰ skill äº†ã€‚è£…å®Œä¹‹åï¼Œæˆ‘è§‰å¾—æˆ‘çš„ ChatGPT å®Œå…¨å¯ä»¥ä¸¢æ‰äº†ã€‚</p>
<p>æœ‰æœ‹å‹é—®æˆ‘ï¼š<strong>Clawdbot åˆ°åº•æ¯”</strong> <strong>ChatGPT</strong> <strong>å¼ºåœ¨å“ªï¼Ÿ</strong></p>
<p>æˆ‘çš„å›ç­”æ˜¯ï¼š</p>
<ol>
<li>
<p><strong>è®°å¿†çœŸæ­£å¯æ§ã€‚</strong> ChatGPT çš„è®°å¿†åŠŸèƒ½å¾ˆæœ‰é™ï¼Œè€Œä¸”ä½ æ§åˆ¶ä¸äº†å®ƒè®°ä½ä»€ä¹ˆã€å¿˜æ‰ä»€ä¹ˆã€‚Clawdbot çš„é•¿æœŸè®°å¿†æ˜¯æ–‡ä»¶åŒ–çš„ï¼Œæ¯å¤©éƒ½ä¼šè®°å½•ï¼Œä½ æƒ³å¬å›éšæ—¶éƒ½å¯ä»¥ã€‚</p>
</li>
<li>
<p><strong>èƒ½åŠ›è‡ªç”±è£…é…ã€‚</strong> é€šè¿‡ skill ç³»ç»Ÿï¼Œä½ å¯ä»¥æŒ‰éœ€å®‰è£…å„ç§èƒ½åŠ›â€”â€”é‚®ä»¶ã€è¥é”€ã€YouTubeã€æµç¨‹å›¾ã€å¿ƒç†ç–å¯¼â€¦â€¦ChatGPT åšä¸åˆ°è¿™ç§æ·±åº¦å®šåˆ¶ã€‚</p>
</li>
<li>
<p><strong>å¯æ“æ§èŒƒå›´å¤§å¾—å¤šã€‚</strong> å®ƒèƒ½å­˜ä½ çš„ tokenã€è¯»ä½ çš„æ–‡ä»¶ã€è¿æ¥ä½ çš„å„ç§æœåŠ¡ã€‚ä½ çš„é‡è¦æ–‡ä»¶éƒ½å¯ä»¥è®©å®ƒå­˜ç€å½“å¤‡ä»½ï¼Œéšæ—¶å¬å›ï¼Œè€Œä¸”å®ƒè¿˜èƒ½ç†è§£æ–‡ä»¶å†…å®¹ã€‚</p>
</li>
<li>
<p><strong>æœ¬è´¨åŒºåˆ«ï¼š</strong> ChatGPT æ˜¯ä¸€ä¸ªå¯¹è¯å·¥å…·ï¼Œè€Œ <strong>Clawdbot æ›´åƒæ˜¯ä¸€ä¸ªçœŸæ­£çš„ç§äººåŠ©ç†</strong>â€”â€”ä½ ç”šè‡³å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªäººæ¥çœ‹å¾…ã€‚</p>
</li>
</ol>
<p><strong>å¦‚æœä½ ä¹Ÿæƒ³æ‹¥æœ‰ä¸€ä¸ªè¿™æ ·çš„åŠ©ç†ï¼Œå¯ä»¥ç›´æ¥å»è¯•è¯•ã€‚</strong></p>
<hr/>
<p>ğŸš€ æƒ³è¦ä¸æ›´å¤šAIçˆ±å¥½è€…äº¤æµï¼Œå…±åŒæˆé•¿å—ï¼Ÿ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">å’Œä¸€ç¾¤å¿—åŒé“åˆçš„äººï¼ŒæŒç»­ç²¾è¿› AI çš„æ¯ä¸€å¤©</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose ä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸‰ï¼‰ï¼šçŠ¶æ€ç®¡ç† - ä»åŸç†åˆ°å®è·µ]]></title>    <link>https://juejin.cn/post/7600663744192069668</link>    <guid>https://juejin.cn/post/7600663744192069668</guid>    <pubDate>2026-01-29T11:34:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600663744192069668" data-draft-id="7600562816458653738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose ä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸‰ï¼‰ï¼šçŠ¶æ€ç®¡ç† - ä»åŸç†åˆ°å®è·µ"/> <meta itemprop="keywords" content="Kotlin,JetBrains,Android"/> <meta itemprop="datePublished" content="2026-01-29T11:34:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‚¹é˜¿æ¶›æ¶›æ¶›æ¶›æ¶›æ¶›æ¶›æ¶›"/> <meta itemprop="url" content="https://juejin.cn/user/3808364009106839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose ä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸‰ï¼‰ï¼šçŠ¶æ€ç®¡ç† - ä»åŸç†åˆ°å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364009106839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‚¹é˜¿æ¶›æ¶›æ¶›æ¶›æ¶›æ¶›æ¶›æ¶›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:34:11.000Z" title="Thu Jan 29 2026 11:34:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æ·±å…¥ç†è§£ Compose çš„çŠ¶æ€ç³»ç»Ÿï¼šSlot Table æœºåˆ¶ã€é‡ç»„åŸç†ã€çŠ¶æ€æå‡è®¾è®¡æ¨¡å¼ï¼Œä»¥åŠä¼ä¸šçº§çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨å‰ä¸¤ç¯‡ä¸­ï¼Œæˆ‘ä»¬æŒæ¡äº† Compose çš„å¸ƒå±€ç³»ç»Ÿã€‚ä½†ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¦»ä¸å¼€çŠ¶æ€ç®¡ç†ï¼šç”¨æˆ·çš„ç‚¹å‡»ã€ç½‘ç»œè¯·æ±‚çš„ç»“æœã€é¡µé¢çš„åˆ‡æ¢...è¿™äº›éƒ½éœ€è¦çŠ¶æ€æ¥é©±åŠ¨ UI æ›´æ–°ã€‚</p>
<p>Compose çš„çŠ¶æ€ç³»ç»Ÿä¸ä¼ ç»Ÿ View ç³»ç»Ÿå®Œå…¨ä¸åŒï¼Œå®ƒé‡‡ç”¨äº†<strong>å“åº”å¼ç¼–ç¨‹</strong>çš„æ€æƒ³ï¼šçŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘ UI æ›´æ–°ã€‚è¿™å¬èµ·æ¥å¾ˆç¥å¥‡ï¼Œä½†èƒŒåæœ‰ç€ç²¾å¦™çš„è®¾è®¡ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« å°†å¸¦ä½ æ·±å…¥ç†è§£ï¼š</p>
<ul>
<li>Compose å¦‚ä½•è¿½è¸ªçŠ¶æ€å˜åŒ–ï¼Ÿ</li>
<li>é‡ç»„ï¼ˆRecompositionï¼‰åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆæœ‰æ—¶å€™çŠ¶æ€æ›´æ–°äº† UI å´æ²¡åˆ·æ–°ï¼Ÿ</li>
<li>å¦‚ä½•è®¾è®¡ä¼˜é›…çš„çŠ¶æ€ç®¡ç†æ¶æ„ï¼Ÿ</li>
</ul>
<p>è®©æˆ‘ä»¬å¼€å§‹è¿™åœºæ·±å…¥æºç çš„æ¢ç´¢ä¹‹æ—…ï¼</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€çŠ¶æ€ä¸é‡ç»„æœºåˆ¶æ·±åº¦è§£æ</h2>
<h3 data-id="heading-2">1.1 å“åº”å¼ç¼–ç¨‹çš„æœ¬è´¨</h3>
<p>Compose çš„æ ¸å¿ƒç†å¿µæ˜¯<strong>çŠ¶æ€é©±åŠ¨ UI</strong>ã€‚å½“çŠ¶æ€å˜åŒ–æ—¶ï¼ŒUI ä¼šè‡ªåŠ¨æ›´æ–°ã€‚è¿™èƒŒåçš„å…³é”®æœºåˆ¶å°±æ˜¯<strong>é‡ç»„ï¼ˆRecompositionï¼‰</strong>ã€‚</p>
<p><strong>ä¼ ç»Ÿ View ç³»ç»Ÿï¼ˆå‘½ä»¤å¼ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ‰‹åŠ¨æ›´æ–° UI</span>
button.setOnClickListener {
    count++
    textView.text = <span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>  <span class="hljs-comment">// æ‰‹åŠ¨è®¾ç½®æ–°å€¼</span>
}
</code></pre>
<p><strong>Composeï¼ˆå£°æ˜å¼ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)  <span class="hljs-comment">// è‡ªåŠ¨æ›´æ–°</span>
    }
}
</code></pre>
<p><strong>å…³é”®åŒºåˆ«</strong>ï¼šCompose ä¼šè‡ªåŠ¨è¿½è¸ª <code>count</code> çš„å˜åŒ–ï¼Œå½“ <code>count</code> æ”¹å˜æ—¶ï¼Œè‡ªåŠ¨é‡æ–°æ‰§è¡Œ <code>Counter</code> å‡½æ•°ï¼Œæ›´æ–° UIã€‚</p>
<h3 data-id="heading-3">1.2 Slot Tableï¼šCompose çš„"è®°å¿†"ç³»ç»Ÿ</h3>
<p>Compose å¦‚ä½•çŸ¥é“å“ªäº› Composable éœ€è¦é‡ç»„ï¼Ÿç­”æ¡ˆå°±æ˜¯ <strong>Slot Table</strong>ã€‚</p>
<h4 data-id="heading-4">1.2.1 ä¸ºä»€ä¹ˆéœ€è¦ Slot Tableï¼Ÿ</h4>
<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p>å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œ<code>count</code> ä» 0 å˜æˆ 1ã€‚æ­¤æ—¶ Compose éœ€è¦ï¼š</p>
<ol>
<li>çŸ¥é“ <code>count</code> çš„æ–°å€¼æ˜¯ 1</li>
<li>çŸ¥é“å“ªäº› Composable è¯»å–äº† <code>count</code></li>
<li>åªæ›´æ–°é‚£äº› Composable</li>
</ol>
<p><strong>Slot Table å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæœºåˆ¶</strong>ã€‚</p>
<h4 data-id="heading-5">1.2.2 Slot Table æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>Slot Table æ˜¯ Compose è¿è¡Œæ—¶ç»´æŠ¤çš„ä¸€ä¸ª<strong>çº¿æ€§æ•°ç»„</strong>ï¼Œç”¨äºå­˜å‚¨ Composable å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸º Compose çš„"è®°å¿†ç³»ç»Ÿ"ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Slot Table ç»“æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç´¢å¼•    ç±»å‹          å†…å®¹                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚   <span class="hljs-number">0</span>      <span class="hljs-keyword">Group</span>        Counter (Composable ç»„)                   â”‚
â”‚   <span class="hljs-number">1</span>      Int          <span class="hljs-number">0</span> (remember çš„ <span class="hljs-keyword">key</span>)                       â”‚
â”‚   <span class="hljs-number">2</span>      State        MutableState(value=<span class="hljs-number">0</span>)                     â”‚
â”‚   <span class="hljs-number">3</span>      <span class="hljs-keyword">Group</span>        Button                                    â”‚
â”‚   <span class="hljs-number">4</span>      Lambda       onClick = { count++ }                     â”‚
â”‚   <span class="hljs-number">5</span>      <span class="hljs-keyword">Group</span>        <span class="hljs-keyword">Text</span>                                      â”‚
â”‚   <span class="hljs-number">6</span>      <span class="hljs-type">String</span>       <span class="hljs-string">"Count: 0"</span>                                â”‚
â”‚   <span class="hljs-number">7</span>      EndGroup     <span class="hljs-keyword">Text</span> ç»“æŸ                                 â”‚
â”‚   <span class="hljs-number">8</span>      EndGroup     Button ç»“æŸ                               â”‚
â”‚   <span class="hljs-number">9</span>      EndGroup     Counter ç»“æŸ                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Slot Table çš„ä¸‰å¤§ä½œç”¨</strong>ï¼š</p>
<ol>
<li><strong>è®°å¿†çŠ¶æ€</strong>ï¼šä¿å­˜ <code>remember</code>ã€<code>mutableStateOf</code> ç­‰çš„çŠ¶æ€ï¼Œé‡ç»„æ—¶ä¸ä¸¢å¤±</li>
<li><strong>è¿½è¸ªç»“æ„</strong>ï¼šè®°å½• Composable æ ‘çš„ç»“æ„ï¼ŒçŸ¥é“å“ªä¸ªç»„ä»¶åœ¨å“ªé‡Œ</li>
<li><strong>æ”¯æŒé‡ç»„</strong>ï¼šé€šè¿‡å¯¹æ¯”æ–°æ—§ Slot Tableï¼Œç¡®å®šå“ªäº›éƒ¨åˆ†éœ€è¦æ›´æ–°</li>
</ol>
<h4 data-id="heading-6">1.2.3 Slot Table çš„æºç å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// SlotTable ç®€åŒ–ç‰ˆæºç ï¼ˆä½äº androidx.compose.runtime åŒ…ï¼‰</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlotTable</span> {
    <span class="hljs-comment">// å­˜å‚¨æ•°æ®çš„æ•°ç»„ï¼Œæ‰€æœ‰çŠ¶æ€å’Œå¯¹è±¡éƒ½å­˜åœ¨è¿™é‡Œ</span>
    <span class="hljs-keyword">val</span> slots = Array&lt;Any?&gt;(<span class="hljs-number">64</span>) { <span class="hljs-literal">null</span> }
    
    <span class="hljs-comment">// å½“å‰å†™å…¥ä½ç½®</span>
    <span class="hljs-keyword">var</span> currentSlot = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// ç»„ï¼ˆGroupï¼‰çš„æ ˆï¼Œç”¨äºè¿½è¸ªåµŒå¥—çš„ Composable</span>
    <span class="hljs-keyword">val</span> groups = IntArray(<span class="hljs-number">64</span>)
    <span class="hljs-keyword">var</span> currentGroup = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// å†™å…¥æ•°æ®åˆ°å½“å‰ä½ç½®ï¼Œç„¶åç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">write</span><span class="hljs-params">(value: <span class="hljs-type">Any</span>?)</span></span> {
        slots[currentSlot++] = value
    }
    
    <span class="hljs-comment">// è¯»å–å½“å‰ä½ç½®çš„æ•°æ®ï¼Œç„¶åç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span>: Any? = slots[currentSlot++]
    
    <span class="hljs-comment">// å¼€å§‹ä¸€ä¸ªç»„ï¼ˆComposableï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startGroup</span><span class="hljs-params">(key: <span class="hljs-type">Int</span>)</span></span> {
        groups[currentGroup++] = currentSlot
        write(key)
    }
    
    <span class="hljs-comment">// ç»“æŸä¸€ä¸ªç»„</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">endGroup</span><span class="hljs-params">()</span></span> {
        currentGroup--
    }
}
</code></pre>
<h4 data-id="heading-7">1.2.4 Slot Table å¦‚ä½•å·¥ä½œï¼Ÿ</h4>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®Œæ•´ä¾‹å­ç†è§£ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p><strong>é¦–æ¬¡ç»„åˆæ—¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. å¼€å§‹ Counter ç»„
   SlotTable<span class="hljs-selector-class">.startGroup</span>("Counter".hashCode())
   
<span class="hljs-number">2</span>. æ‰§è¡Œ remember { <span class="hljs-built_in">mutableStateOf</span>(<span class="hljs-number">0</span>) }
   - åˆ›å»º MutableState å¯¹è±¡
   - å†™å…¥ SlotTable: <span class="hljs-built_in">write</span>(<span class="hljs-built_in">MutableState</span>(<span class="hljs-number">0</span>))
   
<span class="hljs-number">3</span>. å¼€å§‹ Button ç»„
   SlotTable.<span class="hljs-built_in">startGroup</span>(<span class="hljs-string">"Button"</span>.<span class="hljs-built_in">hashCode</span>())
   
<span class="hljs-number">4</span>. æ‰§è¡Œ <span class="hljs-built_in">Text</span>(<span class="hljs-string">"Count: $count"</span>)
   - è¯»å– count çš„å€¼: <span class="hljs-number">0</span>
   - å†™å…¥ SlotTable: <span class="hljs-built_in">write</span>(<span class="hljs-string">"Count: 0"</span>)
   
<span class="hljs-number">5</span>. ç»“æŸæ‰€æœ‰ç»„
</code></pre>
<p><strong>é‡ç»„æ—¶</strong>ï¼ˆç”¨æˆ·ç‚¹å‡»åï¼Œcount å˜æˆ 1ï¼‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> å¼€å§‹ Counter ç»„
<span class="hljs-bullet">   -</span> å‘ç°è¿™ä¸ªç»„å·²ç»å­˜åœ¨
<span class="hljs-bullet">   -</span> è·³è¿‡å·²å­˜åœ¨çš„å†…å®¹ï¼Œåªå¯¹æ¯”å˜åŒ–
   
<span class="hljs-bullet">2.</span> æ‰§è¡Œ remember
<span class="hljs-bullet">   -</span> å‘ç° remember å·²ç»å­˜åœ¨
<span class="hljs-bullet">   -</span> ç›´æ¥è¿”å›ç¼“å­˜çš„ MutableState
   
<span class="hljs-bullet">3.</span> æ‰§è¡Œ Text("Count: $count")
<span class="hljs-bullet">   -</span> å‘ç°ä¹‹å‰çš„å€¼æ˜¯ "Count: 0"
<span class="hljs-bullet">   -</span> æ–°çš„å€¼æ˜¯ "Count: 1"
<span class="hljs-bullet">   -</span> å€¼ä¸åŒï¼éœ€è¦æ›´æ–°
   
<span class="hljs-bullet">4.</span> åªæ›´æ–° Text ç»„ä»¶
</code></pre>
<h3 data-id="heading-8">1.3 Composition çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>Compose çš„æ¸²æŸ“è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Composition ç”Ÿå‘½å‘¨æœŸ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   åˆå§‹ç»„åˆ (<span class="hljs-keyword">Initial</span> Composition)                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1.</span> æ‰§è¡Œ Composable å‡½æ•°                                  â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2.</span> å¡«å…… Slot <span class="hljs-keyword">Table</span>                                       â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3.</span> åˆ›å»º LayoutNode æ ‘                                    â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">4.</span> æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   çŠ¶æ€å˜åŒ–                                                      â”‚
â”‚                              â†“                                  â”‚
â”‚   é‡ç»„ (Recomposition)                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1.</span> æ£€æµ‹åˆ° State å˜åŒ–                                     â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2.</span> æ ‡è®°å—å½±å“çš„ Composable ä¸º"è¿‡æœŸ"                      â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3.</span> é‡æ–°æ‰§è¡Œè¿‡æœŸçš„ Composable                             â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">4.</span> å¯¹æ¯”æ–°æ—§ Slot <span class="hljs-keyword">Table</span>                                   â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">5.</span> åªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   å¸ƒå±€ä¸ç»˜åˆ¶ (Layout <span class="hljs-operator">&amp;</span> Draw)                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1.</span> æµ‹é‡å—å½±å“çš„èŠ‚ç‚¹                                       â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2.</span> å¸ƒå±€å—å½±å“çš„èŠ‚ç‚¹                                       â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3.</span> ç»˜åˆ¶å—å½±å“çš„åŒºåŸŸ                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-9">1.4 é‡ç»„çš„è§¦å‘æœºåˆ¶</h3>
<h4 data-id="heading-10">1.4.1 State å˜åŒ–å¦‚ä½•è§¦å‘é‡ç»„ï¼Ÿ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// mutableStateOf çš„ç®€åŒ–å®ç°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">mutableStateOf</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span>: MutableState&lt;T&gt; =
    SnapshotMutableStateImpl(value)

<span class="hljs-comment">// SnapshotMutableStateImpl ç®€åŒ–ç‰ˆ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnapshotMutableStateImpl</span>&lt;<span class="hljs-type">T</span>&gt;(initial: T) : MutableState&lt;T&gt; {
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
        <span class="hljs-keyword">get</span>() = next.readable(<span class="hljs-keyword">this</span>).value
        <span class="hljs-keyword">set</span>(value) = next.withCurrent {
            <span class="hljs-keyword">if</span> (it.value != value) {
                <span class="hljs-comment">// 1. åˆ›å»ºæ–°çš„ State è®°å½•</span>
                next = it.newStateRecord(value)
                <span class="hljs-comment">// 2. é€šçŸ¥è§‚å¯Ÿè€…</span>
                notifyObservers()
            }
        }
}
</code></pre>
<p><strong>è§¦å‘æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">1. ç”¨æˆ·ç‚¹å‡»æŒ‰é’®
        â†“
2. count++ æ‰§è¡Œ
        â†“
<span class="hljs-attr">3. MutableState.value</span> = newValue
        â†“
4. åˆ›å»ºæ–°çš„ Snapshot è®°å½•
        â†“
5. é€šçŸ¥æ‰€æœ‰è¯»å–è¿‡è¯¥ State çš„ Composable
        â†“
6. å°†è¿™äº› Composable æ ‡è®°ä¸º"éœ€è¦é‡ç»„"
        â†“
7. åœ¨ä¸‹ä¸€å¸§ï¼Œæ‰§è¡Œé‡ç»„
</code></pre>
<h4 data-id="heading-11">1.4.2 é‡ç»„çš„èŒƒå›´æ§åˆ¶</h4>
<p>Compose ä¼šå°½é‡ç¼©å°é‡ç»„çš„èŒƒå›´ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Parent</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }
    
    Column {
        <span class="hljs-comment">// è¿™ä¸ª Text ä¼šé‡ç»„ï¼Œå› ä¸ºå®ƒè¯»å–äº† count</span>
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
        
        <span class="hljs-comment">// è¿™ä¸ª Button ä¸ä¼šé‡ç»„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¯»å– count</span>
        Button(onClick = { count++ }) {
            Text(<span class="hljs-string">"Increment"</span>)
        }
        
        <span class="hljs-comment">// Child ä¼šé‡ç»„å—ï¼Ÿå–å†³äºå®ƒæ˜¯å¦è¯»å–äº† count</span>
        Child(count)
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Child</span><span class="hljs-params">(count: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-comment">// å¦‚æœè¿™é‡Œä½¿ç”¨äº† countï¼Œå°±ä¼šé‡ç»„</span>
    Text(<span class="hljs-string">"Child: <span class="hljs-variable">$count</span>"</span>)
}
</code></pre>
<p><strong>é‡ç»„èŒƒå›´è§„åˆ™</strong>ï¼š</p>
<ul>
<li>åªæœ‰<strong>è¯»å–äº†å˜åŒ– State</strong> çš„ Composable æ‰ä¼šé‡ç»„</li>
<li>é‡ç»„ä¼š<strong>å‘ä¸‹ä¼ æ’­</strong>åˆ°æ‰€æœ‰å­ Composable</li>
<li>å¯ä»¥é€šè¿‡<strong>å‚æ•°ä¼ é€’</strong>æ§åˆ¶é‡ç»„èŒƒå›´</li>
</ul>
<h3 data-id="heading-12">1.5 é‡ç»„çš„ä¼˜åŒ–ç­–ç•¥</h3>
<h4 data-id="heading-13">1.5.1 @Stable ä¸ @Immutable</h4>
<p>Compose ä½¿ç”¨ <strong>ç¨³å®šæ€§ï¼ˆStabilityï¼‰</strong> æ¥åˆ¤æ–­å¯¹è±¡å˜åŒ–æ—¶æ˜¯å¦éœ€è¦é‡ç»„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ç¨³å®šç±» - ä»»ä½•å˜åŒ–éƒ½ä¼šè§¦å‘é‡ç»„</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UnstableUser</span> {
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
}

<span class="hljs-comment">// ç¨³å®šç±» - åªæœ‰å±æ€§å˜åŒ–æ—¶è§¦å‘é‡ç»„</span>
<span class="hljs-meta">@Stable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StableUser</span> {
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">""</span>
    <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
}

<span class="hljs-comment">// ä¸å¯å˜ç±» - å®ä¾‹æ›¿æ¢æ—¶è§¦å‘é‡ç»„</span>
<span class="hljs-meta">@Immutable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmutableUser</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>
)
</code></pre>
<p><strong>ç¨³å®šæ€§å¯¹æ¯”</strong>ï¼š</p>

























<table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th><th>è§¦å‘é‡ç»„æ¡ä»¶</th></tr></thead><tbody><tr><td>æ— </td><td>ä¸ç¨³å®š</td><td>ä»»ä½•æƒ…å†µéƒ½å¯èƒ½é‡ç»„</td></tr><tr><td>@Stable</td><td>ç¨³å®š</td><td>å±æ€§å˜åŒ–æ—¶é‡ç»„</td></tr><tr><td>@Immutable</td><td>ä¸å¯å˜</td><td>å®ä¾‹æ›¿æ¢æ—¶é‡ç»„</td></tr></tbody></table>
<h4 data-id="heading-14">1.5.2 remember çš„å¦™ç”¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ExpensiveCalculation</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    <span class="hljs-comment">// âŒ é”™è¯¯ï¼šæ¯æ¬¡é‡ç»„éƒ½é‡æ–°è®¡ç®—</span>
    <span class="hljs-keyword">val</span> sum = <span class="hljs-keyword">data</span>.sum()
    
    <span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåªåœ¨ data å˜åŒ–æ—¶è®¡ç®—</span>
    <span class="hljs-keyword">val</span> sum = remember(<span class="hljs-keyword">data</span>) { <span class="hljs-keyword">data</span>.sum() }
    
    Text(<span class="hljs-string">"Sum: <span class="hljs-variable">$sum</span>"</span>)
}
</code></pre>
<h4 data-id="heading-15">1.5.3 derivedStateOfï¼šæ´¾ç”ŸçŠ¶æ€</h4>
<p>å½“çŠ¶æ€å˜åŒ–é¢‘ç¹ï¼Œä½† UI ä¸éœ€è¦æ¯æ¬¡éƒ½æ›´æ–°æ—¶ï¼Œä½¿ç”¨ <code>derivedStateOf</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchList</span><span class="hljs-params">(query: <span class="hljs-type">String</span>, items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    <span class="hljs-comment">// âŒ é”™è¯¯ï¼šæ¯æ¬¡ query å˜åŒ–éƒ½è¿‡æ»¤æ•´ä¸ªåˆ—è¡¨</span>
    <span class="hljs-keyword">val</span> filtered = items.filter { it.name.contains(query) }
    
    <span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåªåœ¨å¿…è¦æ—¶æ›´æ–°</span>
    <span class="hljs-keyword">val</span> filtered <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            items.filter { it.name.contains(query) }
        }
    }
    
    LazyColumn {
        items(filtered) { item -&gt;
            ItemRow(item)
        }
    }
}
</code></pre>
<p><strong>derivedStateOf çš„åŸç†</strong>ï¼š</p>
<ul>
<li>å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªç¼“å­˜å€¼</li>
<li>åªæœ‰è¯»å–æ—¶æ‰ä¼šé‡æ–°è®¡ç®—</li>
<li>è®¡ç®—ç»“æœå˜åŒ–æ—¶æ‰é€šçŸ¥è§‚å¯Ÿè€…</li>
</ul>
<hr/>
<h2 data-id="heading-16">äºŒã€remember ä¸ mutableStateOf æºç è§£æ</h2>
<h3 data-id="heading-17">2.1 remember çš„åŸç†</h3>
<p><code>remember</code> æ˜¯ Compose ä¸­ç”¨äº<strong>ç¼“å­˜è®¡ç®—ç»“æœ</strong>çš„å‡½æ•°ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼šåœ¨é‡ç»„æ—¶ä¿æŒçŠ¶æ€ä¸å˜ã€‚</p>
<h4 data-id="heading-18">2.1.1 ä¸ºä»€ä¹ˆéœ€è¦ rememberï¼Ÿ</h4>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>  <span class="hljs-comment">// âŒ é”™è¯¯ï¼šæ¯æ¬¡é‡ç»„éƒ½ä¼šé‡ç½®ä¸º 0</span>
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p>æ¯æ¬¡ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œè§¦å‘é‡ç»„ï¼Œ<code>count</code> éƒ½ä¼šè¢«é‡æ–°åˆå§‹åŒ–ä¸º 0ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰"è®°ä½"è¿™ä¸ªå€¼ã€‚</p>
<p><strong>remember çš„ä½œç”¨</strong>ï¼šåœ¨é¦–æ¬¡ç»„åˆæ—¶è®¡ç®—å€¼ï¼Œå¹¶åœ¨åç»­é‡ç»„æ—¶è¿”å›ç¼“å­˜çš„å€¼ã€‚</p>
<h4 data-id="heading-19">2.1.2 remember çš„æºç å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// remember çš„ç®€åŒ–å®ç°</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">remember</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> keys: <span class="hljs-type">Any</span>?,  <span class="hljs-comment">// ç¼“å­˜çš„ key</span>
    calculation: () -&gt; <span class="hljs-type">T</span>  <span class="hljs-comment">// è®¡ç®—å‡½æ•°</span>
)</span></span>: T {
    <span class="hljs-comment">// è·å–å½“å‰ Composer</span>
    <span class="hljs-keyword">val</span> composer = currentComposer
    
    <span class="hljs-comment">// åœ¨ Slot Table ä¸­æŸ¥æ‰¾ç¼“å­˜</span>
    <span class="hljs-keyword">val</span> slot = composer.nextSlot()
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (slot === Composer.Empty || 
               keys.any { it != composer.rememberedValue() }) {
        <span class="hljs-comment">// ç¼“å­˜ä¸å­˜åœ¨æˆ– key å˜åŒ–ï¼Œé‡æ–°è®¡ç®—</span>
        <span class="hljs-keyword">val</span> value = calculation()
        composer.updateRememberedValue(value)
        value
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜</span>
        <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
        slot <span class="hljs-keyword">as</span> T
    }
}
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      remember æ‰§è¡Œæµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç¬¬ä¸€æ¬¡ç»„åˆ                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ <span class="hljs-number">1</span>. è¯»å– Slot <span class="hljs-selector-tag">Table</span> â†’ å¾—åˆ° Composer<span class="hljs-selector-class">.Empty</span>               â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">2</span>. æ‰§è¡Œ calculation()                                   â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">3</span>. å°†ç»“æœå†™å…¥ Slot <span class="hljs-selector-tag">Table</span>                                â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">4</span>. è¿”å›ç»“æœ                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                  â”‚
â”‚  é‡ç»„ï¼ˆkey æœªå˜åŒ–ï¼‰                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ <span class="hljs-number">1</span>. è¯»å– Slot <span class="hljs-selector-tag">Table</span> â†’ å¾—åˆ°ç¼“å­˜å€¼                         â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">2</span>. å¯¹æ¯” keys â†’ æ²¡æœ‰å˜åŒ–                                 â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">3</span>. ç›´æ¥è¿”å›ç¼“å­˜å€¼ï¼ˆè·³è¿‡äº† calculationï¼‰                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                  â”‚
â”‚  é‡ç»„ï¼ˆkey å˜åŒ–ï¼‰                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ <span class="hljs-number">1</span>. è¯»å– Slot <span class="hljs-selector-tag">Table</span> â†’ å¾—åˆ°ç¼“å­˜å€¼                         â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">2</span>. å¯¹æ¯” keys â†’ æœ‰å˜åŒ–                                   â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">3</span>. æ‰§è¡Œ calculation()                                   â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">4</span>. æ›´æ–° Slot <span class="hljs-selector-tag">Table</span>                                      â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">5</span>. è¿”å›æ–°ç»“æœ                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-20">2.1.3 remember çš„å¤šç§ç”¨æ³•</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. æ—  key - æ°¸è¿œä½¿ç”¨ç¼“å­˜</span>
<span class="hljs-keyword">val</span> value = remember { expensiveCalculation() }

<span class="hljs-comment">// 2. æœ‰ key - key å˜åŒ–æ—¶é‡æ–°è®¡ç®—</span>
<span class="hljs-keyword">val</span> value = remember(userId) { loadUser(userId) }

<span class="hljs-comment">// 3. å¤šä¸ª key - ä»»ä¸€ key å˜åŒ–éƒ½é‡æ–°è®¡ç®—</span>
<span class="hljs-keyword">val</span> value = remember(userId, refreshFlag) { loadUser(userId) }

<span class="hljs-comment">// 4. rememberSaveable - é…ç½®å˜æ›´åæ¢å¤</span>
<span class="hljs-keyword">val</span> value = rememberSaveable { mutableStateOf(<span class="hljs-number">0</span>) }
</code></pre>
<h3 data-id="heading-21">2.2 mutableStateOf çš„åŸç†</h3>
<p><code>mutableStateOf</code> åˆ›å»ºäº†ä¸€ä¸ª<strong>å¯è§‚å¯Ÿçš„çŠ¶æ€å¯¹è±¡</strong>ï¼Œå½“å€¼å˜åŒ–æ—¶ä¼šè‡ªåŠ¨è§¦å‘é‡ç»„ã€‚</p>
<h4 data-id="heading-22">2.2.1 mutableStateOf çš„æºç å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// mutableStateOf å®ç°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">mutableStateOf</span><span class="hljs-params">(
    value: <span class="hljs-type">T</span>,
    policy: <span class="hljs-type">SnapshotMutationPolicy</span>&lt;<span class="hljs-type">T</span>&gt; = structuralEqualityPolicy()</span></span>
): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy)

<span class="hljs-comment">// SnapshotMutableStateImpl ç®€åŒ–ç‰ˆ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnapshotMutableStateImpl</span>&lt;<span class="hljs-type">T</span>&gt;(
    initial: T,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> policy: SnapshotMutationPolicy&lt;T&gt;
) : MutableState&lt;T&gt; {
    
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
        <span class="hljs-keyword">get</span>() = next.readable(<span class="hljs-keyword">this</span>).value
        <span class="hljs-keyword">set</span>(value) = next.withCurrent {
            <span class="hljs-comment">// ä½¿ç”¨ policy åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span>
            <span class="hljs-keyword">if</span> (!policy.equivalent(it.value, value)) {
                <span class="hljs-comment">// åˆ›å»ºæ–°çš„ State è®°å½•</span>
                next = it.newStateRecord(value)
            }
        }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">component1</span><span class="hljs-params">()</span></span>: T = value
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">component2</span><span class="hljs-params">()</span></span>: (T) -&gt; <span class="hljs-built_in">Unit</span> = { value = it }
}
</code></pre>
<h4 data-id="heading-23">2.2.2 Snapshot æœºåˆ¶</h4>
<p>Compose çš„ State åŸºäº <strong>Snapshotï¼ˆå¿«ç…§ï¼‰</strong> æœºåˆ¶å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Snapshot æœºåˆ¶                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Snapshot 1 (å½“å‰)                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  StateRecord 1: <span class="hljs-attr">value</span> = <span class="hljs-string">"A"</span>                             â”‚  â”‚
â”‚   â”‚  StateRecord 2: <span class="hljs-attr">value</span> = <span class="hljs-string">"B"</span>  â† å½“å‰å€¼                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   <span class="hljs-attr">value</span> = <span class="hljs-string">"C"</span> (ä¿®æ”¹)                                            â”‚
â”‚                              â†“                                  â”‚
â”‚   Snapshot 2 (æ–°å¿«ç…§)                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  StateRecord 1: <span class="hljs-attr">value</span> = <span class="hljs-string">"A"</span>                             â”‚  â”‚
â”‚   â”‚  StateRecord 2: <span class="hljs-attr">value</span> = <span class="hljs-string">"B"</span>                             â”‚  â”‚
â”‚   â”‚  StateRecord 3: <span class="hljs-attr">value</span> = <span class="hljs-string">"C"</span>  â† æ–°è®°å½•                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   é€šçŸ¥è§‚å¯Ÿè€…ï¼šå€¼ä» "B" å˜ä¸º "C"                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>Snapshot çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>åŸå­æ€§</strong>ï¼šå¤šä¸ª State çš„ä¿®æ”¹è¦ä¹ˆå…¨éƒ¨ç”Ÿæ•ˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸ç”Ÿæ•ˆ</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šè¯»å–æ—¶çœ‹åˆ°çš„æ˜¯ä¸€è‡´çš„å¿«ç…§</li>
<li><strong>å¯å›æ»š</strong>ï¼šå¯ä»¥ä¸¢å¼ƒæœªæäº¤çš„ä¿®æ”¹</li>
</ul>
<h4 data-id="heading-24">2.2.3 çŠ¶æ€æ¯”è¾ƒç­–ç•¥</h4>
<p><code>mutableStateOf</code> æ”¯æŒä¸‰ç§æ¯”è¾ƒç­–ç•¥ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ç»“æ„ç›¸ç­‰ï¼ˆé»˜è®¤ï¼‰- ä½¿ç”¨ == æ¯”è¾ƒ</span>
<span class="hljs-keyword">val</span> state = mutableStateOf(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))
state.value = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment">// ä¸ä¼šè§¦å‘é‡ç»„ï¼Œå› ä¸ºå†…å®¹ç›¸ç­‰</span>

<span class="hljs-comment">// 2. å¼•ç”¨ç›¸ç­‰ - ä½¿ç”¨ === æ¯”è¾ƒ</span>
<span class="hljs-keyword">val</span> state = mutableStateOf(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), policy = referentialEqualityPolicy())
state.value = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment">// ä¼šè§¦å‘é‡ç»„ï¼Œå› ä¸ºæ˜¯æ–°å¯¹è±¡</span>

<span class="hljs-comment">// 3. æ°¸ä¸æ¯”è¾ƒ - æ€»æ˜¯è®¤ä¸ºä¸åŒ</span>
<span class="hljs-keyword">val</span> state = mutableStateOf(<span class="hljs-number">0</span>, policy = neverEqualPolicy())
state.value = <span class="hljs-number">0</span>  <span class="hljs-comment">// ä¼šè§¦å‘é‡ç»„</span>
</code></pre>
<h3 data-id="heading-25">2.3 rememberSaveable çš„åŸç†</h3>
<p><code>rememberSaveable</code> å¯ä»¥åœ¨<strong>é…ç½®å˜æ›´</strong>ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰åæ¢å¤çŠ¶æ€ã€‚</p>
<h4 data-id="heading-26">2.3.1 ä¸ºä»€ä¹ˆéœ€è¦ rememberSaveableï¼Ÿ</h4>
<p>çœ‹ä¸€ä¸ªåœºæ™¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FormScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> name <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    <span class="hljs-keyword">var</span> email <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    
    <span class="hljs-comment">// ç”¨æˆ·å¡«å†™äº†è¡¨å•...</span>
    
    <span class="hljs-comment">// æ—‹è½¬å±å¹•åï¼Œname å’Œ email éƒ½å˜æˆç©ºå­—ç¬¦ä¸²äº†ï¼</span>
    <span class="hljs-comment">// å› ä¸º Activity é‡å»ºï¼Œremember çš„ç¼“å­˜ä¸¢å¤±äº†</span>
}
</code></pre>
<p><strong>rememberSaveable çš„ä½œç”¨</strong>ï¼šå°†çŠ¶æ€ä¿å­˜åˆ° Bundleï¼Œé…ç½®å˜æ›´åè‡ªåŠ¨æ¢å¤ã€‚</p>
<h4 data-id="heading-27">2.3.2 å®ç°åŸç†</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any&gt;</span> <span class="hljs-title">rememberSaveable</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> inputs: <span class="hljs-type">Any</span>?,
    saver: <span class="hljs-type">Saver</span>&lt;<span class="hljs-type">T</span>, <span class="hljs-keyword">out</span> Any&gt; = autoSaver()</span></span>,
    key: String? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">init</span>: () -&gt; T
): T {
    <span class="hljs-comment">// ç»„åˆæœ¬åœ°æä¾›çš„ SaveableStateRegistry</span>
    <span class="hljs-keyword">val</span> registry = LocalSaveableStateRegistry.current
    
    <span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€ key</span>
    <span class="hljs-keyword">val</span> finalKey = key ?: rememberSaveableKey()
    
    <span class="hljs-comment">// å°è¯•ä» Bundle æ¢å¤</span>
    <span class="hljs-keyword">val</span> restored = registry?.consumeRestored(finalKey)
    
    <span class="hljs-comment">// åˆ›å»ºæˆ–æ¢å¤çŠ¶æ€</span>
    <span class="hljs-keyword">val</span> value = remember(*inputs) {
        restored?.let { saver.restore(it) } ?: <span class="hljs-keyword">init</span>()
    }
    
    <span class="hljs-comment">// æ³¨å†Œä¿å­˜å›è°ƒ</span>
    <span class="hljs-keyword">if</span> (registry != <span class="hljs-literal">null</span>) {
        DisposableEffect(registry, finalKey, saver) {
            <span class="hljs-keyword">val</span> entry = registry.registerProvider(finalKey) {
                saver.save(value)
            }
            onDispose { entry.unregister() }
        }
    }
    
    <span class="hljs-keyword">return</span> value
}
</code></pre>
<p><strong>ä¿å­˜ä¸æ¢å¤æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  rememberSaveable æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   é¦–æ¬¡åˆ›å»º                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. æ£€æŸ¥ Bundle ä¸­æ²¡æœ‰è¯¥ key çš„ä¿å­˜å€¼                     â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. æ‰§è¡Œ <span class="hljs-built_in">init</span>() åˆ›å»ºåˆå§‹å€¼                               â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. æ³¨å†Œä¿å­˜å›è°ƒåˆ° SaveableStateRegistry                 â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">4</span>. è¿”å›åˆå§‹å€¼                                           â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   é…ç½®å˜æ›´ï¼ˆå¦‚æ—‹è½¬å±å¹•ï¼‰                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. Activity è¢«é”€æ¯ï¼Œè§¦å‘ onSaveInstanceState            â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. SaveableStateRegistry è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„ä¿å­˜å›è°ƒ          â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. å°†å€¼åºåˆ—åŒ–ä¿å­˜åˆ° Bundle                               â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">4</span>. Activity é‡å»º                                         â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">5</span>. ä» Bundle æ¢å¤å€¼                                      â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">6</span>. rememberSaveable è¯»å–æ¢å¤çš„å€¼                         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-28">2.3.3 è‡ªå®šä¹‰ Saver</h4>
<p><strong>ä»€ä¹ˆæ˜¯ Saverï¼Ÿ</strong></p>
<p>Saver æ˜¯ rememberSaveable ç”¨æ¥<strong>åºåˆ—åŒ–å’Œååºåˆ—åŒ–çŠ¶æ€</strong>çš„å·¥å…·ã€‚å› ä¸º Bundle åªèƒ½å­˜å‚¨ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ Compose å¦‚ä½•å°†è‡ªå®šä¹‰å¯¹è±¡è½¬æ¢ä¸º Bundle å¯å­˜å‚¨çš„æ ¼å¼ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰ Saverï¼Ÿ</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰ç±»</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> email: String
)

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›´æ¥ rememberSaveable ä¼šå´©æºƒ</span>
<span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> rememberSaveable { mutableStateOf(User(<span class="hljs-number">1</span>, <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"zhangsan@example.com"</span>)) }
<span class="hljs-comment">// å´©æºƒåŸå› ï¼šUser ç±»ä¸çŸ¥é“å¦‚ä½•ä¿å­˜åˆ° Bundle</span>
</code></pre>
<p><strong>è‡ªå®šä¹‰ Saver ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ºè‡ªå®šä¹‰ç±»åˆ›å»º Saver</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> email: String)

<span class="hljs-keyword">val</span> UserSaver = Saver&lt;User, Bundle&gt;(
    <span class="hljs-comment">// save: å°† User è½¬æ¢ä¸º Bundle</span>
    save = { user -&gt;
        Bundle().apply {
            putInt(<span class="hljs-string">"id"</span>, user.id)
            putString(<span class="hljs-string">"name"</span>, user.name)
            putString(<span class="hljs-string">"email"</span>, user.email)
        }
    },
    <span class="hljs-comment">// restore: ä» Bundle æ¢å¤ User</span>
    restore = { bundle -&gt;
        User(
            id = bundle.getInt(<span class="hljs-string">"id"</span>),
            name = bundle.getString(<span class="hljs-string">"name"</span>) ?: <span class="hljs-string">""</span>,
            email = bundle.getString(<span class="hljs-string">"email"</span>) ?: <span class="hljs-string">""</span>
        )
    }
)

<span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰ Saver</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> rememberSaveable(saver = UserSaver) {
        mutableStateOf(User(<span class="hljs-number">1</span>, <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"zhangsan@example.com"</span>))
    }
    
    <span class="hljs-comment">// ç°åœ¨æ—‹è½¬å±å¹•åï¼Œuser çš„å€¼ä¼šè¢«æ­£ç¡®æ¢å¤</span>
    Text(<span class="hljs-string">"Name: <span class="hljs-subst">${user.name}</span>"</span>)
}
</code></pre>
<p><strong>Saver ç”Ÿæ•ˆæœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Saver ç”Ÿæ•ˆæµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ä¿å­˜æ—¶                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ <span class="hljs-number">1</span>. rememberSaveable æ£€æµ‹åˆ°é…ç½®å˜æ›´                       â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">2</span>. è°ƒç”¨ Saver<span class="hljs-selector-class">.save</span>(value)                                â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">3</span>. è¿”å› Bundle/Parcelable/List ç­‰å¯åºåˆ—åŒ–ç±»å‹            â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">4</span>. ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜åˆ° Activity çš„ Bundle                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                  â”‚
â”‚  æ¢å¤æ—¶                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ <span class="hljs-number">1</span>. Activity é‡å»ºï¼Œä» Bundle è¯»å–ä¿å­˜çš„æ•°æ®               â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">2</span>. rememberSaveable è°ƒç”¨ Saver<span class="hljs-selector-class">.restore</span>(savedData)        â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">3</span>. è¿”å›æ¢å¤åçš„å¯¹è±¡                                        â”‚   â”‚
â”‚  â”‚ <span class="hljs-number">4</span>. èµ‹å€¼ç»™çŠ¶æ€å˜é‡                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>é€‚åˆä½¿ç”¨è‡ªå®šä¹‰ Saver çš„åœºæ™¯</strong>ï¼š</p>
<ol>
<li><strong>è¡¨å•æ•°æ®</strong>ï¼šç”¨æˆ·å¡«å†™çš„è¡¨å•ï¼Œæ—‹è½¬å±å¹•åéœ€è¦ä¿ç•™</li>
<li><strong>æ»šåŠ¨ä½ç½®</strong>ï¼šåˆ—è¡¨çš„æ»šåŠ¨ä½ç½®</li>
<li><strong>ç”¨æˆ·åå¥½</strong>ï¼šå½“å‰é€‰ä¸­çš„é€‰é¡¹ã€å¼€å…³çŠ¶æ€</li>
<li><strong>ä¸´æ—¶æ•°æ®</strong>ï¼šæœªæäº¤çš„ç¼–è¾‘å†…å®¹</li>
</ol>
<p><strong>ä¸é€‚åˆä½¿ç”¨ Saver çš„åœºæ™¯</strong>ï¼š</p>
<ol>
<li><strong>å¤§é‡æ•°æ®</strong>ï¼šBundle æœ‰å¤§å°é™åˆ¶ï¼ˆçº¦ 1MBï¼‰</li>
<li><strong>æ•æ„Ÿæ•°æ®</strong>ï¼šBundle æ•°æ®å¯ä»¥è¢«è¯»å–</li>
<li><strong>ä¸éœ€è¦æŒä¹…åŒ–çš„æ•°æ®</strong>ï¼šå¦‚ç½‘ç»œè¯·æ±‚ç»“æœ</li>
</ol>
<hr/>
<h2 data-id="heading-29">ä¸‰ã€çŠ¶æ€æå‡ï¼ˆState Hoistingï¼‰è®¾è®¡æ¨¡å¼</h2>
<h3 data-id="heading-30">3.1 ä»€ä¹ˆæ˜¯çŠ¶æ€æå‡ï¼Ÿ</h3>
<p><strong>çŠ¶æ€æå‡</strong>æ˜¯ Compose æ¨èçš„çŠ¶æ€ç®¡ç†æ¨¡å¼ï¼šå°†çŠ¶æ€ä»å­ç»„ä»¶"æå‡"åˆ°çˆ¶ç»„ä»¶ï¼Œå­ç»„ä»¶é€šè¿‡å‚æ•°æ¥æ”¶çŠ¶æ€ï¼Œé€šè¿‡å›è°ƒé€šçŸ¥çŠ¶æ€å˜åŒ–ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆå«"æå‡"ï¼Ÿ</strong></p>
<p>æƒ³è±¡ä¸€ä¸ªç»„ä»¶æ ‘ï¼š</p>
<pre><code class="hljs">Parent
â”œâ”€â”€ ChildA
â”‚   â””â”€â”€ GrandChild
â””â”€â”€ ChildB
</code></pre>
<p>å¦‚æœ <code>GrandChild</code> éœ€è¦ä¿®æ”¹çŠ¶æ€ï¼Œè€Œè¿™ä¸ªçŠ¶æ€éœ€è¦å½±å“ <code>ChildB</code>ï¼Œé‚£ä¹ˆçŠ¶æ€å°±éœ€è¦"æå‡"åˆ°å®ƒä»¬çš„å…±åŒç¥–å…ˆ <code>Parent</code>ã€‚</p>
<h3 data-id="heading-31">3.2 çŠ¶æ€æå‡çš„è®¾è®¡åŸåˆ™</h3>
<p><strong>å•ä¸€æ•°æ®æº</strong>ï¼šçŠ¶æ€åªåœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰
<strong>çŠ¶æ€å‘ä¸‹æµåŠ¨</strong>ï¼šé€šè¿‡å‚æ•°ä¼ é€’ç»™å­ç»„ä»¶
<strong>äº‹ä»¶å‘ä¸Šä¼ é€’</strong>ï¼šé€šè¿‡å›è°ƒé€šçŸ¥çˆ¶ç»„ä»¶ä¿®æ”¹çŠ¶æ€</p>
<h3 data-id="heading-32">3.3 çŠ¶æ€æå‡çš„ç¤ºä¾‹</h3>
<h4 data-id="heading-33">3.3.1 æ— çŠ¶æ€æå‡ï¼ˆé—®é¢˜ä»£ç ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šçŠ¶æ€åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶ä¸­</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CounterScreen</span><span class="hljs-params">()</span></span> {
    Column {
        Counter()  <span class="hljs-comment">// æ¯ä¸ª Counter æœ‰è‡ªå·±çš„çŠ¶æ€</span>
        Counter()
        Counter()
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-number">0</span>) }  <span class="hljs-comment">// çŠ¶æ€åœ¨å­ç»„ä»¶ä¸­</span>
    
    Button(onClick = { count++ }) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>æ— æ³•åŒæ­¥å¤šä¸ª Counter çš„çŠ¶æ€</li>
<li>çˆ¶ç»„ä»¶æ— æ³•è·å–/ä¿®æ”¹å­ç»„ä»¶çš„çŠ¶æ€</li>
<li>çŠ¶æ€åˆ†æ•£ï¼Œéš¾ä»¥ç®¡ç†</li>
</ul>
<h4 data-id="heading-34">3.3.2 æœ‰çŠ¶æ€æå‡ï¼ˆæ­£ç¡®ä»£ç ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šçŠ¶æ€æå‡åˆ°çˆ¶ç»„ä»¶</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CounterScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> counts <span class="hljs-keyword">by</span> remember { mutableStateOf(List(<span class="hljs-number">3</span>) { <span class="hljs-number">0</span> }) }
    
    Column {
        counts.forEachIndexed { index, count -&gt;
            Counter(
                count = count,
                onIncrement = {
                    counts = counts.toMutableList().apply {
                        <span class="hljs-keyword">this</span>[index]++
                    }
                }
            )
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Counter</span><span class="hljs-params">(
    count: <span class="hljs-type">Int</span>,                    <span class="hljs-comment">// çŠ¶æ€é€šè¿‡å‚æ•°ä¼ å…¥</span>
    onIncrement: () -&gt; <span class="hljs-type">Unit</span>        <span class="hljs-comment">// äº‹ä»¶é€šè¿‡å›è°ƒä¼ å‡º</span>
)</span></span> {
    Button(onClick = onIncrement) {
        Text(<span class="hljs-string">"Count: <span class="hljs-variable">$count</span>"</span>)
    }
}
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>çŠ¶æ€é›†ä¸­ç®¡ç†</li>
<li>å­ç»„ä»¶å¯å¤ç”¨</li>
<li>æ˜“äºæµ‹è¯•</li>
</ul>
<h3 data-id="heading-35">3.4 çŠ¶æ€æå‡çš„è®¾è®¡æ¨¡å¼</h3>
<h4 data-id="heading-36">3.4.1 çŠ¶æ€å®¹å™¨æ¨¡å¼</h4>
<p>å¯¹äºå¤æ‚çš„çŠ¶æ€ï¼Œå¯ä»¥åˆ›å»ºä¸“é—¨çš„çŠ¶æ€å®¹å™¨ç±»ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// çŠ¶æ€å®¹å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterState</span> {
    <span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> mutableStateOf(<span class="hljs-number">0</span>)
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> {
        count++
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span></span> {
        count--
    }
}

<span class="hljs-comment">// ä½¿ç”¨ remember åˆ›å»ºçŠ¶æ€å®¹å™¨</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">rememberCounterState</span><span class="hljs-params">()</span></span> = remember { CounterState() }

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CounterScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> state = rememberCounterState()
    
    Counter(
        count = state.count,
        onIncrement = { state.increment() }
    )
}
</code></pre>
<h4 data-id="heading-37">3.4.2 å±å¹•çº§çŠ¶æ€ç®¡ç†</h4>
<p>å¯¹äºæ•´ä¸ªå±å¹•çš„çŠ¶æ€ï¼Œå¯ä»¥åœ¨å±å¹•çº§ Composable ä¸­ç»Ÿä¸€ç®¡ç†ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfileScreen</span><span class="hljs-params">(
    userId: <span class="hljs-type">String</span>,
    viewModel: <span class="hljs-type">UserProfileViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-comment">// æ”¶é›† ViewModel çš„çŠ¶æ€</span>
    <span class="hljs-keyword">val</span> uiState <span class="hljs-keyword">by</span> viewModel.uiState.collectAsState()
    
    <span class="hljs-comment">// å±å¹•çº§çŠ¶æ€ç®¡ç†</span>
    <span class="hljs-keyword">var</span> isEditing <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-literal">false</span>) }
    <span class="hljs-keyword">var</span> editedName <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    
    <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> state = uiState) {
        <span class="hljs-keyword">is</span> UiState.Loading -&gt; LoadingScreen()
        <span class="hljs-keyword">is</span> UiState.Error -&gt; ErrorScreen(state.message)
        <span class="hljs-keyword">is</span> UiState.Success -&gt; {
            UserProfileContent(
                user = state.<span class="hljs-keyword">data</span>,
                isEditing = isEditing,
                editedName = editedName,
                onEditClick = { 
                    isEditing = <span class="hljs-literal">true</span>
                    editedName = state.<span class="hljs-keyword">data</span>.name
                },
                onNameChange = { editedName = it },
                onSaveClick = {
                    viewModel.updateName(editedName)
                    isEditing = <span class="hljs-literal">false</span>
                }
            )
        }
    }
}
</code></pre>
<h3 data-id="heading-38">3.5 çŠ¶æ€æå‡çš„è¾¹ç•Œ</h3>
<p>ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½éœ€è¦æå‡ï¼Œéœ€è¦æ ¹æ®åœºæ™¯åˆ¤æ–­ï¼š</p>





















<table><thead><tr><th>çŠ¶æ€ä½ç½®</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å­ç»„ä»¶å†…éƒ¨</td><td>çº¯ UI çŠ¶æ€ï¼ˆå¦‚åŠ¨ç”»çŠ¶æ€ã€æ»šåŠ¨ä½ç½®ï¼‰</td></tr><tr><td>çˆ¶ç»„ä»¶</td><td>éœ€è¦å…±äº«çš„çŠ¶æ€ã€éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€</td></tr><tr><td>ViewModel</td><td>ä¸šåŠ¡é€»è¾‘çŠ¶æ€ã€éœ€è¦è·¨å±å¹•å…±äº«çš„çŠ¶æ€</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-39">å››ã€ViewModel ä¸ Compose æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-40">4.1 ViewModel çš„ä½œç”¨</h3>
<p>ViewModel æ˜¯ Android æ¶æ„ç»„ä»¶ï¼Œç”¨äºï¼š</p>
<ul>
<li><strong>ä¿å­˜é…ç½®å˜æ›´åçš„çŠ¶æ€</strong></li>
<li><strong>ç®¡ç†ä¸šåŠ¡é€»è¾‘</strong></li>
<li><strong>ä½œä¸º UI å±‚å’Œæ•°æ®å±‚çš„æ¡¥æ¢</strong></li>
</ul>
<h3 data-id="heading-41">4.2 ViewModel ä¸ Compose çš„é›†æˆ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewModel å®šä¹‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {
    
    <span class="hljs-comment">// ä½¿ç”¨ StateFlow ç®¡ç†çŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow&lt;UiState&lt;User&gt;&gt;(UiState.Loading)
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;UiState&lt;User&gt;&gt; = _uiState.asStateFlow()
    
    <span class="hljs-keyword">init</span> {
        loadUser()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _uiState.value = UiState.Loading
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser()
                _uiState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.value = UiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span> {
        loadUser()
    }
}

<span class="hljs-comment">// Composable ä¸­ä½¿ç”¨</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserScreen</span><span class="hljs-params">(
    viewModel: <span class="hljs-type">UserViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-keyword">val</span> uiState <span class="hljs-keyword">by</span> viewModel.uiState.collectAsState()
    
    <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> state = uiState) {
        <span class="hljs-keyword">is</span> UiState.Loading -&gt; LoadingScreen()
        <span class="hljs-keyword">is</span> UiState.Error -&gt; ErrorScreen(
            message = state.message,
            onRetry = { viewModel.refresh() }
        )
        <span class="hljs-keyword">is</span> UiState.Success -&gt; UserContent(user = state.<span class="hljs-keyword">data</span>)
    }
}
</code></pre>
<h3 data-id="heading-42">4.3 StateFlow vs LiveData</h3>
<p>åœ¨ Compose ä¸­ï¼Œæ¨èä½¿ç”¨ <strong>StateFlow</strong>ï¼š</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>StateFlow</th><th>LiveData</th></tr></thead><tbody><tr><td>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</td><td>éœ€è¦é…åˆ <code>collectAsState</code></td><td>è‡ªåŠ¨æ„ŸçŸ¥</td></tr><tr><td>åˆå§‹å€¼</td><td>å¿…é¡»æœ‰</td><td>å¯ä»¥æ²¡æœ‰</td></tr><tr><td>çº¿ç¨‹å®‰å…¨</td><td>æ˜¯</td><td>æ˜¯</td></tr><tr><td>ä¸ Compose é›†æˆ</td><td>æ›´è‡ªç„¶</td><td>éœ€è¦é¢å¤–è½¬æ¢</td></tr></tbody></table>
<h3 data-id="heading-43">4.4 UI çŠ¶æ€è®¾è®¡æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-44">4.4.1 å•ä¸€çŠ¶æ€ç±»</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ¨èï¼šä½¿ç”¨å•ä¸€çŠ¶æ€ç±»</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserUiState</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Loading : UserUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-keyword">val</span> user: User) : UserUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UserUiState
}

<span class="hljs-comment">// âŒ ä¸æ¨èï¼šåˆ†æ•£çš„çŠ¶æ€</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">val</span> isLoading = MutableStateFlow(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">val</span> user = MutableStateFlow&lt;User?&gt;(<span class="hljs-literal">null</span>)
    <span class="hljs-keyword">val</span> error = MutableStateFlow&lt;String?&gt;(<span class="hljs-literal">null</span>)
}
</code></pre>
<h4 data-id="heading-45">4.4.2 ä¸å¯å˜çŠ¶æ€</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ¨èï¼šçŠ¶æ€ä¸å¯å˜ï¼Œé€šè¿‡ copy æ›´æ–°</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserUiState</span>(
    <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">val</span> user: User? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">val</span> error: String? = <span class="hljs-literal">null</span>
)

<span class="hljs-comment">// ViewModel ä¸­</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow(UserUiState())
<span class="hljs-keyword">val</span> uiState = _uiState.asStateFlow()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    _uiState.update { it.copy(user = user, isLoading = <span class="hljs-literal">false</span>) }
}
</code></pre>
<h3 data-id="heading-46">4.5 ViewModel çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ViewModel ç”Ÿå‘½å‘¨æœŸ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Activity/Fragment åˆ›å»º                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. ViewModel åˆ›å»º                                       â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. æ‰§è¡Œ init å—                                         â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. å¼€å§‹æ”¶é›†æ•°æ®                                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   é…ç½®å˜æ›´ï¼ˆæ—‹è½¬å±å¹•ï¼‰                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. Activity é”€æ¯                                        â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. ViewModel ä¿ç•™ï¼ˆä¸é”€æ¯ï¼‰                              â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. æ–°çš„ Activity åˆ›å»º                                    â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">4</span>. è·å–ç›¸åŒçš„ ViewModel å®ä¾‹                             â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">5</span>. çŠ¶æ€ä¿æŒä¸å˜                                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   Activity/Fragment çœŸæ­£é”€æ¯                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. <span class="hljs-built_in">onCleared</span>() è¢«è°ƒç”¨                                    â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. ViewModel é”€æ¯                                        â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. åç¨‹ä½œç”¨åŸŸå–æ¶ˆ                                        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-47">äº”ã€CompositionLocal æ·±åº¦è§£æ</h2>
<h3 data-id="heading-48">5.1 ä»€ä¹ˆæ˜¯ CompositionLocalï¼Ÿ</h3>
<p><strong>CompositionLocal</strong> æ˜¯ä¸€ç§<strong>éšå¼ä¼ å‚</strong>æœºåˆ¶ï¼Œå…è®¸åœ¨ Composable æ ‘ä¸­å‘ä¸‹ä¼ é€’æ•°æ®ï¼Œè€Œä¸éœ€è¦é€šè¿‡æ¯ä¸€å±‚çš„å‚æ•°ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ CompositionLocalï¼Ÿ</strong></p>
<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ä½¿ç”¨ CompositionLocal - éœ€è¦å±‚å±‚ä¼ é€’</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">App</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = User(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"admin"</span>)
    ScreenA(user = user)
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ScreenA</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    Header(user = user)
    Content(user = user)
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Header</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    Avatar(user = user)
    UserName(user = user)
}

<span class="hljs-comment">// æ¯ä¸€å±‚éƒ½éœ€è¦ä¼ é€’ user å‚æ•°ï¼Œå³ä½¿ä¸­é—´å±‚ä¸ä½¿ç”¨å®ƒ</span>
</code></pre>
<p>ä½¿ç”¨ CompositionLocalï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨ CompositionLocal - éšå¼ä¼ é€’</span>
<span class="hljs-keyword">val</span> LocalUser = compositionLocalOf&lt;User&gt; { error(<span class="hljs-string">"No user provided"</span>) }

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">App</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = User(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"admin"</span>)
    CompositionLocalProvider(LocalUser provides user) {
        ScreenA()  <span class="hljs-comment">// ä¸éœ€è¦ä¼ é€’ user</span>
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ScreenA</span><span class="hljs-params">()</span></span> {
    Header()   <span class="hljs-comment">// ä¸éœ€è¦ä¼ é€’ user</span>
    Content()  <span class="hljs-comment">// ä¸éœ€è¦ä¼ é€’ user</span>
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Header</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = LocalUser.current  <span class="hljs-comment">// åœ¨éœ€è¦çš„åœ°æ–¹è·å–</span>
    Avatar(user = user)
    UserName(user = user)
}
</code></pre>
<h3 data-id="heading-49">5.2 CompositionLocal çš„åŸç†</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CompositionLocal åŸç†                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Composable æ ‘                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-built_in">CompositionLocalProvider</span>(LocalColor provides Color.Red) â”‚  â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚ â”‚  <span class="hljs-built_in">Child1</span>()                                          â”‚ â”‚  â”‚
â”‚   â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚
â”‚   â”‚ â”‚   â”‚  <span class="hljs-built_in">Child2</span>()                                  â”‚  â”‚ â”‚  â”‚
â”‚   â”‚ â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”‚  â”‚
â”‚   â”‚ â”‚   â”‚   â”‚  LocalColor<span class="hljs-selector-class">.current</span>  <span class="hljs-comment">// è¿”å› Red   â”‚  â”‚  â”‚ â”‚  â”‚</span>
â”‚   â”‚ â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚  â”‚
â”‚   â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   æŸ¥æ‰¾è§„åˆ™ï¼š                                                      â”‚
â”‚   <span class="hljs-number">1</span>. ä»å½“å‰èŠ‚ç‚¹å‘ä¸ŠæŸ¥æ‰¾                                           â”‚
â”‚   <span class="hljs-number">2</span>. æ‰¾åˆ°æœ€è¿‘çš„ CompositionLocalProvider                          â”‚
â”‚   <span class="hljs-number">3</span>. è¿”å›å¯¹åº”çš„å€¼                                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-50">5.3 åˆ›å»ºä¸ä½¿ç”¨ CompositionLocal</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. åˆ›å»º CompositionLocal</span>
<span class="hljs-keyword">val</span> LocalUser = compositionLocalOf&lt;User&gt; { error(<span class="hljs-string">"No user provided"</span>) }

<span class="hljs-comment">// 2. æä¾›å€¼</span>
CompositionLocalProvider(LocalUser provides currentUser) {
    UserProfile()  <span class="hljs-comment">// åŠå…¶å­ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ LocalUser.current è·å–</span>
}

<span class="hljs-comment">// 3. ä½¿ç”¨å€¼</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfile</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> user = LocalUser.current
    Text(<span class="hljs-string">"Hello, <span class="hljs-subst">${user.name}</span>"</span>)
}
</code></pre>
<h3 data-id="heading-51">5.4 compositionLocalOf vs staticCompositionLocalOf</h3>




















<table><thead><tr><th>å‡½æ•°</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>compositionLocalOf</code></td><td>å€¼å˜åŒ–æ—¶ï¼Œåªé‡ç»„è¯»å–è¯¥å€¼çš„ç»„ä»¶</td><td>é¢‘ç¹å˜åŒ–çš„å€¼</td></tr><tr><td><code>staticCompositionLocalOf</code></td><td>å€¼å˜åŒ–æ—¶ï¼Œé‡ç»„æ•´ä¸ªå­æ ‘</td><td>å¾ˆå°‘å˜åŒ–çš„å€¼</td></tr></tbody></table>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸»é¢˜é¢œè‰² - å¾ˆå°‘å˜åŒ–</span>
<span class="hljs-keyword">val</span> LocalColors = staticCompositionLocalOf { LightColorScheme }

<span class="hljs-comment">// æ»šåŠ¨çŠ¶æ€ - é¢‘ç¹å˜åŒ–</span>
<span class="hljs-keyword">val</span> LocalScrollState = compositionLocalOf { ScrollState(<span class="hljs-number">0</span>) }
</code></pre>
<h3 data-id="heading-52">5.5 MaterialTheme çš„å®ç°</h3>
<p>MaterialTheme å°±æ˜¯åŸºäº CompositionLocal å®ç°çš„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MaterialTheme</span><span class="hljs-params">(
    colorScheme: <span class="hljs-type">ColorScheme</span> = MaterialTheme.colorScheme,
    typography: <span class="hljs-type">Typography</span> = MaterialTheme.typography,
    shapes: <span class="hljs-type">Shapes</span> = MaterialTheme.shapes,
    content: @<span class="hljs-type">Composable</span> () -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">val</span> rememberedColorScheme = remember { colorScheme }
    <span class="hljs-keyword">val</span> rememberedTypography = remember { typography }
    <span class="hljs-keyword">val</span> rememberedShapes = remember { shapes }
    
    CompositionLocalProvider(
        LocalColorScheme provides rememberedColorScheme,
        LocalTypography provides rememberedTypography,
        LocalShapes provides rememberedShapes
    ) {
        content()
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">MyComponent</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> colorScheme = MaterialTheme.colorScheme
    <span class="hljs-keyword">val</span> typography = MaterialTheme.typography
    
    Text(
        text = <span class="hljs-string">"Hello"</span>,
        color = colorScheme.primary,
        style = typography.bodyLarge
    )
}
</code></pre>
<h3 data-id="heading-53">5.6 CompositionLocal çš„æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-54">âœ… æ¨èä½¿ç”¨</h4>
<ul>
<li>ä¸»é¢˜é…ç½®ï¼ˆé¢œè‰²ã€å­—ä½“ã€å½¢çŠ¶ï¼‰</li>
<li>ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå±å¹•ç±»å‹ã€æƒé™çŠ¶æ€ï¼‰</li>
<li>å…¨å±€æœåŠ¡ï¼ˆNavigatorã€Analyticsï¼‰</li>
</ul>
<h4 data-id="heading-55">âŒ é¿å…ä½¿ç”¨</h4>
<ul>
<li>é¢‘ç¹å˜åŒ–çš„æ•°æ®ï¼ˆä½¿ç”¨å‚æ•°ä¼ é€’ï¼‰</li>
<li>ä¸šåŠ¡é€»è¾‘çŠ¶æ€ï¼ˆä½¿ç”¨ ViewModelï¼‰</li>
<li>å¯èƒ½å¯¼è‡´éšå¼ä¾èµ–ï¼Œé™ä½ä»£ç å¯è¯»æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-56">å…­ã€å‰¯ä½œç”¨ API è¯¦è§£</h2>
<h3 data-id="heading-57">6.1 ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ</h3>
<p><strong>å‰¯ä½œç”¨</strong>æ˜¯æŒ‡ Composable å‡½æ•°å¯¹å¤–éƒ¨ä¸–ç•Œçš„å½±å“ï¼Œå¦‚ï¼š</p>
<ul>
<li>ç½‘ç»œè¯·æ±‚</li>
<li>æ•°æ®åº“æ“ä½œ</li>
<li>è®¢é˜…äº‹ä»¶</li>
<li>ä¿®æ”¹å…±äº«çŠ¶æ€</li>
</ul>
<p>Compose æ˜¯çº¯å‡½æ•°å¼çš„ï¼ŒComposable ä¸åº”è¯¥æœ‰å‰¯ä½œç”¨ã€‚ä½†åº”ç”¨å¼€å‘ç¦»ä¸å¼€å‰¯ä½œç”¨ï¼Œå› æ­¤ Compose æä¾›äº†ä¸“é—¨çš„ API æ¥å¤„ç†å‰¯ä½œç”¨ã€‚</p>
<h3 data-id="heading-58">6.2 LaunchedEffectï¼šåœ¨ç»„åˆä¸­å¯åŠ¨åç¨‹</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfile</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">var</span> user <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;User?&gt;(<span class="hljs-literal">null</span>) }
    
    <span class="hljs-comment">// åœ¨ç»„åˆæ—¶å¯åŠ¨åç¨‹</span>
    LaunchedEffect(userId) {
        <span class="hljs-comment">// è¿™é‡Œçš„ä»£ç åœ¨åç¨‹ä¸­æ‰§è¡Œ</span>
        user = api.getUser(userId)
    }
    
    user?.let {
        Text(<span class="hljs-string">"Name: <span class="hljs-subst">${it.name}</span>"</span>)
    }
}
</code></pre>
<p><strong>LaunchedEffect çš„ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>åœ¨ç»„åˆæ—¶å¯åŠ¨åç¨‹</li>
<li>key å˜åŒ–æ—¶ï¼Œå–æ¶ˆæ—§åç¨‹ï¼Œå¯åŠ¨æ–°åç¨‹</li>
<li>é‡ç»„æ—¶ä¸ä¼šé‡æ–°å¯åŠ¨</li>
</ul>
<pre><code class="hljs language-vbnet" lang="vbnet">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LaunchedEffect ç”Ÿå‘½å‘¨æœŸ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   é¦–æ¬¡ç»„åˆ                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. LaunchedEffect è¿›å…¥ç»„åˆ                              â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. å¯åŠ¨åç¨‹ï¼Œæ‰§è¡Œå‰¯ä½œç”¨ä»£ç                               â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. åç¨‹æŒç»­è¿è¡Œ...                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   é‡ç»„ï¼ˆ<span class="hljs-keyword">key</span> æœªå˜åŒ–ï¼‰                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. LaunchedEffect é‡ç»„                                  â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. <span class="hljs-keyword">key</span> ç›¸åŒï¼Œåç¨‹ç»§ç»­è¿è¡Œ                                â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. ä¸æ‰§è¡Œå‰¯ä½œç”¨ä»£ç                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   é‡ç»„ï¼ˆ<span class="hljs-keyword">key</span> å˜åŒ–ï¼‰                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. å–æ¶ˆæ—§åç¨‹                                           â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. å¯åŠ¨æ–°åç¨‹                                           â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">3</span>. æ‰§è¡Œæ–°çš„å‰¯ä½œç”¨ä»£ç                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                  â”‚
â”‚   é€€å‡ºç»„åˆ                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ <span class="hljs-number">1</span>. LaunchedEffect é€€å‡ºç»„åˆ                              â”‚  â”‚
â”‚   â”‚ <span class="hljs-number">2</span>. å–æ¶ˆåç¨‹                                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-59">6.3 SideEffectï¼šæ¯æ¬¡é‡ç»„éƒ½æ‰§è¡Œ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">AnalyticsScreen</span><span class="hljs-params">(screenName: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-comment">// æ¯æ¬¡é‡ç»„éƒ½æ‰§è¡Œ</span>
    SideEffect {
        analytics.logScreenView(screenName)
    }
    
    <span class="hljs-comment">// UI å†…å®¹</span>
    Text(<span class="hljs-string">"Screen: <span class="hljs-variable">$screenName</span>"</span>)
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šéœ€è¦ç¡®ä¿å‰¯ä½œç”¨åœ¨æ¯æ¬¡æˆåŠŸé‡ç»„åéƒ½æ‰§è¡Œã€‚</p>
<h3 data-id="heading-60">6.4 DisposableEffectï¼šéœ€è¦æ¸…ç†çš„å‰¯ä½œç”¨</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BackHandler</span><span class="hljs-params">(onBack: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-keyword">val</span> dispatcher = LocalOnBackPressedDispatcherOwner.current?.onBackPressedDispatcher
    
    DisposableEffect(dispatcher) {
        <span class="hljs-comment">// è®¾ç½®å›è°ƒ</span>
        <span class="hljs-keyword">val</span> callback = <span class="hljs-keyword">object</span> : OnBackPressedCallback(<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleOnBackPressed</span><span class="hljs-params">()</span></span> {
                onBack()
            }
        }
        dispatcher?.addCallback(callback)
        
        <span class="hljs-comment">// è¿”å›æ¸…ç†å‡½æ•°</span>
        onDispose {
            callback.remove()
        }
    }
}
</code></pre>
<p><strong>DisposableEffect çš„ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>key å˜åŒ–æ—¶ï¼Œå…ˆæ‰§è¡Œ onDisposeï¼Œå†æ‰§è¡Œæ–°çš„å‰¯ä½œç”¨</li>
<li>é€€å‡ºç»„åˆæ—¶ï¼Œæ‰§è¡Œ onDispose</li>
</ul>
<h3 data-id="heading-61">6.5 rememberCoroutineScopeï¼šåœ¨å›è°ƒä¸­å¯åŠ¨åç¨‹</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserList</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> scope = rememberCoroutineScope()
    <span class="hljs-keyword">var</span> users <span class="hljs-keyword">by</span> remember { mutableStateOf&lt;List&lt;User&gt;&gt;(emptyList()) }
    
    Button(onClick = {
        <span class="hljs-comment">// åœ¨å›è°ƒä¸­å¯åŠ¨åç¨‹</span>
        scope.launch {
            users = api.getUsers()
        }
    }) {
        Text(<span class="hljs-string">"Load Users"</span>)
    }
    
    <span class="hljs-comment">// æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨</span>
    LazyColumn {
        items(users) { user -&gt;
            Text(user.name)
        }
    }
}
</code></pre>
<p><strong>ä¸ LaunchedEffect çš„åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><code>LaunchedEffect</code>ï¼šåœ¨ç»„åˆæ—¶è‡ªåŠ¨å¯åŠ¨</li>
<li><code>rememberCoroutineScope</code>ï¼šæä¾› CoroutineScopeï¼Œåœ¨å›è°ƒä¸­æ‰‹åŠ¨å¯åŠ¨</li>
</ul>
<h3 data-id="heading-62">6.6 rememberUpdatedStateï¼šè·å–æœ€æ–°å€¼</h3>
<p>å½“éœ€è¦åœ¨é•¿æ—¶é—´è¿è¡Œçš„å‰¯ä½œç”¨ä¸­è·å–æœ€æ–°çŠ¶æ€æ—¶ï¼Œä½¿ç”¨ <code>rememberUpdatedState</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Timer</span><span class="hljs-params">(
    onTick: () -&gt; <span class="hljs-type">Unit</span>,
    interval: <span class="hljs-type">Long</span> = <span class="hljs-number">1000</span>L
)</span></span> {
    <span class="hljs-comment">// ä½¿ç”¨ rememberUpdatedState è·å–æœ€æ–°çš„ onTick</span>
    <span class="hljs-keyword">val</span> currentOnTick <span class="hljs-keyword">by</span> rememberUpdatedState(onTick)
    
    LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            delay(interval)
            currentOnTick()  <span class="hljs-comment">// æ€»æ˜¯è°ƒç”¨æœ€æ–°çš„ onTick</span>
        }
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ rememberUpdatedStateï¼Ÿ</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šLaunchedEffect æ•è·çš„æ˜¯æ—§çš„ onTick</span>
LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        delay(<span class="hljs-number">1000</span>)
        onTick()  <span class="hljs-comment">// æ€»æ˜¯è°ƒç”¨ç¬¬ä¸€æ¬¡ä¼ å…¥çš„ onTick</span>
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ rememberUpdatedState</span>
<span class="hljs-keyword">val</span> currentOnTick <span class="hljs-keyword">by</span> rememberUpdatedState(onTick)
LaunchedEffect(<span class="hljs-built_in">Unit</span>) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        delay(<span class="hljs-number">1000</span>)
        currentOnTick()  <span class="hljs-comment">// æ€»æ˜¯è°ƒç”¨æœ€æ–°çš„ onTick</span>
    }
}
</code></pre>
<h3 data-id="heading-63">6.7 DerivedStateï¼šæ´¾ç”ŸçŠ¶æ€</h3>
<p>å½“éœ€è¦åŸºäºå…¶ä»–çŠ¶æ€è®¡ç®—æ´¾ç”ŸçŠ¶æ€æ—¶ï¼Œä½¿ç”¨ <code>derivedStateOf</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchResults</span><span class="hljs-params">(query: <span class="hljs-type">String</span>, items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    <span class="hljs-comment">// åªåœ¨å¿…è¦æ—¶é‡æ–°è®¡ç®—</span>
    <span class="hljs-keyword">val</span> filteredItems <span class="hljs-keyword">by</span> remember {
        derivedStateOf {
            items.filter { it.name.contains(query, ignoreCase = <span class="hljs-literal">true</span>) }
        }
    }
    
    LazyColumn {
        items(filteredItems) { item -&gt;
            ItemRow(item)
        }
    }
}
</code></pre>
<p><strong>derivedStateOf vs remember</strong>ï¼š</p>




















<table><thead><tr><th>ç‰¹æ€§</th><th>derivedStateOf</th><th>remember</th></tr></thead><tbody><tr><td>è§¦å‘æ¡ä»¶</td><td>è¯»å–æ—¶</td><td>ä¾èµ–å˜åŒ–æ—¶</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>é¢‘ç¹è¯»å–ã€è®¡ç®—æˆæœ¬é«˜</td><td>ä¸€æ¬¡æ€§è®¡ç®—</td></tr></tbody></table>
<h3 data-id="heading-64">6.8 produceStateï¼šå°†é Compose çŠ¶æ€è½¬æ¢ä¸º State</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: State&lt;User?&gt; {
    <span class="hljs-keyword">return</span> produceState&lt;User?&gt;(initialValue = <span class="hljs-literal">null</span>, userId) {
        value = api.getUser(userId)
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserProfile</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> user <span class="hljs-keyword">by</span> loadUser(userId)
    
    user?.let {
        Text(<span class="hljs-string">"Name: <span class="hljs-subst">${it.name}</span>"</span>)
    }
}
</code></pre>
<h3 data-id="heading-65">6.9 snapshotFlowï¼šå°† State è½¬æ¢ä¸º Flow</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SearchScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> query <span class="hljs-keyword">by</span> remember { mutableStateOf(<span class="hljs-string">""</span>) }
    
    <span class="hljs-comment">// å°† State è½¬æ¢ä¸º Flow</span>
    <span class="hljs-keyword">val</span> searchResults <span class="hljs-keyword">by</span> remember {
        snapshotFlow { query }
            .debounce(<span class="hljs-number">300</span>)  <span class="hljs-comment">// é˜²æŠ–</span>
            .flatMapLatest { api.search(it) }
            .collectAsState(initial = emptyList())
    }
    
    Column {
        TextField(
            value = query,
            onValueChange = { query = it }
        )
        
        LazyColumn {
            items(searchResults) { result -&gt;
                Text(result.name)
            }
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-66">ä¸ƒã€çŠ¶æ€ç®¡ç†æ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-67">7.1 åˆ†å±‚æ¶æ„</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UI Layer (Composable)                      â”‚
â”‚  - æ˜¾ç¤ºæ•°æ®                                                      â”‚
â”‚  - å¤„ç†ç”¨æˆ·äº¤äº’                                                  â”‚
â”‚  - è°ƒç”¨ ViewModel æ–¹æ³•                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ViewModel Layer                               â”‚
â”‚  - ç®¡ç† UI çŠ¶æ€                                                  â”‚
â”‚  - å¤„ç†ä¸šåŠ¡é€»è¾‘                                                  â”‚
â”‚  - è°ƒç”¨ Repository æ–¹æ³•                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Repository Layer                               â”‚
â”‚  - æ•°æ®èšåˆ                                                      â”‚
â”‚  - ä¸šåŠ¡è§„åˆ™                                                      â”‚
â”‚  - é€‰æ‹©æ•°æ®æº                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Data Source Layer                             â”‚
â”‚  - ç½‘ç»œ API (Retrofit)                                          â”‚
â”‚  - æœ¬åœ°æ•°æ®åº“ (Room)                                            â”‚
â”‚  - æœ¬åœ°ç¼“å­˜ (DataStore)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-68">7.2 å®Œæ•´å®æˆ˜ï¼šç”¨æˆ·åˆ—è¡¨é¡µé¢</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ============ Data Layer ============</span>

<span class="hljs-comment">// æ•°æ®æ¨¡å‹</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> id: String,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> email: String,
    <span class="hljs-keyword">val</span> avatar: String
)

<span class="hljs-comment">// Repository</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt;
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchUsers</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span>: List&lt;User&gt;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepositoryImpl</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: UserApi
) : UserRepository {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt; = api.getUsers()
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchUsers</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span>: List&lt;User&gt; = api.searchUsers(query)
}

<span class="hljs-comment">// ============ ViewModel Layer ============</span>

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsersUiState</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Loading : UsersUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-keyword">val</span> users: List&lt;User&gt;) : UsersUiState
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UsersUiState
}

<span class="hljs-meta">@HiltViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UsersViewModel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) : ViewModel() {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow&lt;UsersUiState&gt;(UsersUiState.Loading)
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;UsersUiState&gt; = _uiState.asStateFlow()
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _searchQuery = MutableStateFlow(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">val</span> searchQuery: StateFlow&lt;String&gt; = _searchQuery.asStateFlow()
    
    <span class="hljs-comment">// æœç´¢ç»“æœçš„æ´¾ç”ŸçŠ¶æ€</span>
    <span class="hljs-keyword">val</span> searchResults: StateFlow&lt;UsersUiState&gt; = _searchQuery
        .debounce(<span class="hljs-number">300</span>)
        .flatMapLatest { query -&gt;
            <span class="hljs-keyword">if</span> (query.isEmpty()) {
                flowOf(UsersUiState.Success(emptyList()))
            } <span class="hljs-keyword">else</span> {
                flow {
                    emit(UsersUiState.Loading)
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">val</span> users = repository.searchUsers(query)
                        emit(UsersUiState.Success(users))
                    } <span class="hljs-keyword">catch</span> (e: Exception) {
                        emit(UsersUiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>))
                    }
                }
            }
        }
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>),
            initialValue = UsersUiState.Success(emptyList())
        )
    
    <span class="hljs-keyword">init</span> {
        loadUsers()
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUsers</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _uiState.value = UsersUiState.Loading
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> users = repository.getUsers()
                _uiState.value = UsersUiState.Success(users)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.value = UsersUiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSearchQueryChange</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span> {
        _searchQuery.value = query
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span> {
        loadUsers()
    }
}

<span class="hljs-comment">// ============ UI Layer ============</span>

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UsersScreen</span><span class="hljs-params">(
    viewModel: <span class="hljs-type">UsersViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-keyword">val</span> uiState <span class="hljs-keyword">by</span> viewModel.uiState.collectAsState()
    <span class="hljs-keyword">val</span> searchQuery <span class="hljs-keyword">by</span> viewModel.searchQuery.collectAsState()
    <span class="hljs-keyword">val</span> searchResults <span class="hljs-keyword">by</span> viewModel.searchResults.collectAsState()
    
    <span class="hljs-keyword">val</span> isSearching = searchQuery.isNotEmpty()
    <span class="hljs-keyword">val</span> currentState = <span class="hljs-keyword">if</span> (isSearching) searchResults <span class="hljs-keyword">else</span> uiState
    
    UsersContent(
        uiState = currentState,
        searchQuery = searchQuery,
        onSearchQueryChange = viewModel::onSearchQueryChange,
        onRefresh = viewModel::refresh
    )
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UsersContent</span><span class="hljs-params">(
    uiState: <span class="hljs-type">UsersUiState</span>,
    searchQuery: <span class="hljs-type">String</span>,
    onSearchQueryChange: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>,
    onRefresh: () -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    Column(modifier = Modifier.fillMaxSize()) {
        <span class="hljs-comment">// æœç´¢æ¡†</span>
        SearchBar(
            query = searchQuery,
            onQueryChange = onSearchQueryChange
        )
        
        <span class="hljs-comment">// å†…å®¹åŒºåŸŸ</span>
        <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> state = uiState) {
            <span class="hljs-keyword">is</span> UsersUiState.Loading -&gt; LoadingScreen()
            <span class="hljs-keyword">is</span> UsersUiState.Error -&gt; ErrorScreen(
                message = state.message,
                onRetry = onRefresh
            )
            <span class="hljs-keyword">is</span> UsersUiState.Success -&gt; {
                <span class="hljs-keyword">if</span> (state.users.isEmpty()) {
                    EmptyScreen()
                } <span class="hljs-keyword">else</span> {
                    UserList(users = state.users)
                }
            }
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserList</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span> {
    LazyColumn {
        items(users, key = { it.id }) { user -&gt;
            UserItem(user = user)
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserItem</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .padding(horizontal = <span class="hljs-number">16.</span>dp, vertical = <span class="hljs-number">8.</span>dp)
    ) {
        Row(
            modifier = Modifier.padding(<span class="hljs-number">16.</span>dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            AsyncImage(
                model = user.avatar,
                contentDescription = <span class="hljs-literal">null</span>,
                modifier = Modifier
                    .size(<span class="hljs-number">48.</span>dp)
                    .clip(CircleShape)
            )
            
            Spacer(modifier = Modifier.width(<span class="hljs-number">16.</span>dp))
            
            Column {
                Text(
                    text = user.name,
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = user.email,
                    style = MaterialTheme.typography.bodyMedium,
                    color = Color.Gray
                )
            }
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-69">å…«ã€æœ¬ç¯‡å°ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬æ·±å…¥æ¢è®¨äº† Compose çš„çŠ¶æ€ç®¡ç†ç³»ç»Ÿï¼š</p>
<h3 data-id="heading-70">çŠ¶æ€ä¸é‡ç»„æœºåˆ¶</h3>
<ul>
<li>ç†è§£äº† Slot Table çš„æ•°æ®ç»“æ„å’Œä½œç”¨</li>
<li>æŒæ¡äº†é‡ç»„çš„è§¦å‘æœºåˆ¶å’Œä¼˜åŒ–ç­–ç•¥</li>
<li>å­¦ä¼šäº†ä½¿ç”¨ @Stable å’Œ @Immutable æ§åˆ¶é‡ç»„</li>
</ul>
<h3 data-id="heading-71">remember ä¸ mutableStateOf</h3>
<ul>
<li>æ·±å…¥ç†è§£äº† remember çš„ç¼“å­˜åŸç†</li>
<li>æŒæ¡äº† mutableStateOf çš„ Snapshot æœºåˆ¶</li>
<li>å­¦ä¼šäº† rememberSaveable çš„ä¿å­˜ä¸æ¢å¤</li>
</ul>
<h3 data-id="heading-72">çŠ¶æ€æå‡</h3>
<ul>
<li>ç†è§£äº†çŠ¶æ€æå‡çš„è®¾è®¡å“²å­¦</li>
<li>æŒæ¡äº†çŠ¶æ€å®¹å™¨æ¨¡å¼å’Œå±å¹•çº§çŠ¶æ€ç®¡ç†</li>
</ul>
<h3 data-id="heading-73">ViewModel ä¸ Compose</h3>
<ul>
<li>å­¦ä¼šäº† StateFlow ä¸ Compose çš„é›†æˆ</li>
<li>æŒæ¡äº† UI çŠ¶æ€è®¾è®¡çš„æœ€ä½³å®è·µ</li>
</ul>
<h3 data-id="heading-74">CompositionLocal</h3>
<ul>
<li>ç†è§£äº†éšå¼ä¼ å‚çš„åŸç†</li>
<li>å­¦ä¼šäº†åˆ›å»ºå’Œä½¿ç”¨ CompositionLocal</li>
</ul>
<h3 data-id="heading-75">å‰¯ä½œç”¨ API</h3>
<ul>
<li>æŒæ¡äº† LaunchedEffectã€DisposableEffect ç­‰å‰¯ä½œç”¨ API</li>
<li>ç†è§£äº†ä¸åŒåœºæ™¯ä¸‹çš„é€‰æ‹©ç­–ç•¥</li>
</ul>
<hr/>
<h2 data-id="heading-76">ä¸‹ç¯‡é¢„å‘Š</h2>
<p><strong>ç¬¬å››ç¯‡ï¼šMaterial ç»„ä»¶ä¸ä¸»é¢˜</strong> å°†æ·±å…¥è®²è§£ï¼š</p>
<ul>
<li>Material Design 3 ç»„ä»¶å¤§å…¨</li>
<li>è‡ªå®šä¹‰ä¸»é¢˜ä¸é¢œè‰²ç³»ç»Ÿ</li>
<li>æ·±è‰²æ¨¡å¼ä¸åŠ¨æ€ä¸»é¢˜é€‚é…</li>
<li>è‡ªå®šä¹‰ç»„ä»¶çš„è®¾è®¡æ€è·¯</li>
</ul>
<p>æ•¬è¯·æœŸå¾…ï¼</p>
<hr/>
<h2 data-id="heading-77">å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fcompose%2Fstate" target="_blank" title="https://developer.android.com/jetpack/compose/state" ref="nofollow noopener noreferrer">Compose çŠ¶æ€å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fcompose%2Fside-effects" target="_blank" title="https://developer.android.com/jetpack/compose/side-effects" ref="nofollow noopener noreferrer">Compose å‰¯ä½œç”¨å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fframeworks%2Fsupport%2F%2B%2Fandroidx-main%2Fcompose%2F" target="_blank" title="https://android.googlesource.com/platform/frameworks/support/+/androidx-main/compose/" ref="nofollow noopener noreferrer">Compose æºç </a></li>
</ul>
<hr/>
<blockquote>
<p>ğŸ“Œ <strong>ç³»åˆ—æ–‡ç« å¯¼èˆª</strong></p>
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼šåˆè¯† Compose âœ…</li>
<li>ç¬¬äºŒç¯‡ï¼šæ ¸å¿ƒåŸºçŸ³ âœ…</li>
<li>ç¬¬ä¸‰ç¯‡ï¼šçŠ¶æ€ç®¡ç†ï¼ˆå½“å‰ï¼‰âœ…</li>
<li>ç¬¬å››ç¯‡ï¼šMaterial ç»„ä»¶ä¸ä¸»é¢˜</li>
<li>ç¬¬äº”ç¯‡ï¼šåŠ¨ç”»ä¸äº¤äº’</li>
<li>ç¬¬å…­ç¯‡ï¼šæ¶æ„ä¸å·¥ç¨‹åŒ–</li>
<li>ç¬¬ä¸ƒç¯‡ï¼šé«˜çº§ç‰¹æ€§ä¸å®æˆ˜</li>
</ul>
</blockquote>
<hr/>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ <strong>ç‚¹èµ</strong>ã€<strong>æ”¶è—</strong>ã€<strong>å…³æ³¨</strong>ï¼æœ‰ä»»ä½•é—®é¢˜å¯ä»¥åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</p>
<p><del>Generated by Kimi K2.5 Agent</del></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ71ï¼‰å¦‚ä½•åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600628279215046682</link>    <guid>https://juejin.cn/post/7600628279215046682</guid>    <pubDate>2026-01-29T11:53:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279215046682" data-draft-id="7600601482690543662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ71ï¼‰å¦‚ä½•åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-29T11:53:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ71ï¼‰å¦‚ä½•åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:53:09.000Z" title="Thu Jan 29 2026 11:53:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ä½¿ç”¨Hibernateæ—¶ï¼Œéœ€è¦å¤„ç†å¤§é‡æ•°æ®å’Œå¤æ‚æŸ¥è¯¢ï¼Œç¡®ä¿æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚å°½ç®¡Hibernateæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ORMæ¡†æ¶ï¼Œä½†åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶ï¼Œå¯èƒ½éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥ï¼Œå¦‚æ‰¹é‡å¤„ç†ã€åˆ†é¡µã€ç¼“å­˜å’Œåˆ†å¸ƒå¼å¤„ç†ç­‰ã€‚</p>
<p>ä¸‹é¢æ˜¯è¯¦ç»†æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ä½¿ç”¨Hibernateã€‚</p>
<h3 data-id="heading-0">1. é¡¹ç›®ä¾èµ–</h3>
<p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- EHCache for Second Level Cache --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§</h3>
<p>åœ¨<code>application.properties</code>ä¸­é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">spring.datasource.url=jdbc:mysql://localhost:3306/mydatabase
spring.datasource.username=root
spring.datasource.password=rootpassword
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Enable Second Level Cache
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory
</code></pre>
<h3 data-id="heading-2">3. é…ç½®EhCache</h3>
<p>åœ¨ç±»è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ª<code>ehcache.xml</code>æ–‡ä»¶æ¥é…ç½®ç¼“å­˜ã€‚</p>
<h4 data-id="heading-3"><code>ehcache.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">defaultCache</span>
        <span class="hljs-attr">maxEntriesLocalHeap</span>=<span class="hljs-string">"10000"</span>
        <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">statistics</span>=<span class="hljs-string">"true"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.entity.BigDataEntity"</span>
        <span class="hljs-attr">maxEntriesLocalHeap</span>=<span class="hljs-string">"10000"</span>
        <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"120"</span>
        <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">statistics</span>=<span class="hljs-string">"true"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">4. å®šä¹‰å®ä½“ç±»å’ŒDAOå±‚</h3>
<h4 data-id="heading-5"><code>BigDataEntity.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "big_data")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataEntity</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String dataField;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDataField</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> dataField;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDataField</span><span class="hljs-params">(String dataField)</span> {
        <span class="hljs-built_in">this</span>.dataField = dataField;
    }
}
</code></pre>
<h4 data-id="heading-6"><code>BigDataRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BigDataRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;BigDataEntity, Long&gt; {
}
</code></pre>
<h3 data-id="heading-7">5. æ‰¹é‡å¤„ç†å’Œåˆ†é¡µ</h3>
<h4 data-id="heading-8"><code>BigDataService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BigDataRepository bigDataRepository;

    <span class="hljs-comment">// æ‰¹é‡æ’å…¥æ•°æ®</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveAll</span><span class="hljs-params">(List&lt;BigDataEntity&gt; entities)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; entities.size(); i += batchSize) {
            List&lt;BigDataEntity&gt; batchList = entities.subList(i, Math.min(i + batchSize, entities.size()));
            bigDataRepository.saveAll(batchList);
            bigDataRepository.flush();
        }
    }

    <span class="hljs-comment">// åˆ†é¡µæŸ¥è¯¢å¤§æ•°æ®</span>
    <span class="hljs-keyword">public</span> Page&lt;BigDataEntity&gt; <span class="hljs-title function_">findPaginated</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size)</span> {
        <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageable</span> <span class="hljs-operator">=</span> PageRequest.of(page, size);
        <span class="hljs-keyword">return</span> bigDataRepository.findAll(pageable);
    }
}
</code></pre>
<h3 data-id="heading-9">6. ä½¿ç”¨ç¼“å­˜</h3>
<h4 data-id="heading-10">åœ¨å®ä½“ç±»ä¸Šå¯ç”¨ç¼“å­˜</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.annotations.Cache;
<span class="hljs-keyword">import</span> org.hibernate.annotations.CacheConcurrencyStrategy;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "big_data")</span>
<span class="hljs-meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataEntity</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String dataField;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h3 data-id="heading-11">7. ä½¿ç”¨æœåŠ¡å±‚</h3>
<p>ç¼–å†™æ§åˆ¶å™¨æ¥ä½¿ç”¨æœåŠ¡å±‚è¿›è¡Œæ‰¹é‡å¤„ç†å’Œåˆ†é¡µæŸ¥è¯¢ã€‚</p>
<h4 data-id="heading-12"><code>BigDataController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/bigdata")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDataController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BigDataService bigDataService;

    <span class="hljs-meta">@PostMapping("/saveall")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">saveAll</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;BigDataEntity&gt; entities)</span> {
        bigDataService.saveAll(entities);
        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();
    }

    <span class="hljs-meta">@GetMapping("/page/{page}/{size}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Page&lt;BigDataEntity&gt;&gt; <span class="hljs-title function_">findPaginated</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> page, <span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> size)</span> {
        Page&lt;BigDataEntity&gt; result = bigDataService.findPaginated(page, size);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }
}
</code></pre>
<h3 data-id="heading-13">8. æ‰¹é‡å¤„ç†</h3>
<h4 data-id="heading-14">æ‰¹é‡æ’å…¥æ•°æ®ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BigDataService bigDataService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataLoader</span><span class="hljs-params">(BigDataService bigDataService)</span> {
        <span class="hljs-built_in">this</span>.bigDataService = bigDataService;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;BigDataEntity&gt; entities = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-type">BigDataEntity</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDataEntity</span>();
            entity.setDataField(<span class="hljs-string">"Data "</span> + i);
            entities.add(entity);
        }
        bigDataService.saveAll(entities);
    }
}
</code></pre>
<h3 data-id="heading-15">9. åˆ†é¡µæŸ¥è¯¢</h3>
<h4 data-id="heading-16">åˆ†é¡µæŸ¥è¯¢æ•°æ®ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BigDataService bigDataService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataLoader</span><span class="hljs-params">(BigDataService bigDataService)</span> {
        <span class="hljs-built_in">this</span>.bigDataService = bigDataService;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            Page&lt;BigDataEntity&gt; result = bigDataService.findPaginated(page, size);
            <span class="hljs-keyword">if</span> (result.isEmpty()) {
                <span class="hljs-keyword">break</span>;
            }
            result.forEach(entity -&gt; System.out.println(entity.getDataField()));
            page++;
        }
    }
}
</code></pre>
<h3 data-id="heading-17">æ€»ç»“</h3>
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼ŒåŒ…æ‹¬é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§ã€é…ç½®ç¼“å­˜ã€å®šä¹‰å®ä½“å’ŒDAOå±‚ã€æ‰¹é‡å¤„ç†ã€åˆ†é¡µæŸ¥è¯¢ä»¥åŠä½¿ç”¨ç¼“å­˜ã€‚åœ¨å¤§æ•°æ®ç¯å¢ƒä¸­ï¼Œé‡‡ç”¨æ‰¹é‡å¤„ç†ã€åˆ†é¡µã€ç¼“å­˜ç­‰ç­–ç•¥å¯ä»¥æœ‰æ•ˆæé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶é«˜æ•ˆè¿è¡Œï¼Œå¹¶åˆ©ç”¨Hibernateè¿›è¡Œæ•°æ®åº“æ“ä½œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ72ï¼‰å¦‚ä½•åœ¨NoSQLæ•°æ®åº“ä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600616270002864166</link>    <guid>https://juejin.cn/post/7600616270002864166</guid>    <pubDate>2026-01-29T11:54:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600616270002864166" data-draft-id="7600616270002847782" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ72ï¼‰å¦‚ä½•åœ¨NoSQLæ•°æ®åº“ä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-29T11:54:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ72ï¼‰å¦‚ä½•åœ¨NoSQLæ•°æ®åº“ä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T11:54:11.000Z" title="Thu Jan 29 2026 11:54:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨NoSQLæ•°æ®åº“ä¸­ä½¿ç”¨Hibernateï¼Œå¯ä»¥ä½¿ç”¨Hibernate OGMï¼ˆObject/Grid Mapperï¼‰ã€‚Hibernate OGMæ˜¯Hibernate ORMçš„æ‰©å±•ï¼Œæ—¨åœ¨ä¸ºNoSQLæ•°æ®åº“æä¾›å¯¹è±¡æ˜ å°„å’ŒæŒä¹…åŒ–åŠŸèƒ½ã€‚å®ƒæ”¯æŒå¤šç§NoSQLæ•°æ®åº“ï¼ŒåŒ…æ‹¬MongoDBã€CouchDBã€Neo4jç­‰ã€‚</p>
<p>ä¸‹é¢æ˜¯è¯¦ç»†æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨MongoDBï¼ˆä¸€ç§å¸¸è§çš„NoSQLæ•°æ®åº“ï¼‰ä¸­ä½¿ç”¨Hibernate OGMã€‚</p>
<h3 data-id="heading-0">1. é¡¹ç›®ä¾èµ–</h3>
<p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MongoDB Driver --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mongodb-driver-sync<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hibernate OGM Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.ogm<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ogm-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hibernate OGM MongoDB --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.ogm<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-ogm-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®Hibernate OGM</h3>
<p>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»æ¥é…ç½®Hibernate OGMã€‚</p>
<h4 data-id="heading-2"><code>OgmConfig.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Primary;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;

<span class="hljs-keyword">import</span> javax.persistence.EntityManagerFactory;
<span class="hljs-keyword">import</span> javax.sql.DataSource;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OgmConfig</span> {

    <span class="hljs-meta">@Value("${spring.data.mongodb.host}")</span>
    <span class="hljs-keyword">private</span> String mongoHost;

    <span class="hljs-meta">@Value("${spring.data.mongodb.port}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mongoPort;

    <span class="hljs-meta">@Value("${spring.data.mongodb.database}")</span>
    <span class="hljs-keyword">private</span> String mongoDatabase;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="hljs-title function_">entityManagerFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LocalContainerEntityManagerFactoryBean</span> <span class="hljs-variable">em</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalContainerEntityManagerFactoryBean</span>();
        em.setJpaVendorAdapter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HibernateJpaVendorAdapter</span>());
        
        Map&lt;String, Object&gt; properties = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.provider"</span>, <span class="hljs-string">"mongodb"</span>);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.create_database"</span>, <span class="hljs-literal">true</span>);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.database"</span>, mongoDatabase);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.host"</span>, mongoHost);
        properties.put(<span class="hljs-string">"hibernate.ogm.datastore.port"</span>, mongoPort);
        
        em.setJpaPropertyMap(properties);
        
        <span class="hljs-keyword">return</span> em;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@Primary</span>
    <span class="hljs-keyword">public</span> JpaTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">(EntityManagerFactory emf)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JpaTransactionManager</span>(emf);
    }
}
</code></pre>
<p>åœ¨<code>application.properties</code>ä¸­é…ç½®MongoDBå‚æ•°ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">spring.data.mongodb.host=localhost
spring.data.mongodb.port=27017
spring.data.mongodb.database=mydatabase
</code></pre>
<h3 data-id="heading-3">3. å®šä¹‰å®ä½“ç±»å’ŒDAOå±‚</h3>
<h4 data-id="heading-4"><code>Person.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.annotations.GenericGenerator;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(generator = "UUID")</span>
    <span class="hljs-meta">@GenericGenerator(
        name = "UUID",
        strategy = "org.hibernate.id.UUIDGenerator"
    )</span>
    <span class="hljs-keyword">private</span> String id;

    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5"><code>PersonRepository.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PersonRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Person, String&gt; {
}
</code></pre>
<h3 data-id="heading-6">4. åˆ›å»ºæœåŠ¡å±‚</h3>
<h4 data-id="heading-7"><code>PersonService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PersonRepository personRepository;

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">createPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-keyword">return</span> personRepository.save(person);
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPersonById</span><span class="hljs-params">(String id)</span> {
        <span class="hljs-keyword">return</span> personRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title function_">getAllPersons</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> personRepository.findAll();
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-keyword">return</span> personRepository.save(person);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(String id)</span> {
        personRepository.deleteById(id);
    }
}
</code></pre>
<h3 data-id="heading-8">5. åˆ›å»ºæ§åˆ¶å™¨</h3>
<h4 data-id="heading-9"><code>PersonController.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/persons")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PersonService personService;

    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Person&gt; <span class="hljs-title function_">createPerson</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Person person)</span> {
        <span class="hljs-type">Person</span> <span class="hljs-variable">createdPerson</span> <span class="hljs-operator">=</span> personService.createPerson(person);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(createdPerson);
    }

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Person&gt; <span class="hljs-title function_">getPersonById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> personService.getPersonById(id);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(person);
    }

    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Person&gt;&gt; <span class="hljs-title function_">getAllPersons</span><span class="hljs-params">()</span> {
        List&lt;Person&gt; persons = personService.getAllPersons();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(persons);
    }

    <span class="hljs-meta">@PutMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Person&gt; <span class="hljs-title function_">updatePerson</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id, <span class="hljs-meta">@RequestBody</span> Person person)</span> {
        person.setId(id); <span class="hljs-comment">// Ensure the person ID is set correctly</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">updatedPerson</span> <span class="hljs-operator">=</span> personService.updatePerson(person);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(updatedPerson);
    }

    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">deletePerson</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        personService.deletePerson(id);
        <span class="hljs-keyword">return</span> ResponseEntity.noContent().build();
    }
}
</code></pre>
<h3 data-id="heading-10">6. è¿è¡Œåº”ç”¨</h3>
<ol>
<li><strong>å¯åŠ¨MongoDB</strong>ï¼šç¡®ä¿ä½ çš„MongoDBæ•°æ®åº“è¿è¡Œåœ¨<code>localhost:27017</code>ã€‚</li>
<li><strong>å¯åŠ¨Spring Bootåº”ç”¨</strong>ï¼šè¿è¡ŒSpring Bootåº”ç”¨ç¨‹åºã€‚</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:run
</code></pre>
<h3 data-id="heading-11">7. è®¿é—®API</h3>
<p>é€šè¿‡ä»¥ä¸‹APIè®¿é—®<code>Person</code>æ•°æ®ï¼š</p>
<ul>
<li><code>POST /persons</code>ï¼šåˆ›å»ºPersonã€‚</li>
<li><code>GET /persons/{id}</code>ï¼šæŒ‰IDè·å–Personã€‚</li>
<li><code>GET /persons</code>ï¼šè·å–æ‰€æœ‰Personsã€‚</li>
<li><code>PUT /persons/{id}</code>ï¼šæ›´æ–°Personã€‚</li>
<li><code>DELETE /persons/{id}</code>ï¼šåˆ é™¤Personã€‚</li>
</ul>
<h3 data-id="heading-12">æ€»ç»“</h3>
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åœ¨NoSQLæ•°æ®åº“ï¼ˆå¦‚MongoDBï¼‰ä¸­ä½¿ç”¨Hibernate OGMï¼ŒåŒ…æ‹¬é…ç½®Hibernate OGMã€å®šä¹‰å®ä½“å’ŒDAOå±‚ã€åˆ›å»ºæœåŠ¡å±‚å’Œæ§åˆ¶å™¨ä»¥åŠå¦‚ä½•è¿è¡Œå’Œè®¿é—®APIã€‚åœ¨å¤§æ•°æ®å’ŒNoSQLç¯å¢ƒä¸­ï¼ŒHibernate OGMæä¾›äº†ä¸€ç§åŸºäºå¯¹è±¡çš„æ–¹å¼æ¥å¤„ç†å¤æ‚çš„æ•°æ®æŒä¹…åŒ–éœ€æ±‚ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®æ“ä½œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent æ¡†æ¶æ¢ç§˜ï¼šæ‹†è§£ OpenHandsï¼ˆ4ï¼‰--- æœåŠ¡]]></title>    <link>https://juejin.cn/post/7600601482690560046</link>    <guid>https://juejin.cn/post/7600601482690560046</guid>    <pubDate>2026-01-29T12:02:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600601482690560046" data-draft-id="7600597995768496137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent æ¡†æ¶æ¢ç§˜ï¼šæ‹†è§£ OpenHandsï¼ˆ4ï¼‰--- æœåŠ¡"/> <meta itemprop="keywords" content="ç®—æ³•,äººå·¥æ™ºèƒ½,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2026-01-29T12:02:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç½—è¥¿çš„æ€è€ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent æ¡†æ¶æ¢ç§˜ï¼šæ‹†è§£ OpenHandsï¼ˆ4ï¼‰--- æœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç½—è¥¿çš„æ€è€ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T12:02:06.000Z" title="Thu Jan 29 2026 12:02:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI Agent æ¡†æ¶æ¢ç§˜ï¼šæ‹†è§£ OpenHandsï¼ˆ4ï¼‰--- æœåŠ¡</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 æ¦‚è¿°</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 æœåŠ¡</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 API æ¨¡å¼</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 æœåŠ¡å™¨ç»„ä»¶</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 æœåŠ¡å·¥ä½œæµç¨‹æè¿°</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.4 listen_socket.py</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF å‚è€ƒ</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 æ¦‚è¿°</h3>
<p>æœ¬ç¯‡ç»“åˆå®˜æ–¹æ–‡æ¡£è¿›è¡Œè§£è¯»OpenHandsçš„æœåŠ¡å™¨ï¼Œè¿™æ˜¯OpenHandsç³»ç»Ÿçš„ç«‹èº«åŸºç¡€ã€‚</p>
<p>å› ä¸ºæœ¬ç³»åˆ—å€Ÿé‰´çš„æ–‡ç« è¿‡å¤šï¼Œå¯èƒ½åœ¨å‚è€ƒæ–‡çŒ®ä¸­æœ‰é—æ¼çš„æ–‡ç« ï¼Œå¦‚æœæœ‰ï¼Œè¿˜è¯·å¤§å®¶æŒ‡å‡ºã€‚</p>
<h3 data-id="heading-2">0x01 æœåŠ¡</h3>
<p>OpenHandsæä¾›äº†WebSocketæœåŠ¡å™¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/534926d42ee84a37bb6b27a9119b96bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770292925&amp;x-signature=WXxYFrjXBhQjzC48wE6PKwl5MWs%3D" alt="openhands-server" loading="lazy"/></p>
<p>openhands-server</p>
<h4 data-id="heading-3">1.1 API æ¨¡å¼</h4>
<p>å¯ä»¥å‘é€æˆ–ä»æœåŠ¡å™¨æ¥æ”¶ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼š</p>
<ul>
<li>Actions</li>
<li>Observations</li>
</ul>
<h5 data-id="heading-4">1.1.1 Actions</h5>
<p>ä¸€ä¸ªaction åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>action</code>ï¼šè¦é‡‡å–çš„åŠ¨ä½œ</li>
<li><code>args</code>ï¼šåŠ¨ä½œçš„å‚æ•°</li>
<li><code>message</code>ï¼šå¯ä»¥æ”¾åœ¨èŠå¤©è®°å½•ä¸­çš„å‹å¥½æ¶ˆæ¯</li>
</ul>
<p>æœ‰å‡ ç§action ã€‚å®ƒä»¬çš„å‚æ•°åˆ—åœ¨ä¸‹é¢ã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¸ªåˆ—è¡¨å¯èƒ½ä¼šå¢é•¿ã€‚</p>
<ul>
<li>
<p><code>initialize</code> - åˆå§‹åŒ–ä»£ç†ã€‚ä»…ç”±å®¢æˆ·ç«¯å‘é€ã€‚</p>
<ul>
<li><code>model</code> - è¦ä½¿ç”¨çš„æ¨¡å‹åç§°</li>
<li><code>directory</code> - å·¥ä½œç©ºé—´çš„è·¯å¾„</li>
<li><code>agent_cls</code> - è¦ä½¿ç”¨çš„ä»£ç†ç±»</li>
</ul>
</li>
<li>
<p><code>start</code> - å¼€å§‹ä¸€ä¸ªæ–°çš„å¼€å‘ä»»åŠ¡ã€‚ä»…ç”±å®¢æˆ·ç«¯å‘é€ã€‚</p>
<ul>
<li><code>task</code> - è¦å¼€å§‹çš„ä»»åŠ¡</li>
</ul>
</li>
<li>
<p><code>read</code> - è¯»å–æ–‡ä»¶å†…å®¹ã€‚</p>
<ul>
<li><code>path</code> - è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„</li>
</ul>
</li>
<li>
<p><code>write</code> - å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ã€‚</p>
<ul>
<li><code>path</code> - è¦å†™å…¥çš„æ–‡ä»¶è·¯å¾„</li>
<li><code>content</code> - å†™å…¥æ–‡ä»¶çš„å†…å®¹</li>
</ul>
</li>
<li>
<p><code>run</code> - è¿è¡Œå‘½ä»¤ã€‚</p>
<ul>
<li><code>command</code> - è¦è¿è¡Œçš„å‘½ä»¤</li>
</ul>
</li>
</ul>

<ul>
<li>
<p><code>browse</code> - æ‰“å¼€ç½‘é¡µã€‚</p>
<ul>
<li><code>url</code> - è¦æ‰“å¼€çš„URL</li>
</ul>
</li>
<li>
<p><code>think</code> - å…è®¸ä»£ç†åˆ¶å®šè®¡åˆ’ã€è®¾å®šç›®æ ‡æˆ–è®°å½•æƒ³æ³•</p>
<ul>
<li><code>thought</code> - è¦è®°å½•çš„æƒ³æ³•</li>
</ul>
</li>
<li>
<p><code>finish</code> - ä»£ç†å‘å‡ºä»»åŠ¡å®Œæˆçš„ä¿¡å·</p>
</li>
</ul>
<h5 data-id="heading-5">1.1.2 observation</h5>
<p>ä¸€ä¸ªobservation åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>observation</code>ï¼šè§‚å¯Ÿç±»å‹</li>
<li><code>content</code>ï¼šè¡¨ç¤ºè§‚å¯Ÿæ•°æ®çš„å­—ç¬¦ä¸²</li>
<li><code>extras</code>ï¼šé¢å¤–çš„ç»“æ„åŒ–æ•°æ®</li>
<li><code>message</code>ï¼šå¯ä»¥æ”¾åœ¨èŠå¤©è®°å½•ä¸­çš„å‹å¥½æ¶ˆæ¯</li>
</ul>
<p>æœ‰å‡ ç§observation ã€‚å®ƒä»¬çš„é¢å¤–ä¿¡æ¯åˆ—åœ¨ä¸‹é¢ã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¸ªåˆ—è¡¨å¯èƒ½ä¼šå¢é•¿ã€‚</p>
<ul>
<li>
<p><code>read</code> - æ–‡ä»¶å†…å®¹</p>
<ul>
<li><code>path</code> - è¯»å–çš„æ–‡ä»¶è·¯å¾„</li>
</ul>
</li>
<li>
<p><code>browse</code> - URLçš„HTMLå†…å®¹</p>
<ul>
<li><code>url</code> - æ‰“å¼€çš„URL</li>
</ul>
</li>
<li>
<p><code>run</code> - å‘½ä»¤çš„è¾“å‡º</p>
<ul>
<li><code>command</code> - è¿è¡Œçš„å‘½ä»¤</li>
<li><code>exit_code</code> - å‘½ä»¤çš„é€€å‡ºä»£ç </li>
</ul>
</li>
<li>
<p><code>chat</code> - ç”¨æˆ·çš„æ¶ˆæ¯</p>
</li>
</ul>
<h4 data-id="heading-6">1.2 æœåŠ¡å™¨ç»„ä»¶</h4>
<p>ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†OpenHandsé¡¹ç›®çš„æœåŠ¡å™¨ç«¯ç»„ä»¶ã€‚</p>
<h5 data-id="heading-7">session.py</h5>
<p><code>session.py</code> æ–‡ä»¶å®šä¹‰äº†<code>Session</code>ç±»ï¼Œå®ƒä»£è¡¨ä¸å®¢æˆ·ç«¯çš„WebSocketä¼šè¯ã€‚å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¤„ç†WebSocketè¿æ¥å’Œæ–­å¼€</li>
<li>åˆå§‹åŒ–å’Œç®¡ç†ä»£ç†ä¼šè¯</li>
<li>åœ¨å®¢æˆ·ç«¯å’Œä»£ç†ä¹‹é—´åˆ†å‘äº‹ä»¶</li>
<li>å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯å’Œé”™è¯¯</li>
</ul>
<h5 data-id="heading-8">session/agent_session.py</h5>
<p><code>agent_session.py</code> æ–‡ä»¶åŒ…å«<code>AgentSession</code>ç±»ï¼Œå®ƒç®¡ç†ä¼šè¯å†…ä»£ç†çš„ç”Ÿå‘½å‘¨æœŸã€‚å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>åˆ›å»ºå’Œç®¡ç†è¿è¡Œæ—¶ç¯å¢ƒ</li>
<li>åˆå§‹åŒ–ä»£ç†æ§åˆ¶å™¨</li>
<li>å¤„ç†å®‰å…¨åˆ†æ</li>
<li>ç®¡ç†äº‹ä»¶æµ</li>
</ul>
<h5 data-id="heading-9">session/conversation_manager/conversation_manager.py</h5>
<p><code>conversation_manager.py</code> æ–‡ä»¶å®šä¹‰äº†<code>ConversationManager</code>ç±»ï¼Œå®ƒè´Ÿè´£ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯ä¼šè¯ã€‚å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ·»åŠ å’Œé‡å¯ä¼šè¯</li>
<li>å‘ç‰¹å®šä¼šè¯å‘é€æ¶ˆæ¯</li>
<li>æ¸…ç†éæ´»åŠ¨ä¼šè¯</li>
</ul>
<h5 data-id="heading-10">listen.py</h5>
<p><code>listen.py</code> æ–‡ä»¶æ˜¯ä¸»æœåŠ¡å™¨æ–‡ä»¶ï¼Œå®ƒè®¾ç½®FastAPIåº”ç”¨ç¨‹åºå¹¶å®šä¹‰å„ç§APIç«¯ç‚¹ã€‚å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>è®¾ç½®CORSä¸­é—´ä»¶</li>
<li>å¤„ç†WebSocketè¿æ¥</li>
<li>ç®¡ç†æ–‡ä»¶ä¸Šä¼ </li>
<li>æä¾›ä»£ç†äº¤äº’ã€æ–‡ä»¶æ“ä½œå’Œå®‰å…¨åˆ†æçš„APIç«¯ç‚¹</li>
<li>ä¸ºå‰ç«¯æä¾›é™æ€æ–‡ä»¶æœåŠ¡</li>
</ul>
<p>è¯¥è„šæœ¬å®šä¹‰äº†æœåŠ¡æ¥å£ï¼Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>ä¸€éƒ¨åˆ†æ˜¯é€šè¿‡<code>FastAPI</code>åº“å®ç°çš„HTTPæ¥å£ï¼Œå…¶å…·ä½“å®ç°ä½äº<code>openhands/server/routes</code>ç›®å½•ä¸­ï¼›</li>
<li>å¦ä¸€éƒ¨åˆ†æ˜¯åˆ©ç”¨<code>socketio</code>åº“å®ç°çš„WebSocketæ¥å£ï¼Œå…¶ä»£ç å®ç°åœ¨<code>openhands/server/listen_socket.py</code>æ–‡ä»¶ä¸­ã€‚ç”¨æˆ·ä¸ä»£ç†çš„äº¤äº’é€šè¿‡WebSocketè¿›è¡Œï¼Œè¿æ¥åˆå§‹åŒ–æ—¶ä¼šè§¦å‘<code>connect</code>äº‹ä»¶ï¼Œç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ä¼šè§¦å‘<code>oh_user_action</code>äº‹ä»¶ï¼Œè¿æ¥æ–­å¼€æ—¶ä¼šè§¦å‘<code>disconnect</code>äº‹ä»¶ã€‚å› æ­¤ï¼Œæ¢³ç†ä»£ç†äº¤äº’é€»è¾‘çš„æ ¸å¿ƒåœ¨äºå¯¹è¿™ä¸‰ä¸ªäº‹ä»¶çš„å¤„ç†æµç¨‹è¿›è¡Œæ•´ç†ã€‚</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span>Â socketio

<span class="hljs-keyword">from</span>Â openhands.server.appÂ <span class="hljs-keyword">import</span>Â appÂ <span class="hljs-keyword">as</span>Â base_app
<span class="hljs-keyword">from</span>Â openhands.server.listen_socketÂ <span class="hljs-keyword">import</span>Â sio
<span class="hljs-keyword">from</span>Â openhands.server.middlewareÂ <span class="hljs-keyword">import</span>Â (
Â Â Â Â CacheControlMiddleware,
Â Â Â Â InMemoryRateLimiter,
Â Â Â Â LocalhostCORSMiddleware,
Â Â Â Â RateLimitMiddleware,
)
<span class="hljs-keyword">from</span>Â openhands.server.staticÂ <span class="hljs-keyword">import</span>Â SPAStaticFiles

<span class="hljs-keyword">if</span>Â os.getenv(<span class="hljs-string">'SERVE_FRONTEND'</span>,Â <span class="hljs-string">'true'</span>).lower()Â ==Â <span class="hljs-string">'true'</span>:
Â Â Â Â base_app.mount(
Â Â Â Â Â Â Â Â <span class="hljs-string">'/'</span>,Â SPAStaticFiles(directory=<span class="hljs-string">'./frontend/build'</span>,Â html=<span class="hljs-literal">True</span>),Â name=<span class="hljs-string">'dist'</span>
Â Â Â Â )

base_app.add_middleware(LocalhostCORSMiddleware)
base_app.add_middleware(CacheControlMiddleware)
base_app.add_middleware(
Â Â Â Â RateLimitMiddleware,
Â Â Â Â rate_limiter=InMemoryRateLimiter(requests=<span class="hljs-number">10</span>,Â seconds=<span class="hljs-number">1</span>),
)

appÂ =Â socketio.ASGIApp(sio,Â other_asgi_app=base_app)
</code></pre>
<h4 data-id="heading-11">1.3 æœåŠ¡å·¥ä½œæµç¨‹æè¿°</h4>
<p>æœåŠ¡çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>æœåŠ¡å™¨åˆå§‹åŒ–</strong>ï¼š</p>
<ul>
<li>FastAPIåº”ç”¨ç¨‹åºåœ¨<code>listen.py</code>ä¸­åˆ›å»ºå’Œé…ç½®ã€‚</li>
<li>è®¾ç½®CORSä¸­é—´ä»¶å’Œé™æ€æ–‡ä»¶æœåŠ¡ã€‚</li>
<li>åˆå§‹åŒ–<code>ConversationManager</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å®¢æˆ·ç«¯è¿æ¥</strong>ï¼š</p>
<ul>
<li>å½“å®¢æˆ·ç«¯é€šè¿‡WebSocketè¿æ¥æ—¶ï¼Œåˆ›å»ºæ–°çš„<code>Session</code>æˆ–é‡å¯ç°æœ‰ä¸€ä¸ªã€‚</li>
<li><code>Session</code>åˆå§‹åŒ–<code>AgentSession</code>ï¼Œè®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒå’Œä»£ç†æ§åˆ¶å™¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä»£ç†åˆå§‹åŒ–</strong>ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯å‘é€åˆå§‹åŒ–è¯·æ±‚ã€‚</li>
<li>æœåŠ¡å™¨æ ¹æ®æä¾›çš„å‚æ•°åˆ›å»ºå’Œé…ç½®ä»£ç†ã€‚</li>
<li>è®¾ç½®è¿è¡Œæ—¶ç¯å¢ƒï¼Œåˆå§‹åŒ–ä»£ç†æ§åˆ¶å™¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>äº‹ä»¶å¤„ç†</strong>ï¼š</p>
<ul>
<li><code>Session</code>ç®¡ç†å®¢æˆ·ç«¯å’Œä»£ç†ä¹‹é—´çš„äº‹ä»¶æµã€‚</li>
<li>å®¢æˆ·ç«¯çš„äº‹ä»¶åˆ†å‘åˆ°ä»£ç†ã€‚</li>
<li>ä»£ç†çš„è§‚å¯Ÿç»“æœå‘é€å›å®¢æˆ·ç«¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ–‡ä»¶æ“ä½œ</strong>ï¼š</p>
<ul>
<li>æœåŠ¡å™¨å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Œç¡®ä¿å®ƒä»¬ç¬¦åˆå¤§å°å’Œç±»å‹é™åˆ¶ã€‚</li>
<li>é€šè¿‡è¿è¡Œæ—¶ç¯å¢ƒæ‰§è¡Œæ–‡ä»¶è¯»å–å’Œå†™å…¥æ“ä½œã€‚</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨åˆ†æ</strong>ï¼š</p>
<ul>
<li>å¦‚æœé…ç½®äº†ï¼Œæ¯ä¸ªä¼šè¯åˆå§‹åŒ–å®‰å…¨åˆ†æå™¨ã€‚</li>
<li>å®‰å…¨ç›¸å…³çš„APIè¯·æ±‚è½¬å‘åˆ°å®‰å…¨åˆ†æå™¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¼šè¯ç®¡ç†</strong>ï¼š</p>
<ul>
<li><code>ConversationManager</code>å®šæœŸæ¸…ç†éæ´»åŠ¨ä¼šè¯ã€‚</li>
<li>å®ƒè¿˜åœ¨éœ€è¦æ—¶å¤„ç†å‘ç‰¹å®šä¼šè¯å‘é€æ¶ˆæ¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>APIç«¯ç‚¹</strong>ï¼š</p>
<ul>
<li>æä¾›å„ç§APIç«¯ç‚¹ï¼Œç”¨äºä»£ç†äº¤äº’ã€æ–‡ä»¶æ“ä½œå’Œè·å–é…ç½®é»˜è®¤å€¼ã€‚</li>
</ul>
</li>
</ol>
<p>è¿™ç§æœåŠ¡å™¨æ¶æ„å…è®¸ç®¡ç†å¤šä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼Œæ¯ä¸ªä¼šè¯éƒ½æœ‰è‡ªå·±çš„ä»£ç†å®ä¾‹ã€è¿è¡Œæ—¶ç¯å¢ƒå’Œå®‰å…¨åˆ†æå™¨ã€‚äº‹ä»¶é©±åŠ¨è®¾è®¡ä¿ƒè¿›äº†å®¢æˆ·ç«¯å’Œä»£ç†ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œè€Œæ¨¡å—åŒ–ç»“æ„å…è®¸è½»æ¾æ‰©å±•å’Œç»´æŠ¤ä¸åŒç»„ä»¶ã€‚</p>
<h4 data-id="heading-12">1.4 listen_socket.py</h4>
<p>listen_socket.pyæ˜¯ OpenHands æœåŠ¡å™¨ç«¯çš„ Socket.IO äº‹ä»¶ç›‘å¬å™¨ï¼Œè´Ÿè´£å¤„ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶åŒå‘é€šä¿¡ï¼ŒåŒ…æ‹¬è¿æ¥å»ºç«‹ã€äº‹ä»¶å›æ”¾ã€ç”¨æˆ·è¡ŒåŠ¨è½¬å‘å’Œè¿æ¥æ–­å¼€å››å¤§æ ¸å¿ƒåœºæ™¯ï¼Œæ˜¯å®¢æˆ·ç«¯ä¸åç«¯ä¼šè¯ã€ä»£ç†ç³»ç»Ÿäº¤äº’çš„æ¡¥æ¢ã€‚</p>
<h5 data-id="heading-13">1.4.1 æ ¸å¿ƒç‰¹è‰²</h5>
<p>listen_socket.pyçš„æ ¸å¿ƒç‰¹è‰²å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ–­ç‚¹ç»­ä¼ çš„äº‹ä»¶å›æ”¾ï¼šæ”¯æŒé€šè¿‡ <code>latest_event_id</code> å‚æ•°å®ç°äº‹ä»¶æ–­ç‚¹ç»­ä¼ ï¼Œå®¢æˆ·ç«¯é‡è¿æ—¶ä»…å›æ”¾æœªæ¥æ”¶çš„äº‹ä»¶ï¼Œé¿å…é‡å¤æ•°æ®ä¼ è¾“ï¼Œæå‡è¿æ¥æ•ˆç‡ã€‚</li>
<li>ä¸¥æ ¼çš„èº«ä»½ä¸æƒé™æ ¡éªŒï¼šè¿æ¥å»ºç«‹æ—¶æ ¡éªŒä¼šè¯ IDã€API å¯†é’¥ã€ç”¨æˆ·èº«ä»½ï¼ˆé€šè¿‡ Cookie å’Œ Authorization å¤´ï¼‰ï¼Œç¡®ä¿ä¼šè¯å®‰å…¨æ€§ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚</li>
<li>å‘åå…¼å®¹çš„äº‹ä»¶å¤„ç†ï¼šä¿ç•™ <code>oh_action</code> å¤„ç†å™¨å…¼å®¹æ—§ç‰ˆå®¢æˆ·ç«¯ï¼ŒåŒæ—¶æä¾› <code>oh_user_action</code> æ–°ç‰ˆæ¥å£ï¼Œå¹³æ»‘è¿‡æ¸¡ä¸ä¸­æ–­æœåŠ¡ã€‚</li>
<li>æœ‰åºçš„äº‹ä»¶æ¨é€é€»è¾‘ï¼šä»£ç†çŠ¶æ€å˜æ›´äº‹ä»¶ï¼ˆ<code>AgentStateChangedObservation</code>ï¼‰æœ€åå‘é€ï¼Œç¡®ä¿å®¢æˆ·ç«¯å…ˆæ¥æ”¶å†å²äº‹ä»¶ï¼Œå†åŒæ­¥æœ€æ–°çŠ¶æ€ï¼Œé¿å…çŠ¶æ€ä¸ä¸€è‡´ã€‚</li>
<li>å¼‚æ­¥é«˜æ•ˆçš„äº‹ä»¶å¤„ç†ï¼šåŸºäºå¼‚æ­¥ IOï¼ˆ<code>async/await</code>ï¼‰å®ç°äº‹ä»¶å›æ”¾å’Œè½¬å‘ï¼Œæ”¯æŒé«˜å¹¶å‘è¿æ¥ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œæå‡ç³»ç»Ÿååé‡ã€‚</li>
<li>å®Œå–„çš„é”™è¯¯å¤„ç†ï¼šè¿æ¥å¤±è´¥æ—¶ä¸»åŠ¨æ–­å¼€æ— æ•ˆè¿æ¥ï¼Œè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ï¼›è¿‡æ»¤æ— æ•ˆäº‹ä»¶ï¼ˆå¦‚ <code>NullAction</code>ï¼‰ï¼Œå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œä¼ è¾“ã€‚</li>
</ol>
<h5 data-id="heading-14">1.4.2 å…·ä½“åŠŸèƒ½</h5>
<p>listen_socket.pyçš„å…·ä½“åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>è¿æ¥ç®¡ç†ï¼ˆconnect äº‹ä»¶ï¼‰</p>
<ul>
<li>èº«ä»½éªŒè¯ï¼šéªŒè¯è¿æ¥å‚æ•°ä¸­çš„ conversation_id å’Œ API å¯†é’¥</li>
<li>ç”¨æˆ·è®¤è¯ï¼šé€šè¿‡ conversation_validator éªŒè¯ç”¨æˆ·èº«ä»½</li>
<li>ä¼šè¯æ¢å¤ï¼šä¸ºå·²å­˜åœ¨çš„ä¼šè¯é‡æ”¾äº‹ä»¶æµå†å²</li>
<li>äº‹ä»¶é‡æ’­ï¼šå‘æ–°è¿æ¥çš„å®¢æˆ·ç«¯å‘é€å†å²äº‹ä»¶ï¼ŒåŒ…æ‹¬è¿‡æ»¤ç‰¹å®šäº‹ä»¶ç±»å‹</li>
<li>ä¼šè¯åŠ å…¥ï¼šå°†å®¢æˆ·ç«¯è¿æ¥åŠ å…¥åˆ°å¯¹åº”çš„ä¼šè¯ä¸­</li>
</ul>
</li>
<li>
<p>åŠ¨ä½œå¤„ç†ï¼ˆoh_user_action å’Œ oh_action äº‹ä»¶ï¼‰</p>
<ul>
<li>ç”¨æˆ·åŠ¨ä½œæ¥æ”¶ï¼šå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ç”¨æˆ·æ“ä½œè¯·æ±‚</li>
<li>äº‹ä»¶è½¬å‘ï¼šå°†ç”¨æˆ·åŠ¨ä½œè½¬å‘åˆ°ä¼šè¯ç®¡ç†å™¨è¿›è¡Œå¤„ç†</li>
<li>å‘åå…¼å®¹ï¼šåŒæ—¶æ”¯æŒ oh_user_action å’Œ oh_action äº‹ä»¶å¤„ç†ï¼ˆåè€…ä¸ºå…¼å®¹æ—§å®¢æˆ·ç«¯ä¿ç•™ï¼‰</li>
</ul>
</li>
<li>
<p>æ–­å¼€è¿æ¥å¤„ç†ï¼ˆdisconnect äº‹ä»¶ï¼‰</p>
<ul>
<li>è¿æ¥æ¸…ç†ï¼šå½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œæ¸…ç†ç›¸å…³ä¼šè¯èµ„æº</li>
<li>çŠ¶æ€ç®¡ç†ï¼šé€šçŸ¥ä¼šè¯ç®¡ç†å™¨å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥</li>
</ul>
</li>
</ul>
<p>listen_socket.pyçš„æ ¸å¿ƒå·¥ä½œæµç¨‹ä¸ºï¼š</p>
<ul>
<li>
<p>è¿æ¥å»ºç«‹ï¼š</p>
<ul>
<li>è§£ææŸ¥è¯¢å‚æ•°ï¼ˆä¼šè¯ IDã€æœ€æ–°äº‹ä»¶ IDç­‰ï¼‰</li>
<li>éªŒè¯ä¼šè¯å’Œç”¨æˆ·èº«ä»½</li>
<li>åˆ›å»ºäº‹ä»¶å­˜å‚¨å®ä¾‹</li>
</ul>
</li>
<li>
<p>äº‹ä»¶å†å²é‡æ’­ï¼š</p>
<ul>
<li>ä¸ºå®¢æˆ·ç«¯é‡æ”¾ä¼šè¯å†å²äº‹ä»¶</li>
<li>è¿‡æ»¤æ‰ NullActionã€NullObservationã€RecallAction ç­‰ç‰¹å®šäº‹ä»¶</li>
<li>ç¡®ä¿ AgentStateChangedObservation äº‹ä»¶æœ€åå‘é€</li>
</ul>
</li>
<li>
<p>ä¼šè¯åŠ å…¥ï¼š</p>
<ul>
<li>å°†è¿æ¥ ID ä¸ä¼šè¯å…³è”</li>
<li>åˆå§‹åŒ–ä¼šè¯è®¾ç½®</li>
</ul>
</li>
<li>
<p>å®‰å…¨æœºåˆ¶</p>
<ul>
<li>APIå¯†é’¥éªŒè¯ï¼šæ£€æŸ¥ SESSION_API_KEY ç¯å¢ƒå˜é‡ä¸æŸ¥è¯¢å‚æ•°ä¸­çš„å¯†é’¥æ˜¯å¦åŒ¹é…</li>
<li>ä¼šè¯æƒé™æ§åˆ¶ï¼šé€šè¿‡ conversation_validator éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®å®šä¼šè¯</li>
</ul>
</li>
<li>
<p>é”™è¯¯å¤„ç†</p>
<ul>
<li>è¿æ¥æ‹’ç»ï¼šåœ¨éªŒè¯å¤±è´¥æˆ–å‡ºç°é”™è¯¯æ—¶æ‹’ç»è¿æ¥</li>
<li>å¼‚å¸¸ä¼ æ’­ï¼šä½¿ç”¨ConnectionRefusedErrorå¤„ç†è¿æ¥é”™è¯¯</li>
<li>å¼‚æ­¥æ¸…ç†ï¼šåœ¨è¿æ¥è¢«æ‹’ç»åå¼‚æ­¥æ–­å¼€è¿æ¥</li>
</ul>
</li>
</ul>
<p>listen_socket.py ä¸å…¶ä»–ç»„ä»¶å…³ç³»</p>
<ul>
<li>ä¸EventStreamç´§å¯†é…åˆï¼Œè´Ÿè´£äº‹ä»¶çš„ä¼ è¾“å’Œåˆ†å‘</li>
<li>é€šè¿‡ connection_manager ç®¡ç†ä¼šè¯çŠ¶æ€</li>
<li>ä½¿ç”¨ event_to_dict è¿›è¡Œäº‹ä»¶åºåˆ—åŒ–ä»¥ä¾¿é€šè¿‡ç½‘ç»œä¼ è¾“</li>
</ul>
<h5 data-id="heading-15">1.4.3 æµç¨‹å›¾</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/268213b2cf444fc4a4dc162b50d04b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770292925&amp;x-signature=8VyQJHw6BXja3XK2J5%2Bwgxw9%2Ba0%3D" alt="Openhands-æœåŠ¡" loading="lazy"/></p>
<p>Openhands-æœåŠ¡</p>
<h5 data-id="heading-16">1.4.4 ä¼šè¯è¿æ¥</h5>
<p>æ­¤å¤„å…³é”®ä¸€æ­¥ä¸ºä¸ä¼šè¯ç®¡ç†å™¨ ConversationManager å»ºç«‹è¿æ¥ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Â Â Â Â Â Â Â Â <span class="hljs-attr">conversation_init_data</span>Â =Â awaitÂ setup_init_conversation_settings(
Â Â Â Â Â Â Â Â Â Â Â Â user_id,Â conversation_id,Â providers_set
Â Â Â Â Â Â Â Â )

Â Â Â Â Â Â Â Â <span class="hljs-attr">agent_loop_info</span>Â =Â awaitÂ conversation_manager.join_conversation(
Â Â Â Â Â Â Â Â Â Â Â Â conversation_id,
Â Â Â Â Â Â Â Â Â Â Â Â connection_id,
Â Â Â Â Â Â Â Â Â Â Â Â conversation_init_data,
Â Â Â Â Â Â Â Â Â Â Â Â user_id,
Â Â Â Â Â Â Â Â )
</code></pre>
<h5 data-id="heading-17">1.4.5 ä»£ç </h5>
<p>listen_socket.pyçš„ä»£ç ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@sio.event</span>
<span class="hljs-keyword">async</span>Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">connect</span>(<span class="hljs-params">connection_id:Â <span class="hljs-built_in">str</span>,Â environ:Â <span class="hljs-built_in">dict</span></span>)Â -&gt;Â <span class="hljs-literal">None</span>:
Â Â Â Â <span class="hljs-string">"""
Â Â Â Â SocketIOè¿æ¥äº‹ä»¶å¤„ç†å™¨ï¼šå®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶è§¦å‘ï¼Œå®Œæˆä¼šè¯éªŒè¯ã€äº‹ä»¶å›æ”¾ã€ä¼šè¯åŠ å…¥ç­‰åˆå§‹åŒ–æµç¨‹ã€‚
Â Â Â Â 
Â Â Â Â å‚æ•°ï¼š
Â Â Â Â Â Â Â Â connection_id:Â å®¢æˆ·ç«¯è¿æ¥å”¯ä¸€æ ‡è¯†ï¼ˆSocketIOåˆ†é…ï¼‰
Â Â Â Â Â Â Â Â environ:Â WSGIç¯å¢ƒå˜é‡å­—å…¸ï¼ŒåŒ…å«è¯·æ±‚å¤´ã€æŸ¥è¯¢å‚æ•°ç­‰ä¿¡æ¯
Â Â Â Â """</span>
Â Â Â Â <span class="hljs-keyword">try</span>:
Â Â Â Â Â Â Â Â logger.info(<span class="hljs-string">f"SocketIOè¿æ¥å»ºç«‹ï¼šconnection_id=<span class="hljs-subst">{connection_id}</span>"</span>)
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â è§£ææŸ¥è¯¢å‚æ•°ï¼ˆä»WSGIç¯å¢ƒå˜é‡ä¸­æå–QUERY_STRINGï¼‰</span>
Â Â Â Â Â Â Â Â query_paramsÂ =Â parse_qs(environ.get(<span class="hljs-string">'QUERY_STRING'</span>,Â <span class="hljs-string">''</span>))
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â è§£ææœ€æ–°äº‹ä»¶IDï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼Œé»˜è®¤-1è¡¨ç¤ºä»æœ€å¼€å§‹å›æ”¾ï¼‰</span>
Â Â Â Â Â Â Â Â latest_event_id_strÂ =Â query_params.get(<span class="hljs-string">'latest_event_id'</span>,Â [-<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>]
Â Â Â Â Â Â Â Â <span class="hljs-keyword">try</span>:
Â Â Â Â Â Â Â Â Â Â Â Â latest_event_idÂ =Â <span class="hljs-built_in">int</span>(latest_event_id_str)
Â Â Â Â Â Â Â Â <span class="hljs-keyword">except</span>Â ValueError:
Â Â Â Â Â Â Â Â Â Â Â Â logger.debug(<span class="hljs-string">f"æ— æ•ˆçš„latest_event_idå€¼ï¼š<span class="hljs-subst">{latest_event_id_str}</span>ï¼Œé»˜è®¤è®¾ä¸º-1"</span>)
Â Â Â Â Â Â Â Â Â Â Â Â latest_event_idÂ =Â -<span class="hljs-number">1</span>
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â è§£æä¼šè¯IDï¼ˆå¿…éœ€å‚æ•°ï¼Œç”¨äºå…³è”ç‰¹å®šå¯¹è¯ï¼‰</span>
Â Â Â Â Â Â Â Â conversation_idÂ =Â query_params.get(<span class="hljs-string">'conversation_id'</span>,Â [<span class="hljs-literal">None</span>])[<span class="hljs-number">0</span>]
Â Â Â Â Â Â Â Â logger.info(<span class="hljs-string">f"ä¼šè¯è¿æ¥è¯·æ±‚ï¼šconversation_id=<span class="hljs-subst">{conversation_id}</span>,Â connection_id=<span class="hljs-subst">{connection_id}</span>"</span>)
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â è§£ææä¾›è€…é›†åˆï¼ˆå¦‚æ”¯æŒçš„LLMæä¾›å•†åˆ—è¡¨ï¼Œç”¨äºé™åˆ¶å¯ç”¨èµ„æºï¼‰</span>
Â Â Â Â Â Â Â Â raw_listÂ =Â query_params.get(<span class="hljs-string">'providers_set'</span>,Â [])
Â Â Â Â Â Â Â Â providers_listÂ =Â []
Â Â Â Â Â Â Â Â <span class="hljs-keyword">for</span>Â itemÂ <span class="hljs-keyword">in</span>Â raw_list:
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ‹†åˆ†é€—å·åˆ†éš”çš„æä¾›è€…åç§°ï¼Œè¿‡æ»¤ç©ºå€¼</span>
Â Â Â Â Â Â Â Â Â Â Â Â providers_list.extend(item.split(<span class="hljs-string">','</span>)Â <span class="hljs-keyword">if</span>Â <span class="hljs-built_in">isinstance</span>(item,Â <span class="hljs-built_in">str</span>)Â <span class="hljs-keyword">else</span>Â [])
Â Â Â Â Â Â Â Â providers_listÂ =Â [pÂ <span class="hljs-keyword">for</span>Â pÂ <span class="hljs-keyword">in</span>Â providers_listÂ <span class="hljs-keyword">if</span>Â p]
Â Â Â Â Â Â Â Â providers_setÂ =Â [ProviderType(p)Â <span class="hljs-keyword">for</span>Â pÂ <span class="hljs-keyword">in</span>Â providers_list]Â Â <span class="hljs-comment">#Â è½¬æ¢ä¸ºProviderTypeæšä¸¾ç±»å‹</span>

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ ¡éªŒä¼šè¯IDæ˜¯å¦å­˜åœ¨</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-keyword">not</span>Â conversation_id:
Â Â Â Â Â Â Â Â Â Â Â Â logger.error(<span class="hljs-string">"æŸ¥è¯¢å‚æ•°ä¸­ç¼ºå°‘conversation_id"</span>)
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">raise</span>Â ConnectionRefusedError(<span class="hljs-string">"ç¼ºå°‘ä¼šè¯IDï¼ˆconversation_idï¼‰"</span>)

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ ¡éªŒä¼šè¯APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â _invalid_session_api_key(query_params):
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">raise</span>Â ConnectionRefusedError(<span class="hljs-string">"æ— æ•ˆçš„ä¼šè¯APIå¯†é’¥"</span>)

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æå–è¯·æ±‚ä¸­çš„Cookieå’ŒAuthorizationå¤´ï¼ˆç”¨äºç”¨æˆ·èº«ä»½éªŒè¯ï¼‰</span>
Â Â Â Â Â Â Â Â cookies_strÂ =Â environ.get(<span class="hljs-string">'HTTP_COOKIE'</span>,Â <span class="hljs-string">''</span>)
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â WSGIç¯å¢ƒä¸­ï¼ŒHTTPå¤´ä¼šè½¬ä¸º"HTTP_å‰ç¼€+ä¸‹åˆ’çº¿æ›¿æ¢çŸ­æ¨ªçº¿"æ ¼å¼</span>
Â Â Â Â Â Â Â Â authorization_headerÂ =Â environ.get(<span class="hljs-string">'HTTP_AUTHORIZATION'</span>,Â <span class="hljs-literal">None</span>)
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â åˆ›å»ºä¼šè¯éªŒè¯å™¨ï¼Œæ ¡éªŒç”¨æˆ·èº«ä»½ï¼ˆå…³è”ä¼šè¯IDã€Cookieã€æˆæƒå¤´ï¼‰</span>
Â Â Â Â Â Â Â Â conversation_validatorÂ =Â create_conversation_validator()
Â Â Â Â Â Â Â Â user_idÂ =Â <span class="hljs-keyword">await</span>Â conversation_validator.validate(
Â Â Â Â Â Â Â Â Â Â Â Â conversation_id,Â cookies_str,Â authorization_header
Â Â Â Â Â Â Â Â )
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â åˆ›å»ºäº‹ä»¶å­˜å‚¨å®ä¾‹ï¼ˆç”¨äºè¯»å–ä¼šè¯å†å²äº‹ä»¶ï¼‰</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">try</span>:
Â Â Â Â Â Â Â Â Â Â Â Â event_storeÂ =Â EventStore(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â conversation_id,Â conversation_manager.file_store,Â user_id
Â Â Â Â Â Â Â Â Â Â Â Â )
Â Â Â Â Â Â Â Â <span class="hljs-keyword">except</span>Â FileNotFoundErrorÂ <span class="hljs-keyword">as</span>Â e:
Â Â Â Â Â Â Â Â Â Â Â Â logger.error(<span class="hljs-string">f"åˆ›å»ºä¼šè¯äº‹ä»¶å­˜å‚¨å¤±è´¥ï¼šconversation_id=<span class="hljs-subst">{conversation_id}</span>,Â é”™è¯¯=<span class="hljs-subst">{e}</span>"</span>)
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">raise</span>Â ConnectionRefusedError(<span class="hljs-string">f"æ— æ³•è®¿é—®ä¼šè¯äº‹ä»¶ï¼š<span class="hljs-subst">{e}</span>"</span>)

Â Â Â Â Â Â Â Â agent_state_changedÂ =Â <span class="hljs-literal">None</span>Â Â <span class="hljs-comment">#Â å­˜å‚¨ä»£ç†çŠ¶æ€å˜æ›´äº‹ä»¶ï¼ˆæœ€åå•ç‹¬å‘é€ï¼‰</span>

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â åˆ›å»ºå¼‚æ­¥äº‹ä»¶å­˜å‚¨åŒ…è£…å™¨ï¼Œä»latest_event_id+1å¼€å§‹å›æ”¾äº‹ä»¶ï¼ˆé¿å…é‡å¤ï¼‰</span>
Â Â Â Â Â Â Â Â async_storeÂ =Â AsyncEventStoreWrapper(event_store,Â latest_event_idÂ +Â <span class="hljs-number">1</span>)

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â å¼‚æ­¥å›æ”¾å†å²äº‹ä»¶ï¼ˆå‘å®¢æˆ·ç«¯æ¨é€æœªæ¥æ”¶è¿‡çš„äº‹ä»¶ï¼‰</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">async</span>Â <span class="hljs-keyword">for</span>Â eventÂ <span class="hljs-keyword">in</span>Â async_store:
Â Â Â Â Â Â Â Â Â Â Â Â logger.debug(<span class="hljs-string">f"å›æ”¾äº‹ä»¶ï¼š<span class="hljs-subst">{event.__class__.__name__}</span>"</span>)

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â è·³è¿‡æ— æ•ˆ/å¬å›ç±»äº‹ä»¶ï¼ˆæ— éœ€æ¨é€ç»™å®¢æˆ·ç«¯ï¼‰</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â <span class="hljs-built_in">isinstance</span>(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â event,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (NullAction,Â NullObservation,Â RecallAction),
Â Â Â Â Â Â Â Â Â Â Â Â ):
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">continue</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æš‚å­˜ä»£ç†çŠ¶æ€å˜æ›´äº‹ä»¶ï¼ˆæœ€åå‘é€ï¼Œç¡®ä¿å®¢æˆ·ç«¯çŠ¶æ€åŒæ­¥ï¼‰</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">elif</span>Â <span class="hljs-built_in">isinstance</span>(event,Â AgentStateChangedObservation):
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â agent_state_changedÂ =Â event
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â å…¶ä»–äº‹ä»¶ç›´æ¥æ¨é€ç»™å®¢æˆ·ç«¯</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">else</span>:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">await</span>Â sio.emit(<span class="hljs-string">'oh_event'</span>,Â event_to_dict(event),Â to=connection_id)

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æœ€åå‘é€ä»£ç†çŠ¶æ€å˜æ›´äº‹ä»¶ï¼ˆç¡®ä¿å®¢æˆ·ç«¯è·å–æœ€æ–°çŠ¶æ€ï¼‰</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â agent_state_changed:
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">await</span>Â sio.emit(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-string">'oh_event'</span>,Â event_to_dict(agent_state_changed),Â to=connection_id
Â Â Â Â Â Â Â Â Â Â Â Â )

Â Â Â Â Â Â Â Â logger.info(<span class="hljs-string">f"ä¼šè¯äº‹ä»¶å›æ”¾å®Œæˆï¼šconversation_id=<span class="hljs-subst">{conversation_id}</span>"</span>)

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â åˆå§‹åŒ–ä¼šè¯è®¾ç½®ï¼ˆç”¨æˆ·åå¥½ã€æä¾›è€…é…ç½®ç­‰ï¼‰</span>
Â Â Â Â Â Â Â Â conversation_init_dataÂ =Â <span class="hljs-keyword">await</span>Â setup_init_conversation_settings(
Â Â Â Â Â Â Â Â Â Â Â Â user_id,Â conversation_id,Â providers_set
Â Â Â Â Â Â Â Â )

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â åŠ å…¥ä¼šè¯ï¼šå…³è”connection_idä¸ä¼šè¯ï¼Œå¯åŠ¨ä»£ç†å¾ªç¯</span>
Â Â Â Â Â Â Â Â agent_loop_infoÂ =Â <span class="hljs-keyword">await</span>Â conversation_manager.join_conversation(
Â Â Â Â Â Â Â Â Â Â Â Â conversation_id,
Â Â Â Â Â Â Â Â Â Â Â Â connection_id,
Â Â Â Â Â Â Â Â Â Â Â Â conversation_init_data,
Â Â Â Â Â Â Â Â Â Â Â Â user_id,
Â Â Â Â Â Â Â Â )

Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â æ ¡éªŒä¼šè¯åŠ å…¥ç»“æœ</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â agent_loop_infoÂ <span class="hljs-keyword">is</span>Â <span class="hljs-literal">None</span>:
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">raise</span>Â ConnectionRefusedError(<span class="hljs-string">"åŠ å…¥ä¼šè¯å¤±è´¥"</span>)

Â Â Â Â Â Â Â Â logger.info(<span class="hljs-string">f"ä¼šè¯åŠ å…¥æˆåŠŸï¼šconversation_id=<span class="hljs-subst">{conversation_id}</span>,Â connection_id=<span class="hljs-subst">{connection_id}</span>"</span>)
Â Â Â Â Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">except</span>Â ConnectionRefusedError:
Â Â Â Â Â Â Â Â <span class="hljs-comment">#Â å‘é€é”™è¯¯åæ–­å¼€æ— æ•ˆè¿æ¥</span>
Â Â Â Â Â Â Â Â asyncio.create_task(sio.disconnect(connection_id))
Â Â Â Â Â Â Â Â <span class="hljs-keyword">raise</span>


<span class="hljs-meta">@sio.event</span>
<span class="hljs-keyword">async</span>Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">oh_user_action</span>(<span class="hljs-params">connection_id:Â <span class="hljs-built_in">str</span>,Â data:Â <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>,Â <span class="hljs-type">Any</span>]</span>)Â -&gt;Â <span class="hljs-literal">None</span>:
Â Â Â Â <span class="hljs-string">"""
Â Â Â Â å¤„ç†å®¢æˆ·ç«¯å‘é€çš„ç”¨æˆ·è¡ŒåŠ¨äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ã€æ“ä½œæŒ‡ä»¤ï¼‰ã€‚
Â Â Â Â 
Â Â Â Â å‚æ•°ï¼š
Â Â Â Â Â Â Â Â connection_id:Â å®¢æˆ·ç«¯è¿æ¥ID
Â Â Â Â Â Â Â Â data:Â ç”¨æˆ·è¡ŒåŠ¨æ•°æ®ï¼ˆå­—å…¸æ ¼å¼ï¼ŒåŒ…å«è¡ŒåŠ¨ç±»å‹ã€å†…å®¹ç­‰ï¼‰
Â Â Â Â """</span>
Â Â Â Â <span class="hljs-comment">#Â å°†ç”¨æˆ·è¡ŒåŠ¨è½¬å‘åˆ°äº‹ä»¶æµï¼Œç”±ä¼šè¯ç®¡ç†å™¨å¤„ç†</span>
Â Â Â Â <span class="hljs-keyword">await</span>Â conversation_manager.send_to_event_stream(connection_id,Â data)


<span class="hljs-meta">@sio.event</span>
<span class="hljs-keyword">async</span>Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">oh_action</span>(<span class="hljs-params">connection_id:Â <span class="hljs-built_in">str</span>,Â data:Â <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>,Â <span class="hljs-type">Any</span>]</span>)Â -&gt;Â <span class="hljs-literal">None</span>:
Â Â Â Â <span class="hljs-string">"""
Â Â Â Â å…¼å®¹æ—§ç‰ˆå®¢æˆ·ç«¯çš„è¡ŒåŠ¨äº‹ä»¶å¤„ç†å™¨ï¼ˆä¿ç•™ç”¨äºå‘åå…¼å®¹ï¼‰ã€‚
Â Â Â Â 
Â Â Â Â æ³¨æ„ï¼šå¾…æ‰€æœ‰å®¢æˆ·ç«¯å‡çº§ä¸ºä½¿ç”¨oh_user_actionåï¼Œå¯ç§»é™¤è¯¥å¤„ç†å™¨
Â Â Â Â ç›®å‰ç”¨äºæ”¯æŒæ­£åœ¨è¿›è¡Œä¸­çš„æ—§ä¼šè¯ï¼Œé¿å…ä¸­æ–­æœåŠ¡
Â Â Â Â """</span>
Â Â Â Â <span class="hljs-keyword">await</span>Â conversation_manager.send_to_event_stream(connection_id,Â data)


<span class="hljs-meta">@sio.event</span>
<span class="hljs-keyword">async</span>Â <span class="hljs-keyword">def</span>Â <span class="hljs-title function_">disconnect</span>(<span class="hljs-params">connection_id:Â <span class="hljs-built_in">str</span></span>)Â -&gt;Â <span class="hljs-literal">None</span>:
Â Â Â Â <span class="hljs-string">"""
Â Â Â Â SocketIOæ–­å¼€è¿æ¥äº‹ä»¶å¤„ç†å™¨ï¼šå®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶è§¦å‘ã€‚
Â Â Â Â 
Â Â Â Â å‚æ•°ï¼š
Â Â Â Â Â Â Â Â connection_id:Â æ–­å¼€è¿æ¥çš„å®¢æˆ·ç«¯ID
Â Â Â Â """</span>
Â Â Â Â logger.info(<span class="hljs-string">f"SocketIOè¿æ¥æ–­å¼€ï¼šconnection_id=<span class="hljs-subst">{connection_id}</span>"</span>)
Â Â Â Â <span class="hljs-comment">#Â é€šçŸ¥ä¼šè¯ç®¡ç†å™¨ï¼Œæ–­å¼€è¯¥è¿æ¥ä¸ä¼šè¯çš„å…³è”</span>
Â Â Â Â <span class="hljs-keyword">await</span>Â conversation_manager.disconnect_from_session(connection_id)
</code></pre>
<h3 data-id="heading-18">0xFF å‚è€ƒ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.all-hands.dev%2Fopenhands%2Fusage%2Farchitecture%2Fbackend" target="_blank" title="https://docs.all-hands.dev/openhands/usage/architecture/backend" ref="nofollow noopener noreferrer">docs.all-hands.dev/openhands/uâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1936485868761257658" target="_blank" title="https://zhuanlan.zhihu.com/p/1936485868761257658" ref="nofollow noopener noreferrer">å½“AI Agentä»â€œç©å…·â€èµ°å‘â€œå·¥å…·â€ï¼Œæˆ‘ä»¬è¯¥å…³æ³¨ä»€ä¹ˆï¼ŸOpenhandsæ¶æ„è§£æã€ç¬¬äºŒç¯‡ï¼šAgent ç›¸å…³æ ¸å¿ƒæ¦‚å¿µã€‘</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fdreamrenderx" target="_blank" title="https://www.zhihu.com/people/dreamrenderx" ref="nofollow noopener noreferrer">å…‹é‡Œ</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1936175201323825087" target="_blank" title="https://zhuanlan.zhihu.com/p/1936175201323825087" ref="nofollow noopener noreferrer">å½“AI Agentä»â€œç©å…·â€èµ°å‘â€œå·¥å…·â€ï¼Œæˆ‘ä»¬è¯¥å…³æ³¨ä»€ä¹ˆï¼ŸOpenhandsæ¶æ„è§£æã€ç¬¬ä¸€ç¯‡ï¼šç³»åˆ—å¯¼è¯»ã€‘</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fdreamrenderx" target="_blank" title="https://www.zhihu.com/people/dreamrenderx" ref="nofollow noopener noreferrer">å…‹é‡Œ</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1940436682949244630" target="_blank" title="https://zhuanlan.zhihu.com/p/1940436682949244630" ref="nofollow noopener noreferrer">Coding Agentä¹‹Openhandsè§£æ(å«ä»£ç )</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fwu-long-ming-cha-56" target="_blank" title="https://www.zhihu.com/people/wu-long-ming-cha-56" ref="nofollow noopener noreferrer">Arrow</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1940824548485347192" target="_blank" title="https://zhuanlan.zhihu.com/p/1940824548485347192" ref="nofollow noopener noreferrer">OpenHands æºç è§£è¯»</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fpeople%2Fxiao-hui-66-72" target="_blank" title="https://www.zhihu.com/people/xiao-hui-66-72" ref="nofollow noopener noreferrer">ä¸€åŠ›è¾‰</a></p>
<p>æœ¬æ–‡ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> æ’ç‰ˆ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dart - å…¨é¢è®¤è¯†Stream]]></title>    <link>https://juejin.cn/post/7600628279214456858</link>    <guid>https://juejin.cn/post/7600628279214456858</guid>    <pubDate>2026-01-29T09:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279214456858" data-draft-id="7600414546189713418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dart - å…¨é¢è®¤è¯†Stream"/> <meta itemprop="keywords" content="Flutter,Dart"/> <meta itemprop="datePublished" content="2026-01-29T09:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æµ©è¾‰"/> <meta itemprop="url" content="https://juejin.cn/user/1134351728786711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dart - å…¨é¢è®¤è¯†Stream
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1134351728786711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æµ©è¾‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:26:32.000Z" title="Thu Jan 29 2026 09:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€ç« ï¼šFlutter è¿›é˜¶â€”â€”ä¸ºä»€ä¹ˆä½ éœ€è¦ Streamï¼Ÿä» Future åˆ°æµçš„æ€ç»´è·ƒè¿</h2>
<p>åœ¨ Flutter å’Œ Dart çš„å¼‚æ­¥ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œå¤§å¤šæ•°å¼€å‘è€…éƒ½æ˜¯ä» <code>Future</code> å¼€å§‹å…¥é—¨çš„ã€‚æˆ‘ä»¬ä¹ æƒ¯äº† <code>await</code> ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç„¶åç­‰å¾…ç»“æœè¿”å›ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“ä½ è¯•å›¾å®ç°ä¸€ä¸ªâ€œå€’è®¡æ—¶â€ã€â€œæ–‡ä»¶ä¸‹è½½è¿›åº¦æ¡â€æˆ–è€…â€œå®æ—¶èŠå¤©å®¤â€æ—¶ï¼Œä½ ä¼šå‘ç° <code>Future</code> å˜å¾—åŠ›ä¸ä»å¿ƒã€‚è¿™æ—¶å€™ï¼Œä½ å°±éœ€è¦å‡çº§ä½ çš„æ­¦å™¨åº“ï¼Œå¼•å…¥ä¸€ä¸ªæ›´å¼ºå¤§çš„æ¦‚å¿µ â€”â€” <strong>Stream (æµ)</strong>ã€‚</p>
<p>æœ¬ç« æˆ‘ä»¬å°†ä¸å†ä»…ä»…ç½—åˆ— APIï¼Œè€Œæ˜¯ä»å†…å­˜å’Œæ‰§è¡ŒåŸç†çš„è§’åº¦ï¼Œè§£å‰– Stream åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä¸ºä»€ä¹ˆè¢«ç§°ä¸ºâ€œå¼‚æ­¥æ•°æ®çš„ç”Ÿå‘½ä¹‹æ²³â€ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ Future çš„â€œä¸€é”¤å­ä¹°å–â€</h3>
<p>å…ˆæ¥çœ‹ä¸€æ®µæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ <code>Future</code> ä»£ç ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-built_in">String</span>&gt; fetchUser() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-string">"Jason"</span>; <span class="hljs-comment">// ä»»åŠ¡ç»“æŸï¼Œè¿”å›ç»“æœ</span>
}

</code></pre>
<p><code>Future</code> çš„è®¾è®¡å“²å­¦éå¸¸ç®€å•ï¼š<strong>ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”ã€‚</strong></p>
<p>å®ƒå°±åƒæ˜¯ç½‘è´­ã€‚ä½ ä¸‹ä¸ªå•ï¼ˆè°ƒç”¨å‡½æ•°ï¼‰ï¼Œè¿‡å‡ å¤©å¿«é€’å‘˜ç»™ä½ <strong>ä¸€ä¸ª</strong>åŒ…è£¹ï¼ˆè¿”å›å€¼ï¼‰ã€‚äº¤æ˜“å®Œæˆåï¼Œä½ å’Œå¿«é€’å‘˜çš„å…³ç³»å°±ç»“æŸäº†ã€‚</p>
<p>åœ¨åº•å±‚å†…å­˜æ¨¡å‹ä¸­ï¼Œå½“ä½ æ‰§è¡Œ <code>return "Jason"</code> çš„é‚£ä¸€ç¬é—´ï¼Œå‘ç”Ÿäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li><strong>ç»“æœäº¤ä»˜</strong>ï¼šæ•°æ®è¢«å‘é€ç»™äº†ç­‰å¾…è€…ã€‚</li>
<li><strong>ç°åœºé”€æ¯</strong>ï¼š<code>fetchUser</code> å‡½æ•°çš„<strong>æ ˆå¸§ (Stack Frame)</strong> è¢«å¼¹å‡ºã€é”€æ¯ã€‚è¿™ä¸ªå‡½æ•°â€œæ­»â€äº†ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå½»åº•ç»“æŸã€‚</li>
</ol>
<p><strong>ç—›ç‚¹æ¥äº†ï¼š</strong>
å¦‚æœä½ æƒ³è¦çš„æ˜¯â€œè¿ç»­çš„æ•°æ®â€å‘¢ï¼Ÿ
æ¯”å¦‚ï¼Œä½ ä¸ä»…æƒ³çŸ¥é“â€œæ–‡ä»¶ä¸‹è½½å®Œäº†æ²¡æœ‰â€ï¼Œè¿˜æƒ³çŸ¥é“â€œç°åœ¨ä¸‹è½½äº†ç™¾åˆ†ä¹‹å‡ â€ã€‚</p>
<ul>
<li>å¦‚æœä½ ç”¨ <code>Future</code>ï¼Œä½ åªèƒ½å¾—åˆ°ä¸€å¼ ä¸‹è½½å®Œæˆæ—¶çš„<strong>æˆªå›¾</strong>ã€‚</li>
<li>ä½†ä½ çœŸæ­£æƒ³è¦çš„æ˜¯ä¸€æ®µ<strong>å½•åƒ</strong>ã€‚</li>
</ul>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½â€œæ´»ç€â€å¹¶åœ¨æ—¶é—´è½´ä¸Šæºæºä¸æ–­åå‡ºæ•°æ®çš„æœºåˆ¶ã€‚</p>
<h3 data-id="heading-2">äºŒã€ Streamï¼šæ—¶é—´è½´ä¸Šçš„ä¼ é€å¸¦</h3>
<p>å¦‚æœè¯´ <code>Future</code> æ˜¯é™æ€çš„<strong>ç‚¹</strong>ï¼Œé‚£ä¹ˆ <code>Stream</code> å°±æ˜¯åŠ¨æ€çš„<strong>çº¿</strong>ã€‚</p>
<p>ä½ å¯ä»¥æŠŠ <code>Stream</code> æƒ³è±¡æˆå›è½¬å¯¿å¸åº—é‡Œçš„ä¸€æ¡<strong>è‡ªåŠ¨ä¼ é€å¸¦</strong>ã€‚</p>
<p>åœ¨è¿™ä¸ªæ¨¡å‹é‡Œï¼Œæœ‰ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²ï¼š</p>
<ol>
<li><strong>Sink (å…¥å£/å¨å¸ˆ)</strong>ï¼šè¿™æ˜¯ç”Ÿäº§ç«¯ã€‚å¨å¸ˆï¼ˆç”Ÿæˆå™¨ï¼‰æŠŠä¸€ç›˜ç›˜å¯¿å¸ï¼ˆæ•°æ®ï¼‰æŒ‰é¡ºåºæ”¾ä¸Šä¼ é€å¸¦ã€‚</li>
<li><strong>Stream (ç®¡é“)</strong>ï¼šè¿™æ˜¯ä¼ é€å¸¦æœ¬èº«ã€‚å®ƒè´Ÿè´£æ¬è¿æ•°æ®ï¼Œå®ƒä¸å…³å¿ƒè°åƒï¼Œåªè´Ÿè´£è½¬åŠ¨ã€‚</li>
<li><strong>Listener (å‡ºå£/é£Ÿå®¢)</strong>ï¼šè¿™æ˜¯æ¶ˆè´¹ç«¯ã€‚ä½ ååœ¨ä¼ é€å¸¦æœ«ç«¯ï¼Œ<strong>ç›‘å¬ (Listen)</strong> ç€å®ƒã€‚æ¥ä¸€ç›˜ï¼Œä½ åƒä¸€ç›˜ã€‚</li>
</ol>
<p>ä¸ <code>Future</code> ä¸åŒï¼Œ<code>Stream</code> æ˜¯ä¸€ç§ <strong>å¼‚æ­¥çš„ Iterable (Asynchronous Iterable)</strong>ã€‚å®ƒä»£è¡¨çš„ä¸æ˜¯â€œä¸€ä¸ªå€¼â€ï¼Œè€Œæ˜¯â€œå¯èƒ½éšæ—¶é—´æ¨ç§»è€Œåˆ°è¾¾çš„ä¸€ç³»åˆ—å€¼â€ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€ è¯­æ³•ä¸Šçš„â€œåŸºå› çªå˜â€ï¼šasync* ä¸ yield</h3>
<p>ä¸ºäº†æ”¯æŒè¿™ç§â€œæºæºä¸æ–­â€çš„ç‰¹æ€§ï¼ŒDart åœ¨è¯­æ³•å±‚é¢åšäº†ä¸€ä¸ªæå…·æ·±æ„çš„è®¾è®¡ã€‚</p>
<p>æˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨ä¸¤ä¸ªå…³é”®å­—ï¼š<code>async*</code> å’Œ <code>yield</code>ã€‚</p>
<h4 data-id="heading-4">1. é‚£ä¸ªç¥ç§˜çš„æ˜Ÿå· (*)</h4>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼ŒStream å‡½æ•°çš„å®šä¹‰åé¢å¿…é¡»å¸¦ä¸€ä¸ª <code>*</code>ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Future: å•æ•°</span>
Future&lt;<span class="hljs-built_in">int</span>&gt; getScore() <span class="hljs-keyword">async</span> { ... }

<span class="hljs-comment">// Stream: å¤æ•°ï¼ˆç”Ÿæˆå™¨ï¼‰</span>
Stream&lt;<span class="hljs-built_in">int</span>&gt; getScores() <span class="hljs-keyword">async</span>* { ... }

</code></pre>
<p>è¿™ä¸ªæ˜Ÿå· <code>*</code> ä»£è¡¨ <strong>Generator (ç”Ÿæˆå™¨)</strong>ã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå®ƒæš—ç¤ºç€â€œå¤šâ€å’Œâ€œç”Ÿäº§èƒ½åŠ›â€ã€‚å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼š<strong>â€œå—¨ï¼Œè¿™ä¸ªå‡½æ•°æœ‰ç‚¹ç‰¹æ®Šï¼Œå®ƒä¸ä¼šè·‘ä¸€éå°±æ­»æ‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªçŠ¶æ€æœºã€‚â€</strong></p>
<h4 data-id="heading-5">2. yield vs returnï¼šæš‚åœä¸é”€æ¯</h4>
<p>è¿™æ˜¯ç†è§£ Stream åº•å±‚åŸç†æœ€å…³é”®çš„ä¸€æ­¥ã€‚è¯·çœ‹è¿™æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Stream&lt;<span class="hljs-built_in">int</span>&gt; countDown() <span class="hljs-keyword">async</span>* {
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">5</span>; i &gt; <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>));
    <span class="hljs-keyword">yield</span> i; <span class="hljs-comment">// &lt;--- å…³é”®çœ‹è¿™é‡Œï¼</span>
  }
}

</code></pre>
<ul>
<li><strong><code>return</code> (è¾èŒ)</strong>ï¼š
å½“æ™®é€šå‡½æ•°æ‰§è¡Œ <code>return</code> æ—¶ï¼Œå®ƒæ˜¯<strong>å½»åº•é€€å‡º</strong>ã€‚å®ƒçš„æ ˆå¸§è¢«é”€æ¯ï¼Œå±€éƒ¨å˜é‡å…¨éƒ¨æ¸…ç©ºã€‚ä¸‹æ¬¡å†è°ƒç”¨ï¼Œä¸€åˆ‡ä»å¤´å¼€å§‹ã€‚</li>
<li><strong><code>yield</code> (åœè–ªç•™èŒ/æš‚åœ)</strong>ï¼š
å½“ç”Ÿæˆå™¨å‡½æ•°æ‰§è¡Œ <code>yield i</code> æ—¶ï¼Œå®ƒåšçš„æ˜¯ <strong>â€œäº¤å‡ºæ•°æ®ï¼ŒåŸåœ°æš‚åœâ€</strong>ã€‚</li>
<li><strong>äº¤å‡ºæ•°æ®</strong>ï¼šæŠŠ <code>i</code> æ‰”è¿›äº‹ä»¶å¾ªç¯ï¼Œå‘ç»™ç›‘å¬è€…ã€‚</li>
<li><strong>ä¿ç•™ç°åœº</strong>ï¼š<strong>å…³é”®ç‚¹ï¼</strong> æ­¤æ—¶å‡½æ•°çš„æ ˆå¸§<strong>å¹¶æ²¡æœ‰è¢«é”€æ¯</strong>ï¼å½“å‰çš„å±€éƒ¨å˜é‡ <code>i</code> çš„å€¼ã€ä»£ç æ‰§è¡Œåˆ°äº†ç¬¬å‡ è¡Œï¼Œé€šé€šè¢«â€œå†»ç»“â€åœ¨å†…å­˜é‡Œã€‚</li>
<li><strong>æ¢å¤æ‰§è¡Œ</strong>ï¼šå½“å‡½æ•°å†æ¬¡è¢«å”¤é†’æ—¶ï¼Œå®ƒä¼šä» <code>yield</code> çš„<strong>ä¸‹ä¸€è¡Œ</strong>ç»§ç»­æ‰§è¡Œï¼Œä»¿ä½›ä»æœªä¸­æ–­è¿‡ã€‚</li>
</ul>
<p>æ­£æ˜¯å› ä¸ºæœ‰äº† <code>yield</code> è¿™ç§**â€œä¿ç•™çŠ¶æ€â€**çš„èƒ½åŠ›ï¼ŒStream æ‰èƒ½åšåˆ°è®°ä½äº†å¾ªç¯åˆ°äº†å“ªé‡Œï¼Œä»è€Œæºæºä¸æ–­åœ°äº§ç”Ÿæ•°æ®ã€‚</p>
<h3 data-id="heading-6">å››ã€ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ Streamï¼Ÿ</h3>
<p>æ—¢ç„¶ <code>Future</code> ç®€å•å¥½ç”¨ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æŠ˜è…¾ <code>Stream</code>ï¼Ÿ</p>
<p><strong>1. è§£å†³â€œè¿‡ç¨‹â€é—®é¢˜</strong>
ç°å®ä¸–ç•Œçš„äº¤äº’å¾€å¾€æ˜¯è¿ç»­çš„ã€‚</p>
<ul>
<li><strong>å€’è®¡æ—¶</strong>ï¼š5, 4, 3, 2, 1...</li>
<li><strong>æœç´¢è”æƒ³</strong>ï¼šä½ è¾“ä¸€ä¸ªå­—æ¯ï¼Œæ¨èåˆ—è¡¨å˜ä¸€æ¬¡ã€‚</li>
<li><strong>WebSocket</strong>ï¼šæœåŠ¡å™¨éšæ—¶å¯èƒ½æ¨ä¸€æ¡æ–°æ¶ˆæ¯è¿‡æ¥ã€‚
è¿™äº›åœºæ™¯ï¼Œç”¨ <code>Future</code> è¿™ç§â€œä¸€æ¬¡æ€§æ‰¿è¯ºâ€æ˜¯æ— æ³•ä¼˜é›…å®ç°çš„ï¼Œå¿…é¡»ç”¨ <code>Stream</code>ã€‚</li>
</ul>
<p><strong>2. å˜â€œä¸»åŠ¨è½®è¯¢â€ä¸ºâ€œè¢«åŠ¨å“åº”â€</strong></p>
<ul>
<li><strong>ä¼ ç»Ÿæ–¹å¼ (Pull)</strong>ï¼šä½ ä¸åœåœ°é—®æœåŠ¡å™¨â€œå¥½äº†æ²¡ï¼Ÿå¥½äº†æ²¡ï¼Ÿâ€ï¼ˆè½®è¯¢ï¼‰ï¼Œæµªè´¹èµ„æºã€‚</li>
<li><strong>Stream æ–¹å¼ (Push)</strong>ï¼šä½ æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ <code>listen()</code>ï¼Œç„¶åå»å¹²åˆ«çš„äº‹ã€‚ä¸€æ—¦æœ‰æ•°æ®ï¼ŒStream ä¼š<strong>ä¸»åŠ¨</strong>æ¨ç»™ä½ ã€‚è¿™ä¹Ÿå°±æ˜¯ç°åœ¨æµè¡Œçš„ <strong>å“åº”å¼ç¼–ç¨‹ (Reactive Programming)</strong> çš„æ ¸å¿ƒæ€æƒ³ã€‚</li>
</ul>
<h3 data-id="heading-7">å°ç»“</h3>



































<table><thead><tr><th>ç‰¹æ€§</th><th>Future (æœªæ¥)</th><th>Stream (æµ)</th></tr></thead><tbody><tr><td><strong>æ•°æ®é‡</strong></td><td>å•ä¸ªå€¼ (Single)</td><td>å¤šä¸ªå€¼ (Multiple)</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸€æ¬¡æ€§ (One-shot)</td><td>æŒç»­çš„æ—¶é—´è½´ (Continuous)</td></tr><tr><td><strong>ç»“æŸåŠ¨ä½œ</strong></td><td>Return (é”€æ¯)</td><td>Stream Done (å…³é—­)</td></tr><tr><td><strong>æ ¸å¿ƒæœºåˆ¶</strong></td><td>æ ˆå¸§é”€æ¯</td><td><strong>æ ˆå¸§æš‚åœ (yield)</strong></td></tr><tr><td><strong>ç”Ÿæ´»ç±»æ¯”</strong></td><td>æ‹ä¸€å¼ ç…§ç‰‡</td><td>å½•ä¸€æ®µè§†é¢‘</td></tr></tbody></table>
<p>ç†è§£äº† Stream çš„<strong>ä¼ é€å¸¦æ¨¡å‹</strong>å’Œ <strong><code>yield</code> çš„æš‚åœæœºåˆ¶</strong>ï¼Œä½ å°±å·²ç»è¿ˆè¿‡äº†å¼‚æ­¥ç¼–ç¨‹æœ€éš¾çš„ä¸€é“åã€‚</p>
<p>ä½†æ˜¯ï¼Œç°åœ¨çš„ä¼ é€å¸¦è¿˜å¾ˆç®€é™‹ã€‚å¦‚æœæˆ‘æƒ³è®©å¤šä¸ªäººåŒæ—¶çœ‹ä¸€æ¡ä¼ é€å¸¦ï¼ˆå¤šè®¢é˜…ï¼‰ï¼Ÿæˆ–è€…æˆ‘æƒ³åœ¨ä¼ é€å¸¦ä¸­é—´åŠ ä¸€ä¸ªæ»¤ç½‘ï¼Œåªè¿‡æ»¤å‡ºæˆ‘æƒ³è¦çš„å¯¿å¸ï¼ˆæ“ä½œç¬¦ï¼‰ï¼Ÿ</p>
<p>ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Stream çš„ä¸¤ç§å½¢æ€ï¼š<strong>å•è®¢é˜… (Single-subscription)</strong> ä¸ <strong>å¹¿æ’­ (Broadcast)</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-8">ç¬¬äºŒç« ï¼šFlutter è¿›é˜¶â€”â€”Stream çš„ä¸¤ç§å½¢æ€ä¸æŒæ§æƒ</h2>
<p>åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>async*</code> å‡½æ•°è½»æ¾åˆ›å»ºäº†ä¸€æ¡ä¼ é€å¸¦ã€‚
ä½†æ˜¯ï¼Œå½“ä½ è¯•å›¾åœ¨ä»£ç ä¸­å¯¹åŒä¸€ä¸ª Stream è°ƒç”¨ä¸¤æ¬¡ <code>listen</code> æ—¶ï¼Œç¨‹åºä¼šæ¯«ä¸ç•™æƒ…åœ°æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š
<code>Bad state: Stream has already been listened to.</code></p>
<p>è¿™å¹¶ä¸æ˜¯ Bugï¼Œè¿™æ˜¯ Dart Stream è®¾è®¡å“²å­¦çš„æ ¸å¿ƒï¼š<strong>æ ¹æ®æ¶ˆè´¹åœºæ™¯çš„ä¸åŒï¼ŒStream åˆ†ä¸ºä¸¤ç§æˆªç„¶ä¸åŒçš„å½¢æ€ã€‚</strong></p>
<p>æœ¬ç« æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ <strong>å•è®¢é˜… (Single-subscription)</strong> ä¸ <strong>å¹¿æ’­ (Broadcast)</strong> çš„åŒºåˆ«ï¼Œå¹¶è§£é” Stream çš„æ‰‹åŠ¨æŒ¡æ¨¡å¼ â€”â€” <strong>StreamController</strong>ã€‚</p>
<h3 data-id="heading-9">ä¸€ã€ ç§å¯†å¯¹è¯ vs å…¬å…±å¹¿æ’­</h3>
<p>åœ¨å†…å­˜ä¸–ç•Œé‡Œï¼Œæ•°æ®çš„æµåŠ¨æ–¹å¼å†³å®šäº† Stream çš„ç±»å‹ã€‚</p>
<h4 data-id="heading-10">1. å•è®¢é˜… Stream (Single-subscription) â€”â€” â€œæˆ‘çš„æ±‰å ¡â€</h4>
<p>è¿™æ˜¯ Stream çš„<strong>é»˜è®¤å½¢æ€</strong>ã€‚å½“ä½ ä½¿ç”¨ <code>async*</code> æˆ–è€… <code>File.openRead()</code> åˆ›å»ºæµæ—¶ï¼Œå®ƒå°±æ˜¯å•è®¢é˜…çš„ã€‚</p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>ä¸€å¯¹ä¸€</strong>ã€‚è¿™æ¡ä¼ é€å¸¦æ˜¯ä¸ºä½ ä¸“é—¨é“ºè®¾çš„ã€‚</li>
<li><strong>å½¢è±¡æ¯”å–»</strong>ï¼š<strong>â€œåœ¨é¤å…ç‚¹é¤â€</strong>ã€‚
å¨å¸ˆä¸ºä½ åšäº†ä¸€ä»½ç‚’é¥­ã€‚è¿™ä»½ç‚’é¥­ï¼ˆæ•°æ®ï¼‰åªèƒ½è¢«ä½ ä¸€ä¸ªäººåƒï¼ˆæ¶ˆè´¹ï¼‰ã€‚å¦‚æœä½ çš„æœ‹å‹ä¹Ÿæƒ³åƒï¼Œä»–å¿…é¡»é‡æ–°ä¸‹ä¸€å•ï¼ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ Stream ï¼‰ï¼Œå¨å¸ˆä¼šé‡æ–°åšä¸€ä»½ã€‚</li>
<li><strong>åº•å±‚é€»è¾‘</strong>ï¼š
æ•°æ®æ˜¯ä¸ºäº†ä¿è¯<strong>å®Œæ•´æ€§</strong>å’Œ<strong>é¡ºåºæ€§</strong>ã€‚æ¯”å¦‚è¯»å–æ–‡ä»¶ï¼Œä½ ç»ä¸å¸Œæœ›ä¸¤ä¸ªäººåœ¨åŒæ—¶è¯»ä¸€ä¸ªæ–‡ä»¶æµï¼Œå¯¼è‡´ä½ è¯»ä¸€åŠï¼Œä»–è¯»ä¸€åŠï¼Œæ•°æ®å…¨ä¹±å¥—äº†ã€‚</li>
<li><strong>è‡´å‘½é™åˆ¶</strong>ï¼š<strong>åªèƒ½ç›‘å¬ä¸€æ¬¡ï¼</strong> å³ä½¿ç¬¬ä¸€ä¸ªç›‘å¬è€…å–æ¶ˆäº†è®¢é˜… (cancel)ï¼Œè¿™æ¡ Stream ä¹ŸåºŸäº†ï¼Œä¸èƒ½å†è¢«ç›‘å¬ã€‚</li>
</ul>
<h4 data-id="heading-11">2. å¹¿æ’­ Stream (Broadcast) â€”â€” â€œæ‘å£å¤§å–‡å­â€</h4>
<p>è¿™æ˜¯ Stream çš„å¦ä¸€ç§å½¢æ€ã€‚é€šå¸¸ç”¨äºäº‹ä»¶æ€»çº¿ã€é¼ æ ‡ç‚¹å‡»ã€ç³»ç»Ÿé€šçŸ¥ç­‰åœºæ™¯ã€‚</p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>ä¸€å¯¹å¤š</strong>ã€‚</li>
<li><strong>å½¢è±¡æ¯”å–»</strong>ï¼š<strong>â€œå¬æ”¶éŸ³æœºâ€</strong>ã€‚
ç”µå°ï¼ˆæ•°æ®æºï¼‰åœ¨ä¸åœåœ°æ’­æ”¾ã€‚ä½ å¬ï¼Œæˆ–è€…éš”å£è€ç‹å¬ï¼Œç”šè‡³ä¸€ç™¾ä¸ªäººåŒæ—¶å¬ï¼Œäº’ä¸å½±å“ã€‚</li>
<li><strong>å…³é”®å·®å¼‚</strong>ï¼š</li>
<li><strong>è¿‡æ—¶ä¸å€™</strong>ï¼šå¹¿æ’­æµé€šå¸¸æ˜¯ <strong>"Hot" (çƒ­)</strong> çš„ã€‚å¦‚æœä½  10:00 æ‰“å¼€æ”¶éŸ³æœºï¼Œä½ å¬ä¸åˆ° 9:50 æ’­æ”¾çš„æ–°é—»ã€‚æ•°æ®å‘å‡ºå»æ²¡äººå¬ï¼Œå°±ç›´æ¥ä¸¢å¼ƒäº†ã€‚</li>
<li><strong>éšæ—¶ç›‘å¬</strong>ï¼šä½ å¯ä»¥éšæ—¶åŠ å…¥ï¼Œä¹Ÿå¯ä»¥éšæ—¶é€€å‡ºï¼Œæ”¯æŒå¤šä¸ªç›‘å¬è€…åŒæ—¶å­˜åœ¨ã€‚</li>
</ul>
<h4 data-id="heading-12">3. ä»£ç å®æˆ˜ï¼šå¦‚ä½•è½¬æ¢ï¼Ÿ</h4>
<p>å¦‚æœæˆ‘éè¦è®©é‚£ç›˜â€œç‚’é¥­â€å¤§å®¶ä¸€èµ·åƒæ€ä¹ˆåŠï¼ŸDart æä¾›äº† <code>asBroadcastStream()</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªæ™®é€šçš„å•è®¢é˜…æµ</span>
Stream&lt;<span class="hljs-built_in">int</span>&gt; stream = getScoreStream();

<span class="hljs-comment">// 2. å¼ºè¡Œå˜æˆå¹¿æ’­æµ</span>
Stream&lt;<span class="hljs-built_in">int</span>&gt; broadcastStream = stream.asBroadcastStream();

<span class="hljs-comment">// 3. ç°åœ¨å¯ä»¥å¤šæ¬¡ç›‘å¬äº†</span>
broadcastStream.listen((v) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"è€ç‹å¬åˆ°äº†: <span class="hljs-subst">$v</span>"</span>));
broadcastStream.listen((v) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"å°æå¬åˆ°äº†: <span class="hljs-subst">$v</span>"</span>));

</code></pre>
<hr/>
<h3 data-id="heading-13">äºŒã€ æ‰‹åŠ¨æŒ¡ï¼šStreamController</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ <code>async*</code> å‡½æ•°æ¥**â€œè‡ªåŠ¨â€**ç”Ÿæˆ Streamã€‚è¿™ç§æ–¹å¼å¾ˆç®€å•ï¼Œä½†å®ƒæ˜¯è¢«åŠ¨çš„â€”â€”å¿…é¡»ç­‰åˆ°å‡½æ•°é‡Œçš„ <code>yield</code> æ‰§è¡Œæ—¶æ‰æœ‰æ•°æ®ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»äº‹ä»¶é‡Œå‘é€æ•°æ®ï¼Ÿæˆ–è€…åœ¨ç½‘ç»œè¯·æ±‚å›è°ƒé‡Œå‘é€æ•°æ®ï¼Ÿ
è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ <strong>StreamController (æµæ§åˆ¶å™¨)</strong>ã€‚</p>
<p>å¦‚æœè¯´ <code>async*</code> æ˜¯è®¾å®šå¥½ç¨‹åºçš„<strong>è‡ªåŠ¨æµæ°´çº¿</strong>ï¼Œé‚£ <code>StreamController</code> å°±æ˜¯ä¸€ä¸ª<strong>ä¸‡èƒ½é¥æ§å™¨</strong>ã€‚</p>
<h4 data-id="heading-14">1. ç»“æ„è§£å‰–</h4>
<p><code>StreamController</code> æŠŠ Stream çš„ç»“æ„æ‹†è§£å¾—æ¸…æ¸…æ¥šæ¥šï¼š</p>
<ul>
<li><strong>å…¥å£ (Sink)</strong>ï¼šä½ å¯ä»¥éšæ—¶éšåœ°è°ƒç”¨ <code>sink.add(data)</code> å¾€é‡Œé¢æ‰”æ•°æ®ã€‚</li>
<li><strong>å‡ºå£ (Stream)</strong>ï¼šå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„é‚£ä¸ª Streamï¼Œç»™åˆ«äººå» <code>listen</code> çš„ã€‚</li>
<li><strong>æ§åˆ¶å™¨ (Controller)</strong>ï¼šç®¡ç†å¼€å…³ã€æš‚åœã€ä»¥åŠæµçš„çŠ¶æ€ã€‚</li>
</ul>
<h4 data-id="heading-15">2. æç®€ä»£ç ç¤ºèŒƒ</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 1. åˆ›å»ºæ§åˆ¶å™¨ (ä¹°äº†ä¸€ä¸ªé¥æ§å™¨)</span>
  <span class="hljs-comment">// å¦‚æœæƒ³åšå¹¿æ’­æµï¼Œå°±ç”¨ StreamController.broadcast();</span>
  <span class="hljs-keyword">final</span> controller = StreamController&lt;<span class="hljs-built_in">String</span>&gt;();

  <span class="hljs-comment">// 2. æ‹¿åˆ°å‡ºå£ (ç»™åˆ«äººå¬çš„)</span>
  controller.stream.listen(
    (data) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ”¶åˆ°æ¨æµ: <span class="hljs-subst">$data</span>"</span>),
    onError: (err) =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‘ç”Ÿé”™è¯¯: <span class="hljs-subst">$err</span>"</span>),
    onDone: () =&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç›´æ’­ç»“æŸ"</span>),
  );

  <span class="hljs-comment">// 3. æ‹¿åˆ°å…¥å£ (è‡ªå·±åœ¨ä»»æ„åœ°æ–¹æ§åˆ¶)</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">"å‡†å¤‡å‘å°„æ•°æ®..."</span>);
  controller.sink.add(<span class="hljs-string">"ç¬¬ä¸€æ¡æ¶ˆæ¯"</span>); <span class="hljs-comment">// åƒä¸åƒ EventBusï¼Ÿ</span>
  controller.sink.add(<span class="hljs-string">"ç¬¬äºŒæ¡æ¶ˆæ¯"</span>);
  
  <span class="hljs-comment">// 4. æ¨¡æ‹Ÿå‘ç”Ÿé”™è¯¯</span>
  controller.addError(<span class="hljs-string">"ä¿¡å·ä¸¢å¤±ï¼"</span>);

  <span class="hljs-comment">// 5. å…³æµ (éå¸¸é‡è¦ï¼ï¼ï¼)</span>
  <span class="hljs-comment">// ä¸å…³æµä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºç›‘å¬è€…ä¼šä¸€ç›´å¹²ç­‰ç€</span>
  controller.close();
}

</code></pre>
<h4 data-id="heading-16">3. ä¸ºä»€ä¹ˆå®ƒåœ¨ Flutter ä¸­å¦‚æ­¤é‡è¦ï¼Ÿ</h4>
<p>å‡ ä¹æ‰€æœ‰ Flutter çš„çŠ¶æ€ç®¡ç†åº“ï¼ˆBLoC, Provider, Riverpod ç­‰ï¼‰çš„åº•å±‚ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ç”¨åˆ°äº† <code>StreamController</code> çš„æ€æƒ³ã€‚</p>
<ul>
<li><strong>UI å±‚</strong>ï¼šåªç®¡ <code>add</code> äº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»æŒ‰é’®ï¼‰ã€‚</li>
<li><strong>é€»è¾‘å±‚</strong>ï¼šé€šè¿‡ <code>Controller</code> å¤„ç†ä¸šåŠ¡ã€‚</li>
<li><strong>UI å±‚</strong>ï¼š<code>StreamBuilder</code> ç›‘å¬ <code>Controller.stream</code> å¹¶åˆ·æ–°ç•Œé¢ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯ <strong>â€œè¾“å…¥ä¸è¾“å‡ºåˆ†ç¦»â€</strong> çš„æ¶æ„é›å½¢ã€‚</p>
<hr/>
<h3 data-id="heading-17">ä¸‰ã€ é¿å‘æŒ‡å—ï¼šå†…å­˜æ³„æ¼çš„éšæ‚£</h3>
<p>åœ¨ä½¿ç”¨ <code>StreamController</code> æ—¶ï¼Œæœ‰ä¸€ä¸ªæ–°æ‰‹æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ï¼š<strong>å¿˜äº†å…³æµ (Close)</strong>ã€‚</p>
<ul>
<li><strong>åŸç†</strong>ï¼š<code>StreamController</code> åœ¨åº•å±‚ä¼šæŒæœ‰ç›‘å¬è€…çš„å¼•ç”¨ã€‚å¦‚æœä½ çš„é¡µé¢é”€æ¯äº†ï¼Œä½† Controller æ²¡å…³é—­ï¼Œè¿™ä¸ª Stream ä¾ç„¶è®¤ä¸ºâ€œæœ‰äººåœ¨å¬â€ï¼Œå®ƒä¸ä¼šé‡Šæ”¾èµ„æºï¼Œå¯¼è‡´ <strong>å†…å­˜æ³„æ¼ (Memory Leak)</strong>ã€‚</li>
<li><strong>é“å¾‹</strong>ï¼šåœ¨ Flutter çš„ <code>dispose()</code> æ–¹æ³•ä¸­ï¼Œä¸€å®šè¦è°ƒç”¨ <code>controller.close()</code>ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-18">å°ç»“</h3>
<p>è¿™ä¸€ç« æˆ‘ä»¬å®Œæˆäº†ä»â€œä½¿ç”¨è€…â€åˆ°â€œæŒæ§è€…â€çš„è½¬å˜ï¼š</p>
<ol>
<li><strong>åˆ†æ¸…å½¢æ€</strong>ï¼š</li>
</ol>
<ul>
<li><strong>å•è®¢é˜…</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šæ•°æ®å®Œæ•´ï¼Œä¸€å¯¹ä¸€ï¼Œé”™è¿‡å³æ¯ã€‚</li>
<li><strong>å¹¿æ’­</strong>ï¼ˆBroadcastï¼‰ï¼šå®æ—¶æ€§å¼ºï¼Œä¸€å¯¹å¤šï¼Œè¿‡æ—¶ä¸å€™ã€‚</li>
</ul>
<ol>
<li><strong>æŒæ¡æ§åˆ¶</strong>ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨ <strong><code>StreamController</code></strong> å¯ä»¥è®©æˆ‘ä»¬åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä¸»åŠ¨åœ°â€œæ¨â€æ•°æ®ï¼Œå®ƒæ˜¯è¿æ¥å‘½ä»¤å¼ä»£ç ï¼ˆæ™®é€šå‡½æ•°ï¼‰å’Œå“åº”å¼ä»£ç ï¼ˆStreamï¼‰çš„æ¡¥æ¢ã€‚</li>
</ul>
<p>äº†è§£äº†å½¢æ€å’Œæ§åˆ¶ï¼Œä¸‹ä¸€ç« æˆ‘ä»¬å°†è¿›å…¥ Stream æœ€å¼ºå¤§çš„é¢†åŸŸ â€”â€” <strong>æ•°å­¦èˆ¬çš„é­”æ³•</strong>ã€‚
æˆ‘ä»¬å°†æ¢ç´¢å¦‚ä½•åƒæ“ä½œæ•°ç»„ä¸€æ ·æ“ä½œæ—¶é—´æµï¼š<code>map</code>ã€<code>where</code>ã€<code>debounce</code>ï¼ˆé˜²æŠ–ï¼‰ä»¥åŠ <code>distinct</code>ã€‚è¿™äº›æ“ä½œç¬¦å°†å½»åº•æ”¹å˜ä½ å†™ä¸šåŠ¡é€»è¾‘çš„æ–¹å¼ã€‚</p>
<h2 data-id="heading-19">ç¬¬ä¸‰ç« ï¼šæµä¸Šå»ºé€ æµæ°´çº¿</h2>
<p>åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬å­¦ä¼šäº†ç”¨ <code>StreamController</code> åˆ¶é€ ä¼ é€å¸¦ã€‚ä½†åœ¨çœŸå®å¼€å‘ä¸­ï¼ŒåŸå§‹æ•°æ®å¾€å¾€æ˜¯â€œè„â€çš„æˆ–è€…â€œä¸ç¬¦åˆ UI èƒƒå£â€çš„ã€‚</p>
<ul>
<li><strong>åç«¯</strong>ï¼šæ¨ç»™ä½ ä¸€å † JSON å­—ç¬¦ä¸²ã€‚</li>
<li><strong>UIå±‚</strong>ï¼šæƒ³è¦çš„æ˜¯ä¸€ä¸ªè½¬æ¢å¥½çš„ <code>User</code> å¯¹è±¡ã€‚</li>
<li><strong>ç”¨æˆ·</strong>ï¼šæ‰‹æŠ–ï¼Œä¸€ç§’é’Ÿç‚¹äº† 5 æ¬¡æŒ‰é’®ã€‚</li>
<li><strong>é€»è¾‘å±‚</strong>ï¼šåªå¸Œæœ›å¤„ç†æœ€åä¸€æ¬¡ç‚¹å‡»ã€‚</li>
</ul>
<p>å¦‚æœæŠŠè¿™äº›é€»è¾‘éƒ½å†™åœ¨ <code>listen</code> çš„å›è°ƒé‡Œï¼Œä»£ç ä¼šå˜æˆä¸€å¨ä¹±éº»ã€‚
Dart Stream èµ‹äºˆäº†æˆ‘ä»¬ä¸€ç§èƒ½åŠ›ï¼š<strong>åœ¨æ•°æ®åˆ°è¾¾ç›‘å¬è€…ä¹‹å‰ï¼Œå…ˆåœ¨ä¼ é€å¸¦ä¸Šæ¶è®¾ä¸€æ’â€œæœºå™¨æ‰‹è‡‚â€ï¼Œå¯¹æ•°æ®è¿›è¡Œå…¨è‡ªåŠ¨åŠ å·¥ã€‚</strong></p>
<p>è¿™å°±æ˜¯ <strong>æ“ä½œç¬¦ (Operators)</strong>ã€‚</p>
<h3 data-id="heading-20">ä¸€ã€ ç†Ÿæ‚‰çš„é…æ–¹ï¼šä» List åˆ° Stream</h3>
<p>Dart æœ€ä¼˜é›…çš„è®¾è®¡ä¹‹ä¸€ï¼Œå°±æ˜¯å®ƒè®©æ“ä½œ Stream (æ—¶é—´æµ) å°±åƒæ“ä½œ List (é™æ€æ•°ç»„) ä¸€æ ·ç®€å•ã€‚</p>
<p>å¦‚æœä½ ä¼šç”¨ <code>List</code> çš„æ–¹æ³•ï¼Œä½ å·²ç»å­¦ä¼šäº† 90% çš„ Stream æ“ä½œã€‚</p>
<h4 data-id="heading-21">1. è¿‡æ»¤ä¸è½¬æ¢ (Where &amp; Map)</h4>
<p>æƒ³è±¡ä¼ é€å¸¦ä¸Šæµè¿‡æ¥çš„æ˜¯ä¸€å †æ•°å­— <code>1, 2, 3, 4, 5...</code>ã€‚</p>
<ul>
<li><strong>éœ€æ±‚</strong>ï¼šæˆ‘åªæƒ³è¦å¶æ•°ï¼Œè€Œä¸”è¦æŠŠå®ƒæ”¾å¤§ 10 å€ã€‚</li>
</ul>
<pre><code class="hljs language-dart" lang="dart">Stream&lt;<span class="hljs-built_in">int</span>&gt; rawStream = Stream.fromIterable([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]);

rawStream
    .where((event) =&gt; event % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-comment">// æœºå™¨æ‰‹è‡‚1ï¼šè¿‡æ»¤ã€‚åªæ”¾è¡Œå¶æ•°ã€‚</span>
    .map((event) =&gt; event * <span class="hljs-number">10</span>)       <span class="hljs-comment">// æœºå™¨æ‰‹è‡‚2ï¼šåŠ å·¥ã€‚å˜æˆåŸæ¥çš„10å€ã€‚</span>
    .listen((data) {
      <span class="hljs-built_in">print</span>(data); <span class="hljs-comment">// è¾“å‡ºï¼š20, 40</span>
    });

</code></pre>
<p><strong>åº•å±‚åŸç†</strong>ï¼š
æ¯ä¸ªæ“ä½œç¬¦ï¼ˆ<code>.where</code>, <code>.map</code>ï¼‰æœ¬è´¨ä¸Šéƒ½è¿”å›äº†ä¸€ä¸ª<strong>æ–°çš„ Stream</strong>ã€‚
è¿™å°±åƒæ¥æ°´ç®¡ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠä¸€èŠ‚èŠ‚çŸ­ç®¡å­ï¼ˆæ“ä½œç¬¦ï¼‰æ‹§åœ¨ä¸€èµ·ï¼Œæ„æˆäº†ä¸€æ¡é•¿é•¿çš„å¤„ç†ç®¡é“ã€‚åŸå§‹æ•°æ®ä»ä¸€å¤´è¿›ï¼Œç»è¿‡å±‚å±‚å‡€åŒ–ï¼Œæœ€åæµå‡ºæ¥çš„å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„çº¯å‡€æ°´ã€‚</p>
<h3 data-id="heading-22">äºŒã€ è§£å†³ç°å®ç—›ç‚¹ï¼šé‚£äº› Stream ç‹¬æœ‰çš„ç¥æŠ€</h3>
<p>é™¤äº†é€šç”¨çš„ <code>map/where</code>ï¼ŒStream è¿˜æœ‰ä¸€äº›ä¸“é—¨å¤„ç†â€œæ—¶é—´è½´â€é—®é¢˜çš„ç¥æŠ€ã€‚</p>
<h4 data-id="heading-23">1. å»é‡ç¥æŠ€ï¼š<code>distinct</code></h4>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šä½ è¦å®ç°ä¸€ä¸ªæœç´¢æ¡†ã€‚ç”¨æˆ·æƒ³æœ "Flutter"ï¼Œä½†ä»–è¾“å…¥ "F", "Fl", "Flu"...</li>
<li><strong>ç—›ç‚¹</strong>ï¼šå¦‚æœç”¨æˆ·è¾“å…¥äº† "Flu"ï¼Œåœäº†ä¸€ä¸‹ï¼Œåˆ æ‰ "u"ï¼Œåˆè¾“äº†ä¸€æ¬¡ "u"ã€‚è¾“å…¥å†…å®¹è¿˜æ˜¯ "Flu"ã€‚å¦‚æœä¸å¤„ç†ï¼Œä½ ä¼šå‘ä¸¤æ¬¡å®Œå…¨ä¸€æ ·çš„ç½‘ç»œè¯·æ±‚ã€‚</li>
<li><strong>è§£æ³•</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-dart" lang="dart">inputStream
    .distinct() <span class="hljs-comment">// åªæœ‰å½“æ–°æ•°æ®å’Œä¸Šä¸€æ¬¡æ•°æ®ä¸ä¸€æ ·æ—¶ï¼Œæ‰æ”¾è¡Œ</span>
    .listen((text) =&gt; search(text));

</code></pre>
<p>å®ƒå°±åƒä¸€ä¸ªæå…¶ä¸¥æ ¼çš„è´¨æ£€å‘˜ï¼Œæ‹¿ç€ä¸Šä¸€ä¸ªé€šè¿‡çš„äº§å“åšå¯¹æ¯”ï¼Œä¸€æ ·çš„ç›´æ¥æ‰”æ‰ã€‚</p>
<h4 data-id="heading-24">2. æ‰å¹³åŒ–ç¥æŠ€ï¼š<code>expand</code> ä¸ <code>asyncExpand</code></h4>
<p>è¿™æ˜¯ä¸€ä¸ªé«˜çº§ä½†å¿…ç”¨çš„æ“ä½œç¬¦ã€‚</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šStream é‡Œæµè¿‡æ¥çš„æ˜¯â€œæ–‡ä»¶å¤¹â€ï¼Œä½†ç›‘å¬è€…æƒ³è¦çš„æ˜¯â€œæ–‡ä»¶â€ã€‚
å³ï¼šStream å‘å‡ºçš„æ¯ä¸ªæ•°æ®ï¼Œæœ¬èº«åˆåŒ…å«äº†ä¸€ç»„æ•°æ®ï¼ˆStream of Listï¼‰ã€‚</li>
<li><strong>è§£æ³•</strong>ï¼š<code>expand</code> ä¼šæŠŠâ€œæµè¿‡æ¥çš„æ¯ä¸€ä¸ªå…ƒç´ â€ç‚¸å¼€ï¼Œå˜æˆä¸€å †å…ƒç´ ï¼Œç„¶åé‡æ–°é“ºå¹³åœ¨ä¼ é€å¸¦ä¸Šã€‚</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å‡è®¾æµè¿‡æ¥çš„æ˜¯ï¼š[1, 2], [3, 4]</span>
stream
  .expand((element) =&gt; element) 
  .listen(<span class="hljs-built_in">print</span>); 
<span class="hljs-comment">// è¾“å‡ºï¼š1, 2, 3, 4 (å˜æˆäº†æ‰å¹³çš„æµ)</span>

</code></pre>
<h3 data-id="heading-25">ä¸‰ã€ ç»ˆææ­¦å™¨ï¼šStreamTransformer</h3>
<p>æœ‰æ—¶å€™ï¼Œå®˜æ–¹æä¾›çš„ <code>map</code>ã€<code>where</code> ä¸å¤Ÿç”¨äº†ã€‚
æ¯”å¦‚ï¼ŒSocket è¿æ¥å‘è¿‡æ¥çš„æ˜¯<strong>å­—èŠ‚æµ (List&lt;int&gt;)</strong>ï¼Œä½†ä½ æƒ³æŒ‰**â€œæ¢è¡Œç¬¦â€<strong>åˆ‡åˆ†æˆä¸€è¡Œè¡Œçš„</strong>æ–‡æœ¬æµ (String)**ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œä½ éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªâ€œå˜å‹å™¨â€ â€”â€” <strong>StreamTransformer</strong>ã€‚</p>
<p>å®ƒæ˜¯ <code>stream.transform()</code> æ–¹æ³•çš„å‚æ•°ã€‚Dart å®˜æ–¹è´´å¿ƒåœ°åœ¨ <code>dart:convert</code> åº“é‡Œå†…ç½®äº†ä¸€äº›æœ€å¸¸ç”¨çš„å˜å‹å™¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:convert'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;

<span class="hljs-keyword">void</span> readFile() {
  File(<span class="hljs-string">'log.txt'</span>)
    .openRead() <span class="hljs-comment">// åŸå§‹æµï¼šä¸€å †äºŒè¿›åˆ¶å­—èŠ‚</span>
    .transform(utf8.decoder) <span class="hljs-comment">// å˜å‹å™¨1ï¼šå­—èŠ‚ -&gt; å­—ç¬¦ä¸²</span>
    .transform(<span class="hljs-keyword">const</span> LineSplitter()) <span class="hljs-comment">// å˜å‹å™¨2ï¼šä¸€æ•´å—å­—ç¬¦ä¸² -&gt; æŒ‰æ¢è¡Œç¬¦åˆ‡å¼€çš„ä¸€è¡Œè¡Œå­—ç¬¦ä¸²</span>
    .listen((line) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">"è¯»å–åˆ°ä¸€è¡Œæ—¥å¿—: <span class="hljs-subst">$line</span>"</span>);
    });
}

</code></pre>
<p><strong>åº•å±‚é€»è¾‘</strong>ï¼š
<code>transform</code> æ˜¯å°†æµçš„æ§åˆ¶æƒå®Œå…¨äº¤ç»™ä½ ã€‚ä½ å¯ä»¥æ§åˆ¶è¾“å…¥ä»€ä¹ˆï¼Œç¼“å­˜å¤šå°‘ï¼Œä»€ä¹ˆæ—¶å€™è¾“å‡ºï¼Œç”šè‡³å¯ä»¥æŠŠä¸€ä¸ªæ•°æ®å˜æˆä¸¤ä¸ªï¼Œæˆ–è€…æŠŠä¸¤ä¸ªæ•°æ®åˆå¹¶æˆä¸€ä¸ªã€‚</p>
<h3 data-id="heading-26">å››ã€ é™ç»´æ‰“å‡»ï¼šRxDart çš„é˜²æŠ–ä¸èŠ‚æµ</h3>
<p>è®²åˆ° Stream æ“ä½œç¬¦ï¼Œå¦‚æœä¸æ <strong>RxDart</strong>ï¼Œé‚£å°±æ˜¯è€æµæ°“ã€‚
è™½ç„¶ Dart åŸç”Ÿåº“å¾ˆå¼ºï¼Œä½†åœ¨å¤„ç†å¤æ‚çš„äº¤äº’äº‹ä»¶æ—¶ï¼ŒRxDart æä¾›äº†â€œå¤–æŒ‚â€çº§åˆ«çš„æ“ä½œç¬¦ã€‚</p>
<p>Flutter é¢è¯•å¿…é—®çš„ä¸¤å¤§æ€æ‰‹é”ï¼š</p>
<ol>
<li><strong>é˜²æŠ– (Debounce)</strong>ï¼š</li>
</ol>
<ul>
<li><strong>æ¯”å–»</strong>ï¼šç”µæ¢¯å…³é—¨ã€‚å¦‚æœä¸€ç›´æœ‰äººè¿›ç”µæ¢¯ï¼ˆäº‹ä»¶ä¸€ç›´æ¥ï¼‰ï¼Œç”µæ¢¯é—¨å°±ä¸€ç›´ä¸å…³ã€‚åªæœ‰å½“å¤§å®¶éƒ½ä¸åŠ¨äº†ï¼ˆé—´éš”è¶…è¿‡ä¸€å®šæ—¶é—´ï¼‰ï¼Œç”µæ¢¯é—¨æ‰ä¼šå…³ä¸Šï¼ˆæ‰§è¡Œé€»è¾‘ï¼‰ã€‚</li>
<li><strong>ç”¨é€”</strong>ï¼šæœç´¢æ¡†è”æƒ³ã€‚æ‰“å­—åœé¡¿ 500ms åå†è¯·æ±‚ APIã€‚</li>
</ul>
<ol>
<li><strong>èŠ‚æµ (Throttle)</strong>ï¼š</li>
</ol>
<ul>
<li><strong>æ¯”å–»</strong>ï¼šæœºå…³æªå°„é€Ÿé™åˆ¶ã€‚ä¸ç®¡ä½ æ‰£æ‰³æœºçš„æ‰‹é€Ÿæœ‰å¤šå¿«ï¼Œå­å¼¹æœ€å¿«åªèƒ½æ¯ç§’å‘ 10 å‘ã€‚</li>
<li><strong>ç”¨é€”</strong>ï¼šé˜²æ­¢æŒ‰é’®è¿ç‚¹ã€‚</li>
</ul>
<p><em>(æ³¨ï¼šRxDart æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ StreamTransformer å°è£…å¥½äº†ç»™ä½ ç”¨ã€‚)</em></p>
<h3 data-id="heading-27">å°ç»“</h3>
<p>è¿™ä¸€ç« æˆ‘ä»¬æŠŠ Stream ä»â€œä¼ è¾“å·¥å…·â€å‡çº§æˆäº†â€œå¤„ç†å·¥å…·â€ã€‚</p>
<ol>
<li><strong>ç®¡é“æ€ç»´</strong>ï¼šç”¨ <code>map</code>ã€<code>where</code> åƒæ­ç§¯æœ¨ä¸€æ ·å¤„ç†æ•°æ®ã€‚</li>
<li><strong>ç‹¬æœ‰æŠ€èƒ½</strong>ï¼šç”¨ <code>distinct</code> è¿‡æ»¤é‡å¤ä¿¡å·ã€‚</li>
<li><strong>é«˜çº§å®šåˆ¶</strong>ï¼šç”¨ <code>transform</code> å¤„ç†å¤æ‚çš„æ•°æ®è½¬æ¢ï¼ˆå¦‚äºŒè¿›åˆ¶è½¬æ–‡æœ¬ï¼‰ã€‚</li>
</ol>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†æ•°æ®æºï¼ˆControllerï¼‰ï¼Œæœ‰äº†å¤„ç†é€»è¾‘ï¼ˆOperatorsï¼‰ï¼Œæœ‰äº†ç›‘å¬è€…ï¼ˆListenï¼‰ã€‚
<strong>ä½†æ˜¯ï¼Œåœ¨ Flutter çš„ UI ä»£ç é‡Œå†™ <code>listen</code> å’Œ <code>setState</code> ä¾ç„¶å¾ˆç—›è‹¦ï¼Œå¾ˆå®¹æ˜“å¿˜æ‰ <code>cancel</code> å¯¼è‡´å†…å­˜æ³„æ¼ã€‚</strong></p>
<p>æœ‰æ²¡æœ‰ä¸€ç§ Widgetï¼Œèƒ½ç›´æ¥æŠŠ Stream æ’ä¸Šå»ï¼Œå®ƒè‡ªå·±å°±ä¼šæ ¹æ®æ•°æ®å˜æ¥å˜å»ï¼Œè¿˜è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Ÿ</p>
<p>ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ä»‹ç» Flutter å®˜æ–¹æä¾›çš„ç»ˆæç»„ä»¶ â€”â€” <strong>StreamBuilder</strong>ï¼Œå®ƒæ˜¯è¿æ¥é€»è¾‘å±‚ä¸ UI å±‚çš„è·¨æµ·å¤§æ¡¥ã€‚</p>
<hr/>
<h2 data-id="heading-28">ç¬¬å››ç« ï¼šFlutter å®æˆ˜â€”â€”å‘Šåˆ« setStateï¼Œæ‹¥æŠ± StreamBuilder</h2>
<p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨çº¯ Dart ç¯å¢ƒä¸‹æŠŠ Stream ç©å‡ºäº†èŠ±ã€‚ä½†å½“æˆ‘ä»¬å›åˆ° Flutter çš„ Widget ä¸–ç•Œæ—¶ï¼Œä¼šé‡åˆ°ä¸€ä¸ªå°´å°¬çš„ç°å®ã€‚</p>
<p><strong>ç—›ç‚¹ï¼šæ‰‹åŠ¨ç®¡ç†çš„â€œåœ°ç‹±â€</strong></p>
<p>å¦‚æœä½ ä¸ç”¨ä¸“é—¨çš„å·¥å…·ï¼Œæƒ³åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ª Stream çš„æ•°æ®ï¼Œä½ éœ€è¦å†™å¤§é‡çš„æ¨¡ç‰ˆä»£ç ï¼š</p>
<ol>
<li>å¿…é¡»ç”¨ <code>StatefulWidget</code>ã€‚</li>
<li>åœ¨ <code>initState</code> é‡Œæ‰‹åŠ¨ <code>listen</code>ã€‚</li>
<li>åœ¨å›è°ƒé‡Œæ‰‹åŠ¨ <code>setState</code> è§¦å‘åˆ·æ–°ã€‚</li>
<li><strong>æœ€è¦å‘½çš„</strong>ï¼šå¿…é¡»åœ¨ <code>dispose</code> é‡Œæ‰‹åŠ¨ <code>subscription.cancel()</code>ã€‚å“ªæ€•å¿˜å†™ä¸€æ¬¡ï¼Œä½ çš„ App å°±ä¼šåœ¨åå°é»˜é»˜å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç›´åˆ°å´©æºƒã€‚</li>
</ol>
<p>ä¸ºäº†æŠŠå¼€å‘è€…ä»è¿™ç§é‡å¤åŠ³åŠ¨ä¸­è§£æ•‘å‡ºæ¥ï¼ŒFlutter æä¾›äº†ä¸€ä¸ªç»ˆæç»„ä»¶ â€”â€” <strong>StreamBuilder</strong>ã€‚</p>
<h3 data-id="heading-29">ä¸€ã€ ä»€ä¹ˆæ˜¯ StreamBuilderï¼Ÿ</h3>
<p><code>StreamBuilder</code> æ˜¯ä¸€ä¸ª Widgetï¼Œä½†å®ƒä¸ç”»ä»»ä½•ä¸œè¥¿ã€‚å®ƒçš„å”¯ä¸€å·¥ä½œå°±æ˜¯ <strong>â€œè‡ªåŠ¨å¸®ä½ çœ‹ä¼ é€å¸¦â€</strong>ã€‚</p>
<ul>
<li><strong>è‡ªåŠ¨åŒ–</strong>ï¼šå®ƒè´Ÿè´£ <code>listen</code>ï¼Œå®ƒè´Ÿè´£ <code>setState</code>ï¼Œå®ƒè´Ÿè´£ <code>dispose</code>ã€‚ä½ å®Œå…¨ä¸ç”¨ç®¡ã€‚</li>
<li><strong>å“åº”å¼</strong>ï¼šä¼ é€å¸¦ä¸Šæ¯è¿‡æ¥ä¸€ä¸ªæ–°æ•°æ®ï¼Œå®ƒå°±è‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ <code>builder</code> æ–¹æ³•ï¼Œé‡æ–°ç”»ä¸€éå­ç»„ä»¶ã€‚</li>
</ul>
<h3 data-id="heading-30">äºŒã€ ä»£ç å®æˆ˜ï¼šä¸€ä¸ªæœ€ç®€å•çš„ç”µå­è¡¨</h3>
<p>æˆ‘ä»¬æ¥åšä¸€ä¸ªæ¯ç§’æ›´æ–°æ—¶é—´çš„ç”µå­è¡¨ã€‚</p>
<p><strong>1. å‡†å¤‡ Streamï¼ˆæ•°æ®æºï¼‰</strong></p>
<pre><code class="hljs language-dart" lang="dart">Stream&lt;<span class="hljs-built_in">String</span>&gt; getTimerStream() <span class="hljs-keyword">async</span>* {
  <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>));
    <span class="hljs-keyword">yield</span> <span class="hljs-built_in">DateTime</span>.now().toString().substring(<span class="hljs-number">11</span>, <span class="hljs-number">19</span>); <span class="hljs-comment">// è¿”å› "12:00:01"</span>
  }
}

</code></pre>
<p><strong>2. ä½¿ç”¨ StreamBuilderï¼ˆUI æ„å»ºï¼‰</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClock</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{ <span class="hljs-comment">// æ³¨æ„ï¼šå¯ä»¥ç”¨ StatelessWidget äº†ï¼</span>
  <span class="hljs-keyword">final</span> Stream&lt;<span class="hljs-built_in">String</span>&gt; _timerStream = getTimerStream();

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      body: Center(
        child: StreamBuilder&lt;<span class="hljs-built_in">String</span>&gt;(
          stream: _timerStream, <span class="hljs-comment">// 1. æ’ä¸Šç½‘çº¿</span>
          builder: (context, snapshot) { <span class="hljs-comment">// 2. æ ¹æ®å¿«ç…§ç”»å›¾</span>
            <span class="hljs-comment">// snapshot åŒ…å«äº†å½“å‰æ—¶åˆ» Stream çš„æ‰€æœ‰ä¿¡æ¯</span>
            <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.waiting) {
              <span class="hljs-keyword">return</span> CircularProgressIndicator(); <span class="hljs-comment">// è¿˜æ²¡æ•°æ®æ—¶æ˜¾ç¤ºè½¬åœˆ</span>
            }
            
            <span class="hljs-keyword">if</span> (snapshot.hasError) {
              <span class="hljs-keyword">return</span> Text(<span class="hljs-string">'å‡ºé”™äº†: <span class="hljs-subst">${snapshot.error}</span>'</span>);
            }

            <span class="hljs-comment">// æœ‰æ•°æ®äº†ï¼</span>
            <span class="hljs-keyword">return</span> Text(
              snapshot.data ?? <span class="hljs-string">'æ— æ•°æ®'</span>,
              style: TextStyle(fontSize: <span class="hljs-number">30</span>),
            );
          },
        ),
      ),
    );
  }
}

</code></pre>
<p>çœ‹ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦ <code>StatefulWidget</code>ï¼æ‰€æœ‰çš„çŠ¶æ€å˜åŒ–éƒ½å°è£…åœ¨äº† <code>StreamBuilder</code> å†…éƒ¨ã€‚</p>
<h3 data-id="heading-31">ä¸‰ã€ è§£å‰–æ ¸å¿ƒï¼šAsyncSnapshot (å¿«ç…§)</h3>
<p><code>builder</code> å›è°ƒå‡½æ•°é‡Œé‚£ä¸ª <code>snapshot</code> å‚æ•°ï¼Œæ˜¯ç†è§£ <code>StreamBuilder</code> çš„å…³é”®ã€‚</p>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ <strong>â€œStream åœ¨è¿™ä¸€ç¬é—´çš„ä½“æ£€æŠ¥å‘Šâ€</strong>ã€‚å®ƒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼š</p>
<ol>
<li><strong>ConnectionState (è¿æ¥çŠ¶æ€)</strong>ï¼š</li>
</ol>
<ul>
<li><code>none</code>: æ²¡æ’ç½‘çº¿ï¼ˆstream ä¸º nullï¼‰ã€‚</li>
<li><code>waiting</code>: æ’äº†ç½‘çº¿ï¼Œä½†ç¬¬ä¸€ä¸ªæ•°æ®è¿˜æ²¡æ¥ï¼ˆé€šå¸¸æ˜¾ç¤º Loadingï¼‰ã€‚</li>
<li><code>active</code>: æ•°æ®æ­£åœ¨æºæºä¸æ–­åœ°æ¥ï¼ˆæœ€ä¸»è¦çš„çŠ¶æ€ï¼‰ã€‚</li>
<li><code>done</code>: ä¼ é€å¸¦åœäº†ï¼ˆStream å…³é—­ï¼‰ã€‚</li>
</ul>
<ol>
<li><strong>data (æ•°æ®)</strong>ï¼š</li>
</ol>
<ul>
<li>å¦‚æœä¸ä¸º nullï¼Œè¯´æ˜è¿™å°±æ˜¯æœ€æ–°æ‹¿åˆ°çš„æ•°æ®ã€‚</li>
</ul>
<ol>
<li><strong>error (é”™è¯¯)</strong>ï¼š</li>
</ol>
<ul>
<li>å¦‚æœä¸ä¸º nullï¼Œè¯´æ˜åˆšæ‰æµé‡Œä¼ æ¥äº†ä¸€ä¸ªé”™è¯¯äº‹ä»¶ã€‚</li>
</ul>
<p><strong>æœ€ä½³å®è·µå†™æ³•</strong>ï¼š
ä¸è¦åªå†™ä¸€ä¸ª <code>return Text(...)</code>ï¼Œä¸€å®šè¦å…»æˆä¹ æƒ¯å¤„ç†ä¸‰ç§çŠ¶æ€ï¼š<strong>åŠ è½½ä¸­ã€é”™è¯¯ã€æ­£å¸¸æ˜¾ç¤º</strong>ã€‚</p>
<pre><code class="hljs language-dart" lang="dart">builder: (context, snapshot) {
  <span class="hljs-keyword">if</span> (snapshot.hasError) <span class="hljs-keyword">return</span> ErrorWidget();
  <span class="hljs-keyword">switch</span> (snapshot.connectionState) {
    <span class="hljs-keyword">case</span> ConnectionState.waiting: <span class="hljs-keyword">return</span> LoadingWidget();
    <span class="hljs-keyword">case</span> ConnectionState.active:
    <span class="hljs-keyword">case</span> ConnectionState.done:
      <span class="hljs-keyword">return</span> DataWidget(snapshot.data);
    <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> SizedBox();
  }
}

</code></pre>
<h3 data-id="heading-32">å››ã€ æ–°æ‰‹å¿…è¸©çš„è¶…çº§å¤§å‘</h3>
<p>åœ¨ä½¿ç”¨ <code>StreamBuilder</code> æ—¶ï¼Œ90% çš„æ–°æ‰‹ä¼šçŠ¯åŒä¸€ä¸ªé”™è¯¯ï¼š<strong>åœ¨ build æ–¹æ³•é‡Œåˆ›å»º Stream</strong>ã€‚</p>
<p><strong>âŒ é”™è¯¯ç¤ºèŒƒï¼š</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> StreamBuilder(
    <span class="hljs-comment">// é”™ï¼æ¯æ¬¡çˆ¶ç»„ä»¶åˆ·æ–°ï¼Œbuild éƒ½ä¼šè·‘ä¸€é</span>
    <span class="hljs-comment">// è¿™ä¸€è¡Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ Streamï¼</span>
    stream: createMyStream(), 
    builder: ...
  );
}

</code></pre>
<p><strong>ğŸ’¥ åæœï¼š</strong>
æ¯æ¬¡ä½ çš„ç•Œé¢åˆ·æ–°ï¼ˆæ¯”å¦‚é”®ç›˜å¼¹èµ·ã€çˆ¶ç»„ä»¶ setStateï¼‰ï¼Œ<code>createMyStream()</code> å°±ä¼šé‡æ–°æ‰§è¡Œã€‚
è¿™å°±æ„å‘³ç€ï¼š<strong>åŸæœ¬çš„è¿æ¥æ–­å¼€äº†ï¼Œä¸€ä¸ªæ–°çš„è¿æ¥å»ºç«‹äº†ã€‚</strong>
ä½ ä¼šçœ‹åˆ° Loading è½¬åœˆåœˆæ— é™é—ªçƒï¼Œæˆ–è€…å€’è®¡æ—¶æ˜æ˜èµ°åˆ° 5 äº†ï¼Œçªç„¶åˆå˜å› 10 é‡æ–°å¼€å§‹ã€‚</p>
<p><strong>âœ… æ­£ç¡®å§¿åŠ¿ï¼š</strong>
Stream å®ä¾‹çš„åˆ›å»ºå¿…é¡»åœ¨ <code>build</code> æ–¹æ³•<strong>ä¹‹å¤–</strong>ã€‚</p>
<ol>
<li>å¦‚æœæ˜¯ <code>StatefulWidget</code>ï¼Œåœ¨ <code>initState</code> é‡Œåˆ›å»ºã€‚</li>
<li>å¦‚æœæ˜¯ BLoC/Provider æ¨¡å¼ï¼ŒStream åº”è¯¥ç”±ä¸šåŠ¡é€»è¾‘ç±»æä¾›ï¼ŒUI åªè´Ÿè´£å¼•ç”¨ã€‚</li>
</ol>
<h3 data-id="heading-33">å°ç»“</h3>
<p>è¿™ä¸€ç« æˆ‘ä»¬è§è¯äº† Stream ä¸ Flutter UI çš„å®Œç¾èåˆã€‚</p>
<ul>
<li><strong>StreamBuilder</strong> æ˜¯è¿æ¥é€»è¾‘å±‚ä¸ UI å±‚çš„<strong>ä¸‡èƒ½é€‚é…å™¨</strong>ã€‚</li>
<li><strong>AsyncSnapshot</strong> æ˜¯æºå¸¦æ•°æ®çš„<strong>å¿«é€’ç›’</strong>ï¼Œæˆ‘ä»¬è¦å­¦ä¼šæ£€æŸ¥ç›’å­çš„çŠ¶æ€ï¼ˆWaiting/Active/Errorï¼‰ã€‚</li>
<li><strong>é“å¾‹</strong>ï¼šæ°¸è¿œä¸è¦åœ¨ <code>build</code> æ–¹æ³•é‡Œåˆ›å»º Streamï¼Œé‚£æ˜¯â€œä¸€æ¬¡æ€§ç­·å­â€ï¼Œç”¨å®Œå°±ä¸¢ï¼Œä¼šå¯¼è‡´çŠ¶æ€é‡ç½®ã€‚</li>
</ul>
<p>åˆ°è¿™é‡Œï¼Œå…³äº Stream çš„åŸºç¡€ã€è¿›é˜¶å’Œ UI å®æˆ˜æˆ‘ä»¬éƒ½è®²å®Œäº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä¸­å¤§å‹ APPï¼Œä½ ä¼šå‘ç°å…‰æœ‰ Stream è¿˜æ˜¯ä¸å¤Ÿã€‚ä½ éœ€è¦ä¸€ç§æ¶æ„æ¨¡å¼ï¼ŒæŠŠ Stream ç»„ç»‡èµ·æ¥ï¼Œè®©ä»£ç äº•äº•æœ‰æ¡ã€‚
è¿™å°±æ˜¯ Flutter å®˜æ–¹æ¨èçš„ â€”â€” <strong>BLoC (Business Logic Component) æ¨¡å¼</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-34">ç¬¬äº”ç« ï¼šFlutter å®æˆ˜â€”â€”BLoC æ¨¡å¼ï¼Œç»™ä½ çš„ä»£ç å®šè§„çŸ©</h2>
<p>ç»è¿‡å‰å››ç« çš„å­¦ä¹ ï¼Œä½ æ‰‹ä¸­å·²ç»æ¡æœ‰äº†å¼ºå¤§çš„æ­¦å™¨ï¼šStreamï¼Œå¹¶ä¸”å­¦ä¼šäº† Stream çš„æ‰€æœ‰æ‹›å¼ï¼ˆåˆ›å»ºã€å˜å½¢ã€æ¶ˆè´¹ï¼‰ï¼Œæ˜¯æ—¶å€™æŠŠå®ƒä»¬ç»„åˆæˆä¸€å¥—ç»ä¸–æ­¦åŠŸäº†ã€‚</p>
<p>ä½†ä½ å¯èƒ½ä¼šå‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼š<strong>æ­¦å™¨å¤ªçµæ´»äº†ï¼Œå®¹æ˜“è¯¯ä¼¤è‡ªå·±ã€‚</strong></p>
<p>å¦‚æœä½ åœ¨ UI Widget é‡Œéšä¾¿åˆ›å»º Controllerï¼Œåœ¨ <code>build</code> æ–¹æ³•é‡Œéšæ„å¤„ç†æ•°æ®ï¼Œå¾ˆå¿«ä½ çš„ä»£ç å°±ä¼šå˜æˆä¸€ç¢—â€œæ„å¤§åˆ©é¢â€â€”â€”é€»è¾‘å’Œ UI çº ç¼ ä¸æ¸…ï¼Œéš¾ä»¥ç»´æŠ¤ï¼Œéš¾ä»¥æµ‹è¯•ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒFlutter ç¤¾åŒºè¯ç”Ÿäº†ä¸€ç§åŸºäº Stream çš„æ¶æ„æ¨¡å¼ï¼š<strong>BLoC (Business Logic Component)</strong>ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒæ€æƒ³åªæœ‰ä¸€å¥è¯ï¼š<strong>è®© UI åªæ˜¯ UIï¼Œè®©é€»è¾‘åªæ˜¯é€»è¾‘ï¼Œä¸¤è€…é€šè¿‡ Stream å¯¹è¯ã€‚</strong></p>
<h3 data-id="heading-35">ä¸€ã€ BLoC çš„â€œé»‘ç›’æ¨¡å‹â€</h3>
<p>æŠŠ BLoC æƒ³è±¡æˆä¸€å°<strong>è‡ªåŠ¨å”®è´§æœº</strong>ã€‚</p>
<ol>
<li><strong>è¾“å…¥ (Input)</strong>ï¼šä½ æŒ‰ä¸‹ä¸€ä¸ªæŒ‰é’®ï¼ˆæ¯”å¦‚â€œè´­ä¹°å¯ä¹â€ï¼‰ã€‚è¿™åœ¨ BLoC é‡Œå« <strong>Event (äº‹ä»¶)</strong>ã€‚</li>
<li><strong>é»‘ç›’ (Processing)</strong>ï¼šæœºå™¨å†…éƒ¨å¬åˆ°æŒ‡ä»¤ï¼Œæ£€æŸ¥åº“å­˜ï¼Œæ‰£é™¤ä½™é¢ï¼Œé©±åŠ¨æœºæ¢°è‡‚ã€‚è¿™å°±æ˜¯ <strong>Business Logic (ä¸šåŠ¡é€»è¾‘)</strong>ã€‚</li>
<li><strong>è¾“å‡º (Output)</strong>ï¼šæœºå™¨åå‡ºä¸€å¬å¯ä¹ï¼Œæˆ–è€…æ˜¾ç¤ºâ€œä½™é¢ä¸è¶³â€ã€‚è¿™åœ¨ BLoC é‡Œå« <strong>State (çŠ¶æ€)</strong>ã€‚</li>
</ol>
<p><strong>å…³é”®è§„åˆ™ï¼š</strong></p>
<ul>
<li>UI ç»„ä»¶ï¼ˆWidgetï¼‰<strong>ç»å¯¹ä¸å…è®¸</strong>ç›´æ¥ä¿®æ”¹æ•°æ®ã€‚</li>
<li>UI åªèƒ½åšä¸€ä»¶äº‹ï¼š<strong>å¾€ BLoC çš„ Sink é‡Œæ‰”äº‹ä»¶</strong>ã€‚</li>
<li>UI åªèƒ½å¬ä¸€ä»¶äº‹ï¼š<strong>å¬ BLoC çš„ Stream é‡Œæµå‡ºæ¥çš„çŠ¶æ€</strong>ã€‚</li>
</ul>
<h3 data-id="heading-36">äºŒã€ æ‰‹å†™ä¸€ä¸ªçº¯ç²¹çš„ BLoC</h3>
<p>åœ¨å¼•å…¥ç¬¬ä¸‰æ–¹åº“ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç”¨åŸç”Ÿ Dart ä»£ç å†™ä¸€ä¸ª BLoCï¼Œä½ ä¼šå‘ç°å®ƒæœ¬è´¨ä¸Šå°±æ˜¯æˆ‘ä»¬ç¬¬äºŒç« å­¦çš„ <code>StreamController</code> çš„å°è£…ã€‚</p>
<p>æˆ‘ä»¬æ¥é‡æ„ä¹‹å‰çš„â€œç”µå­è¡¨â€æˆ–â€œè®¡æ•°å™¨â€ã€‚</p>
<p><strong>1. å®šä¹‰ BLoC ç±» (é€»è¾‘å±‚)</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterBloc</span> </span>{
  <span class="hljs-comment">// 1. çŠ¶æ€æµæ§åˆ¶å™¨ (Output)ï¼šå‘Šè¯‰ UI å½“å‰æ˜¯å‡ </span>
  <span class="hljs-comment">// ä½¿ç”¨å¹¿æ’­æµï¼Œå…è®¸å¤šä¸ªé¡µé¢åŒæ—¶ç›‘å¬</span>
  <span class="hljs-keyword">final</span> _stateController = StreamController&lt;<span class="hljs-built_in">int</span>&gt;.broadcast();
  <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 2. æš´éœ²ç»™å¤–éƒ¨çš„ Stream (åªè¯»)</span>
  Stream&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-keyword">get</span> stream =&gt; _stateController.stream;

  <span class="hljs-comment">// 3. äº‹ä»¶å…¥å£ (Input)ï¼šUI åªèƒ½è°ƒè¿™ä¸ªæ–¹æ³•</span>
  <span class="hljs-keyword">void</span> increment() {
    _count++;
    <span class="hljs-comment">// é€»è¾‘å¤„ç†å®Œï¼ŒæŠŠæ–°çŠ¶æ€æ¨å‡ºå»</span>
    _stateController.sink.add(_count); 
  }

  <span class="hljs-comment">// 4. èµ„æºé‡Šæ”¾</span>
  <span class="hljs-keyword">void</span> dispose() {
    _stateController.close();
  }
}

</code></pre>
<p><strong>2. åœ¨ UI ä¸­ä½¿ç”¨ (è§†å›¾å±‚)</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _CounterPageState createState() =&gt; _CounterPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CounterPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">CounterPage</span>&gt; </span>{
  <span class="hljs-keyword">final</span> bloc = CounterBloc(); <span class="hljs-comment">// åˆ›å»º BLoC</span>

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    bloc.dispose(); <span class="hljs-comment">// è®°å¾—å…³æµ</span>
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">"BLoC æ¨¡å¼"</span>)),
      body: Center(
        <span class="hljs-comment">// ä½¿ç”¨ StreamBuilder ç›‘å¬ BLoC çš„è¾“å‡º</span>
        child: StreamBuilder&lt;<span class="hljs-built_in">int</span>&gt;(
          stream: bloc.stream,
          initialData: <span class="hljs-number">0</span>,
          builder: (context, snapshot) {
            <span class="hljs-keyword">return</span> Text(
              <span class="hljs-string">'<span class="hljs-subst">${snapshot.data}</span>'</span>, 
              style: TextStyle(fontSize: <span class="hljs-number">40</span>)
            );
          },
        ),
      ),
      floatingActionButton: FloatingActionButton(
        <span class="hljs-comment">// UI åªè´Ÿè´£è§¦å‘åŠ¨ä½œ</span>
        onPressed: () =&gt; bloc.increment(),
        child: Icon(Icons.add),
      ),
    );
  }
}

</code></pre>
<p><strong>çœ‹ï¼Œä»£ç æ¸…çˆ½å¤šäº†ï¼</strong></p>
<ul>
<li><code>build</code> æ–¹æ³•é‡Œæ²¡æœ‰ä»»ä½• <code>_count++</code> è¿™æ ·çš„é€»è¾‘ã€‚</li>
<li>é€»è¾‘ä»£ç å…¨åœ¨ <code>CounterBloc</code> é‡Œï¼Œä½ å¯ä»¥ä¸ä¾èµ– Flutter UI ç›´æ¥å¯¹ <code>CounterBloc</code> å†™å•å…ƒæµ‹è¯•ã€‚</li>
</ul>
<h3 data-id="heading-37">ä¸‰ã€ è¿›é˜¶ï¼šä¸ºä»€ä¹ˆè¦ç”¨ <code>flutter_bloc</code> åº“ï¼Ÿ</h3>
<p>è™½ç„¶æ‰‹å†™ BLoC å¸®æˆ‘ä»¬ç†æ¸…äº†åŸç†ï¼Œä½†å®é™…å¼€å‘ä¸­ï¼Œæ‰‹åŠ¨ç®¡ç† <code>StreamController</code> çš„å…³é—­ã€æ‰‹åŠ¨å®šä¹‰ Sink å’Œ Stream è¿˜æ˜¯å¤ªç¹çäº†ã€‚</p>
<p>äºæ˜¯ï¼Œå¤§ç¥ <strong>Felix Angelov</strong> å¼€æºäº† <code>flutter_bloc</code> åº“ï¼Œå®ƒæŠŠè¿™å¥—æµç¨‹æ ‡å‡†åŒ–äº†ã€‚</p>
<p>åœ¨ <code>flutter_bloc</code> åº“ä¸­ï¼š</p>
<ol>
<li><strong>ä¸å†éœ€è¦æ‰‹åŠ¨å†™ Controller</strong>ï¼šåº“å¸®ä½ å°è£…å¥½äº†ã€‚</li>
<li><strong>å¼ºåˆ¶çš„ Event/State å®šä¹‰</strong>ï¼šä½ å¿…é¡»å…ˆå®šä¹‰å¥½æ‰€æœ‰çš„â€œåŠ¨ä½œâ€å’Œâ€œç»“æœâ€ï¼Œå¼ºåˆ¶ä»£ç è§„èŒƒã€‚</li>
<li><strong>BlocBuilder</strong>ï¼šå®ƒå°±æ˜¯ <code>StreamBuilder</code> çš„äº²å„¿å­ï¼Œä¸“é—¨ç”¨æ¥ç®€åŒ– BLoC çš„ç›‘å¬ã€‚</li>
</ol>
<h3 data-id="heading-38">å››ã€ BLoC çš„å“²å­¦æ„ä¹‰</h3>
<p>å­¦ä¹  BLoCï¼Œå®é™…ä¸Šæ˜¯åœ¨å­¦ä¹ ä¸€ç§ <strong>â€œå•å‘æ•°æ®æµâ€ (Unidirectional Data Flow)</strong> çš„æ€æƒ³ã€‚</p>
<ul>
<li><strong>æ²¡æœ‰ BLoC æ—¶</strong>ï¼šæ•°æ®æ»¡å¤©é£ï¼ŒA ç»„ä»¶æ”¹äº† B çš„æ•°æ®ï¼ŒC ç»„ä»¶åˆå›è°ƒäº† A çš„æ–¹æ³•ã€‚å‡ºäº† Bug æ ¹æœ¬æ‰¾ä¸åˆ°æºå¤´ã€‚</li>
<li><strong>æœ‰äº† BLoC å</strong>ï¼š</li>
<li>æ•°æ®æ°¸è¿œæ˜¯ <strong>ä»ä¸Šå¾€ä¸‹æµ</strong> (Stream)ã€‚</li>
<li>äº‹ä»¶æ°¸è¿œæ˜¯ <strong>ä»ä¸‹å¾€ä¸Šå‘</strong> (Sink)ã€‚</li>
<li>å½¢æˆäº†ä¸€ä¸ªå®Œç¾çš„é—­ç¯ã€‚</li>
</ul>
<h3 data-id="heading-39">äº”ã€ å…¨å‰§ç»ˆï¼šStream å­¦ä¹ ä¹‹è·¯</h3>
<p>æ­å–œä½ ï¼ä»ç¬¬ä¸€ç« çš„ <code>Future</code> å•æ¬¡è¯·æ±‚ï¼Œåˆ° <code>Stream</code> çš„ä¼ é€å¸¦æ¨¡å‹ï¼Œå†åˆ° <code>StreamController</code> çš„æ‰‹åŠ¨æ§åˆ¶ï¼Œæœ€åä¸Šå‡åˆ° <code>BLoC</code> çš„æ¶æ„æ¨¡å¼ã€‚</p>
<p>ä½ å·²ç»èµ°å®Œäº† Dart å¼‚æ­¥ç¼–ç¨‹æœ€æ ¸å¿ƒçš„æ—…ç¨‹ã€‚</p>
<p><strong>å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„æˆå°±ï¼š</strong></p>
<ol>
<li><strong>åº•å±‚åŸç†</strong>ï¼šä½ æ‡‚äº† <code>yield</code> æš‚åœæœºåˆ¶ï¼ŒçŸ¥é“äº†å¼‚æ­¥ä¸æ˜¯é­”æ³•ï¼Œæ˜¯çŠ¶æ€æœºçš„åˆ‡æ¢ã€‚</li>
<li><strong>å†…å­˜æ¨¡å‹</strong>ï¼šä½ åˆ†æ¸…äº†å•è®¢é˜…å’Œå¹¿æ’­ï¼ŒçŸ¥é“å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ã€‚</li>
<li><strong>å·¥å…·ç®±</strong>ï¼šä½ æŒæ¡äº† <code>map</code>, <code>where</code>, <code>debounce</code> ç­‰æ“ä½œç¬¦ï¼Œèƒ½åƒåšæ‰‹æœ¯ä¸€æ ·å¤„ç†æ•°æ®ã€‚</li>
<li><strong>æ¶æ„æ€ç»´</strong>ï¼šä½ å­¦ä¼šäº†ç”¨ Stream å°† UI å’Œé€»è¾‘å½»åº•åˆ†ç¦»ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸“ä¸šæŒ‡å—ï¼šä»æ ¸å¿ƒæ¦‚å¿µåˆ°3DåŠ¨æ•ˆå®ç°]]></title>    <link>https://juejin.cn/post/7600489282839871498</link>    <guid>https://juejin.cn/post/7600489282839871498</guid>    <pubDate>2026-01-29T10:03:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600489282839871498" data-draft-id="7600616270002602022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸“ä¸šæŒ‡å—ï¼šä»æ ¸å¿ƒæ¦‚å¿µåˆ°3DåŠ¨æ•ˆå®ç°"/> <meta itemprop="keywords" content="å‰ç«¯,CSS"/> <meta itemprop="datePublished" content="2026-01-29T10:03:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Leeå·"/> <meta itemprop="url" content="https://juejin.cn/user/2402874087453658"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸“ä¸šæŒ‡å—ï¼šä»æ ¸å¿ƒæ¦‚å¿µåˆ°3DåŠ¨æ•ˆå®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2402874087453658/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Leeå·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:03:00.000Z" title="Thu Jan 29 2026 10:03:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS3 ä¸“ä¸šæŒ‡å—ï¼šä»æ ¸å¿ƒæ¦‚å¿µåˆ°3DåŠ¨æ•ˆå®ç°</h2>
<h3 data-id="heading-1">å¼•è¨€ï¼šCSS3çš„æ¼”è¿›ä¸ç°ä»£åŒ–å¸ƒå±€ä½“ç³»</h3>
<p>CSS3ä¸ä»…æ˜¯CSS2.1çš„ç®€å•æ‰©å±•ï¼Œè€Œæ˜¯Webæ ·å¼è®¾è®¡çš„ä¸€æ¬¡é©å‘½æ€§å‡çº§ã€‚è‡ª2011å¹´å¼€å§‹é€æ­¥æ ‡å‡†åŒ–ï¼ŒCSS3å¼•å…¥äº†æ¨¡å—åŒ–è®¾è®¡ç†å¿µï¼Œå°†æ ·å¼è§„èŒƒæ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æ¼”è¿›ã€‚è¿™ç§è®¾è®¡ä½¿å¾—Flexboxã€Gridã€åŠ¨ç”»ã€å˜æ¢ç­‰ç°ä»£ç‰¹æ€§å¾—ä»¥å¿«é€Ÿå‘å±•ï¼Œå½»åº•æ”¹å˜äº†å‰ç«¯å¼€å‘è€…çš„å·¥ä½œæ–¹å¼ã€‚</p>
<h3 data-id="heading-2">ä¸€ã€CSS3æ ¸å¿ƒæ¨¡å—æ¶æ„</h3>
<h4 data-id="heading-3">1.1 é€‰æ‹©å™¨æ¨¡å—ï¼šç²¾å‡†å…ƒç´ å®šä½</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å±æ€§é€‰æ‹©å™¨ - ç²¾å‡†åŒ¹é… */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"email"</span>]</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#3498db</span>;
}

<span class="hljs-comment">/* ç»“æ„ä¼ªç±»é€‰æ‹©å™¨ */</span>
<span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) { <span class="hljs-comment">/* å¶æ•°é¡¹ */</span>
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
}

<span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(odd) { <span class="hljs-comment">/* å¥‡æ•°é¡¹ */</span>
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e9ecef</span>;
}

<span class="hljs-comment">/* ç›®æ ‡ä¼ªç±» */</span>
<span class="hljs-selector-tag">section</span><span class="hljs-selector-pseudo">:target</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff3cd</span>;
  <span class="hljs-attribute">animation</span>: highlight <span class="hljs-number">1s</span> ease;
}

<span class="hljs-comment">/* å¦å®šä¼ªç±» */</span>
<span class="hljs-selector-tag">div</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-class">.exclude</span>) {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.3s</span>;
}

<span class="hljs-comment">/* çŠ¶æ€ä¼ªç±» */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span>-within {
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">52</span>, <span class="hljs-number">152</span>, <span class="hljs-number">219</span>, <span class="hljs-number">0.3</span>);
}
</code></pre>
<h4 data-id="heading-4">1.2 ç›’æ¨¡å‹å¢å¼ºï¼šå¤šåˆ—å¸ƒå±€å®è·µ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ç»å…¸å¤šåˆ—å¸ƒå±€ */</span>
<span class="hljs-selector-class">.article-content</span> {
  <span class="hljs-attribute">column-count</span>: <span class="hljs-number">3</span>;
  <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">2em</span>;
  <span class="hljs-attribute">column-rule</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dee2e6</span>;
  <span class="hljs-attribute">column-width</span>: <span class="hljs-number">300px</span>;
  
  <span class="hljs-comment">/* é¿å…å…ƒç´ è·¨åˆ—æ–­å¼€ */</span>
  <span class="hljs-attribute">break-inside</span>: avoid;
}

<span class="hljs-comment">/* åˆ—é—´å¹³è¡¡ä¼˜åŒ– */</span>
<span class="hljs-selector-class">.balanced-columns</span> {
  <span class="hljs-attribute">column-count</span>: <span class="hljs-number">3</span>;
  <span class="hljs-attribute">column-fill</span>: balance; <span class="hljs-comment">/* åˆ—é«˜å°½é‡å¹³è¡¡ */</span>
}

<span class="hljs-comment">/* å“åº”å¼å¤šåˆ— */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.article-content</span> {
    <span class="hljs-attribute">column-count</span>: <span class="hljs-number">2</span>;
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
  <span class="hljs-selector-class">.article-content</span> {
    <span class="hljs-attribute">column-count</span>: <span class="hljs-number">1</span>;
  }
}
</code></pre>
<h3 data-id="heading-5">äºŒã€Flexboxï¼šä¸€ç»´å¸ƒå±€çš„é©å‘½</h3>
<h4 data-id="heading-6">2.1 Flexå®¹å™¨ä¸é¡¹ç›®çš„åŸºç¡€é…ç½®</h4>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">div</span> class="<span class="hljs-attribute">flex</span>-container"&gt;
  &lt;<span class="hljs-selector-tag">div</span> class="<span class="hljs-attribute">flex</span>-item"&gt;é¡¹ç›®<span class="hljs-number">1</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> class="<span class="hljs-attribute">flex</span>-item"&gt;é¡¹ç›®<span class="hljs-number">2</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">div</span> class="<span class="hljs-attribute">flex</span>-item"&gt;é¡¹ç›®<span class="hljs-number">3</span>&lt;/<span class="hljs-selector-tag">div</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.flex-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row; <span class="hljs-comment">/* ä¸»è½´æ–¹å‘: row | row-reverse | column | column-reverse */</span>
  <span class="hljs-attribute">flex-wrap</span>: wrap; <span class="hljs-comment">/* æ¢è¡Œ: nowrap | wrap | wrap-reverse */</span>
  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/* ä¸»è½´å¯¹é½ */</span>
  <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* äº¤å‰è½´å¯¹é½ */</span>
  <span class="hljs-attribute">align-content</span>: stretch; <span class="hljs-comment">/* å¤šè¡Œå¯¹é½ */</span>
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1rem</span>; <span class="hljs-comment">/* é¡¹ç›®é—´è· */</span>
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.flex-item</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>; <span class="hljs-comment">/* grow | shrink | basis */</span>
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.9</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.flex-item</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}
</code></pre>
<h4 data-id="heading-7">2.2 Flexé¡¹ç›®çš„é«˜çº§æ§åˆ¶</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é¡¹ç›®æ’åºæ§åˆ¶ */</span>
<span class="hljs-selector-class">.flex-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) { <span class="hljs-attribute">order</span>: <span class="hljs-number">3</span>; }
<span class="hljs-selector-class">.flex-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) { <span class="hljs-attribute">order</span>: <span class="hljs-number">1</span>; }
<span class="hljs-selector-class">.flex-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) { <span class="hljs-attribute">order</span>: <span class="hljs-number">2</span>; }

<span class="hljs-comment">/* é¡¹ç›®å¯¹é½è¦†ç›– */</span>
<span class="hljs-selector-class">.flex-item</span><span class="hljs-selector-class">.special</span> {
  <span class="hljs-attribute">align-self</span>: flex-start; <span class="hljs-comment">/* è¦†ç›–å®¹å™¨align-items */</span>
  <span class="hljs-attribute">flex-grow</span>: <span class="hljs-number">2</span>; <span class="hljs-comment">/* æ¯”å…¶ä»–é¡¹ç›®å¤šå ç©ºé—´ */</span>
}

<span class="hljs-comment">/* å“åº”å¼Flexè°ƒæ•´ */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.flex-container</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
  }
  
  <span class="hljs-selector-class">.flex-item</span> {
    <span class="hljs-attribute">flex-basis</span>: auto;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }
}
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€CSS Gridï¼šäºŒç»´å¸ƒå±€çš„ç»ˆæè§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-9">3.1 ç½‘æ ¼ç³»ç»ŸåŸºç¡€æ¶æ„</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">grid-template-rows</span>: auto;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">1.5rem</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fa</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">400px</span>;
}

<span class="hljs-selector-class">.grid-item</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1.5rem</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">6px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.4</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">1</span>);
}

<span class="hljs-comment">/* æ˜¾å¼ç½‘æ ¼å®šä½ */</span>
<span class="hljs-selector-class">.grid-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
  <span class="hljs-attribute">grid-column</span>: <span class="hljs-number">1</span> / <span class="hljs-number">3</span>; <span class="hljs-comment">/* è·¨è¶Šä¸¤åˆ— */</span>
  <span class="hljs-attribute">grid-row</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.grid-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) {
  <span class="hljs-attribute">grid-column</span>: <span class="hljs-number">3</span>;
  <span class="hljs-attribute">grid-row</span>: <span class="hljs-number">1</span> / <span class="hljs-number">3</span>; <span class="hljs-comment">/* è·¨è¶Šä¸¤è¡Œ */</span>
}

<span class="hljs-comment">/* éšå¼ç½‘æ ¼è¡Œä¸º */</span>
<span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">grid-auto-flow</span>: dense; <span class="hljs-comment">/* è‡ªåŠ¨å¡«å……ç©ºç™½ */</span>
  <span class="hljs-attribute">grid-auto-rows</span>: <span class="hljs-built_in">minmax</span>(<span class="hljs-number">150px</span>, auto); <span class="hljs-comment">/* éšå¼è¡Œé«˜ */</span>
}
</code></pre>
<h4 data-id="heading-10">3.2 é«˜çº§ç½‘æ ¼å¸ƒå±€æ¨¡å¼</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ‚å¿—å¼å¸ƒå±€ */</span>
<span class="hljs-selector-class">.magazine-layout</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-areas</span>:
    <span class="hljs-string">"header header header"</span>
    <span class="hljs-string">"sidebar content ads"</span>
    <span class="hljs-string">"footer footer footer"</span>;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">200px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">grid-template-rows</span>: auto <span class="hljs-number">1</span>fr auto;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
}

<span class="hljs-selector-class">.header</span> { <span class="hljs-attribute">grid-area</span>: header; <span class="hljs-attribute">background</span>: <span class="hljs-number">#2c3e50</span>; <span class="hljs-attribute">color</span>: white; }
<span class="hljs-selector-class">.sidebar</span> { <span class="hljs-attribute">grid-area</span>: sidebar; <span class="hljs-attribute">background</span>: <span class="hljs-number">#ecf0f1</span>; }
<span class="hljs-selector-class">.content</span> { <span class="hljs-attribute">grid-area</span>: content; <span class="hljs-attribute">background</span>: white; }
<span class="hljs-selector-class">.ads</span> { <span class="hljs-attribute">grid-area</span>: ads; <span class="hljs-attribute">background</span>: <span class="hljs-number">#f1c40f</span>; }
<span class="hljs-selector-class">.footer</span> { <span class="hljs-attribute">grid-area</span>: footer; <span class="hljs-attribute">background</span>: <span class="hljs-number">#34495e</span>; <span class="hljs-attribute">color</span>: white; }

<span class="hljs-comment">/* å“åº”å¼ç½‘æ ¼è°ƒæ•´ */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1024px</span>) {
  <span class="hljs-selector-class">.magazine-layout</span> {
    <span class="hljs-attribute">grid-template-areas</span>:
      <span class="hljs-string">"header"</span>
      <span class="hljs-string">"sidebar"</span>
      <span class="hljs-string">"content"</span>
      <span class="hljs-string">"ads"</span>
      <span class="hljs-string">"footer"</span>;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
    <span class="hljs-attribute">grid-template-rows</span>: auto;
  }
}
</code></pre>
<h3 data-id="heading-11">å››ã€æ°´å¹³å‚ç›´å±…ä¸­ï¼šå…¨æ–¹ä½è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-12">4.1 ä¼ ç»Ÿå±…ä¸­æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ–¹æ¡ˆ1ï¼šç»å¯¹å®šä½ + transform */</span>
<span class="hljs-selector-class">.centered-1</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-comment">/* æ–¹æ¡ˆ2ï¼šè¡¨æ ¼å•å…ƒæ ¼ */</span>
<span class="hljs-selector-class">.parent-table</span> {
  <span class="hljs-attribute">display</span>: table;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ecf0f1</span>;
}

<span class="hljs-selector-class">.child-table</span> {
  <span class="hljs-attribute">display</span>: table-cell;
  <span class="hljs-attribute">vertical-align</span>: middle;
  <span class="hljs-attribute">text-align</span>: center;
}
</code></pre>
<h4 data-id="heading-13">4.2 ç°ä»£å±…ä¸­æ–¹æ¡ˆ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ–¹æ¡ˆ3ï¼šFlexboxå±…ä¸­ */</span>
<span class="hljs-selector-class">.parent-flex</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff9a9e</span>, <span class="hljs-number">#fad0c4</span>);
}

<span class="hljs-selector-class">.child-flex</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">40px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* æ–¹æ¡ˆ4ï¼šGridå±…ä¸­ */</span>
<span class="hljs-selector-class">.parent-grid</span> {
  <span class="hljs-attribute">display</span>: grid;
  place-items: center; <span class="hljs-comment">/* ä¸€è¡Œä»£ç å®ç°å±…ä¸­ */</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#667eea</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#764ba2</span> <span class="hljs-number">100%</span>);
}

<span class="hljs-comment">/* æ–¹æ¡ˆ5ï¼šMargin auto (å—çº§å…ƒç´ ) */</span>
<span class="hljs-selector-class">.block-centered</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#2ecc71</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
}
</code></pre>
<h4 data-id="heading-14">4.3 æ–‡æœ¬å±…ä¸­ä¸è¡Œå†…å…ƒç´ </h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ–‡æœ¬æ°´å¹³å±…ä¸­ */</span>
<span class="hljs-selector-class">.text-center</span> {
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-comment">/* è¡Œå†…å…ƒç´ å±…ä¸­ */</span>
<span class="hljs-selector-class">.inline-parent</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">100px</span>; <span class="hljs-comment">/* å•è¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fa</span>;
}

<span class="hljs-comment">/* å¤šè¡Œæ–‡æœ¬å‚ç›´å±…ä¸­ */</span>
<span class="hljs-selector-class">.multiline-center</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff3cd</span>;
}
</code></pre>
<h3 data-id="heading-15">äº”ã€CSS3å˜æ¢ä¸è¿‡æ¸¡ï¼šäº¤äº’åŠ¨æ•ˆåŸºç¡€</h3>
<h4 data-id="heading-16">5.1 2Då˜æ¢ç³»ç»Ÿ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.transform-demo</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.68</span>, -<span class="hljs-number">0.55</span>, <span class="hljs-number">0.265</span>, <span class="hljs-number">1.55</span>);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-comment">/* æ—‹è½¬å˜æ¢ */</span>
<span class="hljs-selector-class">.transform-demo</span><span class="hljs-selector-class">.rotate</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">45deg</span>);
}

<span class="hljs-comment">/* ç¼©æ”¾å˜æ¢ */</span>
<span class="hljs-selector-class">.transform-demo</span><span class="hljs-selector-class">.scale</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
}

<span class="hljs-comment">/* å€¾æ–œå˜æ¢ */</span>
<span class="hljs-selector-class">.transform-demo</span><span class="hljs-selector-class">.skew</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">skew</span>(<span class="hljs-number">15deg</span>, <span class="hljs-number">15deg</span>);
}

<span class="hljs-comment">/* å¤šé‡å˜æ¢ */</span>
<span class="hljs-selector-class">.transform-demo</span><span class="hljs-selector-class">.multiple</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">15deg</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>) <span class="hljs-built_in">translateX</span>(<span class="hljs-number">20px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">40px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.2</span>);
}

<span class="hljs-comment">/* å˜æ¢åŸç‚¹æ§åˆ¶ */</span>
<span class="hljs-selector-class">.transform-demo</span><span class="hljs-selector-class">.origin</span> {
  <span class="hljs-attribute">transform-origin</span>: top left; <span class="hljs-comment">/* å·¦ä¸Šè§’ä¸ºå˜æ¢åŸç‚¹ */</span>
}
</code></pre>
<h4 data-id="heading-17">5.2 è¿‡æ¸¡åŠ¨ç”»é«˜çº§åº”ç”¨</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å¤æ‚è¿‡æ¸¡æ•ˆæœ */</span>
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.6s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.175</span>, <span class="hljs-number">0.885</span>, <span class="hljs-number">0.32</span>, <span class="hljs-number">1.275</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">15px</span> <span class="hljs-number">35px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">20px</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">30px</span> <span class="hljs-number">60px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.2</span>);
}

<span class="hljs-selector-class">.card-content</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">50px</span>);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.5s</span> ease <span class="hljs-number">0.2s</span>; <span class="hljs-comment">/* å»¶è¿Ÿè§¦å‘ */</span>
}

<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.card-content</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-comment">/* è¿‡æ¸¡æ€§èƒ½ä¼˜åŒ– */</span>
<span class="hljs-selector-class">.optimized-transition</span> {
  <span class="hljs-comment">/* ä½¿ç”¨transformå’Œopacityä»¥è·å¾—GPUåŠ é€Ÿ */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease, opacity <span class="hljs-number">0.3s</span> ease;
  
  <span class="hljs-comment">/* é¿å…åŠ¨ç”»å¸ƒå±€æŠ–åŠ¨ */</span>
  <span class="hljs-attribute">will-change</span>: transform, opacity;
}
</code></pre>
<h3 data-id="heading-18">å…­ã€CSS3 3Då˜æ¢ï¼šæ·±åº¦ä¸ç©ºé—´æ„Ÿ</h3>
<h4 data-id="heading-19">6.1 3Då˜æ¢åŸºç¡€</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"scene"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"cube"</span>&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face front"</span>&gt;å‰é¢&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face back"</span>&gt;åé¢&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face right"</span>&gt;å³é¢&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face left"</span>&gt;å·¦é¢&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face top"</span>&gt;ä¸Šé¢&lt;/div&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"face bottom"</span>&gt;ä¸‹é¢&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 3Dåœºæ™¯è®¾ç½® */</span>
<span class="hljs-selector-class">.scene</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>; <span class="hljs-comment">/* é€è§†è·ç¦»ï¼Œå€¼è¶Šå°3Dæ•ˆæœè¶Šå¼º */</span>
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span> auto;
}

<span class="hljs-comment">/* 3Då®¹å™¨ */</span>
<span class="hljs-selector-class">.cube</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d; <span class="hljs-comment">/* ä¿æŒ3Dç©ºé—´ */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">1s</span> ease-in-out;
  <span class="hljs-attribute">animation</span>: rotateCube <span class="hljs-number">10s</span> infinite linear;
}

<span class="hljs-comment">/* ç«‹æ–¹ä½“é¢ */</span>
<span class="hljs-selector-class">.face</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">52</span>, <span class="hljs-number">152</span>, <span class="hljs-number">219</span>, <span class="hljs-number">0.8</span>);
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid white;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">backface-visibility</span>: visible;
}

<span class="hljs-comment">/* å„é¢å®šä½ */</span>
<span class="hljs-selector-class">.front</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">100px</span>); }
<span class="hljs-selector-class">.back</span>   { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">100px</span>); }
<span class="hljs-selector-class">.right</span>  { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">90deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">100px</span>); }
<span class="hljs-selector-class">.left</span>   { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(-<span class="hljs-number">90deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">100px</span>); }
<span class="hljs-selector-class">.top</span>    { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">90deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">100px</span>); }
<span class="hljs-selector-class">.bottom</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(-<span class="hljs-number">90deg</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">100px</span>); }

<span class="hljs-comment">/* ç«‹æ–¹ä½“æ—‹è½¬åŠ¨ç”» */</span>
<span class="hljs-keyword">@keyframes</span> rotateCube {
  <span class="hljs-number">0%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">rotateZ</span>(<span class="hljs-number">0</span>); }
  <span class="hljs-number">25%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">90deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); }
  <span class="hljs-number">50%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">180deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">360deg</span>); }
  <span class="hljs-number">75%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">270deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">540deg</span>); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">360deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">720deg</span>); }
}

<span class="hljs-comment">/* äº¤äº’å¼æ—‹è½¬ */</span>
<span class="hljs-selector-class">.cube</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">animation-play-state</span>: paused;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">45deg</span>) <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">45deg</span>);
}
</code></pre>
<h4 data-id="heading-20">6.2 3Då¡ç‰‡ç¿»è½¬æ•ˆæœ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 3Då¡ç‰‡ç¿»è½¬ */</span>
<span class="hljs-selector-class">.flip-card</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.flip-card-inner</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.8s</span>;
  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
}

<span class="hljs-selector-class">.flip-card</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.flip-card-inner</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}

<span class="hljs-selector-class">.flip-card-front</span>,
<span class="hljs-selector-class">.flip-card-back</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">backface-visibility</span>: hidden;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">15px</span> <span class="hljs-number">35px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.flip-card-front</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
}

<span class="hljs-selector-class">.flip-card-back</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#667eea</span>, <span class="hljs-number">#764ba2</span>);
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">justify-content</span>: center;
}
</code></pre>
<h3 data-id="heading-21">ä¸ƒã€CSSåŠ¨ç”»ç³»ç»Ÿï¼šå…³é”®å¸§åŠ¨ç”»è¯¦è§£</h3>
<h4 data-id="heading-22">7.1 å¤æ‚å…³é”®å¸§åŠ¨ç”»</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å¤šé˜¶æ®µåŠ¨ç”» */</span>
<span class="hljs-keyword">@keyframes</span> multiStep {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ff6b6b</span>;
  }
  <span class="hljs-number">25%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">100px</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4ecdc4</span>;
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">200px</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#45b7d1</span>;
  }
  <span class="hljs-number">75%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">100px</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.8</span>);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#96ceb4</span>;
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ff6b6b</span>;
  }
}

<span class="hljs-selector-class">.animated-box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">animation</span>: multiStep <span class="hljs-number">4s</span> ease-in-out infinite;
  <span class="hljs-attribute">animation-fill-mode</span>: both;
}

<span class="hljs-comment">/* åŠ¨ç”»æ§åˆ¶ */</span>
<span class="hljs-selector-class">.paused</span> {
  <span class="hljs-attribute">animation-play-state</span>: paused;
}

<span class="hljs-selector-class">.slow</span> {
  <span class="hljs-attribute">animation-duration</span>: <span class="hljs-number">8s</span>;
  <span class="hljs-attribute">animation-timing-function</span>: ease-in;
}

<span class="hljs-selector-class">.alternate</span> {
  <span class="hljs-attribute">animation-direction</span>: alternate;
}
</code></pre>
<h4 data-id="heading-23">7.2 æ€§èƒ½ä¼˜åŒ–çš„åŠ¨ç”»å®è·µ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* GPUåŠ é€ŸåŠ¨ç”» */</span>
<span class="hljs-selector-class">.gpu-animated</span> {
  <span class="hljs-comment">/* ä½¿ç”¨transformå’Œopacityè§¦å‘GPUåŠ é€Ÿ */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">will-change</span>: transform, opacity;
  
  <span class="hljs-attribute">animation</span>: smoothSlide <span class="hljs-number">2s</span> ease-in-out infinite;
}

<span class="hljs-keyword">@keyframes</span> smoothSlide {
  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">100px</span>) <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
  }
}

<span class="hljs-comment">/* å‡å°‘é‡ç»˜çš„åŠ¨ç”» */</span>
<span class="hljs-selector-class">.optimized-animation</span> {
  <span class="hljs-comment">/* åªåŠ¨ç”»transformå’Œopacityå±æ€§ */</span>
  <span class="hljs-attribute">animation</span>: optimizedMove <span class="hljs-number">3s</span> infinite;
  
  <span class="hljs-comment">/* åˆ›å»ºç‹¬ç«‹çš„åˆæˆå±‚ */</span>
  <span class="hljs-attribute">backface-visibility</span>: hidden;
  -webkit-<span class="hljs-attribute">font-smoothing</span>: subpixel-antialiased;
}

<span class="hljs-keyword">@keyframes</span> optimizedMove {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">300px</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.5</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>;
  }
}
</code></pre>
<h3 data-id="heading-24">å…«ã€ç°ä»£CSSç‰¹æ€§ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-25">8.1 CSSè‡ªå®šä¹‰å±æ€§ï¼ˆCSSå˜é‡ï¼‰</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#2ecc71</span>;
  <span class="hljs-attr">--spacing-unit</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attr">--border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attr">--transition-speed</span>: <span class="hljs-number">0.3s</span>;
  <span class="hljs-attr">--box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
  <span class="hljs-attr">--gradient-bg</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-built_in">var</span>(--primary-color), <span class="hljs-built_in">var</span>(--secondary-color));
}

<span class="hljs-selector-class">.component</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--gradient-bg);
  <span class="hljs-attribute">padding</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--spacing-unit) * <span class="hljs-number">3</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">var</span>(--border-radius);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-built_in">var</span>(--transition-speed) ease;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-built_in">var</span>(--box-shadow);
}

<span class="hljs-selector-class">.component</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#2980b9</span>; <span class="hljs-comment">/* åŠ¨æ€ä¿®æ”¹å˜é‡ */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">40px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.2</span>);
}

<span class="hljs-comment">/* JSä¸CSSå˜é‡äº¤äº’ */</span>
const element = document<span class="hljs-selector-class">.querySelector</span>('<span class="hljs-selector-class">.component</span>');
element<span class="hljs-selector-class">.style</span><span class="hljs-selector-class">.setProperty</span>('<span class="hljs-attr">--primary-color</span>', '<span class="hljs-selector-id">#e74c3c</span>');
</code></pre>
<h4 data-id="heading-26">8.2 ç°ä»£å¸ƒå±€æŠ€æœ¯æ•´åˆ</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ç°ä»£å“åº”å¼å¸ƒå±€ç³»ç»Ÿ */</span>
<span class="hljs-selector-class">.modern-layout</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: 
    [full-start] <span class="hljs-built_in">minmax</span>(<span class="hljs-built_in">var</span>(--spacing-unit), <span class="hljs-number">1</span>fr) 
    [content-start] <span class="hljs-built_in">min</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">2rem</span>, <span class="hljs-number">1200px</span>) 
    [content-end] <span class="hljs-built_in">minmax</span>(<span class="hljs-built_in">var</span>(--spacing-unit), <span class="hljs-number">1</span>fr) 
    [full-end];
  
  <span class="hljs-attribute">gap</span>: <span class="hljs-built_in">var</span>(--spacing-unit);
}

<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">grid-column</span>: content;
  
  <span class="hljs-comment">/* å†…éƒ¨ä½¿ç”¨Flexbox */</span>
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-wrap</span>: wrap;
  <span class="hljs-attribute">gap</span>: <span class="hljs-built_in">var</span>(--spacing-unit);
}

<span class="hljs-comment">/* å­å…ƒç´ ä½¿ç”¨CSS Gridè‡ªåŠ¨å¸ƒå±€ */</span>
<span class="hljs-selector-class">.sub-item</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">200px</span>, <span class="hljs-number">1</span>fr));
  <span class="hljs-attribute">gap</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-built_in">var</span>(--spacing-unit) * <span class="hljs-number">2</span>);
}

<span class="hljs-comment">/* å®¹å™¨æŸ¥è¯¢ï¼ˆå‰æ²¿ç‰¹æ€§ï¼‰ */</span>
<span class="hljs-keyword">@container</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">400px</span>) {
  <span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">2</span>fr;
  }
}
</code></pre>
<h3 data-id="heading-27">ä¹ã€æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-28">9.1 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ç¡¬ä»¶åŠ é€ŸæŠ€å·§ */</span>
<span class="hljs-selector-class">.optimized-element</span> {
  <span class="hljs-comment">/* è§¦å‘GPUåŠ é€Ÿ */</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateZ</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">backface-visibility</span>: hidden;
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>;
  
  <span class="hljs-comment">/* å‡å°‘å¸ƒå±€æŠ–åŠ¨ */</span>
  <span class="hljs-attribute">will-change</span>: transform, opacity;
  
  <span class="hljs-comment">/* ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ */</span>
  <span class="hljs-attribute">animation</span>: optimizedAnimation <span class="hljs-number">0.3s</span> ease forwards;
}

<span class="hljs-keyword">@keyframes</span> optimizedAnimation {
  <span class="hljs-selector-tag">from</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">20px</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.95</span>);
  }
  <span class="hljs-selector-tag">to</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-comment">/* å‡å°‘é‡æ’å’Œé‡ç»˜ */</span>
<span class="hljs-selector-class">.stable-layout</span> {
  <span class="hljs-comment">/* é¿å…é¢‘ç¹ä¿®æ”¹ä¼šå¼•èµ·é‡æ’çš„å±æ€§ */</span>
  <span class="hljs-attribute">position</span>: fixed; <span class="hljs-comment">/* è„±ç¦»æ–‡æ¡£æµ */</span>
  
  <span class="hljs-comment">/* ä½¿ç”¨transformä»£æ›¿top/left */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* ä½¿ç”¨content-visibilityä¼˜åŒ–æ¸²æŸ“ */</span>
<span class="hljs-selector-class">.large-list</span> {
  <span class="hljs-attribute">content-visibility</span>: auto;
  <span class="hljs-attribute">contain</span>-intrinsic-size: <span class="hljs-number">0</span> <span class="hljs-number">500px</span>; <span class="hljs-comment">/* é¢„ä¼°é«˜åº¦ */</span>
}
</code></pre>
<h4 data-id="heading-29">9.2 ç°ä»£CSSå·¥ä½œæµç¨‹</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/* å±‚å å±‚ç®¡ç† */</span>
<span class="hljs-variable">@layer</span> base, components, utilities;

<span class="hljs-variable">@layer</span> base {
  <span class="hljs-comment">/* é‡ç½®æ ·å¼å’ŒåŸºç¡€æ ·å¼ */</span>
  * { <span class="hljs-attribute">box-sizing</span>: border-box; }
  body { <span class="hljs-attribute">font-family</span>: system-ui, sans-serif; }
}

<span class="hljs-variable">@layer</span> components {
  <span class="hljs-comment">/* ç»„ä»¶æ ·å¼ */</span>
  <span class="hljs-selector-class">.card</span> { <span class="hljs-comment">/* å¡ç‰‡ç»„ä»¶æ ·å¼ */</span> }
  .button { <span class="hljs-comment">/* æŒ‰é’®ç»„ä»¶æ ·å¼ */</span> }
}

<span class="hljs-variable">@layer</span> utilities {
  <span class="hljs-comment">/* å·¥å…·ç±» */</span>
  <span class="hljs-selector-class">.text-center</span> { <span class="hljs-attribute">text-align</span>: center; }
  .flex-center { <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">align-items</span>: center; <span class="hljs-attribute">justify-content</span>: center; }
}

<span class="hljs-comment">/* å®¹å™¨æŸ¥è¯¢æ”¯æŒ */</span>
<span class="hljs-variable">@container</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">400px</span>) {
  <span class="hljs-selector-class">.responsive-card</span> {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">2</span>fr;
  }
}

<span class="hljs-comment">/* åª’ä½“æŸ¥è¯¢çš„ç°ä»£å†™æ³• */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">width</span> &gt;= <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.responsive-element</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.125rem</span>;
  }
}
</code></pre>
<h3 data-id="heading-30">ç»“è®ºï¼šCSS3çš„æ¼”è¿›ä¸æœªæ¥è¶‹åŠ¿</h3>
<p>CSS3çš„å‘å±•å·²ç»ä»ç®€å•çš„æ ·å¼æè¿°è¯­è¨€æ¼”å˜ä¸ºåŠŸèƒ½å¼ºå¤§çš„å¸ƒå±€å’ŒåŠ¨ç”»å¼•æ“ã€‚é€šè¿‡æŒæ¡Flexboxå’ŒGridï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå“åº”å¼ã€çµæ´»çš„å¸ƒå±€ç³»ç»Ÿï¼›é€šè¿‡transformã€transitionå’Œanimationï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæµç•…çš„äº¤äº’åŠ¨æ•ˆï¼›é€šè¿‡3Då˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºWebåº”ç”¨å¢åŠ æ·±åº¦å’Œç©ºé—´æ„Ÿã€‚</p>
<p><strong>å…³é”®è¦ç‚¹æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>å¸ƒå±€é€‰æ‹©</strong>ï¼šFlexboxç”¨äºä¸€ç»´å¸ƒå±€ï¼ŒGridç”¨äºäºŒç»´å¸ƒå±€</li>
<li><strong>å±…ä¸­ç­–ç•¥</strong>ï¼šæ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©æœ€åˆé€‚çš„å±…ä¸­æ–¹æ¡ˆ</li>
<li><strong>åŠ¨ç”»ä¼˜åŒ–</strong>ï¼šä¼˜å…ˆä½¿ç”¨transformå’Œopacityï¼Œå‡å°‘å¸ƒå±€æŠ–åŠ¨</li>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šåˆç†ä½¿ç”¨GPUåŠ é€Ÿï¼Œé¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€</li>
<li><strong>æ¸è¿›å¢å¼º</strong>ï¼šä½¿ç”¨ç‰¹æ€§æ£€æµ‹ï¼Œä¸ºä¸æ”¯æŒçš„ç¯å¢ƒæä¾›é™çº§æ–¹æ¡ˆ</li>
</ol>
<p>éšç€CSS Container Queriesã€Subgridã€CSS Nestingç­‰æ–°ç‰¹æ€§çš„é€æ­¥è½åœ°ï¼ŒCSSçš„èƒ½åŠ›è¾¹ç•Œè¿˜åœ¨ä¸æ–­æ‰©å±•ã€‚ä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼ŒæŒç»­å­¦ä¹ å¹¶æŒæ¡è¿™äº›ç°ä»£CSSç‰¹æ€§ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½ã€é«˜ç”¨æˆ·ä½“éªŒWebåº”ç”¨çš„å…³é”®æ‰€åœ¨ã€‚</p>
<p><strong>å­¦ä¹ è·¯å¾„å»ºè®®ï¼š</strong></p>
<ol>
<li>æŒæ¡åŸºç¡€é€‰æ‹©å™¨å’Œç›’æ¨¡å‹</li>
<li>æ·±å…¥å­¦ä¹ Flexboxå’ŒGridå¸ƒå±€</li>
<li>å®è·µå˜æ¢å’Œè¿‡æ¸¡æ•ˆæœ</li>
<li>æ¢ç´¢å…³é”®å¸§åŠ¨ç”»å’Œ3Då˜æ¢</li>
<li>å­¦ä¹ æ€§èƒ½ä¼˜åŒ–å’Œç°ä»£å·¥ä½œæµç¨‹</li>
</ol>
<p>é€šè¿‡ä¸æ–­å®è·µå’Œæ¢ç´¢ï¼Œä½ å°†èƒ½å¤Ÿåˆ©ç”¨CSS3çš„å¼ºå¤§åŠŸèƒ½ï¼Œåˆ›é€ å‡ºæ—¢ç¾è§‚åˆé«˜æ€§èƒ½çš„ç°ä»£Webç•Œé¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JAVAåŸºç¡€ä¹‹é›†åˆæ¡†æ¶è¯¦è§£]]></title>    <link>https://juejin.cn/post/7600606150732103723</link>    <guid>https://juejin.cn/post/7600606150732103723</guid>    <pubDate>2026-01-29T10:03:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600606150732103723" data-draft-id="7600602502633242665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JAVAåŸºç¡€ä¹‹é›†åˆæ¡†æ¶è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-29T10:03:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JAVAåŸºç¡€ä¹‹é›†åˆæ¡†æ¶è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:03:38.000Z" title="Thu Jan 29 2026 10:03:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fxiaoxi%2Fp%2F6089984.html" target="_blank" title="https://www.cnblogs.com/xiaoxi/p/6089984.html" ref="nofollow noopener noreferrer">www.cnblogs.com/xiaoxi/p/60â€¦</a></p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.importnew.com%2F16658.html" target="_blank" title="http://www.importnew.com/16658.html" ref="nofollow noopener noreferrer">www.importnew.com/16658.html</a></p>
<h2 data-id="heading-0">1.é›†åˆæ¡†æ¶å›¾</h2>
<h4 data-id="heading-1">Javaçš„é›†åˆç±»ä¸»è¦ç”±ä¸¤ä¸ªæ¥å£æ´¾ç”Ÿè€Œå‡ºï¼šCollectionå’ŒMapï¼ŒCollectionå’ŒMapæ˜¯Javaé›†åˆæ¡†æ¶çš„æ ¹æ¥å£ï¼Œè¿™ä¸¤ä¸ªæ¥å£åˆåŒ…å«äº†ä¸€äº›å­æ¥å£æˆ–å®ç°ç±»ã€‚</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/697c837ae9cf450ca74064612d25ed19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=ktZDBq44rLzl07tuBB2pgPKl8CU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">2.Collectionæ¥å£ï¼ˆCollectionåŒ…å«äº†Listå’ŒSetä¸¤å¤§åˆ†æ”¯ã€‚ï¼‰</h2>
<h4 data-id="heading-3">2.1 Listæ¥å£çš„å®ç°ç±»ï¼ˆArrayListï¼ŒVectorï¼ŒLinkedListï¼ŒStackï¼‰</h4>
<h6 data-id="heading-4">(1).ArrayList</h6>
<p>ArrayListæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„,å®ƒå…è®¸ä»»ä½•ç¬¦åˆè§„åˆ™çš„å…ƒç´ æ’å…¥ç”šè‡³åŒ…æ‹¬null,æ¯ä¸€ä¸ªArrayListéƒ½æœ‰ä¸€ä¸ªåˆå§‹å®¹é‡ï¼ˆ10ï¼‰,éšç€å®¹å™¨ä¸­çš„å…ƒç´ ä¸æ–­å¢åŠ ï¼Œå®¹å™¨çš„å¤§å°ä¹Ÿä¼šéšç€å¢åŠ ã€‚åœ¨æ¯æ¬¡å‘å®¹å™¨ä¸­å¢åŠ å…ƒç´ çš„åŒæ—¶éƒ½ä¼šè¿›è¡Œå®¹é‡æ£€æŸ¥ï¼Œå½“å¿«æº¢å‡ºæ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹æ“ä½œã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æ˜ç¡®æ‰€æ’å…¥å…ƒç´ çš„å¤šå°‘ï¼Œæœ€å¥½æŒ‡å®šä¸€ä¸ªåˆå§‹å®¹é‡å€¼ï¼Œé¿å…è¿‡å¤šçš„è¿›è¡Œæ‰©å®¹æ“ä½œè€Œæµªè´¹æ—¶é—´ã€æ•ˆç‡ã€‚</p>
<h6 data-id="heading-5">æ³¨æ„ï¼š  ArrayListæ“…é•¿äºéšæœºè®¿é—®ã€‚åŒæ—¶ArrayListæ˜¯éåŒæ­¥çš„ã€‚</h6>
<h6 data-id="heading-6">(2).Vector</h6>
<p>ä¸ArrayListç›¸ä¼¼ï¼Œä½†æ˜¯Vectoræ˜¯åŒæ­¥çš„ã€‚æ‰€ä»¥è¯´Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„åŠ¨æ€æ•°ç»„ã€‚å®ƒçš„æ“ä½œä¸ArrayListå‡ ä¹ä¸€æ ·ã€‚</p>
<h6 data-id="heading-7">(3).LinkedList</h6>
<p>åŒæ ·å®ç°Listæ¥å£çš„LinkedListä¸ArrayListä¸åŒï¼ŒArrayListæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œè€ŒLinkedListæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨,
ç”±äºå®ç°çš„æ–¹å¼ä¸åŒï¼ŒLinkedListä¸èƒ½éšæœºè®¿é—®ï¼Œå®ƒæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯è¦æŒ‰ç…§åŒé‡é“¾è¡¨çš„éœ€è¦æ‰§è¡Œã€‚åœ¨åˆ—è¡¨ä¸­ç´¢å¼•çš„æ“ä½œå°†ä»å¼€å¤´æˆ–ç»“å°¾éå†åˆ—è¡¨ï¼ˆä»é è¿‘æŒ‡å®šç´¢å¼•çš„ä¸€ç«¯ï¼‰ã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥é€šè¿‡è¾ƒä½çš„ä»£ä»·åœ¨Listä¸­è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚
ä¸ArrayListä¸€æ ·ï¼ŒLinkedListä¹Ÿæ˜¯éåŒæ­¥çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªListï¼Œåˆ™å¿…é¡»è‡ªå·±å®ç°è®¿é—®åŒæ­¥ã€‚</p>
<h6 data-id="heading-8">æ³¨æ„ï¼šåˆ›å»ºListæ—¶æ„é€ ä¸€ä¸ªåŒæ­¥çš„Listï¼šList list = Collections.synchronizedList(new LinkedList(...));</h6>
<p>######(4).Stack
Stackç»§æ‰¿è‡ªVectorï¼Œå®ç°ä¸€ä¸ªåè¿›å…ˆå‡ºçš„å †æ ˆã€‚Stackæä¾›5ä¸ªé¢å¤–çš„æ–¹æ³•ä½¿å¾—Vectorå¾—ä»¥è¢«å½“ä½œå †æ ˆä½¿ç”¨ã€‚åŸºæœ¬çš„pushå’Œpop æ–¹æ³•ï¼Œè¿˜æœ‰peekæ–¹æ³•å¾—åˆ°æ ˆé¡¶çš„å…ƒç´ ï¼Œemptyæ–¹æ³•æµ‹è¯•å †æ ˆæ˜¯å¦ä¸ºç©ºï¼Œsearchæ–¹æ³•æ£€æµ‹ä¸€ä¸ªå…ƒç´ åœ¨å †æ ˆä¸­çš„ä½ç½®ã€‚Stackåˆšåˆ›å»ºåæ˜¯ç©ºæ ˆã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp">   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testStack</span>()</span> {
        <span class="hljs-comment">/***
         * æ ˆæ˜¯ä¸€ç§åªèƒ½åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨
         * ç‰¹æ€§ï¼šå…ˆè¿›åå‡º
         */</span>
        Stack&lt;String&gt; stack=<span class="hljs-keyword">new</span> Stack&lt;&gt;();
        <span class="hljs-comment">//è¿›æ ˆpush()</span>
        stack.push(<span class="hljs-string">"1"</span>);
        stack.push(<span class="hljs-string">"2"</span>);
        stack.push(<span class="hljs-string">"3"</span>);
        stack.push(<span class="hljs-string">"4"</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"statck data:"</span>+stack.toString());
        <span class="hljs-comment">// å–æ ˆé¡¶å€¼ï¼ˆä¸å‡ºæ ˆï¼‰</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"stack top:"</span>+stack.peek());
        <span class="hljs-comment">//å‡ºæ ˆ</span>
        <span class="hljs-comment">//  stack.pop();</span>
        <span class="hljs-comment">// stack.pop();</span>
        <span class="hljs-comment">//stack.pop();</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"stack data:"</span>+stack.toString());
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"stack is empty:"</span>+stack.empty());
        <span class="hljs-built_in">int</span> index=stack.search(<span class="hljs-string">"3"</span>);<span class="hljs-comment">//è®¡æ•°ä»é¡¶éƒ¨å¼€å§‹</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"stack search index:"</span>+index);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"stack search result:"</span>+ stack.<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>));

        List&lt;String&gt; list=<span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        list.<span class="hljs-keyword">add</span>(<span class="hljs-string">"1"</span>);
        list.<span class="hljs-keyword">add</span>(<span class="hljs-string">"2"</span>);
        list.<span class="hljs-keyword">add</span>(<span class="hljs-string">"3"</span>);
        list.<span class="hljs-keyword">add</span>(<span class="hljs-string">"4"</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"list is empty:"</span>+list.<span class="hljs-keyword">get</span>(<span class="hljs-number">3</span>));
        Iterator&lt;String&gt; iterator=list.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()){
            System.<span class="hljs-keyword">out</span>.println(iterator.next());
        }
    }

</code></pre>
<h4 data-id="heading-9">2.2 Setæ¥å£çš„å®ç°ç±»ï¼ˆHashSetï¼ŒLinkedHashSetï¼ŒTreeSetï¼‰</h4>
<h6 data-id="heading-10">(1)HashSet</h6>
<p>HashSet æ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„é›†åˆã€‚å®ƒæ˜¯ç”±HashMapå®ç°çš„ï¼Œä¸ä¿è¯å…ƒç´ çš„é¡ºåº(è¿™é‡Œæ‰€è¯´çš„æ²¡æœ‰é¡ºåºæ˜¯æŒ‡ï¼šå…ƒç´ æ’å…¥çš„é¡ºåºä¸è¾“å‡ºçš„é¡ºåºä¸ä¸€è‡´)ï¼Œè€Œä¸”HashSetå…è®¸ä½¿ç”¨null å…ƒç´ ã€‚HashSetæ˜¯éåŒæ­¥çš„ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå“ˆå¸Œsetï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¯¥setï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚ HashSetæŒ‰Hashç®—æ³•æ¥å­˜å‚¨é›†åˆçš„å…ƒç´ ï¼Œå› æ­¤å…·æœ‰å¾ˆå¥½çš„å­˜å–å’ŒæŸ¥æ‰¾æ€§èƒ½ã€‚</p>
<h6 data-id="heading-11">æ³¨æ„ï¼šHashSetæ˜¯ç”±HashMapå®ç°ï¼Œä¸ä¿è¯å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå¯ä»¥å­˜æ”¾nullå€¼ï¼Œä»…ä»…èƒ½å¤Ÿå­˜å…¥ä¸€ä¸ªnullå€¼ã€‚</h6>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testHashSet</span>()</span> {
        <span class="hljs-comment">/****
         * å…ƒç´ ä¸é‡å¤
         */</span>
        Set&lt;String&gt; hashSet=<span class="hljs-keyword">new</span> HashSet&lt;&gt;();
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"javabbb"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java01"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java01"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java03"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java02"</span>);
        Set&lt;String&gt;  hashSet1=<span class="hljs-keyword">new</span> HashSet&lt;&gt;();
        hashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java05"</span>);
        hashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java04"</span>);
        hashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-string">"javaaaa"</span>);
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-literal">null</span>);<span class="hljs-comment">//å¯ä»¥æ’å…¥null</span>
        hashSet.<span class="hljs-keyword">add</span>(<span class="hljs-literal">null</span>);
        hashSet.addAll(hashSet1);
        boolean isEmpty=hashSet.isEmpty();
        <span class="hljs-comment">//éå†</span>
        Iterator&lt;String&gt; iterator= hashSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()){
            System.<span class="hljs-keyword">out</span>.println(iterator.next());
        }
    }
</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2ca37f2546648ffac63ed06ed514299~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=cewG4WbE%2FfcaXQXtmcKExgrcdj4%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-12">(2)LinkedHashSet</h6>
<p>LinkedHashSetç»§æ‰¿è‡ªHashSetï¼Œå…¶åº•å±‚æ˜¯åŸºäºLinkedHashMapæ¥å®ç°çš„ï¼Œæœ‰åºï¼ŒéåŒæ­¥ã€‚LinkedHashSeté›†åˆåŒæ ·æ˜¯æ ¹æ®å…ƒç´ çš„hashCodeå€¼æ¥å†³å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œä½†æ˜¯å®ƒåŒæ—¶ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ¬¡åºã€‚è¿™æ ·ä½¿å¾—å…ƒç´ çœ‹èµ·æ¥åƒæ˜¯ä»¥æ’å…¥é¡ºåºä¿å­˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éå†è¯¥é›†åˆæ—¶å€™ï¼ŒLinkedHashSetå°†ä¼šä»¥å…ƒç´ çš„æ·»åŠ é¡ºåºè®¿é—®é›†åˆçš„å…ƒç´ ã€‚</p>
<h6 data-id="heading-13">æ³¨æ„ï¼šLinkedHashSetåº•å±‚æ˜¯åŸºäºLinkedHashMapæ¥å®ç°</h6>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testLinkedHashSet</span>()</span> {
        <span class="hljs-comment">/****
         * å› ä¸ºæ˜¯é“¾è¡¨ï¼Œæ‰€ä»¥æœ‰åºè¾“å‡º
         * å…ƒç´ ä¸é‡å¤
         */</span>
        Set&lt;String&gt; linkedHashSet=<span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;();
        linkedHashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java01"</span>);
        linkedHashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java01"</span>);
        linkedHashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java02"</span>);
        linkedHashSet.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java03"</span>);
        Set&lt;String&gt; linkedHashSet1=<span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;();
        linkedHashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java04"</span>);
        linkedHashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-string">"java05"</span>);
        linkedHashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-literal">null</span>);
        linkedHashSet1.<span class="hljs-keyword">add</span>(<span class="hljs-literal">null</span>);
        linkedHashSet.addAll(linkedHashSet1);
        <span class="hljs-comment">//éå†</span>
        Iterator&lt;String&gt; iterator= linkedHashSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()){
            System.<span class="hljs-keyword">out</span>.println(iterator.next());
        }

    }
</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4728e6efbc3a44b49cb555efe6ba0568~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=Fh8kYPMdzRqc9FcV8MZkfWSzMaE%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-14">(3)TreeSet</h6>
<p>TreeSetæ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œå…¶åº•å±‚æ˜¯åŸºäºTreeMapå®ç°çš„ï¼Œéçº¿ç¨‹å®‰å…¨ã€‚TreeSetå¯ä»¥ç¡®ä¿é›†åˆå…ƒç´ å¤„äºæ’åºçŠ¶æ€ã€‚TreeSetæ”¯æŒä¸¤ç§æ’åºæ–¹å¼ï¼Œè‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åºï¼Œå…¶ä¸­è‡ªç„¶æ’åºä¸ºé»˜è®¤çš„æ’åºæ–¹å¼ã€‚å½“æˆ‘ä»¬æ„é€ TreeSetæ—¶ï¼Œè‹¥ä½¿ç”¨ä¸å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œåˆ™TreeSetçš„ä½¿ç”¨è‡ªç„¶æ¯”è¾ƒå™¨ï¼›è‹¥ç”¨æˆ·éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨ï¼Œåˆ™éœ€è¦ä½¿ç”¨å¸¦æ¯”è¾ƒå™¨çš„å‚æ•°ã€‚</p>
<h6 data-id="heading-15">æ³¨æ„ï¼šTreeSetåº•å±‚æ˜¯åŸºäºTreeMapæ¥å®ç°ï¼ŒSeté›†åˆéƒ½æ˜¯éçº¿ç¨‹å®‰å…¨çš„</h6>
<pre><code class="hljs language-csharp" lang="csharp">
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testIntegerSort</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Integerå¯¹è±¡è‡ªç„¶æ’åºï¼š"</span>);
        TreeSet&lt;Integer&gt; treeSetFirst = <span class="hljs-keyword">new</span> TreeSet&lt;&gt;();
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-number">2</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-number">1</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-number">4</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-number">3</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-number">5</span>);
        Iterator&lt;Integer&gt; iterator=treeSetFirst.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()){
                System.<span class="hljs-keyword">out</span>.println(iterator.next());
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDictionarySort</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Dictionaryå¯¹è±¡è‡ªç„¶æ’åºï¼š"</span>);
        TreeSet&lt;String&gt; treeSetFirst = <span class="hljs-keyword">new</span> TreeSet&lt;&gt;();
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"Baidu"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"Tecent"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"Ali"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"WanDa"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"HengDa"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"12"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"23a#"</span>);
        treeSetFirst.<span class="hljs-keyword">add</span>(<span class="hljs-string">"#"</span>);
        Iterator&lt;String&gt; iterator=treeSetFirst.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()){
            System.<span class="hljs-keyword">out</span>.println(iterator.next());
        }
    }


    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testCompatorSort</span>()</span> {
        Set&lt;Student&gt; treeSet=<span class="hljs-keyword">new</span> TreeSet&lt;&gt;();
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">"tecent"</span>,<span class="hljs-number">2</span>));
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">"JD"</span>,<span class="hljs-number">1</span>));
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">"wanda"</span>,<span class="hljs-number">3</span>));
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">"baidu"</span>,<span class="hljs-number">2</span>));
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">"ali"</span>,<span class="hljs-number">2</span>));
        treeSet.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">"tecent"</span>,<span class="hljs-number">2</span>));<span class="hljs-comment">//é‡å¤çš„å…ƒç´ è¢«å‰”é™¤äº†</span>
        System.<span class="hljs-keyword">out</span>.println(treeSet);
        Iterator itTSet = treeSet.iterator();<span class="hljs-comment">//éå†è¾“å‡º</span>
        <span class="hljs-keyword">while</span>(itTSet.hasNext()){
            System.<span class="hljs-keyword">out</span>.print(itTSet.next() + <span class="hljs-string">"\n"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSubHeadTailSet</span>()</span> {
        TreeSet nums = <span class="hljs-keyword">new</span> TreeSet();
        nums.<span class="hljs-keyword">add</span>(<span class="hljs-number">5</span>);
        nums.<span class="hljs-keyword">add</span>(<span class="hljs-number">2</span>);
        nums.<span class="hljs-keyword">add</span>(<span class="hljs-number">3</span>);
        nums.<span class="hljs-keyword">add</span>(<span class="hljs-number">8</span>);
        nums.<span class="hljs-keyword">add</span>(<span class="hljs-number">8</span>);
        <span class="hljs-comment">//è¾“å‡ºé›†åˆå…ƒç´ ï¼Œå¯ä»¥çœ‹åˆ°é›†åˆå…ƒç´ å·²ç»å¤„äºæ’åºçŠ¶æ€ï¼Œè¾“å‡ºã€2ï¼Œ3ï¼Œ5ï¼Œ8ã€‘</span>
        System.<span class="hljs-keyword">out</span>.println(nums);
        <span class="hljs-comment">//è¾“å‡ºæ’åºåé›†åˆé‡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ 2</span>
        System.<span class="hljs-keyword">out</span>.println(nums.first());
        <span class="hljs-comment">//è¾“å‡ºæ’åºåé›†åˆé‡Œæœ€åä¸€ä¸ªå…ƒç´ </span>
        System.<span class="hljs-keyword">out</span>.println(nums.last());
        <span class="hljs-comment">//è¾“å‡ºå°äº4çš„é›†åˆï¼Œä¸åŒ…å«4ï¼Œè¾“å‡ºã€2ï¼Œ3ã€‘</span>
        System.<span class="hljs-keyword">out</span>.println(nums.headSet(<span class="hljs-number">4</span>));
        <span class="hljs-comment">//è¾“å‡ºå¤§äº5çš„é›†åˆï¼Œå¦‚æœseté›†åˆä¸­æœ‰5ï¼Œå­é›†ä¸­è¿˜åº”è¯¥æœ‰5ï¼Œè¾“å‡ºã€5ï¼Œ8ã€‘</span>
        System.<span class="hljs-keyword">out</span>.println(nums.tailSet(<span class="hljs-number">5</span>));
        <span class="hljs-comment">//è¾“å‡ºå¤§äº2ï¼Œå°äº5çš„å­é›†ï¼ŒåŒ…æ‹¬2ï¼Œä¸åŒ…æ‹¬5ï¼Œè¾“å‡ºé›†åˆã€2ï¼Œ3ã€‘</span>
        System.<span class="hljs-keyword">out</span>.println(nums.subSet(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>));
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-title">implements</span> <span class="hljs-title">Comparable</span> {
        <span class="hljs-built_in">int</span> num;
        String name;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span>(<span class="hljs-params"> String name,<span class="hljs-built_in">int</span> num</span>)</span> {
            <span class="hljs-keyword">this</span>.num = num;
            <span class="hljs-keyword">this</span>.name = name;
        }

        @Override
        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"StudentNo:"</span> + num + <span class="hljs-string">" ,StudentName:"</span> + name      ;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getNum</span>()</span> {
            <span class="hljs-keyword">return</span> num;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setNum</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> num</span>)</span> {
            <span class="hljs-keyword">this</span>.num = num;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span>()</span> {
            <span class="hljs-keyword">return</span> name;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span>(<span class="hljs-params">String name</span>)</span> {
            <span class="hljs-keyword">this</span>.name = name;
        }

        @Override
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">compareTo</span>(<span class="hljs-params">Object o</span>)</span> {
            Student student= (Student) o;
            <span class="hljs-keyword">if</span>(num&lt;student.getNum()){<span class="hljs-comment">//å‡åºæ’åˆ—</span>
                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
            }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(num==student.getNum()){
                <span class="hljs-keyword">return</span> name.compareTo(student.getName());
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
            }

        }
    }

</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/693896ec086d4db6b161e32da2ee1994~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=XC3c%2F18pBYAk%2B1evY5ipTZNm9Rs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-16">3.Mapæ¥å£</h2>
<p>Mapä¸Listã€Setæ¥å£ä¸åŒï¼Œå®ƒæ˜¯ç”±ä¸€ç³»åˆ—é”®å€¼å¯¹ç»„æˆçš„é›†åˆï¼Œæä¾›äº†keyåˆ°Valueçš„æ˜ å°„ã€‚åŒæ—¶å®ƒä¹Ÿæ²¡æœ‰ç»§æ‰¿Collectionã€‚åœ¨Mapä¸­å®ƒä¿è¯äº†keyä¸valueä¹‹é—´çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueï¼Œæ‰€ä»¥å®ƒä¸èƒ½å­˜åœ¨ç›¸åŒçš„keyå€¼ï¼Œå½“ç„¶valueå€¼å¯ä»¥ç›¸åŒã€‚
####(1).HashMap
HashMapå¯ä»¥é€šè¿‡è°ƒç”¨Collectionsçš„é™æ€æ–¹æ³•Collections.synchronizedMap(Map map)è¿›è¡ŒåŒæ­¥,æœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºNull,ä¸æ”¯æŒçº¿ç¨‹çš„åŒæ­¥ï¼Œæ— åº</p>
<pre><code class="hljs language-arduino" lang="arduino">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">testHashMap</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">/***
         * hashmapçš„keyå’Œvalueéƒ½å¯ä»¥ä¸ºnull
         */</span>
        Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; i++) {
            map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"key"</span> + i, <span class="hljs-string">"value"</span> + i);
        }
        map.<span class="hljs-built_in">put</span>(null,<span class="hljs-string">"value4"</span>);
        map.<span class="hljs-built_in">put</span>(null,<span class="hljs-string">"value5"</span>);
        map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"key6"</span>,null);
        map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"key7"</span>,null);
        map.<span class="hljs-built_in">get</span>(<span class="hljs-string">"key"</span> + <span class="hljs-number">5</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> key : map.<span class="hljs-built_in">keySet</span>()) {
            System.out.<span class="hljs-built_in">println</span>(map.<span class="hljs-built_in">get</span>(key));
        }
    }
</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fb84ae31ab24f44ace52344f988ac56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=Zfg8yqrOrPAllRjo9yXH6%2BFP5ts%3D" alt="image.png" loading="lazy"/></p>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5cc50c06d543cc95967cedd0dadf13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=p7XSOLsA15EyCbk%2Fb0fO0bn22KM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-17">(2).LinkedHashMap</h4>
<p>LinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒä¿ç•™æ’å…¥çš„é¡ºåºï¼Œå¦‚æœéœ€è¦è¾“å‡ºçš„é¡ºåºå’Œè¾“å…¥æ—¶çš„ç›¸åŒï¼Œé‚£ä¹ˆå°±é€‰ç”¨LinkedHashMapã€‚å…è®¸ä½¿ç”¨nullå€¼å’Œnullé”®</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">testLinkHashMap</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">//linkedhashmap  extends hashmap æ¯”hashmapåŠŸèƒ½æ›´å¼ºå¤§</span>
        Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; map = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; i++) {
            map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"key"</span> + i, <span class="hljs-string">"value"</span> + i);
        }
        map.<span class="hljs-built_in">put</span>(null,<span class="hljs-string">"value4"</span>);
        map.<span class="hljs-built_in">put</span>(null,<span class="hljs-string">"value5"</span>);
        map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"key6"</span>,null);
        map.<span class="hljs-built_in">put</span>(<span class="hljs-string">"key7"</span>,null);
        map.<span class="hljs-built_in">get</span>(<span class="hljs-string">"key"</span> + <span class="hljs-number">5</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> key : map.<span class="hljs-built_in">keySet</span>()) {
            System.out.<span class="hljs-built_in">println</span>(map.<span class="hljs-built_in">get</span>(key));
        }
    }
</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1290c9d37a64010aca5e26701f5e507~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=fAMEPpPaD5i%2BP88ezwOkK%2FVSYfs%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-18">(2).Hashtable</h4>
<p>çº¿ç¨‹åŒæ­¥ï¼ŒåŒæ—¶keyï¼Œvalueéƒ½ä¸å¯ä»¥ä¸ºnull,æ— åºçš„</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> void testHashtable() {
        /***
         * çº¿ç¨‹åŒæ­¥çš„ï¼ŒåŒæ—¶<span class="hljs-keyword">key</span>ï¼Œvalueéƒ½ä¸å¯ä»¥ä¸ºnullï¼Œæ— åºçš„
         */
        Hashtable&lt;<span class="hljs-type">String</span>,<span class="hljs-type">Object</span>&gt; hashtable = <span class="hljs-built_in">new</span> Hashtable();
        hashtable.put(<span class="hljs-string">"baidu"</span>,<span class="hljs-string">"101"</span>);
        hashtable.put(<span class="hljs-string">"ali"</span>,<span class="hljs-string">"102"</span>);
        hashtable.put(<span class="hljs-string">"tencent"</span>,<span class="hljs-string">"103"</span>);
        hashtable.put(<span class="hljs-string">"wanda"</span>,<span class="hljs-string">"105"</span>);
        hashtable.put(<span class="hljs-string">"pingan"</span>,<span class="hljs-string">"107"</span>);
        hashtable.put(<span class="hljs-string">"hengda"</span>,<span class="hljs-string">"106"</span>);
        hashtable.put(<span class="hljs-string">"transsion"</span>,<span class="hljs-string">"104"</span>);
        // hashtable.put(null,<span class="hljs-string">"2"</span>);//java.lang.NullPointerException
        //  hashtable.put(<span class="hljs-string">"wanke"</span>,null);//java.lang.NullPointerException
        <span class="hljs-keyword">for</span>(<span class="hljs-type">String</span> <span class="hljs-keyword">key</span>:hashtable.keySet()){
            System.out.println(<span class="hljs-keyword">key</span>+<span class="hljs-string">"="</span>+hashtable.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">key</span>));
        }
    }
</code></pre>
<h4 data-id="heading-19">(4).ConCurrentHashMap</h4>
<p>ConcurrentHashMapå’ŒHashTableéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— åºçš„ï¼Œkeyå’Œvalueéƒ½ä¸èƒ½ä¸ºnull,æ€§èƒ½ä¸Šè¦æ¯”Hashtableè¦å¼ºï¼Œæ˜¯ä¸€ä¸ªåŠ å¼ºç‰ˆæœ¬çš„Hashtableã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> void testConcurrentHashMap() {
        /***
         * ConcurrentHashMapå’ŒHashTableéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸­è¿›è¡Œï¼Œ
         * <span class="hljs-keyword">key</span>å’Œvalueéƒ½ä¸èƒ½ä¸ºnull,æ€§èƒ½ä¸Šè¦æ¯”Hashtableè¦å¼º
         * çº¿ç¨‹åŒæ­¥çš„ï¼ŒåŒæ—¶<span class="hljs-keyword">key</span>ï¼Œvalueéƒ½ä¸å¯ä»¥ä¸ºnull
         */
        ConcurrentHashMap&lt;<span class="hljs-type">String</span>,<span class="hljs-type">Object</span>&gt; concurrentHashMap = <span class="hljs-built_in">new</span> ConcurrentHashMap();
        concurrentHashMap.put(<span class="hljs-string">"baidu"</span>,<span class="hljs-string">"101"</span>);
        concurrentHashMap.put(<span class="hljs-string">"ali"</span>,<span class="hljs-string">"102"</span>);
        concurrentHashMap.put(<span class="hljs-string">"tencent"</span>,<span class="hljs-string">"103"</span>);
        concurrentHashMap.put(<span class="hljs-string">"wanda"</span>,<span class="hljs-string">"105"</span>);
        concurrentHashMap.put(<span class="hljs-string">"pingan"</span>,<span class="hljs-string">"107"</span>);
        concurrentHashMap.put(<span class="hljs-string">"hengda"</span>,<span class="hljs-string">"106"</span>);
        concurrentHashMap.put(<span class="hljs-string">"transsion"</span>,<span class="hljs-string">"104"</span>);
        // concurrentHashMap.put(null,<span class="hljs-string">"2"</span>);//java.lang.NullPointerException
        // concurrentHashMap.put(<span class="hljs-string">"wanke"</span>,null);//java.lang.NullPointerException
        <span class="hljs-keyword">for</span>(<span class="hljs-type">String</span> <span class="hljs-keyword">key</span>:concurrentHashMap.keySet()){
            System.out.println(<span class="hljs-keyword">key</span>+<span class="hljs-string">"="</span>+concurrentHashMap.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">key</span>));
        }
    }
</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6257b9ca767c49429aae3df72f3c1340~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=LvHSde58JcxQm%2FlmmP2KZOCyT9I%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-20">(5).TreeMap</h4>
<p>TreeMap æ˜¯ä¸€ä¸ªæœ‰åºçš„key-valueé›†åˆï¼ŒéåŒæ­¥ï¼ŒåŸºäºçº¢é»‘æ ‘ï¼ˆRed-Black treeï¼‰å®ç°ï¼Œæ¯ä¸€ä¸ªkey-valueèŠ‚ç‚¹ä½œä¸ºçº¢é»‘æ ‘çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚TreeMapå­˜å‚¨æ—¶ä¼šè¿›è¡Œæ’åºçš„ï¼Œä¼šæ ¹æ®keyæ¥å¯¹key-valueé”®å€¼å¯¹è¿›è¡Œæ’åºï¼Œå…¶ä¸­æ’åºæ–¹å¼ä¹Ÿæ˜¯åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯è‡ªç„¶æ’åºï¼Œä¸€ç§æ˜¯å®šåˆ¶æ’åºï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚
######æ³¨æ„ï¼škeyä¸èƒ½ä¸ºnull,valueå¯ä»¥ä¸ºnull</p>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-comment">//è‡ªç„¶æ’åºé¡ºåºï¼š</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">naturalSort</span>()</span>{
        <span class="hljs-comment">//ç¬¬ä¸€ç§æƒ…å†µï¼šIntegerå¯¹è±¡</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Integerå¯¹è±¡è‡ªç„¶æ’åºï¼š"</span>);
        TreeMap&lt;Integer,String&gt; treeMapFirst = <span class="hljs-keyword">new</span> TreeMap&lt;Integer, String&gt;();
        treeMapFirst.put(<span class="hljs-number">1</span>,<span class="hljs-string">"jiaboyan"</span>);
        treeMapFirst.put(<span class="hljs-number">6</span>,<span class="hljs-string">"jiaboyan"</span>);
        treeMapFirst.put(<span class="hljs-number">3</span>,<span class="hljs-string">"jiaboyan"</span>);
        treeMapFirst.put(<span class="hljs-number">10</span>,<span class="hljs-string">"jiaboyan"</span>);
        treeMapFirst.put(<span class="hljs-number">7</span>,<span class="hljs-string">"jiaboyan"</span>);
        treeMapFirst.put(<span class="hljs-number">13</span>,<span class="hljs-string">"jiaboyan"</span>);
        <span class="hljs-comment">//treeMapFirst.put(null,"jiaboyan");java.lang.NullPointerException</span>
        treeMapFirst.put(<span class="hljs-number">14</span>,<span class="hljs-literal">null</span>);<span class="hljs-comment">//å¯ä»¥è¿è¡Œ</span>
        System.<span class="hljs-keyword">out</span>.println(treeMapFirst.toString());

        <span class="hljs-comment">//ç¬¬äºŒç§æƒ…å†µ:SortedTestå¯¹è±¡</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"SortedTestå¯¹è±¡æ’åºä¸€ï¼š"</span>);
        TreeMap&lt;SortedTest,String&gt; treeMapSecond = <span class="hljs-keyword">new</span> TreeMap&lt;SortedTest, String&gt;();
        treeMapSecond.put(<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">10</span>),<span class="hljs-string">"jiaboyan"</span>);
        treeMapSecond.put(<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">1</span>),<span class="hljs-string">"jiaboyan"</span>);
        treeMapSecond.put(<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">13</span>),<span class="hljs-string">"jiaboyan"</span>);
        treeMapSecond.put(<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">4</span>),<span class="hljs-string">"jiaboyan"</span>);
        treeMapSecond.put(<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">0</span>),<span class="hljs-string">"jiaboyan"</span>);
        treeMapSecond.put(<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">9</span>),<span class="hljs-string">"jiaboyan"</span>);
        System.<span class="hljs-keyword">out</span>.println(treeMapSecond.toString());
        <span class="hljs-comment">//é»˜è®¤æ˜¯æ ¹æ®keyçš„è‡ªç„¶æ’åºæ¥ç»„ç»‡ï¼ˆæ¯”å¦‚integerçš„å¤§å°ï¼ŒStringçš„å­—å…¸æ’åºï¼‰</span>
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"integerå’Œå­—å…¸å¯¹è±¡æ’åºäºŒï¼š"</span>);
        TreeMap&lt;String,SortedTest&gt; treeMapThree = <span class="hljs-keyword">new</span> TreeMap&lt;String,SortedTest &gt;();
        treeMapThree.put(<span class="hljs-string">"2key1"</span>,<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">10</span>));
        treeMapThree.put(<span class="hljs-string">"1key2"</span>,<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">1</span>));
        treeMapThree.put(<span class="hljs-string">"bey3"</span>,<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">13</span>));
        treeMapThree.put(<span class="hljs-string">"key6"</span>,<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">4</span>));
        treeMapThree.put(<span class="hljs-string">"key5"</span>,<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">0</span>));
        treeMapThree.put(<span class="hljs-string">"key4"</span>,<span class="hljs-keyword">new</span> SortedTest(<span class="hljs-number">9</span>));
        System.<span class="hljs-keyword">out</span>.println(treeMapThree.toString());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SortedTest</span> <span class="hljs-title">implements</span> <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">SortedTest</span>&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> age;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SortedTest</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> age</span>)</span>{
            <span class="hljs-keyword">this</span>.age = age;
        }
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getAge</span>()</span> {
            <span class="hljs-keyword">return</span> age;
        }
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> age</span>)</span> {
            <span class="hljs-keyword">this</span>.age = age;
        }

        @Override
        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"age:"</span>+age;
        }

        <span class="hljs-comment">//è‡ªå®šä¹‰å¯¹è±¡ï¼Œå®ç°compareTo(T o)æ–¹æ³•ï¼š</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">compareTo</span>(<span class="hljs-params">SortedTest sortedTest</span>)</span> {
            <span class="hljs-built_in">int</span> num = <span class="hljs-keyword">this</span>.age - sortedTest.getAge();
            <span class="hljs-comment">//ä¸º0æ—¶å€™ï¼Œä¸¤è€…ç›¸åŒï¼š</span>
            <span class="hljs-keyword">if</span>(num==<span class="hljs-number">0</span>){
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                <span class="hljs-comment">//å¤§äº0æ—¶ï¼Œä¼ å…¥çš„å‚æ•°å°ï¼š</span>
            }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(num&gt;<span class="hljs-number">0</span>){
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                <span class="hljs-comment">//å°äº0æ—¶ï¼Œä¼ å…¥çš„å‚æ•°å¤§ï¼š</span>
            }<span class="hljs-keyword">else</span>{
                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
            }
        }
    }

</code></pre>
<p>è¾“å‡ºç»“æœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889d1235fe2e4b318bacc06d26a6a810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770285817&amp;x-signature=uWiXGqqzZFWQmpJgPse5ZUi%2B%2F7E%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[node å…¨æ ˆ(ä¸‰)ï¼šä½¿ç”¨ React æ„å»ºæœ€å°å¯ç”¨çš„èº«ä½“æŒ‡æ ‡ç½‘ç«™]]></title>    <link>https://juejin.cn/post/7600603245396000808</link>    <guid>https://juejin.cn/post/7600603245396000808</guid>    <pubDate>2026-01-29T09:48:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600603245396000808" data-draft-id="7599922362998882350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="node å…¨æ ˆ(ä¸‰)ï¼šä½¿ç”¨ React æ„å»ºæœ€å°å¯ç”¨çš„èº«ä½“æŒ‡æ ‡ç½‘ç«™"/> <meta itemprop="keywords" content="React.js,Jenkins,Node.js"/> <meta itemprop="datePublished" content="2026-01-29T09:48:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ·®æ¡‘æ¦†"/> <meta itemprop="url" content="https://juejin.cn/user/3397929986176872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            node å…¨æ ˆ(ä¸‰)ï¼šä½¿ç”¨ React æ„å»ºæœ€å°å¯ç”¨çš„èº«ä½“æŒ‡æ ‡ç½‘ç«™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3397929986176872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ·®æ¡‘æ¦†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:48:38.000Z" title="Thu Jan 29 2026 09:48:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ–‡ç« å‰è¨€</h2>
<p><strong>æ°¸è¿œæŠŠåˆ«äººå¯¹ä½ çš„æ‰¹è¯„è®°åœ¨å¿ƒé‡Œï¼Œåˆ«äººçš„è¡¨æ‰¬ï¼Œå°±æŠŠå®ƒå¿˜äº†ã€‚Hello å¤§å®¶å¥½ï½ï¼æˆ‘æ˜¯æ·®æ¡‘æ¦†</strong></p>
<p>ç”±äºä¹‹å‰åœ¨é˜¿é‡Œäº‘ä¸Šè´­ä¹°çš„åŸŸåå·²ç»å®Œæˆäº†ICPå¤‡æ¡ˆï¼Œä½†è¿˜æœªåšå…¬å®‰è”ç½‘å¤‡æ¡ˆï¼Œæ‰€ä»¥æœ¬æ–‡ä¸»è¦æ˜¯è®°å½•ä½¿ç”¨Reactæ„å»ºæœ€å°å¯ç”¨çš„èº«ä½“æŒ‡æ ‡ç½‘ç«™ï¼Œè¯¥ç½‘ç«™å°†ç”¨äºå…¬å®‰è”ç½‘å¤‡æ¡ˆï¼Œç‰¹åœ°è®°å½•ä¸‹ä¸è¯¸ä½åˆ†äº«ï¼Œå¦‚æœ‰é˜è¿°ä¸å¯¹çš„åœ°æ–¹æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ã€‚</p>
<p>è§‚çœ‹åˆ°æ–‡ç« æœ€åçš„è¯ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œå¯ä»¥ç‚¹ä¸ªå…³æ³¨æˆ–è€…ç‚¹ä¸ªèµå“¦ï¼æ„Ÿè°¢ï½â¤ï¸</p>
<h2 data-id="heading-1">å‰ç³»æ–‡ç« </h2>
<p><a href="https://juejin.cn/post/7596926832912252991" target="_blank" title="https://juejin.cn/post/7596926832912252991">nodeå…¨æ ˆ(ä¸€)ï¼šåœ¨é˜¿é‡Œäº‘ Ubuntu ä¸Šéƒ¨ç½² Jenkinsï¼ˆDocker æ–¹å¼ï¼‰å®æˆ˜æŒ‡å—</a></p>
<p><a href="https://juejin.cn/post/7597900782910144531" target="_blank" title="https://juejin.cn/post/7597900782910144531">nodeå…¨æ ˆ(äºŒ)ï¼šExpress æ¥å£è‡ªåŠ¨åŒ–éƒ¨ç½²å®æˆ˜ â€”â€” Jenkins + PM2 ä¸Šçº¿æŒ‡å—</a></p>
<h2 data-id="heading-2">æ–‡ç« ä¸»ä½“</h2>
<p>æ„Ÿè°¢å„ä½è§‚è€…çš„è€å¿ƒè§‚çœ‹ï¼Œ<em>ä½¿ç”¨Reactæ„å»ºæœ€å°å¯ç”¨çš„èº«ä½“æŒ‡æ ‡ç½‘ç«™</em>çš„æ­£ç‰‡å³å°†å¼€å§‹ï¼Œä¸”å¬æ·®æ¡‘æ¦†å¨“å¨“é“æ¥</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c369a1777c0d49ae9f6c99fbec74d6a0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=941&amp;h=515&amp;s=533990&amp;e=png&amp;b=c5d9e6" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">æœ¬åœ°å¼€å‘èº«ä½“æŒ‡æ ‡ç½‘ç«™</h3>
<h4 data-id="heading-4">åˆ›å»ºé¡¹ç›®</h4>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> vite<span class="hljs-variable">@latest</span> body<span class="hljs-operator">-</span>metrics<span class="hljs-operator">-</span>web <span class="hljs-comment">-- --template react</span>

cd body<span class="hljs-operator">-</span>metrics<span class="hljs-operator">-</span>web

npm install
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/382a0a5b4a41453c9abd6f91e738741f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5reu5qGR5qaG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284918&amp;x-signature=YNFs52F0SAZ755lKuiuCe921FXE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">å®‰è£… Ant Design</h4>
<pre><code class="hljs">npm install antd
</code></pre>
<h4 data-id="heading-6">å®‰è£…å¤šè¯­è¨€å·¥å…·åŒ…</h4>
<pre><code class="hljs">npm install nangongmoyan-i18n-toolkit i18next react-i18next
</code></pre>
<h4 data-id="heading-7">æ·»åŠ <code>i18n.config.json</code>é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIzaSyACst8BV863yziXZoyWuV8q3EdALygZqgY"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outputDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./src/i18n"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"spreadsheetId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1TZ_11zne_0PVgr0cQu0sdWp9DZFE8KAOAElVlPEwvZw"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tableIndex"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"langues"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"zh-CN"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"en-US"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"socksProxy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"socks5://127.0.0.1:7980"</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-8">åœ¨package.jsonä¸­çš„scriptsä¸­æ·»åŠ </h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"intl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nangongmoyan-i18n-toolkit"</span>
</code></pre>
<h4 data-id="heading-9">å‘½ä»¤è¡Œæ‰§è¡Œnpm run intl</h4>
<p>è¿™é‡Œä¼šå°†å¯¹åº”è¯­è¨€çš„jsonæ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run intl
</code></pre>
<h4 data-id="heading-10">è°ƒæ•´å…¥å£æ–‡ä»¶</h4>
<p>æ·»åŠ å¤šè¯­è¨€èµ„æºå¼•å…¥å’Œåˆå§‹åŒ–</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StrictMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./index.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.jsx'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'antd/dist/reset.css'</span>;
<span class="hljs-keyword">import</span> zhCN <span class="hljs-keyword">from</span> <span class="hljs-string">'./i18n/zh-CN.json'</span>;
<span class="hljs-keyword">import</span> enUS <span class="hljs-keyword">from</span> <span class="hljs-string">'./i18n/en-US.json'</span>;
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">'i18next'</span>;
<span class="hljs-keyword">import</span> { initReactI18next } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-i18next'</span>;

<span class="hljs-keyword">const</span> resources = {
  <span class="hljs-attr">zh_CN</span>: {
    <span class="hljs-attr">common</span>: zhCN,
  },
  <span class="hljs-attr">en_US</span>: {
    <span class="hljs-attr">common</span>: enUS,
  },
};


i18n
  .<span class="hljs-title function_">use</span>(initReactI18next)
  .<span class="hljs-title function_">init</span>({
    resources,
    <span class="hljs-attr">ns</span>: [<span class="hljs-string">'common'</span>],
    <span class="hljs-attr">fallbackLng</span>: <span class="hljs-string">'zh_CN'</span>,
    <span class="hljs-attr">compatibilityJSON</span>: <span class="hljs-string">'v3'</span>,

  });

<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)).<span class="hljs-title function_">render</span>(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StrictMode</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">StrictMode</span>&gt;</span></span>,
)

</code></pre>
<h4 data-id="heading-11">ç¼–è¾‘ç½‘ç«™é¦–é¡µ</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">React</span> <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">react</span>';
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">Layout</span>, <span class="hljs-selector-tag">Typography</span>, <span class="hljs-selector-tag">Breadcrumb</span>, <span class="hljs-selector-tag">Button</span>, <span class="hljs-selector-tag">Timeline</span>, <span class="hljs-selector-tag">message</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">antd</span>';
<span class="hljs-selector-tag">const</span> { <span class="hljs-selector-tag">Header</span>, <span class="hljs-selector-tag">Content</span>, <span class="hljs-selector-tag">Footer</span> } = <span class="hljs-selector-tag">Layout</span>;
<span class="hljs-selector-tag">const</span> { <span class="hljs-selector-tag">Text</span> } = <span class="hljs-selector-tag">Typography</span>;
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">useController</span> } <span class="hljs-selector-tag">from</span> './<span class="hljs-selector-tag">controller</span>';
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">banner</span> <span class="hljs-selector-tag">from</span> '../../<span class="hljs-selector-tag">assets</span>/<span class="hljs-selector-tag">home-banner</span><span class="hljs-selector-class">.png</span>';
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">useTranslation</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">react-i18next</span>';

<span class="hljs-selector-tag">export</span> <span class="hljs-selector-tag">default</span> <span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">Home</span>() {
  <span class="hljs-selector-tag">const</span> { <span class="hljs-selector-tag">t</span> } = <span class="hljs-selector-tag">useTranslation</span>()
  <span class="hljs-selector-tag">const</span> { <span class="hljs-selector-tag">breadcrumbs</span>, <span class="hljs-selector-tag">timelineItems</span>, <span class="hljs-selector-tag">lang</span>, <span class="hljs-selector-tag">changeLanguage</span>, <span class="hljs-selector-tag">handleLoginClick</span> } = <span class="hljs-selector-tag">useController</span>();

  <span class="hljs-selector-tag">return</span> (
    &lt;Layout
      style={{
        <span class="hljs-attribute">width</span>: <span class="hljs-string">'100vw'</span>,
        <span class="hljs-attribute">minHeight</span>: <span class="hljs-string">'100vh'</span>,
        <span class="hljs-attribute">backgroundColor</span>: <span class="hljs-string">'#fff'</span>,
        <span class="hljs-attribute">overflowX</span>: <span class="hljs-string">'hidden'</span>,
      }}
    &gt;
      &lt;Header
        style={{
          <span class="hljs-attribute">position</span>: <span class="hljs-string">'fixed'</span>,
          <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attribute">width</span>: <span class="hljs-string">'100%'</span>,
          <span class="hljs-attribute">zIndex</span>: <span class="hljs-number">100</span>,
          <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>,
          <span class="hljs-attribute">justifyContent</span>: <span class="hljs-string">'space-between'</span>,
          <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>,
          <span class="hljs-attribute">backgroundColor</span>: <span class="hljs-string">'#fff'</span>,
          <span class="hljs-attribute">padding</span>: <span class="hljs-string">'0 40px'</span>,
          <span class="hljs-attribute">boxShadow</span>: <span class="hljs-string">'0 1px 4px rgba(0,0,0,0.1)'</span>,
        }}
      &gt;
        &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-number">24</span> }}&gt;
          &lt;Text strong style={{ fontSize: 18 }}&gt;
            Metrics
          &lt;/Text&gt;
          &lt;Breadcrumb
            items={<span class="hljs-selector-tag">breadcrumbs</span>}
            <span class="hljs-selector-tag">itemRender</span>={(<span class="hljs-selector-tag">route</span>) =&gt; (
              &lt;span style={{ fontSize: 16, fontWeight: 600, <span class="hljs-attribute">color</span>: <span class="hljs-string">'#000'</span> }}&gt;
                {<span class="hljs-selector-tag">route</span><span class="hljs-selector-class">.title</span>}
              &lt;/<span class="hljs-selector-tag">span</span>&gt;
            )}
          /&gt;
        &lt;/<span class="hljs-selector-tag">div</span>&gt;

        &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-number">16</span> }}&gt;
          &lt;span
            style={{
              <span class="hljs-attribute">cursor</span>: <span class="hljs-string">'pointer'</span>,
              <span class="hljs-attribute">fontSize</span>: <span class="hljs-number">14</span>,
              <span class="hljs-attribute">fontWeight</span>: <span class="hljs-number">600</span>,
              <span class="hljs-attribute">color</span>: lang === <span class="hljs-string">'zh_CN'</span> ? <span class="hljs-string">'#4F4165'</span> : <span class="hljs-string">'#999'</span>,
            }}
            onClick={<span class="hljs-selector-tag">changeLanguage</span>}
          &gt;
            ä¸­æ–‡
          &lt;/<span class="hljs-selector-tag">span</span>&gt;
          &lt;<span class="hljs-selector-tag">span</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'#999'</span> }}&gt;|&lt;/span&gt;
          &lt;span
            style={{
              <span class="hljs-attribute">cursor</span>: <span class="hljs-string">'pointer'</span>,
              <span class="hljs-attribute">fontSize</span>: <span class="hljs-number">14</span>,
              <span class="hljs-attribute">fontWeight</span>: <span class="hljs-number">600</span>,
              <span class="hljs-attribute">color</span>: lang === <span class="hljs-string">'en_US'</span> ? <span class="hljs-string">'#4F4165'</span> : <span class="hljs-string">'#999'</span>,
            }}
            onClick={<span class="hljs-selector-tag">changeLanguage</span>}
          &gt;
            <span class="hljs-selector-tag">EN</span>
          &lt;/<span class="hljs-selector-tag">span</span>&gt;

          &lt;<span class="hljs-selector-tag">Button</span>
            <span class="hljs-selector-tag">type</span>="<span class="hljs-selector-tag">primary</span>"
            <span class="hljs-selector-tag">style</span>={{
              backgroundColor: '#4F4165',
              borderColor: '#4F4165',
              <span class="hljs-attribute">outline</span>: <span class="hljs-string">'none'</span>,    
              <span class="hljs-attribute">boxShadow</span>: <span class="hljs-string">'none'</span>,    
            }}
            onClick={<span class="hljs-selector-tag">handleLoginClick</span>}
          &gt;
            {<span class="hljs-selector-tag">t</span>(<span class="hljs-string">'db1730ea5d370986ed9ad745fa8ad320'</span>)}
          &lt;/<span class="hljs-selector-tag">Button</span>&gt;
        &lt;/<span class="hljs-selector-tag">div</span>&gt;
      &lt;/<span class="hljs-selector-tag">Header</span>&gt;

      &lt;<span class="hljs-selector-tag">Content</span>
        <span class="hljs-selector-tag">style</span>={{
          backgroundColor: '#fff',
          <span class="hljs-attribute">padding</span>: <span class="hljs-string">'100px 40px 40px 40px'</span>,
          <span class="hljs-attribute">minHeight</span>: <span class="hljs-string">'calc(100vh - 64px)'</span>,
        }}
      &gt;
        &lt;div style={{ textAlign: 'center', marginBottom: 48, marginTop: 320 }}&gt;
          &lt;img
            src={<span class="hljs-selector-tag">banner</span>}
            <span class="hljs-selector-tag">alt</span>="<span class="hljs-selector-tag">Home</span> <span class="hljs-selector-tag">Banner</span>"
            <span class="hljs-selector-tag">style</span>={{
              <span class="hljs-attribute">width</span>: <span class="hljs-string">'100%'</span>,
              <span class="hljs-attribute">maxWidth</span>: <span class="hljs-number">1860</span>,
              <span class="hljs-attribute">height</span>: <span class="hljs-string">'auto'</span>,
              <span class="hljs-attribute">borderRadius</span>: <span class="hljs-number">8</span>,
            }}
          /&gt;
        &lt;/div&gt;

        &lt;Timeline
          mode=<span class="hljs-string">"alternate"</span>
          items={<span class="hljs-selector-tag">timelineItems</span><span class="hljs-selector-class">.map</span>((item, index) =&gt; ({
            <span class="hljs-attribute">key</span>: index,
            <span class="hljs-attribute">color</span>: <span class="hljs-string">'blue'</span>,
            <span class="hljs-attribute">content</span>: (
              &lt;div&gt;
                &lt;div style={{ <span class="hljs-attribute">fontSize</span>: <span class="hljs-number">16</span>, <span class="hljs-attribute">fontWeight</span>: <span class="hljs-number">600</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">'#4F4165'</span> }}&gt;
                  {item.title}
                &lt;/div&gt;
                &lt;div style={{ <span class="hljs-attribute">fontSize</span>: <span class="hljs-number">14</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">'#000'</span>, <span class="hljs-attribute">marginTop</span>: <span class="hljs-number">4</span> }}&gt;
                  {item.content}
                &lt;/div&gt;
              &lt;/div&gt;
            ),
          }))}
        /&gt;
      &lt;/<span class="hljs-selector-tag">Content</span>&gt;

      &lt;<span class="hljs-selector-tag">Footer</span> <span class="hljs-selector-tag">style</span>={{ textAlign: 'center', <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px 0'</span> }}&gt;
        &lt;div&gt;
          &lt;Text style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'block'</span>, <span class="hljs-attribute">marginBottom</span>: <span class="hljs-number">8</span> }}&gt;
            {<span class="hljs-selector-tag">t</span>(<span class="hljs-string">'488984465088887b5175f44cbc280c1b'</span>)}
          &lt;/<span class="hljs-selector-tag">Text</span>&gt;
          &lt;<span class="hljs-selector-tag">Text</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'block'</span> }}&gt;
            Â© <span class="hljs-number">2026</span> Body Metrics ï½œ ICPå¤‡æ¡ˆå·ï¼š
            &lt;a
              href=<span class="hljs-string">"https://beian.miit.gov.cn/"</span>
              target=<span class="hljs-string">"_blank"</span>
              rel=<span class="hljs-string">"noreferrer"</span>
              style={{ marginLeft: 4 }}
            &gt;
              é—½ICPå¤‡<span class="hljs-number">2026002759</span>å·-<span class="hljs-number">1</span>
            &lt;/a&gt;
          &lt;/Text&gt;
        &lt;/div&gt;
      &lt;/Footer&gt;
    &lt;/Layout&gt;
  );
}
</code></pre>
<h4 data-id="heading-12">ç¼–è¾‘ç½‘ç«™é¦–é¡µæ§åˆ¶å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useCallback, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-i18next"</span>;
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">'i18next'</span>;
<span class="hljs-keyword">import</span> { message } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useController</span> = (<span class="hljs-params"/>) =&gt; {

    <span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useTranslation</span>();
    
    <span class="hljs-keyword">const</span> [lang, setLang] = useState&lt;<span class="hljs-string">'zh_CN'</span> | <span class="hljs-string">'en_US'</span>&gt;(<span class="hljs-string">'zh_CN'</span>)

    <span class="hljs-keyword">const</span> breadcrumbs = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> [
        {
          <span class="hljs-attr">path</span>: <span class="hljs-string">'/index'</span>,
          <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'52840060f8254e27aa3b9b2b0b9d656f'</span>)
        },
      ], [t]);


    <span class="hljs-keyword">const</span> timelineItems = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">()=&gt;</span>[
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'ebbbf81b34583e7f9de5c6fa48b816ab'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'9c802be674a11ad45a6631d90abb5504'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'37bfbd5c693f8adb5299907449f3f4ea'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'1710acdc565dc7f9a9fe96a4611d28bf'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'99f6f78d920c4947c890074d6b269db8'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'80f1452ac632ff01f20f58d805151f04'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'87aa3b7167958c5e4a8a00fbaef36d37'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'76b219fa9200611dc4c59bac7f2bc26b'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'e168d0e3489c09a75a68b5b3733f544a'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'42117fcc4369a571a801d41431c15c0c'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'b69c259e2bfae5dd199edf6c5ce399e6'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'00700332fc6bd6238a458d67c52aa95d'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'314a4858bcf31c67cae2466026c6cd13'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'e1e1ab8de1667f6b9ce9d0810560c7a6'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'49e667da352288dc57ed938c67a96ce8'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'64289b7952c9f8e75240ffd317839f17'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'d6d7cf111600c05862f042b172873acc'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'876d800b93cbe8f670e8949c954bc87c'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'8848d29ab8604dd39d8823440e754113'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'139c1b55b9606936c38d522ceb49b1dc'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'daedccdcc67c28e3533627a2ae385b2c'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'13ede0bee19f6015b31dbcff57b76e67'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'92ed46d181b9812f07a616ea48c75731'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'673d1adb866512b70df13f38e68d1634'</span>)
        },
        {
            <span class="hljs-attr">title</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'463debc2c12e179cfb050c797f27cbcc'</span>),
            <span class="hljs-attr">content</span>: <span class="hljs-title function_">t</span>(<span class="hljs-string">'dc9950665e7ba954760e1678afc2af98'</span>)
        },
    ],[t])


    <span class="hljs-keyword">const</span> <span class="hljs-title function_">changeLanguage</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-title function_">setLang</span>(lang === <span class="hljs-string">'en_US'</span> ? <span class="hljs-string">'zh_CN'</span> : <span class="hljs-string">'en_US'</span>)
    }
      
    <span class="hljs-keyword">const</span> handleLoginClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">()=&gt;</span>{
        message.<span class="hljs-title function_">info</span>(<span class="hljs-title function_">t</span>(<span class="hljs-string">'983928f5ae498edc03884b979f1c3274'</span>));
    },[t])
    
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        i18n.<span class="hljs-title function_">changeLanguage</span>(lang);
      }, [lang])

    <span class="hljs-keyword">return</span> { breadcrumbs, timelineItems, lang, changeLanguage, handleLoginClick }
}
</code></pre>
<h4 data-id="heading-13">æœ¬åœ°è°ƒè¯•è¿è¡Œ</h4>
<p>è°ƒè¯•å®Œæˆåï¼Œå°†ä»£ç æ¨é€è‡³è¿œç¨‹ä»“åº“</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4298d75c12e0460696993f7b8659fe19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5reu5qGR5qaG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284918&amp;x-signature=ADqfNlCQzl4xvSAsuU0yGHV97pY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-14">åˆ›å»ºé¡¹ç›®distä»“åº“</h4>
<p>ç”±äºè´­ç½®çš„æœåŠ¡å™¨ä½é…ï¼Œæ‰€ä»¥æ‰“ç®—é‡‡ç”¨æœ¬åœ°æ„å»ºï¼Œç„¶åå°†æ„å»ºåçš„äº§ç‰©æ¨åˆ°è¿œç¨‹ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²è¿œç¨‹ä»“åº“çš„æ„å»ºäº§ç‰©ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># è¿›å…¥ dist ç›®å½•</span>

cd dist

<span class="hljs-meta"># åˆå§‹åŒ–ä¸´æ—¶ Git ä»“åº“</span>

git <span class="hljs-keyword">init</span>

git remote <span class="hljs-keyword">add</span> origin git@github.com:huaisangyu/body-metrics-web-dist.git

<span class="hljs-meta"># æ·»åŠ æ‰€æœ‰æ–‡ä»¶å¹¶æäº¤</span>

git <span class="hljs-keyword">add</span> .

git commit -m <span class="hljs-string">"chore: deploy build dist"</span>


<span class="hljs-meta"># å¼ºåˆ¶æ¨é€åˆ° deploy åˆ†æ”¯ï¼ˆæ¯æ¬¡è¦†ç›–ï¼‰</span>

git branch -M deploy

git push -f origin deploy
</code></pre>
<h4 data-id="heading-15">åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºmetricsæ–‡ä»¶å¤¹</h4>
<p>metricsæ–‡ä»¶ä¸»è¦ç”¨äºå­˜æ”¾æ„å»ºçš„äº§ç‰©</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /var/www/metrics

<span class="hljs-built_in">chown</span> -R www-data:www-data /var/www
<span class="hljs-built_in">chmod</span> -R 755 /var/www
</code></pre>
<p>é˜¿é‡Œäº‘ Ubuntu é»˜è®¤ nginx ç”¨æˆ·æ˜¯ www-data</p>
<h4 data-id="heading-16">ç»™metricså­åŸŸåå»ºä¸€ä¸ªNginxçš„é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">'EOF'</span> &gt; /etc/nginx/conf.d/metrics.conf
server {
    listen 80;
    server_name metrics.huaisangyu.top;
    <span class="hljs-built_in">return</span> 301 https://$host<span class="hljs-variable">$request_uri</span>;
}

server {
    listen 443 ssl;
    server_name metrics.huaisangyu.top;

    ssl_certificate /etc/letsencrypt/live/metrics.huaisangyu.top/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/metrics.huaisangyu.top/privkey.pem;

    root /var/www/metrics;
    index index.html;

    add_header Content-Security-Policy <span class="hljs-string">"upgrade-insecure-requests"</span>;

    location / {
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
    }
}
EOF
</code></pre>
<p>å¯åŠ¨è¿™ä¸ªé…ç½®</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/metrics /etc/nginx/sites-enabled/metrics
</code></pre>
<p>é‡è½½Nginx</p>
<pre><code class="hljs">sudo systemctl reload nginx
</code></pre>
<h4 data-id="heading-17">æ–°å»ºJenkinsä»»åŠ¡</h4>
<ul>
<li>Jenkins Dashboard â†’ æ–°å»ºItem(New Item)</li>
<li>åç§°ï¼š<code>body-metrics-web-dist</code></li>
<li>ç±»å‹ï¼šæµæ°´çº¿(Pipeline)</li>
</ul>
<h5 data-id="heading-18">Pipeline Script</h5>
<pre><code class="hljs language-bash" lang="bash">pipeline {
    agent any

    environment {
        DeployHost = <span class="hljs-string">"å…¬ç½‘IP"</span>
        DeployUser = <span class="hljs-string">"root"</span>
        DeployPath = <span class="hljs-string">"/var/www/metrics"</span>
        LocalDir   = <span class="hljs-string">"/var/project/body-metrics-web-dist"</span>
        SshKey     = <span class="hljs-string">"/var/jenkins_home/.ssh/id_ed25519"</span>
    }

    parameters {
        gitParameter(
            name: <span class="hljs-string">'Branch'</span>,
            <span class="hljs-built_in">type</span>: <span class="hljs-string">'PT_BRANCH'</span>,
            defaultValue: <span class="hljs-string">'deploy'</span>,
            description: <span class="hljs-string">'é€‰æ‹©è¦éƒ¨ç½²çš„åˆ†æ”¯'</span>,
            branchFilter: <span class="hljs-string">'origin/(.*)'</span>,
            selectedValue: <span class="hljs-string">'DEFAULT'</span>,
            sortMode: <span class="hljs-string">'NONE'</span>,
            quickFilterEnabled: <span class="hljs-literal">true</span>
        )

        string(
            name: <span class="hljs-string">'Repository'</span>,
            defaultValue: <span class="hljs-string">'git@github.com:huaisangyu/body-metrics-web-dist.git'</span>,
            description: <span class="hljs-string">'dist ä»“åº“åœ°å€'</span>
        )

        credentials(
            name: <span class="hljs-string">'Credential'</span>,
            defaultValue: <span class="hljs-string">'github-ssh'</span>,
            description: <span class="hljs-string">'Git SSH å‡­æ®'</span>
        )
    }

    stages {

        stage(<span class="hljs-string">'å‡†å¤‡å‚æ•°'</span>) {
            steps {
                script {
                    repo = params.Repository.trim()
                    branch = params.Branch
                    cred = params.Credential

                    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ä½¿ç”¨ä»“åº“ï¼š<span class="hljs-variable">${repo}</span>"</span>
                    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ä½¿ç”¨åˆ†æ”¯ï¼š<span class="hljs-variable">${branch}</span>"</span>
                    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ä½¿ç”¨å‡­æ®ï¼š<span class="hljs-variable">${cred}</span>"</span>
                }
            }
        }

        // âœ… å…³é”®ï¼šå’Œ node-api ä¸€æ¨¡ä¸€æ ·çš„â€œå ä½ git stepâ€
        stage(<span class="hljs-string">'åˆ·æ–° Git åˆ†æ”¯ä¿¡æ¯'</span>) {
            steps {
                git changelog: <span class="hljs-literal">false</span>,
                    branch: <span class="hljs-string">"<span class="hljs-variable">${branch}</span>"</span>,
                    url: <span class="hljs-string">"<span class="hljs-variable">${repo}</span>"</span>,
                    credentialsId: <span class="hljs-string">"<span class="hljs-variable">${cred}</span>"</span>
            }
        }

        stage(<span class="hljs-string">'å®¿ä¸»æœºæ‹‰å– / æ›´æ–° dist'</span>) {
            steps {
                sh <span class="hljs-string">""</span><span class="hljs-string">"
                    ssh -i <span class="hljs-variable">${SshKey}</span> -o StrictHostKeyChecking=yes <span class="hljs-variable">${DeployUser}</span>@<span class="hljs-variable">${DeployHost}</span> '
                        if [ ! -d <span class="hljs-variable">${LocalDir}</span> ]; then
                            git clone -b <span class="hljs-variable">${branch}</span> <span class="hljs-variable">${repo}</span> <span class="hljs-variable">${LocalDir}</span>
                        else
                            cd <span class="hljs-variable">${LocalDir}</span>
                            git fetch --all
                            git checkout <span class="hljs-variable">${branch}</span>
                            git reset --hard origin/<span class="hljs-variable">${branch}</span>
                        fi
                    '
                "</span><span class="hljs-string">""</span>
            }
        }

        stage(<span class="hljs-string">'å‘å¸ƒåˆ° Nginx'</span>) {
            steps {
                sh <span class="hljs-string">""</span><span class="hljs-string">"
                    ssh -i <span class="hljs-variable">${SshKey}</span> -o StrictHostKeyChecking=yes <span class="hljs-variable">${DeployUser}</span>@<span class="hljs-variable">${DeployHost}</span> '
                        mkdir -p <span class="hljs-variable">${DeployPath}</span>
                        rm -rf <span class="hljs-variable">${DeployPath}</span>/*
                        cp -r <span class="hljs-variable">${LocalDir}</span>/* <span class="hljs-variable">${DeployPath}</span>/
                    '
                "</span><span class="hljs-string">""</span>
            }
        }

        stage(<span class="hljs-string">'Reload Nginx'</span>) {
            steps {
                sh <span class="hljs-string">""</span><span class="hljs-string">"
                    ssh -i <span class="hljs-variable">${SshKey}</span> -o StrictHostKeyChecking=yes <span class="hljs-variable">${DeployUser}</span>@<span class="hljs-variable">${DeployHost}</span> '
                        nginx -t &amp;&amp; nginx -s reload
                    '
                "</span><span class="hljs-string">""</span>
            }
        }
    }

    post {
        success {
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… Web dist éƒ¨ç½²æˆåŠŸï¼š<span class="hljs-variable">${branch}</span>"</span>
        }
        failure {
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"âŒ Web dist éƒ¨ç½²å¤±è´¥"</span>
        }
    }
}
</code></pre>
<h5 data-id="heading-19">Jenkinsæ§åˆ¶å°è¾“å‡º</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92ba06f259fd4b489325fbc512ca415e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5reu5qGR5qaG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284918&amp;x-signature=Uep3TlhTJuWBkzuEQY2EcOYVYoY%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-20">ç½‘é¡µè®¿é—®</h5>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmetrics.huaisangyu.top%2F" target="_blank" title="https://metrics.huaisangyu.top/" ref="nofollow noopener noreferrer">metrics.huaisangyu.top/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cc0f97b1e654519b62bf4c4bbef237a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5reu5qGR5qaG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284918&amp;x-signature=c44CnIA11nYfrB31WIT8LgPKU1A%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-21">ç»“å°¾è¥ä¸š</h2>
<p><strong>çœ‹å®˜éƒ½çœ‹åˆ°è¿™äº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œå¯ä¸å¯ä»¥ä¸åå•¬ä½ çš„å°æ‰‹æ‰‹å¸®å¿™ç‚¹ä¸ªå…³æ³¨æˆ–è€…ç‚¹ä¸ªèµ</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3731781bef4b43bc81c3b2824c91b6a3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=220&amp;h=220&amp;s=83473&amp;e=gif&amp;f=9&amp;b=fcf7f6" alt="711115f2517eae5e.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prometheuså‘Šè­¦è§„åˆ™ç¼–å†™ï¼šä½ å¿…é¡»çŸ¥é“çš„7ä¸ªæ³¨æ„äº‹é¡¹]]></title>    <link>https://juejin.cn/post/7600426046425579555</link>    <guid>https://juejin.cn/post/7600426046425579555</guid>    <pubDate>2026-01-29T09:45:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600426046425579555" data-draft-id="7600355625475522612" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prometheuså‘Šè­¦è§„åˆ™ç¼–å†™ï¼šä½ å¿…é¡»çŸ¥é“çš„7ä¸ªæ³¨æ„äº‹é¡¹"/> <meta itemprop="keywords" content="è¿ç»´"/> <meta itemprop="datePublished" content="2026-01-29T09:45:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpsEye"/> <meta itemprop="url" content="https://juejin.cn/user/2613979161324443"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prometheuså‘Šè­¦è§„åˆ™ç¼–å†™ï¼šä½ å¿…é¡»çŸ¥é“çš„7ä¸ªæ³¨æ„äº‹é¡¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2613979161324443/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpsEye
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:45:29.000Z" title="Thu Jan 29 2026 09:45:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œä¸ºäº‘åŸç”Ÿç›‘æ§çš„äº‹å®æ ‡å‡†ï¼ŒPrometheusçš„å‘Šè­¦è§„åˆ™ç¼–å†™ç›´æ¥å½±å“ç›‘æ§ç³»ç»Ÿçš„æœ‰æ•ˆæ€§å’Œå¯é æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨åœ¨ç¼–å†™Prometheuså‘Šè­¦è§„åˆ™æ—¶çš„å…³é”®æ³¨æ„äº‹é¡¹ï¼Œå¸®åŠ©æ‚¨æ„å»ºæ›´åŠ å¥å£®çš„ç›‘æ§å‘Šè­¦ä½“ç³»ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11e9b67258bd482697a59820da41ae61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BzRXll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284728&amp;x-signature=tKNiBBrBBJG4hZvTmpgOYcCGUTg%3D" alt="640 (10).webp" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€ç†è§£å‘Šè­¦è§„åˆ™çš„åŸºæœ¬ç»“æ„</h2>
<p>åœ¨å¼€å§‹ç¼–å†™å‘Šè­¦è§„åˆ™å‰ï¼Œå¿…é¡»æ¸…æ¥šå‘Šè­¦è§„åˆ™çš„åŸºæœ¬ç»„æˆï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">groups:</span>
 <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">example</span>
  <span class="hljs-attr">rules:</span>
 <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighErrorRate</span>
    <span class="hljs-attr">expr:</span> <span class="hljs-string">job:request_error_rate:ratio5m{job="myjob"}</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.5</span>
    <span class="hljs-attr">for:</span> <span class="hljs-string">10m</span>
    <span class="hljs-attr">labels:</span>
      <span class="hljs-attr">severity:</span> <span class="hljs-string">critical</span>
    <span class="hljs-attr">annotations:</span>
      <span class="hljs-attr">summary:</span> <span class="hljs-string">"High error rate on <span class="hljs-template-variable">{{ $labels.instance }}</span>"</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">"Error rate is <span class="hljs-template-variable">{{ $value }}</span>"</span>
</code></pre>
<p>æ¯ä¸ªå‘Šè­¦è§„åˆ™åŒ…å«ï¼š</p>
<ul>
<li><strong>alert</strong>  : å‘Šè­¦åç§°</li>
<li><strong>exp</strong>r  : PromQLè¡¨è¾¾å¼</li>
<li><strong>for</strong>  : æŒç»­æ—¶é—´ï¼ˆå¯é€‰ï¼‰</li>
<li><strong>labels</strong>  : é™„åŠ æ ‡ç­¾</li>
<li><strong>annotations</strong>  : å‘Šè­¦è¯¦æƒ…æ³¨è§£</li>
</ul>
<h2 data-id="heading-1">äºŒã€åˆç†è®¾ç½®å‘Šè­¦æŒç»­æ—¶é—´ï¼ˆforï¼‰</h2>
<p><strong>for</strong>å­—æ®µå†³å®šäº†è§¦å‘æ¡ä»¶æŒç»­å¤šé•¿æ—¶é—´æ‰ä¼šçœŸæ­£è§¦å‘å‘Šè­¦ã€‚è®¾ç½®ä¸å½“ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>è®¾ç½®è¿‡çŸ­ï¼šäº§ç”Ÿå¤§é‡çŸ­æš‚ã€æ— æ„ä¹‰çš„å‘Šè­¦ï¼ˆå‘Šè­¦é£æš´ï¼‰</li>
<li>è®¾ç½®è¿‡é•¿ï¼šçœŸæ­£çš„é—®é¢˜å¯èƒ½è¢«å»¶è¿Ÿå‘ç°</li>
</ul>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>å¯¹äºå…³é”®ä¸šåŠ¡æŒ‡æ ‡ï¼š2-5åˆ†é’Ÿ</li>
<li>å¯¹äºèµ„æºç±»æŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰ï¼š10-15åˆ†é’Ÿ</li>
<li>å¯¹äºéœ€è¦é•¿æœŸè§‚å¯Ÿçš„è¶‹åŠ¿æ€§æŒ‡æ ‡ï¼š30åˆ†é’Ÿä»¥ä¸Š</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€ç¼–å†™é«˜æ•ˆçš„PromSQLè¡¨è¾¾å¼</h2>
<p>å‘Šè­¦è§„åˆ™çš„æ ¸å¿ƒæ˜¯PromQLè¡¨è¾¾å¼ï¼Œç¼–å†™æ—¶åº”æ³¨æ„ï¼š
<strong>é¿å…çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨é«˜åŸºæ•°æ ‡ç­¾ï¼ˆå¦‚IPã€IDç­‰ï¼‰å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™</li>
<li>è¿‡äºå¤æ‚çš„joinæ“ä½œå¢åŠ è®¡ç®—è´Ÿæ‹…</li>
<li>ç¼ºå°‘å¿…è¦çš„èšåˆå¯¼è‡´å‘Šè­¦è¿‡äºå…·ä½“</li>
</ul>
<p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#ä¸æ¨è - é«˜åŸºæ•°</span>
<span class="hljs-built_in">expr</span>: rate(http_requests_total{status=~<span class="hljs-string">"5.."</span>}[5m]) &gt; 0.1
<span class="hljs-comment">#æ¨è - æŒ‰jobèšåˆ</span>
<span class="hljs-built_in">expr</span>: <span class="hljs-built_in">sum</span> by(job) (rate(http_requests_total{status=~<span class="hljs-string">"5.."</span>}[5m])) / <span class="hljs-built_in">sum</span> by(job) (rate(http_requests_total[5m])) &gt; 0.1
</code></pre>
<h2 data-id="heading-3">å››ã€åˆç†ä½¿ç”¨æ ‡ç­¾å’Œæ³¨è§£</h2>
<p><strong>labelsä½¿ç”¨åŸåˆ™ï¼š</strong></p>
<ul>
<li>ç”¨äºå‘Šè­¦è·¯ç”±ï¼ˆå¦‚severity=critical/warningï¼‰</li>
<li>ç”¨äºå‘Šè­¦åˆ†ç»„ï¼ˆå¦‚region, clusterç­‰ï¼‰</li>
<li>é¿å…ä½¿ç”¨å¯èƒ½é¢‘ç¹å˜åŒ–çš„å€¼ä½œä¸ºæ ‡ç­¾</li>
</ul>
<p><strong>annotationsä½¿ç”¨åŸåˆ™ï¼š</strong></p>
<ul>
<li>summaryåº”ç®€æ´æ˜äº†</li>
<li>descriptionå¯åŒ…å«è¯¦ç»†ä¿¡æ¯å’Œå»ºè®®æ“ä½œ</li>
<li>ä½¿ç”¨æ¨¡æ¿å˜é‡ï¼ˆå¦‚{{ $labels.instance }}ï¼‰ä½¿å‘Šè­¦ä¿¡æ¯åŠ¨æ€åŒ–</li>
</ul>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">annotations:</span>
  <span class="hljs-attr">summary:</span> <span class="hljs-string">"High CPU usage on <span class="hljs-template-variable">{{ $labels.instance }}</span> (<span class="hljs-template-variable">{{ $value }}</span>%)"</span>
  <span class="hljs-attr">description:</span> <span class="hljs-string">"Instance <span class="hljs-template-variable">{{ $labels.instance }}</span> has been over 80% CPU usage for 10 minutes. Please check the process list."</span>
  <span class="hljs-attr">runbook:</span> <span class="hljs-string">"https://wiki.example.com/runbook/high-cpu"</span>
</code></pre>
<h2 data-id="heading-4">äº”ã€é¿å…å‘Šè­¦ç–²åŠ³çš„å…³é”®ç­–ç•¥</h2>
<p>å‘Šè­¦ç–²åŠ³æ˜¯è¿ç»´å›¢é˜Ÿçš„å¤§æ•Œï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¼“è§£ï¼š</p>
<p><strong>(1)åˆ†çº§å‘Šè­¦ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">labels:</span>
  <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>  <span class="hljs-comment"># æˆ–critical/page</span>
</code></pre>
<p><strong>(2)è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼ï¼š</strong></p>
<ul>
<li>åŸºäºå†å²æ•°æ®è®¾ç½®åŠ¨æ€åŸºçº¿</li>
<li>åŒºåˆ†å·¥ä½œæ—¥å’ŒèŠ‚å‡æ—¥æ¨¡å¼</li>
<li/>
</ul>
<p><strong>(3)æŠ‘åˆ¶è§„åˆ™ï¼ˆinhibit_rulesï¼‰ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">inhibit_rules:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">source_match:</span>
    <span class="hljs-attr">severity:</span> <span class="hljs-string">'critical'</span>
  <span class="hljs-attr">target_match:</span>
    <span class="hljs-attr">severity:</span> <span class="hljs-string">'warning'</span>
  <span class="hljs-attr">equal:</span> [<span class="hljs-string">'alertname'</span>, <span class="hljs-string">'instance'</span>]
</code></pre>
<h2 data-id="heading-5">å…­ã€æµ‹è¯•ä¸éªŒè¯å‘Šè­¦è§„åˆ™</h2>
<p>ç¼–å†™å‘Šè­¦è§„åˆ™åå¿…é¡»è¿›è¡ŒéªŒè¯ï¼š</p>
<p><strong>(1)ä½¿ç”¨promtoolæ£€æŸ¥è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">promtool check rules /path/to/alert.rules
</code></pre>
<p><strong>(2)åœ¨æµ‹è¯•ç¯å¢ƒè§¦å‘æ¨¡æ‹Ÿå‘Šè­¦</strong></p>
<p><strong>(3)éªŒè¯Alertmanagerçš„æ¥æ”¶å’Œå¤„ç†</strong></p>
<p><strong>(4)å®šæœŸè¯„å®¡å‘Šè­¦è§„åˆ™çš„æœ‰æ•ˆæ€§</strong></p>
<h2 data-id="heading-6">ä¸ƒã€å‘Šè­¦è§„åˆ™ç»´æŠ¤ä¸æ–‡æ¡£åŒ–</h2>
<p>éšç€ç³»ç»Ÿæ¼”è¿›ï¼Œå‘Šè­¦è§„åˆ™éœ€è¦æŒç»­ç»´æŠ¤ï¼š</p>
<p><strong>(1)ä¸ºæ¯ä¸ªå‘Šè­¦æ·»åŠ æ³¨é‡Šè¯´æ˜ï¼š</strong></p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># ç›‘æ§APIæœåŠ¡çš„5xxé”™è¯¯ç‡</span>
<span class="hljs-comment"># é˜ˆå€¼è®¾ç½®ä¸º1%æ˜¯åŸºäºSLA 99.9%çš„è¦æ±‚</span>
<span class="hljs-comment"># è´Ÿè´£äººï¼š<span class="hljs-doctag">@team</span>-api</span>
</code></pre>
<p><strong>(2)ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç®¡ç†è§„åˆ™æ–‡ä»¶</strong></p>
<p><strong>(3)å®šæœŸæ¸…ç†ä¸å†ä½¿ç”¨çš„å‘Šè­¦è§„åˆ™</strong></p>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>ä¼˜ç§€çš„ Prometheus å‘Šè­¦è§„åˆ™ï¼Œåº”å½“æ˜¯ â€œåœ¨æ­£ç¡®çš„æ—¶é—´ï¼Œä»¥æ­£ç¡®çš„æ–¹å¼ï¼Œå‘Šè¯‰æ­£ç¡®çš„äººæ­£ç¡®çš„é—®é¢˜â€ã€‚å¸Œæœ›æœ¬æ–‡æ‰€è¿°çš„æ³¨æ„äº‹é¡¹ï¼Œå¯ä»¥å¸®åŠ©ä½ é¿å¼€å¸¸è§çš„ â€œå‘Šè­¦é™·é˜±â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MedGemma 1.5ï¼šæ”¯æŒé«˜ç»´åŒ»å­¦å½±åƒã€è§£å‰–å®šä½ç­‰å¤šç§åŠŸèƒ½ï¼›Patient Churn Predictionï¼šé¢å‘åŒ»ç–—ä¿å¥é¢†åŸŸçš„åˆ†ç±»æ•°æ®é›†]]></title>    <link>https://juejin.cn/post/7600597995768217609</link>    <guid>https://juejin.cn/post/7600597995768217609</guid>    <pubDate>2026-01-29T10:09:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600597995768217609" data-draft-id="7600414546189893642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MedGemma 1.5ï¼šæ”¯æŒé«˜ç»´åŒ»å­¦å½±åƒã€è§£å‰–å®šä½ç­‰å¤šç§åŠŸèƒ½ï¼›Patient Churn Predictionï¼šé¢å‘åŒ»ç–—ä¿å¥é¢†åŸŸçš„åˆ†ç±»æ•°æ®é›†"/> <meta itemprop="keywords" content="æ·±åº¦å­¦ä¹ ,äººå·¥æ™ºèƒ½,æœºå™¨å­¦ä¹ "/> <meta itemprop="datePublished" content="2026-01-29T10:09:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenBayesè´å¼è®¡ç®—"/> <meta itemprop="url" content="https://juejin.cn/user/2793222200375607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MedGemma 1.5ï¼šæ”¯æŒé«˜ç»´åŒ»å­¦å½±åƒã€è§£å‰–å®šä½ç­‰å¤šç§åŠŸèƒ½ï¼›Patient Churn Predictionï¼šé¢å‘åŒ»ç–—ä¿å¥é¢†åŸŸçš„åˆ†ç±»æ•°æ®é›†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2793222200375607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenBayesè´å¼è®¡ç®—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:09:44.000Z" title="Thu Jan 29 2026 10:09:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å…¬å…±èµ„æºé€Ÿé€’</strong></p>
<p><strong>5 ä¸ªå…¬å…±æ•°æ®é›†ï¼š</strong></p>
<ul>
<li>
<p>CCTV Incident è·Œå€’æ£€æµ‹æ•°æ®é›†</p>
</li>
<li>
<p>Patient Segmentation æ‚£è€…åˆ†ç±»æ•°æ®é›†</p>
</li>
<li>
<p>Hand Gestures Labbled æ‰‹åŠ¿æ±½è½¦æ¸¸æˆæ•°æ®é›†</p>
</li>
<li>
<p>RealTimeFaceSwap-10k è§†é¢‘é€šè¯ä¼ªé€ æ•°æ®é›†</p>
</li>
<li>
<p>Patient Churn Prediction æ‚£è€…æµå¤±é¢„æµ‹æ•°æ®é›†</p>
</li>
</ul>
<p><strong>8 ä¸ªå…¬å…±æ•™ç¨‹ï¼š</strong></p>
<ul>
<li>Triton ç¼–è¯‘å™¨æ•™ç¨‹</li>
</ul>
<p>*Â DiagGym è¯Šæ–­æ™ºèƒ½ä½“</p>
<ul>
<li>
<p>TRELLIS.2 3D ç”Ÿæˆ Demo</p>
</li>
<li>
<p>WeDLM é«˜æ•ˆå¤§è¯­è¨€æ¨¡å‹è§£ç æ¡†æ¶</p>
</li>
<li>
<p>MedGemma 1.5 å¤šæ¨¡æ€ AI åŒ»ç–—æ¨¡å‹</p>
</li>
</ul>
<p>*Â FLUX.2-klein-4Bï¼šæé€Ÿå›¾åƒç”Ÿæˆæ¨¡å‹</p>
<ul>
<li>Pocket-TTSï¼šé«˜è´¨é‡è½»é‡çº§æµå¼ TTS ç³»ç»Ÿ</li>
</ul>
<p>*Â vLLM+Open WebUI éƒ¨ç½² Nemotron-3 Nano</p>
<p><strong>è®¿é—®å®˜ç½‘ç«‹å³ä½¿ç”¨ï¼š</strong> <em><strong>openbayes.com</strong></em></p>
<p><strong>å…¬å…±æ•°æ®é›†</strong></p>
<p><strong>1. CCTV Incident è·Œå€’æ£€æµ‹æ•°æ®é›†</strong></p>
<p>CCTV Incident æ˜¯ä¸€ä¸ªå¼€æ”¾å¼åˆæˆæ•°æ®é›†ï¼Œä¸“é—¨ç”¨äºè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­çš„è·Œå€’æ£€æµ‹ã€å§¿æ€ä¼°è®¡å’Œäº‹æ•…ç›‘æ§ï¼Œæ—¨åœ¨ä» CCTV ä¿¯è§†è§†è§’è¿›è¡Œåˆ†æï¼Œæ”¯æŒæ¨¡å‹ç†è§£äººç±»å§¿æ€ï¼Œå¹¶å‡†ç¡®åŒºåˆ†ç«™ç«‹å’Œè·Œå€’çš„ä¸ªä½“ã€‚</p>
<p>åœ¨çº¿ä½¿ç”¨ï¼š</p>
<p>***<strong><strong><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2Fm4WXY" target="_blank" title="https://go.openbayes.com/m4WXY" ref="nofollow noopener noreferrer">go.openbayes.com/m4WXY</a></strong></strong></strong></p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaf2834606254942bd52bf2705aac2ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=IFL4FctowYG0mW8f5zpAeqKmQHI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">æ•°æ®é›†ç¤ºä¾‹</p>
<p><strong>2. Patient Segmentation æ‚£è€…åˆ†ç±»æ•°æ®é›†</strong></p>
<p>Patient Segmentation æ˜¯ä¸€ä¸ªé¢å‘åŒ»ç–—åˆ†æä¸è¥é”€çš„æ‚£è€…åˆ†ç±»æ•°æ®é›†ã€‚æ•°æ®é›†åŒ…å« 2,000 ä¸ªæ‚£è€…è®°å½•ï¼ŒåŒ…æ‹¬äººå£ç»Ÿè®¡ä¿¡æ¯ã€å¥åº·æŒ‡æ ‡ã€åŒ»ç–—ä½¿ç”¨æƒ…å†µã€ä¿é™©ä¸å‚ä¸æƒ…å†µï¼Œæ—¨åœ¨é€šè¿‡åˆ†ææ‚£è€…ä¿¡æ¯ï¼Œå°†æ‚£è€…åˆ†æˆæœ‰æ„ä¹‰çš„ç¾¤ä½“ï¼Œä»¥æé«˜ä¸ªæ€§åŒ–æŠ¤ç†å’Œè¥é”€çš„æ•ˆæœã€‚</p>
<p>åœ¨çº¿ä½¿ç”¨ï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2Fr4IsF" target="_blank" title="https://go.openbayes.com/r4IsF" ref="nofollow noopener noreferrer">go.openbayes.com/r4IsF</a></strong></em></p>
<p><strong>3. Hand Gestures Labbled æ‰‹åŠ¿æ±½è½¦æ¸¸æˆæ•°æ®é›†</strong></p>
<p>è¯¥æ•°æ®é›†å…±åŒ…å« 330 å¼ æ‰‹åŠ¿å›¾åƒï¼Œè¦†ç›– 4 ç±»æ‰‹åŠ¿åŠ¨ä½œï¼Œå„ç±»åˆ«æ ·æœ¬æ•°é‡åˆ†åˆ«ä¸º leftï¼ˆ123 å¼ ï¼‰ã€mvefrdï¼ˆ137 å¼ ï¼‰ã€rightï¼ˆ174 å¼ ï¼‰ã€stopï¼ˆ176 å¼ ï¼‰ã€‚</p>
<p>åœ¨çº¿ä½¿ç”¨ï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2FqdOE4" target="_blank" title="https://go.openbayes.com/qdOE4" ref="nofollow noopener noreferrer">go.openbayes.com/qdOE4</a></strong></em></p>
<p><strong>4. RealTimeFaceSwap-10k è§†é¢‘é€šè¯ä¼ªé€ æ•°æ®é›†</strong></p>
<p>è¯¥æ•°æ®é›†åŒ…å« 1,636 ä¸ªç›®æ ‡è§†é¢‘ç‰‡æ®µï¼Œ2,000 å¼ ç”¨äºäººè„¸äº¤æ¢çš„æ¥æºç…§ç‰‡å’Œ 9,772 ä¸ªä½¿ç”¨äººè„¸äº¤æ¢æ¨¡å‹ç”Ÿæˆçš„æ·±åº¦ä¼ªé€ è§†é¢‘ï¼Œæ—¨åœ¨ä¸ºè§†é¢‘ä¼ªé€ æ£€æµ‹æä¾›åŸºç¡€æ•°æ®æ”¯æŒã€‚</p>
<p>åœ¨çº¿ä½¿ç”¨ï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2F9QTWO" target="_blank" title="https://go.openbayes.com/9QTWO" ref="nofollow noopener noreferrer">go.openbayes.com/9QTWO</a></strong></em></p>
<p><strong>5. Patient Churn Prediction æ‚£è€…æµå¤±é¢„æµ‹æ•°æ®é›†</strong></p>
<p>è¯¥æ•°æ®é›†åŒ…å« 2,000 æ¡æ‚£è€…è®°å½•ï¼Œè¦†ç›–æ‚£è€…çš„äººå£ç»Ÿè®¡ä¿¡æ¯ï¼ŒæœåŠ¡åˆ©ç”¨ç‡æŒ‡æ ‡ï¼Œæ‚£è€…æ»¡æ„åº¦æŒ‡æ ‡ï¼Œè´¢åŠ¡åŠå‚ä¸å› ç´ ï¼Œæ—¨åœ¨å¸®åŠ©è¯†åˆ«æœ‰æµå¤±é£é™©çš„æ‚£è€…ï¼Œä»¥ä¾¿äºæå‰é‡‡å–ä¿ç•™æªæ–½ã€‚</p>
<p>åœ¨çº¿ä½¿ç”¨ï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2F7pBpv" target="_blank" title="https://go.openbayes.com/7pBpv" ref="nofollow noopener noreferrer">go.openbayes.com/7pBpv</a></strong></em></p>
<p><strong>å…¬å…±æ•™ç¨‹</strong></p>
<p><strong>1.</strong> <strong>Triton ç¼–è¯‘å™¨æ•™ç¨‹</strong></p>
<p>Triton æ˜¯ä¸€ç§ç”¨äºå¹¶è¡Œç¼–ç¨‹çš„è¯­è¨€å’Œç¼–è¯‘å™¨ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªåŸºäº Python çš„ç¼–ç¨‹ç¯å¢ƒï¼Œä»¥é«˜æ•ˆç¼–å†™è‡ªå®šä¹‰ DNN è®¡ç®—å†…æ ¸ï¼Œå¹¶èƒ½å¤Ÿåœ¨ GPU ç¡¬ä»¶ä¸Šä»¥æœ€å¤§ååé‡è¿è¡Œã€‚æœ¬é¡¹ç›®æ˜¯ä¸€å¥—å®Œæ•´çš„ Triton å­¦ä¹ æ•™ç¨‹ï¼Œæ¶µç›–äº†ä»åŸºç¡€åˆ°é«˜çº§çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å‘é‡æ“ä½œã€çŸ©é˜µè¿ç®—ã€å±‚æ ‡å‡†åŒ–ã€æ³¨æ„åŠ›æœºåˆ¶ã€ä»¥åŠ FP8 çŸ©é˜µä¹˜æ³•ç­‰å†…å®¹ã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2Flw3JM" target="_blank" title="https://go.openbayes.com/lw3JM" ref="nofollow noopener noreferrer">go.openbayes.com/lw3JM</a></strong></em></p>
<p><strong>2.</strong> <strong>DiagGym è¯Šæ–­æ™ºèƒ½ä½“</strong></p>
<p>DiagAgent æ˜¯ç”±ä¸Šæµ·äº¤é€šå¤§å­¦å’Œä¸Šæµ·äººå·¥æ™ºèƒ½å®éªŒå®¤çš„ AI4Med å›¢é˜Ÿå‘å¸ƒçš„è¯Šæ–­æ™ºèƒ½ä½“ï¼Œèƒ½å¤Ÿä¸»åŠ¨ç®¡ç†è¯Šæ–­è½¨è¿¹ï¼šé€‰æ‹©æœ€å…·ä¿¡æ¯é‡çš„æ£€æŸ¥ã€å†³å®šä½•æ—¶åœæ­¢æ£€æŸ¥å¹¶ç»™å‡ºå‡†ç¡®çš„æœ€ç»ˆè¯Šæ–­ã€‚ä¸ä¼ ç»ŸåŒ»å­¦å¤§æ¨¡å‹ä»…æä¾›ä¸€æ¬¡æ€§ç­”æ¡ˆä¸åŒï¼ŒDiagAgent å¯ä»¥æ¨èç›¸å…³æ£€æŸ¥å¹¶åœ¨å¤šè½®å¯¹è¯ä¸­è‡ªé€‚åº”æ›´æ–°è¯Šæ–­ï¼Œåªæœ‰åœ¨è·å¾—è¶³å¤Ÿä¿¡æ¯æ—¶æ‰ç»™å‡ºæœ€ç»ˆè¯Šæ–­ã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2F7YQLf" target="_blank" title="https://go.openbayes.com/7YQLf" ref="nofollow noopener noreferrer">go.openbayes.com/7YQLf</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e00ab3f103c474e82c11e910b1eef34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=gTTZNopIrQ24IJwqcXoy4lrttAc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p>
<hr/>
<p><strong>3. TRELLIS.2 3D ç”Ÿæˆ Demo</strong></p>
<p>TRELLIS.2 ç”± Microsoft å›¢é˜Ÿå¼€æºå‘å¸ƒï¼Œé¢å‘å•å¼ å›¾åƒç”Ÿæˆé«˜è´¨é‡ 3D èµ„äº§ä¸çº¹ç†åŒ–ä»»åŠ¡ã€‚é¡¹ç›®æä¾›ä»è¾“å…¥å›¾åƒåˆ° 3D å½¢çŠ¶ä¸æè´¨çš„ç«¯åˆ°ç«¯æµç¨‹ï¼Œå¹¶é…å¥—å¯äº¤äº’çš„ Web Demoï¼Œä¾¿äºå¿«é€Ÿä½“éªŒä¸å¯¼å‡ºèµ„äº§ã€‚èšç„¦æå‡å‡ ä½•ç»†èŠ‚ä¸çº¹ç†ä¸€è‡´æ€§ï¼Œæ”¯æŒå¤šç§åˆ†è¾¨ç‡ä¸çº§è”æ¨ç†é…ç½®ï¼Œé€‚ç”¨äº 3D å†…å®¹ç”Ÿäº§ã€å¿«é€ŸåŸå‹ä¸åˆ›æ„æ¢ç´¢ç­‰åœºæ™¯ã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2FGPDWb" target="_blank" title="https://go.openbayes.com/GPDWb" ref="nofollow noopener noreferrer">go.openbayes.com/GPDWb</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23121f1713494a6799c1edc54d964635~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=03pMC9XN0r9wDLiKh%2FOsGGztXwM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p>
<p><strong>4. WeDLM é«˜æ•ˆå¤§è¯­è¨€æ¨¡å‹è§£ç æ¡†æ¶</strong></p>
<p>WeDLMæ˜¯ç”±è…¾è®¯æ¨å‡ºçš„é«˜æ•ˆå¤§è¯­è¨€æ¨¡å‹è§£ç æ¡†æ¶ï¼Œæ—¨åœ¨ä¸ºä¸‹ä¸€ä»£ AI å¯¹è¯ç³»ç»Ÿæä¾›æé€Ÿã€æ™ºèƒ½ä¸”é«˜åº¦è‡ªé€‚åº”çš„è¯­è¨€ç”Ÿæˆä½“éªŒã€‚è¯¥æ¡†æ¶é‡‡ç”¨äº†åˆ›æ–°çš„çª—å£å¹¶è¡Œè§£ç æ¶æ„ï¼Œåœ¨ä¿æŒé«˜è´¨é‡æ–‡æœ¬ç”Ÿæˆçš„åŒæ—¶ï¼Œå®ç°äº†æ˜¾è‘—çš„é€Ÿåº¦æå‡ã€‚å…¶æ ¸å¿ƒæŠ€æœ¯çªç ´åœ¨äºé€šè¿‡ç†µé˜ˆå€¼å†³ç­–ä¸ä½ç½®æƒ©ç½šæœºåˆ¶çš„ç»“åˆï¼Œå½»åº•è§£å†³äº†ä¼ ç»Ÿè‡ªå›å½’è§£ç åœ¨é•¿åºåˆ—ç”Ÿæˆä¸­çš„é€Ÿåº¦ç“¶é¢ˆã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2FNGzhi" target="_blank" title="https://go.openbayes.com/NGzhi" ref="nofollow noopener noreferrer">go.openbayes.com/NGzhi</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/933c42d9367240cf8080bfa706ca15bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=avwzUUNbGC7B6EQ588ZlolyWnlg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p>
<p><strong>5. MedGemma 1.5 å¤šæ¨¡æ€ AI åŒ»ç–—æ¨¡å‹</strong></p>
<p>MedGemma 1.5 æ˜¯ç”±è°·æ­Œå¼€æºçš„å¤šæ¨¡æ€ AI åŒ»å­¦æ¨¡å‹ï¼Œä¸“ä¸ºå¤„ç†åŒ»å­¦å½±åƒå’Œæ–‡æœ¬æ•°æ®è®¾è®¡ã€‚æ¨¡å‹æ”¯æŒé«˜ç»´åŒ»å­¦å½±åƒï¼ˆå¦‚ CT å’Œ MRIï¼‰ã€å…¨åˆ‡ç‰‡ç—…ç†å½±åƒã€çºµå‘å½±åƒåˆ†æã€è§£å‰–å®šä½ã€åŒ»å­¦æ–‡æ¡£ç†è§£å’Œç”µå­å¥åº·è®°å½•ï¼ˆEHRï¼‰è§£è¯»ç­‰åŠŸèƒ½ã€‚æ¨¡å‹åŸºäº SigLIP å›¾åƒç¼–ç å™¨å’Œå¼ºå¤§çš„è¯­è¨€æ¨¡å‹ï¼Œä½¿ç”¨å¤šç§åŒ»å­¦æ•°æ®è¿›è¡Œé¢„è®­ç»ƒï¼ŒåŒ…æ‹¬å½±åƒã€æ–‡æœ¬å’Œå®éªŒå®¤æŠ¥å‘Šã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2F8ufT5" target="_blank" title="https://go.openbayes.com/8ufT5" ref="nofollow noopener noreferrer">go.openbayes.com/8ufT5</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdef8d8ed23342569f9ad16930d4d52e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=NztfyNk68EPiAIOixaPkWgd%2Bthk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p>
<p><strong>6. FLUX.2-klein-4Bï¼šæé€Ÿå›¾åƒç”Ÿæˆæ¨¡å‹</strong></p>
<p>FLUX.2-klein-4B æ˜¯ç”± Black Forest Labs (BFL) æ¨å‡ºçš„æœ€æ–°ä¸€ä»£æé€Ÿå›¾åƒç”Ÿæˆæ¨¡å‹ã€‚ä½œä¸º FLUX.2 ç³»åˆ—ä¸­é€Ÿåº¦æœ€å¿«çš„è’¸é¦æ¨¡å‹ï¼Œå®ƒåœ¨ä¸€ä¸ªç´§å‡‘çš„æ¶æ„ä¸­ç»Ÿä¸€äº†ç”Ÿæˆå’Œç¼–è¾‘åŠŸèƒ½ï¼Œæ‹¥æœ‰ 40 äº¿å‚æ•°ï¼ˆ4Bï¼‰ï¼Œèƒ½å¤Ÿåœ¨æ¶ˆè´¹çº§æ˜¾å¡ï¼ˆçº¦ 13GB æ˜¾å­˜ï¼‰ä¸Šè¿è¡Œã€‚è¯¥æ¨¡å‹é‡‡ç”¨ Rectified Flow Transformer æ¶æ„ï¼Œå®ç°äº†äºšç§’çº§ï¼ˆSub-secondï¼‰çš„ç«¯åˆ°ç«¯æ¨ç†é€Ÿåº¦ï¼Œä¸“ä¸ºéœ€è¦å®æ—¶ç”Ÿæˆä¸”ä¸ç‰ºç‰²è´¨é‡çš„åº”ç”¨åœºæ™¯è®¾è®¡ã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2FKOkFI" target="_blank" title="https://go.openbayes.com/KOkFI" ref="nofollow noopener noreferrer">go.openbayes.com/KOkFI</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7efc9eac6b65444ca01841f2991c7f05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=rfwyZaFoeXDP6eYXCk4V%2BMh%2FhOo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p>
<p><strong>7. Pocket-TTSï¼šé«˜è´¨é‡è½»é‡çº§æµå¼ TTS ç³»ç»Ÿ</strong></p>
<p>Pocket-TTS æ˜¯ç”± Kyutai å®éªŒå®¤å‘å¸ƒçš„æè½»é‡åŒ–è¯­éŸ³åˆæˆæ¨¡å‹ã€‚è¯¥æ¨¡å‹ä¸“æ³¨äºä½å»¶è¿Ÿå’Œæµå¼è¾“å‡ºï¼Œæ—¨åœ¨ä¸ºèµ„æºå—é™çš„ç¯å¢ƒæˆ–éœ€è¦å®æ—¶äº¤äº’çš„åœºæ™¯ï¼ˆå¦‚ AI åŠ©æ‰‹ï¼‰æä¾›é«˜è´¨é‡çš„è¯­éŸ³ç”Ÿæˆèƒ½åŠ›ã€‚é‡‡ç”¨äº†ç«¯åˆ°ç«¯çš„ä¼˜åŒ–æ¶æ„ï¼Œåœ¨ä¿è¯éŸ³è´¨çš„åŒæ—¶ï¼Œæå¤§åœ°æå‡äº†æ¨ç†é€Ÿåº¦ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„åºå¤§ TTS ç³»ç»Ÿï¼Œå®ƒä¸ä»…ä½“ç§¯æ›´å°ï¼Œä¸”æ”¯æŒå®æ—¶æµå¼æ¨ç†ï¼Œç‰¹åˆ«é€‚åˆåœ¨é«˜æ€§èƒ½ç®—åŠ›å®¹å™¨ä¸Šè¿›è¡Œå¿«é€Ÿéƒ¨ç½²ä¸äº¤äº’å¼åº”ç”¨ã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2FZzj00" target="_blank" title="https://go.openbayes.com/Zzj00" ref="nofollow noopener noreferrer">go.openbayes.com/Zzj00</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f3986454bee43b88ec78e4b52cd442d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=gABErJPrjVoPzZKHcm0i%2BqLo33g%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p>
<p><strong>8. vLLM+Open WebUI éƒ¨ç½² Nemotron-3 Nano</strong></p>
<p>Nemotron-3-Nano-30B-A3B-BF16 æ˜¯ NVIDIA ä»é›¶å¼€å§‹è®­ç»ƒçš„å¤§å‹è¯­è¨€æ¨¡å‹ (LLM)ï¼Œæ—¨åœ¨æˆä¸ºä¸€ä¸ªç»Ÿä¸€çš„æ¨¡å‹ï¼ŒåŒæ—¶é€‚ç”¨äºæ¨ç†å’Œéæ¨ç†ä»»åŠ¡ã€‚ç”± NVIDIA Corporation å‘å¸ƒçš„ã€‚Nemotron-3-Nano-30B-A3B-BF16 é€‚ç”¨äºå¼€å‘äººå‘˜è®¾è®¡ AI ä»£ç†ç³»ç»Ÿã€èŠå¤©æœºå™¨äººã€RAG ç³»ç»Ÿå’Œå…¶ä»– AI åº”ç”¨ã€‚</p>
<p>åœ¨çº¿è¿è¡Œï¼š</p>
<p><em><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.openbayes.com%2FLUA9Q" target="_blank" title="https://go.openbayes.com/LUA9Q" ref="nofollow noopener noreferrer">go.openbayes.com/LUA9Q</a></strong></em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1b212b91004c26ac9c4f297c6ffa0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlbkJheWVz6LSd5byP6K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286187&amp;x-signature=bKXWABvFTNUHxrzbi44nA2u48cs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p align="center">é¡¹ç›®ç¤ºä¾‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Nativeæ–°æ¶æ„ä¹‹iOSç«¯åˆå§‹åŒ–æºç åˆ†æ]]></title>    <link>https://juejin.cn/post/7600223321041879046</link>    <guid>https://juejin.cn/post/7600223321041879046</guid>    <pubDate>2026-01-28T13:41:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600223321041879046" data-draft-id="7594000527509274665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Nativeæ–°æ¶æ„ä¹‹iOSç«¯åˆå§‹åŒ–æºç åˆ†æ"/> <meta itemprop="keywords" content="React Native,iOS,æºç é˜…è¯»"/> <meta itemprop="datePublished" content="2026-01-28T13:41:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¼–ç¨‹ä¹‹è·¯ä»0åˆ°1"/> <meta itemprop="url" content="https://juejin.cn/user/4125023359744296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Nativeæ–°æ¶æ„ä¹‹iOSç«¯åˆå§‹åŒ–æºç åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023359744296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¼–ç¨‹ä¹‹è·¯ä»0åˆ°1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T13:41:51.000Z" title="Wed Jan 28 2026 13:41:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React Nativeæ–°æ¶æ„ä¹‹iOSç«¯åˆå§‹åŒ–æºç åˆ†æ</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>æ³¨æ„ï¼Œæœ¬æ–‡æ˜¯åŸºäº<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Freact-native%2Ftree%2Fv0.83.0" target="_blank" title="https://github.com/facebook/react-native/tree/v0.83.0" ref="nofollow noopener noreferrer">React Native</a>Â 0.83ç‰ˆæœ¬æºç è¿›è¡Œåˆ†æã€‚æœ‰äº†å‰é¢å‡ ç¯‡Androidç«¯åˆ†ææ–‡ç« æ‰“åŸºç¡€ï¼Œå†æ¥ç†è§£iOSç«¯å°±æ˜“å¦‚åæŒäº†ã€‚æ€»çš„æ¥è¯´ï¼ŒiOSç«¯çš„å®ç°è¦æ¯”Androidç«¯ç®€å•å¤ªå¤šäº†ï¼Œè¿™æ˜¯å› ä¸ºAndroidç«¯çš„Java/Kotlin éƒ½æ˜¯è¿è¡Œåœ¨Javaçš„è™šæ‹Ÿæœºç¯å¢ƒä¸­ï¼Œå…¶ä¸C++é€šä¿¡è¦ç»è¿‡JNIï¼Œå¹¶ä¸å¦‚OCä¸C++äº’è°ƒé‚£ä¹ˆç®€å•ç›´æ¥ã€‚æ­¤å¤–ï¼ŒRNåŸºäºAndroidçš„Gradleæ„å»ºæœºåˆ¶ï¼Œä¹Ÿä½¿é—®é¢˜æ›´åŠ å¤æ‚ã€‚</p>
<h3 data-id="heading-2">åˆå§‹åŒ–æµç¨‹</h3>
<p>React Nativeçš„iOSç«¯ç›¸æ¯”äºå®‰å“ç«¯è¦ç®€å•å¾ˆå¤šã€‚ç°åœ¨æˆ‘ä»¬åŸºäºSwiftå…¥å£æ¥åˆ†æä¸€ä¸‹åˆå§‹åŒ–æµç¨‹ã€‚é¦–å…ˆæ‰¾åˆ°RNæºç å·¥ç¨‹ä¸­çš„æµ‹è¯•å·¥ç¨‹ï¼Œæ‰“å¼€æºç <code>react-native/private/helloworld/ios/HelloWorld/AppDelegate.swift</code>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> React                          <span class="hljs-comment">// React Native æ ¸å¿ƒæ¨¡å—</span>
<span class="hljs-keyword">import</span> ReactAppDependencyProvider     <span class="hljs-comment">// Codegen ç”Ÿæˆçš„ä¾èµ–æä¾›è€…</span>
<span class="hljs-keyword">import</span> React_RCTAppDelegate           <span class="hljs-comment">// AppDelegate ç›¸å…³ç±»</span>
<span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">@main</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDelegate</span>: <span class="hljs-title class_">UIResponder</span>, <span class="hljs-title class_">UIApplicationDelegate</span> {
  <span class="hljs-keyword">var</span> window: <span class="hljs-type">UIWindow</span>?

  <span class="hljs-keyword">var</span> reactNativeDelegate: <span class="hljs-type">ReactNativeDelegate</span>?
  <span class="hljs-keyword">var</span> reactNativeFactory: <span class="hljs-type">RCTReactNativeFactory</span>?

  <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(
    <span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>,
    <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span> <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>
  ) -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-comment">// 1: åˆ›å»º ReactNativeDelegate</span>
    <span class="hljs-keyword">let</span> delegate <span class="hljs-operator">=</span> <span class="hljs-type">ReactNativeDelegate</span>()
    <span class="hljs-comment">// 2: åˆ›å»º RCTReactNativeFactory</span>
    <span class="hljs-keyword">let</span> factory <span class="hljs-operator">=</span> <span class="hljs-type">RCTReactNativeFactory</span>(delegate: delegate)
    <span class="hljs-comment">// 3: é…ç½®ä¾èµ–æä¾›è€…ï¼ˆCodegen ç”Ÿæˆçš„æ¨¡å—ï¼‰</span>
    delegate.dependencyProvider <span class="hljs-operator">=</span> <span class="hljs-type">RCTAppDependencyProvider</span>()

    <span class="hljs-comment">// ä¿æŒå¼ºå¼•ç”¨</span>
    reactNativeDelegate <span class="hljs-operator">=</span> delegate
    reactNativeFactory <span class="hljs-operator">=</span> factory

    <span class="hljs-comment">// 4: é…ç½®å¼€å‘èœå•ï¼ˆä»… DEBUG æ¨¡å¼ï¼‰</span>
    <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
    <span class="hljs-keyword">let</span> devMenuConfiguration <span class="hljs-operator">=</span> <span class="hljs-type">RCTDevMenuConfiguration</span>(
      devMenuEnabled: <span class="hljs-literal">true</span>,
      shakeGestureEnabled: <span class="hljs-literal">true</span>,
      keyboardShortcutsEnabled: <span class="hljs-literal">true</span>
    )
    reactNativeFactory<span class="hljs-operator">?</span>.devMenuConfiguration <span class="hljs-operator">=</span> devMenuConfiguration
    <span class="hljs-keyword">#endif</span>

    <span class="hljs-comment">// 5: åˆ›å»ºä¸»çª—å£</span>
    window <span class="hljs-operator">=</span> <span class="hljs-type">UIWindow</span>(frame: <span class="hljs-type">UIScreen</span>.main.bounds)

    <span class="hljs-comment">// 6: å¯åŠ¨ React Native</span>
    factory.startReactNative(
      withModuleName: <span class="hljs-string">"HelloWorld"</span>,
      in: window,
      launchOptions: launchOptions
    )

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactNativeDelegate</span>: <span class="hljs-title class_">RCTDefaultReactNativeFactoryDelegate</span> {
  <span class="hljs-comment">// æ—§æ¶æ„å…¼å®¹ï¼ˆæ–°æ¶æ„ä¸­ä¼šè°ƒç”¨ bundleURLï¼‰</span>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">sourceURL</span>(<span class="hljs-params">for</span> <span class="hljs-params">bridge</span>: <span class="hljs-type">RCTBridge</span>) -&gt; <span class="hljs-type">URL</span>? {
    <span class="hljs-keyword">self</span>.bundleURL()
  }

  <span class="hljs-comment">// æä¾› JS Bundle çš„ URL</span>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">bundleURL</span>() -&gt; <span class="hljs-type">URL</span>? {
    <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
    <span class="hljs-comment">// å¼€å‘æ¨¡å¼ï¼šä» Metro å¼€å‘æœåŠ¡å™¨åŠ è½½</span>
    <span class="hljs-type">RCTBundleURLProvider</span>.sharedSettings().jsBundleURL(forBundleRoot: <span class="hljs-string">"index"</span>)
    <span class="hljs-keyword">#else</span>
    <span class="hljs-comment">// ç”Ÿäº§æ¨¡å¼ï¼šä» App Bundle åŠ è½½</span>
    <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">"main"</span>, withExtension: <span class="hljs-string">"jsbundle"</span>)
    <span class="hljs-keyword">#endif</span>
  }
}
</code></pre>
<p>Swift æ–°æ¶æ„ä½¿ç”¨ <code>@main</code> æ³¨è§£ä½œä¸ºåº”ç”¨å…¥å£ï¼Œæ— éœ€ <code>main.m</code> æˆ– <code>main.swift</code> æ–‡ä»¶ã€‚<code>ReactNativeDelegate</code> ç»§æ‰¿è‡ª <code>RCTDefaultReactNativeFactoryDelegate</code>ï¼Œè´Ÿè´£æä¾› Bundle URL å’Œè‡ªå®šä¹‰é…ç½®ã€‚</p>
<p>è¿™é‡Œ<code>RCTAppDependencyProvider</code>æ˜¯Objective-C++ä»£ç ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿ä¸C++äº’è°ƒã€‚æºç <code>tcode/react-native/packages/react-native/Libraries/AppDelegate/RCTReactNativeFactory.mm</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">RCTReactNativeFactory</span> () &lt;</span>
    RCTComponentViewFactoryComponentProvider, <span class="hljs-comment">// Fabric ç»„ä»¶æä¾›è€…</span>
    RCTHostDelegate,                          <span class="hljs-comment">// RCTHost ä»£ç†</span>
    RCTJSRuntimeConfiguratorProtocol,         <span class="hljs-comment">// JS Runtime é…ç½®</span>
    RCTTurboModuleManagerDelegate&gt;            <span class="hljs-comment">// TurboModule ç®¡ç†å™¨ä»£ç†</span>
<span class="hljs-keyword">@end</span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">RCTReactNativeFactory</span></span>

- (<span class="hljs-keyword">instancetype</span>)initWithDelegate:(<span class="hljs-type">id</span>&lt;RCTReactNativeFactoryDelegate&gt;)delegate
{
  <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> initWithDelegate:delegate releaseLevel:Stable];
}

- (<span class="hljs-keyword">instancetype</span>)initWithDelegate:(<span class="hljs-type">id</span>&lt;RCTReactNativeFactoryDelegate&gt;)delegate releaseLevel:(RCTReleaseLevel)releaseLevel
{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init]) {
    <span class="hljs-keyword">self</span>.delegate = delegate;
    [<span class="hljs-keyword">self</span> _setUpFeatureFlags:releaseLevel];
    <span class="hljs-comment">// è®¾ç½®é»˜è®¤é¢œè‰²ç©ºé—´</span>
    [RCTColorSpaceUtils applyDefaultColorSpace:[<span class="hljs-keyword">self</span> defaultColorSpace]];
    RCTEnableTurboModule(<span class="hljs-literal">YES</span>);

    <span class="hljs-comment">// åˆ›å»º RCTRootViewFactory</span>
    <span class="hljs-keyword">self</span>.rootViewFactory = [<span class="hljs-keyword">self</span> createRCTRootViewFactory];
    <span class="hljs-comment">// è®¾ç½®ç¬¬ä¸‰æ–¹ Fabric ç»„ä»¶æä¾›è€…</span>
    [RCTComponentViewFactory currentComponentViewFactory].thirdPartyFabricComponentsProvider = <span class="hljs-keyword">self</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°RCTReactNativeFactoryçš„æ„é€ é€»è¾‘éå¸¸ç®€å•ï¼Œä½†å®ƒå®ç°äº†å››ä¸ªå…³é”®åè®®ï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥ä½œä¸ºå¤šä¸ªå­ç³»ç»Ÿçš„ä»£ç†ã€‚</p>
<p>å…ˆé‡ç‚¹çœ‹ä¸€ä¸‹<code>createRCTRootViewFactory</code>æ–¹æ³•çš„å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³é”®æ–¹æ³•ï¼ŒåŒæ—¶è®¾ç½®äº†å¤§é‡çš„å›è°ƒ Block æ¥æ¡¥æ¥ä»£ç†æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (RCTRootViewFactory *)createRCTRootViewFactory
{
  __<span class="hljs-keyword">weak</span> __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;
  <span class="hljs-comment">// 1. åˆ›å»º Bundle URL æä¾›è€… Block</span>
  RCTBundleURLBlock bundleUrlBlock = ^{
    auto *strongSelf = weakSelf;
    <span class="hljs-keyword">return</span> strongSelf.bundleURL;
  };

  <span class="hljs-comment">// 2. åˆ›å»ºé…ç½®å¯¹è±¡ï¼ˆæ–°æ¶æ„é»˜è®¤å…¨éƒ¨å¯ç”¨ï¼‰</span>
  RCTRootViewFactoryConfiguration *configuration =
      [[RCTRootViewFactoryConfiguration alloc] initWithBundleURLBlock:bundleUrlBlock
                                                       newArchEnabled:<span class="hljs-literal">YES</span>
                                                   turboModuleEnabled:<span class="hljs-literal">YES</span>
                                                    bridgelessEnabled:<span class="hljs-literal">YES</span>];

  <span class="hljs-comment">// çœç•¥æ—§æ¶æ„ä»£ç ......</span>

  <span class="hljs-comment">// 3.é…ç½®æ ¹è§†å›¾è‡ªå®šä¹‰å›è°ƒ</span>
  configuration.customizeRootView = ^(<span class="hljs-built_in">UIView</span> *_Nonnull rootView) {
    [weakSelf.delegate customizeRootView:(RCTRootView *)rootView];
  };

  <span class="hljs-comment">// 4.é…ç½® Bundle URL è·å–å›è°ƒ</span>
  configuration.sourceURLForBridge = ^<span class="hljs-built_in">NSURL</span> *_Nullable(RCTBridge *_Nonnull bridge)
  {
    <span class="hljs-comment">// æ–°æ¶æ„ï¼šç›´æ¥ä½¿ç”¨ bundleURLï¼Œä¸å†ä¾èµ– bridge</span>
    <span class="hljs-keyword">return</span> [weakSelf.delegate bundleURL];
  };

  <span class="hljs-comment">// 5.é…ç½® Bundle åŠ è½½å›è°ƒï¼ˆæ”¯æŒè¿›åº¦ï¼‰</span>
  <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(loadSourceForBridge:onProgress:onComplete:)]) {
    configuration.loadSourceForBridgeWithProgress =
        ^(RCTBridge *_Nonnull bridge,
          RCTSourceLoadProgressBlock _Nonnull onProgress,
          RCTSourceLoadBlock _Nonnull loadCallback) {
          <span class="hljs-comment">// æ–°æ¶æ„ï¼šä½¿ç”¨ loadBundleAtURL æ›¿ä»£æ—§çš„ loadSourceForBridge</span>
          [weakSelf.delegate loadBundleAtURL:<span class="hljs-keyword">self</span>.bundleURL onProgress:onProgress onComplete:loadCallback];
        };
  }

  <span class="hljs-comment">// 6.é…ç½®æ— è¿›åº¦çš„ Bundle åŠ è½½å›è°ƒ</span>
  <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(loadSourceForBridge:withBlock:)]) {
    configuration.loadSourceForBridge = ^(RCTBridge *_Nonnull bridge, RCTSourceLoadBlock _Nonnull loadCallback) {
      <span class="hljs-comment">// æ–°æ¶æ„ï¼šä½¿ç”¨ loadBundleAtURLï¼Œè¿›åº¦å›è°ƒä¸ºç©º</span>
      [weakSelf.delegate loadBundleAtURL:<span class="hljs-keyword">self</span>.bundleURL
                              onProgress:^(RCTLoadingProgress *progressData) {
                              }
                              onComplete:loadCallback];
    };
  }

  <span class="hljs-comment">// 7.è®¾ç½® JS Runtime ä»£ç†</span>
  configuration.jsRuntimeConfiguratorDelegate = <span class="hljs-keyword">self</span>;
  <span class="hljs-comment">// 8.åˆ›å»ºå¹¶è¿”å› RCTRootViewFactory</span>
  <span class="hljs-keyword">return</span> [[RCTRootViewFactory alloc] initWithTurboModuleDelegate:<span class="hljs-keyword">self</span> hostDelegate:<span class="hljs-keyword">self</span> configuration:configuration];
}
</code></pre>
<p>è¿™é‡Œçš„å¤§æ¦‚æµç¨‹æ˜¯éå¸¸æ¸…æ¥šçš„ï¼Œä¸»è¦å°±æ˜¯è®¾ç½®äº†å››ä¸ªåè®®çš„ä»£ç†ã€‚æˆ‘ä»¬å°†æµç¨‹ç»˜åˆ¶æˆä¸€ä¸ªå…³ç³»å›¾ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RCTReactNativeFactory                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å®ç°åè®®:                                                          â”‚  â”‚
â”‚  â”‚  â€¢ RCTTurboModuleManagerDelegate    â†’ TurboModule ç±»/å®ä¾‹æŸ¥æ‰¾      â”‚  â”‚
â”‚  â”‚  â€¢ RCTHostDelegate                  â†’ Host ç”Ÿå‘½å‘¨æœŸ + Bundle åŠ è½½  â”‚  â”‚
â”‚  â”‚  â€¢ RCTJSRuntimeConfiguratorProtocol â†’ JS Runtime å·¥å‚åˆ›å»º         â”‚  â”‚
â”‚  â”‚  â€¢ RCTComponentViewFactoryComponentProvider â†’ Fabric ç»„ä»¶æ³¨å†Œ     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ createRCTRootViewFactory() ä¸­è®¾ç½®:                                 â”‚  â”‚
â”‚  â”‚  â€¢ initWithTurboModuleDelegate: <span class="hljs-built_in">self</span>  â† RCTTurboModuleManagerDelegateâ”‚
â”‚  â”‚  â€¢ hostDelegate: <span class="hljs-built_in">self</span>                 â† RCTHostDelegate              â”‚
â”‚  â”‚  â€¢ jsRuntimeConfiguratorDelegate: <span class="hljs-built_in">self</span> â† RCTJSRuntimeConfiguratorProtocolâ”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                     â”‚
â”‚                                    â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åˆå§‹åŒ–æ—¶è®¾ç½®:                                                       â”‚  â”‚
â”‚  â”‚  â€¢ thirdPartyFabricComponentsProvider = <span class="hljs-built_in">self</span>                       â”‚  â”‚
â”‚  â”‚    â† RCTComponentViewFactoryComponentProvider                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-3">RCTTurboModuleManagerDelegate</h4>
<p>ä¸»è¦è´Ÿè´£ TurboModule çš„ç±»æŸ¥æ‰¾å’Œå®ä¾‹åˆ›å»ºï¼Œæºç <code>react-native/packages/react-native/ReactCommon/react/nativemodule/core/platform/ios/ReactCommon/RCTTurboModuleManager.h</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTBridgeProxy</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTTurboModuleManager</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTDevMenuConfigurationDecorator</span>;</span>

<span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">RCTTurboModuleManagerDelegate</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span>

<span class="hljs-comment">/**
 * ç»™å®šæ¨¡å—åç§°ï¼Œè¿”å›å…¶å®é™…ç±»ã€‚å¦‚æœè¿”å› nilï¼Œåˆ™æ‰§è¡ŒåŸºæœ¬çš„ ObjC ç±»æŸ¥æ‰¾
 */</span>
- (Class)getModuleClassFromName:(<span class="hljs-keyword">const</span> <span class="hljs-type">char</span> *)name;

<span class="hljs-comment">/**
 * ç»™å®šä¸€ä¸ªæ¨¡å—ç±»ï¼Œä¸ºå…¶æä¾›ä¸€ä¸ªå®ä¾‹ã€‚å¦‚æœè¿”å›å€¼ä¸º nilï¼Œåˆ™ä½¿ç”¨é»˜è®¤åˆå§‹åŒ–å™¨
 */</span>
- (<span class="hljs-type">id</span>&lt;RCTTurboModule&gt;)getModuleInstanceFromClass:(Class)moduleClass;

<span class="hljs-keyword">@optional</span>

<span class="hljs-comment">/**
 * æ­¤æ–¹æ³•ç”¨äºè·å–ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥åˆ›å»º `facebook::react::TurboModule` å®ä¾‹ã€‚
 * å®ç° `RCTTurboModuleProvider` æ¥å£çš„ç±»å¿…é¡»æ˜¯ Objective-C ç±»ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»£ç ç”Ÿæˆå·¥å…·å¯¹å…¶è¿›è¡ŒåŠ¨æ€åˆå§‹åŒ–ã€‚
 */</span>
- (<span class="hljs-type">id</span>&lt;RCTModuleProvider&gt;)getModuleProvider:(<span class="hljs-keyword">const</span> <span class="hljs-type">char</span> *)name;

<span class="hljs-comment">/**
 * åˆ›å»ºä¸€ä¸ª TurboModule å®ä¾‹ï¼Œè€Œæ— éœ€ä¾èµ–ä»»ä½• ObjC++ æ¨¡å—å®ä¾‹
 */</span>
- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:(<span class="hljs-keyword">const</span> std::string &amp;)name
                                                      jsInvoker:
                                                          (std::shared_ptr&lt;facebook::react::CallInvoker&gt;)jsInvoker;

- (<span class="hljs-type">void</span>)installJSBindings:(facebook::jsi::Runtime &amp;)runtime;

- (<span class="hljs-type">void</span>)invalidate;

<span class="hljs-keyword">@end</span>
</code></pre>
<p>å†æ¥çœ‹çœ‹<strong>RCTReactNativeFactory</strong> ä¸­çš„å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - RCTTurboModuleManagerDelegate</span>

- (Class)getModuleClassFromName:(<span class="hljs-keyword">const</span> <span class="hljs-type">char</span> *)name
{
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RN_DISABLE_OSS_PLUGIN_HEADER</span>
  <span class="hljs-keyword">return</span> RCTTurboModulePluginClassProvider(name);
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
  <span class="hljs-comment">// å…ˆå°è¯•ä» delegate è·å–</span>
  <span class="hljs-keyword">if</span> ([_delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(getModuleClassFromName:)]) {
    Class moduleClass = [_delegate getModuleClassFromName:name];
    <span class="hljs-keyword">if</span> (moduleClass != <span class="hljs-literal">nil</span>) {
      <span class="hljs-keyword">return</span> moduleClass;
    }
  }
  <span class="hljs-keyword">return</span> RCTCoreModulesClassProvider(name);
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

- (<span class="hljs-keyword">nullable</span> <span class="hljs-type">id</span>&lt;RCTModuleProvider&gt;)getModuleProvider:(<span class="hljs-keyword">const</span> <span class="hljs-type">char</span> *)name
{
  <span class="hljs-keyword">if</span> ([_delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(getModuleProvider:)]) {
    <span class="hljs-keyword">return</span> [_delegate getModuleProvider:name];
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
}

<span class="hljs-comment">// åˆ›å»ºçº¯ C++ TurboModule</span>
- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:(<span class="hljs-keyword">const</span> std::string &amp;)name
                                                      jsInvoker:(std::shared_ptr&lt;facebook::react::CallInvoker&gt;)jsInvoker
{
  <span class="hljs-keyword">if</span> ([_delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(getTurboModule:jsInvoker:)]) {
    <span class="hljs-keyword">return</span> [_delegate getTurboModule:name jsInvoker:jsInvoker];
  }

  <span class="hljs-keyword">return</span> facebook::react::DefaultTurboModules::getTurboModule(name, jsInvoker);
}

- (<span class="hljs-type">id</span>&lt;RCTTurboModule&gt;)getModuleInstanceFromClass:(Class)moduleClass
{
<span class="hljs-meta">#<span class="hljs-keyword">if</span> USE_OSS_CODEGEN</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate.dependencyProvider == <span class="hljs-literal">nil</span>) {
    [<span class="hljs-built_in">NSException</span> raise:<span class="hljs-string">@"ReactNativeFactoryDelegate dependencyProvider is nil"</span>
                format:<span class="hljs-string">@"Delegate must provide a valid dependencyProvider"</span>];
  }
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
  <span class="hljs-keyword">if</span> ([_delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(getModuleInstanceFromClass:)]) {
    <span class="hljs-type">id</span>&lt;RCTTurboModule&gt; moduleInstance = [_delegate getModuleInstanceFromClass:moduleClass];
    <span class="hljs-keyword">if</span> (moduleInstance != <span class="hljs-literal">nil</span>) {
      <span class="hljs-keyword">return</span> moduleInstance;
    }
  }
  <span class="hljs-comment">// ä½¿ç”¨é»˜è®¤æ–¹å¼åˆ›å»ºï¼ˆé€šè¿‡ dependencyProviderï¼‰</span>
  <span class="hljs-keyword">return</span> RCTAppSetupDefaultModuleFromClass(moduleClass, <span class="hljs-keyword">self</span>.delegate.dependencyProvider);
}
</code></pre>
<h4 data-id="heading-4">RCTHostDelegate</h4>
<p>ä¸»è¦è´Ÿè´£ RCTHost çš„ç”Ÿå‘½å‘¨æœŸå’Œ Bundle åŠ è½½ã€‚æºç <code>react-native/packages/react-native/ReactCommon/react/runtime/platform/ios/ReactCommon/RCTHost.h</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span>

<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTFabricSurface</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTHost</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTModuleRegistry</span>;</span>
<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">RCTDevMenuConfiguration</span>;</span>

<span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">RCTTurboModuleManagerDelegate</span>;</span>

<span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NSURL</span> *_Nullable (^RCTHostBundleURLProvider)(<span class="hljs-type">void</span>);

<span class="hljs-comment">// Runtime API</span>

<span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">RCTHostDelegate</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span>
<span class="hljs-comment">// Host å¯åŠ¨å®Œæˆé€šçŸ¥</span>
- (<span class="hljs-type">void</span>)hostDidStart:(RCTHost *)host;

<span class="hljs-keyword">@optional</span>
<span class="hljs-comment">// éœ€è¦åœ¨ä¸»çº¿ç¨‹åˆå§‹åŒ–çš„æ¨¡å—åˆ—è¡¨</span>
- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)unstableModulesRequiringMainQueueSetup;

<span class="hljs-comment">// åŠ è½½ Bundleï¼ˆæ”¯æŒè¿›åº¦å›è°ƒï¼‰</span>
- (<span class="hljs-type">void</span>)loadBundleAtURL:(<span class="hljs-built_in">NSURL</span> *)sourceURL
             onProgress:(RCTSourceLoadProgressBlock)onProgress
             onComplete:(RCTSourceLoadBlock)loadCallback;

<span class="hljs-keyword">@end</span>


<span class="hljs-built_in">NS_ASSUME_NONNULL_END</span>
</code></pre>
<p>æŸ¥çœ‹<strong>RCTReactNativeFactory</strong> ä¸­çš„å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - RCTHostDelegate</span>

- (<span class="hljs-type">void</span>)hostDidStart:(RCTHost *)host
{
  <span class="hljs-keyword">if</span> ([_delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(hostDidStart:)]) {
    [_delegate hostDidStart:host];
  }
}

- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)unstableModulesRequiringMainQueueSetup
{
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RN_DISABLE_OSS_PLUGIN_HEADER</span>
  <span class="hljs-keyword">return</span> RCTTurboModulePluginUnstableModulesRequiringMainQueueSetup();
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.delegate.dependencyProvider
      ? RCTAppSetupUnstableModulesRequiringMainQueueSetup(<span class="hljs-keyword">self</span>.delegate.dependencyProvider)
      : @[];
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}
</code></pre>
<h4 data-id="heading-5">RCTJSRuntimeConfiguratorProtocol</h4>
<p>ä¸»è¦è´Ÿè´£åˆ›å»º JS Runtime å·¥å‚ï¼Œæºç <code>react-native/packages/react-native/Libraries/AppDelegate/RCTJSRuntimeConfiguratorProtocol.h</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span>

<span class="hljs-comment">// Forward declarations for umbrella headers.</span>
<span class="hljs-comment">// In implementations, import `&lt;react/runtime/JSRuntimeFactoryCAPI.h&gt;` to obtain the actual type.</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-type">void</span> *JSRuntimeFactoryRef;

<span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">RCTJSRuntimeConfiguratorProtocol</span></span>

<span class="hljs-comment">// åˆ›å»º JS Runtime å·¥å‚ï¼ˆé€šå¸¸è¿”å› Hermesï¼‰</span>
- (JSRuntimeFactoryRef)createJSRuntimeFactory;

<span class="hljs-keyword">@end</span>

<span class="hljs-built_in">NS_ASSUME_NONNULL_END</span>
</code></pre>
<p>æŸ¥çœ‹<strong>RCTReactNativeFactory</strong> ä¸­çš„å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - RCTJSRuntimeConfiguratorProtocol</span>

- (JSRuntimeFactoryRef)createJSRuntimeFactory
{
  <span class="hljs-comment">// å§”æ‰˜ç»™ç”¨æˆ·çš„ delegate</span>
  <span class="hljs-keyword">return</span> [_delegate createJSRuntimeFactory];
}
</code></pre>
<h4 data-id="heading-6">RCTComponentViewFactoryComponentProvider</h4>
<p>ä¸»è¦è´Ÿè´£æä¾›ç¬¬ä¸‰æ–¹ Fabric ç»„ä»¶ï¼Œæºç <code>react-native/packages/react-native/React/Fabric/Mounting/RCTComponentViewFactory.h</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">/**
 * å¯ç”¨äºå‘ Fabric æä¾›ç¬¬ä¸‰æ–¹ç»„ä»¶çš„åè®®ã€‚
 * Fabric å°†æ£€æŸ¥æ­¤æ˜ å°„è¡¨ï¼Œä»¥ç¡®å®šæ˜¯å¦å­˜åœ¨éœ€è¦æ³¨å†Œçš„ç»„ä»¶ã€‚
 */</span>
<span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">RCTComponentViewFactoryComponentProvider</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span>

<span class="hljs-comment">/**
 * è¿”å›ä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å­—å…¸ï¼Œå…¶ä¸­ `key` æ˜¯ç»„ä»¶å¤„ç†ç¨‹åºï¼Œ`value` æ˜¯ä¸€ä¸ªç¬¦åˆ `RCTComponentViewProtocol` åè®®çš„ç±»
 */</span>
- (<span class="hljs-built_in">NSDictionary</span>&lt;<span class="hljs-built_in">NSString</span> *, Class&lt;RCTComponentViewProtocol&gt;&gt; *)thirdPartyFabricComponents;

<span class="hljs-keyword">@end</span>
</code></pre>
<p>æŸ¥çœ‹<strong>RCTReactNativeFactory</strong> ä¸­çš„å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - RCTComponentViewFactoryComponentProvider</span>

- (<span class="hljs-built_in">NSDictionary</span>&lt;<span class="hljs-built_in">NSString</span> *, Class&lt;RCTComponentViewProtocol&gt;&gt; *)thirdPartyFabricComponents
{
  <span class="hljs-comment">// å…ˆå°è¯•ä» delegate è·å–</span>
  <span class="hljs-keyword">if</span> ([_delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(thirdPartyFabricComponents)]) {
    <span class="hljs-keyword">return</span> _delegate.thirdPartyFabricComponents;
  }
  <span class="hljs-comment">// å›é€€åˆ° dependencyProviderï¼ˆCodegen ç”Ÿæˆï¼‰</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.delegate.dependencyProvider ? <span class="hljs-keyword">self</span>.delegate.dependencyProvider.thirdPartyFabricComponents : @{};
}
</code></pre>
<h4 data-id="heading-7">RCTDefaultReactNativeFactoryDelegate</h4>
<p>ä»¥ä¸Šåçš„å¾ˆå¤šæ–¹æ³•çš„å®ç°ï¼Œå…¶å®ä¹Ÿæ˜¯ä»£ç†ç»™<strong>RCTReactNativeFactory</strong> ä¸­çš„<code>delegate</code>å¯¹è±¡ã€‚æ­¤<code>delegate</code>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹è‡ªå®šä¹‰çš„<code>ReactNativeDelegate</code>å®ä¾‹ã€‚å…¶ä¹Ÿæ˜¯ç»§æ‰¿è‡ª<code>RCTDefaultReactNativeFactoryDelegate</code>ï¼Œç°åœ¨åˆ†æä¸€ä¸‹æ­¤ç±»çš„å®ç°ï¼Œæºç <code>react-native/packages/react-native/Libraries/AppDelegate/RCTDefaultReactNativeFactoryDelegate.mm</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">RCTDefaultReactNativeFactoryDelegate</span></span>

<span class="hljs-keyword">@synthesize</span> dependencyProvider;
<span class="hljs-comment">// æŠ½è±¡æ–¹æ³•ï¼šå­ç±»å¿…é¡»å®ç°</span>
- (<span class="hljs-built_in">NSURL</span> *_Nullable)sourceURLForBridge:(<span class="hljs-keyword">nonnull</span> RCTBridge *)bridge
{
  [<span class="hljs-built_in">NSException</span> raise:<span class="hljs-string">@"RCTBridgeDelegate::sourceURLForBridge not implemented"</span>
              format:<span class="hljs-string">@"Subclasses must implement a valid sourceURLForBridge method"</span>];
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
}

- (<span class="hljs-built_in">UIViewController</span> *)createRootViewController
{
  <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIViewController</span> new];
}

- (<span class="hljs-type">void</span>)setRootView:(<span class="hljs-built_in">UIView</span> *)rootView toRootViewController:(<span class="hljs-built_in">UIViewController</span> *)rootViewController
{
  rootViewController.view = rootView;
}

- (JSRuntimeFactoryRef)createJSRuntimeFactory
{
<span class="hljs-meta">#<span class="hljs-keyword">if</span> USE_THIRD_PARTY_JSC != 1</span>
  <span class="hljs-keyword">return</span> jsrt_create_hermes_factory();
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

- (<span class="hljs-type">void</span>)customizeRootView:(RCTRootView *)rootView
{
  <span class="hljs-comment">// Override point for customization after application launch.</span>
}

- (RCTColorSpace)defaultColorSpace
{
  <span class="hljs-keyword">return</span> RCTColorSpaceSRGB;
}

- (<span class="hljs-built_in">NSURL</span> *_Nullable)bundleURL
{
  [<span class="hljs-built_in">NSException</span> raise:<span class="hljs-string">@"RCTAppDelegate::bundleURL not implemented"</span>
              format:<span class="hljs-string">@"Subclasses must implement a valid getBundleURL method"</span>];
  <span class="hljs-keyword">return</span> nullptr;
}

- (<span class="hljs-built_in">NSDictionary</span>&lt;<span class="hljs-built_in">NSString</span> *, Class&lt;RCTComponentViewProtocol&gt;&gt; *)thirdPartyFabricComponents
{
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">self</span>.dependencyProvider != nullptr) ? <span class="hljs-keyword">self</span>.dependencyProvider.thirdPartyFabricComponents : @{};
}

- (<span class="hljs-type">void</span>)hostDidStart:(RCTHost *)host
{
}

- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)unstableModulesRequiringMainQueueSetup
{
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">self</span>.dependencyProvider != nullptr)
      ? RCTAppSetupUnstableModulesRequiringMainQueueSetup(<span class="hljs-keyword">self</span>.dependencyProvider)
      : @[];
}

- (<span class="hljs-keyword">nullable</span> <span class="hljs-type">id</span>&lt;RCTModuleProvider&gt;)getModuleProvider:(<span class="hljs-keyword">const</span> <span class="hljs-type">char</span> *)name
{
  <span class="hljs-built_in">NSString</span> *providerName = [<span class="hljs-built_in">NSString</span> stringWithCString:name encoding:<span class="hljs-built_in">NSUTF8StringEncoding</span>];
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">self</span>.dependencyProvider != nullptr) ? <span class="hljs-keyword">self</span>.dependencyProvider.moduleProviders[providerName] : nullptr;
}

- (std::shared_ptr&lt;facebook::react::TurboModule&gt;)getTurboModule:(<span class="hljs-keyword">const</span> std::string &amp;)name
                                                      jsInvoker:(std::shared_ptr&lt;facebook::react::CallInvoker&gt;)jsInvoker
{
  <span class="hljs-keyword">return</span> facebook::react::DefaultTurboModules::getTurboModule(name, jsInvoker);
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> mark - RCTArchConfiguratorProtocol</span>

- (<span class="hljs-type">BOOL</span>)newArchEnabled
{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;
}

- (<span class="hljs-type">BOOL</span>)bridgelessEnabled
{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;
}

- (<span class="hljs-type">BOOL</span>)fabricEnabled
{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;
}

- (<span class="hljs-type">BOOL</span>)turboModuleEnabled
{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;
}

- (Class)getModuleClassFromName:(<span class="hljs-keyword">const</span> <span class="hljs-type">char</span> *)name
{
  <span class="hljs-keyword">return</span> nullptr;
}

- (<span class="hljs-type">id</span>&lt;RCTTurboModule&gt;)getModuleInstanceFromClass:(Class)moduleClass
{
  <span class="hljs-keyword">return</span> nullptr;
}

- (<span class="hljs-type">void</span>)loadSourceForBridge:(RCTBridge *)bridge
                 onProgress:(RCTSourceLoadProgressBlock)onProgress
                 onComplete:(RCTSourceLoadBlock)loadCallback
{
  [RCTJavaScriptLoader loadBundleAtURL:[<span class="hljs-keyword">self</span> sourceURLForBridge:bridge] onProgress:onProgress onComplete:loadCallback];
}

<span class="hljs-keyword">@end</span>
</code></pre>
<h4 data-id="heading-8">React Native å¯åŠ¨</h4>
<p>å¯¹äºä»¥ä¸Šå››ä¸ªåè®®ä»¥åŠä»£ç†ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†å¤§æ¦‚è®¤è¯†ï¼Œç°åœ¨åº”è¯¥æŠŠè§†çº¿æ‹‰å›<strong>AppDelegate</strong>ä¸­çš„åˆå§‹åŒ–æµç¨‹ï¼Œç»§ç»­åˆ†æ<code>startReactNative</code>æ–¹æ³•çš„å®ç°ï¼Œå®ƒå¯¹åº”çš„OCæ–¹æ³•ååº”è¯¥æ˜¯<code>startReactNativeWithModuleName</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (<span class="hljs-type">void</span>)startReactNativeWithModuleName:(<span class="hljs-built_in">NSString</span> *)moduleName
                              inWindow:(<span class="hljs-built_in">UIWindow</span> *_Nullable)window
                         launchOptions:(<span class="hljs-built_in">NSDictionary</span> *_Nullable)launchOptions
{
  [<span class="hljs-keyword">self</span> startReactNativeWithModuleName:moduleName inWindow:window initialProperties:<span class="hljs-literal">nil</span> launchOptions:launchOptions];
}

- (<span class="hljs-type">void</span>)startReactNativeWithModuleName:(<span class="hljs-built_in">NSString</span> *)moduleName
                              inWindow:(<span class="hljs-built_in">UIWindow</span> *_Nullable)window
                     initialProperties:(<span class="hljs-built_in">NSDictionary</span> *_Nullable)initialProperties
                         launchOptions:(<span class="hljs-built_in">NSDictionary</span> *_Nullable)launchOptions
{
  <span class="hljs-comment">// 1. é€šè¿‡ RootViewFactory åˆ›å»ºæ ¹è§†å›¾</span>
  <span class="hljs-built_in">UIView</span> *rootView = [<span class="hljs-keyword">self</span>.rootViewFactory viewWithModuleName:moduleName
                                            initialProperties:initialProperties
                                                launchOptions:launchOptions
                                         devMenuConfiguration:<span class="hljs-keyword">self</span>.devMenuConfiguration];
  <span class="hljs-comment">// 2. åˆ›å»º RootViewController</span>
  <span class="hljs-built_in">UIViewController</span> *rootViewController = [_delegate createRootViewController];
  <span class="hljs-comment">// 3. è®¾ç½®æ ¹è§†å›¾</span>
  [_delegate setRootView:rootView toRootViewController:rootViewController];
  <span class="hljs-comment">// 4. é…ç½®çª—å£å¹¶æ˜¾ç¤º</span>
  window.rootViewController = rootViewController;
  [window makeKeyAndVisible];
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæµç¨‹ååˆ†æ¸…æ¥šï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¸ª<code>viewWithModuleName</code>æ–¹æ³•å®ç°ã€‚</p>
<h5 data-id="heading-9">RCTHost  (ReactHost)åˆå§‹åŒ–</h5>
<p>æŸ¥çœ‹æºç <code>react-native/packages/react-native/Libraries/AppDelegate/RCTRootViewFactory.mm</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (<span class="hljs-built_in">UIView</span> *)viewWithModuleName:(<span class="hljs-built_in">NSString</span> *)moduleName
             initialProperties:(<span class="hljs-built_in">NSDictionary</span> *)initProps
                 launchOptions:(<span class="hljs-built_in">NSDictionary</span> *)launchOptions
          devMenuConfiguration:(RCTDevMenuConfiguration *)devMenuConfiguration
{
  <span class="hljs-comment">// 1. åˆå§‹åŒ– ReactHost</span>
  [<span class="hljs-keyword">self</span> initializeReactHostWithLaunchOptions:launchOptions devMenuConfiguration:devMenuConfiguration];

  <span class="hljs-comment">// 2. åˆ›å»º Fabric Surface</span>
  RCTFabricSurface *surface = [<span class="hljs-keyword">self</span>.reactHost createSurfaceWithModuleName:moduleName
                                                        initialProperties:initProps ? initProps : @{}];
   <span class="hljs-comment">// 3. åˆ›å»º SurfaceHostingProxyRootView</span>
  RCTSurfaceHostingProxyRootView *surfaceHostingProxyRootView =
      [[RCTSurfaceHostingProxyRootView alloc] initWithSurface:surface];

  surfaceHostingProxyRootView.backgroundColor = [<span class="hljs-built_in">UIColor</span> systemBackgroundColor];
  <span class="hljs-keyword">if</span> (_configuration.customizeRootView != <span class="hljs-literal">nil</span>) {
    <span class="hljs-comment">// 4. è‡ªå®šä¹‰æ ¹è§†å›¾</span>
    _configuration.customizeRootView(surfaceHostingProxyRootView);
  }
  <span class="hljs-keyword">return</span> surfaceHostingProxyRootView;
}


- (<span class="hljs-type">void</span>)initializeReactHostWithLaunchOptions:(<span class="hljs-built_in">NSDictionary</span> *)launchOptions
                        devMenuConfiguration:(RCTDevMenuConfiguration *)devMenuConfiguration
{
  <span class="hljs-comment">// Enable TurboModule interop by default in Bridgeless mode</span>
  RCTEnableTurboModuleInterop(<span class="hljs-literal">YES</span>);
  RCTEnableTurboModuleInteropBridgeProxy(<span class="hljs-literal">YES</span>);

  [<span class="hljs-keyword">self</span> createReactHostIfNeeded:launchOptions devMenuConfiguration:devMenuConfiguration];
  <span class="hljs-keyword">return</span>;
}

- (<span class="hljs-type">void</span>)createReactHostIfNeeded:(<span class="hljs-built_in">NSDictionary</span> *)launchOptions
           devMenuConfiguration:(RCTDevMenuConfiguration *)devMenuConfiguration
{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.reactHost) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">self</span>.reactHost = [<span class="hljs-keyword">self</span> createReactHost:launchOptions devMenuConfiguration:devMenuConfiguration];
}


- (RCTHost *)createReactHost:(<span class="hljs-built_in">NSDictionary</span> *)launchOptions
        devMenuConfiguration:(RCTDevMenuConfiguration *)devMenuConfiguration
{
  __<span class="hljs-keyword">weak</span> __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;
  RCTHost *reactHost =
      [[RCTHost alloc] initWithBundleURLProvider:<span class="hljs-keyword">self</span>-&gt;_configuration.bundleURLBlock
                                    hostDelegate:_hostDelegate
                      turboModuleManagerDelegate:_turboModuleManagerDelegate
                                jsEngineProvider:^std::shared_ptr&lt;facebook::react::JSRuntimeFactory&gt;() {
                                  <span class="hljs-keyword">return</span> [weakSelf createJSRuntimeFactory];
                                }
                                   launchOptions:launchOptions
                            devMenuConfiguration:devMenuConfiguration];
  <span class="hljs-comment">// è®¾ç½® Bundle URL æä¾›è€…</span>
  [reactHost setBundleURLProvider:^<span class="hljs-built_in">NSURL</span> *() {
    <span class="hljs-keyword">return</span> [weakSelf bundleURL];
  }];
  <span class="hljs-comment">// å¯åŠ¨ ReactHost</span>
  [reactHost start];
  <span class="hljs-keyword">return</span> reactHost;
}
</code></pre>
<h5 data-id="heading-10">RCTInstance åˆå§‹åŒ–</h5>
<p>ç»§ç»­è·Ÿè¸ª<code>RCTHost</code>çš„<code>start</code>æ–¹æ³•ã€‚æºç <code>react-native/packages/react-native/ReactCommon/react/runtime/platform/ios/ReactCommon/RCTHost.mm</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (<span class="hljs-type">void</span>)start
{
  <span class="hljs-comment">// 1. è®¾ç½® Bundle URL</span>
  <span class="hljs-keyword">if</span> (_bundleURLProvider) {
    [<span class="hljs-keyword">self</span> _setBundleURL:_bundleURLProvider()];
  }

  <span class="hljs-comment">// 2. è®¾ç½® Inspector Targetï¼ˆç”¨äºè°ƒè¯•ï¼‰</span>
  auto &amp;inspectorFlags = jsinspector_modern::InspectorFlags::getInstance();
  <span class="hljs-keyword">if</span> (inspectorFlags.getFuseboxEnabled() &amp;&amp; !_inspectorPageId.has_value()) {
    _inspectorTarget =
        facebook::react::jsinspector_modern::HostTarget::create(*_inspectorHostDelegate, [](auto callback) {
          RCTExecuteOnMainQueue(^{
            callback();
          });
        });
    __<span class="hljs-keyword">weak</span> RCTHost *weakSelf = <span class="hljs-keyword">self</span>;
    _inspectorPageId = facebook::react::jsinspector_modern::getInspectorInstance().addPage(
        <span class="hljs-string">"React Native Bridgeless"</span>,
        <span class="hljs-comment">/* vm */</span> <span class="hljs-string">""</span>,
        [weakSelf](std::unique_ptr&lt;facebook::react::jsinspector_modern::IRemoteConnection&gt; remote)
            -&gt; std::unique_ptr&lt;facebook::react::jsinspector_modern::ILocalConnection&gt; {
          RCTHost *strongSelf = weakSelf;
          <span class="hljs-keyword">if</span> (!strongSelf) {
            <span class="hljs-comment">// This can happen if we're about to be dealloc'd. Reject the connection.</span>
            <span class="hljs-keyword">return</span> nullptr;
          }
          <span class="hljs-keyword">return</span> strongSelf-&gt;_inspectorTarget-&gt;connect(std::move(remote));
        },
        {.nativePageReloads = <span class="hljs-literal">true</span>, .prefersFuseboxFrontend = <span class="hljs-literal">true</span>});
  }
  <span class="hljs-keyword">if</span> (_instance) {
    RCTLogWarn(
        <span class="hljs-string">@"RCTHost should not be creating a new instance if one already exists. This implies there is a bug with how/when this method is being called."</span>);
    [_instance invalidate];
  }

  <span class="hljs-comment">// 3. åˆ›å»º RCTInstance</span>
  _instance = [[RCTInstance alloc] initWithDelegate:<span class="hljs-keyword">self</span>
                                   jsRuntimeFactory:[<span class="hljs-keyword">self</span> _provideJSEngine]
                                      bundleManager:_bundleManager
                         turboModuleManagerDelegate:_turboModuleManagerDelegate
                                     moduleRegistry:_moduleRegistry
                              parentInspectorTarget:_inspectorTarget.get()
                                      launchOptions:_launchOptions
                               devMenuConfiguration:_devMenuConfiguration];
  <span class="hljs-comment">// 4. é€šçŸ¥ä»£ç† Host å·²å¯åŠ¨</span>
  [_hostDelegate hostDidStart:<span class="hljs-keyword">self</span>];
}
</code></pre>
<p>ç»§ç»­æŸ¥çœ‹<code>RCTInstance</code>çš„æ„é€ å®ç°ï¼Œæºç <code>react-native/packages/react-native/ReactCommon/react/runtime/platform/ios/ReactCommon/RCTInstance.mm</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (<span class="hljs-keyword">instancetype</span>)initWithDelegate:(<span class="hljs-type">id</span>&lt;RCTInstanceDelegate&gt;)delegate
                jsRuntimeFactory:(std::shared_ptr&lt;facebook::react::JSRuntimeFactory&gt;)jsRuntimeFactory
                   bundleManager:(RCTBundleManager *)bundleManager
      turboModuleManagerDelegate:(<span class="hljs-type">id</span>&lt;RCTTurboModuleManagerDelegate&gt;)tmmDelegate
                  moduleRegistry:(RCTModuleRegistry *)moduleRegistry
           parentInspectorTarget:(jsinspector_modern::HostTarget *)parentInspectorTarget
                   launchOptions:(<span class="hljs-keyword">nullable</span> <span class="hljs-built_in">NSDictionary</span> *)launchOptions
            devMenuConfiguration:(RCTDevMenuConfiguration *)devMenuConfiguration
{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init]) {
    <span class="hljs-comment">// æ€§èƒ½ç›‘æ§åˆå§‹åŒ–</span>
    _performanceLogger = [RCTPerformanceLogger new];
    registerPerformanceLoggerHooks(_performanceLogger);
    [_performanceLogger markStartForTag:RCTPLReactInstanceInit];

    <span class="hljs-comment">// ä¿å­˜å¤–éƒ¨ä¼ å…¥çš„å…³é”®ä¾èµ–</span>
    _delegate = delegate;
    _jsRuntimeFactory = jsRuntimeFactory;
    _appTMMDelegate = tmmDelegate;
    _jsThreadManager = [RCTJSThreadManager new];

    <span class="hljs-comment">// å¼€å‘èœå•é…ç½®</span>
    _devMenuConfigurationDecorator =
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RCT_DEV_MENU</span>
        [[RCTDevMenuConfigurationDecorator alloc] initWithDevMenuConfiguration:devMenuConfiguration];
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
        <span class="hljs-literal">nil</span>;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

    _parentInspectorTarget = parentInspectorTarget;

    <span class="hljs-comment">// JS æ¨¡å—è°ƒç”¨å™¨é…ç½®(è®¾ç½® Bridgeless æ¨¡å¼ä¸‹çš„ JS æ¨¡å—æ–¹æ³•è°ƒç”¨å™¨)</span>
    {
      __<span class="hljs-keyword">weak</span> __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;
      [_bridgeModuleDecorator.callableJSModules
          setBridgelessJSModuleMethodInvoker:^(
              <span class="hljs-built_in">NSString</span> *moduleName, <span class="hljs-built_in">NSString</span> *methodName, <span class="hljs-built_in">NSArray</span> *args, dispatch_block_t onComplete) {
            [weakSelf callFunctionOnJSModule:moduleName method:methodName args:args];
            <span class="hljs-keyword">if</span> (onComplete) {
              [weakSelf
                  callFunctionOnBufferedRuntimeExecutor:[onComplete](facebook::jsi::Runtime &amp;_) { onComplete(); }];
            }
          }];
    }
    _launchOptions = launchOptions;

    <span class="hljs-comment">// å†…å­˜è­¦å‘Šç›‘å¬</span>
    [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="hljs-keyword">self</span>
                                             selector:<span class="hljs-keyword">@selector</span>(_handleMemoryWarning)
                                                 name:<span class="hljs-built_in">UIApplicationDidReceiveMemoryWarningNotification</span>
                                               object:<span class="hljs-literal">nil</span>];
    <span class="hljs-comment">// å¯åŠ¨æ ¸å¿ƒåˆå§‹åŒ–</span>
    [<span class="hljs-keyword">self</span> _start];
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹çš„æ ¸å¿ƒæ–¹æ³•<code>_start</code>å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (<span class="hljs-type">void</span>)_start
{
  <span class="hljs-comment">// 1.è®¾ç½®å®šæ—¶å™¨ç³»ç»Ÿ</span>
  auto objCTimerRegistry = std::make_unique&lt;ObjCTimerRegistry&gt;();
  auto timing = objCTimerRegistry-&gt;timing;
  auto *objCTimerRegistryRawPtr = objCTimerRegistry.get();

  auto timerManager = std::make_shared&lt;TimerManager&gt;(std::move(objCTimerRegistry));
  objCTimerRegistryRawPtr-&gt;setTimerManager(timerManager);

  __<span class="hljs-keyword">weak</span> __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;
  auto onJsError = [=](jsi::Runtime &amp;runtime, <span class="hljs-keyword">const</span> JsErrorHandler::ProcessedError &amp;error) {
    [weakSelf _handleJSError:error withRuntime:runtime];
  };

  <span class="hljs-comment">// 2.åˆ›å»º ReactInstance (C++ å±‚)</span>
  _reactInstance = std::make_unique&lt;ReactInstance&gt;(
      _jsRuntimeFactory-&gt;createJSRuntime(_jsThreadManager.jsMessageThread),
      _jsThreadManager.jsMessageThread,
      timerManager,
      onJsError,
      _parentInspectorTarget);
  _valid = <span class="hljs-literal">true</span>;

  <span class="hljs-comment">// 3.è®¾ç½® RuntimeExecutor</span>
  RuntimeExecutor bufferedRuntimeExecutor = _reactInstance-&gt;getBufferedRuntimeExecutor();
  timerManager-&gt;setRuntimeExecutor(bufferedRuntimeExecutor);

  auto jsCallInvoker = make_shared&lt;RuntimeSchedulerCallInvoker&gt;(_reactInstance-&gt;getRuntimeScheduler());
  <span class="hljs-comment">// çœç•¥æ—§æ¶æ„......</span>

  <span class="hljs-comment">// 4.åˆ›å»º TurboModuleManager</span>
  _turboModuleManager = [[RCTTurboModuleManager alloc] initWithBridgeProxy:bridgeProxy
                                                     bridgeModuleDecorator:_bridgeModuleDecorator
                                                                  delegate:<span class="hljs-keyword">self</span>
                                                                 jsInvoker:jsCallInvoker
                                             devMenuConfigurationDecorator:_devMenuConfigurationDecorator];

<span class="hljs-meta">#<span class="hljs-keyword">if</span> RCT_DEV</span>
  <span class="hljs-comment">/**
    * å®ä¾‹åŒ– DevMenu ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå³é€šè¿‡ RCTDevMenu æ³¨å†Œ
    * CMD + dã€CMD + i å’Œ CMD + n çš„å¿«æ·é”®ã€‚ 
    * å› æ­¤ï¼Œå¯ç”¨ TurboModules æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨åˆ›å»ºæ­¤NativeModuleã€‚
   */</span>
  [_turboModuleManager moduleForName:<span class="hljs-string">"RCTDevMenu"</span>];
<span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// end RCT_DEV</span></span>

  <span class="hljs-comment">// åˆå§‹åŒ– RCTModuleRegistryï¼Œä»¥ä¾¿ TurboModules å¯ä»¥å¼•ç”¨å…¶ä»– TurboModules</span>
  [_bridgeModuleDecorator.moduleRegistry setTurboModuleRegistry:_turboModuleManager];

  <span class="hljs-keyword">if</span> (ReactNativeFeatureFlags::enableEagerMainQueueModulesOnIOS()) {
    <span class="hljs-comment">/**
     * æŸäº›åŸç”Ÿæ¨¡å—éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ•è· UIKit å¯¹è±¡ã€‚
     * å› æ­¤ï¼Œè¯·åœ¨æ­¤å¤„çš„ä¸»é˜Ÿåˆ—ä¸Šå¼€å§‹åˆå§‹åŒ–è¿™äº›æ¨¡å—ã€‚JavaScript çº¿ç¨‹å°†ç­‰å¾…è¿™äº›æ¨¡å—åˆå§‹åŒ–å®Œæˆåï¼Œæ‰ä¼šæ‰§è¡Œ JavaScript ä»£ç åŒ…ã€‚
     */</span>
    <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *modulesRequiringMainQueueSetup = [_delegate unstableModulesRequiringMainQueueSetup];

    std::shared_ptr&lt;std::mutex&gt; mutex = std::make_shared&lt;std::mutex&gt;();
    std::shared_ptr&lt;std::condition_variable&gt; cv = std::make_shared&lt;std::condition_variable&gt;();
    std::shared_ptr&lt;<span class="hljs-type">bool</span>&gt; isReady = std::make_shared&lt;<span class="hljs-type">bool</span>&gt;(<span class="hljs-literal">false</span>);

    _waitUntilModuleSetupComplete = ^{
      std::unique_lock&lt;std::mutex&gt; lock(*mutex);
      cv-&gt;wait(lock, [isReady] { <span class="hljs-keyword">return</span> *isReady; });
    };

    <span class="hljs-comment">// TODO(T218039767): å°†æ€§èƒ½æ—¥å¿—è®°å½•åŠŸèƒ½é›†æˆåˆ°ä¸»é˜Ÿåˆ—æ¨¡å—åˆå§‹åŒ–è¿‡ç¨‹ä¸­</span>
    RCTExecuteOnMainQueue(^{
      <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSString</span> *moduleName <span class="hljs-keyword">in</span> modulesRequiringMainQueueSetup) {
        [<span class="hljs-keyword">self</span>-&gt;_bridgeModuleDecorator.moduleRegistry moduleForName:[moduleName UTF8String]];
      }

      RCTScreenSize();
      RCTScreenScale();
      RCTSwitchSize();

      std::lock_guard&lt;std::mutex&gt; lock(*mutex);
      *isReady = <span class="hljs-literal">true</span>;
      cv-&gt;notify_all();
    });
  }

  RCTLogSetBridgelessModuleRegistry(_bridgeModuleDecorator.moduleRegistry);
  RCTLogSetBridgelessCallableJSModules(_bridgeModuleDecorator.callableJSModules);

  <span class="hljs-comment">// 5.åˆ›å»º ContextContainer</span>
  auto contextContainer = std::make_shared&lt;ContextContainer&gt;();
  [_delegate didCreateContextContainer:contextContainer];
  <span class="hljs-comment">// æ’å…¥æ ¸å¿ƒæ¨¡å—</span>
  contextContainer-&gt;insert(
      <span class="hljs-string">"RCTImageLoader"</span>, facebook::react::wrapManagedObject([_turboModuleManager moduleForName:<span class="hljs-string">"RCTImageLoader"</span>]));
  contextContainer-&gt;insert(
      <span class="hljs-string">"RCTEventDispatcher"</span>,
      facebook::react::wrapManagedObject([_turboModuleManager moduleForName:<span class="hljs-string">"RCTEventDispatcher"</span>]));
  contextContainer-&gt;insert(<span class="hljs-string">"RCTBridgeModuleDecorator"</span>, facebook::react::wrapManagedObject(_bridgeModuleDecorator));
  contextContainer-&gt;insert(RuntimeSchedulerKey, std::weak_ptr&lt;RuntimeScheduler&gt;(_reactInstance-&gt;getRuntimeScheduler()));
  contextContainer-&gt;insert(<span class="hljs-string">"RCTBridgeProxy"</span>, facebook::react::wrapManagedObject(bridgeProxy));

  <span class="hljs-comment">// 6.åˆ›å»º SurfacePresenter</span>
  _surfacePresenter = [[RCTSurfacePresenter alloc]
        initWithContextContainer:contextContainer
                 runtimeExecutor:bufferedRuntimeExecutor
      bridgelessBindingsExecutor:std::optional(_reactInstance-&gt;getUnbufferedRuntimeExecutor())];

  <span class="hljs-comment">// è¿™ä½¿å¾—æ¨¡å—ä¸­çš„ RCTViewRegistry èƒ½å¤Ÿé€šè¿‡å…¶ viewForReactTag æ–¹æ³•è¿”å› UIView å¯¹è±¡</span>
  __<span class="hljs-keyword">weak</span> RCTSurfacePresenter *weakSurfacePresenter = _surfacePresenter;
  [_bridgeModuleDecorator.viewRegistry_DEPRECATED setBridgelessComponentViewProvider:^<span class="hljs-built_in">UIView</span> *(<span class="hljs-built_in">NSNumber</span> *reactTag) {
    RCTSurfacePresenter *strongSurfacePresenter = weakSurfacePresenter;
    <span class="hljs-keyword">if</span> (strongSurfacePresenter == <span class="hljs-literal">nil</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
    }

    <span class="hljs-keyword">return</span> [strongSurfacePresenter findComponentViewWithTag_DO_NOT_USE_DEPRECATED:reactTag.integerValue];
  }];

  <span class="hljs-comment">// 7.åˆ›å»ºDisplayLink ï¼ˆç”¨äºè°ƒç”¨è®¡æ—¶å™¨å›è°ƒå‡½æ•°ï¼‰</span>
  _displayLink = [RCTDisplayLink new];

  auto &amp;inspectorFlags = jsinspector_modern::InspectorFlags::getInstance();

  ReactInstance::JSRuntimeFlags options = {
      .isProfiling = inspectorFlags.getIsProfilingBuild(),
      .runtimeDiagnosticFlags = [RCTInstanceRuntimeDiagnosticFlags() UTF8String]};

  <span class="hljs-comment">// 8.åˆå§‹åŒ– JS Runtime å¹¶åŠ è½½ Bundle</span>
  _reactInstance-&gt;initializeRuntime(options, [=](jsi::Runtime &amp;runtime) {
    __<span class="hljs-keyword">strong</span> __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) strongSelf = weakSelf;
    <span class="hljs-keyword">if</span> (!strongSelf) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// å®‰è£… TurboModule JS ç»‘å®š</span>
    [strongSelf-&gt;_turboModuleManager installJSBindings:runtime];
    <span class="hljs-comment">// ç»‘å®š Native Logger</span>
    facebook::react::bindNativeLogger(runtime, [](<span class="hljs-keyword">const</span> std::string &amp;message, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> logLevel) {
      _RCTLogJavaScriptInternal(static_cast&lt;RCTLogLevel&gt;(logLevel), [<span class="hljs-built_in">NSString</span> stringWithUTF8String:message.c_str()]);
    });

    <span class="hljs-comment">// å®‰è£… Native Component Registry ç»‘å®š</span>
    RCTInstallNativeComponentRegistryBinding(runtime);

    <span class="hljs-comment">// é€šçŸ¥ä»£ç† Runtime å·²åˆå§‹åŒ–</span>
    [strongSelf-&gt;_delegate instance:strongSelf didInitializeRuntime:runtime];

    <span class="hljs-comment">// è®¾ç½® DisplayLink</span>
    <span class="hljs-type">id</span>&lt;RCTDisplayLinkModuleHolder&gt; moduleHolder = [[RCTBridgelessDisplayLinkModuleHolder alloc] initWithModule:timing];
    [strongSelf-&gt;_displayLink registerModuleForFrameUpdates:timing withModuleHolder:moduleHolder];
    [strongSelf-&gt;_displayLink addToRunLoop:[<span class="hljs-built_in">NSRunLoop</span> currentRunLoop]];

    <span class="hljs-comment">// å°è¯•åŒæ­¥åŠ è½½bundleåŒ…ï¼Œå¦‚æœå¤±è´¥åˆ™å›é€€åˆ°å¼‚æ­¥åŠ è½½ã€‚</span>
    [strongSelf-&gt;_performanceLogger markStartForTag:RCTPLScriptDownload];
    [strongSelf _loadJSBundle:[strongSelf-&gt;_bridgeModuleDecorator.bundleManager bundleURL]];
  });

  [_performanceLogger markStopForTag:RCTPLReactInstanceInit];
}
</code></pre>
<h5 data-id="heading-11">JS Bundle åŠ è½½</h5>
<p>ç»§ç»­æŸ¥çœ‹<code>_loadJSBundle</code>æ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (<span class="hljs-type">void</span>)_loadJSBundle:(<span class="hljs-built_in">NSURL</span> *)sourceURL
{
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RCT_DEV_MENU &amp;&amp; __has_include(<span class="hljs-string">&lt;React/RCTDevLoadingViewProtocol.h&gt;)</span></span>
  {
    <span class="hljs-comment">// æ˜¾ç¤ºåŠ è½½è§†å›¾</span>
    <span class="hljs-type">id</span>&lt;RCTDevLoadingViewProtocol&gt; loadingView =
        (<span class="hljs-type">id</span>&lt;RCTDevLoadingViewProtocol&gt;)[_turboModuleManager moduleForName:<span class="hljs-string">"DevLoadingView"</span>];
    [loadingView showWithURL:sourceURL];
  }
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

  __<span class="hljs-keyword">weak</span> __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;
  <span class="hljs-comment">// é€šè¿‡ä»£ç†åŠ è½½ Bundle</span>
  [_delegate loadBundleAtURL:sourceURL
      onProgress:^(RCTLoadingProgress *progressData) {
        __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) strongSelf = weakSelf;
        <span class="hljs-keyword">if</span> (!strongSelf) {
          <span class="hljs-keyword">return</span>;
        }

<span class="hljs-meta">#<span class="hljs-keyword">if</span> RCT_DEV_MENU &amp;&amp; __has_include(<span class="hljs-string">&lt;React/RCTDevLoadingViewProtocol.h&gt;)</span></span>
        <span class="hljs-type">id</span>&lt;RCTDevLoadingViewProtocol&gt; loadingView =
            (<span class="hljs-type">id</span>&lt;RCTDevLoadingViewProtocol&gt;)[strongSelf-&gt;_turboModuleManager moduleForName:<span class="hljs-string">"DevLoadingView"</span>];
        [loadingView updateProgress:progressData];
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
      }
      onComplete:^(<span class="hljs-built_in">NSError</span> *error, RCTSource *source) {
        __<span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) strongSelf = weakSelf;
        <span class="hljs-keyword">if</span> (!strongSelf) {
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (error) {
          [strongSelf handleBundleLoadingError:error];
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// _loadScriptFromSource å‡½æ•°çš„å›è°ƒå‡½æ•°éœ€è¦ DevSettings æ¨¡å—ï¼Œå› æ­¤éœ€è¦æå‰è¿›è¡Œåˆå§‹åŒ–ã€‚</span>
        RCTDevSettings *<span class="hljs-keyword">const</span> devSettings =
            (RCTDevSettings *)[strongSelf-&gt;_turboModuleManager moduleForName:<span class="hljs-string">"DevSettings"</span>];

        <span class="hljs-comment">// åŠ è½½è„šæœ¬</span>
        [strongSelf _loadScriptFromSource:source];
        <span class="hljs-comment">// ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨çƒ­æ¨¡å—é‡è½½åŠŸèƒ½ã€‚</span>
        [strongSelf-&gt;_performanceLogger markStopForTag:RCTPLScriptDownload];
        [devSettings setupHMRClientWithBundleURL:sourceURL];
<span class="hljs-meta">#<span class="hljs-keyword">if</span> RCT_DEV</span>
        [strongSelf _logOldArchitectureWarnings];
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
      }];
}


- (<span class="hljs-type">void</span>)_loadScriptFromSource:(RCTSource *)source
{
  std::lock_guard&lt;std::mutex&gt; lock(_invalidationMutex);
  <span class="hljs-keyword">if</span> (!_valid) {
    <span class="hljs-keyword">return</span>;
  }

  auto script = std::make_unique&lt;<span class="hljs-built_in">NSDataBigString</span>&gt;(source.data);
  <span class="hljs-keyword">const</span> auto *url = deriveSourceURL(source.url).UTF8String;

  auto beforeLoad = [waitUntilModuleSetupComplete = <span class="hljs-keyword">self</span>-&gt;_waitUntilModuleSetupComplete](jsi::Runtime &amp;_) {
    <span class="hljs-keyword">if</span> (waitUntilModuleSetupComplete) {
      waitUntilModuleSetupComplete();
    }
  };
  auto afterLoad = [](jsi::Runtime &amp;_) {
    [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:<span class="hljs-string">@"RCTInstanceDidLoadBundle"</span> object:<span class="hljs-literal">nil</span>];
  };
  <span class="hljs-comment">// åœ¨ ReactInstance ä¸­æ‰§è¡Œè„šæœ¬</span>
  _reactInstance-&gt;loadScript(std::move(script), url, beforeLoad, afterLoad);
}
</code></pre>
<h5 data-id="heading-12">Surface åˆ›å»ºä¸å¯åŠ¨</h5>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠè§†çº¿æ‹‰å›<code>viewWithModuleName</code>æ–¹æ³•ä¸­ï¼Œç»§ç»­åˆ†æåé¢çš„<code>createSurfaceWithModuleName</code>æ–¹æ³•çš„å®ç°ã€‚æºç <code>RCTHost.mm</code>ï¼š</p>
<pre><code class="hljs language-objc" lang="objc">- (RCTFabricSurface *)createSurfaceWithModuleName:(<span class="hljs-built_in">NSString</span> *)moduleName initialProperties:(<span class="hljs-built_in">NSDictionary</span> *)properties
{
  <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> createSurfaceWithModuleName:moduleName mode:DisplayMode::Visible initialProperties:properties];
}

- (RCTFabricSurface *)createSurfaceWithModuleName:(<span class="hljs-built_in">NSString</span> *)moduleName
                                             mode:(DisplayMode)displayMode
                                initialProperties:(<span class="hljs-built_in">NSDictionary</span> *)properties
{
  <span class="hljs-comment">// 1. åˆ›å»º FabricSurface</span>
  RCTFabricSurface *surface = [[RCTFabricSurface alloc] initWithSurfacePresenter:<span class="hljs-keyword">self</span>.surfacePresenter
                                                                      moduleName:moduleName
                                                               initialProperties:properties];
  <span class="hljs-comment">// 2. è®¾ç½®æ˜¾ç¤ºæ¨¡å¼</span>
  surface.surfaceHandler.setDisplayMode(displayMode);

  <span class="hljs-comment">// 3. é™„åŠ  Surface</span>
  [<span class="hljs-keyword">self</span> _attachSurface:surface];

  __<span class="hljs-keyword">weak</span> RCTFabricSurface *weakSurface = surface;
  <span class="hljs-comment">// åœ¨ JS Bundle æ‰§è¡Œå®Œæˆåï¼Œä½¿ç”¨BufferedRuntimeExecutorå¯åŠ¨Surface</span>
  [_instance callFunctionOnBufferedRuntimeExecutor:[weakSurface](facebook::jsi::Runtime &amp;_) { [weakSurface start]; }];
  <span class="hljs-keyword">return</span> surface;
}
</code></pre>
<h3 data-id="heading-13">æ€»ç»“</h3>
<p>åˆå§‹åŒ–çš„å¤§æ¦‚æµç¨‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                        <span class="hljs-string">Swift</span> <span class="hljs-string">åº”ç”¨å±‚</span>                              <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">AppDelegate</span>                                                 <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">reactNativeDelegate:</span> <span class="hljs-string">ReactNativeDelegate</span>             <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-attr">reactNativeFactory:</span> <span class="hljs-string">RCTReactNativeFactory</span>             <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-attr">ReactNativeDelegate :</span> <span class="hljs-string">RCTDefaultReactNativeFactoryDelegate</span>  <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">bundleURL()</span> <span class="hljs-string">â†’</span> <span class="hljs-string">URL?</span>                                    <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-attr">dependencyProvider:</span> <span class="hljs-string">RCTAppDependencyProvider</span>          <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                               <span class="hljs-string">â”‚</span>
                               <span class="hljs-string">â–¼</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                        <span class="hljs-string">Factory</span> <span class="hljs-string">å±‚</span>                                <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">RCTReactNativeFactory</span>                                       <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">delegate:</span> <span class="hljs-string">RCTReactNativeFactoryDelegate</span>               <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">rootViewFactory:</span> <span class="hljs-string">RCTRootViewFactory</span>                   <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">startReactNative(withModuleName:in:)</span>                  <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">RCTRootViewFactory</span>                                          <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">reactHost:</span> <span class="hljs-string">RCTHost</span>                                    <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">view(withModuleName:)</span> <span class="hljs-string">â†’</span> <span class="hljs-string">UIView</span>                        <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">createReactHost()</span> <span class="hljs-string">â†’</span> <span class="hljs-string">RCTHost</span>                           <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                               <span class="hljs-string">â”‚</span>
                               <span class="hljs-string">â–¼</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                         <span class="hljs-string">Host</span> <span class="hljs-string">å±‚</span>                                  <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">RCTHost</span>                                                     <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">instance:</span> <span class="hljs-string">RCTInstance</span>                                 <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">bundleManager:</span> <span class="hljs-string">RCTBundleManager</span>                       <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">start()</span>                                               <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">createSurface(withModuleName:)</span> <span class="hljs-string">â†’</span> <span class="hljs-string">RCTFabricSurface</span>     <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                               <span class="hljs-string">â”‚</span>
                               <span class="hljs-string">â–¼</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                       <span class="hljs-string">Instance</span> <span class="hljs-string">å±‚</span>                                <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">RCTInstance</span>                                                 <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">reactInstance:</span> <span class="hljs-string">ReactInstance</span> <span class="hljs-string">(C++)</span>                    <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">turboModuleManager:</span> <span class="hljs-string">RCTTurboModuleManager</span>             <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">surfacePresenter:</span> <span class="hljs-string">RCTSurfacePresenter</span>                 <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">displayLink:</span> <span class="hljs-string">RCTDisplayLink</span>                           <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">_start()</span>                                              <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                               <span class="hljs-string">â”‚</span>
                               <span class="hljs-string">â–¼</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span>                        <span class="hljs-string">C++</span> <span class="hljs-string">Runtime</span> <span class="hljs-string">å±‚</span>                            <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">ReactInstance</span> <span class="hljs-string">(C++)</span>                                         <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">jsRuntime:</span> <span class="hljs-string">jsi::Runtime</span> <span class="hljs-string">(Hermes)</span>                      <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">runtimeScheduler:</span> <span class="hljs-string">RuntimeScheduler</span>                    <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-attr">timerManager:</span> <span class="hljs-string">TimerManager</span>                            <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â”œâ”€â”€</span> <span class="hljs-string">initializeRuntime()</span>                                   <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â””â”€â”€</span> <span class="hljs-string">loadScript()</span>                                          <span class="hljs-string">â”‚â”‚</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºå¼€æ”¾æ™ºèƒ½ä½“ç”Ÿæ€ï¼šAgentScope å¦‚ä½•ç”¨ A2A åè®®ä¸ Nacos æ‰“é€šåä½œå£å’ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600032104248934463</link>    <guid>https://juejin.cn/post/7600032104248934463</guid>    <pubDate>2026-01-28T10:25:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600032104248934463" data-draft-id="7600032104248819775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºå¼€æ”¾æ™ºèƒ½ä½“ç”Ÿæ€ï¼šAgentScope å¦‚ä½•ç”¨ A2A åè®®ä¸ Nacos æ‰“é€šåä½œå£å’ï¼Ÿ"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-28T10:25:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºå¼€æ”¾æ™ºèƒ½ä½“ç”Ÿæ€ï¼šAgentScope å¦‚ä½•ç”¨ A2A åè®®ä¸ Nacos æ‰“é€šåä½œå£å’ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T10:25:43.000Z" title="Wed Jan 28 2026 10:25:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šæ°æ©™ã€å¸­ç¿ã€æ¿¯å…‰</p>
<blockquote>
<p>AgentScope åŸºäº A2A åè®®ä¸ Nacos Agent Registryï¼Œå®ç°æ™ºèƒ½ä½“çš„ç»Ÿä¸€å‘ç°ã€æ²»ç†ä¸è·¨ç”Ÿæ€åä½œã€‚</p>
</blockquote>
<p>éšç€ä¼ä¸šé€æ­¥è½åœ° AI åº”ç”¨æ¶æ„ï¼Œä»åŸæ¥æµ‹è¯• POC workflow/ç®€å• Agent å¼€å§‹é€æ­¥æ„å»ºç”Ÿäº§çº§å¯ç”¨ Agentï¼ŒçœŸæ­£è§£å†³çº¿ä¸Šé—®é¢˜ï¼Œæ„å»º Agent åœ¨ä¼ä¸šæ˜¯é¢ç›¸å…¨å‘˜æå‡æ•ˆç‡çš„è·¯å¾„ï¼Œä¸å†æ˜¯ç®€å•ä¸šåŠ¡æµç¨‹é¢ä¸´é—®é¢˜æ›´åŠ å¤æ‚ï¼Œå¯èƒ½ä¼ä¸šå°±ä¼šé‡åˆ°å¦‚ä¸‹æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>è¯­è¨€æ ˆå¤šæ ·åŒ–</strong>ï¼šä¼ä¸šå†…æ ¸å¿ƒä¸šåŠ¡å›¢é˜Ÿå¯èƒ½æ˜¯ Java/Golangï¼Œç®—æ³•å›¢é˜Ÿä½¿ç”¨ Pythonï¼Œé¢ä¸´ Agent æ¶æ„é€‰å‹å¤šè¯­è¨€æ ˆæ€ä¹ˆåšæ— ç¼åä½œï¼Ÿ</li>
<li><strong>Agent æ¡†æ¶å‰²è£‚</strong>ï¼šLangChainã€AutoGPTã€AgentScope ç­‰ä¸åŒæ¡†æ¶ä»¥åŠ Agent å„è‡ªä¸ºæ”¿ï¼Œå¦‚ä½•å®ç°è·¨æ¡†æ¶è°ƒç”¨ï¼Ÿ</li>
<li><strong>å¤šå›¢é˜ŸAgentååŒ</strong>ï¼šAgent å¦‚æœæœ‰ä¸€ä¸ªå›¢é˜Ÿåšï¼Œä¸æ‡‚ä¸šåŠ¡åšä¸æ·±ï¼ŒAgent åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡ã€å›¢é˜Ÿã€é¡¹ç›®ä¸­ï¼Œå†…éƒ¨é€‰å‹ä¼šæœ‰ Difyã€n8n ä½ä»£ç å’Œé«˜ä»£ç å¹³å°é€‰å‹ï¼Œå¦‚ä½•ç»Ÿä¸€å‘ç°å’Œç®¡ç†ï¼Ÿ</li>
<li><strong>åè®®ä¸ç»Ÿä¸€</strong>ï¼šRESTã€gRPCã€è‡ªå®šä¹‰åè®®...æ¯ä¸ª Agent éƒ½æœ‰è‡ªå·±çš„æ¥å£è§„èŒƒï¼Œé›†æˆæˆæœ¬é«˜ã€ç»´æŠ¤å›°éš¾ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/376420a5e7234943a8b420a4c5ebc5a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770200743&amp;x-signature=EtB756VezetQw0R%2FDPjke0NiyIY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><strong>A2Aï¼ˆAgent-to-Agentï¼‰åè®®æ­£æ˜¯ä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿã€‚</strong> å®ƒæ˜¯ Google æå‡ºä¸€å¥—é¢å‘åˆ†å¸ƒå¼å¤š Agent äº’è”äº’é€šçš„å¼€æ”¾æ ‡å‡†ï¼Œå®šä¹‰äº†ç»Ÿä¸€çš„æ¶ˆæ¯ç»“æ„å’Œèƒ½åŠ›æè¿°ï¼Œè®©ä¸åŒè¯­è¨€ã€ä¸åŒæ¡†æ¶ã€ä¸åŒè¿è¡Œæ—¶ä¸Šçš„ Agent éƒ½èƒ½è¢«å‘ç°ã€è¢«è°ƒç”¨ã€è¢«ç¼–æ’ã€‚åŸºäº A2Aï¼ŒAgent ä¹‹é—´å¯ä»¥åœ¨ä¸å…±äº«ä»£ç ã€ä¸è€¦åˆåº•å±‚å®ç°çš„å‰æä¸‹ï¼Œå®Œæˆæ–‡æœ¬å¯¹è¯ã€thinkingã€å¤šæ¨¡æ€å†…å®¹ã€å·¥å…·è°ƒç”¨ç­‰ä¸°å¯Œäº¤äº’ï¼ŒçœŸæ­£å®ç°â€œä¸€æ¬¡å®šä¹‰ï¼Œå¤„å¤„å¯ç”¨â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d6ffbdf9d84fc4ad46cff42863637b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770200743&amp;x-signature=0eSFVMxugMlNgcY20hEK%2BzJcBcs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-0">Agent è·¨è¯­è¨€ã€è·¨æ¡†æ¶è°ƒç”¨æœ€ä½³å®è·µ</h2>
<p><strong>AgentScope</strong>Â æ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„ä¸€æ¬¾ä»¥å¼€å‘è€…ä¸ºæ ¸å¿ƒï¼Œä¸“æ³¨äº<strong>å¤šæ™ºèƒ½ä½“å¼€å‘çš„å¼€æºæ¡†æ¶</strong>ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯è§£å†³æ™ºèƒ½ä½“åœ¨æ„å»ºã€è¿è¡Œå’Œç®¡ç†ä¸­çš„éš¾é¢˜ï¼Œæä¾›ä¸€å¥—è¦†ç›–â€œå¼€å‘ã€éƒ¨ç½²ã€ç›‘æ§â€å…¨ç”Ÿå‘½å‘¨æœŸçš„ç”Ÿäº§çº§è§£å†³æ–¹æ¡ˆã€‚</p>
<p>åœ¨Â <strong>AgentScope</strong>Â æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬<strong>å…¨é¢æ”¯æŒ A2A åè®®ï¼Œå¹¶é›†æˆ Nacos ä½œä¸º A2A Registry çš„é»˜è®¤å®ç°</strong>ï¼Œæ„å»ºäº†ä¸€å¥—ä»å¼€å‘åˆ°éƒ¨ç½²çš„å®Œæ•´åˆ†å¸ƒå¼å¤šæ™ºèƒ½ä½“åä½œä½“ç³»ï¼Œè®©æ™ºèƒ½ä½“åä½œä»â€œå•æ‰“ç‹¬æ–—â€èµ°å‘â€œå¼€æ”¾äº’è”â€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/657e92a0770a4995a8740d46b5d23798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770200743&amp;x-signature=MbLAkSX5FeYd0o6CYydVBoSb0oY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<ul>
<li><strong>å‘Šåˆ«â€œAgent å­¤å²›â€</strong>ï¼šé€šè¿‡ A2A åè®®ï¼ŒAgentScope çš„ Agent å¯ä»¥ä¸ä»»ä½•å®ç° A2A çš„ Agent æ— ç¼äº’æ“ä½œï¼Œä¸è®ºç”±è°å¼€å‘ã€ç”¨ä½•ç§æŠ€æœ¯æ ˆæ„å»ºï¼Œéƒ½èƒ½åœ¨ç»Ÿä¸€çš„åä½œæ¡†æ¶ä¸‹é«˜æ•ˆååŒï¼Œæ‰“ç ´æŠ€æœ¯å£å’ï¼Œå…±åŒæ„å»ºè·¨è¯­è¨€ã€è·¨æ¡†æ¶çš„å¼€æ”¾ç”Ÿæ€ã€‚</li>
<li><strong>ç»Ÿä¸€å¼€å‘ä½“éªŒï¼Œå‘Šåˆ«é€‚é…çƒ¦æ¼</strong>ï¼šåœ¨ AgentScope ä¸­ï¼Œè°ƒç”¨æœ¬åœ° Agent å’Œè°ƒç”¨è¿œç«¯ A2A Agent ä½¿ç”¨åŒä¸€å¥— APIã€‚æ¡†æ¶è‡ªåŠ¨å¤„ç†åè®®è½¬æ¢ã€é”™è¯¯é‡è¯•å’Œè·¯ç”±é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“æ³¨ä¸šåŠ¡ï¼Œä¸å¿…ä¸ºé€‚é…ä¸åŒ Agent ç¼–å†™å†—ä½™ä»£ç ï¼Œä»è€Œæå‡æ•ˆç‡ä¸å¯ç»´æŠ¤æ€§ã€‚</li>
<li><strong>ç”Ÿäº§çº§æ²»ç†ï¼Œå¼€ç®±å³ç”¨</strong>ï¼šåŸºäº Nacos 3.0 æ™ºèƒ½ä½“æ³¨å†Œä¸­å¿ƒï¼ŒAgentScope åº”ç”¨å…·å¤‡æœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€å‘½åç©ºé—´éš”ç¦»ç­‰æˆç†Ÿèƒ½åŠ›ã€‚é€‰æ‹© Nacos ä½œä¸ºé»˜è®¤ A2A Registryï¼Œä¸ä»…å› ä¸ºå®ƒç»è¿‡å¤§è§„æ¨¡ç”Ÿäº§éªŒè¯ï¼Œä¹Ÿå› ä¸ºå®ƒä¸ä¼ä¸šç°æœ‰è¿ç»´ä½“ç³»å…¼å®¹ï¼Œè®©æ™ºèƒ½ä½“æ²»ç†æ— éœ€é‡å¤é€ è½®å­ï¼ŒåŠ é€Ÿè§„æ¨¡åŒ–è½åœ°ã€‚</li>
</ul>
<h2 data-id="heading-1">åœ¨ AgentScope ä¸­ä½¿ç”¨ A2A</h2>
<h3 data-id="heading-2">1. AgentScopeï¼šè¿æ¥å¤–éƒ¨ A2A ç½‘ç»œï¼Œåƒè°ƒç”¨æœ¬åœ° Agent ä¸€æ ·ç®€å•</h3>
<p>AgentScope æä¾›ç»Ÿä¸€çš„ A2A å¯¹æ¥èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨æœ¬åœ°å·¥å…·ä¸€æ ·è‡ªç„¶åœ°è°ƒç”¨è¿œç«¯ A2A Agentï¼Œå®ç°è·¨è¯­è¨€ã€è·¨æ¡†æ¶çš„ååŒï¼Œå‘Šåˆ«ç¹ççš„åè®®é€‚é…å·¥ä½œï¼š</p>
<ul>
<li><strong>åŒå‘æ¶ˆæ¯è½¬æ¢ï¼š</strong> å®ç°æ¡†æ¶å†…éƒ¨æ¶ˆæ¯æ ¼å¼ä¸ A2A <code>Message</code>Â çš„åŒå‘è½¬æ¢ï¼Œæ”¯æŒæ–‡æœ¬ã€thinkingã€å¤šæ¨¡æ€ã€å·¥å…·è°ƒç”¨ç­‰ Block ç±»å‹ï¼Œä¿ç•™å¿…è¦å…ƒä¿¡æ¯ï¼Œç¡®ä¿è¯­ä¹‰ä¸€è‡´ã€‚</li>
<li><strong>ç»Ÿä¸€äº¤äº’èŒƒå¼ï¼š</strong> æ”¯æŒç›´æ¥è°ƒç”¨å’Œ <code>observe()</code>Â ä¸¤ç§æ–¹å¼ã€‚ç›´æ¥è°ƒç”¨Â <code>agent(msg)</code>Â å¯ç«‹å³æ‹¿åˆ°ç»“æœï¼›<code>observe()</code>Â å…ˆç´¯ç§¯ä¸Šä¸‹æ–‡ï¼Œåç»­å†è¿åŒå½“å‰è¾“å…¥ä¸€èµ·å‘é€ï¼Œé€‚åˆé•¿ä¼šè¯ã€å¤šè½®åä½œåœºæ™¯ã€‚</li>
<li><strong>ä»»åŠ¡ä¸ä¸­æ–­ç®¡ç†ï¼š</strong> å†…å»ºé•¿ä»»åŠ¡çŠ¶æ€ç®¡ç†ä¸ Artifact å¤„ç†æœºåˆ¶ï¼Œæ”¯æŒé•¿æ—¶é—´ä»»åŠ¡çš„å¹³æ»‘ä¸­æ–­ï¼Œè¦†ç›–è¶…æ—¶ä¸å–æ¶ˆåœºæ™¯ã€‚</li>
<li><strong>ç»Ÿä¸€çš„æœåŠ¡å‘ç°èƒ½åŠ›ï¼š</strong> é€šè¿‡ <code>AgentCardResolver</code>Â æ‰©å±•ç‚¹æ ‡å‡†åŒ–â€œå‘ç°â€èƒ½åŠ›ï¼Œä»»ä½•å®ç°è¯¥æ¥å£çš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼š<code>FixedAgentCardResolver</code>ã€<code>FileAgentCardResolver</code>ã€<code>WellKnownAgentCardResolver</code>ã€<code>NacosAgentCardResolver</code>Â ç­‰éƒ½å¯æŒ‰éœ€åŠ è½½ï¼Œè½»æ¾é€‚é…ä¸åŒåŸºç¡€è®¾æ–½ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d8e0d47b294113bc3d963862ae4d8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770200743&amp;x-signature=bNZ2KwwXE0rwaadMaQ%2FHrtShx%2Fg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é€šè¿‡Â <code>A2AAgent</code>Â ä»¥åŠÂ <code>AgentCardResolver</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰åç§°ã€åˆ†ç»„æˆ–æ ‡ç­¾ä» A2A Registry ä¸­å‘ç°å¹¶è°ƒç”¨å…¶ä»– Agentï¼Œå®ç°è·¨å›¢é˜Ÿã€è·¨é¡¹ç›®ç”šè‡³è·¨è¯­è¨€çš„æ™ºèƒ½ä½“å¤ç”¨ã€‚åŸºäº A2A Registryï¼Œæ™ºèƒ½ä½“æ‹¥æœ‰ç»Ÿä¸€çš„æœåŠ¡å‘ç°ä¸æ²»ç†èƒ½åŠ›ï¼Œå¯ä¸ç°æœ‰é…ç½®ä¸­å¿ƒã€ç½‘å…³ã€ç†”æ–­é™æµåŠå®‰å…¨ä½“ç³»ååŒï¼Œä¸ºå¤§è§„æ¨¡åˆ†å¸ƒå¼æ™ºèƒ½ä½“åº”ç”¨æ‰“å¥½åº•åº§ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨Â <code>NacosAgentCardResolver</code>Â ä» Nacos Registry ä¸­å‘ç°å¹¶è°ƒç”¨ Agentï¼š</p>
<p><em>æ³¨æ„åœ¨å¯¹åº”ç‰ˆæœ¬ä»¥ä¸Šä½¿ç”¨ demoï¼Œ</em> <em><strong>Python</strong></em> <em>ï¼ˆAgentScope</em> <em><strong>v1.0.11</strong></em> <em>ã€AgentScope Runtime</em> <em><strong>v1.0.4</strong></em> *ï¼‰å’ŒÂ * <em><strong>Java</strong></em> <em>ï¼ˆAgentScope</em> <em><strong>v1.0.6</strong></em> <em>ï¼ŒAgentScope Runtime</em> <em><strong>v1.0.0</strong></em> <em>ï¼‰</em></p>
<h4 data-id="heading-3">Python ä»£ç ç¤ºä¾‹</h4>
<p><strong>æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.agentscope.io%2Fzh_CN%2Ftutorial%2Ftask_a2a.html" target="_blank" title="https://doc.agentscope.io/zh_CN/tutorial/task_a2a.html" ref="nofollow noopener noreferrer">doc.agentscope.io/zh_CN/tutorâ€¦</a></strong></p>
<pre><code class="hljs language-ini" lang="ini">fromÂ agentscope.agentÂ importÂ A2AAgent
fromÂ agentscope.a2aÂ importÂ NacosAgentCardResolver
fromÂ agentscope.messageÂ importÂ Msg
<span class="hljs-comment"># Python AgentScope v1.0.11ä»¥ä¸Š</span>
<span class="hljs-comment"># åˆ›å»º Nacos AgentCard Resolver</span>
<span class="hljs-attr">nacos_resolver</span> = NacosAgentCardResolver(
Â  Â  <span class="hljs-attr">remote_agent_name</span>=<span class="hljs-string">"my-remote-agent"</span>, Â <span class="hljs-comment"># Nacos ä¸­æ³¨å†Œçš„æ™ºèƒ½ä½“åç§°</span>
Â  Â  <span class="hljs-attr">nacos_client_config</span>=ClientConfig(
Â  Â  Â  Â  <span class="hljs-attr">server_addresses</span>=<span class="hljs-string">"http://localhost:8848"</span>, Â <span class="hljs-comment"># Nacos æœåŠ¡å™¨åœ°å€</span>
Â  Â  Â  Â Â <span class="hljs-comment"># å…¶ä»–å¯é€‰é…ç½®é¡¹</span>
Â  Â  ),
)
<span class="hljs-comment"># ä½¿ç”¨ Resolver åˆ›å»º A2AAgentï¼Œé€šè¿‡åç§°ä» Nacos å‘ç° Agent</span>
<span class="hljs-attr">agent</span> = A2AAgent(
Â  Â  <span class="hljs-attr">agent_card</span>=awaitÂ nacos_resolver.get_agent_card()
)
</code></pre>
<h4 data-id="heading-4">Java ä»£ç ç¤ºä¾‹</h4>
<p><strong>æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjava.agentscope.io%2Fzh%2Ftask%2Fa2a.html" target="_blank" title="https://java.agentscope.io/zh/task/a2a.html" ref="nofollow noopener noreferrer">java.agentscope.io/zh/task/a2aâ€¦</a></strong></p>
<p>ä½¿ç”¨Â <code>NacosAgentCardResolver</code>Â ä» Nacos Registry ä¸­å‘ç° Agentï¼š</p>
<pre><code class="hljs language-ini" lang="ini">importÂ io.agentscope.agent.A2AAgent<span class="hljs-comment">;</span>
importÂ io.agentscope.extensions.a2a.nacos.NacosAgentCardResolver<span class="hljs-comment">;</span>
importÂ java.util.Properties<span class="hljs-comment">;</span>
importÂ com.alibaba.nacos.api.PropertyKeyConst<span class="hljs-comment">;</span>
importÂ com.alibaba.nacos.api.ai.AiFactory<span class="hljs-comment">;</span>
importÂ com.alibaba.nacos.api.ai.AiService<span class="hljs-comment">;</span>
PropertiesÂ <span class="hljs-attr">properties</span>Â =Â newÂ Properties()<span class="hljs-comment">;</span>
properties.put(PropertyKeyConst.SERVER_ADDR,Â "localhost:8848")<span class="hljs-comment">;</span>
// å…¶ä»–å¯é€‰é…ç½®é¡¹
AiServiceÂ <span class="hljs-attr">aiService</span>Â =Â AiFactory.createAiService(properties)<span class="hljs-comment">;</span>
NacosAgentCardResolverÂ <span class="hljs-attr">agentCardResolver</span>Â =Â newÂ NacosAgentCardResolver(aiService)<span class="hljs-comment">;</span>
A2AAgentÂ <span class="hljs-attr">agent</span>Â =Â A2AAgent.builder()
Â  Â  Â  Â  .name("MyAgent")
Â  Â  Â  Â  .agentCardResolver(agentCardResolver)
Â  Â  Â  Â  .build()<span class="hljs-comment">;</span>
</code></pre>
<p>Nacos 3.0 ä½œä¸ºæ™ºèƒ½ä½“æ³¨å†Œä¸­å¿ƒï¼Œå…¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¹…ç»éªŒè¯çš„æœåŠ¡å‘ç°ä¸é…ç½®ç®¡ç†èƒ½åŠ›ï¼Œèƒ½å¤ŸåŠ©åŠ›ä¼ä¸šæ„å»ºç»Ÿä¸€çš„æ™ºèƒ½ä½“æœåŠ¡æ²»ç†å¹³å°ã€‚</p>
<h3 data-id="heading-5">2. AgentScope Runtimeï¼šæš´éœ² A2A Agent æœåŠ¡ï¼Œå¯åŠ¨å³æ³¨å†Œ</h3>
<p>AgentScope Runtime æä¾›ç»Ÿä¸€çš„ A2A æœåŠ¡æš´éœ²èƒ½åŠ›ï¼Œå¸®åŠ©æˆ‘ä»¬æŠŠæœ¬åœ° Agent åº”ç”¨åŒ…è£…æˆç¬¦åˆ A2A è§„èŒƒçš„æœåŠ¡ç«¯ç‚¹ã€‚é€šè¿‡ A2A åè®®é€‚é…å™¨ï¼Œåº”ç”¨åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨å®Œæˆï¼š</p>
<ul>
<li><strong>ç»“æ„åŒ–é…ç½®ä½“ç³»</strong>ï¼šé€šè¿‡ A2A æ‰©å±•é…ç½® <code>a2a_config</code>Â çµæ´»å®šä¹‰ AgentCardï¼ˆnameã€descriptionã€versionã€skillsã€default_input_modes/default_output_modes ç­‰ï¼‰ã€ä¼ è¾“å±‚é…ç½®ï¼ˆhostã€portã€path ç­‰ï¼‰ã€Registry å‚æ•°å’Œä»»åŠ¡è¶…æ—¶ç­‰ã€‚</li>
<li><strong>è‡ªåŠ¨æœåŠ¡åŒ…è£…</strong>ï¼šå¯åŠ¨æ—¶ç”± A2A åè®®é€‚é…å™¨å°† Agent åº”ç”¨å°è£…æˆç¬¦åˆ A2A è§„èŒƒçš„æœåŠ¡ç«¯ç‚¹ï¼Œè‡ªåŠ¨å¤„ç†åè®®è½¬æ¢ã€æ¶ˆæ¯è·¯ç”±ç­‰åº•å±‚ç»†èŠ‚ã€‚</li>
<li><strong>ç”Ÿäº§çº§éƒ¨ç½²æ”¯æŒ</strong>ï¼šä¸ä¸»æµæ¡†æ¶æ— ç¼é›†æˆï¼ŒPython ä¾§æ”¯æŒ <code>AgentApp</code>Â é…ç½®ä½“ç³»ï¼ŒJava ä¾§æ”¯æŒÂ <code>Spring Boot Starter</code>ï¼Œè®©æ™ºèƒ½ä½“æœåŠ¡è‡ªç„¶èå…¥ç°æœ‰åŸºç¡€è®¾æ–½ã€‚</li>
<li><strong>è‡ªåŠ¨æœåŠ¡æ³¨å†Œä¸æ²»ç†</strong>ï¼šé€šè¿‡ <code>A2ARegistry</code>Â æŠ½è±¡æ¥å£ï¼ŒPython ä¸ Java éƒ½èƒ½å¼€ç®±å³ç”¨åœ°é›†æˆ Nacos Agent Registryã€‚Agent èƒ½åŠ›æè¿°ï¼ˆAgentCardï¼‰å’Œç½‘ç»œç«¯ç‚¹ä¼šè‡ªåŠ¨æ³¨å†Œåˆ° Registryï¼Œè®©å…¶ä»– Agent å¯å‘ç°ã€å¯è°ƒç”¨ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55dd73181c2940148036fccb9ad74158~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770200743&amp;x-signature=42WC7sFaCCxRJDKPaI72ZBYy6qE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•åœ¨ Runtime å±‚ä½¿ç”¨ Nacos Registry è¿›è¡ŒæœåŠ¡æ³¨å†Œï¼š</p>
<h4 data-id="heading-6">Python ä»£ç ç¤ºä¾‹</h4>
<p><strong>æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fruntime.agentscope.io%2Fzh%2Fa2a_registry.html" target="_blank" title="https://runtime.agentscope.io/zh/a2a_registry.html" ref="nofollow noopener noreferrer">runtime.agentscope.io/zh/a2a_regiâ€¦</a></strong></p>
<p><strong>æ–¹å¼ä¸€ï¼šå‚æ•°é…ç½®</strong></p>
<p>åœ¨æ„é€ Â AgentAppÂ æ—¶ï¼Œé€šè¿‡ A2A é…ç½®æ‰©å±•å­—æ®µÂ a2a_configÂ å‚æ•°çš„Â registryÂ å­—æ®µæŒ‡å®š Registry å®ä¾‹æˆ–åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">fromÂ agentscope_runtime.engine.appÂ importÂ AgentApp
fromÂ agentscope_runtime.engine.deployers.adapter.a2aÂ importÂ (
Â  Â  AgentCardWithRuntimeConfig,
)
fromÂ agentscope_runtime.engine.deployers.adapter.a2a.nacos_a2a_registryÂ importÂ (
Â  Â  NacosRegistry,
)
fromÂ v2.nacosÂ importÂ ClientConfigBuilder
<span class="hljs-comment"># åˆ›å»º Nacos Registry å®ä¾‹</span>
<span class="hljs-attr">registry</span> = NacosRegistry(
Â  Â  <span class="hljs-attr">nacos_client_config</span>=ClientConfigBuilder()
Â  Â  Â  Â  .server_address("nacos-server:8848")
Â  Â  Â  Â Â <span class="hljs-comment"># å…¶ä»–å¯é€‰é…ç½®é¡¹</span>
Â  Â  Â  Â  .build()
)
<span class="hljs-attr">app</span> = AgentApp(
Â  Â  <span class="hljs-attr">app_name</span>=<span class="hljs-string">"TestAgent"</span>,
Â  Â  <span class="hljs-attr">app_description</span>=<span class="hljs-string">"TestAgent"</span>,
Â  Â Â <span class="hljs-comment"># åœ¨ a2a_config ä¸­é…ç½® registry</span>
Â  Â  <span class="hljs-attr">a2a_config</span>=AgentCardWithRuntimeConfig(registry=registry),
)
</code></pre>
<p><strong>æ–¹å¼äºŒï¼šä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®</strong></p>
<p>ç¯å¢ƒå˜é‡å¯ä»¥é€šè¿‡Â .envÂ æ–‡ä»¶æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡è®¾ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env æ–‡ä»¶ç¤ºä¾‹</span>
<span class="hljs-attr">A2A_REGISTRY_ENABLED</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">A2A_REGISTRY_TYPE</span>=nacos
<span class="hljs-attr">NACOS_SERVER_ADDR</span>=localhost:<span class="hljs-number">8848</span>
<span class="hljs-comment"># å…¶ä»–å¯é€‰é…ç½®é¡¹</span>
</code></pre>
<h4 data-id="heading-7">Java ä»£ç ç¤ºä¾‹</h4>
<p><strong>æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjava.agentscope.io%2Fzh%2Ftask%2Fa2a.html" target="_blank" title="https://java.agentscope.io/zh/task/a2a.html" ref="nofollow noopener noreferrer">java.agentscope.io/zh/task/a2aâ€¦</a></strong></p>
<p>åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Java AgentScope ä¸­ï¼Œåº”ç”¨å¯ä»¥ç›´æ¥æš´éœ² A2A æœåŠ¡ï¼Œåªæœ‰åœ¨éœ€è¦ä½¿ç”¨ Sandbox æ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨ Runtimeã€‚</p>
<p>å¯¹äºéæœ€æ–°ç‰ˆæœ¬ï¼ŒJava å¼€å‘è€…å¯ä»¥å°† AgentScope Agent æ— ç¼èå…¥ç°æœ‰çš„ Spring Boot åŸºç¡€è®¾æ–½ä½“ç³»ã€‚é€šè¿‡å¼•å…¥Â <code>spring-boot-starter-agentscope-runtime-a2a-nacos</code>Â ä¾èµ–ï¼Œåº”ç”¨åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æš´éœ² A2A æœåŠ¡å¹¶æ³¨å†Œåˆ° Nacos Registryã€‚</p>
<p><strong>Maven ä¾èµ–é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â  Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.agentscope<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â  Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-agentscope-runtime-a2a-nacos<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â  Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>application.yaml é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">agentscope:</span>
Â  <span class="hljs-attr">a2a:</span>
Â  Â  <span class="hljs-attr">server:</span>
Â  Â  Â  <span class="hljs-attr">card:</span>
Â  Â  Â  Â  <span class="hljs-string">description:</span>Â <span class="hljs-string">"åŸºäº A2A åè®®çš„ Java æ™ºèƒ½ä½“"</span>
Â  Â  Â  Â  <span class="hljs-attr">provider:</span>
Â  Â  Â  Â  Â  <span class="hljs-attr">organization:</span> <span class="hljs-string">æ‚¨çš„ç»„ç»‡åç§°</span>
Â  Â  Â  Â  Â  <span class="hljs-attr">url:</span> <span class="hljs-string">https://your-organization.com</span>
Â  Â  Â  <span class="hljs-attr">nacos:</span>
Â  Â  Â  Â  <span class="hljs-string">server-addr:</span>Â <span class="hljs-string">${NACOS_SERVER_ADDRESS:127.0.0.1:8848}</span>
Â  Â  Â  Â Â <span class="hljs-comment"># å…¶ä»–å¯é€‰é…ç½®é¡¹</span>
</code></pre>
<p>é€šè¿‡ä¸Šè¿°é…ç½®ï¼ŒSpring Boot åº”ç”¨åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ï¼š</p>
<ul>
<li>æš´éœ²ç¬¦åˆ A2A è§„èŒƒçš„ JSONRPC æœåŠ¡ç«¯ç‚¹ï¼ˆé»˜è®¤è·¯å¾„ï¼š<code>/a2a/jsonrpc</code>ï¼‰ã€‚</li>
<li>æš´éœ² AgentCard çš„ Well-Known ç«¯ç‚¹ï¼ˆé»˜è®¤è·¯å¾„ï¼š<code>/.well-known/agent-card.json</code>ï¼‰ï¼Œç”¨äºå…¶ä»– Agent å‘ç°å’Œäº†è§£å½“å‰ Agent çš„èƒ½åŠ›ã€‚</li>
<li>è‡ªåŠ¨å¤„ç† A2A åè®®çš„æ¶ˆæ¯è½¬æ¢å’Œè·¯ç”±ï¼Œå°† A2A æ¶ˆæ¯æ ¼å¼è½¬æ¢ä¸ºåº”ç”¨å†…éƒ¨çš„æ¶ˆæ¯å¤„ç†é€»è¾‘ã€‚</li>
<li>æ”¯æŒä»»åŠ¡è¶…æ—¶ã€ä¸­æ–­ç­‰ A2A åè®®è§„å®šçš„è¿è¡Œæ—¶ç‰¹æ€§ã€‚</li>
<li>å°† Agent çš„èƒ½åŠ›æè¿°ï¼ˆAgentCardï¼‰æ³¨å†Œåˆ° Nacosï¼ŒåŸºäº Nacos 3.0 æ™ºèƒ½ä½“æ³¨å†Œä¸­å¿ƒè¿›è¡Œç»Ÿä¸€æ²»ç†ã€‚</li>
</ul>
<p>å¾—ç›Šäºè¿™ä¸€æœºåˆ¶ï¼ŒAgentScope åº”ç”¨å¯åŠ¨å³å®Œæˆåœ¨ Nacos çš„ A2A Agent æ³¨å†Œï¼Œä¸ºåç»­çš„å‘ç°ã€è·¯ç”±ã€ç°åº¦ä¸ç›‘æ§å¥ å®šåŸºç¡€ã€‚å¯¹äºå·²ç»å¤§è§„æ¨¡é‡‡ç”¨ Java æŠ€æœ¯æ ˆçš„å›¢é˜Ÿï¼Œè¿™æ„å‘³ç€æ™ºèƒ½ä½“æœåŠ¡èƒ½è‡ªç„¶é•¿åœ¨åŒä¸€å¥—åŸºç¡€è®¾æ–½ä¸Šï¼Œå¤§å¹…é™ä½å¼•å…¥æˆæœ¬ä¸è¿ç»´è´Ÿæ‹…ã€‚</p>
<h2 data-id="heading-8">æ€»ç»“</h2>
<p><strong>AgentScope å…¨é¢æ”¯æŒ A2A åè®®å’Œ Nacos Agent Registry</strong>ï¼Œæ ‡å¿—ç€æ™ºèƒ½ä½“ä»â€œå•ç‚¹èƒ½åŠ›â€è¿ˆå‘â€œå¼€æ”¾äº’è”ç”Ÿæ€â€çš„å…³é”®ä¸€æ­¥ï¼Œä¸ºä¼ä¸šæ„å»ºç»Ÿä¸€çš„æ™ºèƒ½ä½“ç®¡ç†å¹³å°ï¼ŒåŠ©åŠ›å¤§è§„æ¨¡ Agent åŒ–è½åœ°ï¼š</p>
<ul>
<li><strong>AgentScope å±‚ï¼šå€ŸåŠ©</strong> A2AAgentÂ ä¸Â AgentCardResolverï¼Œæˆ‘ä»¬æä¾›ç»Ÿä¸€çš„ A2A å¯¹æ¥èƒ½åŠ›å’Œçµæ´»çš„å‘ç°ç­–ç•¥ï¼Œé»˜è®¤é›†æˆ Nacosï¼Œæ”¯æŒåŠ¨æ€ Agent å‘ç°ä¸è°ƒç”¨ã€‚</li>
<li><strong>AgentScope Runtime å±‚ï¼šé€šè¿‡ A2A åè®®é€‚é…å™¨å’Œ</strong> A2ARegistryÂ æŠ½è±¡æ¥å£ï¼Œæä¾›ç»Ÿä¸€çš„ A2A æœåŠ¡æš´éœ²èƒ½åŠ›ï¼Œæ”¯æŒè‡ªåŠ¨æœåŠ¡æ³¨å†Œä¸æ²»ç†ï¼Œä¸ PythonÂ AgentAppÂ å’Œ JavaÂ Spring Boot StarterÂ æ— ç¼é›†æˆã€‚</li>
</ul>
<p>æœªæ¥ï¼Œæˆ‘ä»¬ä¼šç»§ç»­å›´ç»• A2A ä¸ Registry æ·±è€•ï¼Œåœ¨å‘ç°ä¸è·¯ç”±ã€ç‰ˆæœ¬ä¸ç°åº¦ã€å®‰å…¨ä¸è®¿é—®æ§åˆ¶ç­‰æ–¹å‘è¿­ä»£ï¼Œè®©é¢å‘ç”Ÿäº§çš„æ™ºèƒ½ä½“åº”ç”¨æ›´ç¨³ã€æ›´æ˜“ç”¨ã€‚</p>
<p><strong>æ‰©å±•é“¾æ¥</strong>ï¼š</p>
<p>AgentScopeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.agentscope.io%2F" target="_blank" title="https://doc.agentscope.io/" ref="nofollow noopener noreferrer">doc.agentscope.io/</a></p>
<p>AgentScope Python A2A æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.agentscope.io%2Ftutorial%2Ftask_a2a.htmlAgentScope" target="_blank" title="https://doc.agentscope.io/tutorial/task_a2a.htmlAgentScope" ref="nofollow noopener noreferrer">doc.agentscope.io/tutorial/taâ€¦</a></p>
<p>Javaï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjava.agentscope.io%2FAgentScope" target="_blank" title="https://java.agentscope.io/AgentScope" ref="nofollow noopener noreferrer">java.agentscope.io/AgentScope</a></p>
<p>Java A2A æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fjava.agentscope.io%2Fen%2Ftask%2Fa2a.html" target="_blank" title="https://java.agentscope.io/en/task/a2a.html" ref="nofollow noopener noreferrer">java.agentscope.io/en/task/a2aâ€¦</a></p>
<p>Nacosï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnacos.io%2Fdocs%2Flatest%2Fmanual%2Fuser%2Fai%2Fagent-registry" target="_blank" title="https://nacos.io/docs/latest/manual/user/ai/agent-registry" ref="nofollow noopener noreferrer">nacos.io/docs/latestâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çªç ´ä¼ ç»Ÿé™åˆ¶ï¼šOxygenREC--ä¸€ä¸ªåŸºäºæŒ‡ä»¤è·Ÿéšçš„â€œå¿«æ…¢æ€è€ƒâ€œç”µå•†ç”Ÿæˆå¼æ¨èæ¡†æ¶]]></title>    <link>https://juejin.cn/post/7600068892988866570</link>    <guid>https://juejin.cn/post/7600068892988866570</guid>    <pubDate>2026-01-28T10:43:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600068892988866570" data-draft-id="7600234310965051430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çªç ´ä¼ ç»Ÿé™åˆ¶ï¼šOxygenREC--ä¸€ä¸ªåŸºäºæŒ‡ä»¤è·Ÿéšçš„â€œå¿«æ…¢æ€è€ƒâ€œç”µå•†ç”Ÿæˆå¼æ¨èæ¡†æ¶"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-28T10:43:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äº¬ä¸œé›¶å”®æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çªç ´ä¼ ç»Ÿé™åˆ¶ï¼šOxygenREC--ä¸€ä¸ªåŸºäºæŒ‡ä»¤è·Ÿéšçš„â€œå¿«æ…¢æ€è€ƒâ€œç”µå•†ç”Ÿæˆå¼æ¨èæ¡†æ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äº¬ä¸œé›¶å”®æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T10:43:58.000Z" title="Wed Jan 28 2026 10:43:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç”µå•†æ¨èç³»ç»Ÿä¸­ï¼Œæ¨èæ¨¡å‹é•¿æœŸé¢ä¸´ç€ä¸¤ä¸ªæ ¸å¿ƒçŸ›ç›¾ï¼šä¸€æ–¹é¢ï¼Œä¼ ç»Ÿçš„å¤šé˜¶æ®µçº§è”æ¨èç³»ç»Ÿå­˜åœ¨ç›®æ ‡ä¸ä¸€è‡´å’Œè¯¯å·®ç´¯ç§¯çš„é—®é¢˜ï¼›å¦ä¸€æ–¹é¢ï¼Œç›´æ¥å¼•å…¥å¤§å‹è¯­è¨€æ¨¡å‹LLMè™½ç„¶èƒ½å¸¦æ¥å¼ºå¤§çš„æ¨ç†èƒ½åŠ›ï¼Œä½†å…¶é«˜æ˜‚çš„å»¶è¿Ÿå’Œè®¡ç®—æˆæœ¬åœ¨å·¥ä¸šçº§åº”ç”¨ä¸­éš¾ä»¥æ‰¿å—ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç°æœ‰çš„ç”Ÿæˆå¼æ¨èæ–¹æ³•åœ¨å¤šåœºæ™¯æ‰©å±•æ€§ä¸Šé¢ä¸´å·¨å¤§ç“¶é¢ˆ--æ¯ä¸ªåœºæ™¯éƒ½éœ€è¦ç‹¬ç«‹è®­ç»ƒå’Œéƒ¨ç½²ï¼Œå¯¼è‡´èµ„æºåˆ©ç”¨ç‡ä½ä¸‹ã€ç»´æŠ¤æˆæœ¬é«˜æ˜‚ã€‚</p>
<p>äº¬ä¸œé›¶å”®OxygenRECå›¢é˜Ÿåœ¨è®ºæ–‡ã€ŠOxygenREC: An Instruction-Following Generative Framework for E-commerce Recommendationã€‹ä¸­æå‡ºäº†ä¸€ç§å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼šOxygenRECã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºâ€œå¿«æ…¢æ€è€ƒâ€çš„æŒ‡ä»¤è·Ÿéšç”Ÿæˆå¼æ¨èæ¡†æ¶ï¼Œä¸ä»…è§£å†³äº†æ¨ç†èƒ½åŠ›ä¸å»¶è¿Ÿä¹‹é—´çš„çŸ›ç›¾ï¼Œæ›´å®ç°äº†â€œä¸€æ¬¡è®­ç»ƒï¼Œå¤šå¤„éƒ¨ç½²â€çš„å¤šåœºæ™¯ç»Ÿä¸€é«˜æ•ˆè§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7df8c0078784d2cbbe21c6175c19f8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=two5r0QHfN4%2FFUGKXeu2hm4CgCA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€å…³é”®æŒ‘æˆ˜</h2>
<p>OxygenREC æ—¨åœ¨è§£å†³å½“å‰æ¨èç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯ç”Ÿæˆå¼æ¨èèŒƒå¼ä¸‹çš„ä¸‰å¤§æ ¸å¿ƒéš¾é¢˜ï¼š</p>
<p>1.æœ‰é™çš„æ¼”ç»æ¨ç†èƒ½åŠ›ï¼šç°æœ‰çš„ç”Ÿæˆå¼æ¨èæ–¹æ³•ä¸»è¦ä»ç”¨æˆ·æµ·é‡è¡Œä¸ºä¸­è¿›è¡Œå½’çº³å­¦ä¹ ï¼Œä½†åœ¨éœ€è¦ç»“åˆç°å®ä¸–ç•ŒçŸ¥è¯†è¿›è¡Œæ·±åº¦æ¼”ç»æ¨ç†çš„åœºæ™¯ä¸‹è¡¨ç°ä¸ä½³ã€‚æ¯”å¦‚ä¸‹è¾¹ä¸¤ä¸ªä¾‹å­ï¼š</p>
<p>å½“æ¨èçš„æ—¶ç©ºèƒŒæ™¯å’Œç”¨æˆ·ç”»åƒæ˜¯â€œæˆéƒ½å†¬è‡³æ—¶çš„å¹´è½»å®å¦ˆâ€æ—¶ï¼Œä¼ ç»Ÿæ¨¡å‹å¯èƒ½åªæ˜¯æ¨èâ€œå†¬å­£å¤–å¥—â€è¿™æ ·çš„å•†å“ï¼Œè€Œæ— æ³•æ·±åº¦æ¨ç†å‡ºæ­¤æ—¶æˆéƒ½æ˜¯â€œå†·æ¹¿ç¯å¢ƒâ€ï¼Œè¿™ä½å¹´è½»æ¯äº²æ½œåœ¨çš„éœ€æ±‚å¯èƒ½æ˜¯â€œå©´å„¿æ’æ±—ç¡è¡£â€ã€‚</p>
<p>æœ‰ä¸ªæˆ·å¤–è¿åŠ¨vloggeråœ¨è´­ç‰©è¡Œä¸ºä¸­åå¤å¯¹æ¯”åä¸ºMate 70å’ŒiPhone 16 Proä¸¤æ¬¾æ‰‹æœºï¼Œä¼ ç»Ÿç³»ç»Ÿå› ä¸ºç”¨æˆ·é¢‘ç¹çš„äº¤äº’å†å²ï¼Œåªä¼šä¸æ–­åŠ å¼ºé‡å¤æ¨èè¿™ä¸¤æ¬¾å•†å“è¿›è¡Œæ¯”ä»·ï¼Œè€Œæ— æ³•æ¨ç†å‡ºå…¶çœŸæ­£è¯‰æ±‚å¯èƒ½æ˜¯â€œé«˜è´¨é‡çš„ç§»åŠ¨å½±åƒâ€ï¼Œä»è€Œæ¨¡å‹æœªèƒ½ç²¾å‡†æ¨èâ€˜åä¸ºPuraâ€™ç³»åˆ—è¿™ä¸€çœŸæ­£ç¬¦åˆç”¨æˆ·è¯‰æ±‚çš„ç›®æ ‡å•†å“ã€‚</p>
<p>2.å¤šåœºæ™¯é€‚åº”ä¸èµ„æºæ•ˆç‡çš„çŸ›ç›¾ï¼šå¤§éƒ¨åˆ†æ¨èå¹³å°æ‹¥æœ‰é¦–é¡µã€é¢‘é“æµã€è´­ç‰©è½¦ã€æœç´¢ç­‰å¤šç§æ¨èåœºæ™¯ã€‚ç°æœ‰ç”Ÿæˆå¼æ¨èæ¨¡å‹å¦‚æœä¸ºæ¯ä¸ªåœºæ™¯è®­ç»ƒç‹¬ç«‹æ¨¡å‹ï¼Œä¼šå¸¦æ¥å·¨å¤§çš„è¿è¥å’Œè®¡ç®—æˆæœ¬ï¼Œè€Œä½¿ç”¨ç®€å•çš„ç»Ÿä¸€æ¨¡å‹åˆä¼šé¢ä¸´â€œè´Ÿè¿ç§»â€é—®é¢˜--ä¸åŒåœºæ™¯é—´çš„çŸ¥è¯†ç›¸äº’å¹²æ‰°ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p>
<p>3.å·¥ä¸šçº§éƒ¨ç½²çš„å·¥ç¨‹æŒ‘æˆ˜ï¼šå°†LLMçš„æ·±åº¦æ¨ç†èƒ½åŠ›ä¸æ¨èç³»ç»Ÿçš„å¤§è§„æ¨¡ç¨€ç–ç‰¹å¾ã€ä¸¥æ ¼å»¶è¿Ÿè¦æ±‚ç›¸ç»“åˆï¼Œæ˜¯ä¸€ä¸ªå·¨å¤§çš„ç³»ç»Ÿå·¥ç¨‹æŒ‘æˆ˜ã€‚å®ƒéœ€è¦åŒæ—¶å¤„ç†æ¨èç³»ç»Ÿå…¸å‹çš„TBçº§ç¨€ç–åµŒå…¥å’ŒLLMå…¸å‹çš„åäº¿çº§ç¨ å¯†å‚æ•°ï¼Œè¿™å¯¹è®­ç»ƒæ¡†æ¶å’Œæ¨ç†å¼•æ“éƒ½æå‡ºäº†æé«˜è¦æ±‚ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒè´¡çŒ®</h2>
<p>é¢å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œäº¬ä¸œé›¶å”®OxygenRECå›¢é˜Ÿæå‡ºäº†ä¸€ä¸ªåŸºäºæŒ‡ä»¤è·Ÿéšçš„ç”Ÿæˆå¼æ¨èæ¡†æ¶-OxygenRECï¼Œé¦–æ¬¡æŠŠLLMä¸­çš„â€œå¿«æ…¢æ€è€ƒâ€æ¨¡å¼å¼•å…¥åˆ°ç”Ÿæˆå¼æ¨èä¸­æ¥ã€‚åœ¨OxygenRECæ¡†æ¶ä¸­ï¼Œé€šè¿‡åŸºäºTransformer çš„Encoder-Decoder ä½œä¸ºéª¨å¹²ç½‘ç»œï¼Œèƒ½å¤Ÿæ ¹æ®ç‰¹å®šæŒ‡ä»¤ç”Ÿæˆè¯­ä¹‰åŒ–ç‰©å“åºåˆ—ï¼Œæ¥æ‰§è¡Œæ¨èåœºæ™¯çš„â€å¿«æ€è€ƒ"æ–¹å¼ã€‚åœ¨â€œæ…¢æ€è€ƒâ€æ¨¡å¼ä¸­ï¼Œå¼•å…¥ä¸Šä¸‹æ–‡æ¨ç†æŒ‡ä»¤--ç”±è¿‘çº¿LLM pipeline ç”Ÿæˆï¼Œå°†ç”¨æˆ·è¡Œä¸ºä¸ä¸Šä¸‹æ–‡åˆæˆä¸ºå¯è§£é‡Šçš„æŒ‡ä»¤ã€‚åŒæ—¶å¤šåœºæ™¯å¯¹é½ä¸­ï¼Œé€šè¿‡åœºæ™¯æŒ‡ä»¤ä¸åŸºäºå¼ºåŒ–å­¦ä¹ çš„å¯¹é½æœºåˆ¶ï¼Œå®ç°â€œä¸€æ¬¡è®­ç»ƒï¼Œå¤šåœºæ™¯éƒ¨ç½²â€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa6943c39aa3452a9461937c41dd99dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=LmqwDZ2L1J1VK%2Bt5K2HP7NHVzh0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">1. â€œå¿«æ…¢æ€è€ƒâ€æ¶æ„ï¼šçŸ¥è¯†æ³¨å…¥ä¸ä½å»¶è¿Ÿçš„å¹³è¡¡</h4>
<p>è¿™æ˜¯æ•´ä¸ªOxygenRECçš„åŸºç¡€ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¤æ‚çš„æ¨ç†è¿‡ç¨‹â€œç¦»çº¿åŒ–â€ï¼Œä¿è¯åœ¨çº¿æœåŠ¡çš„ä½å»¶è¿Ÿã€‚</p>
<p>æ…¢æ€è€ƒï¼šä¸€ä¸ªè¿‘çº¿çš„LLM pipelineï¼Œç»¼åˆåˆ†æç”¨æˆ·çš„æ—¶ç©ºä¸Šä¸‹æ–‡ã€ä¸ªæ€§åŒ–ç‰¹å¾å’Œå†å²è¡Œä¸ºï¼Œç”Ÿæˆé«˜è´¨é‡çš„â€œä¸Šä¸‹æ–‡æ¨ç†æŒ‡ä»¤â€ã€‚è¿™ä¸ªè¿‡ç¨‹èåˆäº†ä¸–ç•ŒçŸ¥è¯†ï¼Œèƒ½è¿›è¡Œæ·±åº¦æ¼”ç»æ¨ç†ï¼Œä½†å› å…¶æ˜¯è¿‘çº¿æ‰¹é‡å¤„ç†ï¼Œä¸å¢åŠ åœ¨çº¿è¯·æ±‚çš„å»¶è¿Ÿã€‚</p>
<p>å¿«æ€è€ƒï¼šä¸€ä¸ªé«˜æ•ˆçš„ç¼–ç å™¨-è§£ç å™¨éª¨å¹²ç½‘ç»œã€‚å®ƒæ¥æ”¶â€œæ…¢æ€è€ƒâ€ç”Ÿæˆçš„æŒ‡ä»¤ï¼Œç»“åˆå®æ—¶ç”¨æˆ·ä¿¡å·ï¼Œåœ¨ä¸¥æ ¼çš„å»¶è¿Ÿé™åˆ¶ä¸‹ç”Ÿæˆæ¨èåºåˆ—ã€‚è¯¥éª¨å¹²ç½‘ç»œæœ¬èº«è½»é‡ã€é«˜æ•ˆï¼Œä¸“ä¸ºå®æ—¶æ¨ç†ä¼˜åŒ–ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b52361b6fcf74385b289ca2312ddf96f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=bA49vQ0BcffsL8hXQ0E7YjbIW3c%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">2. è¯­ä¹‰å¯¹é½çš„æŒ‡ä»¤æ§åˆ¶æœºåˆ¶ï¼šè®©æŒ‡ä»¤çœŸæ­£å‘æŒ¥ä½œç”¨</h4>
<p>ä»…ä»…ç”ŸæˆæŒ‡ä»¤æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜å¿…é¡»ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®ç†è§£å¹¶éµå¾ªæŒ‡ä»¤ã€‚OxygenRECé€šè¿‡ä¸¤é¡¹å…³é”®æŠ€æœ¯å®ç°ç²¾å‡†æŒ‡ä»¤æ§åˆ¶ï¼š</p>
<p>æŸ¥è¯¢åˆ°ç‰©å“çš„å¯¹é½æŸå¤±ï¼šåœ¨è®­ç»ƒé˜¶æ®µï¼Œé€šè¿‡ä¸€ä¸ªè¾…åŠ©çš„Query-to-Item (Q2I) æŸå¤±å‡½æ•°ï¼Œå°†æŒ‡ä»¤åµŒå…¥ä¸ç›®æ ‡ç‰©å“åµŒå…¥åœ¨åŒä¸€ä¸ªè¯­ä¹‰ç©ºé—´ä¸­å¯¹é½ã€‚è¿™ä½¿å¾—æŒ‡ä»¤èƒ½å¤Ÿâ€œç†è§£â€ç‰©å“ï¼Œå¹¶ç”¨äºæ£€ç´¢ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/456be53a34c64881b332f3ca1234ea54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=EgBT2a2bhxSYsCifMziQZyH8olM%3D" alt="image.png" loading="lazy"/></p>
<p>æŒ‡ä»¤å¼•å¯¼æ£€ç´¢(IGR)ï¼šåœ¨ç”Ÿæˆæ¨èæ—¶ï¼Œåˆ©ç”¨å¯¹é½åçš„æŒ‡ä»¤ä½œä¸ºæŸ¥è¯¢ï¼Œä»ç”¨æˆ·é•¿æœŸå†å²è¡Œä¸ºä¸­æ£€ç´¢å‡ºæœ€ç›¸å…³çš„éƒ¨åˆ†ï¼Œè¿‡æ»¤æ‰æ— å…³çš„å™ªå£°ã€‚è¿™ç¡®ä¿äº†æ¨¡å‹ç”Ÿæˆæ—¶ä¸“æ³¨åœ¨ä¸å½“å‰æŒ‡ä»¤æ„å›¾æœ€ç›¸å…³çš„å†å²ä¿¡æ¯ä¸Šï¼Œå¤§å¤§æå‡äº†å¯æ§æ€§å’Œå‡†ç¡®æ€§ã€‚</p>
<h4 data-id="heading-4">3. åŸºäºæŒ‡ä»¤ä¸å¼ºåŒ–å­¦ä¹ çš„å¤šåœºæ™¯ç»Ÿä¸€å¯¹é½ï¼šTrain-Once-Deploy-Everywhere</h4>
<p>è¿™æ˜¯è§£å†³å¤šåœºæ™¯æ‰©å±•æ€§çš„å…³é”®ã€‚OxygenRECæ‘’å¼ƒäº†ä¸ºæ¯ä¸ªåœºæ™¯ç‹¬ç«‹å»ºæ¨¡çš„æ€è·¯ã€‚</p>
<p>åœºæ™¯æŒ‡ä»¤åŒ–ï¼šå°†ä¸åŒçš„åœºæ™¯ä¿¡æ¯ï¼ˆå¦‚é¦–é¡µã€è´­ç‰©è½¦ï¼‰å’Œå¯é€‰çš„è§¦å‘ç‰©å“ï¼ˆå¦‚ç”¨æˆ·ç‚¹å‡»çš„å…¥å£å•†å“ï¼‰ç»Ÿä¸€ç¼–ç ä¸ºâ€œåœºæ™¯æŒ‡ä»¤â€ï¼Œä½œä¸ºæ¨¡å‹çš„æ¡ä»¶è¾“å…¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab5da81d461544c99f265ffc6ade2b3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=VslxIpTc5Wu94KlcDUmKJ6yaJPo%3D" alt="image.png" loading="lazy"/></p>
<p>ç»Ÿä¸€å¥–åŠ±æ˜ å°„ä¸ç­–ç•¥ä¼˜åŒ–ï¼šè®¾è®¡äº†ä¸€ä¸ªç»Ÿä¸€çš„å¥–åŠ±æ˜ å°„æœåŠ¡ï¼Œå°†ä¸åŒåœºæ™¯ã€ä¸åŒä¸šåŠ¡ç›®æ ‡ï¼ˆå¦‚GMVï¼Œè½¬åŒ–ç‡ï¼Œåˆæ³•æ€§ï¼Œå¤šæ ·æ€§ï¼‰çš„å¥–åŠ±ä¿¡å·å½’ä¸€åŒ–ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæå‡ºäº†Soft Adaptive Group Clip Policy Optimization (SA-GCPO)ç®—æ³•è¿›è¡Œå¼ºåŒ–å­¦ä¹ è®­ç»ƒ:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/691bbb2d3c5a41c2852e5fbb621b3974~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=yY6qltu7fFGDbHF4fNPqt0K11xA%3D" alt="image.png" loading="lazy"/></p>
<p>è¯¥ç®—æ³•ç”¨è‡ªé€‚åº”é—¨æ§å‡½æ•°æ›¿ä»£ä¼ ç»ŸåŸºäºGRPOçš„ç¡¬æˆªæ–­æ–¹å¼(hard clip):</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7861e3ae0a14bb1a39f295b3d2a84db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=%2Fs27rs%2FTM4r9PTCMj%2Fp7qedGfwI%3D" alt="image.png" loading="lazy"/></p>
<p>å¹¶ä»¥åŸºäºç”¨æˆ·çœŸå®åé¦ˆçš„å¥–åŠ±åˆ†æ•°ä½œä¸ºé˜ˆå€¼åŒºåˆ†æ­£è´Ÿadvantageæ ·æœ¬ï¼Œæ˜¾è‘—æå‡äº†å¤šä»»åŠ¡ã€å¤šåœºæ™¯ä¸‹ç­–ç•¥å­¦ä¹ çš„ç¨³å®šæ€§å’Œæ•ˆç‡ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f6df5ad12294ba9a15a4f7cea575b7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=%2BSaOUEO6bJ44eb9RFxAu8lQvGoI%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">4. å¤§è§„æ¨¡ç”Ÿäº§çº§ç³»ç»Ÿå®ç°</h4>
<p>ä¸ºäº†æ”¯æ’‘ä»¥ä¸Šåˆ›æ–°ï¼Œå›¢é˜Ÿæ„å»ºäº†å®Œæ•´çš„å·¥ç¨‹ä½“ç³»ï¼š</p>
<p>ç»Ÿä¸€è®­ç»ƒæ¡†æ¶ï¼šåŸºäºPyTorchï¼Œæ·±åº¦èåˆäº†å·¥ä¸šçº§ç¨€ç–åµŒå…¥å¼•æ“å’ŒLLMç¨ å¯†è®­ç»ƒå¼•æ“ï¼Œåœ¨128å¼ H800 GPUé›†ç¾¤ä¸Šå®ç°äº†40%çš„æ¨¡å‹FLOPsåˆ©ç”¨ç‡ã€‚ï»¿</p>
<p>é«˜æ€§èƒ½æ¨ç†å¼•æ“xLLMï¼šé’ˆå¯¹ç”Ÿæˆå¼æ¨èé•¿ä¸Šä¸‹æ–‡ã€å¤§å€™é€‰é›†çš„ç‰¹ç‚¹ï¼Œå®šåˆ¶å¼€å‘äº†xLLMæ¨ç†æ¡†æ¶ï¼Œé€šè¿‡xScheduleï¼ˆç³»ç»Ÿè°ƒåº¦ï¼‰ã€xAttentionï¼ˆç®—å­ä¼˜åŒ–ï¼‰ã€xBeamï¼ˆæŸæœç´¢ä¼˜åŒ–ï¼‰ä¸‰çº§ä¼˜åŒ–ï¼Œæ»¡è¶³çº¿ä¸Šä¸¥æ ¼çš„æœåŠ¡çº§åˆ«ç›®æ ‡ã€‚</p>
<p>è¿‘çº¿æŒ‡ä»¤æœåŠ¡ï¼šæ¨ç†æŒ‡ä»¤é€šè¿‡è¿‘çº¿æœåŠ¡æ‰¹é‡ç”Ÿæˆå¹¶å­˜å…¥KVæ•°æ®åº“ï¼Œçº¿ä¸Šæ¨èæ¨¡å‹ç›´æ¥è¯»å–ï¼Œå®ç°äº†é›¶åœ¨çº¿LLMè°ƒç”¨ï¼Œå…¼é¡¾äº†è¯­ä¹‰ä¸°å¯Œæ€§å’Œä½å»¶è¿Ÿã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€å®éªŒæˆæœ</h2>
<p>OxygenRECåœ¨äº¬ä¸œå‡ ä¸ªæ ¸å¿ƒåœºæ™¯çš„å¤§é‡ç¦»çº¿å®éªŒå’Œåœ¨çº¿A/Bæµ‹è¯•ä¸­å–å¾—äº†æ˜¾è‘—æ•ˆæœï¼Œè¯æ˜OxygenREC åŸºäºç”Ÿæˆå¼æ¨èçš„æ–¹æ³•åœ¨å¤§è§„æ¨¡å·¥ä¸šçº§æ¨èç³»ç»Ÿä¸­çš„æœ‰æ•ˆæ€§ã€‚</p>
<h4 data-id="heading-7">1. åŸºäºå¿«æ…¢æ€è€ƒçš„ç”Ÿæˆå¼æ¡†æ¶æœ‰æ•ˆæ€§éªŒè¯</h4>
<p>è¯­ä¹‰IDï¼šé€šè¿‡å¤šæºå¯¹æ¯”å­¦ä¹ ï¼ˆæ–‡æœ¬ã€å›¾åƒã€è¡Œä¸ºå…³è”ï¼‰æ„å»ºçš„å±‚æ¬¡åŒ–è¯­ä¹‰IDï¼Œåœ¨ä¿æŒé«˜ç±»åˆ«çº¯åº¦ï¼ˆ92.8%ï¼‰çš„åŒæ—¶ï¼Œå®ç°äº†æä½çš„IDç¢°æ’ï¼Œè¯æ˜äº†å…¶å¼ºå¤§çš„è¡¨è¾¾å’ŒåŒºåˆ†èƒ½åŠ›ã€‚</p>
<p>æŒ‡ä»¤è·Ÿéšï¼šæ¶ˆèå®éªŒè¯æ˜ï¼Œåœ¨BOSå³ä¾§æ’å…¥æŒ‡ä»¤çš„æ–¹å¼ä¸ºæœ€ä½³ï¼›èåˆäº†åœºæ™¯IDå’Œè§¦å‘ç‰©å“IDçš„æŒ‡ä»¤æ•ˆæœæ˜¾è‘—ä¼˜äºå•ä¸€ç»„ä»¶ï¼›IGRå’ŒQ2Iå¯¹é½æœºåˆ¶å…±åŒä½œç”¨å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f9dd59be950429da8a3a310fee5dd44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=k7XxVwhntSYUlnbyqc2KEKNeAp0%3D" alt="image.png" loading="lazy"/></p>
<p>ç»Ÿä¸€æ¨¡å‹ vs. ç‹¬ç«‹æ¨¡å‹ï¼šåœ¨å…­ä¸ªæ ¸å¿ƒåœºæ™¯çš„å¯¹æ¯”ä¸­ï¼Œç»Ÿä¸€çš„OxygenRECæ¨¡å‹å…¨é¢è¶…è¶Šäº†ä¸ºæ¯ä¸ªåœºæ™¯ç‹¬ç«‹å¾®è°ƒçš„åŸºçº¿æ¨¡å‹ï¼ŒéªŒè¯äº†OxygenRECæ¡†æ¶åœ¨åœºæ™¯é—´æ­£å‘è¿ç§»çš„æœ‰æ•ˆæ€§ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0b1466804884746b3ad44efb6446e10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=5U4ZnhK%2BL0RXvSOAoBNetYjdpys%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">2. åŸºäºSA-GCPOåè®­ç»ƒçš„æœ‰æ•ˆæ€§éªŒè¯</h4>
<p>åœ¨åç»­è®­ç»ƒé˜¶æ®µï¼Œæå‡ºçš„SA-GCPOç®—æ³•åœ¨åˆæˆæ•°æ®æ¯”ä¾‹å˜åŒ–æ—¶è¡¨ç°æ›´ç¨³å®šï¼Œä¸”æ€§èƒ½æ˜¾è‘—ä¼˜äºä¼ ç»Ÿçš„GRPOåŠå…¶å˜ä½“GSPOã€‚ä¾‹å¦‚ï¼Œåœ¨33%åˆæˆæ•°æ®æ¯”ä¾‹ä¸‹ï¼ŒSA-GCPOåœ¨HR@1å’ŒHR@10ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0087405b804745ceb529b71b5855817f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=08vEU0crdzoLzVVmQvE5fvAen60%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">3. ç”µå•†åœºæ™¯åœ¨çº¿A/Bæµ‹è¯•çš„å•†ä¸šæ•ˆæœ</h4>
<p>OxygenRECå·²åœ¨äº¬ä¸œAppä¸Šå½¢æˆè¦†ç›–ç”¨æˆ·è´­ç‰©å…¨é“¾è·¯çš„éƒ¨ç½²é—­ç¯ï¼šé¦–é¡µå¯¼æµï¼ˆåœºæ™¯1ã€2ï¼‰-&gt; é¢‘é“æµè§ˆï¼ˆåœºæ™¯3ã€4ï¼‰-&gt; å•†å“ç»“ç®—è½¬åŒ–ï¼ˆåœºæ™¯5ã€6ï¼‰ã€‚åœ¨çº¿æµ‹è¯•ç»“æœè¡¨æ˜ï¼Œè¯¥æ¨¡å‹åœ¨æ‰€æœ‰å…³é”®ä¸šåŠ¡æŒ‡æ ‡ä¸Šå‡å¸¦æ¥æ˜¾è‘—æå‡ï¼š</p>
<p>é¦–é¡µåœºæ™¯ï¼šGMVæå‡4.52%-8.40%ã€‚</p>
<p>é¢‘é“æµåœºæ™¯ï¼šå…¶ä¸­ä¸€ä¸ªåœºæ™¯çš„è®¢å•é‡æå‡äº†8.03%ï¼Œæ˜¾ç¤ºå‡ºæ¨¡å‹ç²¾å‡†åŒ¹é…è´­ä¹°æ„å›¾çš„èƒ½åŠ›ã€‚</p>
<p>ç»“ç®—è·¯å¾„åœºæ™¯ï¼šåœ¨ç”¨æˆ·å¼ºè´­ä¹°æ„å›¾ä¸‹ï¼ŒGMVæå‡é«˜è¾¾11.80%ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d67fbbf584e49edbe176cf9f1fc028f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=23bAzHEgiBYmFlb9avNIhDNPaPE%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸è¡Œä¸šä¸Šå…¶ä»–ç”Ÿæˆå¼æ¨èæ–¹å¼å¯¹æ¯”:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/582dc6a123c741c381fd9891479fc4fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770201838&amp;x-signature=oGNN%2BnJdtBnYTm1V4W1iZ9rLWnM%3D" alt="image.png" loading="lazy"/></p>
<p>OxygenREC åœ¨å‡ ä¸ªå…³é”®ç»´åº¦ä¸Šè¿›è¡Œäº†ç”Ÿæˆå¼æ¨èçš„èŒƒå¼é©æ–°ï¼š</p>
<p>æ¶æ„ä¸Šï¼Œç”¨â€œå¿«æ…¢æ€è€ƒâ€ç ´è§£äº†æ¨ç†ä¸å»¶è¿Ÿçš„æ­»ç»“ã€‚</p>
<p>æ•ˆç‡ä¸Šï¼Œç”¨â€œç»Ÿä¸€æŒ‡ä»¤æ¨¡å‹â€ç ´è§£äº†å¤šåœºæ™¯è®­ç»ƒçš„å›°å±€ã€‚</p>
<p>æ§åˆ¶ä¸Šï¼Œç”¨â€œè¯­ä¹‰å¯¹é½ä¸å¼•å¯¼æ£€ç´¢â€æ„å»ºäº†ç”Ÿæˆå¼æ¨èæ¨¡å‹çš„æŒ‡ä»¤è·Ÿéšèƒ½åŠ›ã€‚</p>
<p>ä¼˜åŒ–ä¸Šï¼Œç”¨â€œSA-GCPOâ€å’Œå…¨æ ˆç³»ç»Ÿä¼˜åŒ–ï¼Œç¡®ä¿äº†æŠ€æœ¯åœ¨å·¥ä¸šå·¨é‡æµé‡ä¸‹çš„å¯è¡Œæ€§ã€ç¨³å®šæ€§å’Œå“è¶Šæ€§èƒ½ã€‚</p>
<h2 data-id="heading-10">å››ã€æ€»ç»“ä¸å±•æœ›</h2>
<p>OxygenRECçš„æˆåŠŸï¼Œæ ‡å¿—ç€ç”Ÿæˆå¼æ¨èåœ¨å·¥ä¸šè½åœ°ä¸Šè¿ˆå‡ºäº†å…³é”®ä¸€æ­¥ã€‚å®ƒé€šè¿‡â€œå¿«æ…¢æ€è€ƒâ€å·§å¦™å¹³è¡¡äº†æ·±åº¦æ¨ç†ä¸ä½å»¶è¿Ÿï¼Œé€šè¿‡â€œæŒ‡ä»¤è·Ÿéšâ€å®ç°äº†å¯¹æ¨èè¿‡ç¨‹çš„ç²¾å‡†å¯æ§ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€çš„å¥–åŠ±ä¸ç­–ç•¥å­¦ä¹ ç ´è§£äº†å¤šåœºæ™¯æ‰©å±•çš„éš¾é¢˜ï¼ŒçœŸæ­£å®ç°äº†â€œä¸€æ¬¡è®­ç»ƒï¼Œå¤šåœºæ™¯éƒ¨ç½²â€çš„pipelineã€‚</p>
<p>æœªæ¥ï¼Œäº¬ä¸œé›¶å”®OxygenRECå›¢é˜Ÿè®¡åˆ’ä»ä¸¤ä¸ªæ–¹å‘ç»§ç»­æ¢ç´¢ï¼š</p>
<p>ä¸€æ˜¯å‘åŸºäºè¯­è¨€æ‰©æ•£æ¨¡å‹çš„éè‡ªå›å½’ç”ŸæˆèŒƒå¼æ¼”è¿›ï¼Œä»æ ¹æœ¬ä¸Šçªç ´åºåˆ—ç”Ÿæˆå»¶è¿Ÿä¸åˆ—è¡¨é•¿åº¦çš„çº¿æ€§å…³ç³»ï¼Œæ»¡è¶³æ›´é«˜ååéœ€æ±‚ï¼›</p>
<p>äºŒæ˜¯å¼€å±•è·¨åœºæ™¯ç”¨æˆ·è½¨è¿¹å»ºæ¨¡ï¼Œä»ç”¨æˆ·åœ¨é¦–é¡µã€æœç´¢ã€è´­ç‰©è½¦ã€ç»“ç®—ç­‰å¤šåœºæ™¯çš„è¿è´¯è¡Œä¸ºä¸­æŒ–æ˜æ›´æ·±å±‚çš„ç”¨æˆ·æ„å›¾ï¼Œå®ç°æ›´é•¿å‘¨æœŸçš„ä»·å€¼æ¨èã€‚</p>
<p>OxygenRECä¸ä»…æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ¨èç³»ç»Ÿï¼Œæ›´ä¸ºå·¥ä¸šçº§ç”Ÿæˆå¼AIåº”ç”¨çš„å¤§æ¨¡å‹è®¾è®¡æä¾›äº†å®è´µèŒƒå¼--å¦‚ä½•å°†å¤§æ¨¡å‹çš„â€œè„‘â€ä¸å°æ¨¡å‹çš„â€œèº«æ‰‹â€ç»“åˆï¼Œå¦‚ä½•åœ¨å¤æ‚å¤šç›®æ ‡ä»»åŠ¡ä¸­å®ç°ç¨³å®šé«˜æ•ˆçš„å­¦ä¹ ï¼Œè¿™å…¶ä¸­çš„æ€æƒ³å€¼å¾—å¹¿æ³›å€Ÿé‰´ã€‚</p>
<p>è®ºæ–‡åŸæ–‡ï¼šOxygenREC: An Instruction-Following Generative Framework for E-commerce Recommendation</p>
<p>è®­ç»ƒæ¡†æ¶ï¼š Oxygen 9N-LLMç”Ÿæˆå¼æ¨èè®­ç»ƒ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸‡å­—é•¿æ–‡ï¼å¸¦ä½ ä¸€å£æ°”ææ‡‚åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§æ¨¡å‹å’Œé€»è¾‘æ—¶é’Ÿ]]></title>    <link>https://juejin.cn/post/7599970244787667007</link>    <guid>https://juejin.cn/post/7599970244787667007</guid>    <pubDate>2026-01-28T07:21:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599970244787667007" data-draft-id="7598699872553025572" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸‡å­—é•¿æ–‡ï¼å¸¦ä½ ä¸€å£æ°”ææ‡‚åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§æ¨¡å‹å’Œé€»è¾‘æ—¶é’Ÿ"/> <meta itemprop="keywords" content="åˆ†å¸ƒå¼,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-28T07:21:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‡‰å‡‰çš„çŸ¥è¯†åº“"/> <meta itemprop="url" content="https://juejin.cn/user/3280598428311326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸‡å­—é•¿æ–‡ï¼å¸¦ä½ ä¸€å£æ°”ææ‡‚åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§æ¨¡å‹å’Œé€»è¾‘æ—¶é’Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598428311326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‡‰å‡‰çš„çŸ¥è¯†åº“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T07:21:14.000Z" title="Wed Jan 28 2026 07:21:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74d799411e4f4ce18e53458626fffdf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=V8ikmQjgeejq%2Bw4AEVGs6Zuf2nE%3D" alt="" loading="lazy"/></p>

























<table><thead><tr><th>ç­‰çº§</th><th>å…·ä½“ç»†åˆ†ç­‰çº§</th></tr></thead><tbody><tr><td>å¼ºä¸€è‡´æ€§</td><td>çº¿æ€§ä¸€è‡´æ€§(Linearizability consistency)</td></tr><tr><td>å¼ºä¸€è‡´æ€§</td><td>é¡ºåºä¸€è‡´æ€§(Sequential consistency)</td></tr><tr><td>å¼±ä¸€è‡´æ€§</td><td>å› æœä¸€è‡´æ€§ (Causal consistency)</td></tr><tr><td>å¼±ä¸€è‡´æ€§</td><td>æœ€ç»ˆä¸€è‡´æ€§ (Eventual consistency)</td></tr></tbody></table>
<h2 data-id="heading-0">çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizable Consistencyï¼‰</h2>
<p>çº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰ï¼Œåˆç§°åŸå­ä¸€è‡´æ€§ï¼ˆAtomic Consistencyï¼‰ã€ä¸¥æ ¼ä¸€è‡´æ€§ï¼ˆStrict Consistencyï¼‰æˆ–å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼‰ï¼Œæ˜¯å¹¶å‘ç³»ç»Ÿå’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å…³äºå•ä¸ªå¯¹è±¡æ“ä½œæ­£ç¡®æ€§çš„æ ¸å¿ƒæ¨¡å‹ã€‚</p>
<p>å…¶æ ¸å¿ƒç›®æ ‡æ˜¯è®©ä¸€ä¸ªå¤šå‰¯æœ¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåœ¨å¤–éƒ¨è§‚å¯Ÿèµ·æ¥ï¼Œè¡¨ç°å¾—å°±åƒåªæœ‰ä¸€ä¸ªæ•°æ®å‰¯æœ¬ä¸€æ ·ï¼Œä¸”æ¯ä¸ªæ“ä½œéƒ½æ˜¯æ“ä½œéƒ½å¿…é¡»æ˜¯ â€œç¬æ—¶â€ ç”Ÿæ•ˆä¸” â€œåŸå­â€ çš„ï¼ˆå­˜åœ¨å¯çº¿æ€§åŒ–ç‚¹ï¼‰ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹çœ‹åˆ°çš„å…¨å±€æ“ä½œé¡ºåºå’ŒçœŸå®ä¸–ç•Œçš„å‘ç”Ÿæ—¶é—´é¡ºåºä¸€è‡´ã€‚</p>
<blockquote>
<p>å¯çº¿æ€§åŒ–ç‚¹ï¼ˆLinearization Pointï¼‰ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œåœ¨å…¶è°ƒç”¨å¼€å§‹å’Œå“åº”è¿”å›ä¹‹é—´çš„æŸä¸ªæ—¶é—´ç‚¹â€œç¬é—´ç”Ÿæ•ˆâ€ã€‚åœ¨è¿™ä¸ªç‚¹ä¹‹å‰ï¼Œæ“ä½œçš„æ•ˆæœå¯¹ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†ä¸å¯è§ï¼›åœ¨è¿™ä¸ªç‚¹ä¹‹åï¼Œæ“ä½œçš„æ•ˆæœå¯¹æ‰€æœ‰åç»­æ“ä½œç«‹å³å¯è§ã€‚å¯ä»¥å°†å…¶æƒ³è±¡ä¸ºæ“ä½œè¢«æäº¤åˆ°å…¨å±€æ—¶é—´çº¿ä¸Šçš„ä¸€ä¸ªä¸å¯åˆ†å‰²çš„ç‚¹</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a991f64a94747ab8678292a472c1849~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=LPhlOk6uSUx%2B0jpwjjadJHTAx2c%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">å®ç°è·¯å¾„</h3>
<ul>
<li>å•ä¸»å¤åˆ¶ï¼šä»ä¸»èŠ‚ç‚¹æˆ–è€…åŒæ­¥æ›´æ–°çš„ä»èŠ‚ç‚¹ä¸Šè¯»å–ï¼Œå¯èƒ½æ»¡è¶³</li>
<li>å…±è¯†ç®—æ³• ï¼šå¦‚ Raft, Paxosã€‚åœ¨ä»‹ç»å®Œé¡ºåºä¸€è‡´æ€§åï¼Œæˆ‘ä»¬ä¼šåŒæ—¶è¯¦ç»†ä»‹ç»å…±è¯†</li>
<li>åŸºäºæ—¶é’Ÿçš„åè®®ï¼šGoogle Spanner åˆ©ç”¨å…·æœ‰æœ‰ç•Œè¯¯å·®çš„å…¨å±€æ—¶é’Ÿï¼ˆTrueTime APIï¼‰ä¸ºäº‹åŠ¡åˆ†é…æ—¶é—´æˆ³ï¼Œå¹¶é€šè¿‡ç­‰å¾…è¯¯å·®æ—¶é—´ï¼ˆCommit Waitï¼‰æ¥ä¿è¯æ“ä½œçš„å…¨å±€é¡ºåº</li>
</ul>
<h2 data-id="heading-2">é¡ºåºä¸€è‡´æ€§ï¼ˆSequential Consistencyï¼‰</h2>
<p>é¡ºåºä¸€è‡´æ€§æ˜¯ Lamportï¼ˆ1979ï¼‰åœ¨è§£å†³å¤šå¤„ç†å™¨ç³»ç»Ÿå…±äº«å­˜å‚¨å™¨æ—¶é¦–æ¬¡æå‡ºæ¥çš„</p>
<ol>
<li>ä»»ä½•ä¸€æ¬¡è¯»å†™æ“ä½œéƒ½æ˜¯æŒ‰ç…§æŸç§ç‰¹å®šçš„é¡ºåº</li>
<li>æ‰€æœ‰è¿›ç¨‹çœ‹åˆ°çš„è¯»å†™æ“ä½œé¡ºåºéƒ½ä¿æŒä¸€è‡´</li>
</ol>
<p>é‚£ä¹ˆçº¿æ€§ä¸€è‡´æ€§å’Œé¡ºåºä¸€è‡´æ€§çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿé¡ºåºä¸€è‡´æ€§è™½ç„¶é€šè¿‡é€»è¾‘æ—¶é’Ÿä¿è¯æ‰€æœ‰è¿›ç¨‹ä¿æŒä¸€è‡´çš„è¯»å†™æ“ä½œé¡ºåºï¼Œä½†è¿™äº›è¯»å†™æ“ä½œçš„é¡ºåºè·Ÿå®é™…ä¸Šå‘ç”Ÿçš„é¡ºåºå¹¶ä¸ä¸€å®šä¸€è‡´ã€‚è€Œçº¿æ€§ä¸€è‡´æ€§æ˜¯ä¸¥æ ¼ä¿è¯è·Ÿå®é™…å‘ç”Ÿçš„é¡ºåºä¸€è‡´çš„ã€‚</p>
<h3 data-id="heading-3">ååºå’Œå…¨åº</h3>
<p>ç®€å•çš„è¯´ï¼Œååºçš„æ„æ€æ˜¯è¯´é›†åˆä¸­çš„å…ƒç´ æ˜¯éƒ¨åˆ†æœ‰åºçš„ï¼Œè€Œå…¨åºçš„æ„æ€æ˜¯é›†åˆä¸­ä»»æ„ä¸€å¯¹å…ƒç´ éƒ½æ˜¯å¯ä»¥ç›¸äº’æ¯”è¾ƒçš„ï¼Œå¯ä»¥å®Œå…¨æ’åºã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ ï¼š</p>
<ul>
<li>è‡ªç„¶æ•°çš„é›†åˆæ˜¯å…¨åº</li>
<li>æ•´æ•°çš„é›†åˆæ˜¯å…¨åº</li>
<li>å¤æ•°çš„é›†åˆæ˜¯ååºï¼Œ1å’Œ100iæ˜¯æ— æ³•æ¯”è¾ƒçš„ï¼Œæ²¡æœ‰æ„ä¹‰</li>
</ul>
<h3 data-id="heading-4">Lamport é€»è¾‘æ—¶é’Ÿ</h3>
<p>æ—¢ç„¶ç‰©ç†æ—¶é’Ÿä¸å¯é ï¼Œé‚£å°±äººä¸ºæ„é€ ä¸€ä¸ªé€’å¢çš„åºåˆ—æ¥ä¸ºäº‹ä»¶æ’åºï¼Œè¿™å°±æ˜¯Lamporté€»è¾‘æ—¶é’Ÿçš„åŸºæœ¬æ€æƒ³ã€‚</p>
<p><strong>Happens-Before å…³ç³»ï¼š</strong></p>
<p>Lamporté€»è¾‘æ—¶é’Ÿçš„åŸºçŸ³æ˜¯ â€œhappens-beforeâ€å…³ç³»ï¼ˆè®°ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼‰ï¼Œå®ƒå®šä¹‰äº†äº‹ä»¶çš„ååºå…³ç³»ï¼Œå…¶è§„åˆ™å¦‚ä¸‹ ï¼š</p>
<ul>
<li>åŒä¸€è¿›ç¨‹å†…éƒ¨ï¼šå¦‚æœäº‹ä»¶aå’Œbåœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…å‘ç”Ÿï¼Œä¸”aåœ¨bä¹‹å‰æ‰§è¡Œï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex"> a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li>è·¨è¿›ç¨‹æ¶ˆæ¯ä¼ é€’ï¼šå¦‚æœäº‹ä»¶aæ˜¯è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>å‘é€ä¸€æ¡æ¶ˆæ¯çš„äº‹ä»¶ï¼Œè€Œäº‹ä»¶bæ˜¯å¦ä¸€ä¸ªè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>æ¥æ”¶è¿™æ¡æ¶ˆæ¯çš„äº‹ä»¶ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex"> a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li>ä¼ é€’æ€§ï¼šå¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> ä¸” <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>â†’</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">b â†’ c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span>ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a â†’ c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span></li>
</ul>
<p>å¦‚æœä¸¤ä¸ªäº‹ä»¶ä¹‹é—´æ— æ³•æ ¹æ®ä»¥ä¸Šè§„åˆ™å»ºç«‹ happens-before å…³ç³»ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªäº‹ä»¶æ˜¯å¹¶å‘çš„ï¼ˆconcurrentï¼‰</p>
<p><strong>é€»è¾‘æ—¶é’Ÿçš„æ›´æ–°è§„åˆ™ï¼š</strong></p>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯ä¸ªè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ä¿å­˜ä¸€ä¸ªæœ¬åœ°é€»è¾‘æ—¶é’Ÿå€¼<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C_i(a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span></span></span> è¡¨ç¤ºè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>å‘ç”Ÿäº‹ä»¶aæ—¶çš„é€»è¾‘æ—¶é’Ÿå€¼ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>çš„æ›´æ–°ç®—æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>æ¯å‘ç”Ÿä¸€æ¬¡äº‹ä»¶ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>åŠ 1ã€‚</li>
<li>è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ç»™è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>å‘é€æ¶ˆæ¯ï¼Œæœ¬åœ°æ‰§è¡Œä¸€ä¸ªäº‹ä»¶ï¼ˆå°† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> åŠ  1ï¼‰ï¼Œå°†è¿™ä¸ªæ–°çš„æ—¶é—´æˆ³åŒ…å«åœ¨æ¶ˆæ¯ä¸­ä¸€èµ·å‘é€å‡ºå»</li>
<li>è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>æ¥æ”¶æ¶ˆæ¯ï¼Œæ›´æ–°<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">C_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>C</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">max(C_i, C_j) + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ã€‚</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f1a53ec05e6443781372562f4db386d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=plXO5L%2FcrKP5RSDetn3el9d75gE%3D" alt="" loading="lazy"/></p>
<p>ä»ä»¥ä¸Šç®—æ³•å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—å‡ºä¸‹é¢ä¸¤ä¸ªç»“è®ºï¼š</p>
<ol>
<li>åŒä¸€ä¸ªè¿›ç¨‹å†…çš„ä¸¤ä¸ªäº‹ä»¶aå’Œbï¼Œå¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C_i(a)&lt;C_i(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></li>
<li>aæ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>è¿›ç¨‹çš„æ¶ˆæ¯å‘é€äº‹ä»¶ï¼Œbæ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>è¿›ç¨‹è¯¥æ¶ˆæ¯çš„æ¥æ”¶äº‹ä»¶ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C_i(a)&lt;C_j(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></li>
</ol>
<p>æ‰€ä»¥ï¼š<strong>å¯¹äºä»»æ„ä¸¤ä¸ªäº‹ä»¶aå’Œbï¼Œå¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></strong></p>
<p>ä½†åè¿‡æ¥<strong>å¦‚æœ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>ï¼Œç”±äºå¹¶å‘çš„å­˜åœ¨ï¼Œå¹¶ä¸èƒ½è¯´æ˜<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œåå‘çš„æ¨è®ºå¹¶ä¸æˆç«‹ã€‚ä¹Ÿå°±æ˜¯è¯´<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>æ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span> çš„å¿…è¦ä¸å……åˆ†æ¡ä»¶</strong></p>
<blockquote>
<p>Lamporté€»è¾‘æ—¶é’Ÿ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea4e0be074a429091f3468cc3cb6bef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=nfJxsLaX%2BDo9J18ROfaLns9vv18%3D" alt="" loading="lazy"/></p>
<p>æ•´ä¸ªäº‹ä»¶é›†åˆä¸­åªæœ‰å› æœå…³ç³»ï¼ˆè“è‰²éƒ¨åˆ†ï¼‰å¯ä»¥æ¯”è¾ƒå¤§å°ã€å¹¶å‘å…³ç³»ï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰çš„å¤§å°æ— æ„ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´Lamporté€»è¾‘æ—¶é’Ÿæ„é€ çš„æ˜¯ååºå…³ç³»</p>
<p>å¯¹äº<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>æ¥è¯´<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>ï¼Œä¹Ÿå°±æ˜¯è“è‰²éƒ¨åˆ†å…¨éƒ¨éƒ½æ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>ã€‚ä½†<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>å¯èƒ½æ˜¯å› æœå…³ç³»ï¼ˆè“è‰²éƒ¨åˆ†ï¼‰ä¹Ÿæœ‰å¯èƒ½æ˜¯å¹¶å‘å…³ç³»ï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>æ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>çš„å¿…è¦æ¡ä»¶</p>
</blockquote>
<h4 data-id="heading-5"><strong>å…¨åºäº‹ä»¶é›†</strong></h4>
<p>Lamporté€»è¾‘æ—¶é’Ÿç®—æ³•æ„é€ çš„æ•´ä¸ªäº‹ä»¶é›†åˆ (happened before â†’) æ˜¯ä¸€ç§ååºå…³ç³»ï¼Œæˆ‘ä»¬åŠ å…¥å¦å¤–ä¸€ä¸ªæ¡ä»¶ä¹Ÿå°±æ˜¯åˆ¤æ–­ä¸¤ä¸ªè¿›ç¨‹å·çš„å¤§å°ï¼ŒæŠŠLamporté€»è¾‘æ—¶é’Ÿä¸­ä¸èƒ½æ¯”è¾ƒå¤§å°çš„äº‹ä»¶å˜æˆå¯ä»¥æ¯”è¾ƒå¤§å°ï¼Œä»è€Œä½¿æ•´ä¸ªäº‹ä»¶é›†åˆå˜æˆä¸€ç§å…¨åºå…³ç³»</p>
<p>å®šä¹‰å…¨åºå…³ç³» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â‡’</mo></mrow><annotation encoding="application/x-tex">â‡’</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â‡’</span></span></span></span></span> å¦‚ä¸‹ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>è¿›ç¨‹çš„äº‹ä»¶aå’Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>è¿›ç¨‹çš„äº‹ä»¶bå¦‚æœæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªå…³ç³»ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™ç§° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â‡’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â‡’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ã€‚</p>
<ol>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C_i (a) &lt; C_j (b) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>ï¼ˆäº‹ä»¶açš„Lamportæ—¶é—´æˆ³å°äºäº‹ä»¶bçš„ï¼‰</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C_i (a) = C_j (b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span> å¹¶ä¸” <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_i &lt; P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></li>
</ol>
<p>å…¨åºå…³ç³» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â‡’</mo></mrow><annotation encoding="application/x-tex">â‡’</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â‡’</span></span></span></span></span> æŠŠååºå…³ç³» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">â†’</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span> å˜æˆäº†ä»»ä½•ä¸¤ä¸ªå…ƒç´ éƒ½å¯æ¯”è¾ƒçš„å…¨åºå…³ç³»ï¼Œè€Œä¸”æœ‰ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex"> a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â‡’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â‡’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eea18eae6acf4fe294e77a3cdca05ca7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=5AxXlE880FbLXNlk5mAATcB6WUE%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸ªå…¨åºå…³ç³»çš„å…³é”®åœ¨äºï¼Œå®ƒä¸ºç³»ç»Ÿä¸­ä»»ä½•ä¸¤ä¸ªäº‹ä»¶éƒ½å®šä¹‰äº†ä¸€ä¸ªæ˜ç¡®çš„å…ˆåé¡ºåºï¼Œå³ä½¿å®ƒä»¬æ˜¯å¹¶å‘çš„</p>
<ul>
<li>ä¸ååºå…³ç³»å…¼å®¹ï¼šè¿™ä¸ªå…¨åºå…³ç³»â€œæ‰©å±•â€äº†åŸæœ‰çš„ååºå…³ç³»ã€‚å¦‚æœäº‹ä»¶aåœ¨ååºä¸Šâ€œhappened beforeâ€äº‹ä»¶bï¼ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex"> a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼‰ï¼Œé‚£ä¹ˆåœ¨å…¨åºä¸­aä¹Ÿä¸€å®šåœ¨bä¹‹å‰ï¼ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â‡’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â‡’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼‰ã€‚å®ƒä¸ä¼šç ´åå·²æœ‰çš„å› æœå…³ç³»</li>
<li>é¡ºåºçš„ä»»æ„æ€§ï¼šç‰©ç†æ—¶é—´ä¸ŠçœŸæ­£å…ˆå‘ç”Ÿçš„äº‹ä»¶ï¼Œåœ¨å…¨åºä¸­å¯èƒ½ä¼šè¢«æ’åœ¨åå‘ç”Ÿçš„äº‹ä»¶ä¹‹åã€‚è¿™å¯èƒ½å¯¼è‡´<strong>ä¸å…¬å¹³</strong>ä½†æ­£ç¡®çš„ç»“æœ</li>
</ul>
<p>å†æ¬¡å¼ºè°ƒï¼šæ³¨æ„å…¨åºå…³ç³»åªæ˜¯æ˜ç¡®äº†å…ˆåé¡ºåºï¼Œæ˜¯ä¸èƒ½æè¿°äº‹ä»¶çš„å› æœå…³ç³»çš„ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>ä¸èƒ½æ¨å¯¼å‡º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex"> a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼ˆåªèƒ½æ¨å¯¼å‡º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â‡’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ‡’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼‰ï¼Œå³ä½¿çŸ¥é“äº†ä¸¤ä¸ªé€»è¾‘æ—¶é’Ÿå€¼ï¼Œä¹Ÿæ— æ³•åŒºåˆ†å› æœäº‹ä»¶å’Œå¹¶å‘äº‹ä»¶ï¼Œå› ä¸ºå…¨åºå…³ç³»å¯èƒ½å°†æœ¬æ— å› æœçš„å¹¶å‘äº‹ä»¶å¼ºåˆ¶æ’åºã€‚</p>
<h3 data-id="heading-6">å…¨åºå…³ç³»å¹¿æ’­</h3>
<p>æŠ›å¼€Lamportæ—¶é’Ÿæ¥èŠä¸€ä¸ªæ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼šå…¨åºå…³ç³»å¹¿æ’­</p>
<p>å…¨åºå…³ç³»å¹¿æ’­ï¼Œä¹Ÿè¢«ç§°ä¸ºåŸå­å¹¿æ’­ï¼ˆAtomic Broadcastï¼‰ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚æœå¤šä¸ªèŠ‚ç‚¹éœ€è¦è¾¾æˆä¸€è‡´ï¼Œä»…ä»…ä¿è¯æ¶ˆæ¯å‘åˆ°äº†æ˜¯ä¸å¤Ÿçš„ï¼Œæœ€éš¾çš„æ˜¯ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æ¥æ”¶æ¶ˆæ¯çš„é¡ºåºä¸€æ¨¡ä¸€æ ·</p>
<p>å…¨åºå¹¿æ’­å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ ¸å¿ƒæ€§è´¨ï¼š</p>
<ol>
<li>å¯é ä¼ é€’ï¼š å¦‚æœæ¶ˆæ¯è¢«å‘ç»™äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒæœ€ç»ˆå¿…é¡»è¢«æ‰€æœ‰æ­£å¸¸çš„èŠ‚ç‚¹æ¥æ”¶</li>
<li>å…¨åºå±æ€§ï¼š å¦‚æœèŠ‚ç‚¹ A å…ˆå¤„ç†æ¶ˆæ¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> å†å¤„ç† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">m_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­ä»»ä½•å…¶ä»–èŠ‚ç‚¹ä¹Ÿå¿…é¡»å…ˆå¤„ç† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> å†å¤„ç† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">m_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></li>
</ol>
<p>å…¨åºå¹¿æ’­ä¿è¯äº†æ‰€æœ‰èŠ‚ç‚¹ä»¥ç›¸åŒçš„é¡ºåºæ¥æ”¶æ¶ˆæ¯ï¼Œè¿™ç›´æ¥å¯¼è‡´äº†é¡ºåºä¸€è‡´æ€§ã€‚</p>
<p>åœ¨å…¨åºå¹¿æ’­çš„åŸºç¡€ä¸Šï¼Œå†åŠ ä¸Šã€Œè¯»æ“ä½œå¿…é¡»èƒ½çœ‹åˆ°æœ€æ–°çš„å†™ã€è¿™ä¸€çº¦æŸï¼ˆä¾‹å¦‚è¯»ä¹Ÿèµ°ä¸€æ¬¡å…±è¯†ï¼Œæˆ–è€…é€šè¿‡ Leader ç§Ÿçº¦ç¡®è®¤ï¼‰ï¼Œå‡çº§åˆ°äº†çº¿æ€§ä¸€è‡´æ€§</p>
<h4 data-id="heading-7">å¦‚ä½•å®ç°å…¨åºå¹¿æ’­ï¼Ÿ</h4>
<p>å®ç°å…¨åºå¹¿æ’­ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å¸¸è§ç­–ç•¥ï¼š</p>
<p>A. ä»¤ç‰Œä¼ é€’ (Token Passing)ã€‚ è°æ‹¿åˆ°ä»¤ç‰Œï¼Œè°å°±æœ‰æƒå†³å®šä¸‹ä¸€ä¸ªå…±è¯†å€¼ã€‚èŠ‚ç‚¹æ”¶åˆ°å¸¦åºå·çš„æ¶ˆæ¯åï¼Œç›´æ¥æŒ‰åºæŠ•é€’ã€‚å·¥ç¨‹æŒ‘æˆ˜ï¼šä»¤ç‰Œä¸¢å¤±ï¼Œ å¦‚æœæŒæœ‰ä»¤ç‰Œçš„èŠ‚ç‚¹çªç„¶å®•æœºï¼Œä»¤ç‰Œå°±æ¶ˆå¤±äº†ã€‚èŠ‚ç‚¹åŠ å…¥/é€€å‡ºï¼Œ é€»è¾‘ç¯çš„ç»´æŠ¤éå¸¸å¤æ‚ã€‚æ—©æœŸæœ‰ä¸€äº›åŸºäºä»¤ç‰Œçš„å®¹é”™åè®®ï¼ˆå¦‚ Totemï¼‰ï¼Œé€šè¿‡æå…¶å¤æ‚çš„é‡ç»„æœºåˆ¶æ¥æ‰¾å›ä¸¢å¤±çš„ä»¤ç‰Œï¼Œä½†åœ¨ç°ä»£å¤§è§„æ¨¡é›†ç¾¤ä¸­å‡ ä¹è§ä¸åˆ°äº†</p>
<p>B. åŸºäºé€šä¿¡å†å²/é€»è¾‘æ—¶é’Ÿ (Communication History / Logical Clocks)ã€‚ä¸éœ€è¦ Leaderï¼Œæ¯ä¸ªèŠ‚ç‚¹æ ¹æ®è‡ªå·±çš„é€»è¾‘æ—¶é’Ÿç»™ææ¡ˆæ‰“åˆ†ï¼Œé€šè¿‡ä¸¤è½®äº¤äº’å–æœ€å¤§å€¼ä½œä¸ºæœ€ç»ˆåºå·</p>
<p>C. åŸºäºå®šåºå™¨ (Sequencer-based)ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”±Leader ç»™æ¯ä¸ªæ¶ˆæ¯åˆ†é…ä¸€ä¸ªå…¨å±€é€’å¢çš„åºåˆ—å·ã€‚ä¼˜ç‚¹ï¼š ç®€å•ï¼Œå»¶è¿Ÿä½ã€‚å·¥ç¨‹æŒ‘æˆ˜ï¼š Leaderæ˜¯å•ç‚¹æ•…éšœï¼Œæ‰€ä»¥å¦‚æœ Leader æŒ‚äº†ï¼Œéœ€è¦å¤æ‚çš„é€‰ä¸¾æœºåˆ¶æ¥é€‰æ–° Leader å¹¶æ¢å¤æ•°æ®ã€‚è¿™ä¹Ÿæ˜¯Raft/Paxosçš„å®ç°ç­–ç•¥</p>
<p>è™½ç„¶åœ¨åˆ†å¸ƒå¼ç†è®ºè¯¾ä¸Šï¼ŒLamport æ—¶é’Ÿç»å¸¸è¢«ç”¨æ¥æ¼”ç¤ºå¦‚ä½•å®ç°å…¨åºï¼Œä½†åœ¨é«˜æ€§èƒ½çš„å·¥ä¸šçº§åˆ†å¸ƒå¼åè°ƒç³»ç»Ÿä¸­ï¼Œå®ƒä»¬è¢«è®¤ä¸ºå¤ªå¼±æˆ–å¤ªé‡äº†ã€‚å·¥ç¨‹ä¸Šæ›´åçˆ±åŸºäºå®šåºå™¨çš„å…±è¯†ã€‚ZooKeeperå’Œetcdä½¿ç”¨äº†æ›´å¼ºåŠ›ã€æ›´ç›´æ¥çš„æœºåˆ¶ï¼šåŸºäºé¢†å¯¼è€…çš„å®šåºå™¨ï¼ˆLeader-based Sequencerï¼‰ï¼Œé…åˆé€»è¾‘åºåˆ—å·æ¥å®ç°å…¨åºï¼Œåœ¨å®šåºå™¨çš„åŸºç¡€ä¸Šå¢åŠ äº†é€‰ä¸¾é€»è¾‘å’Œæ—¥å¿—æ¢å¤é€»è¾‘</p>
<h4 data-id="heading-8">å…±è¯†</h4>
<p>åœ¨åˆ†å¸ƒå¼ç†è®ºä¸­ï¼Œå…¨åºå¹¿æ’­å’Œå…±è¯†(Consensus) æ˜¯ç­‰ä»·çš„é—®é¢˜ã€‚ä»»ä½•èƒ½å®ç°å…¨åºå¹¿æ’­çš„æœºåˆ¶ï¼Œåœ¨æ•°å­¦ä¸Šéƒ½èƒ½æ¨å¯¼å‡ºå…±è¯†ã€‚</p>
<ul>
<li>å…±è¯†æ˜¯è®©èŠ‚ç‚¹å°±â€œæŸä¸€ä¸ªå€¼â€è¾¾æˆä¸€è‡´</li>
<li>å…¨åºå…³ç³»å¹¿æ’­å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç³»åˆ—çš„å…±è¯†å®ä¾‹ï¼šèŠ‚ç‚¹ä»¬éœ€è¦å¯¹â€œç¬¬1æ¡æ¶ˆæ¯æ˜¯ä»€ä¹ˆâ€ã€â€œç¬¬2æ¡æ¶ˆæ¯æ˜¯ä»€ä¹ˆâ€â€¦â€¦è¾¾æˆä¸€è‡´</li>
</ul>
<p>å¦‚æœä½ è§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œä½ å°±è‡ªåŠ¨è§£å†³äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚ç°ä»£çš„è®¸å¤šå…±è¯†ç®—æ³•ï¼ˆå¦‚ Paxos, Raft, ZABï¼‰æœ¬è´¨ä¸Šå°±æ˜¯åœ¨å®ç°å…¨åºå¹¿æ’­ï¼ˆé€šå¸¸é€šè¿‡å¤åˆ¶æ—¥å¿— Log Replication çš„å½¢å¼ï¼‰</p>
<p>ZooKeeperå’Œetcdé€šè¿‡å„è‡ªçš„å…±è¯†åè®®çš„å®ç°äº†çº¿æ€§ä¸€è‡´æ€§çš„å†™æ“ä½œã€‚å…±è¯†åè®®ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æœ€ç»ˆéƒ½ä¼šæŒ‰ç›¸åŒçš„é¡ºåºè¾¾åˆ°ç›¸åŒçš„çŠ¶æ€ï¼Œä½†ç”±äºç½‘ç»œå»¶è¿Ÿï¼ŒFollowerå¯èƒ½è¿˜æ²¡æ”¶åˆ°æœ€æ–°çš„æ—¥å¿—ï¼Œå®¢æˆ·ç«¯è¯»å–åˆ°æ—§æ•°æ®ï¼Œæ‰€ä»¥ç³»ç»Ÿåªä¿è¯äº†é¡ºåºä¸€è‡´æ€§è¯»ã€‚ä¸ºäº†è¾¾åˆ°çº¿æ€§ä¸€è‡´æ€§è¯»ï¼Œetcd å’Œ ZooKeeper å¿…é¡»é‡‡å–ç‰¹æ®Šæ‰‹æ®µï¼š</p>
<ol>
<li>Read Index / Lease Read (etcd/Raft)ï¼šè¯»è¯·æ±‚å¿…é¡»è¯¢é—® Leaderã€‚Leader ä¼šç¡®è®¤è‡ªå·±æ˜¯å¦è¿˜æ˜¯åˆæ³•çš„é¢†å¯¼è€…ï¼Œå¹¶ç¡®ä¿è¯»åˆ°çš„æ•°æ®ä¸æ—©äºå½“å‰çš„ Commit Index</li>
<li>Sync + Read (ZooKeeper)ï¼šZooKeeper é»˜è®¤æä¾›çš„æ˜¯â€œå•è°ƒå†™â€å’Œâ€œé¡ºåºè¯»â€ã€‚ä½†å¦‚æœä½ åœ¨è¯»ä¹‹å‰è°ƒç”¨ <code>sync()</code> æ¥å£ï¼Œå®ƒä¼šå¼ºåˆ¶åŒæ­¥è¿›åº¦ï¼Œä»è€Œé€¼è¿‘çº¿æ€§ä¸€è‡´æ€§</li>
</ol>
<h2 data-id="heading-9">å› æœä¸€è‡´æ€§ï¼ˆCausal Consistencyï¼‰</h2>
<p>å› æœä¸€è‡´æ€§æ˜¯ä¸€ç§å¼±åŒ–çš„é¡ºåºä¸€è‡´æ€§æ¨¡å‹ï¼Œå®ƒæ—¨åœ¨ä¿è¯æ“ä½œä¹‹é—´å› æœå…³ç³»çš„æ­£ç¡®é¡ºåºï¼ŒåŒæ—¶å…è®¸æ— å› æœå…³ç³»çš„å¹¶å‘æ“ä½œä»¥ä¸åŒé¡ºåºè¢«è§‚å¯Ÿåˆ°ï¼Œä»è€Œåœ¨å¼ºä¸€è‡´æ€§çš„ä¸¥æ ¼æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§çš„å®½æ¾æ€§ä¹‹é—´å–å¾—äº†è‰¯å¥½çš„å¹³è¡¡</p>
<p>å› æœä¸€è‡´æ€§çš„æ¡ä»¶åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ‰€æœ‰è¿›ç¨‹å¿…é¡»ä»¥ç›¸åŒçš„é¡ºåºçœ‹åˆ°å…·æœ‰å› æœå…³ç³»çš„è¯»å†™æ“ä½œ</li>
<li>ä¸åŒè¿›ç¨‹å¯ä»¥ä»¥ä¸åŒçš„é¡ºåºçœ‹åˆ°å¹¶å‘çš„è¯»å†™æ“ä½œ</li>
</ol>
<p>é¡ºåºä¸€è‡´æ€§è™½ç„¶ä¸ä¿è¯äº‹ä»¶å‘ç”Ÿçš„é¡ºåºè·Ÿå®é™…å‘ç”Ÿçš„ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿä¿è¯æ‰€æœ‰è¿›ç¨‹çœ‹åˆ°çš„è¯»å†™æ“ä½œé¡ºåºæ˜¯ä¸€æ ·çš„ã€‚è€Œå› æœä¸€è‡´æ€§æ›´è¿›ä¸€æ­¥å¼±åŒ–äº†é¡ºåºä¸€è‡´æ€§ä¸­å¯¹è¯»å†™æ“ä½œé¡ºåºçš„çº¦æŸï¼Œä»…ä¿è¯æœ‰å› æœå…³ç³»çš„è¯»å†™æ“ä½œæœ‰åºï¼Œæ²¡æœ‰å› æœå…³ç³»çš„è¯»å†™æ“ä½œï¼ˆå¹¶å‘äº‹ä»¶ï¼‰åˆ™ä¸åšä¿è¯ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯æ— å› æœå…³ç³»çš„æ•°æ®æ“ä½œä¸åŒè¿›ç¨‹çœ‹åˆ°çš„å€¼æ˜¯æœ‰å¯èƒ½æ˜¯ä¸ä¸€æ ·ï¼Œè€Œæœ‰å› æœå…³ç³»çš„æ•°æ®æ“ä½œä¸åŒè¿›ç¨‹çœ‹åˆ°çš„å€¼ä¿è¯æ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 data-id="heading-10">å‘é‡æ—¶é’Ÿ</h3>
<p>å®ç°å› æœä¸€è‡´æ€§çš„æ ¸å¿ƒæŠ€æœ¯æ˜¯å‘é‡æ—¶é’Ÿ (Vector Clock)ã€‚å‘é‡æ—¶é’Ÿæ˜¯1988å¹´ç”±Colin Fidgeå’ŒFriedemann Matternæå‡ºçš„ï¼Œæ¯”Lamportæå‡ºé€»è¾‘æ—¶é’Ÿæ™šäº†åˆšå¥½åå¹´ã€‚</p>
<p>Lamporté€»è¾‘æ—¶é’Ÿå­˜åœ¨çš„é—®é¢˜æ˜¯ä¸èƒ½æè¿°äº‹ä»¶çš„å› æœå…³ç³»ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(a) &lt; C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>ä¸èƒ½æ¨å¯¼å‡º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex"> a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œè¿™æ ·å¯¼è‡´å³ä½¿çŸ¥é“äº†ä¸¤ä¸ªé€»è¾‘æ—¶é’Ÿå€¼ï¼Œä½†å´ä¸èƒ½ç¡®å®šè¿™ä¸¤ä¸ªäº‹ä»¶çš„å› æœå…³ç³»ã€‚</p>
<p>å‘é‡æ—¶é’Ÿå¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå®ƒçš„æ€æƒ³æ˜¯è¿›ç¨‹é—´é€šä¿¡çš„æ—¶å€™ï¼Œä¸å…‰åŒæ­¥æœ¬è¿›ç¨‹çš„æ—¶é’Ÿå€¼ï¼Œè¿˜åŒæ­¥è‡ªå·±çŸ¥é“çš„å…¶ä»–è¿›ç¨‹çš„æ—¶é’Ÿå€¼ã€‚</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>å‘é‡æ—¶é’Ÿ</th><th>Lamport é€»è¾‘æ—¶é’Ÿ</th></tr></thead><tbody><tr><td>æ ¸å¿ƒæ€æƒ³</td><td>æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªå‘é‡ï¼Œè®°å½•æ‰€æœ‰èŠ‚ç‚¹å·²çŸ¥çš„äº‹ä»¶è®¡æ•°</td><td>æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªå•ä¸€çš„ã€å…¨å±€é€’å¢çš„è®¡æ•°å™¨</td></tr><tr><td>æ—¶åºä¿¡æ¯</td><td>å¤šç»´å‘é‡ï¼Œè®°å½•éƒ¨åˆ†æ—¶åºä¿¡æ¯</td><td>å•ä¸€æ—¶é’Ÿå€¼ï¼Œå»ºç«‹å…¨åºå…³ç³»</td></tr><tr><td>å› æœå…³ç³»åˆ¤æ–­</td><td>å……åˆ†å¿…è¦æ¡ä»¶ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi><mo>â‡”</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">aâ†’b â‡” VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡”</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></td><td>å¿…è¦æ¡ä»¶ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi><mo>â‡’</mo><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">aâ†’b \Rightarrow C(a)&lt;C(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></td></tr><tr><td>å¹¶å‘äº‹ä»¶è¯†åˆ«</td><td>å¯ä»¥ç²¾ç¡®è¯†åˆ«ã€‚å¦‚æœä¸¤ä¸ªå‘é‡æ—¶é’Ÿä¸å¯æ¯”è¾ƒï¼Œåˆ™äº‹ä»¶å¹¶å‘</td><td>æ— æ³•å‡†ç¡®è¯†åˆ«ã€‚æ—¶é’Ÿå€¼å¤§å°ä¸èƒ½ç¡®å®šäº‹ä»¶æ˜¯å› æœè¿˜æ˜¯å¹¶å‘</td></tr></tbody></table>
<h4 data-id="heading-11">å‘é‡æ—¶é’Ÿç®—æ³•</h4>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯ä¸ªè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ä¿å­˜ä¸€ä¸ªæœ¬åœ°é€»è¾‘æ—¶é’Ÿå‘é‡å€¼<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">VC_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼Œå‘é‡çš„é•¿åº¦æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¿›ç¨‹çš„æ€»ä¸ªæ•°ã€‚<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_i [k]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">]</span></span></span></span></span> è¡¨ç¤ºè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>çŸ¥é“çš„è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">P_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>çš„æœ¬åœ°é€»è¾‘æ—¶é’Ÿå€¼ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">VC_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>çš„æ›´æ–°ç®—æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>åˆå§‹åŒ–ï¼šåˆå§‹åŒ–<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">VC_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>çš„å€¼å…¨ä¸º0ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_i = [0, â€¦ , 0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span>ã€‚ä¾‹å¦‚ï¼Œå¯¹äºèŠ‚ç‚¹ Aã€Bã€Cï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>A</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_A = [0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span>ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>B</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_B = [0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span>ï¼Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>C</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_C = [0,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p>
</li>
<li>
<p>æœ¬åœ°äº‹ä»¶å‘ç”Ÿï¼šè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>æ¯å‘ç”Ÿä¸€æ¬¡äº‹ä»¶ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_i[i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span></span>åŠ 1ã€‚ä¾‹å¦‚ï¼ŒAå‘ç”Ÿäº‹ä»¶ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>A</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_A = [1,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p>
</li>
<li>
<p>å‘é€æ¶ˆæ¯ï¼šè¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ç»™è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>å‘é€æ¶ˆæ¯ï¼Œå®ƒé¦–å…ˆä¼šæ‰§è¡Œä¸Šä¸€æ­¥ï¼ˆé€’å¢è‡ªå·±çš„åˆ†é‡ï¼‰ï¼Œç„¶åå°†è‡ªå·±çš„æ•´ä¸ªå‘é‡æ—¶é’Ÿ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">VC_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>é™„åŠ åˆ°æ¶ˆæ¯ä¸­ä¸€å¹¶å‘é€å‡ºå»ã€‚ä¾‹å¦‚ï¼ŒAå‘é€æ¶ˆæ¯ç»™Bï¼Œå…ˆåŠ è‡ªå·±çš„å‘é‡[2,0,0]ï¼Œç„¶åå‘é€å‡ºå»</p>
</li>
<li>
<p>è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>æ¥æ”¶æ¶ˆæ¯ï¼Œéœ€è¦åšä¸¤æ­¥æ“ä½œ</p>
<p>4.1 å¯¹äº<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>å‘é‡ä¸­çš„æ¯ä¸ªå€¼<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_j[k]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">]</span></span></span></span></span>ï¼Œæ›´æ–°ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">[</mo><mi>k</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC_j[k] = max(VC_j[k], VC_i[k])</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">])</span></span></span></span></span>ï¼Œè¿™ä¸€æ­¥æ˜¯ä¸ºäº†è·å–è¿›ç¨‹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>ç›®å‰æ‰€çŸ¥çš„æ‰€æœ‰è¿›ç¨‹çš„æœ€æ–°äº‹ä»¶è®¡æ•°ã€‚æ‰€ä»¥<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>B</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_B = [2,0,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p>
<p>4.2 å°†<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>ä¸­è‡ªå·±å¯¹åº”çš„æ—¶é’Ÿå€¼åŠ 1ï¼Œå³<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_j[j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span></span>åŠ 1ï¼Œè¡¨ç¤ºå¤„ç†äº†ä¸€æ¬¡æ¥æ”¶äº‹ä»¶ã€‚æ­¤æ—¶<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>B</mi></msub><mo>=</mo><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">VC_B = [2,1,0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">0</span><span class="mclose">]</span></span></span></span></span></p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/004c7c4ce93a457aa5727a92817f9a9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=sfIBsN9Oz2wlBks9T2ksYOaL5G4%3D" alt="" loading="lazy"/></p>
<p>å®šä¹‰å‘é‡æ—¶é’Ÿä¹‹é—´çš„å¤§å°å…³ç³»</p>
<ul>
<li>å¦‚æœæ‰€æœ‰åˆ†é‡éƒ½ç›¸ç­‰å®šä¹‰ä¸º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_i = VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">VC_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> ä¸­æ¯ä¸€ä¸ªåˆ†é‡éƒ½å°äºæˆ–ç­‰äº<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>ä¸­å¯¹åº”çš„åˆ†é‡ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªåˆ†é‡æ˜¯ä¸¥æ ¼å°äºçš„ï¼Œåˆ™è®¤ä¸º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo>&lt;</mo><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_i &lt; VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></li>
<li>å¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> ä¸­æ¯ä¸€ä¸ªåˆ†é‡éƒ½å¤§äºæˆ–ç­‰äº <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> ä¸­å¯¹åº”çš„åˆ†é‡ï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªåˆ†é‡æ˜¯ä¸¥æ ¼å¤§äºçš„ï¼Œåˆ™è®¤ä¸º<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo>&gt;</mo><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_i &gt; VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></li>
<li>å¦‚æœä¸¤ä¸ªå‘é‡ä¸­å­˜åœ¨ä¸€äº›åˆ†é‡ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å¤§ï¼Œå¦ä¸€äº›åˆ†é‡ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å¤§ï¼ˆå³æ— æ³•ç”¨ä¸Šè¿°å¤§å°å…³ç³»æ¯”è¾ƒï¼‰ã€‚è¿™è¡¨ç¤ºè¿™ä¸¤ä¸ªäº‹ä»¶æ˜¯å¹¶å‘çš„ï¼Œè®°ä½œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo>âˆ¥</mo><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">VC_i \parallel VC_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">âˆ¥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥å¾—å‡ºè¿™æ ·çš„ç»“è®ºï¼š</p>
<ul>
<li>
<p>å‘é‡æ—¶é’Ÿä¹‹é—´çš„å¤§å°å…³ç³»æ˜¯ä¸€ç§ååºå…³ç³»</p>
</li>
<li>
<p>å‘é‡æœ‰åºï¼Œåˆ™äº‹ä»¶æœ‰åºï¼ˆå……è¦ï¼‰:<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo><mo>â‡”</mo><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)â‡”aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡”</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></p>
</li>
<li>
<p>å‘é‡å¹³è¡Œï¼Œåˆ™äº‹ä»¶å¹¶å‘ï¼ˆå……è¦ï¼‰:<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>âˆ¥</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo><mo>â‡”</mo><mi>a</mi><mo>âˆ¥</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">VC(a) \parallel VC(b)â‡”a \parallel b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">âˆ¥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡”</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">âˆ¥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></p>
</li>
</ul>
<blockquote>
<p>ä»¥ä¸‹æ˜¯å‘é‡æœ‰åºæ˜¯äº‹ä»¶æœ‰åºå¾—å……åˆ†å¿…è¦æ¡ä»¶è¯æ˜è¿‡ç¨‹</p>
<p>è¯æ˜1: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi><mo>â‡’</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">aâ†’b \Rightarrow VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></p>
<ol>
<li>åŒä¸€ä¸ªè¿›ç¨‹å†…çš„ä¸¤ä¸ªäº‹ä»¶aå’Œbï¼Œå¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a â†’ b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC_i (a) &lt; VC_i (b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></li>
<li>aæ˜¯Piè¿›ç¨‹çš„æ¶ˆæ¯å‘é€äº‹ä»¶ï¼Œbæ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>è¿›ç¨‹çš„æ¶ˆæ¯æ¥æ”¶äº‹ä»¶ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><msub><mi>C</mi><mi>j</mi></msub><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC_i(a)&lt;VC_j(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></li>
</ol>
<p>æ‰€ä»¥å¯¹äºä»»æ„ä¸¤ä¸ªäº‹ä»¶aå’Œbï¼Œå¦‚æœ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></p>
<p>è¯æ˜2: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo><mo>â‡’</mo><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)â‡’aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></p>
<ol>
<li>
<p>å¦‚æœ aå’Œbä¸¤ä¸ªäº‹ä»¶å¤„åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ˜¾è€Œæ˜“è§ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></p>
</li>
<li>
<p>å¦‚æœ aå’Œbä¸¤ä¸ªäº‹ä»¶å¤„åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¸­ï¼Œä¸€å®šåªèƒ½æ˜¯ä»¥ä¸‹å‡ ç§æƒ…å†µï¼Œå…¨éƒ¨éƒ½æ˜¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2e25bc3e666488aa3c0d180b2ac6174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=XgXFuWVywD83DZ3Kxpw1k43lVyA%3D" alt="" loading="lazy"/></p>
</blockquote>
<blockquote>
<p>å‘é‡æ—¶é’Ÿ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71adfd4a57bd42d39143beea84282575~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=Cx%2FSU1ZULYZ9eW19QJpmAhqSnnw%3D" alt="" loading="lazy"/></p>
<p>æ•´ä¸ªäº‹ä»¶é›†åˆä¸­åªæœ‰å› æœå…³ç³»ï¼ˆè“è‰²éƒ¨åˆ†ï¼‰å¯ä»¥æ¯”è¾ƒå¤§å°ã€å¹¶å‘å…³ç³»ï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰çš„å¤§å°æ— æ³•æ¯”è¾ƒï¼Œæ‰€ä»¥æˆ‘ä»¬è¯´å‘é‡æ—¶é’Ÿæ„é€ çš„æ˜¯ååºå…³ç³»</p>
<p>å¯¹äº<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>æ¥è¯´<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span> ä¸€å®š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ï¼Œå³<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>åªä½äºè“è‰²éƒ¨åˆ†ï¼Œçº¢è‰²éƒ¨åˆ†çš„å¤§å°æ— æ³•æ¯”è¾ƒã€‚æ‰€ä»¥æˆ‘ä»¬è¯´<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC(a)&lt;VC(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>æ˜¯<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>â†’</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">aâ†’b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>çš„å……åˆ†å¿…è¦æ¡ä»¶</p>
</blockquote>
<h4 data-id="heading-12">å‘é‡æ—¶é’Ÿçš„åº”ç”¨</h4>
<p>å¾®ä¿¡æœ‹å‹åœˆä¸åŒåœ°åŸŸçš„ç”¨æˆ·å¯èƒ½åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¾®ä¿¡æœ‹å‹åœˆçš„è·¨åœ°åŸŸæ•°æ®åŒæ­¥å°±å€Ÿé‰´äº†å› æœä¸€è‡´æ€§çš„æ€æƒ³ï¼Œä»¥ç¡®ä¿è¯„è®ºå’Œå›å¤èƒ½ä»¥æ­£ç¡®çš„é¡ºåºå‘ˆç°åœ¨å…¨çƒæ‰€æœ‰ç”¨æˆ·é¢å‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da3d71d11a404d618ec7d30377a293ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=BpJwt1riiFaSRsTZQ7uCrGZblA0%3D" alt="" loading="lazy"/></p>
<p>ä¸Šæµ·å°ç‹å‘äº†ä¸€ä¸ªé£æ™¯å›¾ç‰‡åˆ°æœ‹å‹åœˆï¼Œé¦™æ¸¯Maryçœ‹åˆ°åè¯„è®ºäº†é—®â€œè¿™æ˜¯å“ªâ€ï¼Œä¸Šæµ·å°ç‹å›å¤è¯„è®ºâ€œæ¢…é‡Œé›ªå±±â€ã€‚ç”±äºç½‘ç»œåŸå› ï¼Œå¯¹è¯„è®ºçš„å›å¤å…ˆåŒæ­¥åˆ°äº†åŠ æ‹¿å¤§çš„æœåŠ¡å™¨ï¼Œè¯„è®ºååˆ°ï¼Œå¯¼è‡´åŠ æ‹¿å¤§Kateå…ˆçœ‹åˆ°å›ç­”â€œæ¢…é‡Œé›ªå±±â€ï¼Œåçœ‹åˆ°æé—®â€œè¿™æ˜¯å“ªâ€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cd4ca1cc6a54b2b8e9d6b6fd8c19468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YeJ5YeJ55qE55-l6K-G5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770189679&amp;x-signature=i7pFgjDd%2FtFmlVQ%2BME3jJtUiYyQ%3D" alt="" loading="lazy"/></p>
<p>ä½¿ç”¨å‘é‡æ—¶é’Ÿï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>V</mi><mi>C</mi><mo stretchy="false">(</mo><mi>e</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VC(c) &lt; VC(e)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mclose">)</span></span></span></span></span>ï¼Œå› æ­¤ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>â†’</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">c â†’ e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">e</span></span></span></span></span>ï¼ŒåŠ æ‹¿å¤§çš„æœåŠ¡å™¨çŸ¥é“cå‘ç”Ÿåœ¨eå‰é¢ï¼Œå¯ä»¥å¯¹è¯„è®ºå’Œå›å¤æ­£ç¡®æ’åºåæ˜¾ç¤ºã€‚</p>
<h4 data-id="heading-13">å‘é‡æ—¶é’Ÿçš„ä¸è¶³</h4>
<ol>
<li>
<p>åªè€ƒè™‘äº†å›ºå®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰è€ƒè™‘èŠ‚ç‚¹çš„åŠ¨æ€æ·»åŠ å’Œé”€æ¯ã€‚</p>
<p>ç°ä»£è§£å†³æ–¹æ¡ˆï¼š åŒºé—´æ ‘æ—¶é’Ÿ - Interval Tree Clocks</p>
</li>
<li>
<p>å‡è®¾èŠ‚ç‚¹æ•°é‡æ˜¯N ï¼Œé‚£ä¹ˆæ¯ä¸ªèŠ‚ç‚¹éœ€è¦ç»´æŠ¤çš„ç©ºé—´å¤æ‚åº¦æ˜¯ ğ‘‚(ğ‘)ã€‚ é€šä¿¡çš„ä¿¡æ¯é‡çš„å¤æ‚åº¦ä¹Ÿæ˜¯ ğ‘‚(ğ‘)</p>
<p>2019å¹´æ–°é²œå‡ºç‚‰çš„ä¸€ä¸ªå¯»æ±‚ä¼˜åŒ–æ—¶é’Ÿç©ºé—´çš„ç®—æ³•ï¼Œå¸ƒéš†æ—¶é’Ÿ - Bloom Clocks</p>
</li>
</ol>
<h3 data-id="heading-14">æ··åˆé€»è¾‘æ—¶é’Ÿ</h3>
<p>æ··åˆé€»è¾‘æ—¶é’Ÿï¼ˆHybrid Logical Clock, HLCï¼‰æ˜¯ä¸€ç§å·§å¦™èåˆç‰©ç†æ—¶é’Ÿå’Œé€»è¾‘æ—¶é’Ÿä¼˜åŠ¿çš„ç®—æ³•ï¼Œæ—¨åœ¨ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹ä»¶æä¾›æ—¢èƒ½åæ˜ å› æœå…³ç³»ã€åˆä¸ç‰©ç†æ—¶é—´ä¿æŒæ¥è¿‘çš„æ—¶é—´æˆ³ã€‚å®ƒç”± Sandeep Kulkarni ç­‰äººåœ¨2014å¹´çš„è®ºæ–‡ã€ŠLogical Physical Clocks and Consistent Snapshots in Globally Distributed Databasesã€‹ä¸­æå‡º</p>
<h4 data-id="heading-15">HLCçš„ç®—æ³•</h4>
<p>åœ¨ HLC ä¸­ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæˆ–è¿›ç¨‹ï¼‰<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> ç»´æŠ¤ä¸€ä¸ªæ—¶é—´æˆ³çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>L</mi><mi>C</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mo stretchy="false">(</mo><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo separator="true">,</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">HLC.j = (l.j, c.j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>  ï¼šé€»è¾‘ç‰©ç†æ—¶é—´ã€‚ä»£è¡¨å½“å‰èŠ‚ç‚¹å·²çŸ¥çš„æœ€å¤§ç‰©ç†æ—¶é’Ÿå€¼ï¼ˆä¸ä¸€å®šæ¥è‡ªæœ¬åœ°ï¼‰</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">c.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>  ï¼šé€»è¾‘è®¡æ•°å™¨ã€‚å½“å¤šä¸ªäº‹ä»¶çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></span> éƒ¨åˆ†ç›¸åŒæ—¶ï¼Œç”¨äºåœ¨é€»è¾‘ä¸ŠåŒºåˆ†å…¶å…ˆåé¡ºåº</li>
</ul>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæœ¬åœ°çš„ç‰©ç†æ—¶é’Ÿæºï¼š</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">pt.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">pt</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>ï¼šèŠ‚ç‚¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> å½“å‰çš„ç³»ç»Ÿç‰©ç†æ—¶é—´</li>
</ul>
<p>å…¶æ ¸å¿ƒç®—æ³•åœ¨äºå¦‚ä½•åœ¨ä¸åŒæ“ä½œä¸‹æ›´æ–°è¿™ä¸ª <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo separator="true">,</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(l.j, c.j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span></span> å¯¹</p>
<p><strong>å‘é€äº‹ä»¶æˆ–æœ¬åœ°äº‹ä»¶</strong></p>
<p>å½“å‘ç”Ÿä¸€ä¸ªæœ¬åœ°äº‹ä»¶æˆ–å‡†å¤‡å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒéœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„æ—¶é—´æˆ³ã€‚ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°½å¯èƒ½ä½¿ç”¨å½“å‰çš„ç‰©ç†æ—¶é—´ï¼Œé™¤éç‰©ç†æ—¶é—´å‘ç”Ÿäº†å›é€€æˆ–è½åäºä¹‹å‰çš„é€»è¾‘æ—¶é—´</p>
<ol>
<li>è·å–å½“å‰ç‰©ç†æ—¶é—´ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">pt.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">pt</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span></li>
<li>æ›´æ–° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo separator="true">,</mo><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">l.j = max(l.j, pt.j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">pt</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span></span>ã€‚è¿™ä¸€æ­¥ç¡®ä¿ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></span> éƒ¨åˆ†æ€»èƒ½è·Ÿè¸ªåˆ°æœ€æ–°çš„ç‰©ç†æ—¶é—´ã€‚</li>
<li>æ›´æ–° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">l.c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal">c</span></span></span></span></span>
<ul>
<li>å¦‚æœæ–°çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> ç­‰äºä¹‹å‰çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>ï¼ˆå³ç‰©ç†æ—¶é—´æ²¡æœ‰è¶…è¶Šï¼‰ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">c.j = c.j + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> ã€‚è¿™è¡¨ç¤ºåœ¨åŒä¸€ä¸ªç‰©ç†æ—¶é—´ç‰‡å†…å‘ç”Ÿäº†æ–°äº‹ä»¶</li>
<li>å¦‚æœæ–°çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> å¤§äºä¹‹å‰çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> ï¼ˆå³ç‰©ç†æ—¶é—´å‘ç”Ÿäº†è·ƒå‡ï¼‰ï¼Œåˆ™ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c.j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> ã€‚è¿™è¡¨ç¤ºç‰©ç†æ—¶é—´å·²ç»æ¨è¿›ï¼Œé€»è¾‘è®¡æ•°å™¨å¯ä»¥é‡ç½®</li>
</ul>
</li>
</ol>
<p><strong>æ¥æ”¶äº‹ä»¶ï¼ˆå¤„ç†æ¶ˆæ¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span></span></span></span></span>ï¼‰</strong></p>
<p>å½“èŠ‚ç‚¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">m</span></span></span></span></span>ï¼Œè¯¥æ¶ˆæ¯æºå¸¦çš„æ—¶é—´æˆ³ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>l</mi><mi mathvariant="normal">.</mi><mi>m</mi><mo separator="true">,</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(l.m, c.m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></span>ã€‚èŠ‚ç‚¹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> éœ€è¦æ›´æ–°è‡ªå·±çš„æ—¶é’Ÿï¼Œä»¥æ»¡è¶³å› æœå…³ç³»ï¼ˆå³è‡ªå·±çš„æ—¶é—´å¿…é¡»æ™šäºæ¶ˆæ¯çš„æ—¶é—´ï¼‰</p>
<ol>
<li>è·å–å½“å‰å½“å‰ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>ï¼Œæ¶ˆæ¯çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">l.m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal">m</span></span></span></span></span>ã€å½“å‰ç‰©ç†æ—¶é—´ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">pt.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">pt</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span></li>
<li>æ›´æ–° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>l</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mi>max</mi><mo>â¡</mo><mo stretchy="false">(</mo><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo separator="true">,</mo><mi>l</mi><mi mathvariant="normal">.</mi><mi>m</mi><mo separator="true">,</mo><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">l'.j = \max(l.j, l.m, pt.j)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">pt</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span></span>ã€‚è¿™ä¸€æ­¥ç¡®ä¿æœ¬åœ°çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></span> éƒ¨åˆ†èƒ½æ„ŸçŸ¥åˆ°æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æœ€æ–°ç‰©ç†æ—¶é—´ã€‚</li>
<li>æ ¹æ® <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>l</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l'.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> æ˜¯ç”±è°å†³å®šçš„ï¼Œæ¥æ›´æ–°è®¡æ•°å™¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">c'.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>
<ul>
<li>å¦‚æœä¸‰è€…ä¸­ç›¸ç­‰ï¼šå¢åŠ é€»è¾‘æ—¶é’Ÿéƒ¨åˆ† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo separator="true">,</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>m</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">c'.j = max(c.j, c.m) + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></li>
<li>å¦‚æœæ˜¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">l.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> èµ¢äº†ï¼ˆæœ¬åœ°HLCæ—¶é—´æœ€å¤§ï¼‰ï¼šå»¶ç»­æœ¬åœ°è®¡æ•°ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>j</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">c'.j = c.j + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></li>
<li>å¦‚æœæ˜¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi mathvariant="normal">.</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">l.m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord">.</span><span class="mord mathnormal">m</span></span></span></span></span> èµ¢äº†ï¼ˆæ¶ˆæ¯æ—¶é—´æœ€å¤§ï¼‰ï¼šè·Ÿéšæ¶ˆæ¯è®¡æ•°ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mi>c</mi><mi mathvariant="normal">.</mi><mi>m</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">c'.j = c.m + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></li>
<li>å¦‚æœæ˜¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">pt.j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">pt</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span> èµ¢äº†ï¼ˆæœ¬åœ°ç‰©ç†æ—¶é—´æœ€å¤§ï¼‰ï¼šé‡ç½®è®¡æ•°ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>c</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mi mathvariant="normal">.</mi><mi>j</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c'.j = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></li>
</ul>
</li>
</ol>
<h4 data-id="heading-16">HLCçš„åº”ç”¨</h4>
<p>1ã€å› æœä¸€è‡´æ€§</p>
<p>è¿™æ˜¯ HLC æœ€æœ¬è´¨çš„æ•°å­¦å±æ€§ã€‚HLC æ—¨åœ¨æ•æ‰åˆ†å¸ƒå¼ç³»ç»Ÿä¸­äº‹ä»¶çš„â€œå‘ç”Ÿå…ˆäºâ€ï¼ˆHappens-Before, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â†’</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">â†’</span></span></span></span></span>ï¼‰å…³ç³»ã€‚å¦‚æœäº‹ä»¶ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">e</span></span></span></span></span> å‘ç”Ÿåœ¨äº‹ä»¶ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span></span> ä¹‹å‰ï¼ˆå³ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>â†’</mo><mi>f</mi></mrow><annotation encoding="application/x-tex">e \rightarrow f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span></span>ï¼‰ï¼Œé‚£ä¹ˆ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>L</mi><mi>C</mi><mo stretchy="false">(</mo><mi>e</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>H</mi><mi>L</mi><mi>C</mi><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">HLC(e) &lt; HLC(f)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span></span> ä¸€å®šæˆç«‹</p>
<p>2ã€å¿«ç…§éš”ç¦»/ä¸€è‡´æ€§å¿«ç…§</p>
<p>è¿™æ˜¯ HLC åœ¨å·¥ç¨‹å®è·µä¸­ï¼ˆå¦‚ CockRoachDBã€HBaseï¼‰æœ€ä¸»è¦çš„åº”ç”¨ç›®æ ‡</p>
<h2 data-id="heading-17">æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰</h2>
<p>æœ€ç»ˆä¸€è‡´æ€§æ˜¯æ›´åŠ å¼±åŒ–çš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œå› æœä¸€è‡´æ€§èµ·ç è¿˜ä¿è¯äº†æœ‰å› æœå…³ç³»çš„æ•°æ®ä¸åŒè¿›ç¨‹è¯»å–åˆ°çš„å€¼ä¿è¯æ˜¯ä¸€æ ·çš„ï¼Œè€Œæœ€ç»ˆä¸€è‡´æ€§åªä¿è¯æ‰€æœ‰å‰¯æœ¬çš„æ•°æ®æœ€ç»ˆåœ¨æŸä¸ªæ—¶åˆ»ä¼šä¿æŒä¸€è‡´ï¼Œä½†ä¸ä¿è¯ä¸­é—´çŠ¶æ€çš„é¡ºåºã€‚ç†è®ºä¸Šï¼Œå¯èƒ½å‡ºç°éå¸¸æ··ä¹±çš„ä¸­é—´çŠ¶æ€</p>
<p>ç”±äºæœ€ç»ˆä¸€è‡´æ€§å¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æ¯”è¾ƒä½ï¼Œåœ¨å¯¹æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯ä¸­æ˜¯ç»å¸¸ä½¿ç”¨çš„ä¸€è‡´æ€§æ¨¡å‹</p>
<p><strong>ä¸ºä»€ä¹ˆè¯´MySQLçš„å¼‚æ­¥å¤åˆ¶ (é»˜è®¤)æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ</strong></p>

































<table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>æœºåˆ¶</strong></th><th><strong>ä¸€è‡´æ€§ç±»å‹</strong></th><th><strong>ä¼˜ç‚¹</strong></th><th><strong>ç¼ºç‚¹</strong></th></tr></thead><tbody><tr><td>å¼‚æ­¥å¤åˆ¶ (é»˜è®¤)</td><td>Master å†™å®Œ Binlog å³è¿”å›ï¼Œä¸ç®¡ Slave</td><td>æœ€ç»ˆä¸€è‡´æ€§</td><td>æ€§èƒ½æœ€é«˜ï¼Œä¸»åº“ä¸è¢«æ‹–ç´¯ã€‚</td><td>è¯»ä»åº“å¯èƒ½æœ‰å»¶è¿Ÿï¼›Master å®•æœºå¯èƒ½ä¸¢æ•°æ®ã€‚</td></tr><tr><td>åŠåŒæ­¥å¤åˆ¶ (Semi-Sync)</td><td>Master è‡³å°‘ç­‰å¾…ä¸€ä¸ª Slave æ”¶åˆ° Binlog (å†™å…¥ Relay Log) æ‰è¿”å›</td><td>å¢å¼ºçš„æœ€ç»ˆä¸€è‡´æ€§</td><td>æ•°æ®å®‰å…¨æ€§æ›´é«˜ï¼Œä¸æ˜“ä¸¢æ•°æ®ã€‚</td><td>æ€§èƒ½æœ‰æŸè€—ï¼›Slave ä¾ç„¶å¯èƒ½å­˜åœ¨å›æ”¾å»¶è¿Ÿï¼ˆè¯»ä»å¯èƒ½ä¸ä¸€è‡´ï¼‰ã€‚</td></tr><tr><td>å…¨åŒæ­¥/ç»„å¤åˆ¶ (MGR)</td><td>æ‰€æœ‰èŠ‚ç‚¹åå•†ä¸€è‡´æ‰æäº¤</td><td>å¼ºä¸€è‡´æ€§ (æ¥è¿‘)</td><td>æ•°æ®ä¸€è‡´æ€§æé«˜ã€‚</td><td>æ€§èƒ½æœ€å·®ï¼Œå—é™äºæœ€æ…¢çš„èŠ‚ç‚¹ï¼Œæ¶æ„å¤æ‚ã€‚</td></tr></tbody></table>
<p>é¦–å…ˆå¯¹æ¯”ZooKeeperï¼ŒZookeeperä¸­é’ˆå¯¹åŒä¸€ä¸ªFollower Aæäº¤çš„å†™è¯·æ±‚R1ï¼ŒR2ï¼ŒæŸäº›Followerå¯èƒ½è¯»å–åˆ°æ—§æ•°æ®ã€‚æ—¢ç„¶æ•°æ®åŒæ­¥éœ€è¦æ—¶é—´ï¼ŒFollower ä¸Šçš„æ•°æ®ä¼šæ»åï¼ˆStaleï¼‰ï¼Œé‚£ä¸å°±æ˜¯ã€Œæœ€ç»ˆã€æ‰ä¸€è‡´å—ï¼Ÿä½†ZooKeeperæ–‡æ¡£ä¸­å†™æ˜å®ƒæ˜¯é¡ºåºä¸€è‡´æ€§è¯»</p>
<p>ä¹‹æ‰€ä»¥ä¼šäº§ç”Ÿæœ€ç»ˆä¸€è‡´æ€§çš„é”™è§‰ï¼Œæ˜¯å› ä¸ºZooKeeperçš„ä¸€è‡´æ€§æ¨¡å‹ä¸­å­˜åœ¨å®æ—¶æ€§ï¼ˆTimelinessï¼‰çš„ç¼ºå¤±</p>
<ul>
<li>çº¿æ€§ä¸€è‡´æ€§ï¼š å†™å…¥æˆåŠŸåï¼Œæ‰€æœ‰èŠ‚å¾—éƒ½è¯»åˆ°æœ€æ–°å€¼</li>
<li>ZK çš„è¯»ï¼š ZK é»˜è®¤è¯»ä¸æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§ï¼Œå› ä¸ºå…è®¸éƒ¨åˆ†å®¢æˆ·ç«¯è¯» Follower è¯»åˆ°æ—§æ•°æ®ã€‚å®˜æ–¹ç§°ä¹‹ä¸ºâ€œSync-Linearizableâ€ï¼Œå³å¦‚æœä½ éœ€è¦è¯»åˆ°æœ€æ–°æ•°æ®ï¼Œéœ€è¦å…ˆå‘ä¸€ä¸ª <code>sync()</code> å‘½ä»¤</li>
</ul>
<p>å› ä¸ºå…è®¸è¯»åˆ°æ—§æ•°æ®ï¼ˆæ»åï¼‰ï¼Œæ‰€ä»¥ç»™äººçš„æ„Ÿè§‰æ˜¯â€œæœ€ç»ˆæ‰ä¼šä¸€è‡´â€ã€‚ä½†åœ¨åˆ†å¸ƒå¼ç†è®ºä¸­ï¼Œæ»åï¼ˆLagï¼‰ å’Œ ä¹±åºï¼ˆOut of orderï¼‰ æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ€§è´¨</p>
<ul>
<li>å…è®¸æ»å + ä¸¥æ ¼æœ‰åº = é¡ºåºä¸€è‡´æ€§ (Sequential)</li>
<li>å…è®¸æ»å + å…è®¸ä¹±åº = æœ€ç»ˆä¸€è‡´æ€§ (Eventual)</li>
</ul>
<p>é¡ºåºä¸€è‡´æ€§çš„å®šä¹‰éå¸¸ä¸¥æ ¼ï¼Œå®ƒè¦æ±‚ç³»ç»Ÿæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>å†…éƒ¨æœ‰åºï¼š å•ä¸ªå¤„ç†å™¨çš„æ“ä½œé¡ºåºç¬¦åˆç¨‹åºé¡ºåº</li>
<li>å…¨å±€å•ä¸€è§†å›¾ï¼š æ‰€æœ‰å®¢æˆ·ç«¯çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºå¿…é¡»æ˜¯ä¸€è‡´çš„</li>
</ol>
<p>ZooKeeper çš„é¡ºåºä¸€è‡´æ€§ä¿è¯äº†ä»€ä¹ˆï¼š ZooKeeper ä¿è¯äº†â€œå®¢æˆ·ç«¯è§†è§’çš„å…¨å±€æœ‰åºâ€ï¼Œæ³¨æ„æ˜¯å®¢æˆ·ç«¯è§†è§’</p>
<ul>
<li>å†…éƒ¨æœ‰åºï¼š å³ä½¿ Follower æ»åï¼Œå®ƒä¹Ÿå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ Leader çš„ zxidï¼ˆäº‹åŠ¡IDï¼‰é¡ºåºæ¥åº”ç”¨æ—¥å¿—ã€‚å¦‚æœ Leader å‘å‡º R1ç„¶å R2ï¼ŒFollower å†³ä¸å¯èƒ½å…ˆåº”ç”¨ R2ã€‚å®ƒè¦ä¹ˆåœåœ¨ R0ï¼ˆæ—§æ•°æ®ï¼‰ï¼Œè¦ä¹ˆæ›´æ–°åˆ° R1ï¼Œè¦ä¹ˆæ›´æ–°åˆ° R2ã€‚æ»åæ˜¯å¯ä»¥çš„ï¼Œä½†ä¹±åºæ˜¯ä¸è¡Œçš„</li>
<li>å…¨å±€å•ä¸€è§†å›¾ï¼š ZK ä¿è¯å•ä¸€å®¢æˆ·ç«¯çš„å•è°ƒè¯»ï¼ˆMonotonic Readsï¼‰ã€‚å¦‚æœä½ åœ¨ Follower A è¯»åˆ°äº†ç‰ˆæœ¬R1çš„æ•°æ®ï¼Œå½“ä½ åˆ‡åˆ° Follower B æ—¶ï¼ŒZKçš„æœºåˆ¶ç¡®ä¿ä½ ä¸ä¼šè¯»åˆ°ç‰ˆæœ¬R1çš„æ•°æ®ï¼ˆå¦‚æœ Follower B è¿˜æ²¡åŒæ­¥åˆ°R2ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šè¢«é˜»å¡æˆ–éœ€è¦å¤„ç†ï¼Œå…·ä½“å–å†³äºå®ç°ç»†èŠ‚ï¼Œä½†é€»è¾‘è§†å›¾ä¸Šä¸ä¼šå›é€€ï¼‰</li>
</ul>
<p>ZK ä¿è¯äº†ï¼š åªè¦ä½ çœ‹è§è¿‡æ–°ä¸–ç•Œï¼Œæˆ‘å°±ç»ä¸è®©ä½ å†é€€å›æ—§ä¸–ç•Œ</p>
<blockquote>
<p>ZooKeeper å¦‚ä½•åšåˆ°çš„ï¼ŸZooKeeper åœ¨å®¢æˆ·ç«¯ä¼šè¯ï¼ˆSessionï¼‰å±‚é¢åšäº†æ‰‹è„šï¼š</p>
<ul>
<li>ZXID æ£€æŸ¥æœºåˆ¶ï¼š å½“ Client è¿ä¸Š ZK çš„ Follower A æ—¶ï¼ŒFollower A ä¼šå‘Šè¯‰ Clientï¼šâ€œæˆ‘ç°åœ¨çš„æ•°æ®ç‰ˆæœ¬æ˜¯ ZXID=100â€ã€‚Client ä¼šåœ¨æœ¬åœ°è®°ä¸‹â€œæˆ‘çœ‹è¿‡ ZXID 100 äº†â€ã€‚</li>
<li>æ‹’ç»â€œæ—¶å…‰å€’æµâ€ï¼š å¦‚æœ Client æ–­å¼€ï¼Œé‡è¿åˆ°æ»åçš„ Follower Bï¼ˆZXID=80ï¼‰ã€‚Follower B ä¼šæ£€æŸ¥ Client çš„æ¡æ‰‹åŒ…ï¼Œå‘ç° Client è§è¿‡ 100ï¼Œè€Œè‡ªå·±åªæœ‰ 80ã€‚</li>
<li>å¤„ç†ç»“æœï¼š Follower B è¦ä¹ˆæ‹’ç»æœåŠ¡ï¼Œè¦ä¹ˆé˜»å¡ç›´åˆ°è‡ªå·±è¿½ä¸Š 100ï¼Œè¦ä¹ˆ Client è¢«è·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</li>
</ul>
</blockquote>
<p>MySQLæ— æ³•æ»¡è¶³å…¨å±€å•ä¸€è§†å›¾ã€‚MySQLçš„å¼‚æ­¥å¤åˆ¶ç¡®å®ä¿è¯äº†å†…éƒ¨æ“ä½œé¡ºåºï¼Œä½†å®ƒç¼ºä¹é˜²æ­¢â€œå®¢æˆ·ç«¯è§†è§’çš„å…¨å±€æœ‰åºâ€çš„æœºåˆ¶ï¼Œå› æ­¤åªèƒ½ç®—æœ€ç»ˆä¸€è‡´æ€§</p>
<p>å‡è®¾æ¶æ„æ˜¯ï¼š1 Master + 2 Slaves (Slave A å¿«, Slave B æ…¢)ã€‚ åˆå§‹å€¼ <code>x = 0</code>ã€‚</p>
<ol>
<li>Master å†™å…¥ <code>x = 1</code>ã€‚</li>
<li>Slave A åŒæ­¥å®Œæˆï¼Œå˜æ›´ä¸º <code>x = 1</code>ã€‚</li>
<li>Slave B å»¶è¿Ÿäº†ï¼Œè¿˜æ˜¯ <code>x = 0</code>ã€‚</li>
</ol>
<p>å¦‚æœæ˜¯é¡ºåºä¸€è‡´æ€§ï¼ˆå¦‚ ZKï¼‰ï¼Œç³»ç»Ÿå¿…é¡»ä¿è¯ï¼š ä¸€æ—¦å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ Client 1ï¼‰è¯»åˆ°äº† <code>x = 1</code>ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯Client 1ä»¥åå³ä½¿åˆ‡æ¢äº†Followeréƒ½ä¸ä¼šå†è¯»åˆ° <code>x = 0</code></p>
<p>ä½†åœ¨ MySQL å¼‚æ­¥å¤åˆ¶ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æ—¶åˆ» T1ï¼š Client 1 è¿ä¸Š Slave Aï¼Œè¯»åˆ° <code>x = 1</code>ï¼ˆç”¨æˆ·è§‰å¾—ï¼šå“¦ï¼Œæ•°æ®æ›´æ–°äº†ï¼‰</li>
<li>æ—¶åˆ» T2ï¼š Client 1 åˆ·æ–°é¡µé¢ï¼Œè´Ÿè½½å‡è¡¡å°†è¯·æ±‚åˆ‡åˆ°äº† Slave B</li>
<li>æ—¶åˆ» T3ï¼š Client 1 è¯»åˆ° <code>x = 0</code></li>
</ul>
<p>åœ¨å¤šèŠ‚ç‚¹åˆ‡æ¢è®¿é—®æ—¶ï¼Œå¯¹äº Client 1 æ¥è¯´ï¼Œä»–å…ˆçœ‹åˆ°äº†æ–°æ•°æ®ï¼Œåçœ‹åˆ°äº†æ—§æ•°æ®ã€‚æ•°æ®çš„ç‰ˆæœ¬å‘ç”Ÿäº†å›é€€ã€‚ è¿™ç§æƒ…å†µç ´åäº†å•è°ƒè¯»ï¼ˆMonotonic Readsï¼‰ï¼Œä¹Ÿç ´åäº†é¡ºåºä¸€è‡´æ€§è¦æ±‚çš„å…¨å±€å•ä¸€è§†å›¾ã€‚åœ¨å®¢æˆ·ç«¯çœ‹æ¥ï¼Œè¿™ä¸ªç³»ç»Ÿçš„è¡Œä¸ºæ˜¯æ··ä¹±çš„ï¼Œè€Œä¸æ˜¯é¡ºåºçš„ï¼Œå› æ­¤åªèƒ½ç®—æœ€ç»ˆä¸€è‡´æ€§</p>
<hr/>
<p>âœ¨ å¾®ä¿¡å…¬ä¼—å·ã€<strong>å‡‰å‡‰çš„çŸ¥è¯†åº“</strong>ã€‘åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨è·å–æœ€æ–°æœ€æœ‰ç”¨çš„çŸ¥è¯† âœ¨</p>
<h2 data-id="heading-18">å‚è€ƒ</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F693187" target="_blank" title="https://developer.aliyun.com/article/693187" ref="nofollow noopener noreferrer">åˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸€è‡´æ€§æ¨¡å‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhit9.dev%2Fpost%2Flogical-clocks%23%25E5%2590%2591%25E9%2587%258F%25E6%2597%25B6%25E9%2592%259F-vector-clocks" target="_blank" title="https://hit9.dev/post/logical-clocks#%E5%90%91%E9%87%8F%E6%97%B6%E9%92%9F-vector-clocks" ref="nofollow noopener noreferrer">é€»è¾‘æ—¶é’Ÿ - å¦‚ä½•åˆ»ç”»åˆ†å¸ƒå¼ä¸­çš„äº‹ä»¶é¡ºåº</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fyang.observer%2F2020%2F07%2F26%2Ftime-lamport-logical-time%2F" target="_blank" title="https://yang.observer/2020/07/26/time-lamport-logical-time/" ref="nofollow noopener noreferrer">è®¡ç®—æœºçš„æ—¶é’Ÿï¼ˆäºŒï¼‰ï¼šLamporté€»è¾‘æ—¶é’Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F56146800" target="_blank" title="https://zhuanlan.zhihu.com/p/56146800" ref="nofollow noopener noreferrer">åˆ†å¸ƒå¼ç³»ç»Ÿï¼šLamport é€»è¾‘æ—¶é’Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fyang.observer%2F2020%2F09%2F12%2Fvector-clock%2F" target="_blank" title="https://yang.observer/2020/09/12/vector-clock/" ref="nofollow noopener noreferrer">è®¡ç®—æœºçš„æ—¶é’Ÿï¼ˆä¸‰ï¼‰ï¼šå‘é‡æ—¶é’Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F56886156" target="_blank" title="https://zhuanlan.zhihu.com/p/56886156" ref="nofollow noopener noreferrer">åˆ†å¸ƒå¼ç³»ç»Ÿï¼šå‘é‡æ—¶é’Ÿ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftech.meituan.com%2F2022%2F08%2F25%2Freplication-in-meituan-02.html" target="_blank" title="https://tech.meituan.com/2022/08/25/replication-in-meituan-02.html" ref="nofollow noopener noreferrer">Replicationï¼ˆä¸‹ï¼‰ï¼šäº‹åŠ¡ï¼Œä¸€è‡´æ€§ä¸å…±è¯†</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7600060691350405162</link>    <guid>https://juejin.cn/post/7600060691350405162</guid>    <pubDate>2026-01-28T12:20:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600060691350405162" data-draft-id="7600219080046002219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ"/> <meta itemprop="keywords" content="Android,æºç é˜…è¯»,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-28T12:20:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 15ç½‘ç»œå­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸€ï¼‰ï¼šConnectivityServiceä¸ç½‘ç»œç®¡ç†æ¡†æ¶å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T12:20:27.000Z" title="Wed Jan 28 2026 12:20:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>ç½‘ç»œè¿æ¥æ˜¯ç°ä»£ç§»åŠ¨è®¾å¤‡æœ€æ ¸å¿ƒçš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä»æ‰“å¼€ç½‘é¡µã€æ”¶å‘æ¶ˆæ¯ï¼Œåˆ°è§†é¢‘é€šè¯ã€åœ¨çº¿æ¸¸æˆï¼Œæ¯ä¸€ä¸ªç½‘ç»œæ“ä½œèƒŒåï¼Œéƒ½æœ‰Androidç½‘ç»œå­ç³»ç»Ÿåœ¨é»˜é»˜å·¥ä½œã€‚è€Œ<strong>ConnectivityService</strong>ï¼Œæ­£æ˜¯è¿™ä¸ªåºå¤§ç³»ç»Ÿçš„"ä¸­æ¢å¤§è„‘"ã€‚</p>
<p>åœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç´¢ï¼š</p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆConnectivityServiceå¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä½ æ­£åœ¨ç”¨WiFiè§‚çœ‹é«˜æ¸…è§†é¢‘ï¼Œçªç„¶WiFiä¿¡å·å˜å¼±ã€‚Androidç³»ç»Ÿéœ€è¦åœ¨1ç§’å†…å®Œæˆä»¥ä¸‹å¤æ‚æ“ä½œï¼š</p>
<ol>
<li><strong>ç›‘æµ‹WiFiè´¨é‡ä¸‹é™</strong> - NetworkMonitoræŒç»­éªŒè¯ç½‘ç»œ</li>
<li><strong>è¯„ä¼°åˆ‡æ¢æ—¶æœº</strong> - NetworkRankerå¯¹æ¯”WiFiå’Œç§»åŠ¨ç½‘ç»œå¾—åˆ†</li>
<li><strong>å‡†å¤‡ç§»åŠ¨ç½‘ç»œ</strong> - TelephonyNetworkFactoryæ¿€æ´»ç§»åŠ¨æ•°æ®</li>
<li><strong>æ— ç¼åˆ‡æ¢</strong> - åœ¨ä¸ä¸­æ–­è§†é¢‘çš„æƒ…å†µä¸‹è¿ç§»è¿æ¥</li>
<li><strong>é€šçŸ¥åº”ç”¨</strong> - é€šè¿‡NetworkCallbackå‘ŠçŸ¥ç½‘ç»œå˜æ›´</li>
</ol>
<p>è¿™ä¸€åˆ‡ï¼Œéƒ½ç”±ConnectivityServiceåè°ƒå®Œæˆã€‚å®ƒå°±åƒäº¤é€šæŒ‡æŒ¥ä¸­å¿ƒï¼Œç®¡ç†ç€è®¾å¤‡ä¸Šæ‰€æœ‰ç½‘ç»œçš„"äº¤é€š"ã€‚</p>
<h3 data-id="heading-2">æœ¬æ–‡å†…å®¹æ¦‚è§ˆ</h3>
<ol>
<li>
<p><strong>ConnectivityServiceæ¶æ„æ€»è§ˆ</strong></p>
<ul>
<li>æ ¸å¿ƒèŒè´£ä¸è®¾è®¡ç†å¿µ</li>
<li>ä¸å…¶ä»–ç³»ç»ŸæœåŠ¡çš„å…³ç³»</li>
<li>Android 15çš„æ¶æ„æ¼”è¿›</li>
</ul>
</li>
<li>
<p><strong>NetworkAgentæœºåˆ¶æ·±åº¦è§£æ</strong></p>
<ul>
<li>NetworkAgentç”Ÿå‘½å‘¨æœŸ</li>
<li>ç½‘ç»œçŠ¶æ€ä¸ŠæŠ¥æµç¨‹</li>
<li>WiFi/Cellularçš„Agentå®ç°</li>
</ul>
</li>
<li>
<p><strong>NetworkFactoryå·¥ä½œåŸç†</strong></p>
<ul>
<li>ç½‘ç»œè¯·æ±‚åŒ¹é…æœºåˆ¶</li>
<li>Factoryè¯„åˆ†ä¸ç«äº‰</li>
<li>æŒ‰éœ€ç½‘ç»œæ¿€æ´»</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œçŠ¶æ€ç®¡ç†</strong></p>
<ul>
<li>9ç§ç½‘ç»œçŠ¶æ€è¯¦è§£</li>
<li>çŠ¶æ€æœºè½¬æ¢æµç¨‹</li>
<li>Lingeræœºåˆ¶</li>
</ul>
</li>
<li>
<p><strong>WiFiä¸ç§»åŠ¨ç½‘ç»œåˆ‡æ¢</strong></p>
<ul>
<li>åˆ‡æ¢å†³ç­–ç®—æ³•</li>
<li>NetworkRankerè¯„åˆ†æœºåˆ¶</li>
<li>æ— ç¼åˆ‡æ¢å®ç°</li>
</ul>
</li>
<li>
<p><strong>å®æˆ˜ï¼šç½‘ç»œé—®é¢˜è¯Šæ–­</strong></p>
<ul>
<li>WiFiè¿æ¥å¤±è´¥æ’æŸ¥</li>
<li>ç½‘ç»œåˆ‡æ¢å¼‚å¸¸å®šä½</li>
<li>æ€§èƒ½ä¼˜åŒ–æŠ€å·§</li>
</ul>
</li>
</ol>
<p>è®©æˆ‘ä»¬å¼€å§‹è¿™æ®µæ·±å…¥Androidç½‘ç»œæ ¸å¿ƒçš„æ—…ç¨‹ï¼</p>
<hr/>
<h2 data-id="heading-3">ä¸€ã€ConnectivityServiceæ¶æ„æ€»è§ˆ</h2>
<h3 data-id="heading-4">1.1 ConnectivityServiceçš„æ ¸å¿ƒèŒè´£</h3>
<p>ConnectivityServiceæ˜¯Androidç½‘ç»œæ ˆçš„"æ€»ç®¡å®¶"ï¼Œè´Ÿè´£ï¼š</p>
<pre><code class="hljs language-objectivec" lang="objectivec">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ConnectivityServiceæ ¸å¿ƒèŒè´£        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1.</span> ç½‘ç»œç”Ÿå‘½å‘¨æœŸç®¡ç†                     â”‚
â”‚    - åˆ›å»º/é”€æ¯ç½‘ç»œ                      â”‚
â”‚    - ç›‘æ§ç½‘ç»œçŠ¶æ€                       â”‚
â”‚    - å¤„ç†ç½‘ç»œåˆ‡æ¢                       â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">2.</span> ç½‘ç»œè¯·æ±‚è°ƒåº¦                         â”‚
â”‚    - æ¥æ”¶NetworkRequest                â”‚
â”‚    - åˆ†å‘åˆ°å¯¹åº”NetworkFactory          â”‚
â”‚    - ç®¡ç†è¯·æ±‚ä¼˜å…ˆçº§                     â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">3.</span> ç½‘ç»œèƒ½åŠ›ç®¡ç†                         â”‚
â”‚    - NetworkCapabilitiesåŒ¹é…           â”‚
â”‚    - ç½‘ç»œè¯„åˆ†(NetworkScore)            â”‚
â”‚    - é»˜è®¤ç½‘ç»œé€‰æ‹©                       â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">4.</span> ç½‘ç»œéªŒè¯                            â”‚
â”‚    - è§¦å‘NetworkMonitoréªŒè¯            â”‚
â”‚    - å¤„ç†Captive Portal               â”‚
â”‚    - ç®¡ç†éƒ¨åˆ†è¿æ¥çŠ¶æ€                   â”‚
â”‚                                        â”‚
â”‚ <span class="hljs-number">5.</span> åº”ç”¨ç½‘ç»œæƒé™                         â”‚
â”‚    - <span class="hljs-built_in">UID</span>ç½‘ç»œè®¿é—®æ§åˆ¶                    â”‚
â”‚    - åå°æ•°æ®é™åˆ¶                       â”‚
â”‚    - VPNéš§é“ç®¡ç†                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-5">1.2 æ•´ä½“æ¶æ„</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424ee010e395475da12c022ee30aad87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770207627&amp;x-signature=tjXJzYy5buG2mXRro1kDAt7b2co%3D" alt="07-01-connectivityservice-architecture.png" loading="lazy"/></p>
<p><strong>æ¶æ„åˆ†å±‚è¯´æ˜</strong>ï¼š</p>
<h4 data-id="heading-6"><strong>åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨ä½¿ç”¨ConnectivityManager API</span>
<span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> (ConnectivityManager)
    context.getSystemService(Context.CONNECTIVITY_SERVICE);

<span class="hljs-comment">// è¯·æ±‚ç½‘ç»œ</span>
<span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
    .addCapability(NetworkCapabilities.NET_CAPABILITY_INTERNET)
    .addTransportType(NetworkCapabilities.TRANSPORT_WIFI)
    .build();

cm.requestNetwork(request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
        <span class="hljs-comment">// ç½‘ç»œå¯ç”¨</span>
    }
});
</code></pre>
<h4 data-id="heading-7"><strong>Frameworkå±‚ï¼ˆConnectivityServiceæ ¸å¿ƒï¼‰</strong></h4>
<p>ConnectivityServiceæºç ä½ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">packages/modules/Connectivity/service/src/com/android/server/ConnectivityService.java
</code></pre>
<p><strong>æ ¸å¿ƒæ•°æ®ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// frameworks/.../ConnectivityService.java (ç²¾ç®€ç‰ˆ)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectivityService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IConnectivityManager</span>.Stub {

    <span class="hljs-comment">// æ‰€æœ‰NetworkAgentçš„é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HashMap&lt;Messenger, NetworkAgentInfo&gt; mNetworkAgentInfos =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-comment">// æ‰€æœ‰NetworkRequestçš„é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SparseArray&lt;NetworkRequestInfo&gt; mNetworkRequests =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparseArray</span>&lt;&gt;();

    <span class="hljs-comment">// æ‰€æœ‰NetworkFactoryçš„é›†åˆ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;NetworkFactoryInfo&gt; mNetworkFactoryInfos =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-comment">// å½“å‰é»˜è®¤ç½‘ç»œ</span>
    <span class="hljs-keyword">private</span> NetworkAgentInfo mDefaultNetwork;

    <span class="hljs-comment">// ç½‘ç»œè¯„åˆ†å™¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> NetworkRanker mNetworkRanker;

    <span class="hljs-comment">// æƒé™ç›‘æ§</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PermissionMonitor mPermissionMonitor;

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šæ³¨å†ŒNetworkAgent</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerNetworkAgent</span><span class="hljs-params">(Messenger messenger,
                                     NetworkInfo networkInfo,
                                     LinkProperties linkProperties,
                                     NetworkCapabilities networkCapabilities,
                                     <span class="hljs-type">int</span> currentScore,
                                     NetworkAgentConfig networkAgentConfig,
                                     <span class="hljs-type">int</span> factorySerialNumber)</span> {

        <span class="hljs-comment">// 1. åˆ›å»ºNetworkAgentInfo</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">NetworkAgentInfo</span> <span class="hljs-variable">nai</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkAgentInfo</span>(
            messenger, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncChannel</span>(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Network</span>(mNextNetworkId++),
            networkInfo, linkProperties,
            networkCapabilities, currentScore,
            mContext, mHandler,
            networkAgentConfig, <span class="hljs-built_in">this</span>,
            mNetd, mDnsResolver,
            mNMS, factorySerialNumber);

        <span class="hljs-comment">// 2. åˆ†é…NetId</span>
        <span class="hljs-keyword">try</span> {
            mNetd.networkCreate(nai.network.netId,
                               NativeNetworkType.PHYSICAL);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            loge(<span class="hljs-string">"Error creating network "</span> + nai.network.netId);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 3. æ·»åŠ åˆ°ç®¡ç†åˆ—è¡¨</span>
        mNetworkAgentInfos.put(messenger, nai);

        <span class="hljs-comment">// 4. é€šçŸ¥NetworkMonitorå¼€å§‹éªŒè¯</span>
        nai.networkMonitor.start();

        <span class="hljs-comment">// 5. åŒ¹é…NetworkRequest</span>
        rematchNetworkAndRequests(nai, ReapUnvalidatedNetworks.DONT_REAP);
    }

    <span class="hljs-comment">// æ ¸å¿ƒæ–¹æ³•ï¼šå¤„ç†NetworkRequest</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestNetwork</span><span class="hljs-params">(NetworkCapabilities nc,
                               Messenger messenger,
                               <span class="hljs-type">int</span> timeoutMs,
                               IBinder binder,
                               <span class="hljs-type">int</span> legacyType,
                               <span class="hljs-meta">@CallbackFlags</span> <span class="hljs-type">int</span> callbackFlags)</span> {

        <span class="hljs-comment">// 1. æƒé™æ£€æŸ¥</span>
        enforceAccessPermission();

        <span class="hljs-comment">// 2. åˆ›å»ºNetworkRequestInfo</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">NetworkRequestInfo</span> <span class="hljs-variable">nri</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequestInfo</span>(
            messenger, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>(nc, legacyType,
            nextNetworkRequestId(), NetworkRequest.Type.REQUEST),
            binder);

        <span class="hljs-comment">// 3. ä¿å­˜è¯·æ±‚</span>
        mNetworkRequests.put(nri.request.requestId, nri);

        <span class="hljs-comment">// 4. å‘é€ç»™æ‰€æœ‰NetworkFactory</span>
        <span class="hljs-keyword">for</span> (NetworkFactoryInfo nfi : mNetworkFactoryInfos) {
            nfi.asyncChannel.sendMessage(
                android.net.NetworkFactory.CMD_REQUEST_NETWORK,
                nri.request);
        }

        <span class="hljs-comment">// 5. å°è¯•åŒ¹é…ç°æœ‰ç½‘ç»œ</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">NetworkAgentInfo</span> <span class="hljs-variable">bestNetwork</span> <span class="hljs-operator">=</span>
            getBestNetwork(nri.request, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span> (bestNetwork != <span class="hljs-literal">null</span>) {
            callCallbackForRequest(nri, bestNetwork,
                                  ConnectivityManager.CALLBACK_AVAILABLE);
        }
    }
}
</code></pre>
<h3 data-id="heading-8">1.3 ä¸å…¶ä»–ç³»ç»ŸæœåŠ¡çš„å…³ç³»</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ConnectivityService                â”‚
â”‚              (æ ¸å¿ƒåè°ƒè€…)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚          â”‚          â”‚
    â–¼         â–¼         â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚NetworkStackâ”‚Netd â”‚ â”‚Telephonyâ”‚ <span class="hljs-built_in">WiFi</span> â”‚ â”‚VpnManager
â”‚        â”‚ â”‚      â”‚ â”‚Service â”‚ |Serviceâ”‚ â”‚        â”‚
â”‚éªŒè¯ç½‘ç»œ  â”‚ â”‚è·¯ç”±  â”‚ â”‚èœ‚çªç½‘ç»œ â”‚ |æ— çº¿   â”‚  â”‚VPNéš§é“  â”‚
â”‚        â”‚ â”‚é…ç½®   â”‚ â”‚        â”‚|      â”‚  â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å…³é”®äº¤äº’</strong>ï¼š</p>
<ol>
<li><strong>ä¸NetworkStackäº¤äº’</strong> - ç½‘ç»œéªŒè¯</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ConnectivityServiceè§¦å‘éªŒè¯</span>
nai.networkMonitor.notifyNetworkConnected(
    nai.linkProperties, nai.networkCapabilities);

<span class="hljs-comment">// NetworkStackæ‰§è¡ŒHTTPæ¢æµ‹</span>
<span class="hljs-comment">// è¿”å›éªŒè¯ç»“æœ(VALID/PORTAL/INVALID)</span>
</code></pre>
<ol start="2">
<li><strong>ä¸Netdäº¤äº’</strong> - è·¯ç”±é…ç½®</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è®¾ç½®é»˜è®¤ç½‘ç»œ</span>
mNetd.networkSetDefault(nai.network.netId);

<span class="hljs-comment">// æ·»åŠ è·¯ç”±è§„åˆ™</span>
mNetd.networkAddRoute(netId, ifname, destination, nexthop);
</code></pre>
<ol start="3">
<li><strong>ä¸TelephonyServiceäº¤äº’</strong> - ç§»åŠ¨ç½‘ç»œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¯·æ±‚ç§»åŠ¨æ•°æ®è¿æ¥</span>
telephonyNetworkFactory.needNetworkFor(request);

<span class="hljs-comment">// æ¥æ”¶æ•°æ®è¿æ¥çŠ¶æ€å˜åŒ–</span>
onDataConnectionStateChanged(state, networkType);
</code></pre>
<h3 data-id="heading-9">1.4 Android 15çš„æ¶æ„æ”¹è¿›</h3>
<h4 data-id="heading-10"><strong>æ”¹è¿›1ï¼šæ¨¡å—åŒ–NetworkStack</strong></h4>
<p>Android 10å¼€å§‹ï¼ŒNetworkStackä»system_serverç‹¬ç«‹ä¸ºå•ç‹¬è¿›ç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">Android 9åŠä¹‹å‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    system<span class="hljs-emphasis">_server       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ConnectivityServiceâ”‚  â”‚
â”‚  â”‚  + NetworkMonitor â”‚  â”‚ â† éªŒè¯é€»è¾‘è€¦åˆ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Android 10+:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    system_</span>server       â”‚     â”‚NetworkStack  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  è¿›ç¨‹         â”‚
â”‚  â”‚ConnectivityServiceâ”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ AIDLâ”‚â”‚NetworkMonitorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
<span class="hljs-code">                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘ å¯ç‹¬ç«‹æ›´æ–°
</span></code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<ul>
<li>NetworkStackå¯é€šè¿‡APKæ›´æ–°ï¼Œæ— éœ€OTA</li>
<li>éš”ç¦»æ•…éšœï¼ŒNetworkStackå´©æºƒä¸å½±å“system_server</li>
<li>æ›´å¥½çš„å®‰å…¨è¾¹ç•Œ</li>
</ul>
<h4 data-id="heading-11"><strong>æ”¹è¿›2ï¼šeBPFç½‘ç»œç­–ç•¥</strong></h4>
<p>Android 15ä½¿ç”¨eBPFæ›¿ä»£iptablesï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// kernel BPFç¨‹åº - å¿«é€Ÿæ•°æ®åŒ…è¿‡æ»¤</span>
SEC(<span class="hljs-string">"cgroup/sock"</span>)
<span class="hljs-type">int</span> <span class="hljs-title function_">bpf_cgroup_sock_filter</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> bpf_sock *sk)</span> {
    __u32 uid = bpf_get_current_uid_gid();

    <span class="hljs-comment">// æŸ¥è¯¢UIDæ˜¯å¦å…è®¸è®¿é—®ç½‘ç»œ</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uid_permission_value</span> *<span class="hljs-title">value</span> =</span>
        bpf_map_lookup_elem(&amp;uid_permission_map, &amp;uid);

    <span class="hljs-keyword">if</span> (value &amp;&amp; value-&gt;permission == PERMISSION_DENIED)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ‹’ç»è¿æ¥</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// å…è®¸è¿æ¥</span>
}
</code></pre>
<p><strong>æ€§èƒ½æå‡</strong>ï¼š</p>
<ul>
<li>iptablesè§„åˆ™åŒ¹é…ï¼šO(n)</li>
<li>eBPFå“ˆå¸ŒæŸ¥æ‰¾ï¼šO(1)</li>
<li>å»¶è¿Ÿé™ä½ï¼š~100Î¼s â†’ ~10Î¼s</li>
</ul>
<h4 data-id="heading-12"><strong>æ”¹è¿›3ï¼šMulti-Network APIå¢å¼º</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Android 15æ–°å¢ï¼šç½‘ç»œåˆ‡ç‰‡(Network Slicing)æ”¯æŒ</span>
<span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
    .addCapability(NET_CAPABILITY_ENTERPRISE)  <span class="hljs-comment">// ä¼ä¸šä¸“ç½‘</span>
    .setEnterpriseId(NET_ENTERPRISE_ID_1)      <span class="hljs-comment">// åˆ‡ç‰‡ID</span>
    .build();

<span class="hljs-comment">// 5Gç½‘ç»œåˆ‡ç‰‡å¯ä»¥ä¸ºä¸åŒä¸šåŠ¡æä¾›å·®å¼‚åŒ–QoS</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">äºŒã€NetworkAgentæœºåˆ¶æ·±åº¦è§£æ</h2>
<h3 data-id="heading-14">2.1 NetworkAgentæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><strong>NetworkAgent</strong>æ˜¯ç½‘ç»œæä¾›è€…ï¼ˆå¦‚WiFiã€Cellularã€Ethernetã€VPNï¼‰ä¸ConnectivityServiceä¹‹é—´çš„"ä¿¡ä½¿"ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">WiFi</span>åº•å±‚é©±åŠ¨
    â†“
<span class="hljs-built_in">WiFiNetworkAgent</span> (ç»§æ‰¿NetworkAgent)
    â†“ Messengeré€šä¿¡
ConnectivityService
</code></pre>
<h3 data-id="heading-15">2.2 NetworkAgentç”Ÿå‘½å‘¨æœŸ</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca7e77cfb92d4126a7313de48768dae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770207627&amp;x-signature=gKkU%2FnrZvJp7TwzFeV%2B%2FRB9HLPU%3D" alt="07-02-network-state-machine.png" loading="lazy"/></p>
<p><strong>9ç§æ ¸å¿ƒçŠ¶æ€è¯¦è§£</strong>ï¼š</p>
<h4 data-id="heading-16"><strong>1. DISCONNECTEDï¼ˆæ–­å¼€ï¼‰</strong></h4>
<ul>
<li>åˆå§‹çŠ¶æ€ï¼ŒNetworkAgentå°šæœªåˆ›å»º</li>
<li>æˆ–ç½‘ç»œå·²å®Œå…¨é”€æ¯</li>
</ul>
<h4 data-id="heading-17"><strong>2. CONNECTINGï¼ˆè¿æ¥ä¸­ï¼‰</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// WiFiNetworkAgentåˆ›å»ºæ—¶</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WiFiNetworkAgent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkAgent</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WiFiNetworkAgent</span><span class="hljs-params">(Context context, ...)</span> {
        <span class="hljs-built_in">super</span>(context, looper, TAG,
              networkInfo,        <span class="hljs-comment">// åˆå§‹çŠ¶æ€ï¼šCONNECTING</span>
              networkCapabilities,
              linkProperties,
              networkScore,
              config);
    }
}
</code></pre>
<h4 data-id="heading-18"><strong>3. CONNECTEDï¼ˆå·²è¿æ¥ï¼‰</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç‰©ç†è¿æ¥å»ºç«‹åï¼ŒAgentä¸ŠæŠ¥</span>
sendLinkProperties(linkProperties);
sendNetworkCapabilities(networkCapabilities);
sendNetworkScore(score);

<span class="hljs-comment">// ConnectivityServiceæ”¶åˆ°åæ›´æ–°çŠ¶æ€ â†’ CONNECTED</span>
</code></pre>
<h4 data-id="heading-19"><strong>4. VALIDATINGï¼ˆéªŒè¯ä¸­ï¼‰</strong></h4>
<p>ConnectivityServiceè‡ªåŠ¨è§¦å‘NetworkMonitorï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// packages/modules/NetworkStack/.../NetworkMonitor.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyNetworkConnected</span><span class="hljs-params">(LinkProperties lp,
                                   NetworkCapabilities nc)</span> {
    <span class="hljs-comment">// 1. HTTPæ¢æµ‹</span>
    <span class="hljs-type">ValidationProbeEvent</span> <span class="hljs-variable">probeResult</span> <span class="hljs-operator">=</span>
        isCaptivePortal(mCleartextDnsNetwork);

    <span class="hljs-comment">// 2. HTTPSæ¢æµ‹</span>
    probeResult = httpsProbe();

    <span class="hljs-comment">// 3. DNSæ¢æµ‹</span>
    probeResult = sendDnsProbe(mPrivateDnsProviderHostname);

    <span class="hljs-comment">// 4. è¿”å›éªŒè¯ç»“æœ</span>
    <span class="hljs-keyword">if</span> (allProbesSucceeded) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationResult</span>(
            NetworkValidationResult.VALID, ...);
    }
}
</code></pre>
<p><strong>éªŒè¯URLï¼ˆå¯é…ç½®ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># HTTP</span>
http://connectivitycheck.gstatic.com/generate_204

<span class="hljs-comment"># HTTPS</span>
https://www.google.com/generate_204

<span class="hljs-comment"># è¿”å›HTTP 204è¡¨ç¤ºéªŒè¯é€šè¿‡</span>
</code></pre>
<h4 data-id="heading-20"><strong>5. VALIDATEDï¼ˆå·²éªŒè¯ï¼‰</strong></h4>
<p>éªŒè¯é€šè¿‡åï¼Œç½‘ç»œæˆä¸º"å€™é€‰é»˜è®¤ç½‘ç»œ"ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ConnectivityService.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateNetworkInfo</span><span class="hljs-params">(NetworkAgentInfo nai, NetworkInfo info)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">oldScore</span> <span class="hljs-operator">=</span> nai.getCurrentScore();

    <span class="hljs-keyword">if</span> (info.getDetailedState() == NetworkInfo.DetailedState.CONNECTED) {
        <span class="hljs-comment">// ç½‘ç»œéªŒè¯é€šè¿‡ï¼Œæå‡è¯„åˆ†</span>
        nai.setScore(oldScore + <span class="hljs-number">10</span>);

        <span class="hljs-comment">// é‡æ–°è¯„ä¼°é»˜è®¤ç½‘ç»œ</span>
        rematchAllNetworksAndRequests();
    }
}
</code></pre>
<h4 data-id="heading-21"><strong>6. CAPTIVE_PORTALï¼ˆå¼ºåˆ¶é—¨æˆ·ï¼‰</strong></h4>
<p>æ£€æµ‹åˆ°éœ€è¦ç½‘é¡µç™»å½•ï¼ˆå¦‚å…¬å…±WiFiï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkMonitoræ£€æµ‹åˆ°HTTP 302é‡å®šå‘</span>
<span class="hljs-keyword">if</span> (probeResult.isPortal()) {
    <span class="hljs-comment">// æ˜¾ç¤ºç™»å½•é€šçŸ¥</span>
    showSignInNotification(nai);

    <span class="hljs-comment">// ç­‰å¾…ç”¨æˆ·ç™»å½•åé‡æ–°éªŒè¯</span>
    scheduleReevaluation(REEVALUATION_DELAY_MS);
}
</code></pre>
<p>ç”¨æˆ·ä½“éªŒï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è¿æ¥WiFi
<span class="hljs-bullet">2.</span> ç³»ç»Ÿæ£€æµ‹åˆ°å¼ºåˆ¶é—¨æˆ·
<span class="hljs-bullet">3.</span> å¼¹å‡ºé€šçŸ¥ï¼š"éœ€è¦ç™»å½•WiFiç½‘ç»œ"
<span class="hljs-bullet">4.</span> ç‚¹å‡»é€šçŸ¥æ‰“å¼€ç™»å½•é¡µé¢
<span class="hljs-bullet">5.</span> ç™»å½•æˆåŠŸåè‡ªåŠ¨é‡æ–°éªŒè¯
<span class="hljs-bullet">6.</span> çŠ¶æ€å˜ä¸ºVALIDATED
</code></pre>
<h4 data-id="heading-22"><strong>7. LOSINGï¼ˆå³å°†ä¸¢å¤±ï¼‰</strong></h4>
<p>Lingeræœºåˆ¶ - ç»™åº”ç”¨è¿ç§»æ—¶é—´ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// packages/modules/Connectivity/.../ConnectivityService.java</span>

<span class="hljs-comment">// å½“æ›´å¥½çš„ç½‘ç»œå‡ºç°æ—¶</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLingerComplete</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-comment">// Lingerå€’è®¡æ—¶å¼€å§‹ï¼ˆé»˜è®¤30ç§’ï¼‰</span>
    nai.lingerExpiryMs = SystemClock.elapsedRealtime()
                        + mLingerDelayMs;

    <span class="hljs-comment">// é€šçŸ¥åº”ç”¨ç½‘ç»œå³å°†å¤±å»</span>
    <span class="hljs-keyword">for</span> (NetworkRequestInfo nri : nai.networkRequests) {
        callCallbackForRequest(nri, nai,
            ConnectivityManager.CALLBACK_LOSING,
            mLingerDelayMs);
    }
}
</code></pre>
<p>åº”ç”¨å¯ä»¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨æ”¶åˆ°CALLBACK_LOSING</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLosing</span><span class="hljs-params">(Network network, <span class="hljs-type">int</span> maxMsToLive)</span> {
    <span class="hljs-comment">// è¿˜æœ‰maxMsToLiveæ¯«ç§’ï¼Œå¿«é€Ÿè¿ç§»è¿æ¥</span>
    <span class="hljs-keyword">if</span> (maxMsToLive &gt; <span class="hljs-number">0</span> &amp;&amp; maxMsToLive &lt; <span class="hljs-number">30000</span>) {
        <span class="hljs-comment">// å°†TCPè¿æ¥è¿ç§»åˆ°æ–°ç½‘ç»œ</span>
        migrateConnectionsToNewNetwork();
    }
}
</code></pre>
<h4 data-id="heading-23"><strong>8. SUSPENDEDï¼ˆæš‚åœï¼‰</strong></h4>
<p>ç½‘ç»œç‰©ç†å¯ç”¨ä½†é€»è¾‘æš‚åœï¼ˆå¦‚é£è¡Œæ¨¡å¼ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¿›å…¥é£è¡Œæ¨¡å¼</span>
when (Intent.ACTION_AIRPLANE_MODE_CHANGED) {
    <span class="hljs-keyword">if</span> (isAirplaneModeOn) {
        <span class="hljs-comment">// æš‚åœæ‰€æœ‰ç½‘ç»œï¼ˆé™¤äº†local-onlyï¼‰</span>
        <span class="hljs-keyword">for</span> (NetworkAgentInfo nai : mNetworkAgentInfos.values()) {
            <span class="hljs-keyword">if</span> (!nai.isLocalNetwork()) {
                nai.networkInfo.setDetailedState(
                    NetworkInfo.DetailedState.SUSPENDED,
                    <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-24"><strong>9. DISCONNECTINGï¼ˆæ–­å¼€ä¸­ï¼‰</strong></h4>
<p>ä¸»åŠ¨æˆ–è¢«åŠ¨æ–­å¼€ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸»åŠ¨æ–­å¼€</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// Agenté€šçŸ¥ConnectivityService</span>
    mAsyncChannel.sendMessage(CMD_NETWORK_DISCONNECT);
}

<span class="hljs-comment">// ConnectivityServiceå¤„ç†</span>
<span class="hljs-keyword">case</span> CMD_NETWORK_DISCONNECT:
    <span class="hljs-comment">// 1. ç§»é™¤è·¯ç”±</span>
    mNetd.networkDestroy(nai.network.netId);

    <span class="hljs-comment">// 2. é€šçŸ¥åº”ç”¨</span>
    callCallbackForRequest(nri, nai, CALLBACK_LOST);

    <span class="hljs-comment">// 3. æ¸…ç†Agent</span>
    mNetworkAgentInfos.remove(nai.messenger);
    <span class="hljs-keyword">break</span>;
</code></pre>
<h3 data-id="heading-25">2.3 NetworkAgentå®ç°ç¤ºä¾‹ï¼šWiFiNetworkAgent</h3>
<p>æºç ä½ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">packages/modules/Wifi/service/java/com/android/server/wifi/WifiNetworkAgent.java
</code></pre>
<p><strong>åˆ›å»ºè¿‡ç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// frameworks/.../WifiNetworkAgent.java (ç®€åŒ–ç‰ˆ)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WifiNetworkAgent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkAgent</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WifiInfo mWifiInfo;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WifiNetworkAgent</span><span class="hljs-params">(Context context, Looper looper,
                           WifiInfo wifiInfo,
                           NetworkCapabilities nc,
                           LinkProperties lp,
                           NetworkScore score)</span> {
        <span class="hljs-built_in">super</span>(context, looper, <span class="hljs-string">"WifiNetworkAgent"</span>,
              nc, lp, score, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkAgentConfig</span>.Builder().build(),
              NetworkProvider.ID_WIFI);

        mWifiInfo = wifiInfo;
        register();  <span class="hljs-comment">// å‘ConnectivityServiceæ³¨å†Œ</span>
    }

    <span class="hljs-comment">// å½“WiFiè¿æ¥ä¿¡æ¯å˜åŒ–æ—¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNetworkCapabilities</span><span class="hljs-params">(NetworkCapabilities nc)</span> {
        <span class="hljs-comment">// æ›´æ–°WiFiç‰¹å®šèƒ½åŠ›</span>
        nc.setSignalStrength(mWifiInfo.getRssi());
        nc.setLinkUpstreamBandwidthKbps(
            mWifiInfo.getLinkSpeed() * <span class="hljs-number">1000</span>);

        <span class="hljs-built_in">super</span>.sendNetworkCapabilities(nc);
    }

    <span class="hljs-comment">// å½“IPé…ç½®å®Œæˆæ—¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendLinkProperties</span><span class="hljs-params">(LinkProperties lp)</span> {
        <span class="hljs-comment">// WiFiæ¥å£å</span>
        lp.setInterfaceName(mWifiInfo.getInterfaceName());

        <span class="hljs-comment">// IPåœ°å€</span>
        lp.addLinkAddress(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkAddress</span>(ipAddress, prefixLength));

        <span class="hljs-comment">// DNSæœåŠ¡å™¨</span>
        <span class="hljs-keyword">for</span> (InetAddress dns : dnsServers) {
            lp.addDnsServer(dns);
        }

        <span class="hljs-comment">// è·¯ç”±</span>
        lp.addRoute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RouteInfo</span>(destination, gateway, ifname));

        <span class="hljs-built_in">super</span>.sendLinkProperties(lp);
    }
}
</code></pre>
<p><strong>çŠ¶æ€ä¸ŠæŠ¥æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">WiFié©±åŠ¨: DHCPæˆåŠŸè·å–IP
    â†“
WifiStateMachine: è§£æIPé…ç½®
    â†“
WifiNetworkAgent.<span class="hljs-built_in">sendLinkProperties</span>(lp)
    â†“
NetworkAgent.<span class="hljs-built_in">sendMessage</span>(EVENT_NETWORK_PROPERTIES_CHANGED, lp)
    â†“
ConnectivityServiceæ”¶åˆ°æ¶ˆæ¯
    â†“
<span class="hljs-built_in">updateLinkProperties</span>(nai, lp)
    â†“
è§¦å‘NetworkMonitoréªŒè¯
    â†“
<span class="hljs-built_in">notifyNetworkCallbacks</span>(CALLBACK_IP_CHANGED)
    â†“
åº”ç”¨æ”¶åˆ°<span class="hljs-built_in">onLinkPropertiesChanged</span>()å›è°ƒ
</code></pre>
<hr/>
<h2 data-id="heading-26">ä¸‰ã€NetworkFactoryå·¥ä½œåŸç†</h2>
<h3 data-id="heading-27">3.1 NetworkFactoryçš„è§’è‰²</h3>
<p><strong>NetworkFactory</strong>æ˜¯"ç½‘ç»œå·¥å‚"ï¼Œè´Ÿè´£æŒ‰éœ€åˆ›å»ºç½‘ç»œè¿æ¥ã€‚</p>
<pre><code class="hljs language-vbnet" lang="vbnet">åº”ç”¨è¯·æ±‚ï¼š<span class="hljs-string">"æˆ‘éœ€è¦WiFiç½‘ç»œ"</span>
    â†“
<span class="hljs-symbol">ConnectivityService:</span> <span class="hljs-string">"å“ªä¸ªFactoryèƒ½æä¾›WiFi?"</span>
    â†“
<span class="hljs-symbol">WiFiNetworkFactory:</span> <span class="hljs-string">"æˆ‘å¯ä»¥ï¼"</span>
    â†“
WiFiNetworkFactoryæ¿€æ´»WiFiè¿æ¥
    â†“
åˆ›å»ºWifiNetworkAgentå¹¶æ³¨å†Œ
</code></pre>
<h3 data-id="heading-28">3.2 Factoryæ³¨å†Œä¸è¯„åˆ†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// packages/modules/Wifi/.../WifiNetworkFactory.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WifiNetworkFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NetworkFactory</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">WifiNetworkFactory</span><span class="hljs-params">(Looper looper, Context context, ...)</span> {
        <span class="hljs-built_in">super</span>(looper, context, <span class="hljs-string">"WifiNetworkFactory"</span>,
              <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCapabilities</span>.Builder()
                  .addTransportType(TRANSPORT_WIFI)
                  .addCapability(NET_CAPABILITY_INTERNET)
                  .addCapability(NET_CAPABILITY_NOT_RESTRICTED)
                  .build());

        <span class="hljs-comment">// æ³¨å†Œåˆ°ConnectivityService</span>
        register();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">needNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// æ”¶åˆ°ConnectivityServiceçš„ç½‘ç»œè¯·æ±‚</span>

        <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦èƒ½æ»¡è¶³è¯·æ±‚</span>
        <span class="hljs-keyword">if</span> (!request.hasCapability(NET_CAPABILITY_INTERNET)) {
            <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// ä¸å¤„ç†</span>
        }

        <span class="hljs-comment">// 2. å¯åŠ¨WiFiæ‰«æ</span>
        mWifiManager.startScan();

        <span class="hljs-comment">// 3. è¿æ¥æœ€ä½³AP</span>
        <span class="hljs-type">WifiConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> selectBestNetwork(scanResults);
        mWifiManager.connect(config, <span class="hljs-literal">null</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseNetworkFor</span><span class="hljs-params">(NetworkRequest request)</span> {
        <span class="hljs-comment">// NetworkRequestè¢«å–æ¶ˆï¼Œå¯ä»¥æ–­å¼€WiFi</span>
        <span class="hljs-keyword">if</span> (noMoreRequests()) {
            mWifiManager.disconnect();
        }
    }
}
</code></pre>
<h3 data-id="heading-29">3.3 NetworkRequeståŒ¹é…æœºåˆ¶</h3>
<p><strong>NetworkCapabilitiesåŒ¹é…è§„åˆ™</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkCapabilities.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">satisfiedByNetworkCapabilities</span><span class="hljs-params">(NetworkCapabilities nc)</span> {
    <span class="hljs-comment">// 1. Transportç±»å‹å¿…é¡»åŒ¹é…</span>
    <span class="hljs-keyword">if</span> ((mTransportTypes &amp; nc.mTransportTypes) != mTransportTypes) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 2. å¿…é¡»çš„Capabilityéƒ½è¦æœ‰</span>
    <span class="hljs-keyword">if</span> ((mNetworkCapabilities &amp; nc.mNetworkCapabilities)
        != mNetworkCapabilities) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 3. ç¦æ­¢çš„Capabilityä¸èƒ½æœ‰</span>
    <span class="hljs-keyword">if</span> ((mUnwantedNetworkCapabilities &amp; nc.mNetworkCapabilities) != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 4. é“¾è·¯ä¸Šä¸‹è¡Œå¸¦å®½æ»¡è¶³è¦æ±‚</span>
    <span class="hljs-keyword">if</span> (getLinkDownstreamBandwidthKbps() &gt;
        nc.getLinkDownstreamBandwidthKbps()) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šå¤æ‚NetworkRequest</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨è¯·æ±‚ï¼šé«˜é€Ÿã€éè®¡è´¹ã€WiFiç›´è¿ç½‘ç»œ</span>
<span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
    .addCapability(NET_CAPABILITY_INTERNET)
    .addCapability(NET_CAPABILITY_NOT_METERED)  <span class="hljs-comment">// éè®¡è´¹</span>
    .addTransportType(TRANSPORT_WIFI)           <span class="hljs-comment">// å¿…é¡»WiFi</span>
    .setLinkDownstreamBandwidthKbps(<span class="hljs-number">10000</span>)      <span class="hljs-comment">// è‡³å°‘10Mbps</span>
    .setNetworkSpecifier(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WifiNetworkSpecifier</span>.Builder()
        .setSsid(<span class="hljs-string">"MyNetwork"</span>)                   <span class="hljs-comment">// æŒ‡å®šSSID</span>
        .build())
    .build();

cm.requestNetwork(request, callback);
</code></pre>
<p><strong>ConnectivityServiceåŒ¹é…è¿‡ç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ConnectivityService.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendUpdatedScoreToFactories</span><span class="hljs-params">(NetworkRequest request)</span> {
    <span class="hljs-comment">// éå†æ‰€æœ‰Factory</span>
    <span class="hljs-keyword">for</span> (NetworkFactoryInfo nfi : mNetworkFactoryInfos) {

        <span class="hljs-comment">// è®¡ç®—è¯¥Factoryå¯¹è¿™ä¸ªRequestçš„åŒ¹é…å¾—åˆ†</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> nfi.networkCapabilities
            .calculateScore(request.networkCapabilities);

        <span class="hljs-comment">// å‘é€REQUEST_NETWORKæ¶ˆæ¯ï¼Œé™„å¸¦åˆ†æ•°</span>
        nfi.asyncChannel.sendMessage(CMD_REQUEST_NETWORK,
                                     score, <span class="hljs-number">0</span>, request);
    }
}
</code></pre>
<h3 data-id="heading-30">3.4 Factoryç«äº‰æœºåˆ¶</h3>
<p>å½“å¤šä¸ªFactoryéƒ½èƒ½æ»¡è¶³è¯·æ±‚æ—¶ï¼Œé€šè¿‡è¯„åˆ†ç«äº‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkFactory.java</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
    <span class="hljs-keyword">switch</span> (msg.what) {
        <span class="hljs-keyword">case</span> CMD_REQUEST_NETWORK:
            <span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (NetworkRequest) msg.obj;
            <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> msg.arg1;

            <span class="hljs-comment">// å¦‚æœåˆ†æ•°ä¸º0ï¼Œè¯´æ˜ä¸åŒ¹é…ï¼Œé‡Šæ”¾ç½‘ç»œ</span>
            <span class="hljs-keyword">if</span> (score == <span class="hljs-number">0</span>) {
                releaseNetworkFor(request);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// åˆ†æ•°è¶Šé«˜ï¼Œè¶Šåº”è¯¥ç§¯æå“åº”</span>
                <span class="hljs-keyword">if</span> (score &gt; mCurrentScore) {
                    needNetworkFor(request);
                }
            }
            <span class="hljs-keyword">break</span>;
    }
}
</code></pre>
<p><strong>å®é™…åœºæ™¯</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ç”¨æˆ·è¯·æ±‚ï¼šè”ç½‘ä½†ä¸æŒ‡å®šç±»å‹

WiFiNetworkFactoryæ”¶åˆ°:
  - <span class="hljs-attr">score</span> = <span class="hljs-number">60</span> (WiFiå·²è¿æ¥)
  - æ— éœ€æ“ä½œï¼ŒWiFiå·²æ¿€æ´»

TelephonyNetworkFactoryæ”¶åˆ°:
  - <span class="hljs-attr">score</span> = <span class="hljs-number">50</span> (ç§»åŠ¨æ•°æ®å¯ç”¨ä½†æœªè¿æ¥)
  - score &lt; WiFiï¼Œä¸æ¿€æ´»ç§»åŠ¨æ•°æ®

VpnNetworkFactoryæ”¶åˆ°:
  - <span class="hljs-attr">score</span> = <span class="hljs-number">0</span> (VPNæ— æ³•æ»¡è¶³æ™®é€šè¯·æ±‚)
  - é‡Šæ”¾VPNè¯·æ±‚(å¦‚æœæœ‰)

æœ€ç»ˆï¼šä½¿ç”¨WiFiç½‘ç»œ
</code></pre>
<hr/>
<h2 data-id="heading-31">å››ã€WiFiä¸ç§»åŠ¨ç½‘ç»œåˆ‡æ¢</h2>
<h3 data-id="heading-32">4.1 åˆ‡æ¢è§¦å‘æ¡ä»¶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ConnectivityService.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rematchAllNetworksAndRequests</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. é‡æ–°è¯„ä¼°æ‰€æœ‰ç½‘ç»œ</span>
    <span class="hljs-keyword">for</span> (NetworkAgentInfo nai : mNetworkAgentInfos.values()) {
        updateNetworkScore(nai);
    }

    <span class="hljs-comment">// 2. é‡æ–°é€‰æ‹©æœ€ä½³ç½‘ç»œ</span>
    <span class="hljs-type">NetworkAgentInfo</span> <span class="hljs-variable">newDefault</span> <span class="hljs-operator">=</span> getBestNetwork();

    <span class="hljs-comment">// 3. å¦‚æœé»˜è®¤ç½‘ç»œå˜åŒ–</span>
    <span class="hljs-keyword">if</span> (newDefault != mDefaultNetwork) {
        <span class="hljs-comment">// è§¦å‘åˆ‡æ¢</span>
        makeDefault(newDefault);
    }
}
</code></pre>
<p><strong>å¸¸è§è§¦å‘åœºæ™¯</strong>ï¼š</p>



































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">è§¦å‘æ¡ä»¶</th><th align="left">åˆ‡æ¢æ–¹å‘</th></tr></thead><tbody><tr><td align="left">WiFiä¿¡å·å˜å¼±</td><td align="left">RSSI &lt; -75dBm</td><td align="left">WiFi â†’ ç§»åŠ¨ç½‘ç»œ</td></tr><tr><td align="left">WiFiéªŒè¯å¤±è´¥</td><td align="left">HTTPæ¢æµ‹å¤±è´¥</td><td align="left">WiFi â†’ ç§»åŠ¨ç½‘ç»œ</td></tr><tr><td align="left">ç§»åŠ¨æ•°æ®æ‰“å¼€</td><td align="left">ç”¨æˆ·æ‰‹åŠ¨å¯ç”¨</td><td align="left">æ—  â†’ ç§»åŠ¨ç½‘ç»œ</td></tr><tr><td align="left">è¿æ¥åˆ°æ›´å¥½çš„WiFi</td><td align="left">æ–°WiFi RSSIæ›´é«˜</td><td align="left">ç§»åŠ¨ç½‘ç»œ â†’ WiFi</td></tr><tr><td align="left">ç§»å‡ºWiFiè¦†ç›–</td><td align="left">WiFiæ–­å¼€</td><td align="left">WiFi â†’ ç§»åŠ¨ç½‘ç»œ</td></tr></tbody></table>
<h3 data-id="heading-33">4.2 NetworkRankerè¯„åˆ†ç®—æ³•</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// packages/modules/Connectivity/.../NetworkRanker.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRanker</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">rankNetwork</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-comment">// 1. åŸºç¡€åˆ†æ•°ï¼ˆTransportç±»å‹ï¼‰</span>
        <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasTransport(TRANSPORT_WIFI)) {
            score += <span class="hljs-number">60</span>;  <span class="hljs-comment">// WiFiåŸºç¡€åˆ†60</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasTransport(TRANSPORT_CELLULAR)) {
            score += <span class="hljs-number">50</span>;  <span class="hljs-comment">// ç§»åŠ¨ç½‘ç»œåŸºç¡€åˆ†50</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasTransport(TRANSPORT_ETHERNET)) {
            score += <span class="hljs-number">70</span>;  <span class="hljs-comment">// ä»¥å¤ªç½‘åŸºç¡€åˆ†70</span>
        }

        <span class="hljs-comment">// 2. éªŒè¯çŠ¶æ€åŠ åˆ†</span>
        <span class="hljs-keyword">if</span> (nai.everValidated) {
            score += <span class="hljs-number">10</span>;  <span class="hljs-comment">// æ›¾ç»éªŒè¯é€šè¿‡+10åˆ†</span>
        }
        <span class="hljs-keyword">if</span> (nai.lastValidated) {
            score += <span class="hljs-number">20</span>;  <span class="hljs-comment">// æœ€è¿‘éªŒè¯é€šè¿‡+20åˆ†</span>
        }

        <span class="hljs-comment">// 3. ç½‘ç»œèƒ½åŠ›åŠ åˆ†</span>
        <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasCapability(
            NET_CAPABILITY_NOT_METERED)) {
            score += <span class="hljs-number">5</span>;  <span class="hljs-comment">// éè®¡è´¹ç½‘ç»œ+5åˆ†</span>
        }
        <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasCapability(
            NET_CAPABILITY_NOT_ROAMING)) {
            score += <span class="hljs-number">5</span>;  <span class="hljs-comment">// éæ¼«æ¸¸+5åˆ†</span>
        }

        <span class="hljs-comment">// 4. ä¿¡å·å¼ºåº¦å½±å“(WiFi)</span>
        <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasTransport(TRANSPORT_WIFI)) {
            <span class="hljs-type">int</span> <span class="hljs-variable">rssi</span> <span class="hljs-operator">=</span> nai.networkCapabilities.getSignalStrength();
            <span class="hljs-keyword">if</span> (rssi &gt; -<span class="hljs-number">60</span>) score += <span class="hljs-number">10</span>;      <span class="hljs-comment">// ä¼˜ç§€ä¿¡å·</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rssi &gt; -<span class="hljs-number">70</span>) score += <span class="hljs-number">5</span>;  <span class="hljs-comment">// è‰¯å¥½ä¿¡å·</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rssi &lt; -<span class="hljs-number">80</span>) score -= <span class="hljs-number">10</span>; <span class="hljs-comment">// å·®ä¿¡å·æ‰£åˆ†</span>
        }

        <span class="hljs-comment">// 5. é“¾è·¯é€Ÿåº¦å½±å“</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">linkSpeed</span> <span class="hljs-operator">=</span> nai.networkCapabilities
            .getLinkDownstreamBandwidthKbps();
        <span class="hljs-keyword">if</span> (linkSpeed &gt; <span class="hljs-number">100000</span>) score += <span class="hljs-number">10</span>;  <span class="hljs-comment">// &gt;100Mbps</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (linkSpeed &gt; <span class="hljs-number">10000</span>) score += <span class="hljs-number">5</span>; <span class="hljs-comment">// &gt;10Mbps</span>

        <span class="hljs-comment">// 6. VPNç‰¹æ®Šå¤„ç†</span>
        <span class="hljs-keyword">if</span> (nai.networkCapabilities.hasTransport(TRANSPORT_VPN)) {
            score += <span class="hljs-number">101</span>;  <span class="hljs-comment">// VPNæ€»æ˜¯ä¼˜å…ˆ</span>
        }

        <span class="hljs-keyword">return</span> score;
    }
}
</code></pre>
<p><strong>ç¤ºä¾‹è®¡ç®—</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">åœºæ™¯ï¼š<span class="hljs-built_in">WiFi</span>å’ŒLTEåŒæ—¶å¯ç”¨

<span class="hljs-built_in">WiFi</span>ç½‘ç»œ:
  åŸºç¡€åˆ†: <span class="hljs-number">60</span>
  éªŒè¯é€šè¿‡: +<span class="hljs-number">20</span>
  éè®¡è´¹: +<span class="hljs-number">5</span>
  ä¿¡å·å¼ºåº¦(<span class="hljs-number">-65</span>dBm): +<span class="hljs-number">5</span>
  é€Ÿåº¦(<span class="hljs-number">50</span>Mbps): +<span class="hljs-number">5</span>
  æ€»åˆ†: <span class="hljs-number">95</span>

LTEç½‘ç»œ:
  åŸºç¡€åˆ†: <span class="hljs-number">50</span>
  éªŒè¯é€šè¿‡: +<span class="hljs-number">20</span>
  æ¼«æ¸¸: <span class="hljs-number">0</span>
  æ€»åˆ†: <span class="hljs-number">70</span>

ç»“æœï¼š<span class="hljs-built_in">WiFi</span>å¾—åˆ†æ›´é«˜ï¼Œæˆä¸ºé»˜è®¤ç½‘ç»œ
</code></pre>
<h3 data-id="heading-34">4.3 æ— ç¼åˆ‡æ¢å®ç°</h3>
<p><strong>ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡æ–°ç½‘ç»œ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ConnectivityService.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeDefault</span><span class="hljs-params">(NetworkAgentInfo newDefault)</span> {
    <span class="hljs-type">NetworkAgentInfo</span> <span class="hljs-variable">oldDefault</span> <span class="hljs-operator">=</span> mDefaultNetwork;

    <span class="hljs-keyword">if</span> (oldDefault == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// é¦–æ¬¡å»ºç«‹é»˜è®¤ç½‘ç»œ</span>
        setDefaultNetwork(newDefault);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 1. é…ç½®æ–°ç½‘ç»œè·¯ç”±ï¼ˆä½†ä¸è®¾ä¸ºé»˜è®¤ï¼‰</span>
    mNetd.networkAddRoute(newDefault.network.netId,
                         newDefault.linkProperties.getInterfaceName(),
                         <span class="hljs-string">"0.0.0.0/0"</span>, <span class="hljs-literal">null</span>);

    <span class="hljs-comment">// 2. é€šçŸ¥åº”ç”¨æ–°ç½‘ç»œå¯ç”¨</span>
    callCallbackForRequest(nri, newDefault, CALLBACK_AVAILABLE);

    <span class="hljs-comment">// 3. ç»™æ—§ç½‘ç»œ30ç§’Lingeræ—¶é—´</span>
    handleLingerComplete(oldDefault);
}
</code></pre>
<p><strong>ç¬¬äºŒé˜¶æ®µï¼šè¿ç§»è¿æ¥</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨æ”¶åˆ°onAvailableå›è°ƒ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
    <span class="hljs-comment">// ä¸»åŠ¨å°†Socketç»‘å®šåˆ°æ–°ç½‘ç»œ</span>
    network.bindSocket(mySocket);

    <span class="hljs-comment">// æˆ–ä½¿ç”¨Network.openConnection</span>
    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> (HttpURLConnection)
        network.openConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">"https://example.com"</span>));
}
</code></pre>
<p><strong>ç¬¬ä¸‰é˜¶æ®µï¼šåˆ‡æ¢é»˜è®¤ç½‘ç»œ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Lingerè¶…æ—¶åï¼Œåˆ‡æ¢é»˜è®¤è·¯ç”±</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLingered</span><span class="hljs-params">(NetworkAgentInfo nai)</span> {
    <span class="hljs-comment">// 1. ç§»é™¤æ—§ç½‘ç»œé»˜è®¤è·¯ç”±</span>
    mNetd.networkClearDefault();

    <span class="hljs-comment">// 2. è®¾ç½®æ–°ç½‘ç»œä¸ºé»˜è®¤</span>
    mNetd.networkSetDefault(mDefaultNetwork.network.netId);

    <span class="hljs-comment">// 3. é€šçŸ¥åº”ç”¨æ—§ç½‘ç»œå·²ä¸¢å¤±</span>
    callCallbackForRequest(nri, nai, CALLBACK_LOST);

    <span class="hljs-comment">// 4. é”€æ¯æ—§NetworkAgent</span>
    nai.networkMonitor.stop();
    mNetworkAgentInfos.remove(nai.messenger);
}
</code></pre>
<p><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">æ—¶åˆ»<span class="hljs-number">0</span>s: <span class="hljs-built_in">WiFi</span>ä¿¡å·å˜å¼±
  â†’ NetworkMonitoræ£€æµ‹åˆ°éªŒè¯å¤±è´¥
  â†’ NetworkRankeré‡æ–°è¯„åˆ†
  â†’ LTEå¾—åˆ†è¶…è¿‡<span class="hljs-built_in">WiFi</span>

æ—¶åˆ»<span class="hljs-number">0.1</span>s: å‡†å¤‡LTEç½‘ç»œ
  â†’ TelephonyNetworkFactoryæ¿€æ´»æ•°æ®è¿æ¥
  â†’ <span class="hljs-number">3</span><span class="hljs-number">-5</span>ç§’åLTEè¿æ¥å»ºç«‹

æ—¶åˆ»<span class="hljs-number">5</span>s: é€šçŸ¥åº”ç”¨
  â†’ å‘é€<span class="hljs-built_in">CALLBACK_AVAILABLE</span>(LTE)
  â†’ åº”ç”¨å¼€å§‹è¿ç§»è¿æ¥

æ—¶åˆ»<span class="hljs-number">5</span><span class="hljs-number">-35</span>s: LingeræœŸ
  â†’ <span class="hljs-built_in">WiFi</span>å’ŒLTEå¹¶å­˜
  â†’ æ–°è¿æ¥ä½¿ç”¨LTE
  â†’ æ—§è¿æ¥ä»ç”¨<span class="hljs-built_in">WiFi</span>

æ—¶åˆ»<span class="hljs-number">35</span>s: å®Œæˆåˆ‡æ¢
  â†’ <span class="hljs-built_in">WiFi</span>æˆä¸ºé»˜è®¤ç½‘ç»œ
  â†’ å‘é€<span class="hljs-built_in">CALLBACK_LOST</span>(<span class="hljs-built_in">WiFi</span>)
  â†’ <span class="hljs-built_in">WiFi</span>æ–­å¼€

ç”¨æˆ·æ„ŸçŸ¥ï¼šå‡ ä¹æ— æ„ŸçŸ¥åˆ‡æ¢
</code></pre>
<h3 data-id="heading-35">4.4 é¿å…é¢‘ç¹åˆ‡æ¢</h3>
<p><strong>é—®é¢˜</strong>ï¼šWiFiä¿¡å·åœ¨ä¸´ç•Œå€¼é™„è¿‘æ³¢åŠ¨å¯¼è‡´é¢‘ç¹åˆ‡æ¢</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šHysteresisï¼ˆæ»åï¼‰æœºåˆ¶</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkRanker.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSwitchToNewNetwork</span><span class="hljs-params">(NetworkAgentInfo oldNai,
                                        NetworkAgentInfo newNai)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">oldScore</span> <span class="hljs-operator">=</span> rankNetwork(oldNai);
    <span class="hljs-type">int</span> <span class="hljs-variable">newScore</span> <span class="hljs-operator">=</span> rankNetwork(newNai);

    <span class="hljs-comment">// æ–°ç½‘ç»œå¿…é¡»æ˜¾è‘—ä¼˜äºæ—§ç½‘ç»œæ‰åˆ‡æ¢</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">HYSTERESIS</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// æ»åé˜ˆå€¼</span>

    <span class="hljs-keyword">if</span> (newScore &gt; oldScore + HYSTERESIS) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ–°ç½‘ç»œæ˜¾è‘—æ›´å¥½</span>
    }

    <span class="hljs-comment">// é¿å…æŠ–åŠ¨ï¼šä»…å½“æ–°ç½‘ç»œè¿œä¼˜äºæ—§ç½‘ç»œæ—¶æ‰åˆ‡æ¢</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¸ä½¿ç”¨æ»å:
æ—¶é—´  <span class="hljs-built_in">WiFi</span> RSSI  åˆ†æ•°  é»˜è®¤ç½‘ç»œ
<span class="hljs-number">0</span>s    <span class="hljs-number">-71</span>dBm    <span class="hljs-number">65</span>    <span class="hljs-built_in">WiFi</span>
<span class="hljs-number">1</span>s    <span class="hljs-number">-73</span>dBm    <span class="hljs-number">63</span>    <span class="hljs-built_in">WiFi</span>
<span class="hljs-number">2</span>s    <span class="hljs-number">-75</span>dBm    <span class="hljs-number">60</span>    â†’ åˆ‡æ¢åˆ°LTE
<span class="hljs-number">3</span>s    <span class="hljs-number">-73</span>dBm    <span class="hljs-number">63</span>    â†’ åˆ‡æ¢åˆ°<span class="hljs-built_in">WiFi</span>
<span class="hljs-number">4</span>s    <span class="hljs-number">-75</span>dBm    <span class="hljs-number">60</span>    â†’ åˆ‡æ¢åˆ°<span class="hljs-built_in">LTE</span>  (é¢‘ç¹æŠ–åŠ¨)

ä½¿ç”¨æ»å(é˜ˆå€¼<span class="hljs-number">10</span>):
<span class="hljs-number">0</span>s    <span class="hljs-number">-71</span>dBm    <span class="hljs-number">65</span>    <span class="hljs-built_in">WiFi</span>
<span class="hljs-number">1</span>s    <span class="hljs-number">-73</span>dBm    <span class="hljs-number">63</span>    <span class="hljs-built_in">WiFi</span>
<span class="hljs-number">2</span>s    <span class="hljs-number">-75</span>dBm    <span class="hljs-number">60</span>    <span class="hljs-built_in">WiFi</span>  (<span class="hljs-number">60</span> vs <span class="hljs-number">50</span>+<span class="hljs-number">10</span>=<span class="hljs-number">60</span>, ä¸åˆ‡æ¢)
<span class="hljs-number">3</span>s    <span class="hljs-number">-77</span>dBm    <span class="hljs-number">55</span>    â†’ åˆ‡æ¢åˆ°<span class="hljs-built_in">LTE</span> (<span class="hljs-number">55</span> &lt; <span class="hljs-number">50</span>+<span class="hljs-number">10</span>)
<span class="hljs-number">4</span>s    <span class="hljs-number">-73</span>dBm    <span class="hljs-number">63</span>    <span class="hljs-built_in">LTE</span>   (<span class="hljs-number">63</span> &lt; <span class="hljs-number">50</span>+<span class="hljs-number">10</span>, ä»ç”¨LTE)
</code></pre>
<hr/>
<h2 data-id="heading-36">äº”ã€ç½‘ç»œéªŒè¯ä¸Captive Portalå¤„ç†</h2>
<h3 data-id="heading-37">5.1 NetworkMonitoréªŒè¯æµç¨‹</h3>
<p>æºç ä½ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">packages/modules/NetworkStack/src/android/net/captiveportal/CaptivePortalProbeResult.java
packages/modules/NetworkStack/src/android/net/NetworkMonitor.java
</code></pre>
<p><strong>å®Œæ•´éªŒè¯æµç¨‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkMonitor.java (ç®€åŒ–ç‰ˆ)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkMonitor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateMachine</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_HTTP_URL</span> <span class="hljs-operator">=</span>
        <span class="hljs-string">"http://connectivitycheck.gstatic.com/generate_204"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_HTTPS_URL</span> <span class="hljs-operator">=</span>
        <span class="hljs-string">"https://www.google.com/generate_204"</span>;

    <span class="hljs-keyword">private</span> CaptivePortalProbeResult <span class="hljs-title function_">isCaptivePortal</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. HTTPæ¢æµ‹</span>
        <span class="hljs-type">CaptivePortalProbeResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sendHttpProbe(
            mCleartextDnsNetwork, VALIDATION_TYPE_HTTP);

        <span class="hljs-keyword">if</span> (result.isSuccessful()) {
            <span class="hljs-comment">// HTTP 204è¿”å›ï¼Œè¯´æ˜å¯ä»¥è®¿é—®äº’è”ç½‘</span>
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">if</span> (result.isPortal()) {
            <span class="hljs-comment">// HTTPé‡å®šå‘ï¼Œè¯´æ˜æ˜¯Captive Portal</span>
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-comment">// 2. HTTPSæ¢æµ‹ï¼ˆæ›´å¯é ï¼‰</span>
        result = sendHttpProbe(
            mCleartextDnsNetwork, VALIDATION_TYPE_HTTPS);

        <span class="hljs-keyword">if</span> (result.isSuccessful()) {
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-comment">// 3. DNSæ¢æµ‹ï¼ˆæ£€æŸ¥DNSæ˜¯å¦è¢«åŠ«æŒï¼‰</span>
        result = sendDnsProbe(mPrivateDnsProviderHostname);

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">private</span> CaptivePortalProbeResult <span class="hljs-title function_">sendHttpProbe</span><span class="hljs-params">(
            Network network, <span class="hljs-type">int</span> validationType)</span> {

        <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> (validationType == VALIDATION_TYPE_HTTPS)
                ? mHttpsUrl : mHttpUrl;

        <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            conn = (HttpURLConnection) network.openConnection(url);
            conn.setInstanceFollowRedirects(<span class="hljs-literal">false</span>);
            conn.setConnectTimeout(SOCKET_TIMEOUT_MS);
            conn.setReadTimeout(SOCKET_TIMEOUT_MS);
            conn.setUseCaches(<span class="hljs-literal">false</span>);
            conn.addRequestProperty(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"close"</span>);

            <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> SystemClock.elapsedRealtime();
            conn.getInputStream();
            <span class="hljs-type">long</span> <span class="hljs-variable">latency</span> <span class="hljs-operator">=</span> SystemClock.elapsedRealtime() - start;

            <span class="hljs-type">int</span> <span class="hljs-variable">responseCode</span> <span class="hljs-operator">=</span> conn.getResponseCode();
            <span class="hljs-type">String</span> <span class="hljs-variable">location</span> <span class="hljs-operator">=</span> conn.getHeaderField(<span class="hljs-string">"Location"</span>);

            <span class="hljs-comment">// HTTP 204 = éªŒè¯é€šè¿‡</span>
            <span class="hljs-keyword">if</span> (responseCode == <span class="hljs-number">204</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptivePortalProbeResult</span>(
                    CaptivePortalProbeResult.SUCCESS, latency);
            }

            <span class="hljs-comment">// HTTP 200 = å¯èƒ½æ˜¯Captive Portal</span>
            <span class="hljs-keyword">if</span> (responseCode &gt;= <span class="hljs-number">200</span> &amp;&amp; responseCode &lt;= <span class="hljs-number">399</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptivePortalProbeResult</span>(
                    CaptivePortalProbeResult.PORTAL,
                    location, latency);
            }

            <span class="hljs-comment">// å…¶ä»– = éªŒè¯å¤±è´¥</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptivePortalProbeResult</span>(
                CaptivePortalProbeResult.FAILED, latency);

        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptivePortalProbeResult</span>(
                CaptivePortalProbeResult.FAILED, <span class="hljs-number">0</span>);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (conn != <span class="hljs-literal">null</span>) conn.disconnect();
        }
    }
}
</code></pre>
<h3 data-id="heading-38">5.2 Captive Portalç™»å½•æµç¨‹</h3>
<p><strong>åœºæ™¯ï¼šè¿æ¥æ˜Ÿå·´å…‹WiFi</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Step 1:</span> <span class="hljs-string">ç‰©ç†è¿æ¥</span>
  <span class="hljs-string">ç”¨æˆ·:</span> <span class="hljs-string">é€‰æ‹©"Starbucks</span> <span class="hljs-string">WiFi"</span>
  <span class="hljs-attr">WiFi:</span> <span class="hljs-string">DHCPè·å–IP</span> <span class="hljs-string">(192.168.1.100)</span>
  <span class="hljs-attr">WiFiNetworkAgent:</span> <span class="hljs-string">ä¸ŠæŠ¥CONNECTEDçŠ¶æ€</span>

<span class="hljs-attr">Step 2:</span> <span class="hljs-string">NetworkMonitoréªŒè¯</span>
  <span class="hljs-string">HTTPæ¢æµ‹</span> <span class="hljs-string">â†’</span> <span class="hljs-string">http://connectivitycheck.gstatic.com/generate_204</span>
  <span class="hljs-string">æœåŠ¡å™¨è¿”å›:</span> <span class="hljs-string">HTTP</span> <span class="hljs-number">302</span> <span class="hljs-string">Redirect</span>
  <span class="hljs-attr">Location:</span> <span class="hljs-string">http://æ˜Ÿå·´å…‹ç™»å½•é¡µé¢.com/login</span>

  <span class="hljs-string">ç»“è®º:</span> <span class="hljs-string">æ£€æµ‹åˆ°Captive</span> <span class="hljs-string">Portal</span>

<span class="hljs-attr">Step 3:</span> <span class="hljs-string">é€šçŸ¥ç”¨æˆ·</span>
  <span class="hljs-string">ç³»ç»Ÿé€šçŸ¥:</span> <span class="hljs-string">"éœ€è¦ç™»å½•WiFiç½‘ç»œ"</span>
  <span class="hljs-string">ç‚¹å‡»åæ‰“å¼€:</span> <span class="hljs-string">CaptivePortalLoginActivity</span>

<span class="hljs-attr">Step 4:</span> <span class="hljs-string">ç”¨æˆ·ç™»å½•</span>
  <span class="hljs-string">WebViewåŠ è½½ç™»å½•é¡µ</span>
  <span class="hljs-string">ç”¨æˆ·è¾“å…¥ä¿¡æ¯</span> <span class="hljs-string">/</span> <span class="hljs-string">åŒæ„æ¡æ¬¾</span>
  <span class="hljs-string">ç™»å½•æˆåŠŸ</span>

<span class="hljs-attr">Step 5:</span> <span class="hljs-string">é‡æ–°éªŒè¯</span>
  <span class="hljs-attr">NetworkMonitor:</span> <span class="hljs-string">å†æ¬¡å‘é€HTTPæ¢æµ‹</span>
  <span class="hljs-string">æœåŠ¡å™¨è¿”å›:</span> <span class="hljs-string">HTTP</span> <span class="hljs-number">204</span> <span class="hljs-string">(éªŒè¯é€šè¿‡)</span>
  <span class="hljs-string">çŠ¶æ€:</span> <span class="hljs-string">CAPTIVE_PORTAL</span> <span class="hljs-string">â†’</span> <span class="hljs-string">VALIDATED</span>
</code></pre>
<p><strong>ä»£ç å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// CaptivePortalLoginActivity.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CaptivePortalLoginActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {

    <span class="hljs-keyword">private</span> WebView mWebView;
    <span class="hljs-keyword">private</span> Network mNetwork;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);

        <span class="hljs-comment">// è·å–è¦éªŒè¯çš„ç½‘ç»œ</span>
        mNetwork = getIntent().getParcelableExtra(
            ConnectivityManager.EXTRA_NETWORK);

        <span class="hljs-comment">// è®¾ç½®WebViewä½¿ç”¨è¯¥ç½‘ç»œ</span>
        mWebView = findViewById(R.id.webview);
        mWebView.setWebViewClient(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PortalWebViewClient</span>());

        <span class="hljs-comment">// åŠ è½½ç™»å½•é¡µé¢</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> getIntent().getStringExtra(
            ConnectivityManager.EXTRA_CAPTIVE_PORTAL_URL);
        mWebView.loadUrl(url);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PortalWebViewClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebViewClient</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldOverrideUrlLoading</span><span class="hljs-params">(WebView view, String url)</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ç™»å½•æˆåŠŸ</span>
            <span class="hljs-keyword">if</span> (isSuccessUrl(url)) {
                <span class="hljs-comment">// é€šçŸ¥ç³»ç»Ÿé‡æ–°éªŒè¯</span>
                notifyPortalLoginSuccess();
                finish();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyPortalLoginSuccess</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> getSystemService(
            ConnectivityManager.class);
        cm.reportNetworkConnectivity(mNetwork, <span class="hljs-literal">true</span>);
    }
}
</code></pre>
<h3 data-id="heading-39">5.3 Android 15 Private DNSæ”¯æŒ</h3>
<p><strong>DoT (DNS over TLS)</strong> - åŠ å¯†DNSæŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NetworkMonitor.java - Android 15æ–°å¢</span>
<span class="hljs-keyword">private</span> CaptivePortalProbeResult <span class="hljs-title function_">sendDnsProbe</span><span class="hljs-params">(String hostname)</span> {
    <span class="hljs-keyword">if</span> (isPrivateDnsValidationRequired()) {
        <span class="hljs-comment">// ä½¿ç”¨TLSåŠ å¯†çš„DNSæŸ¥è¯¢</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">SSLSocket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> (SSLSocket)
                SSLSocketFactory.getDefault()
                    .createSocket(mPrivateDnsServerIp, <span class="hljs-number">853</span>);

            socket.startHandshake();

            <span class="hljs-comment">// å‘é€DNSæŸ¥è¯¢</span>
            <span class="hljs-type">DnsPacket</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> DnsPacket.createQuery(
                hostname, TYPE_A);
            socket.getOutputStream().write(query.getBytes());

            <span class="hljs-comment">// æ¥æ”¶å“åº”</span>
            <span class="hljs-type">DnsPacket</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> DnsPacket.parse(
                socket.getInputStream());

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptivePortalProbeResult</span>(
                CaptivePortalProbeResult.SUCCESS, <span class="hljs-number">0</span>);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptivePortalProbeResult</span>(
                CaptivePortalProbeResult.FAILED, <span class="hljs-number">0</span>);
        }
    }
}
</code></pre>
<p><strong>é…ç½®Private DNS</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½® â†’ ç½‘ç»œå’Œäº’è”ç½‘ â†’ ç§äººDNS</span>
adb shell settings put global private_dns_mode hostname
adb shell settings put global private_dns_specifier dns.google

<span class="hljs-comment"># éªŒè¯</span>
adb shell getprop net.dns1
<span class="hljs-comment"># è¾“å‡º: 8.8.8.8 (ä½¿ç”¨Google Public DNS)</span>
</code></pre>
<hr/>
<h2 data-id="heading-40">å…­ã€å®æˆ˜ï¼šç½‘ç»œé—®é¢˜è¯Šæ–­</h2>
<h3 data-id="heading-41">6.1 WiFiè¿æ¥å¤±è´¥æ’æŸ¥</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šWiFiæ˜¾ç¤º"å·²è¿æ¥"ä½†æ— æ³•ä¸Šç½‘</p>
<p><strong>è¯Šæ–­æ­¥éª¤</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Step 1: æ£€æŸ¥ç½‘ç»œçŠ¶æ€</span>
adb shell dumpsys connectivity | grep -A 30 <span class="hljs-string">"Active networks"</span>

<span class="hljs-comment"># è¾“å‡ºç¤ºä¾‹:</span>
<span class="hljs-comment"># NetworkAgentInfo{ ni{[WIFI () - 100]}</span>
<span class="hljs-comment">#   network{151}  handle{151}</span>
<span class="hljs-comment">#   lp{{InterfaceName: wlan0</span>
<span class="hljs-comment">#       LinkAddresses: [ 192.168.1.100/24 ]</span>
<span class="hljs-comment">#       DnsAddresses: [ 192.168.1.1 ]</span>
<span class="hljs-comment">#       Routes: [ 0.0.0.0/0 -&gt; 192.168.1.1 wlan0 ]}}</span>
<span class="hljs-comment">#   nc{[ Transports: WIFI</span>
<span class="hljs-comment">#        Capabilities: NOT_METERED</span>
<span class="hljs-comment">#        NOT_ROAMING INTERNET NOT_SUSPENDED VALIDATED]}  â† æ³¨æ„è¿™é‡Œ</span>
<span class="hljs-comment">#   Score{current=60 validated=true}}</span>

<span class="hljs-comment"># å…³é”®å­—æ®µ:</span>
<span class="hljs-comment"># - VALIDATED: ç½‘ç»œå·²éªŒè¯ (å¦‚æœæ²¡æœ‰æ­¤å­—æ®µï¼Œè¯´æ˜éªŒè¯å¤±è´¥)</span>
<span class="hljs-comment"># - DnsAddresses: DNSæœåŠ¡å™¨ (æ£€æŸ¥æ˜¯å¦æ­£ç¡®)</span>
<span class="hljs-comment"># - LinkAddresses: æœ¬æœºIP (æ£€æŸ¥æ˜¯å¦åœ¨åˆç†èŒƒå›´)</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Step 2: æ£€æŸ¥ç½‘ç»œéªŒè¯ç»“æœ</span>
adb shell dumpsys network_stack | grep -i <span class="hljs-string">"validation"</span>

<span class="hljs-comment"># è¾“å‡º:</span>
<span class="hljs-comment"># ValidationProbeEvent{latency=234 result=204 ...}  â† HTTP 204è¡¨ç¤ºé€šè¿‡</span>
<span class="hljs-comment"># æˆ–</span>
<span class="hljs-comment"># ValidationProbeEvent{latency=5000 result=timeout ...}  â† è¶…æ—¶</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Step 3: æ‰‹åŠ¨æµ‹è¯•è¿é€šæ€§</span>
adb shell

<span class="hljs-comment"># Pingç½‘å…³</span>
ping -c 4 192.168.1.1
<span class="hljs-comment"># å¦‚æœä¸é€šï¼Œè¯´æ˜å±€åŸŸç½‘é—®é¢˜</span>

<span class="hljs-comment"># Ping DNS</span>
ping -c 4 8.8.8.8
<span class="hljs-comment"># å¦‚æœä¸é€šï¼Œè¯´æ˜è·¯ç”±é—®é¢˜</span>

<span class="hljs-comment"># PingåŸŸå</span>
ping -c 4 www.google.com
<span class="hljs-comment"># å¦‚æœä¸é€šï¼Œè¯´æ˜DNSé—®é¢˜</span>

<span class="hljs-comment"># HTTPæµ‹è¯•</span>
curl -I http://connectivitycheck.gstatic.com/generate_204
<span class="hljs-comment"># åº”è¯¥è¿”å› HTTP/1.1 204 No Content</span>
</code></pre>
<p><strong>å¸¸è§åŸå› ä¸è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>



































<table><thead><tr><th align="left">ç°è±¡</th><th align="left">åŸå› </th><th align="left">è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td align="left">Pingç½‘å…³ä¸é€š</td><td align="left">WiFié©±åŠ¨/ç¡¬ä»¶é—®é¢˜</td><td align="left">é‡å¯WiFiï¼Œæ£€æŸ¥é©±åŠ¨æ—¥å¿—</td></tr><tr><td align="left">Ping DNSä¸é€š</td><td align="left">è·¯ç”±å™¨æœªè®¾ç½®é»˜è®¤ç½‘å…³</td><td align="left">æ£€æŸ¥DHCPé…ç½®</td></tr><tr><td align="left">PingåŸŸåä¸é€š</td><td align="left">DNSæœåŠ¡å™¨æ•…éšœ</td><td align="left">æ‰‹åŠ¨è®¾ç½®DNSä¸º8.8.8.8</td></tr><tr><td align="left">HTTPè¿”å›302</td><td align="left">Captive Portal</td><td align="left">æ‰“å¼€æµè§ˆå™¨å®Œæˆç™»å½•</td></tr><tr><td align="left">HTTPè¶…æ—¶</td><td align="left">é˜²ç«å¢™æ‹¦æˆª</td><td align="left">æ£€æŸ¥iptablesè§„åˆ™</td></tr></tbody></table>
<h3 data-id="heading-42">6.2 ç½‘ç»œåˆ‡æ¢å¼‚å¸¸å®šä½</h3>
<p><strong>ç—‡çŠ¶</strong>ï¼šä»WiFiåˆ‡æ¢åˆ°ç§»åŠ¨ç½‘ç»œåï¼Œåº”ç”¨æ— æ³•è”ç½‘</p>
<p><strong>è¯Šæ–­</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æŸ¥çœ‹å½“å‰é»˜è®¤ç½‘ç»œ</span>
adb shell dumpsys connectivity | grep <span class="hljs-string">"Active default"</span>
<span class="hljs-comment"># è¾“å‡º: Active default network: 151</span>

<span class="hljs-comment"># 2. æŸ¥çœ‹è¯¥ç½‘ç»œè¯¦æƒ…</span>
adb shell dumpsys connectivity networks 151
<span class="hljs-comment"># ç¡®è®¤æ˜¯å¦æ˜¯æœŸæœ›çš„ç½‘ç»œ(WiFi/LTE)</span>

<span class="hljs-comment"># 3. æ£€æŸ¥åº”ç”¨æ˜¯å¦ç»‘å®šäº†æ—§ç½‘ç»œ</span>
adb shell dumpsys connectivity requests | grep <span class="hljs-string">"YOUR_PACKAGE"</span>
<span class="hljs-comment"># è¾“å‡ºä¼šæ˜¾ç¤ºåº”ç”¨çš„NetworkRequestå’Œç»‘å®šçš„Network</span>

<span class="hljs-comment"># 4. æŠ“å–ç½‘ç»œåˆ‡æ¢æ—¥å¿—</span>
adb logcat -b all | grep -E <span class="hljs-string">"ConnectivityService|NetworkAgent"</span>
</code></pre>
<p><strong>å…¸å‹æ—¥å¿—åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"># æ­£å¸¸åˆ‡æ¢æ—¥å¿—:
<span class="hljs-symbol">ConnectivityService:</span> NetworkAgentInfo [WIFI] validation passed
<span class="hljs-symbol">ConnectivityService:</span> Setting <span class="hljs-keyword">default</span> network <span class="hljs-keyword">to</span> <span class="hljs-number">151</span> (WIFI)
<span class="hljs-symbol">ConnectivityService:</span> Lingering network <span class="hljs-number">149</span> (MOBILE)
... (<span class="hljs-number">30</span>ç§’å)
<span class="hljs-symbol">ConnectivityService:</span> Tearing down network <span class="hljs-number">149</span>

# å¼‚å¸¸åˆ‡æ¢æ—¥å¿—:
<span class="hljs-symbol">ConnectivityService:</span> NetworkAgentInfo [MOBILE] validation failed
<span class="hljs-symbol">ConnectivityService:</span> <span class="hljs-built_in">Not</span> setting <span class="hljs-keyword">default</span> <span class="hljs-keyword">to</span> unvalidated network
â† ç§»åŠ¨ç½‘ç»œéªŒè¯å¤±è´¥ï¼Œæœªåˆ‡æ¢
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åº”ç”¨ä»£ç ä¿®å¤ï¼šä½¿ç”¨ConnectivityManager.NetworkCallback</span>
<span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> ...;
<span class="hljs-type">NetworkCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
        <span class="hljs-comment">// ç½‘ç»œå¯ç”¨æ—¶ï¼Œå°†Socketç»‘å®šåˆ°æ–°ç½‘ç»œ</span>
        <span class="hljs-keyword">try</span> {
            network.bindSocket(mySocket);
            <span class="hljs-comment">// æˆ–é‡æ–°åˆ›å»ºè¿æ¥</span>
            recreateConnection(network);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            Log.e(TAG, <span class="hljs-string">"Failed to bind socket"</span>, e);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLost</span><span class="hljs-params">(Network network)</span> {
        <span class="hljs-comment">// ç½‘ç»œä¸¢å¤±æ—¶ï¼Œæ¸…ç†èµ„æº</span>
        closeConnection();
    }
};

<span class="hljs-comment">// æ³¨å†Œç›‘å¬</span>
cm.registerDefaultNetworkCallback(callback);
</code></pre>
<h3 data-id="heading-43">6.3 æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘ç½‘ç»œåˆ‡æ¢å»¶è¿Ÿ</h3>
<p><strong>é—®é¢˜</strong>ï¼šWiFiâ†’LTEåˆ‡æ¢éœ€è¦5-8ç§’</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š</p>
<h4 data-id="heading-44"><strong>æ–¹æ¡ˆ1ï¼šé¢„è¿æ¥ç§»åŠ¨ç½‘ç»œ</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Android 12å¼•å…¥çš„MultiPath API</span>
<span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">cm</span> <span class="hljs-operator">=</span> ...;

<span class="hljs-comment">// è¯·æ±‚åŒæ—¶ä½¿ç”¨WiFiå’ŒLTE</span>
<span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
    .addCapability(NET_CAPABILITY_INTERNET)
    .build();

cm.requestNetwork(request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
        <span class="hljs-comment">// ä¿æŒLTEè¿æ¥å¤„äºæ¿€æ´»çŠ¶æ€</span>
        <span class="hljs-comment">// å½“WiFiæ–­å¼€æ—¶ï¼Œå¯ç«‹å³åˆ‡æ¢</span>
    }
}, MULTI_PATH_PREFERENCE_PERFORMANCE);
</code></pre>
<h4 data-id="heading-45"><strong>æ–¹æ¡ˆ2ï¼šå¿«é€Ÿå¤±è´¥æ£€æµ‹</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¼©çŸ­éªŒè¯è¶…æ—¶æ—¶é—´</span>
adb shell settings put global captive_portal_http_url_timeout_ms <span class="hljs-number">3000</span>

<span class="hljs-comment">// é»˜è®¤å€¼ï¼š10000ms (10ç§’)</span>
<span class="hljs-comment">// ä¼˜åŒ–åï¼š3000ms (3ç§’)</span>
</code></pre>
<h4 data-id="heading-46"><strong>æ–¹æ¡ˆ3ï¼šåº”ç”¨å±‚ä¼˜åŒ– - Happy Eyeballs</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// RFC 8305: åŒæ—¶å°è¯•IPv4å’ŒIPv6ï¼Œä½¿ç”¨æœ€å¿«å“åº”çš„</span>
<span class="hljs-keyword">public</span> Socket <span class="hljs-title function_">connectWithHappyEyeballs</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port)</span> {
    List&lt;InetAddress&gt; addresses =
        InetAddress.getAllByName(host);  <span class="hljs-comment">// è·å–æ‰€æœ‰IP</span>

    List&lt;Future&lt;Socket&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();

    <span class="hljs-comment">// å¹¶å‘è¿æ¥æ‰€æœ‰åœ°å€</span>
    <span class="hljs-keyword">for</span> (InetAddress addr : addresses) {
        futures.add(executor.submit(() -&gt; {
            <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Socket</span>();
            socket.connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(addr, port), <span class="hljs-number">1000</span>);
            <span class="hljs-keyword">return</span> socket;
        }));
    }

    <span class="hljs-comment">// è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„è¿æ¥</span>
    <span class="hljs-keyword">for</span> (Future&lt;Socket&gt; future : futures) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> future.get(<span class="hljs-number">2</span>, TimeUnit.SECONDS);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª</span>
        }
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IOException</span>(<span class="hljs-string">"All connection attempts failed"</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-47">ä¸ƒã€Android 15æ–°ç‰¹æ€§</h2>
<h3 data-id="heading-48">7.1 Satellite Connectivityï¼ˆå«æ˜Ÿè¿æ¥ï¼‰</h3>
<p>Android 15æ–°å¢å«æ˜Ÿç½‘ç»œæ”¯æŒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ£€æµ‹å«æ˜Ÿç½‘ç»œå¯ç”¨æ€§</span>
<span class="hljs-type">NetworkCapabilities</span> <span class="hljs-variable">nc</span> <span class="hljs-operator">=</span> cm.getNetworkCapabilities(network);

<span class="hljs-keyword">if</span> (nc.hasTransport(NetworkCapabilities.TRANSPORT_SATELLITE)) {
    <span class="hljs-comment">// è¿™æ˜¯å«æ˜Ÿè¿æ¥</span>
    <span class="hljs-comment">// ç‰¹ç‚¹ï¼šé«˜å»¶è¿Ÿ(500-800ms)ã€ä½å¸¦å®½(å‡ Kbps)ã€é«˜æˆæœ¬</span>

    <span class="hljs-comment">// åº”ç”¨åº”è¯¥:</span>
    <span class="hljs-comment">// 1. ä½¿ç”¨æ–‡æœ¬é€šä¿¡è€Œéè¯­éŸ³/è§†é¢‘</span>
    <span class="hljs-comment">// 2. å‹ç¼©æ•°æ®</span>
    <span class="hljs-comment">// 3. å‡å°‘è¯·æ±‚é¢‘ç‡</span>
}
</code></pre>
<h3 data-id="heading-49">7.2 Network Slicing (5Gç½‘ç»œåˆ‡ç‰‡)</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¯·æ±‚ç‰¹å®šçš„5Gåˆ‡ç‰‡</span>
<span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
    .addCapability(NET_CAPABILITY_ENTERPRISE)
    .setEnterpriseId(NET_ENTERPRISE_ID_1)  <span class="hljs-comment">// ä¼ä¸šä¸“ç½‘åˆ‡ç‰‡</span>
    .build();

cm.requestNetwork(request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkCallback</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAvailable</span><span class="hljs-params">(Network network)</span> {
        <span class="hljs-comment">// ä½¿ç”¨ä¼ä¸šä¸“ç½‘ï¼Œäº«å—:</span>
        <span class="hljs-comment">// - æ›´ä½å»¶è¿Ÿ (&lt;10ms)</span>
        <span class="hljs-comment">// - æ›´é«˜å¸¦å®½ä¿è¯</span>
        <span class="hljs-comment">// - æ›´å¥½çš„QoS</span>
    }
});
</code></pre>
<h3 data-id="heading-50">7.3 Thread Network Support</h3>
<p>Android 15æ”¯æŒThreadåè®®ï¼ˆç”¨äºæ™ºèƒ½å®¶å±…ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¿æ¥Threadç½‘ç»œ</span>
<span class="hljs-type">NetworkRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NetworkRequest</span>.Builder()
    .addTransportType(NetworkCapabilities.TRANSPORT_THREAD)
    .build();

<span class="hljs-comment">// Threadç‰¹ç‚¹:</span>
<span class="hljs-comment">// - ä½åŠŸè€—</span>
<span class="hljs-comment">// - Meshç½‘ç»œ</span>
<span class="hljs-comment">// - IPv6 only</span>
<span class="hljs-comment">// - ç”¨äºIoTè®¾å¤‡</span>
</code></pre>
<hr/>
<h2 data-id="heading-51">å…«ã€æ€»ç»“ä¸å±•æœ›</h2>
<h3 data-id="heading-52">8.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol>
<li>
<p><strong>ConnectivityServiceæ¶æ„</strong></p>
<ul>
<li>ç³»ç»Ÿç½‘ç»œç®¡ç†ä¸­æ¢</li>
<li>åè°ƒNetworkAgentå’ŒNetworkFactory</li>
<li>ç®¡ç†ç½‘ç»œç”Ÿå‘½å‘¨æœŸ</li>
</ul>
</li>
<li>
<p><strong>NetworkAgentæœºåˆ¶</strong></p>
<ul>
<li>9ç§ç½‘ç»œçŠ¶æ€</li>
<li>çŠ¶æ€æœºé©±åŠ¨</li>
<li>åŸºäºMessengeré€šä¿¡</li>
</ul>
</li>
<li>
<p><strong>NetworkFactoryå·¥ä½œåŸç†</strong></p>
<ul>
<li>æŒ‰éœ€æ¿€æ´»ç½‘ç»œ</li>
<li>CapabilityåŒ¹é…</li>
<li>è¯„åˆ†ç«äº‰æœºåˆ¶</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œåˆ‡æ¢</strong></p>
<ul>
<li>NetworkRankerè¯„åˆ†ç®—æ³•</li>
<li>Lingerä¼˜é›…æ–­å¼€</li>
<li>Hysteresisé˜²æŠ–åŠ¨</li>
</ul>
</li>
<li>
<p><strong>ç½‘ç»œéªŒè¯</strong></p>
<ul>
<li>HTTP/HTTPSæ¢æµ‹</li>
<li>Captive Portalå¤„ç†</li>
<li>Private DNSæ”¯æŒ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-53">8.2 ConnectivityServiceæ¼”è¿›å²</h3>













































<table><thead><tr><th align="left">ç‰ˆæœ¬</th><th align="left">å…³é”®å˜åŒ–</th><th align="left">å½±å“</th></tr></thead><tbody><tr><td align="left">Android 5.0</td><td align="left">å¼•å…¥NetworkRequest/NetworkCallback</td><td align="left">åº”ç”¨å¯ä¸»åŠ¨è¯·æ±‚ç½‘ç»œ</td></tr><tr><td align="left">Android 7.0</td><td align="left">MultiNetwork API</td><td align="left">åº”ç”¨å¯åŒæ—¶ä½¿ç”¨å¤šä¸ªç½‘ç»œ</td></tr><tr><td align="left">Android 9.0</td><td align="left">å¼ºåˆ¶ä½¿ç”¨HTTPS</td><td align="left">å®‰å…¨æ€§æå‡</td></tr><tr><td align="left">Android 10.0</td><td align="left">NetworkStackæ¨¡å—åŒ–</td><td align="left">å¯ç‹¬ç«‹æ›´æ–°</td></tr><tr><td align="left">Android 11.0</td><td align="left">eBPFç½‘ç»œç­–ç•¥</td><td align="left">æ€§èƒ½å¤§å¹…æå‡</td></tr><tr><td align="left">Android 12.0</td><td align="left">Network Slicing</td><td align="left">5Gç½‘ç»œåˆ‡ç‰‡æ”¯æŒ</td></tr><tr><td align="left">Android 15.0</td><td align="left">Satellite + Thread</td><td align="left">æ‰©å±•è¿æ¥åœºæ™¯</td></tr></tbody></table>
<h3 data-id="heading-54">8.3 æœªæ¥å±•æœ›</h3>
<p><strong>è¶‹åŠ¿1ï¼šAIé©±åŠ¨çš„ç½‘ç»œç®¡ç†</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æœªæ¥å¯èƒ½çš„å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AINetworkRanker</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.model = load_ml_model(<span class="hljs-string">"network_predictor.tflite"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_network_quality</span>(<span class="hljs-params">self, nai</span>):
        features = extract_features(nai)  <span class="hljs-comment"># RSSI, é€Ÿåº¦, å»¶è¿Ÿç­‰</span>
        score = self.model.predict(features)
        <span class="hljs-keyword">return</span> score
</code></pre>
<p><strong>è¶‹åŠ¿2ï¼šSeamless Multi-Path</strong></p>
<ul>
<li>åŒæ—¶ä½¿ç”¨WiFi+5Gï¼Œè‡ªåŠ¨è´Ÿè½½å‡è¡¡</li>
<li>å…³é”®æ•°æ®èµ°5Gï¼ˆä½å»¶è¿Ÿï¼‰ï¼Œå¤§æ•°æ®èµ°WiFiï¼ˆçœæµé‡ï¼‰</li>
</ul>
<p><strong>è¶‹åŠ¿3ï¼šè¾¹ç¼˜è®¡ç®—é›†æˆ</strong></p>
<ul>
<li>ConnectivityServiceæ„ŸçŸ¥MEC(å¤šæ¥å…¥è¾¹ç¼˜è®¡ç®—)èŠ‚ç‚¹</li>
<li>è‡ªåŠ¨å°†æµé‡è·¯ç”±åˆ°æœ€è¿‘çš„è¾¹ç¼˜æœåŠ¡å™¨</li>
</ul>
<hr/>
<h2 data-id="heading-55">ä¹ã€å‚è€ƒèµ„æº</h2>
<h3 data-id="heading-56">9.1 æºç è·¯å¾„</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ConnectivityServiceæ ¸å¿ƒ</span>
packages/modules/Connectivity/service/src/com/android/server/
â”œâ”€â”€ ConnectivityService.java          <span class="hljs-comment"># æ ¸å¿ƒæœåŠ¡</span>
â”œâ”€â”€ NetworkAgentInfo.java             <span class="hljs-comment"># Agentä¿¡æ¯</span>
â”œâ”€â”€ NetworkRequestInfo.java           <span class="hljs-comment"># è¯·æ±‚ä¿¡æ¯</span>
â””â”€â”€ connectivity/
    â”œâ”€â”€ NetworkRanker.java            <span class="hljs-comment"># ç½‘ç»œæ’å</span>
    â””â”€â”€ PermissionMonitor.java        <span class="hljs-comment"># æƒé™ç›‘æ§</span>

<span class="hljs-comment"># NetworkStack</span>
packages/modules/NetworkStack/src/
â”œâ”€â”€ android/net/NetworkMonitor.java    <span class="hljs-comment"># ç½‘ç»œéªŒè¯</span>
â”œâ”€â”€ android/net/apf/                   <span class="hljs-comment"># APFåŒ…è¿‡æ»¤</span>
â””â”€â”€ android/net/ip/IpClient.java       <span class="hljs-comment"># IPé…ç½®</span>

<span class="hljs-comment"># NetworkAgentå®ç°</span>
packages/modules/Wifi/service/java/com/android/server/wifi/
â””â”€â”€ WifiNetworkAgent.java              <span class="hljs-comment"># WiFi Agent</span>

frameworks/opt/telephony/src/java/com/android/internal/telephony/
â””â”€â”€ dataconnection/DcNetworkAgent.java <span class="hljs-comment"># Cellular Agent</span>
</code></pre>
<h3 data-id="heading-57">9.2 è°ƒè¯•å‘½ä»¤</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ</span>
adb shell dumpsys connectivity networks

<span class="hljs-comment"># æŸ¥çœ‹é»˜è®¤ç½‘ç»œ</span>
adb shell dumpsys connectivity | grep <span class="hljs-string">"Active default"</span>

<span class="hljs-comment"># æŸ¥çœ‹NetworkRequest</span>
adb shell dumpsys connectivity requests

<span class="hljs-comment"># æŸ¥çœ‹NetworkFactory</span>
adb shell dumpsys connectivity factories

<span class="hljs-comment"># è§¦å‘ç½‘ç»œéªŒè¯</span>
adb shell cmd connectivity force-network-validation &lt;netId&gt;

<span class="hljs-comment"># æ¨¡æ‹Ÿç½‘ç»œåˆ‡æ¢</span>
adb shell svc wifi <span class="hljs-built_in">disable</span> &amp;&amp; <span class="hljs-built_in">sleep</span> 2 &amp;&amp; adb shell svc wifi <span class="hljs-built_in">enable</span>

<span class="hljs-comment"># æŸ¥çœ‹eBPFç»Ÿè®¡</span>
adb shell dumpsys connectivity trafficcontroller
</code></pre>
<h3 data-id="heading-58">9.3 å®˜æ–¹æ–‡æ¡£</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.android.com%2Fdocs%2Fcore%2Fconnect" target="_blank" title="https://source.android.com/docs/core/connect" ref="nofollow noopener noreferrer">Connectivity Overview</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fnet%2FConnectivityManager" target="_blank" title="https://developer.android.com/reference/android/net/ConnectivityManager" ref="nofollow noopener noreferrer">ConnectivityManager API</a></li>
</ul>
<h3 data-id="heading-59">9.4 ç›¸å…³RFC</h3>
<ul>
<li>RFC 3093: DHCP</li>
<li>RFC 8305: Happy Eyeballs v2</li>
<li>RFC 7858: DNS over TLS</li>
<li>RFC 8910: Captive Portal API</li>
</ul>
<hr/>
<h2 data-id="heading-60">åè®°</h2>
<p>ConnectivityServiceæ˜¯Androidç³»ç»Ÿä¸­æœ€å¤æ‚çš„æœåŠ¡ä¹‹ä¸€ï¼Œç®¡ç†ç€è®¾å¤‡ä¸å¤–ç•Œçš„æ‰€æœ‰ç½‘ç»œè¿æ¥ã€‚ä»ç®€å•çš„WiFiè¿æ¥ï¼Œåˆ°å¤æ‚çš„å¤šç½‘ç»œå¹¶å‘ã€VPNéš§é“ã€5Gåˆ‡ç‰‡ï¼ŒConnectivityServiceéƒ½èƒ½æ¸¸åˆƒæœ‰ä½™åœ°å¤„ç†ã€‚</p>
<h3 data-id="heading-61">ç³»åˆ—æ–‡ç« </h3>
<ul>
<li><a href="https://juejin.cn/post/7599330434427158579" target="_blank" title="https://juejin.cn/post/7599330434427158579">ä¸Šä¸€ç¯‡ï¼šAndroid 15å­˜å‚¨å­ç³»ç»Ÿæ·±åº¦è§£æï¼ˆä¸‰ï¼‰ï¼šFBEåŠ å¯†æ–‡ä»¶ç³»ç»Ÿä¸å­˜å‚¨æ€§èƒ½ä¼˜åŒ–å®æˆ˜</a></li>
</ul>
<hr/>
<p><em>æ¬¢è¿æ¥æˆ‘ä¸­çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>æ‰¾åˆ°æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†å’Œæœ‰è¶£çš„äº§å“</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JDKæœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨]]></title>    <link>https://juejin.cn/post/7599924721007444031</link>    <guid>https://juejin.cn/post/7599924721007444031</guid>    <pubDate>2026-01-28T06:25:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599924721007444031" data-draft-id="7599983917664911403" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JDKæœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-28T06:25:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JDKæœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T06:25:36.000Z" title="Wed Jan 28 2026 06:25:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JDKçš„åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰éšç€ç‰ˆæœ¬è¿­ä»£ä¸æ–­æ¼”è¿›ï¼Œæ—¨åœ¨å¹³è¡¡<strong>ååé‡</strong>ï¼ˆç”¨æˆ·ä»£ç è¿è¡Œæ—¶é—´å æ¯”ï¼‰ã€<strong>å»¶è¿Ÿ</strong>ï¼ˆSTWåœé¡¿æ—¶é—´ï¼‰å’Œ<strong>å†…å­˜å ç”¨</strong>ä¸‰å¤§æ ¸å¿ƒæŒ‡æ ‡ã€‚ä»¥ä¸‹æ˜¯JDKå„ç‰ˆæœ¬æ”¯æŒçš„ä¸»è¦åƒåœ¾å›æ”¶å™¨åŠå…¶ç‰¹ç‚¹ã€é€‚ç”¨åœºæ™¯ï¼ŒæŒ‰<strong>ç»å…¸â†’ç°ä»£</strong>çš„é¡ºåºå±•å¼€ï¼š</p>
<h3 data-id="heading-0"><strong>ä¸€ã€ç»å…¸åƒåœ¾å›æ”¶å™¨ï¼ˆJDK 8åŠä¹‹å‰ï¼‰</strong></h3>
<p>ç»å…¸å›æ”¶å™¨åŸºäº<strong>åˆ†ä»£å‡è®¾</strong>ï¼ˆå¹´è½»ä»£â€œæœç”Ÿå¤•ç­â€ã€è€å¹´ä»£â€œé•¿æœŸå­˜æ´»â€ï¼‰ï¼Œåˆ†ä¸º<strong>å¹´è½»ä»£</strong>ã€<strong>è€å¹´ä»£</strong>å’Œ<strong>æ•´å †</strong>ä¸‰ç±»ï¼Œé€‚ç”¨äºä¼ ç»Ÿå•ä½“åº”ç”¨æˆ–ä¸­å°å †åœºæ™¯ã€‚</p>
<h4 data-id="heading-1"><strong>1. å¹´è½»ä»£å›æ”¶å™¨ï¼ˆYoung Generationï¼‰</strong></h4>
<p>å¹´è½»ä»£å›æ”¶å™¨è´Ÿè´£å›æ”¶<strong>EdenåŒº</strong>å’Œ<strong>SurvivoråŒº</strong>ï¼ˆS0/S1ï¼‰çš„çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ï¼Œé€šå¸¸é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ï¼ˆæ— ç¢ç‰‡ã€æ•ˆç‡é«˜ï¼‰ã€‚</p>
<h5 data-id="heading-2"><strong>ï¼ˆ1ï¼‰Serialæ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå•çº¿ç¨‹ã€STWï¼ˆStop-The-Worldï¼Œæš‚åœæ‰€æœ‰åº”ç”¨çº¿ç¨‹ï¼‰ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨ï¼ˆå¦‚æ¡Œé¢ç¨‹åºï¼‰ã€å•æ ¸CPUç¯å¢ƒæˆ–èµ„æºå—é™çš„åµŒå…¥å¼è®¾å¤‡ã€‚</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šç®€å•é«˜æ•ˆï¼Œæ— çº¿ç¨‹äº¤äº’å¼€é”€ï¼Œå•çº¿ç¨‹ä¸‹ååé‡æœ€é«˜ã€‚</li>
<li><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseSerialGC</code>ï¼ˆå¯ç”¨Serialå¹´è½»ä»£+Serial Oldè€å¹´ä»£ç»„åˆï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-3"><strong>ï¼ˆ2ï¼‰ParNewæ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šSerialçš„<strong>å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬</strong>ï¼ŒåŒæ ·é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼ŒSTWã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤šæ ¸æœåŠ¡å™¨ï¼Œéœ€ä¸<strong>CMSè€å¹´ä»£æ”¶é›†å™¨</strong>é…åˆä½¿ç”¨ï¼ˆParNewæ˜¯CMSçš„å”¯ä¸€å¹´è½»ä»£æ­æ¡£ï¼‰ã€‚</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šå¤šçº¿ç¨‹å¹¶è¡Œå›æ”¶ï¼Œç¼©çŸ­å¹´è½»ä»£STWæ—¶é—´ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚</li>
<li><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseParNewGC</code>ï¼ˆæ˜¾å¼å¯ç”¨ParNewï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-4"><strong>ï¼ˆ3ï¼‰Parallel Scavengeæ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹å¹¶è¡Œã€å¤åˆ¶ç®—æ³•ï¼ŒSTWï¼Œ<strong>å…³æ³¨ååé‡</strong>ï¼ˆååé‡=ç”¨æˆ·ä»£ç æ—¶é—´/(ç”¨æˆ·ä»£ç æ—¶é—´+GCæ—¶é—´)ï¼‰ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåå°è¿ç®—ï¼ˆå¦‚æ‰¹å¤„ç†ã€ç§‘å­¦è®¡ç®—ï¼‰ã€ä¸éœ€è¦é¢‘ç¹äº¤äº’çš„æœåŠ¡ç«¯åº”ç”¨ã€‚</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šé€šè¿‡<code>-XX:MaxGCPauseMillis</code>ï¼ˆæœ€å¤§åœé¡¿æ—¶é—´ï¼‰ã€<code>-XX:GCTimeRatio</code>ï¼ˆååé‡ç›®æ ‡ï¼‰ç­‰å‚æ•°ï¼Œå¯å®ç°<strong>è‡ªé€‚åº”è°ƒèŠ‚</strong>ï¼ˆè‡ªåŠ¨è°ƒæ•´å †å¤§å°ã€åˆ†ä»£æ¯”ä¾‹ï¼‰ã€‚</li>
<li><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseParallelGC</code>ï¼ˆå¯ç”¨Parallel Scavengeå¹´è½»ä»£+Parallel Oldè€å¹´ä»£ç»„åˆï¼ŒJDK 8é»˜è®¤ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-5"><strong>2. è€å¹´ä»£å›æ”¶å™¨ï¼ˆOld Generationï¼‰</strong></h4>
<p>è€å¹´ä»£å›æ”¶å™¨è´Ÿè´£å›æ”¶<strong>è€å¹´ä»£</strong>çš„é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ï¼Œé€šå¸¸é‡‡ç”¨<strong>æ ‡è®°-æ¸…é™¤</strong>ï¼ˆCMSï¼‰æˆ–<strong>æ ‡è®°-æ•´ç†</strong>ï¼ˆSerial Oldã€Parallel Oldï¼‰ç®—æ³•ã€‚</p>
<h5 data-id="heading-6"><strong>ï¼ˆ1ï¼‰Serial Oldæ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šSerialçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå•çº¿ç¨‹ã€STWï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼ˆè§£å†³å†…å­˜ç¢ç‰‡ï¼‰ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨ï¼ˆé»˜è®¤è€å¹´ä»£æ”¶é›†å™¨ï¼‰ã€ä½œä¸ºCMSçš„åå¤‡æ–¹æ¡ˆï¼ˆå½“CMSå¹¶å‘æ”¶é›†å¤±è´¥æ—¶ï¼Œ fallbackåˆ°Serial Oldï¼‰ã€‚</li>
<li><strong>é…ç½®å‚æ•°</strong>ï¼šä¸Serialç»„åˆä½¿ç”¨ï¼ˆ<code>-XX:+UseSerialGC</code>ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-7"><strong>ï¼ˆ2ï¼‰Parallel Oldæ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šParallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå¤šçº¿ç¨‹å¹¶è¡Œã€STWï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸Parallel Scavengeé…åˆï¼Œæ„æˆ<strong>ååé‡ä¼˜å…ˆ</strong>çš„å®Œæ•´æ”¶é›†å™¨ç»„åˆï¼ˆJDK 8é»˜è®¤ï¼‰ã€‚</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šå¤šçº¿ç¨‹å¹¶è¡Œå›æ”¶ï¼Œæå‡è€å¹´ä»£ååé‡ï¼Œé€‚åˆé«˜ååéœ€æ±‚çš„æœåŠ¡å™¨ç«¯åº”ç”¨ã€‚</li>
<li><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseParallelOldGC</code>ï¼ˆæ˜¾å¼å¯ç”¨ï¼ŒJDK 8é»˜è®¤åŒ…å«ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-8"><strong>ï¼ˆ3ï¼‰CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li>
<p><strong>ç‰¹ç‚¹</strong>ï¼š<strong>å¹¶å‘æ”¶é›†</strong>ï¼ˆå¤§éƒ¨åˆ†é˜¶æ®µä¸åº”ç”¨çº¿ç¨‹åŒæ—¶è¿è¡Œï¼‰ã€<strong>ä½å»¶è¿Ÿ</strong>ï¼ˆSTWæ—¶é—´çŸ­ï¼‰ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼ˆæ— æ•´ç†ï¼Œæ˜“äº§ç”Ÿç¢ç‰‡ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li><strong>åˆå§‹æ ‡è®°</strong>ï¼ˆSTWï¼‰ï¼šæ ‡è®°GC Rootsç›´æ¥å…³è”çš„å¯¹è±¡ï¼ˆé€Ÿåº¦å¿«ï¼‰ï¼›</li>
<li><strong>å¹¶å‘æ ‡è®°</strong>ï¼ˆä¸åº”ç”¨çº¿ç¨‹å¹¶è¡Œï¼‰ï¼šéå†å¯¹è±¡å›¾ï¼Œæ ‡è®°å­˜æ´»å¯¹è±¡ï¼›</li>
<li><strong>é‡æ–°æ ‡è®°</strong>ï¼ˆSTWï¼‰ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´çš„å˜åŠ¨ï¼ˆæ¯”åˆå§‹æ ‡è®°ç•¥é•¿ï¼‰ï¼›</li>
<li><strong>å¹¶å‘æ¸…é™¤</strong>ï¼ˆä¸åº”ç”¨çº¿ç¨‹å¹¶è¡Œï¼‰ï¼šå›æ”¶æœªæ ‡è®°çš„å¯¹è±¡ã€‚</li>
</ol>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ï¼ˆå¦‚WebæœåŠ¡ã€ç”µå•†äº¤æ˜“ç³»ç»Ÿï¼‰ï¼Œéœ€å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¯¹CPUèµ„æºæ•æ„Ÿï¼ˆå¹¶å‘é˜¶æ®µå ç”¨çº¿ç¨‹ï¼Œå¯¼è‡´åº”ç”¨ååé‡ä¸‹é™ï¼‰ï¼›</li>
<li>æ— æ³•å¤„ç†<strong>æµ®åŠ¨åƒåœ¾</strong>ï¼ˆå¹¶å‘æ¸…é™¤é˜¶æ®µäº§ç”Ÿçš„æ–°åƒåœ¾ï¼Œéœ€ä¸‹æ¬¡GCå¤„ç†ï¼‰ï¼›</li>
<li>æ ‡è®°-æ¸…é™¤ç®—æ³•æ˜“å¯¼è‡´<strong>å†…å­˜ç¢ç‰‡</strong>ï¼ˆéœ€é€šè¿‡<code>-XX:+UseCMSCompactAtFullCollection</code>å®šæœŸæ•´ç†ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseConcMarkSweepGC</code>ï¼ˆå¯ç”¨CMSï¼ŒJDK 8åŠä¹‹å‰å¸¸ç”¨ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ³¨æ„</strong>ï¼šCMSåœ¨<strong>JDK 14</strong>ä¸­è¢«ç§»é™¤ï¼ˆJEP 363ï¼‰ï¼Œå› å…¶åœ¨å¤§å †åœºæ™¯ä¸‹å»¶è¿Ÿä¸ç¨³å®šã€‚</p>
</li>
</ul>
<h4 data-id="heading-9"><strong>3. æ•´å †å›æ”¶å™¨ï¼ˆWhole Heapï¼‰</strong></h4>
<p>æ•´å †å›æ”¶å™¨æ‰“ç ´<strong>å¹´è½»ä»£/è€å¹´ä»£</strong>çš„ç‰©ç†åˆ’åˆ†ï¼Œå°†å †åˆ’åˆ†ä¸ºå¤šä¸ª<strong>Region</strong>ï¼ˆåŒºåŸŸï¼‰ï¼Œå®ç°æ›´çµæ´»çš„å†…å­˜ç®¡ç†ï¼Œå…¼é¡¾ååé‡ä¸å»¶è¿Ÿã€‚</p>
<h5 data-id="heading-10"><strong>ï¼ˆ1ï¼‰G1ï¼ˆGarbage-Firstï¼‰æ”¶é›†å™¨</strong>â€‹</h5>
<ul>
<li>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>åŒºåŸŸåŒ–åˆ†ä»£</strong>ï¼šå°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionï¼ˆé»˜è®¤1MB-32MBï¼‰ï¼Œæ¯ä¸ªRegionå¯æ‰®æ¼”Edenã€Survivoræˆ–è€å¹´ä»£ï¼›</li>
<li><strong>å¯é¢„æµ‹åœé¡¿</strong>ï¼šé€šè¿‡<code>-XX:MaxGCPauseMillis</code>ï¼ˆé»˜è®¤200msï¼‰è®¾ç½®æœ€å¤§åœé¡¿æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶â€œåƒåœ¾æœ€å¤šâ€çš„Regionï¼ˆGarbage-Firstï¼‰ï¼›</li>
<li><strong>å¹¶å‘æ ‡è®°</strong>ï¼šä¸åº”ç”¨çº¿ç¨‹å¹¶è¡Œæ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œå‡å°‘STWæ—¶é—´ï¼›</li>
<li><strong>æ ‡è®°-æ•´ç†</strong>ï¼šå›æ”¶æ—¶é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼ˆå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°Regionï¼‰ï¼Œé¿å…å†…å­˜ç¢ç‰‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§å †å†…å­˜ï¼ˆå¦‚16GBä»¥ä¸Šï¼‰ã€å»¶è¿Ÿæ•æ„Ÿçš„æœåŠ¡ç«¯åº”ç”¨ï¼ˆå¦‚å¾®æœåŠ¡ã€å¤§æ•°æ®å¤„ç†ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŠ¿</strong>ï¼šå…¼é¡¾ååé‡ï¼ˆå¹¶è¡Œå›æ”¶ï¼‰ä¸å»¶è¿Ÿï¼ˆå¯é¢„æµ‹åœé¡¿ï¼‰ï¼Œæ˜¯JDK 9è‡³JDK 20çš„<strong>é»˜è®¤æ”¶é›†å™¨</strong>ã€‚</p>
</li>
<li>
<p><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseG1GC</code>ï¼ˆæ˜¾å¼å¯ç”¨ï¼‰ã€‚</p>
</li>
</ul>
<h3 data-id="heading-11"><strong>äºŒã€ç°ä»£åƒåœ¾å›æ”¶å™¨ï¼ˆJDK 11åŠä¹‹åï¼‰</strong></h3>
<p>éšç€äº‘åŸç”Ÿã€å¤§å †å†…å­˜ï¼ˆTBçº§ï¼‰åº”ç”¨çš„æ™®åŠï¼Œç»å…¸å›æ”¶å™¨çš„<strong>å»¶è¿Ÿç“¶é¢ˆ</strong>ï¼ˆå¦‚G1çš„STWæ—¶é—´éšå †å¢å¤§è€Œå¢åŠ ï¼‰æ—¥ç›Šå‡¸æ˜¾ã€‚ç°ä»£å›æ”¶å™¨é€šè¿‡<strong>å…¨å †å¹¶å‘</strong>ï¼ˆå‡ ä¹æ‰€æœ‰é˜¶æ®µä¸åº”ç”¨çº¿ç¨‹å¹¶è¡Œï¼‰ã€<strong>åˆ†ä»£ä¼˜åŒ–</strong>ï¼ˆå¦‚Generational ZGCï¼‰ç­‰æŠ€æœ¯ï¼Œå®ç°<strong>è¶…ä½å»¶è¿Ÿ</strong>ï¼ˆ&lt;1msï¼‰ä¸<strong>å¤§å †æ”¯æŒ</strong>ï¼ˆTBçº§ï¼‰ã€‚</p>
<h4 data-id="heading-12"><strong>1. ZGCï¼ˆZ Garbage Collectorï¼‰</strong> â€‹</h4>
<ul>
<li>
<p><strong>å¼•å…¥ç‰ˆæœ¬</strong>ï¼šJDK 11ï¼ˆå®éªŒæ€§ï¼‰ã€JDK 15ï¼ˆç”Ÿäº§çº§ç¨³å®šï¼ŒJEP 377ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼š</p>
<ul>
<li><strong>è¶…ä½å»¶è¿Ÿ</strong>ï¼šæœ€å¤§STWåœé¡¿æ—¶é—´&lt;1msï¼ˆä¸å †å¤§å°æ— å…³ï¼‰ï¼›</li>
<li><strong>å¤§å †æ”¯æŒ</strong>ï¼šæ”¯æŒ8MBè‡³16TBçš„å †å†…å­˜ï¼ˆé€‚åˆäº‘åŸç”Ÿã€å¤§æ•°æ®åœºæ™¯ï¼‰ï¼›</li>
<li><strong>å…¨å †å¹¶å‘</strong>ï¼šå‡ ä¹æ‰€æœ‰é˜¶æ®µï¼ˆæ ‡è®°ã€è½¬ç§»ã€é‡æ˜ å°„ï¼‰ä¸åº”ç”¨çº¿ç¨‹å¹¶è¡Œã€‚</li>
</ul>
</li>
<li>
<p><strong>å…³é”®æŠ€æœ¯</strong>ï¼š</p>
<ul>
<li><strong>ç€è‰²æŒ‡é’ˆï¼ˆColored Pointersï¼‰</strong> ï¼šåœ¨64ä½å¯¹è±¡åœ°å€ä¸­ç¼–ç GCçŠ¶æ€ï¼ˆå¦‚Marked0ã€Marked1ã€Remappedï¼‰ï¼Œå®ç°å¹¶å‘æ ‡è®°ä¸è½¬ç§»ï¼›</li>
<li><strong>è¯»å±éšœï¼ˆLoad Barrierï¼‰</strong> ï¼šåº”ç”¨çº¿ç¨‹è¯»å–å¯¹è±¡æ—¶ï¼Œæ£€æŸ¥æŒ‡é’ˆçŠ¶æ€ï¼Œä¿®æ­£å¹¶å‘è½¬ç§»åçš„å¯¹è±¡åœ°å€ï¼ˆç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼‰ï¼›</li>
<li><strong>Regionlessç»“æ„</strong>ï¼šæ— å›ºå®šå¤§å°çš„Regionï¼Œæ ¹æ®å¯¹è±¡å¤§å°åŠ¨æ€åˆ†é…ï¼ˆå°å‹Region 2MBã€ä¸­å‹32MBã€å¤§å‹Region 4MBä»¥ä¸Šï¼‰ï¼Œé¿å…ç¢ç‰‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå»¶è¿Ÿæ•æ„Ÿçš„è¶…å¤§å †åº”ç”¨ï¼ˆå¦‚å¹¿å‘Šç³»ç»Ÿã€æ¸¸æˆåç«¯ã€åœ¨çº¿æœåŠ¡ç½‘å…³ï¼‰ã€äº‘åŸç”Ÿå®¹å™¨ç¯å¢ƒï¼ˆå¦‚K8sï¼‰ã€‚</p>
</li>
<li>
<p><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseZGC</code>ï¼ˆJDK 15+æ— éœ€è§£é”å®éªŒæ€§å‚æ•°ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ¼”è¿›</strong>ï¼šJDK 21å¼•å…¥<strong>Generational ZGC</strong>ï¼ˆåˆ†ä»£ZGCï¼‰ï¼Œç»“åˆåˆ†ä»£å‡è®¾ä¸ZGCçš„è¶…ä½å»¶è¿Ÿï¼Œè¿›ä¸€æ­¥æå‡ååé‡ï¼ˆå¦‚å¹´è½»ä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨å¹¶å‘è½¬ç§»ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-13"><strong>2. Shenandoah GC</strong>â€‹</h4>
<ul>
<li>
<p><strong>å¼•å…¥ç‰ˆæœ¬</strong>ï¼šJDK 12ï¼ˆå®éªŒæ€§ï¼‰ã€JDK 17ï¼ˆç”Ÿäº§çº§ç¨³å®šï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç›®æ ‡</strong>ï¼š<strong>ä½å»¶è¿Ÿ</strong>ï¼ˆSTWåœé¡¿æ—¶é—´&lt;10msï¼‰ã€<strong>å…¨å †å¹¶å‘</strong>ï¼ˆä¸ZGCç±»ä¼¼ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å…³é”®æŠ€æœ¯</strong>ï¼š</p>
<ul>
<li><strong>BrooksæŒ‡é’ˆ</strong>ï¼šåœ¨å¯¹è±¡å¤´ä¸­å­˜å‚¨è½¬å‘åœ°å€ï¼ˆForwarding Addressï¼‰ï¼Œå®ç°å¹¶å‘è½¬ç§»ï¼ˆé¿å…è¯»å±éšœçš„æ€§èƒ½å¼€é”€ï¼‰ï¼›</li>
<li><strong>è¯»å†™å±éšœç»“åˆ</strong>ï¼šé€šè¿‡è¯»å±éšœï¼ˆä¿®æ­£å¯¹è±¡åœ°å€ï¼‰å’Œå†™å±éšœï¼ˆè·Ÿè¸ªå¯¹è±¡å¼•ç”¨å˜åŠ¨ï¼‰ï¼Œç¡®ä¿å¹¶å‘æ ‡è®°çš„å‡†ç¡®æ€§ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä¸ZGCç±»ä¼¼ï¼Œé€‚åˆå»¶è¿Ÿæ•æ„Ÿçš„å¤§å †åº”ç”¨ï¼ˆå¦‚é‡‘èäº¤æ˜“ç³»ç»Ÿã€å®æ—¶æ•°æ®å¤„ç†ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŠ¿</strong>ï¼šRedHatä¸»å¯¼å¼€å‘ï¼Œç¤¾åŒºæ´»è·ƒï¼Œå¯¹<strong>å¤§å¯¹è±¡</strong>ï¼ˆå¦‚ç¼“å­˜æ•°æ®ï¼‰çš„å¤„ç†æ›´é«˜æ•ˆã€‚</p>
</li>
</ul>
<h4 data-id="heading-14"><strong>3. Epsilon GCï¼ˆJDK 21+ï¼‰</strong> â€‹</h4>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>æ— æ“ä½œæ”¶é›†å™¨</strong>ï¼ˆNo-Op GCï¼‰ï¼Œä»…åˆ†é…å†…å­˜ï¼Œä¸å›æ”¶åƒåœ¾ï¼ˆåº”ç”¨é€€å‡ºæ—¶ç”±æ“ä½œç³»ç»Ÿé‡Šæ”¾å†…å­˜ï¼‰ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<strong>æ€§èƒ½æµ‹è¯•</strong>ï¼ˆå¦‚è¯„ä¼°åº”ç”¨çš„å†…å­˜åˆ†é…é€Ÿç‡ã€æ’é™¤GCå¹²æ‰°ï¼‰ã€çŸ­æœŸè¿è¡Œçš„å·¥å…·ï¼ˆå¦‚è„šæœ¬ï¼‰ã€‚</li>
<li><strong>é…ç½®å‚æ•°</strong>ï¼š<code>-XX:+UseEpsilonGC</code>ï¼ˆæ˜¾å¼å¯ç”¨ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-15"><strong>ä¸‰ã€å„JDKç‰ˆæœ¬çš„é»˜è®¤åƒåœ¾å›æ”¶å™¨</strong></h3>

























<table><thead><tr><th>JDKç‰ˆæœ¬</th><th>é»˜è®¤åƒåœ¾å›æ”¶å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>JDK 8</td><td>Parallel Scavenge + Parallel Old</td><td>ååé‡ä¼˜å…ˆï¼Œé€‚åˆä¼ ç»ŸæœåŠ¡ç«¯åº”ç”¨</td></tr><tr><td>JDK 9-20</td><td>G1</td><td>å…¼é¡¾ååé‡ä¸å»¶è¿Ÿï¼Œé€‚åˆå¤§å †å†…å­˜</td></tr><tr><td>JDK 21+</td><td>ZGCï¼ˆè‹¥æ”¯æŒï¼‰</td><td>è¶…ä½å»¶è¿Ÿã€å¤§å †æ”¯æŒï¼Œé€‚åˆäº‘åŸç”Ÿã€å»¶è¿Ÿæ•æ„Ÿåº”ç”¨ï¼ˆå¦åˆ™ fallbackåˆ°G1ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-16"><strong>å››ã€åƒåœ¾å›æ”¶å™¨é€‰å‹å»ºè®®</strong></h3>
<p>é€‰æ‹©åƒåœ¾å›æ”¶å™¨çš„æ ¸å¿ƒä¾æ®æ˜¯<strong>åº”ç”¨éœ€æ±‚</strong>ï¼ˆå»¶è¿Ÿã€ååé‡ã€å †å¤§å°ï¼‰ï¼Œä»¥ä¸‹æ˜¯å¸¸è§åœºæ™¯çš„é€‰å‹æŒ‡å—ï¼š</p>



































<table><thead><tr><th>åœºæ™¯ç±»å‹</th><th>æ¨èæ”¶é›†å™¨</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>å®¢æˆ·ç«¯åº”ç”¨ï¼ˆæ¡Œé¢ç¨‹åºï¼‰</td><td>Serial + Serial Old</td><td>ç®€å•é«˜æ•ˆï¼Œæ— çº¿ç¨‹å¼€é”€</td></tr><tr><td>é«˜åååå°è¿ç®—ï¼ˆæ‰¹å¤„ç†ï¼‰</td><td>Parallel Scavenge + Parallel Old</td><td>ååé‡ä¼˜å…ˆï¼Œé€‚åˆä¸éœ€è¦äº¤äº’çš„åœºæ™¯</td></tr><tr><td>å»¶è¿Ÿæ•æ„ŸWebæœåŠ¡</td><td>G1ï¼ˆJDK 8-20ï¼‰/ ZGCï¼ˆJDK 21+ï¼‰</td><td>G1çš„å¯é¢„æµ‹åœé¡¿é€‚åˆä¸­å°å †ï¼ŒZGCçš„è¶…ä½å»¶è¿Ÿé€‚åˆå¤§å †</td></tr><tr><td>è¶…å¤§å †ï¼ˆTBçº§ï¼‰åº”ç”¨</td><td>ZGC / Shenandoah</td><td>æ”¯æŒTBçº§å †ï¼Œå…¨å †å¹¶å‘ï¼Œå»¶è¿Ÿ&lt;1ms</td></tr><tr><td>æ€§èƒ½æµ‹è¯•</td><td>Epsilon GC</td><td>æ’é™¤GCå¹²æ‰°ï¼Œè¯„ä¼°åº”ç”¨æœ¬èº«æ€§èƒ½</td></tr></tbody></table>
<h3 data-id="heading-17"><strong>äº”ã€æ€»ç»“</strong></h3>
<p>JDKçš„åƒåœ¾å›æ”¶å™¨ç»å†äº†ä»<strong>ç»å…¸åˆ†ä»£</strong>ï¼ˆSerialã€Parallelã€CMSã€G1ï¼‰åˆ°<strong>ç°ä»£å…¨å †å¹¶å‘</strong>ï¼ˆZGCã€Shenandoahï¼‰çš„æ¼”è¿›ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯<strong>é™ä½å»¶è¿Ÿ</strong>ï¼ˆSTWæ—¶é—´ï¼‰ä¸<strong>æ”¯æŒå¤§å †</strong>ï¼ˆTBçº§ï¼‰ã€‚é€‰å‹æ—¶éœ€ç»“åˆ<strong>åº”ç”¨åœºæ™¯</strong>ï¼ˆå»¶è¿Ÿ/ååé‡éœ€æ±‚ï¼‰ã€<strong>å †å¤§å°</strong>ï¼ˆä¸­å°å †/è¶…å¤§å †ï¼‰å’Œ<strong>JDKç‰ˆæœ¬</strong>ï¼ˆå¦‚JDK 21+é»˜è®¤ZGCï¼‰ï¼Œé€‰æ‹©æœ€é€‚åˆçš„æ”¶é›†å™¨ã€‚</p>
<p>å¦‚éœ€è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¯é€šè¿‡<strong>JVMå‚æ•°</strong>ï¼ˆå¦‚<code>-XX:MaxGCPauseMillis</code>ã€<code>-XX:G1HeapRegionSize</code>ã€<code>-XX:ZUncommitDelay</code>ï¼‰è°ƒæ•´æ”¶é›†å™¨è¡Œä¸ºï¼Œæˆ–ä½¿ç”¨<strong>ç›‘æ§å·¥å…·</strong>ï¼ˆå¦‚VisualVMã€GCEasyï¼‰åˆ†æGCæ—¥å¿—ï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RocketMQä»å®æˆ˜åˆ°æºç ï¼šSpringBootæ•´åˆRocketMQ]]></title>    <link>https://juejin.cn/post/7600060691350470698</link>    <guid>https://juejin.cn/post/7600060691350470698</guid>    <pubDate>2026-01-28T14:18:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600060691350470698" data-draft-id="7600240045366591542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RocketMQä»å®æˆ˜åˆ°æºç ï¼šSpringBootæ•´åˆRocketMQ"/> <meta itemprop="keywords" content="åç«¯,RocketMQ"/> <meta itemprop="datePublished" content="2026-01-28T14:18:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ€’æ”¾å§å¾·å¾·"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RocketMQä»å®æˆ˜åˆ°æºç ï¼šSpringBootæ•´åˆRocketMQ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ€’æ”¾å§å¾·å¾·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T14:18:42.000Z" title="Wed Jan 28 2026 14:18:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RocketMQä»å®æˆ˜åˆ°æºç ï¼šSpringBootæ•´åˆRocketMQ</h2>
<blockquote>
<p>ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢</p>
<p>ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°</p>
<p>ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·</p>
<p>ğŸ† <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">åšå®¢é¦–é¡µ</a> Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@æ€’æ”¾å§å¾·å¾·</a>Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">Toè®°å½•é¢†åœ°</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº</a></p>
<p>ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼</p>
</blockquote>
<p><em>è½¬å‘è¯·æºå¸¦ä½œè€…ä¿¡æ¯</em>Â  <strong>@æ€’æ”¾å§å¾·å¾·(æ˜é‡‘) @ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº(CSDN)</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c33ed4ee428469db4621f0d3f673b67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770214722&amp;x-signature=GbDQMs9j51WT9%2BOtBqvLxwFWMVI%3D" alt="rocketmqå°é¢.png" loading="lazy"/></p>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶æ˜¯å®ç°æœåŠ¡è§£è€¦ã€å‰Šå³°å¡«è°·ã€å¼‚æ­¥é€šä¿¡çš„æ ¸å¿ƒç»„ä»¶ï¼Œè€Œ RocketMQ ä½œä¸ºé˜¿é‡Œå¼€æºçš„é«˜æ€§èƒ½ã€é«˜å¯é åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå‡­å€Ÿé«˜ååé‡ã€ä½å»¶è¿Ÿã€å¼ºä¸€è‡´æ€§ç­‰ç‰¹æ€§ï¼Œå¹¿æ³›åº”ç”¨äºå„ç±»åˆ†å¸ƒå¼ç³»ç»Ÿã€‚SpringBoot åˆ™ä»¥â€œçº¦å®šå¤§äºé…ç½®â€çš„ç†å¿µï¼Œæå¤§ç®€åŒ–äº†ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æ•´åˆæˆæœ¬ã€‚æœ¬æ–‡å°†ä»å®æ“è§’åº¦å‡ºå‘ï¼Œè¯¦ç»†è®²è§£ RocketMQ ä¸ SpringBoot çš„å®Œæ•´æ•´åˆæµç¨‹ï¼ŒåŒ…å«ç¯å¢ƒå‡†å¤‡ã€ä¾èµ–é…ç½®ã€ç”Ÿäº§è€…/æ¶ˆè´¹è€…å®ç°ã€æµ‹è¯•éªŒè¯ï¼Œä»¥åŠå¸¸è§é—®é¢˜æ’æŸ¥ï¼Œé€‚åˆæ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹ï¼Œä¹Ÿå¯ä½œä¸ºå¼€å‘å‚è€ƒæ‰‹å†Œã€‚</p>
<h3 data-id="heading-2">1 æ•´åˆ SpringBoot</h3>
<h4 data-id="heading-3">1.1 ç¯å¢ƒ</h4>
<p>rocketmq: 2.2.3 RocketMQ ä¸ SpringBoot çš„æ•´åˆä¾èµ–å®˜æ–¹æä¾›çš„ starter ç»„ä»¶ï¼Œç‰ˆæœ¬é€‚é…è‡³å…³é‡è¦ï¼Œå¦åˆ™ä¼šå‡ºç°è‡ªåŠ¨é…ç½®å¤±æ•ˆã€Bean æ³¨å…¥å¤±è´¥ç­‰é—®é¢˜ã€‚æœ¬æ–‡é€‰ç”¨ä¸šå†…ç¨³å®šå…¼å®¹ç‰ˆæœ¬ç»„åˆï¼ˆæ–°æ‰‹ç›´æ¥ç…§æ¬å³å¯ï¼‰ï¼Œç‰ˆæœ¬å¯¹åº”å…³ç³»å‚è€ƒ Apache RocketMQ å®˜æ–¹å…¼å®¹æ€§çŸ©é˜µï¼š</p>
<ul>
<li>JDKï¼š17ï¼ˆéœ€è¦ 1.8+ï¼ŒRocketMQ å¯¹ JDK 11+ å…¼å®¹æ€§ä¸€èˆ¬ï¼Œç”Ÿäº§ç¯å¢ƒä¼˜å…ˆé€‰ç”¨ JDK 8ï¼Œé¿å…è¸©å‘ï¼‰</li>
<li>SpringBootï¼š2.7.xï¼ˆç¨³å®šç‰ˆï¼Œé¿å…ä½¿ç”¨ 3.x ç‰ˆæœ¬ï¼Œä¸ RocketMQ starter å­˜åœ¨å…¼å®¹æ–­ç‚¹ï¼‰</li>
<li>RocketMQï¼š4.9.7ï¼ˆç¨³å®šç‰ˆï¼Œç¤¾åŒºé•¿æœŸç»´æŠ¤ï¼Œé€‚é… SpringBoot 2.7.xï¼‰</li>
<li>RocketMQ SpringBoot Starterï¼š2.2.3ï¼ˆå¦‚æœä½¿ç”¨ 2.3 çš„ç‰ˆæœ¬ï¼Œjdk éœ€è¦ 17ï¼Œå¹¶ä¸” springboot éœ€è¦ 3.0 ä»¥ä¸Šï¼‰</li>
<li>Mavenï¼š3.6+ï¼ˆé¡¹ç›®æ„å»ºå·¥å…·ï¼‰</li>
</ul>
<h4 data-id="heading-4">1.2 å¼•å…¥ä¾èµ–</h4>
<p>åˆ›å»º SpringBoot é¡¹ç›®ï¼Œå¼•å…¥ RocketMQ æ•´åˆä¾èµ–ï¼Œæ ¸å¿ƒæ˜¯ RocketMQ å®˜æ–¹æä¾›çš„ spring-boot-starterï¼Œæ— éœ€æ‰‹åŠ¨å¼•å…¥åŸç”Ÿ RocketMQ å®¢æˆ·ç«¯ä¾èµ–ï¼Œstarter ä¼šè‡ªåŠ¨å®Œæˆä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®ã€‚</p>
<pre><code class="hljs language-java" lang="java">&lt;!-- RocketMQ ä¾èµ– --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;
    &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">2.2</span><span class="hljs-number">.3</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 data-id="heading-5">1.3 é…ç½®</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># rocketmq é…ç½®é¡¹ï¼Œå¯¹åº” RocketMQProperties é…ç½®ç±»</span>
<span class="hljs-attr">rocketmq:</span>
  <span class="hljs-attr">name-server:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.109</span><span class="hljs-number">.134</span><span class="hljs-string">:9876</span> <span class="hljs-comment"># RocketMQ Namesrv</span>
  <span class="hljs-comment"># Producer é…ç½®é¡¹ ï¼ˆåªæœ‰é…ç½®äº†ç”Ÿäº§è€…ï¼Œæ‰ä¼šåˆå§‹åŒ–RocketMQTemplateï¼‰</span>
  <span class="hljs-attr">producer:</span>
    <span class="hljs-attr">group:</span> <span class="hljs-string">demo-spring-group</span> <span class="hljs-comment"># ç”Ÿäº§è€…åˆ†ç»„(è‡ªå®šä¹‰)</span>
    <span class="hljs-attr">send-message-timeout:</span> <span class="hljs-number">3000</span> <span class="hljs-comment"># å‘é€æ¶ˆæ¯è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚é»˜è®¤ä¸º 3000 ã€‚</span>
    <span class="hljs-attr">compress-message-body-threshold:</span> <span class="hljs-number">4096</span> <span class="hljs-comment"># æ¶ˆæ¯å‹ç¼©é˜€å€¼ï¼Œå½“æ¶ˆæ¯ä½“çš„å¤§å°è¶…è¿‡è¯¥é˜€å€¼åï¼Œè¿›è¡Œæ¶ˆæ¯å‹ç¼©ã€‚é»˜è®¤ä¸º 4 * 1024B</span>
    <span class="hljs-attr">max-message-size:</span> <span class="hljs-number">4194304</span> <span class="hljs-comment"># æ¶ˆæ¯ä½“çš„æœ€å¤§å…è®¸å¤§å°ã€‚ã€‚é»˜è®¤ä¸º 4 * 1024 * 1024B</span>
    <span class="hljs-attr">retry-times-when-send-failed:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># åŒæ­¥å‘é€æ¶ˆæ¯æ—¶ï¼Œå¤±è´¥é‡è¯•æ¬¡æ•°ã€‚é»˜è®¤ä¸º 2 æ¬¡ã€‚</span>
    <span class="hljs-attr">retry-times-when-send-async-failed:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># å¼‚æ­¥å‘é€æ¶ˆæ¯æ—¶ï¼Œå¤±è´¥é‡è¯•æ¬¡æ•°ã€‚é»˜è®¤ä¸º 2 æ¬¡ã€‚</span>
    <span class="hljs-attr">retry-next-server:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># å‘é€æ¶ˆæ¯ç»™ Broker æ—¶ï¼Œå¦‚æœå‘é€å¤±è´¥ï¼Œæ˜¯å¦é‡è¯•å¦å¤–ä¸€å° Broker ã€‚é»˜è®¤ä¸º false</span>
    <span class="hljs-attr">access-key:</span> <span class="hljs-comment"># Access Key ï¼Œå¯é˜…è¯» https://github.com/apache/rocketmq/blob/master/docs/cn/acl/user_guide.md æ–‡æ¡£</span>
    <span class="hljs-attr">secret-key:</span> <span class="hljs-comment"># Secret Key</span>
    <span class="hljs-attr">enable-msg-trace:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ˜¯å¦å¼€å¯æ¶ˆæ¯è½¨è¿¹åŠŸèƒ½ã€‚é»˜è®¤ä¸º true å¼€å¯ã€‚å¯é˜…è¯» https://github.com/apache/rocketmq/blob/master/docs/cn/msg_trace/user_guide.md æ–‡æ¡£</span>
    <span class="hljs-attr">customized-trace-topic:</span> <span class="hljs-string">RMQ_SYS_TRACE_TOPIC</span> <span class="hljs-comment"># è‡ªå®šä¹‰æ¶ˆæ¯è½¨è¿¹çš„ Topic ã€‚é»˜è®¤ä¸º RMQ_SYS_TRACE_TOPIC ã€‚</span>
  <span class="hljs-comment"># Consumer é…ç½®é¡¹ (å¯ä»¥ä¸åœ¨è¿™é‡Œé…ç½®ï¼Œä¸åœ¨è¿™é‡Œé…ç½®éœ€è¦åœ¨æ³¨è§£ä¸­é…ç½®)</span>

</code></pre>
<p>å¯åŠ¨ç±»ä¸éœ€è¦é…ç½®ï¼Œå°±è·Ÿä½¿ç”¨ redis ä¸€æ ·ã€‚</p>
<h4 data-id="heading-6">1.4 ä»£ç </h4>
<p>ç®€å•è¿›è¡Œæ“ä½œï¼Œåšä¸ªç®€å•çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>æ„å»ºä¸€ä¸ªæ¶ˆæ¯ç±»ï¼Œå®é™…å¼€å‘ä¸­å¸¸å‘é€å¯¹è±¡æ¶ˆæ¯ï¼ˆå¦‚è®¢å•ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œéœ€åˆ›å»ºå®ä½“ç±»å¹¶å®ç° Serializable æ¥å£ï¼ˆé¿å…åºåˆ—åŒ–å¤±è´¥ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo01Message</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOPIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SPRING-DEMO-01"</span>;
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Integer id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Demo01Message{"</span> +
        <span class="hljs-string">"id="</span> + id +
        <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p>ç”Ÿäº§è€…ä»£ç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RocketMQTemplate rocketMQTemplate;

    <span class="hljs-comment">/**
     * åŒæ­¥
     * <span class="hljs-doctag">@param</span> id
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> SendResult <span class="hljs-title function_">syncSend</span><span class="hljs-params">(Integer id)</span> {
        <span class="hljs-comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span>
        <span class="hljs-type">Demo01Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo01Message</span>();
        message.setId(id);
        <span class="hljs-comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span>
        <span class="hljs-keyword">return</span> rocketMQTemplate.syncSend(Demo01Message.TOPIC, message);
    }

    <span class="hljs-comment">/**
     * å¼‚æ­¥
     * <span class="hljs-doctag">@param</span> id
     * <span class="hljs-doctag">@param</span> callback å›è°ƒ
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">asyncSend</span><span class="hljs-params">(Integer id, SendCallback callback)</span> {
        <span class="hljs-comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span>
        <span class="hljs-type">Demo01Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo01Message</span>();
        message.setId(id);
        rocketMQTemplate.asyncSend(Demo01Message.TOPIC, message, callback);
    }

    <span class="hljs-comment">/**
     * å•å‘å‘é€
     * <span class="hljs-doctag">@param</span> id
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onewaySend</span><span class="hljs-params">(Integer id)</span> {
        <span class="hljs-comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span>
        <span class="hljs-type">Demo01Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo01Message</span>();
        message.setId(id);
        rocketMQTemplate.sendOneWay(Demo01Message.TOPIC, message);
    }

}
</code></pre>
<p>é€šè¿‡ä½¿ç”¨ <code>RocketMQTemplate</code>è¿›è¡Œå‘é€æ¶ˆæ¯ï¼Œä»¥ä¸Šæ¡ˆä¾‹æµ‹è¯•äº† 3 ç§æ¶ˆæ¯å‘é€æ–¹å¼ï¼ˆåŒæ­¥ã€å¼‚æ­¥ã€å•å‘ï¼‰ã€‚</p>
<p>æ¶ˆè´¹è€…ä»£ç </p>
<p>:::info
SpringBoot æ•´åˆ RocketMQ åï¼Œæ¶ˆè´¹è€…æ— éœ€æ‰‹åŠ¨å¯åŠ¨ç›‘å¬ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªç›‘å¬ç±»ï¼Œå®ç° RocketMQListener æ¥å£ï¼Œå¹¶ç”¨ @RocketMQMessageListener æ³¨è§£æŒ‡å®šè®¢é˜…çš„ä¸»é¢˜å’Œæ¶ˆè´¹è€…ç»„ï¼ŒSpring ä¼šè‡ªåŠ¨æ‰«æå¹¶å¯åŠ¨ç›‘å¬ã€‚</p>
<p>:::</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RocketMQMessageListener(topic = Demo01Message.TOPIC,
        consumerGroup = "GROUP-" + Demo01Message.TOPIC)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;Demo01Message&gt; {
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"æ¶ˆè´¹è€…ç›‘å¬å·²å¯åŠ¨..."</span>);
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(Demo01Message messageExt)</span> {
        log.info(<span class="hljs-string">"[æ¶ˆè´¹è€…][çº¿ç¨‹å·:{} ç›‘å¬åˆ°æ¶ˆæ¯ï¼š{}]"</span>, Thread.currentThread().getId(), messageExt);
    }
}
</code></pre>
<blockquote>
<p>æ³¨ï¼šè¿™ä¸ª onMessage çš„ç±»å‹ Demo01Message å¯ä»¥æ”¾åŸæ¥çš„ç±» MessageExt</p>
</blockquote>
<p>æ¶ˆè´¹è€…çš„å£°æ˜çš„æ‰€æœ‰å±æ€§é€šè¿‡@RocketMQMessageListeneræ³¨è§£å£°æ˜ï¼Œå®ç° RocketMQListener æ¥å£ã€‚</p>
<p>æˆ‘ä»¬æ„å»ºä¸€ä¸ªæµ‹è¯•ç±»è¿›è¡Œæ“¦çœ‹æµ‹è¯•ç»“æœ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RocketProducerTest</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Producer producer;

    <span class="hljs-comment">/**
     * æµ‹è¯•åŒæ­¥å‘é€
     */</span>
    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSyncSend</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (System.currentTimeMillis() / <span class="hljs-number">1000</span>);
        <span class="hljs-type">SendResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> producer.syncSend(id);
        log.info(<span class="hljs-string">"[æµ‹è¯•åŒæ­¥å‘é€][å‘é€ç¼–å·ï¼š[{}] å‘é€ç»“æœï¼š[{}]]"</span>, id, result);

        <span class="hljs-comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>).await();
    }

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAsyncSend</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (System.currentTimeMillis() / <span class="hljs-number">1000</span>);
        producer.asyncSend(id, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(SendResult sendResult)</span> {
                log.info(<span class="hljs-string">"[æµ‹è¯•å¼‚æ­¥å‘é€][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[{}]]"</span>, id, sendResult);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onException</span><span class="hljs-params">(Throwable throwable)</span> {
                log.info(<span class="hljs-string">"[testASyncSend][å‘é€ç¼–å·ï¼š[{}] å‘é€å¼‚å¸¸]]"</span>, id, throwable);
            }
        });


        <span class="hljs-comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>).await();
    }

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOnewaySend</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (System.currentTimeMillis() / <span class="hljs-number">1000</span>);

        producer.onewaySend(id);
        log.info(<span class="hljs-string">"[æµ‹è¯•å¼‚æ­¥å‘é€][å‘é€ç¼–å·ï¼š[{}] å‘é€æˆåŠŸ, ä¸å…³å¿ƒæ˜¯å¦è¢«æ¶ˆè´¹ï¼"</span>, id);
        <span class="hljs-comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>).await();
    }

}
</code></pre>
<p>è¿è¡Œç»“æœ</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3dd8b8eab8b4270bcaee5d0eb36d0e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770214722&amp;x-signature=PSumvrNM84PaFXFGvRDE7kGcMIk%3D" alt="" loading="lazy"/></p>
<p>æ›´å¤šæ¡ˆä¾‹æŸ¥çœ‹ giteeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fliyongde%2Fjava-trial%2Ftree%2Fmaster%2FTrial1-RocketMQ%2FTrial1-RocketMQ-Demo1" target="_blank" title="https://gitee.com/liyongde/java-trial/tree/master/Trial1-RocketMQ/Trial1-RocketMQ-Demo1" ref="nofollow noopener noreferrer">rocketmq-demo</a></p>
<h3 data-id="heading-7">2 ç›¸å…³é…ç½®</h3>
<p>ç»“åˆå‰æ–‡é…ç½®æ–‡ä»¶ï¼Œè¡¥å…… RocketMQ ä¸ SpringBoot æ•´åˆçš„æ ¸å¿ƒé…ç½®è¯´æ˜ï¼ˆå¯¹åº” application.ymlï¼‰ï¼Œå¸®åŠ©å¤§å®¶æ ¹æ®ä¸šåŠ¡åœºæ™¯çµæ´»è°ƒæ•´ï¼Œé¿å…ç›²ç›®é…ç½®ï¼š</p>















































<table><thead><tr><th><strong>é…ç½®é¡¹</strong></th><th><strong>å«ä¹‰</strong></th><th><strong>é»˜è®¤å€¼</strong></th><th><strong>ä½¿ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td>rocketmq.name-server</td><td>NameServer åœ°å€ï¼Œç”Ÿäº§è€…/æ¶ˆè´¹è€…é€šè¿‡è¯¥åœ°å€æ‰¾åˆ° Broker</td><td>æ— ï¼ˆå¿…é…ï¼‰</td><td>å•æœº/é›†ç¾¤éƒ¨ç½²å‡éœ€é…ç½®ï¼Œé›†ç¾¤ç”¨åˆ†å·åˆ†éš”å¤šä¸ªåœ°å€</td></tr><tr><td>rocketmq.producer.group</td><td>ç”Ÿäº§è€…ç»„åç§°ï¼ŒåŒç±»ç”Ÿäº§è€…å½’ä¸ºä¸€ç»„</td><td>æ— ï¼ˆå¿…é…ï¼‰</td><td>ç”¨äºå®¹é”™å’Œè´Ÿè½½å‡è¡¡ï¼Œä¸å¯ä¸æ¶ˆè´¹è€…ç»„é‡å</td></tr><tr><td>rocketmq.consumer.group</td><td>æ¶ˆè´¹è€…ç»„åç§°ï¼ŒåŒç±»æ¶ˆè´¹è€…å½’ä¸ºä¸€ç»„</td><td>æ— ï¼ˆå¿…é…ï¼‰</td><td>é›†ç¾¤æ¨¡å¼ä¸‹åˆ†æ‘Šæ¶ˆè´¹ï¼Œå¹¿æ’­æ¨¡å¼ä¸‹ä»…ç”¨äºæ ‡è¯†</td></tr><tr><td>rocketmq.consumer.message-model</td><td>æ¶ˆè´¹æ¨¡å¼ï¼ŒCLUSTERINGï¼ˆé›†ç¾¤ï¼‰/BROADCASTINGï¼ˆå¹¿æ’­ï¼‰</td><td>CLUSTERING</td><td>é›†ç¾¤æ¨¡å¼ï¼šä¸€æ¡æ¶ˆæ¯ä»…è¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼›å¹¿æ’­æ¨¡å¼ï¼šç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…éƒ½èƒ½æ”¶åˆ°</td></tr><tr><td>rocketmq.producer.retry-times-when-send-failed</td><td>åŒæ­¥å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°ï¼ˆä¸å«ç¬¬ä¸€æ¬¡å‘é€ï¼‰</td><td>2</td><td>ç½‘ç»œæ³¢åŠ¨ã€Broker ç¹å¿™æ—¶ï¼Œæé«˜æ¶ˆæ¯å‘é€æˆåŠŸç‡</td></tr><tr><td>rocketmq.consumer.consume-message-batch-max-size</td><td>æ¯æ¬¡æ‰¹é‡æ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡</td><td>1</td><td>æ¶ˆæ¯é‡å¤§æ—¶ï¼Œè°ƒå¤§è¯¥å€¼æé«˜æ¶ˆè´¹æ•ˆç‡ï¼ˆä¸å®œè¿‡å¤§ï¼Œé¿å…å†…å­˜æº¢å‡ºï¼‰</td></tr></tbody></table>
<h3 data-id="heading-8">3 å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘é‡ç‚¹ï¼‰</h3>
<p>æ•´åˆè¿‡ç¨‹ä¸­ï¼Œæ–°æ‰‹å®¹æ˜“é‡åˆ°å„ç±»é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼Œç»“åˆå‚è€ƒèµ„æ–™ä¸­çš„å…¼å®¹é—®é¢˜å’Œå®æ“è¸©å‘ç»éªŒæ•´ç†ï¼š</p>
<h4 data-id="heading-9">3.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h4>
<ul>
<li>é—®é¢˜1ï¼šé¡¹ç›®å¯åŠ¨å¤±è´¥ï¼Œæç¤ºâ€œCould not autowire. No beans of 'RocketMQTemplate' type foundâ€ è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ RocketMQ starter ä¾èµ–æ˜¯å¦å¼•å…¥ï¼Œç‰ˆæœ¬æ˜¯å¦ä¸ SpringBoot é€‚é…ï¼ˆSpringBoot 2.7.x å¯¹åº” starter 2.2.3+ï¼‰ï¼›æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­ rocketmq.name-server æ˜¯å¦é…ç½®æ­£ç¡®ã€‚</li>
<li>é—®é¢˜2ï¼šæ¶ˆæ¯å‘é€æˆåŠŸï¼Œä½†æ¶ˆè´¹è€…æ”¶ä¸åˆ°æ¶ˆæ¯ è§£å†³æ–¹æ¡ˆï¼šâ‘  æ£€æŸ¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ topic æ˜¯å¦ä¸€è‡´ï¼›â‘¡ æ£€æŸ¥æ¶ˆè´¹è€…ç»„åç§°æ˜¯å¦ä¸ application.yml ä¸­é…ç½®çš„ä¸€è‡´ï¼›â‘¢ æ£€æŸ¥æ¶ˆè´¹æ¨¡å¼æ˜¯å¦æ­£ç¡®ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹è‹¥å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œæ¶ˆæ¯ä¼šåˆ†æ‘Šæ¶ˆè´¹ï¼Œå¯å…³é—­å…¶ä»–å®ä¾‹é‡è¯•ï¼›â‘£ æ£€æŸ¥ RocketMQ æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ŒNameServer ä¸ Broker è¿æ¥æ˜¯å¦æ­£å¸¸ã€‚</li>
<li>é—®é¢˜3ï¼šå‘é€å¯¹è±¡æ¶ˆæ¯æ—¶ï¼Œæ¶ˆè´¹è€…æ¥æ”¶å¤±è´¥ï¼Œæç¤ºâ€œåºåˆ—åŒ–å¤±è´¥â€ è§£å†³æ–¹æ¡ˆï¼šå®ä½“ç±»å¿…é¡»å®ç° Serializable æ¥å£ï¼›ç¡®ä¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å®ä½“ç±»å…¨è·¯å¾„ä¸€è‡´ï¼ˆåŒ…åã€ç±»åå®Œå…¨ç›¸åŒï¼‰ï¼›é¿å…å®ä½“ç±»ä¸­å­˜åœ¨ä¸å¯åºåˆ—åŒ–çš„å­—æ®µï¼ˆå¦‚ transient ä¿®é¥°çš„å­—æ®µï¼‰ã€‚</li>
<li>é—®é¢˜4ï¼šé¡¹ç›®å¯åŠ¨å¤±è´¥ï¼Œæç¤ºâ€œApplicationContext åˆå§‹åŒ–å¤±è´¥â€ è§£å†³æ–¹æ¡ˆï¼šå¤§æ¦‚ç‡æ˜¯ç‰ˆæœ¬ä¸å…¼å®¹ï¼ŒSpringBoot 2.7.x ä¸å¯ä½¿ç”¨ä½äº 2.2.3 ç‰ˆæœ¬çš„ RocketMQ starterï¼›é¿å…æ··åˆä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ Spring ç›¸å…³ä¾èµ–ã€‚</li>
<li>é—®é¢˜5ï¼šæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œæ— æ³•è§¦å‘é‡è¯• è§£å†³æ–¹æ¡ˆï¼šæ¶ˆè´¹æ–¹æ³•ä¸­è‹¥å‡ºç°å¼‚å¸¸ï¼Œéœ€æ‰‹åŠ¨æŠ›å‡º RuntimeExceptionï¼ˆä¸å¯æ•è·åä¸æŠ›å‡ºï¼‰ï¼ŒSpring ä¼šæ„ŸçŸ¥å¼‚å¸¸å¹¶è§¦å‘é‡è¯•ï¼›æ£€æŸ¥é‡è¯•æ¬¡æ•°é…ç½®ï¼ˆé»˜è®¤16æ¬¡ï¼‰ï¼Œé‡è¯•è¾¾åˆ°ä¸Šé™åæ¶ˆæ¯ä¼šè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</li>
</ul>
<h4 data-id="heading-10">3.2 æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>ç‰ˆæœ¬é€‚é…æ˜¯å…³é”®ï¼šä¸¥æ ¼æŒ‰ç…§æœ¬æ–‡æ¨èçš„ç‰ˆæœ¬ç»„åˆé…ç½®ï¼Œé¿å…å› ç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´å„ç±»å¼‚å¸¸ï¼Œå…·ä½“å¯å‚è€ƒ Apache RocketMQ å®˜æ–¹å…¼å®¹æ€§çŸ©é˜µã€‚</li>
<li>ç»„åç§°è§„èŒƒï¼šç”Ÿäº§è€…ç»„å’Œæ¶ˆè´¹è€…ç»„ä¸å¯é‡åï¼ŒåŒä¸€ä¸šåŠ¡åœºæ™¯çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…å½’ä¸ºåŒä¸€ç»„ï¼Œä¸åŒä¸šåŠ¡åœºæ™¯ä½¿ç”¨ä¸åŒçš„ç»„åç§°ã€‚</li>
<li>ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼šç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€å…³é—­ Broker çš„ autoCreateTopicEnable é…ç½®ï¼Œæå‰æ‰‹åŠ¨åˆ›å»ºä¸»é¢˜å’Œé˜Ÿåˆ—ï¼›æ¶ˆæ¯å‘é€å¤±è´¥éœ€åšé™çº§å¤„ç†ï¼ˆå¦‚å­˜å…¥æ•°æ®åº“ï¼Œåç»­è¡¥å¿å‘é€ï¼‰ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚</li>
<li>æ¶ˆæ¯é‡è¯•ä¸æ­»ä¿¡é˜Ÿåˆ—ï¼šæ¶ˆè´¹å¤±è´¥ä¼šè§¦å‘é‡è¯•ï¼Œé‡è¯•è¾¾åˆ°ä¸Šé™åæ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLQï¼‰ï¼Œéœ€æ‰‹åŠ¨å¤„ç†æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚</li>
<li>é…ç½®æ–‡ä»¶è§„èŒƒï¼šå°½é‡é¿å…ç¡¬ç¼–ç ï¼Œæ¶ˆè´¹è€…ç»„ã€ä¸»é¢˜ç­‰å¯é€šè¿‡é…ç½®æ–‡ä»¶è¯»å–ï¼Œæ–¹ä¾¿åç»­ç¯å¢ƒåˆ‡æ¢ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>æ•´åˆ springboot æ˜¯å¾ˆç®€å•çš„ï¼Œä½¿ç”¨æ–¹æ³•è·Ÿ redis ç±»ä¼¼ï¼Œä¸»è¦æ˜¯éœ€è¦äº†è§£åœ¨ä»€ä¹ˆåœºæ™¯ç”¨ä»€ä¹ˆæ¶ˆæ¯å‘é€æœºåˆ¶ï¼Œä»¥åŠæ¶ˆæ¯å‘é€æœºåˆ¶å¯èƒ½ä¼šå½±å“çš„æ•ˆç‡ã€‚</p>
</blockquote>
<h3 data-id="heading-11">4 æ€»ç»“</h3>
<p>æœ¬æ–‡è¯¦ç»†è®²è§£äº† RocketMQ ä¸ SpringBoot çš„å®Œæ•´æ•´åˆæµç¨‹ï¼Œä»ç¯å¢ƒå‡†å¤‡ã€ä¾èµ–é…ç½®ã€ç”Ÿäº§è€…/æ¶ˆè´¹è€…å®ç°ï¼Œåˆ°æµ‹è¯•éªŒè¯å’Œé¿å‘æŒ‡å—ï¼Œå…¨ç¨‹è´´åˆå¼€å‘å®é™…åœºæ™¯ï¼Œçªå‡ºå®æ“æ€§ã€‚æ ¸å¿ƒäº®ç‚¹æ˜¯åˆ©ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®ç‰¹æ€§ï¼Œé€šè¿‡ RocketMQTemplate å’Œ @RocketMQMessageListener æ³¨è§£ï¼Œæ‘’å¼ƒäº†åŸç”Ÿ API ç¹ççš„å®ä¾‹åˆ›å»ºå’Œé…ç½®ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå®ç°æ¶ˆæ¯çš„å‘é€ä¸æ¥æ”¶ã€‚</p>
<p>æ•´åˆçš„æ ¸å¿ƒè¦ç‚¹çš„æ˜¯â€œç‰ˆæœ¬é€‚é…â€å’Œâ€œé…ç½®è§„èŒƒâ€ï¼Œåªè¦ä¸¥æ ¼éµå¾ªæœ¬æ–‡çš„ç‰ˆæœ¬ç»„åˆå’Œé…ç½®è¦æ±‚ï¼Œå°±èƒ½é¡ºåˆ©å®Œæˆæ•´åˆã€‚åç»­å¯åŸºäºæœ¬æ–‡çš„åŸºç¡€ï¼Œæ‰©å±• RocketMQ çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚äº‹åŠ¡æ¶ˆæ¯ã€å»¶è¿Ÿæ¶ˆæ¯ã€æ¶ˆæ¯è¿‡æ»¤ç­‰ï¼Œé€‚é…æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚åˆ†å¸ƒå¼äº‹åŠ¡ã€å®šæ—¶ä»»åŠ¡é€šçŸ¥ç­‰ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ70ï¼‰å¦‚ä½•åœ¨å¤šæ•°æ®åº“ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7600234310965198886</link>    <guid>https://juejin.cn/post/7600234310965198886</guid>    <pubDate>2026-01-28T11:43:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600234310965198886" data-draft-id="7600245693997137930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ70ï¼‰å¦‚ä½•åœ¨å¤šæ•°æ®åº“ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-28T11:43:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ70ï¼‰å¦‚ä½•åœ¨å¤šæ•°æ®åº“ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T11:43:43.000Z" title="Wed Jan 28 2026 11:43:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¤šæ•°æ®åº“ç¯å¢ƒä¸­ä½¿ç”¨Hibernateï¼Œéœ€è¦é…ç½®å¤šä¸ªæ•°æ®æºï¼ˆDataSourceï¼‰å’Œå¤šä¸ªå®ä½“ç®¡ç†å™¨ï¼ˆEntityManagerï¼‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åœ¨Spring Booté¡¹ç›®ä¸­ä½¿ç”¨Hibernateæ¥è¿æ¥å¤šä¸ªæ•°æ®åº“ã€‚ä¸‹é¢æ˜¯è¯¦ç»†æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­é…ç½®å’Œä½¿ç”¨å¤šä¸ªæ•°æ®åº“ã€‚</p>
<h3 data-id="heading-0">1. é¡¹ç›®ä¾èµ–</h3>
<p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¿…è¦çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot Starter Data JPA --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- HikariCP for Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®å¤šä¸ªæ•°æ®æº</h3>
<p>éœ€è¦åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>æ–‡ä»¶ä¸­é…ç½®å¤šä¸ªæ•°æ®æºã€‚</p>
<h4 data-id="heading-2"><code>application.properties</code></h4>
<pre><code class="hljs language-properties" lang="properties"># Primary DataSource
spring.datasource.primary.url=jdbc:mysql://localhost:3306/primarydb
spring.datasource.primary.username=root
spring.datasource.primary.password=rootpassword
spring.datasource.primary.driver-class-name=com.mysql.cj.jdbc.Driver

# Secondary DataSource
spring.datasource.secondary.url=jdbc:mysql://localhost:3306/secondarydb
spring.datasource.secondary.username=root
spring.datasource.secondary.password=rootpassword
spring.datasource.secondary.driver-class-name=com.mysql.cj.jdbc.Driver

# Hibernate properties
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
</code></pre>
<h3 data-id="heading-3">3. é…ç½®å¤šæ•°æ®æºä¸å®ä½“ç®¡ç†å™¨</h3>
<p>éœ€è¦åˆ›å»ºé…ç½®ç±»æ¥é…ç½®å¤šä¸ªæ•°æ®æºä¸å¯¹åº”çš„å®ä½“ç®¡ç†å™¨ã€‚</p>
<h4 data-id="heading-4"><code>PrimaryDataSourceConfig.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;
<span class="hljs-keyword">import</span> org.springframework.transaction.PlatformTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;

<span class="hljs-keyword">import</span> javax.persistence.EntityManagerFactory;
<span class="hljs-keyword">import</span> javax.sql.DataSource;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-meta">@EnableJpaRepositories(
        basePackages = "com.example.primary",
        entityManagerFactoryRef = "primaryEntityManagerFactory",
        transactionManagerRef = "primaryTransactionManager"
)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrimaryDataSourceConfig</span> {

    <span class="hljs-meta">@Bean(name = "primaryDataSource")</span>
    <span class="hljs-meta">@ConfigurationProperties(prefix = "spring.datasource.primary")</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">primaryDataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> DataSourceBuilder.create().build();
    }

    <span class="hljs-meta">@Bean(name = "primaryEntityManagerFactory")</span>
    <span class="hljs-keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="hljs-title function_">primaryEntityManagerFactory</span><span class="hljs-params">(
            <span class="hljs-meta">@Qualifier("primaryDataSource")</span> DataSource dataSource)</span> {
        <span class="hljs-type">LocalContainerEntityManagerFactoryBean</span> <span class="hljs-variable">em</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalContainerEntityManagerFactoryBean</span>();
        em.setDataSource(dataSource);
        em.setPackagesToScan(<span class="hljs-string">"com.example.primary"</span>);
        em.setJpaVendorAdapter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HibernateJpaVendorAdapter</span>());
        <span class="hljs-keyword">return</span> em;
    }

    <span class="hljs-meta">@Bean(name = "primaryTransactionManager")</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">primaryTransactionManager</span><span class="hljs-params">(
            <span class="hljs-meta">@Qualifier("primaryEntityManagerFactory")</span> EntityManagerFactory entityManagerFactory)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JpaTransactionManager</span>(entityManagerFactory);
    }
}
</code></pre>
<h4 data-id="heading-5"><code>SecondaryDataSourceConfig.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaRepositories;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.JpaTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
<span class="hljs-keyword">import</span> org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;
<span class="hljs-keyword">import</span> org.springframework.transaction.PlatformTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;

<span class="hljs-keyword">import</span> javax.persistence.EntityManagerFactory;
<span class="hljs-keyword">import</span> javax.sql.DataSource;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-meta">@EnableJpaRepositories(
        basePackages = "com.example.secondary",
        entityManagerFactoryRef = "secondaryEntityManagerFactory",
        transactionManagerRef = "secondaryTransactionManager"
)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondaryDataSourceConfig</span> {

    <span class="hljs-meta">@Bean(name = "secondaryDataSource")</span>
    <span class="hljs-meta">@ConfigurationProperties(prefix = "spring.datasource.secondary")</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">secondaryDataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> DataSourceBuilder.create().build();
    }

    <span class="hljs-meta">@Bean(name = "secondaryEntityManagerFactory")</span>
    <span class="hljs-keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="hljs-title function_">secondaryEntityManagerFactory</span><span class="hljs-params">(
            <span class="hljs-meta">@Qualifier("secondaryDataSource")</span> DataSource dataSource)</span> {
        <span class="hljs-type">LocalContainerEntityManagerFactoryBean</span> <span class="hljs-variable">em</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalContainerEntityManagerFactoryBean</span>();
        em.setDataSource(dataSource);
        em.setPackagesToScan(<span class="hljs-string">"com.example.secondary"</span>);
        em.setJpaVendorAdapter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HibernateJpaVendorAdapter</span>());
        <span class="hljs-keyword">return</span> em;
    }

    <span class="hljs-meta">@Bean(name = "secondaryTransactionManager")</span>
    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">secondaryTransactionManager</span><span class="hljs-params">(
            <span class="hljs-meta">@Qualifier("secondaryEntityManagerFactory")</span> EntityManagerFactory entityManagerFactory)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JpaTransactionManager</span>(entityManagerFactory);
    }
}
</code></pre>
<h3 data-id="heading-6">4. å®šä¹‰å®ä½“ç±»å’ŒDAOå±‚</h3>
<p>æ ¹æ®ä¸åŒçš„æ•°æ®æºï¼Œå°†å®ä½“ç±»å’ŒDAOå±‚æ”¾åœ¨ä¸åŒçš„åŒ…ä¸­ã€‚</p>
<h4 data-id="heading-7">ä¸»æ•°æ®æºå®ä½“ç±»å’ŒDAOå±‚</h4>
<h5 data-id="heading-8"><code>com.example.primary.entity.User.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.primary.entity;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> {
        <span class="hljs-built_in">this</span>.password = password;
    }
}
</code></pre>
<h5 data-id="heading-9"><code>com.example.primary.repository.UserRepository.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.primary.repository;

<span class="hljs-keyword">import</span> com.example.primary.entity.User;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;User, Long&gt; {
    User <span class="hljs-title function_">findByUsername</span><span class="hljs-params">(String username)</span>;
}
</code></pre>
<h4 data-id="heading-10">æ¬¡æ•°æ®æºå®ä½“ç±»å’ŒDAOå±‚</h4>
<h5 data-id="heading-11"><code>com.example.secondary.entity.Order.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.secondary.entity;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Table;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String orderNumber;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getOrderNumber</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderNumber;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrderNumber</span><span class="hljs-params">(String orderNumber)</span> {
        <span class="hljs-built_in">this</span>.orderNumber = orderNumber;
    }
}
</code></pre>
<h5 data-id="heading-12"><code>com.example.secondary.repository.OrderRepository.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.secondary.repository;

<span class="hljs-keyword">import</span> com.example.secondary.entity.Order;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;Order, Long&gt; {
    Order <span class="hljs-title function_">findByOrderNumber</span><span class="hljs-params">(String orderNumber)</span>;
}
</code></pre>
<h3 data-id="heading-13">5. åˆ›å»ºæœåŠ¡å±‚</h3>
<h4 data-id="heading-14">ä¸»æ•°æ®æºæœåŠ¡å±‚</h4>
<h5 data-id="heading-15"><code>com.example.primary.service.UserService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.primary.service;

<span class="hljs-keyword">import</span> com.example.primary.entity.User;
<span class="hljs-keyword">import</span> com.example.primary.repository.UserRepository;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserService</span><span class="hljs-params">(UserRepository userRepository)</span> {
        <span class="hljs-built_in">this</span>.userRepository = userRepository;
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">return</span> userRepository.save(user);
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> userRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userRepository.findAll();
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">return</span> userRepository.save(user);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span> {
        userRepository.deleteById(id);
    }
}
</code></pre>
<h4 data-id="heading-16">æ¬¡æ•°æ®æºæœåŠ¡å±‚</h4>
<h5 data-id="heading-17"><code>com.example.secondary.service.OrderService.java</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.secondary.service;

<span class="hljs-keyword">import</span> com.example.secondary.entity.Order;
<span class="hljs-keyword">import</span> com.example.secondary.repository.OrderRepository;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(OrderRepository orderRepository)</span> {
        <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
    }

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">return</span> orderRepository.save(order);
    }

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> orderRepository.findById(id).orElse(<span class="hljs-literal">null</span>);
    }

    <span class="hljs-keyword">public</span> List&lt;Order&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderRepository.findAll();
    }

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-keyword">return</span> orderRepository.save(order);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(Long id)</span> {
        orderRepository.deleteById(id);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ”¥åˆ«å†ç”¨é€’å½’äº†ï¼WeakMap çš„å½±å­ç´¢å¼•â€œè®©æ ‘ä¸å†æ˜¯æ ‘ï¼â€]]></title>    <link>https://juejin.cn/post/7600248718361083946</link>    <guid>https://juejin.cn/post/7600248718361083946</guid>    <pubDate>2026-01-28T15:57:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600248718361083946" data-draft-id="7600223321041862662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥åˆ«å†ç”¨é€’å½’äº†ï¼WeakMap çš„å½±å­ç´¢å¼•â€œè®©æ ‘ä¸å†æ˜¯æ ‘ï¼â€"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2026-01-28T15:57:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="vilan_å¾®æ¾œ"/> <meta itemprop="url" content="https://juejin.cn/user/2225067267199320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥åˆ«å†ç”¨é€’å½’äº†ï¼WeakMap çš„å½±å­ç´¢å¼•â€œè®©æ ‘ä¸å†æ˜¯æ ‘ï¼â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067267199320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    vilan_å¾®æ¾œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-28T15:57:10.000Z" title="Wed Jan 28 2026 15:57:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"ğŸ¦„";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"ğŸ³";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"ğŸ„";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"ğŸ¦¥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"ğŸ¦©";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"ğŸ§";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"â"}.markdown-body blockquote:after{right:10px;bottom:0;content:"â"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"Â· "}.markdown-body strong:after{content:" Â·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¾®æ¾œã€‚ä»Šå¤©æ¥åˆ†äº«ä¸€ä¸ªåŸºäºÂ <strong>WeakMap</strong>Â å®ç°çš„<strong>å¿«é€Ÿå¯¹æ ‘å½¢ç»“æ„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œ</strong>çš„<code>useTree hook</code>å‡½æ•°ï¼Œå®ƒæ˜¯åŸºäº<code>JavaScript</code> çš„ <code>WeakMap</code> ç‰¹æ€§ï¼Œåœ¨ä¸æ”¹åŠ¨åŸå§‹æ•°æ®çš„å‰æä¸‹ï¼Œå®ç°äº†ä¸€å¥— <strong>O(1)</strong> æŸ¥æ‰¾çš„<strong>å½±å­ç´¢å¼•ç»“æ„</strong>ï¼Œè¿™ä¸ª<strong>å½±å­</strong>å…¶å®å°±æ˜¯å¯¹è±¡çš„<strong>å¼•ç”¨åœ°å€</strong>ï¼Œè®©æ ‘å½¢æ•°æ®æ“ä½œåƒæ“ä½œæ•°ç»„ä¸€æ ·ç®€å•ï¼</p>
<h2 data-id="heading-1">äºŒã€ä¸ºä»€ä¹ˆé€‰æ‹© WeakMapï¼Ÿ</h2>
<h3 data-id="heading-2">1. éä¾µå…¥æ€§ (Non-invasive)</h3>
<p>é€šè¿‡ <code>WeakMap</code> åœ¨å†…å­˜ä¸­æ„å»ºäº†ä¸€å¥— <code>Node -&gt; Parent</code> çš„æ˜ å°„ã€‚åŸå§‹æ•°æ®å¯¹è±¡ä¿æŒçº¯å‡€ï¼Œæ²¡æœ‰ä»»ä½•å¤šä½™å±æ€§ï¼Œå®Œç¾æ”¯æŒåºåˆ—åŒ–ã€‚</p>
<h3 data-id="heading-3">2. å†…å­˜å®‰å…¨ (Memory Safety)</h3>
<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€ç‚¹ã€‚<code>WeakMap</code> å¯¹é”®ï¼ˆå¯¹è±¡ï¼‰æ˜¯<strong>å¼±å¼•ç”¨</strong>çš„ã€‚</p>
<ul>
<li>
<p>å¦‚æœä½ åˆ é™¤äº†åŸå§‹æ ‘ä¸­çš„æŸä¸ªèŠ‚ç‚¹ï¼Œä¸”æ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨å®ƒï¼Œåƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰ä¼šè‡ªåŠ¨æ¸…ç†ç´¢å¼•è¡¨ä¸­çš„å¯¹åº”é¡¹ã€‚</p>
</li>
<li>
<p>è¿™ç§ç‰¹æ€§éå¸¸é€‚åˆå¤„ç†å¤§å‹åŠ¨æ€æ ‘ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒæ‰‹åŠ¨ç»´æŠ¤ç´¢å¼•å¸¦æ¥çš„å†…å­˜æ³„æ¼ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">3ã€ä¸åŒå®ç°æ–¹æ¡ˆå¯¹æ¯”</h3>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä¸ºä»€ä¹ˆé€‰æ‹© <strong>WeakMap</strong>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç»¼åˆå¯¹æ¯”æ¥çœ‹çœ‹<strong>æ“ä½œæ ‘å½¢æ•°æ®</strong>ä¸åŒæ–¹æ¡ˆçš„å·®å¼‚ï¼š</p>






















































<table><thead><tr><th align="left"><strong>ç»´åº¦ / æ–¹æ¡ˆ</strong></th><th align="left"><strong>ä¼ ç»Ÿé€’å½’éå†</strong></th><th align="left"><strong>èŠ‚ç‚¹æ³¨å…¥ parent</strong></th><th align="left"><strong>Map ç¼“å­˜æ–¹æ¡ˆ</strong></th><th align="left"><strong>WeakMap ä¼˜åŒ–æ–¹æ¡ˆ (æœ¬é¡¹ç›®)</strong></th></tr></thead><tbody><tr><td align="left"><strong>åˆå§‹åŒ–å¤æ‚åº¦</strong></td><td align="left"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> (åŒå±‚å¾ªç¯)</td><td align="left"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span></td><td align="left"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span></td><td align="left"><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span> (å•æ¬¡é€’å½’)</strong></td></tr><tr><td align="left"><strong>æº¯æºæ—¶é—´å¤æ‚åº¦</strong></td><td align="left"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span></td><td align="left"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></td><td align="left"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(D)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span></span></span></span></span></td><td align="left"><strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(D)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span></span></span></span></span> (Dä¸ºæ·±åº¦ï¼Œæå¿«)</strong></td></tr><tr><td align="left"><strong>æ•°æ®æ±¡æŸ“</strong></td><td align="left">æ— </td><td align="left">é«˜ï¼ˆç›´æ¥ä¿®æ”¹å¯¹è±¡ï¼‰</td><td align="left">æ— </td><td align="left"><strong>æ— ï¼ˆå¤–éƒ¨æ˜ å°„ï¼Œä¿æŒçº¯å‡€ï¼‰</strong></td></tr><tr><td align="left"><strong>å†…å­˜ç®¡ç†</strong></td><td align="left">å·®</td><td align="left">ä¸€èˆ¬</td><td align="left">ä¸€èˆ¬ (å¼ºå¼•ç”¨ï¼Œéœ€æ‰‹åŠ¨æ¸…ç†)</td><td align="left"><strong>ä¼˜ç§€ï¼ˆå¼±å¼•ç”¨è‡ªåŠ¨ GCï¼‰</strong></td></tr><tr><td align="left"><strong>åºåˆ—åŒ–å‹å¥½åº¦</strong></td><td align="left">å‹å¥½</td><td align="left">æå·®ï¼ˆå¾ªç¯å¼•ç”¨ï¼‰</td><td align="left">å‹å¥½</td><td align="left"><strong>å‹å¥½</strong></td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">æå°æ•°æ®é‡</td><td align="left">ä¸­ç­‰æ•°æ®é‡</td><td align="left">ä¸­ç­‰æ•°æ®é‡</td><td align="left"><strong>å¤§è§„æ¨¡æ•°æ®ã€é«˜é¢‘è½¬æ¢</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€æ ¸å¿ƒå®ç°åŸç†</h2>
<h3 data-id="heading-6">1. æ•´ä½“æ¶æ„å›¾</h3>
<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå¤–éƒ¨çš„ <code>WeakMap</code> æ¥å­˜å‚¨<strong>èŠ‚ç‚¹ä¸å…¶çˆ¶çº§çš„å¯¹åº”å…³ç³»</strong>ã€‚è¿™ç§è®¾è®¡æœ€å¤§çš„å¥½å¤„æ˜¯ï¼šâ€œä¸æ”¹å˜åŸå§‹æ ‘ç»“æ„ï¼Œä¸äº§ç”Ÿå¾ªç¯å¼•ç”¨ï¼Œä¸”èƒ½å®ç° O(1) çš„æº¯æºã€‚â€</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[åŸå§‹æ ‘å½¢æ•°æ®] --&gt; B{useTree Hook}
    B -- "1. é€’å½’æ‰«æ" --&gt; C[WeakMap å­˜å‚¨åº“]

    subgraph "WeakMap å­˜å‚¨ç­–ç•¥"
    C -- "Key: æ ¹èŠ‚ç‚¹" --&gt; D["Value: æ•´ä¸ª Tree æ•°ç»„ (æ–¹ä¾¿åˆ é™¤)"]
    C -- "Key: å­èŠ‚ç‚¹" --&gt; E["Value: ç›´æ¥çˆ¶èŠ‚ç‚¹å¯¹è±¡ (å®ç°æº¯æº)"]
    end

    F[ä¸šåŠ¡è¯·æ±‚: æŸ¥æ‰¾/åˆ é™¤] --&gt; C
    C -- "è¿”å›çˆ¶çº§å¼•ç”¨" --&gt; G[å®Œæˆæ“ä½œ]
</code></pre>
<h3 data-id="heading-7">2. æ•°æ®æ˜ å°„å›¾è§£ (æ ¸å¿ƒé€»è¾‘)</h3>
<p>ä¸ºäº†è®©å¤§å®¶æ›´ç›´è§‚åœ°çœ‹åˆ° <code>WeakMap</code> é‡Œåˆ°åº•å­˜äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<p><strong>ç¤ºä¾‹æ•°æ®ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> list = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ˜é‡‘'</span>,
    <span class="hljs-attr">children</span>: [ { <span class="hljs-attr">id</span>: <span class="hljs-number">11</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å‰ç«¯ç»„'</span> } ]
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'ç¤¾åŒº'</span>,
    <span class="hljs-attr">children</span>: []
  }
];
</code></pre>
<p><strong>WeakMap å†…éƒ¨æ˜ å°„å…³ç³»ï¼š</strong></p>





























<table><thead><tr><th align="left">èŠ‚ç‚¹ (Key)</th><th align="left">æ˜ å°„å€¼ (Value)</th><th align="left">Valueç±»å‹</th><th align="left">å­˜å‚¨é€»è¾‘è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>{ id: 11, name: 'å‰ç«¯ç»„' }</code></td><td align="left"><code>{ id: 1, name: 'æ˜é‡‘', children: [{ id: 11, name: 'å‰ç«¯ç»„' }] }</code></td><td align="left"><strong>Object (çˆ¶èŠ‚ç‚¹)</strong></td><td align="left"><strong>éæ ¹èŠ‚ç‚¹</strong>ï¼šæŒ‡å‘å®ƒçš„ç›´æ¥çˆ¶å¯¹è±¡</td></tr><tr><td align="left"><code>{ id: 1, name: 'æ˜é‡‘', children: [{ id: 11, name: 'å‰ç«¯ç»„' }] }</code></td><td align="left"><code>[{ id: 1, name: 'æ˜é‡‘', children: [{ id: 11, name: 'å‰ç«¯ç»„' }] }, { id: 2, name: 'ç¤¾åŒº', children: [] }]</code></td><td align="left"><strong>Array (æ ¹æ•°ç»„)</strong></td><td align="left"><strong>æ ¹èŠ‚ç‚¹</strong>ï¼šæŒ‡å‘å®ƒæ‰€å±çš„æ•´æ£µæ ‘æ•°ç»„</td></tr><tr><td align="left"><code>{ id: 2, name: 'ç¤¾åŒº', children: [] }</code></td><td align="left"><code>[{ id: 1, name: 'æ˜é‡‘', children: [{ id: 11, name: 'å‰ç«¯ç»„' }] }, { id: 2, name: 'ç¤¾åŒº', children: [] }]</code></td><td align="left"><strong>Array (æ ¹æ•°ç»„)</strong></td><td align="left"><strong>æ ¹èŠ‚ç‚¹</strong>ï¼šæŒ‡å‘å®ƒæ‰€å±çš„æ•´æ£µæ ‘æ•°ç»„</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>æ ¸å¿ƒç§˜è¯€</strong>ï¼š
ä»¥ä¸Šè®¾è®¡äº†ä¸€å¥—å·§å¦™çš„åˆ¤æ–­è§„åˆ™ï¼šå¦‚æœèŠ‚ç‚¹æ˜¯<strong>æ ¹èŠ‚ç‚¹</strong>ï¼Œå…¶æ˜ å°„å€¼å°±æ˜¯<strong>æ•°ç»„</strong>ï¼›å¦‚æœèŠ‚ç‚¹æ˜¯<strong>å­èŠ‚ç‚¹</strong>ï¼Œå…¶æ˜ å°„å€¼å°±æ˜¯<strong>çˆ¶å¯¹è±¡</strong>ã€‚
è¿™æ ·åœ¨æ‰§è¡Œ <code>removeChild</code> æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ <code>Array.isArray(parent)</code>ï¼Œå°±èƒ½è‡ªåŠ¨åˆ‡æ¢â€œä»æ•°ç»„ä¸­åˆ é™¤â€<strong>æ ¹èŠ‚ç‚¹</strong>æˆ–â€œä» <code>children</code> å±æ€§ä¸­åˆ é™¤â€<strong>å­èŠ‚ç‚¹</strong>çš„é€»è¾‘ï¼Œæå…¶ä¼˜é›…ï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">å››ã€useTree()å®ç°æ–¹æ³•é€ä¸€æ‹†è§£</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ <code>useTree</code> å†…éƒ¨æ¯ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°åŸç†ã€‚</p>
<h3 data-id="heading-9">1. <code>initTree</code> - åˆå§‹åŒ–ç´¢å¼•</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šé€’å½’éå†æ•´æ£µæ ‘ï¼Œå»ºç«‹ <code>WeakMap</code> æ˜ å°„ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ•°æ®ç´¢å¼•å¯¹è±¡</span>
<span class="hljs-keyword">const</span> _treeWeakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>&lt;<span class="hljs-title class_">TreeNode</span>, <span class="hljs-title class_">TreeNode</span> | <span class="hljs-title class_">TreeNode</span>[]&gt;();

<span class="hljs-keyword">const</span> useTree = (
  <span class="hljs-attr">props</span>: <span class="hljs-title class_">Props</span> = {
    <span class="hljs-comment">// å¤–éƒ¨æ•°æ®å¯¹è±¡å­—æ®µæ˜ å°„</span>
    <span class="hljs-attr">treeNodeProp</span>: {
      <span class="hljs-attr">value</span>: <span class="hljs-string">'value'</span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">'label'</span>,
      <span class="hljs-attr">children</span>: <span class="hljs-string">'children'</span>,
    }
  }
){
    <span class="hljs-comment">// åˆå§‹åŒ–æ ‘ç»“æ„ç´¢å¼•</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">initTree</span>(<span class="hljs-params">list, parent</span>){...}
}
</code></pre>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">// åˆå§‹åŒ–æ ‘ç»“æ„ç´¢å¼•</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">initTree</span>(<span class="hljs-params">list: TreeNode[], parent?: TreeNode</span>) {
    list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      <span class="hljs-comment">// æ ¹èŠ‚ç‚¹çš„çˆ¶çº§ä¸ºå®Œæ•´çš„æ ‘æ•°æ®ï¼Œåœ¨åˆ é™¤æ ¹èŠ‚ç‚¹æ—¶éœ€è¦é€šè¿‡å®Œæ•´çš„æ•°ç»„åˆ é™¤</span>
      _treeWeakMap.<span class="hljs-title function_">set</span>(item, parent || list);
      <span class="hljs-keyword">if</span> (item[treeNodeProp.<span class="hljs-property">children</span>]) {
        <span class="hljs-comment">// åˆ é™¤å­èŠ‚ç‚¹åªéœ€è¦é€šè¿‡å¯¹åº”å­èŠ‚ç‚¹çš„childrenæ•°ç»„åˆ é™¤</span>
        <span class="hljs-title function_">initTree</span>(item[treeNodeProp.<span class="hljs-property">children</span>], item);
      }
    });
  }
</code></pre>
<p><strong>åŸç†</strong>ï¼šåœ¨ç»„ä»¶æŒ‚è½½æˆ–æ•°æ®æ›´æ–°æ—¶è°ƒç”¨ã€‚é€šè¿‡è¿™ç§â€œå·®å¼‚åŒ–æ˜ å°„â€ï¼Œæˆ‘ä»¬è®©æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‹¥æœ‰äº†ä¸€ä¸ªæŒ‡å‘å…¶â€œå½’å±é›†åˆâ€çš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘äº†<strong>çˆ¶çº§çš„å¼•ç”¨åœ°å€</strong>ã€‚</p>
<p>ä»¥ä¸Šæ–‡çš„è¡¨æ ¼åˆ—å‡ºçš„ç¤ºä¾‹æ•°æ®ä¸ºä¾‹ï¼Œè°ƒç”¨<code>initTree</code>æ–¹æ³•åˆå§‹åŒ–åï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å¯¹åº”å…³ç³»ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph Keys [èŠ‚ç‚¹å¯¹è±¡ - Key]
        K11("å‰ç«¯ç»„ (id:11)")
        K1("æ˜é‡‘ (id:1)")
        K2("ç¤¾åŒº (id:2)")
    end

    subgraph Values [æ˜ å°„å€¼ - Value]
        V_Obj1["çˆ¶èŠ‚ç‚¹å¯¹è±¡ (id:1)"]
        V_Arr["æ ¹æ•°æ®æ•°ç»„ [Tree]"]
    end

    K11 -- "æŒ‡å‘ç›´æ¥çˆ¶çº§" --&gt; V_Obj1
    K1 -- "æŒ‡å‘æ‰€å±æ ¹æ•°ç»„" --&gt; V_Arr
    K2 -- "æŒ‡å‘æ‰€å±æ ¹æ•°ç»„" --&gt; V_Arr

    style K11 fill:#f9f,stroke:#333
    style K1 fill:#bbf,stroke:#333
    style K2 fill:#bbf,stroke:#333
    style V_Arr fill:#dfd,stroke:#333
    style V_Obj1 fill:#fff,stroke:#333
</code></pre>
<h3 data-id="heading-10">2. <code>_setParent</code> - èŠ‚ç‚¹ç´¢å¼•è®¾ç½®</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šå»ºç«‹èŠ‚ç‚¹ä¸å…¶æ‰€å±å®¹å™¨ï¼ˆçˆ¶èŠ‚ç‚¹å¯¹è±¡æˆ–æ ¹æ•°ç»„ï¼‰çš„æ˜ å°„å…³ç³»ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">// è®¾ç½®èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜ å°„ã€‚ä¸ºé˜²æ­¢ç”¨æˆ·é”™è¯¯ä½¿ç”¨ï¼Œä¸å‘å¤–æš´éœ²ï¼Œå†…éƒ¨ä½¿ç”¨</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">_setParent</span>(<span class="hljs-params">node: TreeNode, parent: TreeNode | TreeNode[]</span>) {
    _treeWeakMap.<span class="hljs-title function_">set</span>(node, parent);
  }
</code></pre>
<p><strong>åŸç†</strong>ï¼šè¿™æ˜¯å¯¹ <code>WeakMap.set</code> çš„ä¸€å±‚ç®€å•å°è£…ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°†èŠ‚ç‚¹å¯¹è±¡å¼•ç”¨ä½œä¸º <code>Key</code>ï¼Œå…¶çˆ¶çº§å¼•ç”¨ä½œä¸º <code>Value</code> å­˜å…¥ç´¢å¼•åº“ã€‚é€šè¿‡<code>_</code>å‰ç¼€æ ‡è®°ä¸º<strong>ç§æœ‰</strong>æ˜¯ä¸ºäº†é˜²æ­¢å¤–éƒ¨ç›´æ¥ç¯¡æ”¹æ˜ å°„å…³ç³»ï¼Œä¿è¯ç´¢å¼•çš„å•ä¸€å¯é æ€§ã€‚</p>
<h3 data-id="heading-11">3. <code>getParent</code> - è·å–çˆ¶èŠ‚ç‚¹</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šè·å–æŒ‡å®šèŠ‚ç‚¹çš„ç›´æ¥çˆ¶èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">// è·å–èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParent</span>(<span class="hljs-params">node: TreeNode</span>) {
    <span class="hljs-keyword">return</span> _treeWeakMap.<span class="hljs-title function_">get</span>(node);
  }
</code></pre>
<ul>
<li><strong>åŸç†</strong>ï¼šåˆ©ç”¨ <code>WeakMap.get</code> ç›´æ¥è·å–ã€‚æ—¶é—´å¤æ‚åº¦ä¸º <strong>O(1)</strong>ã€‚</li>
</ul>
<h3 data-id="heading-12">4. <code>getParents</code> - è·å–å…¨è·¯å¾„çˆ¶èŠ‚ç‚¹</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šé€’å½’å‘ä¸Šæ£€ç´¢çˆ¶çº§ï¼Œè·å–ä»å½“å‰èŠ‚ç‚¹åˆ°æ ¹éƒ¨çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹æ•°ç»„ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">// è·å–èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParents</span>(<span class="hljs-params">item: TreeNode, parentList: (TreeNode | <span class="hljs-built_in">string</span>)[] = [], key?: <span class="hljs-built_in">string</span></span>): (<span class="hljs-title class_">TreeNode</span> | <span class="hljs-built_in">string</span>)[] {
    <span class="hljs-keyword">const</span> parent = _treeWeakMap.<span class="hljs-title function_">get</span>(item);
    <span class="hljs-comment">// é€’å½’åˆ°æ ¹èŠ‚ç‚¹æ•°ç»„æ—¶åœæ­¢</span>
    <span class="hljs-keyword">if</span> (parent &amp;&amp; !<span class="hljs-title function_">_isRootNode</span>(parent)) {
      parentList.<span class="hljs-title function_">push</span>(key ? parent[key] : parent);
      <span class="hljs-title function_">getParents</span>(parent, parentList, key);
    }
    <span class="hljs-keyword">return</span> parentList;
  }
  
  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ ¹èŠ‚ç‚¹ï¼Œä¸‹æ–‡éƒ½ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­æ˜¯å¦æ ¹èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">_isRootNode</span>(<span class="hljs-params">node: TreeNode | TreeNode[]</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(node);
  }
</code></pre>
<p><strong>åŸç†</strong>ï¼šé€šè¿‡èŠ‚ç‚¹è‡ªèº«çš„å¼•ç”¨åœ°å€åœ¨<code>WeakMap</code>ä¸­æŸ¥æ‰¾çˆ¶çº§ã€‚ç›¸æ¯”äº<code>DFS</code>(æ·±åº¦ä¼˜å…ˆéå†)å…¨æ ‘ï¼Œè¿™ç§<strong>å‚ç›´çˆ¬å‡</strong>çš„æ–¹å¼æ•ˆç‡æé«˜ã€‚
ä»€ä¹ˆæ˜¯<strong>å‚ç›´çˆ¬å‡</strong>ï¼Ÿ</p>
<p><strong>ç±»ä¼¼äºï¼š</strong></p>
<blockquote>
<p><code>show code is me.parent.parent.  ......</code></p>
</blockquote>
<p>å°±è¿™æ ·ï¼Œè¿ç¥–å®—åå…«ä»£éƒ½èƒ½ç»™ä½ æ‰’å‡ºæ¥ï¼</p>
<h3 data-id="heading-13">5. <code>addChild</code> - åŠ¨æ€æ·»åŠ èŠ‚ç‚¹</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šå‘æŒ‡å®šèŠ‚ç‚¹æ·»åŠ å­èŠ‚ç‚¹ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°ç´¢å¼•ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">// æ·»åŠ å­èŠ‚ç‚¹æˆ–æ ¹èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸å­˜åœ¨.childrenæ—¶ï¼Œä»£è¡¨æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹æ•°ç»„</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">addChild</span>(<span class="hljs-params">node: TreeNode, child: TreeNode</span>) {
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">_isRootNode</span>(node)) {
      <span class="hljs-comment">// æ ¹èŠ‚ç‚¹æ•°ç»„ç›´æ¥æ·»åŠ </span>
      <span class="hljs-keyword">const</span> i = node.<span class="hljs-title function_">push</span>(child) - <span class="hljs-number">1</span>;
      <span class="hljs-comment">/**
       * ä¸ºæ–°å¢åŠ çš„å­èŠ‚ç‚¹æ„å»ºä¸€ä¸ªWeakMapç´¢å¼•ï¼ŒæŒ‡å‘çˆ¶èŠ‚ç‚¹
       * æ³¨æ„ï¼šæ³¨å†Œä¸ºkeyçš„å¼•ç”¨åœ°å€æ˜¯ç»è¿‡proxyå¤„ç†åçš„èŠ‚ç‚¹
       */</span>
      node[i] &amp;&amp; <span class="hljs-title function_">_setParent</span>(node[i], node);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// éæ ¹èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°childrenæ•°ç»„</span>
      <span class="hljs-keyword">if</span> (!node[treeNodeProp.<span class="hljs-property">children</span>]) {
        node[treeNodeProp.<span class="hljs-property">children</span>] = [];
      }
      <span class="hljs-keyword">const</span> i = node[treeNodeProp.<span class="hljs-property">children</span>].<span class="hljs-title function_">push</span>(child) - <span class="hljs-number">1</span>;
      <span class="hljs-comment">// å’Œä¸Šé¢è®¾ç½®æ ¹èŠ‚ç‚¹åŒç†</span>
      node.<span class="hljs-property">children</span>[i] &amp;&amp; <span class="hljs-title function_">_setParent</span>(node.<span class="hljs-property">children</span>[i], node);
    }
  }
</code></pre>
<p><strong>åŸç†</strong>ï¼šåœ¨æ“ä½œåŸå§‹æ•°æ®çš„åŒæ—¶ï¼ŒåŒæ­¥æ›´æ–° <code>WeakMap</code>ç´¢å¼•ã€‚ä¹Ÿå°±æ˜¯ä¸ºæ–°å¢çš„å¯¹è±¡å»ºç«‹çˆ¶çº§ç´¢å¼•ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œä¸èƒ½æŠŠæ–°æ·»åŠ çš„<code>child</code>å¯¹è±¡å½“åš<code>WeakMap</code>çš„<code>Key</code>ï¼Œå› ä¸º<code>child</code>åªæ˜¯ä¸€ä¸ªå¤–éƒ¨ä¼ å…¥çš„ä¸€ä¸ª<strong>ä¸´æ—¶å˜é‡</strong>ï¼Œè¿˜æ²¡æœ‰å’Œæ•´æ£µæ ‘å»ºç«‹è”ç³»ï¼Œéœ€è¦åœ¨æ·»åŠ åˆ°æ ‘å½“ä¸­åï¼Œè·å–<strong>æ ‘å½“ä¸­çš„å¯¹è±¡åœ°å€</strong>ä½œä¸º<code>Key</code>å»ºç«‹ç´¢å¼•ã€‚</p>
<h3 data-id="heading-14">6. <code>removeChild</code> - åˆ é™¤æŒ‡å®šèŠ‚ç‚¹</h3>
<p><strong>åŠŸèƒ½</strong>ï¼šæ— ç—›åˆ é™¤ä»»æ„èŠ‚ç‚¹ï¼Œæ— éœ€æ‰‹åŠ¨éå†æŸ¥æ‰¾ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">// åˆ é™¤æŒ‡å®šå­èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">removeChild</span>(<span class="hljs-params">node: TreeNode</span>) {
    <span class="hljs-comment">// æ‰¾åˆ°çˆ¶èŠ‚ç‚¹ï¼Œé€šè¿‡çˆ¶èŠ‚ç‚¹åˆ é™¤</span>
    <span class="hljs-keyword">const</span> parent = <span class="hljs-title function_">getParent</span>(node);
    <span class="hljs-keyword">if</span>(!parent) {
      <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°çˆ¶çº§èŠ‚ç‚¹ï¼ŒæŠ›å‡ºé”™è¯¯</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ²¡æœ‰æ‰¾åˆ°çˆ¶çº§èŠ‚ç‚¹ï¼'</span>);
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">_isRootNode</span>(parent)) {
      <span class="hljs-comment">// åˆ é™¤æ ¹èŠ‚ç‚¹</span>
      <span class="hljs-keyword">const</span> index = parent.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item: TreeNode</span>) =&gt;</span> item === node);
      <span class="hljs-keyword">if</span>(index &gt;= <span class="hljs-number">0</span>) {
        parent.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°è¦åˆ é™¤çš„æ ¹èŠ‚ç‚¹ï¼ŒæŠ›å‡ºé”™è¯¯</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ²¡æœ‰æ‰¾åˆ°è¦åˆ é™¤çš„æ ¹èŠ‚ç‚¹ï¼'</span>);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// é€šè¿‡æ‰¾åˆ°çˆ¶çº§åˆ é™¤è‡ªå·±</span>
      parent.<span class="hljs-property">children</span> = parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item: TreeNode</span>) =&gt;</span> item !== node);
    }
  }
</code></pre>
<p><strong>åŸç†</strong>ï¼šè¿™æ˜¯è¯¥æ–¹æ¡ˆæœ€ç²¾å¦™çš„åœ°æ–¹ï¼é€šè¿‡ <code>initTree</code> å»ºç«‹çš„å·®å¼‚åŒ–æ˜ å°„ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„ <code>Array.isArray</code> åˆ¤æ–­ï¼Œå°±èƒ½å‡†ç¡®æ‰¾åˆ°èŠ‚ç‚¹æ‰€åœ¨çš„â€œå®¹å™¨â€ï¼Œå®ç°ç§’åˆ ã€‚</p>
<hr/>
<h2 data-id="heading-15">äº”ã€å®Œæ•´ä»£ç å®ç°</h2>
<p>ä»£ç ä¸å¤šï¼Œå´èƒ½<strong>å¿«é€Ÿ~</strong>å®ç°å¯¹æ ‘å½¢æ•°æ®çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTree.ts</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = {
  <span class="hljs-comment">// æ ‘å½¢æ•°æ®å­—æ®µåæ˜ å°„ç±»å‹</span>
  <span class="hljs-attr">treeNodeProp</span>: <span class="hljs-title class_">TreeNodeProp</span>
}

<span class="hljs-comment">// æ ‘èŠ‚ç‚¹å±æ€§æ˜ å°„ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TreeNodeProp</span> = {
  <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">children</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// æ•°èŠ‚ç‚¹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TreeNode</span> = <span class="hljs-built_in">any</span>

<span class="hljs-comment">/**
 * æ ‘ç»“æ„ç´¢å¼•æ•°æ®
 * keyä¸ºèŠ‚ç‚¹æœ¬èº«ï¼Œvalueä¸ºçˆ¶èŠ‚ç‚¹æˆ–æ ¹èŠ‚ç‚¹æ•°ç»„(å³æ•´æ£µæ ‘)
 * å¦‚æœvalueä¸ºArrayï¼Œä»£è¡¨æ ¹èŠ‚ç‚¹æ•°ç»„
 * å¦‚æœvalueä¸ºObjectï¼Œä»£è¡¨å­èŠ‚ç‚¹
 */</span>
<span class="hljs-keyword">const</span> _treeWeakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>&lt;<span class="hljs-title class_">TreeNode</span>, <span class="hljs-title class_">TreeNode</span> | <span class="hljs-title class_">TreeNode</span>[]&gt;();

<span class="hljs-comment">// ä½¿ç”¨weakmapæ„å»ºæ ‘å½¢æ•°æ®æ•°æ®ç´¢å¼•</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useTree</span> = (<span class="hljs-params">
  props: Props = {
    // å¤–éƒ¨æ•°æ®å¯¹è±¡å­—æ®µæ˜ å°„
    treeNodeProp: {
      value: <span class="hljs-string">'value'</span>,
      label: <span class="hljs-string">'label'</span>,
      children: <span class="hljs-string">'children'</span>,
    }
  }
</span>) =&gt; {
  <span class="hljs-keyword">const</span> { treeNodeProp } = props;

  <span class="hljs-comment">// è®¾ç½®èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜ å°„ã€‚ä¸ºé˜²æ­¢ç”¨æˆ·é”™è¯¯ä½¿ç”¨ï¼Œä¸å‘å¤–æš´éœ²ï¼Œå†…éƒ¨ä½¿ç”¨</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">_setParent</span>(<span class="hljs-params">node: TreeNode, parent: TreeNode | TreeNode[]</span>) {
    _treeWeakMap.<span class="hljs-title function_">set</span>(node, parent);
  }

  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ ¹èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">_isRootNode</span>(<span class="hljs-params">node: TreeNode | TreeNode[]</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(node);
  }

  <span class="hljs-comment">// åˆå§‹åŒ–æ ‘ç»“æ„ç´¢å¼•</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">initTree</span>(<span class="hljs-params">list: TreeNode[], parent?: TreeNode</span>) {
    list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      <span class="hljs-comment">// æ ¹èŠ‚ç‚¹çš„çˆ¶çº§ä¸ºå®Œæ•´çš„æ ‘æ•°æ®ï¼Œåœ¨åˆ é™¤æ ¹èŠ‚ç‚¹æ—¶éœ€è¦é€šè¿‡å®Œæ•´çš„æ•°ç»„åˆ é™¤</span>
      _treeWeakMap.<span class="hljs-title function_">set</span>(item, parent || list);
      <span class="hljs-keyword">if</span> (item[treeNodeProp.<span class="hljs-property">children</span>]) {
        <span class="hljs-comment">// åˆ é™¤å­èŠ‚ç‚¹åªéœ€è¦é€šè¿‡å¯¹åº”å­èŠ‚ç‚¹çš„childrenæ•°ç»„åˆ é™¤</span>
        <span class="hljs-title function_">initTree</span>(item[treeNodeProp.<span class="hljs-property">children</span>], item);
      }
    });
  }

  <span class="hljs-comment">// æ·»åŠ å­èŠ‚ç‚¹æˆ–æ ¹èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸å­˜åœ¨.childrenæ—¶ï¼Œä»£è¡¨æ·»åŠ åˆ°æ ¹èŠ‚ç‚¹æ•°ç»„</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">addChild</span>(<span class="hljs-params">node: TreeNode, child: TreeNode</span>) {
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">_isRootNode</span>(node)) {
      <span class="hljs-comment">// æ ¹èŠ‚ç‚¹æ•°ç»„ç›´æ¥æ·»åŠ </span>
      <span class="hljs-keyword">const</span> i = node.<span class="hljs-title function_">push</span>(child) - <span class="hljs-number">1</span>;
      <span class="hljs-comment">/**
       * ä¸ºæ–°å¢åŠ çš„å­èŠ‚ç‚¹æ„å»ºä¸€ä¸ªWeakMapç´¢å¼•ï¼ŒæŒ‡å‘çˆ¶èŠ‚ç‚¹
       * æ³¨æ„ï¼šæ³¨å†Œä¸ºkeyçš„å¼•ç”¨åœ°å€æ˜¯ç»è¿‡proxyå¤„ç†åçš„èŠ‚ç‚¹
       */</span>
      node[i] &amp;&amp; <span class="hljs-title function_">_setParent</span>(node[i], node);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// éæ ¹èŠ‚ç‚¹ï¼Œæ·»åŠ åˆ°childrenæ•°ç»„</span>
      <span class="hljs-keyword">if</span> (!node[treeNodeProp.<span class="hljs-property">children</span>]) {
        node[treeNodeProp.<span class="hljs-property">children</span>] = [];
      }
      <span class="hljs-keyword">const</span> i = node[treeNodeProp.<span class="hljs-property">children</span>].<span class="hljs-title function_">push</span>(child) - <span class="hljs-number">1</span>;
      <span class="hljs-comment">// å’Œä¸Šé¢è®¾ç½®æ ¹èŠ‚ç‚¹åŒç†</span>
      node.<span class="hljs-property">children</span>[i] &amp;&amp; <span class="hljs-title function_">_setParent</span>(node.<span class="hljs-property">children</span>[i], node);
    }
  }

  <span class="hljs-comment">// åˆ é™¤æŒ‡å®šå­èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">removeChild</span>(<span class="hljs-params">node: TreeNode</span>) {
    <span class="hljs-comment">// æ‰¾åˆ°çˆ¶èŠ‚ç‚¹ï¼Œé€šè¿‡çˆ¶èŠ‚ç‚¹åˆ é™¤</span>
    <span class="hljs-keyword">const</span> parent = <span class="hljs-title function_">getParent</span>(node);
    <span class="hljs-keyword">if</span>(!parent) {
      <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°çˆ¶çº§èŠ‚ç‚¹ï¼ŒæŠ›å‡ºé”™è¯¯</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ²¡æœ‰æ‰¾åˆ°çˆ¶çº§èŠ‚ç‚¹ï¼'</span>);
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">_isRootNode</span>(parent)) {
      <span class="hljs-comment">// åˆ é™¤æ ¹èŠ‚ç‚¹</span>
      <span class="hljs-keyword">const</span> index = parent.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item: TreeNode</span>) =&gt;</span> item === node);
      <span class="hljs-keyword">if</span>(index &gt;= <span class="hljs-number">0</span>) {
        parent.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°è¦åˆ é™¤çš„æ ¹èŠ‚ç‚¹ï¼ŒæŠ›å‡ºé”™è¯¯</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æ²¡æœ‰æ‰¾åˆ°è¦åˆ é™¤çš„æ ¹èŠ‚ç‚¹ï¼'</span>);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// é€šè¿‡æ‰¾åˆ°çˆ¶çº§åˆ é™¤è‡ªå·±</span>
      parent.<span class="hljs-property">children</span> = parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item: TreeNode</span>) =&gt;</span> item !== node);
    }
  }

  <span class="hljs-comment">// è·å–èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParent</span>(<span class="hljs-params">node: TreeNode</span>) {
    <span class="hljs-keyword">return</span> _treeWeakMap.<span class="hljs-title function_">get</span>(node);
  }

  <span class="hljs-comment">// è·å–èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParents</span>(<span class="hljs-params">item: TreeNode, parentList: (TreeNode | <span class="hljs-built_in">string</span>)[] = [], key?: <span class="hljs-built_in">string</span></span>): (<span class="hljs-title class_">TreeNode</span> | <span class="hljs-built_in">string</span>)[] {
    <span class="hljs-keyword">const</span> parent = _treeWeakMap.<span class="hljs-title function_">get</span>(item);
    <span class="hljs-comment">// é€’å½’åˆ°æ ¹èŠ‚ç‚¹æ•°ç»„æ—¶åœæ­¢</span>
    <span class="hljs-keyword">if</span> (parent &amp;&amp; !<span class="hljs-title function_">_isRootNode</span>(parent)) {
      parentList.<span class="hljs-title function_">push</span>(key ? parent[key] : parent);
      <span class="hljs-title function_">getParents</span>(parent, parentList, key);
    }
    <span class="hljs-keyword">return</span> parentList;
  }

  <span class="hljs-comment">// è·å–èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹labelæ•°ç»„</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParentLabels</span>(<span class="hljs-params">item: TreeNode, labelList: <span class="hljs-built_in">string</span>[] = []</span>): <span class="hljs-built_in">string</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">getParents</span>(item, labelList, treeNodeProp.<span class="hljs-property">label</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[];
  }

  <span class="hljs-comment">// è·å–èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹valueæ•°ç»„</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getParentValues</span>(<span class="hljs-params">item: TreeNode, valueList: <span class="hljs-built_in">string</span>[] = []</span>): <span class="hljs-built_in">string</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">getParents</span>(item, valueList, treeNodeProp.<span class="hljs-property">value</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>[];
  }

  <span class="hljs-keyword">return</span> {
    getParents,
    getParentLabels,
    getParentValues,
    getParent,
    initTree,
    addChild,
    removeChild,
  };
};

</code></pre>
<h2 data-id="heading-16">å…­ã€æ€»ç»“</h2>
<p>é€šè¿‡ <code>WeakMap</code> å®ç°çš„ <code>useTree</code>ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äº<strong>è§£è€¦</strong>ã€‚å®ƒå°†â€œä¸šåŠ¡æ•°æ®â€ä¸â€œå±‚çº§å…³ç³»â€åˆ†ç¦»å¼€æ¥ï¼Œæ—¢ä¿è¯äº†æ•°æ®çš„çº¯å‡€ï¼Œåˆè·å¾—äº†æé«˜çš„æŸ¥æ‰¾æ€§èƒ½ã€‚</p>
<p><code>WeakMap</code> ä½œä¸ºä¸€ä¸ª<strong>å®¹æ˜“è¢«å¿½è§†</strong>çš„åŸç”Ÿç‰¹æ€§ï¼Œåœ¨å¤„ç†è¿™ç±»å…³è”<strong>å…³ç³»æ˜ å°„</strong>æ—¶æœ‰ç€å¤©ç„¶çš„ä¼˜åŠ¿ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿåœ¨ä¸º<strong>å¤æ‚æ ‘ç»“æ„</strong>çš„ç®¡ç†å‘æ„ï¼Œä¸å¦¨å°è¯•ä¸‹è¿™ç§â€œ<strong>å½±å­ç´¢å¼•</strong>â€çš„æ€è·¯ã€‚</p>
<p>å¦‚æœ‰ä¸è¶³æˆ–å¯ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºï¼Œå¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œç‚¹ä¸ªğŸ‘ä¹ŸæŒºå¥½çš„ï¼ğŸ‘</p>
<p><strong>å¦‚æœä½ åœ¨å¤„ç†å¤§å‹æ ‘å½¢è¡¨æ ¼æˆ–å¤æ‚çš„ç»„ç»‡æ¶æ„ï¼Œè¿™ä¸ª Hook ç»å¯¹æ˜¯ä½ çš„ææ•ˆç¥å™¨ï¼</strong></p>
<h2 data-id="heading-17">ä¸ƒã€é¢„è§ˆå’Œæºç åœ°å€</h2>
<h4 data-id="heading-18">å¤šåœºæ™¯æ¼”ç¤º (Demo)</h4>
<ul>
<li>
<p><strong>é¡¹ç›®é¢„è§ˆæ€»å…¥å£</strong>:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fjava6688.github.io%2FTree_By_WeakMap%2F" target="_blank" title="https://java6688.github.io/Tree_By_WeakMap/" ref="nofollow noopener noreferrer">java6688.github.io/Tree_By_Weaâ€¦</a></p>
</li>
<li>
<p><strong>åŸç”Ÿ HTML ç‰ˆæœ¬</strong>:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fjava6688.github.io%2FTree_By_WeakMap%2Fhtml%2Findex.html" target="_blank" title="https://java6688.github.io/Tree_By_WeakMap/html/index.html" ref="nofollow noopener noreferrer">java6688.github.io/Tree_By_Weaâ€¦</a></p>
</li>
<li>
<p><strong>Vue 3 + Element+ ç‰ˆæœ¬</strong>:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fjava6688.github.io%2FTree_By_WeakMap%2Fvue%2Findex.html" target="_blank" title="https://java6688.github.io/Tree_By_WeakMap/vue/index.html" ref="nofollow noopener noreferrer">java6688.github.io/Tree_By_Weaâ€¦</a></p>
</li>
<li>
<p><strong>React + AntD ç‰ˆæœ¬</strong>:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fjava6688.github.io%2FTree_By_WeakMap%2Freact%2Findex.html" target="_blank" title="https://java6688.github.io/Tree_By_WeakMap/react/index.html" ref="nofollow noopener noreferrer">java6688.github.io/Tree_By_Weaâ€¦</a></p>
</li>
</ul>
<h4 data-id="heading-19">é¡¹ç›®æºç åœ°å€</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjava6688%2FTree_By_WeakMap" target="_blank" title="https://github.com/java6688/Tree_By_WeakMap" ref="nofollow noopener noreferrer">githubï¼šhttps://github.com/java6688/Tree_By_WeakMap</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€é…ç½®åŒ– CRUD 01ã€‘æœç´¢é‡ç½®ç»„ä»¶ï¼šå°è£…ä¸å¤ç”¨]]></title>    <link>https://juejin.cn/post/7600560664407900223</link>    <guid>https://juejin.cn/post/7600560664407900223</guid>    <pubDate>2026-01-29T10:03:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600560664407900223" data-draft-id="7600581247020007433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€é…ç½®åŒ– CRUD 01ã€‘æœç´¢é‡ç½®ç»„ä»¶ï¼šå°è£…ä¸å¤ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-29T10:03:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¯å’–å•¡"/> <meta itemprop="url" content="https://juejin.cn/user/2553545740787959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€é…ç½®åŒ– CRUD 01ã€‘æœç´¢é‡ç½®ç»„ä»¶ï¼šå°è£…ä¸å¤ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2553545740787959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¯å’–å•¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:03:06.000Z" title="Thu Jan 29 2026 10:03:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    30
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ï¼šå‰è¨€</h2>
<p>åœ¨åå°ç®¡ç†ç³»ç»Ÿçš„é…ç½®åŒ– CRUD å¼€å‘ä¸­ï¼Œæœç´¢+é‡ç½®æ˜¯é«˜é¢‘ç»„åˆåœºæ™¯ï¼Œå‡ ä¹æ‰€æœ‰åˆ—è¡¨é¡µéƒ½éœ€è¦é€šè¿‡æœç´¢ç­›é€‰æ•°æ®ã€é€šè¿‡é‡ç½®æ¢å¤åˆå§‹æŸ¥è¯¢çŠ¶æ€ç­‰ç­‰...ã€‚åŸºäºæ­¤ï¼Œæœ¬æ–‡å°†è¯¦ç»†è®²è§£ã€Œæœç´¢é‡ç½®ç»„ä»¶ã€çš„å°è£…æ€è·¯åŠä½¿ç”¨æ–¹æ³•ï¼Œè¯¥ç»„ä»¶åŸºäºVue3 +  Element Plus å¼€å‘ï¼Œæ”¯æŒ<strong>é…ç½®åŒ–æ‰©å±•ã€å“åº”å¼è”åŠ¨</strong>ï¼Œå¯ç›´æ¥é›†æˆåˆ°<strong>é…ç½®åŒ– CRUD ä½“ç³»</strong>ä¸­ï¼Œæå‡å¼€å‘æ•ˆç‡ä¸ä»£ç ä¸€è‡´æ€§ã€‚</p>
<h2 data-id="heading-1">äºŒï¼šè§£å†³é—®é¢˜</h2>
<p>å°è£…æœç´¢é‡ç½®ç»„ä»¶ä¸»è¦ä¸ºäº†è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<p>1.ä»£ç å†—ä½™ ï¼š æ¯ä¸ªåˆ—è¡¨é¡µéƒ½è¦é‡å¤ç¼–å†™è¡¨å•ç»“æ„ã€æœç´¢æŒ‰é’®ã€é‡ç½®æŒ‰é’®ï¼Œä»¥åŠå¯¹åº”çš„ç‚¹å‡»äº‹ä»¶ã€æ•°æ®æ ¡éªŒé€»è¾‘ï¼›</p>
<p>2.é£æ ¼ä¸ç»Ÿä¸€ï¼šä¸åŒå¼€å‘äººå‘˜ç¼–å†™çš„æœç´¢è¡¨å•ï¼Œåœ¨å¸ƒå±€ã€æŒ‰é’®å°ºå¯¸ã€æ ‡ç­¾å®½åº¦ã€é—´è·ç­‰ç»†èŠ‚ä¸Šå¯èƒ½å­˜åœ¨å·®å¼‚ï¼›</p>
<p>3.ç»´æŠ¤æˆæœ¬é«˜ï¼šå½“éœ€è¦ä¿®æ”¹æœç´¢è¡¨å•çš„å¸ƒå±€ã€æŒ‰é’®æ ·å¼ï¼Œéœ€è¦é€ä¸ªé¡µé¢æ’æŸ¥ä¿®æ”¹ï¼›</p>
<p>...</p>
<h2 data-id="heading-2">ä¸‰ï¼šå…·ä½“å®ç°</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯»ä¸€ä¸‹æœ¬ä¸“æ çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œ<strong>åŠ¨æ€è¡¨å•</strong>çš„å®ç°æ˜¯æœç´¢é‡ç½®ç»„ä»¶çš„åŸºç¡€ï¼š</p>
<p><a href="https://juejin.cn/post/7579460553614819379" target="_blank" title="https://juejin.cn/post/7579460553614819379">juejin.cn/post/757946â€¦</a> ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdf2470950bb4ea5b1edfcaf071b3d24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5p2v5ZKW5ZWh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288618&amp;x-signature=KKU2NR9ZuAAOeEbo2dcs6BBylac%3D" alt="image.png" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ä¸€ä¸ªé€šç”¨çš„æœç´¢é‡ç½®ç»„ä»¶å…·å¤‡çš„<strong>åŸºæœ¬åŠŸèƒ½</strong>ï¼š</p>
<p>1.æœç´¢é¡¹çš„å±•ç¤º</p>
<p>2.æœç´¢é¡¹é»˜è®¤å±•ç¤ºæœç´¢åˆå§‹å€¼</p>
<p>3.æœç´ ä¸é‡ç½®æŒ‰é’®åŠŸèƒ½</p>
<p>...</p>
<p><strong>æ‰©å±•åŠŸèƒ½ï¼š</strong></p>
<p>1.æœç´¢è¡¨å•é¡¹çš„è”åŠ¨</p>
<p>2.æœç´¢è¡¨å•é¡¹çš„æ ¡éªŒ</p>
<p>...</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥å®ç°ï¼š</p>
<h3 data-id="heading-3">3.1 åŸºç¡€åŠŸèƒ½å®ç°</h3>
<p>å…ˆå®Œæˆæœ€ç®€å•çš„éƒ¨åˆ† ï¼š å±•ç¤ºæœç´¢é¡¹å’Œæœç´¢é‡ç½®æŒ‰é’®ã€ä»¥åŠåŸºæœ¬æ ·å¼ç»Ÿä¸€å¤„ç†</p>
<p>ç»„ä»¶åŸºç¡€å®ç°ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">
type SearchPrams = {
  schema?: FormOptions[] // é…ç½®è¡¨
  search?: () =&gt; void  // æœç´¢å›è°ƒ
  reset?: () =&gt; void   // é‡ç½®å›è°ƒ
  labelWidth?: string,
  flex?: number
}
const props = withDefaults(defineProps&lt;SearchPrams&gt;(), {
  schema: {},
  labelWidth:'140px',
  flex:5
})

const codeFormRef = ref(null)

//æœç´¢
const search = async () =&gt; {
  const data = await codeFormRef?.value?.getData()
  emits('search', data)
}

//é‡ç½®
const reset = () =&gt; {
  codeFormRef?.value?.resetFields('')
  emits('reset', {})
}

 &lt;div class="sea-box"&gt;
    &lt;CodeForm
      class="form-box"
      :style="{ flex: props?.flex || 5 }"
      layoutType="cell"
      ref="codeFormRef"
      :schema="schema"
      :labelWidth="props.labelWidth"
    &gt;
    &lt;/CodeForm&gt;
    &lt;div class="sea-btn-box"&gt;
      &lt;div&gt;
        &lt;ElButton
          type="primary"
          :style="{ width: '80px' }"
          @click="search"
          &gt;{{ $t('Search') }}&lt;/ElButton
        &gt;
        &lt;ElButton
          :style="{ width: '80px', marginLeft: '15px' }"
          @click="reset"
          &gt;{{ $t('Reset') }}&lt;/ElButton
        &gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  
 &lt;style scoped&gt;
    .sea-btn-box {
      flex: 1;
      display: flex;
      justify-content: flex-end;
    }
    .form-box {
      flex: 5;
    }
    .sea-box {
      display: flex;
      padding: 20px;
      padding-bottom: 0;
      padding-top: 0;
    }
&lt;/style&gt;

</code></pre>
<p>å¤–éƒ¨å®šä¹‰é…ç½®è¡¨ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml">  <span class="hljs-string">const</span> <span class="hljs-string">searchColumn</span> <span class="hljs-string">=</span> [
      {
        <span class="hljs-attr">label:</span> <span class="hljs-string">'å§“å'</span>,
        <span class="hljs-attr">prop:</span> <span class="hljs-string">'name'</span>,
        <span class="hljs-attr">component:</span> <span class="hljs-string">'Input'</span>,
      },
      {
        <span class="hljs-attr">label:</span> <span class="hljs-string">'å¹´é¾„'</span>,
        <span class="hljs-attr">prop:</span> <span class="hljs-string">'age'</span>,
        <span class="hljs-attr">component:</span> <span class="hljs-string">'Input'</span>,
      },
      {
        <span class="hljs-attr">label:</span> <span class="hljs-string">'ä¸Šå­¦é˜¶æ®µ'</span>,
        <span class="hljs-attr">prop:</span> <span class="hljs-string">'jieduan'</span>,
        <span class="hljs-attr">component:</span> <span class="hljs-string">'Select'</span>,
        <span class="hljs-attr">componentProps:</span> {
            <span class="hljs-attr">options:</span> [
              {
                <span class="hljs-attr">label:</span> <span class="hljs-string">'å¹¼å„¿å›­'</span>,
                <span class="hljs-attr">value:</span> <span class="hljs-number">1</span>
              },
              {
                <span class="hljs-attr">label:</span> <span class="hljs-string">'å…¶ä»–é˜¶æ®µ'</span>,
                <span class="hljs-attr">value:</span> <span class="hljs-number">2</span>
              }
            ]
          }
      },
]
</code></pre>
<p>å¼•å…¥ç»„ä»¶ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"> &lt;Search
    :<span class="hljs-attr">schema</span>=<span class="hljs-string">"allshema.searchcolumns"</span>
    @<span class="hljs-attr">search</span>=<span class="hljs-string">"(params) =&gt; console.log('ç‚¹å‡»æŸ¥è¯¢:',{params})"</span>
    @<span class="hljs-attr">reset</span>=<span class="hljs-string">"() =&gt; setSearchParams({}, true, true)"</span>
   &gt;
&lt;/Search&gt;

</code></pre>
<p>è¿è¡Œæˆªå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f96da8cf59134f5a9c1949dd7572d1e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5p2v5ZKW5ZWh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288618&amp;x-signature=Br6cmZ7DfiyU4eHytlqTk798QhU%3D" alt="image.png" loading="lazy"/></p>
<p>åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬å°±å·²ç»å®ç°äº†åŸºæœ¬åŠŸèƒ½ï¼š<strong>å±•ç¤ºè¡¨å•ã€ç»Ÿä¸€é£æ ¼ã€æŸ¥è¯¢é‡ç½®</strong>ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬å¯èƒ½ä¼šæƒ³è¦æŸäº›è¡¨å•é¡¹å…·æœ‰åˆå§‹å€¼ï¼Œæˆ–è€…ä¸å±•ç¤ºé‡ç½®æŒ‰é’®ï¼Œåªè¦ç»„ä»¶å†…éƒ¨ç¨åŠ æ”¹é€ ä¸€ä¸‹å°±è¡Œï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-keyword">type</span> <span class="hljs-title class_">SearchPrams</span> = {
  showSearch?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// å±•ç¤ºæœç´¢æŒ‰é’®</span>
  showReset?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// å±•ç¤ºé‡ç½®æŒ‰é’®</span>
  schema?: <span class="hljs-built_in">any</span> <span class="hljs-comment">// é…ç½®è¡¨</span>
  search?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">any</span>
  reset?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">any</span>
  labelWidth?: <span class="hljs-built_in">string</span>,
  flex?: <span class="hljs-built_in">number</span>
}

 &lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"sea-btn-box"</span>&gt;
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ElButton</span>
          <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showSearch"</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
          <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ width: '80px' }"</span>
          @<span class="hljs-attr">click</span>=<span class="hljs-string">"search"</span>
          &gt;</span>{{ $t('Search') }}&lt;/ElButton
        &gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">ElButton</span>
          <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showReset"</span>
          <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ width: '80px', marginLeft: '15px' }"</span>
          @<span class="hljs-attr">click</span>=<span class="hljs-string">"reset"</span>
          &gt;</span>{{ $t('Reset') }}&lt;/ElButton
        &gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

</span></code></pre>
<p>å¤–éƒ¨å¼•å…¥ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">searchColumn</span> = [
      {
        label: <span class="hljs-string">'å§“å'</span>,
        prop: <span class="hljs-string">'name'</span>,
        initValue: <span class="hljs-string">'åˆå§‹åŒ–åå­—'</span>,
        component: <span class="hljs-string">'Input'</span>,
      },
      ...
  ]
  &lt;Search
     :<span class="hljs-attr">schema</span>=<span class="hljs-string">"searchColumn"</span>
     @<span class="hljs-attr">search</span>=<span class="hljs-string">"(params) =&gt; console.log('ç‚¹å‡»æŸ¥è¯¢:',{params})"</span>
     :<span class="hljs-attr">showReset</span>=<span class="hljs-string">"false"</span>
    &gt;
 &lt;/Search&gt;
 
</code></pre>
<p>è¿è¡Œæˆªå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16f6d66577894dd2b9c8e71d795b024d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5p2v5ZKW5ZWh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288618&amp;x-signature=lUkRk5xsqBRJxNKZkd25FNKntjg%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·å°±å®ç°äº†æŒ‰é’®çš„å±•ç¤ºä¸éšè—ä»¥åŠåˆå§‹åŒ–é»˜è®¤å€¼ã€‚</p>
<h3 data-id="heading-4">3.2 æ‰©å±•åŠŸèƒ½å®ç°</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å®ç°ä¸€ä¸‹æ‰©å±•åŠŸèƒ½ï¼š</p>
<p><strong>1.è¡¨å•é¡¹çš„è”åŠ¨</strong></p>
<p>åˆ©ç”¨åŠ¨æ€è¡¨å•ç»„ä»¶å†…ç½®çš„ setValuesã€setSchemasæ–¹æ³•ï¼Œ</p>
<p>ç»„ä»¶å†…éƒ¨å¢åŠ æ–¹æ³•å®šä¹‰åŠæš´éœ²ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">const</span> setValues = (<span class="hljs-keyword">data</span>: any) =&gt; {
  codeFormRef?.value?.setValues(<span class="hljs-keyword">data</span>)
}

<span class="hljs-keyword">const</span> setSchemas = (<span class="hljs-keyword">data</span>: any) =&gt; {
  codeFormRef?.value?.setSchemas(<span class="hljs-keyword">data</span>)
}

defineExpose({
  getData,
  setValues,
  setSchemas
})

</code></pre>
<p>å¤–éƒ¨å¢åŠ æœç´¢ç»„ä»¶çš„refå¼•ç”¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const searchRef: <span class="hljs-attr">any</span> = ref(null)

const <span class="hljs-attr">searchColumn</span> = [
  {
    label: <span class="hljs-string">'å§“å'</span>,
    prop: <span class="hljs-string">'name'</span>,
    initValue: <span class="hljs-string">'åˆå§‹åŒ–åå­—'</span>,
    component: <span class="hljs-string">'Input'</span>,
    componentProps: {
      <span class="hljs-literal">on</span>Input: (e: any) =&gt; {
         console.log(<span class="hljs-string">'å§“åè¾“å…¥æ¡†è¾“å…¥äº‹ä»¶'</span>, e)
         searchRef.value?.setSchemas([
             {
                prop: <span class="hljs-string">'age'</span>,
                path: <span class="hljs-string">'componentProps.placeholder'</span>,
                value: `è¯·è¾“å…¥<span class="hljs-variable">${e}</span>çš„å¹´é¾„`
            }
         ])
      }
    }
  },
  {
    label: <span class="hljs-string">'å¹´é¾„'</span>,
    prop: <span class="hljs-string">'age'</span>,
    component: <span class="hljs-string">'Input'</span>,
  },
  ...
]

&lt;Search
   <span class="hljs-attr">ref</span>=<span class="hljs-string">"searchRef"</span>
   :<span class="hljs-attr">schema</span>=<span class="hljs-string">"allshema.searchcolumns"</span>
   @<span class="hljs-attr">search</span>=<span class="hljs-string">"setSearchParams"</span>
   @<span class="hljs-attr">reset</span>=<span class="hljs-string">"() =&gt; setSearchParams({}, true, true)"</span>
  &gt;
&lt;/Search&gt;
</code></pre>
<p>è¿è¡Œæˆªå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09e459d92c6f4d74b2c568adc2015dde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5p2v5ZKW5ZWh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288618&amp;x-signature=MvbiR6okgv0o5hJG1e%2FmoKDRP%2Fg%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·å°±å®ç°äº†æœç´¢è¡¨å•é¡¹ä¹‹é—´çš„è”åŠ¨ã€‚</p>
<p><strong>2.è¡¨å•é¡¹çš„æ ¡éªŒ</strong></p>
<p>ç»„ä»¶å†…éƒ¨æ”¹åŠ¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">SearchPrams</span> = {
  showSearch?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// å±•ç¤ºæœç´¢</span>
  showReset?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// å±•ç¤ºé‡ç½®æŒ‰é’®</span>
  isVaildSearch?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// æ˜¯å¦æ ¡éªŒæœç´¢</span>
  schema?: <span class="hljs-built_in">any</span> <span class="hljs-comment">// é…ç½®è¡¨</span>
  search?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">any</span>
  reset?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">any</span>
  labelWidth?: <span class="hljs-built_in">string</span>,
  flex?: <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">SearchPrams</span>&gt;(), {
  <span class="hljs-attr">showSearch</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">showReset</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">isVaildSearch</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">schema</span>: {}, <span class="hljs-comment">// è¡¨å•é…ç½®</span>
  <span class="hljs-attr">labelWidth</span>:<span class="hljs-string">'140px'</span>,
  <span class="hljs-attr">flex</span>:<span class="hljs-number">5</span>
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">search</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span>(props.<span class="hljs-property">isVaildSearch</span>) {
    <span class="hljs-keyword">const</span> valid = <span class="hljs-keyword">await</span> codeFormRef?.<span class="hljs-property">value</span>?.<span class="hljs-title function_">validate</span>();
    <span class="hljs-keyword">if</span>(!valid) <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> codeFormRef?.<span class="hljs-property">value</span>?.<span class="hljs-title function_">getData</span>()
  <span class="hljs-title function_">emits</span>(<span class="hljs-string">'search'</span>, data)
}

</code></pre>
<p>å¤–éƒ¨å¼•å…¥ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">searchColumn</span> = [
    ...,
    {
       label: <span class="hljs-string">'å¹´é¾„'</span>,
       prop: <span class="hljs-string">'age'</span>,
       component: <span class="hljs-string">'Input'</span>,
       formItemProps: {
         rules:[
             {
               required: <span class="hljs-literal">true</span>,
               message: <span class="hljs-string">'è¯·è¾“å…¥å¹´é¾„'</span>,
               trigger: <span class="hljs-string">'blur'</span>
             }
          ]
       }
    },
    ...
]

&lt;Search
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"searchRef"</span>
    :<span class="hljs-attr">schema</span>=<span class="hljs-string">"searchColumn"</span>
    @<span class="hljs-attr">search</span>=<span class="hljs-string">"(params) =&gt; console.log('ç‚¹å‡»æŸ¥è¯¢:',{params})"</span>
    :<span class="hljs-attr">showReset</span>=<span class="hljs-string">"false"</span>
    :<span class="hljs-attr">isVaildSearch</span>=<span class="hljs-string">"true"</span>
   &gt;
&lt;/Search&gt;
</code></pre>
<p>è¿è¡Œæˆªå›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67d1e812aace4c9d915901e4ca2c441a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5p2v5ZKW5ZWh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288618&amp;x-signature=UO%2F8hIqmaWdfEyxjv2KZx5Nvb5g%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ ·å°±å®ç°äº†æœç´¢è¡¨å•é¡¹çš„è¡¨å•æ ¡éªŒã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æœç´¢é‡ç½®ç»„ä»¶çš„æ ¸å¿ƒå®ç°æ­¥éª¤~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµ…è°ˆå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼]]></title>    <link>https://juejin.cn/post/7600587732991623210</link>    <guid>https://juejin.cn/post/7600587732991623210</guid>    <pubDate>2026-01-29T10:12:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600587732991623210" data-draft-id="7600606150732120107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµ…è°ˆå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-29T10:12:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµ…è°ˆå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:12:33.000Z" title="Thu Jan 29 2026 10:12:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>######å‚è€ƒæ–‡ç« :</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fhellojava%2Fp%2F3615502.html" target="_blank" title="https://www.cnblogs.com/hellojava/p/3615502.html" ref="nofollow noopener noreferrer">å•ä¾‹æ¨¡å¼ </a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fluohanguo%2Fp%2F7825656.html" target="_blank" title="https://www.cnblogs.com/luohanguo/p/7825656.html" ref="nofollow noopener noreferrer">è§‚å¯Ÿè€…æ¨¡å¼</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fz4909801%2Farticle%2Fdetails%2F59059263" target="_blank" title="https://blog.csdn.net/z4909801/article/details/59059263" ref="nofollow noopener noreferrer">è£…é¥°æ¨¡å¼</a></p>
<h3 data-id="heading-0">1.å•ä¾‹æ¨¡å¼</h3>
<p>(1)ï¼šæ‡’æ±‰ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­æ— æ³•æ­£å¸¸å·¥ä½œï¼‰</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTon</span> {
  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleTon</span>()</span>{}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingleTon instance;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingleTon <span class="hljs-title">getInstance</span>()</span>{
        <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">null</span>){
            instance=<span class="hljs-keyword">new</span> SingleTon();
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>(2)ï¼šæ‡’æ±‰ï¼ˆçº¿ç¨‹Â·Â·å®‰å…¨  synchronizedåŒæ­¥é™æ€æ–¹æ³•ï¼Œå®é™…é”ä½äº†classç±»ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œæ— è®ºinstanceæœ‰æ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œæ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•éƒ½è¦æ£€æŸ¥é”æ˜¯å¦é‡Šæ”¾ï¼Œè€—è´¹èµ„æºï¼Œæ‰€ä»¥ï¼ˆ3ï¼‰çš„è¿™ç§åŒé‡æ ¡éªŒé”çš„æ–¹å¼å°±æ˜¯ä¼˜åŒ–æ–¹å¼ï¼‰</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTon</span> {
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleTon</span>()</span>{}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingleTon instance;
  <span class="hljs-comment">//synchronizedç»™é™æ€æ–¹æ³•åŠ é”ï¼Œå®é™…ä¸Šé”ä½çš„æ˜¯SingleTon è¿™ä¸ªclassç±»ï¼Œæ„å‘³ç€å…¶ä»–ç°åœ¨åœ¨æ‰§è¡Œè¿™ä¸ª</span>
<span class="hljs-comment">// getInstance()é™æ€æ–¹æ³•æ—¶ï¼Œå¿…é¡»ç­‰å¾…classç±»é”è¢«é‡Šæ”¾ã€‚</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> synchronized SingleTon <span class="hljs-title">getInstance</span>()</span>{
        <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">null</span>){ 
            instance=<span class="hljs-keyword">new</span> SingleTon();
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>(3)ï¼šæ‡’æ±‰ï¼ˆçº¿ç¨‹Â·Â·å®‰å…¨  synchronizedåŒæ­¥ä»£ç å—ï¼ŒåŒé‡æ ¡éªŒé”ï¼Œsynchronizedå…³é”®å­—å†…å¤–éƒ½åŠ äº†ä¸€å±‚ if æ¡ä»¶åˆ¤æ–­ï¼‰</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTon</span> {
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleTon</span>()</span>{}
    <span class="hljs-keyword">private</span>  <span class="hljs-keyword">volatile</span>  <span class="hljs-keyword">static</span>  SingleTon instance;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  SingleTon <span class="hljs-title">getInstance</span>()</span>{
        <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">null</span>){ 
            synchronized (SingleTon.<span class="hljs-keyword">class</span>){ <span class="hljs-comment">//å’Œé™æ€æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿæ˜¯é”ä½çš„classç±»</span>
                <span class="hljs-keyword">if</span>(instance==<span class="hljs-literal">null</span>){
                      <span class="hljs-comment">//1.åœ¨å †ä¸Šåˆ†é…å†…å­˜ç©ºé—´å­˜å‚¨SingleTonå¯¹è±¡&gt;&gt;2.å®ä¾‹åŒ–instanceå¼•ç”¨å¯¹è±¡&gt;&gt;3.å†…å­˜ç©ºé—´è¿”å›çš„åœ° </span>
                    <span class="hljs-comment">//å€èµ‹ å€¼ç»™instanceå¼•ç”¨.</span>
                    instance=<span class="hljs-keyword">new</span> SingleTon(); <span class="hljs-comment">//volatileä¿®é¥°Instance,ç¦æ­¢æŒ‡ä»¤é‡æ’,é˜²æ­¢æŠ¥é”™</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>(4).æ‡’æ±‰(é™æ€å†…éƒ¨ç±»ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯å³ä½¿SingleTonè¢«è£…è½½äº†ï¼Œinstanceä¹Ÿä¸ä¼šç«‹é©¬å®ä¾‹åŒ–)</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTon</span> {
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleTon</span>()</span>{}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTonHolder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingleTon instance=<span class="hljs-keyword">new</span> SingleTon();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  SingleTon <span class="hljs-title">getInstance</span>()</span>{
        <span class="hljs-keyword">return</span> SingleTonHolder.instance;
    }
}
</code></pre>
<p>(5).é¥¿æ±‰ï¼ˆä¸€æ—¦SingleTon è¢«è£…è½½äº†ï¼Œinstanceä¼šç«‹é©¬å®ä¾‹åŒ–ï¼‰</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTon</span> {
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleTon</span>()</span>{}
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingleTon instance=<span class="hljs-keyword">new</span> SingleTon();
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  SingleTon <span class="hljs-title">getInstance</span>()</span>{
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<p>ï¼ˆ6ï¼‰é¥¿æ±‰ï¼ˆé™æ€ä»£ç å—ï¼‰</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingleTonSeven</span> {
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleTonSeven</span>()</span> {
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SingleTonSeven singleTonSeven;
    <span class="hljs-keyword">static</span> {
        singleTonSeven=<span class="hljs-keyword">new</span> SingleTonSeven();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span>   <span class="hljs-keyword">static</span> SingleTonSeven <span class="hljs-title">getInstance</span>()</span>{
        <span class="hljs-keyword">return</span>  singleTonSeven;
    }
}
</code></pre>
<p>ï¼ˆ7ï¼‰æšä¸¾</p>
<pre><code class="hljs language-ini" lang="ini">// å•ä¾‹
public enum  SingleTonSix {
    Instance<span class="hljs-comment">;</span>
    SingleTonSix() {
        System.out.println("init")<span class="hljs-comment">;</span>
    }
    public void print(){
        System.out.println("ffffffffffff")<span class="hljs-comment">;</span>
    }
}

//æµ‹è¯•
public static void main(String<span class="hljs-section">[]</span> args) {

      //ã€€ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿèƒ½ã€‚
        SingleTonSix <span class="hljs-attr">singleTonSix1</span>=SingleTonSix.Instance<span class="hljs-comment">;</span>
        singleTonSix1.print()<span class="hljs-comment">;</span>
        SingleTonSix <span class="hljs-attr">singleTonSix2</span>=SingleTonSix.Instance<span class="hljs-comment">;</span>
        singleTonSix2.print()<span class="hljs-comment">;</span>
        SingleTonSix <span class="hljs-attr">singleTonSix3</span>=SingleTonSix.Instance<span class="hljs-comment">;</span>
        singleTonSix3.print()<span class="hljs-comment">;</span>
        SingleTonSix <span class="hljs-attr">singleTonSix4</span>=SingleTonSix.Instance<span class="hljs-comment">;</span>
        singleTonSix4.print()<span class="hljs-comment">;</span>
    }

</code></pre>
<pre><code class="hljs">æ‰§è¡Œæ•ˆç‡ä¸Šï¼š
é¥¿æ±‰å¼æ²¡æœ‰åŠ ä»»ä½•çš„é”ï¼Œå› æ­¤æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚
æ‡’æ±‰å¼ä¸€èˆ¬ä½¿ç”¨éƒ½ä¼šåŠ åŒæ­¥é”ï¼Œæ•ˆç‡æ¯”é¥¿æ±‰å¼å·®ã€‚

æ€§èƒ½ä¸Šï¼š
é¥¿æ±‰å¼åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–ï¼Œä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨ï¼Œå®ƒéƒ½å®ä¾‹åŒ–äº†ï¼Œ
æ‰€ä»¥ä¼šå æ®ç©ºé—´ï¼Œæµªè´¹å†…å­˜ã€‚
æ‡’æ±‰å¼ä»€ä¹ˆæ—¶å€™éœ€è¦ä»€ä¹ˆæ—¶å€™å®ä¾‹åŒ–ï¼Œç›¸å¯¹æ¥è¯´ä¸æµªè´¹å†…å­˜ã€‚
</code></pre>
<h3 data-id="heading-1">2.å·¥å‚æ¨¡å¼</h3>
<p>(1).æ™®é€šå·¥å‚æ¨¡å¼</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Sender</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">send</span>();
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MailSender</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Sender</span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">send</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"this is mail sender"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsSender</span> <span class="hljs-keyword">implements</span>  <span class="hljs-title class_">Sender</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">send</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"this is sms sender"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendFactoryOne</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Sender</span> <span class="hljs-title function_">produce</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">type</span></span>){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">type</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-string">"mail"</span>)){
            <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">MailSender</span>();
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">type</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-string">"sms"</span>)){
            <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsSender</span>();
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}

</code></pre>
<p>(2).å·¥å‚æ–¹æ³•æ¨¡å¼</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SendFactoryTwo</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span>  Sender <span class="hljs-title">produceMail</span>()</span>{
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MailSender();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span>  Sender <span class="hljs-title">produceSms</span>()</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SmsSender();
    }
}
</code></pre>
<p>(3).é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SendFactoryThree</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sender <span class="hljs-title">produceMail</span>()</span>{
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MailSender();
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sender <span class="hljs-title">produceSms</span>()</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SmsSender();
    }
}

</code></pre>
<p>(4).æŠ½è±¡å·¥ç¨‹æ¨¡å¼</p>
<h5 data-id="heading-2">æ³¨æ„ï¼šå·¥ç¨‹æ–¹æ³•æ¨¡å¼æœ‰ä¸ªé—®é¢˜ï¼Œç±»çš„åˆ›å»ºå’Œæ‰©å±•å¿…é¡»ä¿®æ”¹å·¥å‚ç±»ï¼Œè¿™è¿èƒŒäº†é—­åŒ…åŸåˆ™ï¼Œæ‰€æœ‰ç”¨åˆ°æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œåˆ›å»ºå¤šä¸ªå·¥å‚ç±»ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç›´æ¥å¢åŠ å·¥å‚ç±»å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦ä¿®æ”¹ä¹‹å‰çš„ä»£ç ã€‚</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Provider</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Sender</span> <span class="hljs-title function_">produce</span>();
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendMailFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Provider</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Sender</span> <span class="hljs-title function_">produce</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MailSender</span>();
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendSmsFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Provider</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Sender</span> <span class="hljs-title function_">produce</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsSender</span>();
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>){
        <span class="hljs-title class_">SendFactoryOne</span> sendFactoryOne=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SendFactoryOne</span>();
        sendFactoryOne.<span class="hljs-title function_">produce</span>(<span class="hljs-string">"mail"</span>);
        sendFactoryOne.<span class="hljs-title function_">produce</span>(<span class="hljs-string">"sms"</span>);

         <span class="hljs-title class_">SendFactoryTwo</span> sendFactoryTwo=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SendFactoryTwo</span>();
         sendFactoryTwo.<span class="hljs-title function_">produceMail</span>();
         sendFactoryTwo.<span class="hljs-title function_">produceSms</span>();

         <span class="hljs-title class_">SendFactoryThree</span>.<span class="hljs-title function_">produceMail</span>();
         <span class="hljs-title class_">SendFactoryThree</span>.<span class="hljs-title function_">produceSms</span>();
         
         <span class="hljs-title class_">Provider</span> provider=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SendMailFactory</span>();
         <span class="hljs-title class_">Sender</span> sender=provider.<span class="hljs-title function_">produce</span>();
         sender.<span class="hljs-title function_">send</span>();

         <span class="hljs-title class_">Provider</span> provider1=<span class="hljs-keyword">new</span> <span class="hljs-title class_">SendSmsFactory</span>();
         <span class="hljs-title class_">Sender</span> sender1=provider1.<span class="hljs-title function_">produce</span>();
         sender1.<span class="hljs-title function_">send</span>();
    }
}
</code></pre>
<h3 data-id="heading-3">3.è§‚å¯Ÿè€…æ¨¡å¼</h3>
<p>ç±»ä¼¼äºé‚®ä»¶è®¢é˜…ï¼Œå½“æˆ‘ä»¬æµè§ˆä¸€äº›åšå®¢æˆ–è€…wikiæ—¶ï¼Œå½“ä½ è®¢é˜…äº†æ”¹æ–‡ç« ï¼Œå¦‚æœåç»­æœ‰æ›´æ–°ï¼Œä¼šåŠæ—¶é€šçŸ¥ä½ ï¼Œæ˜¯ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fluohanguo%2Fp%2F7825656.html%25EF%25BC%2589" target="_blank" title="https://www.cnblogs.com/luohanguo/p/7825656.html%EF%BC%89" ref="nofollow noopener noreferrer">www.cnblogs.com/luohanguo/pâ€¦</a></p>
<p>(1) ã€å®šä¹‰ä¸€ä¸ªæŠ½è±¡è§‚å¯Ÿè€…æ¥å£</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Observer</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span>()</span>;
}
</code></pre>
<p>(2)ã€å®šä¹‰ä¸€ä¸ªæŠ½è±¡è¢«è§‚å¯Ÿè€…æ¥å£</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Observerable</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerObserver</span>(<span class="hljs-params">Observer observer</span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeObserver</span>(<span class="hljs-params">Observer observer</span>)</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyObservers</span>()</span>;
}
</code></pre>
<p>(3).å®šä¹‰è¢«è§‚å¯Ÿè€…ï¼Œå®ç°äº†Observerableæ¥å£ï¼Œå¯¹Observerableæ¥å£çš„ä¸‰ä¸ªæ–¹æ³•è¿›è¡Œäº†å…·ä½“å®ç°ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªListé›†åˆï¼Œç”¨ä»¥ä¿å­˜æ³¨å†Œçš„è§‚å¯Ÿè€…ï¼Œç­‰éœ€è¦é€šçŸ¥è§‚å¯Ÿè€…æ—¶ï¼Œéå†è¯¥é›†åˆå³å¯,é€šçŸ¥æ–°å¢ä¸€ä¸ªoperation()ç”¨äºé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeChatServer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Observerable</span> {

   <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Observer</span>&gt;  list=<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<span class="hljs-comment">//é¢å‘æ¥å£ç¼–ç¨‹</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerObserver</span>(<span class="hljs-params">Observer observer</span>) {
        list.<span class="hljs-title function_">add</span>(observer);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">removeObserver</span>(<span class="hljs-params">Observer observer</span>) {
        <span class="hljs-keyword">if</span>(!list.<span class="hljs-title function_">isEmpty</span>()){
            list.<span class="hljs-title function_">remove</span>(observer);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">notifyObservers</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">for</span>(int i=<span class="hljs-number">0</span>;i&lt;list.<span class="hljs-title function_">size</span>();i++){
            list.<span class="hljs-title function_">get</span>(i).<span class="hljs-title function_">update</span>();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">operation</span>(<span class="hljs-params"/>) {
        <span class="hljs-title function_">notifyObservers</span>();
    }
}
</code></pre>
<p>(4)ã€å®šä¹‰å…·ä½“è§‚å¯Ÿè€…ï¼Œå¾®ä¿¡å…¬ä¼—å·çš„å…·ä½“è§‚å¯Ÿè€…ä¸ºç”¨æˆ·User1,User2</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User1</span> <span class="hljs-title">implements</span> <span class="hljs-title">Observer</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(User1.<span class="hljs-keyword">class</span>.toString() +<span class="hljs-string">"has received the push message!"</span>);
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">User2</span> <span class="hljs-title">implements</span> <span class="hljs-title">Observer</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(User2.<span class="hljs-keyword">class</span>.toString() +<span class="hljs-string">"has received the push message!"</span>);
    }
}

</code></pre>
<p>(5)ã€ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»</p>
<pre><code class="hljs language-ini" lang="ini">public class MainTest {
    public static void main(String<span class="hljs-section">[]</span> args){
        WeChatServer <span class="hljs-attr">server</span>=new WeChatServer()<span class="hljs-comment">;</span>
        User1 <span class="hljs-attr">user1</span>=new User1()<span class="hljs-comment">;</span>
        User2 <span class="hljs-attr">user2</span>=new User2()<span class="hljs-comment">;</span>
        server.registerObserver(user1)<span class="hljs-comment">;</span>
        server.registerObserver(user2)<span class="hljs-comment">;</span>
        server.operation()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5c3fed54aca4c4ea14b07e3d30366fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286353&amp;x-signature=1g6TEYiIln5nUveB4pkga1EiYhA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">4.è£…é¥°æ¨¡å¼</h3>
<p>è£…é¥°æ¨¡å¼å°±æ˜¯ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œè€Œä¸”æ˜¯åŠ¨æ€çš„ï¼Œè¦æ±‚è£…é¥°å¯¹è±¡å’Œè¢«è£…é¥°å¯¹è±¡å®ç°ç»Ÿä¸€æ¥å£æˆ–è€…ç»§æ‰¿åŒä¸€ä¸ªçˆ¶ç±»ï¼Œè£…é¥°å¯¹è±¡æŒæœ‰è¢«è£…é¥°å¯¹è±¡çš„å®ä¾‹ã€‚</p>
<p>(1).Foodç±»ï¼Œè®©å…¶ä»–æ‰€æœ‰é£Ÿç‰©éƒ½æ¥ç»§æ‰¿è¿™ä¸ªç±»</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Food</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> food_name;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Food</span><span class="hljs-params">()</span></span>{

    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Food</span><span class="hljs-params">(<span class="hljs-type">String</span> food_name)</span> </span>{
        <span class="hljs-keyword">this</span>.food_name = food_name;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">make</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span>  food_name;
    }
}
</code></pre>
<p>(2).Breadç±»ï¼ŒCreamç±»ï¼ŒVegetableç±»</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Food</span></span>{
    <span class="hljs-keyword">private</span> <span class="hljs-type">Food</span> basic_food;
    public <span class="hljs-type">Bread</span>(<span class="hljs-type">Food</span> basic_food){
          <span class="hljs-keyword">this</span>.basic_food=basic_food;
    }
    <span class="hljs-meta">@Override</span>
    public <span class="hljs-type">String</span> make() {
        <span class="hljs-keyword">return</span> basic_food.make()+<span class="hljs-string">"+é¢åŒ…"</span>;
    }
}

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cream</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Food</span> </span>{
    <span class="hljs-keyword">private</span>  <span class="hljs-type">Food</span> basic_food;

    public <span class="hljs-type">Cream</span>(<span class="hljs-type">Food</span> basic_food) {
        <span class="hljs-keyword">this</span>.basic_food = basic_food;
    }

    <span class="hljs-meta">@Override</span>
    public <span class="hljs-type">String</span> make() {
        <span class="hljs-keyword">return</span> basic_food.make()+<span class="hljs-string">"+å¥¶æ²¹"</span>;
    }
}

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vegetable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Food</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-type">Food</span> basic_food;

    public <span class="hljs-type">Vegetable</span>(<span class="hljs-type">Food</span> basic_food) {
        <span class="hljs-keyword">this</span>.basic_food = basic_food;
    }

    <span class="hljs-meta">@Override</span>
    public <span class="hljs-type">String</span> make() {
        <span class="hljs-keyword">return</span> basic_food.make()+<span class="hljs-string">"+è”¬èœ"</span>;
    }
}

</code></pre>
<p>(3).ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»</p>
<pre><code class="hljs language-ini" lang="ini">public class MainTest {

    public static void main(String<span class="hljs-section">[]</span> args){
        Food <span class="hljs-attr">food</span>=new Food(<span class="hljs-string">"é¦™è‚ "</span>)<span class="hljs-comment">;</span>
        Bread <span class="hljs-attr">bread</span>=new Bread(food)<span class="hljs-comment">;</span>
        Cream <span class="hljs-attr">cream</span>=new Cream(bread)<span class="hljs-comment">;</span>
        Vegetable <span class="hljs-attr">vegetable</span>=new Vegetable(cream)<span class="hljs-comment">;</span>
        System.out.print("è¿è¡Œç»“æœï¼š"+vegetable.make()+"\n")<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fa0f99c7b794b29ae7be10b175126ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286353&amp;x-signature=UgjTcuE4L0R415ZrsOr3G6RW8%2BQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">5.é€‚é…å™¨æ¨¡å¼</h3>
<h6 data-id="heading-6">(1).ç±»é€‚é…å™¨æ¨¡å¼ï¼ˆé€šè¿‡ç»§æ‰¿æ¥å®ç°é€‚é…å™¨åŠŸèƒ½ï¼‰</h6>
<p>æˆ‘ä»¬ä»¥ps2ä¸usbçš„è½¬æ¥ä¸ºä¾‹ï¼š
Ps2æ¥å£ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Ps2</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">isPs2</span>()</span>;
}
</code></pre>
<p>Usbæ¥å£:</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Usb</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">isUsb</span>()</span>;
}
</code></pre>
<p>Usbæ¥å£å®ç°ç±»ï¼šUsber</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Usber</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Usb</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">isUsb</span>(<span class="hljs-params"/>) {

    }
}
</code></pre>
<p>é€‚é…å™¨ï¼šAdapterOne</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdapterOne</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Usber</span> <span class="hljs-title">implements</span> <span class="hljs-title">Ps2</span></span>{
    <span class="hljs-meta">@Override</span>
    public void isPs2() {
           isUsb();
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>){
        <span class="hljs-comment">//1.ç±»é€‚é…ï¼Œé€šè¿‡ç»§æ‰¿ç±»é€‚é…</span>
        <span class="hljs-title class_">Ps2</span> p=<span class="hljs-keyword">new</span> <span class="hljs-title class_">AdapterOne</span>();
        p.<span class="hljs-title function_">isPs2</span>();
    }
</code></pre>
<h6 data-id="heading-7">(2).å¯¹è±¡é€‚é…å™¨æ¨¡å¼ï¼ˆé€šè¿‡ç»„åˆæ¥å®ç°é€‚é…å™¨çš„åŠŸèƒ½ï¼‰</h6>
<p>é€‚é…å™¨ï¼šAdapterTwo</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdapterTwo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Ps2</span>{
    <span class="hljs-keyword">private</span> Usber usber;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AdapterTwo</span><span class="hljs-params">(Usber usber)</span> {
        <span class="hljs-built_in">this</span>.usber = usber;
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">isPs2</span><span class="hljs-params">()</span> {
        usber.isUsb();
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>){
        <span class="hljs-comment">//2.å¯¹è±¡é€‚é…ï¼Œé€šè¿‡ç»„åˆå®ç°</span>
        <span class="hljs-title class_">Ps2</span> p=<span class="hljs-keyword">new</span> <span class="hljs-title class_">AdapterTwo</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Usber</span>());
        p.<span class="hljs-title function_">isPs2</span>();
    }
}
</code></pre>
<h6 data-id="heading-8">æ³¨æ„ï¼šç±»é€‚é…å’Œå¯¹è±¡é€‚é…æ¨¡å¼ä¸­æ‰€æœ‰çš„adapterå‡éœ€è¦å®ç°Ps2æ¥å£</h6>
<h6 data-id="heading-9">(3).æ¥å£é€‚é…å™¨æ¨¡å¼ï¼ˆé€šè¿‡æŠ½è±¡ç±»æ¥å®ç°ï¼‰</h6>
<p>ç›®æ ‡æ¥å£A:</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">A</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">a</span>()</span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">b</span>()</span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">c</span>()</span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">d</span>()</span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">e</span>()</span>;
}
</code></pre>
<p>Açš„å®ç°ç±»ï¼šAdapter</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">abstract</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Adapter</span> <span class="hljs-selector-tag">implements</span> <span class="hljs-selector-tag">A</span> {
    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">a</span>() {

    }

    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">b</span>() {

    }

    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">c</span>() {

    }

    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">d</span>() {

    }

    <span class="hljs-variable">@Override</span>
    public void <span class="hljs-built_in">e</span>() {

    }
}

</code></pre>
<p>ç»§æ‰¿è‡ªAdapterçš„MyAdapterï¼š</p>
<pre><code class="hljs language-scala" lang="scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Adapter</span> </span>{

    <span class="hljs-meta">@Override</span>
    public void a() {
        <span class="hljs-keyword">super</span>.a();
        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"å®ç°Aæ–¹æ³•"</span>);
    }

    <span class="hljs-meta">@Override</span>
    public void b() {
        <span class="hljs-keyword">super</span>.b();
        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"å®ç°Bæ–¹æ³•"</span>);
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>){
        <span class="hljs-comment">//3.æ¥å£é€‚é…ï¼Œé€šè¿‡æŠ½è±¡ç±»å®ç°</span>
        A aRealize=<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAdapter</span>();
        aRealize.<span class="hljs-title function_">a</span>();
        aRealize.<span class="hljs-title function_">b</span>();

    }
</code></pre>
<h3 data-id="heading-10">6.ç­–ç•¥æ¨¡å¼ï¼ˆä¸€ä¸ªäººèµ°æ¥¼æ¢¯ä¸Šæ¥¼æˆ–è€…èµ°ç”µæ¢¯ä¸Šæ¥¼ï¼‰</h3>
<p>è¿™é‡Œä»¥åŠ å‡ç®—æ³•ä¸ºä¾‹ï¼š
(1).å®šä¹‰æŠ½è±¡ç­–ç•¥è§’è‰²æ¥å£ï¼šStrategy</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Strategy</span> {
     <span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">calc</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> num1,<span class="hljs-built_in">int</span> num2</span>)</span>;
}
</code></pre>
<p>(2).å®šä¹‰åŠ æ³•ç­–ç•¥ï¼šAddStrategy</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calc</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> {
        <span class="hljs-keyword">return</span> num1+num2;
    }
}
</code></pre>
<p>(3).å®šä¹‰å‡æ³•ç­–ç•¥ï¼šSubStrategy</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Strategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calc</span><span class="hljs-params">(<span class="hljs-type">int</span> num1, <span class="hljs-type">int</span> num2)</span> {
        <span class="hljs-keyword">return</span> num1-num2;
    }
}
</code></pre>
<p>(4).ç¯å¢ƒè§’è‰²ï¼šEnvironment</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Environment</span> {
    <span class="hljs-keyword">private</span> Strategy strategy;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Environment</span><span class="hljs-params">(Strategy strategy)</span> </span>{
        <span class="hljs-keyword">this</span>.strategy = strategy;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">calc</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span></span>{
        <span class="hljs-keyword">return</span> strategy.<span class="hljs-built_in">calc</span>(a,b);
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"> public static void main(String<span class="hljs-section">[]</span> args){
        Strategy <span class="hljs-attr">addStrage</span>=new AddStrategy()<span class="hljs-comment">;</span>
        Environment <span class="hljs-attr">environment</span>=new Environment(addStrage)<span class="hljs-comment">;</span>
        int <span class="hljs-attr">sum1</span>=environment.calc(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>)<span class="hljs-comment">;</span>
        System.out.println("Result1:"+sum1)<span class="hljs-comment">;</span>
        Strategy <span class="hljs-attr">subStrage</span>=new SubStrategy()<span class="hljs-comment">;</span>
        int <span class="hljs-attr">sum2</span>=subStrage.calc(<span class="hljs-number">20</span>,<span class="hljs-number">10</span>)<span class="hljs-comment">;</span>
        System.out.println("Result2:"+sum2)<span class="hljs-comment">;</span>
    }
</code></pre>
<h3 data-id="heading-11">7.Builderæ¨¡å¼</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Request</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String reason;
    <span class="hljs-keyword">private</span> String days;
    <span class="hljs-keyword">private</span> String groupLeaderInfo;
    <span class="hljs-keyword">private</span> String managerInfo;
    <span class="hljs-keyword">private</span> String departmentHeaderInfo;
    <span class="hljs-keyword">private</span> String customInfo;
    <span class="hljs-keyword">public</span> Request(Builder builder){
         <span class="hljs-comment">// super();</span>
          <span class="hljs-keyword">this</span>.name=builder.name;
          <span class="hljs-keyword">this</span>.reason=builder.reason;
          <span class="hljs-keyword">this</span>.days=builder.days;
          <span class="hljs-keyword">this</span>.groupLeaderInfo=builder.groupLeaderInfo;
          <span class="hljs-keyword">this</span>.managerInfo=builder.managerInfo;
          <span class="hljs-keyword">this</span>.departmentHeaderInfo=builder.departmentHeaderInfo;
          <span class="hljs-keyword">this</span>.customInfo=builder.customInfo;

    }


    <span class="hljs-keyword">public</span> static <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span>{
        <span class="hljs-keyword">private</span> String name;
        <span class="hljs-keyword">private</span> String reason;
        <span class="hljs-keyword">private</span> String days;
        <span class="hljs-keyword">private</span> String groupLeaderInfo;
        <span class="hljs-keyword">private</span> String managerInfo;
        <span class="hljs-keyword">private</span> String departmentHeaderInfo;
        <span class="hljs-keyword">private</span> String customInfo;

        <span class="hljs-keyword">public</span> Builder setName(String name) {
            <span class="hljs-keyword">this</span>.name = name;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Builder setReason(String reason) {
            <span class="hljs-keyword">this</span>.reason = reason;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Builder setDays(String days) {
            <span class="hljs-keyword">this</span>.days = days;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Builder setGroupLeaderInfo(String groupLeaderInfo) {
            <span class="hljs-keyword">this</span>.groupLeaderInfo = groupLeaderInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Builder setManagerInfo(String managerInfo) {
            <span class="hljs-keyword">this</span>.managerInfo = managerInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Builder setDepartmentHeaderInfo(String departmentHeaderInfo) {
            <span class="hljs-keyword">this</span>.departmentHeaderInfo = departmentHeaderInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Builder setCustomInfo(String customInfo) {
            <span class="hljs-keyword">this</span>.customInfo = customInfo;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        <span class="hljs-keyword">public</span> Builder newRequest(Request request){
            <span class="hljs-keyword">this</span>.name=request.name;
            <span class="hljs-keyword">this</span>.days=request.days;
            <span class="hljs-keyword">this</span>.reason=request.reason;
            <span class="hljs-keyword">if</span>(request.getGroupLeaderInfo()!=<span class="hljs-literal">null</span>&amp;&amp;!request.getGroupLeaderInfo().equals(<span class="hljs-string">""</span>)){
                <span class="hljs-keyword">this</span>.groupLeaderInfo=request.groupLeaderInfo;
            }
            <span class="hljs-keyword">if</span>(request.getManagerInfo()!=<span class="hljs-literal">null</span>&amp;&amp;!request.getManagerInfo().equals(<span class="hljs-string">""</span>)){
                <span class="hljs-keyword">this</span>.managerInfo=request.managerInfo;
            }
            <span class="hljs-keyword">if</span>(request.getDepartmentHeaderInfo()!=<span class="hljs-literal">null</span>&amp;&amp;!request.getDepartmentHeaderInfo().equals(<span class="hljs-string">""</span>)){
                <span class="hljs-keyword">this</span>.departmentHeaderInfo=request.getDepartmentHeaderInfo();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">public</span> Request build(){
            <span class="hljs-keyword">return</span> new Request(<span class="hljs-keyword">this</span>);
        }
    }

    <span class="hljs-keyword">public</span> String getName() {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> String getReason() {
        <span class="hljs-keyword">return</span> reason;
    }

    <span class="hljs-keyword">public</span> String getDays() {
        <span class="hljs-keyword">return</span> days;
    }

    <span class="hljs-keyword">public</span> String getGroupLeaderInfo() {
        <span class="hljs-keyword">return</span> groupLeaderInfo;
    }

    <span class="hljs-keyword">public</span> String getManagerInfo() {
        <span class="hljs-keyword">return</span> managerInfo;
    }

    <span class="hljs-keyword">public</span> String getDepartmentHeaderInfo() {
        <span class="hljs-keyword">return</span> departmentHeaderInfo;
    }

    <span class="hljs-keyword">public</span> String getCustomInfo() {
        <span class="hljs-keyword">return</span> customInfo;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String toString() {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Request{"</span> +
                <span class="hljs-string">"name='"</span> + name + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", reason='"</span> + reason + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", days='"</span> + days + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", groupLeaderInfo='"</span> + groupLeaderInfo + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", managerInfo='"</span> + managerInfo + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", departmentHeaderInfo='"</span> + departmentHeaderInfo + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", customInfo='"</span> + customInfo + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">  <span class="hljs-keyword">public</span> static void main(String[] args){
       <span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder()
               .setName(<span class="hljs-string">"shuijian"</span>)
               .setReason(<span class="hljs-string">"GoHome"</span>)
               .setDays(<span class="hljs-string">"2days"</span>)
               .build();
       System.out.println(<span class="hljs-built_in">request</span>.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
    }
</code></pre>
<h3 data-id="heading-12">8.è´£ä»»é“¾æ¨¡å¼</h3>
<p>å®ä¾‹åœºæ™¯
Â  Â  åœ¨å…¬å¸å†…éƒ¨å‘˜å·¥è¯·å‡ä¸€èˆ¬æƒ…å†µæ˜¯è¿™æ ·çš„ï¼šå‘˜å·¥åœ¨OAç³»ç»Ÿä¸­æäº¤ä¸€å°è¯·å‡é‚®ä»¶ï¼Œè¯¥é‚®ä»¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°ä½ çš„ç›´æ¥ä¸Šçº§é¢†å¯¼é‚®ç®±é‡Œï¼Œå¦‚æœä½ çš„è¯·å‡çš„æƒ…å†µç‰¹æ®Šçš„è¯ï¼Œè¯¥é‚®ä»¶ä¹Ÿä¼šè½¬å‘åˆ°ä½ ä¸Šçº§çš„ä¸Šçº§çš„é‚®ç®±ï¼Œæ ¹æ®è¯·å‡çš„æƒ…å†µå¤©æ•°å¤šå°‘ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è½¬å‘ç›¸åº”çš„è´£ä»»äººçš„é‚®ç®±ã€‚æˆ‘ä»¬å°±ä»¥è¿™æ ·ä¸€ç§åœºæ™¯ä¸ºä¾‹å®Œæˆä¸€ä¸ªè´£ä»»é“¾æ¨¡å¼çš„ä»£ç ã€‚ä¸ºäº†æ›´æ¸…æ™°çš„æè¿°è¿™ç§åœºæ™¯æˆ‘ä»¬è§„å®šå¦‚ä¸‹ï¼š
Â  Â  â‘  GroupLeaderï¼ˆç»„é•¿ ï¼‰ï¼šä»–èƒ½æ‰¹å‡†çš„å‡æœŸä¸º2å¤©ï¼Œå¦‚æœè¯·å‡å¤©æ•°è¶…è¿‡2å¤©å°±å°†è¯·å‡é‚®ä»¶è‡ªåŠ¨è½¬å‘åˆ°ç»„é•¿å’Œç»ç†é‚®ç®±ã€‚
Â  Â  â‘¡Â Managerï¼ˆç»ç†ï¼‰ï¼šä»–èƒ½æ‰¹å‡†çš„å‡æœŸä¸º4å¤©ä»¥å†…ï¼Œå¦‚æœè¯·å‡å¤©æ•°å¤§äº4å¤©å°†è¯¥é‚®ä»¶è½¬å‘åˆ°è‡ªåŠ¨è½¬å‘åˆ°ç»„é•¿ã€ç»ç†å’Œéƒ¨é—¨é¢†å¯¼çš„é‚®ç®±ã€‚
Â  Â  â‘¢Â DepartmentHeaderï¼ˆéƒ¨é—¨é¢†å¯¼ï¼‰ï¼šä»–èƒ½æ‰¹å‡†çš„å‡æœŸä¸º7å¤©ä»¥å†…ï¼Œå¦‚æœå¤§äº7å¤©å°±åªæ‰¹å‡†7å¤©ã€‚</p>
<h6 data-id="heading-13">(1).æ„é€ Requestå¯¹è±¡ï¼Œå¦‚ï¼šBuilderæ¨¡å¼ä¸­çš„Request</h6>
<h6 data-id="heading-14">(2).æ„é€ æ‰¹å‡†ç»“æœå¯¹è±¡Result</h6>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> isRality;
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span>  info;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Result</span>(<span class="hljs-built_in">boolean</span> isRality, <span class="hljs-title class_">String</span> info) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRality</span> = isRality;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isRality</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> isRality;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setRality</span>(<span class="hljs-params"><span class="hljs-built_in">boolean</span> rality</span>) {
        isRality = rality;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> info;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setInfo</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> info</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Result{"</span> +
                <span class="hljs-string">"isRality="</span> + isRality +
                <span class="hljs-string">", info='"</span> + info + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<h6 data-id="heading-15">(3).å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£ç”¨äºå¤„ç†Requestå’Œè·å–è¯·æ±‚ç»“æœResult</h6>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Ratify</span> {
    <span class="hljs-comment">//å¤„ç†è¯·æ±‚</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Result <span class="hljs-title">deal</span>(<span class="hljs-params">Chain chain</span>)</span>;
    <span class="hljs-comment">//å¯¹requestå’Œresultå°è£…ï¼Œç”¨æ¥è½¬å‘</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title">Chain</span>{
        <span class="hljs-comment">//è·å–å½“å‰çš„request</span>
        <span class="hljs-function">Request <span class="hljs-title">request</span>()</span>;
        <span class="hljs-comment">//è½¬å‘Request</span>
        <span class="hljs-function">Result <span class="hljs-title">proceed</span>(<span class="hljs-params">Request request</span>)</span>;
    }
}
</code></pre>
<p>çœ‹åˆ°ä¸Šé¢çš„æ¥å£ï¼Œå¯èƒ½ä¼šæœ‰äººè¿·æƒ‘ï¼šåœ¨æ¥å£Ratifyä¸­ä¸ºä»€ä¹ˆåˆå®šä¹‰ä¸€ä¸ªChainæ¥å£å‘¢ï¼Ÿå…¶å®è¿™ä¸ªæ¥å£æ˜¯å•ç‹¬å®šä¹‰è¿˜æ˜¯å†…éƒ¨æ¥å£æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œä½†æ˜¯è€ƒè™‘åˆ°Chainæ¥å£ä¸Ratifyæ¥å£çš„å…³ç³»ä¸ºæé«˜å†…èšæ€§å°±å®šä¹‰ä¸ºå†…éƒ¨æ¥å£äº†ã€‚å®šä¹‰Ratifyæ¥å£æ˜¯ä¸ºäº†å¤„ç†Requesté‚£ä¸ºä»€ä¹ˆè¿˜è¦å®šä¹‰Chainæ¥å£å‘¢ï¼Ÿè¿™æ­£æ˜¯è´£ä»»é“¾æ¥å£çš„ç²¾é«“ä¹‹å¤„ï¼šè½¬å‘åŠŸèƒ½åŠå¯åŠ¨æ€æ‰©å±•â€œè´£ä»»äººâ€ï¼Œè¿™ä¸ªæ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ä¸€ä¸ªæ˜¯requestï¼ˆï¼‰å°±æ˜¯ä¸ºäº†è·å–requestï¼Œå¦‚æœå½“å‰Ratifyçš„å®ç°ç±»è·å–åˆ°requestä¹‹åå‘ç°è‡ªå·±ä¸èƒ½å¤„ç†æˆ–è€…è¯´è‡ªå·±åªèƒ½å¤„ç†éƒ¨åˆ†è¯·æ±‚ï¼Œé‚£ä¹ˆä»–å°†è‡ªå·±çš„é‚£éƒ¨åˆ†èƒ½å¤„ç†çš„å°±å¤„ç†æ‰ï¼Œç„¶åé‡æ–°æ„å»ºä¸€ä¸ªæˆ–è€…ç›´æ¥è½¬å‘Requestç»™ä¸‹ä¸€ä¸ªè´£ä»»äººã€‚å¯èƒ½è¿™ç‚¹è¯´çš„ä¸å®¹æ˜“ç†è§£ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨Androidä¸åå°äº¤äº’ä¸­å¦‚æœä½¿ç”¨äº†Httpåè®®ï¼Œå½“ç„¶æˆ‘ä»¬å¯èƒ½ä½¿ç”¨å„ç§Httpæ¡†æ¶å¦‚HttpClientã€OKHttpç­‰ï¼Œæˆ‘ä»¬åªéœ€è¦å‘é€è¦è¯·æ±‚çš„å‚æ•°å°±ç›´æ¥ç­‰å¾…ç»“æœäº†ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä½ å¯èƒ½å¹¶æ²¡æœ‰æ„å»ºè¯·æ±‚å¤´ï¼Œé‚£ä¹ˆæ¡†æ¶å¸®ä½ æŠŠè¿™éƒ¨åˆ†å·¥ä½œç»™åšäº†ï¼Œå®ƒåšçš„å·¥ç¨‹ä¸­å¦‚æœä½¿ç”¨äº†è´£ä»»é“¾æ¨¡å¼çš„è¯ï¼Œå®ƒè‚¯å®šä¼šå°†Requestè¿›è¡ŒåŒ…è£…ï¼ˆä¹Ÿå°±æ˜¯æ·»åŠ è¯·æ±‚å¤´ï¼‰æˆæ–°çš„Requestï¼Œæˆ‘ä»¬å§‘ä¸”åŠ ä»–ä¸ºRequest1ï¼Œå¦‚æœä½ åˆå¸Œæœ›Httpåšæœ¬åœ°ç¼“å­˜ï¼Œé‚£ä¹ˆRequest1åˆä¼šè¢«è½¬å‘åˆ°å¹¶ä¸”é‡æ–°è¿›ä¸€æ­¥åŒ…è£…ä¸ºRequest2ã€‚æ€»ä¹‹Chainè¿™ä¸ªæ¥å£å°±æ˜¯èµ·åˆ°å¯¹Requestè¿›è¡Œé‡æ–°åŒ…è£…çš„å¹¶å°†åŒ…è£…åçš„Requestè¿›è¡Œä¸‹ä¸€æ­¥è½¬å‘çš„ä½œç”¨ã€‚å¦‚æœè¿˜ä¸æ˜¯å¾ˆæ˜ç™½ä¹Ÿæ²¡å…³ç³»ï¼Œæœ¬å®ä¾‹ä¼šæ¼”ç¤ºè¿™ä¸€åŠŸèƒ½æœºåˆ¶ã€‚</p>
<h6 data-id="heading-16">(4).å®ç°Chainæ¥å£çš„çš„çœŸæ­£çš„åŒ…è£…Requestå’Œè½¬å‘åŠŸèƒ½</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RealChain</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Ratify</span>.Chain {
    <span class="hljs-keyword">public</span> Request request;
    <span class="hljs-keyword">public</span> List&lt;Ratify&gt; ratifyList;
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> index;
    <span class="hljs-comment">/**
     * æ„é€ æ–¹æ³•
     *
     * <span class="hljs-doctag">@param</span> ratifyList
     *            Ratifyæ¥å£çš„å®ç°ç±»é›†åˆ
     * <span class="hljs-doctag">@param</span> request
     *            å…·ä½“çš„è¯·æ±‚Requestå®ä¾‹
     * <span class="hljs-doctag">@param</span> index
     *            å·²ç»å¤„ç†è¿‡è¯¥requestçš„è´£ä»»äººæ•°é‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RealChain</span><span class="hljs-params">(List&lt;Ratify&gt; ratifyList, Request request,<span class="hljs-type">int</span> index)</span> {
        <span class="hljs-built_in">this</span>.request = request;
        <span class="hljs-built_in">this</span>.ratifyList = ratifyList;
        <span class="hljs-built_in">this</span>.index = index;
    }
    <span class="hljs-comment">/**
     * æ–¹æ³•æè¿°ï¼šå…·ä½“è½¬å‘åŠŸèƒ½
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">proceed</span><span class="hljs-params">(Request request)</span> {
        Result proceed=<span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span>(ratifyList.size()&gt;index){
          RealChain realChain=<span class="hljs-keyword">new</span> <span class="hljs-title class_">RealChain</span>(ratifyList,request,index+<span class="hljs-number">1</span>);
          Ratify ratify=ratifyList.get(index);
          proceed=ratify.deal(realChain);
        }
        <span class="hljs-keyword">return</span> proceed;
    }

    <span class="hljs-comment">/***
     * æ–¹æ³•æè¿°ï¼šè¿”å›å½“å‰Requestå¯¹è±¡æˆ–è€…è¿”å›å½“å‰è¿›è¡ŒåŒ…è£…åçš„Requestå¯¹è±¡
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Request <span class="hljs-title function_">request</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> request;
    }
}
</code></pre>
<h6 data-id="heading-17">(5).GroupLeaderã€Managerå’ŒDepartmentHeaderï¼Œå¹¶è®©ä»–ä»¬å®ç°Ratifyæ¥å£</h6>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> GroupLeader implements Ratify {
    @Override
    <span class="hljs-keyword">public</span> Result deal(Chain chain) {
        <span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>=chain.<span class="hljs-built_in">request</span>();
        System.out.println(<span class="hljs-string">"GroupLeader====&gt;request:"</span>+<span class="hljs-built_in">request</span>.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
        <span class="hljs-keyword">if</span>(Integer.parse<span class="hljs-built_in">Int</span>(<span class="hljs-built_in">request</span>.getDays())&gt;<span class="hljs-number">1</span>){
            //åŒ…è£…æ–°çš„<span class="hljs-built_in">Request</span>å¯¹è±¡
            <span class="hljs-built_in">Request</span> newRequest=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder().newRequest(<span class="hljs-built_in">request</span>).setGroupLeaderInfo(<span class="hljs-built_in">request</span>.getName()+<span class="hljs-string">"å¹³æ—¶è¡¨ç°ä¸é”™,è€Œä¸”ç°åœ¨é¡¹ç›®ä¸å¿™"</span>).build();
            return chain.proceed(newRequest);
        }
        return <span class="hljs-keyword">new</span> Result(<span class="hljs-literal">true</span>,<span class="hljs-string">"GroupLeader:æ—©å»æ—©å›"</span>);
    }
}
</code></pre>

<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> Manager implements Ratify {
    @Override
    <span class="hljs-keyword">public</span> Result deal(Chain chain) {
        <span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>=chain.<span class="hljs-built_in">request</span>();
        System.out.println(<span class="hljs-string">"Manager====&gt;request:"</span>+<span class="hljs-built_in">request</span>.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
        <span class="hljs-keyword">if</span>(Integer.parse<span class="hljs-built_in">Int</span>(<span class="hljs-built_in">request</span>.getDays())&gt;<span class="hljs-number">3</span>){
            //æ„å»ºæ–°çš„<span class="hljs-built_in">Request</span>
            <span class="hljs-built_in">Request</span> newRequest=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder().newRequest(<span class="hljs-built_in">request</span>).setManagerInfo(<span class="hljs-built_in">request</span>.getName()+<span class="hljs-string">"æ¯æœˆçš„KPIè€ƒæ ¸è¿˜ä¸é”™,å¯ä»¥æ‰¹å‡†"</span>).build();
            return chain.proceed(newRequest);

        }
        return <span class="hljs-keyword">new</span> Result(<span class="hljs-literal">true</span>,<span class="hljs-string">"Manager:æ—©ç‚¹æŠŠäº‹æƒ…åŠå®Œï¼Œé¡¹ç›®ç¦»ä¸å¼€ä½ "</span>);
    }
}
</code></pre>

<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> DepartmentHeader implements Ratify {
    @Override
    <span class="hljs-keyword">public</span> Result deal(Chain chain) {
        <span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>=chain.<span class="hljs-built_in">request</span>();
        System.out.println(<span class="hljs-string">"DepartmentHeader=====&gt;request:"</span>+<span class="hljs-built_in">request</span>.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
        <span class="hljs-keyword">if</span>(Integer.parse<span class="hljs-built_in">Int</span>(<span class="hljs-built_in">request</span>.getDays())&gt;<span class="hljs-number">7</span>){
              return  <span class="hljs-keyword">new</span> Result(<span class="hljs-literal">false</span>,<span class="hljs-string">"DepartmentHeader:ä½ è¿™ä¸ªæ—¶é—´å¤ªé•¿,ä¸èƒ½æ‰¹å‡†"</span>);
        }
        return <span class="hljs-keyword">new</span> Result(<span class="hljs-literal">true</span>,<span class="hljs-string">"DepartmentHeader:ä¸è¦ç€æ€¥ï¼ŒæŠŠäº‹æƒ…å¤„ç†å®Œåœ¨å›æ¥!"</span>);
    }
}
</code></pre>

<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> CustomInterceptor implements Ratify {
    @Override
    <span class="hljs-keyword">public</span> Result deal(Chain chain) {
        <span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>=chain.<span class="hljs-built_in">request</span>();
        System.out.println(<span class="hljs-string">"CustomInterceptor====&gt;"</span>+<span class="hljs-built_in">request</span>.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());
        String reason=<span class="hljs-built_in">request</span>.getReason();
        <span class="hljs-keyword">if</span>(reason!=<span class="hljs-literal">null</span>&amp;&amp;reason.equals(<span class="hljs-string">"äº‹å‡"</span>)){
              <span class="hljs-built_in">Request</span> newRequest=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder().newRequest(<span class="hljs-built_in">request</span>).setCustomInfo(<span class="hljs-built_in">request</span>.getName()+<span class="hljs-string">"è¯·çš„æ˜¯äº‹å‡ï¼Œè€Œä¸”å¾ˆç€æ€¥ï¼Œè¯·é¢†å¯¼é‡è§†ä¸€ä¸‹"</span>).build();
              System.out.println(<span class="hljs-string">"CustomInterceptor====&gt;è½¬å‘è¯·æ±‚"</span>);
              return chain.proceed(newRequest);
        }
        return <span class="hljs-keyword">new</span> Result(<span class="hljs-literal">true</span>,<span class="hljs-string">"åŒæ„è¯·å‡"</span>);
    }
}
</code></pre>
<h6 data-id="heading-18">(6).è´£ä»»é“¾æ¨¡å¼å·¥å…·ç±»</h6>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ChainOfResponsibilityClient</span> {
    <span class="hljs-keyword">private</span> ArrayList&lt;Ratify&gt; ratifies;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ChainOfResponsibilityClient</span>()</span> {
        ratifies=<span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    }

    <span class="hljs-comment">/**
     * ä¸ºäº†å±•ç¤ºâ€œè´£ä»»é“¾æ¨¡å¼â€çš„çœŸæ­£çš„è¿·äººä¹‹å¤„ï¼ˆå¯æ‰©å±•æ€§ï¼‰ï¼Œåœ¨è¿™é‡Œæ„é€ è¯¥æ–¹æ³•ä»¥ä¾¿æ·»åŠ è‡ªå®šä¹‰çš„â€œè´£ä»»äººâ€
     * @param ratify
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addRatifys</span>(<span class="hljs-params">Ratify ratify</span>)</span>{
        ratifies.<span class="hljs-keyword">add</span>(ratify);
    }

    <span class="hljs-comment">/***
     *
     * æ–¹æ³•æè¿°ï¼šæ‰§è¡Œè¯·æ±‚
     * @param request
     * @return
     */</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> Result <span class="hljs-title">execute</span>(<span class="hljs-params">Request request</span>)</span>{
        ArrayList&lt;Ratify&gt; arrayList=<span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        arrayList.addAll(ratifies);
        arrayList.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> GroupLeader());
        arrayList.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Manager());
        arrayList.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> DepartmentHeader());
        RealChain realChain=<span class="hljs-keyword">new</span> RealChain(arrayList,request,<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> realChain.proceed(request);
    }
}
</code></pre>
<h6 data-id="heading-19">(6).æµ‹è¯•æ–¹æ³•</h6>
<pre><code class="hljs language-vbscript" lang="vbscript"> <span class="hljs-keyword">public</span> static void main(String[] args){
        //å†™æ³•ä¸€
        <span class="hljs-built_in">Request</span>.Builder builder=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder();//é€šè¿‡é™æ€å†…éƒ¨ç±»æ„å»ºbuilderå¯¹è±¡
        builder.setName(<span class="hljs-string">"zhangsan"</span>);
        builder.setDays(<span class="hljs-string">"5"</span>);
        builder.setReason(<span class="hljs-string">"äº‹å‡"</span>);
        <span class="hljs-built_in">Request</span> <span class="hljs-built_in">request</span>=builder.build();//buildæ–¹æ³•è¿”å›<span class="hljs-built_in">request</span>å¯¹è±¡
        //å†™æ³•äºŒ
        <span class="hljs-built_in">Request</span> request1=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Request</span>.Builder().setName(<span class="hljs-string">"lisi"</span>).setDays(<span class="hljs-string">"7"</span>).setReason(<span class="hljs-string">"äº‹å‡"</span>).build();
        //System.out.pr<span class="hljs-built_in">int</span>(<span class="hljs-string">"ç»“æœï¼š"</span>+<span class="hljs-built_in">request</span>.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());

        ChainOfResponsibilityClient client=<span class="hljs-keyword">new</span> ChainOfResponsibilityClient();
        //æ·»åŠ è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨åˆ°è´£ä»»äººåˆ—è¡¨é¡¶ç«¯
        client.addRatifys(<span class="hljs-keyword">new</span> CustomInterceptor());
        Result result=client.<span class="hljs-keyword">execute</span>(<span class="hljs-built_in">request</span>);
        System.out.println(<span class="hljs-string">"ç»“æœ:"</span>+result.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());

    }
</code></pre>
<h3 data-id="heading-20">9.äº«å…ƒæ¨¡å¼</h3>
<p>(1).å®šä¹‰ä¸€ä¸ªæ¥å£ä½œä¸ºäº«å…ƒè§’è‰²</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBike</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ride</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> hours</span>)</span>;
}
</code></pre>
<p>(2).å®ç°IBikeæ¥å£ï¼Œä½œä¸ºå…·ä½“çš„äº«å…ƒè§’è‰²</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShareBike</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBike</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> price=<span class="hljs-number">2</span> ;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ride</span><span class="hljs-params">(<span class="hljs-type">int</span> hours)</span> {
        <span class="hljs-type">int</span> total=<span class="hljs-number">2</span>*hours;
        System.out.println(<span class="hljs-string">"ride bike total spend "</span>+total+<span class="hljs-string">" RMB"</span>);

    }
}
</code></pre>
<p>(3).åˆ›å»ºäº«å…ƒå·¥å‚</p>
<pre><code class="hljs language-ini" lang="ini">public class ShareBikeFactory {
    Map&lt;String,IBike&gt; <span class="hljs-attr">pool</span>=new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
    public  IBike getBike(String name){
        IBike <span class="hljs-attr">iBike</span>=null<span class="hljs-comment">;</span>
        if(!pool.containsKey(name)){
            <span class="hljs-attr">iBike</span>=new ShareBike()<span class="hljs-comment">;</span>
            pool.put(name,iBike)<span class="hljs-comment">;</span>
            System.out.println("äº¤äº†199å…ƒæŠ¼é‡‘ï¼Œå¯ä»¥ç”¨è½¦:"+name)<span class="hljs-comment">;</span>
        }else{
            <span class="hljs-attr">iBike</span>=pool.get(name)<span class="hljs-comment">;</span>
            System.out.println("æŠ¼é‡‘å·²äº¤ï¼Œç›´æ¥ç”¨è½¦:"+name)<span class="hljs-comment">;</span>
        }
        return iBike<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>(4).æµ‹è¯•ç±»</p>
<pre><code class="hljs language-ini" lang="ini"> public static void main(String<span class="hljs-section">[]</span> args) {
        ShareBikeFactory <span class="hljs-attr">shareBikeFactory</span>=new ShareBikeFactory()<span class="hljs-comment">;</span>
        //ç¬¬ä¸€æ¬¡éª‘ofoï¼Œäº¤æŠ¼é‡‘
        IBike <span class="hljs-attr">ofo1</span>=shareBikeFactory.getBike(<span class="hljs-string">"ofo"</span>)<span class="hljs-comment">;</span>
        ofo1.ride(2)<span class="hljs-comment">;</span>
        //ç¬¬ä¸€æ¬¡éª‘mobikeï¼Œäº¤æŠ¼é‡‘
        IBike <span class="hljs-attr">mobike</span>=shareBikeFactory.getBike(<span class="hljs-string">"mobike"</span>)<span class="hljs-comment">;</span>
        mobike.ride(3)<span class="hljs-comment">;</span>
        //ç¬¬äºŒæ¬¡éª‘mobikeï¼Œä¸äº¤æŠ¼é‡‘
        IBike <span class="hljs-attr">ofo2</span>=shareBikeFactory.getBike(<span class="hljs-string">"ofo"</span>)<span class="hljs-comment">;</span>
        ofo2.ride(4)<span class="hljs-comment">;</span>
    }
</code></pre>
<h3 data-id="heading-21">10.æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h3>
<p>(1).åˆ›å»ºæŠ½è±¡ç±»ï¼Œå®šä¹‰ç®—æ³•æ¡†æ¶</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Postman</span> {

    <span class="hljs-function"><span class="hljs-keyword">public</span> final <span class="hljs-keyword">void</span> <span class="hljs-title">post</span>()</span>{<span class="hljs-comment">//è¿™é‡Œå£°æ˜ä¸ºfinalï¼Œä¸å¸Œæœ›å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œé˜²æ­¢æ›´æ”¹æµç¨‹</span>
        prepare();
        call();
        <span class="hljs-keyword">if</span>(isSign()){
            sign();
        }<span class="hljs-keyword">else</span>{
            refuse();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refuse</span>()</span> {
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sign</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ´¾é€å®Œæ¯•,å®¢æˆ·å·²ç»ç­¾æ”¶ï¼"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> boolean <span class="hljs-title">isSign</span>()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">call</span>()</span>;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepare</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å¿«é€’å·²ç»åˆ°è¾¾ï¼Œå‡†å¤‡æ´¾é€..."</span>);
    }
}
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢çš„æŠ½è±¡ç±»ï¼ˆPostmanï¼‰åŒ…å«äº†ä¸‰ç§ç±»å‹çš„æ–¹æ³•ï¼šæŠ½è±¡æ–¹æ³•ã€å…·ä½“æ–¹æ³•å’Œé’©å­æ–¹æ³•ã€‚
æŠ½è±¡æ–¹æ³•ï¼šéœ€è¦å­ç±»å»å®ç°ã€‚å¦‚ä¸Šé¢çš„call()ã€‚
å…·ä½“æ–¹æ³•ï¼šæŠ½è±¡çˆ¶ç±»ä¸­ç›´æ¥å®ç°ã€‚å¦‚ä¸Šé¢çš„prepare()å’Œsign()ã€‚
é’©å­æ–¹æ³•ï¼šæœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§ï¼Œå®ƒæ˜¯ä¸€ä¸ªç©ºå®ç°çš„æ–¹æ³•ï¼Œå­ç±»å¯ä»¥è§†æƒ…å†µæ¥å†³å®šæ˜¯å¦è¦è¦†ç›–å®ƒï¼Œå¦‚ä¸Šé¢çš„refuse()ï¼›ç¬¬äºŒç§ï¼Œå®ƒçš„è¿”å›ç±»å‹é€šå¸¸æ˜¯booleanç±»å‹çš„ï¼Œä¸€èˆ¬ç”¨äºå¯¹æŸä¸ªæ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡ŒæŸä¸€æ­¥éª¤ï¼Œå¦åˆ™å°†ä¸æ‰§è¡Œï¼Œå¦‚ä¸Šé¢çš„isSign()ã€‚
(2).åˆ›å»ºå…·ä½“å®ç°ç±»ï¼Œå®šä¹‰ç®—æ³•æ¡†æ¶
PostmanA:</p>
<pre><code class="hljs language-scala" lang="scala">public  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostmanA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Postman</span></span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void call() {
        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"è”ç³»æ”¶è´§äººA,å‡†å¤‡æ´¾é€..."</span>);
    }
}
</code></pre>
<p>PostmanB:</p>
<pre><code class="hljs language-scala" lang="scala">public  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostmanB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Postman</span></span>{
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void call() {
        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"è”ç³»æ”¶è´§äººB,å‡†å¤‡æ´¾é€..."</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> boolean isSign() {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void refuse() {
        <span class="hljs-keyword">super</span>.refuse();
        <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"å•†å“ä¸å®ç‰©ä¸ç¬¦ï¼Œæ‹’ç»ç­¾æ”¶!"</span>);
    }
}
</code></pre>
<p>(3).æµ‹è¯•ç±»</p>
<pre><code class="hljs language-scss" lang="scss"> public static void <span class="hljs-selector-tag">main</span>(String[] args){
        <span class="hljs-comment">//Aæ”¶è´§äººæ­£å¸¸ç­¾æ”¶</span>
        Postman postmanA=new <span class="hljs-built_in">PostmanA</span>();
        postmanA<span class="hljs-selector-class">.post</span>();
        <span class="hljs-comment">//Bæ”¶è´§äººæ‹’ç»ç­¾æ”¶</span>
        Postman postmanB=new <span class="hljs-built_in">PostmanB</span>();
        postmanB<span class="hljs-selector-class">.post</span>();
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d095712c6ae849da8bf905d1cbe156a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286353&amp;x-signature=1B%2Bog5v8EsnaFCfsMschnueXpMY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-22">11.å¤‡å¿˜å½•æ¨¡å¼</h3>
<p>ä»¥æ¸¸æˆå­˜æ¡£ä¸ºä¾‹:
(1).åˆ›å»ºå‘èµ·äººè§’è‰²ï¼šGame</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Game</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> mLevel=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> mIcon=<span class="hljs-number">0</span>;

    <span class="hljs-comment">/***
     * å¼€å§‹æ¸¸æˆ
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paly</span>()</span>{
        System.<span class="hljs-keyword">out</span>.print(<span class="hljs-string">"å‡çº§äº†"</span>);
        mLevel++;
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å½“å‰ç­‰çº§ä¸ºï¼š"</span>+mLevel);
        mIcon+=<span class="hljs-number">32</span>;
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"è·å¾—é‡‘å¸ï¼š"</span>+mIcon);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å½“å‰é‡‘å¸æ•°é‡ä¸º:"</span>+mIcon);
    }

    <span class="hljs-comment">/***
     * é€€å‡ºæ¸¸æˆ
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exit</span>()</span>{
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"é€€å‡ºæ¸¸æˆï¼Œå±æ€§ä¸ºï¼šç­‰çº§="</span>+mLevel+<span class="hljs-string">",é‡‘å¸="</span>+mIcon);
    }

    <span class="hljs-comment">//åˆ›å»ºå¤‡å¿˜å½•</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Memo <span class="hljs-title">createMemo</span>()</span>{
        Memo memo=<span class="hljs-keyword">new</span> Memo();
        memo.setmLevel(mLevel);
        memo.setmIcon(mIcon);
        <span class="hljs-keyword">return</span> memo;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMemo</span>(<span class="hljs-params">Memo memo</span>)</span>{
        mLevel=memo.getmLevel();
        mIcon=memo.getmIcon();
    }

}
</code></pre>
<p>(2).åˆ›å»ºå¤‡å¿˜å½•è§’è‰²ï¼šMemo</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Memo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> mLevel;<span class="hljs-comment">//ç­‰çº§</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> mIcon;<span class="hljs-comment">//é‡‘å¸æ•°é‡</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getmLevel</span>()</span> {
        <span class="hljs-keyword">return</span> mLevel;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setmLevel</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> mLevel</span>)</span> {
        <span class="hljs-keyword">this</span>.mLevel = mLevel;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getmIcon</span>()</span> {
        <span class="hljs-keyword">return</span> mIcon;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setmIcon</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> mIcon</span>)</span> {
        <span class="hljs-keyword">this</span>.mIcon = mIcon;
    }
}
</code></pre>
<p>(3).åˆ›å»ºè´Ÿè´£äººè§’è‰²ï¼šCreateMemo</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateMemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Memo</span> memo;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Memo</span> <span class="hljs-title function_">getMemo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> memo;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMemo</span>(<span class="hljs-params">Memo memo</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">memo</span> = memo;
    }
}
</code></pre>
<p>(4).æµ‹è¯•ç±»</p>
<pre><code class="hljs language-scss" lang="scss">public static void <span class="hljs-selector-tag">main</span>(String[] args){
        Game game=new <span class="hljs-built_in">Game</span>();
        game<span class="hljs-selector-class">.paly</span>();
        CreateMemo createMemo=new <span class="hljs-built_in">CreateMemo</span>();
        createMemo<span class="hljs-selector-class">.setMemo</span>(game.createMemo());<span class="hljs-comment">//æ¸¸æˆå­˜æ¡£</span>
        game<span class="hljs-selector-class">.exit</span>();
        <span class="hljs-comment">//ç¬¬äºŒæ¬¡è¿›å…¥æ¸¸æˆ</span>
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("ç¬¬äºŒæ¬¡è¿›å…¥æ¸¸æˆ");
        Game secondGame=new <span class="hljs-built_in">Game</span>();
        secondGame<span class="hljs-selector-class">.setMemo</span>(createMemo.getMemo());<span class="hljs-comment">//å–å‡ºä¹‹å‰å¤‡å¿˜å½•ä¸­çš„æ•°æ®</span>
        secondGame<span class="hljs-selector-class">.paly</span>();
        secondGame<span class="hljs-selector-class">.exit</span>();
    }
</code></pre>
<h3 data-id="heading-23">12.åŸå‹æ¨¡å¼</h3>
<p>(1).åˆ›å»ºå…·ä½“åŸå‹ç±»
å®ç°Cloneableæ¥å£ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Card</span> <span class="hljs-title">implements</span> <span class="hljs-title">Cloneable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> num;<span class="hljs-comment">//å¡å·</span>
    <span class="hljs-keyword">private</span> Spec spec=<span class="hljs-keyword">new</span> Spec();
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Card</span>()</span>{
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Card æ‰§è¡Œæ„é€ å‡½æ•°"</span>);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">protected</span> Card <span class="hljs-title">clone</span>() throws CloneNotSupportedException</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"cloneæ—¶ä¸æ‰§è¡Œæ„é€ å‡½æ•°"</span>);
        Card card= (Card) super.clone();
        card.spec=spec.clone();<span class="hljs-comment">//å¯¹Spceå¯¹è±¡ä¹Ÿè°ƒç”¨clone,å®ç°æ·±æ‹·è´</span>
        <span class="hljs-keyword">return</span> card;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getNum</span>()</span> {
        <span class="hljs-keyword">return</span> num;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setNum</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> num</span>)</span> {
        <span class="hljs-keyword">this</span>.num = num;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Spec <span class="hljs-title">getSpec</span>()</span> {
        <span class="hljs-keyword">return</span> spec;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSpec</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> width,<span class="hljs-built_in">int</span>  length</span>)</span> {
        spec.width=width;
        spec.length=length;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Spec</span> <span class="hljs-title">implements</span> <span class="hljs-title">Cloneable</span>{
        <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> width;
        <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> length;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getWidth</span>()</span> {
            <span class="hljs-keyword">return</span> width;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setWidth</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> width</span>)</span> {
            <span class="hljs-keyword">this</span>.width = width;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getLength</span>()</span> {
            <span class="hljs-keyword">return</span> length;
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLength</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> length</span>)</span> {
            <span class="hljs-keyword">this</span>.length = length;
        }

        @Override
        <span class="hljs-function"><span class="hljs-keyword">protected</span> Spec <span class="hljs-title">clone</span>() throws CloneNotSupportedException</span> {
            <span class="hljs-keyword">return</span> (Spec) super.clone();
        }
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span>()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Card{"</span> +
                <span class="hljs-string">"num="</span> + num +
                <span class="hljs-string">", spec="</span> +<span class="hljs-string">"{width="</span>+spec.getWidth()+<span class="hljs-string">",length="</span>+spec.getLength()+
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p>(2).æµ‹è¯•ç±»</p>
<pre><code class="hljs language-scss" lang="scss"> public static void <span class="hljs-selector-tag">main</span>(String[] args) throws CloneNotSupportedException {
        Card card1=new <span class="hljs-built_in">Card</span>();
        card1<span class="hljs-selector-class">.setNum</span>(<span class="hljs-number">111</span>);
        card1<span class="hljs-selector-class">.setSpec</span>(<span class="hljs-number">66</span>,<span class="hljs-number">67</span>);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(card1.toString());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("---------------------");
        <span class="hljs-comment">//æ‹·è´</span>
        Card card2=card1<span class="hljs-selector-class">.clone</span>();
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(card2.toString());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("---------------------");
        <span class="hljs-comment">//æ‹·è´ä¹‹åï¼Œcard2å¯¹numè¿›è¡Œé‡æ–°èµ‹å€¼</span>
        card2<span class="hljs-selector-class">.setNum</span>(<span class="hljs-number">222</span>);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(card1.toString());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(card2.toString());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("---------------------");
        <span class="hljs-comment">//æ‹·è´ä¹‹åï¼Œcard2å¯¹Specè¿›è¡Œé‡æ–°èµ‹å€¼ä¹‹åï¼Œè¿card1ä¹Ÿè·Ÿç€æ”¹å˜äº†ï¼Œè¿™ç§å°±æ˜¯æµ…æ‹·è´</span>
        card2<span class="hljs-selector-class">.setSpec</span>(<span class="hljs-number">76</span>,<span class="hljs-number">77</span>);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(card1.toString());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(card2.toString());
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("---------------------");
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c95d2957990148c8a634e99328b0ce1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286353&amp;x-signature=yxF97%2Fb3xpcuojB7ivD3SCeijAs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-24">13.å‘½ä»¤æ¨¡å¼</h3>
<p>(1).åˆ›å»ºå‘½ä»¤æ¥å£Command</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Command</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span>()</span>;
}
</code></pre>
<p>(2).åˆ›å»ºå‘½ä»¤æ¥å£å®ç°ç±»ï¼šShutDownCommand</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ShutDownCommand</span> <span class="hljs-title">implements</span> <span class="hljs-title">Command</span> {
    Receiver receiver;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ShutDownCommand</span>(<span class="hljs-params">Receiver receiver</span>)</span> {
        <span class="hljs-keyword">this</span>.receiver = receiver;
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å‘½ä»¤è§’è‰²æ‰§è¡Œå…³æœºå‘½ä»¤"</span>);
        receiver.action();
    }
}
</code></pre>
<p>(3).åˆ›å»ºå‘½ä»¤æ‰§è¡Œè€…Receiver</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Receiver</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">action</span>()</span>{
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ¥æ”¶è€…æ‰§è¡Œå…·ä½“çš„æ“ä½œ"</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œå…³æœºå‘½ä»¤"</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"é€€å‡ºæ‰€æœ‰ç¨‹åº"</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å…³æœº..."</span>);
    }
}
</code></pre>
<p>(4).åˆ›å»ºè°ƒç”¨è€…Invoker</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Invoker</span> {
    <span class="hljs-keyword">private</span>  Command command;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Invoker</span>(<span class="hljs-params">Command command</span>)</span> {
        <span class="hljs-keyword">this</span>.command = command;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">action</span>()</span>{
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"è°ƒç”¨è€…æ‰§è¡Œå‘½ä»¤"</span>);
        command.execute();
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">public static void <span class="hljs-selector-tag">main</span>(String[] args){
       Receiver receiver=new <span class="hljs-built_in">Receiver</span>();<span class="hljs-comment">//åˆ›å»ºå‘½ä»¤æ¥æ”¶è€…</span>
       Command command=new <span class="hljs-built_in">ShutDownCommand</span>(receiver);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå‘½ä»¤çš„å…·ä½“å®ç°å¯¹è±¡ï¼Œå¹¶æŒ‡å®šå‘½ä»¤æ¥æ”¶è€…</span>
       Invoker invoke=new <span class="hljs-built_in">Invoker</span>(command);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå‘½ä»¤è°ƒç”¨è€…ï¼Œå¹¶æŒ‡å®šå…·ä½“å‘½ä»¤</span>
       invoke<span class="hljs-selector-class">.action</span>();
    }
</code></pre>
<h6 data-id="heading-25">æ³¨æ„ï¼šæ­¤å¤„è°ƒç”¨è€…ä¸æ¥å—è€…ä¹‹é—´çš„è§£è—•ã€‚æ˜“äºæ‰©å±•ï¼Œæ‰©å±•å‘½ä»¤åªéœ€æ–°å¢å…·ä½“å‘½ä»¤ç±»å³å¯ï¼Œç¬¦åˆå¼€æ”¾å°é—­åŸåˆ™ã€‚</h6>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12bf100cb904d14ad8f4353552453c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286353&amp;x-signature=qCyQ36co%2FNtwkdoYoH4GXCikDQU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-26">14.ä»£ç†æ¨¡å¼</h3>
<p>(1).é™æ€ä»£ç†
IBuyæ¥å£</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBuy</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">buy</span>()</span>;
}
</code></pre>
<p>IBuyæ¥å£å®ç°ç±»ï¼šHome,OverSea</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBuy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">buy</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"å›½å†…è¦ä¹°ä¸€ä¸ªåŒ…"</span>);
    }
}
</code></pre>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Oversea</span> <span class="hljs-title">implements</span> <span class="hljs-title">IBuy</span> {
    IBuy buyer;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Oversea</span>(<span class="hljs-params">IBuy buyer</span>)</span> {
        <span class="hljs-keyword">this</span>.buyer=buyer;
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">buy</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æˆ‘æ˜¯æµ·å¤–ä»£è´­"</span>);
        buyer.buy();
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span></span>{
        <span class="hljs-comment">//é™æ€ä»£ç†</span>
        IBuy home=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Home</span>();
        IBuy oversea=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Oversea</span>(home);
        oversea.<span class="hljs-built_in">buy</span>();
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"----------------------------------------"</span>);
        
    }

</code></pre>
<p>(2).åŠ¨æ€ä»£ç†(ä»£ç†ç±»åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆ)
åŠ¨æ€ä»£ç†ç±»ï¼šDynamicProxy</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Object</span> obj;<span class="hljs-comment">//è¢«ä»£ç†çš„å¯¹è±¡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DynamicProxy</span>(<span class="hljs-title class_">Object</span> obj) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">obj</span>=obj;
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-title class_">Object</span> proxy, <span class="hljs-title class_">Method</span> method, <span class="hljs-title class_">Object</span>[] args) throws <span class="hljs-title class_">Throwable</span> {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æµ·å¤–åŠ¨æ€ä»£ç†è°ƒç”¨æ–¹æ³•:"</span>+method.<span class="hljs-title function_">getName</span>());
        <span class="hljs-title class_">Object</span> result=method.<span class="hljs-title function_">invoke</span>(obj,args);
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">  public static void <span class="hljs-selector-tag">main</span>(String[] args){
        <span class="hljs-comment">//åŠ¨æ€ä»£ç†</span>
        IBuy home=new <span class="hljs-built_in">Home</span>();<span class="hljs-comment">//è¢«ä»£ç†ç±»</span>
        ClassLoader classLoader=demestics<span class="hljs-selector-class">.getClass</span>()<span class="hljs-selector-class">.getClassLoader</span>();<span class="hljs-comment">//è·å–classloader</span>
        Class<span class="hljs-selector-attr">[]</span> classes=new Class<span class="hljs-selector-attr">[]</span>{IBuy<span class="hljs-selector-class">.class</span>};<span class="hljs-comment">//æ¥å£ç±»çš„classæ•°ç»„</span>
        DynamicProxy dynamicProxy=new <span class="hljs-built_in">DynamicProxy</span>(home);<span class="hljs-comment">//åˆ›å»ºåŠ¨æ€ä»£ç†</span>
        IBuy oversea1= (IBuy) Proxy<span class="hljs-selector-class">.newProxyInstance</span>(classLoader,classes,dynamicProxy);
        oversea1<span class="hljs-selector-class">.buy</span>();<span class="hljs-comment">//è°ƒç”¨æµ·å¤–ä»£è´­çš„buy,æ­¤å¤„å®é™…ä¸Šæ˜¯è°ƒç”¨dynamicProxy.invoke()æ–¹æ³•</span>
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("----------------------------------------");

    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b828889f964f447ca84cb5b412f43a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286353&amp;x-signature=g4nH%2FOl8KbuBqST5yt8keSjgVOo%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ç¨‹æ± çš„ç±»å‹å’ŒåŸç†]]></title>    <link>https://juejin.cn/post/7600587732991655978</link>    <guid>https://juejin.cn/post/7600587732991655978</guid>    <pubDate>2026-01-29T10:22:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600587732991655978" data-draft-id="7600602502633357353" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ç¨‹æ± çš„ç±»å‹å’ŒåŸç†"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-29T10:22:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Asmewill"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938370557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ç¨‹æ± çš„ç±»å‹å’ŒåŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938370557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Asmewill
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:22:13.000Z" title="Thu Jan 29 2026 10:22:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flanseyitai1224%2Fp%2F7895652.html" target="_blank" title="https://www.cnblogs.com/lanseyitai1224/p/7895652.html" ref="nofollow noopener noreferrer">Javaçº¿ç¨‹æ± çš„å››ç§åˆ›å»ºæ–¹å¼ - ç»ä¸å¦¥åç»ä¸ä½å¤´ - åšå®¢å›­ (cnblogs.com)</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fdongguacai%2Fp%2F6030187.html" target="_blank" title="https://www.cnblogs.com/dongguacai/p/6030187.html" ref="nofollow noopener noreferrer">JAVAçº¿ç¨‹æ± åŸç†è¯¦è§£ä¸€ - å†¬ç“œè”¡ - åšå®¢å›­ (cnblogs.com)</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fstar95%2Fp%2F17714057.html" target="_blank" title="https://www.cnblogs.com/star95/p/17714057.html" ref="nofollow noopener noreferrer">æ·±åº¦è§£è¯»Javaçº¿ç¨‹æ± </a></p>
<h3 data-id="heading-0">1.çº¿ç¨‹æ± åˆ›å»ºä¹‹ä½¿ç”¨çº¿ç¨‹æ± å·¥å‚</h3>
<h5 data-id="heading-1">1.1.å®šé•¿çº¿ç¨‹æ± </h5>
<p>Executors.newFixedThreadPool(2)ï¼Œæ ¸å¿ƒçº¿ç¨‹å’Œçº¿ç¨‹æ€»æ•°ä¸€æ ·ï¼Œä½¿ç”¨LinkedBlockingQueueé˜Ÿåˆ—(é“¾è¡¨ï¼Œå®¹é‡Integer.Max)</p>
<pre><code class="hljs language-java" lang="java">       <span class="hljs-comment">//1.æ­¥éª¤ä¸€</span>
       ExecutorService newFixedThreadPool=Executors.newFixedThreadPool(<span class="hljs-number">2</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">4</span>;j++){
            <span class="hljs-keyword">final</span>  <span class="hljs-type">int</span> index=j;
            newFixedThreadPool.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>(index));
        }
       <span class="hljs-comment">//2.æ­¥éª¤äºŒ   LinkedBlockingQueueé˜Ÿåˆ—çš„å®¹é‡ä¸ºInteger.Max</span>
       <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> nThreads)</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(nThreads, nThreads,
                                      <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,
                                      <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());
      }
     <span class="hljs-comment">//3.æ­¥éª¤ä¸‰ Integer.MAX_VALUE</span>
     <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,
                              <span class="hljs-type">int</span> maximumPoolSize,
                              <span class="hljs-type">long</span> keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue)</span> {
        <span class="hljs-built_in">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,
             Executors.defaultThreadFactory(), defaultHandler);
    }
   <span class="hljs-comment">//4.æ­¥éª¤å››  defaultHandlerå®ç°äº†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RejectedExecutionHandler</span> <span class="hljs-variable">defaultHandler</span> <span class="hljs-operator">=</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortPolicy</span>();
   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbortPolicy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RejectedExecutionHandler</span> {
        <span class="hljs-comment">/**
         * Creates an {<span class="hljs-doctag">@code</span> AbortPolicy}.
         */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">AbortPolicy</span><span class="hljs-params">()</span> { }

        <span class="hljs-comment">/**
         * Always throws RejectedExecutionException.
         *
         * <span class="hljs-doctag">@param</span> r the runnable task requested to be executed
         * <span class="hljs-doctag">@param</span> e the executor attempting to execute this task
         * <span class="hljs-doctag">@throws</span> RejectedExecutionException always
         */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectedExecution</span><span class="hljs-params">(Runnable r, ThreadPoolExecutor e)</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RejectedExecutionException</span>(<span class="hljs-string">"Task "</span> + r.toString() +
                                                 <span class="hljs-string">" rejected from "</span> +
                                                 e.toString());
        }
    }
</code></pre>
<h5 data-id="heading-2">1.2.å‘¨æœŸæ€§ç¨‹æ± ï¼Œæ”¯æŒå‘¨æœŸæ€§æˆ–è€…å®šæ—¶ä»»åŠ¡ã€‚</h5>
<p>Executors.newScheduleThreadPool
æ ¸å¿ƒçº¿ç¨‹æ˜¯å›ºå®šçš„ï¼Œçº¿ç¨‹æ€»æ•°æ˜¯Integer.Max_valueï¼Œä½¿ç”¨DelayedWorkQueueé˜Ÿåˆ—ï¼ˆæœ€å°å †ï¼Œå®¹é‡16ï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//1.æ­¥éª¤ä¸€</span>
 ScheduledExecutorService newScheduleThreadPool= Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">0</span>;k&lt;<span class="hljs-number">4</span>;k++){
           <span class="hljs-keyword">final</span>  <span class="hljs-type">int</span> index=k;
            <span class="hljs-comment">//æ‰§è¡Œç»“æœï¼šå»¶è¿Ÿä¸‰ç§’ä¹‹åæ‰§è¡Œï¼Œé™¤äº†å»¶è¿Ÿæ‰§è¡Œä¹‹å¤–å’ŒnewFixedThreadPoolåŸºæœ¬ç›¸åŒ</span>
            newScheduleThreadPool.schedule(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>(index),<span class="hljs-number">3</span>, TimeUnit.SECONDS);
        }
  <span class="hljs-comment">// 2.æ­¥éª¤äºŒ</span>
   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ScheduledExecutorService <span class="hljs-title function_">newScheduledThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize);
    }
  <span class="hljs-comment">//3.æ­¥éª¤ä¸‰</span>
   <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScheduledThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> {
        <span class="hljs-built_in">super</span>(corePoolSize, Integer.MAX_VALUE,
              DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,
              <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedWorkQueue</span>());
    }
   <span class="hljs-comment">//æ­¥éª¤å››</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,
                              <span class="hljs-type">int</span> maximumPoolSize,
                              <span class="hljs-type">long</span> keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue)</span> {
        <span class="hljs-built_in">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,
             Executors.defaultThreadFactory(), defaultHandler);
    }


</code></pre>
<h5 data-id="heading-3">1.3.å¯ç¼“å­˜çº¿ç¨‹æ± </h5>
<p>Executors.newCachedThreadPool
æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º0ï¼Œçº¿ç¨‹æ€»æ•°ä¸ºInteger.Maxï¼Œä½¿ç”¨SynchronousQueueåŒæ­¥é˜Ÿåˆ—ï¼ˆåŒå‘é“¾è¡¨,å®¹é‡0ï¼‰
ç‰¹ç‚¹ï¼šSynchronousQueueæ²¡æœ‰å®¹é‡ï¼Œå¯ä»¥ç¡®ä¿ä»»åŠ¡ç«‹å³è¢«å¤„ç†ï¼Œè€Œä¸æ˜¯æ’é˜Ÿç­‰å¾…ã€‚</p>
<pre><code class="hljs language-java" lang="java">   <span class="hljs-comment">//1.æ­¥éª¤ä¸€</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">newCachedThreadPool</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> index=i;
            newCachedThreadPool.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>(index));
     }
 <span class="hljs-comment">//2.æ­¥éª¤äºŒ</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newCachedThreadPool</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">0</span>, Integer.MAX_VALUE,
                                      <span class="hljs-number">60L</span>, TimeUnit.SECONDS,
                                      <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;Runnable&gt;());
    }
<span class="hljs-comment">//3.æ­¥éª¤ä¸‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,
                              <span class="hljs-type">int</span> maximumPoolSize,
                              <span class="hljs-type">long</span> keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue)</span> {
        <span class="hljs-built_in">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,
             Executors.defaultThreadFactory(), defaultHandler);
    }
  
</code></pre>
<h5 data-id="heading-4">1.4.å•çº¿ç¨‹æ± </h5>
<p>Executors.newSingleThreadExecutor
æ ¸å¿ƒçº¿ç¨‹æ•°å’Œçº¿ç¨‹æ€»æ•°éƒ½æ˜¯1ï¼Œä½¿ç”¨çš„LinkedBlockingQueueé˜Ÿåˆ—ï¼ˆé“¾è¡¨å®ç°ï¼Œå®¹é‡é»˜è®¤Integer.Maxï¼‰</p>
<pre><code class="hljs language-csharp" lang="csharp">  <span class="hljs-comment">//1.æ­¥éª¤ä¸€</span>
  ExecutorService newSingleThreadExtutor=Executors.newSingleThreadExecutor();
        <span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> l=<span class="hljs-number">0</span>;l&lt;<span class="hljs-number">4</span>;l++){
            final <span class="hljs-built_in">int</span> index=l;
            <span class="hljs-comment">//æ‰§è¡Œç»“æœï¼šåªå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œé¡ºåºæ‰§è¡Œ</span>
            newSingleThreadExtutor.execute(<span class="hljs-keyword">new</span> MyRunnable(index));
  }
<span class="hljs-comment">//2.æ­¥éª¤äºŒ</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title">newSingleThreadExecutor</span>()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FinalizableDelegatedExecutorService
            (<span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,
                                    <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,
                                    <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));
    }
<span class="hljs-comment">//æ­¥éª¤ä¸‰</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> corePoolSize,
                              <span class="hljs-built_in">int</span> maximumPoolSize,
                              <span class="hljs-built_in">long</span> keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue</span>)</span> {
        <span class="hljs-keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,
             Executors.defaultThreadFactory(), defaultHandler);
    }


</code></pre>
<h3 data-id="heading-5">2.çº¿ç¨‹æ± åˆ›å»ºä¹‹ä½¿ç”¨ThreadPoolExecutoræ„é€ æ–¹æ³•è‡ªå®šä¹‰çº¿ç¨‹æ± </h3>
<ul>
<li>int corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°</li>
<li>int maximumPoolSize  çº¿ç¨‹æ€»æ•°</li>
<li>long keepAliveTime éæ ¸å¿ƒç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</li>
<li>TimeUnit  unit  éæ ¸å¿ƒç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´å•ä½</li>
<li>BlockingQueue workQueue ä»»åŠ¡é˜Ÿåˆ—</li>
<li>ThreadFactory çº¿ç¨‹å·¥å‚ç±» (å·¥å‚æ¨¡å¼çš„æ–¹å¼åˆ›å»ºçº¿ç¨‹)ï¼ˆæ¥å£ï¼Œå®ç°äº†newThreadæ–¹æ³•ï¼‰ã€é»˜è®¤å®ç°ã€‘</li>
<li>RejectedExecutionHandler æ‹’ç»ç­–ç•¥ (æ¥å£ï¼Œå®ç°äº†RejectedExecutionæ–¹æ³•) ã€é»˜è®¤å®ç°ã€‘
#####2.1.è‡ªå®šä¹‰çº¿ç¨‹æ± 
æ³¨æ„ï¼šå¦‚æœæƒ³è¦è‡ªå®šçº¿ç¨‹å·¥ç¨‹ï¼Œæˆ–è€…è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥éƒ½å¯ä»¥.</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">LinkedBlockingQueue  <span class="hljs-attr">queue</span>=new LinkedBlockingQueue()<span class="hljs-comment">;</span>
ThreadPoolExecutor   <span class="hljs-attr">theadPool</span>=new ThreadPoolExecutor(
2,4,10,
TimeUnit.SECONDS,queue,
Executors.defaultTheadFactory,
defaultHandler )<span class="hljs-comment">;</span>

</code></pre>
<h5 data-id="heading-6">2.2.ç³»ç»Ÿé»˜è®¤çš„çº¿ç¨‹å·¥å·¥å‚å’Œæ‹’ç»ç­–ç•¥</h5>
<p>//çº¿ç¨‹å·¥å‚ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºçº¿ç¨‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ThreadFactory</span> {
    Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span>;
}
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadFactory <span class="hljs-title function_">defaultThreadFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultThreadFactory</span>();
}
<span class="hljs-comment">//æ‹’ç»ç­–ç•¥ï¼Œé»˜è®¤ä¸ºæŠ›å‡ºå¼‚å¸¸</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RejectedExecutionHandler</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectedExecution</span><span class="hljs-params">(Runnable r, ThreadPoolExecutor executor)</span>;
}
 <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RejectedExecutionHandler</span> <span class="hljs-variable">defaultHandler</span> <span class="hljs-operator">=</span><span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortPolicy</span>();

</code></pre>
<h5 data-id="heading-7">2.3.é»˜è®¤çš„çº¿ç¨‹æ± å·¥å‚å®ç°ç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultThreadFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ThreadFactory</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">poolNumber</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ThreadGroup group;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">threadNumber</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String namePrefix;

        DefaultThreadFactory() {
            <span class="hljs-type">SecurityManager</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> System.getSecurityManager();
            group = (s != <span class="hljs-literal">null</span>) ? s.getThreadGroup() :
                                  Thread.currentThread().getThreadGroup();
            namePrefix = <span class="hljs-string">"pool-"</span> +
                          poolNumber.getAndIncrement() +
                         <span class="hljs-string">"-thread-"</span>;
        }

        <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> {
            <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(group, r,
                                  namePrefix + threadNumber.getAndIncrement(),
                                  <span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span> (t.isDaemon())
                t.setDaemon(<span class="hljs-literal">false</span>);
            <span class="hljs-keyword">if</span> (t.getPriority() != Thread.NORM_PRIORITY)
                t.setPriority(Thread.NORM_PRIORITY);
            <span class="hljs-keyword">return</span> t;
        }
    }
</code></pre>
<h5 data-id="heading-8">2.4.æ‹’ç»ç­–ç•¥ã€A-C-D-Dã€‘ ï¼ˆåœ¨é˜»å¡é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§å€¼ï¼Œè€Œä¸”çº¿ç¨‹æ•°ä¹Ÿè¾¾åˆ°æœ€å¤§å€¼äº†ï¼Œçº¿ç¨‹æ± æ— æ³•å†å¤„ç†æ–°æäº¤è¿‡æ¥çš„ä»»åŠ¡ï¼Œæ­¤æ—¶ä½¿ç”¨æ‹’ç»ç­–ç•¥ï¼‰</h5>
<ul>
<li>AbortPolicy   é»˜è®¤ç­–ç•¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢ä»»åŠ¡</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AbortPolicy</span> <span class="hljs-title">implements</span> <span class="hljs-title">RejectedExecutionHandler</span> {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbortPolicy</span>()</span> { }
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rejectedExecution</span>(<span class="hljs-params">Runnable r, ThreadPoolExecutor e</span>)</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RejectedExecutionException(<span class="hljs-string">"Task "</span> + r.toString() +
                                                 <span class="hljs-string">" rejected from "</span> +
                                                 e.toString());
        }
    }
</code></pre>
<ul>
<li>CallerRunsPolicy  æ˜¯ä½¿ç”¨å½“å‰æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CallerRunsPolicy</span> <span class="hljs-title">implements</span> <span class="hljs-title">RejectedExecutionHandler</span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CallerRunsPolicy</span>()</span>{ }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rejectedExecution</span>(<span class="hljs-params">Runnable r , ThreadPoolExecutor e</span>)</span>{
         <span class="hljs-keyword">if</span>(!e.shutdown()){
             r.run();<span class="hljs-comment">//å½“å‰æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</span>
        }
    }
}
</code></pre>
<ul>
<li>DiscardPolicy  ä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥ä¸¢å¼ƒä»»åŠ¡</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DiscardPolicy</span> <span class="hljs-title">implements</span> <span class="hljs-title">RejectExecutionHandler</span>{
       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DiscardPolicy</span>()</span>{}
       <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rejectExecution</span>(<span class="hljs-params">Runnable r, ThreadPoolExecutor e</span>)</span>{ <span class="hljs-comment">//do nothing</span>
       }
  }
</code></pre>
<ul>
<li>DiscardOldestPolicy ä¸¢å¼ƒæœ€å…ˆæ”¾å…¥é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œç„¶åå°†å½“å‰ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± </li>
</ul>

<pre><code class="hljs language-scss" lang="scss">public static class DiscardOldestPolicy implements RejectExecutionHandler{
       public <span class="hljs-built_in">DiscardOldestPolicy</span>(){}
       public void <span class="hljs-built_in">rejectExecution</span>(Runnable r, ThreadPoolExecutor e){
                 <span class="hljs-built_in">if</span>(!e.isShutdown()){
                     e<span class="hljs-selector-class">.getQueue</span>()<span class="hljs-selector-class">.poll</span>();
                     e<span class="hljs-selector-class">.execute</span>(r);
                  }
       }
}
</code></pre>
<h3 data-id="heading-9">3.çº¿ç¨‹æ± æºç è§£æ</h3>
<h5 data-id="heading-10">3.1.åˆ›å»ºçš„çº¿ç¨‹æ± å…·ä½“é…ç½®ä¸ºï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º5ä¸ªï¼›å…¨éƒ¨çº¿ç¨‹æ•°é‡ä¸º10ä¸ªï¼›å·¥ä½œé˜Ÿåˆ—çš„é•¿åº¦ä¸º5ã€‚</h5>
<h5 data-id="heading-11">3.2.æˆ‘ä»¬é€šè¿‡queue.size()çš„æ–¹æ³•æ¥è·å–å·¥ä½œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ•°ã€‚</h5>
<h5 data-id="heading-12">3.3.çº¿ç¨‹æ± åŸç†åˆ†æ.</h5>
<p>å½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹æ•°æ˜¯å¦&gt;=æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœå°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ä¸ªåï¼Œæ–°çš„ä»»åŠ¡è¿›æ¥åä¸å†åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè€Œæ˜¯å°†ä»»åŠ¡åŠ å…¥å·¥ä½œé˜Ÿåˆ—ï¼Œä»»åŠ¡é˜Ÿåˆ—åˆ°è¾¾ä¸Šçº¿5ä¸ªåï¼Œæ–°çš„ä»»åŠ¡åˆä¼šåˆ›å»ºæ–°çš„æ™®é€šçº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§çš„çº¿ç¨‹æ•°é‡10ä¸ªï¼Œåé¢çš„ä»»åŠ¡åˆ™æ ¹æ®é…ç½®çš„é¥±å’Œç­–ç•¥æ¥å¤„ç†ã€‚æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰å…·ä½“é…ç½®ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é…ç½®AbortPolicy:ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚å½“ç„¶ï¼Œä¸ºäº†è¾¾åˆ°æˆ‘éœ€è¦çš„æ•ˆæœï¼Œä¸Šè¿°çº¿ç¨‹å¤„ç†çš„ä»»åŠ¡éƒ½æ˜¯åˆ©ç”¨ä¼‘çœ å¯¼è‡´çº¿ç¨‹æ²¡æœ‰é‡Šæ”¾ï¼ï¼ï¼
#####3.4.çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹ä¼šè¢«å›æ”¶å—ï¼Ÿ
é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ˜¯ä¸ä¼šè¢«å›æ”¶çš„ï¼Œå³ä½¿ä»–ä»¬å¤„äºç©ºé—²çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥é¿å…é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹ï¼ŒèŠ‚çœç³»ç»Ÿå¼€é”€ã€‚å½“è®¾ç½®allowCoreThreadTimeCount(true)ï¼Œæ ¸å¿ƒçº¿ç¨‹åœ¨ç©ºé—²æ—¶è¶…è¿‡keepAliveTimeæ—¶ï¼Œä¼šè¢«å›æ”¶.</p>
<h5 data-id="heading-13">3.5.çº¿ç¨‹æ± æºç åˆ†æ</h5>
<h5 data-id="heading-14">3.5.1.æ ¸å¿ƒæ¥å£å’Œç±»</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/838db2c371e74480b7e1edb44dd6cc97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXNtZXdpbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770286933&amp;x-signature=O2YIYp3%2FYgHfEVh2sXFk%2Fxvw%2F6Y%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-15">Executor</h5>
<p>Executoræ¥å£åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªåŸºç¡€çš„executeæ–¹æ³•.</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Executor</span>{
     <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span>(<span class="hljs-params">Runnable</span>)</span>;
}
</code></pre>
<h5 data-id="heading-16">ExecutorService</h5>
<p>ExecutorServiceæ¥å£å®šä¹‰äº†çº¿ç¨‹æ± çš„ä¸€äº›å¸¸ç”¨æ“ä½œ.</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">ExecutorService</span> <span class="hljs-title">extends</span> <span class="hljs-title">Executor</span>{

     <span class="hljs-comment">// ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä¼šå°†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆ</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">shutdown</span>()</span>;
    <span class="hljs-comment">//ç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ä¸åœ¨æ‰§è¡Œï¼Œè¿”å›æœªæ‰§è¡Œä»»åŠ¡é›†åˆ.</span>
    <span class="hljs-function">List&lt;Runnable&gt; <span class="hljs-title">shutdownNow</span>()</span>;
   <span class="hljs-comment">//åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦åœæ‰ï¼Œåªè¦çº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ï¼Œéƒ½ä¼šè¿”å›true</span>
   <span class="hljs-function">boolean <span class="hljs-title">isShutdown</span>()</span>;
   <span class="hljs-comment">//åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦å®Œæˆç»ˆæ­¢ï¼ŒçŠ¶æ€æ˜¯TERMINATED</span>
   <span class="hljs-function">boolean <span class="hljs-title">isTerminated</span>()</span>;
  <span class="hljs-comment">//æäº¤Runnableä»»åŠ¡ï¼Œè¿”å›Future,Futureçš„getæ–¹æ³•è¿”å›å€¼å°±æ˜¯resultå‚æ•°.//getæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹</span>
  &lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span>(<span class="hljs-params">Runnable task,T result</span>)</span>;
 <span class="hljs-comment">//æäº¤Rennableä»»åŠ¡ï¼Œè¿”å›Future,Futureçš„getæ–¹æ³•è¿”å›å€¼å°±æ˜¯null.//getæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹</span>
  Future&lt;?&gt; submit(Runnable task);

}
</code></pre>
<h5 data-id="heading-17">AbstractExecutorService</h5>
<p>AbstractExecutorServiceæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°äº†æ¥å£çš„ä¸€äº›æ–¹æ³•ï¼Œæœªå®ç°çš„æ–¹æ³•ç»§ç»­ç•™ç»™å­ç±»å®ç°.</p>
<pre><code class="hljs language-scss" lang="scss">public abstract class AbstractExecutorService implement  ExecutorService{
         <span class="hljs-comment">//æäº¤Runnalbeä»»åŠ¡ï¼Œè¿”å›Future,Futureçš„getæ–¹æ³•è¿”å›å€¼æ˜¯null//getæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹</span>
        public Future&lt;?&gt; <span class="hljs-built_in">submit</span>(Runnable task) {
                if (task == null) {
                    throw new <span class="hljs-built_in">NullPointerException</span>();
               }
              RunnableFuture&lt;Void&gt; ftask = <span class="hljs-built_in">newTaskFor</span>(task, null);
              <span class="hljs-built_in">execute</span>(ftask);<span class="hljs-comment">//çœŸæ­£æ‰§è¡Œä»»åŠ¡çš„æ˜¯å­ç±»å®ç°çš„executeæ–¹æ³•</span>
              return ftask;
       }
       <span class="hljs-comment">//æäº¤Runnableä»»åŠ¡ï¼Œè¿”å›Futureï¼ŒFutureçš„getæ–¹æ³•è¿”å›å€¼æ˜¯resultå‚æ•°.//getæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹</span>
      public &lt;T&gt; Future&lt;T&gt; <span class="hljs-built_in">submit</span>(Runnable task, T result) {
           if (task == null) throw new <span class="hljs-built_in">NullPointerException</span>();
           RunnableFuture&lt;T&gt; ftask = <span class="hljs-built_in">newTaskFor</span>(task, result);
           <span class="hljs-built_in">execute</span>(ftask);<span class="hljs-comment">//çœŸæ­£æ‰§è¡Œä»»åŠ¡çš„æ˜¯å­ç±»å®ç°çš„executeæ–¹æ³•</span>
           return ftask;
      }
 
}
</code></pre>
<h5 data-id="heading-18">ä»»åŠ¡æ‰§è¡Œ</h5>
<pre><code class="hljs language-scss" lang="scss">public class ThreadPoolExecutor extends AbstractExecutorService {
      public void <span class="hljs-built_in">execute</span>(Runnable command) {
        if (command == null)
            throw new <span class="hljs-built_in">NullPointerException</span>();
   
        int c = ctl<span class="hljs-selector-class">.get</span>();
      <span class="hljs-comment">//1.åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ•°æ˜¯å¦æ ¸å¿ƒçº¿ç¨‹æ•°</span>
        if (workerCountOf(c) &lt; corePoolSize) {
            <span class="hljs-comment">//2.æ·»åŠ å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span>
            if (addWorker(command, true))
                return;
            c = ctl<span class="hljs-selector-class">.get</span>();
        }
         <span class="hljs-comment">//3.çº¿ç¨‹æ± ä¸ºRunningçŠ¶æ€ä¸”ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—æˆåŠŸ</span>
        if (isRunning(c) &amp;&amp; workQueue<span class="hljs-selector-class">.offer</span>(command)) {
            int recheck = ctl<span class="hljs-selector-class">.get</span>();
            if (! isRunning(recheck) &amp;&amp; <span class="hljs-built_in">remove</span>(command))
                <span class="hljs-built_in">reject</span>(command);
            else if (workerCountOf(recheck) == <span class="hljs-number">0</span>)
                <span class="hljs-built_in">addWorker</span>(null, false);<span class="hljs-comment">//æ·»åŠ å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span>
        }
        <span class="hljs-comment">//4.é˜Ÿåˆ—æ»¡äº†ï¼Œè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ä¹‹åï¼Œå°±ä¼šèµ°æ‹’ç»ç­–ç•¥ï¼ŒaddWorker()è¿”å›å€¼å°±æ˜¯false</span>
        else if (!addWorker(command, false))
            <span class="hljs-built_in">reject</span>(command);
    }
}
</code></pre>
<h5 data-id="heading-19">æ·»åŠ å·¥ä½œçº¿ç¨‹</h5>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼šè®¾ç½®ctlçš„çº¿ç¨‹æ•°+1ï¼Œä¸»è¦æ˜¯åˆ¤æ–­çº¿ç¨‹æ± çŠ¶æ€ä»¥åŠçº¿ç¨‹æ•°æ˜¯å¦è¶…é™ï¼Œç„¶åå¯¹ctrlçš„çº¿ç¨‹æ•°åŠ 1ã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨æ‰§è¡Œï¼Œå°†åˆ›å»ºçš„å·¥ä½œçº¿ç¨‹ç±»Workeræ”¾å…¥çº¿ç¨‹æ± å·¥ä½œçº¿ç¨‹é›†åˆé‡Œå¹¶å¯åŠ¨ï¼Œå¦å¤–ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸æƒ…å†µï¼Œå°±èµ°finally{}ï¼Œç§»é™¤å·¥ä½œçº¿ç¨‹Workerï¼Œå¹¶æ‰§è¡Œctlçš„çº¿ç¨‹æ•°å‡1.</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"> private final HashSet&lt;Worker&gt; <span class="hljs-attr">workers</span> = new HashSet&lt;&gt;()<span class="hljs-comment">; //çº¿ç¨‹æ± å·¥ä½œçº¿ç¨‹é›†åˆ</span>
private boolean addWorker(Runnable firstTask, boolean core) {
        retry:
        for (int <span class="hljs-attr">c</span> = ctl.get()<span class="hljs-comment">;;) {</span>
  
            for (<span class="hljs-comment">;;) {</span>
                //å¦‚æœæ˜¯æ ¸å¿ƒçº¿ç¨‹ ï¼Œçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æ€»æ•°&gt;=corePoolSizeï¼Œè¿”å›false
              //å¦‚æœæ˜¯éæ ¸å¿ƒçº¿ç¨‹ ï¼Œçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æ€»æ•°&gt;=maximumPoolSizeï¼Œè¿”å›false
                if (workerCountOf(c)&gt;= ((core ? corePoolSize : maximumPoolSize) &amp; COUNT_MASK))
                    return false<span class="hljs-comment">;</span>
                //è®¾ç½®ctlçš„çº¿ç¨‹æ•°+1ï¼Œè·³å‡ºæ•´ä¸ªforå¾ªç¯
                if (compareAndIncrementWorkerCount(c))
                    break retry<span class="hljs-comment">; //è·³å‡ºretry  forå¾ªç¯</span>
            }
        }
       //ä»¥ä¸Šåªæ˜¯å°†ctlçš„çº¿ç¨‹æ•°+1äº†ï¼Œä»¥ä¸‹æ˜¯çœŸæ­£çš„åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹
        boolean <span class="hljs-attr">workerStarted</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
        boolean <span class="hljs-attr">workerAdded</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
        Worker <span class="hljs-attr">w</span> = null<span class="hljs-comment">;</span>
        try {
           //Workeræ„é€ æ–¹æ³•ä¸­ä¼šä½¿ç”¨ThreadFactoryåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹
            <span class="hljs-attr">w</span> = new Worker(firstTask)<span class="hljs-comment">; </span>
            final Thread <span class="hljs-attr">t</span> = w.thread<span class="hljs-comment">;</span>
            if (t != null) {
                // åˆ›å»ºå·¥ä½œçº¿ç¨‹æ—¶ï¼Œéœ€è¦åŠ é”ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹å¹¶å‘æ“ä½œã€‚
                final ReentrantLock <span class="hljs-attr">mainLock</span> = this.mainLock<span class="hljs-comment">;</span>
                mainLock.lock()<span class="hljs-comment">;</span>
                try {
                    int <span class="hljs-attr">c</span> = ctl.get()<span class="hljs-comment">;</span>
                    if (isRunning(c) ||
                        (runStateLessThan(c, STOP) &amp;&amp; <span class="hljs-attr">firstTask</span> == null)) {
                        if (t.getState() != Thread.State.NEW)
                            throw new IllegalThreadStateException()<span class="hljs-comment">;</span>
                        workers.add(w)<span class="hljs-comment">; //å¹¶å°†Workeræ”¾å…¥å·¥ä½œçº¿ç¨‹é›†åˆé‡Œ</span>
                        <span class="hljs-attr">workerAdded</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
                        int <span class="hljs-attr">s</span> = workers.size()<span class="hljs-comment">;</span>
                       // è¿™é‡Œå°±æ˜¯æ ‡è®°çº¿ç¨‹æ± é‡Œåˆ›å»ºçº¿ç¨‹çš„æœ€å¤§å€¼ï¼Œè¿™ä¸ªå€¼æœ€å¤§ä¹Ÿä¸ä¼šè¶…è¿‡maximumPoolSizeã€‚
                        if (s &gt; largestPoolSize)
                            <span class="hljs-attr">largestPoolSize</span> = s<span class="hljs-comment">;</span>
                    }
                } finally {
                    mainLock.unlock()<span class="hljs-comment">;//é‡Šæ”¾é”</span>
                }
                if (workerAdded) {
                    t.start()<span class="hljs-comment">; //å¯åŠ¨å·¥ä½œçº¿ç¨‹&gt;&gt;Worker.run()&gt;&gt;runWorker()&gt;&gt;firstTask.run()</span>
                    <span class="hljs-attr">workerStarted</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
                }
            }
        } finally {
            if (! workerStarted)
                addWorkerFailed(w)<span class="hljs-comment">;</span>
        }
        return workerStarted<span class="hljs-comment">;</span>
 }

//å¦‚æœæ·»åŠ å­çº¿ç¨‹å·¥ä½œæµç¨‹å¤±è´¥ï¼Œ
private void addWorkerFailed(Worker w) {
    final ReentrantLock <span class="hljs-attr">mainLock</span> = this.mainLock<span class="hljs-comment">;</span>
	// æ¶‰åŠå·¥ä½œçº¿ç¨‹çš„ç›¸å…³æ“ä½œéƒ½éœ€è¦åŠ é”
    mainLock.lock()<span class="hljs-comment">;</span>
    try {
        // ä»å·¥ä½œçº¿ç¨‹é›†åˆé‡Œç§»é™¤worker
        if (w != null)
            workers.remove(w)<span class="hljs-comment">;</span>
        // casæ“ä½œctlçº¿ç¨‹æ•°å‡1
        decrementWorkerCount()<span class="hljs-comment">;</span>
        // åˆ¤æ–­æ˜¯å¦éœ€è¦ç»ˆæ­¢çº¿ç¨‹æ± 
        tryTerminate()<span class="hljs-comment">;</span>
    } finally {
        mainLock.unlock()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h5 data-id="heading-20">å·¥ä½œçº¿ç¨‹ç±»Worker</h5>
<p>Workerç±»æ˜¯å…·ä½“çš„å·¥ä½œçº¿ç¨‹ç±»ï¼ŒæŒæœ‰ä¸€ä¸ªThreadçº¿ç¨‹å’Œä¸€ä¸ªRunnableä»»åŠ¡å®ä¾‹ï¼Œå¹¶å®ç°äº†Runnableæ¥å£.</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> <span class="hljs-title">implements</span> <span class="hljs-title">Runnable</span> </span>{
   <span class="hljs-comment">// Workerçš„Threadå±æ€§ï¼Œå…¶å®å¹²æ´»çš„å°±æ˜¯è¿™ä¸ªçº¿ç¨‹</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> thread;
    <span class="hljs-comment">// ä»»åŠ¡</span>
    <span class="hljs-type">Runnable</span> firstTask;
    <span class="hljs-comment">// çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡æ€»æ•°</span>
    volatile long completedTasks;
	
   <span class="hljs-comment">// æ„é€ æ–¹æ³•</span>
    <span class="hljs-type">Worker</span>(<span class="hljs-type">Runnable</span> firstTask) {
        setState(<span class="hljs-number">-1</span>); <span class="hljs-comment">// inhibit interrupts until runWorker</span>
        <span class="hljs-keyword">this</span>.firstTask = firstTask;
        <span class="hljs-comment">// çº¿ç¨‹æ‰§è¡Œæ—¶è°ƒç”¨çš„å°±æ˜¯Worker.run() &gt;&gt;runWorker()&gt;&gt;firstTask.run()</span>
         <span class="hljs-comment">//ä½¿ç”¨çº¿ç¨‹å·¥ç¨‹æ‰¹é‡åˆ›å»ºçº¿ç¨‹.</span>
        <span class="hljs-keyword">this</span>.thread = getThreadFactory().newThread(<span class="hljs-keyword">this</span>);
    }
    <span class="hljs-comment">// runæ–¹æ³•æ‰§è¡Œä»»åŠ¡ï¼Œè°ƒç”¨çš„æ˜¯å¤–éƒ¨ThreadPoolExecutorçš„runWorkeræ–¹æ³•</span>
    public void run() {
        runWorker(<span class="hljs-keyword">this</span>);
    }
}
</code></pre>
<h5 data-id="heading-21">æ‰§è¡Œä»»åŠ¡runWorker</h5>
<pre><code class="hljs language-ini" lang="ini">  final void runWorker(Worker w) {
        Thread <span class="hljs-attr">wt</span> = Thread.currentThread()<span class="hljs-comment">;</span>
        Runnable <span class="hljs-attr">task</span> = w.firstTask<span class="hljs-comment">;</span>
        <span class="hljs-attr">w.firstTask</span> = null<span class="hljs-comment">;</span>
        w.unlock()<span class="hljs-comment">; // allow interrupts</span>
        boolean <span class="hljs-attr">completedAbruptly</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
        try {
            while (task != null || (<span class="hljs-attr">task</span> = getTask()) != null) {
                w.lock()<span class="hljs-comment">;</span>
                if ((runStateAtLeast(ctl.get(), STOP) ||
                     (Thread.interrupted() &amp;&amp;
                      runStateAtLeast(ctl.get(), STOP))) &amp;&amp;
                    !wt.isInterrupted())
                    wt.interrupt()<span class="hljs-comment">;</span>
                try {
                    beforeExecute(wt, task)<span class="hljs-comment">;</span>
                    try {
                        task.run()<span class="hljs-comment">; //æ‰§è¡Œä»»åŠ¡</span>
                        afterExecute(task, null)<span class="hljs-comment">;</span>
                    } catch (Throwable ex) {
                        afterExecute(task, ex)<span class="hljs-comment">;</span>
                        throw ex<span class="hljs-comment">;</span>
                    }
                } finally {
                    <span class="hljs-attr">task</span> = null<span class="hljs-comment">;</span>
                    w.completedTasks++<span class="hljs-comment">;</span>
                    w.unlock()<span class="hljs-comment">;</span>
                }
            }
            <span class="hljs-attr">completedAbruptly</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
        } finally {
            processWorkerExit(w, completedAbruptly)<span class="hljs-comment">;</span>
        }
    }

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC æƒé™ç³»ç»Ÿå®æˆ˜ï¼ˆä¸€ï¼‰ï¼šé¡µé¢çº§è®¿é—®æ§åˆ¶å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7600600904094842914</link>    <guid>https://juejin.cn/post/7600600904094842914</guid>    <pubDate>2026-01-29T10:56:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600600904094842914" data-draft-id="7600600904094826530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC æƒé™ç³»ç»Ÿå®æˆ˜ï¼ˆä¸€ï¼‰ï¼šé¡µé¢çº§è®¿é—®æ§åˆ¶å…¨è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-29T10:56:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åäº”ä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/343495027727229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC æƒé™ç³»ç»Ÿå®æˆ˜ï¼ˆä¸€ï¼‰ï¼šé¡µé¢çº§è®¿é—®æ§åˆ¶å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/343495027727229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åäº”ä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T10:56:23.000Z" title="Thu Jan 29 2026 10:56:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è§£ RBAC æƒé™æ–¹æ¡ˆåœ¨ä¸­åå°ç®¡ç†ç³»ç»Ÿçš„å®ç°</p>
<p>åœ¨å…¬å¸å†…éƒ¨å†™è¿‡å¥½å‡ ä¸ªåå°ç³»ç»Ÿï¼Œéƒ½éœ€è¦å®ç°æƒé™æ§åˆ¶ï¼Œåœ¨èŒæ—¶å·¥ä½œç¹å¤šï¼Œæ²¡æœ‰ç³»ç»Ÿæ€§çš„æ¥æ€»ç»“ä¸€ä¸‹ç›¸å…³ç»éªŒï¼Œç°åœ¨äººå·²ç¦»èŒï¼Œå°±æŠŠè‡ªå·±çš„ç»éªŒæ€»ç»“ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ </p>
<blockquote>
<p>æœ¬æ–‡æ˜¯<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog%3Ftab%3Dreadme-ov-file%23%25E9%2580%259A%25E4%25BF%2597%25E6%2598%2593%25E6%2587%2582%25E7%259A%2584%25E4%25B8%25AD%25E5%2590%258E%25E5%258F%25B0%25E7%25B3%25BB%25E7%25BB%259F%25E5%25BB%25BA%25E8%25AE%25BE%25E6%258C%2587%25E5%258D%2597%25E4%25B8%2593%25E6%25A0%258F" target="_blank" title="https://github.com/bryqiu/Blog?tab=readme-ov-file#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%B8%AD%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E5%BB%BA%E8%AE%BE%E6%8C%87%E5%8D%97%E4%B8%93%E6%A0%8F" ref="nofollow noopener noreferrer">ã€Šé€šä¿—æ˜“æ‡‚çš„ä¸­åå°ç³»ç»Ÿå»ºè®¾æŒ‡å—ã€‹</a>ç³»åˆ—çš„ç¬¬ä¹ç¯‡æ–‡ç« ï¼Œè¯¥ç³»åˆ—æ—¨åœ¨å‘Šè¯‰ä½ å¦‚ä½•æ¥æ„å»ºä¸€ä¸ªä¼˜ç§€çš„ä¸­åå°ç®¡ç†ç³»ç»Ÿ</p>
</blockquote>
<h2 data-id="heading-1">æƒé™æ¨¡å‹æœ‰å“ªäº›ï¼Ÿ</h2>
<p>ä¸»æµçš„æƒé™æ¨¡å‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ç§ï¼š</p>
<ul>
<li>ACLæ¨¡å‹ï¼šè®¿é—®æ§åˆ¶åˆ—è¡¨</li>
<li>DACæ¨¡å‹ï¼šè‡ªä¸»è®¿é—®æ§åˆ¶</li>
<li>MACæ¨¡å‹ï¼šå¼ºåˆ¶è®¿é—®æ§åˆ¶</li>
<li>ABACæ¨¡å‹ï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶</li>
<li>RBACæ¨¡å‹ï¼šåŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶</li>
</ul>
<p>è¿™é‡Œä¸ä»‹ç»å…¨éƒ¨çš„æƒé™æ¨¡å‹ï¼Œæœ‰å…´è¶£ä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/7121977695197970463" target="_blank" title="https://juejin.cn/post/7121977695197970463">æƒé™ç³»ç»Ÿå°±è¯¥è¿™ä¹ˆè®¾è®¡ï¼Œyyds</a></p>
<p>å¦‚æœä½ çœ‹è¿‡ã€ç”¨è¿‡å¸‚é¢ä¸Šä¸€äº›å¼€æºåå°ç³»ç»ŸåŠæƒé™è®¾è®¡ï¼Œä½ ä¼šå‘ç°å®ƒä»¬ä¸»è¦éƒ½æ˜¯åŸºäº RBAC æ¨¡å‹æ¥å®ç°çš„</p>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆæ˜¯ RBAC æƒé™æ¨¡å‹ï¼Ÿ</h2>
<p>å¥½é—®é¢˜ï¼æˆ‘å¸®ä½ é—®äº†ä¸‹ AI</p>



































<table><thead><tr><th align="left">å¯¹æ¯”ç»´åº¦</th><th align="left">ACL (è®¿é—®æ§åˆ¶åˆ—è¡¨)</th><th align="left">RBAC (åŸºäºè§’è‰²)</th><th align="left">ABAC (åŸºäºå±æ€§)</th></tr></thead><tbody><tr><td align="left"><strong>æ ¸å¿ƒé€»è¾‘</strong></td><td align="left"><strong>ç”¨æˆ· â†” æƒé™</strong><br/>ç›´æ¥ç‚¹å¯¹ç‚¹ç»‘å®šï¼Œæ— ä¸­é—´å±‚</td><td align="left"><strong>ç”¨æˆ· â†” è§’è‰² â†” æƒé™</strong><br/>å¼•å…¥â€œè§’è‰²â€è§£è€¦ï¼Œæƒé™å½’äºè§’è‰²</td><td align="left"><strong>å±æ€§ + è§„åˆ™ = æƒé™</strong><br/>åŠ¨æ€è®¡ç®— (Who, When, Where)</td></tr><tr><td align="left"><strong>ä¼˜ç‚¹</strong></td><td align="left">æ¨¡å‹æç®€ï¼Œå¼€å‘é€Ÿåº¦å¿«ï¼Œé€‚åˆåˆæœŸ MVP</td><td align="left">ç»“æ„æ¸…æ™°ï¼Œ<strong>å¤ç”¨æ€§é«˜</strong>ï¼Œç¬¦åˆä¼ä¸šç»„ç»‡æ¶æ„ï¼Œç»´æŠ¤æˆæœ¬ä½</td><td align="left">æåº¦çµæ´»ï¼Œæ”¯æŒç»†ç²’åº¦æ§åˆ¶<br/>(å¦‚ï¼šåªèƒ½åœ¨å·¥ä½œæ—¥è®¿é—®)</td></tr><tr><td align="left"><strong>ç¼ºç‚¹</strong></td><td align="left">ç”¨æˆ·é‡å¤§æ—¶ç»´æŠ¤å·¥ä½œå‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œææ˜“å‡ºé”™</td><td align="left"><strong>è§’è‰²çˆ†ç‚¸</strong>ï¼šè‹¥ç‰¹ä¾‹è¿‡å¤šï¼Œå¯èƒ½å¯¼è‡´å®šä¹‰æˆç™¾ä¸Šåƒä¸ªè§’è‰²</td><td align="left">å¼€å‘å¤æ‚åº¦æé«˜ï¼Œè§„åˆ™å¼•æ“éš¾è®¾è®¡ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½æ¶ˆè€—</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">ä¸ªäººåšå®¢ã€å°å‹å†…éƒ¨å·¥å…·</td><td align="left"><strong>ä¸­å¤§å‹åå°ç³»ç»Ÿã€SaaS å¹³å° (è¡Œä¸šæ ‡å‡†)</strong></td><td align="left">é“¶è¡Œé£æ§ã€AWS IAMã€å›½å®¶å®‰å…¨çº§ç³»ç»Ÿ</td></tr></tbody></table>
<p>æ€»ç»“æ¥è¯´ï¼Œåœ¨åå°ç³»ç»Ÿçš„åœºæ™¯ä¸‹ï¼ŒRBAC æ¨¡å‹åœ¨çµæ´»æ€§ï¼ˆå¯¹æ¯”ACLï¼‰å’Œå¤æ‚æ€§ï¼ˆå¯¹æ¯”ABACï¼‰ä¸Šå–å¾—äº†ä¸€ä¸ªå¾ˆå¥½çš„å¹³è¡¡</p>
<h2 data-id="heading-3">RBAC æ¦‚å¿µç†è§£</h2>
<p>RBAC æƒé™æ¨¡å‹ï¼Œå…¨ç§° Role-Based Access Controlï¼ŒåŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶</p>
<p>æ¨¡å‹æœ‰ä¸‰è¦ç´ ï¼š</p>
<ul>
<li>ç”¨æˆ·ï¼ˆUserï¼‰ï¼šç³»ç»Ÿä¸»ä½“ï¼Œå³æ“ä½œç³»ç»Ÿçš„å…·ä½“äººå‘˜æˆ–è´¦å·</li>
<li>è§’è‰²ï¼ˆRoleï¼‰ï¼šè§’è‰²æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œä»£è¡¨äº†ç”¨æˆ·åœ¨ç»„ç»‡ä¸­çš„èŒèƒ½æˆ–èº«ä»½</li>
<li>æƒé™ï¼ˆPermissionï¼‰ï¼šç”¨æˆ·å¯ä»¥å¯¹ç³»ç»Ÿèµ„æºè¿›è¡Œçš„è®¿é—®æˆ–æ“ä½œèƒ½åŠ›</li>
</ul>
<p>RBAC çš„è®¾è®¡æ˜¯å°†è§’è‰²ç»‘å®šæƒé™ï¼Œç”¨æˆ·ç»‘å®šè§’è‰²ï¼Œä»è€Œå®ç°æƒé™æ§åˆ¶</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/477cc8185d0244aaa6a073d8313920c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=6fTTIUFMJOrZGOxj7nfS%2BhqLnJg%3D" alt="image.png" loading="lazy"/></p>
<p>å¹¶ä¸”ï¼Œå®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»é€šå¸¸æ˜¯å¤šå¯¹å¤šçš„ï¼š</p>
<p><strong>ç”¨æˆ· - è§’è‰² (User-Role)ï¼š</strong> ä¸€ä¸ªç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼ˆä¾‹å¦‚ï¼šæŸäººæ—¢æ˜¯â€œé¡¹ç›®ç»ç†â€åˆæ˜¯â€œæŠ€æœ¯å§”å‘˜ä¼šæˆå‘˜â€ï¼‰</p>
<p><strong>è§’è‰² - æƒé™(Role-Permission)ï¼š</strong> ä¸€ä¸ªè§’è‰²åŒ…å«å¤šä¸ªæƒé™ï¼ˆä¾‹å¦‚ï¼šâ€œäººäº‹ç»ç†â€è§’è‰²æ‹¥æœ‰â€œæŸ¥çœ‹å‘˜å·¥â€ã€â€œç¼–è¾‘è–ªèµ„â€ç­‰æƒé™ï¼‰</p>
<h2 data-id="heading-4">ä¸»å¯¼æƒé™æ§åˆ¶çš„å‰ç«¯ã€åç«¯æ–¹æ¡ˆ</h2>
<p>å¸‚é¢ä¸Šè¿™äº›å¼€æº Admin çš„æƒé™æ§åˆ¶ä¸­ï¼Œå­˜åœ¨ä¸¤ç§ä¸»è¦çš„æƒé™ä¸»å¯¼æ–¹æ¡ˆï¼šå‰ç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆå’Œåç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆ</p>
<h3 data-id="heading-5">å‰ç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆ</h3>
<p>å‰ç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆï¼Œä¸€ä¸ªä¸»è¦çš„ç‰¹å¾æ˜¯èœå•æ•°æ®ç”±å‰ç«¯ç»´æŠ¤ï¼Œè€Œä¸æ˜¯å­˜åœ¨æ•°æ®åº“ä¸­</p>
<p>åç«¯åªéœ€è¦åœ¨ç™»å½•åç»™åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯ä¸­ä¼šåŒ…å«ç”¨æˆ·çš„è§’è‰²ï¼Œæ ¹æ®è¿™ä¸ªè§’è‰²ä¿¡æ¯ï¼Œå‰ç«¯å¯ä»¥ç­›é€‰å‡ºå…·æœ‰æƒé™çš„èœå•ã€æŒ‰é’®</p>
<p>è¿™ç§æ–¹æ¡ˆçš„ä¸»è¦é€»è¾‘æ”¾åœ¨å‰ç«¯ï¼Œè€Œä¸æ˜¯åç«¯æ•°æ®åº“ï¼Œæ‰€ä»¥å®‰å…¨æ€§æ²¡ä¿éšœï¼Œçµæ´»æ€§ä¹Ÿè¾ƒå·®ï¼Œè¦æ›´æ–°æƒé™ï¼Œå°±éœ€è¦æ”¹åŠ¨å‰ç«¯ä»£ç å¹¶é‡æ–°æ‰“åŒ…ä¸Šçº¿ï¼Œæ— æ³•æ”¯æŒâ€œåŠ¨æ€é…ç½®æƒé™â€</p>
<p>é€‚åˆä¸€äº›å°å‹ã€ç®€å•ç³»ç»Ÿ</p>
<h3 data-id="heading-6">åç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆ</h3>
<p>åç«¯æ§åˆ¶æ–¹æ¡ˆï¼Œå³ç™»å½•ååœ¨è¿”å›ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œè¿˜ä¼šç»™åˆ°æ­¤ç”¨æˆ·å¯¹åº”çš„èœå•æ•°æ®å’ŒæŒ‰é’®æƒé™ç ç­‰</p>
<p>èœå•æ•°æ®ã€æŒ‰é’®æƒé™ç ç­‰éƒ½å­˜åœ¨æ•°æ®åº“ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå®‰å…¨æ€§ã€çµæ´»æ€§æ›´é«˜ï¼Œè¦æ›´æ–°æƒé™æ•°æ®æˆ–ç”¨æˆ·æƒé™æ§åˆ¶ï¼Œæä¾›ç›¸åº”æ¥å£å³å¯ä¿®æ”¹</p>
<blockquote>
<p>å€’ä¹Ÿä¸æ˜¯è¯´å‰ç«¯å®Œå…¨ä¸ç”¨ç®¡èœå•æ•°æ®ï¼Œè€Œæ˜¯å‰ç«¯åªéœ€è¦ç»´æŠ¤ä¸€äº›é™æ€èœå•æ•°æ®ï¼Œæ¯”å¦‚ç™»å½•é¡µã€å¼‚å¸¸é¡µ(404ã€403...)</p>
</blockquote>
<p>åœ¨ä¼ä¸šçº§åå°ç³»ç»Ÿä¸­ï¼Œåç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œæœ¬æ–‡åªä»‹ç»åç«¯ä¸»å¯¼çš„æƒé™æ–¹æ¡ˆ</p>
<h2 data-id="heading-7">æƒé™æ–¹æ¡ˆæ•´ä½“æµç¨‹</h2>
<p>åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œè¦æ¸…æ™°çŸ¥é“æ•´ä½“å®ç°æµç¨‹ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾æ¥ç›´è§‚å±•ç¤ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24d25fc5a24b446eb3b46d1109e688ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=X8GZE0WmhkV99y%2BwVUpesaS5Fmc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">åå°ç³»ç»Ÿä¸­çš„ RBAC æƒé™å®æˆ˜</h2>
<h3 data-id="heading-9">æƒé™èœå•ç±»å‹å®šä¹‰</h3>
<p>é¦–å…ˆï¼Œåœ¨å‰åç«¯äººå‘˜é…åˆä¸­ï¼Œæˆ‘ä»¬æœ€å¥½çº¦å®šä¸€å¥—èœå•æ•°æ®çš„ç»“æ„ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteMeta</span>, <span class="hljs-title class_">RouteRecordRaw</span>, <span class="hljs-title class_">RouteRecordRedirectOption</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DefineComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/type'</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CustomRouteRecordRaw</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>, 'meta'&gt; {
    <span class="hljs-comment">/**
     * è·¯ç”±åœ°å€
     */</span>
    path?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * è·¯ç”±åç§°
     */</span>
    name?: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * é‡å®šå‘è·¯å¾„
     */</span>
    redirect?: <span class="hljs-title class_">RouteRecordRedirectOption</span>;
    <span class="hljs-comment">/**
     * ç»„ä»¶
     */</span>
    component?: <span class="hljs-title class_">Component</span> | <span class="hljs-title class_">DefineComponent</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">unknown</span>&gt;);
    <span class="hljs-comment">/**
     * å­è·¯ç”±ä¿¡æ¯
     */</span>
    children?: <span class="hljs-title class_">CustomRouteRecordRaw</span>[];
    <span class="hljs-comment">/**
     * è·¯ç”±ç±»å‹
     */</span>
    <span class="hljs-keyword">type</span>?: <span class="hljs-title class_">RouteType</span>;
    <span class="hljs-comment">/**
     * å…ƒä¿¡æ¯
     */</span>
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-comment">/**
       * èœå•æ ‡é¢˜
       */</span>
      <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
      <span class="hljs-comment">/**
       * èœå•å›¾æ ‡
       */</span>
      menuIcon?: <span class="hljs-built_in">string</span>;
      <span class="hljs-comment">/**
       * æ’åº
       */</span>
      sort?: <span class="hljs-built_in">number</span>;
      <span class="hljs-comment">/**
       * æ˜¯å¦åœ¨ä¾§è¾¹æ èœå•ä¸­éšè—
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      hideMenu?: <span class="hljs-built_in">boolean</span>;
      <span class="hljs-comment">/**
       * æ˜¯å¦åœ¨é¢åŒ…å±‘ä¸­éšè—
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      hideBreadcrumb?: <span class="hljs-built_in">boolean</span>;
      <span class="hljs-comment">/**
       * å½“åªæœ‰ä¸€ä¸ªå­èœå•æ—¶ï¼Œæ˜¯å¦éšè—çˆ¶çº§èœå•ç›´æ¥æ˜¾ç¤ºå­èœå•å†…å®¹
       * <span class="hljs-doctag">@default</span> <span class="hljs-variable">false</span>
       */</span>
      hideParentIfSingleChild?: <span class="hljs-built_in">boolean</span>;
    };
  }

  <span class="hljs-comment">/**
   * åç«¯è¿”å›çš„æƒé™è·¯ç”±ç±»å‹å®šä¹‰
   */</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">PermissionRoute</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">CustomRouteRecordRaw</span>, <span class="hljs-string">'component'</span> | <span class="hljs-string">'children'</span> | <span class="hljs-string">'type'</span>&gt; &amp; {
    <span class="hljs-comment">/**
     * è·¯ç”±ID
     */</span>
    id?: <span class="hljs-built_in">number</span>;
    <span class="hljs-comment">/**
     * è·¯ç”±çˆ¶ID
     */</span>
    parentId?: <span class="hljs-built_in">number</span>;
    <span class="hljs-comment">/**
     * ç»„ä»¶è·¯å¾„ï¼ˆåç«¯è¿”å›æ—¶ä¸ºå­—ç¬¦ä¸²ï¼Œå‰ç«¯å¤„ç†åä¸ºç»„ä»¶ï¼‰
     */</span>
    <span class="hljs-attr">component</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-comment">/**
     * å­è·¯ç”±ä¿¡æ¯
     */</span>
    children?: <span class="hljs-title class_">PermissionRoute</span>[];
    <span class="hljs-comment">/**
     * è·¯ç”±ç±»å‹
     */</span>
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">RouteType</span>;
  };
}

</code></pre>
<blockquote>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Frouter.d.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/router.d.ts" ref="nofollow noopener noreferrer">router.d.ts</a> æ‰¾åˆ°ç±»å‹æ–‡ä»¶</p>
</blockquote>
<p>ä»¥ä¸Šé¢çš„ç±»å‹å®šä¹‰ä¸ºä¾‹ï¼Œæˆ‘ä»¬çº¦å®š <code>PermissionRoute</code> ç±»å‹æ˜¯åç«¯è¿”å›çš„æƒé™è·¯ç”±ç±»å‹ï¼š</p>
<p>æˆ‘è¿™é‡Œä½¿ç”¨ ApiFox æ¥ Mock æƒé™è·¯ç”±æ•°æ®ï¼Œæ•°æ®æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F" target="_blank" title="https://clean-admin.apifox.cn/" ref="nofollow noopener noreferrer">clean-admin ApiFox æ–‡æ¡£åœ¨çº¿åœ°å€</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d472ebe0289417aab9114ab52c82a2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=533qsuaKRIxS%2Bvb0FxFeUHlz7Mo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">ä»ç™»å½•é¡µåˆ°è·¯ç”±å®ˆå«</h3>
<p>æƒé™æ–¹æ¡ˆçš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯ç™»å½•å¹¶æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯</p>
<p>å‡è®¾æˆ‘ä»¬ç°åœ¨ç”¨ Element Plus æ­å»ºèµ·äº†ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œå½“ç”¨æˆ·ç‚¹å‡»ç™»å½•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšè¿™å‡ ä»¶äº‹ï¼š</p>
<ol>
<li>è°ƒç”¨ç™»å½•æ¥å£ï¼Œå°†è´¦å·ã€å¯†ç å‘é€ç»™åç«¯è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åˆ™è¿”å› JWT ä¿¡æ¯</li>
<li>å°†è¿”å›çš„ JWT ä¿¡æ¯ä¿å­˜åˆ°æœ¬åœ°ï¼Œåç»­æ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦ Token æ¥è¯†åˆ«ç”¨æˆ·èº«ä»½å¹¶å†³å®šä½ èƒ½æ‹¿åˆ°çš„æƒé™è·¯ç”±æ•°æ®</li>
<li>è§¦å‘è·¯ç”±å®ˆå«æ‹¦æˆª</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d1195e632f74c2aa508c623555734ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=f%2FsehCMd98KQLSHYFgN9fuwg2Qg%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Fviews%2Fauth%2Fpage%2Faccount-login.vue" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/views/auth/page/account-login.vue" ref="nofollow noopener noreferrer">account-login.vue</a> æ‰¾åˆ°å…¨éƒ¨ä»£ç </p>
</blockquote>
<h3 data-id="heading-11">åŸºæœ¬ Vue Router é…ç½®</h3>
<p>ç™»å½•å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥è§¦å‘è·¯ç”±å®ˆå«äº†ï¼Œä½†åœ¨å†™è·¯ç”±å®ˆå«ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥é…ç½®ä¸€ä¸‹åŸºæœ¬çš„ Vue Router</p>
<p>åœ¨æ•´ä¸ªæƒé™ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å°†è·¯ç”±æ•°æ®åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ol>
<li>é™æ€è·¯ç”±ï¼šç³»ç»Ÿå›ºå®šçš„è·¯ç”±ï¼Œæ¯”å¦‚ç™»å½•é¡µã€å¼‚å¸¸é¡µ(404ã€403...)</li>
<li>åŠ¨æ€è·¯ç”±ï¼šç”±åç«¯æ¥å£è¿”å›çš„ç”¨æˆ·è§’è‰²å¯¹åº”çš„èœå•è·¯ç”±æ•°æ®</li>
</ol>
<p>é™æ€è·¯ç”±æ˜¯ç›´æ¥ç”±å‰ç«¯å®šä¹‰ï¼Œä¸ä¼šä»åç«¯æ¥å£è¿”å›ã€ä¸ä¼šæ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€å˜åŒ–ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†è·¯ç”±æˆ‘ä»¬ç›´æ¥å†™å¥½ç„¶åæ³¨å†Œåˆ° Vue Router ä¸­å³å¯</p>
<p>Vue Router é…ç½®ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createRouter, createWebHashHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteRecordRaw</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">App</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ImportGlobRoutes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./typing'</span>;
<span class="hljs-keyword">import</span> { extractRoutes } <span class="hljs-keyword">from</span> <span class="hljs-string">'./helpers'</span>;
<span class="hljs-keyword">import</span> { afterEachGuard, beforeEachGuard } <span class="hljs-keyword">from</span> <span class="hljs-string">'./guards'</span>;

<span class="hljs-comment">/** é™æ€è·¯ç”± */</span>
<span class="hljs-keyword">const</span> staticRoutes = <span class="hljs-title function_">extractRoutes</span>(
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">glob</span>&lt;<span class="hljs-title class_">ImportGlobRoutes</span>&gt;([<span class="hljs-string">'./modules/constant-routes/**/*.ts'</span>], {
    <span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span>,
  }),
);

<span class="hljs-comment">/** ç³»ç»Ÿè·¯ç”± */</span>
<span class="hljs-keyword">const</span> systemRoutes = <span class="hljs-title function_">extractRoutes</span>(
  <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">glob</span>&lt;<span class="hljs-title class_">ImportGlobRoutes</span>&gt;([<span class="hljs-string">'./modules/system-routes/**/*.ts'</span>], {
    <span class="hljs-attr">eager</span>: <span class="hljs-literal">true</span>,
  }),
);

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHashHistory</span>(),
  <span class="hljs-attr">routes</span>: [...staticRoutes, ...systemRoutes] <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouteRecordRaw</span>[],
  <span class="hljs-attr">strict</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">scrollBehavior</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }),
});

<span class="hljs-title function_">beforeEachGuard</span>(router);
<span class="hljs-title function_">afterEachGuard</span>(router);

<span class="hljs-comment">/** åˆå§‹åŒ–è·¯ç”± */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initRouter</span>(<span class="hljs-params">app: App&lt;Element&gt;</span>) {
  app.<span class="hljs-title function_">use</span>(router);
}

<span class="hljs-keyword">export</span> { router, initRouter, staticRoutes };

</code></pre>
<blockquote>
<p>å›¾ä¸­çš„é™æ€è·¯ç”±å’Œç³»ç»Ÿè·¯ç”±æ˜¯åŒä¸€ç±»è·¯ç”±æ•°æ®ï¼Œå³é™æ€è·¯ç”±</p>
</blockquote>
<p>è¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Frouter%2Findex.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/router/index.ts" ref="nofollow noopener noreferrer">router/index.ts</a> æ‰¾åˆ°</p>
<p>è¿™ä¸ªåŸºæœ¬çš„ Vue Router é…ç½®ï¼Œåšäº†è¿™ä¹ˆå‡ ä»¶äº‹ï¼š</p>
<ol>
<li>å¯¼å…¥ <code>modules</code> æ–‡ä»¶å¤¹ä¸‹çš„é™æ€è·¯ç”±è¿›è¡Œæ³¨å†Œ</li>
<li>è·¯ç”±åˆå§‹åŒ–é…ç½® <code>initRouter</code> ï¼Œåœ¨ <code>main.ts</code> ä¸­è°ƒç”¨</li>
<li>æ³¨å†Œå…¨å±€å‰ç½®å®ˆå« <code>beforeEach</code>ã€å…¨å±€åç½®å®ˆå« <code>afterEach</code></li>
</ol>
<p>æˆ‘ä»¬å®ç°åŠ¨æ€è·¯ç”±æ³¨å†Œçš„é€»è¾‘å°±å†™åœ¨ <code>beforeEach</code> ä¸­</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä½¿ç”¨äº† <code>import.meta.glob</code> æ¥åŠ¨æ€å¯¼å…¥æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶æ¨¡å—ï¼Œè¿™æ˜¯ <code>Vite</code> æä¾›çš„ä¸€ç§å¯¼å…¥æ–¹å¼ï¼Œå‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vite.dev%2Fguide%2Ffeatures%23glob-import" target="_blank" title="https://cn.vite.dev/guide/features#glob-import" ref="nofollow noopener noreferrer">Vite Glob å¯¼å…¥</a></p>
<h3 data-id="heading-12">è·¯ç”±å®ˆå«ä¸åŠ¨æ€æ³¨å†Œ</h3>
<p>è·¯ç”±å®ˆå«æ˜¯ Vue Router æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œä¸»è¦ç”¨æ¥é€šè¿‡è·³è½¬æˆ–å–æ¶ˆçš„æ–¹å¼å®ˆå«å¯¼èˆªï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Frouter.vuejs.org%2Fzh%2Fguide%2Fadvanced%2Fnavigation-guards.html" target="_blank" title="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html" ref="nofollow noopener noreferrer">Vue Router è·¯ç”±å®ˆå«</a></p>
<p>é‡å¤´æˆåœ¨å…¨å±€å‰ç½®å®ˆå« <code>router.beforeEach</code> ä¸­å®ç°ï¼Œæ¥çœ‹çœ‹æˆ‘ä»¬åšå“ªäº›äº‹ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">ROUTE_NAMES</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../config'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteRecordNameGeneric</span>, <span class="hljs-title class_">RouteRecordRaw</span>, <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;
<span class="hljs-keyword">import</span> { getLocalAccessToken } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/permission'</span>;
<span class="hljs-keyword">import</span> { userService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/api'</span>;
<span class="hljs-keyword">import</span> { nprogress } <span class="hljs-keyword">from</span> <span class="hljs-string">'./helpers'</span>;
<span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;

<span class="hljs-comment">/** ç™»å½•è®¤è¯é¡µé¢ï¼šè´¦å·ç™»å½•é¡µã€çŸ­ä¿¡ç™»å½•é¡µã€äºŒç»´ç ç™»å½•é¡µã€å¿˜è®°å¯†ç é¡µã€æ³¨å†Œé¡µ... */</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">authPages</span>: <span class="hljs-title class_">RouteRecordNameGeneric</span>[] = [
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">AUTH</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ACCOUNT_LOGIN</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">SMS_LOGIN</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">QR_LOGIN</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">FORGOT_PASSWORD</span>,
  <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">REGISTER</span>,
];

<span class="hljs-comment">/** é¡µé¢ç™½åå•ï¼šä¸éœ€è¦ç™»å½•ä¹Ÿèƒ½è®¿é—®çš„é¡µé¢ */</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">pageWhiteList</span>: <span class="hljs-title class_">RouteRecordNameGeneric</span>[] = [...authPages];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">beforeEachGuard</span>(<span class="hljs-params">router: Router</span>) {
  router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to) =&gt; {
    <span class="hljs-comment">/** è¿›åº¦æ¡ï¼šå¼€å§‹ */</span>
    nprogress.<span class="hljs-title function_">start</span>();

    <span class="hljs-keyword">const</span> { <span class="hljs-attr">name</span>: <span class="hljs-title class_">RouteName</span> } = to;

    <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();
    <span class="hljs-keyword">const</span> { getAccessToken, getRoutesAddStatus, registerRoutes } = <span class="hljs-title function_">storeToRefs</span>(userStore);
    <span class="hljs-keyword">const</span> { setRoutesAddStatus, setUserInfo, logout } = userStore;

    <span class="hljs-comment">/** è®¿é—®ä»¤ç‰Œ */</span>
    <span class="hljs-keyword">const</span> accessToken = getAccessToken.<span class="hljs-property">value</span> || <span class="hljs-title function_">getLocalAccessToken</span>();

    <span class="hljs-comment">// 1.ç”¨æˆ·æœªç™»å½•ï¼ˆæ—  Tokenï¼‰</span>
    <span class="hljs-keyword">if</span> (!accessToken) {
      <span class="hljs-keyword">const</span> isWhitePage = pageWhiteList.<span class="hljs-title function_">includes</span>(<span class="hljs-title class_">RouteName</span>);
      <span class="hljs-comment">// 1.1 æœªç™»å½•ï¼Œå¦‚æœè®¿é—®çš„æ˜¯ç™½åå•ä¸­çš„é¡µé¢ï¼Œç›´æ¥æ”¾è¡Œ</span>
      <span class="hljs-keyword">if</span> (isWhitePage) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

      nprogress.<span class="hljs-title function_">done</span>();

      <span class="hljs-comment">// 1.2 æœªç™»å½•åˆä¸åœ¨ç™½åå•ï¼Œåˆ™æ‹¦æˆªå¹¶é‡å®šå‘åˆ°ç™»å½•é¡µ</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ACCOUNT_LOGIN</span> };
    }

    <span class="hljs-comment">// å¦‚æœå·²ç™»å½•ç”¨æˆ·è¯•å›¾è®¿é—®ç™»å½•é¡µï¼Œé¿å…é‡å¤ç™»å½•ï¼Œè¦å¼ºåˆ¶é‡å®šå‘åˆ°é¦–é¡µ</span>
    <span class="hljs-keyword">if</span> (authPages.<span class="hljs-title function_">includes</span>(<span class="hljs-title class_">RouteName</span>)) {
      nprogress.<span class="hljs-title function_">done</span>();
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ROOT</span> };
    }

    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦åŠ¨æ€åŠ è½½è·¯ç”±çš„æ“ä½œ</span>
    <span class="hljs-keyword">if</span> (!getRoutesAddStatus.<span class="hljs-property">value</span>) {
      <span class="hljs-comment">// isRoutesAdded é»˜è®¤ä¸º falseï¼ˆæœªæŒä¹…åŒ–ï¼‰ï¼Œåœ¨å·²ç»åŠ¨æ€æ³¨å†Œè¿‡æ—¶ä¼šè®¾ç½®ä¸ºtrueï¼Œåœ¨é¡µé¢åˆ·æ–°æ—¶ä¼šé‡ç½®ä¸º false</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1.æ‹‰å–ç”¨æˆ·ä¿¡æ¯</span>
        <span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">await</span> userService.<span class="hljs-title function_">getUserInfo</span>();

        <span class="hljs-comment">// 2.å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ Store</span>
        <span class="hljs-title function_">setUserInfo</span>(userInfo);

        <span class="hljs-comment">// 3.åŠ¨æ€æ³¨å†Œè·¯ç”±ï¼ŒregisterRoutes æ˜¯å¤„ç†åçš„è·¯ç”±è¡¨</span>
        registerRoutes.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> {
          router.<span class="hljs-title function_">addRoute</span>(route <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">RouteRecordRaw</span>);
        });

        <span class="hljs-comment">// 4.æ ‡è®°è·¯ç”±å·²æ·»åŠ </span>
        <span class="hljs-title function_">setRoutesAddStatus</span>(<span class="hljs-literal">true</span>);

        <span class="hljs-comment">// 5.ä¸­æ–­å½“å‰å¯¼èˆªï¼Œé‡æ–°è¿›å…¥å®ˆå«</span>
        <span class="hljs-keyword">return</span> { ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> };
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼ˆå¦‚ Token è¿‡æœŸå¤±æ•ˆã€ç½‘ç»œå¼‚å¸¸ï¼‰</span>
        <span class="hljs-title function_">logout</span>();
        nprogress.<span class="hljs-title function_">done</span>();
        <span class="hljs-comment">// é‡å®šå‘å›ç™»å½•é¡µï¼Œè®©ç”¨æˆ·é‡æ–°ç™»å½•</span>
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">name</span>: <span class="hljs-variable constant_">ROUTE_NAMES</span>.<span class="hljs-property">ACCOUNT_LOGIN</span> };
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  });
}

</code></pre>
<blockquote>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Frouter%2Fguards%2Fbefore-each-guard.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/router/guards/before-each-guard.ts" ref="nofollow noopener noreferrer">before-each-guard.ts</a> æ‰¾åˆ°å…¨éƒ¨ä»£ç </p>
</blockquote>
<p>ä¸Šé¢çš„ä»£ç å·²ç»ç»™å‡ºäº†å¾ˆè¯¦ç»†çš„æ³¨é‡Šï¼Œä»æ•´ä½“è§’åº¦æ¥è®²ï¼Œæˆ‘ä»¬åšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å¤„ç†ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ç”¨æˆ·æœªç™»å½•ã€ç™»å½•åè®¿é—®ç™»å½•é¡µã€ç™½åå•ç­‰æƒ…å†µ</li>
<li>æ‹‰å–ç”¨æˆ·ä¿¡æ¯ï¼ŒåŠ¨æ€æ³¨å†Œè·¯ç”±</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52a61b13fbbd43698183f2e65dee3b47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=bEbJ33PHj4SjT%2BBG4X%2BVC942%2BOA%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨è·¯ç”±å®ˆå«ä¸­â€œæ‹‰å–ç”¨æˆ·ä¿¡æ¯â€ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé™¤äº†è¿”å›ç”¨æˆ·æœ¬èº«çš„ä¿¡æ¯å¤–ï¼Œè¿˜ä¼šç»™åˆ°æƒé™è·¯ç”±ä¿¡æ¯ã€æƒé™ç ä¿¡æ¯ï¼Œè¿™é‡Œçš„æ•°æ®ç»“æ„å¯ä»¥è·Ÿåç«¯è¿›è¡Œçº¦å®š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e69f7c3abe341d4b51f2033820b757e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=ciXyPsIRKCJK%2BwXwvHogFOQlqBg%3D" alt="image.png" loading="lazy"/></p>
<p>æ¯”å¦‚åœ¨ vue-clean-admin ä¸­ï¼Œè¿”å›çš„æ•°æ®ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>
<blockquote>
<p>åœ¨ ApiFox æ–‡æ¡£å¯ä»¥æ‰¾åˆ°ç”¨æˆ·æ¥å£è¯´æ˜ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fclean-admin.apifox.cn%2F336121333e0" target="_blank" title="https://clean-admin.apifox.cn/336121333e0" ref="nofollow noopener noreferrer">ApiFox æ–‡æ¡£ - ç”¨æˆ·ä¿¡æ¯</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a1983f04833498ca8738fd8e027677c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=TEQWMgkv5Yb42BKazc%2BroN1epGE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">åç«¯è·¯ç”±ç»“æ„çš„è½¬åŒ–</h3>
<p>åœ¨é€šè¿‡â€œæ‹‰å–ç”¨æˆ·ä¿¡æ¯â€æ‹¿åˆ°è·¯ç”±æ•°æ®åï¼Œå¹¶ä¸æ˜¯ç›´æ¥æ³¨å†Œåˆ° Vue Routerï¼Œè€Œæ˜¯éœ€è¦è¿›è¡Œå¤„ç†è½¬åŒ–ï¼Œæ‰èƒ½ç¬¦åˆ Vue Router å®šä¹‰çš„è·¯ç”±è¡¨ç»“æ„ï¼Œ<code>registerRoutes</code> å°±æ˜¯å¤„ç†åçš„è·¯ç”±è¡¨ï¼Œå¤„ç†åçš„ç±»å‹å®šä¹‰å¯ä»¥å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Ftypings%2Frouter.d.ts%23L7-L64" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/typings/router.d.ts#L7-L64" ref="nofollow noopener noreferrer"><code>CustomRouteRecordRaw</code></a></p>
<p>å¤„ç†ä»€ä¹ˆå†…å®¹å‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚ï¼Œæ¥å£æ‹¿åˆ°çš„è·¯ç”±æ•°æ®å­—æ®µ <code>component</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è·¯å¾„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜ å°„è·¯å¾„ï¼Œæ˜ å°„åˆ°å‰ç«¯é¡¹ç›®ä¸‹çš„çœŸå®ç»„ä»¶è·¯å¾„</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e45648c28a1842d989038a603c9d8fdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=3pupbwBxPl8RwEVJMSVXNGpW8Ws%3D" alt="image.png" loading="lazy"/></p>
<p>å®ç°è·¯ç”±ç»“æ„è½¬æ¢çš„ä»£ç ï¼Œæˆ‘å†™åœ¨äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Fblob%2Fmain%2Fsrc%2Frouter%2Fhelpers.ts" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/blob/main/src/router/helpers.ts" ref="nofollow noopener noreferrer">router/helpers.ts</a>ï¼Œæœ€ä¸»è¦é€»è¾‘æ˜¯ <code>generateRoutes</code> å‡½æ•°ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * ç”Ÿæˆç¬¦åˆ Vue Router å®šä¹‰çš„è·¯ç”±è¡¨
 * <span class="hljs-doctag">@param</span> routes æœªè½¬åŒ–çš„è·¯ç”±æ•°æ®
 * <span class="hljs-doctag">@returns</span> ç¬¦åˆç»“æ„çš„è·¯ç”±è¡¨
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateRoutes</span>(<span class="hljs-params">routes: PermissionRoute[]</span>): <span class="hljs-title class_">CustomRouteRecordRaw</span>[] {
  <span class="hljs-keyword">if</span> (!routes.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> [];
  <span class="hljs-keyword">return</span> routes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">route</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { path, name, redirect, <span class="hljs-keyword">type</span>, meta } = route;
    <span class="hljs-keyword">const</span> <span class="hljs-attr">baseRoute</span>: <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">CustomRouteRecordRaw</span>, <span class="hljs-string">'children'</span>&gt; = {
      path,
      name,
      redirect,
      <span class="hljs-keyword">type</span>,
      <span class="hljs-attr">component</span>: <span class="hljs-title function_">loadComponent</span>(route),
      <span class="hljs-attr">meta</span>: {
        ...meta,
        <span class="hljs-comment">// æ˜¯å¦åœ¨ä¾§è¾¹æ èœå•ä¸­éšè—</span>
        <span class="hljs-attr">hideMenu</span>: route.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideMenu</span> || <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// æ˜¯å¦åœ¨é¢åŒ…å±‘ä¸­éšè—</span>
        <span class="hljs-attr">hideBreadcrumb</span>: route.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideBreadcrumb</span> || <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// å½“åªæœ‰ä¸€ä¸ªå­èœå•æ—¶ï¼Œæ˜¯å¦éšè—çˆ¶çº§èœå•ç›´æ¥æ˜¾ç¤ºå­èœå•å†…å®¹</span>
        <span class="hljs-attr">hideParentIfSingleChild</span>: route.<span class="hljs-property">meta</span>?.<span class="hljs-property">hideParentIfSingleChild</span> || <span class="hljs-literal">false</span>,
      },
    };

    <span class="hljs-comment">// æ˜¯ç›®å½•æ•°æ®ï¼Œè®¾ç½®é‡å®šå‘è·¯å¾„</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-title class_">PermissionRouteTypeEnum</span>.<span class="hljs-property">DIR</span>) {
      baseRoute.<span class="hljs-property">redirect</span> = redirect || <span class="hljs-title function_">getRedirectPath</span>(route);
    }
    <span class="hljs-comment">// é€’å½’å¤„ç†å­è·¯ç”±</span>
    <span class="hljs-keyword">const</span> processedChildren =
      route.<span class="hljs-property">children</span> &amp;&amp; route.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> ? <span class="hljs-title function_">generateRoutes</span>(route.<span class="hljs-property">children</span>) : <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">return</span> {
      ...baseRoute,
      ...(processedChildren ? { <span class="hljs-attr">children</span>: processedChildren } : {}),
    };
  });
}
</code></pre>
<p>ç»è¿‡ <code>generateRoutes</code> å¤„ç†çš„è·¯ç”±è¡¨ï¼Œå† <code>addRoute</code> åˆ° Vue Router ä¸­</p>
<h3 data-id="heading-14">ä¾§è¾¹æ èœå•çš„æ¸²æŸ“</h3>
<p>å½“è·¯ç”±å®ˆå«çš„é€»è¾‘èµ°å®Œåï¼Œå°±è¿›å…¥åˆ°é¦–é¡µï¼Œåœ¨é¦–é¡µä¸­ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®è·¯ç”±è¡¨ï¼ˆè½¬æ¢è¿‡çš„ï¼‰æ¥æ¸²æŸ“ä¾§è¾¹æ èœå•</p>
<p>ä¾§è¾¹æ èœå•æ˜¯æ‹¿ Element Plus çš„ <code>el-menu</code> ç»„ä»¶æ¥åšçš„ï¼Œæˆ‘ä»¬å°è£…äº†ä¸€ä¸ªèœå•ç»„ä»¶ï¼Œé™¤äº†æ¸²æŸ“è·¯ç”±æ•°æ®å¤–ï¼Œä¹Ÿæ›´æ–¹ä¾¿è‡ªå®šä¹‰é…ç½®èœå•å±æ€§ï¼ˆ<code>meta</code>ï¼‰æ¥å®ç°ä¸€äº›åŠŸèƒ½</p>
<p>å°è£…ä¸éš¾ï¼Œå°±æ˜¯æ‹¿å¤„ç†åçš„è·¯ç”±è¡¨å¾ªç¯æ¸²æŸ“ <code>menu-item</code>ï¼Œæ ¹æ® <code>meta</code> é…ç½®é¡¹æ¥å®ç°"æ˜¯å¦éšè—èœå•"ï¼Œ"å½“åªæœ‰ä¸€ä¸ªå­èœå•æ—¶ï¼Œæ˜¯å¦éšè—çˆ¶çº§èœå•ç›´æ¥æ˜¾ç¤ºå­èœå•å†…å®¹"ç­‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc22c2cff5504c7da9f622501542575d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2B5LqU5Li2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770288982&amp;x-signature=N30nuLBJhKAnO0gn1RD1N8kky4E%3D" alt="image.png" loading="lazy"/></p>
<p>èœå•ç»„ä»¶çš„å°è£…ä»£ç åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin%2Ftree%2Fmain%2Fsrc%2Flayout%2Fcomponents%2Fbasic-menu" target="_blank" title="https://github.com/bryqiu/vue-clean-admin/tree/main/src/layout/components/basic-menu" ref="nofollow noopener noreferrer">basic-menu</a> æ–‡ä»¶å¤¹ä¸­</p>
<p>åˆ°è¿™ä¸€æ­¥ï¼Œå·²ç»å®ç°äº†åŠ¨æ€æƒé™è·¯ç”±åŠä¾§è¾¹æ èœå•çš„æ¸²æŸ“ï¼Œä½†è¿˜ä¸ç®—å®Œ</p>
<p>å› ä¸ºæˆ‘ä»¬è¿˜ä¸èƒ½è‡ªç”±å®šä¹‰èœå•ä¿¡æ¯ã€è§’è‰²ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯æ¥å®ç°æƒé™æ§åˆ¶ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« æ¥èŠèŠç®¡ç†æ¨¡å—</p>
<h2 data-id="heading-15">äº†è§£æ›´å¤š</h2>
<p>ç³»åˆ—ä¸“æ åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2FBlog" target="_blank" title="https://github.com/bryqiu/Blog" ref="nofollow noopener noreferrer">GitHub åšå®¢</a> | <a href="https://juejin.cn/column/7437267529330901026" target="_blank" title="https://juejin.cn/column/7437267529330901026">æ˜é‡‘ä¸“æ </a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fblog%2Fadmin_guide" target="_blank" title="https://segmentfault.com/blog/admin_guide" ref="nofollow noopener noreferrer">æ€å¦ä¸“æ </a></p>
<p>å®æˆ˜é¡¹ç›®ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbryqiu%2Fvue-clean-admin" target="_blank" title="https://github.com/bryqiu/vue-clean-admin" ref="nofollow noopener noreferrer">vue-clean-admin</a></p>
<h2 data-id="heading-16">äº¤æµè®¨è®º</h2>
<p>æ–‡ç« å¦‚æœ‰é”™è¯¯æˆ–éœ€è¦æ”¹è¿›ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¸‰ç« ä½¿ç”¨ mergeMap å®ç°å¹¶å‘è¯·æ±‚]]></title>    <link>https://juejin.cn/post/7600560664407523391</link>    <guid>https://juejin.cn/post/7600560664407523391</guid>    <pubDate>2026-01-29T09:01:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600560664407523391" data-draft-id="7600469605476958250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¸‰ç« ä½¿ç”¨ mergeMap å®ç°å¹¶å‘è¯·æ±‚"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:01:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¸‰ç« ä½¿ç”¨ mergeMap å®ç°å¹¶å‘è¯·æ±‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:01:40.000Z" title="Thu Jan 29 2026 09:01:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ mergeMap å®ç°å¹¶å‘è¯·æ±‚</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¹¶å‘æ‰§è¡Œå¤šä¸ªè¯·æ±‚ã€‚è™½ç„¶ <code>forkJoin</code> ä¹Ÿå¯ä»¥å®ç°å¹¶å‘ï¼Œä½†å®ƒè¦æ±‚ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆã€‚è€Œ <code>mergeMap</code> æä¾›äº†æ›´çµæ´»çš„å¹¶å‘æ§åˆ¶ï¼Œå¯ä»¥å®æ—¶å¤„ç†æ¯ä¸ªè¯·æ±‚çš„ç»“æœã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>mergeMap</code> å®ç°å¹¶å‘è¯·æ±‚ã€‚</p>
<h3 data-id="heading-2">mergeMap æ“ä½œç¬¦ç®€ä»‹</h3>
<p><code>mergeMap</code>ï¼ˆä¹Ÿç§°ä¸º <code>flatMap</code>ï¼‰æ˜¯ RxJS ä¸­æœ€å¸¸ç”¨çš„æ“ä½œç¬¦ä¹‹ä¸€ã€‚å®ƒä¼šå°†æº Observable çš„æ¯ä¸ªå€¼æ˜ å°„ä¸ºä¸€ä¸ªæ–°çš„ Observableï¼Œç„¶ååˆå¹¶è¿™äº› Observable çš„è¾“å‡ºã€‚</p>
<h4 data-id="heading-3">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">source$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-title function_">createObservable</span>(value))
)
</code></pre>
<h4 data-id="heading-4">å…³é”®ç‰¹æ€§</h4>
<ol>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>mergeMap</code> ä¼šå¹¶å‘æ‰§è¡Œæ‰€æœ‰å†…éƒ¨ Observable</li>
<li><strong>å®æ—¶è¾“å‡º</strong>ï¼šæ¯ä¸ªå†…éƒ¨ Observable å®Œæˆåç«‹å³è¾“å‡ºç»“æœï¼Œä¸ç­‰å¾…å…¶ä»– Observable</li>
<li><strong>é¡ºåºä¸ä¿è¯</strong>ï¼šç»“æœçš„é¡ºåºå¯èƒ½ä¸è¾“å…¥é¡ºåºä¸åŒï¼ˆæŒ‰å®Œæˆæ—¶é—´æ’åºï¼‰</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°é™åˆ¶å¹¶å‘æ•°</li>
</ol>
<h3 data-id="heading-5">å®æˆ˜åœºæ™¯ï¼šå¹¶å‘è¯·æ±‚å¤šä¸ªæ¥å£</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦å¹¶å‘è¯·æ±‚ 10 ä¸ªæ¥å£ï¼ˆdelay1ã€delay2ã€delay3 å¾ªç¯ï¼‰ï¼Œå¹¶å®æ—¶æ˜¾ç¤ºæ¯ä¸ªè¯·æ±‚çš„ç»“æœã€‚</p>
<h4 data-id="heading-6">å®ç°æ€è·¯</h4>
<ol>
<li>ä½¿ç”¨ <code>from</code> å°†æ¥å£ URL æ•°ç»„è½¬æ¢ä¸º Observable</li>
<li>ä½¿ç”¨ <code>mergeMap</code> å¹¶å‘æ‰§è¡Œæ¯ä¸ªè¯·æ±‚</li>
<li>ä½¿ç”¨ <code>catchError</code> å¤„ç†å•ä¸ªè¯·æ±‚çš„é”™è¯¯</li>
<li>ä½¿ç”¨ <code>toArray</code> æ”¶é›†æ‰€æœ‰ç»“æœï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦ç­‰å¾…å…¨éƒ¨å®Œæˆï¼‰</li>
</ol>
<h4 data-id="heading-7">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> apiUrls = [
  <span class="hljs-string">'/api/delay1'</span>,
  <span class="hljs-string">'/api/delay2'</span>,
  <span class="hljs-string">'/api/delay3'</span>,
  <span class="hljs-string">'/api/delay1'</span>,
  <span class="hljs-string">'/api/delay2'</span>,
  <span class="hljs-string">'/api/delay3'</span>,
  <span class="hljs-string">'/api/delay1'</span>,
  <span class="hljs-string">'/api/delay2'</span>,
  <span class="hljs-string">'/api/delay3'</span>,
  <span class="hljs-string">'/api/delay1'</span>
];

<span class="hljs-title function_">from</span>(apiUrls)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">(<span class="hljs-params">url, index</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> apiName = url.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'/api/'</span>, <span class="hljs-string">''</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">DelayApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span><span class="hljs-subst">${url}</span>`</span>)
        .<span class="hljs-title function_">pipe</span>(
          <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
            <span class="hljs-comment">// æ•è·å•ä¸ªè¯·æ±‚é”™è¯¯ï¼Œè¿”å›é”™è¯¯å“åº”</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`è¯·æ±‚ <span class="hljs-subst">${url}</span> å¤±è´¥:`</span>, err);
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({
              <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>,
              <span class="hljs-attr">data</span>: {
                <span class="hljs-attr">delay</span>: <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>,
                <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                <span class="hljs-attr">info</span>: <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>
              }
            } <span class="hljs-keyword">as</span> <span class="hljs-title class_">DelayApiResponse</span>);
          }),
          <span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
            <span class="hljs-comment">// å°†å“åº”åŒ…è£…ä¸ºåŒ…å«æ¥å£åç§°çš„å¯¹è±¡</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">RequestResult</span> = {
              apiName,
              <span class="hljs-attr">apiUrl</span>: url,
              response,
              index
            };
            <span class="hljs-keyword">return</span> result;
          })
        );
    }),
    <span class="hljs-title function_">toArray</span>() <span class="hljs-comment">// æ”¶é›†æ‰€æœ‰ç»“æœ</span>
  )
  .<span class="hljs-title function_">subscribe</span>({
    <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">results: RequestResult[]</span>) =&gt;</span> {
      <span class="hljs-comment">// æ‰€æœ‰è¯·æ±‚å®Œæˆï¼ˆæŒ‰å®Œæˆé¡ºåºï¼Œä¸æ˜¯åŸå§‹é¡ºåºï¼‰</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">results</span> = results;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‰€æœ‰è¯·æ±‚å®Œæˆ:'</span>, results);
    }
  });
</code></pre>
<h3 data-id="heading-8">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-9">1. å¹¶å‘æ‰§è¡Œæœºåˆ¶</h4>
<p><code>mergeMap</code> é»˜è®¤å¹¶å‘æ•°ä¸º <code>Infinity</code>ï¼Œæ„å‘³ç€ç†è®ºä¸Šæ‰€æœ‰è¯·æ±‚éƒ½ä¼šå¹¶å‘æ‰§è¡Œã€‚ä½†å®é™…å¹¶å‘æ•°å¯èƒ½å—ä»¥ä¸‹å› ç´ é™åˆ¶ï¼š</p>
<ul>
<li><strong>æµè§ˆå™¨å¹¶å‘è¿æ¥é™åˆ¶</strong>ï¼šåŒä¸€åŸŸåé€šå¸¸æœ€å¤š 6 ä¸ªå¹¶å‘è¿æ¥</li>
<li><strong>HTTP å®¢æˆ·ç«¯é™åˆ¶</strong>ï¼šæŸäº› HTTP å®¢æˆ·ç«¯å¯èƒ½æœ‰è‡ªå·±çš„å¹¶å‘é™åˆ¶</li>
<li><strong>æœåŠ¡å™¨é™åˆ¶</strong>ï¼šæœåŠ¡å™¨å¯èƒ½é™åˆ¶åŒä¸€å®¢æˆ·ç«¯çš„å¹¶å‘è¿æ¥æ•°</li>
</ul>
<h4 data-id="heading-10">2. ç»“æœé¡ºåº</h4>
<p><code>mergeMap</code> è¾“å‡ºçš„ç»“æœé¡ºåºæ˜¯æŒ‰ç…§å®Œæˆæ—¶é—´æ’åºçš„ï¼Œè€Œä¸æ˜¯è¾“å…¥é¡ºåºã€‚å¦‚æœéœ€è¦ä¿æŒåŸå§‹é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨ <code>concatMap</code> æˆ– <code>toArray()</code> åå†æ’åºã€‚</p>
<h4 data-id="heading-11">3. é”™è¯¯å¤„ç†</h4>
<p>ä½¿ç”¨ <code>catchError</code> å¯ä»¥æ•è·å•ä¸ªè¯·æ±‚çš„é”™è¯¯ï¼Œé¿å…æ•´ä¸ªæµä¸­æ–­ã€‚è¿™æ ·å³ä½¿æŸä¸ªè¯·æ±‚å¤±è´¥ï¼Œå…¶ä»–è¯·æ±‚ä»èƒ½ç»§ç»­æ‰§è¡Œã€‚</p>
<h4 data-id="heading-12">4. å¹¶å‘æ•°æ§åˆ¶</h4>
<p>å¦‚æœéœ€è¦é™åˆ¶å¹¶å‘æ•°ï¼Œå¯ä»¥åœ¨ <code>mergeMap</code> çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­æŒ‡å®šï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">(<span class="hljs-params">url, index</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(url);
}, <span class="hljs-number">3</span>) <span class="hljs-comment">// æœ€å¤šåŒæ—¶ 3 ä¸ªè¯·æ±‚</span>
</code></pre>
<h3 data-id="heading-13">ä¸ forkJoin çš„å¯¹æ¯”</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>mergeMap</th><th>forkJoin</th></tr></thead><tbody><tr><td>æ‰§è¡Œæ–¹å¼</td><td>å¹¶å‘ï¼Œå®æ—¶è¾“å‡º</td><td>å¹¶å‘ï¼Œç­‰å¾…å…¨éƒ¨å®Œæˆ</td></tr><tr><td>ç»“æœé¡ºåº</td><td>æŒ‰å®Œæˆæ—¶é—´</td><td>æŒ‰è¾“å…¥é¡ºåº</td></tr><tr><td>é”™è¯¯å¤„ç†</td><td>å¯å•ç‹¬å¤„ç†</td><td>ä»»ä¸€å¤±è´¥æ•´ä½“å¤±è´¥</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>éœ€è¦å®æ—¶å¤„ç†ç»“æœ</td><td>éœ€è¦ç­‰å¾…å…¨éƒ¨å®Œæˆ</td></tr></tbody></table>
<h3 data-id="heading-14">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-15">1. æ‰¹é‡æ•°æ®éªŒè¯</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¹¶å‘éªŒè¯å¤šä¸ªç”¨æˆ·IDæ˜¯å¦å­˜åœ¨</span>
<span class="hljs-title function_">from</span>(userIds)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">userId</span> =&gt;</span> 
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>).<span class="hljs-title function_">pipe</span>(
        <span class="hljs-title function_">catchError</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>))
      )
    )
  )
  .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
    <span class="hljs-comment">// å®æ—¶å¤„ç†æ¯ä¸ªéªŒè¯ç»“æœ</span>
    <span class="hljs-keyword">if</span> (result) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·å­˜åœ¨:'</span>, result);
    }
  });
</code></pre>
<h4 data-id="heading-16">2. æ–‡ä»¶ä¸Šä¼ è¿›åº¦</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¹¶å‘ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œå®æ—¶æ˜¾ç¤ºè¿›åº¦</span>
<span class="hljs-title function_">from</span>(files)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> 
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadFile</span>(file).<span class="hljs-title function_">pipe</span>(
        <span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">progress</span> =&gt;</span> ({ file, progress }))
      )
    )
  )
  .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">{ file, progress }</span>) =&gt;</span> {
    <span class="hljs-comment">// å®æ—¶æ›´æ–°æ¯ä¸ªæ–‡ä»¶çš„ä¸Šä¼ è¿›åº¦</span>
    <span class="hljs-title function_">updateFileProgress</span>(file, progress);
  });
</code></pre>
<h4 data-id="heading-17">3. æ•°æ®é‡‡é›†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä»å¤šä¸ªæ•°æ®æºå¹¶å‘é‡‡é›†æ•°æ®</span>
<span class="hljs-title function_">from</span>(dataSources)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">source</span> =&gt;</span> 
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchData</span>(source).<span class="hljs-title function_">pipe</span>(
        <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`æ•°æ®æº <span class="hljs-subst">${source}</span> å¤±è´¥:`</span>, err);
          <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;
        })
      )
    )
  )
  .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-comment">// å®æ—¶å¤„ç†é‡‡é›†åˆ°çš„æ•°æ®</span>
    <span class="hljs-title function_">processData</span>(data);
  });
</code></pre>
<h3 data-id="heading-18">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-19">1. é™åˆ¶å¹¶å‘æ•°</h4>
<p>å¦‚æœè¯·æ±‚æ•°é‡å¾ˆå¤§ï¼Œå»ºè®®é™åˆ¶å¹¶å‘æ•°ï¼Œé¿å…æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(url), <span class="hljs-number">5</span>) <span class="hljs-comment">// æœ€å¤š 5 ä¸ªå¹¶å‘</span>
</code></pre>
<h4 data-id="heading-20">2. ä½¿ç”¨ exhaustMap é¿å…é‡å¤è¯·æ±‚</h4>
<p>å¦‚æœåŒä¸€ä¸ªè¯·æ±‚å¯èƒ½è¢«è§¦å‘å¤šæ¬¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>exhaustMap</code> å¿½ç•¥åç»­è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(url))
</code></pre>
<h4 data-id="heading-21">3. æ·»åŠ é‡è¯•æœºåˆ¶</h4>
<p>å¯¹äºå¯èƒ½å¤±è´¥çš„è¯·æ±‚ï¼Œå¯ä»¥æ·»åŠ é‡è¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> 
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(url).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">retry</span>(<span class="hljs-number">3</span>), <span class="hljs-comment">// å¤±è´¥åé‡è¯• 3 æ¬¡</span>
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>))
  )
)
</code></pre>
<h3 data-id="heading-22">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå¦‚æœè¯·æ±‚æ•°é‡éå¸¸å¤§ï¼Œéœ€è¦æ³¨æ„å†…å­˜å ç”¨</li>
<li><strong>æœåŠ¡å™¨å‹åŠ›</strong>ï¼šå¹¶å‘è¯·æ±‚ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›ï¼Œéœ€è¦åˆç†æ§åˆ¶å¹¶å‘æ•°</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†ï¼Œé¿å…æ•´ä¸ªæµä¸­æ–­</li>
<li><strong>ç»“æœé¡ºåº</strong>ï¼šå¦‚æœéœ€è¦ä¿æŒé¡ºåºï¼Œè€ƒè™‘ä½¿ç”¨ <code>concatMap</code> æˆ– <code>toArray()</code> åæ’åº</li>
</ol>
<h3 data-id="heading-23">æ€»ç»“</h3>
<p><code>mergeMap</code> æ˜¯å®ç°å¹¶å‘è¯·æ±‚çš„å¼ºå¤§å·¥å…·ï¼Œå®ƒæä¾›äº†çµæ´»çš„å¹¶å‘æ§åˆ¶å’Œå®æ—¶ç»“æœå¤„ç†èƒ½åŠ›ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼š</p>
<ul>
<li><strong>éœ€è¦å®æ—¶å¤„ç†ç»“æœ</strong> â†’ ä½¿ç”¨ <code>mergeMap</code></li>
<li><strong>éœ€è¦ç­‰å¾…å…¨éƒ¨å®Œæˆ</strong> â†’ ä½¿ç”¨ <code>forkJoin</code></li>
<li><strong>éœ€è¦ä¿è¯é¡ºåº</strong> â†’ ä½¿ç”¨ <code>concatMap</code></li>
<li><strong>éœ€è¦é™åˆ¶å¹¶å‘</strong> â†’ ä½¿ç”¨ <code>mergeMap</code> é…åˆå¹¶å‘æ•°å‚æ•°</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨ <code>mergeMap</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºé«˜æ•ˆã€å“åº”è¿…é€Ÿçš„å¼‚æ­¥æ•°æ®æµå¤„ç†ç³»ç»Ÿã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬äº”ç« ä½¿ç”¨ switchMap å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢]]></title>    <link>https://juejin.cn/post/7600602502632767529</link>    <guid>https://juejin.cn/post/7600602502632767529</guid>    <pubDate>2026-01-29T09:03:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600602502632767529" data-draft-id="7600587732991164458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬äº”ç« ä½¿ç”¨ switchMap å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:03:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬äº”ç« ä½¿ç”¨ switchMap å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:03:39.000Z" title="Thu Jan 29 2026 09:03:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ switchMap å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>åœ¨æ ‡ç­¾é¡µï¼ˆTabï¼‰ç»„ä»¶ä¸­ï¼Œç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾æ—¶ï¼Œæ¯ä¸ªæ ‡ç­¾é¡µéƒ½å¯èƒ½å‘èµ·æ•°æ®è¯·æ±‚ã€‚å¦‚æœä¸åšå¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼š</p>
<ol>
<li>å¤šä¸ªè¯·æ±‚åŒæ—¶è¿›è¡Œï¼Œæµªè´¹èµ„æº</li>
<li>æ—§æ ‡ç­¾é¡µçš„è¯·æ±‚å®Œæˆåè¦†ç›–æ–°æ ‡ç­¾é¡µçš„æ•°æ®</li>
<li>ç”¨æˆ·ä½“éªŒå·®ï¼Œæ•°æ®æ··ä¹±</li>
</ol>
<p>æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>switchMap</code> åœ¨æ ‡ç­¾é¡µåˆ‡æ¢æ—¶è‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„è¯·æ±‚ï¼Œç¡®ä¿åªæ˜¾ç¤ºå½“å‰æ ‡ç­¾é¡µçš„æ•°æ®ã€‚</p>
<h3 data-id="heading-2">é—®é¢˜åœºæ™¯</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ ‡ç­¾é¡µç»„ä»¶ï¼ŒåŒ…å« 3 ä¸ªæ ‡ç­¾é¡µï¼Œæ¯ä¸ªæ ‡ç­¾é¡µéœ€è¦åŠ è½½ä¸åŒçš„æ•°æ®ï¼š</p>
<ul>
<li><strong>æ ‡ç­¾é¡µ 1</strong>ï¼šè°ƒç”¨ <code>/api/delay1</code>ï¼ˆå»¶è¿Ÿ 1 ç§’ï¼‰</li>
<li><strong>æ ‡ç­¾é¡µ 2</strong>ï¼šè°ƒç”¨ <code>/api/delay2</code>ï¼ˆå»¶è¿Ÿ 2 ç§’ï¼‰</li>
<li><strong>æ ‡ç­¾é¡µ 3</strong>ï¼šè°ƒç”¨ <code>/api/delay3</code>ï¼ˆå»¶è¿Ÿ 3 ç§’ï¼‰</li>
</ul>
<p>å¦‚æœç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾é¡µï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>ç”¨æˆ·ç‚¹å‡»"æ ‡ç­¾é¡µ 1" â†’ å‘èµ·è¯·æ±‚ Aï¼ˆ1 ç§’ï¼‰</li>
<li>ç”¨æˆ·ç«‹å³ç‚¹å‡»"æ ‡ç­¾é¡µ 2" â†’ å‘èµ·è¯·æ±‚ Bï¼ˆ2 ç§’ï¼‰</li>
<li>ç”¨æˆ·ç«‹å³ç‚¹å‡»"æ ‡ç­¾é¡µ 3" â†’ å‘èµ·è¯·æ±‚ Cï¼ˆ3 ç§’ï¼‰</li>
<li>è¯·æ±‚ A å…ˆå®Œæˆ â†’ æ˜¾ç¤ºæ ‡ç­¾é¡µ 1 çš„æ•°æ®ï¼ˆé”™è¯¯ï¼ï¼‰</li>
<li>è¯·æ±‚ B å®Œæˆ â†’ æ˜¾ç¤ºæ ‡ç­¾é¡µ 2 çš„æ•°æ®ï¼ˆé”™è¯¯ï¼ï¼‰</li>
<li>è¯·æ±‚ C å®Œæˆ â†’ æ˜¾ç¤ºæ ‡ç­¾é¡µ 3 çš„æ•°æ®ï¼ˆæ­£ç¡®ï¼Œä½†å·²ç»æ™šäº†ï¼‰</li>
</ol>
<h3 data-id="heading-3">switchMap è§£å†³æ–¹æ¡ˆ</h3>
<p>ä½¿ç”¨ <code>switchMap</code> å¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼šå½“åˆ‡æ¢æ ‡ç­¾é¡µæ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆä¹‹å‰æœªå®Œæˆçš„è¯·æ±‚ï¼Œåªå¤„ç†æœ€æ–°æ ‡ç­¾é¡µçš„è¯·æ±‚ã€‚</p>
<h4 data-id="heading-4">å®ç°æ€è·¯</h4>
<ol>
<li>ä½¿ç”¨ <code>Subject</code> ä½œä¸ºæ ‡ç­¾é¡µåˆ‡æ¢è§¦å‘å™¨</li>
<li>ä½¿ç”¨ <code>switchMap</code> å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢ï¼Œè‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„è¯·æ±‚</li>
<li>è®°å½•è¯·æ±‚å†å²ï¼Œå±•ç¤ºå“ªäº›è¯·æ±‚è¢«å–æ¶ˆäº†</li>
<li>åœ¨ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆæ‰€æœ‰è®¢é˜…</li>
</ol>
<h4 data-id="heading-5">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ ‡ç­¾é¡µåˆ—è¡¨</span>
<span class="hljs-attr">tabs</span>: <span class="hljs-title class_">Tab</span>[] = [
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'tab1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ ‡ç­¾é¡µ 1'</span>, <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'/api/delay1'</span>, <span class="hljs-attr">apiName</span>: <span class="hljs-string">'delay1'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'tab2'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ ‡ç­¾é¡µ 2'</span>, <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'/api/delay2'</span>, <span class="hljs-attr">apiName</span>: <span class="hljs-string">'delay2'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-string">'tab3'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ ‡ç­¾é¡µ 3'</span>, <span class="hljs-attr">apiUrl</span>: <span class="hljs-string">'/api/delay3'</span>, <span class="hljs-attr">apiName</span>: <span class="hljs-string">'delay3'</span> }
];

<span class="hljs-comment">// å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µ</span>
<span class="hljs-attr">activeTabId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabs</span>[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>;

<span class="hljs-comment">// æ ‡ç­¾é¡µåˆ‡æ¢ Subject</span>
<span class="hljs-keyword">private</span> tabSwitch$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">string</span>&gt;();

<span class="hljs-comment">// é”€æ¯ Subject</span>
<span class="hljs-keyword">private</span> destroy$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-title function_">ngOnInit</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// ä½¿ç”¨ switchMap å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢æ—¶çš„è¯·æ±‚å–æ¶ˆ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabSwitch$</span>
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">(<span class="hljs-params">tabId</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> tab = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabs</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === tabId);
        <span class="hljs-keyword">if</span> (!tab) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
        }
        
        <span class="hljs-comment">// åˆ›å»ºè¯·æ±‚è®°å½•</span>
        <span class="hljs-keyword">const</span> recordId = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">requestCounter</span>;
        <span class="hljs-keyword">const</span> <span class="hljs-attr">record</span>: <span class="hljs-title class_">RequestRecord</span> = {
          <span class="hljs-attr">id</span>: recordId,
          <span class="hljs-attr">tabId</span>: tab.<span class="hljs-property">id</span>,
          <span class="hljs-attr">tabName</span>: tab.<span class="hljs-property">name</span>,
          <span class="hljs-attr">apiName</span>: tab.<span class="hljs-property">apiName</span>,
          <span class="hljs-attr">apiUrl</span>: tab.<span class="hljs-property">apiUrl</span>,
          <span class="hljs-attr">startTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
          <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>
        };
        
        <span class="hljs-comment">// å°†ä¹‹å‰çš„ pending è¯·æ±‚æ ‡è®°ä¸º cancelledï¼ˆåˆ‡æ¢æ ‡ç­¾æ—¶å–æ¶ˆï¼‰</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>) {
            r.<span class="hljs-property">status</span> = <span class="hljs-string">'cancelled'</span>;
            r.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          }
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">unshift</span>(record);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentResult</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">DelayApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span><span class="hljs-subst">${tab.apiUrl}</span>`</span>)
          .<span class="hljs-title function_">pipe</span>(
            <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
              <span class="hljs-comment">// æ•è·é”™è¯¯</span>
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`è¯·æ±‚ <span class="hljs-subst">${tab.apiUrl}</span> å¤±è´¥:`</span>, err);
              <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({
                <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>,
                <span class="hljs-attr">data</span>: {
                  <span class="hljs-attr">delay</span>: <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>,
                  <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                  <span class="hljs-attr">info</span>: <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>
                }
              } <span class="hljs-keyword">as</span> <span class="hljs-title class_">DelayApiResponse</span>);
            })
          );
      }),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroy$</span>) <span class="hljs-comment">// è·¯ç”±åˆ‡æ¢æ—¶å–æ¶ˆæ‰€æœ‰è®¢é˜…</span>
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!response) {
          <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// æ‰¾åˆ°æœ€æ–°çš„ pending è¯·æ±‚è®°å½•</span>
        <span class="hljs-keyword">const</span> latestRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>);
        <span class="hljs-keyword">if</span> (latestRecord) {
          latestRecord.<span class="hljs-property">status</span> = <span class="hljs-string">'completed'</span>;
          latestRecord.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          latestRecord.<span class="hljs-property">response</span> = response;
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentResult</span> = response;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
      },
      <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-comment">// å¤„ç†é”™è¯¯</span>
        <span class="hljs-keyword">const</span> latestRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>);
        <span class="hljs-keyword">if</span> (latestRecord) {
          latestRecord.<span class="hljs-property">status</span> = <span class="hljs-string">'completed'</span>;
          latestRecord.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          latestRecord.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>;
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
      }
    });
  
  <span class="hljs-comment">// åˆå§‹åŒ–æ—¶åŠ è½½ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µçš„æ•°æ®</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">switchTab</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">activeTabId</span>);
}

<span class="hljs-comment">// åˆ‡æ¢æ ‡ç­¾é¡µ</span>
<span class="hljs-title function_">switchTab</span>(<span class="hljs-attr">tabId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeTabId</span> = tabId;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabSwitch$</span>.<span class="hljs-title function_">next</span>(tabId);
}

<span class="hljs-title function_">ngOnDestroy</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// è·¯ç”±åˆ‡æ¢æ—¶ï¼Œå–æ¶ˆæ‰€æœ‰è®¢é˜…å’Œè¯·æ±‚</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">destroy$</span>.<span class="hljs-title function_">next</span>();
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">destroy$</span>.<span class="hljs-title function_">complete</span>();
  
  <span class="hljs-comment">// å°†æœªå®Œæˆçš„è¯·æ±‚æ ‡è®°ä¸º cancelled</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>) {
      r.<span class="hljs-property">status</span> = <span class="hljs-string">'cancelled'</span>;
      r.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    }
  });
}
</code></pre>
<h3 data-id="heading-6">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-7">1. switchMap çš„è‡ªåŠ¨å–æ¶ˆæœºåˆ¶</h4>
<p>å½“ <code>tabSwitch$</code> å‘å‡ºæ–°çš„æ ‡ç­¾é¡µ ID æ—¶ï¼š</p>
<ol>
<li><code>switchMap</code> è‡ªåŠ¨å–æ¶ˆä¹‹å‰æœªå®Œæˆçš„ HTTP è¯·æ±‚</li>
<li>å¼€å§‹æ–°çš„è¯·æ±‚</li>
<li>åªå¤„ç†æœ€æ–°æ ‡ç­¾é¡µçš„å“åº”</li>
</ol>
<h4 data-id="heading-8">2. è¯·æ±‚è®°å½•ç®¡ç†</h4>
<p>é€šè¿‡ç»´æŠ¤è¯·æ±‚è®°å½•åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
<li>è¿½è¸ªæ¯ä¸ªè¯·æ±‚çš„çŠ¶æ€ï¼ˆpendingã€completedã€cancelledï¼‰</li>
<li>å±•ç¤ºè¯·æ±‚å†å²ï¼Œå¸®åŠ©è°ƒè¯•</li>
<li>åˆ†æå“ªäº›è¯·æ±‚è¢«å–æ¶ˆäº†</li>
</ul>
<h4 data-id="heading-9">3. ç»„ä»¶é”€æ¯æ—¶çš„æ¸…ç†</h4>
<p>åœ¨ <code>ngOnDestroy</code> ä¸­ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>destroy$</code> å–æ¶ˆæ‰€æœ‰è®¢é˜…</li>
<li>å°†æœªå®Œæˆçš„è¯·æ±‚æ ‡è®°ä¸º cancelled</li>
<li>é˜²æ­¢å†…å­˜æ³„æ¼</li>
</ol>
<h4 data-id="heading-10">4. åˆå§‹åŒ–åŠ è½½</h4>
<p>åœ¨ <code>ngOnInit</code> ä¸­è°ƒç”¨ <code>switchTab</code>ï¼Œç¡®ä¿ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µçš„æ•°æ®ä¼šè¢«åŠ è½½ã€‚</p>
<h3 data-id="heading-11">æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h3>
<p>å‡è®¾ç”¨æˆ·çš„æ“ä½œåºåˆ—å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>åˆå§‹åŒ–</strong>ï¼šåŠ è½½æ ‡ç­¾é¡µ 1 çš„æ•°æ®</p>
<ul>
<li>å‘èµ·è¯·æ±‚ Aï¼ˆdelay1ï¼Œ1 ç§’ï¼‰</li>
<li>çŠ¶æ€ï¼špending</li>
</ul>
</li>
<li>
<p><strong>ç”¨æˆ·ç‚¹å‡»æ ‡ç­¾é¡µ 2</strong>ï¼ˆè¯·æ±‚ A è¿˜æœªå®Œæˆï¼‰</p>
<ul>
<li><code>switchMap</code> å–æ¶ˆè¯·æ±‚ A</li>
<li>è¯·æ±‚ A çŠ¶æ€å˜ä¸ºï¼šcancelled</li>
<li>å‘èµ·è¯·æ±‚ Bï¼ˆdelay2ï¼Œ2 ç§’ï¼‰</li>
<li>çŠ¶æ€ï¼špending</li>
</ul>
</li>
<li>
<p><strong>ç”¨æˆ·ç‚¹å‡»æ ‡ç­¾é¡µ 3</strong>ï¼ˆè¯·æ±‚ B è¿˜æœªå®Œæˆï¼‰</p>
<ul>
<li><code>switchMap</code> å–æ¶ˆè¯·æ±‚ B</li>
<li>è¯·æ±‚ B çŠ¶æ€å˜ä¸ºï¼šcancelled</li>
<li>å‘èµ·è¯·æ±‚ Cï¼ˆdelay3ï¼Œ3 ç§’ï¼‰</li>
<li>çŠ¶æ€ï¼špending</li>
</ul>
</li>
<li>
<p><strong>è¯·æ±‚ C å®Œæˆ</strong></p>
<ul>
<li>è¯·æ±‚ C çŠ¶æ€å˜ä¸ºï¼šcompleted</li>
<li>æ˜¾ç¤ºæ ‡ç­¾é¡µ 3 çš„æ•°æ® âœ…</li>
</ul>
</li>
</ol>
<p>æœ€ç»ˆç»“æœï¼šåªæ˜¾ç¤ºæ ‡ç­¾é¡µ 3 çš„æ•°æ®ï¼Œè¯·æ±‚ A å’Œ B éƒ½è¢«å–æ¶ˆäº†ã€‚</p>
<h3 data-id="heading-12">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<h4 data-id="heading-13">æ–¹æ¡ˆ 1ï¼šä¸ä½¿ç”¨ switchMapï¼ˆæœ‰é—®é¢˜ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå¤šä¸ªè¯·æ±‚å¯èƒ½åŒæ—¶å®Œæˆï¼Œå¯¼è‡´æ•°æ®æ··ä¹±</span>
<span class="hljs-title function_">switchTab</span>(<span class="hljs-attr">tabId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeTabId</span> = tabId;
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tabId).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentResult</span> = data; <span class="hljs-comment">// å¯èƒ½æ˜¾ç¤ºæ—§æ ‡ç­¾é¡µçš„æ•°æ®</span>
  });
}
</code></pre>
<h4 data-id="heading-14">æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨å–æ¶ˆè®¢é˜…ï¼ˆå¤æ‚ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âš ï¸ å¯è¡Œä½†å¤æ‚ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†è®¢é˜…</span>
<span class="hljs-keyword">private</span> currentSubscription?: <span class="hljs-title class_">Subscription</span>;

<span class="hljs-title function_">switchTab</span>(<span class="hljs-attr">tabId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// å–æ¶ˆä¹‹å‰çš„è®¢é˜…</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSubscription</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSubscription</span>.<span class="hljs-title function_">unsubscribe</span>();
  }
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">activeTabId</span> = tabId;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSubscription</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tabId).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentResult</span> = data;
  });
}
</code></pre>
<h4 data-id="heading-15">æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ switchMapï¼ˆæ¨èï¼‰âœ…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šç®€æ´ã€è‡ªåŠ¨ç®¡ç†</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">tabSwitch$</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">tabId</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tabId))
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentResult</span> = data; <span class="hljs-comment">// åªæ˜¾ç¤ºæœ€æ–°æ ‡ç­¾é¡µçš„æ•°æ®</span>
});
</code></pre>
<h3 data-id="heading-16">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-17">1. å¤šæ ‡ç­¾é¡µæ•°æ®åŠ è½½</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ ‡ç­¾é¡µç»„ä»¶</span>
tabs = [<span class="hljs-string">'ç”¨æˆ·'</span>, <span class="hljs-string">'è®¢å•'</span>, <span class="hljs-string">'å•†å“'</span>];
activeTab = <span class="hljs-string">'ç”¨æˆ·'</span>;

tabChange$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">tab</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tab))
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabData</span> = data;
});
</code></pre>
<h4 data-id="heading-18">2. è·¯ç”±å‚æ•°å˜åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è·¯ç”±å‚æ•°å˜åŒ–æ—¶ï¼Œå–æ¶ˆä¹‹å‰çš„æ•°æ®è¯·æ±‚</span>
route.<span class="hljs-property">params</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">params</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>(params.<span class="hljs-property">id</span>))
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;
});
</code></pre>
<h4 data-id="heading-19">3. æ¨¡æ€æ¡†å†…å®¹åŠ è½½</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ‰“å¼€ä¸åŒæ¨¡æ€æ¡†æ—¶ï¼Œå–æ¶ˆä¹‹å‰çš„å†…å®¹åŠ è½½</span>
modalOpen$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">modalType</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadModalContent</span>(modalType))
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">content</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">modalContent</span> = content;
});
</code></pre>
<h3 data-id="heading-20">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-21">1. æ·»åŠ ç¼“å­˜æœºåˆ¶</h4>
<p>å¯¹äºä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼Œå¯ä»¥æ·»åŠ ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> tabDataCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;();

<span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">tabId</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">tabDataCache</span>.<span class="hljs-title function_">has</span>(tabId)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tabDataCache</span>.<span class="hljs-title function_">get</span>(tabId));
  }
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tabId).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">tap</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabDataCache</span>.<span class="hljs-title function_">set</span>(tabId, data))
  );
})
</code></pre>
<h4 data-id="heading-22">2. é¢„åŠ è½½ç›¸é‚»æ ‡ç­¾é¡µ</h4>
<p>å¯ä»¥åœ¨ç”¨æˆ·åˆ‡æ¢åˆ°æŸä¸ªæ ‡ç­¾é¡µæ—¶ï¼Œé¢„åŠ è½½ç›¸é‚»æ ‡ç­¾é¡µçš„æ•°æ®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">switchTab</span>(<span class="hljs-attr">tabId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tabSwitch$</span>.<span class="hljs-title function_">next</span>(tabId);
  <span class="hljs-comment">// é¢„åŠ è½½ç›¸é‚»æ ‡ç­¾é¡µ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">preloadAdjacentTabs</span>(tabId);
}
</code></pre>
<h4 data-id="heading-23">3. æ·»åŠ åŠ è½½çŠ¶æ€</h4>
<p>é€šè¿‡ç»´æŠ¤åŠ è½½çŠ¶æ€ï¼Œç»™ç”¨æˆ·æ›´å¥½çš„åé¦ˆï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">tabId</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tabId).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">finalize</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>)
  );
})
</code></pre>
<h3 data-id="heading-24">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å‰¯ä½œç”¨å¤„ç†</strong>ï¼šå¦‚æœè¯·æ±‚æœ‰å‰¯ä½œç”¨ï¼ˆå¦‚åˆ›å»ºèµ„æºï¼‰ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ <code>switchMap</code></li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¢‘ç¹å–æ¶ˆè¯·æ±‚å¯èƒ½ä¼šè®©ç”¨æˆ·å›°æƒ‘ï¼Œéœ€è¦é€‚å½“çš„ UI åé¦ˆ</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†</li>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆæ‰€æœ‰è®¢é˜…</li>
</ol>
<h3 data-id="heading-25">æ€»ç»“</h3>
<p>ä½¿ç”¨ <code>switchMap</code> å¤„ç†æ ‡ç­¾é¡µåˆ‡æ¢æ˜¯ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡è‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„è¯·æ±‚æ¥ç¡®ä¿ï¼š</p>
<ul>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šåªæ˜¾ç¤ºå½“å‰æ ‡ç­¾é¡µçš„æ•°æ®</li>
<li><strong>èµ„æºèŠ‚çº¦</strong>ï¼šå–æ¶ˆä¸å¿…è¦çš„è¯·æ±‚ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›</li>
<li><strong>ä»£ç ç®€æ´</strong>ï¼šä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†è®¢é˜…å’Œå–æ¶ˆé€»è¾‘</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¿å…æ•°æ®æ··ä¹±ï¼Œæä¾›æµç•…çš„äº¤äº’ä½“éªŒ</li>
</ul>
<p>è®°ä½ï¼šå½“ä½ éœ€è¦åœ¨åˆ‡æ¢æ—¶å–æ¶ˆä¹‹å‰çš„æ“ä½œæ—¶ï¼Œä½¿ç”¨ <code>switchMap</code> æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å…­ç« é˜²æŠ–ï¼ˆdebounceï¼‰ä¸èŠ‚æµï¼ˆthrottleï¼‰çš„åº”ç”¨]]></title>    <link>https://juejin.cn/post/7600560664407539775</link>    <guid>https://juejin.cn/post/7600560664407539775</guid>    <pubDate>2026-01-29T09:04:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600560664407539775" data-draft-id="7600587732991197226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å…­ç« é˜²æŠ–ï¼ˆdebounceï¼‰ä¸èŠ‚æµï¼ˆthrottleï¼‰çš„åº”ç”¨"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:04:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å…­ç« é˜²æŠ–ï¼ˆdebounceï¼‰ä¸èŠ‚æµï¼ˆthrottleï¼‰çš„åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:04:24.000Z" title="Thu Jan 29 2026 09:04:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šé˜²æŠ–ï¼ˆdebounceï¼‰ä¸èŠ‚æµï¼ˆthrottleï¼‰çš„åº”ç”¨</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>åœ¨ç”¨æˆ·äº¤äº’é¢‘ç¹çš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚æœç´¢è¾“å…¥æ¡†ã€æ»šåŠ¨äº‹ä»¶ã€çª—å£è°ƒæ•´ç­‰ï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œå¯èƒ½ä¼šè§¦å‘å¤§é‡ä¸å¿…è¦çš„è¯·æ±‚æˆ–è®¡ç®—ã€‚é˜²æŠ–ï¼ˆdebounceï¼‰å’ŒèŠ‚æµï¼ˆthrottleï¼‰æ˜¯ä¸¤ç§å¸¸ç”¨çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶äº‹ä»¶è§¦å‘çš„é¢‘ç‡ã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ RxJS ä¸­ä½¿ç”¨ <code>debounceTime</code> å’Œ <code>throttleTime</code> æ“ä½œç¬¦ã€‚</p>
<h3 data-id="heading-2">é˜²æŠ–ï¼ˆDebounceï¼‰vs èŠ‚æµï¼ˆThrottleï¼‰</h3>
<h4 data-id="heading-3">é˜²æŠ–ï¼ˆDebounceï¼‰</h4>
<p><strong>å®šä¹‰</strong>ï¼šåœ¨äº‹ä»¶è¢«è§¦å‘åï¼Œç­‰å¾…ä¸€å®šæ—¶é—´ï¼ˆå¦‚ 500msï¼‰ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰å†æ¬¡è§¦å‘äº‹ä»¶ï¼Œæ‰æ‰§è¡Œæ“ä½œã€‚å¦‚æœåœ¨ç­‰å¾…æœŸé—´åˆè§¦å‘äº†äº‹ä»¶ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚</p>
<p><strong>å½¢è±¡æ¯”å–»</strong>ï¼šå°±åƒç”µæ¢¯é—¨ï¼Œå½“æœ‰äººè¿›å…¥æ—¶ï¼Œç”µæ¢¯é—¨ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…åˆæœ‰äººè¿›å…¥ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚åªæœ‰å½“ç­‰å¾…æ—¶é—´å†…æ²¡æœ‰äººè¿›å…¥æ—¶ï¼Œç”µæ¢¯é—¨æ‰å…³é—­ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>æœç´¢è¾“å…¥æ¡†ï¼šç”¨æˆ·åœæ­¢è¾“å…¥åæ‰å‘èµ·æœç´¢è¯·æ±‚</li>
<li>çª—å£è°ƒæ•´ï¼šç”¨æˆ·åœæ­¢è°ƒæ•´çª—å£å¤§å°åæ‰é‡æ–°è®¡ç®—å¸ƒå±€</li>
<li>è¡¨å•éªŒè¯ï¼šç”¨æˆ·åœæ­¢è¾“å…¥åæ‰è¿›è¡ŒéªŒè¯</li>
</ul>
<h4 data-id="heading-4">èŠ‚æµï¼ˆThrottleï¼‰</h4>
<p><strong>å®šä¹‰</strong>ï¼šåœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…ï¼Œæ— è®ºäº‹ä»¶è§¦å‘å¤šå°‘æ¬¡ï¼Œåªæ‰§è¡Œä¸€æ¬¡æ“ä½œã€‚</p>
<p><strong>å½¢è±¡æ¯”å–»</strong>ï¼šå°±åƒæ°´é¾™å¤´ï¼Œæ— è®ºä½ æ‹§å¤šå°‘æ¬¡ï¼Œæ°´æµçš„é¢‘ç‡æ˜¯å›ºå®šçš„ï¼ˆæ¯”å¦‚æ¯ç§’æµä¸€æ¬¡ï¼‰ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>æ»šåŠ¨äº‹ä»¶ï¼šæ»šåŠ¨æ—¶æ¯ 100ms æ›´æ–°ä¸€æ¬¡ä½ç½®</li>
<li>é¼ æ ‡ç§»åŠ¨ï¼šé¼ æ ‡ç§»åŠ¨æ—¶æ¯ 50ms æ›´æ–°ä¸€æ¬¡åæ ‡</li>
<li>æŒ‰é’®ç‚¹å‡»ï¼šé˜²æ­¢ç”¨æˆ·å¿«é€Ÿé‡å¤ç‚¹å‡»</li>
</ul>
<h3 data-id="heading-5">debounceTime æ“ä½œç¬¦</h3>
<p><code>debounceTime</code> ä¼šå»¶è¿Ÿå€¼çš„å‘å‡ºï¼Œç›´åˆ°æº Observable åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å‘å‡ºæ–°å€¼ã€‚</p>
<h4 data-id="heading-6">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">source$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">500</span>) <span class="hljs-comment">// 500ms å†…æ²¡æœ‰æ–°å€¼æ‰å‘å‡º</span>
)
</code></pre>
<h4 data-id="heading-7">å®æˆ˜åœºæ™¯ï¼šæœç´¢è¾“å…¥æ¡†</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæœç´¢è¾“å…¥æ¡†ï¼Œç”¨æˆ·è¾“å…¥æ—¶ä¼šè§¦å‘æœç´¢è¯·æ±‚ã€‚ä½¿ç”¨ <code>debounceTime</code> å¯ä»¥ç¡®ä¿åªåœ¨ç”¨æˆ·åœæ­¢è¾“å…¥åæ‰å‘èµ·è¯·æ±‚ã€‚</p>
<h4 data-id="heading-8">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é˜²æŠ–è¾“å…¥æ¡†</span>
debounceInput = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(<span class="hljs-string">''</span>);

<span class="hljs-title function_">ngOnInit</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// é˜²æŠ–è¾“å…¥æ¡†ï¼šä½¿ç”¨ debounceTimeï¼Œåœæ­¢è¾“å…¥ 500ms åå‘èµ·è¯·æ±‚</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceInput</span>.<span class="hljs-property">valueChanges</span>
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">distinctUntilChanged</span>(), <span class="hljs-comment">// åªæœ‰å€¼çœŸæ­£æ”¹å˜æ—¶æ‰è§¦å‘</span>
      <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">500</span>), <span class="hljs-comment">// é˜²æŠ–ï¼šåœæ­¢è¾“å…¥ 500ms åæ‰è§¦å‘</span>
      <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">(<span class="hljs-params">query</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!query || query.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
        }
        
        <span class="hljs-keyword">const</span> recordId = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">requestCounter</span>;
        <span class="hljs-keyword">const</span> <span class="hljs-attr">record</span>: <span class="hljs-title class_">RequestRecord</span> = {
          <span class="hljs-attr">id</span>: recordId,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'debounce'</span>,
          <span class="hljs-attr">query</span>: query.<span class="hljs-title function_">trim</span>(),
          <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceRecords</span>.<span class="hljs-title function_">unshift</span>(record);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceLoading</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        
        <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpParams</span>().<span class="hljs-title function_">set</span>(<span class="hljs-string">'q'</span>, query.<span class="hljs-title function_">trim</span>());
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">SearchApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span>/api/search`</span>, { params })
          .<span class="hljs-title function_">pipe</span>(
            <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'é˜²æŠ–è¯·æ±‚å¤±è´¥:'</span>, err);
              record.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>;
              <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({
                <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>,
                <span class="hljs-attr">data</span>: {
                  <span class="hljs-attr">query</span>: query.<span class="hljs-title function_">trim</span>(),
                  <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                  <span class="hljs-attr">results</span>: []
                }
              } <span class="hljs-keyword">as</span> <span class="hljs-title class_">SearchApiResponse</span>);
            })
          );
      }),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroySubject$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response === <span class="hljs-literal">null</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceLoading</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
          <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">const</span> latestRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceRecords</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> !r.<span class="hljs-property">response</span> &amp;&amp; !r.<span class="hljs-property">error</span>);
        <span class="hljs-keyword">if</span> (latestRecord) {
          latestRecord.<span class="hljs-property">response</span> = response;
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceCurrentResult</span> = response;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">debounceLoading</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
      }
    });
}
</code></pre>
<h4 data-id="heading-9">æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h4>
<p>å‡è®¾ç”¨æˆ·è¾“å…¥ "rxjs"ï¼š</p>
<ol>
<li>ç”¨æˆ·è¾“å…¥ "r" â†’ ç­‰å¾… 500ms</li>
<li>ç”¨æˆ·è¾“å…¥ "x"ï¼ˆåœ¨ 500ms å†…ï¼‰â†’ é‡æ–°è®¡æ—¶ï¼Œç­‰å¾… 500ms</li>
<li>ç”¨æˆ·è¾“å…¥ "j"ï¼ˆåœ¨ 500ms å†…ï¼‰â†’ é‡æ–°è®¡æ—¶ï¼Œç­‰å¾… 500ms</li>
<li>ç”¨æˆ·è¾“å…¥ "s"ï¼ˆåœ¨ 500ms å†…ï¼‰â†’ é‡æ–°è®¡æ—¶ï¼Œç­‰å¾… 500ms</li>
<li>ç”¨æˆ·åœæ­¢è¾“å…¥ â†’ 500ms åå‘èµ·æœç´¢è¯·æ±‚ âœ…</li>
</ol>
<p><strong>ç»“æœ</strong>ï¼šåªå‘èµ· 1 æ¬¡è¯·æ±‚ï¼Œæœç´¢ "rxjs"</p>
<h3 data-id="heading-10">throttleTime æ“ä½œç¬¦</h3>
<p><code>throttleTime</code> ä¼šåœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…ï¼Œåªå‘å‡ºç¬¬ä¸€ä¸ªå€¼ï¼Œå¿½ç•¥åç»­çš„å€¼ã€‚</p>
<h4 data-id="heading-11">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">source$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">500</span>) <span class="hljs-comment">// æ¯ 500ms æœ€å¤šå‘å‡ºä¸€æ¬¡</span>
)
</code></pre>
<h4 data-id="heading-12">å®æˆ˜åœºæ™¯ï¼šæœç´¢è¾“å…¥æ¡†ï¼ˆèŠ‚æµç‰ˆæœ¬ï¼‰</h4>
<p>ä½¿ç”¨ <code>throttleTime</code> å¯ä»¥ç¡®ä¿åœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…æœ€å¤šå‘èµ·ä¸€æ¬¡è¯·æ±‚ã€‚</p>
<h4 data-id="heading-13">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// èŠ‚æµè¾“å…¥æ¡†</span>
throttleInput = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormControl</span>(<span class="hljs-string">''</span>);

<span class="hljs-title function_">ngOnInit</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// èŠ‚æµè¾“å…¥æ¡†ï¼šä½¿ç”¨ throttleTimeï¼Œæ¯ 500ms æœ€å¤šè§¦å‘ä¸€æ¬¡</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleInput</span>.<span class="hljs-property">valueChanges</span>
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">distinctUntilChanged</span>(), <span class="hljs-comment">// åªæœ‰å€¼çœŸæ­£æ”¹å˜æ—¶æ‰è§¦å‘</span>
      <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">500</span>), <span class="hljs-comment">// èŠ‚æµï¼šæ¯ 500ms æœ€å¤šè§¦å‘ä¸€æ¬¡</span>
      <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">(<span class="hljs-params">query</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!query || query.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
        }
        
        <span class="hljs-keyword">const</span> recordId = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">requestCounter</span>;
        <span class="hljs-keyword">const</span> <span class="hljs-attr">record</span>: <span class="hljs-title class_">RequestRecord</span> = {
          <span class="hljs-attr">id</span>: recordId,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'throttle'</span>,
          <span class="hljs-attr">query</span>: query.<span class="hljs-title function_">trim</span>(),
          <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleRecords</span>.<span class="hljs-title function_">unshift</span>(record);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleLoading</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        
        <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpParams</span>().<span class="hljs-title function_">set</span>(<span class="hljs-string">'q'</span>, query.<span class="hljs-title function_">trim</span>());
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">SearchApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span>/api/search`</span>, { params })
          .<span class="hljs-title function_">pipe</span>(
            <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'èŠ‚æµè¯·æ±‚å¤±è´¥:'</span>, err);
              record.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>;
              <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({
                <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>,
                <span class="hljs-attr">data</span>: {
                  <span class="hljs-attr">query</span>: query.<span class="hljs-title function_">trim</span>(),
                  <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                  <span class="hljs-attr">results</span>: []
                }
              } <span class="hljs-keyword">as</span> <span class="hljs-title class_">SearchApiResponse</span>);
            })
          );
      }),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroySubject$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-comment">// å¤„ç†å“åº”...</span>
      }
    });
}
</code></pre>
<h4 data-id="heading-14">æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h4>
<p>å‡è®¾ç”¨æˆ·å¿«é€Ÿè¾“å…¥ "rxjs"ï¼ˆæ¯ä¸ªå­—ç¬¦é—´éš” 100msï¼‰ï¼š</p>
<ol>
<li>ç”¨æˆ·è¾“å…¥ "r" â†’ ç«‹å³å‘èµ·è¯·æ±‚ï¼Œæœç´¢ "r"</li>
<li>ç”¨æˆ·è¾“å…¥ "x"ï¼ˆ100ms åï¼‰â†’ è¢«å¿½ç•¥ï¼ˆåœ¨ 500ms å†…ï¼‰</li>
<li>ç”¨æˆ·è¾“å…¥ "j"ï¼ˆ200ms åï¼‰â†’ è¢«å¿½ç•¥ï¼ˆåœ¨ 500ms å†…ï¼‰</li>
<li>ç”¨æˆ·è¾“å…¥ "s"ï¼ˆ300ms åï¼‰â†’ è¢«å¿½ç•¥ï¼ˆåœ¨ 500ms å†…ï¼‰</li>
<li>500ms å â†’ å¯ä»¥å‘èµ·æ–°è¯·æ±‚</li>
<li>ç”¨æˆ·è¾“å…¥å…¶ä»–å­—ç¬¦ â†’ ç«‹å³å‘èµ·è¯·æ±‚</li>
</ol>
<p><strong>ç»“æœ</strong>ï¼šå¯èƒ½å‘èµ·å¤šæ¬¡è¯·æ±‚ï¼Œä½†æ¯ 500ms æœ€å¤šä¸€æ¬¡</p>
<h3 data-id="heading-15">å¯¹æ¯”æ€»ç»“</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>debounceTime</th><th>throttleTime</th></tr></thead><tbody><tr><td><strong>è§¦å‘æ—¶æœº</strong></td><td>åœæ­¢è§¦å‘åç­‰å¾…ä¸€æ®µæ—¶é—´</td><td>å›ºå®šæ—¶é—´é—´éš”å†…è§¦å‘ä¸€æ¬¡</td></tr><tr><td><strong>è¯·æ±‚æ¬¡æ•°</strong></td><td>é€šå¸¸æ›´å°‘ï¼ˆåªåœ¨åœæ­¢åè§¦å‘ï¼‰</td><td>å¯èƒ½æ›´å¤šï¼ˆå›ºå®šé—´éš”è§¦å‘ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æœç´¢è¾“å…¥æ¡†ã€çª—å£è°ƒæ•´</td><td>æ»šåŠ¨äº‹ä»¶ã€é¼ æ ‡ç§»åŠ¨</td></tr><tr><td><strong>ç”¨æˆ·ä½“éªŒ</strong></td><td>ç­‰å¾…ç”¨æˆ·å®Œæˆæ“ä½œ</td><td>å®æ—¶åé¦ˆä½†æœ‰é™åˆ¶</td></tr></tbody></table>
<h3 data-id="heading-16">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-17">1. æœç´¢è¾“å…¥æ¡†ï¼ˆæ¨èé˜²æŠ–ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript">searchInput.<span class="hljs-property">valueChanges</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>),
  <span class="hljs-title function_">distinctUntilChanged</span>(),
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">query</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchService</span>.<span class="hljs-title function_">search</span>(query))
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchResults</span> = results;
});
</code></pre>
<h4 data-id="heading-18">2. æ»šåŠ¨äº‹ä»¶ï¼ˆæ¨èèŠ‚æµï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">window</span>, <span class="hljs-string">'scroll'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">100</span>)
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateScrollPosition</span>();
});
</code></pre>
<h4 data-id="heading-19">3. çª—å£è°ƒæ•´ï¼ˆæ¨èé˜²æŠ–ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">window</span>, <span class="hljs-string">'resize'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>)
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">recalculateLayout</span>();
});
</code></pre>
<h4 data-id="heading-20">4. æŒ‰é’®ç‚¹å‡»ï¼ˆæ¨èèŠ‚æµï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript">buttonClick$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 1 ç§’å†…æœ€å¤šç‚¹å‡»ä¸€æ¬¡</span>
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">submitForm</span>();
});
</code></pre>
<h3 data-id="heading-21">ç»„åˆä½¿ç”¨</h3>
<h4 data-id="heading-22">é˜²æŠ– + switchMap</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æœç´¢è¾“å…¥æ¡†ï¼šé˜²æŠ– + å–æ¶ˆä¹‹å‰çš„è¯·æ±‚</span>
searchInput.<span class="hljs-property">valueChanges</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>),
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">query</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">search</span>(query))
)
</code></pre>
<h4 data-id="heading-23">èŠ‚æµ + distinctUntilChanged</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ»šåŠ¨äº‹ä»¶ï¼šèŠ‚æµ + å»é‡</span>
scroll$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">100</span>),
  <span class="hljs-title function_">distinctUntilChanged</span>()
)
</code></pre>
<h3 data-id="heading-24">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-25">1. åˆç†è®¾ç½®æ—¶é—´é—´éš”</h4>
<ul>
<li><strong>æœç´¢è¾“å…¥æ¡†</strong>ï¼š300-500msï¼ˆç»™ç”¨æˆ·è¶³å¤Ÿçš„è¾“å…¥æ—¶é—´ï¼‰</li>
<li><strong>æ»šåŠ¨äº‹ä»¶</strong>ï¼š50-100msï¼ˆä¿æŒæµç•…æ€§ï¼‰</li>
<li><strong>çª—å£è°ƒæ•´</strong>ï¼š300-500msï¼ˆé¿å…é¢‘ç¹è®¡ç®—ï¼‰</li>
</ul>
<h4 data-id="heading-26">2. ç»“åˆ distinctUntilChanged</h4>
<p>ä½¿ç”¨ <code>distinctUntilChanged</code> å¯ä»¥é¿å…ç›¸åŒå€¼çš„é‡å¤å¤„ç†ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">input$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">distinctUntilChanged</span>(),
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>)
)
</code></pre>
<h4 data-id="heading-27">3. ç»“åˆ switchMap</h4>
<p>ä½¿ç”¨ <code>switchMap</code> å¯ä»¥å–æ¶ˆä¹‹å‰çš„è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">input$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>),
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">query</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">search</span>(query))
)
</code></pre>
<h3 data-id="heading-28">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>æ—¶é—´é—´éš”é€‰æ‹©</strong>ï¼šæ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„é—´éš”æ—¶é—´</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé˜²æŠ–å¯èƒ½ä¼šè®©ç”¨æˆ·æ„Ÿè§‰å“åº”æ…¢ï¼Œéœ€è¦é€‚å½“çš„åŠ è½½æç¤º</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†</li>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆè®¢é˜…</li>
</ol>
<h3 data-id="heading-29">æ€»ç»“</h3>
<p>é˜²æŠ–å’ŒèŠ‚æµæ˜¯ä¼˜åŒ–ç”¨æˆ·äº¤äº’çš„é‡è¦æŠ€æœ¯ï¼š</p>
<ul>
<li><strong>é˜²æŠ–ï¼ˆdebounceTimeï¼‰</strong>ï¼šé€‚åˆ"ç­‰å¾…ç”¨æˆ·å®Œæˆæ“ä½œ"çš„åœºæ™¯ï¼Œå¦‚æœç´¢è¾“å…¥æ¡†</li>
<li><strong>èŠ‚æµï¼ˆthrottleTimeï¼‰</strong>ï¼šé€‚åˆ"éœ€è¦å®æ—¶åé¦ˆä½†æœ‰é™åˆ¶"çš„åœºæ™¯ï¼Œå¦‚æ»šåŠ¨äº‹ä»¶</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨å¤šä¸ªæ“ä½œç¬¦æ¥è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚è®°ä½ï¼š<strong>é˜²æŠ–æ˜¯ç­‰å¾…ï¼ŒèŠ‚æµæ˜¯é™åˆ¶é¢‘ç‡</strong>ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å››ç« ä½¿ç”¨ switchMap å¤„ç†è¯·æ±‚ç«æ€æ¡ä»¶]]></title>    <link>https://juejin.cn/post/7600602502632718377</link>    <guid>https://juejin.cn/post/7600602502632718377</guid>    <pubDate>2026-01-29T09:02:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600602502632718377" data-draft-id="7600562816458407978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å››ç« ä½¿ç”¨ switchMap å¤„ç†è¯·æ±‚ç«æ€æ¡ä»¶"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:02:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å››ç« ä½¿ç”¨ switchMap å¤„ç†è¯·æ±‚ç«æ€æ¡ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:02:37.000Z" title="Thu Jan 29 2026 09:02:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ switchMap å¤„ç†è¯·æ±‚ç«æ€æ¡ä»¶</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>åœ¨ç”¨æˆ·äº¤äº’é¢‘ç¹çš„åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰é—®é¢˜ã€‚æ¯”å¦‚ç”¨æˆ·å¿«é€Ÿç‚¹å‡»æŒ‰é’®ï¼Œæˆ–è€…è¾“å…¥æ¡†å¿«é€Ÿè¾“å…¥ï¼Œå¯èƒ½ä¼šè§¦å‘å¤šä¸ªè¯·æ±‚ï¼Œè€Œè¿™äº›è¯·æ±‚çš„å“åº”é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ RxJS çš„ <code>switchMap</code> æ“ä½œç¬¦æ¥ä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶ï¼Ÿ</h3>
<p>ç«æ€æ¡ä»¶æ˜¯æŒ‡å¤šä¸ªå¼‚æ­¥æ“ä½œåŒæ—¶è¿›è¡Œï¼Œä½†å®ƒä»¬çš„å®Œæˆé¡ºåºä¸ç¡®å®šï¼Œå¯¼è‡´æœ€ç»ˆç»“æœå¯èƒ½ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œå¸¸è§çš„ç«æ€æ¡ä»¶åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>å¿«é€Ÿç‚¹å‡»æŒ‰é’®</strong>ï¼šç”¨æˆ·å¿«é€Ÿç‚¹å‡»"æœç´¢"æŒ‰é’®ï¼Œè§¦å‘å¤šä¸ªæœç´¢è¯·æ±‚</li>
<li><strong>è¾“å…¥æ¡†è¾“å…¥</strong>ï¼šç”¨æˆ·å¿«é€Ÿè¾“å…¥ï¼Œæ¯æ¬¡è¾“å…¥éƒ½è§¦å‘è¯·æ±‚</li>
<li><strong>æ ‡ç­¾é¡µåˆ‡æ¢</strong>ï¼šç”¨æˆ·å¿«é€Ÿåˆ‡æ¢æ ‡ç­¾é¡µï¼Œæ¯ä¸ªæ ‡ç­¾é¡µéƒ½å‘èµ·æ•°æ®è¯·æ±‚</li>
</ol>
<h3 data-id="heading-3">switchMap æ“ä½œç¬¦ç®€ä»‹</h3>
<p><code>switchMap</code> æ˜¯ RxJS ä¸­å¤„ç†ç«æ€æ¡ä»¶çš„åˆ©å™¨ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å½“æ–°çš„å€¼åˆ°è¾¾æ—¶ï¼Œä¼šè‡ªåŠ¨å–æ¶ˆä¹‹å‰æœªå®Œæˆçš„å†…éƒ¨ Observable</strong>ã€‚</p>
<h4 data-id="heading-4">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">source$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-title function_">createObservable</span>(value))
)
</code></pre>
<h4 data-id="heading-5">å…³é”®ç‰¹æ€§</h4>
<ol>
<li><strong>è‡ªåŠ¨å–æ¶ˆ</strong>ï¼šæ–°çš„å€¼åˆ°è¾¾æ—¶ï¼Œè‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„ Observable</li>
<li><strong>åªä¿ç•™æœ€æ–°</strong>ï¼šåªå¤„ç†æœ€æ–°çš„è¯·æ±‚ï¼Œå¿½ç•¥ä¹‹å‰çš„è¯·æ±‚</li>
<li><strong>é¿å…ç«æ€</strong>ï¼šç¡®ä¿æœ€ç»ˆç»“æœå¯¹åº”æœ€æ–°çš„æ“ä½œ</li>
</ol>
<h3 data-id="heading-6">å®æˆ˜åœºæ™¯ï¼šå¤„ç†å¿«é€Ÿç‚¹å‡»è¯·æ±‚</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åä¼šéšæœºè°ƒç”¨ä¸åŒçš„ APIï¼ˆdelay1ã€delay2ã€delay3ï¼‰ã€‚å¦‚æœç”¨æˆ·å¿«é€Ÿç‚¹å‡»ï¼Œæˆ‘ä»¬å¸Œæœ›åªå¤„ç†æœ€åä¸€æ¬¡ç‚¹å‡»çš„è¯·æ±‚ã€‚</p>
<h4 data-id="heading-7">å®ç°æ€è·¯</h4>
<ol>
<li>ä½¿ç”¨ <code>Subject</code> ä½œä¸ºè¯·æ±‚è§¦å‘å™¨</li>
<li>ä½¿ç”¨ <code>switchMap</code> å¤„ç†è¯·æ±‚ï¼Œè‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„è¯·æ±‚</li>
<li>è®°å½•è¯·æ±‚å†å²ï¼Œå±•ç¤ºå“ªäº›è¯·æ±‚è¢«å–æ¶ˆäº†</li>
</ol>
<h4 data-id="heading-8">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è¯·æ±‚è§¦å‘ Subject</span>
<span class="hljs-keyword">private</span> requestTrigger$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">string</span>&gt;();

<span class="hljs-comment">// é”€æ¯ Subject</span>
<span class="hljs-keyword">private</span> destroy$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-title function_">ngOnInit</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// ä½¿ç”¨ switchMap å¤„ç†è¯·æ±‚ç«æ€æ¡ä»¶</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestTrigger$</span>
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">(<span class="hljs-params">apiUrl</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> api = <span class="hljs-variable language_">this</span>.<span class="hljs-property">apis</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">url</span> === apiUrl);
        <span class="hljs-keyword">const</span> apiName = api?.<span class="hljs-property">name</span> || <span class="hljs-string">'unknown'</span>;
        
        <span class="hljs-comment">// åˆ›å»ºè¯·æ±‚è®°å½•</span>
        <span class="hljs-keyword">const</span> recordId = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">requestCounter</span>;
        <span class="hljs-keyword">const</span> <span class="hljs-attr">record</span>: <span class="hljs-title class_">RequestRecord</span> = {
          <span class="hljs-attr">id</span>: recordId,
          apiName,
          apiUrl,
          <span class="hljs-attr">startTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
          <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>
        };
        
        <span class="hljs-comment">// å°†ä¹‹å‰çš„ pending è¯·æ±‚æ ‡è®°ä¸º cancelled</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>) {
            r.<span class="hljs-property">status</span> = <span class="hljs-string">'cancelled'</span>;
            r.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          }
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">unshift</span>(record);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentApiName</span> = apiName;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">DelayApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span><span class="hljs-subst">${apiUrl}</span>`</span>)
          .<span class="hljs-title function_">pipe</span>(
            <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
              <span class="hljs-comment">// æ•è·é”™è¯¯</span>
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`è¯·æ±‚ <span class="hljs-subst">${apiUrl}</span> å¤±è´¥:`</span>, err);
              <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({
                <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>,
                <span class="hljs-attr">data</span>: {
                  <span class="hljs-attr">delay</span>: <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>,
                  <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                  <span class="hljs-attr">info</span>: <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>
                }
              } <span class="hljs-keyword">as</span> <span class="hljs-title class_">DelayApiResponse</span>);
            })
          );
      }),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroy$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-comment">// æ‰¾åˆ°æœ€æ–°çš„ pending è¯·æ±‚è®°å½•</span>
        <span class="hljs-keyword">const</span> latestRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>);
        <span class="hljs-keyword">if</span> (latestRecord) {
          latestRecord.<span class="hljs-property">status</span> = <span class="hljs-string">'completed'</span>;
          latestRecord.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          latestRecord.<span class="hljs-property">response</span> = response;
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentResult</span> = response;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
      },
      <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-comment">// å¤„ç†é”™è¯¯</span>
        <span class="hljs-keyword">const</span> latestRecord = <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestRecords</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>);
        <span class="hljs-keyword">if</span> (latestRecord) {
          latestRecord.<span class="hljs-property">status</span> = <span class="hljs-string">'completed'</span>;
          latestRecord.<span class="hljs-property">endTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
          latestRecord.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>;
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
      }
    });
}

<span class="hljs-comment">// è§¦å‘è¯·æ±‚</span>
<span class="hljs-title function_">triggerRequest</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> randomApi = <span class="hljs-variable language_">this</span>.<span class="hljs-property">apis</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">apis</span>.<span class="hljs-property">length</span>)];
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestTrigger$</span>.<span class="hljs-title function_">next</span>(randomApi.<span class="hljs-property">url</span>);
}
</code></pre>
<h3 data-id="heading-9">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-10">1. switchMap çš„å–æ¶ˆæœºåˆ¶</h4>
<p>å½“ <code>requestTrigger$</code> å‘å‡ºæ–°å€¼æ—¶ï¼Œ<code>switchMap</code> ä¼šï¼š</p>
<ol>
<li>å–æ¶ˆä¹‹å‰æœªå®Œæˆçš„ HTTP è¯·æ±‚ï¼ˆå¦‚æœå¯èƒ½ï¼‰</li>
<li>å¼€å§‹æ–°çš„è¯·æ±‚</li>
<li>åªå¤„ç†æœ€æ–°è¯·æ±‚çš„å“åº”</li>
</ol>
<h4 data-id="heading-11">2. è¯·æ±‚è®°å½•ç®¡ç†</h4>
<p>é€šè¿‡ç»´æŠ¤è¯·æ±‚è®°å½•åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>
<ul>
<li>è¿½è¸ªæ¯ä¸ªè¯·æ±‚çš„çŠ¶æ€ï¼ˆpendingã€completedã€cancelledï¼‰</li>
<li>å±•ç¤ºè¯·æ±‚å†å²</li>
<li>åˆ†æå“ªäº›è¯·æ±‚è¢«å–æ¶ˆäº†</li>
</ul>
<h4 data-id="heading-12">3. é”™è¯¯å¤„ç†</h4>
<p>ä½¿ç”¨ <code>catchError</code> ç¡®ä¿å•ä¸ªè¯·æ±‚çš„é”™è¯¯ä¸ä¼šä¸­æ–­æ•´ä¸ªæµï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯å“åº”å¯¹è±¡ã€‚</p>
<h3 data-id="heading-13">ä¸å…¶ä»–æ“ä½œç¬¦çš„å¯¹æ¯”</h3>
<h4 data-id="heading-14">switchMap vs mergeMap</h4>

























<table><thead><tr><th>ç‰¹æ€§</th><th>switchMap</th><th>mergeMap</th></tr></thead><tbody><tr><td>è¡Œä¸º</td><td>å–æ¶ˆä¹‹å‰çš„è¯·æ±‚</td><td>å¹¶å‘æ‰§è¡Œæ‰€æœ‰è¯·æ±‚</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>åªéœ€è¦æœ€æ–°ç»“æœ</td><td>éœ€è¦æ‰€æœ‰ç»“æœ</td></tr><tr><td>èµ„æºå ç”¨</td><td>ä½ï¼ˆåªä¿ç•™ä¸€ä¸ªè¯·æ±‚ï¼‰</td><td>é«˜ï¼ˆå¯èƒ½å¤šä¸ªè¯·æ±‚ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-15">switchMap vs concatMap</h4>

























<table><thead><tr><th>ç‰¹æ€§</th><th>switchMap</th><th>concatMap</th></tr></thead><tbody><tr><td>è¡Œä¸º</td><td>å–æ¶ˆä¹‹å‰çš„è¯·æ±‚</td><td>æŒ‰é¡ºåºæ‰§è¡Œ</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>åªéœ€è¦æœ€æ–°ç»“æœ</td><td>éœ€è¦ä¿è¯é¡ºåº</td></tr><tr><td>æ‰§è¡Œæ–¹å¼</td><td>ä¸­æ–­ä¹‹å‰çš„è¯·æ±‚</td><td>ç­‰å¾…ä¹‹å‰çš„è¯·æ±‚å®Œæˆ</td></tr></tbody></table>
<h3 data-id="heading-16">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-17">1. æœç´¢è¾“å…¥æ¡†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç”¨æˆ·è¾“å…¥æ—¶ï¼Œåªå¤„ç†æœ€æ–°çš„æœç´¢è¯·æ±‚</span>
searchInput.<span class="hljs-property">valueChanges</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>), <span class="hljs-comment">// é˜²æŠ–</span>
  <span class="hljs-title function_">distinctUntilChanged</span>(), <span class="hljs-comment">// å»é‡</span>
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">query</span> =&gt;</span> 
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchService</span>.<span class="hljs-title function_">search</span>(query)
  )
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  <span class="hljs-comment">// åªæ˜¾ç¤ºæœ€æ–°æœç´¢çš„ç»“æœ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchResults</span> = results;
});
</code></pre>
<h4 data-id="heading-18">2. æ ‡ç­¾é¡µåˆ‡æ¢</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ‡æ¢æ ‡ç­¾æ—¶ï¼Œå–æ¶ˆä¹‹å‰æ ‡ç­¾çš„æ•°æ®è¯·æ±‚</span>
tabSwitch$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">tabId</span> =&gt;</span> 
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadTabData</span>(tabId)
  )
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// åªæ˜¾ç¤ºå½“å‰æ ‡ç­¾çš„æ•°æ®</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTabData</span> = data;
});
</code></pre>
<h4 data-id="heading-19">3. è·¯ç”±å‚æ•°å˜åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è·¯ç”±å‚æ•°å˜åŒ–æ—¶ï¼Œå–æ¶ˆä¹‹å‰çš„æ•°æ®è¯·æ±‚</span>
route.<span class="hljs-property">params</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">params</span> =&gt;</span> 
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>(params.<span class="hljs-property">id</span>)
  )
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// åªæ˜¾ç¤ºæœ€æ–°è·¯ç”±çš„æ•°æ®</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;
});
</code></pre>
<h3 data-id="heading-20">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-21">1. ç»“åˆé˜²æŠ–ä½¿ç”¨</h4>
<p>å¯¹äºè¾“å…¥æ¡†åœºæ™¯ï¼Œå¯ä»¥ç»“åˆ <code>debounceTime</code> ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">input$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>),
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(value))
)
</code></pre>
<h4 data-id="heading-22">2. æ·»åŠ åŠ è½½çŠ¶æ€</h4>
<p>é€šè¿‡ç»´æŠ¤åŠ è½½çŠ¶æ€ï¼Œå¯ä»¥ç»™ç”¨æˆ·æ›´å¥½çš„åé¦ˆï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">apiUrl</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(apiUrl).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">finalize</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>)
  );
})
</code></pre>
<h4 data-id="heading-23">3. é”™è¯¯é‡è¯•</h4>
<p>å¯¹äºå¯èƒ½å¤±è´¥çš„è¯·æ±‚ï¼Œå¯ä»¥æ·»åŠ é‡è¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">apiUrl</span> =&gt;</span> 
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(apiUrl).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">retry</span>(<span class="hljs-number">2</span>),
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>))
  )
)
</code></pre>
<h3 data-id="heading-24">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å–æ¶ˆè¯·æ±‚çš„é™åˆ¶</strong>ï¼šHTTP è¯·æ±‚çš„å–æ¶ˆå–å†³äºæµè§ˆå™¨å’Œ HTTP å®¢æˆ·ç«¯çš„æ”¯æŒ</li>
<li><strong>å‰¯ä½œç”¨å¤„ç†</strong>ï¼šå¦‚æœè¯·æ±‚æœ‰å‰¯ä½œç”¨ï¼ˆå¦‚åˆ›å»ºèµ„æºï¼‰ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ <code>switchMap</code></li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¢‘ç¹å–æ¶ˆè¯·æ±‚å¯èƒ½ä¼šè®©ç”¨æˆ·å›°æƒ‘ï¼Œéœ€è¦é€‚å½“çš„ UI åé¦ˆ</li>
</ol>
<h3 data-id="heading-25">æ€»ç»“</h3>
<p><code>switchMap</code> æ˜¯å¤„ç†ç«æ€æ¡ä»¶çš„å¼ºå¤§å·¥å…·ï¼Œå®ƒé€šè¿‡è‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„è¯·æ±‚æ¥ç¡®ä¿åªå¤„ç†æœ€æ–°çš„æ“ä½œã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåˆç†ä½¿ç”¨ <code>switchMap</code> å¯ä»¥ï¼š</p>
<ul>
<li><strong>é¿å…ç«æ€æ¡ä»¶</strong>ï¼šç¡®ä¿ç»“æœå¯¹åº”æœ€æ–°çš„æ“ä½œ</li>
<li><strong>èŠ‚çœèµ„æº</strong>ï¼šå–æ¶ˆä¸å¿…è¦çš„è¯·æ±‚ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›</li>
<li><strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼šåªæ˜¾ç¤ºæœ€æ–°çš„ç»“æœï¼Œé¿å…æ··ä¹±</li>
</ul>
<p>è®°ä½ï¼šå½“ä½ åªéœ€è¦æœ€æ–°ç»“æœæ—¶ï¼Œä½¿ç”¨ <code>switchMap</code>ï¼›å½“ä½ éœ€è¦æ‰€æœ‰ç»“æœæ—¶ï¼Œä½¿ç”¨ <code>mergeMap</code> æˆ– <code>forkJoin</code>ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¸ƒç« ä½¿ç”¨ shareReplay å®ç° Token åˆ·æ–°çš„å¹¶å‘æ§åˆ¶]]></title>    <link>https://juejin.cn/post/7600587732991262762</link>    <guid>https://juejin.cn/post/7600587732991262762</guid>    <pubDate>2026-01-29T09:05:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600587732991262762" data-draft-id="7600562816458440746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¸ƒç« ä½¿ç”¨ shareReplay å®ç° Token åˆ·æ–°çš„å¹¶å‘æ§åˆ¶"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:05:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¸ƒç« ä½¿ç”¨ shareReplay å®ç° Token åˆ·æ–°çš„å¹¶å‘æ§åˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:05:16.000Z" title="Thu Jan 29 2026 09:05:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ shareReplay å®ç° Token åˆ·æ–°çš„å¹¶å‘æ§åˆ¶</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>åœ¨éœ€è¦èº«ä»½éªŒè¯çš„ Web åº”ç”¨ä¸­ï¼ŒToken è¿‡æœŸæ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚å½“å¤šä¸ªè¯·æ±‚åŒæ—¶å‘èµ·ï¼Œä¸” Token éƒ½å·²è¿‡æœŸæ—¶ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½ç‹¬ç«‹åˆ·æ–° Tokenï¼Œä¼šå¯¼è‡´ï¼š</p>
<ol>
<li>å¤šä¸ªé‡å¤çš„ Token åˆ·æ–°è¯·æ±‚</li>
<li>èµ„æºæµªè´¹</li>
<li>å¯èƒ½çš„ç«æ€æ¡ä»¶</li>
</ol>
<p>æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ RxJS çš„ <code>shareReplay</code> æ“ä½œç¬¦æ¥å®ç° Token åˆ·æ–°çš„å¹¶å‘æ§åˆ¶ï¼Œç¡®ä¿å¤šä¸ªè¯·æ±‚å…±äº«åŒä¸€ä¸ª Token åˆ·æ–°è¯·æ±‚ã€‚</p>
<h3 data-id="heading-2">é—®é¢˜åœºæ™¯</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ 3 ä¸ª API è¯·æ±‚åŒæ—¶å‘èµ·ï¼Œä¸” Token éƒ½å·²è¿‡æœŸï¼š</p>
<ol>
<li><strong>è¯·æ±‚ A</strong>ï¼šæ£€æµ‹åˆ° Token è¿‡æœŸ â†’ å‘èµ· Token åˆ·æ–°è¯·æ±‚ 1</li>
<li><strong>è¯·æ±‚ B</strong>ï¼šæ£€æµ‹åˆ° Token è¿‡æœŸ â†’ å‘èµ· Token åˆ·æ–°è¯·æ±‚ 2</li>
<li><strong>è¯·æ±‚ C</strong>ï¼šæ£€æµ‹åˆ° Token è¿‡æœŸ â†’ å‘èµ· Token åˆ·æ–°è¯·æ±‚ 3</li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼š3 ä¸ªè¯·æ±‚éƒ½ç‹¬ç«‹åˆ·æ–° Tokenï¼Œå¯¼è‡´é‡å¤è¯·æ±‚å’Œèµ„æºæµªè´¹ã€‚</p>
<p><strong>æœŸæœ›</strong>ï¼š3 ä¸ªè¯·æ±‚å…±äº«åŒä¸€ä¸ª Token åˆ·æ–°è¯·æ±‚ï¼Œåªåˆ·æ–°ä¸€æ¬¡ã€‚</p>
<h3 data-id="heading-3">shareReplay æ“ä½œç¬¦ç®€ä»‹</h3>
<p><code>shareReplay</code> æ˜¯ RxJS ä¸­ç”¨äºå…±äº« Observable ç»“æœçš„æ“ä½œç¬¦ã€‚å®ƒä¼šï¼š</p>
<ol>
<li><strong>å…±äº«è®¢é˜…</strong>ï¼šå¤šä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ä¸ªæº Observable</li>
<li><strong>ç¼“å­˜ç»“æœ</strong>ï¼šç¼“å­˜æŒ‡å®šæ•°é‡çš„æœ€æ–°å€¼</li>
<li><strong>é¿å…é‡å¤æ‰§è¡Œ</strong>ï¼šæº Observable åªæ‰§è¡Œä¸€æ¬¡</li>
</ol>
<h4 data-id="heading-4">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">source$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">shareReplay</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// ç¼“å­˜æœ€æ–°çš„ 1 ä¸ªå€¼</span>
)
</code></pre>
<h3 data-id="heading-5">è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ shareReplay å…±äº« Token åˆ·æ–°</h3>
<h4 data-id="heading-6">å®ç°æ€è·¯</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ª Token åˆ·æ–° Observableï¼Œä½¿ç”¨ <code>shareReplay</code> å…±äº«</li>
<li>å½“è¯·æ±‚æ£€æµ‹åˆ° Token è¿‡æœŸæ—¶ï¼Œè®¢é˜…å…±äº«çš„ Token åˆ·æ–° Observable</li>
<li>Token åˆ·æ–°å®Œæˆåï¼Œæ‰€æœ‰ç­‰å¾…çš„è¯·æ±‚éƒ½ä½¿ç”¨æ–°çš„ Token é‡è¯•</li>
</ol>
<h4 data-id="heading-7">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å½“å‰tokenï¼ˆåˆå§‹ä¸ºè¿‡æœŸtokenï¼‰</span>
<span class="hljs-keyword">private</span> currentToken = <span class="hljs-string">'expired_token'</span>;

<span class="hljs-comment">// tokenåˆ·æ–°Observableï¼ˆä½¿ç”¨shareReplayç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-attr">tokenRefresh$</span>: <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// åˆ·æ–°tokenï¼ˆä½¿ç”¨shareReplayç¡®ä¿å¹¶å‘è¯·æ±‚æ—¶åªæœ‰ä¸€ä¸ªtokenåˆ·æ–°è¯·æ±‚ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">refreshToken</span>(): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt; {
  <span class="hljs-comment">// å¦‚æœå·²ç»æœ‰æ­£åœ¨è¿›è¡Œçš„tokenåˆ·æ–°è¯·æ±‚ï¼Œç›´æ¥è¿”å›è¯¥Observable</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenRefresh$</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenRefresh$</span>;
  }
  
  <span class="hljs-comment">// æ ‡è®°æ­£åœ¨åˆ·æ–°token</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">refreshingToken</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
  
  <span class="hljs-comment">// åˆ›å»ºæ–°çš„tokenåˆ·æ–°è¯·æ±‚ï¼Œä½¿ç”¨shareReplayç¡®ä¿å¤šä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ä¸ªè¯·æ±‚</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenRefresh$</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">post</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span>/api/refresh-token`</span>, {})
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">shareReplay</span>(<span class="hljs-number">1</span>), <span class="hljs-comment">// å…³é”®ï¼šä½¿ç”¨shareReplayç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€æœ‰è®¢é˜…è€…å…±äº«ç»“æœ</span>
      <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Tokenåˆ·æ–°å¤±è´¥:'</span>, error);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenRefresh$</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// é‡ç½®ï¼Œå…è®¸é‡è¯•</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">refreshingToken</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error);
      }),
      <span class="hljs-title function_">finalize</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// è¯·æ±‚å®Œæˆåé‡ç½®tokenRefresh$ï¼Œå…è®¸ä¸‹æ¬¡åˆ·æ–°</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenRefresh$</span> = <span class="hljs-literal">null</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">refreshingToken</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        }, <span class="hljs-number">100</span>);
      })
    );
  
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenRefresh$</span>;
}

<span class="hljs-comment">// å‘èµ·å¸¦tokençš„è¯·æ±‚ï¼ˆè‡ªåŠ¨å¤„ç†tokenåˆ·æ–°ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">makeRequestWithToken</span>(<span class="hljs-attr">apiName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">apiUrl</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">ApiResponse</span>&gt; {
  <span class="hljs-comment">// å…ˆå°è¯•ä½¿ç”¨å½“å‰tokenè¯·æ±‚</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">ApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span><span class="hljs-subst">${apiUrl}</span>`</span>, {
    <span class="hljs-attr">headers</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>({
      <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.currentToken}</span>`</span>
    })
  }).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
      <span class="hljs-comment">// å¦‚æœtokenè¿‡æœŸï¼ˆ401é”™è¯¯ï¼‰</span>
      <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">401</span> &amp;&amp; error.<span class="hljs-property">error</span>?.<span class="hljs-property">code</span> === <span class="hljs-string">'TOKEN_EXPIRED'</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${apiName}</span> tokenè¿‡æœŸï¼Œç­‰å¾…tokenåˆ·æ–°...`</span>);
        
        <span class="hljs-comment">// åˆ·æ–°tokenï¼ˆå¦‚æœå·²ç»æœ‰æ­£åœ¨è¿›è¡Œçš„åˆ·æ–°è¯·æ±‚ï¼Œä¼šå¤ç”¨ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshToken</span>().<span class="hljs-title function_">pipe</span>(
          <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">(<span class="hljs-params">tokenResponse</span>) =&gt;</span> {
            <span class="hljs-comment">// tokenåˆ·æ–°æˆåŠŸï¼Œæ›´æ–°å½“å‰token</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentToken</span> = tokenResponse.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTokenDisplay</span> = tokenResponse.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${apiName}</span> tokenåˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–°tokené‡è¯•è¯·æ±‚`</span>);
            
            <span class="hljs-comment">// ä½¿ç”¨æ–°tokené‡è¯•è¯·æ±‚</span>
            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">ApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span><span class="hljs-subst">${apiUrl}</span>`</span>, {
              <span class="hljs-attr">headers</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>({
                <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.currentToken}</span>`</span>
              })
            });
          }),
          <span class="hljs-title function_">catchError</span>(<span class="hljs-function">(<span class="hljs-params">refreshError</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${apiName}</span> tokenåˆ·æ–°å¤±è´¥:`</span>, refreshError);
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> refreshError);
          })
        );
      }
      
      <span class="hljs-comment">// å…¶ä»–é”™è¯¯ç›´æ¥æŠ›å‡º</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error);
    })
  );
}
</code></pre>
<h3 data-id="heading-8">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-9">1. shareReplay çš„å…±äº«æœºåˆ¶</h4>
<p>å½“å¤šä¸ªè¯·æ±‚åŒæ—¶æ£€æµ‹åˆ° Token è¿‡æœŸæ—¶ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€ä¸ªè¯·æ±‚</strong>ï¼šè°ƒç”¨ <code>refreshToken()</code>ï¼Œåˆ›å»ºæ–°çš„ Token åˆ·æ–° Observableï¼Œå¹¶è®¢é˜…å®ƒï¼ˆå‘èµ· HTTP è¯·æ±‚ï¼‰</li>
<li><strong>ç¬¬äºŒä¸ªè¯·æ±‚</strong>ï¼šè°ƒç”¨ <code>refreshToken()</code>ï¼Œå‘ç° <code>tokenRefresh$</code> å·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›å…±äº«çš„ Observableï¼Œå¹¶è®¢é˜…å®ƒ</li>
<li><strong>ç¬¬ä¸‰ä¸ªè¯·æ±‚</strong>ï¼šè°ƒç”¨ <code>refreshToken()</code>ï¼Œå‘ç° <code>tokenRefresh$</code> å·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›å…±äº«çš„ Observableï¼Œå¹¶è®¢é˜…å®ƒ</li>
</ol>
<p><strong>ç­‰å¾…æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªè¯·æ±‚é€šè¿‡<strong>è®¢é˜…åŒä¸€ä¸ª Observable</strong>ï¼ˆ<code>tokenRefresh$</code>ï¼‰æ¥å®ç°ç­‰å¾…</li>
<li>å½“å®ƒä»¬è°ƒç”¨ <code>this.refreshToken().pipe(switchMap(...))</code> æ—¶ï¼Œ<code>switchMap</code> ä¼š<strong>ç­‰å¾…</strong>ä¸Šæ¸¸ Observableï¼ˆ<code>tokenRefresh$</code>ï¼‰å‘å‡ºå€¼</li>
<li>ç”±äºä½¿ç”¨äº† <code>shareReplay</code>ï¼Œå¤šä¸ªè®¢é˜…è€…ä¼š<strong>å…±äº«åŒä¸€ä¸ªåº•å±‚çš„ Observable æ‰§è¡Œ</strong></li>
<li>å½“ç¬¬ä¸€ä¸ªè®¢é˜…è€…å·²ç»å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œåç»­çš„è®¢é˜…è€…ä¼š"åŠ å…¥"è¿™ä¸ªæ­£åœ¨è¿›è¡Œçš„æ‰§è¡Œ</li>
<li>å½“ HTTP è¯·æ±‚å®Œæˆå¹¶å‘å‡º Token å€¼æ—¶ï¼Œ<strong>æ‰€æœ‰è®¢é˜…è€…éƒ½ä¼šåŒæ—¶æ”¶åˆ°è¿™ä¸ªå€¼</strong></li>
<li>ç„¶å <code>switchMap</code> æ‰ä¼šæ‰§è¡Œä¸‹æ¸¸çš„æ“ä½œï¼ˆä½¿ç”¨æ–° token é‡è¯•è¯·æ±‚ï¼‰</li>
</ul>
<p><strong>ç»“æœ</strong>ï¼š3 ä¸ªè¯·æ±‚å…±äº«åŒä¸€ä¸ª Token åˆ·æ–°è¯·æ±‚ï¼Œåªåˆ·æ–°ä¸€æ¬¡ï¼Œå¹¶ä¸”éƒ½ä¼šç­‰å¾… Token åˆ·æ–°å®Œæˆåæ‰ç»§ç»­ã€‚</p>
<h4 data-id="heading-10">2. ç¼“å­˜æœºåˆ¶</h4>
<p><code>shareReplay(1)</code> ä¼šç¼“å­˜æœ€æ–°çš„ 1 ä¸ªå€¼ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>å¦‚æœ Token åˆ·æ–°å·²å®Œæˆï¼Œåç»­è®¢é˜…è€…ä¼šç«‹å³æ”¶åˆ°ç¼“å­˜çš„ç»“æœ</li>
<li>ä¸éœ€è¦é‡æ–°å‘èµ·è¯·æ±‚</li>
</ul>
<h4 data-id="heading-11">3. é”™è¯¯å¤„ç†</h4>
<p>å¦‚æœ Token åˆ·æ–°å¤±è´¥ï¼š</p>
<ol>
<li>é‡ç½® <code>tokenRefresh$</code> ä¸º <code>null</code>ï¼Œå…è®¸é‡è¯•</li>
<li>æŠ›å‡ºé”™è¯¯ï¼Œè®©è°ƒç”¨è€…å¤„ç†</li>
</ol>
<h4 data-id="heading-12">4. æ¸…ç†æœºåˆ¶</h4>
<p>åœ¨ <code>finalize</code> ä¸­é‡ç½® <code>tokenRefresh$</code>ï¼Œç¡®ä¿ä¸‹æ¬¡ Token è¿‡æœŸæ—¶å¯ä»¥é‡æ–°åˆ·æ–°ã€‚</p>
<h3 data-id="heading-13">æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h3>
<p>å‡è®¾ 3 ä¸ªè¯·æ±‚åŒæ—¶å‘èµ·ï¼Œä¸” Token éƒ½å·²è¿‡æœŸï¼š</p>
<ol>
<li>
<p><strong>è¯·æ±‚ A</strong>ï¼šæ£€æµ‹åˆ° Token è¿‡æœŸ</p>
<ul>
<li>è°ƒç”¨ <code>refreshToken()</code>ï¼Œåˆ›å»º Token åˆ·æ–° Observableï¼ˆä½¿ç”¨ <code>shareReplay</code>ï¼‰</li>
<li>è°ƒç”¨ <code>this.refreshToken().pipe(switchMap(...))</code>ï¼Œ<strong>è®¢é˜…</strong> <code>tokenRefresh$</code></li>
<li>ç”±äºæ˜¯ç¬¬ä¸€ä¸ªè®¢é˜…è€…ï¼Œå¼€å§‹æ‰§è¡Œåº•å±‚ Observableï¼Œå‘èµ· HTTP è¯·æ±‚ï¼ˆToken åˆ·æ–°ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è¯·æ±‚ B</strong>ï¼šæ£€æµ‹åˆ° Token è¿‡æœŸï¼ˆåœ¨è¯·æ±‚ A çš„ Token åˆ·æ–°å®Œæˆå‰ï¼Œä¾‹å¦‚ 1 ç§’åï¼‰</p>
<ul>
<li>è°ƒç”¨ <code>refreshToken()</code>ï¼Œå‘ç° <code>tokenRefresh$</code> å·²å­˜åœ¨ï¼Œè¿”å›åŒä¸€ä¸ª Observable</li>
<li>è°ƒç”¨ <code>this.refreshToken().pipe(switchMap(...))</code>ï¼Œ<strong>è®¢é˜…</strong>åŒä¸€ä¸ª <code>tokenRefresh$</code></li>
<li>ç”±äºä½¿ç”¨äº† <code>shareReplay</code>ï¼Œ<strong>åŠ å…¥</strong>æ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚æ‰§è¡Œï¼ˆä¸å‘èµ·æ–°è¯·æ±‚ï¼‰</li>
<li><code>switchMap</code> <strong>ç­‰å¾…</strong>ä¸Šæ¸¸ Observableï¼ˆ<code>tokenRefresh$</code>ï¼‰å‘å‡ºå€¼</li>
</ul>
</li>
<li>
<p><strong>è¯·æ±‚ C</strong>ï¼šæ£€æµ‹åˆ° Token è¿‡æœŸï¼ˆåœ¨è¯·æ±‚ A çš„ Token åˆ·æ–°å®Œæˆå‰ï¼Œä¾‹å¦‚ 2 ç§’åï¼‰</p>
<ul>
<li>è°ƒç”¨ <code>refreshToken()</code>ï¼Œå‘ç° <code>tokenRefresh$</code> å·²å­˜åœ¨ï¼Œè¿”å›åŒä¸€ä¸ª Observable</li>
<li>è°ƒç”¨ <code>this.refreshToken().pipe(switchMap(...))</code>ï¼Œ<strong>è®¢é˜…</strong>åŒä¸€ä¸ª <code>tokenRefresh$</code></li>
<li>ç”±äºä½¿ç”¨äº† <code>shareReplay</code>ï¼Œ<strong>åŠ å…¥</strong>æ­£åœ¨è¿›è¡Œçš„ HTTP è¯·æ±‚æ‰§è¡Œï¼ˆä¸å‘èµ·æ–°è¯·æ±‚ï¼‰</li>
<li><code>switchMap</code> <strong>ç­‰å¾…</strong>ä¸Šæ¸¸ Observableï¼ˆ<code>tokenRefresh$</code>ï¼‰å‘å‡ºå€¼</li>
</ul>
</li>
<li>
<p><strong>Token åˆ·æ–°å®Œæˆ</strong>ï¼ˆä¾‹å¦‚ 3 ç§’åï¼‰</p>
<ul>
<li>HTTP è¯·æ±‚è¿”å›æ–°çš„ Token</li>
<li><code>tokenRefresh$</code> Observable å‘å‡ºå€¼ï¼ˆæ–°çš„ Tokenï¼‰</li>
<li><strong>æ‰€æœ‰è®¢é˜…è€…ï¼ˆè¯·æ±‚ Aã€Bã€Cï¼‰åŒæ—¶æ”¶åˆ°</strong>æ–°çš„ Token</li>
<li>æ‰€æœ‰è¯·æ±‚çš„ <code>switchMap</code> åŒæ—¶æ‰§è¡Œï¼Œä½¿ç”¨æ–° Token é‡è¯•å„è‡ªçš„è¯·æ±‚</li>
</ul>
</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªè¯·æ±‚é€šè¿‡<strong>è®¢é˜…åŒä¸€ä¸ª Observable</strong> æ¥å®ç°ç­‰å¾…</li>
<li><code>switchMap</code> ä¼š<strong>é˜»å¡ç­‰å¾…</strong>ä¸Šæ¸¸ Observable å‘å‡ºå€¼ï¼Œç„¶åæ‰æ‰§è¡Œä¸‹æ¸¸æ“ä½œ</li>
<li><code>shareReplay</code> ç¡®ä¿å¤šä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ä¸ªåº•å±‚çš„ HTTP è¯·æ±‚æ‰§è¡Œ</li>
</ul>
<p><strong>ç»“æœ</strong>ï¼šåªå‘èµ· 1 æ¬¡ Token åˆ·æ–°è¯·æ±‚ï¼Œ3 ä¸ªè¯·æ±‚å…±äº«ç»“æœï¼Œå¹¶ä¸”éƒ½ä¼šç­‰å¾… Token åˆ·æ–°å®Œæˆåæ‰ç»§ç»­ âœ…</p>
<h3 data-id="heading-14">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<h4 data-id="heading-15">æ–¹æ¡ˆ 1ï¼šä¸ä½¿ç”¨ shareReplayï¼ˆæœ‰é—®é¢˜ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ é”™è¯¯ç¤ºä¾‹ï¼šæ¯ä¸ªè¯·æ±‚éƒ½ç‹¬ç«‹åˆ·æ–° Token</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">refreshToken</span>(): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/refresh-token'</span>, {}); <span class="hljs-comment">// å¯èƒ½å‘èµ·å¤šæ¬¡è¯·æ±‚</span>
}
</code></pre>
<h4 data-id="heading-16">æ–¹æ¡ˆ 2ï¼šä½¿ç”¨æ ‡å¿—ä½ï¼ˆå¤æ‚ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âš ï¸ å¯è¡Œä½†å¤æ‚ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†æ ‡å¿—ä½å’Œ Promise</span>
<span class="hljs-keyword">private</span> isRefreshing = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">private</span> refreshPromise?: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt;;

<span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">refreshToken</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isRefreshing</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">refreshPromise</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">refreshPromise</span>; <span class="hljs-comment">// ç­‰å¾…æ­£åœ¨è¿›è¡Œçš„åˆ·æ–°</span>
  }
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRefreshing</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">refreshPromise</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/refresh-token'</span>, {}).<span class="hljs-title function_">toPromise</span>();
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-17">æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ shareReplayï¼ˆæ¨èï¼‰âœ…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šç®€æ´ã€è‡ªåŠ¨ç®¡ç†</span>
<span class="hljs-keyword">private</span> tokenRefresh$ = <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/refresh-token'</span>, {}).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">shareReplay</span>(<span class="hljs-number">1</span>)
);
</code></pre>
<h3 data-id="heading-18">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-19">1. HTTP æ‹¦æˆªå™¨ä¸­çš„ Token åˆ·æ–°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// HTTP æ‹¦æˆªå™¨</span>
<span class="hljs-title function_">intercept</span>(<span class="hljs-attr">req</span>: <span class="hljs-title class_">HttpRequest</span>&lt;<span class="hljs-built_in">any</span>&gt;, <span class="hljs-attr">next</span>: <span class="hljs-title class_">HttpHandler</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">HttpEvent</span>&lt;<span class="hljs-built_in">any</span>&gt;&gt; {
  <span class="hljs-keyword">return</span> next.<span class="hljs-title function_">handle</span>(req).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshToken</span>().<span class="hljs-title function_">pipe</span>(
          <span class="hljs-title function_">switchMap</span>(<span class="hljs-function"><span class="hljs-params">token</span> =&gt;</span> {
            <span class="hljs-comment">// ä½¿ç”¨æ–° Token é‡è¯•è¯·æ±‚</span>
            <span class="hljs-keyword">const</span> cloned = req.<span class="hljs-title function_">clone</span>({
              <span class="hljs-attr">setHeaders</span>: { <span class="hljs-title class_">Authorization</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span> }
            });
            <span class="hljs-keyword">return</span> next.<span class="hljs-title function_">handle</span>(cloned);
          })
        );
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error);
    })
  );
}
</code></pre>
<h4 data-id="heading-20">2. å¤šä¸ª API è¯·æ±‚çš„ Token åˆ·æ–°</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚</span>
<span class="hljs-title function_">forkJoin</span>({
  <span class="hljs-attr">user</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUser</span>(),
  <span class="hljs-attr">orders</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOrders</span>(),
  <span class="hljs-attr">products</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProducts</span>()
}).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  <span class="hljs-comment">// æ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ª Token åˆ·æ–°è¯·æ±‚</span>
});
</code></pre>
<h3 data-id="heading-21">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-22">1. æ·»åŠ  Token è¿‡æœŸæ—¶é—´æ£€æŸ¥</h4>
<p>åœ¨åˆ·æ–° Token å‰ï¼Œæ£€æŸ¥ Token æ˜¯å¦çœŸçš„è¿‡æœŸï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">isTokenExpired</span>(): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-comment">// æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenExpiryTime</span> &lt; <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
}

<span class="hljs-keyword">private</span> <span class="hljs-title function_">refreshToken</span>(): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-title class_">TokenResponse</span>&gt; {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isTokenExpired</span>()) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({ <span class="hljs-attr">token</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentToken</span> }); <span class="hljs-comment">// Token æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span>
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-23">2. æ·»åŠ é‡è¯•æœºåˆ¶</h4>
<p>å¯¹äº Token åˆ·æ–°å¤±è´¥çš„æƒ…å†µï¼Œå¯ä»¥æ·»åŠ é‡è¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/refresh-token'</span>, {}).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retry</span>(<span class="hljs-number">2</span>), <span class="hljs-comment">// å¤±è´¥åé‡è¯• 2 æ¬¡</span>
  <span class="hljs-title function_">shareReplay</span>(<span class="hljs-number">1</span>)
)
</code></pre>
<h4 data-id="heading-24">3. æ·»åŠ è¶…æ—¶å¤„ç†</h4>
<p>ä¸º Token åˆ·æ–°æ·»åŠ è¶…æ—¶å¤„ç†ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/refresh-token'</span>, {}).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">timeout</span>(<span class="hljs-number">5000</span>), <span class="hljs-comment">// 5 ç§’è¶…æ—¶</span>
  <span class="hljs-title function_">shareReplay</span>(<span class="hljs-number">1</span>)
)
</code></pre>
<h3 data-id="heading-25">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆè®¢é˜…</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç¡®ä¿ Token åˆ·æ–°å¤±è´¥æ—¶æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼š<code>shareReplay</code> ç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚ï¼Œä½†éœ€è¦æ­£ç¡®ç®¡ç†çŠ¶æ€</li>
<li><strong>Token å­˜å‚¨</strong>ï¼šåˆ·æ–°åçš„ Token éœ€è¦æ­£ç¡®å­˜å‚¨å’Œæ›´æ–°</li>
</ol>
<h3 data-id="heading-26">æ€»ç»“</h3>
<p>ä½¿ç”¨ <code>shareReplay</code> å®ç° Token åˆ·æ–°çš„å¹¶å‘æ§åˆ¶æ˜¯ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡å…±äº« Observable æ¥ç¡®ä¿ï¼š</p>
<ul>
<li><strong>é¿å…é‡å¤è¯·æ±‚</strong>ï¼šå¤šä¸ªè¯·æ±‚å…±äº«åŒä¸€ä¸ª Token åˆ·æ–°è¯·æ±‚</li>
<li><strong>èµ„æºèŠ‚çº¦</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚</li>
<li><strong>ä»£ç ç®€æ´</strong>ï¼šä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†æ ‡å¿—ä½å’Œ Promise</li>
<li><strong>è‡ªåŠ¨ç®¡ç†</strong>ï¼šRxJS è‡ªåŠ¨å¤„ç†è®¢é˜…å’Œå–æ¶ˆ</li>
</ul>
<p>è®°ä½ï¼šå½“ä½ éœ€è¦å¤šä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ä¸ª Observable ç»“æœæ—¶ï¼Œä½¿ç”¨ <code>shareReplay</code> æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å…«ç« ä½¿ç”¨ retryWhen å®ç°å¤±è´¥é‡è¯•æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7600602502632800297</link>    <guid>https://juejin.cn/post/7600602502632800297</guid>    <pubDate>2026-01-29T09:05:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600602502632800297" data-draft-id="7600587732991279146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å…«ç« ä½¿ç”¨ retryWhen å®ç°å¤±è´¥é‡è¯•æœºåˆ¶"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:05:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬å…«ç« ä½¿ç”¨ retryWhen å®ç°å¤±è´¥é‡è¯•æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:05:47.000Z" title="Thu Jan 29 2026 09:05:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ retryWhen å®ç°å¤±è´¥é‡è¯•æœºåˆ¶</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>åœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œç”±äºç½‘ç»œæ³¢åŠ¨ã€æœåŠ¡å™¨ä¸´æ—¶æ•…éšœç­‰åŸå› ï¼Œè¯·æ±‚å¯èƒ½ä¼šå¤±è´¥ã€‚ç®€å•çš„é‡è¯•æœºåˆ¶ï¼ˆå¦‚ <code>retry</code> æ“ä½œç¬¦ï¼‰å¯èƒ½ä¸å¤Ÿçµæ´»ï¼Œæ— æ³•æ»¡è¶³å¤æ‚çš„éœ€æ±‚ã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>retryWhen</code> æ“ä½œç¬¦å®ç°æ›´çµæ´»çš„é‡è¯•æœºåˆ¶ï¼Œæ¯”å¦‚å»¶è¿Ÿé‡è¯•ã€é™åˆ¶é‡è¯•æ¬¡æ•°ç­‰ã€‚</p>
<h3 data-id="heading-2">retry æ“ä½œç¬¦çš„å±€é™æ€§</h3>
<p>RxJS æä¾›äº† <code>retry</code> æ“ä½œç¬¦ï¼Œå¯ä»¥ç®€å•åœ°é‡è¯•æŒ‡å®šæ¬¡æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retry</span>(<span class="hljs-number">3</span>) <span class="hljs-comment">// å¤±è´¥åç«‹å³é‡è¯• 3 æ¬¡</span>
)
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ç«‹å³é‡è¯•ï¼Œå¯èƒ½æœåŠ¡å™¨è¿˜æ²¡æ¢å¤</li>
<li>æ— æ³•è‡ªå®šä¹‰é‡è¯•é€»è¾‘ï¼ˆå¦‚å»¶è¿Ÿé‡è¯•ï¼‰</li>
<li>æ— æ³•æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•</li>
</ul>
<h3 data-id="heading-3">retryWhen æ“ä½œç¬¦ç®€ä»‹</h3>
<p><code>retryWhen</code> æä¾›äº†æ›´çµæ´»çš„é‡è¯•æœºåˆ¶ï¼Œå®ƒå…è®¸æˆ‘ä»¬ï¼š</p>
<ol>
<li><strong>è‡ªå®šä¹‰é‡è¯•é€»è¾‘</strong>ï¼šæ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•</li>
<li><strong>å»¶è¿Ÿé‡è¯•</strong>ï¼šåœ¨é‡è¯•å‰ç­‰å¾…ä¸€æ®µæ—¶é—´</li>
<li><strong>é™åˆ¶é‡è¯•æ¬¡æ•°</strong>ï¼šä½¿ç”¨ <code>take</code> æˆ– <code>scan</code> é™åˆ¶é‡è¯•æ¬¡æ•°</li>
<li><strong>æŒ‡æ•°é€€é¿</strong>ï¼šæ¯æ¬¡é‡è¯•çš„å»¶è¿Ÿæ—¶é—´é€’å¢</li>
</ol>
<h4 data-id="heading-4">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">source$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span> 
    errors.<span class="hljs-title function_">pipe</span>(
      <span class="hljs-comment">// è‡ªå®šä¹‰é‡è¯•é€»è¾‘</span>
    )
  )
)
</code></pre>
<h3 data-id="heading-5">å®æˆ˜åœºæ™¯ï¼šå»¶è¿Ÿé‡è¯•å¤±è´¥è¯·æ±‚</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯èƒ½å¤±è´¥çš„ APIï¼Œå¤±è´¥åéœ€è¦ç­‰å¾… 3 ç§’å†é‡è¯•ï¼Œæœ€å¤šé‡è¯• 3 æ¬¡ã€‚</p>
<h4 data-id="heading-6">å®ç°æ€è·¯</h4>
<ol>
<li>ä½¿ç”¨ <code>retryWhen</code> æ•è·é”™è¯¯</li>
<li>ä½¿ç”¨ <code>scan</code> è®¡æ•°é‡è¯•æ¬¡æ•°</li>
<li>ä½¿ç”¨ <code>delay</code> å»¶è¿Ÿé‡è¯•</li>
<li>ä½¿ç”¨ <code>take</code> é™åˆ¶é‡è¯•æ¬¡æ•°</li>
</ol>
<h4 data-id="heading-7">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æœ€å¤§é‡è¯•æ¬¡æ•°</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> maxRetries = <span class="hljs-number">3</span>;

<span class="hljs-comment">// å‘èµ·è¯·æ±‚ï¼ˆå¸¦é‡è¯•é€»è¾‘ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">makeRequestWithRetry</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span> = {
    <span class="hljs-attr">status</span>: <span class="hljs-string">'requesting'</span>,
    <span class="hljs-attr">retryCount</span>: <span class="hljs-number">0</span>
  };
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">ApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span>/api/fail`</span>)
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-comment">// ä½¿ç”¨ retryWhen å®ç°å¤±è´¥å 3 ç§’é‡è¯•</span>
      <span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span> 
        errors.<span class="hljs-title function_">pipe</span>(
          <span class="hljs-comment">// ä½¿ç”¨ scan æ¥è®¡æ•°é‡è¯•æ¬¡æ•°</span>
          <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">retryCount, error</span>) =&gt;</span> {
            <span class="hljs-comment">// æ›´æ–°é‡è¯•æ¬¡æ•°</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">retryCount</span> = retryCount + <span class="hljs-number">1</span>;
            
            <span class="hljs-comment">// å¦‚æœè¿˜æ²¡è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ›´æ–°çŠ¶æ€ä¸ºé‡è¯•ä¸­</span>
            <span class="hljs-keyword">if</span> (retryCount &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxRetries</span>) {
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'retrying'</span>;
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
            }
            
            <span class="hljs-keyword">return</span> retryCount + <span class="hljs-number">1</span>;
          }, <span class="hljs-number">0</span>),
          <span class="hljs-comment">// å»¶è¿Ÿ 3 ç§’åé‡è¯•</span>
          <span class="hljs-title function_">delay</span>(<span class="hljs-number">3000</span>),
          <span class="hljs-comment">// æœ€å¤šé‡è¯• maxRetries æ¬¡</span>
          <span class="hljs-title function_">take</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxRetries</span>)
        )
      ),
      <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-comment">// å¦‚æœæœ€ç»ˆå¤±è´¥ï¼Œè¿”å›é”™è¯¯</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'failed'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
      })
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response) {
          <span class="hljs-comment">// è¯·æ±‚æˆåŠŸ</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'success'</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">response</span> = response;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        }
      },
      <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-comment">// å¤„ç†é”™è¯¯ï¼ˆè™½ç„¶å·²ç»åœ¨ catchError ä¸­å¤„ç†äº†ï¼‰</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">status</span> !== <span class="hljs-string">'failed'</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'failed'</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestStatus</span>.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        }
      }
    });
}
</code></pre>
<h3 data-id="heading-8">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-9">1. retryWhen çš„å·¥ä½œæœºåˆ¶</h4>
<p><code>retryWhen</code> æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ª Observableï¼ˆé”™è¯¯æµï¼‰ï¼Œè¿”å›ä¸€ä¸ª Observableã€‚å½“è¿”å›çš„ Observable å‘å‡ºå€¼æ—¶ï¼Œä¼šé‡è¯•æº Observableã€‚</p>
<h4 data-id="heading-10">2. scan æ“ä½œç¬¦è®¡æ•°</h4>
<p><code>scan</code> æ“ä½œç¬¦ç”¨äºç´¯ç§¯å€¼ï¼Œè¿™é‡Œç”¨æ¥è®¡æ•°é‡è¯•æ¬¡æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">retryCount, error</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> retryCount + <span class="hljs-number">1</span>; <span class="hljs-comment">// æ¯æ¬¡é”™è¯¯æ—¶é€’å¢</span>
}, <span class="hljs-number">0</span>) <span class="hljs-comment">// åˆå§‹å€¼ä¸º 0</span>
</code></pre>
<h4 data-id="heading-11">3. delay å»¶è¿Ÿé‡è¯•</h4>
<p><code>delay(3000)</code> ä¼šåœ¨é‡è¯•å‰ç­‰å¾… 3 ç§’ï¼Œç»™æœåŠ¡å™¨æ¢å¤çš„æ—¶é—´ã€‚</p>
<h4 data-id="heading-12">4. take é™åˆ¶é‡è¯•æ¬¡æ•°</h4>
<p><code>take(this.maxRetries)</code> ç¡®ä¿æœ€å¤šé‡è¯• 3 æ¬¡ï¼Œè¶…è¿‡åä¸å†é‡è¯•ã€‚</p>
<h4 data-id="heading-13">5. æ‰§è¡Œæµç¨‹</h4>
<ol>
<li><strong>ç¬¬ä¸€æ¬¡è¯·æ±‚</strong>ï¼šå¤±è´¥ â†’ è¿›å…¥ <code>retryWhen</code></li>
<li><strong>ç¬¬ä¸€æ¬¡é‡è¯•</strong>ï¼šç­‰å¾… 3 ç§’ â†’ é‡è¯• â†’ å¦‚æœå¤±è´¥ï¼Œç»§ç»­</li>
<li><strong>ç¬¬äºŒæ¬¡é‡è¯•</strong>ï¼šç­‰å¾… 3 ç§’ â†’ é‡è¯• â†’ å¦‚æœå¤±è´¥ï¼Œç»§ç»­</li>
<li><strong>ç¬¬ä¸‰æ¬¡é‡è¯•</strong>ï¼šç­‰å¾… 3 ç§’ â†’ é‡è¯• â†’ å¦‚æœå¤±è´¥ï¼Œä¸å†é‡è¯•</li>
<li><strong>æœ€ç»ˆç»“æœ</strong>ï¼šæˆåŠŸæˆ–å¤±è´¥</li>
</ol>
<h3 data-id="heading-14">é«˜çº§ç”¨æ³•</h3>
<h4 data-id="heading-15">1. æŒ‡æ•°é€€é¿ï¼ˆExponential Backoffï¼‰</h4>
<p>æ¯æ¬¡é‡è¯•çš„å»¶è¿Ÿæ—¶é—´é€’å¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
  errors.<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">retryCount, error</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> delay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1000</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, retryCount), <span class="hljs-number">10000</span>); <span class="hljs-comment">// æŒ‡æ•°é€’å¢ï¼Œæœ€å¤š 10 ç§’</span>
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">retryCount</span>: retryCount + <span class="hljs-number">1</span>, delay };
    }, { <span class="hljs-attr">retryCount</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">delay</span>: <span class="hljs-number">1000</span> }),
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">(<span class="hljs-params">{ delay }</span>) =&gt;</span> <span class="hljs-title function_">timer</span>(delay)), <span class="hljs-comment">// ä½¿ç”¨åŠ¨æ€å»¶è¿Ÿ</span>
    <span class="hljs-title function_">take</span>(<span class="hljs-number">5</span>)
  )
)
</code></pre>
<h4 data-id="heading-16">2. æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•</h4>
<p>åªå¯¹ç‰¹å®šé”™è¯¯é‡è¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
  errors.<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">(<span class="hljs-params">error, index</span>) =&gt;</span> {
      <span class="hljs-comment">// åªå¯¹ 500 é”™è¯¯é‡è¯•</span>
      <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">500</span> &amp;&amp; index &lt; <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">3000</span>); <span class="hljs-comment">// å»¶è¿Ÿ 3 ç§’åé‡è¯•</span>
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error); <span class="hljs-comment">// å…¶ä»–é”™è¯¯ä¸é‡è¯•</span>
    })
  )
)
</code></pre>
<h4 data-id="heading-17">3. é‡è¯•å‰æ‰§è¡Œæ“ä½œ</h4>
<p>åœ¨é‡è¯•å‰æ‰§è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚åˆ·æ–° Tokenï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
  errors.<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">(<span class="hljs-params">error, index</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (error.<span class="hljs-property">status</span> === <span class="hljs-number">401</span> &amp;&amp; index &lt; <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// åˆ·æ–° Token åå†é‡è¯•</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refreshToken</span>().<span class="hljs-title function_">pipe</span>(
          <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">1000</span>)) <span class="hljs-comment">// å»¶è¿Ÿ 1 ç§’åé‡è¯•</span>
        );
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error);
    })
  )
)
</code></pre>
<h3 data-id="heading-18">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<h4 data-id="heading-19">æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ retryï¼ˆç®€å•ä½†ä¸çµæ´»ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âš ï¸ ç«‹å³é‡è¯•ï¼Œæ— æ³•å»¶è¿Ÿ</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retry</span>(<span class="hljs-number">3</span>)
)
</code></pre>
<h4 data-id="heading-20">æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨å®ç°ï¼ˆå¤æ‚ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âš ï¸ éœ€è¦æ‰‹åŠ¨ç®¡ç†çŠ¶æ€å’Œå¾ªç¯</span>
<span class="hljs-keyword">let</span> retryCount = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> maxRetries = <span class="hljs-number">3</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">makeRequest</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (retryCount &lt; maxRetries) {
        retryCount++;
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">3000</span>).<span class="hljs-title function_">pipe</span>(
          <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">makeRequest</span>())
        );
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error);
    })
  );
}
</code></pre>
<h4 data-id="heading-21">æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ retryWhenï¼ˆæ¨èï¼‰âœ…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… ç®€æ´ã€çµæ´»</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
    errors.<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> count + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
      <span class="hljs-title function_">delay</span>(<span class="hljs-number">3000</span>),
      <span class="hljs-title function_">take</span>(<span class="hljs-number">3</span>)
    )
  )
)
</code></pre>
<h3 data-id="heading-22">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-23">1. API è¯·æ±‚é‡è¯•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç½‘ç»œè¯·æ±‚å¤±è´¥åé‡è¯•</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
    errors.<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> count + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
      <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">count</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">3</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'é‡è¯•æ¬¡æ•°è¿‡å¤š'</span>));
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">1000</span> * count); <span class="hljs-comment">// å»¶è¿Ÿæ—¶é—´é€’å¢</span>
      })
    )
  )
)
</code></pre>
<h4 data-id="heading-24">2. WebSocket è¿æ¥é‡è¯•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// WebSocket è¿æ¥å¤±è´¥åé‡è¯•</span>
<span class="hljs-title function_">connectWebSocket</span>().<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
    errors.<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> count + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
      <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">count</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">5</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¿æ¥å¤±è´¥'</span>));
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">2000</span> * count); <span class="hljs-comment">// å»¶è¿Ÿæ—¶é—´é€’å¢</span>
      })
    )
  )
)
</code></pre>
<h4 data-id="heading-25">3. æ–‡ä»¶ä¸Šä¼ é‡è¯•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ–‡ä»¶ä¸Šä¼ å¤±è´¥åé‡è¯•</span>
<span class="hljs-title function_">uploadFile</span>(file).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
    errors.<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> count + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
      <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">count</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">2</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ä¸Šä¼ å¤±è´¥'</span>));
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">3000</span>); <span class="hljs-comment">// å›ºå®šå»¶è¿Ÿ 3 ç§’</span>
      })
    )
  )
)
</code></pre>
<h3 data-id="heading-26">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-27">1. åˆç†è®¾ç½®é‡è¯•æ¬¡æ•°</h4>
<p>æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®åˆç†çš„é‡è¯•æ¬¡æ•°ï¼š</p>
<ul>
<li><strong>å…³é”®æ“ä½œ</strong>ï¼š3-5 æ¬¡</li>
<li><strong>éå…³é”®æ“ä½œ</strong>ï¼š1-2 æ¬¡</li>
<li><strong>å®æ—¶æ€§è¦æ±‚é«˜</strong>ï¼š1 æ¬¡æˆ–ä¸é‡è¯•</li>
</ul>
<h4 data-id="heading-28">2. ä½¿ç”¨æŒ‡æ•°é€€é¿</h4>
<p>å¯¹äºå¯èƒ½é•¿æ—¶é—´æ•…éšœçš„æœåŠ¡ï¼Œä½¿ç”¨æŒ‡æ•°é€€é¿ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
  errors.<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> count + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">count</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> delay = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1000</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, count), <span class="hljs-number">30000</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(delay);
    }),
    <span class="hljs-title function_">take</span>(<span class="hljs-number">5</span>)
  )
)
</code></pre>
<h4 data-id="heading-29">3. æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•</h4>
<p>åªå¯¹å¯æ¢å¤çš„é”™è¯¯é‡è¯•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">retryWhen</span>(<span class="hljs-function"><span class="hljs-params">errors</span> =&gt;</span>
  errors.<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">(<span class="hljs-params">error, index</span>) =&gt;</span> {
      <span class="hljs-comment">// åªå¯¹ç½‘ç»œé”™è¯¯å’Œ 5xx é”™è¯¯é‡è¯•</span>
      <span class="hljs-keyword">if</span> ((error.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">500</span> || !error.<span class="hljs-property">status</span>) &amp;&amp; index &lt; <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(<span class="hljs-number">3000</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-function">() =&gt;</span> error);
    })
  )
)
</code></pre>
<h3 data-id="heading-30">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>æ— é™é‡è¯•</strong>ï¼šç¡®ä¿ä½¿ç”¨ <code>take</code> é™åˆ¶é‡è¯•æ¬¡æ•°ï¼Œé¿å…æ— é™é‡è¯•</li>
<li><strong>èµ„æºå ç”¨</strong>ï¼šé‡è¯•ä¼šå ç”¨èµ„æºï¼Œéœ€è¦åˆç†è®¾ç½®é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿ</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šç»™ç”¨æˆ·é€‚å½“çš„åé¦ˆï¼Œå‘ŠçŸ¥æ­£åœ¨é‡è¯•</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šç¡®ä¿æœ€ç»ˆå¤±è´¥æ—¶æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†</li>
</ol>
<h3 data-id="heading-31">æ€»ç»“</h3>
<p><code>retryWhen</code> æ˜¯å®ç°çµæ´»é‡è¯•æœºåˆ¶çš„å¼ºå¤§å·¥å…·ï¼Œå®ƒå…è®¸æˆ‘ä»¬ï¼š</p>
<ul>
<li><strong>è‡ªå®šä¹‰é‡è¯•é€»è¾‘</strong>ï¼šæ ¹æ®é”™è¯¯ç±»å‹å’Œæ¬¡æ•°å†³å®šæ˜¯å¦é‡è¯•</li>
<li><strong>å»¶è¿Ÿé‡è¯•</strong>ï¼šåœ¨é‡è¯•å‰ç­‰å¾…ï¼Œç»™æœåŠ¡å™¨æ¢å¤çš„æ—¶é—´</li>
<li><strong>é™åˆ¶é‡è¯•æ¬¡æ•°</strong>ï¼šé¿å…æ— é™é‡è¯•</li>
<li><strong>æŒ‡æ•°é€€é¿</strong>ï¼šå»¶è¿Ÿæ—¶é—´é€’å¢ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„é‡è¯•ç­–ç•¥ï¼Œæ—¢èƒ½æé«˜è¯·æ±‚çš„æˆåŠŸç‡ï¼Œåˆèƒ½é¿å…è¿‡åº¦é‡è¯•å¸¦æ¥çš„èµ„æºæµªè´¹ã€‚</p>
<p>è®°ä½ï¼š<strong>é‡è¯•æ˜¯ä¸€ç§å®¹é”™æœºåˆ¶ï¼Œä½†ä¸æ˜¯ä¸‡èƒ½çš„ã€‚å¯¹äºå…³é”®æ“ä½œï¼Œè¿˜éœ€è¦è€ƒè™‘å…¶ä»–å®¹é”™æ–¹æ¡ˆï¼Œå¦‚é™çº§ã€ç¼“å­˜ç­‰</strong>ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¹ç« ä½¿ç”¨ exhaustMap å®ç°è½®è¯¢æœºåˆ¶]]></title>    <link>https://juejin.cn/post/7600560664407556159</link>    <guid>https://juejin.cn/post/7600560664407556159</guid>    <pubDate>2026-01-29T09:06:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600560664407556159" data-draft-id="7600469605477023786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¹ç« ä½¿ç”¨ exhaustMap å®ç°è½®è¯¢æœºåˆ¶"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:06:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬ä¹ç« ä½¿ç”¨ exhaustMap å®ç°è½®è¯¢æœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:06:15.000Z" title="Thu Jan 29 2026 09:06:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ exhaustMap å®ç°è½®è¯¢æœºåˆ¶</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>è½®è¯¢ï¼ˆPollingï¼‰æ˜¯ä¸€ç§å®šæœŸæ£€æŸ¥æ•°æ®æ›´æ–°çš„æŠ€æœ¯ï¼Œå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ£€æŸ¥ä»»åŠ¡çŠ¶æ€ã€è·å–æœ€æ–°æ•°æ®ç­‰ã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ RxJS çš„ <code>timer</code> å’Œ <code>exhaustMap</code> æ“ä½œç¬¦å®ç°ä¼˜é›…çš„è½®è¯¢æœºåˆ¶ã€‚</p>
<h3 data-id="heading-2">è½®è¯¢çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>è½®è¯¢æ˜¯æŒ‡å®šæœŸï¼ˆå¦‚æ¯ 3 ç§’ï¼‰å‘èµ·è¯·æ±‚ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦æœ‰æ›´æ–°ã€‚å¸¸è§çš„è½®è¯¢åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ä»»åŠ¡çŠ¶æ€æ£€æŸ¥</strong>ï¼šå®šæœŸæ£€æŸ¥åå°ä»»åŠ¡æ˜¯å¦å®Œæˆ</li>
<li><strong>æ•°æ®åŒæ­¥</strong>ï¼šå®šæœŸä»æœåŠ¡å™¨è·å–æœ€æ–°æ•°æ®</li>
<li><strong>æ¶ˆæ¯é€šçŸ¥</strong>ï¼šå®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ–°æ¶ˆæ¯</li>
</ul>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆä½¿ç”¨ exhaustMapï¼Ÿ</h3>
<p>åœ¨è½®è¯¢åœºæ™¯ä¸­ï¼Œå¦‚æœå‰ä¸€ä¸ªè¯·æ±‚è¿˜æ²¡å®Œæˆï¼Œæ–°çš„è½®è¯¢å‘¨æœŸåˆåˆ°äº†ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›ï¼š</p>
<ul>
<li><strong>å¿½ç•¥æ–°çš„è¯·æ±‚</strong>ï¼šç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆ</li>
<li><strong>é¿å…è¯·æ±‚å †ç§¯</strong>ï¼šé˜²æ­¢å¤šä¸ªè¯·æ±‚åŒæ—¶è¿›è¡Œ</li>
</ul>
<p><code>exhaustMap</code> æ­£æ˜¯ä¸ºæ­¤è®¾è®¡çš„ï¼šå®ƒä¼šå¿½ç•¥æ–°çš„å€¼ï¼Œç›´åˆ°å½“å‰çš„å†…éƒ¨ Observable å®Œæˆã€‚</p>
<h4 data-id="heading-4">exhaustMap vs å…¶ä»–æ“ä½œç¬¦</h4>






























<table><thead><tr><th>æ“ä½œç¬¦</th><th>è¡Œä¸º</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>mergeMap</code></td><td>å¹¶å‘æ‰§è¡Œæ‰€æœ‰è¯·æ±‚</td><td>éœ€è¦æ‰€æœ‰è¯·æ±‚çš„ç»“æœ</td></tr><tr><td><code>concatMap</code></td><td>æŒ‰é¡ºåºæ‰§è¡Œè¯·æ±‚</td><td>éœ€è¦ä¿è¯é¡ºåº</td></tr><tr><td><code>switchMap</code></td><td>å–æ¶ˆä¹‹å‰çš„è¯·æ±‚</td><td>åªéœ€è¦æœ€æ–°ç»“æœ</td></tr><tr><td><code>exhaustMap</code></td><td>å¿½ç•¥æ–°çš„è¯·æ±‚</td><td>é¿å…è¯·æ±‚å †ç§¯ï¼ˆè½®è¯¢ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-5">å®æˆ˜åœºæ™¯ï¼šå®šæœŸè½®è¯¢ API</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦æ¯ 3 ç§’è½®è¯¢ä¸€æ¬¡ APIï¼Œè·å–æœ€æ–°æ•°æ®ã€‚å¦‚æœå‰ä¸€ä¸ªè¯·æ±‚è¿˜æ²¡å®Œæˆï¼Œåº”è¯¥å¿½ç•¥æ–°çš„è½®è¯¢å‘¨æœŸã€‚</p>
<h4 data-id="heading-6">å®ç°æ€è·¯</h4>
<ol>
<li>ä½¿ç”¨ <code>timer(0, 3000)</code> åˆ›å»ºå®šæ—¶å™¨ï¼ˆç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡ï¼Œç„¶åæ¯ 3 ç§’æ‰§è¡Œä¸€æ¬¡ï¼‰</li>
<li>ä½¿ç”¨ <code>exhaustMap</code> ç¡®ä¿å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆåå†æ‰§è¡Œä¸‹ä¸€ä¸ª</li>
<li>ä½¿ç”¨ <code>catchError</code> å¤„ç†å•ä¸ªè¯·æ±‚çš„é”™è¯¯</li>
<li>è®°å½•æ¯æ¬¡è½®è¯¢çš„ç»“æœ</li>
</ol>
<h4 data-id="heading-7">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è½®è¯¢é—´éš”ï¼ˆæ¯«ç§’ï¼‰</span>
<span class="hljs-keyword">readonly</span> pollInterval = <span class="hljs-number">3000</span>; <span class="hljs-comment">// 3ç§’</span>

<span class="hljs-comment">// è½®è¯¢è®¢é˜…</span>
<span class="hljs-keyword">private</span> pollSubscription?: <span class="hljs-title class_">Subscription</span>;

<span class="hljs-comment">// è½®è¯¢çŠ¶æ€</span>
isPolling = <span class="hljs-literal">false</span>;

<span class="hljs-comment">// å¼€å§‹è½®è¯¢</span>
<span class="hljs-title function_">startPolling</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// å¦‚æœå·²ç»åœ¨è½®è¯¢ï¼Œå…ˆåœæ­¢</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPolling</span>) {
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPolling</span> = <span class="hljs-literal">true</span>;
  
  <span class="hljs-comment">// ä½¿ç”¨ timer(0, 3000) ç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œç„¶åæ¯3ç§’æ‰§è¡Œä¸€æ¬¡</span>
  <span class="hljs-comment">// ä½¿ç”¨ exhaustMap ç¡®ä¿å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆåå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œé¿å…è¯·æ±‚å †ç§¯</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollSubscription</span> = <span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollInterval</span>)
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> recordId = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">recordCounter</span>;
        <span class="hljs-keyword">const</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>();
        
        <span class="hljs-comment">// åˆ›å»ºè®°å½•ï¼ˆå…ˆæ ‡è®°ä¸º pendingï¼Œå®é™…åœ¨å“åº”ä¸­æ›´æ–°ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title class_">PollApiResponse</span>&gt;(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.apiBaseUrl}</span><span class="hljs-subst">${<span class="hljs-variable language_">this</span>.pollApiUrl}</span>`</span>)
          .<span class="hljs-title function_">pipe</span>(
            <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
              <span class="hljs-comment">// é”™è¯¯å¤„ç†</span>
              <span class="hljs-keyword">const</span> <span class="hljs-attr">errorRecord</span>: <span class="hljs-title class_">PollRecord</span> = {
                <span class="hljs-attr">id</span>: recordId,
                <span class="hljs-attr">timestamp</span>: startTime,
                <span class="hljs-attr">status</span>: <span class="hljs-string">'error'</span>,
                <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> || <span class="hljs-string">'è¯·æ±‚å¤±è´¥'</span>
              };
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-title function_">unshift</span>(errorRecord);
              <span class="hljs-comment">// é™åˆ¶è®°å½•æ•°é‡ï¼Œæœ€å¤šä¿ç•™50æ¡</span>
              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">50</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>);
              }
              <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
              <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
            })
          );
      })
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response) {
          <span class="hljs-keyword">const</span> <span class="hljs-attr">record</span>: <span class="hljs-title class_">PollRecord</span> = {
            <span class="hljs-attr">id</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">recordCounter</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
            response,
            <span class="hljs-attr">status</span>: response.<span class="hljs-property">success</span> ? <span class="hljs-string">'success'</span> : <span class="hljs-string">'error'</span>
          };
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-title function_">unshift</span>(record);
          <span class="hljs-comment">// é™åˆ¶è®°å½•æ•°é‡ï¼Œæœ€å¤šä¿ç•™50æ¡</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">50</span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>);
          }
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        }
      },
      <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è½®è¯¢é”™è¯¯:'</span>, error);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopPolling</span>();
      }
    });
}

<span class="hljs-comment">// åœæ­¢è½®è¯¢</span>
<span class="hljs-title function_">stopPolling</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollSubscription</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollSubscription</span>.<span class="hljs-title function_">unsubscribe</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollSubscription</span> = <span class="hljs-literal">undefined</span>;
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPolling</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
}
</code></pre>
<h3 data-id="heading-8">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-9">1. timer æ“ä½œç¬¦</h4>
<p><code>timer(0, 3000)</code> çš„å«ä¹‰ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆ0ï¼‰</strong>ï¼šå»¶è¿Ÿæ—¶é—´ï¼Œ0 è¡¨ç¤ºç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡</li>
<li><strong>ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ3000ï¼‰</strong>ï¼šé—´éš”æ—¶é—´ï¼Œæ¯ 3000 æ¯«ç§’ï¼ˆ3 ç§’ï¼‰æ‰§è¡Œä¸€æ¬¡</li>
</ul>
<h4 data-id="heading-10">2. exhaustMap çš„ä½œç”¨</h4>
<p><code>exhaustMap</code> ç¡®ä¿ï¼š</p>
<ul>
<li>å¦‚æœå‰ä¸€ä¸ªè¯·æ±‚è¿˜åœ¨è¿›è¡Œï¼Œå¿½ç•¥æ–°çš„è½®è¯¢å‘¨æœŸ</li>
<li>åªæœ‰å½“å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆåï¼Œæ‰ä¼šå¤„ç†ä¸‹ä¸€ä¸ªè½®è¯¢å‘¨æœŸ</li>
<li>é¿å…è¯·æ±‚å †ç§¯ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›</li>
</ul>
<h4 data-id="heading-11">3. æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h4>
<p>å‡è®¾ API å“åº”æ—¶é—´ä¸º 2 ç§’ï¼š</p>
<ol>
<li><strong>0 ç§’</strong>ï¼štimer å‘å‡ºç¬¬ä¸€ä¸ªå€¼ â†’ exhaustMap å‘èµ·è¯·æ±‚ Aï¼ˆ2 ç§’ï¼‰</li>
<li><strong>3 ç§’</strong>ï¼štimer å‘å‡ºç¬¬äºŒä¸ªå€¼ â†’ exhaustMap å¿½ç•¥ï¼ˆè¯·æ±‚ A è¿˜åœ¨è¿›è¡Œï¼‰</li>
<li><strong>4 ç§’</strong>ï¼šè¯·æ±‚ A å®Œæˆ â†’ å¯ä»¥å¤„ç†ä¸‹ä¸€ä¸ªå€¼</li>
<li><strong>6 ç§’</strong>ï¼štimer å‘å‡ºç¬¬ä¸‰ä¸ªå€¼ â†’ exhaustMap å‘èµ·è¯·æ±‚ Bï¼ˆ2 ç§’ï¼‰</li>
<li><strong>8 ç§’</strong>ï¼šè¯·æ±‚ B å®Œæˆ</li>
</ol>
<p><strong>ç»“æœ</strong>ï¼šæ¯ 3-4 ç§’æ‰§è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œä¸ä¼šå †ç§¯ã€‚</p>
<h4 data-id="heading-12">4. é”™è¯¯å¤„ç†</h4>
<p>ä½¿ç”¨ <code>catchError</code> ç¡®ä¿å•ä¸ªè¯·æ±‚çš„é”™è¯¯ä¸ä¼šä¸­æ–­æ•´ä¸ªè½®è¯¢æµç¨‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
  <span class="hljs-comment">// è®°å½•é”™è¯¯ï¼Œä½†ç»§ç»­è½®è¯¢</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleError</span>(error);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
})
</code></pre>
<h3 data-id="heading-13">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<h4 data-id="heading-14">æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ setIntervalï¼ˆä¸æ¨èï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šæ— æ³•ä¼˜é›…åœ°å–æ¶ˆï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">subscribe</span>();
}, <span class="hljs-number">3000</span>);

<span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨æ¸…ç†</span>
<span class="hljs-built_in">clearInterval</span>(interval);
</code></pre>
<h4 data-id="heading-15">æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ mergeMapï¼ˆæœ‰é—®é¢˜ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âš ï¸ é—®é¢˜ï¼šå¯èƒ½åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚</span>
<span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3000</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>))
)
</code></pre>
<h4 data-id="heading-16">æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ exhaustMapï¼ˆæ¨èï¼‰âœ…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šé¿å…è¯·æ±‚å †ç§¯</span>
<span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3000</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>))
)
</code></pre>
<h3 data-id="heading-17">é«˜çº§ç”¨æ³•</h3>
<h4 data-id="heading-18">1. æ¡ä»¶è½®è¯¢</h4>
<p>æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦ç»§ç»­è½®è¯¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3000</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/task-status'</span>)),
  <span class="hljs-title function_">takeWhile</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-property">status</span> !== <span class="hljs-string">'completed'</span>), <span class="hljs-comment">// ä»»åŠ¡å®Œæˆæ—¶åœæ­¢è½®è¯¢</span>
  <span class="hljs-title function_">finalize</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è½®è¯¢ç»“æŸ'</span>))
)
</code></pre>
<h4 data-id="heading-19">2. åŠ¨æ€è°ƒæ•´è½®è¯¢é—´éš”</h4>
<p>æ ¹æ®å“åº”ç»“æœåŠ¨æ€è°ƒæ•´è½®è¯¢é—´éš”ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> pollInterval = <span class="hljs-number">3000</span>;

<span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, pollInterval).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>)),
  <span class="hljs-title function_">tap</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-comment">// æ ¹æ®å“åº”è°ƒæ•´è½®è¯¢é—´éš”</span>
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">hasUpdate</span>) {
      pollInterval = <span class="hljs-number">1000</span>; <span class="hljs-comment">// æœ‰æ›´æ–°æ—¶åŠ å¿«è½®è¯¢</span>
    } <span class="hljs-keyword">else</span> {
      pollInterval = <span class="hljs-number">5000</span>; <span class="hljs-comment">// æ— æ›´æ–°æ—¶å‡æ…¢è½®è¯¢</span>
    }
  })
)
</code></pre>
<h4 data-id="heading-20">3. æŒ‡æ•°é€€é¿è½®è¯¢</h4>
<p>å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œé€æ¸å¢åŠ è½®è¯¢é—´éš”ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> pollInterval = <span class="hljs-number">3000</span>;
<span class="hljs-keyword">let</span> consecutiveErrors = <span class="hljs-number">0</span>;

<span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, pollInterval).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> 
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>).<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">tap</span>(<span class="hljs-function">() =&gt;</span> {
        consecutiveErrors = <span class="hljs-number">0</span>; <span class="hljs-comment">// æˆåŠŸæ—¶é‡ç½®é”™è¯¯è®¡æ•°</span>
        pollInterval = <span class="hljs-number">3000</span>; <span class="hljs-comment">// é‡ç½®é—´éš”</span>
      }),
      <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        consecutiveErrors++;
        pollInterval = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">3000</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, consecutiveErrors), <span class="hljs-number">30000</span>); <span class="hljs-comment">// æŒ‡æ•°é€€é¿</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
      })
    )
  )
)
</code></pre>
<h3 data-id="heading-21">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-22">1. ä»»åŠ¡çŠ¶æ€æ£€æŸ¥</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ£€æŸ¥åå°ä»»åŠ¡æ˜¯å¦å®Œæˆ</span>
<span class="hljs-title function_">startPollingTaskStatus</span>(<span class="hljs-attr">taskId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2000</span>).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTaskStatus</span>(taskId)),
    <span class="hljs-title function_">takeWhile</span>(<span class="hljs-function"><span class="hljs-params">status</span> =&gt;</span> status !== <span class="hljs-string">'completed'</span> &amp;&amp; status !== <span class="hljs-string">'failed'</span>),
    <span class="hljs-title function_">finalize</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ä»»åŠ¡å®Œæˆï¼Œåœæ­¢è½®è¯¢</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onTaskComplete</span>();
    })
  ).<span class="hljs-title function_">subscribe</span>();
}
</code></pre>
<h4 data-id="heading-23">2. æ•°æ®åŒæ­¥</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šæœŸåŒæ­¥æ•°æ®</span>
<span class="hljs-title function_">startDataSync</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5000</span>).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">syncData</span>()),
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åŒæ­¥å¤±è´¥:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// ç»§ç»­è½®è¯¢</span>
    })
  ).<span class="hljs-title function_">subscribe</span>();
}
</code></pre>
<h4 data-id="heading-24">3. æ¶ˆæ¯é€šçŸ¥</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šæœŸæ£€æŸ¥æ–°æ¶ˆæ¯</span>
<span class="hljs-title function_">startMessagePolling</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">timer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3000</span>).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">exhaustMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkNewMessages</span>()),
    <span class="hljs-title function_">tap</span>(<span class="hljs-function"><span class="hljs-params">messages</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (messages.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showNotifications</span>(messages);
      }
    })
  ).<span class="hljs-title function_">subscribe</span>();
}
</code></pre>
<h3 data-id="heading-25">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-26">1. åˆç†è®¾ç½®è½®è¯¢é—´éš”</h4>
<p>æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®åˆç†çš„è½®è¯¢é—´éš”ï¼š</p>
<ul>
<li><strong>å®æ—¶æ€§è¦æ±‚é«˜</strong>ï¼š1-3 ç§’</li>
<li><strong>ä¸€èˆ¬åœºæ™¯</strong>ï¼š3-5 ç§’</li>
<li><strong>å®æ—¶æ€§è¦æ±‚ä½</strong>ï¼š10-30 ç§’</li>
</ul>
<h4 data-id="heading-27">2. é™åˆ¶è®°å½•æ•°é‡</h4>
<p>å¯¹äºè½®è¯¢ç»“æœï¼Œé™åˆ¶è®°å½•æ•°é‡ï¼Œé¿å…å†…å­˜å ç”¨è¿‡å¤§ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">50</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollRecords</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>);
}
</code></pre>
<h4 data-id="heading-28">3. åœ¨é¡µé¢ä¸å¯è§æ—¶æš‚åœè½®è¯¢</h4>
<p>ä½¿ç”¨ Page Visibility API åœ¨é¡µé¢ä¸å¯è§æ—¶æš‚åœè½®è¯¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">document</span>, <span class="hljs-string">'visibilitychange'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">hidden</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopPolling</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startPolling</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;
    }
  })
).<span class="hljs-title function_">subscribe</span>();
</code></pre>
<h3 data-id="heading-29">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆè®¢é˜…</li>
<li><strong>æœåŠ¡å™¨å‹åŠ›</strong>ï¼šåˆç†è®¾ç½®è½®è¯¢é—´éš”ï¼Œé¿å…ç»™æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›</li>
<li><strong>ç½‘ç»œæ¶ˆè€—</strong>ï¼šè½®è¯¢ä¼šæŒç»­æ¶ˆè€—ç½‘ç»œèµ„æºï¼Œè€ƒè™‘ä½¿ç”¨ WebSocket æ›¿ä»£</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šç»™ç”¨æˆ·é€‚å½“çš„åé¦ˆï¼Œå‘ŠçŸ¥æ­£åœ¨è½®è¯¢</li>
</ol>
<h3 data-id="heading-30">æ€»ç»“</h3>
<p>ä½¿ç”¨ <code>exhaustMap</code> å®ç°è½®è¯¢æœºåˆ¶æ˜¯ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡å¿½ç•¥æ–°çš„è¯·æ±‚æ¥ç¡®ä¿ï¼š</p>
<ul>
<li><strong>é¿å…è¯·æ±‚å †ç§¯</strong>ï¼šå‰ä¸€ä¸ªè¯·æ±‚å®Œæˆåå†æ‰§è¡Œä¸‹ä¸€ä¸ª</li>
<li><strong>èµ„æºèŠ‚çº¦</strong>ï¼šä¸ä¼šåŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚</li>
<li><strong>ä»£ç ç®€æ´</strong>ï¼šä½¿ç”¨ RxJS æ“ä½œç¬¦ï¼Œä»£ç æ¸…æ™°æ˜“è¯»</li>
<li><strong>æ˜“äºç®¡ç†</strong>ï¼šå¯ä»¥è½»æ¾å¯åŠ¨å’Œåœæ­¢è½®è¯¢</li>
</ul>
<p>è®°ä½ï¼š<strong>è½®è¯¢æ˜¯ä¸€ç§ç®€å•ä½†æœ‰æ•ˆçš„å®æ—¶æ•°æ®è·å–æ–¹å¼ï¼Œä½†å¯¹äºå®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œè€ƒè™‘ä½¿ç”¨ WebSocket æˆ– Server-Sent Events</strong>ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æˆ˜ï¼šåŸºäº LangChain + Multimodal RAG æ„å»ºè§†é¢‘çŸ¥è¯†åº“ï¼ˆæ•°æ®æ¸…æ´—å…¨æµç¨‹ï¼‰]]></title>    <link>https://juejin.cn/post/7600489282839609354</link>    <guid>https://juejin.cn/post/7600489282839609354</guid>    <pubDate>2026-01-29T09:06:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600489282839609354" data-draft-id="7600601482689855534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æˆ˜ï¼šåŸºäº LangChain + Multimodal RAG æ„å»ºè§†é¢‘çŸ¥è¯†åº“ï¼ˆæ•°æ®æ¸…æ´—å…¨æµç¨‹ï¼‰"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-29T09:06:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FT542"/> <meta itemprop="url" content="https://juejin.cn/user/3423222479199755"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æˆ˜ï¼šåŸºäº LangChain + Multimodal RAG æ„å»ºè§†é¢‘çŸ¥è¯†åº“ï¼ˆæ•°æ®æ¸…æ´—å…¨æµç¨‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3423222479199755/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FT542
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:06:03.000Z" title="Thu Jan 29 2026 09:06:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è®­ç»ƒå‚ç›´é¢†åŸŸçš„ Video-Text æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éµå¾ª <code>Data Ingestion -&gt; Cleaning -&gt; Chunking -&gt; Embedding</code> çš„æ ‡å‡†é“¾è·¯ã€‚</p>
<p>ç—›ç‚¹åœ¨äº <strong>Cleaning</strong> ç¯èŠ‚ã€‚ä¼ ç»Ÿçš„ <code>OpenCV In-painting</code> æ–¹æ³•æ¨ç†æˆæœ¬è¿‡é«˜ï¼ˆå¤„ç† 1000 å°æ—¶è§†é¢‘éœ€è¦æ•°åƒ GPU æ—¶ï¼‰ï¼Œä¸”å®¹æ˜“äº§ç”Ÿä¼ªå½±ã€‚åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œæœ€ä¼˜è§£æ˜¯<strong>æº¯æº</strong>â€”â€”ç›´æ¥è·å– CDN åˆ†å‘ç«¯çš„åŸå§‹ MP4 æµã€‚</p>
<h4 data-id="heading-0">1. Pipeline æ¶æ„è®¾è®¡</h4>
<p>æˆ‘ä»¬ä¸é€ è½®å­ï¼Œè€Œæ˜¯ç»„åˆå·¥å…·ã€‚</p>
<ul>
<li><strong>Orchestration</strong>: LangChain</li>
<li><strong>Parser Middleware</strong>: No-Code è§£æå™¨ï¼ˆå¦‚é¦™è•‰ä¸€é”®å»æ°´å°ï¼‰</li>
<li><strong>Vector DB</strong>: Milvus / Pinecone</li>
</ul>
<h4 data-id="heading-1">2. æ ¸å¿ƒä»£ç å®ç° (Python)</h4>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ•°æ®æ¸…æ´—ç±» <code>VideoCorpusCleaner</code>ã€‚æ³¨æ„ <code>_fetch_clean_stream</code> æ–¹æ³•çš„è®¾è®¡æ€è·¯ï¼šæˆ‘ä»¬å°†å¤æ‚çš„é€†å‘ç­¾åé€»è¾‘ï¼ˆReverse Engineeringï¼‰å¤–åŒ…ç»™ç¨³å®šçš„è§£æå·¥å…·ï¼Œç¡®ä¿ Pipeline çš„å¥å£®æ€§ã€‚</p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>
<span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> UnstructuredFileLoader

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoCorpusCleaner</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, raw_metadata: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]</span>):
        self.metadata = raw_metadata
        self.output_dir = <span class="hljs-string">"./clean_corpus/video"</span>
        os.makedirs(self.output_dir, exist_ok=<span class="hljs-literal">True</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_fetch_clean_stream</span>(<span class="hljs-params">self, share_url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""
        æ ¸å¿ƒé€»è¾‘ï¼šé€šè¿‡è§£æå±‚è·å–æ— æ°´å°ç›´é“¾ (Clean Stream URL)
        
        Engineering Note:
        ç»´æŠ¤å„å¹³å°çš„ JS é€†å‘ç­¾åæˆæœ¬æé«˜ï¼ˆTime Consumingï¼‰ã€‚
        ç”Ÿäº§ç¯å¢ƒå»ºè®®æ¥å…¥ 'é¦™è•‰ä¸€é”®å»æ°´å°' è¿™ç±»å°ç¨‹åºä½œä¸º Parser Middlewareã€‚
        è¾“å…¥ Share URL -&gt; è¾“å‡º Origin MP4 URL (æ— æ°´å°/1080P)ã€‚
        """</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[*] Parsing Deep Link: <span class="hljs-subst">{share_url}</span>"</span>)
        
        <span class="hljs-comment"># æ¨¡æ‹Ÿè°ƒç”¨è§£ææ¥å£æˆ–æ‰‹åŠ¨è·å–</span>
        <span class="hljs-comment"># å®é™…éƒ¨ç½²æ—¶ï¼Œè¿™é‡Œé€šå¸¸æ˜¯ä¸€ä¸ª API Call</span>
        <span class="hljs-comment"># ä¼˜åŠ¿ï¼šç›´æ¥è·å– Ground Truth çº§åˆ«çš„åŸå§‹ç´ æï¼Œæ— éœ€ CV åå¤„ç†</span>
        clean_url = <span class="hljs-string">"https://cdn.platform.com/origin_stream_example.mp4"</span> 
        <span class="hljs-keyword">return</span> clean_url

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">download_and_validate</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span>, file_id: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""ä¸‹è½½æµå¹¶æ ¡éªŒå®Œæ•´æ€§"""</span>
        clean_url = self._fetch_clean_stream(url)
        save_path = os.path.join(self.output_dir, <span class="hljs-string">f"<span class="hljs-subst">{file_id}</span>.mp4"</span>)
        
        <span class="hljs-comment"># ä½¿ç”¨ curl è¿›è¡Œé«˜å¹¶å‘ä¸‹è½½</span>
        cmd = <span class="hljs-string">f"curl -L -o <span class="hljs-subst">{save_path}</span> '<span class="hljs-subst">{clean_url}</span>'"</span>
        subprocess.run(cmd, shell=<span class="hljs-literal">True</span>, check=<span class="hljs-literal">True</span>)
        
        <span class="hljs-keyword">if</span> self._check_integrity(save_path):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[+] Asset <span class="hljs-subst">{file_id}</span> sanitized and saved."</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[-] Asset <span class="hljs-subst">{file_id}</span> corrupted."</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_check_integrity</span>(<span class="hljs-params">self, path</span>):
        <span class="hljs-keyword">return</span> os.path.getsize(path) &gt; <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> <span class="hljs-comment"># Simple check</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">batch_process</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.metadata:
            <span class="hljs-comment"># é’ˆå¯¹å›¾æ–‡æ•°æ®é›†(Gallery)å’Œè§†é¢‘(Video)åˆ†åˆ«å¤„ç†</span>
            self.download_and_validate(item[<span class="hljs-string">'url'</span>], item[<span class="hljs-string">'id'</span>])

<span class="hljs-comment"># Usage Example</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®æºï¼šé€šå¸¸æ¥è‡ªçˆ¬è™«åº“</span>
    sample_data = [
        {<span class="hljs-string">"id"</span>: <span class="hljs-string">"v001"</span>, <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://v.douyin.com/xyz/"</span>},
        {<span class="hljs-string">"id"</span>: <span class="hljs-string">"v002"</span>, <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://xhslink.com/abc/"</span>}
    ]
    
    cleaner = VideoCorpusCleaner(sample_data)
    cleaner.batch_process()
</code></pre>
<h4 data-id="heading-2">3. å‘é‡åŒ–ä¸å…¥åº“</h4>
<p>æ‹¿åˆ° Clean Data åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠ½å–å…³é”®å¸§ï¼ˆKeyframesï¼‰è¿›è¡Œ CLIP ç¼–ç ï¼Œæ­¤æ—¶çš„å‘é‡ç©ºé—´åˆ†å¸ƒå°†ä¸å†å—å¹³å° Logo çš„å¹²æ‰°ã€‚</p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Pseudo-code for Embedding</span>
from transformers import CLIPProcessor, CLIPModel

<span class="hljs-attr">model</span> = CLIPModel.from_pretrained(<span class="hljs-string">"openai/clip-vit-base-patch32"</span>)
<span class="hljs-attr">processor</span> = CLIPProcessor.from_pretrained(<span class="hljs-string">"openai/clip-vit-base-patch32"</span>)

<span class="hljs-comment"># ç”±äºåœ¨ä¸Šä¸€æ­¥é€šè¿‡ Parser è·å–äº†æ— æ°´å°åŸç‰‡ï¼Œ</span>
<span class="hljs-comment"># è¿™é‡Œçš„ image_inputs ä¸éœ€è¦å†åš crop æˆ– mask æ“ä½œï¼Œç›´æ¥è¾“å…¥å…¨å›¾</span>
<span class="hljs-attr">image_inputs</span> = processor(images=cleaned_frames, return_tensors=<span class="hljs-string">"pt"</span>)
<span class="hljs-attr">image_features</span> = model.get_image_features(**image_inputs)
</code></pre>
<hr/>
<p><strong>âš™ï¸ Tech Stack &amp; QA (å·¥ç¨‹åŒ–å·¥å…·æ ˆ)</strong></p>






























<table><thead><tr><th><strong>Layer</strong></th><th><strong>Tool Name</strong></th><th><strong>Role in Pipeline</strong></th></tr></thead><tbody><tr><td><strong>Model</strong></td><td>OpenAI CLIP</td><td>å¤šæ¨¡æ€ç‰¹å¾å¯¹é½ä¸ç¼–ç </td></tr><tr><td><strong>Framework</strong></td><td>LangChain</td><td>ç¼–æ’æ•°æ®å¤„ç†æµç¨‹</td></tr><tr><td><strong>Asset Parser</strong></td><td><strong>é¦™è•‰ä¸€é”®å»æ°´å°</strong></td><td><strong>[ETL æ¸…æ´—]</strong> æ›¿ä»£ OpenCVï¼Œä½œä¸ºæ— ä»£ç è§£æå™¨æå–<strong>æ— æ°´å° MP4</strong> å’Œ <strong>å›¾é›†åŸå›¾</strong> (Ground Truth)ã€‚</td></tr><tr><td><strong>Storage</strong></td><td>Milvus (Lite)</td><td>å‘é‡æ•°æ®æŒä¹…åŒ–å­˜å‚¨</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åç« ä½¿ç”¨ RxJS å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ]]></title>    <link>https://juejin.cn/post/7600469605477056554</link>    <guid>https://juejin.cn/post/7600469605477056554</guid>    <pubDate>2026-01-29T09:06:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600469605477056554" data-draft-id="7600562816458506282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åç« ä½¿ç”¨ RxJS å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ "/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:06:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åç« ä½¿ç”¨ RxJS å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:06:50.000Z" title="Thu Jan 29 2026 09:06:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ RxJS å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ </h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>å¤§æ–‡ä»¶ä¸Šä¼ æ˜¯ Web å¼€å‘ä¸­çš„å¸¸è§éœ€æ±‚ã€‚ç›´æ¥ä¸Šä¼ å¤§æ–‡ä»¶å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>è¶…æ—¶</strong>ï¼šæ–‡ä»¶å¤ªå¤§ï¼Œä¸Šä¼ æ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´è¯·æ±‚è¶…æ—¶</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå¤§æ–‡ä»¶å ç”¨å¤§é‡å†…å­˜</li>
<li><strong>ç½‘ç»œä¸­æ–­</strong>ï¼šç½‘ç»œä¸ç¨³å®šæ—¶ï¼Œéœ€è¦é‡æ–°ä¸Šä¼ æ•´ä¸ªæ–‡ä»¶</li>
<li><strong>ç”¨æˆ·ä½“éªŒå·®</strong>ï¼šæ— æ³•æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ï¼Œç”¨æˆ·ä¸çŸ¥é“ä¸Šä¼ çŠ¶æ€</li>
</ol>
<p>åˆ†ç‰‡ä¸Šä¼ ï¼ˆChunk Uploadï¼‰æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„æœ‰æ•ˆæ–¹æ¡ˆã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ RxJS å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼ŒåŒ…æ‹¬æ–­ç‚¹ç»­ä¼ ã€è¿›åº¦æ˜¾ç¤ºã€å¹¶å‘æ§åˆ¶ç­‰åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-2">åˆ†ç‰‡ä¸Šä¼ çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>åˆ†ç‰‡ä¸Šä¼ æ˜¯æŒ‡å°†å¤§æ–‡ä»¶åˆ†å‰²æˆå¤šä¸ªå°ç‰‡æ®µï¼ˆChunkï¼‰ï¼Œé€ä¸ªä¸Šä¼ ï¼Œæœ€ååœ¨æœåŠ¡å™¨ç«¯åˆå¹¶ã€‚ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>é¿å…è¶…æ—¶</strong>ï¼šæ¯ä¸ªåˆ†ç‰‡è¾ƒå°ï¼Œä¸Šä¼ æ—¶é—´çŸ­</li>
<li><strong>æ–­ç‚¹ç»­ä¼ </strong>ï¼šç½‘ç»œä¸­æ–­åï¼Œåªéœ€ä¸Šä¼ æœªå®Œæˆçš„åˆ†ç‰‡</li>
<li><strong>è¿›åº¦æ˜¾ç¤º</strong>ï¼šå¯ä»¥æ˜¾ç¤ºæ¯ä¸ªåˆ†ç‰‡å’Œæ•´ä½“çš„ä¸Šä¼ è¿›åº¦</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šå¯ä»¥æ§åˆ¶åŒæ—¶ä¸Šä¼ çš„åˆ†ç‰‡æ•°é‡</li>
</ol>
<h3 data-id="heading-3">å®ç°æ€è·¯</h3>
<h4 data-id="heading-4">1. æ–‡ä»¶åˆ†ç‰‡</h4>
<p>å°†æ–‡ä»¶æŒ‰ç…§æŒ‡å®šå¤§å°ï¼ˆå¦‚ 2MBï¼‰åˆ†å‰²æˆå¤šä¸ªåˆ†ç‰‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">createChunks</span>(<span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>): <span class="hljs-title class_">ChunkInfo</span>[] {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">chunks</span>: <span class="hljs-title class_">ChunkInfo</span>[] = [];
  <span class="hljs-keyword">const</span> totalChunks = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(file.<span class="hljs-property">size</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">CHUNK_SIZE</span>);
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; totalChunks; i++) {
    <span class="hljs-keyword">const</span> start = i * <span class="hljs-variable language_">this</span>.<span class="hljs-property">CHUNK_SIZE</span>;
    <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(start + <span class="hljs-variable language_">this</span>.<span class="hljs-property">CHUNK_SIZE</span>, file.<span class="hljs-property">size</span>);
    <span class="hljs-keyword">const</span> blob = file.<span class="hljs-title function_">slice</span>(start, end);
    
    chunks.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">index</span>: i,
      start,
      end,
      blob,
      <span class="hljs-attr">uploaded</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span>
    });
  }
  
  <span class="hljs-keyword">return</span> chunks;
}
</code></pre>
<h4 data-id="heading-5">2. ä¸Šä¼ å•ä¸ªåˆ†ç‰‡</h4>
<p>ä½¿ç”¨ <code>HttpRequest</code> çš„ <code>reportProgress</code> é€‰é¡¹æ¥è·Ÿè¸ªä¸Šä¼ è¿›åº¦ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">uploadChunk</span>(<span class="hljs-attr">chunk</span>: <span class="hljs-title class_">ChunkInfo</span>, <span class="hljs-attr">fileId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">file</span>: <span class="hljs-title class_">File</span>): <span class="hljs-title class_">Observable</span>&lt;{ <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">progress</span>: <span class="hljs-built_in">number</span> }&gt; {
  <span class="hljs-comment">// å¦‚æœå·²ç»ä¸Šä¼ ï¼Œç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">if</span> (chunk.<span class="hljs-property">uploaded</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({ <span class="hljs-attr">index</span>: chunk.<span class="hljs-property">index</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">100</span> });
  }
  
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'file'</span>, chunk.<span class="hljs-property">blob</span>);
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'chunkIndex'</span>, chunk.<span class="hljs-property">index</span>.<span class="hljs-title function_">toString</span>());
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'fileId'</span>, fileId);
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'fileName'</span>, file.<span class="hljs-property">name</span>);
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'totalChunks'</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(file.<span class="hljs-property">size</span> / <span class="hljs-variable language_">this</span>.<span class="hljs-property">CHUNK_SIZE</span>).<span class="hljs-title function_">toString</span>());
  
  <span class="hljs-keyword">const</span> req = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpRequest</span>(<span class="hljs-string">'POST'</span>, <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.API_BASE_URL}</span>/api/upload/chunk`</span>, formData, {
    <span class="hljs-attr">reportProgress</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// å¯ç”¨è¿›åº¦æŠ¥å‘Š</span>
  });
  
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">request</span>(req).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">event: HttpEvent&lt;<span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> {
      <span class="hljs-keyword">switch</span> (event.<span class="hljs-property">type</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">HttpEventType</span>.<span class="hljs-property">UploadProgress</span>:
          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">total</span>) {
            <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((<span class="hljs-number">100</span> * event.<span class="hljs-property">loaded</span>) / event.<span class="hljs-property">total</span>);
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">index</span>: chunk.<span class="hljs-property">index</span>, progress };
          }
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">index</span>: chunk.<span class="hljs-property">index</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span> };
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">HttpEventType</span>.<span class="hljs-property">Response</span>:
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">index</span>: chunk.<span class="hljs-property">index</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">100</span> };
        <span class="hljs-attr">default</span>:
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">index</span>: chunk.<span class="hljs-property">index</span>, <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span> };
      }
    }),
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`åˆ†ç‰‡ <span class="hljs-subst">${chunk.index}</span> ä¸Šä¼ å¤±è´¥:`</span>, error);
      <span class="hljs-keyword">throw</span> { <span class="hljs-attr">index</span>: chunk.<span class="hljs-property">index</span>, error };
    })
  );
}
</code></pre>
<h4 data-id="heading-6">3. å¹¶å‘ä¸Šä¼ å¤šä¸ªåˆ†ç‰‡</h4>
<p>ä½¿ç”¨ <code>mergeMap</code> å¹¶å‘ä¸Šä¼ å¤šä¸ªåˆ†ç‰‡ï¼Œå¹¶é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°é™åˆ¶å¹¶å‘æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è·å–æœªä¸Šä¼ çš„åˆ†ç‰‡</span>
<span class="hljs-keyword">const</span> pendingChunks = chunks.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> !c.<span class="hljs-property">uploaded</span>);

<span class="hljs-comment">// åˆ›å»ºåˆ†ç‰‡ä¸Šä¼ æµ</span>
<span class="hljs-keyword">const</span> chunkStreams$ = <span class="hljs-title function_">from</span>(pendingChunks).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadChunk</span>(chunk, fileId, file).<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUploadCancel$</span>),
      <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-comment">// å¤„ç†é”™è¯¯ï¼Œç»§ç»­ä¸Šä¼ å…¶ä»–åˆ†ç‰‡</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`åˆ†ç‰‡ <span class="hljs-subst">${chunk.index}</span> ä¸Šä¼ å¤±è´¥:`</span>, error);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>) {
          <span class="hljs-keyword">const</span> chunkToUpdate = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">chunks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">index</span> === chunk.<span class="hljs-property">index</span>);
          <span class="hljs-keyword">if</span> (chunkToUpdate) {
            chunkToUpdate.<span class="hljs-property">progress</span> = <span class="hljs-number">0</span>;
          }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;
      })
    );
  }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">CONCURRENT_LIMIT</span>), <span class="hljs-comment">// å¹¶å‘é™åˆ¶ï¼šæœ€å¤šåŒæ—¶ä¸Šä¼  3 ä¸ªåˆ†ç‰‡</span>
  <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroy$</span>)
);
</code></pre>
<h4 data-id="heading-7">4. èšåˆè¿›åº¦</h4>
<p>ä½¿ç”¨ <code>scan</code> æ“ä½œç¬¦èšåˆæ‰€æœ‰åˆ†ç‰‡çš„ä¸Šä¼ è¿›åº¦ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">chunkStreams$.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc, chunkProgress</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>) {
      <span class="hljs-keyword">return</span> acc;
    }
    
    <span class="hljs-keyword">const</span> chunk = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">chunks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">index</span> === chunkProgress.<span class="hljs-property">index</span>);
    <span class="hljs-keyword">if</span> (chunk) {
      chunk.<span class="hljs-property">progress</span> = chunkProgress.<span class="hljs-property">progress</span>;
      <span class="hljs-keyword">if</span> (chunkProgress.<span class="hljs-property">progress</span> === <span class="hljs-number">100</span>) {
        chunk.<span class="hljs-property">uploaded</span> = <span class="hljs-literal">true</span>;
      }
    }
    
    <span class="hljs-comment">// è®¡ç®—æ€»è¿›åº¦</span>
    <span class="hljs-keyword">const</span> uploadedSize = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">chunks</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, c</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (c.<span class="hljs-property">uploaded</span>) {
        <span class="hljs-keyword">return</span> sum + c.<span class="hljs-property">blob</span>.<span class="hljs-property">size</span>;
      }
      <span class="hljs-keyword">return</span> sum + (c.<span class="hljs-property">blob</span>.<span class="hljs-property">size</span> * c.<span class="hljs-property">progress</span> / <span class="hljs-number">100</span>);
    }, <span class="hljs-number">0</span>);
    
    <span class="hljs-keyword">const</span> uploadedChunks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">chunks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">uploaded</span>).<span class="hljs-property">length</span>;
    
    <span class="hljs-keyword">const</span> progress = {
      <span class="hljs-attr">loaded</span>: uploadedSize,
      <span class="hljs-attr">total</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">file</span>.<span class="hljs-property">size</span>,
      <span class="hljs-attr">percentage</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>((uploadedSize / <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">file</span>.<span class="hljs-property">size</span>) * <span class="hljs-number">100</span>),
      uploadedChunks,
      <span class="hljs-attr">totalChunks</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">chunks</span>.<span class="hljs-property">length</span>
    };
    
    <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'uploading'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">progress</span> = progress;
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveUploadProgress</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>); <span class="hljs-comment">// ä¿å­˜è¿›åº¦åˆ° localStorage</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
    }
    
    <span class="hljs-keyword">return</span> progress;
  }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">progress</span>)
)
</code></pre>
<h4 data-id="heading-8">5. æ–­ç‚¹ç»­ä¼ </h4>
<p>ä½¿ç”¨ <code>localStorage</code> ä¿å­˜ä¸Šä¼ è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¿å­˜ä¸Šä¼ è¿›åº¦</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">saveUploadProgress</span>(<span class="hljs-attr">state</span>: <span class="hljs-title class_">UploadState</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> dataToSave = {
      <span class="hljs-attr">fileId</span>: state.<span class="hljs-property">fileId</span>,
      <span class="hljs-attr">chunks</span>: state.<span class="hljs-property">chunks</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> ({
        <span class="hljs-attr">index</span>: c.<span class="hljs-property">index</span>,
        <span class="hljs-attr">uploaded</span>: c.<span class="hljs-property">uploaded</span>,
        <span class="hljs-attr">progress</span>: c.<span class="hljs-property">progress</span>
      })),
      <span class="hljs-attr">progress</span>: state.<span class="hljs-property">progress</span>,
      <span class="hljs-attr">status</span>: state.<span class="hljs-property">status</span>
    };
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">`<span class="hljs-subst">${STORAGE_KEY_PREFIX}</span><span class="hljs-subst">${state.fileId}</span>`</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(dataToSave));
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ä¿å­˜ä¸Šä¼ è¿›åº¦å¤±è´¥:'</span>, e);
  }
}

<span class="hljs-comment">// åŠ è½½ä¸Šä¼ è¿›åº¦</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">loadUploadProgress</span>(<span class="hljs-attr">fileId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">UploadState</span>&gt; | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">const</span> stored = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`<span class="hljs-subst">${STORAGE_KEY_PREFIX}</span><span class="hljs-subst">${fileId}</span>`</span>);
  <span class="hljs-keyword">if</span> (stored) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(stored);
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è§£æä¸Šä¼ è¿›åº¦å¤±è´¥:'</span>, e);
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-9">6. åˆå¹¶åˆ†ç‰‡</h4>
<p>æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆåï¼Œè°ƒç”¨åˆå¹¶æ¥å£ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆå¹¶æ‰€æœ‰åˆ†ç‰‡</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">mergeChunks</span>(<span class="hljs-attr">fileId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">fileName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">totalChunks</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">any</span>&gt; {
  <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpParams</span>()
    .<span class="hljs-title function_">set</span>(<span class="hljs-string">'fileId'</span>, fileId)
    .<span class="hljs-title function_">set</span>(<span class="hljs-string">'fileName'</span>, fileName)
    .<span class="hljs-title function_">set</span>(<span class="hljs-string">'totalChunks'</span>, totalChunks.<span class="hljs-title function_">toString</span>());
  
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.API_BASE_URL}</span>/api/upload/merge`</span>, <span class="hljs-literal">null</span>, { params }).<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åˆå¹¶åˆ†ç‰‡å¤±è´¥:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">of</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'åˆå¹¶æˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰'</span> });
    })
  );
}
</code></pre>
<h3 data-id="heading-10">å®Œæ•´æµç¨‹</h3>
<h4 data-id="heading-11">1. å¼€å§‹ä¸Šä¼ </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">startUpload</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> file = <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedFile</span>;
  <span class="hljs-keyword">const</span> fileId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateFileId</span>(file);
  
  <span class="hljs-comment">// åˆ›å»ºåˆ†ç‰‡</span>
  <span class="hljs-keyword">let</span> chunks = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createChunks</span>(file);
  
  <span class="hljs-comment">// å°è¯•ä» localStorage æ¢å¤è¿›åº¦</span>
  <span class="hljs-keyword">const</span> savedProgress = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadUploadProgress</span>(fileId);
  <span class="hljs-keyword">if</span> (savedProgress &amp;&amp; savedProgress.<span class="hljs-property">chunks</span>) {
    <span class="hljs-comment">// æ¢å¤å·²ä¸Šä¼ çš„åˆ†ç‰‡ä¿¡æ¯</span>
    chunks = chunks.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> saved = savedProgress.<span class="hljs-property">chunks</span>?.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">index</span> === chunk.<span class="hljs-property">index</span>);
      <span class="hljs-keyword">if</span> (saved) {
        <span class="hljs-keyword">return</span> {
          ...chunk,
          <span class="hljs-attr">uploaded</span>: saved.<span class="hljs-property">uploaded</span> || <span class="hljs-literal">false</span>,
          <span class="hljs-attr">progress</span>: saved.<span class="hljs-property">progress</span> || <span class="hljs-number">0</span>
        };
      }
      <span class="hljs-keyword">return</span> chunk;
    });
  }
  
  <span class="hljs-comment">// åˆå§‹åŒ–ä¸Šä¼ çŠ¶æ€</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span> = {
    file,
    fileId,
    chunks,
    <span class="hljs-attr">progress</span>: { <span class="hljs-comment">/* ... */</span> },
    <span class="hljs-attr">status</span>: <span class="hljs-string">'uploading'</span>
  };
  
  <span class="hljs-comment">// å¼€å§‹ä¸Šä¼ æœªå®Œæˆçš„åˆ†ç‰‡</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-12">2. æš‚åœä¸Šä¼ </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">pauseUpload</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'uploading'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUploadCancel$</span>.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// å–æ¶ˆå½“å‰ä¸Šä¼ </span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUploadCancel$</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;(); <span class="hljs-comment">// åˆ›å»ºæ–°çš„å–æ¶ˆ Subject</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'paused'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveUploadProgress</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>); <span class="hljs-comment">// ä¿å­˜è¿›åº¦</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
  }
}
</code></pre>
<h4 data-id="heading-13">3. ç»§ç»­ä¸Šä¼ </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">resumeUpload</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">uploadState</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'paused'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startUpload</span>(); <span class="hljs-comment">// ä»æš‚åœå¤„ç»§ç»­</span>
  }
}
</code></pre>
<h3 data-id="heading-14">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-15">1. å¹¶å‘æ§åˆ¶</h4>
<p>ä½¿ç”¨ <code>mergeMap</code> çš„ç¬¬äºŒä¸ªå‚æ•°é™åˆ¶å¹¶å‘æ•°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadChunk</span>(chunk), <span class="hljs-number">3</span>) <span class="hljs-comment">// æœ€å¤šåŒæ—¶ä¸Šä¼  3 ä¸ªåˆ†ç‰‡</span>
</code></pre>
<h4 data-id="heading-16">2. è¿›åº¦è®¡ç®—</h4>
<p>æ€»è¿›åº¦ = æ‰€æœ‰åˆ†ç‰‡çš„å·²ä¸Šä¼ å¤§å° / æ–‡ä»¶æ€»å¤§å°</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> uploadedSize = chunks.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, c</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (c.<span class="hljs-property">uploaded</span>) {
    <span class="hljs-keyword">return</span> sum + c.<span class="hljs-property">blob</span>.<span class="hljs-property">size</span>; <span class="hljs-comment">// å·²ä¸Šä¼ çš„åˆ†ç‰‡ï¼Œä½¿ç”¨å®Œæ•´å¤§å°</span>
  }
  <span class="hljs-keyword">return</span> sum + (c.<span class="hljs-property">blob</span>.<span class="hljs-property">size</span> * c.<span class="hljs-property">progress</span> / <span class="hljs-number">100</span>); <span class="hljs-comment">// æ­£åœ¨ä¸Šä¼ çš„åˆ†ç‰‡ï¼ŒæŒ‰è¿›åº¦è®¡ç®—</span>
}, <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-17">3. é”™è¯¯å¤„ç†</h4>
<p>å•ä¸ªåˆ†ç‰‡ä¸Šä¼ å¤±è´¥ä¸å½±å“å…¶ä»–åˆ†ç‰‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">catchError</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
  <span class="hljs-comment">// è®°å½•é”™è¯¯ï¼Œç»§ç»­ä¸Šä¼ å…¶ä»–åˆ†ç‰‡</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`åˆ†ç‰‡ <span class="hljs-subst">${chunk.index}</span> ä¸Šä¼ å¤±è´¥:`</span>, error);
  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>; <span class="hljs-comment">// ä¸ä¸­æ–­æµ</span>
})
</code></pre>
<h4 data-id="heading-18">4. å–æ¶ˆä¸Šä¼ </h4>
<p>ä½¿ç”¨ <code>Subject</code> å®ç°å–æ¶ˆåŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> currentUploadCancel$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-comment">// ä¸Šä¼ æ—¶ä½¿ç”¨ takeUntil</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">uploadChunk</span>(chunk).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUploadCancel$</span>)
)

<span class="hljs-comment">// å–æ¶ˆæ—¶å‘å‡ºä¿¡å·</span>
<span class="hljs-title function_">cancelUpload</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUploadCancel$</span>.<span class="hljs-title function_">next</span>();
}
</code></pre>
<h3 data-id="heading-19">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-20">1. å¤§æ–‡ä»¶ä¸Šä¼ </h4>
<p>é€‚ç”¨äºä¸Šä¼ è§†é¢‘ã€å¤§å‹æ–‡æ¡£ç­‰å¤§æ–‡ä»¶ã€‚</p>
<h4 data-id="heading-21">2. æ–­ç‚¹ç»­ä¼ </h4>
<p>ç½‘ç»œä¸­æ–­åï¼Œå¯ä»¥ä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­ä¸Šä¼ ã€‚</p>
<h4 data-id="heading-22">3. è¿›åº¦æ˜¾ç¤º</h4>
<p>å®æ—¶æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<h4 data-id="heading-23">4. å¹¶å‘ä¼˜åŒ–</h4>
<p>é€šè¿‡æ§åˆ¶å¹¶å‘æ•°ï¼Œå¹³è¡¡ä¸Šä¼ é€Ÿåº¦å’ŒæœåŠ¡å™¨å‹åŠ›ã€‚</p>
<h3 data-id="heading-24">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-25">1. åˆç†è®¾ç½®åˆ†ç‰‡å¤§å°</h4>
<p>æ ¹æ®ç½‘ç»œç¯å¢ƒå’Œæ–‡ä»¶å¤§å°è®¾ç½®åˆç†çš„åˆ†ç‰‡å¤§å°ï¼š</p>
<ul>
<li><strong>ç½‘ç»œå¥½</strong>ï¼š2-5MB</li>
<li><strong>ç½‘ç»œä¸€èˆ¬</strong>ï¼š1-2MB</li>
<li><strong>ç½‘ç»œå·®</strong>ï¼š500KB-1MB</li>
</ul>
<h4 data-id="heading-26">2. åˆç†è®¾ç½®å¹¶å‘æ•°</h4>
<p>æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è®¾ç½®åˆç†çš„å¹¶å‘æ•°ï¼š</p>
<ul>
<li><strong>æœåŠ¡å™¨æ€§èƒ½å¥½</strong>ï¼š3-5 ä¸ª</li>
<li><strong>æœåŠ¡å™¨æ€§èƒ½ä¸€èˆ¬</strong>ï¼š2-3 ä¸ª</li>
<li><strong>æœåŠ¡å™¨æ€§èƒ½å·®</strong>ï¼š1-2 ä¸ª</li>
</ul>
<h4 data-id="heading-27">3. å‹ç¼©æ–‡ä»¶</h4>
<p>å¯¹äºå¯ä»¥å‹ç¼©çš„æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼‰ï¼Œå…ˆå‹ç¼©å†ä¸Šä¼ ã€‚</p>
<h4 data-id="heading-28">4. ä½¿ç”¨ Web Workers</h4>
<p>å¯¹äºå¤§æ–‡ä»¶çš„åˆ†ç‰‡å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ Web Workers é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
<h3 data-id="heading-29">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>localStorage é™åˆ¶</strong>ï¼šlocalStorage æœ‰å¤§å°é™åˆ¶ï¼ˆé€šå¸¸ 5-10MBï¼‰ï¼Œå¤§æ–‡ä»¶çš„è¿›åº¦ä¿¡æ¯å¯èƒ½æ— æ³•å®Œå…¨ä¿å­˜</li>
<li><strong>æœåŠ¡å™¨æ”¯æŒ</strong>ï¼šéœ€è¦æœåŠ¡å™¨æ”¯æŒåˆ†ç‰‡ä¸Šä¼ å’Œåˆå¹¶æ¥å£</li>
<li><strong>æ–‡ä»¶å®Œæ•´æ€§</strong>ï¼šåˆå¹¶åéœ€è¦éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆå¦‚ MD5ï¼‰</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå¤§æ–‡ä»¶åˆ†ç‰‡ä»ä¼šå ç”¨å†…å­˜ï¼Œéœ€è¦æ³¨æ„</li>
</ol>
<h3 data-id="heading-30">æ€»ç»“</h3>
<p>ä½¿ç”¨ RxJS å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæä¾›äº†ï¼š</p>
<ul>
<li><strong>åˆ†ç‰‡ä¸Šä¼ </strong>ï¼šå°†å¤§æ–‡ä»¶åˆ†å‰²æˆå°ç‰‡æ®µä¸Šä¼ </li>
<li><strong>æ–­ç‚¹ç»­ä¼ </strong>ï¼šæ”¯æŒä»ä¸Šæ¬¡ä¸­æ–­å¤„ç»§ç»­ä¸Šä¼ </li>
<li><strong>è¿›åº¦æ˜¾ç¤º</strong>ï¼šå®æ—¶æ˜¾ç¤ºä¸Šä¼ è¿›åº¦</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šæ§åˆ¶åŒæ—¶ä¸Šä¼ çš„åˆ†ç‰‡æ•°é‡</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šå•ä¸ªåˆ†ç‰‡å¤±è´¥ä¸å½±å“å…¶ä»–åˆ†ç‰‡</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨ RxJS æ“ä½œç¬¦ï¼ˆ<code>mergeMap</code>ã€<code>scan</code>ã€<code>takeUntil</code> ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜è‰¯çš„å¤§æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åäºŒç« ä½¿ç”¨ throttleTime å®ç°å¼¹å¹•ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7600587732991311914</link>    <guid>https://juejin.cn/post/7600587732991311914</guid>    <pubDate>2026-01-29T09:07:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600587732991311914" data-draft-id="7600560664407621695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åäºŒç« ä½¿ç”¨ throttleTime å®ç°å¼¹å¹•ç³»ç»Ÿ"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:07:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åäºŒç« ä½¿ç”¨ throttleTime å®ç°å¼¹å¹•ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:07:50.000Z" title="Thu Jan 29 2026 09:07:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ throttleTime å®ç°å¼¹å¹•ç³»ç»Ÿ</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>å¼¹å¹•ï¼ˆDanmakuï¼‰æ˜¯ä¸€ç§åœ¨è§†é¢‘æˆ–ç›´æ’­ä¸­å®æ—¶æ˜¾ç¤ºç”¨æˆ·è¯„è®ºçš„åŠŸèƒ½ã€‚åœ¨å®ç°å¼¹å¹•ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†ï¼š</p>
<ol>
<li><strong>ç‚¹å‡»èŠ‚æµ</strong>ï¼šç”¨æˆ·å¿«é€Ÿç‚¹å‡»æ—¶ï¼Œé™åˆ¶å¼¹å¹•åˆ›å»ºé¢‘ç‡</li>
<li><strong>åŠ¨ç”»ç®¡ç†</strong>ï¼šç®¡ç†å¼¹å¹•çš„åˆ›å»ºã€åŠ¨ç”»å’Œé”€æ¯</li>
<li><strong>ä½ç½®éšæœº</strong>ï¼šå¼¹å¹•åœ¨éšæœºä½ç½®å‡ºç°</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé¿å…åˆ›å»ºè¿‡å¤šå¼¹å¹•å¯¼è‡´æ€§èƒ½é—®é¢˜</li>
</ol>
<p>æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ RxJS çš„ <code>throttleTime</code> æ“ä½œç¬¦å®ç°å¼¹å¹•ç³»ç»Ÿï¼Œå¹¶å¤„ç†ç‚¹å‡»äº‹ä»¶çš„èŠ‚æµã€‚</p>
<h3 data-id="heading-2">å¼¹å¹•ç³»ç»Ÿçš„åŸºæœ¬éœ€æ±‚</h3>
<ol>
<li><strong>è¾“å…¥æ¡†å‘é€</strong>ï¼šç”¨æˆ·è¾“å…¥æ–‡å­—åå‘é€å¼¹å¹•</li>
<li><strong>ç‚¹å‡»è§¦å‘</strong>ï¼šç”¨æˆ·ç‚¹å‡»åŒºåŸŸæ—¶åˆ›å»ºéšæœºå¼¹å¹•</li>
<li><strong>åŠ¨ç”»æ•ˆæœ</strong>ï¼šå¼¹å¹•ä»å³åˆ°å·¦ç§»åŠ¨</li>
<li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šå¼¹å¹•åŠ¨ç”»ç»“æŸåè‡ªåŠ¨ç§»é™¤</li>
</ol>
<h3 data-id="heading-3">å®ç°æ€è·¯</h3>
<h4 data-id="heading-4">1. å¼¹å¹•æ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¼¹å¹•é¡¹æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DanmakuItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">top</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// å¼¹å¹•çš„å‚ç›´ä½ç½®ï¼ˆç™¾åˆ†æ¯”ï¼‰</span>
  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// å¼¹å¹•é¢œè‰²</span>
  <span class="hljs-attr">speed</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// å¼¹å¹•é€Ÿåº¦ï¼ˆç§’ï¼‰</span>
}
</code></pre>
<h4 data-id="heading-5">2. ç‚¹å‡»èŠ‚æµ</h4>
<p>ä½¿ç”¨ <code>throttleTime</code> é™åˆ¶ç‚¹å‡»äº‹ä»¶çš„è§¦å‘é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç‚¹å‡»èŠ‚æµ Subject</span>
<span class="hljs-keyword">private</span> clickSubject$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-title class_">MouseEvent</span>&gt;();

<span class="hljs-comment">// é”€æ¯ Subject</span>
<span class="hljs-keyword">private</span> destroySubject$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-title function_">ngOnInit</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// è®¾ç½®ç‚¹å‡»èŠ‚æµï¼šæ¯ 300ms æœ€å¤šè§¦å‘ä¸€æ¬¡</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">clickSubject$</span>
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">300</span>), <span class="hljs-comment">// èŠ‚æµï¼šæ¯ 300ms æœ€å¤šè§¦å‘ä¸€æ¬¡</span>
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroySubject$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmakuFromClick</span>(event);
    });
}

<span class="hljs-comment">// ç‚¹å‡»åŒºåŸŸè§¦å‘å¼¹å¹•ï¼ˆå¸¦èŠ‚æµï¼‰</span>
<span class="hljs-title function_">onDanmakuAreaClick</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">clickSubject$</span>.<span class="hljs-title function_">next</span>(event);
}
</code></pre>
<h4 data-id="heading-6">3. åˆ›å»ºå¼¹å¹•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¼¹å¹•é¢œè‰²æ± </span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> colors = [
  <span class="hljs-string">'#ffffff'</span>,
  <span class="hljs-string">'#ff6b6b'</span>,
  <span class="hljs-string">'#4ecdc4'</span>,
  <span class="hljs-string">'#45b7d1'</span>,
  <span class="hljs-string">'#f9ca24'</span>,
  <span class="hljs-string">'#6c5ce7'</span>,
  <span class="hljs-string">'#a29bfe'</span>,
  <span class="hljs-string">'#fd79a8'</span>,
  <span class="hljs-string">'#00b894'</span>,
  <span class="hljs-string">'#e17055'</span>,
];

<span class="hljs-comment">// åˆ›å»ºå¼¹å¹•</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">createDanmaku</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">danmaku</span>: <span class="hljs-title class_">DanmakuItem</span> = {
    <span class="hljs-attr">id</span>: ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuIdCounter</span>,
    text,
    <span class="hljs-attr">top</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">80</span> + <span class="hljs-number">10</span>, <span class="hljs-comment">// 10% - 90% ä¹‹é—´çš„éšæœºä½ç½®</span>
    <span class="hljs-attr">color</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-variable language_">this</span>.<span class="hljs-property">colors</span>.<span class="hljs-property">length</span>)],
    <span class="hljs-attr">speed</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3</span> + <span class="hljs-number">5</span>, <span class="hljs-comment">// 5-8 ç§’ä¹‹é—´éšæœºé€Ÿåº¦</span>
  };

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuList</span>.<span class="hljs-title function_">push</span>(danmaku);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();

  <span class="hljs-comment">// å¼¹å¹•åŠ¨ç”»ç»“æŸåç§»é™¤ï¼ˆé€Ÿåº¦ + 0.5ç§’ç¼“å†²ï¼‰</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuList</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> === danmaku.<span class="hljs-property">id</span>);
    <span class="hljs-keyword">if</span> (index !== -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuList</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
    }
  }, (danmaku.<span class="hljs-property">speed</span> + <span class="hljs-number">0.5</span>) * <span class="hljs-number">1000</span>);
}

<span class="hljs-comment">// ä»ç‚¹å‡»äº‹ä»¶åˆ›å»ºå¼¹å¹•</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">createDanmakuFromClick</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> clickTexts = [
    <span class="hljs-string">'666'</span>,
    <span class="hljs-string">'å¤ªæ£’äº†ï¼'</span>,
    <span class="hljs-string">'å‰å®³ï¼'</span>,
    <span class="hljs-string">'èµï¼'</span>,
    <span class="hljs-string">'å¥½ï¼'</span>,
    <span class="hljs-string">'ä¸é”™ï¼'</span>,
    <span class="hljs-string">'æ”¯æŒï¼'</span>,
    <span class="hljs-string">'åŠ æ²¹ï¼'</span>,
    <span class="hljs-string">'å¾ˆæ£’ï¼'</span>,
    <span class="hljs-string">'ä¼˜ç§€ï¼'</span>,
  ];
  <span class="hljs-keyword">const</span> randomText = clickTexts[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * clickTexts.<span class="hljs-property">length</span>)];
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmaku</span>(randomText);
}
</code></pre>
<h4 data-id="heading-7">4. è¾“å…¥æ¡†å‘é€</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¼¹å¹•è¾“å…¥æ–‡å­—</span>
danmakuText = <span class="hljs-string">''</span>;

<span class="hljs-comment">// å‘é€å¼¹å¹•ï¼ˆä»è¾“å…¥æ¡†ï¼‰</span>
<span class="hljs-title function_">sendDanmaku</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuText</span>.<span class="hljs-title function_">trim</span>()) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmaku</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuText</span>.<span class="hljs-title function_">trim</span>());
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuText</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// æ¸…ç©ºè¾“å…¥æ¡†</span>
}

<span class="hljs-comment">// å›è½¦é”®å‘é€å¼¹å¹•</span>
<span class="hljs-title function_">onKeyDown</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">KeyboardEvent</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span> &amp;&amp; !event.<span class="hljs-property">shiftKey</span>) {
    event.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendDanmaku</span>();
  }
}
</code></pre>
<h3 data-id="heading-8">CSS åŠ¨ç”»å®ç°</h3>
<p>å¼¹å¹•çš„ç§»åŠ¨åŠ¨ç”»é€šè¿‡ CSS å®ç°ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.danmaku-item</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">white-space</span>: nowrap;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">animation</span>: danmaku-move linear;
  <span class="hljs-attribute">pointer-events</span>: none;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
}

<span class="hljs-keyword">@keyframes</span> danmaku-move {
  <span class="hljs-selector-tag">from</span> {
    <span class="hljs-attribute">left</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>);
  }
  <span class="hljs-selector-tag">to</span> {
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">100%</span>);
  }
}
</code></pre>
<h3 data-id="heading-9">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-10">1. throttleTime çš„ä½œç”¨</h4>
<p>ä½¿ç”¨ <code>throttleTime(300)</code> å¯ä»¥ï¼š</p>
<ul>
<li>é™åˆ¶ç‚¹å‡»äº‹ä»¶çš„è§¦å‘é¢‘ç‡</li>
<li>é¿å…ç”¨æˆ·å¿«é€Ÿç‚¹å‡»æ—¶åˆ›å»ºè¿‡å¤šå¼¹å¹•</li>
<li>æå‡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ</li>
</ul>
<h4 data-id="heading-11">2. å¼¹å¹•ä½ç½®éšæœº</h4>
<p>é€šè¿‡ <code>Math.random() * 80 + 10</code> ç”Ÿæˆ 10% - 90% ä¹‹é—´çš„éšæœºä½ç½®ï¼Œé¿å…å¼¹å¹•é‡å ã€‚</p>
<h4 data-id="heading-12">3. å¼¹å¹•é€Ÿåº¦éšæœº</h4>
<p>é€šè¿‡ <code>Math.random() * 3 + 5</code> ç”Ÿæˆ 5-8 ç§’ä¹‹é—´çš„éšæœºé€Ÿåº¦ï¼Œè®©å¼¹å¹•ç§»åŠ¨æ›´è‡ªç„¶ã€‚</p>
<h4 data-id="heading-13">4. è‡ªåŠ¨æ¸…ç†</h4>
<p>ä½¿ç”¨ <code>setTimeout</code> åœ¨å¼¹å¹•åŠ¨ç”»ç»“æŸåè‡ªåŠ¨ç§»é™¤ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<h3 data-id="heading-14">æ‰§è¡Œæµç¨‹ç¤ºä¾‹</h3>
<p>å‡è®¾ç”¨æˆ·å¿«é€Ÿç‚¹å‡»å¼¹å¹•åŒºåŸŸï¼š</p>
<ol>
<li><strong>0ms</strong>ï¼šç”¨æˆ·ç‚¹å‡» â†’ <code>clickSubject$</code> å‘å‡ºäº‹ä»¶</li>
<li><strong>0ms</strong>ï¼š<code>throttleTime</code> ç«‹å³å¤„ç† â†’ åˆ›å»ºå¼¹å¹• A</li>
<li><strong>100ms</strong>ï¼šç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ <code>clickSubject$</code> å‘å‡ºäº‹ä»¶</li>
<li><strong>100ms</strong>ï¼š<code>throttleTime</code> å¿½ç•¥ï¼ˆåœ¨ 300ms å†…ï¼‰</li>
<li><strong>200ms</strong>ï¼šç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ <code>clickSubject$</code> å‘å‡ºäº‹ä»¶</li>
<li><strong>200ms</strong>ï¼š<code>throttleTime</code> å¿½ç•¥ï¼ˆåœ¨ 300ms å†…ï¼‰</li>
<li><strong>400ms</strong>ï¼šç”¨æˆ·å†æ¬¡ç‚¹å‡» â†’ <code>clickSubject$</code> å‘å‡ºäº‹ä»¶</li>
<li><strong>400ms</strong>ï¼š<code>throttleTime</code> å¤„ç†ï¼ˆå·²è¶…è¿‡ 300msï¼‰â†’ åˆ›å»ºå¼¹å¹• B</li>
</ol>
<p><strong>ç»“æœ</strong>ï¼š300ms å†…åªåˆ›å»º 1 ä¸ªå¼¹å¹•ï¼Œé¿å…è¿‡å¤šå¼¹å¹•ã€‚</p>
<h3 data-id="heading-15">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<h4 data-id="heading-16">æ–¹æ¡ˆ 1ï¼šä¸ä½¿ç”¨èŠ‚æµï¼ˆæœ‰é—®é¢˜ï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå¿«é€Ÿç‚¹å‡»ä¼šåˆ›å»ºè¿‡å¤šå¼¹å¹•</span>
<span class="hljs-title function_">onDanmakuAreaClick</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmakuFromClick</span>(event); <span class="hljs-comment">// æ¯æ¬¡ç‚¹å‡»éƒ½åˆ›å»º</span>
}
</code></pre>
<h4 data-id="heading-17">æ–¹æ¡ˆ 2ï¼šä½¿ç”¨é˜²æŠ–ï¼ˆä¸é€‚åˆï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âš ï¸ ä¸é€‚åˆï¼šé˜²æŠ–ä¼šç­‰å¾…ç”¨æˆ·åœæ­¢ç‚¹å‡»ï¼Œä½†å¼¹å¹•éœ€è¦å³æ—¶åé¦ˆ</span>
<span class="hljs-title function_">onDanmakuAreaClick</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmakuFromClick</span>(event);
  });
}
</code></pre>
<h4 data-id="heading-18">æ–¹æ¡ˆ 3ï¼šä½¿ç”¨èŠ‚æµï¼ˆæ¨èï¼‰âœ…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šé™åˆ¶é¢‘ç‡ä½†ä¿æŒå³æ—¶åé¦ˆ</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">clickSubject$</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">300</span>)
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmakuFromClick</span>(event);
});
</code></pre>
<h3 data-id="heading-19">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-20">1. è§†é¢‘å¼¹å¹•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è§†é¢‘æ’­æ”¾æ—¶æ˜¾ç¤ºå¼¹å¹•</span>
<span class="hljs-title function_">playVideo</span>().<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">() =&gt;</span> 
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuService</span>.<span class="hljs-title function_">getDanmakus</span>(videoId).<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">danmaku</span> =&gt;</span> {
        <span class="hljs-comment">// æ ¹æ®è§†é¢‘æ—¶é—´æ˜¾ç¤ºå¼¹å¹•</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">timer</span>(danmaku.<span class="hljs-property">time</span> * <span class="hljs-number">1000</span>).<span class="hljs-title function_">pipe</span>(
          <span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> danmaku)
        );
      })
    )
  )
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">danmaku</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmaku</span>(danmaku.<span class="hljs-property">text</span>);
});
</code></pre>
<h4 data-id="heading-21">2. ç›´æ’­å¼¹å¹•</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¥æ”¶ç›´æ’­å¼¹å¹•</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">websocketService</span>.<span class="hljs-title function_">onMessage</span>(<span class="hljs-string">'danmaku'</span>).<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">100</span>) <span class="hljs-comment">// é™åˆ¶å¼¹å¹•åˆ›å»ºé¢‘ç‡</span>
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">danmaku</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmaku</span>(danmaku.<span class="hljs-property">text</span>);
});
</code></pre>
<h4 data-id="heading-22">3. äº’åŠ¨æ¸¸æˆ</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¸¸æˆä¸­çš„å¼¹å¹•æ•ˆæœ</span>
<span class="hljs-title function_">onPlayerAction</span>(<span class="hljs-attr">action</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionSubject$</span>.<span class="hljs-title function_">next</span>(action);
}

<span class="hljs-variable language_">this</span>.<span class="hljs-property">actionSubject$</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">throttleTime</span>(<span class="hljs-number">500</span>) <span class="hljs-comment">// é™åˆ¶åŠ¨ä½œè§¦å‘é¢‘ç‡</span>
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">action</span> =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createDanmaku</span>(action);
});
</code></pre>
<h3 data-id="heading-23">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-24">1. é™åˆ¶å¼¹å¹•æ•°é‡</h4>
<p>é™åˆ¶åŒæ—¶æ˜¾ç¤ºçš„å¼¹å¹•æ•°é‡ï¼Œé¿å…æ€§èƒ½é—®é¢˜ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é™åˆ¶å¼¹å¹•æ•°é‡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">MAX_DANMAKU</span> = <span class="hljs-number">50</span>;

<span class="hljs-keyword">private</span> <span class="hljs-title function_">createDanmaku</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// å¦‚æœå¼¹å¹•æ•°é‡è¶…è¿‡é™åˆ¶ï¼Œç§»é™¤æœ€æ—§çš„</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuList</span>.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">MAX_DANMAKU</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuList</span>.<span class="hljs-title function_">shift</span>();
  }
  
  <span class="hljs-comment">// åˆ›å»ºæ–°å¼¹å¹•</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-25">2. ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨</h4>
<p>å¯¹äºå¤§é‡å¼¹å¹•ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å¼¹å¹•</span>
<span class="hljs-title function_">getVisibleDanmakus</span>(): <span class="hljs-title class_">DanmakuItem</span>[] {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuList</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">danmaku</span> =&gt;</span> {
    <span class="hljs-comment">// åˆ¤æ–­å¼¹å¹•æ˜¯å¦åœ¨å¯è§åŒºåŸŸ</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isDanmakuVisible</span>(danmaku);
  });
}
</code></pre>
<h4 data-id="heading-26">3. ä½¿ç”¨ CSS åŠ¨ç”»</h4>
<p>ä½¿ç”¨ CSS åŠ¨ç”»è€Œä¸æ˜¯ JavaScript åŠ¨ç”»ï¼Œæ€§èƒ½æ›´å¥½ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.danmaku-item</span> {
  <span class="hljs-attribute">animation</span>: danmaku-move linear;
  <span class="hljs-attribute">will-change</span>: transform; <span class="hljs-comment">/* ä¼˜åŒ–æ€§èƒ½ */</span>
}
</code></pre>
<h4 data-id="heading-27">4. é˜²æŠ–è¾“å…¥æ¡†</h4>
<p>å¯¹äºè¾“å…¥æ¡†å‘é€ï¼Œå¯ä»¥ç»“åˆé˜²æŠ–ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">danmakuInput</span>.<span class="hljs-property">valueChanges</span>.<span class="hljs-title function_">pipe</span>(
  <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">300</span>),
  <span class="hljs-title function_">distinctUntilChanged</span>()
).<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
  <span class="hljs-comment">// è¾“å…¥æ¡†å˜åŒ–å¤„ç†</span>
});
</code></pre>
<h3 data-id="heading-28">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç¡®ä¿å¼¹å¹•åŠ¨ç”»ç»“æŸååŠæ—¶ç§»é™¤</li>
<li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šé™åˆ¶åŒæ—¶æ˜¾ç¤ºçš„å¼¹å¹•æ•°é‡</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šåˆç†è®¾ç½®èŠ‚æµæ—¶é—´ï¼Œæ—¢é™åˆ¶é¢‘ç‡åˆä¿æŒå“åº”</li>
<li><strong>åŠ¨ç”»æµç•…</strong>ï¼šä½¿ç”¨ CSS åŠ¨ç”»å’Œ <code>will-change</code> ä¼˜åŒ–æ€§èƒ½</li>
</ol>
<h3 data-id="heading-29">æ€»ç»“</h3>
<p>ä½¿ç”¨ <code>throttleTime</code> å®ç°å¼¹å¹•ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡é™åˆ¶ç‚¹å‡»äº‹ä»¶çš„è§¦å‘é¢‘ç‡æ¥ç¡®ä¿ï¼š</p>
<ul>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé¿å…åˆ›å»ºè¿‡å¤šå¼¹å¹•å¯¼è‡´æ€§èƒ½é—®é¢˜</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šä¿æŒå³æ—¶åé¦ˆï¼Œä½†é™åˆ¶é¢‘ç‡</li>
<li><strong>ä»£ç ç®€æ´</strong>ï¼šä½¿ç”¨ RxJS æ“ä½œç¬¦ï¼Œä»£ç æ¸…æ™°æ˜“è¯»</li>
<li><strong>æ˜“äºæ‰©å±•</strong>ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚å¼¹å¹•è¿‡æ»¤ã€å¼¹å¹•æ ·å¼ç­‰ï¼‰</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨ RxJS æ“ä½œç¬¦ï¼ˆ<code>throttleTime</code>ã€<code>takeUntil</code> ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªæµç•…ã€é«˜æ•ˆçš„å¼¹å¹•ç³»ç»Ÿã€‚</p>
<p>è®°ä½ï¼š<strong>èŠ‚æµé€‚åˆéœ€è¦å³æ—¶åé¦ˆä½†éœ€è¦é™åˆ¶é¢‘ç‡çš„åœºæ™¯ï¼Œè€Œé˜²æŠ–é€‚åˆç­‰å¾…ç”¨æˆ·å®Œæˆæ“ä½œçš„åœºæ™¯</strong>ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆç¨‹åºå‘˜ä¸è‡ªå·±å¼€å‘ä¸€ä¸ªå°ç¨‹åºèµšé’±]]></title>    <link>https://juejin.cn/post/7600489282839625738</link>    <guid>https://juejin.cn/post/7600489282839625738</guid>    <pubDate>2026-01-29T09:06:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600489282839625738" data-draft-id="7600414546189516810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆç¨‹åºå‘˜ä¸è‡ªå·±å¼€å‘ä¸€ä¸ªå°ç¨‹åºèµšé’±"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,GitHub"/> <meta itemprop="datePublished" content="2026-01-29T09:06:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å‡Œè§ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3350967174565198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆç¨‹åºå‘˜ä¸è‡ªå·±å¼€å‘ä¸€ä¸ªå°ç¨‹åºèµšé’±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3350967174565198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å‡Œè§ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:06:48.000Z" title="Thu Jan 29 2026 09:06:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å‡Œè§ˆã€‚</p>
<ul>
<li>ä¸ªäººç½‘ç«™ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.code24.top%2F" target="_blank" title="https://blog.code24.top/" ref="nofollow noopener noreferrer">blog.code24.top</a></li>
<li>å»æ°´å°ä¸‹è½½é¸­ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fnologo.code24.top%2F" target="_blank" title="http://nologo.code24.top/" ref="nofollow noopener noreferrer">nologo.code24.top</a></li>
</ul>
<p>å¦‚æœæœ¬æ–‡èƒ½ç»™ä½ æä¾›å¯å‘æˆ–å¸®åŠ©ï¼Œæ¬¢è¿åŠ¨åŠ¨å°æ‰‹æŒ‡ï¼Œä¸€é”®ä¸‰è¿ï¼ˆ<code>ç‚¹èµ</code>ã€<code>è¯„è®º</code>ã€<code>è½¬å‘</code>ï¼‰ï¼Œç»™æˆ‘ä¸€äº›æ”¯æŒå’Œé¼“åŠ±è°¢è°¢ã€‚</p>
<hr/>
<p>åˆ·åˆ°ä¸€ä¸ªæŒºæ‰å¿ƒçš„è¯é¢˜ï¼šç¨‹åºå‘˜ä¸ºä»€ä¹ˆä¸è‡ªå·±åšäº§å“èµšé’±ã€‚</p>
<p>èº«è¾¹è¿˜çœŸæœ‰ä¸å°‘äººé—®è¿‡ç±»ä¼¼çš„è¯ï¼š"ä½ å¤©å¤©å†™ä»£ç è¿™ä¹ˆå‰å®³ï¼Œæ€ä¹ˆä¸è‡ªå·±æä¸ªAppã€åšä¸ªå°ç¨‹åºï¼Ÿéšä¾¿å¼„å¼„ä¸å°±å‘è´¢äº†ï¼Ÿ"</p>
<p>æ¯æ¬¡å¬åˆ°è¿™ç§é—®é¢˜ï¼Œæˆ‘éƒ½ä¸çŸ¥é“è¯¥ä»å“ªå„¿å¼€å§‹è§£é‡Šã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7617ab656e6e488da8d4640c21070318~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5YeM6KeI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770282641&amp;x-signature=WiLDjWxOTjGW4i2rdd03B9n6K%2FI%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€è¿‘åœ¨ X ä¹ä¸Šçœ‹åˆ°åŒè¡Œçš„å›ç­”ï¼Œçœ‹å®Œåªèƒ½è¯´ï¼šå¤ªçœŸå®äº†ã€‚</p>
<h2 data-id="heading-0">ç†æƒ³å¾ˆä¸°æ»¡ã€ç°å®å¾ˆ<strong>éª¨æ„Ÿ</strong></h2>
<p>é¦–å…ˆï¼Œå‡è£…æˆ‘ä»¬æ˜¯ç¨‹åºå‘˜ï¼ŒæŸå¤©æ·±å¤œåŠ ç­å›å®¶ï¼Œç˜«åœ¨æ²™å‘ä¸Šåˆ·æ‰‹æœºï¼Œçªç„¶ä¸€ä¸ªå¿µå¤´ç‚¸å¼€â€”â€”"æˆ‘å»ï¼Œè¿™ä¸ªåŠŸèƒ½å¸‚é¢ä¸Šæ ¹æœ¬æ²¡æœ‰ï¼æˆ‘è¦æ˜¯åšä¸€ä¸ªï¼Œè‚¯å®šçˆ†ç«ï¼â€ã€‚</p>
<p>è„‘å­é‡Œçš„ç”»é¢ç¬é—´æ¸…æ™°ï¼šäº§å“ä¸Šçº¿ã€ç”¨æˆ·ç–¯æ¶¨ã€æŠ•èµ„äººæ’é˜Ÿã€è´¢åŠ¡è‡ªç”±...ï¼Œæ»¡è„‘å­éƒ½æ˜¯"è€å­ä¸å¹²äº†ï¼Œè¦åˆ›ä¸š"ã€‚</p>
<p>è¯´å¹²å°±å¹²ï¼Œæµç¨‹èµ°èµ·æ¥ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œè´¦å·ç»“æœå‘ç°é‚®ç®±æ—©å°±è¢«è‡ªå·±å¤šå¹´å‰æ³¨å†Œè¿‡ï¼Œè¿˜å†»ç»“äº†ã€‚è§£å†»ã€æ¢é‚®ç®±ï¼ŒæŠ˜è…¾ä¸€åœˆã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šæƒ³åå­—ç»å°½è„‘æ±æƒ³äº†ä¸ªå¥½åå­—ï¼Œä¸€æœï¼Œå·²è¢«å ç”¨ã€‚å†æƒ³æƒ³æƒ³ï¼Œç»ˆäºé€šè¿‡ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šå¼€å‘å‰ç«¯åç«¯ä¸€æŠŠæŠ“ï¼Œä¸ä¼šå‰ç«¯ï¼Ÿæ²¡äº‹ï¼ŒAiç»“ä¼´ç¼–ç¨‹ä¸€æŠŠæ¢­ã€‚uniappå¯åŠ¨ï¼Œä¸€å¥—ä»£ç å¤šç«¯è¿è¡Œï¼Œå¾®ä¿¡ã€QQã€æŠ–éŸ³ã€å¿«æ‰‹å¹³å°å…¨éƒ½è¦ä¸Šã€‚</p>
<p>ç¬¬å››æ­¥ï¼šä¹°æœåŠ¡å™¨ï¼Œé˜¿é‡Œäº‘ä¸€æ ¸ä¸¤Gï¼Œä¸€å¹´600å—ï¼Œä»˜æ¬¾çš„æ—¶å€™æ‰‹è¿˜æ²¡æŠ–ã€‚</p>
<p>ç¬¬äº”æ­¥ï¼šæåŸŸåï¼Œéšä¾¿æŒ‘ä¸€ä¸ªï¼Œä¸€å¹´30å—ï¼Œä¾¿å®œã€‚</p>
<p>ç¬¬å…­æ­¥ï¼šå¤‡æ¡ˆåˆ°è¿™é‡Œï¼Œå™©æ¢¦å¼€å§‹äº†ã€‚æ‹ç…§ã€å¡«è¡¨ã€ç­‰å®¡æ ¸ï¼Œæ¥æ¥å›å›æŠ˜è…¾ã€‚å¥½ä¸å®¹æ˜“è¿‡äº†ï¼Œæäº¤å°ç¨‹åºå®¡æ ¸â€”â€”"è¯¥é¡¹ç›®ç±»å‹ä¸ªäººä¸æ”¯æŒï¼Œéœ€è¦ä¼ä¸šè®¤è¯ã€‚"</p>
<p>å’ã€‚äºæŸ-630å…ƒã€‚</p>
<p>ä½†ç¨‹åºå‘˜å˜›ï¼Œå¤´é“ã€‚ä¸ä¿¡é‚ªï¼Œç»§ç»­ï¼š</p>
<p>ç¬¬ä¸ƒæ­¥ï¼šæ³¨å†Œå…¬å¸ä¸ªä½“æˆ·è¦ç»è¥åœºæ‰€ï¼Œå¹²è„†ç›´æ¥æ³¨å†Œå…¬å¸ã€‚å‡†å¤‡ææ–™ã€å¼€å¯¹å…¬è´¦æˆ·ã€åˆ»å…¬ç« ï¼Œåˆæ˜¯ä¸€é¡¿æ“ä½œã€‚</p>
<p>ç¬¬å…«æ­¥ï¼šé‡æ–°è®¤è¯ä¼ä¸šè®¤è¯è¦çš„ææ–™å †æˆå±±ï¼Œå¹²è„†é‡æ–°æ³¨å†Œä¸ªå°ç¨‹åºã€‚åˆæ˜¯æƒ³åå­—ï¼ˆåŸæ¥çš„è¿˜è¦ç­‰ä¸¤å¤©æ‰èƒ½é‡Šæ”¾ï¼‰ã€å¡«èµ„æ–™ã€æ‰¿è¯ºä¹¦ã€ç›–ç« ...</p>
<p>ç»ˆäºï¼Œå°ç¨‹åºä¸Šçº¿äº†ã€‚</p>
<p>ä¸Šçº¿åªæ˜¯å¼€å§‹ï¼Œèµšé’±æ‰æ˜¯éš¾é¢˜ã€‚</p>
<p>æ¯å¤©åŠªåŠ›å®£ä¼ ã€å¼•æµï¼Œç»“æœå¹¿å‘Šæ”¶ç›Šé•¿è¿™æ ·ï¼šæ˜¨æ—¥æ”¶å…¥0.65å…ƒã€‚</p>
<p>å¯¹ï¼Œä½ æ²¡çœ‹é”™ï¼Œå…­æ¯›äº”ã€‚æŠ˜çº¿å›¾ä¸Šçš„æ›²çº¿åœ¨0.3å…ƒåˆ°1.8å…ƒä¹‹é—´åå¤æ¨ªè·³ï¼Œæœˆæ”¶å…¥6.72å…ƒã€‚æœåŠ¡å™¨é’±è¿˜æ²¡èµšå›æ¥ï¼Œå…ˆèµ”è¿›å»å‡ ç™¾å—ã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</h2>
<ul>
<li>ä¸ªäººå¼€å‘è€…ä¸èƒ½æ”¶è´¹ï¼Œåªèƒ½é€šè¿‡æŒ‚å¹¿å‘Šï¼Œè€Œå¹¿å‘Šæ”¶å…¥ä½åˆ°ç¦»è°±ã€‚æ¿€åŠ±å¹¿å‘Šå•ä»·å±…ç„¶åªæœ‰4.29å…ƒ/åƒæ¬¡å±•ç¤ºï¼ŒBannerå¹¿å‘Šæ›´æƒ¨ï¼Œå‡ å—é’±åƒæ¬¡å±•ç¤ºã€‚ç®—ç¬”è´¦ï¼šæ—¥è®¿é—®é‡è¦è¾¾åˆ°2ä¸‡ï¼Œæ‰èƒ½æ—¥å…¥500ã€‚2ä¸‡UVä»€ä¹ˆæ¦‚å¿µï¼Ÿå¾ˆå¤šå°å…¬å¸çš„å®˜ç½‘ä¸€å¤©éƒ½æ²¡è¿™ä¹ˆå¤šäººã€‚</li>
<li>æ¨å¹¿éš¾ï¼Œå°ç¨‹åºæ˜¯ä¸ªå°é—­ç”Ÿæ€ï¼Œä½ ä¸èƒ½è¯±å¯¼åˆ†äº«ï¼Œå¦åˆ™ç›´æ¥å°å·ã€‚åªèƒ½ä»å…¶ä»–å¹³å°å¾€å¾®ä¿¡å¯¼æµï¼Œä½†ç”¨æˆ·è·¯å¾„ä¸€é•¿ï¼Œæµå¤±ç‡å¥‡é«˜ã€‚è¦å¼€é€šæµé‡ä¸»è¿˜å¾—å…ˆå¼•æµ500äººï¼Œè¿™ç¬¬ä¸€é“é—¨æ§›å°±å¡æ­»ä¸å°‘äººã€‚</li>
<li>å®¡æ ¸æœºåˆ¶è®©äººå¤´å¤§ï¼Œé¡µé¢ä¸Šæ–‡å­—ä¸€å¤šï¼Œå°±è¯´ä½ æ¶‰åŠ"å†…å®¹èµ„è®¯"ï¼Œä¸ç»™è¿‡ã€‚ä¸ªäººå¼€å‘è€…ç»è¥ç±»ç›®å—é™ï¼ŒåŠ¨ä¸åŠ¨å°±è¸©çº¢çº¿ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ˜¯å•†ä¸šé—®é¢˜</h2>
<p>ç¨‹åºå‘˜ä¸åšå°ç¨‹åºèµšé’±ï¼Œä¸æ˜¯å› ä¸ºä¸ä¼šå†™ä»£ç ï¼Œè€Œæ˜¯å› ä¸ºå†™ä»£ç åªæ˜¯ä¸‡é‡Œé•¿å¾ç¬¬ä¸€æ­¥ã€‚</p>
<p>åšä¸€ä¸ªèƒ½èµšé’±çš„å°ç¨‹åºï¼Œéœ€è¦ï¼š</p>
<ul>
<li>äº§å“èƒ½åŠ›ï¼šåšä»€ä¹ˆï¼Ÿè§£å†³è°çš„ä»€ä¹ˆé—®é¢˜ï¼Ÿå‡­ä»€ä¹ˆç”¨ä½ çš„ï¼Ÿ</li>
<li>è¿è¥èƒ½åŠ›ï¼šæµé‡ä»å“ªæ¥ï¼Ÿæ€ä¹ˆç•™å­˜ï¼Ÿæ€ä¹ˆå˜ç°ï¼Ÿ</li>
<li>å•†ä¸šèµ„è´¨ï¼šå…¬å¸ã€å¯¹å…¬è´¦æˆ·ã€å„ç§è®¸å¯è¯ï¼Œåˆè§„æˆæœ¬ä¸ä½ï¼›</li>
<li>æ—¶é—´å’Œç²¾åŠ›ï¼šç™½å¤©ä¸Šç­ï¼Œæ™šä¸Šæå‰¯ä¸šï¼ŒæœåŠ¡å™¨åŠå¤œæŒ‚äº†è¿˜å¾—çˆ¬èµ·æ¥ä¿®ã€‚</li>
</ul>
<p>è€Œå¤§å¤šæ•°ç¨‹åºå‘˜ï¼Œåªæ˜¯å–œæ¬¢å†™ä»£ç è€Œå·²ã€‚è®©ä»–ä»¬å»ææµé‡ã€è°ˆå•†åŠ¡ã€å¤„ç†å·¥å•†ç¨åŠ¡ï¼Œæ¯”å†™ä¸€ä¸‡è¡Œä»£ç è¿˜ç—›è‹¦ã€‚</p>
<p>æ›´æ‰å¿ƒçš„æ˜¯ï¼Œå°±ç®—ä½ æ„¿æ„å¹²è¿™äº›ï¼Œå°ç¨‹åºçš„çº¢åˆ©æœŸä¹Ÿæ—©è¿‡äº†ã€‚2017å¹´åˆšå‡ºæ¥é‚£ä¼šå„¿ï¼Œç¡®å®æœ‰äººé ç®€å•å·¥å…·ç±»å°ç¨‹åºèµšåˆ°ç¬¬ä¸€æ¡¶é‡‘ã€‚ç°åœ¨ï¼Ÿå„å¤§å¹³å°åº“å­˜é‡å‡ ç™¾ä¸‡ä¸ªï¼Œç”¨æˆ·æ³¨æ„åŠ›è¢«æŸéŸ³ã€è¢«çº¢ä¹¦åˆ‡å¾—ç¨€ç¢ï¼Œæ–°å…¥å±€è€…åŸºæœ¬å°±æ˜¯ç‚®ç°ã€‚</p>
<h2 data-id="heading-3">æˆåŠŸæ¡ˆä¾‹</h2>
<p>ç½‘ä¸Šç»å¸¸èƒ½çœ‹åˆ°"åšå°ç¨‹åºæœˆå…¥è¿‡ä¸‡"çš„å¸–å­ï¼Œä½†ä»”ç»†çœ‹ä¼šå‘ç°ï¼Œè¦ä¹ˆæ˜¯å–è¯¾çš„ï¼Œè¦ä¹ˆæ˜¯æœ‰ç‰¹æ®Šèµ„æºçš„ï¼ˆæ¯”å¦‚æ‰‹é‡Œæœ‰å…¬ä¼—å·çŸ©é˜µå¯¼æµï¼‰ï¼Œè¦ä¹ˆæ˜¯æ—©æœŸå…¥å±€è€…åƒåˆ°äº†çº¢åˆ©ã€‚
å¯¹äºæ™®é€šç¨‹åºå‘˜æ¥è¯´ï¼Œæ¥ä¸ªå¤–åŒ…é¡¹ç›®ï¼ŒæŒ‰æ—¶è–ªç®—å¯èƒ½æ¯”æŠ˜è…¾ä¸‰ä¸ªæœˆå°ç¨‹åºèµšå¾—è¿˜å¤šï¼Œè¿˜çœå¿ƒã€‚</p>
<p>æŠ€æœ¯åªæ˜¯å·¥å…·ï¼Œå•†ä¸šæ‰æ˜¯æˆ˜åœºã€‚ä¼šæ‹¿é”¤å­çš„ä¸ä¸€å®šä¼šç›–æˆ¿å­ï¼Œä¼šå†™ä»£ç çš„ä¸ä¸€å®šèƒ½åšå‡ºèµšé’±çš„äº§å“ã€‚è¿™ä¸æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè¿™æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„èµ›é“ã€‚</p>
<h2 data-id="heading-4">æœ€å</h2>
<p>æ‰€ä»¥ï¼Œå¼€å‘ä¸€ä¸ªå°ç¨‹åºåˆ°åº•èƒ½ä¸èƒ½èµšé’±ï¼Ÿ</p>
<p>èƒ½ï¼Œä½†è·Ÿä½ å…³ç³»ä¸å¤§ã€‚</p>
<p>è¦ä¹ˆä½ æœ‰ç°æˆçš„æµé‡æ± ï¼Œæ¯”å¦‚å‡ åä¸‡ç²‰ä¸çš„å…¬ä¼—å·ã€æŠ–éŸ³å·ï¼Œå°ç¨‹åºåªæ˜¯å˜ç°å·¥å…·ï¼›è¦ä¹ˆä½ æœ‰ç‰¹æ®Šèµ„æºï¼Œæ¯”å¦‚ç‹¬å®¶æ•°æ®ã€è¡Œä¸šèµ„è´¨ï¼›å†è¦ä¹ˆä½ è¸©ä¸­äº†æŸä¸ªæå°æ¦‚ç‡çš„é£å£ï¼Œæ¯”å¦‚å½“å¹´ç–«æƒ…æœŸé—´çš„å¥åº·ç å‘¨è¾¹å·¥å…·ã€‚å¦åˆ™ï¼Œä¸ªäººå¼€å‘è€…å¤§æ¦‚ç‡æ˜¯ç‚®ç°ã€‚</p>
<p><strong>å†™ä»£ç æ˜¯ç¡®å®šæ€§çš„äº‹ï¼Œè¾“å…¥é€»è¾‘è¾“å‡ºç»“æœï¼›åšç”Ÿæ„æ˜¯æ¦‚ç‡æ€§çš„äº‹ï¼ŒæŠ•å…¥ä¸ä¸€å®šæœ‰å›æŠ¥ã€‚</strong> å¤§å¤šæ•°äººé€‚åˆå‰è€…ï¼Œå´è¯¯ä»¥ä¸ºè‡ªå·±èƒ½é©¾é©­åè€…ã€‚</p>
<p>ä½ å‘¢ï¼Ÿæœ‰æ²¡æœ‰è¿‡"åšä¸ªäº§å“æ”¹å˜ä¸–ç•Œ"çš„å†²åŠ¨ï¼Ÿæœ€åæˆäº†å—ï¼Ÿ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åä¸‰ç« ä½¿ç”¨ interval å’Œ scan å®ç°å®šæ—¶å™¨]]></title>    <link>https://juejin.cn/post/7600560664407638079</link>    <guid>https://juejin.cn/post/7600560664407638079</guid>    <pubDate>2026-01-29T09:08:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600560664407638079" data-draft-id="7600587732991328298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åä¸‰ç« ä½¿ç”¨ interval å’Œ scan å®ç°å®šæ—¶å™¨"/> <meta itemprop="keywords" content="Angular.js,RxJS"/> <meta itemprop="datePublished" content="2026-01-29T09:08:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeeYaMaster"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565583085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20ä¸ªä¾‹å­æŒæ¡RxJSâ€”â€”ç¬¬åä¸‰ç« ä½¿ç”¨ interval å’Œ scan å®ç°å®šæ—¶å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565583085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeeYaMaster
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:08:22.000Z" title="Thu Jan 29 2026 09:08:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RxJS å®æˆ˜ï¼šä½¿ç”¨ interval å’Œ scan å®ç°å®šæ—¶å™¨</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>å®šæ—¶å™¨æ˜¯ä¸€ä¸ªå¸¸è§çš„åŠŸèƒ½ï¼Œç”¨äºæµ‹é‡ç»è¿‡çš„æ—¶é—´ã€‚åœ¨ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å®ç°ç§’è¡¨ã€å€’è®¡æ—¶ç­‰åŠŸèƒ½ã€‚æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ RxJS çš„ <code>interval</code>ã€<code>scan</code> å’Œ <code>takeUntil</code> æ“ä½œç¬¦å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å®šæ—¶å™¨ã€‚</p>
<h3 data-id="heading-2">å®šæ—¶å™¨çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>å®šæ—¶å™¨ç”¨äºæµ‹é‡ä»æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹ç»è¿‡çš„æ—¶é—´ã€‚å¸¸è§çš„å®šæ—¶å™¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç§’è¡¨åŠŸèƒ½</strong>ï¼šæµ‹é‡ç»è¿‡çš„æ—¶é—´</li>
<li><strong>å€’è®¡æ—¶å™¨</strong>ï¼šä»æŒ‡å®šæ—¶é—´å€’è®¡æ—¶åˆ° 0</li>
<li><strong>ä»»åŠ¡è®¡æ—¶</strong>ï¼šè®°å½•ä»»åŠ¡æ‰§è¡Œæ—¶é—´</li>
<li><strong>æ¸¸æˆè®¡æ—¶</strong>ï¼šæ¸¸æˆä¸­çš„è®¡æ—¶åŠŸèƒ½</li>
</ul>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆä½¿ç”¨ RxJSï¼Ÿ</h3>
<p>ä½¿ç”¨ RxJS å®ç°å®šæ—¶å™¨æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>å“åº”å¼ç¼–ç¨‹</strong>ï¼šä½¿ç”¨ Observable æµå¤„ç†æ—¶é—´ï¼Œä»£ç æ›´æ¸…æ™°</li>
<li><strong>æ˜“äºæ§åˆ¶</strong>ï¼šå¯ä»¥è½»æ¾å®ç°å¼€å§‹ã€æš‚åœã€é‡ç½®ç­‰åŠŸèƒ½</li>
<li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šä½¿ç”¨ <code>takeUntil</code> å¯ä»¥ä¼˜é›…åœ°å–æ¶ˆè®¢é˜…</li>
<li><strong>ç»„åˆæ€§å¼º</strong>ï¼šå¯ä»¥è½»æ¾ä¸å…¶ä»– RxJS æ“ä½œç¬¦ç»„åˆ</li>
</ol>
<h3 data-id="heading-4">æ ¸å¿ƒæ“ä½œç¬¦</h3>
<h4 data-id="heading-5">1. interval</h4>
<p><code>interval</code> åˆ›å»ºä¸€ä¸ªæŒ‰å›ºå®šæ—¶é—´é—´éš”å‘å‡ºé€’å¢æ•°å­—çš„ Observableã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>) <span class="hljs-comment">// æ¯ç§’å‘å‡ºä¸€ä¸ªå€¼ï¼š0, 1, 2, 3...</span>
</code></pre>
<h4 data-id="heading-6">2. scan</h4>
<p><code>scan</code> ç±»ä¼¼æ•°ç»„çš„ <code>reduce</code>ï¼Œä½†ä¼šå‘å‡ºæ¯æ¬¡ç´¯åŠ çš„ç»“æœã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc, value</span>) =&gt;</span> acc + value, <span class="hljs-number">0</span>)
<span class="hljs-comment">// è¾“å…¥ï¼š0, 1, 2, 3...</span>
<span class="hljs-comment">// è¾“å‡ºï¼š0, 1, 3, 6, 10...</span>
</code></pre>
<h4 data-id="heading-7">3. startWith</h4>
<p><code>startWith</code> åœ¨ Observable å¼€å§‹å‰å‘å‡ºæŒ‡å®šçš„å€¼ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>))
<span class="hljs-comment">// ç«‹å³å‘å‡º 0ï¼Œç„¶åæ¯ç§’å‘å‡º 1, 2, 3...</span>
</code></pre>
<h4 data-id="heading-8">4. takeUntil</h4>
<p><code>takeUntil</code> å½“å¦ä¸€ä¸ª Observable å‘å‡ºå€¼æ—¶ï¼Œå®Œæˆå½“å‰ Observableã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>).<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">takeUntil</span>(stop$))
<span class="hljs-comment">// å½“ stop$ å‘å‡ºå€¼æ—¶ï¼Œåœæ­¢å‘å‡ºå€¼</span>
</code></pre>
<h3 data-id="heading-9">å®æˆ˜åœºæ™¯ï¼šå®ç°ä¸€ä¸ªç§’è¡¨</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç§’è¡¨ï¼Œå…·æœ‰å¼€å§‹ã€æš‚åœã€é‡ç½®åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-10">å®ç°æ€è·¯</h4>
<ol>
<li>ä½¿ç”¨ <code>interval(1000)</code> æ¯ç§’å‘å‡ºä¸€ä¸ªå€¼</li>
<li>ä½¿ç”¨ <code>startWith(0)</code> ç«‹å³å¼€å§‹</li>
<li>ä½¿ç”¨ <code>scan</code> ç´¯åŠ æ—¶é—´</li>
<li>ä½¿ç”¨ <code>takeUntil</code> æ§åˆ¶åœæ­¢ã€æš‚åœå’Œé‡ç½®</li>
</ol>
<h4 data-id="heading-11">æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šæ—¶å™¨çŠ¶æ€</span>
isRunning = <span class="hljs-literal">false</span>;
currentTime = <span class="hljs-number">0</span>;

<span class="hljs-comment">// é”€æ¯ Subject</span>
<span class="hljs-keyword">private</span> destroySubject$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-comment">// æš‚åœ/ç»§ç»­æ§åˆ¶ Subject</span>
<span class="hljs-keyword">private</span> pauseSubject$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-comment">// é‡ç½®æ§åˆ¶ Subject</span>
<span class="hljs-keyword">private</span> resetSubject$ = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-comment">// å¼€å§‹å®šæ—¶å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">startTimer</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span>) {
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span> = <span class="hljs-literal">true</span>;
  
  <span class="hljs-comment">// ä½¿ç”¨ interval(1000) æ¯ç§’å‘å‡ºä¸€ä¸ªå€¼</span>
  <span class="hljs-comment">// ä½¿ç”¨ scan ç´¯åŠ æ—¶é—´</span>
  <span class="hljs-comment">// ä½¿ç”¨ startWith ä»å½“å‰æ—¶é—´å¼€å§‹</span>
  <span class="hljs-comment">// ä½¿ç”¨ takeUntil æ§åˆ¶åœæ­¢</span>
  <span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">1</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span>),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroySubject$</span>),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resetSubject$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>({
      <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">time</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = time;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
      },
      <span class="hljs-attr">complete</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// å¦‚æœæ˜¯æš‚åœï¼Œä¿æŒçŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>.<span class="hljs-property">closed</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span> = <span class="hljs-literal">false</span>;
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
        }
      }
    });
}

<span class="hljs-comment">// æš‚åœå®šæ—¶å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-title function_">pauseTimer</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span>) {
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>.<span class="hljs-title function_">next</span>();
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
}

<span class="hljs-comment">// é‡ç½®å®šæ—¶å™¨</span>
<span class="hljs-title function_">resetTimer</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// å¦‚æœæ­£åœ¨è¿è¡Œï¼Œå…ˆåœæ­¢</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>.<span class="hljs-title function_">next</span>();
  }
  
  <span class="hljs-comment">// é‡ç½®æ—¶é—´</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRunning</span> = <span class="hljs-literal">false</span>;
  
  <span class="hljs-comment">// åˆ›å»ºæ–°çš„ pauseSubject å’Œ resetSubject</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">resetSubject$</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>();
}
</code></pre>
<h3 data-id="heading-12">å…³é”®ç‚¹è§£æ</h3>
<h4 data-id="heading-13">1. interval çš„ä½¿ç”¨</h4>
<p><code>interval(1000)</code> æ¯ç§’å‘å‡ºä¸€ä¸ªå€¼ï¼Œä» 0 å¼€å§‹ï¼š</p>
<ul>
<li>0 ç§’ï¼šå‘å‡º 0</li>
<li>1 ç§’ï¼šå‘å‡º 1</li>
<li>2 ç§’ï¼šå‘å‡º 2</li>
<li>...</li>
</ul>
<h4 data-id="heading-14">2. scan ç´¯åŠ æ—¶é—´</h4>
<p><code>scan((acc) =&gt; acc + 1, this.currentTime)</code> çš„ä½œç”¨ï¼š</p>
<ul>
<li>ä» <code>this.currentTime</code> å¼€å§‹ç´¯åŠ </li>
<li>æ¯æ¬¡æ”¶åˆ°æ–°å€¼ï¼Œç´¯åŠ  1</li>
<li>å¦‚æœä» 10 ç§’å¼€å§‹ï¼Œä¼šè¾“å‡ºï¼š10, 11, 12, 13...</li>
</ul>
<h4 data-id="heading-15">3. startWith çš„ä½œç”¨</h4>
<p><code>startWith(0)</code> ç¡®ä¿ï¼š</p>
<ul>
<li>ç«‹å³å‘å‡ºåˆå§‹å€¼ï¼Œä¸ç­‰å¾…ç¬¬ä¸€ä¸ª interval</li>
<li>å®šæ—¶å™¨å¯ä»¥ç«‹å³å¼€å§‹è®¡æ—¶</li>
</ul>
<h4 data-id="heading-16">4. takeUntil çš„å¤šé‡æ§åˆ¶</h4>
<p>ä½¿ç”¨å¤šä¸ª <code>takeUntil</code> å¯ä»¥çµæ´»æ§åˆ¶å®šæ—¶å™¨çš„åœæ­¢ï¼š</p>
<ul>
<li><code>takeUntil(this.destroySubject$)</code>ï¼šç»„ä»¶é”€æ¯æ—¶åœæ­¢</li>
<li><code>takeUntil(this.pauseSubject$)</code>ï¼šæš‚åœæ—¶åœæ­¢</li>
<li><code>takeUntil(this.resetSubject$)</code>ï¼šé‡ç½®æ—¶åœæ­¢</li>
</ul>
<h4 data-id="heading-17">5. æš‚åœå’Œé‡ç½®çš„å®ç°</h4>
<p>æš‚åœå’Œé‡ç½®éœ€è¦åˆ›å»ºæ–°çš„ Subjectï¼Œç¡®ä¿å¯ä»¥é‡æ–°å¯åŠ¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æš‚åœåï¼Œåˆ›å»ºæ–°çš„ Subject</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();

<span class="hljs-comment">// é‡ç½®åï¼Œåˆ›å»ºæ–°çš„ Subject</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">resetSubject$</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>&lt;<span class="hljs-built_in">void</span>&gt;();
</code></pre>
<h3 data-id="heading-18">æ—¶é—´æ ¼å¼åŒ–</h3>
<p>å®šæ—¶å™¨é€šå¸¸éœ€è¦å°†ç§’æ•°æ ¼å¼åŒ–ä¸º <code>HH:MM:SS</code> æ ¼å¼ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">formatTime</span>(<span class="hljs-attr">seconds</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds / <span class="hljs-number">3600</span>);
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((seconds % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>);
  <span class="hljs-keyword">const</span> secs = seconds % <span class="hljs-number">60</span>;
  
  <span class="hljs-keyword">return</span> [
    hours.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>),
    minutes.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>),
    secs.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  ].<span class="hljs-title function_">join</span>(<span class="hljs-string">':'</span>);
}
</code></pre>
<h3 data-id="heading-19">ä¸å…¶ä»–æ–¹æ¡ˆçš„å¯¹æ¯”</h3>
<h4 data-id="heading-20">æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ setIntervalï¼ˆä¸æ¨èï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šéš¾ä»¥æ§åˆ¶ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">interval</span>: <span class="hljs-built_in">any</span>;
<span class="hljs-keyword">let</span> currentTime = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">startTimer</span>(<span class="hljs-params"/>) {
  interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    currentTime++;
    <span class="hljs-title function_">updateDisplay</span>();
  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">pauseTimer</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">clearInterval</span>(interval);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">resetTimer</span>(<span class="hljs-params"/>) {
  <span class="hljs-built_in">clearInterval</span>(interval);
  currentTime = <span class="hljs-number">0</span>;
  <span class="hljs-title function_">updateDisplay</span>();
}
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>éœ€è¦æ‰‹åŠ¨ç®¡ç† interval ID</li>
<li>å®¹æ˜“å¿˜è®°æ¸…ç†ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li>
<li>ä»£ç ä¸å¤Ÿä¼˜é›…</li>
</ul>
<h4 data-id="heading-21">æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ RxJSï¼ˆæ¨èï¼‰âœ…</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šå“åº”å¼ç¼–ç¨‹ï¼Œæ˜“äºæ§åˆ¶</span>
<span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">1</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span>),
    <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>)
  )
  .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = time;
  });
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å“åº”å¼ç¼–ç¨‹ï¼Œä»£ç æ¸…æ™°</li>
<li>è‡ªåŠ¨ç®¡ç†è®¢é˜…ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
<li>æ˜“äºæ‰©å±•å’Œç»´æŠ¤</li>
</ul>
<h3 data-id="heading-22">é«˜çº§ç”¨æ³•</h3>
<h4 data-id="heading-23">1. å€’è®¡æ—¶å™¨</h4>
<p>å®ç°ä»æŒ‡å®šæ—¶é—´å€’è®¡æ—¶åˆ° 0ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> initialTime = <span class="hljs-number">60</span>; <span class="hljs-comment">// 60ç§’å€’è®¡æ—¶</span>

<span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc - <span class="hljs-number">1</span>, initialTime),
    <span class="hljs-title function_">takeWhile</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> time &gt;= <span class="hljs-number">0</span>),
    <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroySubject$</span>)
  )
  .<span class="hljs-title function_">subscribe</span>({
    <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">time</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = time;
      <span class="hljs-keyword">if</span> (time === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onCountdownComplete</span>();
      }
    }
  });
</code></pre>
<h4 data-id="heading-24">2. å¤šæ®µè®¡æ—¶</h4>
<p>è®°å½•å¤šä¸ªæ—¶é—´æ®µï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">TimeSegment</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">startTime</span>: <span class="hljs-built_in">number</span>;
  endTime?: <span class="hljs-built_in">number</span>;
  duration?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">private</span> <span class="hljs-attr">segments</span>: <span class="hljs-title class_">TimeSegment</span>[] = [];
<span class="hljs-keyword">private</span> currentSegmentId = <span class="hljs-number">0</span>;

<span class="hljs-title function_">startSegment</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">segment</span>: <span class="hljs-title class_">TimeSegment</span> = {
    <span class="hljs-attr">id</span>: ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSegmentId</span>,
    <span class="hljs-attr">startTime</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span>
  };
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">push</span>(segment);
}

<span class="hljs-title function_">endSegment</span>(<span class="hljs-attr">segmentId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> segment = <span class="hljs-variable language_">this</span>.<span class="hljs-property">segments</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">id</span> === segmentId);
  <span class="hljs-keyword">if</span> (segment) {
    segment.<span class="hljs-property">endTime</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span>;
    segment.<span class="hljs-property">duration</span> = segment.<span class="hljs-property">endTime</span> - segment.<span class="hljs-property">startTime</span>;
  }
}
</code></pre>
<h4 data-id="heading-25">3. ç²¾ç¡®è®¡æ—¶</h4>
<p>ä½¿ç”¨æ›´å°çš„é—´éš”å®ç°æ›´ç²¾ç¡®çš„è®¡æ—¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¯ 100 æ¯«ç§’æ›´æ–°ä¸€æ¬¡ï¼ˆç²¾ç¡®åˆ° 0.1 ç§’ï¼‰</span>
<span class="hljs-title function_">interval</span>(<span class="hljs-number">100</span>)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>),
    <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>)
  )
  .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(time * <span class="hljs-number">10</span>) / <span class="hljs-number">10</span>; <span class="hljs-comment">// ä¿ç•™ä¸€ä½å°æ•°</span>
  });
</code></pre>
<h4 data-id="heading-26">4. æ¡ä»¶åœæ­¢</h4>
<p>æ ¹æ®æ¡ä»¶è‡ªåŠ¨åœæ­¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
    <span class="hljs-title function_">takeWhile</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> time &lt; <span class="hljs-number">60</span>), <span class="hljs-comment">// 60ç§’åè‡ªåŠ¨åœæ­¢</span>
    <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">destroySubject$</span>)
  )
  .<span class="hljs-title function_">subscribe</span>({
    <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">time</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = time;
    },
    <span class="hljs-attr">complete</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onTimerComplete</span>();
    }
  });
</code></pre>
<h3 data-id="heading-27">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 data-id="heading-28">1. ç§’è¡¨åŠŸèƒ½</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æµ‹é‡ç»è¿‡çš„æ—¶é—´</span>
<span class="hljs-title function_">startStopwatch</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pauseSubject$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elapsedTime</span> = time;
    });
}
</code></pre>
<h4 data-id="heading-29">2. ä»»åŠ¡è®¡æ—¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è®°å½•ä»»åŠ¡æ‰§è¡Œæ—¶é—´</span>
<span class="hljs-title function_">startTaskTimer</span>(<span class="hljs-attr">taskId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  
  <span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime) / <span class="hljs-number">1000</span>)),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">taskComplete$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">taskTimes</span>[taskId] = time;
    });
}
</code></pre>
<h4 data-id="heading-30">3. æ¸¸æˆè®¡æ—¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¸¸æˆä¸­çš„è®¡æ—¶åŠŸèƒ½</span>
<span class="hljs-title function_">startGameTimer</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">interval</span>(<span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">pipe</span>(
      <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
      <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
      <span class="hljs-title function_">takeUntil</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gameOver$</span>)
    )
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gameTime</span> = time;
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateGameUI</span>();
    });
}
</code></pre>
<h3 data-id="heading-31">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-32">1. ä½¿ç”¨ ChangeDetectorRef</h4>
<p>åœ¨ Angular ä¸­ï¼Œä½¿ç”¨ <code>ChangeDetectorRef</code> æ‰‹åŠ¨è§¦å‘å˜æ›´æ£€æµ‹ï¼Œé¿å…ä¸å¿…è¦çš„æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">.<span class="hljs-title function_">subscribe</span>({
  <span class="hljs-attr">next</span>: <span class="hljs-function">(<span class="hljs-params">time</span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTime</span> = time;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cdr</span>.<span class="hljs-title function_">detectChanges</span>(); <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘å˜æ›´æ£€æµ‹</span>
  }
});
</code></pre>
<h4 data-id="heading-33">2. é™åˆ¶æ›´æ–°é¢‘ç‡</h4>
<p>å¦‚æœä¸éœ€è¦æ¯ç§’æ›´æ–°ï¼Œå¯ä»¥é™ä½æ›´æ–°é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡</span>
<span class="hljs-title function_">interval</span>(<span class="hljs-number">5000</span>)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">startWith</span>(<span class="hljs-number">0</span>),
    <span class="hljs-title function_">scan</span>(<span class="hljs-function">(<span class="hljs-params">acc</span>) =&gt;</span> acc + <span class="hljs-number">5</span>, <span class="hljs-number">0</span>)
  )
</code></pre>
<h4 data-id="heading-34">3. åœ¨é¡µé¢ä¸å¯è§æ—¶æš‚åœ</h4>
<p>ä½¿ç”¨ Page Visibility API åœ¨é¡µé¢ä¸å¯è§æ—¶æš‚åœå®šæ—¶å™¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">fromEvent</span>(<span class="hljs-variable language_">document</span>, <span class="hljs-string">'visibilitychange'</span>)
  .<span class="hljs-title function_">pipe</span>(
    <span class="hljs-title function_">switchMap</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">hidden</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pauseTimer</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// é¡µé¢å¯è§æ—¶å¯ä»¥é€‰æ‹©æ¢å¤</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;
      }
    })
  )
  .<span class="hljs-title function_">subscribe</span>();
</code></pre>
<h3 data-id="heading-35">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šç¡®ä¿åœ¨ç»„ä»¶é”€æ¯æ—¶å–æ¶ˆè®¢é˜…</li>
<li><strong>å˜æ›´æ£€æµ‹</strong>ï¼šåœ¨ Angular ä¸­ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è§¦å‘å˜æ›´æ£€æµ‹</li>
<li><strong>æµè§ˆå™¨ç¯å¢ƒ</strong>ï¼šä½¿ç”¨ <code>isPlatformBrowser</code> æ£€æŸ¥ï¼Œé¿å… SSR é—®é¢˜</li>
<li><strong>æš‚åœå’Œé‡ç½®</strong>ï¼šéœ€è¦åˆ›å»ºæ–°çš„ Subjectï¼Œç¡®ä¿å¯ä»¥é‡æ–°å¯åŠ¨</li>
<li><strong>ç²¾åº¦é—®é¢˜</strong>ï¼š<code>interval</code> ä¸æ˜¯å®Œå…¨ç²¾ç¡®çš„ï¼Œå¯èƒ½å—åˆ°æµè§ˆå™¨æ€§èƒ½å½±å“</li>
</ol>
<h3 data-id="heading-36">æ€»ç»“</h3>
<p>ä½¿ç”¨ RxJS å®ç°å®šæ—¶å™¨æ˜¯ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒé€šè¿‡å“åº”å¼ç¼–ç¨‹çš„æ–¹å¼ï¼š</p>
<ul>
<li><strong>ä»£ç æ¸…æ™°</strong>ï¼šä½¿ç”¨ Observable æµå¤„ç†æ—¶é—´ï¼Œé€»è¾‘æ¸…æ™°</li>
<li><strong>æ˜“äºæ§åˆ¶</strong>ï¼šå¯ä»¥è½»æ¾å®ç°å¼€å§‹ã€æš‚åœã€é‡ç½®ç­‰åŠŸèƒ½</li>
<li><strong>è‡ªåŠ¨æ¸…ç†</strong>ï¼šä½¿ç”¨ <code>takeUntil</code> å¯ä»¥ä¼˜é›…åœ°å–æ¶ˆè®¢é˜…</li>
<li><strong>ç»„åˆæ€§å¼º</strong>ï¼šå¯ä»¥è½»æ¾ä¸å…¶ä»– RxJS æ“ä½œç¬¦ç»„åˆ</li>
</ul>
<p>è®°ä½ï¼š<strong>å®šæ—¶å™¨æ˜¯å“åº”å¼ç¼–ç¨‹çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼Œä½¿ç”¨ RxJS å¯ä»¥è®©ä»£ç æ›´åŠ ä¼˜é›…å’Œå¯ç»´æŠ¤</strong>ã€‚</p>
<p>ç äº‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fleeyamaster%2Frxjs-examples" target="_blank" title="https://gitee.com/leeyamaster/rxjs-examples" ref="nofollow noopener noreferrer">gitee.com/leeyamasterâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apifox 1 æœˆæ›´æ–°ï½œMCP è°ƒè¯•ã€æµ‹è¯•å¥—ä»¶ã€æµ‹è¯•æŠ¥å‘Šé‡æ„ã€ç½‘ç»œä¿¡æ¯æŸ¥çœ‹ã€Hoppscotch å¯¼å…¥]]></title>    <link>https://juejin.cn/post/7600489282839658506</link>    <guid>https://juejin.cn/post/7600489282839658506</guid>    <pubDate>2026-01-29T09:13:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600489282839658506" data-draft-id="7600508556124405811" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apifox 1 æœˆæ›´æ–°ï½œMCP è°ƒè¯•ã€æµ‹è¯•å¥—ä»¶ã€æµ‹è¯•æŠ¥å‘Šé‡æ„ã€ç½‘ç»œä¿¡æ¯æŸ¥çœ‹ã€Hoppscotch å¯¼å…¥"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,æµ‹è¯•"/> <meta itemprop="datePublished" content="2026-01-29T09:13:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Apifox"/> <meta itemprop="url" content="https://juejin.cn/user/2766843870448222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apifox 1 æœˆæ›´æ–°ï½œMCP è°ƒè¯•ã€æµ‹è¯•å¥—ä»¶ã€æµ‹è¯•æŠ¥å‘Šé‡æ„ã€ç½‘ç»œä¿¡æ¯æŸ¥çœ‹ã€Hoppscotch å¯¼å…¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2766843870448222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Apifox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:13:40.000Z" title="Thu Jan 29 2026 09:13:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Apifox æ–°ç‰ˆæœ¬ä¸Šçº¿å•¦ï¼</p>
<p>çœ‹çœ‹æœ¬æ¬¡ç‰ˆæœ¬æ›´æ–°ä¸»è¦æ¶µç›–çš„é‡ç‚¹å†…å®¹ï¼Œæœ‰æ²¡æœ‰ä½ æ‰€å…³æ³¨çš„åŠŸèƒ½ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>æ”¯æŒåˆ›å»º MCP Client ä»¥è°ƒè¯• MCP Server</strong></li>
<li><strong>æ”¯æŒåˆ›å»ºã€Œæµ‹è¯•å¥—ä»¶ã€</strong></li>
<li><strong>æµ‹è¯•æŠ¥å‘Šå…¨é¢é‡æ„ï¼Œæ”¯æŒç»“æ„åŒ–å±•ç¤º</strong></li>
<li><strong>è°ƒè¯•èƒ½åŠ›æŒç»­å‡çº§</strong>
<ul>
<li>æ”¯æŒæŸ¥çœ‹ HTTP ç‰ˆæœ¬ã€TLS åè®®ç­‰ç½‘ç»œä¿¡æ¯</li>
<li>array ç±»å‹å‚æ•°çš„å­å…ƒç´ æ”¯æŒç›´æ¥é€‰æ‹©æšä¸¾å€¼</li>
<li>è°ƒè¯• SSE æ¥å£æ—¶ï¼Œæ”¯æŒ <code>\r\n</code> æ¢è¡Œç¬¦</li>
</ul>
</li>
<li><strong>æ”¯æŒå¯¼å…¥ Hoppscotch çš„ Collection</strong></li>
<li><strong>ä¼˜åŒ–é‚€è¯·ä»–äººåŠ å…¥é¡¹ç›®çš„æµç¨‹</strong></li>
<li><strong>ç”¨æˆ·åé¦ˆä¼˜åŒ–</strong>
<ul>
<li>è§£å†³ MongoDB æ•°æ®åº“çš„å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦ <code>%</code> æ—¶æ— æ³•è¿æ¥æˆåŠŸçš„é—®é¢˜</li>
<li>è§£å†³ç»‘å®šäº†æ‰‹æœºå·çš„ç”¨æˆ·æ— æ³•é€šè¿‡â€œå¿˜è®°å¯†ç â€åŠŸèƒ½é‡ç½®å¯†ç çš„é—®é¢˜</li>
</ul>
</li>
</ul>
<p><strong>å°† Apifox æ›´æ–°è‡³æœ€æ–°ç‰ˆï¼Œä¸€èµ·å¼€å¯å…¨æ–°ä½“éªŒå§ï¼</strong></p>
<h2 data-id="heading-0">æ”¯æŒåˆ›å»º MCP Client ä»¥è°ƒè¯• MCP Server</h2>
<p>Apifox å‡çº§åï¼Œæ”¯æŒåˆ›å»º MCP Clientï¼Œå¼€å‘è€…å¯ä»¥åƒè°ƒè¯• API ä¸€æ ·ï¼Œç›´æ¥è°ƒè¯• MCP Server çš„<strong>Tools</strong>ã€<strong>Resources</strong>å’Œ <strong>Prompts</strong>ã€‚åŒæ—¶æ”¯æŒ<strong>STDIO</strong>å’Œ <strong>Streamable HTTP</strong> åè®®ï¼Œå¹¶å¯<strong>è‡ªåŠ¨é…ç½® OAuth 2.0 è®¤è¯æµç¨‹</strong>ï¼Œæå¤§ç®€åŒ–è¿æ¥ä¸è®¤è¯æµç¨‹ï¼Œå…¨é¢æå‡ AI Agent çš„å¼€å‘ä¸è°ƒè¯•æ•ˆç‡ã€‚</p>
<p><em>æ›´å¤šå…³äº MCP çš„å†…å®¹ï¼Œå¯ä»¥å‰å¾€</em> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fmcp" target="_blank" title="https://docs.apifox.com/mcp" ref="nofollow noopener noreferrer"><em>å¸®åŠ©æ–‡æ¡£</em> </a><em>æŸ¥çœ‹ã€‚</em></p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291401195.gif" alt="æ”¯æŒåˆ›å»º MCP Client ä»¥è°ƒè¯• MCP Server" loading="lazy"/></p>
<h2 data-id="heading-1">æ”¯æŒåˆ›å»ºã€Œæµ‹è¯•å¥—ä»¶ã€</h2>
<p>Apifox æ¨å‡ºäº†ã€Œæµ‹è¯•å¥—ä»¶ã€åŠŸèƒ½ï¼Œæ”¯æŒæ·»åŠ å•æ¥å£ç”¨ä¾‹å’Œåœºæ™¯ç”¨ä¾‹ï¼Œå¹¶å¯åœ¨ã€Œé™æ€ã€ä¸ã€ŒåŠ¨æ€ã€ä¸¤ç§æ¨¡å¼é—´åˆ‡æ¢ï¼š</p>
<ul>
<li>é™æ€æ¨¡å¼ç”¨äºç²¾ç¡®æŒ‡å®šéœ€è¦æ‰§è¡Œçš„æµ‹è¯•é¡¹ï¼Œå†…å®¹ä¸ä¼šå˜åŠ¨ï¼Œä¸”æ”¯æŒçµæ´»è°ƒæ•´æµ‹è¯•æ­¥éª¤çš„é¡ºåºã€‚</li>
<li>åŠ¨æ€æ¨¡å¼å¯<strong>é€šè¿‡è§„åˆ™è‡ªåŠ¨ç­›é€‰</strong>éœ€æ‰§è¡Œçš„æµ‹è¯•é¡¹ã€‚æ¯æ¬¡è¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šå®æ—¶æ‰«æé¡¹ç›®ï¼Œå°†æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æœ€æ–°ç”¨ä¾‹çº³å…¥æ‰§è¡Œã€‚æ­¤æ¨¡å¼ä¸‹ï¼Œä»…å¯æ•´ä½“åˆ é™¤æˆ–ä¿®æ”¹è¿‡æ»¤æ¡ä»¶ï¼Œæ— æ³•å•ç‹¬åˆ é™¤ç»„å†…çš„æŸä¸ªåŠ¨æ€é¡¹ã€‚</li>
</ul>
<p>åœºæ™¯ç”¨ä¾‹ä¾§é‡äºæµ‹è¯•æµç¨‹çš„ç¼–æ’ï¼Œæµ‹è¯•å¥—ä»¶åˆ™èšç„¦äºçµæ´»é«˜æ•ˆçš„æµ‹è¯•æ‰§è¡Œï¼Œä¸¤è€…å¹¶éäº’ç›¸æ›¿ä»£ï¼Œè€Œæ˜¯åˆ†å±‚åä½œï¼Œé¢å‘ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œç»“åˆä½¿ç”¨å¯ä»¥æ»¡è¶³è‡ªåŠ¨åŒ–æµ‹è¯•çš„å¤šæ ·åŒ–éœ€æ±‚ã€‚</p>
<p><em>æ›´å¤šå…³äºæµ‹è¯•å¥—ä»¶çš„å…·ä½“æ•™ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹å¾€æœŸå†…å®¹ã€Š</em> <a href="https://link.juejin.cn?target=https%3A%2F%2Fapifox.com%2Fblog%2Ftest-suites%2F" target="_blank" title="https://apifox.com/blog/test-suites/" ref="nofollow noopener noreferrer"><em>æµ‹è¯•ç”¨ä¾‹è¶Šå †è¶Šå¤šï¼Ÿç”¨ Apifox æµ‹è¯•å¥—ä»¶è®©è‡ªåŠ¨åŒ–å›å½’æ›´æ˜“ç»´æŠ¤</em> </a><em>ã€‹ã€‚</em></p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291401636.gif" alt="æ”¯æŒåˆ›å»ºã€Œæµ‹è¯•å¥—ä»¶ã€" loading="lazy"/></p>
<h2 data-id="heading-2">æµ‹è¯•æŠ¥å‘Šå…¨é¢é‡æ„ï¼Œæ”¯æŒç»“æ„åŒ–å±•ç¤º</h2>
<p>æœ€æ–°ç‰ˆæœ¬çš„ Apifox å¯¹æµ‹è¯•æŠ¥å‘Šç•Œé¢è¿›è¡Œäº†å…¨é¢é‡æ„ï¼Œæ–°ç‰ˆæµ‹è¯•æŠ¥å‘Šæ”¯æŒç»“æ„åŒ–å±•ç¤ºæ‰€æœ‰æµ‹è¯•æ­¥éª¤ï¼Œè®©æµ‹è¯•ç»“æœçš„å±‚æ¬¡å…³ç³»æ›´åŠ æ¸…æ™°æ˜äº†ã€‚ç”¨æˆ·å¯ä»¥å¿«é€Ÿå®šä½æ¯ä¸ªæµ‹è¯•æ­¥éª¤çš„æ‰§è¡Œæƒ…å†µå’Œç»“æœï¼Œä»è€Œæ›´é«˜æ•ˆåœ°åˆ†ææµ‹è¯•é—®é¢˜ï¼Œæå‡æµ‹è¯•ç»“æœçš„å¯è¯»æ€§å’Œåˆ†ææ•ˆç‡ã€‚</p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291403059.png" alt="æµ‹è¯•æŠ¥å‘Šå…¨é¢é‡æ„ï¼Œæ”¯æŒç»“æ„åŒ–å±•ç¤º" loading="lazy"/></p>
<h2 data-id="heading-3">è°ƒè¯•èƒ½åŠ›æŒç»­å‡çº§</h2>
<h3 data-id="heading-4">æ”¯æŒæŸ¥çœ‹ HTTP ç‰ˆæœ¬ã€TLS åè®®ç­‰ç½‘ç»œä¿¡æ¯</h3>
<p>æ›´æ–° Apifox åï¼Œå¼€å‘è€…åœ¨è°ƒè¯•æ¥å£æ—¶å¯ç›´æ¥æŸ¥çœ‹ HTTP ç‰ˆæœ¬ã€TLS åè®®ç­‰è¯¦ç»†ç½‘ç»œä¿¡æ¯ï¼Œä»è€Œå¿«é€ŸæŒæ¡æ¥å£è¯·æ±‚çš„é€šä¿¡ç»†èŠ‚ï¼Œæœ‰åŠ©äºè¿›è¡Œæ›´ç²¾ç¡®çš„é—®é¢˜å®šä½å’Œæ€§èƒ½åˆ†æã€‚</p>
<p>åŒæ—¶ï¼Œæ”¯æŒæŸ¥çœ‹æ›´è¯¦ç»†çš„å“åº”å¤§å°ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Body å’Œ Header çš„å¤§å°ï¼Œä»¥åŠå‹ç¼©å‰åçš„ Body å¤§å°ï¼Œä¾¿äºåˆ¤æ–­ gzip ç­‰å‹ç¼©åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291404605.png" alt="æ”¯æŒæŸ¥çœ‹ HTTP ç‰ˆæœ¬ã€TLS åè®®ç­‰ç½‘ç»œä¿¡æ¯" loading="lazy"/></p>
<h3 data-id="heading-5">array ç±»å‹å‚æ•°çš„å­å…ƒç´ æ”¯æŒç›´æ¥é€‰æ‹©æšä¸¾å€¼</h3>
<p>è°ƒè¯•æ¥å£æ—¶ï¼Œå¦‚æœ array ç±»å‹å‚æ•°çš„å­å…ƒç´ åŒ…å«æšä¸¾å€¼ï¼Œç”¨æˆ·å¯ç›´æ¥ä»åˆ—è¡¨ä¸­é€‰æ‹©ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥ï¼Œç®€åŒ–äº†é…ç½®æµç¨‹ï¼Œæå‡å‚æ•°é…ç½®çš„ä¾¿æ·æ€§ä¸å‡†ç¡®æ€§ï¼Œä½¿æ¥å£è°ƒè¯•æ›´åŠ é«˜æ•ˆæµç•…ã€‚</p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291405954.png" alt="array ç±»å‹å‚æ•°çš„å­å…ƒç´ æ”¯æŒç›´æ¥é€‰æ‹©æšä¸¾å€¼" loading="lazy"/></p>
<h3 data-id="heading-6">è°ƒè¯• SSE æ¥å£æ—¶ï¼Œæ”¯æŒ <code>\r\n</code> æ¢è¡Œç¬¦</h3>
<p>Apifox ä¼˜åŒ–äº† SSE æ¥å£çš„è°ƒè¯•ä½“éªŒã€‚SSE è§„èŒƒé‡‡ç”¨ <code>\n\n</code> ä½œä¸ºæ ‡å‡†æ¢è¡Œç¬¦ï¼Œä½†ä¸€äº›å®é™…ä¸šåŠ¡ä¸­å¸¸ç”¨ <code>\r\n</code> <em>ï¼ˆWindows æ¢è¡Œç¬¦ï¼‰</em> è¿›è¡Œåˆ†éš”ã€‚Apifox ç°å·²å…¼å®¹å¹¶æ­£ç¡®è§£æ <code>\r\n</code> æ¢è¡Œç¬¦ï¼Œç¡®ä¿ SSE æµå¼æ•°æ®èƒ½å¤Ÿä»¥æ ‡å‡†æˆ–éæ ‡å‡†æ ¼å¼éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºï¼Œå¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆã€å‡†ç¡®åœ°è°ƒè¯•å’ŒéªŒè¯ SSE æ¥å£å“åº”å†…å®¹ã€‚</p>
<h2 data-id="heading-7">æ”¯æŒå¯¼å…¥ Hoppscotch çš„ Collection</h2>
<p>Apifox ç°å·²æ”¯æŒå¯¼å…¥ Hoppscotch Collection æ•°æ®ï¼Œå¸®åŠ©å›¢é˜Ÿæ›´ä¾¿æ·åœ°å°† Hoppscotch é¡¹ç›®è¿ç§»åˆ° Apifoxï¼Œè¿›ä¸€æ­¥æ‰©å±•äº†æ•°æ®è¿ç§»çš„å…¼å®¹æ€§ï¼Œé™ä½è¿ç§»æˆæœ¬ï¼Œæå‡å›¢é˜Ÿåä½œçš„çµæ´»æ€§ã€‚</p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291405365.png" alt="æ”¯æŒå¯¼å…¥ Hoppscotch çš„ Collection" loading="lazy"/></p>
<h2 data-id="heading-8">ä¼˜åŒ–é‚€è¯·ä»–äººåŠ å…¥é¡¹ç›®çš„æµç¨‹</h2>
<p>Apifox å¯¹é¡¹ç›®æˆå‘˜é‚€è¯·æµç¨‹è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé™¤äº†é“¾æ¥é‚€è¯·å’Œé‚®ç®±é‚€è¯·å¤–ï¼Œè¿˜æ”¯æŒç›´æ¥ä»å›¢é˜Ÿæˆå‘˜åˆ—è¡¨ä¸­é€‰æ‹©æˆå‘˜åŠ å…¥é¡¹ç›®ï¼Œå¹¶å¯åœ¨é‚€è¯·æ—¶åŒæ­¥è®¾ç½®é¡¹ç›®æƒé™ï¼Œå¤§å¹…ç®€åŒ–äº†æˆå‘˜ç®¡ç†æµç¨‹ï¼Œè®©å›¢é˜Ÿåä½œé…ç½®æ›´åŠ ä¾¿æ·é«˜æ•ˆã€‚</p>
<p><img src="https://cdn.apifox.cn/uploads/help/202601291405341.png" alt="ä¼˜åŒ–é‚€è¯·ä»–äººåŠ å…¥é¡¹ç›®çš„æµç¨‹" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>ç”¨æˆ·åé¦ˆä¼˜åŒ–</strong></h2>
<h3 data-id="heading-10">è§£å†³ MongoDB æ•°æ®åº“çš„å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦<code>%</code>æ—¶æ— æ³•è¿æ¥æˆåŠŸçš„é—®é¢˜</h3>
<p>æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œæˆ‘ä»¬å·²ä¿®å¤ MongoDB æ•°æ®åº“è¿æ¥ä¸­å­˜åœ¨çš„é—®é¢˜ï¼šå½“æ•°æ®åº“å¯†ç åŒ…å«ç‰¹æ®Šå­—ç¬¦ <code>%</code> æ—¶ï¼ŒApifox ç°èƒ½æ­£ç¡®å¤„ç†å¹¶æˆåŠŸå»ºç«‹è¿æ¥ï¼Œè¿›ä¸€æ­¥æå‡äº†æ•°æ®åº“è¿æ¥åŠŸèƒ½çš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§ã€‚</p>
<h3 data-id="heading-11">è§£å†³ç»‘å®šäº†æ‰‹æœºå·çš„ç”¨æˆ·æ— æ³•é€šè¿‡â€œå¿˜è®°å¯†ç â€åŠŸèƒ½é‡ç½®å¯†ç çš„é—®é¢˜</h3>
<p>ç°åœ¨é€šè¿‡"å¿˜è®°å¯†ç "åŠŸèƒ½å¯ä»¥æ­£å¸¸é‡ç½®å¯†ç ï¼Œç¡®ä¿ç”¨æˆ·åœ¨éœ€è¦æ—¶èƒ½é¡ºåˆ©æ‰¾å›è´¦å·è®¿é—®æƒé™ï¼Œæå‡è´¦æˆ·å®‰å…¨ç®¡ç†åŠŸèƒ½çš„å®Œæ•´æ€§ä¸å¯ç”¨æ€§ã€‚</p>
<h2 data-id="heading-12"><strong>äº†è§£æ›´å¤š</strong></h2>
<p>å½“ç„¶ï¼ŒApifox äº§å“å›¢é˜Ÿä¸ºå¤§å®¶å¸¦æ¥çš„æ–°åŠŸèƒ½è¿œä¸æ­¢ä»¥ä¸Šè¿™äº›ï¼š</p>
<ul>
<li>ä¼˜åŒ–äº†å‰åç½®æ“ä½œçš„ç•Œé¢</li>
<li>ä¼˜åŒ–äº†æµ‹è¯•æŠ¥å‘Šåˆ—è¡¨ï¼Œæ”¯æŒç»“æ„åŒ–å±•ç¤ºã€ç­›é€‰</li>
<li>æ”¯æŒå¤åˆ¶æµ‹è¯•å¥—ä»¶çš„åˆ†äº«é“¾æ¥</li>
<li>æ”¯æŒè°ƒæ•´æµ‹è¯•å¥—ä»¶é™æ€æ­¥éª¤å†…èµ„æºçš„é¡ºåº</li>
<li>å¯¼å…¥ OpenAPI/Swagger æ•°æ®æ—¶ï¼Œæ”¯æŒ Query ç±»å‹çš„ HTTP æ–¹æ³•å’Œ additionalOperation</li>
<li>ä¼˜åŒ–äº†å˜é‡é¢„è§ˆå¼¹çª—çš„è§¦å‘æ—¶é—´ï¼Œè®©å…¶æœ‰ä¸€ä¸ªåˆç†çš„å»¶è¿Ÿ</li>
<li>åœ¨ä»˜è´¹é¡µè¿›è¡Œç»­è´¹æ—¶ï¼Œé€»è¾‘æ›´åˆç†ä¸å‹å¥½</li>
<li>è§£å†³åœ¨æ¥å£è¿”å›çš„å“åº”æ•°æ®ä¸Šç‚¹å‡»å³é”®ï¼Œæ²¡æœ‰ Copy JSONPath ç­‰åŠŸèƒ½çš„é—®é¢˜</li>
<li>è§£å†³å½“æ ¹ç›®å½•çš„å¯è§æ€§ä¸ºå†…éƒ¨æ—¶ï¼ŒWebSocket æ¥å£ä»è¢«å‘å¸ƒåˆ°å…¬å¼€åœ¨çº¿æ–‡æ¡£çš„é—®é¢˜</li>
<li>è§£å†³æœªç»‘å®šæ”¯ä»˜æ–¹å¼çš„å›¢é˜Ÿæ— æ³•è¢«æ­£ç¡®è½¬å…¥ç»„ç»‡çš„é—®é¢˜</li>
</ul>
<p>é™¤äº†æ–°å¢åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯¹äº§å“ç»†èŠ‚å’Œä½¿ç”¨ä½“éªŒè¿›è¡Œäº†ä¼˜åŒ–ï¼Œ<strong>å…·ä½“ä¿®æ”¹å†…å®¹å¯ç‚¹å‡»ã€Œé˜…è¯»åŸæ–‡ã€å‰å¾€ Apifox æ›´æ–°æ—¥å¿—æŸ¥çœ‹</strong>ï¼Œæœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.apifox.com%2Fdoc-5751209%23%25E7%2594%25A8%25E6%2588%25B7%25E7%25BE%25A4%2F" target="_blank" title="https://docs.apifox.com/doc-5751209#%E7%94%A8%E6%88%B7%E7%BE%A4/" ref="nofollow noopener noreferrer"> Apifox ç”¨æˆ·ç¾¤</a>ä¸æˆ‘ä»¬äº¤æµæ²Ÿé€šã€‚</p>
<p>åŒæ—¶ï¼ŒApifox æä¾›<a href="https://link.juejin.cn?target=https%3A%2F%2Fapifox.com%2Fsiyouhua%3Futm_source%3Dself%26utm_medium%3Dwx0129" target="_blank" title="https://apifox.com/siyouhua?utm_source=self&amp;utm_medium=wx0129" ref="nofollow noopener noreferrer">ä¼ä¸šç§æœ‰åŒ–éƒ¨ç½²</a>ç‰ˆæœ¬ï¼Œé€šè¿‡æœ¬åœ°åŒ–éƒ¨ç½²ã€å®¢åˆ¶åŒ–æœåŠ¡ï¼ŒååŠ©ä¼ä¸šè¿›ä¸€æ­¥æå‡ç ”å‘å›¢é˜Ÿæ•ˆèƒ½ã€‚</p>
<p>æ¬¢è¿å„ä½ç”¨æˆ·å¯¹ Apifox ç»§ç»­æå‡ºä½¿ç”¨åé¦ˆå’Œä¼˜åŒ–æ„è§ï¼Œæˆ‘ä»¬ä¼šæŒç»­ä¼˜åŒ–æ›´æ–°ï¼Œè‡´åŠ›äºä¸ºç”¨æˆ·æä¾›æ›´ä¼˜ç§€çš„äº§å“åŠŸèƒ½å’Œæ›´æè‡´çš„ä½¿ç”¨ä½“éªŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git Commit è§„èŒƒåŒ–å®è·µ - å‘Šåˆ«æ‰‹åŠ¨è¾“å…¥è¡¨æƒ…ç¬¦å·]]></title>    <link>https://juejin.cn/post/7600597995768021001</link>    <guid>https://juejin.cn/post/7600597995768021001</guid>    <pubDate>2026-01-29T09:32:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600597995768021001" data-draft-id="7600581247020384265" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git Commit è§„èŒƒåŒ–å®è·µ - å‘Šåˆ«æ‰‹åŠ¨è¾“å…¥è¡¨æƒ…ç¬¦å·"/> <meta itemprop="keywords" content="Git,GitHub"/> <meta itemprop="datePublished" content="2026-01-29T09:32:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²¡å¤šå°‘é€»è¾‘"/> <meta itemprop="url" content="https://juejin.cn/user/2717648475395325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git Commit è§„èŒƒåŒ–å®è·µ - å‘Šåˆ«æ‰‹åŠ¨è¾“å…¥è¡¨æƒ…ç¬¦å·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648475395325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²¡å¤šå°‘é€»è¾‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:32:53.000Z" title="Thu Jan 29 2026 09:32:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>ä¹‹å‰æˆ‘ä¸€ç›´æ‰‹åŠ¨åœ¨ commit ä¿¡æ¯å‰åŠ è¡¨æƒ…ç¬¦å·ï¼Œæ¯”å¦‚ <code>âœ¨ feat: xxx</code>ã€<code>ğŸ› fix: xxx</code>ï¼Œæ¯æ¬¡éƒ½è¦å»æ‰¾å¯¹åº”çš„ emojiï¼Œæœ‰æ—¶å€™è¿˜ä¼šé—æ¼ï¼ŒæŒºéº»çƒ¦çš„ã€‚æœ€è¿‘å‘ç°äº† commitizen + cz-git è¿™å¥—æ–¹æ¡ˆï¼Œå¯ä»¥é€šè¿‡äº¤äº’å¼ç•Œé¢è‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„æäº¤ä¿¡æ¯ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚</p>
<p>é¡ºä¾¿æ¨èä¸€ä¸‹æˆ‘åœ¨ç»´æŠ¤çš„å¼€æºé¡¹ç›® <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">gocron</a> - ä¸€ä¸ª Go å†™çš„åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œç”¨æ¥æ›¿ä»£ Linux crontab çš„ï¼Œæ”¯æŒ Web ç•Œé¢ã€ç§’çº§ç²¾åº¦ã€ä»»åŠ¡ä¾èµ–ç­‰åŠŸèƒ½ã€‚æ¬¢è¿ Star â­ï¸</p>
<h2 data-id="heading-1">å¯¹æ¯”æ•ˆæœ</h2>
<p><strong>ä¹‹å‰æ‰‹åŠ¨è¾“å…¥ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">âœ¨</span> <span class="hljs-attr">feat:</span> <span class="hljs-string">add</span> <span class="hljs-string">task</span> <span class="hljs-string">dependency</span> <span class="hljs-string">feature</span>  <span class="hljs-comment"># æ¯æ¬¡éƒ½è¦å¤åˆ¶ç²˜è´´ emoji</span>
<span class="hljs-string">ğŸ›</span> <span class="hljs-attr">fix:</span> <span class="hljs-string">fix</span> <span class="hljs-string">status</span> <span class="hljs-string">update</span> <span class="hljs-string">issue</span>
</code></pre>
<p><strong>ç°åœ¨äº¤äº’å¼é€‰æ‹©ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">pnpm run commit
<span class="hljs-comment"># é€‰æ‹©ç±»å‹ã€èŒƒå›´ã€å¡«å†™æè¿°ï¼Œè‡ªåŠ¨ç”Ÿæˆå¸¦ emoji çš„è§„èŒƒæäº¤</span>
</code></pre>
<h2 data-id="heading-2">åœ¨gocroné¡¹ç›®ä¸­ä½¿ç”¨æ¡ˆä¾‹</h2>
<p>gocron é¡¹ç›®å·²ç»é…ç½®å¥½äº†ï¼Œç›´æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> gocron
pnpm install
pnpm run prepare

<span class="hljs-comment"># æäº¤ä»£ç </span>
git add .
pnpm run commit
</code></pre>
<h2 data-id="heading-3">åœ¨è‡ªå·±é¡¹ç›®ä¸­é…ç½®</h2>
<h3 data-id="heading-4">1. å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D @commitlint/cli @commitlint/config-conventional commitizen cz-git husky
</code></pre>
<h3 data-id="heading-5">2. åˆ›å»ºé…ç½®æ–‡ä»¶</h3>
<p>åˆ›å»º <code>commitlint.config.cjs</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">'@commitlint/config-conventional'</span>],
  <span class="hljs-attr">prompt</span>: {
    <span class="hljs-attr">types</span>: [
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"âœ¨ feat"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"feat:     âœ¨ æ–°å¢åŠŸèƒ½"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"ğŸ› fix"</span>,      <span class="hljs-attr">name</span>: <span class="hljs-string">"fix:      ğŸ› ä¿®å¤ç¼ºé™·"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"ï¿½ docs"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"docs:     ğŸ“ æ–‡æ¡£å˜æ›´"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"ï¿½ğŸ’„ style"</span>,    <span class="hljs-attr">name</span>: <span class="hljs-string">"style:    ğŸ’„ ä»£ç æ ¼å¼"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"â™»ï¸ refactor"</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"refactor: â™»ï¸ ä»£ç é‡æ„"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"âš¡ï¸ perf"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"perf:     âš¡ï¸ æ€§èƒ½ä¼˜åŒ–"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"âœ… test"</span>,     <span class="hljs-attr">name</span>: <span class="hljs-string">"test:     âœ… æ·»åŠ æµ‹è¯•"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"ğŸ“¦ï¸ build"</span>,    <span class="hljs-attr">name</span>: <span class="hljs-string">"build:    ğŸ“¦ï¸ æ„å»ºå˜æ›´"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"ğŸ¡ ci"</span>,       <span class="hljs-attr">name</span>: <span class="hljs-string">"ci:       ğŸ¡ CI é…ç½®"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"âªï¸ revert"</span>,   <span class="hljs-attr">name</span>: <span class="hljs-string">"revert:   âªï¸ å›æ»š"</span> },
      { <span class="hljs-attr">value</span>: <span class="hljs-string">"ğŸ”¨ chore"</span>,    <span class="hljs-attr">name</span>: <span class="hljs-string">"chore:    ğŸ”¨ å…¶ä»–ä¿®æ”¹"</span> }
    ],
    <span class="hljs-attr">skipQuestions</span>: [<span class="hljs-string">'breaking'</span>, <span class="hljs-string">'footerPrefix'</span>, <span class="hljs-string">'footer'</span>]
  }
}
</code></pre>
<h3 data-id="heading-6">3. ä¿®æ”¹ package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/cz-git"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-7">4. åˆå§‹åŒ– husky</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm run prepare
<span class="hljs-built_in">echo</span> <span class="hljs-string">"npx --no -- commitlint --edit \$1"</span> &gt; .husky/commit-msg
</code></pre>
<h2 data-id="heading-8">ä½¿ç”¨</h2>
<pre><code class="hljs language-bash" lang="bash">git add .
pnpm run commit
</code></pre>
<p>æŒ‰æç¤ºæ“ä½œï¼š</p>
<ol>
<li>é€‰æ‹©æäº¤ç±»å‹ï¼ˆè‡ªåŠ¨å¸¦ emojiï¼‰</li>
<li>é€‰æ‹©å½±å“èŒƒå›´ï¼ˆå¯é€‰ï¼‰</li>
<li>å¡«å†™ç®€çŸ­æè¿°</li>
<li>ç¡®è®¤æäº¤</li>
</ol>
<h2 data-id="heading-9">æäº¤ç±»å‹è¯´æ˜</h2>

































































<table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>feat</td><td>æ–°åŠŸèƒ½</td><td><code>âœ¨ feat(task): æ·»åŠ ä»»åŠ¡ä¾èµ–é…ç½®</code></td></tr><tr><td>fix</td><td>Bug ä¿®å¤</td><td><code>ğŸ› fix(api): ä¿®å¤çŠ¶æ€æ›´æ–°å¼‚å¸¸</code></td></tr><tr><td>docs</td><td>æ–‡æ¡£</td><td><code>ğŸ“ docs: æ›´æ–° API æ–‡æ¡£</code></td></tr><tr><td>style</td><td>ä»£ç æ ¼å¼</td><td><code>ğŸ’„ style: ç»Ÿä¸€ä»£ç ç¼©è¿›</code></td></tr><tr><td>refactor</td><td>é‡æ„</td><td><code>â™»ï¸ refactor: é‡æ„ä»»åŠ¡è°ƒåº¦é€»è¾‘</code></td></tr><tr><td>perf</td><td>æ€§èƒ½ä¼˜åŒ–</td><td><code>âš¡ï¸ perf: ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½</code></td></tr><tr><td>test</td><td>æµ‹è¯•</td><td><code>âœ… test: æ·»åŠ å•å…ƒæµ‹è¯•</code></td></tr><tr><td>build</td><td>æ„å»º</td><td><code>ğŸ“¦ï¸ build: å‡çº§ä¾èµ–</code></td></tr><tr><td>ci</td><td>CI é…ç½®</td><td><code>ğŸ¡ ci: æ·»åŠ  GitHub Actions</code></td></tr><tr><td>revert</td><td>å›æ»š</td><td><code>âªï¸ revert: å›æ»šæŸåŠŸèƒ½</code></td></tr><tr><td>chore</td><td>å…¶ä»–</td><td><code>ğŸ”¨ chore: æ›´æ–° .gitignore</code></td></tr></tbody></table>
<h2 data-id="heading-10">ç›¸å…³é“¾æ¥</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">GoCron é¡¹ç›®</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgocron-docs.pages.dev" target="_blank" title="https://gocron-docs.pages.dev" ref="nofollow noopener noreferrer">GoCron æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcz-git.qbb.sh%2Fzh%2F" target="_blank" title="https://cz-git.qbb.sh/zh/" ref="nofollow noopener noreferrer">cz-git æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcommitlint.js.org%2F" target="_blank" title="https://commitlint.js.org/" ref="nofollow noopener noreferrer">Commitlint æ–‡æ¡£</a></li>
</ul>
<hr/>
<p>å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œæ¬¢è¿ç»™ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgocronx-team%2Fgocron" target="_blank" title="https://github.com/gocronx-team/gocron" ref="nofollow noopener noreferrer">gocron</a> ç‚¹ä¸ª Star â­ï¸</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vercel å›¢é˜Ÿ 10 å¹´ React æ€§èƒ½ä¼˜åŒ–ç»éªŒï¼š10 å¤§æ ¸å¿ƒç­–ç•¥è®©æ€§èƒ½æå‡ 300%]]></title>    <link>https://juejin.cn/post/7600587732991492138</link>    <guid>https://juejin.cn/post/7600587732991492138</guid>    <pubDate>2026-01-29T09:33:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600587732991492138" data-draft-id="7600587732991475754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vercel å›¢é˜Ÿ 10 å¹´ React æ€§èƒ½ä¼˜åŒ–ç»éªŒï¼š10 å¤§æ ¸å¿ƒç­–ç•¥è®©æ€§èƒ½æå‡ 300%"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,React.js"/> <meta itemprop="datePublished" content="2026-01-29T09:33:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†´ç¾½"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vercel å›¢é˜Ÿ 10 å¹´ React æ€§èƒ½ä¼˜åŒ–ç»éªŒï¼š10 å¤§æ ¸å¿ƒç­–ç•¥è®©æ€§èƒ½æå‡ 300%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†´ç¾½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:33:55.000Z" title="Thu Jan 29 2026 09:33:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Vercel æœ€è¿‘å‘å¸ƒäº† React æœ€ä½³å®è·µåº“ï¼Œå°†<strong>åä½™å¹´æ¥ç§¯ç´¯çš„ React å’Œ Next.js</strong> ä¼˜åŒ–ç»éªŒæ•´åˆåˆ°äº†ä¸€ä¸ªæŒ‡å—ä¸­ã€‚</p>
<p>å…¶ä¸­ä¸€å…±åŒ…å«<strong>8 ä¸ªç±»åˆ«ã€40 å¤šæ¡è§„åˆ™</strong>ã€‚</p>
<p>è¿™äº›åŸåˆ™å¹¶ä¸æ˜¯çº¸ä¸Šè°ˆå…µï¼Œè€Œæ˜¯ Vercel å›¢é˜Ÿåœ¨ 10 ä½™å¹´ä»æ— æ•°ç”Ÿäº§ä»£ç åº“ä¸­æ€»ç»“å‡ºçš„ç»éªŒä¹‹è°ˆã€‚å®ƒä»¬å·²ç»è¢«æ— æ•°æˆåŠŸæ¡ˆä¾‹éªŒè¯ï¼Œèƒ½åˆ‡å®æ”¹å–„ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡æŒ‡æ ‡ã€‚</p>
<p>ä»¥ä¸‹å°†æ˜¯å¯¹ä½ çš„ React å’Œ Next.js é¡¹ç›®å½±å“æœ€å¤§çš„ 10 å¤§å®è·µã€‚</p>
<h2 data-id="heading-0">1. å°†ç‹¬ç«‹çš„å¼‚æ­¥æ“ä½œå¹¶è¡Œ</h2>
<p>è¯·æ±‚ç€‘å¸ƒæµæ˜¯ React åº”ç”¨æ€§èƒ½çš„å¤´å·æ€æ‰‹ã€‚</p>
<p>æ¯æ¬¡é¡ºåºæ‰§è¡Œ await éƒ½ä¼šå¢åŠ ç½‘ç»œå»¶è¿Ÿï¼Œæ¶ˆé™¤å®ƒä»¬å¯ä»¥å¸¦æ¥æœ€å¤§çš„æ€§èƒ½æå‡ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();
  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPosts</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Dashboard</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> <span class="hljs-attr">posts</span>=<span class="hljs-string">{posts}</span> /&gt;</span></span>;
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [user, posts] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">fetchUser</span>(), <span class="hljs-title function_">fetchPosts</span>()]);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Dashboard</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> <span class="hljs-attr">posts</span>=<span class="hljs-string">{posts}</span> /&gt;</span></span>;
}
</code></pre>
<p>å½“å¤„ç†å¤šä¸ªæ•°æ®æºæ—¶ï¼Œè¿™ä¸ªç®€å•çš„æ”¹å˜å¯ä»¥å°†é¡µé¢åŠ è½½æ—¶é—´å‡å°‘æ•°ç™¾æ¯«ç§’ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fd0761460354780b5a7c2b663153458~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=yjIIcSkHja31%2F3clblBo4IYsSqE%3D" alt="ç­–ç•¥1ï¼šå¹¶è¡Œå¼‚æ­¥æ“ä½œ" loading="lazy"/></p>
<h2 data-id="heading-1">2. é¿å…æ¡¶æ–‡ä»¶å¯¼å…¥</h2>
<p>ä»æ¡¶æ–‡ä»¶å¯¼å…¥ä¼šå¼ºåˆ¶æ‰“åŒ…ç¨‹åºè§£ææ•´ä¸ªåº“ï¼Œå³ä½¿ä½ åªéœ€è¦å…¶ä¸­ä¸€ä¸ªç»„ä»¶ã€‚</p>
<p>è¿™å°±åƒæŠŠæ•´ä¸ªè¡£æŸœéƒ½æ¬èµ°ï¼Œåªä¸ºäº†ç©¿ä¸€ä»¶è¡£æœã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Check</span>, X, <span class="hljs-title class_">Menu</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"lucide-react"</span>;
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Check</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"lucide-react/dist/esm/icons/check"</span>;
<span class="hljs-keyword">import</span> X <span class="hljs-keyword">from</span> <span class="hljs-string">"lucide-react/dist/esm/icons/x"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Menu</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"lucide-react/dist/esm/icons/menu"</span>;
</code></pre>
<p><strong>æ›´å¥½çš„æ–¹å¼ï¼ˆä½¿ç”¨ Next.js é…ç½®ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// next.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">experimental</span>: {
    <span class="hljs-attr">optimizePackageImports</span>: [<span class="hljs-string">"lucide-react"</span>, <span class="hljs-string">"@mui/material"</span>],
  },
};

<span class="hljs-comment">// ç„¶åä¿æŒç®€æ´çš„å¯¼å…¥æ–¹å¼</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Check</span>, X, <span class="hljs-title class_">Menu</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"lucide-react"</span>;
</code></pre>
<p>ç›´æ¥å¯¼å…¥å¯å°†å¯åŠ¨é€Ÿåº¦æé«˜ 15-70%ï¼Œæ„å»ºéš¾åº¦é™ä½ 28%ï¼Œå†·å¯åŠ¨é€Ÿåº¦æé«˜ 40%ï¼ŒHMR é€Ÿåº¦æ˜¾è‘—æé«˜ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f389ae11eb1345abb64dbe31b9aa8c48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=Qre2hz1PW564x40agjqlED8%2B6gI%3D" alt="ç­–ç•¥2ï¼šé¿å…æ¡¶æ–‡ä»¶å¯¼å…¥" loading="lazy"/></p>
<h2 data-id="heading-2">3. ä½¿ç”¨å»¶è¿ŸçŠ¶æ€åˆå§‹åŒ–</h2>
<p>å½“åˆå§‹åŒ–çŠ¶æ€éœ€è¦è¿›è¡Œè€—æ—¶çš„è®¡ç®—æ—¶ï¼Œå°†åˆå§‹åŒ–ç¨‹åºåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œç¡®ä¿å®ƒåªè¿è¡Œä¸€æ¬¡ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [config, setConfig] = <span class="hljs-title function_">useState</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">"config"</span>)));
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{config.theme}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [config, setConfig] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">"config"</span>)));
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{config.theme}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šä» localStorage è§£æ JSON é…ç½®ï¼Œä½†å…¶å®å®ƒåªéœ€è¦åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¯»å–ä¸€æ¬¡ï¼Œå°†å…¶å°è£…åœ¨å›è°ƒå‡½æ•°ä¸­å¯ä»¥æ¶ˆé™¤è¿™ç§æµªè´¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd76a17381a3489c9d21f94e55f4cadf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=OwIuHEVGU9A76kju5d4suY2%2BDVA%3D" alt="ç­–ç•¥3ï¼šå»¶è¿ŸçŠ¶æ€åˆå§‹åŒ–" loading="lazy"/></p>
<h2 data-id="heading-3">4. æœ€å°åŒ– RSC è¾¹ç•Œçš„æ•°æ®ä¼ é€’</h2>
<p>React <strong>æœåŠ¡ç«¯/å®¢æˆ·ç«¯</strong>è¾¹ç•Œä¼šå°†æ‰€æœ‰å¯¹è±¡å±æ€§åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²å¹¶åµŒå…¥åˆ° HTML å“åº”ä¸­ï¼Œè¿™ä¼šç›´æ¥å½±å“é¡µé¢å¤§å°å’ŒåŠ è½½æ—¶é—´ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(); <span class="hljs-comment">// 50 fields</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
}

(<span class="hljs-string">"use client"</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>; <span class="hljs-comment">// uses 1 field</span>
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">{user.name}</span> /&gt;</span></span>;
}

(<span class="hljs-string">"use client"</span>);
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">{ name }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>åªä¼ é€’å®¢æˆ·ç«¯ç»„ä»¶å®é™…éœ€è¦çš„æ•°æ®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f43e688d0af544d7b0a2a735758ae08f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=kvqOLctC1Lbx8iomFfizWsYRuKQ%3D" alt="ç­–ç•¥4ï¼šæœ€å°åŒ–RSCè¾¹ç•Œ" loading="lazy"/></p>
<h2 data-id="heading-4">5. åŠ¨æ€å¯¼å…¥å¤§å‹ç»„ä»¶</h2>
<p>ä»…åœ¨åŠŸèƒ½æ¿€æ´»æ—¶åŠ è½½å¤§å‹åº“ï¼Œå‡å°‘åˆå§‹åŒ…ä½“ç§¯ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AnimationPlayer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./heavy-animation-lib"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Component</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [enabled, setEnabled] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">return</span> enabled ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AnimationPlayer</span> /&gt;</span></span> : <span class="hljs-literal">null</span>;
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AnimationPlayer</span>(<span class="hljs-params">{ enabled, setEnabled }</span>) {
  <span class="hljs-keyword">const</span> [frames, setFrames] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (enabled &amp;&amp; !frames &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">"undefined"</span>) {
      <span class="hljs-keyword">import</span>(<span class="hljs-string">"./animation-frames.js"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">mod</span>) =&gt;</span> <span class="hljs-title function_">setFrames</span>(mod.<span class="hljs-property">frames</span>)).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setEnabled</span>(<span class="hljs-literal">false</span>));
    }
  }, [enabled, frames, setEnabled]);

  <span class="hljs-keyword">if</span> (!frames) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Skeleton</span> /&gt;</span></span>;
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Canvas</span> <span class="hljs-attr">frames</span>=<span class="hljs-string">{frames}</span> /&gt;</span></span>;
}
</code></pre>
<p><code>typeof window</code> å¯ä»¥é˜²æ­¢å°†æ­¤æ¨¡å—æ‰“åŒ…ç”¨äº <strong>SSRï¼Œä¼˜åŒ–</strong>æœåŠ¡ç«¯åŒ…ä½“ç§¯å’Œæ„å»ºé€Ÿåº¦ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cc3b7710569482bab2577744e55da7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=1sP01Gz6tBP1hITfz4%2BJr6mwOvg%3D" alt="ç­–ç•¥5ï¼šåŠ¨æ€å¯¼å…¥ç»„ä»¶" loading="lazy"/></p>
<h2 data-id="heading-5">6. å»¶è¿ŸåŠ è½½ç¬¬ä¸‰æ–¹è„šæœ¬</h2>
<p>åˆ†æå’Œè·Ÿè¸ªè„šæœ¬ä¸è¦é˜»å¡ç”¨æˆ·äº¤äº’ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">initAnalytics</span>();
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  );
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Analytics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@vercel/analytics/react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">RootLayout</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        {children}
        <span class="hljs-tag">&lt;<span class="hljs-name">Analytics</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
  );
}
</code></pre>
<p>åœ¨æ°´åˆååŠ è½½åˆ†æè„šæœ¬ï¼Œä¼˜å…ˆå¤„ç†äº¤äº’å†…å®¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f39210c94c17483ea6b13db5174b71c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=%2BFPfJTS3B4iRfUdGwQ5QLHMsqQ0%3D" alt="ç­–ç•¥6ï¼šå»¶è¿ŸåŠ è½½è„šæœ¬" loading="lazy"/></p>
<h2 data-id="heading-6">7. ä½¿ç”¨ React.cache() è¿›è¡Œè¯·æ±‚å»é‡</h2>
<p>é˜²æ­¢æœåŠ¡ç«¯åœ¨åŒä¸€æ¸²æŸ“å‘¨æœŸå†…é‡å¤è¯·æ±‚ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(); <span class="hljs-comment">// é‡å¤è¯·æ±‚</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>{user.email}<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>;
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { cache } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> getUser = <span class="hljs-title function_">cache</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUser</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUser</span>(); <span class="hljs-comment">// å·²ç¼“å­˜ï¼Œæ— é‡å¤è¯·æ±‚</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>{user.email}<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>;
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99c6bef06a2f462882bfd72a922c1426~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=jvbjdqYaD%2BHmgiwikZ9u2Xj6g8k%3D" alt="ç­–ç•¥7-8ï¼šç¼“å­˜å»é‡" loading="lazy"/></p>
<h2 data-id="heading-7">8. å®ç°è·¨è¯·æ±‚æ•°æ®çš„ LRU ç¼“å­˜</h2>
<p>React.cache() ä»…åœ¨å•ä¸ªè¯·æ±‚å†…æœ‰æ•ˆï¼Œå› æ­¤å¯¹äºè·¨è¿ç»­è¯·æ±‚å…±äº«çš„æ•°æ®ï¼Œä½¿ç”¨ LRU ç¼“å­˜ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LRUCache</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"lru-cache"</span>;

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LRUCache</span>({
  <span class="hljs-attr">max</span>: <span class="hljs-number">1000</span>,
  <span class="hljs-attr">ttl</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5 åˆ†é’Ÿ</span>
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">const</span> cached = cache.<span class="hljs-title function_">get</span>(id);
  <span class="hljs-keyword">if</span> (cached) <span class="hljs-keyword">return</span> cached;

  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { id } });
  cache.<span class="hljs-title function_">set</span>(id, user);
  <span class="hljs-keyword">return</span> user;
}
</code></pre>
<p>è¿™åœ¨ Vercel çš„ Fluid Compute ä¸­ç‰¹åˆ«æœ‰æ•ˆï¼Œå¤šä¸ªå¹¶å‘è¯·æ±‚å…±äº«åŒä¸€ä¸ªå‡½æ•°å®ä¾‹ã€‚</p>
<h2 data-id="heading-8">9. é€šè¿‡ç»„ä»¶ç»„åˆå®ç°å¹¶è¡ŒåŒ–</h2>
<p>React æœåŠ¡ç«¯ç»„ä»¶åœ¨æ ‘çŠ¶ç»“æ„ä¸­æŒ‰é¡ºåºæ‰§è¡Œï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ç»„åˆå¯¹ç»„ä»¶æ ‘è¿›è¡Œé‡æ„ä»¥å®ç°å¹¶è¡ŒåŒ–æ•°æ®è·å–ï¼š</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPageData</span>();
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{data}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Sidebar</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Sidebar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchPageData</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data.content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œé¡µçœ‰å’Œä¾§è¾¹æ å°±å¯ä»¥å¹¶è¡Œè·å–æ•°æ®äº†ã€‚</p>
<h2 data-id="heading-9">10. ä½¿ç”¨ SWR è¿›è¡Œå®¢æˆ·ç«¯è¯·æ±‚å»é‡</h2>
<p>å½“å®¢æˆ·ç«¯ä¸Šçš„å¤šä¸ªç»„ä»¶è¯·æ±‚ç›¸åŒçš„æ•°æ®æ—¶ï¼ŒSWR ä¼šè‡ªåŠ¨å¯¹è¯·æ±‚è¿›è¡Œå»é‡ã€‚</p>
<p>âŒ é”™è¯¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/user"</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(setUser);
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserAvatar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/user"</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(setUser);
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{user?.avatar}</span> /&gt;</span></span>;
}
</code></pre>
<p>âœ… æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> useSWR <span class="hljs-keyword">from</span> <span class="hljs-string">"swr"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetcher</span> = (<span class="hljs-params">url</span>) =&gt; <span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.<span class="hljs-title function_">json</span>());

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: user } = <span class="hljs-title function_">useSWR</span>(<span class="hljs-string">"/api/user"</span>, fetcher);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserAvatar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: user } = <span class="hljs-title function_">useSWR</span>(<span class="hljs-string">"/api/user"</span>, fetcher);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{user?.avatar}</span> /&gt;</span></span>;
}
</code></pre>
<p>SWR åªå‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å°†ç»“æœåœ¨ä¸¤ä¸ªç»„ä»¶ä¹‹é—´å…±äº«ã€‚</p>
<h2 data-id="heading-10">11. æ€»ç»“</h2>
<p>è¿™äº›æœ€ä½³å®è·µçš„ç¾å¦™ä¹‹å¤„åœ¨äºï¼š<strong>å®ƒä»¬ä¸æ˜¯å¤æ‚çš„æ¶æ„å˜æ›´</strong>ã€‚å¤§å¤šæ•°éƒ½æ˜¯ç®€å•çš„ä»£ç ä¿®æ”¹ï¼Œå´èƒ½äº§ç”Ÿæ˜¾è‘—çš„æ€§èƒ½æ”¹è¿›ã€‚</p>
<p>ä¸€ä¸ª 600ms çš„ç€‘å¸ƒç­‰å¾…æ—¶é—´ï¼Œä¼šå½±å“<strong>æ¯ä¸€ä½ç”¨æˆ·</strong>ï¼Œç›´åˆ°è¢«ä¿®å¤ã€‚</p>
<p>ä¸€ä¸ªæ¡¶æ–‡ä»¶å¯¼å…¥é€ æˆçš„åŒ…è†¨èƒ€ï¼Œä¼šå‡æ…¢<strong>æ¯ä¸€æ¬¡æ„å»ºå’Œæ¯ä¸€æ¬¡é¡µé¢åŠ è½½</strong>ã€‚</p>
<p><strong>æ‰€ä»¥è¶Šæ—©é‡‡ç”¨è¿™äº›å®è·µï¼Œå°±èƒ½é¿å…ç§¯ç´¯è¶Šæ¥è¶Šå¤šçš„æ€§èƒ½å€ºåŠ¡ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6edbff7a052f4a3fa9e71edc26c12d43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770284035&amp;x-signature=Ys0c5ZZ6YfMytP3B5%2BnIx%2Bs5yWE%3D" alt="æ€»ç»“ï¼šç«‹å³è¡ŒåŠ¨" loading="lazy"/></p>
<p>ç°åœ¨å¼€å§‹åº”ç”¨è¿™äº›æŠ€å·§ï¼Œè®©ä½ çš„ React åº”ç”¨å¿«å¦‚é—ªç”µå§ï¼</p>
<p>æˆ‘æ˜¯å†´ç¾½ï¼Œ10 å¹´ç¬”è€•ä¸è¾ï¼Œä¸“æ³¨å‰ç«¯é¢†åŸŸï¼Œæ›´æ–°äº† 10+ ç³»åˆ—ã€300+ ç¯‡åŸåˆ›æŠ€æœ¯æ–‡ç« ï¼Œç¿»è¯‘è¿‡ Svelteã€Solid.jsã€TypeScript æ–‡æ¡£ï¼Œè‘—æœ‰å°å†Œã€ŠNext.js å¼€å‘æŒ‡å—ã€‹ã€ã€ŠSvelte å¼€å‘æŒ‡å—ã€‹ã€ã€ŠAstro å®æˆ˜æŒ‡å—ã€‹ã€‚</p>
<p>æ¬¢è¿å›´è§‚æˆ‘çš„â€œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fyayujs.com%2F" target="_blank" title="https://yayujs.com/" ref="nofollow noopener noreferrer">ç½‘é¡µç‰ˆæœ‹å‹åœˆ</a>â€ï¼Œå…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼š<strong>å†´ç¾½ï¼ˆæˆ–æœç´¢ yayujsï¼‰</strong>ï¼Œæ¯å¤©åˆ†äº«å‰ç«¯çŸ¥è¯†ã€AI å¹²è´§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Crawbotä¸€å¤œçˆ†çº¢ï¼æ˜¯AIæ–°é£å£è¿˜æ˜¯èµ›åšçˆ¬è™«ï¼Ÿå®æµ‹æ­ç§˜çœŸç›¸]]></title>    <link>https://juejin.cn/post/7600414546189680650</link>    <guid>https://juejin.cn/post/7600414546189680650</guid>    <pubDate>2026-01-29T09:22:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600414546189680650" data-draft-id="7600581247020531721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Crawbotä¸€å¤œçˆ†çº¢ï¼æ˜¯AIæ–°é£å£è¿˜æ˜¯èµ›åšçˆ¬è™«ï¼Ÿå®æµ‹æ­ç§˜çœŸç›¸"/> <meta itemprop="keywords" content="å‰ç«¯,æ˜é‡‘æŠ€æœ¯å¾æ–‡"/> <meta itemprop="datePublished" content="2026-01-29T09:22:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeekSavvy"/> <meta itemprop="url" content="https://juejin.cn/user/629365724166398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Crawbotä¸€å¤œçˆ†çº¢ï¼æ˜¯AIæ–°é£å£è¿˜æ˜¯èµ›åšçˆ¬è™«ï¼Ÿå®æµ‹æ­ç§˜çœŸç›¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/629365724166398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeekSavvy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:22:20.000Z" title="Thu Jan 29 2026 09:22:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€å¤œçˆ†çº¢çš„Crawbotï¼Œæ˜¯AIæ–°é£å£è¿˜æ˜¯â€œèµ›åšçˆ¬è™«â€ï¼Ÿ</h2>
<blockquote>
<p>å½“ä½ çš„æµè§ˆå™¨å¼€å§‹è‡ªå·±æ€è€ƒï¼Œäº‹æƒ…å°±å˜å¾—æœ‰è¶£äº†ã€‚</p>
</blockquote>
<p>æœ€è¿‘æˆ‘çš„æŠ€æœ¯åœˆå’Œè‡ªåª’ä½“ç¾¤èŠï¼Œè¢«ä¸€ä¸ªè¯åˆ·å±äº†ï¼š<strong>Crawbot</strong>ã€‚</p>
<p>ä¸æ˜¯Chatbotï¼Œä¸æ˜¯Agentï¼Œæ˜¯<strong>Crawbot</strong>ã€‚è¿™ç©æ„å„¿åƒä¸€é˜µé£ï¼Œçªç„¶å°±åˆ®èµ·æ¥äº†ã€‚æœ‰äººè¯´å®ƒæ˜¯â€œç½‘é¡µè‡ªåŠ¨åŒ–ç¥å™¨â€ï¼Œæœ‰äººç§°å®ƒä¸ºâ€œRPAçš„ç»ˆç»“è€…â€ï¼Œæ›´æœ‰äººç›´æ¥æŠŠå®ƒæ§ä¸ºâ€œä¸‹ä¸€ä»£AIäº¤äº’çš„é›å½¢â€ã€‚</p>
<p><img src="https://01editor.oss-cn-hangzhou.aliyuncs.com/aiarticle/images/20260129171948_e59e8c43.jpg" alt="å›¾ç‰‡æ¥æºï¼š6.4ä¸‡Chat bot å…ç‰ˆç¨å›¾ç‰‡ã€åº“å­˜ç…§ç‰‡å’Œå›¾åƒ| Shutterstock" loading="lazy"/></p>
<p>ä½œä¸ºä¸€ä¸ªå¸¸å¹´æ··è¿¹åœ¨AIå’Œè‡ªåŠ¨åŒ–ä¸€çº¿çš„è€å¸æœºï¼Œæˆ‘ç¬¬ä¸€ååº”æ˜¯ï¼šåˆæ¥ä¸€ä¸ªç‚’æ¦‚å¿µçš„ï¼Ÿä½†æ¶ä¸ä½å¥½å¥‡å¿ƒï¼Œæˆ‘å†³å®šäº²è‡ªä¸‹åœºï¼Œæ‰’ä¸€æ‰’è¿™ä¸ª<strong>Crawbot</strong>çš„åº•è£¤ï¼Œçœ‹çœ‹å®ƒåˆ°åº•æ˜¯çœŸæå®æ–™çš„â€œå½“çº¢ç‚¸å­é¸¡â€ï¼Œè¿˜æ˜¯åˆä¸€ä¸ªåŒ…è£…ç²¾ç¾çš„â€œæŠ€æœ¯æ³¡æ²«â€ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å¼€ç®±å®æµ‹ï¼šå½“AIå­¦ä¼šâ€œçœ‹â€ç½‘é¡µ</h3>
<p>æ‹¿åˆ°ä¸€ä¸ªCrawbotå·¥å…·ï¼ˆä¸ºäº†é¿å…å¹¿å‘Šå«Œç–‘ï¼Œè¿™é‡Œå°±ä¸ç‚¹åäº†ï¼‰ï¼Œæˆ‘çš„æµ‹è¯•æ–¹æ³•å¾ˆç®€å•ç²—æš´ï¼š<strong>ç»™å®ƒä¸€ä¸ªæˆ‘å®Œå…¨æ²¡æ¥è§¦è¿‡çš„ã€ä¿¡æ¯ç»“æ„å¤æ‚çš„å®˜ç½‘ï¼Œè®©å®ƒå¸®æˆ‘æ‰¾å‡ºâ€œ2025å¹´å¼€å‘è€…å¤§ä¼šçš„æŠ¥åæˆªæ­¢æ—¥æœŸå’Œç¥¨ä»·â€ã€‚</strong></p>
<p>ä¼ ç»Ÿçˆ¬è™«æ€ä¹ˆåšï¼Ÿä½ å¾—å†™XPathã€CSSé€‰æ‹©å™¨ï¼Œç ”ç©¶é¡µé¢ç»“æ„ï¼Œå¤„ç†JavaScriptæ¸²æŸ“ï¼Œä¸€ä¸å°å¿ƒå°±è§¦å‘åçˆ¬ã€‚RPAå·¥å…·å‘¢ï¼Ÿä½ å¾—å½•åˆ¶æ“ä½œï¼Œå®šä½å…ƒç´ ï¼Œæµç¨‹åƒµç¡¬å¾—åƒåœ¨åšå¹¿æ’­ä½“æ“ã€‚</p>
<p>è€ŒCrawbotï¼Œæˆ‘åªè¾“å…¥äº†é‚£å¥äººè¯æŒ‡ä»¤å’Œç½‘å€é“¾æ¥ã€‚</p>
<p>æ¥ä¸‹æ¥çš„å‡ åˆ†é’Ÿï¼Œæœ‰ç‚¹é­”å¹»ã€‚æˆ‘çœ‹åˆ°æµè§ˆå™¨çš„å…‰æ ‡è‡ªå·±åœ¨é¡µé¢ä¸Šç§»åŠ¨ã€ç‚¹å‡»ã€æ»šåŠ¨ã€æ‚¬åœã€‚å®ƒæ²¡æœ‰èµ°é¢„è®¾çš„å¯¼èˆªèœå•ï¼Œè€Œæ˜¯åƒä¸€ä¸ªäººä¸€æ ·ï¼Œå…ˆå¿«é€Ÿæ‰«è§†é¦–é¡µï¼Œç„¶åç‚¹è¿›äº†â€œæ´»åŠ¨â€æ¿å—ï¼Œåœ¨å‡ ä¸ªåˆ†é¡µé‡Œç¿»æ‰¾ï¼Œæœ€ååœ¨ä¸€ä¸ªæŠ˜å çš„â€œå¸¸è§é—®é¢˜â€åŒºåŸŸï¼Œç²¾å‡†åœ°æªå‡ºäº†æˆ‘è¦çš„ä¿¡æ¯ã€‚</p>
<p><img src="https://01editor.oss-cn-hangzhou.aliyuncs.com/svgs/0313184663729557.svg" alt="å›¾ç‰‡æ¥æºï¼š01Editor" loading="lazy"/></p>
<p><strong>æ•´ä¸ªè¿‡ç¨‹ï¼Œæ²¡æœ‰ä¸€è¡Œä»£ç ï¼Œæ²¡æœ‰ä¸€ä¸ªå…ƒç´ å®šä½ã€‚</strong> å®ƒé çš„æ˜¯å¯¹ç½‘é¡µè§†è§‰å…ƒç´ çš„â€œç†è§£â€å’ŒåŸºäºç›®æ ‡çš„â€œæ¨ç†â€ã€‚</p>
<p><img src="https://01editor.oss-cn-hangzhou.aliyuncs.com/aiarticle/images/20260129171745_63f7d47a.jpeg" alt="å›¾ç‰‡æ¥æºï¼šAIç”Ÿæˆ" loading="lazy"/></p>
<p>è¿™æ„Ÿè§‰ï¼Œå°±åƒä½ é›‡äº†ä¸€ä¸ªçœ¼ç¥å¥½ã€è„‘å­å¿«ã€è¿˜ç‰¹åˆ«å¬è¯çš„å®ä¹ ç”Ÿï¼Œä½ åªéœ€è¦å‘Šè¯‰ä»–â€œå»é‚£ä¸ªç½‘ç«™ï¼ŒæŠŠXXä¿¡æ¯æ‰¾å‡ºæ¥â€ï¼Œä»–å°±èƒ½ç»™ä½ åŠå¦¥ã€‚</p>
<p><strong>é‡‘å¥æ¥äº†ï¼šå½“å·¥å…·ä»â€œæ‰§è¡Œå›ºå®šè„šæœ¬â€è¿›åŒ–åˆ°â€œç†è§£å¹¶å®Œæˆä»»åŠ¡â€ï¼Œç”Ÿäº§åŠ›çš„è§£æ”¾å°±ä¸å†æ˜¯çº¿æ€§å¢é•¿ï¼Œè€Œæ˜¯æŒ‡æ•°çº§çˆ†ç‚¸ã€‚</strong></p>
<h3 data-id="heading-2">äºŒã€æŠ€æœ¯åº•ç‰Œï¼šCV + LLMï¼Œç»™æµè§ˆå™¨è£…ä¸Šâ€œçœ¼ç›â€å’Œâ€œå¤§è„‘â€</h3>
<p>Crawbotä¸ºä»€ä¹ˆèƒ½è¿™ä¹ˆâ€œèªæ˜â€ï¼Ÿæ‹†å¼€æ¥çœ‹ï¼Œå®ƒçš„æ ¸å¿ƒæŠ€æœ¯æ ˆå…¶å®å¾ˆæ¸…æ™°ï¼š</p>
<ul>
<li>
<p><strong>è®¡ç®—æœºè§†è§‰ï¼ˆCVï¼‰ä½œä¸ºâ€œçœ¼ç›â€</strong>ï¼šå®ƒä¸å†ä¾èµ–è„†å¼±çš„DOMæ ‘æˆ–å…ƒç´ IDï¼Œè€Œæ˜¯ç›´æ¥â€œçœ‹â€ç½‘é¡µçš„æˆªå›¾æˆ–åƒç´ æµã€‚æŒ‰é’®ã€è¾“å…¥æ¡†ã€é“¾æ¥ã€è¡¨æ ¼ï¼Œåœ¨å®ƒçœ¼é‡Œéƒ½æ˜¯å±å¹•ä¸Šçš„è§†è§‰å…ƒç´ ã€‚è¿™æ‹›ç›´æ¥ç»•å¼€äº†å¤§é‡å‰ç«¯æ¡†æ¶åŠ¨æ€æ¸²æŸ“å¸¦æ¥çš„ä¼ ç»Ÿçˆ¬å–éš¾é¢˜ã€‚</p>
</li>
<li>
<p><strong>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä½œä¸ºâ€œå¤§è„‘â€</strong>ï¼šè¿™æ˜¯çµé­‚ã€‚LLMè´Ÿè´£ç†è§£ä½ çš„<strong>è‡ªç„¶è¯­è¨€æŒ‡ä»¤</strong>ï¼Œå¹¶å°†å…¶åˆ†è§£æˆä¸€ç³»åˆ—å¯æ‰§è¡Œçš„å­ä»»åŠ¡å’Œæ“ä½œé€»è¾‘ï¼ˆæ¯”å¦‚ï¼šâ€œå…ˆæ‰¾åˆ°å¯¼èˆªæ ï¼Œç‚¹å‡»â€˜äº§å“â€™ï¼Œåœ¨åˆ—è¡¨é¡µç­›é€‰ä»·æ ¼ä½äº1000çš„å•†å“â€¦â€¦â€ï¼‰ã€‚åŒæ—¶ï¼ŒLLMè¿˜èƒ½ç†è§£å®ƒâ€œçœ‹åˆ°â€çš„ç½‘é¡µå†…å®¹ï¼Œåˆ¤æ–­å½“å‰çŠ¶æ€ï¼Œå†³å®šä¸‹ä¸€æ­¥ç‚¹å‡»å“ªé‡Œã€‚</p>
</li>
<li>
<p><strong>å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰ä½œä¸ºâ€œå°è„‘â€</strong>ï¼šé€šè¿‡å¤§é‡çš„äººæœºäº¤äº’æ•°æ®è®­ç»ƒï¼ŒCrawbotèƒ½å­¦ä¹ åˆ°åœ¨ä¸åŒç½‘é¡µæƒ…å¢ƒä¸‹çš„æœ€ä¼˜æ“ä½œè·¯å¾„ï¼Œå½¢æˆä¸€ç§â€œæ‰‹æ„Ÿâ€æˆ–â€œç›´è§‰â€ï¼Œå‡å°‘æ— æ•ˆç‚¹å‡»ï¼Œæé«˜ä»»åŠ¡æˆåŠŸç‡ã€‚</p>
</li>
</ul>
<p>å½“ç„¶ï¼Œè¿™ä¹Ÿä¼šå¸¦æ¥æ–°çš„é—®é¢˜ï¼šä¿¡æ¯è¿‡è½½çš„æƒé™äº¤ç»™äº†AIï¼Œæˆ‘ä»¬å¦‚ä½•éªŒè¯ç»“æœçš„å‡†ç¡®æ€§ï¼Ÿå½“æ•°æ®æŠ“å–å˜å¾—å¦‚æ­¤ç®€å•ï¼Œç½‘ç»œæ•°æ®çš„å…¬å¹³ä½¿ç”¨å’Œéšç§è¾¹ç•Œåˆåœ¨å“ªé‡Œï¼Ÿ</p>
<h3 data-id="heading-3">å››ã€æœªæ¥å±•æœ›ï¼šCrawbotä¹‹åï¼Œæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>ç©äº†ä¸€å‘¨Crawbotï¼Œæˆ‘æœ€å¤§çš„æ„Ÿè§¦ä¸æ˜¯æŠ€æœ¯å¤šç‰›ï¼Œè€Œæ˜¯å®ƒæ­ç¤ºäº†ä¸€ä¸ªæ˜ç¡®çš„è¶‹åŠ¿ï¼š<strong>AIæ­£åœ¨ä»â€œå¯¹è¯å‹â€å‘â€œæ‰§è¡Œå‹â€æ·±åº¦æ¼”è¿›ã€‚</strong></p>
<p>ChatGPTè®©æˆ‘ä»¬ä¹ æƒ¯äº†ä¸AIèŠå¤©ï¼Œä½†èŠå¤©ç»ˆå½’æ˜¯èŠå¤©ã€‚è€ŒCrawbotè¿™ç±»æ™ºèƒ½ä½“ï¼Œå¼€å§‹<strong>å°†è¯­è¨€ç†è§£è½¬åŒ–ä¸ºå®å®åœ¨åœ¨çš„è¡ŒåŠ¨ï¼Œåœ¨æ•°å­—ä¸–ç•Œé‡Œç•™ä¸‹ç—•è¿¹</strong>ã€‚è¿™æ˜¯ä»â€œæ™ºåº“â€åˆ°â€œæ‰‹è¶³â€çš„å…³é”®ä¸€æ­¥ã€‚</p>
<p>ä¸‹ä¸€æ­¥ä¼šæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘çŒœï¼š</p>
<ul>
<li>
<p><strong>å¤šæ¨¡æ€èƒ½åŠ›èåˆ</strong>ï¼šæœªæ¥çš„Crawbotä¸ä»…èƒ½â€œçœ‹â€ç½‘é¡µï¼Œè¿˜èƒ½â€œå¬â€ä¼šè®®å½•éŸ³è‡ªåŠ¨ç”Ÿæˆçºªè¦ï¼Œâ€œç†è§£â€PDFå›¾è¡¨æå–æ•°æ®ï¼ŒçœŸæ­£æ‰“é€šæ‰€æœ‰æ•°å­—ä¿¡æ¯å­¤å²›ã€‚</p>
</li>
<li>
<p><strong>æ“ä½œç³»ç»Ÿçº§å…¥å£</strong>ï¼šå®ƒå¯èƒ½ä¸å†æ˜¯ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶æˆ–ç‹¬ç«‹åº”ç”¨ï¼Œè€Œæ˜¯æˆä¸ºæ“ä½œç³»ç»Ÿåº•å±‚çš„ä¸€éƒ¨åˆ†ã€‚ä½ å¯ä»¥åƒå¬å”¤Siriä¸€æ ·ï¼Œåœ¨ä»»ä½•åœ°æ–¹ç”¨è¯­éŸ³æˆ–æ–‡å­—å©å’å®ƒå»å®Œæˆè·¨åº”ç”¨ã€è·¨å¹³å°çš„å¤æ‚å·¥ä½œæµã€‚</p>
</li>
<li>
<p><strong>ç¾¤ä½“æ™ºèƒ½ä¸åä½œ</strong>ï¼šä¸€ä¸ªCrawbotå¸®ä½ è®¢æœºç¥¨ï¼Œå¦ä¸€ä¸ªåŒæ­¥å¸®ä½ æŸ¥ç›®çš„åœ°å¤©æ°”å’Œæ”»ç•¥ï¼Œå†ä¸€ä¸ªå¸®ä½ ç”Ÿæˆè¡Œææ¸…å•å¹¶ä¸‹å•ç¼ºå°‘çš„ç‰©å“ã€‚<strong>å¤šä¸ªæ™ºèƒ½ä½“åˆ†å·¥åä½œï¼Œä¸ºä½ æ‰“ç†æ•´ä¸ªæ•°å­—ç”Ÿæ´»ã€‚</strong></p>
</li>
</ul>
<p><strong>æœ€åï¼Œè¯´ç‚¹å®åœ¨çš„ã€‚</strong> ä½œä¸ºæ™®é€šç”¨æˆ·æˆ–å¼€å‘è€…ï¼Œç°åœ¨æœ‰å¿…è¦å»è¿½è¿™ä¸ªçƒ­ç‚¹å—ï¼Ÿ</p>
<p><strong>å¯¹äºå¤§å¤šæ•°åªæƒ³æé«˜æ•ˆç‡çš„ç”¨æˆ·ï¼š</strong> å¯ä»¥ä¿æŒå…³æ³¨ï¼Œä½†ä¸å¿…ç„¦è™‘ã€‚ç›®å‰æˆç†Ÿçš„Crawbotäº§å“è¿˜ä¸å¤šï¼Œä½¿ç”¨é—¨æ§›å’Œæˆæœ¬ä¸ä½ã€‚ä¸å¦¨ç­‰ç”Ÿæ€æ›´æˆç†Ÿã€ä»·æ ¼æ›´äº²æ°‘æ—¶å†å…¥æ‰‹ã€‚</p>
<p><strong>å¯¹äºå¼€å‘è€…å’Œåˆ›ä¸šè€…ï¼š</strong> è¿™æ˜¯ä¸€ä¸ªå€¼å¾—All inè§‚å¯Ÿçš„èµ›é“ã€‚å®ƒçš„æŠ€æœ¯èŒƒå¼ï¼ˆCV+LLM+RLçš„æ™ºèƒ½ä½“æ¶æ„ï¼‰å…·æœ‰æå¼ºçš„æ‰©å±•æ€§ï¼Œåº”ç”¨åœºæ™¯ç»ä¸æ­¢äºçˆ¬è™«ã€‚æƒ³æƒ³å¦‚ä½•å°†è¿™ç§â€œèƒ½çœ‹ä¼šå¹²â€çš„èƒ½åŠ›ï¼Œåº”ç”¨åˆ°ä½ çš„ä¸“ä¸šé¢†åŸŸï¼ˆæ¯”å¦‚è‡ªåŠ¨è®¾è®¡å®¡æŸ¥ã€æ™ºèƒ½è½¯ä»¶æµ‹è¯•ã€æ¸¸æˆè‡ªåŠ¨åŒ–ç­‰ï¼‰ï¼Œå¯èƒ½å°±èƒ½æŒ–åˆ°ç¬¬ä¸€æ¡¶é‡‘ã€‚</p>
<p>æ¯ä¸€æ¬¡æŠ€æœ¯æµªæ½®ï¼Œæœ€å…ˆè¢«æ”¹å˜çš„ä¸æ˜¯ä¸–ç•Œï¼Œè€Œæ˜¯æˆ‘ä»¬çœ‹å¾…å’Œè§£å†³é—®é¢˜çš„å·¥å…·ä¸æ€ç»´ã€‚ Crawbotæˆ–è®¸åªæ˜¯è¿™æ³¢AI Agentæµªæ½®ä¸­çš„ä¸€æœµæµªèŠ±ï¼Œä½†å®ƒè®©æˆ‘ä»¬æ¸…æ™°åœ°çœ‹åˆ°ï¼Œé‚£ä¸ªç”¨è‡ªç„¶è¯­è¨€æŒ‡æŒ¥æ•°å­—ä¸–ç•Œã€è®©æœºå™¨åƒäººä¸€æ ·æ€è€ƒå’Œæ“ä½œçš„æ—¶ä»£ï¼Œå·²ç»å©å“äº†é—¨é“ƒã€‚</p>
<p>é—¨åæ˜¯æ€æ ·çš„æ–°ä¸–ç•Œï¼Ÿæˆ‘å……æ»¡æœŸå¾…ï¼Œä¹Ÿä¿æŒè­¦æƒ•ã€‚ä½ å‘¢ï¼Ÿ</p>
<p>æœ¬æ–‡éƒ¨åˆ†å›¾ç‰‡æ¥æºäºç½‘ç»œï¼Œç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»åˆ é™¤ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ¬¡çº¿ä¸Šäº‹æ•…å¼•å‘çš„æ€è€ƒ]]></title>    <link>https://juejin.cn/post/7600628279214407706</link>    <guid>https://juejin.cn/post/7600628279214407706</guid>    <pubDate>2026-01-29T09:24:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600628279214407706" data-draft-id="7600489282839740426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ¬¡çº¿ä¸Šäº‹æ•…å¼•å‘çš„æ€è€ƒ"/> <meta itemprop="keywords" content="åç«¯,Java,æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-29T09:24:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‚¹æˆ‘è®¾ç½®æ˜µç§°"/> <meta itemprop="url" content="https://juejin.cn/user/2386363528256733"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ¬¡çº¿ä¸Šäº‹æ•…å¼•å‘çš„æ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386363528256733/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‚¹æˆ‘è®¾ç½®æ˜µç§°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:24:03.000Z" title="Thu Jan 29 2026 09:24:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš¨ ä¸€æ¬¡çº¿ä¸Šäº‹æ•…å¼•å‘çš„æ€è€ƒï¼šä¸ºä»€ä¹ˆ GET URL è¿‡é•¿ä¼šå¯¼è‡´ 400ï¼Ÿä»¥åŠæ­£ç¡®çš„æ¥å£è®¾è®¡å§¿åŠ¿</h2>
<h3 data-id="heading-1">ä¸€ã€äº‹æ•…èƒŒæ™¯</h3>
<p>åœ¨ä¸€æ¬¡å¾®æœåŠ¡è°ƒç”¨ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªéå¸¸è¯¡å¼‚çš„é—®é¢˜ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">è¿œç¨‹è°ƒç”¨å¤±è´¥ï¼š
HTTP 400 Bad Request
<span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>....
</code></pre>
<p>æ’æŸ¥æ—¥å¿—å‘ç°ï¼Œè¯·æ±‚æ˜¯è¿™æ ·å‘å‡ºçš„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">GET /dataTagEntityRelation/tagInfoByEntityId
?<span class="hljs-attr">tagType</span>=Table
&amp;<span class="hljs-attr">entityIds</span>=<span class="hljs-number">1</span>
&amp;<span class="hljs-attr">entityIds</span>=<span class="hljs-number">2</span>
&amp;<span class="hljs-attr">entityIds</span>=<span class="hljs-number">3</span>
&amp;<span class="hljs-attr">entityIds</span>=<span class="hljs-number">4</span>
...
&amp;<span class="hljs-attr">entityIds</span>=<span class="hljs-number">1000</span>+
</code></pre>
<p>å‚æ•°æ˜¯ä¸€ä¸ª <code>List&lt;String&gt; entityIds</code>ï¼Œé€šè¿‡ Feign çš„ <code>@SpringQueryMap</code> è‡ªåŠ¨å±•å¼€æˆ URL å‚æ•°ã€‚</p>
<p>ğŸ‘‰ ç»“æœï¼š<strong>è¯·æ±‚ç›´æ¥ 400ï¼ŒController æ ¹æœ¬æ²¡è¿›</strong></p>
<hr/>
<h3 data-id="heading-2">äºŒã€é—®é¢˜ç°è±¡</h3>
<h4 data-id="heading-3">ä»£ç ç»“æ„ï¼ˆé—®é¢˜ç‰ˆæœ¬ï¼‰</h4>
<h4 data-id="heading-4">Feign æ¥å£</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/dataTagEntityRelation/tagInfoByEntityId"</span>)
R&lt;TagInfoByEntityIdVO&gt; <span class="hljs-built_in">tagInfoByEntityId</span>(<span class="hljs-variable">@SpringQueryMap</span> TagInfoByEntityIdDTO dto);
</code></pre>
<h4 data-id="heading-5">DTO</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TagInfoByEntityIdDTO</span> {
    List&lt;<span class="hljs-type">String</span>&gt; entityIds;
    <span class="hljs-type">String</span> tagType;
}
</code></pre>
<h4 data-id="heading-6">å®é™…è¯·æ±‚</h4>
<pre><code class="hljs language-ini" lang="ini">GET /tagInfoByEntityId?<span class="hljs-attr">entityIds</span>=<span class="hljs-number">1</span>&amp;entityIds=<span class="hljs-number">2</span>&amp;entityIds=<span class="hljs-number">3</span>&amp;...entityIds=<span class="hljs-number">1000</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">ä¸‰ã€ä¸ºä»€ä¹ˆä¼š 400ï¼Ÿï¼ˆæœ¬è´¨åŸç†ï¼‰</h3>
<h4 data-id="heading-8">1ï¸âƒ£ HTTP åè®®æœ¬èº«æ²¡æœ‰è§„å®š URL æœ€å¤§é•¿åº¦</h4>
<p>ğŸ‘‰ ä½†æœåŠ¡å™¨å®ç°æœ‰ï¼</p>
<hr/>
<h4 data-id="heading-9">2ï¸âƒ£ çœŸæ­£é™åˆ¶ URL é•¿åº¦çš„æ˜¯æœåŠ¡å™¨ç»„ä»¶</h4>
<h5 data-id="heading-10">Tomcatï¼ˆé»˜è®¤ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">maxHttpHeaderSize</span> = <span class="hljs-number">8</span>KB
</code></pre>
<h5 data-id="heading-11">Nginxï¼ˆé»˜è®¤ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">large_client_header_buffers 4 8k<span class="hljs-comment">;</span>
</code></pre>
<h5 data-id="heading-12">API ç½‘å…³ / è´Ÿè½½å‡è¡¡</h5>
<ul>
<li>Spring Cloud Gateway</li>
<li>Zuul</li>
<li>Kong</li>
<li>SLB / ELB<br/>
ğŸ‘‰ é€šå¸¸é™åˆ¶ 8KB ~ 16KB</li>
</ul>
<hr/>
<h4 data-id="heading-13">3ï¸âƒ£ HTTP æŠ¥æ–‡ç»“æ„å†³å®šäº†é—®é¢˜</h4>
<h5 data-id="heading-14">GET è¯·æ±‚ç»“æ„ï¼š</h5>
<pre><code class="hljs language-ini" lang="ini">GET /xxx?<span class="hljs-attr">entityIds</span>=<span class="hljs-number">1</span>&amp;entityIds=<span class="hljs-number">2</span>&amp;... HTTP/<span class="hljs-number">1.1</span>
Host: xxx
User-Agent: xxx
</code></pre>
<p>ğŸ‘‰ URL å±äº <strong>è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰</strong><br/>
ğŸ‘‰ è¯·æ±‚è¡Œå±äº <strong>HTTP Header</strong><br/>
ğŸ‘‰ Header æœ‰å¤§å°é™åˆ¶<br/>
ğŸ‘‰ è¶…é™ç›´æ¥æ‹’ç»è¯·æ±‚<br/>
ğŸ‘‰ è¿”å› <code>400 Bad Request</code></p>
<hr/>
<h4 data-id="heading-15">4ï¸âƒ£ è¯·æ±‚ç”šè‡³æ²¡è¿›å…¥ Spring</h4>
<p>æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">ç½‘å…³ / Tomcat Connector å±‚
<span class="hljs-code">    â†“
URL é•¿åº¦æ£€æµ‹
    â†“
è¶…é™
    â†“
ç›´æ¥è¿”å› 400
    â†“
SpringMVC / Controller å®Œå…¨æ²¡æœºä¼šæ‰§è¡Œ
</span></code></pre>
<p>æ‰€ä»¥ä½ çœ‹åˆ°çš„æ˜¯ HTML 400 é¡µé¢ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡å¼‚å¸¸ JSONã€‚</p>
<hr/>
<h3 data-id="heading-16">å››ã€ä¸ºä»€ä¹ˆä¸æ˜¯ 414 URI Too Longï¼Ÿ</h3>
<p>ç†è®ºä¸Šè¯­ä¹‰æ­£ç¡®çš„æ˜¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-number">414</span> URI Too <span class="hljs-built_in">Long</span>
</code></pre>
<p>ä½†ç°å®æ˜¯ï¼š</p>





















<table><thead><tr><th>ç»„ä»¶</th><th>è¿”å›</th></tr></thead><tbody><tr><td>Tomcat</td><td>400</td></tr><tr><td>Nginx</td><td>400</td></tr><tr><td>ç½‘å…³</td><td>400</td></tr></tbody></table>
<p>ğŸ‘‰ å®ç°å±‚é€šå¸¸ç»Ÿä¸€è¿”å› 400ï¼ˆBad Requestï¼‰</p>
<hr/>
<h3 data-id="heading-17">äº”ã€æ ¹æœ¬åŸå› æ€»ç»“ä¸€å¥è¯</h3>
<blockquote>
<p>GET çš„å‚æ•°åœ¨ URL é‡Œ<br/>
URL å±äº HTTP Header<br/>
Header æœ‰é•¿åº¦é™åˆ¶<br/>
è¶…é™ = åè®®å±‚æ‹’ç»è¯·æ±‚ = 400</p>
</blockquote>
<hr/>
<h3 data-id="heading-18">å…­ã€æ­£ç¡®è®¾è®¡æ–¹å¼ï¼ˆæ¶æ„çº§ä¿®å¤æ–¹æ¡ˆï¼‰</h3>
<h4 data-id="heading-19">âŒ é”™è¯¯è®¾è®¡</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">GET</span> <span class="hljs-operator">+</span> List å‚æ•°
<span class="hljs-keyword">GET</span> <span class="hljs-operator">+</span> DTO
<span class="hljs-keyword">GET</span> <span class="hljs-operator">+</span> æ‰¹é‡ ID
<span class="hljs-keyword">GET</span> <span class="hljs-operator">+</span> SpringQueryMap
</code></pre>
<h4 data-id="heading-20">âœ… æ­£ç¡®è®¾è®¡</h4>
<pre><code class="hljs language-css" lang="css">POST + JSON <span class="hljs-selector-tag">Body</span>
DTO æ‰¿è½½ List
æ‰¹é‡æŸ¥è¯¢ç»Ÿä¸€ POST
</code></pre>
<hr/>
<h3 data-id="heading-21">ä¸ƒã€æ­£ç¡®å®ç°æ–¹å¼</h3>
<h4 data-id="heading-22">DTO</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TagInfoByEntityIdDTO</span> {
    <span class="hljs-keyword">private</span> String tagType;
    <span class="hljs-keyword">private</span> List&lt;<span class="hljs-built_in">Long</span>&gt; entityIds;
}
</code></pre>
<hr/>
<h4 data-id="heading-23">Feign æ¥å£</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/dataTagEntityRelation/tagInfoByEntityId"</span>)
R&lt;TagInfoByEntityIdVO&gt; <span class="hljs-built_in">tagInfoByEntityId</span>(<span class="hljs-variable">@RequestBody</span> TagInfoByEntityIdDTO dto);
</code></pre>
<hr/>
<h4 data-id="heading-24">Controller</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/tagInfoByEntityId"</span>)
public R&lt;TagInfoByEntityIdVO&gt; <span class="hljs-built_in">tagInfoByEntityId</span>(<span class="hljs-variable">@RequestBody</span> TagInfoByEntityIdDTO dto) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.ok</span>(service.<span class="hljs-built_in">tagInfoByEntityId</span>(dto));
}
</code></pre>
<hr/>
<h4 data-id="heading-25">è¯·æ±‚æ ¼å¼</h4>
<pre><code class="hljs language-bash" lang="bash">POST /tagInfoByEntityId
Content-Type: application/json

{
  <span class="hljs-string">"tagType"</span>: <span class="hljs-string">"Table"</span>,
  <span class="hljs-string">"entityIds"</span>: [1,2,3,4,5,6,7,...]
}
</code></pre>
<hr/>
<h3 data-id="heading-26">å…«ã€å¯¹æ¯”æ•ˆæœ</h3>
<h4 data-id="heading-27">âŒ GETï¼ˆå¿…ç‚¸ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">GET /tagInfoByEntityId?<span class="hljs-attr">entityIds</span>=<span class="hljs-number">1</span>&amp;entityIds=<span class="hljs-number">2</span>&amp;...entityIds=<span class="hljs-number">1000</span>
</code></pre>
<h4 data-id="heading-28">âœ… POSTï¼ˆç¨³å®šï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">POST /tagInfoByEntityId
Body: JSON
</code></pre>
<hr/>
<h3 data-id="heading-29">ä¹ã€æ¥å£è®¾è®¡è§„èŒƒæ€»ç»“ï¼ˆå·¥ç¨‹çº§ç»éªŒï¼‰</h3>
<h4 data-id="heading-30">ğŸš« ç¦æ­¢è®¾è®¡</h4>
<ul>
<li>GET + æ‰¹é‡ ID</li>
<li>GET + DTO</li>
<li>GET + List</li>
<li>GET + SpringQueryMap</li>
</ul>
<h4 data-id="heading-31">âœ… æ¨èè§„èŒƒ</h4>
<ul>
<li>æŸ¥è¯¢å°å‚æ•° â†’ GET</li>
<li>æ‰¹é‡æŸ¥è¯¢ â†’ POST</li>
<li>DTO ä¼ è¾“ â†’ POST</li>
<li>List å‚æ•° â†’ POST</li>
<li>å¤æ‚å¯¹è±¡ â†’ POST</li>
</ul>
<hr/>
<h3 data-id="heading-32">åã€æ ¸å¿ƒè®¤çŸ¥å‡çº§</h3>
<blockquote>
<p>GET æ˜¯â€œå®šä½èµ„æºâ€çš„åè®®<br/>
POST æ˜¯â€œè¿è¾“æ•°æ®â€çš„åè®®</p>
</blockquote>
<p><strong>ä¸è¦ç”¨ GET è¿å¤§æ•°æ®</strong></p>
<hr/>
<h3 data-id="heading-33">åä¸€ã€ä¸€å¥è¯æ€»ç»“ï¼ˆæ˜é‡‘é‡‘å¥ç‰ˆï¼‰</h3>
<blockquote>
<p>â— GET URL è¶…é•¿å¯¼è‡´ 400ï¼Œä¸æ˜¯ Spring çš„é”…<br/>
â— ä¸æ˜¯ Feign çš„é”…<br/>
â— ä¸æ˜¯ä¸šåŠ¡é€»è¾‘çš„é”…</p>
<p>ğŸ‘‰ æ˜¯ HTTP æŠ¥æ–‡ç»“æ„ + æœåŠ¡å™¨å®ç°é™åˆ¶</p>
<p>âœ… æ‰¹é‡æ•°æ® = POST<br/>
âœ… DTO = POST<br/>
âœ… List = POST</p>
<p><strong>æ¥å£è®¾è®¡é”™äº†ï¼Œåé¢å…¨æ˜¯ç¾éš¾</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-34">åäºŒã€å·¥ç¨‹å®è·µå»ºè®®</h3>
<h4 data-id="heading-35">æ¥å£è®¾è®¡çº¢çº¿ï¼š</h4>
<pre><code class="hljs language-ini" lang="ini">çœ‹åˆ° GET + List å‚æ•° = æ¶æ„é£é™©
çœ‹åˆ° GET + <span class="hljs-attr">DTO</span> = æ¶æ„é£é™©
çœ‹åˆ° GET + æ‰¹é‡ <span class="hljs-attr">ID</span> = æ¶æ„é£é™©
</code></pre>
<hr/>
<h3 data-id="heading-36">åä¸‰ã€ç»“è¯­</h3>
<p>è¿™ç±»é—®é¢˜<strong>ä¸æ˜¯ä»£ç  bug</strong>ï¼Œæ˜¯<strong>åè®®è®¤çŸ¥é—®é¢˜</strong>ã€‚<br/>
ä¸€æ—¦ç†è§£ HTTP æŠ¥æ–‡ç»“æ„å’ŒæœåŠ¡å™¨å®ç°æœºåˆ¶ï¼Œè¿™ç±»å‘ä»¥ååŸºæœ¬ä¸ä¼šå†è¸©ã€‚</p>
<p><strong>ç³»ç»Ÿè¶Šå¤§ï¼Œè¶Šè¦éµå®ˆåè®®è®¾è®¡è§„èŒƒï¼Œè€Œä¸æ˜¯â€œèƒ½è·‘å°±è¡Œâ€ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIå…¨æ ˆç­‘åŸºï¼šReact Router DOM è·¯ç”±é…ç½®]]></title>    <link>https://juejin.cn/post/7600600904094515234</link>    <guid>https://juejin.cn/post/7600600904094515234</guid>    <pubDate>2026-01-29T09:37:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600600904094515234" data-draft-id="7600341731048161315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIå…¨æ ˆç­‘åŸºï¼šReact Router DOM è·¯ç”±é…ç½®"/> <meta itemprop="keywords" content="å‰ç«¯æ¡†æ¶,React.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-29T09:37:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§ƒå¤´æ•²ç å°å§å§"/> <meta itemprop="url" content="https://juejin.cn/user/24668014656249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIå…¨æ ˆç­‘åŸºï¼šReact Router DOM è·¯ç”±é…ç½®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/24668014656249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§ƒå¤´æ•²ç å°å§å§
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T09:37:10.000Z" title="Thu Jan 29 2026 09:37:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨AIå…¨æ ˆé¡¹ç›®çš„å¼€å‘å¾é€”ä¸­ï¼Œè·¯ç”±é…ç½®å¾€å¾€æ˜¯å‰ç«¯â€œéª¨æ¶â€æ­å»ºå®Œæˆçš„æ ‡å¿—æ€§èŠ‚ç‚¹ã€‚å½“æˆ‘ä»¬æ•²ä¸‹æœ€åä¸€è¡Œè·¯ç”±ä»£ç ï¼Œçœ‹ç€é¡¹ç›®ç›®å½•ä»æ··æ²Œèµ°å‘æ¸…æ™°ï¼Œè¿™ä¸ä»…ä»…æ˜¯åŠŸèƒ½çš„å®ç°ï¼Œæ›´æ˜¯æ¶æ„æ€ç»´çš„è½åœ°ã€‚</p>
<p>æœ€è¿‘åœ¨æ­å»ºä¸€ä¸ªåŸºäº <code>React + NestJS + AI</code> çš„å…¨æ ˆé¡¹ç›®æ—¶ï¼Œæˆ‘å¯¹å‰ç«¯è·¯ç”±æœ‰äº†æ›´æ·±å±‚æ¬¡çš„æ€è€ƒã€‚è·¯ç”±ä¸ä»…ä»…æ˜¯URLçš„æ˜ å°„ï¼Œå®ƒæ˜¯è¿æ¥ç”¨æˆ·ä¸åŠŸèƒ½çš„æ¡¥æ¢ï¼Œæ›´æ˜¯å†³å®šåº”ç”¨æ€§èƒ½ä¸å¯ç»´æŠ¤æ€§çš„æ ¸å¿ƒã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆæˆ‘åœ¨é¡¹ç›®ä¸­çš„å®é™…é…ç½®ï¼Œæ·±å…¥æ¢è®¨ React Router DOM åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­çš„æ ¸å¿ƒåº”ç”¨ã€æ˜“é”™ç‚¹ä»¥åŠä¸å…¨æ ˆæ¶æ„çš„ååŒã€‚</p>
<h3 data-id="heading-0">ğŸš¦ 1. è·¯ç”±æ¨¡å¼çš„é€‰æ‹©ï¼šHistory ä¸ Hash çš„åšå¼ˆ</h3>
<p>åœ¨é¡¹ç›®åˆå§‹åŒ–é˜¶æ®µï¼Œé€‰æ‹©åˆé€‚çš„è·¯ç”±æ¨¡å¼æ˜¯è‡³å…³é‡è¦çš„å†³ç­–ã€‚</p>
<p>ç°ä»£ React åº”ç”¨æ™®éå€¾å‘äºä½¿ç”¨ <code>BrowserRouter</code>ï¼ˆHistory æ¨¡å¼ï¼‰ã€‚å®ƒåˆ©ç”¨ HTML5 History API æä¾›äº†å¹²å‡€ã€ç¾è§‚çš„ URL ç»“æ„ï¼ˆå¦‚ <code>/home</code>ï¼‰ï¼Œç¬¦åˆ RESTful è§„èŒƒï¼Œå¯¹ SEO å‹å¥½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/App.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
      {/* è·¯ç”±å†…å®¹ */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ğŸ’¡ æ¶æ„æ€è€ƒï¼š</strong><br/>
è™½ç„¶ <code>BrowserRouter</code> çœ‹èµ·æ¥å¾ˆâ€œæ¸©æŸ”â€ï¼Œä½†å®ƒèƒŒåéšè—ç€é”‹åˆ©çš„ä¸€é¢ï¼š<strong>å®ƒè¦æ±‚æœåŠ¡å™¨ç«¯å¿…é¡»é…ç½®â€œå…œåº•â€ç­–ç•¥</strong>ã€‚<br/>
å¦‚æœä½ çš„åº”ç”¨éƒ¨ç½²åœ¨ Nginx æˆ– Node æœåŠ¡ä¸Šï¼Œå¿…é¡»ç¡®ä¿æ‰€æœ‰é API è¯·æ±‚éƒ½é‡å®šå‘åˆ° <code>index.html</code>ã€‚å¦åˆ™ï¼Œå½“ç”¨æˆ·ç›´æ¥è®¿é—® <code>/user/123</code> æ—¶ï¼Œåç«¯ä¼šå› ä¸ºæ‰¾ä¸åˆ°è¯¥è·¯å¾„è€Œè¿”å› 404ã€‚è¿™æ ‡å¿—ç€åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼Œå‰ç«¯ä¸å†æ˜¯å­¤ç«‹çš„ï¼Œè€Œæ˜¯éœ€è¦ä¸åç«¯éƒ¨ç½²ç­–ç•¥ç´§å¯†é…åˆã€‚</p>
<h3 data-id="heading-1">ğŸ—ï¸ 2. è·¯ç”±å½¢æ€çš„æ·±åº¦è§£æï¼šä»åµŒå¥—åˆ°é‰´æƒ</h3>
<p>åœ¨æ„å»ºå¤æ‚åº”ç”¨æ—¶ï¼Œå•ä¸€çš„è·¯ç”±æ¨¡å¼æ˜¾ç„¶ä¸å¤Ÿç”¨ã€‚æˆ‘ä»¬éœ€è¦æ„å»ºä¸€å¥—å±‚æ¬¡åˆ†æ˜çš„è·¯ç”±ä½“ç³»ã€‚</p>
<h4 data-id="heading-2">2.1 åµŒå¥—è·¯ç”±ï¼šä¿æŒå¸ƒå±€ä¸€è‡´æ€§</h4>
<p>åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä¸ºäº§å“æ¨¡å—é…ç½®äº†åµŒå¥—è·¯ç”±ã€‚çˆ¶ç»„ä»¶ <code>Product</code> è´Ÿè´£æ‰¿è½½å…¬å…±çš„å¯¼èˆªæ æˆ–ä¾§è¾¹æ ï¼Œè€Œå­ç»„ä»¶ï¼ˆè¯¦æƒ…é¡µã€æ–°å¢é¡µï¼‰é€šè¿‡ <code>&lt;Outlet&gt;</code> æ¸²æŸ“åœ¨æŒ‡å®šä½ç½®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/router/index.jsx</span>
{
  <span class="hljs-attr">path</span>: <span class="hljs-string">"/product"</span>,
  <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Product</span> /&gt;</span></span>, <span class="hljs-comment">// çˆ¶çº§å¸ƒå±€</span>
  <span class="hljs-attr">children</span>: [
    { <span class="hljs-attr">path</span>: <span class="hljs-string">":productId"</span>, <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductDetail</span> /&gt;</span></span> }, <span class="hljs-comment">// å­è·¯ç”±</span>
    { <span class="hljs-attr">path</span>: <span class="hljs-string">"new"</span>, <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">NewProduct</span> /&gt;</span></span> },           <span class="hljs-comment">// å­è·¯ç”±</span>
  ],
}
</code></pre>
<p>è¿™ç§æ¨¡å¼é¿å…äº†åœ¨æ¯ä¸ªå­é¡µé¢ä¸­é‡å¤ç¼–å†™ç›¸åŒçš„å¸ƒå±€ä»£ç ï¼Œæå¤§åœ°æå‡äº†ç”¨æˆ·ä½“éªŒçš„è¿è´¯æ€§ã€‚</p>
<h4 data-id="heading-3">2.2 é‰´æƒè·¯ç”±ï¼šè·¯ç”±å®ˆå«çš„å®ç°</h4>
<p>å¯¹äºæ”¯ä»˜ç­‰æ•æ„Ÿé¡µé¢ï¼Œç›´æ¥æš´éœ²æ˜¯å±é™©çš„ã€‚æˆ‘åœ¨è·¯ç”±é…ç½®ä¸­å¼•å…¥äº† <code>ProtectRoute</code> ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-attr">path</span>: <span class="hljs-string">"/pay"</span>,
  <span class="hljs-attr">element</span>: (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProtectRoute</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Pay</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ProtectRoute</span>&gt;</span></span>
  ),
}
</code></pre>
<p><strong>ğŸ’¡ æ ¸å¿ƒé€»è¾‘ï¼š</strong><br/>
<code>ProtectRoute</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ã€‚å®ƒåœ¨æ¸²æŸ“ <code>props.children</code>ï¼ˆå³ Pay ç»„ä»¶ï¼‰ä¹‹å‰ï¼Œä¼šå…ˆæ£€æŸ¥ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼ˆå¦‚æ£€æŸ¥ Tokenï¼‰ã€‚å¦‚æœæœªé€šè¿‡æ ¡éªŒï¼Œç›´æ¥é‡å®šå‘åˆ°ç™»å½•é¡µï¼›å¦‚æœé€šè¿‡ï¼Œåˆ™æ”¾è¡Œã€‚è¿™ç§å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆCross-Cutting Concernsï¼‰å‰¥ç¦»çš„æ–¹å¼ï¼Œæ˜¯ä¼ä¸šçº§åº”ç”¨çš„å¿…å¤‡æ‰‹æ®µã€‚</p>
<h3 data-id="heading-4">âš¡ 3. æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½ä¸ç”¨æˆ·ä½“éªŒ</h3>
<p>å•é¡µåº”ç”¨ï¼ˆSPAï¼‰çš„ä¸€å¤§ç—›ç‚¹æ˜¯é¦–å±ä½“ç§¯è¿‡å¤§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘é‡‡ç”¨äº†<strong>è·¯ç”±çº§ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰</strong> ã€‚</p>
<h4 data-id="heading-5">3.1 React.lazy ä¸ Suspense</h4>
<p>åˆ©ç”¨ Webpack çš„åŠ¨æ€å¯¼å…¥åŠŸèƒ½ï¼Œæˆ‘å°†ä¸åŒé¡µé¢çš„ä»£ç æ‹†åˆ†æˆç‹¬ç«‹çš„ Chunkã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/Home'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../pages/About'</span>));

<span class="hljs-comment">// åœ¨æ¸²æŸ“å±‚</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">LoadingFallback</span> /&gt;</span>}&gt;
  <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>{/* è·¯ç”±é…ç½® */}<span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
</code></pre>
<p>åªæœ‰å½“ç”¨æˆ·è®¿é—® <code>/about</code> è·¯å¾„æ—¶ï¼Œ<code>About</code> ç»„ä»¶çš„ä»£ç æ‰ä¼šè¢«åŠ¨æ€åŠ è½½ã€‚è¿™æ˜¾è‘—å‡å°äº†é¦–åŒ…ä½“ç§¯ï¼Œæå‡äº†é¦–å±æ¸²æŸ“é€Ÿåº¦ã€‚</p>
<h4 data-id="heading-6">3.2 åŠ è½½çŠ¶æ€çš„ä¼˜é›…å¤„ç†</h4>
<p><code>React.lazy</code> çš„åŠ¨æ€å¯¼å…¥æ˜¯å¼‚æ­¥çš„ï¼Œç½‘ç»œå»¶è¿Ÿä¸å¯é¿å…ã€‚å¦‚æœç›´æ¥å±•ç¤ºç™½å±ï¼Œç”¨æˆ·ä½“éªŒæå·®ã€‚</p>
<p>å› æ­¤ï¼Œ<code>&lt;Suspense fallback={&lt;LoadingFallback /&gt;}&gt;</code> çš„ä½œç”¨è‡³å…³é‡è¦ã€‚<code>LoadingFallback</code> ç»„ä»¶ï¼ˆå¦‚éª¨æ¶å±æˆ–åŠ è½½åŠ¨ç”»ï¼‰ä½œä¸ºâ€œå ä½ç¬¦â€ï¼Œåœ¨ç»„ä»¶åŠ è½½å®Œæˆå‰æä¾›è§†è§‰åé¦ˆã€‚è¿™æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å¾®å°ä½†å…³é”®çš„ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-7">ğŸš¨ 4. å®¹é”™ä¸è¾¹ç•Œå¤„ç†ï¼šNotFound çš„è‡ªåŠ¨åŒ–</h3>
<p>å¯¹äºæ— æ•ˆçš„ URLï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œå®ˆé—¨å‘˜â€ã€‚æˆ‘é…ç½®äº†é€šé…ç¬¦è·¯ç”± <code>*</code> æ¥æ•è·æ‰€æœ‰æœªåŒ¹é…çš„è¯·æ±‚ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// NotFound.jsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">NotFound</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">let</span> navigate = <span class="hljs-title function_">useNavigate</span>();
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 6ç§’åè‡ªåŠ¨è·³å›é¦–é¡µï¼Œé˜²æ­¢ç”¨æˆ·è¿·å¤±</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">navigate</span>(<span class="hljs-string">'/'</span>) }, <span class="hljs-number">6000</span>)
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;&gt;</span> 404 Not Found <span class="hljs-tag">&lt;/&gt;</span></span>
}
</code></pre>
<p>è¿™ç§è‡ªåŠ¨åŒ–çš„è·³è½¬ç­–ç•¥ï¼Œæ¯”å•çº¯å±•ç¤ºä¸€ä¸ªæ­»æ¿çš„ 404 é¡µé¢æ›´åŠ äººæ€§åŒ–ï¼Œèƒ½æœ‰æ•ˆæŒ½ç•™å› è¯¯æ“ä½œè€Œæµå¤±çš„ç”¨æˆ·ã€‚</p>
<h3 data-id="heading-8">ğŸ”® 5. ç»“è¯­ï¼šå…¨æ ˆè§†è§’ä¸‹çš„è·¯ç”±æœªæ¥</h3>
<p>è·¯ç”±é…ç½®çš„å®Œæˆï¼Œæ ‡å¿—ç€å‰ç«¯éª¨æ¶çš„æ­å»ºå®Œæ¯•ã€‚ä» <code>BrowserRouter</code> çš„éƒ¨ç½²è€ƒé‡ï¼Œåˆ° <code>ProtectRoute</code> çš„é€»è¾‘å¤ç”¨ï¼Œå†åˆ° <code>React.lazy</code> çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæ¯ä¸€ä¸ªç»†èŠ‚éƒ½ä½“ç°äº†å·¥ç¨‹åŒ–çš„æ€ç»´ã€‚</p>
<p>ç«™åœ¨è¿™ä¸ªåŸºçŸ³ä¸Šï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ°åç«¯ NestJS æ¡†æ¶çš„è½®å»“ï¼Œä»¥åŠ AI æ¨¡å‹æ¥å…¥çš„æ— é™å¯èƒ½ã€‚æœªæ¥çš„è·¯ç”±æˆ–è®¸ä¸ä»…ä»…æ˜¯é¡µé¢çš„è·³è½¬ï¼Œå®ƒå¯èƒ½ç»“åˆ AI èƒ½åŠ›ï¼Œæ ¹æ®ç”¨æˆ·çš„æ„å›¾åŠ¨æ€ç”Ÿæˆå†…å®¹æˆ–è°ƒæ•´å¯¼èˆªè·¯å¾„ã€‚</p>
<p>å…¨æ ˆä¹‹è·¯ï¼Œå§‹äºè¶³ä¸‹ï¼Œè·¯ç”±ä¸ºå¼•ï¼Œæœªæ¥å¯æœŸã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutterå­¦ä¹ ç¬”è®°â€”â€”ç¬¬äºŒç« ï¼šFlutter çŠ¶æ€ç®¡ç†å…¥é—¨]]></title>    <link>https://juejin.cn/post/7600491179499257910</link>    <guid>https://juejin.cn/post/7600491179499257910</guid>    <pubDate>2026-01-29T05:58:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600491179499257910" data-draft-id="7599511763987103798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutterå­¦ä¹ ç¬”è®°â€”â€”ç¬¬äºŒç« ï¼šFlutter çŠ¶æ€ç®¡ç†å…¥é—¨"/> <meta itemprop="keywords" content="Android,Flutter"/> <meta itemprop="datePublished" content="2026-01-29T05:58:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‚å®¿å››å—æ²³ä¸‰"/> <meta itemprop="url" content="https://juejin.cn/user/3479267728427543"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutterå­¦ä¹ ç¬”è®°â€”â€”ç¬¬äºŒç« ï¼šFlutter çŠ¶æ€ç®¡ç†å…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3479267728427543/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‚å®¿å››å—æ²³ä¸‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T05:58:35.000Z" title="Thu Jan 29 2026 05:58:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å·²ç»å­¦ä¹ Flutterä¸€æ®µæ—¶é—´å†…ï¼Œå¯èƒ½å¤§å®¶éƒ½å·²ç»é‡åˆ°è¿‡è¿™äº›å›°æƒ‘ï¼š</p>
<ul>
<li>è¿™ä¸ªå˜é‡è¯¥å†™åœ¨å“ªä¸ª Widget é‡Œï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆæ”¹äº†æ•°æ®ï¼ŒUI æ²¡åˆ·æ–°ï¼Ÿ</li>
<li>setState è¶Šå†™è¶Šä¹±ï¼Œé¡µé¢è¶Šæ¥è¶Šå¤§</li>
<li>åˆ«äººè¯´è¦ç”¨ Provider / Riverpodï¼Œä½†æˆ‘æ ¹æœ¬ä¸çŸ¥é“ä¸ºå•¥</li>
</ul>
<p><strong>è¿™ç¯‡æ–‡ç« åªå¹²ä¸€ä»¶äº‹ï¼š</strong> æŠŠã€ŒçŠ¶æ€ç®¡ç†ã€è¿™ä»¶äº‹ï¼Œç”¨å°½å¯èƒ½é€šä¿—çš„è¯­è¨€è®²æ¸…æ¥š</p>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯çŠ¶æ€ï¼ˆStateï¼‰ï¼Ÿ</h2>
<h3 data-id="heading-1">ä¸€å¥è¯å®šä¹‰</h3>
<blockquote>
<p><strong>çŠ¶æ€ = ä¼šå½±å“ UI æ˜¾ç¤ºã€å¹¶ä¸”å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æ•°æ®</strong></p>
</blockquote>
<h3 data-id="heading-2">å¸¸è§çŠ¶æ€ä¸¾ä¾‹</h3>
<ul>
<li>è®¡æ•°å™¨é‡Œçš„ <code>count</code></li>
<li>æ˜¯å¦ loading</li>
<li>åˆ—è¡¨æ•°æ®</li>
<li>æ˜¯å¦ç™»å½•</li>
<li>Tab å½“å‰é€‰ä¸­é¡¹</li>
<li>è¡¨å•è¾“å…¥å†…å®¹</li>
</ul>
<p><strong>ä¸€å¥è¯åˆ¤æ–­ï¼š</strong></p>
<blockquote>
<p>ğŸ‘‰ æ”¹äº†è¿™ä¸ªå˜é‡ï¼ŒUI è¦ä¸è¦è·Ÿç€å˜ï¼Ÿ<br/>
ğŸ‘‰ è¦ â†’ å®ƒå°±æ˜¯çŠ¶æ€</p>
</blockquote>
<p><strong>è¡¥å……ä¸¤ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li>æœ‰äº›â€œä¸ä¼šå˜â€çš„æ•°æ®ä¹Ÿä¼šå½±å“ UIï¼ˆæ¯”å¦‚é™æ€é…ç½®ï¼‰ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¸æŠŠå®ƒä»¬å«â€œçŠ¶æ€â€ï¼Œè€Œæ˜¯æŠŠâ€œä¼šå˜åŒ–â€çš„é‚£éƒ¨åˆ†æŠ½å‡ºæ¥ä½œä¸ºçŠ¶æ€ã€‚</li>
<li>çŠ¶æ€ä¸ä»…å¯ä»¥æ˜¯ç®€å•å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€æ•´ä¸ªå¯¹è±¡ï¼ˆæ¯”å¦‚Â <code>User</code>ã€<code>Cart</code>ï¼‰ç”šè‡³ä¸€ä¸ªåˆ—è¡¨ã€Mapã€‚</li>
</ul>
<h2 data-id="heading-3">äºŒã€ä¸ºä»€ä¹ˆ Flutter ä¸€å®šè¦â€œç®¡ç†çŠ¶æ€â€ï¼Ÿ</h2>
<p>Flutter æ˜¯<strong>å£°æ˜å¼ UI</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">UI</span> = f(state)
</code></pre>
<p>æ„æ€æ˜¯ï¼š</p>
<ul>
<li>UI <strong>å®Œå…¨ç”±çŠ¶æ€å†³å®šï¼ˆè¿™é‡Œæ’é™¤ç³»ç»Ÿä¸»é¢˜ã€è¯­è¨€åˆ‡æ¢ã€å±å¹•å°ºå¯¸å˜åŒ–ï¼‰</strong></li>
<li>çŠ¶æ€ä¸€å˜ â†’ UI é‡æ–°æè¿°ï¼ˆbuildï¼‰</li>
</ul>
<p>ğŸ‘‰ <strong>Flutter ä¸å…³å¿ƒä½ æ€ä¹ˆæ”¹çŠ¶æ€ï¼Œåªå…³å¿ƒä½ æœ‰æ²¡æœ‰å‘Šè¯‰å®ƒï¼šæˆ‘å˜äº†</strong></p>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€æœ€åŸºç¡€çš„çŠ¶æ€ç®¡ç†ï¼šsetState</h2>
<h3 data-id="heading-5">1ï¸âƒ£ æœ€ç®€å•çš„è®¡æ•°å™¨</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  const <span class="hljs-type">Counter</span>({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">State</span>&lt;<span class="hljs-type">Counter</span>&gt; createState() =&gt; _CounterState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CounterState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State&lt;Counter&gt;</span> </span>{
  int count = <span class="hljs-number">0</span>;

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">Column</span>(
      children: [
        <span class="hljs-type">Text</span>('å½“å‰å€¼ï¼š$count'),
        <span class="hljs-type">ElevatedButton</span>(
          onPressed: () {
            setState(() {
              count++;
            });
          },
          child: const <span class="hljs-type">Text</span>('åŠ  <span class="hljs-number">1</span>'),
        ),
      ],
    );
  }
}
</code></pre>
<p>ä½†çœŸå®é¡¹ç›®çš„é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p>ğŸ‘‰ è¿™ä¸ª <code>count</code> åº”è¯¥æ”¾åœ¨è¿™é‡Œå—ï¼Ÿ</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">å››ã€çŠ¶æ€åˆ°åº•è¯¥æ”¾å“ªï¼Ÿï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰</h2>
<h3 data-id="heading-7">è®°ä½è¿™ä¸€æ¡åŸºæœ¬åŸåˆ™ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<blockquote>
<p><strong>çŠ¶æ€åº”è¯¥æ”¾åœ¨â€œæœ€å°ä½†è¶³å¤Ÿâ€çš„ Widget é‡Œ</strong></p>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªä¾‹å­</p>
<h3 data-id="heading-8">é”™è¯¯ç¤ºä¾‹ 1ï¼šçŠ¶æ€æ”¾å¤ªé«˜ï¼ˆæ–°æ‰‹æœ€å¸¸çŠ¯ï¼‰</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  const <span class="hljs-type">HomePage</span>({<span class="hljs-keyword">super</span>.key});
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">State</span>&lt;<span class="hljs-type">HomePage</span>&gt; createState() =&gt; _HomePageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State&lt;HomePage&gt;</span> </span>{
  int count = <span class="hljs-number">0</span>;

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">Column</span>(
      children: [
        <span class="hljs-type">Header</span>(),
        <span class="hljs-type">Text</span>('count: $count'),
        <span class="hljs-type">Footer</span>(
          onAdd: () {
            setState(() {
              count++;
            });
          },
        ),
      ],
    );
  }
}
</code></pre>
<p>âŒ é—®é¢˜ï¼š</p>
<ul>
<li>Headerã€Footer æ˜æ˜ä¸å…³å¿ƒÂ <code>count</code>ï¼Œå´è·Ÿç€ä¸€èµ·é‡å»ºï¼ˆæ²¡å¿…è¦ï¼‰ã€‚</li>
<li>é¡µé¢é€»è¾‘å’ŒçŠ¶æ€éƒ½å †åœ¨æœ€é¡¶å±‚ï¼Œè¶Šå†™è¶Šéš¾ç»´æŠ¤ã€‚</li>
<li>åœ¨å¤æ‚é¡µé¢é‡Œï¼Œè¿™ç§â€œçŠ¶æ€æ”¾å¤ªé«˜â€çš„å†™æ³•ï¼Œå¯èƒ½å¸¦æ¥ä¸å¿…è¦çš„é‡å»ºå’Œæ€§èƒ½å¼€é”€ï¼ˆæœ¬ä¾‹æ¯”è¾ƒç®€å•ï¼Œæ€§èƒ½å·®è·æå°ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-9">è§£å†³æ–¹æ¡ˆï¼šæŠŠçŠ¶æ€äº¤ç»™çœŸæ­£éœ€è¦å®ƒçš„ç»„ä»¶ï¼ŒçŠ¶æ€ä¸‹æ²‰ï¼ˆå±€éƒ¨ Statefulï¼‰</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  const <span class="hljs-type">Counter</span>({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">State</span>&lt;<span class="hljs-type">Counter</span>&gt; createState() =&gt; _CounterState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CounterState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State&lt;Counter&gt;</span> </span>{
  int count = <span class="hljs-number">0</span>;

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">Row</span>(
      children: [
        <span class="hljs-type">Text</span>('$count'),
        <span class="hljs-type">IconButton</span>(
          icon: const <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.add),
          onPressed: () {
            setState(() {
              count++;
            });
          },
        ),
      ],
    );
  }
}
</code></pre>
<p>ç„¶ååœ¨é¡µé¢ä¸­ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Column</span>(
  children: const [
    Header(),
    <span class="hljs-built_in">Counter</span>(),
    <span class="hljs-selector-tag">Footer</span>(),
  ],
)
</code></pre>
<p>ğŸ‘‰ <strong>è°ç”¨çŠ¶æ€ï¼ŒçŠ¶æ€å°±æ”¾è°é‚£</strong></p>
<hr/>
<h3 data-id="heading-10">é—®é¢˜æ¥äº†ï¼šå¤šä¸ª Widget è¦ç”¨åŒä¸€ä¸ªçŠ¶æ€æ€ä¹ˆåŠï¼Ÿ</h3>
<p>åœºæ™¯ï¼šå•†å“æ•°é‡ + æ€»ä»·</p>
<pre><code class="hljs language-css" lang="css">å•†å“æ•°é‡   <span class="hljs-selector-attr">[+  -]</span>
æ€»ä»·ï¼šÂ¥ <span class="hljs-number">300</span>
</code></pre>
<p>ğŸ‘‰ æ•°é‡å’Œæ€»ä»· <strong>éƒ½ä¾èµ– count</strong></p>
<h3 data-id="heading-11">çŠ¶æ€æå‡ï¼ˆState Liftingï¼‰â€”â€” éå¸¸é‡è¦çš„æ€æƒ³</h3>
<p>æ ¸å¿ƒæ€æƒ³</p>
<blockquote>
<p><strong>å¤šä¸ªå­ç»„ä»¶å…±äº«çŠ¶æ€ â†’ çŠ¶æ€æå‡åˆ°å®ƒä»¬çš„æœ€è¿‘å…¬å…±çˆ¶ç»„ä»¶</strong></p>
</blockquote>
<h3 data-id="heading-12">ç¤ºä¾‹</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CartPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">State</span>&lt;<span class="hljs-type">CartPage</span>&gt; createState() =&gt; _CartPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CartPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State&lt;CartPage&gt;</span> </span>{
  int count = <span class="hljs-number">1</span>;

  void increment() {
    setState(() {
      count++;
    });
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">Column</span>(
      children: [
        <span class="hljs-type">Counter</span>(count: count, onAdd: increment),
        <span class="hljs-type">TotalPrice</span>(count: count),
      ],
    );
  }
}
</code></pre>
<p>å­ç»„ä»¶å˜æˆ <strong>çº¯å±•ç¤ºç»„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> int count;
  <span class="hljs-keyword">final</span> <span class="hljs-type">VoidCallback</span> onAdd;

  const <span class="hljs-type">Counter</span>({
    <span class="hljs-keyword">super</span>.key,
    required <span class="hljs-keyword">this</span>.count,
    required <span class="hljs-keyword">this</span>.onAdd,
  });

  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">return</span> <span class="hljs-type">Row</span>(
      children: [
        <span class="hljs-type">Text</span>('$count'),
        <span class="hljs-type">IconButton</span>(onPressed: onAdd, icon: <span class="hljs-type">Icon</span>(<span class="hljs-type">Icons</span>.add)),
      ],
    );
  }
}
</code></pre>
<p>ğŸ‘‰ <strong>çˆ¶ç®¡çŠ¶æ€ï¼Œå­ç®¡å±•ç¤º</strong></p>
<hr/>
<h2 data-id="heading-13">äº”ã€ä»€ä¹ˆæ—¶å€™ setState å¼€å§‹ä¸å¤Ÿç”¨äº†ï¼Ÿ</h2>
<h3 data-id="heading-14">å‡ºç°è¿™äº›ä¿¡å·ï¼Œå°±è¯¥è­¦æƒ•äº†ï¼š</h3>
<ul>
<li>çŠ¶æ€åœ¨å¤šä¸ªé¡µé¢ç”¨</li>
<li>éœ€è¦è·¨è·¯ç”±è®¿é—®çŠ¶æ€</li>
<li>å‚æ•°ä¸€å±‚ä¸€å±‚å¾€ä¸‹ä¼ ï¼ˆprops drillingï¼‰</li>
<li>ä¸€ä¸ªé¡µé¢å‡ åä¸ª setState</li>
</ul>
<pre><code class="hljs language-css" lang="css">Home
 â””â”€ <span class="hljs-selector-tag">A</span>
    â””â”€ <span class="hljs-selector-tag">B</span>
       â””â”€ C
          â””â”€ Dï¼ˆè¦ç”¨çŠ¶æ€ï¼‰
</code></pre>
<p>ğŸ‘‰ ä½ ä¼šå¼€å§‹è§‰å¾— <strong>â€œä¼ å‚æ•°å¥½çƒ¦â€</strong>ï¼Œè¿™ä¸ªé—®é¢˜è‚¯å®šå›°æ‰°æˆ‘ç­‰å°ç™½ï¼Œåˆ«ç€æ€¥ï¼Œæ¥ç€çœ‹ã€‚</p>
<hr/>
<h2 data-id="heading-15">å…­ã€çŠ¶æ€çš„ä¸‰ç§å¸¸è§å±‚çº§ï¼ˆä¸€å®šè¦åˆ†æ¸…ï¼‰</h2>
<h3 data-id="heading-16">1ï¸âƒ£ UI çŠ¶æ€ï¼ˆæœ€ç®€å•ï¼‰</h3>
<ul>
<li>é€šå¸¸æŒ‡â€œåªè·ŸæŸä¸ªå°éƒ¨ä»¶ç›¸å…³çš„ã€çŸ­ç”Ÿå‘½å‘¨æœŸâ€çš„çŠ¶æ€ï¼Œ</li>
<li>æ¯”å¦‚ï¼š
<ul>
<li>åˆ—è¡¨å±•å¼€/æ”¶èµ·ã€</li>
<li>å½“å‰é€‰ä¸­çš„ tab indexã€</li>
<li>ä¸€ä¸ªæŒ‰é’®çš„ loading çŠ¶æ€ã€‚</li>
<li>åˆ‡æ¢æŒ‰é’®</li>
</ul>
</li>
</ul>
<p>ğŸ‘‰ <strong>setState è¶³å¤Ÿ</strong></p>
<hr/>
<h3 data-id="heading-17">2ï¸âƒ£ é¡µé¢çŠ¶æ€</h3>
<p>å¦‚æœåªæ˜¯è¿™ä¸ªé¡µé¢è‡ªå·±ç”¨ï¼Œæ”¾åœ¨è¿™ä¸ªé¡µé¢çš„Â <code>State</code>Â é‡Œå°±å¤Ÿäº†ã€‚ å¦‚æœé¡µé¢æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥æŠŠçŠ¶æ€å’Œé€»è¾‘æŠ½åˆ°ä¸€ä¸ªÂ <code>ChangeNotifier</code>Â æˆ–ç‹¬ç«‹çš„ç±»é‡Œï¼Œå†é€šè¿‡ Provider ç­‰æ–¹å¼æä¾›ç»™è¿™ä¸ªé¡µé¢ã€‚</p>
<ul>
<li>åˆ—è¡¨æ•°æ®</li>
<li>è¯·æ±‚ç»“æœ</li>
<li>è¡¨å•å†…å®¹</li>
</ul>
<p>ğŸ‘‰ <strong>setState / FutureBuilder / ValueNotifier</strong></p>
<hr/>
<h3 data-id="heading-18">3ï¸âƒ£ å…¨å±€çŠ¶æ€</h3>
<ul>
<li>ç™»å½•ç”¨æˆ·ä¿¡æ¯</li>
<li>ä¸»é¢˜æ¨¡å¼</li>
<li>è´­ç‰©è½¦æ•°é‡</li>
</ul>
<p>ğŸ‘‰ <strong>çŠ¶æ€ç®¡ç†åº“ç™»åœº</strong></p>
<hr/>

























<table><thead><tr><th><strong>çŠ¶æ€ç±»å‹</strong></th><th><strong>ä¸¾ä¾‹</strong></th><th><strong>å¤„ç†ç­–ç•¥</strong></th></tr></thead><tbody><tr><td><strong>UI çŠ¶æ€</strong></td><td>åŠ è½½ä¸­ï¼ˆLoadingï¼‰ã€é”™è¯¯æç¤º</td><td>ç•™åœ¨å½“å‰ Widget å†…éƒ¨å¤„ç†ã€‚</td></tr><tr><td><strong>é¡µé¢çŠ¶æ€</strong></td><td>è¯¦æƒ…é¡µæ•°æ®ã€åˆ—è¡¨æ•°æ®ã€è¡¨å•å†…å®¹</td><td>æ”¾åœ¨ <code>StatefulWidget</code> æˆ–<code>ChangeNotifier</code>ä¸­ã€‚</td></tr><tr><td><strong>å…¨å±€çŠ¶æ€</strong></td><td>ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€ä¸»é¢˜ã€è¯­è¨€</td><td>æ”¾åœ¨é¡¶å±‚ï¼Œé€šè¿‡ <code>InheritedWidget</code> å…±äº«ã€‚æˆ–å„ç§ç¬¬ä¸‰æ–¹çŠ¶æ€åº“</td></tr></tbody></table>
<h2 data-id="heading-19">ä¸ƒã€ä¸€ä¸ªâ€œä¸­é—´æ€â€çš„å¥½å·¥å…·ï¼šValueNotifier</h2>
<p>åœ¨ä½ è¿˜æ²¡ç”¨ Provider ä¹‹å‰ï¼Œ<strong>å®ƒéå¸¸å¥½ç”¨</strong>ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">final <span class="hljs-attr">counter</span> = ValueNotifier&lt;int&gt;(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">ValueListenableBuilder&lt;<span class="hljs-built_in">int</span>&gt;(
  valueListenable: counter,
  builder: (context, value, child) {
    <span class="hljs-keyword">return</span> Text(<span class="hljs-string">'<span class="hljs-subst">$value</span>'</span>);
  },
);
</code></pre>
<p>æ›´æ–°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">counter.value++<span class="hljs-comment">;</span>
</code></pre>
<p>ğŸ‘‰ ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸ç”¨ setState</li>
<li>è‡ªåŠ¨å±€éƒ¨åˆ·æ–°</li>
<li>éå¸¸è½»é‡</li>
</ul>
<p>ğŸ‘‰ ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ç®€å•è®¡æ•°å™¨ã€å¼€å…³ï¼ˆswitchï¼‰ã€å½“å‰ index ç­‰ï¼›</li>
<li>åœ¨ä¸æƒ³å¼•å…¥æ•´ä¸ªçŠ¶æ€ç®¡ç†åº“æ—¶ï¼Œåš<strong>å±€éƒ¨å“åº”å¼æ›´æ–°</strong>ï¼›</li>
<li>å¸¸è§äºÂ <code>TextEditingController</code>Â å†…éƒ¨å°±æ˜¯ç”¨Â <code>ValueNotifier</code>Â å®ç°çš„ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-20">å…«ã€ ä»€ä¹ˆæ—¶å€™ä½ éœ€è¦ Provider / Riverpodï¼Ÿ</h2>
<p>å¾ˆå¤šäººä¸€ä¸Šæ‰‹å°±ç”¨ Providerï¼Œå…¶å®å¹¶ä¸ä¸€å®šç†è§£å®ƒè§£å†³äº†ä»€ä¹ˆã€‚
å®ƒæä¾›äº†ä¸¤ä¸ªæ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ol>
<li><strong>ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰</strong> ï¼šè®©ä»»ä½•å­èŠ‚ç‚¹éƒ½èƒ½é€šè¿‡ <code>context.read&lt;T&gt;()</code> æ‹¿åˆ°æ•°æ®ï¼Œä¸ç”¨ä¸€å±‚å±‚ä¼ å‚æ•°ã€‚</li>
<li><strong>ç²¾å‡†é€šçŸ¥</strong>ï¼šåªæœ‰ç›‘å¬äº†ç‰¹å®šæ•°æ®çš„ç»„ä»¶æ‰ä¼šåˆ·æ–°ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚</li>
</ol>
<blockquote>
<p><strong>å®ƒä»¬è§£å†³çš„æ˜¯â€œçŠ¶æ€çš„å­˜æ”¾ä½ç½®â€å’Œâ€œè®¿é—®æ–¹å¼â€é—®é¢˜</strong></p>
</blockquote>
<h3 data-id="heading-21">é‚£setState è§£å†³ä¸äº†ä»€ä¹ˆï¼Ÿ</h3>
<ol>
<li><strong>è·¨é¡µé¢åŒæ­¥</strong>ï¼šä½ åœ¨ä¸ªäººä¸­å¿ƒTabé¡µæ”¹äº†å¤´åƒï¼Œè¿”å›é¦–é¡µTabé¡µå‘ç°å¤´åƒæ²¡å˜ã€‚</li>
<li><strong>æ·±å±‚åµŒå¥—ï¼ˆProp Drillingï¼‰</strong> ï¼šå¦‚æœä½ æƒ³æŠŠä¸€ä¸ªæ•°æ®ä¼ ç»™ç¬¬ 10 å±‚å­ç»„ä»¶ï¼Œä½ ä¸å¾—ä¸åƒæ¥åŠ›æ£’ä¸€æ ·ç©¿é€ä¸­é—´ 9 å±‚ç»„ä»¶ã€‚</li>
<li><strong>é€»è¾‘ä¸ UI è€¦åˆ</strong>ï¼šä¸šåŠ¡é€»è¾‘å…¨å †åœ¨ <code>State</code> ç±»é‡Œï¼Œéš¾ä»¥å†™å•å…ƒæµ‹è¯•ã€‚</li>
<li><strong>å†…å­˜ç®¡ç†</strong>ï¼š<code>setState</code> çš„æ•°æ®éš Widget é”€æ¯è€Œæ¶ˆå¤±ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦çŠ¶æ€åœ¨é¡µé¢å…³é—­åä¾ç„¶å­˜æ´»ï¼ˆå•ä¾‹æ€ç»´ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-22">ç®€å•ç†è§£</h3>
<ul>
<li><code>setState</code>ï¼šé€‚åˆ<strong>å±€éƒ¨ã€çŸ­ç”Ÿå‘½å‘¨æœŸ</strong>çš„ UI çŠ¶æ€ç®¡ç†ï¼›</li>
<li><code>Provider / Riverpod</code>ï¼šé€‚åˆ<strong>è·¨é¡µé¢ã€å¤æ‚ä¸šåŠ¡ã€è§£è€¦å’Œæµ‹è¯•</strong>åœºæ™¯ã€‚</li>
</ul>
<h3 data-id="heading-23">å½“ä½ é‡åˆ°ä»¥ä¸‹é—®é¢˜æ—¶ï¼Œå°±åº”è¯¥è€ƒè™‘çŠ¶æ€ç®¡ç†åº“äº†ï¼š</h3>
<ul>
<li><strong>å¤šé¡µé¢å…±äº«æ•°æ®</strong>ï¼ˆå¦‚è´­ç‰©è½¦ã€ç™»å½•é¡µå…±äº«ä¸€ä»½æ•°æ®ï¼Œéœ€è¦åŒæ­¥åˆ·æ–°UIï¼‰ã€‚</li>
<li><strong>ä¼ é€’å±‚çº§å¤ªæ·±ï¼ˆéœ€è¦è§£è€¦ï¼‰</strong>ï¼šå½“ä½ çš„ <code>StatefulWidget</code> è¶…è¿‡ 500 è¡Œï¼Œä¸”é€»è¾‘å¤æ‚æ—¶ã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–ï¼ˆStatefulWidget è‡ƒè‚¿ï¼‰</strong>ï¼šé€šè¿‡ <code>Consumer</code> å®ç°çœŸæ­£çš„å±€éƒ¨åˆ·æ–°ï¼Œé¿å…çˆ¶ç»„ä»¶é‡å»ºå¸¦åŠ¨å­ç»„ä»¶ã€‚</li>
</ul>
<p>ä¸ç®¡ç”¨ä¸ç”¨çŠ¶æ€åº“ï¼Œåº•å±‚éƒ½æ˜¯åœ¨ã€ŒæŸä¸ªçŠ¶æ€å˜åŒ–æ—¶ï¼Œè§¦å‘ç‰¹å®š Widget é‡å»ºã€ã€‚<br/>
<code>setState</code>Â æ˜¯æ‰‹åŠ¨æ ‡è®°è‡ªå·±å˜è„ï¼›<br/>
Provider / Riverpod åˆ™æ˜¯æ›´æ™ºèƒ½åœ°å¸®ä½ åšâ€œè°éœ€è¦è¢«é€šçŸ¥ã€å¦‚ä½•æ‰¾åˆ°é‚£æ£µå­æ ‘â€çš„äº‹æƒ…ã€‚</p>
<p>åé¢çš„æ–‡ç« ï¼Œæˆ‘å°†å­¦ä¹ â€œProvider/Riverpodâ€çŠ¶æ€åº“ï¼Œæ›´åŠ æ·»åŠ ä¸­å¤§å‹é¡¹ç›®çš„å®æˆ˜ã€‚</p>
<h2 data-id="heading-24">ä¹ã€ä½ ç°åœ¨åº”è¯¥æ€ä¹ˆé€‰ï¼Ÿï¼ˆå®ç”¨å»ºè®®ï¼‰</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å•ä¸ª Widget</td><td>setState</td></tr><tr><td>çˆ¶å­é€šä¿¡</td><td>çŠ¶æ€æå‡</td></tr><tr><td>å±€éƒ¨å“åº”</td><td>ValueNotifier</td></tr><tr><td>è·¨é¡µé¢ / å…¨å±€</td><td>Provider / Riverpod</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-25">åã€è®°å¿†ç‚¹æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰</h2>
<ul>
<li>çŠ¶æ€ = ä¼šå½±å“ UI çš„æ•°æ®</li>
<li>è°ç”¨çŠ¶æ€ï¼ŒçŠ¶æ€æ”¾è°</li>
<li>å¤šä¸ª Widget ç”¨ â†’ çŠ¶æ€æå‡</li>
<li>setState ä¸å¯æ€•ï¼Œä¹±ç”¨æ‰å¯æ€•</li>
<li>å…ˆææ¸…â€œæ”¾å“ªâ€ï¼Œå†é€‰â€œç”¨å•¥åº“â€</li>
</ul>
<h2 data-id="heading-26">åä¸€ã€å†™åœ¨æœ€å</h2>
<p>â€œçŠ¶æ€ç®¡ç†â€æ˜¯ Flutter ä¸­æœ€å®¹æ˜“è®©äººä¸€å¼€å§‹ç„¦è™‘çš„éƒ¨åˆ†ï¼Œä½†ç»å¤§å¤šæ•° App çš„å‘å±•è¿‡ç¨‹éƒ½æ˜¯ï¼š<br/>
<code>setState â†’ çŠ¶æ€æå‡ â†’ æŠ½é€»è¾‘ç±» â†’ ç®€å•çŠ¶æ€åº“ â†’ å¤æ‚çŠ¶æ€åº“</code><br/>
ä½ ä¸éœ€è¦ä¸€ä¸Šæ¥å°±å®Œå…¨ææ‡‚æ‰€æœ‰åº“ï¼Œåªè¦å…ˆå†™æ¸…æ¥šâ€œçŠ¶æ€æ”¾å“ªâ€ï¼Œå†æ…¢æ…¢å­¦ä¼šâ€œæ€ä¹ˆè®©å®ƒæ›´å¥½ç»´æŠ¤â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BSBacktraceLoggeræºç è§£æ]]></title>    <link>https://juejin.cn/post/7600342201794297871</link>    <guid>https://juejin.cn/post/7600342201794297871</guid>    <pubDate>2026-01-29T06:55:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600342201794297871" data-draft-id="7600345782173532194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BSBacktraceLoggeræºç è§£æ"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-01-29T06:55:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOSåœ¨å…¥é—¨"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426627758"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BSBacktraceLoggeræºç è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426627758/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOSåœ¨å…¥é—¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T06:55:13.000Z" title="Thu Jan 29 2026 06:55:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å€ŸåŠ©AIè¾…åŠ©ã€‚</p>
</blockquote>
<h2 data-id="heading-0">æºç åœ°å€</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbestswifter%2FBSBacktraceLogger" target="_blank" title="https://github.com/bestswifter/BSBacktraceLogger" ref="nofollow noopener noreferrer">github.com/bestswifterâ€¦</a></p>
<h2 data-id="heading-1">é€è¡Œæ³¨é‡Š</h2>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  BSBacktraceLogger.m</span>
<span class="hljs-comment">//  BSBacktraceLogger</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Created by å¼ æ˜Ÿå®‡ on 16/8/27.</span>
<span class="hljs-comment">//  Copyright Â© 2016å¹´ bestswifter. All rights reserved.</span>
<span class="hljs-comment">//</span>

<span class="hljs-comment">// å¯¼å…¥è‡ªå®šä¹‰å¤´æ–‡ä»¶</span>
<span class="hljs-meta">#import <span class="hljs-string">"BSBacktraceLogger.h"</span></span>
<span class="hljs-comment">// å¯¼å…¥Machå†…æ ¸ç›¸å…³å¤´æ–‡ä»¶ï¼Œç”¨äºçº¿ç¨‹æ“ä½œ</span>
<span class="hljs-meta">#import <span class="hljs-string">&lt;mach/mach.h&gt;</span></span>
<span class="hljs-comment">// åŠ¨æ€é“¾æ¥åº“ç›¸å…³å‡½æ•°ï¼Œç”¨äºç¬¦å·è§£æ</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;dlfcn.h&gt;</span></span>
<span class="hljs-comment">// POSIXçº¿ç¨‹åº“</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-comment">// ç³»ç»Ÿç±»å‹å®šä¹‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-comment">// é™åˆ¶å€¼å®šä¹‰ï¼ˆå¦‚ULONG_MAXç­‰ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;limits.h&gt;</span></span>
<span class="hljs-comment">// å­—ç¬¦ä¸²æ“ä½œå‡½æ•°</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-comment">// åŠ¨æ€é“¾æ¥å™¨ç›¸å…³ï¼Œç”¨äºè·å–é•œåƒä¿¡æ¯</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mach-o/dyld.h&gt;</span></span>
<span class="hljs-comment">// Mach-Oç¬¦å·è¡¨ç»“æ„å®šä¹‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mach-o/nlist.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark DEFINE MACRO FOR DIFFERENT CPU ARCHITECTURE</span>
<span class="hljs-comment">// é’ˆå¯¹ä¸åŒCPUæ¶æ„å®šä¹‰ç›¸åº”çš„å®ï¼Œä»¥é€‚é…ä¸åŒç¡¬ä»¶å¹³å°</span>

<span class="hljs-comment">// ARM64æ¶æ„ï¼ˆ64ä½ARMï¼Œå¦‚iPhone 5såŠä»¥åçš„è®¾å¤‡ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(__arm64__)</span>
<span class="hljs-comment">// å»é™¤æŒ‡ä»¤åœ°å€çš„æ ‡ç­¾ä½ï¼ˆARM64ä¸­ä½2ä½å¯èƒ½è¢«ç”¨ä½œæ ‡ç­¾ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DETAG_INSTRUCTION_ADDRESS(A) ((A) &amp; ~(3UL))</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç»“æ„ä½“çš„å¤§å°</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE_COUNT ARM_THREAD_STATE64_COUNT</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç±»å‹</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE ARM_THREAD_STATE64</span>
<span class="hljs-comment">// å¸§æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆFrame Pointerï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_FRAME_POINTER __fp</span>
<span class="hljs-comment">// æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆStack Pointerï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_STACK_POINTER __sp</span>
<span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨/æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆProgram Counterï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_INSTRUCTION_ADDRESS __pc</span>

<span class="hljs-comment">// ARM32æ¶æ„ï¼ˆ32ä½ARMï¼Œæ—§è®¾å¤‡ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">elif</span> defined(__arm__)</span>
<span class="hljs-comment">// å»é™¤æŒ‡ä»¤åœ°å€çš„æ ‡ç­¾ä½ï¼ˆARM32ä¸­ä½1ä½å¯èƒ½è¡¨ç¤ºThumbæ¨¡å¼ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DETAG_INSTRUCTION_ADDRESS(A) ((A) &amp; ~(1UL))</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç»“æ„ä½“çš„å¤§å°</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE_COUNT ARM_THREAD_STATE_COUNT</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç±»å‹</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE ARM_THREAD_STATE</span>
<span class="hljs-comment">// å¸§æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆr7å¯„å­˜å™¨ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_FRAME_POINTER __r[7]</span>
<span class="hljs-comment">// æ ˆæŒ‡é’ˆå¯„å­˜å™¨</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_STACK_POINTER __sp</span>
<span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨å¯„å­˜å™¨</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_INSTRUCTION_ADDRESS __pc</span>

<span class="hljs-comment">// x86_64æ¶æ„ï¼ˆ64ä½Intelï¼Œæ¨¡æ‹Ÿå™¨æˆ–Macï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">elif</span> defined(__x86_64__)</span>
<span class="hljs-comment">// x86æ¶æ„ä¸éœ€è¦å»æ ‡ç­¾ï¼Œç›´æ¥è¿”å›åœ°å€</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DETAG_INSTRUCTION_ADDRESS(A) (A)</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç»“æ„ä½“çš„å¤§å°</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE_COUNT x86_THREAD_STATE64_COUNT</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç±»å‹</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE x86_THREAD_STATE64</span>
<span class="hljs-comment">// å¸§æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆBase Pointerï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_FRAME_POINTER __rbp</span>
<span class="hljs-comment">// æ ˆæŒ‡é’ˆå¯„å­˜å™¨</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_STACK_POINTER __rsp</span>
<span class="hljs-comment">// æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼ˆInstruction Pointerï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_INSTRUCTION_ADDRESS __rip</span>

<span class="hljs-comment">// i386æ¶æ„ï¼ˆ32ä½Intelï¼Œæ—§æ¨¡æ‹Ÿå™¨ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">elif</span> defined(__i386__)</span>
<span class="hljs-comment">// x86æ¶æ„ä¸éœ€è¦å»æ ‡ç­¾</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> DETAG_INSTRUCTION_ADDRESS(A) (A)</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç»“æ„ä½“çš„å¤§å°</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE_COUNT x86_THREAD_STATE32_COUNT</span>
<span class="hljs-comment">// çº¿ç¨‹çŠ¶æ€ç±»å‹</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_THREAD_STATE x86_THREAD_STATE32</span>
<span class="hljs-comment">// å¸§æŒ‡é’ˆå¯„å­˜å™¨</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_FRAME_POINTER __ebp</span>
<span class="hljs-comment">// æ ˆæŒ‡é’ˆå¯„å­˜å™¨</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_STACK_POINTER __esp</span>
<span class="hljs-comment">// æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_INSTRUCTION_ADDRESS __eip</span>

<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-comment">// ä»è¿”å›åœ°å€è®¡ç®—è°ƒç”¨æŒ‡ä»¤åœ°å€ï¼ˆè¿”å›åœ°å€-1å³ä¸ºè°ƒç”¨æŒ‡ä»¤ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> CALL_INSTRUCTION_FROM_RETURN_ADDRESS(A) (DETAG_INSTRUCTION_ADDRESS((A)) - 1)</span>

<span class="hljs-comment">// æ ¹æ®æŒ‡é’ˆå¤§å°ï¼ˆ32ä½æˆ–64ä½ï¼‰å®šä¹‰ä¸åŒçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</span>
<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(__LP64__)</span>
<span class="hljs-comment">// 64ä½ç³»ç»Ÿçš„æ ¼å¼å®šä¹‰</span>
<span class="hljs-comment">// å †æ ˆè·Ÿè¸ªæ¡ç›®æ ¼å¼ï¼šåºå·(4ä½) æ¨¡å—å(31ä½) åœ°å€(16ä½åå…­è¿›åˆ¶) ç¬¦å·å + åç§»é‡</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TRACE_FMT         <span class="hljs-string">"%-4d%-31s 0x%016lx %s + %lu"</span></span>
<span class="hljs-comment">// æŒ‡é’ˆå®Œæ•´æ ¼å¼ï¼ˆ16ä½åå…­è¿›åˆ¶ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> POINTER_FMT       <span class="hljs-string">"0x%016lx"</span></span>
<span class="hljs-comment">// æŒ‡é’ˆçŸ­æ ¼å¼</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> POINTER_SHORT_FMT <span class="hljs-string">"0x%lx"</span></span>
<span class="hljs-comment">// ç¬¦å·è¡¨ç»“æ„ä½“ç±»å‹ï¼ˆ64ä½ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_NLIST struct nlist_64</span>
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
<span class="hljs-comment">// 32ä½ç³»ç»Ÿçš„æ ¼å¼å®šä¹‰</span>
<span class="hljs-comment">// å †æ ˆè·Ÿè¸ªæ¡ç›®æ ¼å¼ï¼šåºå·(4ä½) æ¨¡å—å(31ä½) åœ°å€(8ä½åå…­è¿›åˆ¶) ç¬¦å·å + åç§»é‡</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> TRACE_FMT         <span class="hljs-string">"%-4d%-31s 0x%08lx %s + %lu"</span></span>
<span class="hljs-comment">// æŒ‡é’ˆå®Œæ•´æ ¼å¼ï¼ˆ8ä½åå…­è¿›åˆ¶ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> POINTER_FMT       <span class="hljs-string">"0x%08lx"</span></span>
<span class="hljs-comment">// æŒ‡é’ˆçŸ­æ ¼å¼</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> POINTER_SHORT_FMT <span class="hljs-string">"0x%lx"</span></span>
<span class="hljs-comment">// ç¬¦å·è¡¨ç»“æ„ä½“ç±»å‹ï¼ˆ32ä½ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> BS_NLIST struct nlist</span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-comment">// å®šä¹‰æ ˆå¸§ç»“æ„ä½“ï¼Œç”¨äºéå†å‡½æ•°è°ƒç”¨æ ˆ</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BSStackFrameEntry</span>{</span>
    <span class="hljs-comment">// æŒ‡å‘å‰ä¸€ä¸ªæ ˆå¸§çš„æŒ‡é’ˆï¼ˆå½¢æˆé“¾è¡¨ç»“æ„ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BSStackFrameEntry</span> *<span class="hljs-title">const</span> <span class="hljs-title">previous</span>;</span>
    <span class="hljs-comment">// å½“å‰æ ˆå¸§çš„è¿”å›åœ°å€ï¼ˆå³è°ƒç”¨è€…çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> return_address;
} BSStackFrameEntry;

<span class="hljs-comment">// é™æ€å…¨å±€å˜é‡ï¼Œä¿å­˜ä¸»çº¿ç¨‹çš„Machç«¯å£ID</span>
<span class="hljs-type">static</span> <span class="hljs-type">mach_port_t</span> main_thread_id;

@implementation BSBacktraceLogger

<span class="hljs-comment">// +loadæ–¹æ³•åœ¨ç±»åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œæ—©äºmainå‡½æ•°æ‰§è¡Œ</span>
+ (<span class="hljs-type">void</span>)load {
    <span class="hljs-comment">// ä¿å­˜ä¸»çº¿ç¨‹çš„Machçº¿ç¨‹IDï¼Œç”¨äºåç»­è¯†åˆ«ä¸»çº¿ç¨‹</span>
    main_thread_id = mach_thread_self();
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark Implementation of interface</span>
<span class="hljs-comment">// å…¬å…±æ¥å£å®ç°éƒ¨åˆ†</span>

<span class="hljs-comment">// è·å–æŒ‡å®šNSThreadçš„è°ƒç”¨æ ˆå›æº¯ä¿¡æ¯</span>
+ (NSString *)bs_backtraceOfNSThread:(NSThread *)thread {
    <span class="hljs-comment">// å°†NSThreadè½¬æ¢ä¸ºMachçº¿ç¨‹ï¼Œç„¶åè·å–å…¶å›æº¯ä¿¡æ¯</span>
    <span class="hljs-keyword">return</span> _bs_backtraceOfThread(bs_machThreadFromNSThread(thread));
}

<span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„è°ƒç”¨æ ˆå›æº¯ä¿¡æ¯</span>
+ (NSString *)bs_backtraceOfCurrentThread {
    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡å¹¶è°ƒç”¨é€šç”¨æ–¹æ³•</span>
    <span class="hljs-keyword">return</span> [self bs_backtraceOfNSThread:[NSThread currentThread]];
}

<span class="hljs-comment">// è·å–ä¸»çº¿ç¨‹çš„è°ƒç”¨æ ˆå›æº¯ä¿¡æ¯</span>
+ (NSString *)bs_backtraceOfMainThread {
    <span class="hljs-comment">// è·å–ä¸»çº¿ç¨‹å¯¹è±¡å¹¶è°ƒç”¨é€šç”¨æ–¹æ³•</span>
    <span class="hljs-keyword">return</span> [self bs_backtraceOfNSThread:[NSThread mainThread]];
}

<span class="hljs-comment">// è·å–æ‰€æœ‰çº¿ç¨‹çš„è°ƒç”¨æ ˆå›æº¯ä¿¡æ¯</span>
+ (NSString *)bs_backtraceOfAllThread {
    <span class="hljs-comment">// ç”¨äºå­˜å‚¨çº¿ç¨‹åˆ—è¡¨çš„æ•°ç»„</span>
    <span class="hljs-type">thread_act_array_t</span> threads;
    <span class="hljs-comment">// çº¿ç¨‹æ•°é‡</span>
    <span class="hljs-type">mach_msg_type_number_t</span> thread_count = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// è·å–å½“å‰ä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">task_t</span> this_task = mach_task_self();
    
    <span class="hljs-comment">// è·å–å½“å‰ä»»åŠ¡çš„æ‰€æœ‰çº¿ç¨‹åˆ—è¡¨</span>
    <span class="hljs-type">kern_return_t</span> kr = task_threads(this_task, &amp;threads, &amp;thread_count);
    <span class="hljs-comment">// å¦‚æœè·å–å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span>
    <span class="hljs-keyword">if</span>(kr != KERN_SUCCESS) {
        <span class="hljs-keyword">return</span> @<span class="hljs-string">"Fail to get information of all threads"</span>;
    }
    
    <span class="hljs-comment">// åˆ›å»ºå¯å˜å­—ç¬¦ä¸²ï¼Œç”¨äºæ‹¼æ¥æ‰€æœ‰çº¿ç¨‹çš„å›æº¯ä¿¡æ¯</span>
    NSMutableString *resultString = [NSMutableString stringWithFormat:@<span class="hljs-string">"Call Backtrace of %u threads:\n"</span>, thread_count];
    <span class="hljs-comment">// éå†æ‰€æœ‰çº¿ç¨‹</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; thread_count; i++) {
        <span class="hljs-comment">// è·å–æ¯ä¸ªçº¿ç¨‹çš„å›æº¯ä¿¡æ¯å¹¶è¿½åŠ åˆ°ç»“æœå­—ç¬¦ä¸²</span>
        [resultString appendString:_bs_backtraceOfThread(threads[i])];
    }
    <span class="hljs-comment">// è¿”å›ä¸å¯å˜å‰¯æœ¬</span>
    <span class="hljs-keyword">return</span> [resultString copy];
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark Get call backtrace of a mach_thread</span>
<span class="hljs-comment">// è·å–æŒ‡å®šMachçº¿ç¨‹çš„è°ƒç”¨æ ˆå›æº¯ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰</span>
NSString *_bs_backtraceOfThread(<span class="hljs-type">thread_t</span> thread) {
    <span class="hljs-comment">// åˆ›å»ºç¼“å†²åŒºï¼Œæœ€å¤šå­˜å‚¨50å±‚å‡½æ•°è°ƒç”¨æ ˆ</span>
    <span class="hljs-type">uintptr_t</span> backtraceBuffer[<span class="hljs-number">50</span>];
    <span class="hljs-comment">// å½“å‰æ ˆå¸§ç´¢å¼•</span>
    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// åˆ›å»ºå¯å˜å­—ç¬¦ä¸²ç”¨äºå­˜å‚¨å›æº¯ä¿¡æ¯</span>
    NSMutableString *resultString = [[NSMutableString alloc] initWithFormat:@<span class="hljs-string">"Backtrace of Thread %u:\n"</span>, thread];
    
    <span class="hljs-comment">// æœºå™¨ä¸Šä¸‹æ–‡ç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨çº¿ç¨‹çš„å¯„å­˜å™¨çŠ¶æ€</span>
    _STRUCT_MCONTEXT machineContext;
    <span class="hljs-comment">// è·å–çº¿ç¨‹çš„æœºå™¨ä¸Šä¸‹æ–‡ï¼ˆå¯„å­˜å™¨çŠ¶æ€ï¼‰</span>
    <span class="hljs-keyword">if</span>(!bs_fillThreadStateIntoMachineContext(thread, &amp;machineContext)) {
        <span class="hljs-comment">// å¦‚æœè·å–å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="hljs-keyword">return</span> [NSString stringWithFormat:@<span class="hljs-string">"Fail to get information about thread: %u"</span>, thread];
    }
    
    <span class="hljs-comment">// è·å–å½“å‰æŒ‡ä»¤åœ°å€ï¼ˆPCå¯„å­˜å™¨çš„å€¼ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> instructionAddress = bs_mach_instructionAddress(&amp;machineContext);
    <span class="hljs-comment">// å°†æŒ‡ä»¤åœ°å€ä½œä¸ºç¬¬ä¸€ä¸ªå›æº¯åœ°å€</span>
    backtraceBuffer[i] = instructionAddress;
    <span class="hljs-comment">// ç´¢å¼•é€’å¢</span>
    ++i;
    
    <span class="hljs-comment">// è·å–é“¾æ¥å¯„å­˜å™¨çš„å€¼ï¼ˆARMæ¶æ„ç‰¹æœ‰ï¼Œä¿å­˜å‡½æ•°è¿”å›åœ°å€ï¼‰</span>
    <span class="hljs-type">uintptr_t</span> linkRegister = bs_mach_linkRegister(&amp;machineContext);
    <span class="hljs-comment">// å¦‚æœé“¾æ¥å¯„å­˜å™¨æœ‰å€¼ï¼ˆéx86æ¶æ„ï¼‰</span>
    <span class="hljs-keyword">if</span> (linkRegister) {
        <span class="hljs-comment">// å°†é“¾æ¥å¯„å­˜å™¨çš„å€¼ä½œä¸ºç¬¬äºŒä¸ªå›æº¯åœ°å€</span>
        backtraceBuffer[i] = linkRegister;
        <span class="hljs-comment">// ç´¢å¼•é€’å¢</span>
        i++;
    }
    
    <span class="hljs-comment">// å¦‚æœæŒ‡ä»¤åœ°å€ä¸º0ï¼Œè¯´æ˜è·å–å¤±è´¥</span>
    <span class="hljs-keyword">if</span>(instructionAddress == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> @<span class="hljs-string">"Fail to get instruction address"</span>;
    }
    
    <span class="hljs-comment">// åˆå§‹åŒ–æ ˆå¸§ç»“æ„ä½“</span>
    BSStackFrameEntry frame = {<span class="hljs-number">0</span>};
    <span class="hljs-comment">// è·å–å¸§æŒ‡é’ˆï¼ˆFPå¯„å­˜å™¨çš„å€¼ï¼ŒæŒ‡å‘å½“å‰æ ˆå¸§ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> framePtr = bs_mach_framePointer(&amp;machineContext);
    <span class="hljs-comment">// å¦‚æœå¸§æŒ‡é’ˆä¸º0ï¼Œæˆ–è€…æ— æ³•ä»è¯¥åœ°å€è¯»å–æ ˆå¸§æ•°æ®</span>
    <span class="hljs-keyword">if</span>(framePtr == <span class="hljs-number">0</span> ||
       bs_mach_copyMem((<span class="hljs-type">void</span> *)framePtr, &amp;frame, <span class="hljs-keyword">sizeof</span>(frame)) != KERN_SUCCESS) {
        <span class="hljs-comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="hljs-keyword">return</span> @<span class="hljs-string">"Fail to get frame pointer"</span>;
    }
    
    <span class="hljs-comment">// éå†æ ˆå¸§é“¾è¡¨ï¼Œæœ€å¤š50å±‚</span>
    <span class="hljs-keyword">for</span>(; i &lt; <span class="hljs-number">50</span>; i++) {
        <span class="hljs-comment">// ä¿å­˜å½“å‰æ ˆå¸§çš„è¿”å›åœ°å€</span>
        backtraceBuffer[i] = frame.return_address;
        <span class="hljs-comment">// å¦‚æœè¿”å›åœ°å€ä¸º0ï¼Œæˆ–è€…å‰ä¸€ä¸ªæ ˆå¸§æŒ‡é’ˆä¸º0ï¼Œæˆ–è€…æ— æ³•è¯»å–å‰ä¸€ä¸ªæ ˆå¸§</span>
        <span class="hljs-keyword">if</span>(backtraceBuffer[i] == <span class="hljs-number">0</span> ||
           frame.previous == <span class="hljs-number">0</span> ||
           bs_mach_copyMem(frame.previous, &amp;frame, <span class="hljs-keyword">sizeof</span>(frame)) != KERN_SUCCESS) {
            <span class="hljs-comment">// è·³å‡ºå¾ªç¯ï¼Œæ ˆå¸§éå†ç»“æŸ</span>
            <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-comment">// è®°å½•å®é™…è·å–çš„å›æº¯å±‚æ•°</span>
    <span class="hljs-type">int</span> backtraceLength = i;
    <span class="hljs-comment">// åˆ›å»ºç¬¦å·ä¿¡æ¯æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªåœ°å€å¯¹åº”çš„ç¬¦å·ä¿¡æ¯</span>
    Dl_info symbolicated[backtraceLength];
    <span class="hljs-comment">// å¯¹å›æº¯åœ°å€è¿›è¡Œç¬¦å·åŒ–ï¼ˆå°†åœ°å€è½¬æ¢ä¸ºå‡½æ•°åã€æ¨¡å—åç­‰ï¼‰</span>
    bs_symbolicate(backtraceBuffer, symbolicated, backtraceLength, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// éå†æ‰€æœ‰å›æº¯åœ°å€</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; backtraceLength; ++i) {
        <span class="hljs-comment">// æ ¼å¼åŒ–æ¯ä¸€æ¡å›æº¯ä¿¡æ¯å¹¶è¿½åŠ åˆ°ç»“æœå­—ç¬¦ä¸²</span>
        [resultString appendFormat:@<span class="hljs-string">"%@"</span>, bs_logBacktraceEntry(i, backtraceBuffer[i], &amp;symbolicated[i])];
    }
    <span class="hljs-comment">// è¿½åŠ æ¢è¡Œç¬¦</span>
    [resultString appendFormat:@<span class="hljs-string">"\n"</span>];
    <span class="hljs-comment">// è¿”å›ä¸å¯å˜å‰¯æœ¬</span>
    <span class="hljs-keyword">return</span> [resultString copy];
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark Convert NSThread to Mach thread</span>
<span class="hljs-comment">// å°†NSThreadå¯¹è±¡è½¬æ¢ä¸ºMachçº¿ç¨‹ID</span>
<span class="hljs-comment">// è¿™ä¸ªå‡½æ•°é€šè¿‡ä¸´æ—¶ä¿®æ”¹çº¿ç¨‹åç§°æ¥åŒ¹é…NSThreadå’ŒMachçº¿ç¨‹</span>
<span class="hljs-type">thread_t</span> <span class="hljs-title function_">bs_machThreadFromNSThread</span><span class="hljs-params">(NSThread *nsthread)</span> {
    <span class="hljs-comment">// ç”¨äºå­˜å‚¨çº¿ç¨‹åç§°çš„ç¼“å†²åŒº</span>
    <span class="hljs-type">char</span> name[<span class="hljs-number">256</span>];
    <span class="hljs-comment">// çº¿ç¨‹æ•°é‡</span>
    <span class="hljs-type">mach_msg_type_number_t</span> count;
    <span class="hljs-comment">// çº¿ç¨‹åˆ—è¡¨æ•°ç»„</span>
    <span class="hljs-type">thread_act_array_t</span> <span class="hljs-built_in">list</span>;
    <span class="hljs-comment">// è·å–å½“å‰ä»»åŠ¡çš„æ‰€æœ‰çº¿ç¨‹</span>
    task_threads(mach_task_self(), &amp;<span class="hljs-built_in">list</span>, &amp;count);
    
    <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´æˆ³ï¼Œç”¨ä½œä¸´æ—¶çº¿ç¨‹åç§°ï¼ˆç¡®ä¿å”¯ä¸€æ€§ï¼‰</span>
    NSTimeInterval currentTimestamp = [[NSDate date] timeIntervalSince1970];
    <span class="hljs-comment">// ä¿å­˜åŸå§‹çº¿ç¨‹åç§°</span>
    NSString *originName = [nsthread name];
    <span class="hljs-comment">// å°†çº¿ç¨‹åç§°ä¸´æ—¶è®¾ç½®ä¸ºæ—¶é—´æˆ³å­—ç¬¦ä¸²</span>
    [nsthread setName:[NSString stringWithFormat:@<span class="hljs-string">"%f"</span>, currentTimestamp]];
    
    <span class="hljs-comment">// å¦‚æœæ˜¯ä¸»çº¿ç¨‹ï¼Œç›´æ¥è¿”å›ä¿å­˜çš„ä¸»çº¿ç¨‹ID</span>
    <span class="hljs-keyword">if</span> ([nsthread isMainThread]) {
        <span class="hljs-keyword">return</span> (<span class="hljs-type">thread_t</span>)main_thread_id;
    }
    
    <span class="hljs-comment">// éå†æ‰€æœ‰Machçº¿ç¨‹</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {
        <span class="hljs-comment">// å°†Machçº¿ç¨‹è½¬æ¢ä¸ºPOSIXçº¿ç¨‹ï¼ˆpthreadï¼‰</span>
        <span class="hljs-type">pthread_t</span> pt = pthread_from_mach_thread_np(<span class="hljs-built_in">list</span>[i]);
        <span class="hljs-comment">// å†æ¬¡æ£€æŸ¥æ˜¯å¦ä¸ºä¸»çº¿ç¨‹ï¼ˆå†—ä½™æ£€æŸ¥ï¼Œå®é™…ä¸Šè¿™ä¸ªæ¡ä»¶æ°¸è¿œä¸ä¼šæ»¡è¶³ï¼‰</span>
        <span class="hljs-keyword">if</span> ([nsthread isMainThread]) {
            <span class="hljs-comment">// å¦‚æœMachçº¿ç¨‹IDåŒ¹é…ä¸»çº¿ç¨‹ID</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">list</span>[i] == main_thread_id) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>[i];
            }
        }
        <span class="hljs-comment">// å¦‚æœpthreadè½¬æ¢æˆåŠŸ</span>
        <span class="hljs-keyword">if</span> (pt) {
            <span class="hljs-comment">// æ¸…ç©ºåç§°ç¼“å†²åŒº</span>
            name[<span class="hljs-number">0</span>] = <span class="hljs-string">'\0'</span>;
            <span class="hljs-comment">// è·å–pthreadçš„çº¿ç¨‹åç§°</span>
            pthread_getname_np(pt, name, <span class="hljs-keyword">sizeof</span> name);
            <span class="hljs-comment">// æ¯”è¾ƒçº¿ç¨‹åç§°æ˜¯å¦åŒ¹é…ï¼ˆå³æ˜¯å¦ä¸ºæˆ‘ä»¬ä¸´æ—¶è®¾ç½®çš„æ—¶é—´æˆ³ï¼‰</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(name, [nsthread name].UTF8String)) {
                <span class="hljs-comment">// æ¢å¤åŸå§‹çº¿ç¨‹åç§°</span>
                [nsthread setName:originName];
                <span class="hljs-comment">// è¿”å›åŒ¹é…çš„Machçº¿ç¨‹ID</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>[i];
            }
        }
    }
    
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„çº¿ç¨‹ï¼Œæ¢å¤åŸå§‹åç§°</span>
    [nsthread setName:originName];
    <span class="hljs-comment">// è¿”å›å½“å‰çº¿ç¨‹IDï¼ˆä½œä¸ºåå¤‡æ–¹æ¡ˆï¼‰</span>
    <span class="hljs-keyword">return</span> mach_thread_self();
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark GenerateBacbsrackEnrty</span>
<span class="hljs-comment">// ç”Ÿæˆå•æ¡å›æº¯æ—¥å¿—æ¡ç›®</span>
<span class="hljs-comment">// å‚æ•°ï¼šæ¡ç›®åºå·ã€åœ°å€ã€ç¬¦å·ä¿¡æ¯</span>
NSString* <span class="hljs-title function_">bs_logBacktraceEntry</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> entryNum,
                               <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> address,
                               <span class="hljs-type">const</span> Dl_info* <span class="hljs-type">const</span> dlInfo)</span> {
    <span class="hljs-comment">// æ–‡ä»¶åœ°å€ç¼“å†²åŒºï¼ˆå½“æ–‡ä»¶åä¸ºç©ºæ—¶ç”¨äºå­˜å‚¨åœ°å€ï¼‰</span>
    <span class="hljs-type">char</span> faddrBuff[<span class="hljs-number">20</span>];
    <span class="hljs-comment">// ç¬¦å·åœ°å€ç¼“å†²åŒºï¼ˆå½“ç¬¦å·åä¸ºç©ºæ—¶ç”¨äºå­˜å‚¨åœ°å€ï¼‰</span>
    <span class="hljs-type">char</span> saddrBuff[<span class="hljs-number">20</span>];
    
    <span class="hljs-comment">// ä»å®Œæ•´è·¯å¾„ä¸­æå–æ–‡ä»¶åï¼ˆåªä¿ç•™æœ€åä¸€æ®µï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* fname = bs_lastPathEntry(dlInfo-&gt;dli_fname);
    <span class="hljs-comment">// å¦‚æœæ–‡ä»¶åä¸ºç©ºï¼ˆæœªæ‰¾åˆ°ç¬¦å·ä¿¡æ¯ï¼‰</span>
    <span class="hljs-keyword">if</span>(fname == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-comment">// å°†æ–‡ä»¶åŸºåœ°å€æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²</span>
        <span class="hljs-built_in">sprintf</span>(faddrBuff, POINTER_FMT, (<span class="hljs-type">uintptr_t</span>)dlInfo-&gt;dli_fbase);
        <span class="hljs-comment">// ä½¿ç”¨åœ°å€ä½œä¸ºæ–‡ä»¶å</span>
        fname = faddrBuff;
    }
    
    <span class="hljs-comment">// è®¡ç®—åœ°å€ç›¸å¯¹äºç¬¦å·åœ°å€çš„åç§»é‡</span>
    <span class="hljs-type">uintptr_t</span> offset = address - (<span class="hljs-type">uintptr_t</span>)dlInfo-&gt;dli_saddr;
    <span class="hljs-comment">// è·å–ç¬¦å·åç§°ï¼ˆå‡½æ•°åï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* sname = dlInfo-&gt;dli_sname;
    <span class="hljs-comment">// å¦‚æœç¬¦å·åç§°ä¸ºç©º</span>
    <span class="hljs-keyword">if</span>(sname == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-comment">// å°†æ–‡ä»¶åŸºåœ°å€æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²</span>
        <span class="hljs-built_in">sprintf</span>(saddrBuff, POINTER_SHORT_FMT, (<span class="hljs-type">uintptr_t</span>)dlInfo-&gt;dli_fbase);
        <span class="hljs-comment">// ä½¿ç”¨åœ°å€ä½œä¸ºç¬¦å·å</span>
        sname = saddrBuff;
        <span class="hljs-comment">// é‡æ–°è®¡ç®—åç§»é‡ï¼ˆç›¸å¯¹äºæ–‡ä»¶åŸºåœ°å€ï¼‰</span>
        offset = address - (<span class="hljs-type">uintptr_t</span>)dlInfo-&gt;dli_fbase;
    }
    <span class="hljs-comment">// æ ¼å¼åŒ–è¾“å‡ºï¼šæ¨¡å—å(30ä½å¯¹é½) åœ°å€ ç¬¦å·å + åç§»é‡</span>
    <span class="hljs-keyword">return</span> [NSString stringWithFormat:@<span class="hljs-string">"%-30s  0x%08"</span> PRIxPTR <span class="hljs-string">" %s + %lu\n"</span> ,fname, (<span class="hljs-type">uintptr_t</span>)address, sname, offset];
}

<span class="hljs-comment">// ä»å®Œæ•´è·¯å¾„ä¸­æå–æœ€åä¸€éƒ¨åˆ†ï¼ˆæ–‡ä»¶åï¼‰</span>
<span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title function_">bs_lastPathEntry</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-type">const</span> path)</span> {
    <span class="hljs-comment">// å¦‚æœè·¯å¾„ä¸ºç©ºï¼Œè¿”å›NULL</span>
    <span class="hljs-keyword">if</span>(path == <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
    
    <span class="hljs-comment">// æŸ¥æ‰¾æœ€åä¸€ä¸ª'/'å­—ç¬¦çš„ä½ç½®</span>
    <span class="hljs-type">char</span>* lastFile = <span class="hljs-built_in">strrchr</span>(path, <span class="hljs-string">'/'</span>);
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°'/'ï¼Œè¯´æ˜pathæœ¬èº«å°±æ˜¯æ–‡ä»¶åï¼›å¦åˆ™è¿”å›'/'åé¢çš„éƒ¨åˆ†</span>
    <span class="hljs-keyword">return</span> lastFile == <span class="hljs-literal">NULL</span> ? path : lastFile + <span class="hljs-number">1</span>;
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark HandleMachineContext</span>
<span class="hljs-comment">// æœºå™¨ä¸Šä¸‹æ–‡å¤„ç†ç›¸å…³å‡½æ•°</span>

<span class="hljs-comment">// è·å–çº¿ç¨‹çŠ¶æ€å¹¶å¡«å……åˆ°æœºå™¨ä¸Šä¸‹æ–‡ç»“æ„ä½“ä¸­</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">bs_fillThreadStateIntoMachineContext</span><span class="hljs-params">(<span class="hljs-type">thread_t</span> thread, _STRUCT_MCONTEXT *machineContext)</span> {
    <span class="hljs-comment">// çŠ¶æ€ç»“æ„ä½“çš„å¤§å°ï¼ˆä¸åŒæ¶æ„å¤§å°ä¸åŒï¼‰</span>
    <span class="hljs-type">mach_msg_type_number_t</span> state_count = BS_THREAD_STATE_COUNT;
    <span class="hljs-comment">// è°ƒç”¨å†…æ ¸å‡½æ•°è·å–çº¿ç¨‹çŠ¶æ€ï¼ˆå¯„å­˜å™¨å¿«ç…§ï¼‰</span>
    <span class="hljs-type">kern_return_t</span> kr = thread_get_state(thread, BS_THREAD_STATE, (<span class="hljs-type">thread_state_t</span>)&amp;machineContext-&gt;__ss, &amp;state_count);
    <span class="hljs-comment">// è¿”å›æ˜¯å¦æˆåŠŸè·å–</span>
    <span class="hljs-keyword">return</span> (kr == KERN_SUCCESS);
}

<span class="hljs-comment">// ä»æœºå™¨ä¸Šä¸‹æ–‡ä¸­æå–å¸§æŒ‡é’ˆå¯„å­˜å™¨çš„å€¼</span>
<span class="hljs-type">uintptr_t</span> <span class="hljs-title function_">bs_mach_framePointer</span><span class="hljs-params">(<span class="hljs-type">mcontext_t</span> <span class="hljs-type">const</span> machineContext)</span>{
    <span class="hljs-comment">// é€šè¿‡å®å®šä¹‰è®¿é—®å¯¹åº”æ¶æ„çš„å¸§æŒ‡é’ˆå¯„å­˜å™¨</span>
    <span class="hljs-keyword">return</span> machineContext-&gt;__ss.BS_FRAME_POINTER;
}

<span class="hljs-comment">// ä»æœºå™¨ä¸Šä¸‹æ–‡ä¸­æå–æ ˆæŒ‡é’ˆå¯„å­˜å™¨çš„å€¼</span>
<span class="hljs-type">uintptr_t</span> <span class="hljs-title function_">bs_mach_stackPointer</span><span class="hljs-params">(<span class="hljs-type">mcontext_t</span> <span class="hljs-type">const</span> machineContext)</span>{
    <span class="hljs-comment">// é€šè¿‡å®å®šä¹‰è®¿é—®å¯¹åº”æ¶æ„çš„æ ˆæŒ‡é’ˆå¯„å­˜å™¨</span>
    <span class="hljs-keyword">return</span> machineContext-&gt;__ss.BS_STACK_POINTER;
}

<span class="hljs-comment">// ä»æœºå™¨ä¸Šä¸‹æ–‡ä¸­æå–æŒ‡ä»¤æŒ‡é’ˆ/ç¨‹åºè®¡æ•°å™¨çš„å€¼</span>
<span class="hljs-type">uintptr_t</span> <span class="hljs-title function_">bs_mach_instructionAddress</span><span class="hljs-params">(<span class="hljs-type">mcontext_t</span> <span class="hljs-type">const</span> machineContext)</span>{
    <span class="hljs-comment">// é€šè¿‡å®å®šä¹‰è®¿é—®å¯¹åº”æ¶æ„çš„æŒ‡ä»¤åœ°å€å¯„å­˜å™¨</span>
    <span class="hljs-keyword">return</span> machineContext-&gt;__ss.BS_INSTRUCTION_ADDRESS;
}

<span class="hljs-comment">// ä»æœºå™¨ä¸Šä¸‹æ–‡ä¸­æå–é“¾æ¥å¯„å­˜å™¨çš„å€¼ï¼ˆä»…ARMæ¶æ„æœ‰æ•ˆï¼‰</span>
<span class="hljs-type">uintptr_t</span> <span class="hljs-title function_">bs_mach_linkRegister</span><span class="hljs-params">(<span class="hljs-type">mcontext_t</span> <span class="hljs-type">const</span> machineContext)</span>{
<span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(__i386__) || defined(__x86_64__)</span>
    <span class="hljs-comment">// x86æ¶æ„æ²¡æœ‰é“¾æ¥å¯„å­˜å™¨ï¼Œè¿”å›0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
    <span class="hljs-comment">// ARMæ¶æ„è¿”å›LRå¯„å­˜å™¨çš„å€¼</span>
    <span class="hljs-keyword">return</span> machineContext-&gt;__ss.__lr;
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
}

<span class="hljs-comment">// ä»æŒ‡å®šå†…å­˜åœ°å€å¤åˆ¶æ•°æ®åˆ°ç›®æ ‡åœ°å€</span>
<span class="hljs-comment">// ä½¿ç”¨vm_read_overwriteç¡®ä¿å¯ä»¥å®‰å…¨è¯»å–å…¶ä»–çº¿ç¨‹çš„å†…å­˜</span>
<span class="hljs-type">kern_return_t</span> <span class="hljs-title function_">bs_mach_copyMem</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">void</span> *<span class="hljs-type">const</span> src, <span class="hljs-type">void</span> *<span class="hljs-type">const</span> dst, <span class="hljs-type">const</span> <span class="hljs-type">size_t</span> numBytes)</span>{
    <span class="hljs-comment">// å®é™…å¤åˆ¶çš„å­—èŠ‚æ•°</span>
    <span class="hljs-type">vm_size_t</span> bytesCopied = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// ä½¿ç”¨è™šæ‹Ÿå†…å­˜è¯»å–è¦†å†™å‡½æ•°ï¼Œå¯ä»¥è·¨çº¿ç¨‹è¯»å–å†…å­˜</span>
    <span class="hljs-keyword">return</span> vm_read_overwrite(mach_task_self(), (<span class="hljs-type">vm_address_t</span>)src, (<span class="hljs-type">vm_size_t</span>)numBytes, (<span class="hljs-type">vm_address_t</span>)dst, &amp;bytesCopied);
}

<span class="hljs-meta">#<span class="hljs-keyword">pragma</span> -mark Symbolicate</span>
<span class="hljs-comment">// ç¬¦å·åŒ–ç›¸å…³å‡½æ•°ï¼šå°†å†…å­˜åœ°å€è½¬æ¢ä¸ºå¯è¯»çš„ç¬¦å·ä¿¡æ¯</span>

<span class="hljs-comment">// å¯¹å›æº¯åœ°å€æ•°ç»„è¿›è¡Œç¬¦å·åŒ–å¤„ç†</span>
<span class="hljs-comment">// å‚æ•°ï¼šå›æº¯åœ°å€ç¼“å†²åŒºã€ç¬¦å·ä¿¡æ¯ç¼“å†²åŒºã€æ¡ç›®æ•°é‡ã€è·³è¿‡çš„æ¡ç›®æ•°</span>
<span class="hljs-type">void</span> <span class="hljs-title function_">bs_symbolicate</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span>* <span class="hljs-type">const</span> backtraceBuffer,
                    Dl_info* <span class="hljs-type">const</span> symbolsBuffer,
                    <span class="hljs-type">const</span> <span class="hljs-type">int</span> numEntries,
                    <span class="hljs-type">const</span> <span class="hljs-type">int</span> skippedEntries)</span>{
    <span class="hljs-comment">// å½“å‰å¤„ç†çš„ç´¢å¼•</span>
    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰è·³è¿‡æ¡ç›®ï¼Œä¸”ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…</span>
    <span class="hljs-keyword">if</span>(!skippedEntries &amp;&amp; i &lt; numEntries) {
        <span class="hljs-comment">// ç¬¬ä¸€ä¸ªæ¡ç›®ï¼ˆå½“å‰æŒ‡ä»¤åœ°å€ï¼‰ç›´æ¥ç¬¦å·åŒ–ï¼Œä¸éœ€è¦è°ƒæ•´</span>
        bs_dladdr(backtraceBuffer[i], &amp;symbolsBuffer[i]);
        <span class="hljs-comment">// ç´¢å¼•é€’å¢</span>
        i++;
    }
    
    <span class="hljs-comment">// å¤„ç†å‰©ä½™çš„è¿”å›åœ°å€</span>
    <span class="hljs-keyword">for</span>(; i &lt; numEntries; i++) {
        <span class="hljs-comment">// è¿”å›åœ°å€éœ€è¦å‡1æ‰èƒ½å¾—åˆ°è°ƒç”¨æŒ‡ä»¤çš„åœ°å€ï¼Œç„¶åè¿›è¡Œç¬¦å·åŒ–</span>
        <span class="hljs-comment">// å› ä¸ºè¿”å›åœ°å€æŒ‡å‘çš„æ˜¯è°ƒç”¨åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤</span>
        bs_dladdr(CALL_INSTRUCTION_FROM_RETURN_ADDRESS(backtraceBuffer[i]), &amp;symbolsBuffer[i]);
    }
}

<span class="hljs-comment">// è‡ªå®šä¹‰å®ç°çš„dladdrå‡½æ•°ï¼Œç”¨äºå°†åœ°å€è½¬æ¢ä¸ºç¬¦å·ä¿¡æ¯</span>
<span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªæ‰‹åŠ¨è§£æMach-Oæ–‡ä»¶çš„ç¬¦å·è¡¨æ¥æŸ¥æ‰¾ç¬¦å·çš„è¿‡ç¨‹</span>
<span class="hljs-type">bool</span> <span class="hljs-title function_">bs_dladdr</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> address, Dl_info* <span class="hljs-type">const</span> info)</span> {
    <span class="hljs-comment">// åˆå§‹åŒ–ç¬¦å·ä¿¡æ¯ç»“æ„ä½“çš„æ‰€æœ‰å­—æ®µä¸ºNULL</span>
    info-&gt;dli_fname = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// æ–‡ä»¶å</span>
    info-&gt;dli_fbase = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// æ–‡ä»¶åŸºåœ°å€</span>
    info-&gt;dli_sname = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// ç¬¦å·å</span>
    info-&gt;dli_saddr = <span class="hljs-literal">NULL</span>; <span class="hljs-comment">// ç¬¦å·åœ°å€</span>
    
    <span class="hljs-comment">// æŸ¥æ‰¾åŒ…å«è¯¥åœ°å€çš„é•œåƒç´¢å¼•</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> idx = bs_imageIndexContainingAddress(address);
    <span class="hljs-comment">// å¦‚æœæ²¡æ‰¾åˆ°å¯¹åº”çš„é•œåƒï¼Œè¿”å›false</span>
    <span class="hljs-keyword">if</span>(idx == UINT_MAX) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// è·å–é•œåƒçš„Mach-Oå¤´éƒ¨</span>
    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mach_header</span>* <span class="hljs-title">header</span> =</span> _dyld_get_image_header(idx);
    <span class="hljs-comment">// è·å–é•œåƒçš„è™šæ‹Ÿå†…å­˜åœ°å€åç§»ï¼ˆASLRåœ°å€éšæœºåŒ–åç§»ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> imageVMAddrSlide = (<span class="hljs-type">uintptr_t</span>)_dyld_get_image_vmaddr_slide(idx);
    <span class="hljs-comment">// è®¡ç®—å»é™¤åç§»åçš„åœ°å€ï¼ˆæ–‡ä»¶ä¸­çš„åŸå§‹åœ°å€ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> addressWithSlide = address - imageVMAddrSlide;
    <span class="hljs-comment">// è·å–æ®µåŸºåœ°å€ï¼ˆç”¨äºå®šä½ç¬¦å·è¡¨åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼‰</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> segmentBase = bs_segmentBaseOfImageIndex(idx) + imageVMAddrSlide;
    <span class="hljs-comment">// å¦‚æœæ®µåŸºåœ°å€ä¸º0ï¼Œè¿”å›false</span>
    <span class="hljs-keyword">if</span>(segmentBase == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// å¡«å……æ–‡ä»¶åå’ŒåŸºåœ°å€ä¿¡æ¯</span>
    info-&gt;dli_fname = _dyld_get_image_name(idx);
    info-&gt;dli_fbase = (<span class="hljs-type">void</span>*)header;
    
    <span class="hljs-comment">// æŸ¥æ‰¾ç¬¦å·è¡¨å¹¶è·å–æœ€æ¥è¿‘è¯¥åœ°å€çš„ç¬¦å·</span>
    <span class="hljs-comment">// æœ€ä½³åŒ¹é…çš„ç¬¦å·è¡¨é¡¹</span>
    <span class="hljs-type">const</span> BS_NLIST* bestMatch = <span class="hljs-literal">NULL</span>;
    <span class="hljs-comment">// æœ€å°è·ç¦»åˆå§‹åŒ–ä¸ºæœ€å¤§å€¼</span>
    <span class="hljs-type">uintptr_t</span> bestDistance = ULONG_MAX;
    <span class="hljs-comment">// è·å–Mach-Oå¤´éƒ¨åçš„ç¬¬ä¸€ä¸ªåŠ è½½å‘½ä»¤åœ°å€</span>
    <span class="hljs-type">uintptr_t</span> cmdPtr = bs_firstCmdAfterHeader(header);
    <span class="hljs-comment">// å¦‚æœå‘½ä»¤æŒ‡é’ˆä¸º0ï¼Œè¯´æ˜å¤´éƒ¨æŸå</span>
    <span class="hljs-keyword">if</span>(cmdPtr == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// éå†æ‰€æœ‰åŠ è½½å‘½ä»¤</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-type">uint32_t</span> iCmd = <span class="hljs-number">0</span>; iCmd &lt; header-&gt;ncmds; iCmd++) {
        <span class="hljs-comment">// å½“å‰åŠ è½½å‘½ä»¤</span>
        <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">load_command</span>* <span class="hljs-title">loadCmd</span> =</span> (<span class="hljs-keyword">struct</span> load_command*)cmdPtr;
        <span class="hljs-comment">// å¦‚æœæ˜¯ç¬¦å·è¡¨å‘½ä»¤</span>
        <span class="hljs-keyword">if</span>(loadCmd-&gt;cmd == LC_SYMTAB) {
            <span class="hljs-comment">// è½¬æ¢ä¸ºç¬¦å·è¡¨å‘½ä»¤ç»“æ„ä½“</span>
            <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">symtab_command</span>* <span class="hljs-title">symtabCmd</span> =</span> (<span class="hljs-keyword">struct</span> symtab_command*)cmdPtr;
            <span class="hljs-comment">// è®¡ç®—ç¬¦å·è¡¨åœ¨å†…å­˜ä¸­çš„åœ°å€</span>
            <span class="hljs-type">const</span> BS_NLIST* symbolTable = (BS_NLIST*)(segmentBase + symtabCmd-&gt;symoff);
            <span class="hljs-comment">// è®¡ç®—å­—ç¬¦ä¸²è¡¨åœ¨å†…å­˜ä¸­çš„åœ°å€</span>
            <span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> stringTable = segmentBase + symtabCmd-&gt;stroff;
            
            <span class="hljs-comment">// éå†ç¬¦å·è¡¨ä¸­çš„æ‰€æœ‰ç¬¦å·</span>
            <span class="hljs-keyword">for</span>(<span class="hljs-type">uint32_t</span> iSym = <span class="hljs-number">0</span>; iSym &lt; symtabCmd-&gt;nsyms; iSym++) {
                <span class="hljs-comment">// å¦‚æœn_valueä¸º0ï¼Œè¯´æ˜è¯¥ç¬¦å·å¼•ç”¨å¤–éƒ¨å¯¹è±¡ï¼Œè·³è¿‡</span>
                <span class="hljs-keyword">if</span>(symbolTable[iSym].n_value != <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// ç¬¦å·çš„åŸºåœ°å€</span>
                    <span class="hljs-type">uintptr_t</span> symbolBase = symbolTable[iSym].n_value;
                    <span class="hljs-comment">// è®¡ç®—åœ°å€ä¸ç¬¦å·åŸºåœ°å€çš„è·ç¦»</span>
                    <span class="hljs-type">uintptr_t</span> currentDistance = addressWithSlide - symbolBase;
                    <span class="hljs-comment">// å¦‚æœåœ°å€å¤§äºç­‰äºç¬¦å·åŸºåœ°å€ï¼Œä¸”è·ç¦»å°äºç­‰äºå½“å‰æœ€ä½³è·ç¦»</span>
                    <span class="hljs-keyword">if</span>((addressWithSlide &gt;= symbolBase) &amp;&amp;
                       (currentDistance &lt;= bestDistance)) {
                        <span class="hljs-comment">// æ›´æ–°æœ€ä½³åŒ¹é…</span>
                        bestMatch = symbolTable + iSym;
                        <span class="hljs-comment">// æ›´æ–°æœ€å°è·ç¦»</span>
                        bestDistance = currentDistance;
                    }
                }
            }
            <span class="hljs-comment">// å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„ç¬¦å·</span>
            <span class="hljs-keyword">if</span>(bestMatch != <span class="hljs-literal">NULL</span>) {
                <span class="hljs-comment">// å¡«å……ç¬¦å·åœ°å€ï¼ˆéœ€è¦åŠ ä¸ŠASLRåç§»ï¼‰</span>
                info-&gt;dli_saddr = (<span class="hljs-type">void</span>*)(bestMatch-&gt;n_value + imageVMAddrSlide);
                <span class="hljs-comment">// ä»å­—ç¬¦ä¸²è¡¨ä¸­è·å–ç¬¦å·åç§°</span>
                info-&gt;dli_sname = (<span class="hljs-type">char</span>*)((<span class="hljs-type">intptr_t</span>)stringTable + (<span class="hljs-type">intptr_t</span>)bestMatch-&gt;n_un.n_strx);
                <span class="hljs-comment">// å¦‚æœç¬¦å·åä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼ˆC/C++ç¬¦å·çš„å‘½åçº¦å®šï¼‰ï¼Œè·³è¿‡ä¸‹åˆ’çº¿</span>
                <span class="hljs-keyword">if</span>(*info-&gt;dli_sname == <span class="hljs-string">'_'</span>) {
                    info-&gt;dli_sname++;
                }
                <span class="hljs-comment">// å¦‚æœç¬¦å·åœ°å€ç­‰äºæ–‡ä»¶åŸºåœ°å€ä¸”ç±»å‹ä¸º3ï¼Œè¯´æ˜ç¬¦å·å·²è¢«å‰¥ç¦»</span>
                <span class="hljs-keyword">if</span>(info-&gt;dli_saddr == info-&gt;dli_fbase &amp;&amp; bestMatch-&gt;n_type == <span class="hljs-number">3</span>) {
                    info-&gt;dli_sname = <span class="hljs-literal">NULL</span>;
                }
                <span class="hljs-comment">// æ‰¾åˆ°ç¬¦å·åè·³å‡ºå¾ªç¯</span>
                <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªåŠ è½½å‘½ä»¤</span>
        cmdPtr += loadCmd-&gt;cmdsize;
    }
    <span class="hljs-comment">// è¿”å›æˆåŠŸ</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// è·å–Mach-Oå¤´éƒ¨åçš„ç¬¬ä¸€ä¸ªåŠ è½½å‘½ä»¤åœ°å€</span>
<span class="hljs-type">uintptr_t</span> <span class="hljs-title function_">bs_firstCmdAfterHeader</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> mach_header* <span class="hljs-type">const</span> header)</span> {
    <span class="hljs-comment">// æ ¹æ®é­”æ•°åˆ¤æ–­Mach-Oæ–‡ä»¶çš„ç±»å‹å’Œå­—èŠ‚åº</span>
    <span class="hljs-keyword">switch</span>(header-&gt;magic) {
        <span class="hljs-keyword">case</span> MH_MAGIC:    <span class="hljs-comment">// 32ä½å°ç«¯åº</span>
        <span class="hljs-keyword">case</span> MH_CIGAM:    <span class="hljs-comment">// 32ä½å¤§ç«¯åº</span>
            <span class="hljs-comment">// 32ä½å¤´éƒ¨åç›´æ¥è·ŸåŠ è½½å‘½ä»¤ï¼ˆå¤´éƒ¨å¤§å°ä¸ºmach_headerï¼‰</span>
            <span class="hljs-keyword">return</span> (<span class="hljs-type">uintptr_t</span>)(header + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">case</span> MH_MAGIC_64: <span class="hljs-comment">// 64ä½å°ç«¯åº</span>
        <span class="hljs-keyword">case</span> MH_CIGAM_64: <span class="hljs-comment">// 64ä½å¤§ç«¯åº</span>
            <span class="hljs-comment">// 64ä½å¤´éƒ¨åç›´æ¥è·ŸåŠ è½½å‘½ä»¤ï¼ˆå¤´éƒ¨å¤§å°ä¸ºmach_header_64ï¼‰</span>
            <span class="hljs-keyword">return</span> (<span class="hljs-type">uintptr_t</span>)(((<span class="hljs-keyword">struct</span> mach_header_64*)header) + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">default</span>:
            <span class="hljs-comment">// æœªçŸ¥é­”æ•°ï¼Œå¤´éƒ¨æŸå</span>
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// Header is corrupt</span>
    }
}

<span class="hljs-comment">// æŸ¥æ‰¾åŒ…å«æŒ‡å®šåœ°å€çš„é•œåƒç´¢å¼•</span>
<span class="hljs-comment">// éå†æ‰€æœ‰å·²åŠ è½½çš„åŠ¨æ€åº“ï¼Œæ‰¾åˆ°åŒ…å«è¯¥åœ°å€çš„é‚£ä¸€ä¸ª</span>
<span class="hljs-type">uint32_t</span> <span class="hljs-title function_">bs_imageIndexContainingAddress</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uintptr_t</span> address)</span> {
    <span class="hljs-comment">// è·å–å½“å‰è¿›ç¨‹åŠ è½½çš„é•œåƒï¼ˆåŠ¨æ€åº“/å¯æ‰§è¡Œæ–‡ä»¶ï¼‰æ•°é‡</span>
    <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> imageCount = _dyld_image_count();
    <span class="hljs-comment">// Mach-Oå¤´éƒ¨æŒ‡é’ˆ</span>
    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mach_header</span>* <span class="hljs-title">header</span> =</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// éå†æ‰€æœ‰é•œåƒ</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-type">uint32_t</span> iImg = <span class="hljs-number">0</span>; iImg &lt; imageCount; iImg++) {
        <span class="hljs-comment">// è·å–é•œåƒçš„å¤´éƒ¨</span>
        header = _dyld_get_image_header(iImg);
        <span class="hljs-comment">// å¦‚æœå¤´éƒ¨æœ‰æ•ˆ</span>
        <span class="hljs-keyword">if</span>(header != <span class="hljs-literal">NULL</span>) {
            <span class="hljs-comment">// æŸ¥æ‰¾åŒ…å«è¯¥åœ°å€çš„æ®µå‘½ä»¤</span>
            <span class="hljs-comment">// è®¡ç®—å»é™¤ASLRåç§»åçš„åœ°å€</span>
            <span class="hljs-type">uintptr_t</span> addressWSlide = address - (<span class="hljs-type">uintptr_t</span>)_dyld_get_image_vmaddr_slide(iImg);
            <span class="hljs-comment">// è·å–ç¬¬ä¸€ä¸ªåŠ è½½å‘½ä»¤çš„åœ°å€</span>
            <span class="hljs-type">uintptr_t</span> cmdPtr = bs_firstCmdAfterHeader(header);
            <span class="hljs-comment">// å¦‚æœå‘½ä»¤æŒ‡é’ˆæ— æ•ˆï¼Œè·³è¿‡è¿™ä¸ªé•œåƒ</span>
            <span class="hljs-keyword">if</span>(cmdPtr == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// éå†è¯¥é•œåƒçš„æ‰€æœ‰åŠ è½½å‘½ä»¤</span>
            <span class="hljs-keyword">for</span>(<span class="hljs-type">uint32_t</span> iCmd = <span class="hljs-number">0</span>; iCmd &lt; header-&gt;ncmds; iCmd++) {
                <span class="hljs-comment">// å½“å‰åŠ è½½å‘½ä»¤</span>
                <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">load_command</span>* <span class="hljs-title">loadCmd</span> =</span> (<span class="hljs-keyword">struct</span> load_command*)cmdPtr;
                <span class="hljs-comment">// å¦‚æœæ˜¯32ä½æ®µå‘½ä»¤</span>
                <span class="hljs-keyword">if</span>(loadCmd-&gt;cmd == LC_SEGMENT) {
                    <span class="hljs-comment">// è½¬æ¢ä¸º32ä½æ®µå‘½ä»¤ç»“æ„ä½“</span>
                    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segment_command</span>* <span class="hljs-title">segCmd</span> =</span> (<span class="hljs-keyword">struct</span> segment_command*)cmdPtr;
                    <span class="hljs-comment">// æ£€æŸ¥åœ°å€æ˜¯å¦åœ¨è¯¥æ®µçš„è™šæ‹Ÿåœ°å€èŒƒå›´å†…</span>
                    <span class="hljs-keyword">if</span>(addressWSlide &gt;= segCmd-&gt;vmaddr &amp;&amp;
                       addressWSlide &lt; segCmd-&gt;vmaddr + segCmd-&gt;vmsize) {
                        <span class="hljs-comment">// æ‰¾åˆ°äº†ï¼Œè¿”å›é•œåƒç´¢å¼•</span>
                        <span class="hljs-keyword">return</span> iImg;
                    }
                }
                <span class="hljs-comment">// å¦‚æœæ˜¯64ä½æ®µå‘½ä»¤</span>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(loadCmd-&gt;cmd == LC_SEGMENT_64) {
                    <span class="hljs-comment">// è½¬æ¢ä¸º64ä½æ®µå‘½ä»¤ç»“æ„ä½“</span>
                    <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> segment_command_64* segCmd = (<span class="hljs-keyword">struct</span> segment_command_64*)cmdPtr;
                    <span class="hljs-comment">// æ£€æŸ¥åœ°å€æ˜¯å¦åœ¨è¯¥æ®µçš„è™šæ‹Ÿåœ°å€èŒƒå›´å†…</span>
                    <span class="hljs-keyword">if</span>(addressWSlide &gt;= segCmd-&gt;vmaddr &amp;&amp;
                       addressWSlide &lt; segCmd-&gt;vmaddr + segCmd-&gt;vmsize) {
                        <span class="hljs-comment">// æ‰¾åˆ°äº†ï¼Œè¿”å›é•œåƒç´¢å¼•</span>
                        <span class="hljs-keyword">return</span> iImg;
                    }
                }
                <span class="hljs-comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªåŠ è½½å‘½ä»¤</span>
                cmdPtr += loadCmd-&gt;cmdsize;
            }
        }
    }
    <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°åŒ…å«è¯¥åœ°å€çš„é•œåƒï¼Œè¿”å›UINT_MAXè¡¨ç¤ºå¤±è´¥</span>
    <span class="hljs-keyword">return</span> UINT_MAX;
}

<span class="hljs-comment">// è·å–æŒ‡å®šé•œåƒç´¢å¼•çš„æ®µåŸºåœ°å€</span>
<span class="hljs-comment">// é€šè¿‡æŸ¥æ‰¾__LINKEDITæ®µæ¥è®¡ç®—æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ˜ å°„åŸºåœ°å€</span>
<span class="hljs-type">uintptr_t</span> <span class="hljs-title function_">bs_segmentBaseOfImageIndex</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> idx)</span> {
    <span class="hljs-comment">// è·å–é•œåƒçš„Mach-Oå¤´éƒ¨</span>
    <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mach_header</span>* <span class="hljs-title">header</span> =</span> _dyld_get_image_header(idx);
    
    <span class="hljs-comment">// æŸ¥æ‰¾æ®µå‘½ä»¤å¹¶è¿”å›æ–‡ä»¶é•œåƒåœ°å€</span>
    <span class="hljs-comment">// è·å–ç¬¬ä¸€ä¸ªåŠ è½½å‘½ä»¤çš„åœ°å€</span>
    <span class="hljs-type">uintptr_t</span> cmdPtr = bs_firstCmdAfterHeader(header);
    <span class="hljs-comment">// å¦‚æœå‘½ä»¤æŒ‡é’ˆæ— æ•ˆï¼Œè¿”å›0</span>
    <span class="hljs-keyword">if</span>(cmdPtr == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    <span class="hljs-comment">// éå†æ‰€æœ‰åŠ è½½å‘½ä»¤</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-type">uint32_t</span> i = <span class="hljs-number">0</span>;i &lt; header-&gt;ncmds; i++) {
        <span class="hljs-comment">// å½“å‰åŠ è½½å‘½ä»¤</span>
        <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">load_command</span>* <span class="hljs-title">loadCmd</span> =</span> (<span class="hljs-keyword">struct</span> load_command*)cmdPtr;
        <span class="hljs-comment">// å¦‚æœæ˜¯32ä½æ®µå‘½ä»¤</span>
        <span class="hljs-keyword">if</span>(loadCmd-&gt;cmd == LC_SEGMENT) {
            <span class="hljs-comment">// è½¬æ¢ä¸º32ä½æ®µå‘½ä»¤ç»“æ„ä½“</span>
            <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segment_command</span>* <span class="hljs-title">segmentCmd</span> =</span> (<span class="hljs-keyword">struct</span> segment_command*)cmdPtr;
            <span class="hljs-comment">// æŸ¥æ‰¾__LINKEDITæ®µï¼ˆåŒ…å«ç¬¦å·è¡¨ã€å­—ç¬¦ä¸²è¡¨ç­‰é“¾æ¥ä¿¡æ¯ï¼‰</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(segmentCmd-&gt;segname, SEG_LINKEDIT) == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// è¿”å›æ®µåŸºåœ°å€ï¼šè™šæ‹Ÿå†…å­˜åœ°å€ - æ–‡ä»¶åç§»</span>
                <span class="hljs-comment">// è¿™ä¸ªå€¼ç”¨äºå°†æ–‡ä»¶åç§»è½¬æ¢ä¸ºè™šæ‹Ÿå†…å­˜åœ°å€</span>
                <span class="hljs-keyword">return</span> segmentCmd-&gt;vmaddr - segmentCmd-&gt;fileoff;
            }
        }
        <span class="hljs-comment">// å¦‚æœæ˜¯64ä½æ®µå‘½ä»¤</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(loadCmd-&gt;cmd == LC_SEGMENT_64) {
            <span class="hljs-comment">// è½¬æ¢ä¸º64ä½æ®µå‘½ä»¤ç»“æ„ä½“</span>
            <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> segment_command_64* segmentCmd = (<span class="hljs-keyword">struct</span> segment_command_64*)cmdPtr;
            <span class="hljs-comment">// æŸ¥æ‰¾__LINKEDITæ®µ</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(segmentCmd-&gt;segname, SEG_LINKEDIT) == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// è¿”å›æ®µåŸºåœ°å€ï¼šè™šæ‹Ÿå†…å­˜åœ°å€ - æ–‡ä»¶åç§»</span>
                <span class="hljs-keyword">return</span> (<span class="hljs-type">uintptr_t</span>)(segmentCmd-&gt;vmaddr - segmentCmd-&gt;fileoff);
            }
        }
        <span class="hljs-comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªåŠ è½½å‘½ä»¤</span>
        cmdPtr += loadCmd-&gt;cmdsize;
    }
    <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°__LINKEDITæ®µï¼Œè¿”å›0</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

@end

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot ä¸ºä»€ä¹ˆçªç„¶åˆ·çˆ†ç¡…è°·ï¼Ÿå®ƒä¸æ˜¯ä¸‹ä¸€ä¸ª ChatGPTï¼Œè€Œæ˜¯å¦ä¸€ç§å¯èƒ½]]></title>    <link>https://juejin.cn/post/7600318091831967771</link>    <guid>https://juejin.cn/post/7600318091831967771</guid>    <pubDate>2026-01-29T05:45:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600318091831967771" data-draft-id="7600489282822979634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot ä¸ºä»€ä¹ˆçªç„¶åˆ·çˆ†ç¡…è°·ï¼Ÿå®ƒä¸æ˜¯ä¸‹ä¸€ä¸ª ChatGPTï¼Œè€Œæ˜¯å¦ä¸€ç§å¯èƒ½"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2026-01-29T05:45:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IvanCodes"/> <meta itemprop="url" content="https://juejin.cn/user/2376493931447594"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot ä¸ºä»€ä¹ˆçªç„¶åˆ·çˆ†ç¡…è°·ï¼Ÿå®ƒä¸æ˜¯ä¸‹ä¸€ä¸ª ChatGPTï¼Œè€Œæ˜¯å¦ä¸€ç§å¯èƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2376493931447594/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IvanCodes
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T05:45:26.000Z" title="Thu Jan 29 2026 05:45:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><b>ä¸€ã€ä¸ºä½•æœ€è¿‘çªç„¶åœ¨æŠ€æœ¯åœˆåˆ·å±ï¼Ÿ</b></h2>
<p>è¿™ä¸¤å¤©æˆ‘åˆ· <b>X</b> å’Œ <b>GitHub</b> ç­‰ä¸»æµå¹³å°çš„æ—¶å€™ï¼Œæœ‰ä¸ªåå­—å‡ºç°å¾—ç‰¹åˆ«é¢‘ç¹ï¼Œé¢‘ç¹åˆ°ä½ æƒ³å¿½ç•¥éƒ½ä¸è¡Œï¼š<b>Clawdbot</b></p>
<p>æ›´ç¦»è°±çš„æ˜¯ï¼Œå®ƒè¿˜æ”¹åäº†ã€‚å®˜æ–¹è¿™ä¸¤å¤©æŠŠåå­—æ”¹æˆäº† <b>Moltbot</b></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72f49c5de7e0402eb64d0bd27906a552~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=qDqPNOMc0L%2BwCrYa86g6ylS6AaM%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å®ƒæ²¡æœ‰å‘å¸ƒä¼šï¼Œæ²¡æœ‰èèµ„æ–°é—»ï¼Œä¹Ÿæ²¡æœ‰é‚£ç§é“ºå¤©ç›–åœ°çš„åª’ä½“é€šç¨¿ã€‚å®ƒçš„ä¼ æ’­è·¯å¾„éå¸¸ç®€å•ç²—æš´ï¼šä¸€ç¾¤æŠ€æœ¯ä½¬æŠŠå®ƒè·‘èµ·æ¥äº†ï¼Œç„¶åå¼€å§‹åœ¨å¹³å°ä¸Šæ™’ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd89173973164cecad5c1791eddc1571~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=hajN7obmO0DMHa6fwaHZxZi0ii4%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å®ƒçš„çƒ­åº¦å¢é•¿éå¸¸æ˜æ˜¾ï¼ŒçŸ­æ—¶é—´å†…ï¼ŒStaræ•°å‘ˆçˆ†ç‚¸å¼å¢é•¿ã€‚GitHubä»“åº“é‡Œçš„staræ•°ï¼Œç°å·²çªç ´70kã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d15dfce1df84cf7b8ad0eb6ec1e7c57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=04%2BhbggoZviOQx4A0d7jAFiKXUU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2aa14012ae54947a7605d0f6fcad96b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=%2FOHSZI2DT2%2F7sylSRz0QknxzSEc%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1"><b>äºŒã€å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯è®²é€</b></h2>
<p>å…ˆæ”¾å®˜ç½‘ï¼š
<a href="https://link.juejin.cn?target=https%3A%2F%2Fclawd.bot%2F" target="_blank" title="https://clawd.bot/" ref="nofollow noopener noreferrer">clawd.bot/</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aab24ace6f444a90a864862fb956c6ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=UbGDhrLdU3kFdRRdyXjjAsl%2FHQs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å¦‚æœä½ é—®æˆ‘å®ƒæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä¼šè¿™æ ·è§£é‡Šï¼š</p>
<p>ChatGPT çš„æ ¸å¿ƒä½“éªŒæ˜¯ <b>ä½ è¾“å…¥ä¸€å¥ï¼Œå®ƒå›ä½ ä¸€æ®µ</b>ã€‚
è€Œ Moltbot çš„æ ¸å¿ƒä½“éªŒæ˜¯ <b>ä½ äº¤ä»£ä¸€å¥ï¼Œå®ƒå»æŠŠäº‹æƒ…åŠäº†</b>ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™ä¸æ˜¯è¡¨è¾¾æ–¹å¼çš„åŒºåˆ«ï¼Œè¿™æ˜¯å®šä½çš„åŒºåˆ«ã€‚</p>
<blockquote>
<p>å®ƒä¸æ˜¯æ¥é™ªä½ èŠå¤©çš„ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªä½åœ¨åå°çš„åŠ©ç†ã€‚
ä½ ä¸éœ€è¦ä¸€ç›´ç›¯ç€å®ƒï¼Œå®ƒä¼šæŒ‚åœ¨é‚£å„¿ï¼Œæ‚„æ‚„è·‘ä»»åŠ¡ã€‚</p>
</blockquote>
<p>æœ€å…³é”®çš„ä¸€ç‚¹æ˜¯ï¼š <b>å®ƒä¸æ˜¯æ›´ä¼šè¯´ï¼Œè€Œæ˜¯æ›´æ•¢åŠ¨ã€‚</b></p>
<p>å®ƒå¯ä»¥è¯»å–ä½ çš„æ—¥å†ã€æ§åˆ¶ä½ çš„æµè§ˆå™¨ã€æ¥å…¥ Discord ç¾¤èŠã€ç”šè‡³å¸®ä½ å‘é‚®ä»¶ã€‚ä½ ä¼šæ„Ÿè§‰å®ƒä¸åƒä¸€ä¸ªç½‘é¡µé‡Œçš„æœºå™¨äººï¼Œè€Œåƒä¸€ä¸ª <b>é•¿åœ¨ä½ ç³»ç»Ÿé‡Œçš„å·¥å…·äºº</b>ã€‚</p>
<h2 data-id="heading-2"><b>ä¸‰ã€å®ƒä¸ºä»€ä¹ˆèƒ½ç«å¾—è¿™ä¹ˆå¿«ï¼Ÿ</b></h2>
<p>æˆ‘è§‰å¾—å®ƒç«å¾—å¿«ï¼ŒåŸå› å…¶å®æŒºç°å®çš„ã€‚</p>
<p>ä»¥å‰æˆ‘ä»¬ç”¨ AIï¼Œå¾ˆå¤šæ—¶å€™æ˜¯åœ¨åšè¡¨æ¼”ã€‚è®©å®ƒå†™æ®µæ–‡æ¡ˆã€ç”Ÿæˆå¼ å›¾ã€ç¼–ä¸ªæ•…äº‹ï¼Œçœ‹èµ·æ¥å¾ˆå‰å®³ï¼Œä½†è·Ÿæ—¥å¸¸å·¥ä½œéš”ç€ä¸€å±‚ã€‚</p>
<p>è€Œ Moltbot èµ°çš„æ˜¯å¦ä¸€æ¡è·¯ï¼šå®ƒä¸è¡¨æ¼”ï¼Œå®ƒç›´æ¥å‚ä¸æµç¨‹ã€‚</p>
<p>ä½ æŠŠå®ƒæ”¾åœ¨åå°ï¼Œå®ƒå°±èƒ½æ›¿ä½ ç›¯ç€ç¾¤é‡Œæœ‰æ²¡æœ‰äººåœ¨æä¸Šçº¿ã€æå‘å¸ƒã€æ deadlineï¼›æœ‰äººæäº†ï¼Œå®ƒå°±è®°ä¸‹æ¥ï¼Œç”šè‡³å¯ä»¥æ¨é€ç»™ä½ ã€‚</p>
<h2 data-id="heading-3"><b>å››ã€ä¿å§†çº§å®‰è£…æ•™ç¨‹</b></h2>
<p>å¾ˆå¤šäººæƒ³è¯•ï¼Œä½†åˆæ€•ã€‚æ€•å®ƒæŠŠç”µè„‘æåã€æ€•å®ƒæƒé™å¤ªå¤§ã€æ€•è‡ªå·±ä¸€ä¸ªæ‰‹æ»‘å°±æŠŠä¸»åŠ›æœºå¼„å´©ã€‚</p>
<p>æ‰€ä»¥æˆ‘ç»™çš„å»ºè®®åªæœ‰ä¸€å¥ï¼š</p>
<p><b>åˆ«åœ¨ä¸»åŠ›æœºè£¸å¥”è·‘ï¼Œæ”¾è™šæ‹Ÿæœºé‡Œç©ã€‚</b></p>
<p>è™šæ‹Ÿæœºçš„å¥½å¤„å°±æ˜¯ï¼Œå‡ºäº†é—®é¢˜ä½ ç›´æ¥åˆ äº†é‡è£…ï¼Œå¹²å‡€åˆ©è½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/232ff9cd38e54a2e997ebaa8832e5c0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=Gy2kB%2FaZUaXTeKPeLS5reFqc9YM%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å‡†å¤‡å·¥ä½œå¾ˆç®€å•ï¼šè£… VMware Workstationï¼Œç„¶åè£…ä¸€ä¸ª Ubuntuï¼Œç¡®ä¿èƒ½è”ç½‘å°±è¡Œã€‚</p>
<h3 data-id="heading-4"><b>ç¬¬ä¸€æ­¥ï¼šæŠŠç¯å¢ƒé“ºå¥½</b></h3>
<p>Moltbot ä¾èµ– <b>Node.js</b> å’Œ <b>Git</b>ã€‚æ–°ç¯å¢ƒå…ˆæŠŠåŸºç¡€å·¥å…·è£…é½ã€‚</p>
<p>1.æ›´æ–°æº</p>
<pre><code class="hljs language-bash" lang="bash">apt update 
apt install -y nodejs
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e48c3413feeb40ffafa4d0b52a3c6aa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=Up0DTsAnC2MdZoe4kNLyNBkyFHY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ç­‰å¾…å®‰è£…å®Œæˆ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8c8820a4e174b2ab9997d107586c83e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=g00g%2BGAOLm0EbfSQR0R2ZEf6Czs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>2.æ£€æŸ¥ç‰ˆæœ¬ï¼Œç¡®è®¤ç¯å¢ƒæ²¡é—®é¢˜</p>
<pre><code class="hljs language-bash" lang="bash">node -v
npm -v
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260d243b440b487688e2a7d7804d75a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=ZbBjeflxNhs1uEulJkSx7u4Xdx8%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-5"><b>ç¬¬äºŒæ­¥ï¼šä¸€é”®å®‰è£… Moltbot</b></h3>
<p>ç¯å¢ƒå‡†å¤‡å¥½åï¼Œç›´æ¥è·‘å®˜æ–¹çš„ä¸€é”®å®‰è£…è„šæœ¬å³å¯ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://clawd.bot/install.sh | bash
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/770ce453fd09456c92c1595f72d64b2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=l%2Bd%2BvuHTlw5034FNmqXCDuOmJS4%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
æ¥ç€å®ƒä¼šåœ¨å±å¹•ä¸Šåˆ·å‡ºä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ç”»ï¼Œå†™ç€ CLAWDBOTã€‚</p>
<p>çœ‹åˆ°è¿™å¼ å›¾ï¼ŒåŸºæœ¬å°±è¯´æ˜ä½ è£…å¯¹äº†</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/906b15cd48e847b2bde8a59ed0f4e2fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=zt2C3ixarcXMyNVtTb2iWNZYFzA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-6"><b>ç¬¬ä¸‰æ­¥ï¼šå®‰å…¨è­¦å‘Šåˆ«è·³è¿‡</b></h3>
<p>åé¢ä¼šè¯´èƒ½æ‰§è¡Œå‘½ä»¤ã€èƒ½è¯»å†™æ–‡ä»¶ã€èƒ½æ¥å…¥å„ç§æœåŠ¡
ä¸€æ—¦è¢«è¯±å¯¼ã€è¢«æ”»å‡»ã€æˆ–è€…ä½ è‡ªå·±æ“ä½œä¸å½“ï¼Œéƒ½å¯èƒ½é€ æˆé£é™©</p>
<p>ä¸‹é¢è¿™å¼ å›¾å°±æ˜¯å®ƒå¼¹å‡ºçš„å®‰å…¨è­¦å‘Šä¹‹ä¸€</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54a56eb10bdd4ab290a1a0cc4446a23f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=mWfJ2saUcqzCuu5omHnuxI7a73E%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å¦‚æœä½ æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œï¼Œè¿™æ—¶å€™å°±å¾ˆèˆ’æœäº†ã€‚
ä½ å¯ä»¥æ”¾å¿ƒè¾“å…¥ <b>Yes</b>ï¼Œç»§ç»­ã€‚</p>
<h3 data-id="heading-7"><b>ç¬¬å››æ­¥ï¼šé…ç½®æ¨¡å‹å’Œæ¸ é“</b></h3>
<p>å®‰è£…å®Œæˆåå®ƒä¼šå¼•å¯¼é…ç½®ï¼Œå¹¶å‘Šè¯‰ä½  Gateway çš„ç«¯å£æ˜¯ <b>18789</b>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0ddda1c5552476581187c2e41e5fbe2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=9JCZN2HkP%2B0aMdw5mmJho3GVjnY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥æ˜¯é€‰æ¨¡å‹ã€‚</p>
<p>å®ƒæ”¯æŒå¾ˆå¤šä¸»æµæ¨¡å‹ï¼Œä¸ºäº†å›½å†…è®¿é—®ç¨³å®šã€ä¸­æ–‡å¥½ç”¨ã€ä»·æ ¼ä¹Ÿä¸ç¦»è°±ï¼Œæˆ‘è¿™é‡Œé€‰çš„æ˜¯ <b>Moonshot AIï¼ˆKimiï¼‰</b>ã€‚</p>
<p>è¿™å¼ å›¾å°±æ˜¯æ¨¡å‹é€‰æ‹©é¡µé¢ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f22b2224ed19499f904b34f69d0ee0b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=DN10TdONsEZ5aRm7%2FsNkgVtP134%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>é€‰å®Œä¹‹åè¾“å…¥ API Keyï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ec0278e42554f0b821df935edd4bfa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=et6%2FDtrWwsvxDiZVvImOyBMf24E%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ç„¶åå®ƒä¼šè®©ä½ é€‰æ¥å…¥æ¸ é“ã€‚è¿™é‡Œæˆ‘ç”¨ Discord ä¸¾ä¾‹ï¼Œå› ä¸ºæœ€é€‚åˆå½“æœºå™¨äººå®¿ä¸»ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c653b7af69644d5bafdb89cc0990dea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=maKyb%2FIy78ZTyQgpNjc4ZIOYGyE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-8"><b>ç¬¬äº”æ­¥ï¼šæŠŠ Discord çš„æœºå™¨äººæ‰“é€š</b></h3>
<p>è¿™ä¸€æ­¥æ˜¯æœ€å®¹æ˜“å¡äººçš„ï¼Œä½†å…¶å®æµç¨‹å¾ˆå›ºå®šã€‚</p>
<p>åœ¨ Discord Developer Portalï¼Œæ–°å»ºä¸€ä¸ª Applicationï¼Œåå­—éšä¾¿å–ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48c00cb79f0946638e5d731ae53f2a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=mPzAzAzNf0IA9I8D21PjmILZ1NU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ç„¶åç‚¹ Botï¼Œé‡ç½® Token å¹¶å¤åˆ¶ã€‚
è¿™ä¸ª Token å¾ˆé‡è¦ï¼Œå®ƒå°±æ˜¯ä½ æœºå™¨äººå”¯ä¸€çš„èº«ä»½è¯ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0ccc3399e8b4a1c9b83a3d563a4af8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=hUEiNRogclyo%2B1FgaMRDrKhEDTQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å¤åˆ¶å®Œå›åˆ°è™šæ‹Ÿæœºï¼ŒæŠŠ Token ç²˜è¿›å»ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ef2b0e987e24e0d8be7a9c791667ec6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=ceRjryO2LvmyeZbHMyPPYY%2B2VRM%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>è¿™é‡Œæˆ‘å¿…é¡»å¼ºè°ƒä¸€å¥ï¼š <b>ç™½åå•ä¸€å®šè¦é…ã€‚</b>
ä¸ç„¶åˆ«äººéšä¾¿ @ ä½ çš„æœºå™¨äººï¼Œè®©å®ƒå¹²ç‚¹ä»€ä¹ˆï¼Œä½ å“­éƒ½æ¥ä¸åŠã€‚</p>
<h3 data-id="heading-9"><b>ç¬¬å…­æ­¥ï¼šè£…æŠ€èƒ½</b></h3>
<p>Moltbot æœ¬ä½“åªæ˜¯æ¡†æ¶ï¼Œå®ƒçš„èƒ½åŠ›æ¥è‡ª Skillsã€‚
æ¯”å¦‚è¯» Notionã€æ“ä½œæ—¥å†ã€ç®¡ç†æ–‡ä»¶ä¹‹ç±»çš„ï¼Œéƒ½è¦é æŠ€èƒ½è¡¥é½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76c242be9c884f22850671abd52c9f50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=NFwAWez70kkS0%2BmKcAai3RwKuRM%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸€äº›æŠ¥é”™æç¤ºï¼Œæ¯”å¦‚ hooksã€systemdã€‚
åªè¦ä¸æ˜¯é‚£ç§ç›´æ¥å´©æ‰çš„è‡´å‘½é”™è¯¯ï¼Œå¾ˆå¤šéƒ½å¯ä»¥è·³è¿‡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21b94555f5c84520ae7a564e12d634d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=U%2Fy2QVaC3rZcDbFnnraROnEDB%2Fs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-10"><b>ç¬¬ä¸ƒæ­¥ï¼šå¯åŠ¨å¹¶è®¿é—®æ§åˆ¶å°</b></h3>
<p>å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">clawdbot gateway --verbose --<span class="hljs-built_in">bind</span> lan --port 18789 --allow-unconfigured
</code></pre>
<p>å½“ä½ çœ‹åˆ°ä¸‹é¢è¿™å¼ å›¾è¿™ç§ç»¿è‰²æ—¥å¿—ï¼Œè¯´æ˜ gateway å·²ç»ç›‘å¬æˆåŠŸäº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50cd86160c6548df8bd92866798d4f51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=Z0xzpL1xnALH%2B0%2FDy78WMI0G6AY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>ç„¶åä½ æ‰“å¼€æµè§ˆå™¨è®¿é—®è™šæ‹Ÿæœº <code>IP:18789</code>ï¼Œä¼šçœ‹åˆ°æ§åˆ¶å°ç•Œé¢ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/738469116df14154a68f28a667865cd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSXZhbkNvZGVz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770270326&amp;x-signature=SWgCTdv8rC%2FspFaHrpFvhmcTpXs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h2 data-id="heading-11"><b>äº”ã€å®ƒåˆ°åº•èƒ½å¹²å˜›ï¼Ÿæˆ‘å°†ä»‹ç»ä¸¤ä¸ªåœºæ™¯</b></h2>
<p>åˆ«æŠŠå®ƒå½“æˆèŠå¤©æœºå™¨äººã€‚<strong>æˆ‘æ²¡æœ‰æŠŠå®ƒå½“äººèŠï¼Œè€Œæ˜¯æŠŠå®ƒå½“é¬¼ç”¨ã€‚</strong></p>
<h3 data-id="heading-12"><strong>åœºæ™¯ä¸€ï¼šæŠŠå®ƒæ‹‰è¿› Discordï¼Œå½“æ°¸è¿œåœ¨çº¿çš„ç¾¤ç§˜</strong></h3>
<p>æˆ‘æ²¡æœ‰å•ç‹¬è·Ÿ Moltbot èŠå¤©ï¼Œè€Œæ˜¯ç›´æ¥æŠŠå®ƒæ‹‰è¿›äº†ä¸€ä¸ª Discord ç¾¤ã€‚</p>
<p><strong>æˆ‘çš„æŒ‡ä»¤ï¼š</strong></p>
<blockquote>
<p>@clawdbot ä»¥åè¿™ä¸ªç¾¤é‡Œï¼Œåªè¦æœ‰äººè®¨è®ºåˆ°ã€Œå‘å¸ƒã€ã€Œä¸Šçº¿ã€ã€Œdeadlineã€ï¼Œéƒ½å¸®æˆ‘è®°ä¸‹æ¥ã€‚</p>
</blockquote>
<p><strong>æ•ˆæœï¼š</strong>
åŠå°æ—¶åï¼Œç¾¤é‡Œæœ‰äººéšå£è¯´äº†ä¸€å¥ï¼šâ€œä¸‹å‘¨ä¸‰ä¹‹å‰å¾—æŠŠè¿™ä¸ªåŠŸèƒ½å‘äº†ã€‚â€
å‡ åˆ†é’Ÿåï¼ŒMoltbot é»˜é»˜åœ°ç»™æˆ‘å‘äº†ä¸€æ¡ç§ä¿¡ï¼š</p>
<blockquote>
<p>ã€Œå·²è®°å½•å…³é”®ä¿¡æ¯ï¼šåŠŸèƒ½å‘å¸ƒ Deadlineï¼Œä¸‹å‘¨ä¸‰ã€‚ã€</p>
</blockquote>
<p>å®ƒå°±åƒä¸€ä¸ªæ°¸è¿œä¸ç¡è§‰ã€åœ¨æ—è¾¹é»˜é»˜å¬ä¼šçš„åŒäº‹ã€‚</p>
<h3 data-id="heading-13"><strong>åœºæ™¯äºŒï¼šæŠŠç¢è¯­å˜æˆæ–‡æ¡£</strong></h3>
<p>ä½ åœ¨ Discord é‡Œè·Ÿäººå¤´è„‘é£æš´ï¼Œæƒ³æ³•å¾ˆä¹±ã€‚
ä½ å¯¹ Moltbot è¯´ï¼š</p>
<blockquote>
<p>æŠŠåˆšæ‰æˆ‘ä»¬è®¨è®ºçš„å†…å®¹ï¼Œæ•´ç†æˆä¸€ç¯‡æ–‡æ¡£ï¼Œæ ‡é¢˜å«ã€Œå…¬ä¼—å·é€‰é¢˜è‰ç¨¿ã€ï¼Œè¦åˆ†å¥½æ®µã€‚</p>
</blockquote>
<p>ä½ ç”šè‡³ä¸ç”¨æ‰“å¼€ç¬”è®°è½¯ä»¶ï¼Œå®ƒä¼šåœ¨åå°ç›´æ¥è°ƒç”¨ APIï¼Œåœ¨ä½ æŒ‡å®šçš„ Notion æˆ–æœ¬åœ°æ–‡ä»¶é‡Œç”Ÿæˆå¥½æ–‡æ¡£ã€‚è¿™ç§æ„Ÿè§‰éå¸¸å¥‡å¦™ã€‚</p>
<h2 data-id="heading-14"><b>å…­ã€äº‰è®®ï¼šä¸ºä»€ä¹ˆå®ƒè¶Šç«ï¼Œè¶Šè®©äººå®³æ€•ï¼Ÿ</b></h2>
<p>å®ƒè¶Šç«ï¼Œå°±è¶Šå¤šäººå¼€å§‹æ‹…å¿ƒï¼Œè¿™ä¸ªæ‹…å¿ƒä¹Ÿä¸æ˜¯çŸ«æƒ…ã€‚</p>
<p>å› ä¸º Moltbot çš„å¼ºå¤§æ¥è‡ªå®ƒçš„æƒé™ã€‚
æƒé™è¶Šå¤§ï¼Œé£é™©è¶Šå¤§ã€‚</p>
<p>å½“ä¸€ä¸ª AI èƒ½è¯»ä½ çš„é‚®ä»¶ã€åŠ¨ä½ çš„æ–‡ä»¶ã€æ‰§è¡Œä½ çš„ç»ˆç«¯å‘½ä»¤ï¼Œå®ƒå°±ä¸åªæ˜¯åŠ©æ‰‹äº†ï¼Œå®ƒæ›´åƒä¸€ä¸ªæ‹¿ç€ä½ å®¶é’¥åŒ™çš„äººã€‚</p>
<p>æ›´éº»çƒ¦çš„æ˜¯ï¼Œå¤§æ¨¡å‹å¤©ç”Ÿæœ‰æç¤ºè¯æ³¨å…¥çš„é—®é¢˜ã€‚
ä½ æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰äººåœ¨ç¾¤é‡Œå‘ä¸€æ®µè¯±å¯¼æ–‡æœ¬ï¼Œè®© Moltbot æ‰§è¡Œå±é™©å‘½ä»¤ã€‚</p>
<p>è¿™ä¸æ˜¯ç§‘å¹»ï¼Œè¿™æ˜¯ç°å®å®‰å…¨é¢†åŸŸæ­£åœ¨è®¨è®ºçš„äº‹ã€‚</p>
<p>æ‰€ä»¥æˆ‘æ‰åå¤å¼ºè°ƒï¼š <b>è™šæ‹Ÿæœºéš”ç¦»æ˜¯åº•çº¿</b></p>
<hr/>
<h2 data-id="heading-15"><b>ä¸ƒã€æœ€åçš„è¯</b></h2>
<p>Moltbot ç°åœ¨è¿˜æ—©æœŸï¼Œbug å¤šã€é…ç½®éº»çƒ¦ã€ç”Ÿæ€ä¹Ÿä¸æˆç†Ÿã€‚å®ƒä¸æ˜¯é‚£ç§è£…ä¸Šå°±èƒ½çˆ½ç”¨çš„äº§å“ã€‚</p>
<p>ä½†å®ƒç¡®å®æŠŠæ–¹å‘æŒ‡å¾—å¾ˆæ¸…æ¥šï¼š</p>
<p><b>AI ä¸åº”è¯¥è¢«å›°åœ¨èŠå¤©æ¡†é‡Œã€‚</b></p>
<p>å®ƒåº”è¯¥è¿›ç³»ç»Ÿã€è¿›æµç¨‹ã€è¿›ç¾¤èŠã€è¿›åå°ï¼Œåƒç©ºæ°”ä¸€æ ·å­˜åœ¨ã€‚</p>
<p><b>å®ƒä¸å®Œç¾ï¼Œä½†å®ƒå¾ˆå±é™©ï¼Œä¹Ÿå¾ˆè¿·äººã€‚</b></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin flowçš„ç®€å•äº†è§£]]></title>    <link>https://juejin.cn/post/7600560664407425087</link>    <guid>https://juejin.cn/post/7600560664407425087</guid>    <pubDate>2026-01-29T08:44:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600560664407425087" data-draft-id="7600333405979852841" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin flowçš„ç®€å•äº†è§£"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-29T08:44:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yen"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426633214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin flowçš„ç®€å•äº†è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426633214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T08:44:41.000Z" title="Thu Jan 29 2026 08:44:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ç®€å•ç”¨æ³•</h2>
<h3 data-id="heading-1">1. Flow æ¦‚è¿°</h3>
<p>Flow æ˜¯ Kotlin åç¨‹åº“ä¸­ç”¨äºå¤„ç†å¼‚æ­¥æ•°æ®æµçš„ APIï¼Œç±»ä¼¼äº RxJava çš„ Observableï¼Œä½†æ›´è½»é‡ä¸”ä¸åç¨‹æ·±åº¦é›†æˆã€‚</p>
<h4 data-id="heading-2">ä¸»è¦ç‰¹ç‚¹ï¼š</h4>
<ul>
<li><strong>å†·æµï¼ˆCold Streamï¼‰</strong> ï¼šæ¶ˆè´¹è€…è§¦å‘æ—¶æ‰æ‰§è¡Œ</li>
<li><strong>åŸºäºåç¨‹</strong>ï¼šå¤©ç„¶æ”¯æŒæŒ‚èµ·å‡½æ•°</li>
<li><strong>å“åº”å¼ç¼–ç¨‹</strong>ï¼šæ”¯æŒå‡½æ•°å¼æ“ä½œç¬¦</li>
<li><strong>ç»“æ„åŒ–å¹¶å‘</strong>ï¼šè‡ªåŠ¨å–æ¶ˆå’Œèµ„æºæ¸…ç†</li>
</ul>
<h3 data-id="heading-3">2. Flow çš„åˆ›å»º</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. flow {} æ„å»ºå™¨</span>
<span class="hljs-keyword">val</span> flow1 = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// æŒ‚èµ·å‡½æ•°</span>
        emit(i)    <span class="hljs-comment">// å‘å°„å€¼</span>
    }
}

<span class="hljs-comment">// 2. asFlow() æ‰©å±•å‡½æ•°</span>
<span class="hljs-keyword">val</span> flow2 = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).asFlow()
<span class="hljs-keyword">val</span> flow3 = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()

<span class="hljs-comment">// 3. flowOf()</span>
<span class="hljs-keyword">val</span> flow4 = flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)

<span class="hljs-comment">// 4. channelFlow - æ”¯æŒå¤æ‚å¼‚æ­¥åœºæ™¯</span>
<span class="hljs-keyword">val</span> flow5 = channelFlow {
    send(<span class="hljs-number">1</span>)
    withContext(Dispatchers.IO) {
        send(<span class="hljs-number">2</span>)
    }
}
</code></pre>
<h3 data-id="heading-4">3. Flow æ“ä½œç¬¦</h3>
<h4 data-id="heading-5">ä¸­é—´æ“ä½œç¬¦ï¼ˆIntermediate Operatorsï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è½¬æ¢æ“ä½œ</span>
flow.map { it * <span class="hljs-number">2</span> }                    <span class="hljs-comment">// æ˜ å°„</span>
flow.filter { it &gt; <span class="hljs-number">5</span> }                 <span class="hljs-comment">// è¿‡æ»¤</span>
flow.transform { value -&gt;
    emit(<span class="hljs-string">"Value: <span class="hljs-variable">$value</span>"</span>)
    emit(value * <span class="hljs-number">10</span>)
}

<span class="hljs-comment">// é™é•¿æ“ä½œ</span>
flow.take(<span class="hljs-number">2</span>)                           <span class="hljs-comment">// å–å‰ä¸¤ä¸ª</span>
flow.takeWhile { it &lt; <span class="hljs-number">3</span> }              <span class="hljs-comment">// æ¡ä»¶å–</span>

<span class="hljs-comment">// ç»„åˆæ“ä½œ</span>
<span class="hljs-keyword">val</span> flowA = flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
<span class="hljs-keyword">val</span> flowB = flowOf(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)

flowA.zip(flowB) { a, b -&gt; <span class="hljs-string">"<span class="hljs-variable">$a</span> -&gt; <span class="hljs-variable">$b</span>"</span> } <span class="hljs-comment">// å‹ç¼©</span>
flowA.combine(flowB) { a, b -&gt; <span class="hljs-string">"<span class="hljs-variable">$a</span> - <span class="hljs-variable">$b</span>"</span> } <span class="hljs-comment">// ç»„åˆï¼ˆæœ€æ–°å€¼ï¼‰</span>

<span class="hljs-comment">// å±•å¹³æ“ä½œ</span>
flow.flatMapConcat { value -&gt;          <span class="hljs-comment">// é¡ºåºè¿æ¥</span>
    flowOf(value, value * <span class="hljs-number">2</span>)
}
flow.flatMapMerge { value -&gt;           <span class="hljs-comment">// å¹¶å‘åˆå¹¶</span>
    flow {
        delay(<span class="hljs-number">100</span>)
        emit(value)
    }
}
flow.flatMapLatest { value -&gt;          <span class="hljs-comment">// æœ€æ–°å€¼</span>
    flow {
        delay(<span class="hljs-number">100</span>)
        emit(value)
    }
}
</code></pre>
<h4 data-id="heading-6">ç»ˆç«¯æ“ä½œç¬¦ï¼ˆTerminal Operatorsï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ”¶é›†å€¼</span>
flow.collect { value -&gt;
    println(value)
}

<span class="hljs-comment">// è½¬æ¢ä¸ºé›†åˆ</span>
<span class="hljs-keyword">val</span> list = flow.toList()
<span class="hljs-keyword">val</span> <span class="hljs-keyword">set</span> = flow.toSet()

<span class="hljs-comment">// èšåˆæ“ä½œ</span>
<span class="hljs-keyword">val</span> sum = flow.reduce { acc, value -&gt; acc + value }
<span class="hljs-keyword">val</span> sum2 = flow.fold(<span class="hljs-number">0</span>) { acc, value -&gt; acc + value }

<span class="hljs-comment">// è·å–å•ä¸ªå€¼</span>
<span class="hljs-keyword">val</span> first = flow.first()
<span class="hljs-keyword">val</span> firstOrNull = flow.firstOrNull()
<span class="hljs-keyword">val</span> single = flow.single()  <span class="hljs-comment">// ç¡®ä¿åªæœ‰ä¸€ä¸ªå€¼</span>

<span class="hljs-comment">// è®¡æ•°</span>
<span class="hljs-keyword">val</span> count = flow.count()
</code></pre>
<h3 data-id="heading-7">4. å¼‚å¸¸å¤„ç†</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// catch æ“ä½œç¬¦</span>
flow.<span class="hljs-keyword">catch</span> { cause -&gt;
    println(<span class="hljs-string">"Caught exception: <span class="hljs-variable">$cause</span>"</span>)
    emit(-<span class="hljs-number">1</span>)  <span class="hljs-comment">// å‘å°„å¤‡ç”¨å€¼</span>
}.collect { value -&gt;
    println(value)
}

<span class="hljs-comment">// å£°æ˜å¼å¼‚å¸¸å¤„ç†</span>
flow.onCompletion { cause -&gt;
    cause?.let { println(<span class="hljs-string">"Flow completed exceptionally: <span class="hljs-variable">$it</span>"</span>) }
        ?: println(<span class="hljs-string">"Flow completed successfully"</span>)
}

<span class="hljs-comment">// ç¤ºä¾‹ï¼šå¤šå±‚æ•è·</span>
flow
    .map { it * <span class="hljs-number">2</span> }
    .<span class="hljs-keyword">catch</span> { emit(-<span class="hljs-number">1</span>) }  <span class="hljs-comment">// åªæ•è·ä¸Šæ¸¸å¼‚å¸¸</span>
    .collect { value -&gt;
        <span class="hljs-keyword">try</span> {
            println(value)
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// å¤„ç†æ”¶é›†ç«¯å¼‚å¸¸</span>
        }
    }
</code></pre>
<h3 data-id="heading-8">5. ä¸Šä¸‹æ–‡å’Œçº¿ç¨‹åˆ‡æ¢</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// flowOn - æŒ‡å®šä¸Šæ¸¸æ“ä½œçš„ä¸Šä¸‹æ–‡</span>
flow
    .map { it * <span class="hljs-number">2</span> }                    <span class="hljs-comment">// åœ¨ IO çº¿ç¨‹æ‰§è¡Œ</span>
    .flowOn(Dispatchers.IO)
    .collect { value -&gt;                <span class="hljs-comment">// åœ¨è°ƒç”¨è€…ä¸Šä¸‹æ–‡æ‰§è¡Œ</span>
        println(value)
    }

<span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šä¸è¦åœ¨ flow æ„å»ºå™¨ä¸­åˆ‡æ¢ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">val</span> wrongFlow = flow {
    withContext(Dispatchers.IO) {      <span class="hljs-comment">// âŒ é”™è¯¯ï¼</span>
        emit(<span class="hljs-number">1</span>)
    }
}

<span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ channelFlow æˆ– flowOn</span>
<span class="hljs-keyword">val</span> correctFlow = flow {
    emit(<span class="hljs-number">1</span>)
}.flowOn(Dispatchers.IO)
</code></pre>
<h3 data-id="heading-9">6. èƒŒå‹ï¼ˆBackpressureï¼‰å¤„ç†</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç¼“å†²</span>
flow.buffer()                          <span class="hljs-comment">// é»˜è®¤ç¼“å†²</span>
flow.buffer(<span class="hljs-number">10</span>)                        <span class="hljs-comment">// æŒ‡å®šç¼“å†²å¤§å°</span>

<span class="hljs-comment">// åˆå¹¶ï¼ˆè·³è¿‡ä¸­é—´å€¼ï¼‰</span>
flow.conflate()                        <span class="hljs-comment">// åªå¤„ç†æœ€æ–°å€¼</span>

<span class="hljs-comment">// æ”¶é›†æœ€æ–°å€¼</span>
flow.collectLatest { value -&gt;
    <span class="hljs-comment">// å¦‚æœæ–°å€¼åˆ°è¾¾ï¼Œå–æ¶ˆå½“å‰å¤„ç†</span>
    delay(<span class="hljs-number">300</span>)  <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
    println(value)
}
</code></pre>
<h3 data-id="heading-10">7. çƒ­æµï¼ˆHot Flowï¼‰</h3>
<h4 data-id="heading-11">SharedFlow</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åˆ›å»º SharedFlow</span>
<span class="hljs-keyword">val</span> sharedFlow = MutableSharedFlow&lt;<span class="hljs-built_in">Int</span>&gt;(
    replay = <span class="hljs-number">2</span>,          <span class="hljs-comment">// æ–°è®¢é˜…è€…æ¥æ”¶çš„å†å²å€¼æ•°é‡</span>
    extraBufferCapacity = <span class="hljs-number">10</span>  <span class="hljs-comment">// é¢å¤–ç¼“å†²</span>
)

<span class="hljs-comment">// å‘å°„å€¼</span>
viewModelScope.launch {
    sharedFlow.emit(<span class="hljs-number">1</span>)
}

<span class="hljs-comment">// æ”¶é›†å€¼</span>
sharedFlow.collect { value -&gt;
    println(<span class="hljs-string">"Collector 1: <span class="hljs-variable">$value</span>"</span>)
}

<span class="hljs-comment">// shareIn - å°†å†·æµè½¬ä¸ºçƒ­æµ</span>
<span class="hljs-keyword">val</span> coldFlow = flow {
    repeat(<span class="hljs-number">10</span>) {
        emit(it)
        delay(<span class="hljs-number">100</span>)
    }
}

<span class="hljs-keyword">val</span> hotFlow = coldFlow.shareIn(
    scope = viewModelScope,
    started = SharingStarted.WhileSubscribed(),  <span class="hljs-comment">// è®¢é˜…æ—¶å¼€å§‹</span>
    replay = <span class="hljs-number">1</span>
)

<span class="hljs-comment">// started å‚æ•°é€‰é¡¹ï¼š</span>
<span class="hljs-comment">// SharingStarted.Eagerly    - ç«‹å³å¼€å§‹</span>
<span class="hljs-comment">// SharingStarted.Lazily     - ç¬¬ä¸€ä¸ªè®¢é˜…è€…å‡ºç°æ—¶å¼€å§‹</span>
<span class="hljs-comment">// SharingStarted.WhileSubscribed() - æœ‰è®¢é˜…è€…æ—¶å¼€å§‹</span>
</code></pre>
<h4 data-id="heading-12">StateFlow</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åˆ›å»º StateFlow</span>
<span class="hljs-keyword">val</span> stateFlow = MutableStateFlow(<span class="hljs-number">0</span>)  <span class="hljs-comment">// éœ€è¦åˆå§‹å€¼</span>

<span class="hljs-comment">// æ›´æ–°å€¼ï¼ˆè‡ªåŠ¨å»é‡ï¼‰</span>
stateFlow.value = <span class="hljs-number">1</span>
stateFlow.tryEmit(<span class="hljs-number">2</span>)

<span class="hljs-comment">// æ”¶é›†å€¼ï¼ˆè‡ªåŠ¨æ¥æ”¶æœ€æ–°å€¼å’Œåç»­æ›´æ–°ï¼‰</span>
stateFlow.collect { value -&gt;
    println(<span class="hljs-string">"Current state: <span class="hljs-variable">$value</span>"</span>)
}

<span class="hljs-comment">// stateIn - å°† Flow è½¬æ¢ä¸º StateFlow</span>
<span class="hljs-keyword">val</span> state = flow {
    emit(<span class="hljs-number">1</span>)
    delay(<span class="hljs-number">1000</span>)
    emit(<span class="hljs-number">2</span>)
}.stateIn(
    scope = viewModelScope,
    started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>),  <span class="hljs-comment">// 5ç§’åæ— è®¢é˜…è€…åœæ­¢</span>
    initialValue = <span class="hljs-number">0</span>
)
</code></pre>
<h3 data-id="heading-13">8. Flow ç”Ÿå‘½å‘¨æœŸ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">flow
    .onStart { 
        println(<span class="hljs-string">"Flow started"</span>) 
    }
    .onEach { value -&gt;
        println(<span class="hljs-string">"Emitted: <span class="hljs-variable">$value</span>"</span>)
    }
    .onCompletion { cause -&gt;
        cause?.let { println(<span class="hljs-string">"Completed with exception: <span class="hljs-variable">$it</span>"</span>) }
            ?: println(<span class="hljs-string">"Completed successfully"</span>)
    }
    .<span class="hljs-keyword">catch</span> { cause -&gt;
        println(<span class="hljs-string">"Caught: <span class="hljs-variable">$cause</span>"</span>)
    }
    .collect()
</code></pre>
<h3 data-id="heading-14">9. å®é™…åº”ç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-15">ç¤ºä¾‹ 1ï¼šç½‘ç»œè¯·æ±‚é‡è¯•</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchDataWithRetry</span><span class="hljs-params">()</span></span>: Flow&lt;Result&gt; = flow {
    <span class="hljs-keyword">var</span> retryCount = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> result = api.fetchData()
            emit(Result.Success(result))
            <span class="hljs-keyword">break</span>
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            retryCount++
            <span class="hljs-keyword">if</span> (retryCount &gt; MAX_RETRIES) {
                emit(Result.Error(e))
                <span class="hljs-keyword">break</span>
            }
            delay(retryCount * <span class="hljs-number">1000L</span>)  <span class="hljs-comment">// æŒ‡æ•°é€€é¿</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-16">ç¤ºä¾‹ 2ï¼šæœç´¢é˜²æŠ–</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">search</span><span class="hljs-params">(queryFlow: <span class="hljs-type">Flow</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span>: Flow&lt;List&lt;Result&gt;&gt; = queryFlow
    .debounce(<span class="hljs-number">300</span>)                    <span class="hljs-comment">// é˜²æŠ– 300ms</span>
    .distinctUntilChanged()           <span class="hljs-comment">// å»é‡</span>
    .filter { it.length &gt;= <span class="hljs-number">2</span> }        <span class="hljs-comment">// æœ€å°é•¿åº¦</span>
    .flatMapLatest { query -&gt;         <span class="hljs-comment">// å–æ¶ˆå‰ä¸€ä¸ªæœç´¢</span>
        <span class="hljs-keyword">if</span> (query.isEmpty()) {
            flowOf(emptyList())
        } <span class="hljs-keyword">else</span> {
            flow {
                emit(emptyList&lt;Result&gt;())  <span class="hljs-comment">// æ˜¾ç¤ºåŠ è½½çŠ¶æ€</span>
                <span class="hljs-keyword">val</span> results = api.search(query)
                emit(results)
            }.<span class="hljs-keyword">catch</span> { emit(emptyList()) }  <span class="hljs-comment">// é”™è¯¯æ—¶è¿”å›ç©º</span>
        }
    }
    .flowOn(Dispatchers.IO)
</code></pre>
<h4 data-id="heading-17">ç¤ºä¾‹ 3ï¼šç»„åˆå¤šä¸ªæ•°æ®æº</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeUserData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Flow&lt;UserData&gt; {
    <span class="hljs-keyword">val</span> localFlow = database.observeUser(userId)
    <span class="hljs-keyword">val</span> remoteFlow = api.getUserStream(userId)
    
    <span class="hljs-keyword">return</span> merge(localFlow, remoteFlow)
        .distinctUntilChanged()
        .onEach { user -&gt;
            database.saveUser(user)
        }
}
</code></pre>
<h3 data-id="heading-18">10. æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. é¿å…ä¸å¿…è¦çš„ä¸­é—´æ“ä½œ</span>
flow
    .filter { it &gt; <span class="hljs-number">0</span> }     <span class="hljs-comment">// å°½æ—©è¿‡æ»¤å‡å°‘åç»­æ“ä½œ</span>
    .map { it * <span class="hljs-number">2</span> }

<span class="hljs-comment">// 2. åˆç†ä½¿ç”¨ buffer</span>
flow
    .buffer()              <span class="hljs-comment">// ç”Ÿäº§å’Œæ¶ˆè´¹å¹¶å‘æ‰§è¡Œ</span>
    .collect { value -&gt;
        delay(<span class="hljs-number">100</span>)         <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ¶ˆè´¹</span>
        println(value)
    }

<span class="hljs-comment">// 3. ä½¿ç”¨ shareIn/stateIn é¿å…é‡å¤è®¡ç®—</span>
<span class="hljs-keyword">val</span> sharedData = expensiveFlow
    .shareIn(scope, SharingStarted.Lazily)

<span class="hljs-comment">// 4. é€‚æ—¶å–æ¶ˆä¸å¿…è¦çš„æµ</span>
scope.launch {
    withTimeout(<span class="hljs-number">5000</span>) {
        flow.collect { value -&gt;
            <span class="hljs-keyword">if</span> (value == TARGET) {
                <span class="hljs-keyword">return</span><span class="hljs-symbol">@withTimeout</span>  <span class="hljs-comment">// æ‰¾åˆ°ç›®æ ‡åå–æ¶ˆ</span>
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-19">11. å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ</h3>
<h4 data-id="heading-20">é™·é˜±ï¼š</h4>
<ul>
<li><strong>åœ¨ flow æ„å»ºå™¨ä¸­ä½¿ç”¨ withContext</strong>Â âŒ</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯</span>
flow { withContext(Dispatchers.IO) { emit(<span class="hljs-number">1</span>) } }

<span class="hljs-comment">// æ­£ç¡®</span>
flow { emit(<span class="hljs-number">1</span>) }.flowOn(Dispatchers.IO)
</code></pre>
<ul>
<li><strong>æ•è·å¼‚å¸¸ä½ç½®ä¸å½“</strong></li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// catch åªèƒ½æ•è·ä¸Šæ¸¸å¼‚å¸¸</span>
flow.<span class="hljs-keyword">catch</span> { <span class="hljs-comment">/* æ•è·ä¸Šæ¸¸å¼‚å¸¸ */</span> }
    .collect { 
        <span class="hljs-keyword">try</span> { <span class="hljs-comment">/* å¤„ç†æ”¶é›†ç«¯é€»è¾‘ */</span> } 
        <span class="hljs-keyword">catch</span>(e: Exception) { <span class="hljs-comment">/* æ•è·æ”¶é›†ç«¯å¼‚å¸¸ */</span> }
    }
</code></pre>
<ul>
<li><strong>å¿˜è®°å¤„ç†å–æ¶ˆ</strong></li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">flow {
    emit(<span class="hljs-number">1</span>)
    delay(<span class="hljs-number">1000</span>)
    emit(<span class="hljs-number">2</span>)  <span class="hljs-comment">// å¦‚æœ flow è¢«å–æ¶ˆï¼Œè¿™é‡Œä¸ä¼šæ‰§è¡Œ</span>
}.cancellable()  <span class="hljs-comment">// è®© flow å¯å“åº”å–æ¶ˆ</span>
</code></pre>
<h4 data-id="heading-21">æœ€ä½³å®è·µï¼š</h4>
<ul>
<li>ä½¿ç”¨Â <code>flowOn</code>Â è¿›è¡Œçº¿ç¨‹åˆ‡æ¢</li>
<li>åˆç†ä½¿ç”¨Â <code>catch</code>Â è¿›è¡Œå¼‚å¸¸å¤„ç†</li>
<li>ä½¿ç”¨Â <code>shareIn</code>/<code>stateIn</code>Â å…±äº«çƒ­æµ</li>
<li>ä¸ºè€—æ—¶æ“ä½œæ·»åŠ ç¼“å†²</li>
<li>åŠæ—¶å–æ¶ˆä¸å†éœ€è¦çš„æµ</li>
</ul>
<p>Flow æ˜¯ Kotlin å¼‚æ­¥ç¼–ç¨‹çš„å¼ºå¤§å·¥å…·ï¼Œé€šè¿‡åˆç†ä½¿ç”¨å„ç§æ“ä½œç¬¦å’Œæ¨¡å¼ï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ•ˆã€å¯ç»´æŠ¤çš„å¼‚æ­¥æ•°æ®æµã€‚</p>
<h2 data-id="heading-22">äºŒã€æ·±å…¥ç†è§£</h2>
<h3 data-id="heading-23">1. Flow çš„æ•´ä½“æ¶æ„</h3>
<h4 data-id="heading-24">1.1 Flow æ¥å£ä½“ç³»</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Flow æ ¸å¿ƒæ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flow</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FlowCollector</span>&lt;<span class="hljs-type">in T</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span>
}

<span class="hljs-comment">// Flow æ„å»ºå™¨è¿”å›çš„ SafeFlow å®ç°</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeFlow</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> block: <span class="hljs-keyword">suspend</span> FlowCollector&lt;T&gt;.() -&gt; <span class="hljs-built_in">Unit</span>
) : Flow&lt;T&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-keyword">val</span> safeCollector = SafeCollector(collector, coroutineContext)
        <span class="hljs-keyword">try</span> {
            block(safeCollector)
        } <span class="hljs-keyword">finally</span> {
            safeCollector.releaseIntercepted()
        }
    }
}
</code></pre>
<h4 data-id="heading-25">1.2 Flow æ‰§è¡Œæ¨¡å‹</h4>
<pre><code class="hljs language-text" lang="text">Flow æ‰§è¡Œæ¨¡å‹ï¼š
  ç”Ÿäº§è€… (Producer) â†’ ä¸­é—´æ“ä½œç¬¦ (Intermediate Operators) â†’ æ¶ˆè´¹è€… (Consumer)

å®é™…è°ƒç”¨é“¾ï¼š
  collect() â†’ ä¸­é—´æ“ä½œç¬¦1.collect() â†’ ä¸­é—´æ“ä½œç¬¦2.collect() â†’ ... â†’ æºFlow.collect()
  
æ•°æ®æµå‘ï¼š
  æºFlow.emit() â†’ ä¸­é—´æ“ä½œç¬¦1.emit() â†’ ä¸­é—´æ“ä½œç¬¦2.emit() â†’ ... â†’ æ¶ˆè´¹è€…å¤„ç†
</code></pre>
<h3 data-id="heading-26">2. Flow æ„å»ºåŸç†</h3>
<h4 data-id="heading-27">2.1 flow {} æ„å»ºå™¨å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// flow {} æ„å»ºå™¨çš„å®ç°</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">flow</span><span class="hljs-params">(
    block: <span class="hljs-type">suspend</span> <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;.() -&gt; <span class="hljs-type">Unit</span>
)</span></span>: Flow&lt;T&gt; = SafeFlow(block)

<span class="hljs-comment">// ç¤ºä¾‹ä»£ç çš„å­—èŠ‚ç è¿‘ä¼¼å®ç°</span>
flow {
    emit(<span class="hljs-number">1</span>)
    emit(<span class="hljs-number">2</span>)
}

<span class="hljs-comment">// å®é™…è¢«ç¼–è¯‘ä¸ºï¼ˆç®€åŒ–è¡¨ç¤ºï¼‰ï¼š</span>
<span class="hljs-keyword">object</span> : Flow&lt;<span class="hljs-built_in">Int</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
        <span class="hljs-comment">// æ„å»ºå™¨lambdaè¢«ç¼–è¯‘ä¸ºä¸€ä¸ªå†…éƒ¨ç±»</span>
        collector.emit(<span class="hljs-number">1</span>)
        collector.emit(<span class="hljs-number">2</span>)
    }
}
</code></pre>
<h4 data-id="heading-28">2.2 SafeCollector çš„å…³é”®ä½œç”¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">actual</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeCollector</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-title">actual</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> collector: FlowCollector&lt;T&gt;,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> collectContext: CoroutineContext
) : FlowCollector&lt;T&gt;, Continuation&lt;<span class="hljs-built_in">Unit</span>&gt; {
    
    <span class="hljs-comment">// ä¿å­˜å½“å‰åç¨‹ä¸Šä¸‹æ–‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lastEmissionContext: CoroutineContext? = <span class="hljs-literal">null</span>
    
    <span class="hljs-comment">// emit æ–¹æ³•çš„çº¿ç¨‹å®‰å…¨å®ç°</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        <span class="hljs-comment">// 1. æ£€æŸ¥åç¨‹ä¸Šä¸‹æ–‡æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆé˜²æ­¢é”™è¯¯çš„çº¿ç¨‹åˆ‡æ¢ï¼‰</span>
        checkContext(currentContext)
        
        <span class="hljs-comment">// 2. ä¿å­˜å‘å°„ä¸Šä¸‹æ–‡</span>
        lastEmissionContext = currentContext
        
        <span class="hljs-comment">// 3. å®é™…å‘å°„å€¼</span>
        <span class="hljs-keyword">return</span> suspendCoroutineUninterceptedOrReturn { cont -&gt;
            <span class="hljs-comment">// ä½¿ç”¨ Continuation è¿›è¡ŒæŒ‚èµ·æ¢å¤</span>
            with(collector) {
                emit(value)
            }
            <span class="hljs-comment">// å¦‚æœæŒ‚èµ·ï¼Œè¿”å› COROUTINE_SUSPENDED</span>
            <span class="hljs-comment">// å¦åˆ™è¿”å› Unit</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkContext</span><span class="hljs-params">(currentContext: <span class="hljs-type">CoroutineContext</span>)</span></span> {
        <span class="hljs-comment">// ç¡®ä¿ emit è°ƒç”¨åœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­</span>
        <span class="hljs-keyword">if</span> (lastEmissionContext != <span class="hljs-literal">null</span> &amp;&amp; lastEmissionContext != currentContext) {
            error(<span class="hljs-string">"Flow invariant is violated"</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-29">3. æ“ä½œç¬¦å®ç°åŸç†</h3>
<h4 data-id="heading-30">3.1 ä¸­é—´æ“ä½œç¬¦ - Map å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// map æ“ä½œç¬¦çš„å®ç°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">map</span><span class="hljs-params">(
    <span class="hljs-keyword">crossinline</span> transform: <span class="hljs-type">suspend</span> (<span class="hljs-type">value</span>: <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>
)</span></span>: Flow&lt;R&gt; = flow {  <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Flow</span>
    collect { value -&gt;  <span class="hljs-comment">// æ”¶é›†ä¸Šæ¸¸ Flow çš„å€¼</span>
        <span class="hljs-comment">// å¯¹æ¯ä¸ªå€¼åº”ç”¨è½¬æ¢å‡½æ•°</span>
        <span class="hljs-keyword">val</span> transformed = transform(value)
        <span class="hljs-comment">// å‘ä¸‹æ¸¸å‘å°„è½¬æ¢åçš„å€¼</span>
        emit(transformed)
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹å¯¹åº”çš„è°ƒç”¨é“¾</span>
flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    .map { it * <span class="hljs-number">2</span> }
    .collect { println(it) }

<span class="hljs-comment">// è°ƒç”¨é“¾å±•å¼€ï¼š</span>
<span class="hljs-comment">// 1. è°ƒç”¨ collect() ç»ˆç«¯æ“ä½œç¬¦</span>
<span class="hljs-comment">// 2. è§¦å‘ map åˆ›å»ºçš„ Flow çš„ collect æ–¹æ³•</span>
<span class="hljs-comment">// 3. map Flow çš„ collect æ–¹æ³•è°ƒç”¨ä¸Šæ¸¸ flowOf çš„ collect</span>
<span class="hljs-comment">// 4. flowOf å‘å°„å€¼ 1 â†’ map æ¥æ”¶å¹¶è½¬æ¢ â†’ å‘ä¸‹æ¸¸å‘å°„ 2 â†’ collect æ‰“å° 2</span>
<span class="hljs-comment">// 5. é‡å¤æ­¥éª¤4</span>
</code></pre>
<h4 data-id="heading-31">3.2 ç»ˆç«¯æ“ä½œç¬¦ - Collect å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// collect çš„å®é™…å·¥ä½œæµç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">collect</span><span class="hljs-params">(
    <span class="hljs-keyword">crossinline</span> action: <span class="hljs-type">suspend</span> (<span class="hljs-type">value</span>: <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>
)</span></span>: <span class="hljs-built_in">Unit</span> = collect(<span class="hljs-keyword">object</span> : FlowCollector&lt;T&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> = action(value)
})

<span class="hljs-comment">// æ›´åº•å±‚çš„å®ç°</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
    <span class="hljs-comment">// è°ƒç”¨ Flow æ¥å£çš„ collect æ–¹æ³•</span>
    <span class="hljs-keyword">return</span> collect(collector)
}
</code></pre>
<h3 data-id="heading-32">4. å¼‚å¸¸å¤„ç†åŸç†</h3>
<h4 data-id="heading-33">4.1 catch æ“ä½œç¬¦å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">catch</span><span class="hljs-params">(
    action: <span class="hljs-type">suspend</span> <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;.(<span class="hljs-type">cause</span>: <span class="hljs-type">Throwable</span>) -&gt; <span class="hljs-type">Unit</span>
)</span></span>: Flow&lt;T&gt; = flow {
    <span class="hljs-comment">// å¼‚å¸¸å¤„ç†é€»è¾‘</span>
    <span class="hljs-keyword">val</span> exception = catchImpl(<span class="hljs-keyword">this</span>)
    <span class="hljs-keyword">if</span> (exception != <span class="hljs-literal">null</span>) action(exception)
}

<span class="hljs-comment">// å®é™…çš„å¼‚å¸¸æ•è·å®ç°</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">catchImpl</span><span class="hljs-params">(
    collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;
)</span></span>: Throwable? {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
        collect(collector)
        <span class="hljs-literal">null</span>  <span class="hljs-comment">// æ­£å¸¸å®Œæˆï¼Œè¿”å› null</span>
    } <span class="hljs-keyword">catch</span> (e: Throwable) {
        <span class="hljs-comment">// åªæ•è·ä¸Šæ¸¸å¼‚å¸¸ï¼Œä¸æ•è·ä¸‹æ¸¸å¼‚å¸¸</span>
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">is</span> DownstreamExceptionElement) {
            <span class="hljs-keyword">throw</span> e  <span class="hljs-comment">// ä¸‹æ¸¸å¼‚å¸¸é‡æ–°æŠ›å‡º</span>
        }
        e  <span class="hljs-comment">// è¿”å›ä¸Šæ¸¸å¼‚å¸¸</span>
    }
}
</code></pre>
<h3 data-id="heading-34">5. ä¸Šä¸‹æ–‡åˆ‡æ¢åŸç†</h3>
<h4 data-id="heading-35">5.1 flowOn å®ç°æœºåˆ¶</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">flowOn</span><span class="hljs-params">(context: <span class="hljs-type">CoroutineContext</span>)</span></span>: Flow&lt;T&gt; {
    <span class="hljs-comment">// åˆ›å»º ChannelFlow æ¥å¤„ç†ä¸Šä¸‹æ–‡åˆ‡æ¢</span>
    <span class="hljs-keyword">return</span> ChannelFlowOperatorImpl(<span class="hljs-keyword">this</span>, context = context)
}

<span class="hljs-comment">// ChannelFlowOperatorImpl å…³é”®éƒ¨åˆ†</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelFlowOperatorImpl</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> flow: Flow&lt;T&gt;,
    context: CoroutineContext
) : ChannelFlow&lt;T&gt;(context) {
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectTo</span><span class="hljs-params">(scope: <span class="hljs-type">ProducerScope</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-comment">// åœ¨æ–°çš„åç¨‹ä¸Šä¸‹æ–‡ä¸­æ”¶é›†ä¸Šæ¸¸ Flow</span>
        coroutineScope {
            <span class="hljs-comment">// ä½¿ç”¨æ–°çš„ä¸Šä¸‹æ–‡</span>
            withContext(context) {
                flow.collect { value -&gt;
                    <span class="hljs-comment">// å°†å€¼å‘é€åˆ° channel</span>
                    scope.send(value)
                }
            }
        }
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-comment">// åˆ›å»º channel æ¥å¤„ç†èƒŒå‹</span>
        <span class="hljs-keyword">val</span> channel = produceIn(<span class="hljs-keyword">this</span>)
        <span class="hljs-comment">// ä» channel ä¸­æ¶ˆè´¹å¹¶å‘é€ç»™æ”¶é›†å™¨</span>
        channel.consumeEach { value -&gt;
            collector.emit(value)
        }
    }
}
</code></pre>
<h4 data-id="heading-36">5.2 ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ flow {} ä¸­ç›´æ¥åˆ‡æ¢ä¸Šä¸‹æ–‡</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯çš„åšæ³•</span>
flow {
    withContext(Dispatchers.IO) {  <span class="hljs-comment">// âŒ ä¼šç ´å Flow ä¸å˜æ€§</span>
        emit(<span class="hljs-number">1</span>)
    }
}

<span class="hljs-comment">// åŸç†ï¼šSafeCollector ä¼šæ£€æŸ¥å‘å°„ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeCollector</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastEmissionContext: CoroutineContext? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        <span class="hljs-keyword">val</span> currentContext = coroutineContext
        
        <span class="hljs-comment">// æ£€æŸ¥ï¼šemit è°ƒç”¨çš„ä¸Šä¸‹æ–‡å¿…é¡»ä¸€è‡´</span>
        <span class="hljs-keyword">if</span> (lastEmissionContext != <span class="hljs-literal">null</span> &amp;&amp; lastEmissionContext != currentContext) {
            <span class="hljs-keyword">throw</span> IllegalStateException(<span class="hljs-string">"Flow invariant is violated"</span>)
        }
        
        lastEmissionContext = currentContext
        <span class="hljs-comment">// ... å‘å°„é€»è¾‘</span>
    }
}
</code></pre>
<h3 data-id="heading-37">6. èƒŒå‹å¤„ç†åŸç†</h3>
<h4 data-id="heading-38">6.1 buffer æ“ä½œç¬¦å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">buffer</span><span class="hljs-params">(
    capacity: <span class="hljs-type">Int</span> = Channel.BUFFERED,
    onBufferOverflow: <span class="hljs-type">BufferOverflow</span> = BufferOverflow.SUSPEND
)</span></span>: Flow&lt;T&gt; = <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
    <span class="hljs-keyword">is</span> FusibleFlow -&gt; fuse(capacity = capacity, onBufferOverflow = onBufferOverflow)
    <span class="hljs-keyword">else</span> -&gt; ChannelFlowOperatorImpl(
        <span class="hljs-keyword">this</span>,
        capacity = capacity,
        onBufferOverflow = onBufferOverflow
    )
}

<span class="hljs-comment">// ChannelFlow çš„èƒŒå‹å¤„ç†</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelFlow</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">val</span> capacity: <span class="hljs-built_in">Int</span> = Channel.BUFFERED,
    <span class="hljs-keyword">val</span> onBufferOverflow: BufferOverflow = BufferOverflow.SUSPEND
) : Flow&lt;T&gt; {
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-comment">// åˆ›å»ºå…·æœ‰ç¼“å†²èƒ½åŠ›çš„ channel</span>
        <span class="hljs-keyword">val</span> channel = Channel&lt;T&gt;(capacity, onBufferOverflow)
        
        <span class="hljs-comment">// å¯åŠ¨ç”Ÿäº§è€…åç¨‹</span>
        <span class="hljs-keyword">val</span> producer = launchProducer(channel)
        
        <span class="hljs-comment">// æ¶ˆè´¹è€…ä» channel æ¥æ”¶</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (value <span class="hljs-keyword">in</span> channel) {
                collector.emit(value)
            }
        } <span class="hljs-keyword">finally</span> {
            producer.cancel()
        }
    }
}
</code></pre>
<h4 data-id="heading-39">6.2 conflate æ“ä½œç¬¦å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">conflate</span><span class="hljs-params">()</span></span>: Flow&lt;T&gt; = buffer(
    capacity = Channel.CONFLATED,
    onBufferOverflow = BufferOverflow.DROP_OLDEST
)

<span class="hljs-comment">// CONFLATED çš„ç‰¹æ®Šå¤„ç†</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CONFLATED: <span class="hljs-built_in">Int</span> = -<span class="hljs-number">1</span>

<span class="hljs-comment">// Channel å®ç°ä¸­çš„ CONFLATED å¤„ç†</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConflatedChannel</span>&lt;<span class="hljs-type">E</span>&gt; : <span class="hljs-type">AbstractChannel</span>&lt;<span class="hljs-type">E</span>&gt;() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> value: Any? = NULL
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">send</span><span class="hljs-params">(element: <span class="hljs-type">E</span>)</span></span> {
        <span class="hljs-comment">// å¦‚æœæœ‰æœªæ¶ˆè´¹çš„å€¼ï¼Œç›´æ¥æ›¿æ¢</span>
        <span class="hljs-keyword">if</span> (value !== NULL) {
            value = element
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¦åˆ™æ­£å¸¸å‘é€</span>
            <span class="hljs-keyword">super</span>.send(element)
        }
    }
}
</code></pre>
<h3 data-id="heading-40">7. SharedFlow åŸç†</h3>
<h4 data-id="heading-41">7.1 MutableSharedFlow æ ¸å¿ƒå®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">MutableSharedFlow</span><span class="hljs-params">(
    replay: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,
    extraBufferCapacity: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,
    onBufferOverflow: <span class="hljs-type">BufferOverflow</span> = BufferOverflow.SUSPEND
)</span></span>: MutableSharedFlow&lt;T&gt; {
    <span class="hljs-keyword">return</span> SharedFlowImpl(replay, extraBufferCapacity, onBufferOverflow)
}

<span class="hljs-comment">// SharedFlowImpl çš„å…³é”®æ•°æ®ç»“æ„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedFlowImpl</span>&lt;<span class="hljs-type">T</span>&gt;(
    replay: <span class="hljs-built_in">Int</span>,
    bufferCapacity: <span class="hljs-built_in">Int</span>,
    onBufferOverflow: BufferOverflow
) : AbstractSharedFlow&lt;SharedFlowSlot&lt;T&gt;&gt;(), MutableSharedFlow&lt;T&gt; {
    
    <span class="hljs-comment">// ç¼“å†²åŒºæ•°ç»„ï¼ˆç¯å½¢ç¼“å†²åŒºï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> buffer: Array&lt;Any?&gt;? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> replayIndex = <span class="hljs-number">0L</span>   <span class="hljs-comment">// é‡æ”¾èµ·å§‹ç´¢å¼•</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> minCollectorIndex = <span class="hljs-number">0L</span>  <span class="hljs-comment">// æœ€å°æ”¶é›†è€…ç´¢å¼•</span>
    
    <span class="hljs-comment">// å‘å°„å€¼</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        <span class="hljs-comment">// å°è¯•å¿«é€Ÿå‘å°„ï¼ˆæ— ç­‰å¾…ï¼‰</span>
        <span class="hljs-keyword">if</span> (tryEmit(value)) <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment">// éœ€è¦æŒ‚èµ·ç­‰å¾…</span>
        emitSuspend(value)
    }
    
    <span class="hljs-comment">// æ”¶é›†å€¼</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        <span class="hljs-comment">// ä¸ºæ”¶é›†è€…åˆ†é…ä¸€ä¸ªæ§½</span>
        <span class="hljs-keyword">val</span> slot = allocateSlot()
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ”¶é›†å¾ªç¯</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// å°è¯•ä»ç¼“å†²åŒºè·å–å€¼</span>
                <span class="hljs-keyword">val</span> value = slot.takeValue() ?: suspendAndWait()
                collector.emit(value <span class="hljs-keyword">as</span> T)
            }
        } <span class="hljs-keyword">finally</span> {
            freeSlot(slot)
        }
    }
}
</code></pre>
<h4 data-id="heading-42">7.2 SharedFlow çš„è®¢é˜…ç®¡ç†</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// SharedFlow çš„è®¢é˜…è€…ç®¡ç†</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractSharedFlow</span>&lt;<span class="hljs-type">S : AbstractSharedFlowSlot&lt;*</span>&gt;&gt; {
    
    <span class="hljs-comment">// æ‰€æœ‰æ´»è·ƒçš„è®¢é˜…è€…æ§½</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> slots: Array&lt;S?&gt;? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> nCollectors = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// åˆ†é…æ§½ç»™æ–°çš„æ”¶é›†è€…</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">allocateSlot</span><span class="hljs-params">()</span></span>: S {
        <span class="hljs-keyword">val</span> slot = createSlot()
        synchronized(<span class="hljs-keyword">this</span>) {
            slots = slots.orEmpty().plus(slot)
            nCollectors++
            onNewCollector(slot)
        }
        <span class="hljs-keyword">return</span> slot
    }
    
    <span class="hljs-comment">// é‡Šæ”¾æ§½</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">freeSlot</span><span class="hljs-params">(slot: <span class="hljs-type">S</span>)</span></span> {
        synchronized(<span class="hljs-keyword">this</span>) {
            slots = slots.orEmpty().filter { it !== slot }.toTypedArray()
            nCollectors--
        }
    }
}
</code></pre>
<h3 data-id="heading-43">8. StateFlow åŸç†</h3>
<h4 data-id="heading-44">8.1 StateFlow çš„ç‰¹æ®Šæ€§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StateFlow</span>&lt;<span class="hljs-type">out T</span>&gt; : <span class="hljs-type">SharedFlow</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> value: T
}

<span class="hljs-comment">// StateFlowImpl å®ç°</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateFlowImpl</span>&lt;<span class="hljs-type">T</span>&gt;(
    initialState: T
) : AbstractSharedFlow&lt;StateFlowSlot&gt;(), StateFlow&lt;T&gt;, MutableStateFlow&lt;T&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _state: Any = initialState
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sequence = <span class="hljs-number">0L</span>  <span class="hljs-comment">// åºåˆ—å·ï¼Œç”¨äºæ£€æµ‹é‡å¤å€¼</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> value: T
        <span class="hljs-keyword">get</span>() = _state <span class="hljs-keyword">as</span> T
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        <span class="hljs-comment">// å¦‚æœå€¼ä¸å½“å‰çŠ¶æ€ç›¸åŒï¼Œåˆ™å¿½ç•¥</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.value == value &amp;&amp; sequence != <span class="hljs-number">0L</span>) <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span>
        _state = value
        sequence++
        
        <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…</span>
        forEachSlot { slot -&gt;
            slot.makePending()
        }
    }
}
</code></pre>
<h3 data-id="heading-45">9. Flow çš„åç¨‹é›†æˆ</h3>
<h4 data-id="heading-46">9.1 Flow ä¸åç¨‹ Continuation</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Flow æ”¶é›†çš„åç¨‹ Continuation è½¬æ¢</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: <span class="hljs-built_in">Unit</span> {
    <span class="hljs-comment">// åˆ›å»ºåç¨‹ Continuation</span>
    <span class="hljs-keyword">return</span> suspendCoroutineUninterceptedOrReturn { cont -&gt;
        <span class="hljs-comment">// å°† Flow æ”¶é›†è½¬æ¢ä¸ºåç¨‹æŒ‚èµ·ç‚¹</span>
        <span class="hljs-keyword">val</span> completion = <span class="hljs-keyword">object</span> : Continuation&lt;<span class="hljs-built_in">Unit</span>&gt; {
            <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> context: CoroutineContext = cont.context
            
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resumeWith</span><span class="hljs-params">(result: <span class="hljs-type">Result</span>&lt;<span class="hljs-type">Unit</span>&gt;)</span></span> {
                <span class="hljs-comment">// å°†ç»“æœä¼ é€’ç»™åŸå§‹ Continuation</span>
                cont.resumeWith(result)
            }
        }
        
        <span class="hljs-comment">// å¯åŠ¨ Flow æ”¶é›†</span>
        startCollect(collector, completion)
    }
}
</code></pre>
<h4 data-id="heading-47">9.2 Flow çš„å–æ¶ˆæœºåˆ¶</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Flow çš„å–æ¶ˆæ£€æŸ¥</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">collect</span><span class="hljs-params">(collector: <span class="hljs-type">FlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
    <span class="hljs-comment">// åŒ…è£…æ”¶é›†å™¨ä»¥æ”¯æŒå–æ¶ˆ</span>
    <span class="hljs-keyword">val</span> cancellableCollector = CancellableFlowCollector(collector)
    
    <span class="hljs-keyword">try</span> {
        collectSafely(cancellableCollector)
    } <span class="hljs-keyword">finally</span> {
        cancellableCollector.releaseCancellability()
    }
}

<span class="hljs-comment">// å¯å–æ¶ˆçš„æ”¶é›†å™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancellableFlowCollector</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> collector: FlowCollector&lt;T&gt;
) : FlowCollector&lt;T&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cancellationCause: Throwable? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">emit</span><span class="hljs-params">(value: <span class="hljs-type">T</span>)</span></span> {
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²å–æ¶ˆ</span>
        <span class="hljs-keyword">if</span> (cancellationCause != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> CancellationException()
        }
        
        <span class="hljs-comment">// æ£€æŸ¥åç¨‹æ˜¯å¦æ´»è·ƒ</span>
        ensureActive()
        
        <span class="hljs-comment">// å®é™…å‘å°„</span>
        collector.emit(value)
    }
}
</code></pre>
<h3 data-id="heading-48">10. æ€§èƒ½ä¼˜åŒ–ç»†èŠ‚</h3>
<h4 data-id="heading-49">10.1 Flow çš„èåˆï¼ˆFusionï¼‰ä¼˜åŒ–</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Flow æ“ä½œç¬¦çš„èåˆä¼˜åŒ–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FusibleFlow</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">Flow</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fuse</span><span class="hljs-params">(
        context: <span class="hljs-type">CoroutineContext</span> = EmptyCoroutineContext,
        capacity: <span class="hljs-type">Int</span> = Channel.OPTIONAL_CHANNEL,
        onBufferOverflow: <span class="hljs-type">BufferOverflow</span> = BufferOverflow.SUSPEND
    )</span></span>: Flow&lt;T&gt;
}

<span class="hljs-comment">// ç¤ºä¾‹ï¼šè¿ç»­ map æ“ä½œçš„èåˆ</span>
flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    .map { it * <span class="hljs-number">2</span> }    <span class="hljs-comment">// è¿™ä¸¤ä¸ª map å¯èƒ½è¢«èåˆä¸º</span>
    .map { it + <span class="hljs-number">1</span> }    <span class="hljs-comment">// ä¸€ä¸ª map { (it * 2) + 1 }</span>
    .collect { ... }

<span class="hljs-comment">// èåˆåçš„ä¼ªä»£ç </span>
flow {
    collect { value -&gt;
        <span class="hljs-comment">// èåˆåçš„è½¬æ¢</span>
        <span class="hljs-keyword">val</span> transformed = (value * <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>
        emit(transformed)
    }
}
</code></pre>
<h4 data-id="heading-50">10.2 å†…è”ä¼˜åŒ–</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è®¸å¤š Flow æ“ä½œç¬¦ä½¿ç”¨ inline ä¼˜åŒ–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">filter</span><span class="hljs-params">(
    <span class="hljs-keyword">crossinline</span> predicate: <span class="hljs-type">suspend</span> (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Boolean</span>
)</span></span>: Flow&lt;T&gt; = flow {  <span class="hljs-comment">// inline å‡½æ•°ï¼Œå‡å°‘ lambda å¯¹è±¡åˆ›å»º</span>
    collect { value -&gt;
        <span class="hljs-keyword">if</span> (predicate(value)) emit(value)
    }
}

<span class="hljs-comment">// æœªå†…è”çš„æƒ…å†µï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰ï¼š</span>
<span class="hljs-comment">// 1. åˆ›å»º lambda å¯¹è±¡</span>
<span class="hljs-comment">// 2. åˆ›å»ºæ–°çš„ Flow å¯¹è±¡</span>
<span class="hljs-comment">// 3. é¢å¤–çš„å‡½æ•°è°ƒç”¨å¼€é”€</span>

<span class="hljs-comment">// å†…è”ä¼˜åŒ–åï¼š</span>
<span class="hljs-comment">// 1. ä»£ç ç›´æ¥åµŒå…¥è°ƒç”¨å¤„</span>
<span class="hljs-comment">// 2. å‡å°‘å¯¹è±¡åˆ›å»º</span>
<span class="hljs-comment">// 3. æ›´å¥½çš„ JIT ä¼˜åŒ–æœºä¼š</span>
</code></pre>
<h4 data-id="heading-51">11. æ€»ç»“</h4>
<p>Kotlin Flow çš„æ ¸å¿ƒåŸç†ï¼š</p>
<ol>
<li><strong>åŸºäºåç¨‹</strong>ï¼šåˆ©ç”¨æŒ‚èµ·å‡½æ•°å®ç°å¼‚æ­¥æµå¤„ç†</li>
<li><strong>å†·æµæ¨¡å‹</strong>ï¼šæ¯æ¬¡æ”¶é›†éƒ½åˆ›å»ºæ–°çš„æ‰§è¡Œ</li>
<li><strong>è£…é¥°å™¨æ¨¡å¼</strong>ï¼šæ“ä½œç¬¦é€šè¿‡åŒ…è£…å®ç°é“¾å¼è°ƒç”¨</li>
<li><strong>ç»“æ„åŒ–å¹¶å‘</strong>ï¼šè‡ªåŠ¨ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šé€šè¿‡ SafeCollector ç¡®ä¿ä¸Šä¸‹æ–‡ä¸€è‡´æ€§</li>
<li><strong>èƒŒå‹å¤„ç†</strong>ï¼šåŸºäº Channel çš„ç¼“å†²æœºåˆ¶</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cordova Plugin File çš„ File å¯¹è±¡è®¾è®¡ç¼ºé™·]]></title>    <link>https://juejin.cn/post/7600588379104854068</link>    <guid>https://juejin.cn/post/7600588379104854068</guid>    <pubDate>2026-01-29T08:42:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600588379104854068" data-draft-id="7600345782174122018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cordova Plugin File çš„ File å¯¹è±¡è®¾è®¡ç¼ºé™·"/> <meta itemprop="keywords" content="Android,APP,å®¢æˆ·ç«¯"/> <meta itemprop="datePublished" content="2026-01-29T08:42:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gemini001"/> <meta itemprop="url" content="https://juejin.cn/user/2333635831676704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cordova Plugin File çš„ File å¯¹è±¡è®¾è®¡ç¼ºé™·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2333635831676704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gemini001
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T08:42:05.000Z" title="Thu Jan 29 2026 08:42:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Cordova Plugin File çš„ File å¯¹è±¡è®¾è®¡ç¼ºé™·ï¼šä¸€åœº Web æ ‡å‡†çš„ç¾éš¾</h2>
<h3 data-id="heading-1">ğŸš¨ é—®é¢˜æ¦‚è¿°</h3>
<p>Cordova çš„Â <code>cordova-plugin-file</code>æ’ä»¶è¦†ç›–äº†å…¨å±€çš„Â <code>File</code>æ„é€ å‡½æ•°ï¼Œåˆ›é€ äº†ä¸€ä¸ª<strong>å››ä¸åƒçš„æ–‡ä»¶å¯¹è±¡</strong>ï¼šæ—¢ä¸æ˜¯çœŸæ­£çš„ Web Fileï¼Œä¹Ÿä¸æ˜¯å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿæ¥å£ï¼Œå¯¼è‡´å¤§é‡ H5 ä»£ç å¼‚å¸¸ã€‚
æ’ä»¶åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fcordova-plugin-file%2Fblob%2Fmaster%2Fwww%2FFile.js" target="_blank" title="https://github.com/apache/cordova-plugin-file/blob/master/www/File.js" ref="nofollow noopener noreferrer">github.com/apache/cordâ€¦</a></p>
<h3 data-id="heading-2">ğŸ“Š æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”ï¼šCordova File vs æ ‡å‡† Web File</h3>



























































<table><thead><tr><th>ç‰¹æ€§</th><th>Cordova File</th><th>æ ‡å‡† Web File</th><th>å®é™…å½±å“</th></tr></thead><tbody><tr><td><strong>EXIF æ•°æ®</strong>â€‹</td><td>âŒ ä¸åŒ…å«</td><td>âœ… å¯èƒ½åŒ…å«</td><td>æ— æ³•è¯»å–ç…§ç‰‡æ‹æ‘„ä¿¡æ¯</td></tr><tr><td><strong>IPTC æ•°æ®</strong>â€‹</td><td>âŒ ä¸åŒ…å«</td><td>âœ… å¯èƒ½åŒ…å«</td><td>æ— æ³•è¯»å–å›¾ç‰‡å…ƒæ•°æ®</td></tr><tr><td><strong>æœ¬åœ°è·¯å¾„</strong>â€‹</td><td>âœ… localURL</td><td>âŒ æ— </td><td>Cordova ç‹¬æœ‰ä¼˜åŠ¿</td></tr><tr><td><strong>åˆ‡ç‰‡æ”¯æŒ</strong>â€‹</td><td>âœ… start/end</td><td>âœ… slice()</td><td>ä¸¤è€…éƒ½æ”¯æŒï¼Œä½† API ä¸åŒ</td></tr><tr><td><strong>äºŒè¿›åˆ¶è¯»å–</strong>â€‹</td><td>âœ… é€šè¿‡ FileReader</td><td>âœ… é€šè¿‡ FileReader</td><td>åŸºç¡€åŠŸèƒ½ä¸€è‡´</td></tr><tr><td><strong>æ„é€ å‡½æ•°</strong>â€‹</td><td><code>File(name, localURL, type, lastModifiedDate, size)</code></td><td><code>File(fileBits, fileName, options)</code></td><td>å®Œå…¨ä¸å…¼å®¹</td></tr><tr><td><strong>instanceof File</strong>â€‹</td><td>âŒ false</td><td>âœ… true</td><td>ç±»å‹æ£€æµ‹å¤±æ•ˆ</td></tr><tr><td><strong>ç»§æ‰¿å…³ç³»</strong>â€‹</td><td>ä¸ç»§æ‰¿ Blob</td><td>ç»§æ‰¿è‡ª Blob</td><td>å¤±å» Blob èƒ½åŠ›</td></tr></tbody></table>
<h3 data-id="heading-3">ğŸ’¡ å…³é”®æ´å¯Ÿ</h3>
<h4 data-id="heading-4">Cordova File çš„"ä¼ªä¼˜åŠ¿"</h4>
<ul>
<li><strong>æœ¬åœ°è·¯å¾„ (localURL)</strong> ï¼šè¿™æ˜¯ Cordova File ç‹¬æœ‰çš„ä¼˜åŠ¿ï¼Œå¯ä»¥ç›´æ¥è®¿é—®è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿ</li>
<li><strong>å†…ç½®åˆ‡ç‰‡ (start/end)</strong> ï¼šæä¾›äº†æ–‡ä»¶èŒƒå›´å®šä½ï¼Œé€‚åˆå¤§æ–‡ä»¶å¤„ç†</li>
</ul>
<h4 data-id="heading-5">æ ‡å‡† Web File çš„çœŸæ­£ä»·å€¼</h4>
<ul>
<li><strong>EXIF/IPTC æ•°æ®</strong>ï¼šå¯¹å›¾ç‰‡å¤„ç†åº”ç”¨è‡³å…³é‡è¦</li>
<li><strong>æ ‡å‡†å…¼å®¹æ€§</strong>ï¼šä¸æ•´ä¸ª Web ç”Ÿæ€æ— ç¼é›†æˆ</li>
<li><strong>Blob ç»§æ‰¿</strong>ï¼šè·å¾—æ‰€æœ‰ Blob æ–¹æ³•ï¼ˆ<code>slice()</code>,Â <code>stream()</code>,Â <code>text()</code>,Â <code>arrayBuffer()</code>ï¼‰</li>
</ul>
<h3 data-id="heading-6">ğŸ’¥ å®é™…å¼€å‘ä¸­çš„ç—›ç‚¹</h3>
<h4 data-id="heading-7">1. å›¾ç‰‡åº”ç”¨å´©æºƒ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ğŸ˜± æƒ³è¯»å–ç…§ç‰‡çš„ EXIF ä¿¡æ¯ï¼Ÿ</span>
<span class="hljs-keyword">const</span> cordovaFile = <span class="hljs-title function_">getSelectedFile</span>(); <span class="hljs-comment">// Cordova File å¯¹è±¡</span>

<span class="hljs-comment">// æœŸæœ›è¿™æ ·è¯»å– EXIF</span>
<span class="hljs-variable constant_">EXIF</span>.<span class="hljs-title function_">getData</span>(cordovaFile, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cameraModel = <span class="hljs-variable constant_">EXIF</span>.<span class="hljs-title function_">getTag</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'Model'</span>); <span class="hljs-comment">// undefined!</span>
});

<span class="hljs-comment">// æœŸæœ›è¿™æ ·è¯»å– IPTC  </span>
<span class="hljs-title function_">readIPTCData</span>(cordovaFile); <span class="hljs-comment">// å¤±è´¥ï¼æ²¡æœ‰åŸå§‹å›¾åƒæ•°æ®</span>
</code></pre>
<h4 data-id="heading-8">2. ç¬¬ä¸‰æ–¹åº“é›†ä½“å¤±æ•ˆ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ğŸ“¦ å›¾ç‰‡å¤„ç†åº“å…¨éƒ¨æ‡µé€¼</span>
<span class="hljs-keyword">import</span> imageOptimizer <span class="hljs-keyword">from</span> <span class="hljs-string">'image-optimizer'</span>;    <span class="hljs-comment">// âŒ æ— æ³•è¯»å– EXIF</span>
<span class="hljs-keyword">import</span> watermarkAdder <span class="hljs-keyword">from</span> <span class="hljs-string">'watermark-js'</span>;       <span class="hljs-comment">// âŒ æ— æ³•æ­£ç¡®å¤„ç†</span>
<span class="hljs-keyword">import</span> exifReader <span class="hljs-keyword">from</span> <span class="hljs-string">'exif-reader'</span>;            <span class="hljs-comment">// âŒ æ‰¾ä¸åˆ° EXIF æ•°æ®</span>

<span class="hljs-comment">// å› ä¸ºè¿™äº›åº“éƒ½æœŸæœ›æ ‡å‡† File å¯¹è±¡</span>
</code></pre>
<h4 data-id="heading-9">3. ç±»å‹æ£€æµ‹æ··ä¹±</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processFile</span>(<span class="hljs-params">file</span>) {
    <span class="hljs-keyword">if</span> (file <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">File</span>) {
        <span class="hljs-comment">// æ ‡å‡†ç¯å¢ƒï¼šè¿›å…¥è¿™é‡Œ âœ…</span>
        <span class="hljs-comment">// Cordova ç¯å¢ƒï¼šè¿›ä¸æ¥ âŒ</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¤„ç†æ ‡å‡†æ–‡ä»¶'</span>);
    }
    
    <span class="hljs-keyword">if</span> (file.<span class="hljs-property">localURL</span>) {
        <span class="hljs-comment">// åªæœ‰ Cordova File æœ‰è¿™ä¸ªå±æ€§</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿™æ˜¯ Cordova æ–‡ä»¶ï¼Œä½†æˆ‘ä¸è®¤è¯†å®ƒï¼'</span>);
    }
}
</code></pre>
<h3 data-id="heading-10">ğŸ”§ å®ç”¨è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-11">æ–¹æ¡ˆ1ï¼šä¿ç•™ Cordova ä¼˜åŠ¿ï¼Œä¿®å¤æ ‡å‡†å…¼å®¹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartFileBridge</span> {
    <span class="hljs-comment">// æ£€æµ‹æ–‡ä»¶ç±»å‹</span>
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">detectType</span>(<span class="hljs-params">file</span>) {
        <span class="hljs-keyword">if</span> (file.<span class="hljs-property">localURL</span> &amp;&amp; !file.<span class="hljs-property">slice</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'cordova'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (file <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">File</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'standard'</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">'unknown'</span>;
    }
    
    <span class="hljs-comment">// è½¬æ¢ä¸ºæ ‡å‡† Fileï¼ˆä¿ç•™ EXIF/IPTC è¯»å–èƒ½åŠ›ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">toStandardFile</span>(<span class="hljs-params">cordovaFile</span>) {
        <span class="hljs-comment">// å…³é”®ï¼šé€šè¿‡ FileReader è¯»å–å®Œæ•´äºŒè¿›åˆ¶æ•°æ®</span>
        <span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readAsArrayBuffer</span>(cordovaFile);
        
        <span class="hljs-comment">// åˆ›å»ºæ ‡å‡† Fileï¼Œè¿™æ ·å°±èƒ½è¯»å– EXIF/IPTC äº†</span>
        <span class="hljs-keyword">const</span> standardFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>([arrayBuffer], cordovaFile.<span class="hljs-property">name</span>, {
            <span class="hljs-attr">type</span>: cordovaFile.<span class="hljs-property">type</span>,
            <span class="hljs-attr">lastModified</span>: cordovaFile.<span class="hljs-property">lastModifiedDate</span>?.<span class="hljs-title function_">getTime</span>()
        });
        
        <span class="hljs-comment">// ä¿ç•™ Cordova çš„æœ¬åœ°è·¯å¾„ä¿¡æ¯</span>
        standardFile.<span class="hljs-property">localURL</span> = cordovaFile.<span class="hljs-property">localURL</span>;
        standardFile.<span class="hljs-property">start</span> = cordovaFile.<span class="hljs-property">start</span>;
        standardFile.<span class="hljs-property">end</span> = cordovaFile.<span class="hljs-property">end</span>;
        
        <span class="hljs-keyword">return</span> standardFile;
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">readAsArrayBuffer</span>(<span class="hljs-params">file</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
            reader.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(reader.<span class="hljs-property">result</span>);
            reader.<span class="hljs-property">onerror</span> = reject;
            reader.<span class="hljs-title function_">readAsArrayBuffer</span>(file);
        });
    }
}
</code></pre>
<h4 data-id="heading-12">æ–¹æ¡ˆ2ï¼šæ™ºèƒ½æ–‡ä»¶å¤„ç†å™¨</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IntelligentFileProcessor</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">file</span>) {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = <span class="hljs-title class_">SmartFileBridge</span>.<span class="hljs-title function_">detectType</span>(file);
        
        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">type</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'cordova'</span>:
                <span class="hljs-comment">// Cordova æ–‡ä»¶ï¼šè½¬æ¢ä¸ºæ ‡å‡† File ä»¥å¯ç”¨ EXIF/IPTC è¯»å–</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">SmartFileBridge</span>.<span class="hljs-title function_">toStandardFile</span>(file);
                
            <span class="hljs-keyword">case</span> <span class="hljs-string">'standard'</span>:
                <span class="hljs-comment">// æ ‡å‡†æ–‡ä»¶ï¼šç›´æ¥ä½¿ç”¨</span>
                <span class="hljs-keyword">return</span> file;
                
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'æœªçŸ¥æ–‡ä»¶ç±»å‹'</span>);
        }
    }
    
    <span class="hljs-comment">// ä¸“é—¨å¤„ç†å›¾ç‰‡æ–‡ä»¶çš„ EXIF</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">processImageWithExif</span>(<span class="hljs-params">file</span>) {
        <span class="hljs-keyword">const</span> processedFile = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">process</span>(file);
        
        <span class="hljs-comment">// ç°åœ¨å¯ä»¥å®‰å…¨è¯»å– EXIF äº†</span>
        <span class="hljs-keyword">if</span> (processedFile.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'image/'</span>)) {
            <span class="hljs-keyword">const</span> exifData = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readExif</span>(processedFile);
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">file</span>: processedFile,
                <span class="hljs-attr">exif</span>: exifData,
                <span class="hljs-attr">localURL</span>: processedFile.<span class="hljs-property">localURL</span> <span class="hljs-comment">// ä¿ç•™ Cordova è·¯å¾„</span>
            };
        }
        
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">file</span>: processedFile };
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">readExif</span>(<span class="hljs-params">file</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-variable constant_">EXIF</span>.<span class="hljs-title function_">getData</span>(file, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
                <span class="hljs-title function_">resolve</span>(<span class="hljs-variable constant_">EXIF</span>.<span class="hljs-title function_">getAllTags</span>(<span class="hljs-variable language_">this</span>));
            });
        });
    }
}
</code></pre>
<h4 data-id="heading-13">æ–¹æ¡ˆ3ï¼šå®æˆ˜åº”ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">PhotoUploader</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePhotoSelect</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">cordovaFile</span>) =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ğŸš€ æ™ºèƒ½å¤„ç†ï¼šè‡ªåŠ¨è½¬æ¢å¹¶ä¿ç•™ Cordova ä¼˜åŠ¿</span>
            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">IntelligentFileProcessor</span>.<span class="hljs-title function_">processImageWithExif</span>(cordovaFile);
            
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶ä¿¡æ¯:'</span>, {
                <span class="hljs-attr">name</span>: result.<span class="hljs-property">file</span>.<span class="hljs-property">name</span>,
                <span class="hljs-attr">type</span>: result.<span class="hljs-property">file</span>.<span class="hljs-property">type</span>,
                <span class="hljs-attr">size</span>: result.<span class="hljs-property">file</span>.<span class="hljs-property">size</span>,
                <span class="hljs-attr">localURL</span>: result.<span class="hljs-property">localURL</span>, <span class="hljs-comment">// Cordova æœ¬åœ°è·¯å¾„</span>
                <span class="hljs-attr">exif</span>: result.<span class="hljs-property">exif</span>          <span class="hljs-comment">// ç°åœ¨å¯ä»¥è¯»å– EXIF äº†ï¼</span>
            });
            
            <span class="hljs-comment">// ä½¿ç”¨æ ‡å‡† File è¿›è¡Œåç»­å¤„ç†ï¼ˆæ”¯æŒæ‰€æœ‰ Web APIï¼‰</span>
            <span class="hljs-keyword">const</span> optimizedImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">optimizeImage</span>(result.<span class="hljs-property">file</span>);
            
            <span class="hljs-comment">// éœ€è¦æ—¶ä½¿ç”¨ Cordova æœ¬åœ°è·¯å¾„</span>
            <span class="hljs-keyword">if</span> (result.<span class="hljs-property">localURL</span>) {
                <span class="hljs-keyword">await</span> <span class="hljs-title function_">uploadViaCordovaPath</span>(result.<span class="hljs-property">localURL</span>);
            }
            
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ–‡ä»¶å¤„ç†å¤±è´¥:'</span>, error);
        }
    };
    
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
            <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> 
            <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> handlePhotoSelect(e.target.files[0])}
        /&gt;</span>
    );
}
</code></pre>
<h3 data-id="heading-14">ğŸ¯ æœ€ä½³å®è·µæŒ‡å—</h3>
<h4 data-id="heading-15">1. æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©ç­–ç•¥</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åœºæ™¯ Aï¼šåªéœ€è¦æ–‡ä»¶å†…å®¹å’Œ Cordova è·¯å¾„</span>
<span class="hljs-function">function <span class="hljs-title">simpleFileHandler</span><span class="hljs-params">(cordovaFile)</span> </span>{
    <span class="hljs-keyword">return</span> {
        name: cordovaFile.name,
        localURL: cordovaFile.localURL, <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ Cordova è·¯å¾„</span>
        size: cordovaFile.size
        <span class="hljs-comment">// ä¸éœ€è¦è½¬æ¢ä¸ºæ ‡å‡† File</span>
    };
}

<span class="hljs-comment">// åœºæ™¯ Bï¼šéœ€è¦ EXIF/IPTC æˆ– Web API å…¼å®¹æ€§</span>
<span class="hljs-function">async function <span class="hljs-title">advancedFileHandler</span><span class="hljs-params">(cordovaFile)</span> </span>{
    <span class="hljs-type">const</span> standardFile = await SmartFileBridge.<span class="hljs-built_in">toStandardFile</span>(cordovaFile);
    
    <span class="hljs-keyword">return</span> {
        file: standardFile,           <span class="hljs-comment">// æ ‡å‡† Fileï¼ˆæ”¯æŒ EXIFã€Web APIï¼‰</span>
        localURL: cordovaFile.localURL, <span class="hljs-comment">// ä¿ç•™ Cordova è·¯å¾„</span>
        start: cordovaFile.start,     <span class="hljs-comment">// ä¿ç•™ Cordova åˆ‡ç‰‡</span>
        end: cordovaFile.end
    };
}
</code></pre>
<h4 data-id="heading-16">2. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ğŸš€ æŒ‰éœ€è½¬æ¢ï¼šä¸è¦ç›²ç›®è½¬æ¢æ‰€æœ‰æ–‡ä»¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceAwareProcessor</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">processBatch</span>(<span class="hljs-params">files, options = {}</span>) {
        <span class="hljs-keyword">const</span> { needExif = <span class="hljs-literal">false</span>, needWebAPI = <span class="hljs-literal">false</span> } = options;
        
        <span class="hljs-keyword">const</span> results = [];
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
            <span class="hljs-comment">// å¿«é€Ÿè·¯å¾„ï¼šä¸éœ€è¦æ ‡å‡† File åŠŸèƒ½</span>
            <span class="hljs-keyword">if</span> (!needExif &amp;&amp; !needWebAPI) {
                results.<span class="hljs-title function_">push</span>({
                    <span class="hljs-attr">file</span>: file, <span class="hljs-comment">// ä¿æŒåŸæ ·</span>
                    <span class="hljs-attr">localURL</span>: file.<span class="hljs-property">localURL</span>
                });
                <span class="hljs-keyword">continue</span>;
            }
            
            <span class="hljs-comment">// æ…¢é€Ÿè·¯å¾„ï¼šéœ€è¦å®Œæ•´åŠŸèƒ½</span>
            <span class="hljs-keyword">const</span> converted = <span class="hljs-keyword">await</span> <span class="hljs-title class_">SmartFileBridge</span>.<span class="hljs-title function_">toStandardFile</span>(file);
            results.<span class="hljs-title function_">push</span>({
                <span class="hljs-attr">file</span>: converted,
                <span class="hljs-attr">localURL</span>: file.<span class="hljs-property">localURL</span>
            });
        }
        
        <span class="hljs-keyword">return</span> results;
    }
}
</code></pre>
<h3 data-id="heading-17">ğŸ¤” è®¾è®¡å“²å­¦åæ€</h3>
<h4 data-id="heading-18">Cordova çš„è®¾è®¡å–èˆ</h4>
<ul>
<li><strong>å¾—</strong>ï¼šè·å¾—äº†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè®¿é—®èƒ½åŠ›ï¼ˆlocalURLï¼‰</li>
<li><strong>å¤±</strong>ï¼šå¤±å»äº†æ•´ä¸ª Web ç”Ÿæ€å…¼å®¹æ€§</li>
<li><strong>é—®é¢˜</strong>ï¼šæ²¡æœ‰æä¾›å¹³æ»‘çš„è¿ç§»è·¯å¾„</li>
</ul>
<h4 data-id="heading-19">ç†æƒ³çš„è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ğŸ’­ ç†æƒ³ä¸­çš„è®¾è®¡</span>
<span class="hljs-keyword">const</span> cordovaFile = <span class="hljs-keyword">await</span> cordovaFS.getFile(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> standardFile = <span class="hljs-keyword">await</span> cordovaFile.toStandardFile(); <span class="hljs-comment">// æ˜¾å¼è½¬æ¢</span>
<span class="hljs-keyword">const</span> withExif = <span class="hljs-keyword">await</span> standardFile.readExif(); <span class="hljs-comment">// è·å¾— EXIF èƒ½åŠ›</span>
</code></pre>
<h3 data-id="heading-20">ğŸ æ€»ç»“</h3>
<p>Cordova File å¯¹è±¡çš„æ ¸å¿ƒçŸ›ç›¾åœ¨äºï¼š</p>
<ul>
<li><strong>æƒ³è¦ Cordova çš„ä¼˜åŠ¿</strong>ï¼ˆlocalURLï¼‰â†’ å¿…é¡»ç”¨ Cordova File</li>
<li><strong>æƒ³è¦ Web ç”Ÿæ€</strong>ï¼ˆEXIFã€æ ‡å‡† APIï¼‰â†’ å¿…é¡»è½¬æ¢ä¸ºæ ‡å‡† File</li>
</ul>
<p><strong>å®ç”¨å»ºè®®</strong>ï¼š</p>
<ol>
<li><strong>æ˜ç¡®éœ€æ±‚</strong>ï¼šç¡®å®šæ˜¯å¦éœ€è¦ EXIF/IPTC æˆ– Web API å…¼å®¹æ€§</li>
<li><strong>æŒ‰éœ€è½¬æ¢</strong>ï¼šä¸è¦ç›²ç›®è½¬æ¢ï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯å†³å®š</li>
<li><strong>ä¿ç•™ä¼˜åŠ¿</strong>ï¼šè½¬æ¢æ—¶ä¿ç•™ Cordova ç‰¹æœ‰çš„ localURL ç­‰å±æ€§</li>
<li><strong>æ¸è¿›è¿ç§»</strong>ï¼šæ–°é¡¹ç›®ä¼˜å…ˆè€ƒè™‘ Capacitor ç­‰ç°ä»£æ–¹æ¡ˆ</li>
</ol>
<p>è¿™åœº"ç¾éš¾"çš„æ•™è®­æ˜¯ï¼š<strong>æŠ€æœ¯é€‰å‹è¦åœ¨ç‰¹æ®Šéœ€æ±‚å’Œç”Ÿæ€å…¼å®¹æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡</strong>ã€‚Cordova ç»™äº†æˆ‘ä»¬æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„é’¥åŒ™ï¼Œä½†ä¹Ÿå…³ä¸Šäº† Web æ ‡å‡†çš„å¤§é—¨ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬è¦å­¦ä¼šåŒæ—¶æ‹¿ç€ä¸¤æŠŠé’¥åŒ™ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift å±æ€§åŒ…è£…å™¨]]></title>    <link>https://juejin.cn/post/7600414546189467658</link>    <guid>https://juejin.cn/post/7600414546189467658</guid>    <pubDate>2026-01-29T08:49:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600414546189467658" data-draft-id="7600581247019106313" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift å±æ€§åŒ…è£…å™¨"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2026-01-29T08:49:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·46810455724"/> <meta itemprop="url" content="https://juejin.cn/user/2367689856916010"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift å±æ€§åŒ…è£…å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2367689856916010/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·46810455724
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T08:49:40.000Z" title="Thu Jan 29 2026 08:49:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘ä»¬æ¥çœ‹ The Swift Programming Language (6.2.3) ä¸­çš„ä¾‹å­ã€‚</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@propertyWrapper</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TwelveOrLess</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> number <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> number }
        <span class="hljs-keyword">set</span> { number <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(newValue, <span class="hljs-number">12</span>) }
    }
}
</code></pre>
<p>ç»“æ„ TwelveOrLess æ˜¯å±æ€§åŒ…è£…å™¨ï¼Œå±æ€§åŒ…è£…å™¨å¯ä»¥æ˜¯ classã€struct å’Œ enumã€‚å±æ€§åŒ…è£…å™¨éœ€è¦æœ‰ä¸ªå±æ€§ wrappedValueï¼Œè¡¨ç¤ºè¢«åŒ…è£…çš„å€¼ã€‚TwelveOrLess çš„ wrappedValue å±æ€§æ˜¯è®¡ç®—å±æ€§ï¼Œè¯»å†™ç§æœ‰çš„å­˜å‚¨å±æ€§ numberï¼Œå…¶ setter ç¡®ä¿ number å°äºæˆ–ç­‰äº 12ã€‚</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SmallRectangle</span> {
    <span class="hljs-meta">@TwelveOrLess</span> <span class="hljs-keyword">var</span> height: <span class="hljs-type">Int</span>
    <span class="hljs-meta">@TwelveOrLess</span> <span class="hljs-keyword">var</span> width: <span class="hljs-type">Int</span>
}
</code></pre>
<p>ç»“æ„ SmallRectangle åº”ç”¨åŒ…è£…å™¨ TwelveOrLess åˆ°å±æ€§ height å’Œ widthï¼Œç¼–è¯‘å™¨é‡å†™ä»£ç ä¸ºï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SmallRectangle</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _height <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _width <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>()
    <span class="hljs-keyword">var</span> height: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _height.wrappedValue }
        <span class="hljs-keyword">set</span> { _height.wrappedValue <span class="hljs-operator">=</span> newValue }
    }
    <span class="hljs-keyword">var</span> width: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _width.wrappedValue }
        <span class="hljs-keyword">set</span> { _width.wrappedValue <span class="hljs-operator">=</span> newValue }
    }
}
</code></pre>
<p>ç”Ÿæˆ _height å’Œ _width å­˜å‚¨å±æ€§ï¼Œå­˜å‚¨åŒ…è£…å™¨ TwelveOrLess çš„å®ä¾‹ã€‚height å’Œ width æˆä¸ºè®¡ç®—å±æ€§ï¼Œè®¿é—® _height å’Œ _width çš„ wrappedValueã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f1b3195708c4f1181cd25b3806915fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDY4MTA0NTU3MjQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770281383&amp;x-signature=vrGpv62QP6nrmqkWEIYwbibwQaM%3D" alt="v2-a712b4a4c7d80561227b6bc40f5c8608_1440w.png" loading="lazy"/></p>
<p>ç¼–è¯‘å™¨è¿˜ä¼šä¸º SmallRectangle ç”Ÿæˆ memberwise åˆå§‹åŒ–å™¨ï¼Œæ­¤æ—¶ç”Ÿæˆçš„åˆå§‹åŒ–å™¨ä¸º</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">init</span>(
    <span class="hljs-params">height</span>: <span class="hljs-type">TwelveOrLess</span> <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>(),
    <span class="hljs-params">width</span>: <span class="hljs-type">TwelveOrLess</span> <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>()
)
</code></pre>
<p>å‚æ•° height å’Œ width çš„ç±»å‹ä¸ºåŒ…è£…å™¨ç±»å‹ TwelveOrLessï¼ŒTwelveOrLess çš„åˆå§‹åŒ–å™¨ä¸ºé»˜è®¤åˆå§‹åŒ–å™¨ init()ã€‚
å¦‚æœ TwelveOrLess å¢åŠ åˆå§‹åŒ–å™¨ init(wrappedValue: Int)ï¼Œ</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@propertyWrapper</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TwelveOrLess</span> {   
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> number <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">wrappedValue</span>: <span class="hljs-type">Int</span>) {
        <span class="hljs-keyword">self</span>.number <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(wrappedValue, <span class="hljs-number">12</span>)
    }

    <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> number }
        <span class="hljs-keyword">set</span> { number <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(newValue, <span class="hljs-number">12</span>) }
    }
}
</code></pre>
<p>åˆ™ SmallRectangle çš„åˆå§‹åŒ–å™¨ä¸º</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">init</span>(
    <span class="hljs-params">height</span>: <span class="hljs-type">Int</span>,
    <span class="hljs-params">width</span>: <span class="hljs-type">Int</span>
)
</code></pre>
<p>å‚æ•° height å’Œ width çš„ç±»å‹ä¸ºåŸå§‹ç±»å‹ Intã€‚</p>
<p>å¦‚æœ TwelveOrLess å¢åŠ åˆå§‹åŒ–å™¨ init()ï¼Œ</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@propertyWrapper</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TwelveOrLess</span> {   
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> number <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">init</span>() {
        number  <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
    }
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">wrappedValue</span>: <span class="hljs-type">Int</span>) {
        <span class="hljs-keyword">self</span>.number <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(wrappedValue, <span class="hljs-number">12</span>)
    }

    <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> number }
        <span class="hljs-keyword">set</span> { number <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(newValue, <span class="hljs-number">12</span>) }
    }
}
</code></pre>
<p>åˆ™ SmallRectangle çš„åˆå§‹åŒ–å™¨ä¸º</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">init</span>(
    <span class="hljs-params">height</span>: <span class="hljs-type">TwelveOrLess</span> <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>(),
    <span class="hljs-params">width</span>: <span class="hljs-type">TwelveOrLess</span> <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>()
)
</code></pre>
<p>æ­¤æ—¶æƒ³è®© SmallRectangle çš„ memberwise åˆå§‹åŒ–å™¨å‚æ•°ç±»å‹ä¸ºåŸå§‹ç±»å‹ Intï¼Œéœ€è¦ä¿®æ”¹ä¸º</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SmallRectangle</span> {
    <span class="hljs-meta">@TwelveOrLess</span> <span class="hljs-keyword">var</span> height: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
    <span class="hljs-meta">@TwelveOrLess</span> <span class="hljs-keyword">var</span> width: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
}
</code></pre>
<p>ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ä¸º</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SmallRectangle</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _height <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>(wrappedValue: <span class="hljs-number">1</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> _width <span class="hljs-operator">=</span> <span class="hljs-type">TwelveOrLess</span>(wrappedValue: <span class="hljs-number">1</span>)
    <span class="hljs-keyword">var</span> height: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _height.wrappedValue }
        <span class="hljs-keyword">set</span> { _height.wrappedValue <span class="hljs-operator">=</span> newValue }
    }
    <span class="hljs-keyword">var</span> width: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> _width.wrappedValue }
        <span class="hljs-keyword">set</span> { _width.wrappedValue <span class="hljs-operator">=</span> newValue }
    }
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">height</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">width</span>: <span class="hljs-type">Int</span>) {
        <span class="hljs-keyword">self</span>.height <span class="hljs-operator">=</span> height
        <span class="hljs-keyword">self</span>.width <span class="hljs-operator">=</span> width
    }
}
</code></pre>
<p>æ€»ç»“ï¼šå¯¹ä¸€ä¸ª struct çš„æŸä¸ªå±æ€§åº”ç”¨åŒ…è£…å™¨ï¼Œè¦ä½¿ memberwise åˆå§‹åŒ–å™¨å¯¹åº”å‚æ•°ç±»å‹ä¸ºåŸå§‹ç±»å‹ï¼Œéœ€è¦å¦‚ä¸‹æ¡ä»¶ä¹‹ä¸€ï¼Œ</p>
<ul>
<li>å±æ€§åŒ…è£…å™¨æœ‰åˆå§‹åŒ–å™¨ init(wrappedValue:)ï¼Œå¹¶ä¸”æ²¡æœ‰ init()</li>
<li>å±æ€§æœ‰åˆå§‹å€¼ï¼Œåƒ @TwelveOrLess var height: Int = 1</li>
</ul>
<p>å¦åˆ™ï¼Œmemberwise åˆå§‹åŒ–å™¨å‚æ•°ç±»å‹ä¸ºåŒ…è£…å™¨ç±»å‹ã€‚</p>
<p>é™¤äº†è¢«åŒ…è£…çš„å€¼ï¼Œå±æ€§åŒ…è£…å™¨å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ª projected value æš´éœ²é¢å¤–çš„åŠŸèƒ½ã€‚</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@propertyWrapper</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SmallNumber</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> number: <span class="hljs-type">Int</span>
    <span class="hljs-keyword">private(set)</span> <span class="hljs-keyword">var</span> projectedValue: <span class="hljs-type">Bool</span>
    
    <span class="hljs-keyword">var</span> wrappedValue: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> number }
        <span class="hljs-keyword">set</span> {
            <span class="hljs-keyword">if</span> newValue <span class="hljs-operator">&gt;</span> <span class="hljs-number">12</span> {
                number <span class="hljs-operator">=</span> <span class="hljs-number">12</span>
                projectedValue <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
            } <span class="hljs-keyword">else</span> {
                number <span class="hljs-operator">=</span> newValue
                projectedValue <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
            }
        }
    }
    
    <span class="hljs-keyword">init</span>() {
        <span class="hljs-keyword">self</span>.number <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">self</span>.projectedValue <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    }
}
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒSmallNumber ç»“æ„å¢åŠ äº†ä¸€ä¸ªå±æ€§ projectedValueï¼Œç”¨æ¥è®°å½•åŒ…è£…å™¨æ˜¯å¦è°ƒæ•´äº†è¢«åŒ…è£…çš„å€¼ã€‚</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SomeStructure</span> {
    <span class="hljs-meta">@SmallNumber</span> <span class="hljs-keyword">var</span> someNumber: <span class="hljs-type">Int</span>
}

<span class="hljs-keyword">var</span> someStructure <span class="hljs-operator">=</span> <span class="hljs-type">SomeStructure</span>()
<span class="hljs-built_in">print</span>(someStructure.<span class="hljs-variable">$someNumber</span>)
<span class="hljs-comment">// æ‰“å° false</span>
someStructure.someNumber <span class="hljs-operator">=</span> <span class="hljs-number">55</span>
<span class="hljs-built_in">print</span>(someStructure.<span class="hljs-variable">$someNumber</span>)
<span class="hljs-comment">// æ‰“å° true</span>
</code></pre>
<p>é€šè¿‡åœ¨è¢«åŒ…è£…çš„å±æ€§åå‰å¢åŠ  $ æ¥è®¿é—®åŒ…è£…å™¨çš„ projectedValueã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆè¯† LangChain v1.x Agents]]></title>    <link>https://juejin.cn/post/7600326947506176052</link>    <guid>https://juejin.cn/post/7600326947506176052</guid>    <pubDate>2026-01-29T06:28:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7600326947506176052" data-draft-id="7600341731047374883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆè¯† LangChain v1.x Agents "/> <meta itemprop="keywords" content="LangChain,Agent"/> <meta itemprop="datePublished" content="2026-01-29T06:28:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é™ˆæš–ç§‹"/> <meta itemprop="url" content="https://juejin.cn/user/493019579297533"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆè¯† LangChain v1.x Agents 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/493019579297533/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é™ˆæš–ç§‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-29T06:28:18.000Z" title="Thu Jan 29 2026 06:28:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>404:Not Found</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">ğŸ“– ç›®å½•</h2>
<ol>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-agent" title="#%E4%BB%80%E4%B9%88%E6%98%AF-agent">ä»€ä¹ˆæ˜¯ Agentï¼Ÿ</a></li>
<li><a href="#agent-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6" title="#agent-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">Agent çš„æ ¸å¿ƒç»„ä»¶</a></li>
<li><a href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E5%88%9B%E5%BB%BA%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-agent" title="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%E5%88%9B%E5%BB%BA%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA-agent">å¿«é€Ÿä¸Šæ‰‹ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ª Agent</a></li>
<li><a href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3agent-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" title="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3agent-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">æ·±å…¥ç†è§£ï¼šAgent çš„å·¥ä½œåŸç†</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7" title="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">é«˜çº§ç‰¹æ€§</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B" title="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B">å®æˆ˜æ¡ˆä¾‹</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯ Agentï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªèªæ˜çš„åŠ©æ‰‹ï¼Œå®ƒä¸ä»…èƒ½å›ç­”é—®é¢˜ï¼Œè¿˜èƒ½ä¸»åŠ¨ä½¿ç”¨å„ç§å·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚è¿™å°±æ˜¯ <strong>Agent</strong>ï¼ˆæ™ºèƒ½ä»£ç†ï¼‰ï¼</p>
<h3 data-id="heading-2">ğŸ¯ Agent vs æ™®é€š LLM</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>æ™®é€š LLM</th><th>Agent</th></tr></thead><tbody><tr><td>å›ç­”é—®é¢˜</td><td>âœ…</td><td>âœ…</td></tr><tr><td>ä½¿ç”¨å·¥å…·</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å¤šæ­¥æ¨ç†</td><td>æœ‰é™</td><td>âœ…</td></tr><tr><td>è‡ªä¸»å†³ç­–</td><td>âŒ</td><td>âœ…</td></tr></tbody></table>
<h3 data-id="heading-3">ğŸ“Š Agent çš„å·¥ä½œæµç¨‹</h3>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·è¾“å…¥ â†’ LLM æ¨ç† â†’ é€‰æ‹©å·¥å…· â†’ æ‰§è¡Œå·¥å…· â†’ è§‚å¯Ÿç»“æœ â†’ å†æ¬¡æ¨ç† â†’ æœ€ç»ˆç­”æ¡ˆ
<span class="hljs-code">         â†‘______________________________________________|
                    ï¼ˆå¾ªç¯ç›´åˆ°å¾—å‡ºç­”æ¡ˆï¼‰
</span></code></pre>
<hr/>
<h2 data-id="heading-4">Agent çš„æ ¸å¿ƒç»„ä»¶</h2>
<p>ä¸€ä¸ªå®Œæ•´çš„ Agent ç³»ç»Ÿç”±ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š</p>
<h3 data-id="heading-5">1. ğŸ§  æ¨¡å‹ï¼ˆModelï¼‰</h3>
<p>æ¨¡å‹æ˜¯ Agent çš„"å¤§è„‘"ï¼Œè´Ÿè´£æ¨ç†å’Œå†³ç­–ã€‚</p>
<p><strong>é™æ€æ¨¡å‹é…ç½®ï¼š</strong></p>
<p>åœ¨åˆ›å»ºagentçš„æ—¶å€™é…ç½®ä¸€æ¬¡ï¼Œåç»­åœ¨æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­ä¿æŒä¸å˜ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepSeek

<span class="hljs-comment"># æ–¹å¼1ï¼šä½¿ç”¨æ¨¡å‹æ ‡è¯†ç¬¦å­—ç¬¦ä¸²ï¼ˆç®€å•å¿«æ·ï¼‰</span>
agent = create_agent(<span class="hljs-string">"deepseek:deepseek-chat"</span>, tools=tools)

<span class="hljs-comment"># æ–¹å¼2ï¼šä½¿ç”¨æ¨¡å‹å®ä¾‹ï¼ˆæ›´å¤šæ§åˆ¶ï¼‰</span>
model = ChatDeepSeek(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    temperature=<span class="hljs-number">0.7</span>,  <span class="hljs-comment"># æ§åˆ¶åˆ›é€ æ€§</span>
    max_tokens=<span class="hljs-number">2000</span>,  <span class="hljs-comment"># é™åˆ¶è¾“å‡ºé•¿åº¦</span>
    timeout=<span class="hljs-number">60</span>        <span class="hljs-comment"># è¶…æ—¶è®¾ç½®</span>
)
agent = create_agent(model, tools=tools)
</code></pre>
<p><strong>åŠ¨æ€æ¨¡å‹é€‰æ‹©ï¼š</strong></p>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©ä¸åŒçš„æ¨¡å‹ã€‚æ¯”å¦‚ç®€å•é—®é¢˜ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼Œå¤æ‚é—®é¢˜ç”¨å¼ºå¤§çš„æ¨¡å‹ï¼š
æˆ‘ä»¬é€šè¿‡ <code>@wrap_model_call</code> è£…é¥°å™¨æ¥åˆ›å»ºä¸­é—´ä»¶çš„æ–¹å¼æ¥ä½¿ç”¨åŠ¨æ€æ¨¡å‹ï¼Œæ¦‚ä¸­é—´ä»¶ä¼šä¿®æ”¹è¯·æ±‚ä¸­çš„æ¨¡å‹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> wrap_model_call

basic_model = ChatDeepSeek(model=<span class="hljs-string">"deepseek-chat"</span>)
advanced_model = ChatDeepSeek(model=<span class="hljs-string">"deepseek-reasoner"</span>)

<span class="hljs-meta">@wrap_model_call</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">smart_model_selection</span>(<span class="hljs-params">request, handler</span>):
    <span class="hljs-string">"""æ ¹æ®å¯¹è¯å¤æ‚åº¦æ™ºèƒ½é€‰æ‹©æ¨¡å‹"""</span>
    message_count = <span class="hljs-built_in">len</span>(request.state[<span class="hljs-string">"messages"</span>])
    
    <span class="hljs-keyword">if</span> message_count &gt; <span class="hljs-number">10</span>:
        <span class="hljs-comment"># é•¿å¯¹è¯ä½¿ç”¨æ¨ç†æ¨¡å‹</span>
        model = advanced_model
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ“ˆ ä½¿ç”¨æ¨ç†æ¨¡å‹å¤„ç†å¤æ‚å¯¹è¯"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># çŸ­å¯¹è¯ä½¿ç”¨å¯¹è¯æ¨¡å‹èŠ‚çœæˆæœ¬</span>
        model = basic_model
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ’¡ ä½¿ç”¨å¯¹è¯æ¨¡å‹å¤„ç†ç®€å•å¯¹è¯"</span>)
    
    <span class="hljs-keyword">return</span> handler(request.override(model=model))

agent = create_agent(
    model=basic_model,
    tools=tools,
    middleware=[smart_model_selection]
)
</code></pre>
<h3 data-id="heading-6">2. ğŸ”§ å·¥å…·ï¼ˆToolsï¼‰</h3>
<p>å·¥å…·èµ‹äºˆ Agent è¡ŒåŠ¨èƒ½åŠ›ï¼Œè®©å®ƒèƒ½å¤Ÿä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’ã€‚</p>
<p><strong>å®šä¹‰å·¥å…·ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_web</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""åœ¨äº’è”ç½‘ä¸Šæœç´¢ä¿¡æ¯"""</span>
    <span class="hljs-comment"># å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè°ƒç”¨çœŸå®çš„æœç´¢ API</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"æœç´¢ç»“æœï¼š<span class="hljs-subst">{query}</span> çš„ç›¸å…³ä¿¡æ¯..."</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯"""</span>
    <span class="hljs-comment"># å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè°ƒç”¨å¤©æ°” API</span>
    weather_data = {
        <span class="hljs-string">"åŒ—äº¬"</span>: <span class="hljs-string">"æ™´å¤©ï¼Œ15Â°C"</span>,
        <span class="hljs-string">"ä¸Šæµ·"</span>: <span class="hljs-string">"å¤šäº‘ï¼Œ18Â°C"</span>,
        <span class="hljs-string">"æ·±åœ³"</span>: <span class="hljs-string">"é˜´å¤©ï¼Œ22Â°C"</span>
    }
    <span class="hljs-keyword">return</span> weather_data.get(city, <span class="hljs-string">"æœªçŸ¥åŸå¸‚"</span>)

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">expression: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è®¡ç®—æ•°å­¦è¡¨è¾¾å¼"""</span>
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-built_in">eval</span>(expression)
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"è®¡ç®—ç»“æœï¼š<span class="hljs-subst">{result}</span>"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"è®¡ç®—é”™è¯¯ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>

<span class="hljs-comment"># åˆ›å»º Agent æ—¶ä¼ å…¥å·¥å…·åˆ—è¡¨</span>
tools = [search_web, get_weather, calculate]
</code></pre>
<blockquote>
<p>å¦‚æœæä¾›äº†ä¸€ä¸ªç©ºçš„å·¥å…·åˆ—è¡¨ï¼Œæ™ºèƒ½ä½“å°†ç”±ä¸€ä¸ªä¸å…·å¤‡å·¥å…·è°ƒç”¨åŠŸèƒ½çš„å•ä¸ª LLM èŠ‚ç‚¹ç»„æˆã€‚</p>
</blockquote>
<p><strong>å·¥å…·é”™è¯¯å¤„ç†ï¼š</strong></p>
<p>é€šè¿‡ <code>@wrap_tool_call</code> ä¸­é—´ä»¶è‡ªå®šä¹‰å·¥å…·é”™è¯¯çš„å¤„ç†æ–¹å¼ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> wrap_tool_call
<span class="hljs-keyword">from</span> langchain.messages <span class="hljs-keyword">import</span> ToolMessage

<span class="hljs-meta">@wrap_tool_call</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_tool_errors</span>(<span class="hljs-params">request, handler</span>):
    <span class="hljs-string">"""ä¼˜é›…åœ°å¤„ç†å·¥å…·æ‰§è¡Œé”™è¯¯"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">return</span> handler(request)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ å·¥å…·æ‰§è¡Œå¤±è´¥ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        <span class="hljs-keyword">return</span> ToolMessage(
            content=<span class="hljs-string">f"å·¥å…·æ‰§è¡Œå‡ºé”™ï¼Œè¯·æ£€æŸ¥è¾“å…¥åé‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š<span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
            tool_call_id=request.tool_call[<span class="hljs-string">"id"</span>]
        )

agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=[search_web, get_weather, calculate],
    middleware=[handle_tool_errors]
)
</code></pre>
<p>ä¸Šè¿°ç¤ºä¾‹ï¼Œä¼šåœ¨å·¥å…·å¤±è´¥æ—¶ï¼Œè¿”å›ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯æ¶ˆæ¯ <code>ToolMessage</code> ã€‚</p>
<h3 data-id="heading-7">3. ğŸ’¬ ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰</h3>
<p>ç³»ç»Ÿæç¤ºè¯å®šä¹‰äº† Agent çš„"æ€§æ ¼"å’Œè¡Œä¸ºå‡†åˆ™ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åŸºç¡€ç³»ç»Ÿæç¤ºè¯</span>
agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=tools,
    system_prompt=<span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°æ®åˆ†æåŠ©æ‰‹ï¼Œæ“…é•¿ç”¨å›¾è¡¨å’Œæ•°æ®è¯´è¯ã€‚"</span>
)

<span class="hljs-comment"># åŠ¨æ€ç³»ç»Ÿæç¤ºè¯ï¼ˆæ ¹æ®ç”¨æˆ·è§’è‰²è°ƒæ•´ï¼‰</span>
<span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> dynamic_prompt

<span class="hljs-meta">@dynamic_prompt</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">role_based_prompt</span>(<span class="hljs-params">request</span>):
    <span class="hljs-string">"""æ ¹æ®ç”¨æˆ·è§’è‰²ç”Ÿæˆä¸ªæ€§åŒ–æç¤ºè¯"""</span>
    user_role = request.runtime.context.get(<span class="hljs-string">"user_role"</span>, <span class="hljs-string">"æ™®é€šç”¨æˆ·"</span>)
    
    prompts = {
        <span class="hljs-string">"ä¸“å®¶"</span>: <span class="hljs-string">"ä½ æ˜¯æŠ€æœ¯ä¸“å®¶åŠ©æ‰‹ï¼Œæä¾›æ·±å…¥çš„æŠ€æœ¯åˆ†æå’Œè¯¦ç»†è§£é‡Šã€‚"</span>,
        <span class="hljs-string">"åˆå­¦è€…"</span>: <span class="hljs-string">"ä½ æ˜¯æ–°æ‰‹å‹å¥½çš„åŠ©æ‰‹ï¼Œç”¨ç®€å•æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šæ¦‚å¿µï¼Œé¿å…æœ¯è¯­ã€‚"</span>,
        <span class="hljs-string">"å­¦ç”Ÿ"</span>: <span class="hljs-string">"ä½ æ˜¯æ•™å­¦åŠ©æ‰‹ï¼Œé€šè¿‡ä¾‹å­å’Œç±»æ¯”å¸®åŠ©å­¦ç”Ÿç†è§£çŸ¥è¯†ã€‚"</span>
    }
    
    <span class="hljs-keyword">return</span> prompts.get(user_role, <span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„é€šç”¨åŠ©æ‰‹ã€‚"</span>)

agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=tools,
    middleware=[role_based_prompt]
)
</code></pre>
<blockquote>
<p>å½“æœªæä¾› system_prompt æ—¶ï¼Œagentä¼šç›´æ¥ä»æ¶ˆæ¯ä¸­æ¨æ–­å…¶ä»»åŠ¡ã€‚
@dynamic_prompt è£…é¥°å™¨åˆ›å»ºäº†ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¯ä»¥æ ¹æ®æ¨¡å‹è¯·æ±‚åŠ¨æ€ç”Ÿæˆç³»ç»Ÿæç¤º</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">å¿«é€Ÿä¸Šæ‰‹ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ª Agent</h2>
<h3 data-id="heading-9">ğŸ¬ å®Œæ•´ç¤ºä¾‹ï¼šå¤©æ°”æŸ¥è¯¢åŠ©æ‰‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepSeek
<span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool

<span class="hljs-comment"># æ­¥éª¤1ï¼šå®šä¹‰å·¥å…·</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è·å–åŸå¸‚å¤©æ°”ä¿¡æ¯
    
    Args:
        city: åŸå¸‚åç§°ï¼Œå¦‚"åŒ—äº¬"ã€"ä¸Šæµ·"
    
    Returns:
        è¯¥åŸå¸‚çš„å¤©æ°”ä¿¡æ¯
    """</span>
    weather_db = {
        <span class="hljs-string">"åŒ—äº¬"</span>: <span class="hljs-string">"â˜€ï¸ æ™´å¤©ï¼Œæ¸©åº¦ 15Â°Cï¼Œç©ºæ°”è´¨é‡è‰¯å¥½"</span>,
        <span class="hljs-string">"ä¸Šæµ·"</span>: <span class="hljs-string">"â›… å¤šäº‘ï¼Œæ¸©åº¦ 18Â°Cï¼Œæœ‰è½»å¾®é›¾éœ¾"</span>,
        <span class="hljs-string">"æ·±åœ³"</span>: <span class="hljs-string">"ğŸŒ§ï¸ å°é›¨ï¼Œæ¸©åº¦ 22Â°Cï¼Œæ¹¿åº¦è¾ƒå¤§"</span>,
        <span class="hljs-string">"å¹¿å·"</span>: <span class="hljs-string">"â˜€ï¸ æ™´å¤©ï¼Œæ¸©åº¦ 25Â°Cï¼Œé€‚åˆå¤–å‡º"</span>
    }
    <span class="hljs-keyword">return</span> weather_db.get(city, <span class="hljs-string">f"æŠ±æ­‰ï¼Œæš‚æ—  <span class="hljs-subst">{city}</span> çš„å¤©æ°”ä¿¡æ¯"</span>)

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather_forecast</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span>, days: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è·å–åŸå¸‚æœªæ¥å‡ å¤©çš„å¤©æ°”é¢„æŠ¥
    
    Args:
        city: åŸå¸‚åç§°
        days: é¢„æŠ¥å¤©æ•°ï¼ˆé»˜è®¤3å¤©ï¼‰
    
    Returns:
        æœªæ¥å‡ å¤©çš„å¤©æ°”é¢„æŠ¥
    """</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span> æœªæ¥ <span class="hljs-subst">{days}</span> å¤©å¤©æ°”ï¼š\nç¬¬1å¤©ï¼šæ™´ 20Â°C\nç¬¬2å¤©ï¼šå¤šäº‘ 18Â°C\nç¬¬3å¤©ï¼šå°é›¨ 16Â°C"</span>

<span class="hljs-comment"># æ­¥éª¤2ï¼šåˆ›å»º Agent</span>
weather_agent = create_agent(
    model=ChatDeepSeek(model=<span class="hljs-string">"deepseek-chat"</span>, temperature=<span class="hljs-number">0</span>),
    tools=[get_weather, get_weather_forecast],
    system_prompt=<span class="hljs-string">"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¤©æ°”åŠ©æ‰‹ã€‚
    
    ä½ çš„èŒè´£ï¼š
    1. å‡†ç¡®æä¾›ç”¨æˆ·æŸ¥è¯¢çš„åŸå¸‚å¤©æ°”ä¿¡æ¯
    2. å¦‚æœç”¨æˆ·è¯¢é—®æœªæ¥å¤©æ°”ï¼Œä¸»åŠ¨ä½¿ç”¨å¤©æ°”é¢„æŠ¥å·¥å…·
    3. ç»™å‡ºè´´å¿ƒçš„å‡ºè¡Œå»ºè®®
    
    å›ç­”é£æ ¼ï¼šå‹å¥½ã€ç®€æ´ã€å®ç”¨
    """</span>
)

<span class="hljs-comment"># æ­¥éª¤3ï¼šä½¿ç”¨ Agent</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ¤– å¤©æ°”åŠ©æ‰‹å·²å¯åŠ¨ï¼\n"</span>)

<span class="hljs-comment"># ç¤ºä¾‹å¯¹è¯1ï¼šæŸ¥è¯¢å½“å‰å¤©æ°”</span>
result1 = weather_agent.invoke({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"åŒ—äº¬ç°åœ¨å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>}]
})
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·ï¼šåŒ—äº¬ç°åœ¨å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ©æ‰‹ï¼š<span class="hljs-subst">{result1[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>\n"</span>)

<span class="hljs-comment"># ç¤ºä¾‹å¯¹è¯2ï¼šæŸ¥è¯¢æœªæ¥å¤©æ°”</span>
result2 = weather_agent.invoke({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"ä¸Šæµ·è¿™å‘¨æœ«å¤©æ°”å¦‚ä½•ï¼Ÿæˆ‘æƒ³å»å¤–æ»©"</span>}]
})
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·ï¼šä¸Šæµ·è¿™å‘¨æœ«å¤©æ°”å¦‚ä½•ï¼Ÿæˆ‘æƒ³å»å¤–æ»©"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ©æ‰‹ï¼š<span class="hljs-subst">{result2[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
</code></pre>
<p><strong>è¿è¡Œç»“æœï¼š</strong></p>
<pre><code class="hljs">ğŸ¤– å¤©æ°”åŠ©æ‰‹å·²å¯åŠ¨ï¼

ç”¨æˆ·ï¼šåŒ—äº¬ç°åœ¨å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
åŠ©æ‰‹ï¼šåŒ—äº¬ç°åœ¨å¤©æ°”å¾ˆå¥½ï¼â˜€ï¸ æ™´å¤©ï¼Œæ¸©åº¦ 15Â°Cï¼Œç©ºæ°”è´¨é‡è‰¯å¥½ã€‚é€‚åˆå¤–å‡ºæ´»åŠ¨ï¼Œå»ºè®®ç©¿è–„å¤–å¥—ã€‚

ç”¨æˆ·ï¼šä¸Šæµ·è¿™å‘¨æœ«å¤©æ°”å¦‚ä½•ï¼Ÿæˆ‘æƒ³å»å¤–æ»©
åŠ©æ‰‹ï¼šä¸Šæµ·è¿™å‘¨æœ«å¤©æ°”é¢„æŠ¥ï¼š
ç¬¬1å¤©ï¼šæ™´ 20Â°C
ç¬¬2å¤©ï¼šå¤šäº‘ 18Â°C  
ç¬¬3å¤©ï¼šå°é›¨ 16Â°C

å»ºè®®å‘¨å…­å»å¤–æ»©ï¼Œå¤©æ°”æœ€å¥½ï¼å‘¨æ—¥å¯èƒ½æœ‰å°é›¨ï¼Œè®°å¾—å¸¦ä¼å“¦ã€‚â˜”
</code></pre>
<hr/>
<h2 data-id="heading-10">æ·±å…¥ç†è§£ï¼šAgent çš„å·¥ä½œåŸç†</h2>
<h3 data-id="heading-11">ğŸ”„ ReAct å¾ªç¯ï¼šæ¨ç† + è¡ŒåŠ¨</h3>
<p>Agent ä½¿ç”¨ <strong>ReAct</strong>ï¼ˆReasoning + Actingï¼‰æ¨¡å¼å·¥ä½œï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ReAct å·¥ä½œæµç¨‹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="hljs-number">1</span>ï¸âƒ£ ç”¨æˆ·è¾“å…¥ï¼š
   <span class="hljs-string">"å¸®æˆ‘æŸ¥è¯¢åŒ—äº¬å’Œä¸Šæµ·çš„å¤©æ°”ï¼Œç„¶åå‘Šè¯‰æˆ‘å“ªä¸ªåŸå¸‚æ›´é€‚åˆæ—…æ¸¸"</span>

<span class="hljs-number">2</span>ï¸âƒ£ Agent æ¨ç†ï¼š
   ğŸ’­ <span class="hljs-string">"æˆ‘éœ€è¦å…ˆè·å–ä¸¤ä¸ªåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒ"</span>

<span class="hljs-number">3</span>ï¸âƒ£ Agent è¡ŒåŠ¨ï¼š
   ğŸ”§ è°ƒç”¨å·¥å…· <span class="hljs-built_in">get_weather</span>(<span class="hljs-string">"åŒ—äº¬"</span>)
   
<span class="hljs-number">4</span>ï¸âƒ£ è§‚å¯Ÿç»“æœï¼š
   ğŸ“Š <span class="hljs-string">"åŒ—äº¬ï¼šæ™´å¤©ï¼Œ15Â°Cï¼Œç©ºæ°”è´¨é‡è‰¯å¥½"</span>

<span class="hljs-number">5</span>ï¸âƒ£ Agent å†æ¬¡æ¨ç†ï¼š
   ğŸ’­ <span class="hljs-string">"å¥½çš„ï¼Œå·²ç»æœ‰åŒ—äº¬çš„å¤©æ°”äº†ï¼Œç°åœ¨è·å–ä¸Šæµ·çš„"</span>

<span class="hljs-number">6</span>ï¸âƒ£ Agent å†æ¬¡è¡ŒåŠ¨ï¼š
   ğŸ”§ è°ƒç”¨å·¥å…· <span class="hljs-built_in">get_weather</span>(<span class="hljs-string">"ä¸Šæµ·"</span>)

<span class="hljs-number">7</span>ï¸âƒ£ è§‚å¯Ÿç»“æœï¼š
   ğŸ“Š <span class="hljs-string">"ä¸Šæµ·ï¼šå¤šäº‘ï¼Œ18Â°Cï¼Œæœ‰è½»å¾®é›¾éœ¾"</span>

<span class="hljs-number">8</span>ï¸âƒ£ Agent æœ€ç»ˆæ¨ç†ï¼š
   ğŸ’­ <span class="hljs-string">"ç°åœ¨æˆ‘æœ‰ä¸¤ä¸ªåŸå¸‚çš„å¤©æ°”æ•°æ®ï¼Œå¯ä»¥è¿›è¡Œæ¯”è¾ƒäº†"</span>

<span class="hljs-number">9</span>ï¸âƒ£ è¾“å‡ºç­”æ¡ˆï¼š
   âœ… <span class="hljs-string">"æ ¹æ®å¤©æ°”æƒ…å†µï¼ŒåŒ—äº¬æ›´é€‚åˆæ—…æ¸¸ã€‚åŒ—äº¬æ˜¯æ™´å¤©ä¸”ç©ºæ°”è´¨é‡è‰¯å¥½ï¼Œ
       è€Œä¸Šæµ·å¤šäº‘ä¸”æœ‰è½»å¾®é›¾éœ¾ã€‚å»ºè®®é€‰æ‹©åŒ—äº¬ã€‚"</span>
</code></pre>
<h3 data-id="heading-12">ğŸ“ˆ å®é™…æ‰§è¡Œè¿½è¸ª</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¯ç”¨è¯¦ç»†è¿½è¸ªæ¨¡å¼</span>
agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=[get_weather, get_weather_forecast],
    system_prompt=<span class="hljs-string">"ä½ æ˜¯å¤©æ°”åŠ©æ‰‹"</span>
)

<span class="hljs-comment"># æµå¼è¾“å‡ºï¼ŒæŸ¥çœ‹ä¸­é—´æ­¥éª¤</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ” Agent æ‰§è¡Œè¿½è¸ª"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> agent.stream(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æ¯”è¾ƒåŒ—äº¬å’Œä¸Šæµ·çš„å¤©æ°”"</span>}]},
    stream_mode=<span class="hljs-string">"values"</span>
):
    latest_message = chunk[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
    
    <span class="hljs-keyword">if</span> latest_message.content:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ’¬ Agent å›å¤ï¼š<span class="hljs-subst">{latest_message.content}</span>"</span>)
    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(latest_message, <span class="hljs-string">'tool_calls'</span>) <span class="hljs-keyword">and</span> latest_message.tool_calls:
        tool_names = [tc[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">for</span> tc <span class="hljs-keyword">in</span> latest_message.tool_calls]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ”§ æ­£åœ¨è°ƒç”¨å·¥å…·ï¼š<span class="hljs-subst">{<span class="hljs-string">', '</span>.join(tool_names)}</span>"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-13">é«˜çº§ç‰¹æ€§</h2>
<h3 data-id="heading-14">1. ğŸ¯ ç»“æ„åŒ–è¾“å‡º</h3>
<p>è®© Agent è¿”å›æ ¼å¼åŒ–çš„æ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯çº¯æ–‡æœ¬ã€‚LangChain é€šè¿‡ <code>response_format</code> å‚æ•°æä¾›ç»“æ„åŒ–è¾“å‡ºç­–ç•¥ã€‚</p>
<p><strong>ToolStrategy</strong></p>
<p>ToolStrategy ä½¿ç”¨äººå·¥å·¥å…·è°ƒç”¨æ¥ç”Ÿæˆç»“æ„åŒ–è¾“å‡ºã€‚è¿™é€‚ç”¨äºä»»ä½•æ”¯æŒå·¥å…·è°ƒç”¨çš„æ¨¡å‹ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> langchain.agents.structured_output <span class="hljs-keyword">import</span> ToolStrategy

<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherReport</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""å¤©æ°”æŠ¥å‘Šæ•°æ®æ¨¡å‹"""</span>
    city: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"åŸå¸‚åç§°"</span>)
    temperature: <span class="hljs-built_in">int</span> = Field(description=<span class="hljs-string">"æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰"</span>)
    weather: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"å¤©æ°”çŠ¶å†µ"</span>)
    suggestion: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"å‡ºè¡Œå»ºè®®"</span>)

<span class="hljs-comment"># åˆ›å»ºè¿”å›ç»“æ„åŒ–è¾“å‡ºçš„ Agent</span>
structured_agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=[get_weather],
    response_format=ToolStrategy(WeatherReport)
)

result = structured_agent.invoke({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æŸ¥è¯¢åŒ—äº¬å¤©æ°”"</span>}]
})

<span class="hljs-comment"># è·å–ç»“æ„åŒ–æ•°æ®</span>
weather_data = result[<span class="hljs-string">"structured_response"</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŸå¸‚ï¼š<span class="hljs-subst">{weather_data.city}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ¸©åº¦ï¼š<span class="hljs-subst">{weather_data.temperature}</span>Â°C"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤©æ°”ï¼š<span class="hljs-subst">{weather_data.weather}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"å»ºè®®ï¼š<span class="hljs-subst">{weather_data.suggestion}</span>"</span>)
</code></pre>
<p><strong>è¾“å‡ºç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs">åŸå¸‚ï¼šåŒ—äº¬
æ¸©åº¦ï¼š15Â°C
å¤©æ°”ï¼šæ™´å¤©
å»ºè®®ï¼šå¤©æ°”æ™´æœ—ï¼Œé€‚åˆæˆ·å¤–æ´»åŠ¨ï¼Œå»ºè®®ç©¿è–„å¤–å¥—
</code></pre>
<p><strong>ProviderStrategy</strong></p>
<p>ä½¿ç”¨æ¨¡å‹æä¾›è€…åŸç”Ÿçš„ç»“æ„åŒ–è¾“å‡ºç”Ÿæˆã€‚è¿™æ›´å¯é ï¼Œä½†ä»…é€‚ç”¨äºæ”¯æŒåŸç”Ÿç»“æ„åŒ–è¾“å‡ºçš„æä¾›è€…ï¼ˆä¾‹å¦‚ OpenAIï¼‰ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents.structured_output <span class="hljs-keyword">import</span> ProviderStrategy

agent = create_agent(
    model=<span class="hljs-string">"gpt-4o"</span>,
    response_format=ProviderStrategy(ContactInfo)
)
</code></pre>
<h3 data-id="heading-15">2. ğŸ§  è®°å¿†ä¸çŠ¶æ€ç®¡ç†</h3>
<p>è®© Agent è®°ä½å¯¹è¯ä¸Šä¸‹æ–‡å’Œç”¨æˆ·åå¥½ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> AgentState
<span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> AgentMiddleware
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict

<span class="hljs-comment"># å®šä¹‰è‡ªå®šä¹‰çŠ¶æ€</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherAgentState</span>(<span class="hljs-title class_ inherited__">AgentState</span>):
    user_preferences: <span class="hljs-built_in">dict</span>  <span class="hljs-comment"># ç”¨æˆ·åå¥½</span>
    search_history: <span class="hljs-built_in">list</span>    <span class="hljs-comment"># æœç´¢å†å²</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryMiddleware</span>(<span class="hljs-title class_ inherited__">AgentMiddleware</span>):
    <span class="hljs-string">"""å¸¦è®°å¿†çš„ä¸­é—´ä»¶"""</span>
    state_schema = WeatherAgentState
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">before_model</span>(<span class="hljs-params">self, state, runtime</span>):
        <span class="hljs-comment"># åœ¨è°ƒç”¨æ¨¡å‹å‰ï¼Œæ·»åŠ å†å²è®°å½•åˆ°ä¸Šä¸‹æ–‡</span>
        history = state.get(<span class="hljs-string">"search_history"</span>, [])
        <span class="hljs-keyword">if</span> history:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“š ç”¨æˆ·å†å²æŸ¥è¯¢ï¼š<span class="hljs-subst">{<span class="hljs-string">', '</span>.join(history[-<span class="hljs-number">3</span>:])}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-comment"># åˆ›å»ºå¸¦è®°å¿†çš„ Agent</span>
memory_agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=[get_weather],
    middleware=[MemoryMiddleware()]
)

<span class="hljs-comment"># ä½¿ç”¨å¸¦çŠ¶æ€çš„è°ƒç”¨</span>
result = memory_agent.invoke({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"åŒ—äº¬å¤©æ°”"</span>}],
    <span class="hljs-string">"user_preferences"</span>: {<span class="hljs-string">"temperature_unit"</span>: <span class="hljs-string">"celsius"</span>},
    <span class="hljs-string">"search_history"</span>: [<span class="hljs-string">"ä¸Šæµ·"</span>, <span class="hljs-string">"å¹¿å·"</span>, <span class="hljs-string">"æ·±åœ³"</span>]
})
</code></pre>
<h3 data-id="heading-16">3. ğŸ”€ åŠ¨æ€å·¥å…·é€‰æ‹©</h3>
<p>æ ¹æ®ä¸åŒåœºæ™¯åŠ¨æ€æä¾›ä¸åŒçš„å·¥å…·é›†ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents.middleware <span class="hljs-keyword">import</span> wrap_model_call

<span class="hljs-meta">@wrap_model_call</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">permission_based_tools</span>(<span class="hljs-params">request, handler</span>):
    <span class="hljs-string">"""æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€é€‰æ‹©å·¥å…·"""</span>
    user_role = request.runtime.context.get(<span class="hljs-string">"user_role"</span>, <span class="hljs-string">"guest"</span>)
    
    <span class="hljs-keyword">if</span> user_role == <span class="hljs-string">"admin"</span>:
        <span class="hljs-comment"># ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰å·¥å…·</span>
        tools = [get_weather, get_weather_forecast, update_weather_data]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ” ç®¡ç†å‘˜æƒé™ï¼šæ‰€æœ‰å·¥å…·å¯ç”¨"</span>)
    <span class="hljs-keyword">elif</span> user_role == <span class="hljs-string">"vip"</span>:
        <span class="hljs-comment"># VIP ç”¨æˆ·å¯ä»¥ä½¿ç”¨é«˜çº§åŠŸèƒ½</span>
        tools = [get_weather, get_weather_forecast]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"â­ VIP æƒé™ï¼šåŸºç¡€ + é¢„æŠ¥å·¥å…·"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># æ™®é€šç”¨æˆ·åªèƒ½æŸ¥è¯¢åŸºç¡€å¤©æ°”</span>
        tools = [get_weather]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‘¤ æ™®é€šæƒé™ï¼šä»…åŸºç¡€å·¥å…·"</span>)
    
    <span class="hljs-keyword">return</span> handler(request.override(tools=tools))

dynamic_tool_agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=[get_weather, get_weather_forecast],
    middleware=[permission_based_tools]
)

<span class="hljs-comment"># ä»¥ä¸åŒè§’è‰²è°ƒç”¨</span>
result = dynamic_tool_agent.invoke(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æŸ¥è¯¢å¤©æ°”"</span>}]},
    context={<span class="hljs-string">"user_role"</span>: <span class="hljs-string">"vip"</span>}
)
</code></pre>
<hr/>
<h2 data-id="heading-17">å®æˆ˜æ¡ˆä¾‹</h2>
<h3 data-id="heading-18">ğŸŒŸ æ¡ˆä¾‹1ï¼šæ™ºèƒ½æ—…æ¸¸åŠ©æ‰‹</h3>
<p>ç»“åˆå¤šä¸ªå·¥å…·çš„ç»¼åˆåº”ç”¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepSeek

<span class="hljs-comment"># å®šä¹‰å¤šä¸ªæ—…æ¸¸ç›¸å…³å·¥å…·</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""è·å–åŸå¸‚å¤©æ°”"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span>ï¼šæ™´å¤©ï¼Œé€‚åˆæ—…æ¸¸"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_attractions</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æœç´¢åŸå¸‚æ™¯ç‚¹"""</span>
    attractions = {
        <span class="hljs-string">"åŒ—äº¬"</span>: <span class="hljs-string">"æ•…å®«ã€é•¿åŸã€é¢å’Œå›­ã€å¤©å›"</span>,
        <span class="hljs-string">"ä¸Šæµ·"</span>: <span class="hljs-string">"å¤–æ»©ã€ä¸œæ–¹æ˜ç ã€è±«å›­ã€è¿ªå£«å°¼"</span>,
        <span class="hljs-string">"æ­å·"</span>: <span class="hljs-string">"è¥¿æ¹–ã€çµéšå¯ºã€åƒå²›æ¹–ã€å®‹åŸ"</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span>çƒ­é—¨æ™¯ç‚¹ï¼š<span class="hljs-subst">{attractions.get(city, <span class="hljs-string">'æš‚æ— æ•°æ®'</span>)}</span>"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">estimate_budget</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span>, days: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""ä¼°ç®—æ—…æ¸¸é¢„ç®—"""</span>
    daily_cost = {<span class="hljs-string">"åŒ—äº¬"</span>: <span class="hljs-number">800</span>, <span class="hljs-string">"ä¸Šæµ·"</span>: <span class="hljs-number">900</span>, <span class="hljs-string">"æ­å·"</span>: <span class="hljs-number">700</span>}
    cost = daily_cost.get(city, <span class="hljs-number">800</span>) * days
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{city}</span> <span class="hljs-subst">{days}</span>å¤©æ—…æ¸¸é¢„ç®—çº¦ï¼š<span class="hljs-subst">{cost}</span>å…ƒï¼ˆå«ä½å®¿ã€é¤é¥®ã€é—¨ç¥¨ï¼‰"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_transportation</span>(<span class="hljs-params">from_city: <span class="hljs-built_in">str</span>, to_city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æŸ¥è¯¢äº¤é€šæ–¹å¼"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{from_city}</span> â†’ <span class="hljs-subst">{to_city}</span>ï¼šé«˜é“3å°æ—¶ï¼Œé£æœº1.5å°æ—¶"</span>

<span class="hljs-comment"># åˆ›å»ºæ—…æ¸¸åŠ©æ‰‹</span>
travel_agent = create_agent(
    model=ChatDeepSeek(model=<span class="hljs-string">"deepseek-chat"</span>, temperature=<span class="hljs-number">0.7</span>),
    tools=[get_weather, search_attractions, estimate_budget, get_transportation],
    system_prompt=<span class="hljs-string">"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ—…æ¸¸è§„åˆ’åŠ©æ‰‹ã€‚

    ä½ çš„èƒ½åŠ›ï¼š
    1. æŸ¥è¯¢å¤©æ°”ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦é€‚åˆæ—…æ¸¸
    2. æ¨èçƒ­é—¨æ™¯ç‚¹ï¼Œåˆ¶å®šæ¸¸ç©è·¯çº¿
    3. ä¼°ç®—æ—…æ¸¸é¢„ç®—ï¼Œå¸®åŠ©ç”¨æˆ·åšå¥½è´¢åŠ¡è§„åˆ’
    4. æŸ¥è¯¢äº¤é€šæ–¹å¼ï¼Œæä¾›å‡ºè¡Œå»ºè®®
    
    ä½ çš„é£æ ¼ï¼š
    - çƒ­æƒ…å‹å¥½ï¼Œå……æ»¡æ—…æ¸¸çƒ­æƒ…
    - æä¾›è¯¦ç»†å®ç”¨çš„å»ºè®®
    - è€ƒè™‘ç”¨æˆ·é¢„ç®—å’Œæ—¶é—´é™åˆ¶
    """</span>
)

<span class="hljs-comment"># ç¤ºä¾‹å¯¹è¯</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ–ï¸ æ™ºèƒ½æ—…æ¸¸åŠ©æ‰‹"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

query = <span class="hljs-string">"""æˆ‘æƒ³ä»åŒ—äº¬å»æ­å·ç©3å¤©ï¼Œå¸®æˆ‘è§„åˆ’ä¸€ä¸‹ï¼š
1. ç°åœ¨å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
2. æœ‰ä»€ä¹ˆå¥½ç©çš„åœ°æ–¹ï¼Ÿ
3. å¤§æ¦‚éœ€è¦å¤šå°‘é¢„ç®—ï¼Ÿ
4. æ€ä¹ˆå»æ¯”è¾ƒæ–¹ä¾¿ï¼Ÿ
"""</span>

result = travel_agent.invoke({
    <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: query}]
})

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç”¨æˆ·æé—®ï¼š\n<span class="hljs-subst">{query}</span>\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ©æ‰‹å›ç­”ï¼š\n<span class="hljs-subst">{result[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content}</span>"</span>)
</code></pre>
<p><strong>é¢„æœŸè¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">ğŸ–ï¸ æ™ºèƒ½æ—…æ¸¸åŠ©æ‰‹
============================================================</span>
ç”¨æˆ·æé—®ï¼š
æˆ‘æƒ³ä»åŒ—äº¬å»æ­å·ç©3å¤©ï¼Œå¸®æˆ‘è§„åˆ’ä¸€ä¸‹ï¼š
<span class="hljs-bullet">1.</span> ç°åœ¨å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
<span class="hljs-bullet">2.</span> æœ‰ä»€ä¹ˆå¥½ç©çš„åœ°æ–¹ï¼Ÿ
<span class="hljs-bullet">3.</span> å¤§æ¦‚éœ€è¦å¤šå°‘é¢„ç®—ï¼Ÿ
<span class="hljs-bullet">4.</span> æ€ä¹ˆå»æ¯”è¾ƒæ–¹ä¾¿ï¼Ÿ

åŠ©æ‰‹å›ç­”ï¼š
å¤ªå¥½äº†ï¼è®©æˆ‘ä¸ºæ‚¨è§„åˆ’è¿™æ¬¡æ­å·ä¹‹æ—… ğŸ‰

ğŸ“ <span class="hljs-strong">**ç›®çš„åœ°å¤©æ°”**</span>
æ­å·ï¼šæ™´å¤©ï¼Œéå¸¸é€‚åˆæ—…æ¸¸ï¼

ğŸ¯ <span class="hljs-strong">**æ¨èæ™¯ç‚¹**</span>
æ­å·çš„çƒ­é—¨æ™¯ç‚¹æœ‰ï¼šè¥¿æ¹–ã€çµéšå¯ºã€åƒå²›æ¹–ã€å®‹åŸ
å»ºè®®ç¬¬ä¸€å¤©æ¸¸è¥¿æ¹–ï¼Œç¬¬äºŒå¤©å»çµéšå¯ºï¼Œç¬¬ä¸‰å¤©å¯ä»¥å»å®‹åŸä½“éªŒæ–‡åŒ–æ¼”å‡ºã€‚

ğŸ’° <span class="hljs-strong">**é¢„ç®—ä¼°ç®—**</span>
3å¤©æ—…æ¸¸é¢„ç®—çº¦ï¼š2100å…ƒï¼ˆå«ä½å®¿ã€é¤é¥®ã€é—¨ç¥¨ï¼‰
å»ºè®®å¤šå‡†å¤‡500å…ƒä½œä¸ºè´­ç‰©å’Œåº”æ€¥èµ„é‡‘ã€‚

ğŸš„ <span class="hljs-strong">**äº¤é€šå»ºè®®**</span>
åŒ—äº¬ â†’ æ­å·ï¼šé«˜é“3å°æ—¶ï¼Œé£æœº1.5å°æ—¶
æ¨èä¹˜åé«˜é“ï¼Œèˆ’é€‚ä¾¿æ·ï¼Œæ²¿é€”é£æ™¯ä¹Ÿä¸é”™ï¼

ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼âœˆï¸
</code></pre>
<h3 data-id="heading-19">ğŸŒŸ æ¡ˆä¾‹2ï¼šå®¢æœåŠ©æ‰‹ï¼ˆæµå¼å“åº”ï¼‰</h3>
<p>å±•ç¤ºå¦‚ä½•å®ç°æµå¼è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_order</span>(<span class="hljs-params">order_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æŸ¥è¯¢è®¢å•ä¿¡æ¯"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"è®¢å• <span class="hljs-subst">{order_id}</span>ï¼šå·²å‘è´§ï¼Œé¢„è®¡æ˜å¤©åˆ°è¾¾"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_inventory</span>(<span class="hljs-params">product_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æ£€æŸ¥åº“å­˜"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"å•†å“ <span class="hljs-subst">{product_id}</span>ï¼šåº“å­˜å……è¶³ï¼Œå¯ç«‹å³å‘è´§"</span>

<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_refund</span>(<span class="hljs-params">order_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""å¤„ç†é€€æ¬¾"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"è®¢å• <span class="hljs-subst">{order_id}</span> é€€æ¬¾ç”³è¯·å·²æäº¤ï¼Œ3-5ä¸ªå·¥ä½œæ—¥åˆ°è´¦"</span>

customer_service_agent = create_agent(
    model=<span class="hljs-string">"deepseek-chat"</span>,
    tools=[search_order, check_inventory, process_refund],
    system_prompt=<span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªè€å¿ƒä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ã€‚"</span>
)

<span class="hljs-comment"># æµå¼è¾“å‡º</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ’¬ å®¢æœå¯¹è¯ï¼ˆæµå¼è¾“å‡ºï¼‰"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> customer_service_agent.stream(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"æˆ‘çš„è®¢å• 12345 ä»€ä¹ˆæ—¶å€™åˆ°ï¼Ÿ"</span>}]},
    stream_mode=<span class="hljs-string">"values"</span>
):
    latest = chunk[<span class="hljs-string">"messages"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> latest.content:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å®¢æœï¼š<span class="hljs-subst">{latest.content}</span>"</span>, end=<span class="hljs-string">"\n\n"</span>)
    <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(latest, <span class="hljs-string">'tool_calls'</span>) <span class="hljs-keyword">and</span> latest.tool_calls:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[æ­£åœ¨æŸ¥è¯¢è®¢å•ä¿¡æ¯...]"</span>, end=<span class="hljs-string">"\n"</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>