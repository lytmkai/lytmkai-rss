<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Redis（166）如何使用Redis实现实时统计？]]></title>    <link>https://juejin.cn/post/7580233527284498482</link>    <guid>https://juejin.cn/post/7580233527284498482</guid>    <pubDate>2025-12-06T00:13:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580233527284498482" data-draft-id="7580259796667416622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（166）如何使用Redis实现实时统计？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T00:13:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（166）如何使用Redis实现实时统计？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T00:13:46.000Z" title="Sat Dec 06 2025 00:13:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用Redis实现实时统计是一种非常高效的方法。Redis具有快速读写的特点，非常适合用于需要实时更新和查询的场景。以下是一些常见的实时统计场景以及如何使用Redis实现这些功能的详细示例。</p>
<h3 data-id="heading-0">1. 基本概念</h3>
<p>实时统计通常包括以下几个部分：</p>
<ol>
<li><strong>数据收集</strong>：实时收集和记录数据，如页面访问、点击、交易等。</li>
<li><strong>数据存储</strong>：将收集到的数据存储在Redis中。</li>
<li><strong>数据查询</strong>：实时查询统计结果。</li>
</ol>
<h3 data-id="heading-1">2. 使用Redis实现实时统计</h3>
<p>可以使用Redis的多种数据结构（如Strings、Hashes、Sets和Sorted Sets）来实现不同的统计场景。</p>
<h4 data-id="heading-2">2.1 实时计数</h4>
<p>使用Redis的<code>INCR</code>、<code>INCRBY</code>命令可以实现实时计数。</p>
<h5 data-id="heading-3">示例：网站页面访问计数</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPageViewCounter</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">pageKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"page:view:home"</span>;

        <span class="hljs-comment">// 增加页面访问计数</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">pageCount</span> <span class="hljs-operator">=</span> jedis.incr(pageKey);
        System.out.println(<span class="hljs-string">"Home page view count: "</span> + pageCount);

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-4">2.2 实时聚合统计</h4>
<p>使用Redis的Hashes可以实现更复杂的聚合统计。例如，可以统计不同页面的访问量。</p>
<h5 data-id="heading-5">示例：不同页面的访问计数</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisPageViewAggregator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">pageKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"page:views"</span>;

        <span class="hljs-comment">// 增加不同页面的访问计数</span>
        jedis.hincrBy(pageKey, <span class="hljs-string">"home"</span>, <span class="hljs-number">1</span>);
        jedis.hincrBy(pageKey, <span class="hljs-string">"about"</span>, <span class="hljs-number">1</span>);
        jedis.hincrBy(pageKey, <span class="hljs-string">"contact"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// 获取不同页面的访问计数</span>
        System.out.println(<span class="hljs-string">"Home page view count: "</span> + jedis.hget(pageKey, <span class="hljs-string">"home"</span>));
        System.out.println(<span class="hljs-string">"About page view count: "</span> + jedis.hget(pageKey, <span class="hljs-string">"about"</span>));
        System.out.println(<span class="hljs-string">"Contact page view count: "</span> + jedis.hget(pageKey, <span class="hljs-string">"contact"</span>));

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-6">2.3 实时唯一用户统计</h4>
<p>使用Redis的Sets可以实现去重统计，如统计独立用户的访问量。</p>
<h5 data-id="heading-7">示例：统计独立用户访问</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUniqueUserCounter</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">uniqueUsersKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"unique:users"</span>;

        <span class="hljs-comment">// 添加用户ID到集合中</span>
        jedis.sadd(uniqueUsersKey, <span class="hljs-string">"user1"</span>);
        jedis.sadd(uniqueUsersKey, <span class="hljs-string">"user2"</span>);
        jedis.sadd(uniqueUsersKey, <span class="hljs-string">"user3"</span>);

        <span class="hljs-comment">// 获取独立用户的数量</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">uniqueUserCount</span> <span class="hljs-operator">=</span> jedis.scard(uniqueUsersKey);
        System.out.println(<span class="hljs-string">"Unique user count: "</span> + uniqueUserCount);

        jedis.close();
    }
}
</code></pre>
<h4 data-id="heading-8">2.4 实时排名统计</h4>
<p>使用Redis的Sorted Sets可以实现实时排名统计，如统计商品的销售排名。</p>
<h5 data-id="heading-9">示例：商品销售排名</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.Tuple;

<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisSalesRanking</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">salesRankingKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sales:ranking"</span>;

        <span class="hljs-comment">// 增加商品的销售量</span>
        jedis.zincrby(salesRankingKey, <span class="hljs-number">10</span>, <span class="hljs-string">"product1"</span>);
        jedis.zincrby(salesRankingKey, <span class="hljs-number">20</span>, <span class="hljs-string">"product2"</span>);
        jedis.zincrby(salesRankingKey, <span class="hljs-number">15</span>, <span class="hljs-string">"product3"</span>);

        <span class="hljs-comment">// 获取前2名的商品及其销售量</span>
        Set&lt;Tuple&gt; topProducts = jedis.zrevrangeWithScores(salesRankingKey, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">for</span> (Tuple product : topProducts) {
            System.out.println(<span class="hljs-string">"Product: "</span> + product.getElement() + <span class="hljs-string">", Sales: "</span> + product.getScore());
        }

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-10">3. 综合示例：实时统计系统</h3>
<p>将上述各部分结合起来，实现一个实时统计系统。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.Tuple;

<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisRealTimeStatistics</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);

        <span class="hljs-comment">// Step 1: 实时计数 - 页面访问计数</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">pageKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"page:view:home"</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">pageCount</span> <span class="hljs-operator">=</span> jedis.incr(pageKey);
        System.out.println(<span class="hljs-string">"Home page view count: "</span> + pageCount);

        <span class="hljs-comment">// Step 2: 实时聚合统计 - 不同页面的访问计数</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">aggregatedPageKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"page:views"</span>;
        jedis.hincrBy(aggregatedPageKey, <span class="hljs-string">"home"</span>, <span class="hljs-number">1</span>);
        jedis.hincrBy(aggregatedPageKey, <span class="hljs-string">"about"</span>, <span class="hljs-number">1</span>);
        jedis.hincrBy(aggregatedPageKey, <span class="hljs-string">"contact"</span>, <span class="hljs-number">1</span>);
        System.out.println(<span class="hljs-string">"Home page view count: "</span> + jedis.hget(aggregatedPageKey, <span class="hljs-string">"home"</span>));
        System.out.println(<span class="hljs-string">"About page view count: "</span> + jedis.hget(aggregatedPageKey, <span class="hljs-string">"about"</span>));
        System.out.println(<span class="hljs-string">"Contact page view count: "</span> + jedis.hget(aggregatedPageKey, <span class="hljs-string">"contact"</span>));

        <span class="hljs-comment">// Step 3: 实时唯一用户统计 - 独立用户访问</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">uniqueUsersKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"unique:users"</span>;
        jedis.sadd(uniqueUsersKey, <span class="hljs-string">"user1"</span>);
        jedis.sadd(uniqueUsersKey, <span class="hljs-string">"user2"</span>);
        jedis.sadd(uniqueUsersKey, <span class="hljs-string">"user3"</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">uniqueUserCount</span> <span class="hljs-operator">=</span> jedis.scard(uniqueUsersKey);
        System.out.println(<span class="hljs-string">"Unique user count: "</span> + uniqueUserCount);

        <span class="hljs-comment">// Step 4: 实时排名统计 - 商品销售排名</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">salesRankingKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sales:ranking"</span>;
        jedis.zincrby(salesRankingKey, <span class="hljs-number">10</span>, <span class="hljs-string">"product1"</span>);
        jedis.zincrby(salesRankingKey, <span class="hljs-number">20</span>, <span class="hljs-string">"product2"</span>);
        jedis.zincrby(salesRankingKey, <span class="hljs-number">15</span>, <span class="hljs-string">"product3"</span>);
        Set&lt;Tuple&gt; topProducts = jedis.zrevrangeWithScores(salesRankingKey, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
        <span class="hljs-keyword">for</span> (Tuple product : topProducts) {
            System.out.println(<span class="hljs-string">"Product: "</span> + product.getElement() + <span class="hljs-string">", Sales: "</span> + product.getScore());
        }

        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>通过上面的示例，我们展示了如何使用Redis的不同数据结构来实现实时统计。从简单的计数、聚合统计到唯一用户统计和实时排名，Redis都提供了高效的解决方案。根据实际需求，可以进一步扩展和优化这些功能，例如使用更复杂的数据处理逻辑、实时更新机制和多节点分布式处理等。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（167）如何使用Redis实现分布式缓存？]]></title>    <link>https://juejin.cn/post/7580198093154730030</link>    <guid>https://juejin.cn/post/7580198093154730030</guid>    <pubDate>2025-12-06T00:14:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580198093154730030" data-draft-id="7580198093154713646" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（167）如何使用Redis实现分布式缓存？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-06T00:14:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（167）如何使用Redis实现分布式缓存？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T00:14:41.000Z" title="Sat Dec 06 2025 00:14:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用Redis实现分布式缓存是一种常见且有效的提高系统性能和可扩展性的方法。Redis作为一个高性能的内存数据库，支持丰富的数据类型和操作，可以很好地满足分布式缓存的需求。</p>
<h3 data-id="heading-0">1. 分布式缓存的基本概念</h3>
<p>分布式缓存是一种在多个服务器之间共享缓存数据的方法，用于提高系统性能、减少数据库负载和提高数据访问速度。主要包括以下几个部分：</p>
<ol>
<li><strong>数据存储</strong>：将数据缓存到Redis中。</li>
<li><strong>数据读取</strong>：从Redis中读取缓存数据。</li>
<li><strong>数据过期和失效</strong>：设置缓存数据的过期时间，自动清理无效数据。</li>
<li><strong>缓存更新</strong>：当数据发生变化时，更新缓存中的数据。</li>
</ol>
<h3 data-id="heading-1">2. 使用Redis实现分布式缓存</h3>
<h4 data-id="heading-2">2.1 引入依赖</h4>
<p>在Java项目中使用Jedis库与Redis进行交互。在Maven项目中添加Jedis依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">2.2 缓存数据的存储和读取</h4>
<h5 data-id="heading-4">示例：缓存用户信息</h5>
<p>首先，我们需要定义一个简单的用户类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-comment">// Constructors, getters, and setters</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String id, String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.id = id;
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"User{"</span> +
                <span class="hljs-string">"id='"</span> + id + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", name='"</span> + name + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", age="</span> + age +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p>然后，我们将用户信息缓存到Redis中，并实现获取用户信息的方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCache</span> {

    <span class="hljs-keyword">private</span> Jedis jedis;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 连接到本地的Redis服务</span>
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + user.getId();
        jedis.hset(userKey, <span class="hljs-string">"id"</span>, user.getId());
        jedis.hset(userKey, <span class="hljs-string">"name"</span>, user.getName());
        jedis.hset(userKey, <span class="hljs-string">"age"</span>, String.valueOf(user.getAge()));
        <span class="hljs-comment">// 设置缓存过期时间为1小时</span>
        jedis.expire(userKey, <span class="hljs-number">3600</span>);
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(String userId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + userId;
        <span class="hljs-keyword">if</span> (jedis.exists(userKey)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> jedis.hget(userKey, <span class="hljs-string">"id"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> jedis.hget(userKey, <span class="hljs-string">"name"</span>);
            <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> Integer.parseInt(jedis.hget(userKey, <span class="hljs-string">"age"</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, name, age);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RedisCache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisCache</span>();

        <span class="hljs-comment">// 缓存用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>);
        cache.cacheUser(user);
        System.out.println(<span class="hljs-string">"User cached: "</span> + user);

        <span class="hljs-comment">// 读取用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">cachedUser</span> <span class="hljs-operator">=</span> cache.getUser(<span class="hljs-string">"1"</span>);
        System.out.println(<span class="hljs-string">"Cached user: "</span> + cachedUser);

        cache.close();
    }
}
</code></pre>
<h4 data-id="heading-5">2.3 缓存过期和失效</h4>
<p>Redis提供了多种缓存失效策略，如定时过期、主动删除和被动删除。在上面的示例中，我们使用了<code>expire</code>命令设置了缓存的过期时间。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheUser</span><span class="hljs-params">(User user)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + user.getId();
    jedis.hset(userKey, <span class="hljs-string">"id"</span>, user.getId());
    jedis.hset(userKey, <span class="hljs-string">"name"</span>, user.getName());
    jedis.hset(userKey, <span class="hljs-string">"age"</span>, String.valueOf(user.getAge()));
    <span class="hljs-comment">// 设置缓存过期时间为1小时</span>
    jedis.expire(userKey, <span class="hljs-number">3600</span>);
}
</code></pre>
<h4 data-id="heading-6">2.4 缓存更新</h4>
<p>当基础数据发生变化时，需要及时更新缓存中的数据，否则会导致缓存中的数据不一致。通常有两种方法来更新缓存：</p>
<ol>
<li><strong>直接更新缓存</strong>：当数据发生变化时，直接更新缓存中的数据。</li>
<li><strong>缓存失效</strong>：当数据发生变化时，删除缓存中的数据，下次读取时重新缓存。</li>
</ol>
<h5 data-id="heading-7">示例：缓存更新</h5>
<p>假设我们需要更新用户的信息，可以使用以下方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
    cacheUser(user); <span class="hljs-comment">// 直接更新缓存</span>
    <span class="hljs-comment">// 或者删除缓存，下次读取时重新缓存</span>
    <span class="hljs-comment">// String userKey = "user:" + user.getId();</span>
    <span class="hljs-comment">// jedis.del(userKey);</span>
}
</code></pre>
<h3 data-id="heading-8">3. 分布式缓存的集群配置</h3>
<p>为了提高可用性和扩展性，可以使用Redis集群。Redis集群将数据分片存储在多个节点上，并提供了高可用性。</p>
<h4 data-id="heading-9">3.1 配置Redis集群</h4>
<p>可以使用Redis官方提供的工具配置Redis集群，具体步骤可以参考官方文档。这里只展示如何使用Jedis连接Redis集群。</p>
<h5 data-id="heading-10">示例：连接Redis集群</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.HostAndPort;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisCluster;

<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisClusterCache</span> {

    <span class="hljs-keyword">private</span> JedisCluster jedisCluster;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisClusterCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 配置Redis集群节点</span>
        Set&lt;HostAndPort&gt; nodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        nodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">7000</span>));
        nodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">7001</span>));
        nodes.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostAndPort</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">7002</span>));
        <span class="hljs-built_in">this</span>.jedisCluster = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisCluster</span>(nodes);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cacheUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + user.getId();
        jedisCluster.hset(userKey, <span class="hljs-string">"id"</span>, user.getId());
        jedisCluster.hset(userKey, <span class="hljs-string">"name"</span>, user.getName());
        jedisCluster.hset(userKey, <span class="hljs-string">"age"</span>, String.valueOf(user.getAge()));
        <span class="hljs-comment">// 设置缓存过期时间为1小时</span>
        jedisCluster.expire(userKey, <span class="hljs-number">3600</span>);
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(String userId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"user:"</span> + userId;
        <span class="hljs-keyword">if</span> (jedisCluster.exists(userKey)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> jedisCluster.hget(userKey, <span class="hljs-string">"id"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> jedisCluster.hget(userKey, <span class="hljs-string">"name"</span>);
            <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> Integer.parseInt(jedisCluster.hget(userKey, <span class="hljs-string">"age"</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, name, age);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            jedisCluster.close();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RedisClusterCache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisClusterCache</span>();

        <span class="hljs-comment">// 缓存用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>);
        cache.cacheUser(user);
        System.out.println(<span class="hljs-string">"User cached: "</span> + user);

        <span class="hljs-comment">// 读取用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">cachedUser</span> <span class="hljs-operator">=</span> cache.getUser(<span class="hljs-string">"1"</span>);
        System.out.println(<span class="hljs-string">"Cached user: "</span> + cachedUser);

        cache.close();
    }
}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>通过上面的示例，我们展示了如何使用Redis实现分布式缓存，包括数据的存储和读取、缓存的过期和失效、缓存的更新以及如何使用Redis集群来提高可用性和扩展性。根据实际需求，可以进一步扩展和优化这些功能，例如使用更复杂的数据处理逻辑、实现多级缓存机制等。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis性能提升40%！我用这5个冷门但高效的配置优化了千万级QPS应用]]></title>    <link>https://juejin.cn/post/7580210602078371874</link>    <guid>https://juejin.cn/post/7580210602078371874</guid>    <pubDate>2025-12-06T00:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580210602078371874" data-draft-id="7580210602078355490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis性能提升40%！我用这5个冷门但高效的配置优化了千万级QPS应用"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-06T00:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis性能提升40%！我用这5个冷门但高效的配置优化了千万级QPS应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-06T00:16:51.000Z" title="Sat Dec 06 2025 00:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis性能提升40%！我用这5个冷门但高效的配置优化了千万级QPS应用</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在当今的高并发场景下，Redis作为高性能的内存数据库，已成为众多互联网企业的核心技术栈之一。然而，随着业务规模的增长，即使是Redis这样的"性能怪兽"也可能遇到瓶颈。最近，我在优化一个日均千万级QPS的Redis集群时，通过调整5个鲜为人知但极其高效的配置项，成功将整体性能提升了40%。本文将深入分享这些实战经验，揭示那些被大多数开发者忽略的Redis性能优化技巧。</p>
<h2 data-id="heading-2">一、背景与挑战</h2>
<p>我们的业务系统是一个典型的社交应用场景，核心功能包括：</p>
<ul>
<li>用户关系图谱（关注/粉丝列表）</li>
<li>实时消息推送</li>
<li>热点内容缓存</li>
<li>分布式锁服务</li>
</ul>
<p>原有Redis集群配置：</p>
<ul>
<li>版本：6.2.6</li>
<li>节点：16个分片（8主8从）</li>
<li>内存：每个节点32GB</li>
<li>QPS峰值：约120万/秒</li>
</ul>
<p>面临的性能问题：</p>
<ol>
<li>CPU利用率长期处于80%以上</li>
<li>P99延迟在高峰时段超过50ms</li>
<li>频繁出现命令排队现象</li>
</ol>
<h2 data-id="heading-3">二、关键优化策略</h2>
<h3 data-id="heading-4">1. 精细化内存分配策略：<code>jemalloc-bg-thread</code></h3>
<p><strong>默认配置的问题</strong>：
Redis默认使用jemalloc进行内存管理，但在高分配/释放频率下，内存回收可能成为瓶颈。</p>
<p><strong>优化方案</strong>：</p>
<pre><code class="hljs language-conf" lang="conf"># 启用后台线程进行内存回收
jemalloc-bg-thread yes
# 设置arena数量（通常为核心数的2倍）
MALLOC_CONF="narenas:32,background_thread:true"
</code></pre>
<p><strong>原理分析</strong>：</p>
<ul>
<li>jemalloc通过划分多个arena来减少锁竞争</li>
<li>后台线程异步处理内存碎片整理</li>
<li>arena数量应与CPU核心数匹配</li>
</ul>
<p><strong>效果对比</strong>：</p>




















<table><thead><tr><th>指标</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td>malloc延迟</td><td>850ns</td><td>320ns</td></tr><tr><td>GC停顿时间</td><td>15ms</td><td>&lt;1ms</td></tr></tbody></table>
<h3 data-id="heading-5">2. NUMA架构优化：<code>replica-serve-stale-data no</code></h3>
<p><strong>NUMA陷阱</strong>：
在多插槽服务器上，跨NUMA节点的内存访问会导致显著的延迟增加。</p>
<p><strong>关键配置</strong>：</p>
<pre><code class="hljs language-conf" lang="conf"># 禁用从节点提供过期数据
replica-serve-stale-data no
# NUMA绑定优化
numactl --cpunodebind=0 --membind=0 redis-server /etc/redis.conf
</code></pre>
<p><strong>实践建议</strong>：</p>
<ol>
<li><code>taskset</code>和<code>numactl</code>结合使用</li>
<li>Redis进程与网卡中断绑定相同NUMA节点</li>
<li>HugePage也需考虑NUMA亲和性</li>
</ol>
<h3 data-id="heading-6">3. TCP协议栈调优：<code>tcp-backlog</code></h3>
<p><strong>网络瓶颈分析</strong>：
在突发流量下，Linux默认的SYN队列可能成为瓶颈。</p>
<pre><code class="hljs language-conf" lang="conf"># Redis配置调整
tcp-backlog 65535

# sysctl系统参数调整
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 65535
</code></pre>
<p><strong>内核参数关联表</strong>：</p>





















<table><thead><tr><th>参数</th><th>Recommended Value</th></tr></thead><tbody><tr><td>net.ipv4.tcp_tw_reuse</td><td>1</td></tr><tr><td>net.ipv4.tcp_fin_timeout</td><td>15</td></tr><tr><td>net.core.netdev_max_backlog</td><td>16384</td></tr></tbody></table>
<h3 data-id="heading-7">4. AOF持久化黑科技：<code>aof-rewrite-incremental-fsync</code></h3>
<p><strong>磁盘IO瓶颈突破</strong>：</p>
<pre><code class="hljs language-conf" lang="conf">aof-rewrite-incremental-fsync yes
aof-load-truncated yes

# Linux文件系统优化（EXT4示例）：
mount -o noatime,data=writeback,barrier=0,nobh /dev/sdb /data/redis/
</code></pre>
<p><strong>效果验证工具</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># AOF重写期间的IO观测工具组合</span>
iotop -oP 
blktrace -d /dev/nvme0n1 -o - | blkparse -i -
</code></pre>
<h3 data-id="heading-8">5. LUA脚本加速器：<code>lua-replicate-commands</code></h3>
<p><strong>LUA性能陷阱解决方案</strong>：</p>
<pre><code class="hljs language-conf" lang="conf">lua-time-limit 5000 # ms单位的安全阈值控制

# Lua脚本改造示例（原始脚本）:
local val = redis.call('GET', KEYS[1])
return val

# （优化后）:
redis.replicate_commands()
local val = redis.call('GET', KEYS[1])
return val
</code></pre>
<h2 data-id="heading-9"/>
<h2 data-id="heading-10"/>
<h2 data-id="heading-11"/>
<h2 data-id="heading-12"/>
<h2 data-id="heading-13"/>
<h2 data-id="heading-14"/>
<h2 data-id="heading-15"/>
<h2 data-id="heading-16"/>
<h2 data-id="heading-17"/>
<h2 data-id="heading-18"/>
<h2 data-id="heading-19"/>
<h2 data-id="heading-20"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别数字麻木，重拾消费感知：ezBookkeeping —— 您的轻量自托管记账伴侣]]></title>    <link>https://juejin.cn/post/7580183671532191782</link>    <guid>https://juejin.cn/post/7580183671532191782</guid>    <pubDate>2025-12-05T23:26:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580183671532191782" data-draft-id="7580183671532175398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别数字麻木，重拾消费感知：ezBookkeeping —— 您的轻量自托管记账伴侣"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2025-12-05T23:26:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别数字麻木，重拾消费感知：ezBookkeeping —— 您的轻量自托管记账伴侣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T23:26:25.000Z" title="Fri Dec 05 2025 23:26:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在数字时代，消费与支付因网购而变得无比便捷，金钱也随之渐渐抽象为屏幕上冰冷的数字，失去了曾经真实可握的温度。过去用现金交易时，每一张纸币的递出都伴随着复杂的心绪——或许是计划，是犹豫，抑或是不舍。那种实实在在的“付出感”，无形中让人更懂衡量、更知节制。</p>
<p>如今，手机一扫、一键即付，消费变得轻而易举，人与金钱之间的情感联结却日益稀薄。支付动作的简化，也在不知不觉间削弱了我们对支出的敏感。就像从前用现金吃饭，人们会下意识地根据钱包里的余额约束开销；而数字支付让人难以感知“失去”，更容易在无声无息中越过原本的界限。</p>
<p>于是我不禁思考：既然我们享受着快捷支付的便利，是否也能找到一种方式，让消费重新变得可感知？我曾尝试手动记账，但不仅难以统计，账本也容易丢失；又试过一些记账软件，可它们往往太过“便捷”，依然无法帮我找回那份对消费的真实感知。直到最近在 GitHub 上发现了一个开源项目——它恰好满足了我所有这些期待。今天，就想把它介绍给大家。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/417dd50152a64607875b0387359af2c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=U8M%2Fsn%2F43R3H%2FZ07XM83zZy8xOs%3D" alt="ezbookkeeping-192.png" loading="lazy"/></p>
<p>ezbookkeeping-192.png</p>
<h2 data-id="heading-0">什么是ezBookkeeping？</h2>
<p>ezBookkeeping 是一款轻量、自托管 (self-hosted) 的个人记账应用，拥有用户友好的界面和强大的记账功能。它部署简单，借助 Docker 只需一行命令即可启动。同时对系统资源占用低、可扩展性高，既可运行在树莓派等轻量设备上，也能扩展到 NAS、MicroServer 甚至集群环境。</p>
<p>ezBookkeeping 为移动端和桌面端提供了各自原生的界面设计。借助 PWA (渐进式网页应用) 技术，您还可以将它 添加到手机主屏幕，像原生 App 一样使用。</p>
<p>github 地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmayswind%2Fezbookkeeping" target="_blank" title="https://github.com/mayswind/ezbookkeeping" ref="nofollow noopener noreferrer">github.com/mayswind/ez…</a></p>
<p>文档地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fezbookkeeping.mayswind.net%2Fzh_Hans" target="_blank" title="https://ezbookkeeping.mayswind.net/zh_Hans" ref="nofollow noopener noreferrer">ezbookkeeping.mayswind.net/zh_Hans</a></p>
<p>在线演示：<a href="https://link.juejin.cn?target=https%3A%2F%2Fezbookkeeping-demo.mayswind.net" target="_blank" title="https://ezbookkeeping-demo.mayswind.net" ref="nofollow noopener noreferrer">ezbookkeeping-demo.mayswind.net</a></p>
<p>该项目在github已有3.2k star</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02780ab2ec324e3db6e930cc8ae0002b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=22JytToBQBmE0RgxwS%2FuXOpm6q0%3D" alt="_20251206_054722.png" loading="lazy"/></p>
<p>_20251206_054722.png</p>
<h2 data-id="heading-1">Docker私有化部署</h2>
<p>我使用的是docker-compose 进行私有化部署的，步骤如下：</p>
<ul>
<li>创建docker-compose.yml 文件</li>
</ul>
<p>在我们的服务器上创建部署目录<code>ezbookkeeping</code>,在此目录下创建 docker-compose.yml 文件，内容如下：</p>
<pre><code class="hljs language-bash" lang="bash">services:
  ezbookkeeping:
    image: mayswind/ezbookkeeping:latest
    container_name: ezbookkeeping
    hostname: <span class="hljs-string">"ezbookkeeping"</span>
    ports:
      - <span class="hljs-string">"7080:8080"</span>
    <span class="hljs-comment"># 默认数据库类型是 sqlite3,若使用默认数据库，注释掉以下环境变量</span>
    environment:
      - <span class="hljs-string">"EBK_SERVER_ENABLE_GZIP=true"</span>
      - <span class="hljs-string">"EBK_DATABASE_TYPE=mysql"</span>
      - <span class="hljs-string">"EBK_DATABASE_HOST=192.168.31.195:3306"</span>
      - <span class="hljs-string">"EBK_DATABASE_NAME=ezbookkeeping"</span>
      - <span class="hljs-string">"EBK_DATABASE_USER=root"</span>
      - <span class="hljs-string">"EBK_DATABASE_PASSWD=xj123456"</span>
      - <span class="hljs-string">"EBK_LOG_MODE=file"</span>
      - <span class="hljs-string">"EBK_SECURITY_SECRET_KEY=its_should_be_a_random_string"</span>
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./storage:/ezbookkeeping/storage <span class="hljs-comment"># 请确保 UID:GID 是 1000:1000</span>
      - ./log:/ezbookkeeping/log <span class="hljs-comment"># 请确保 UID:GID 是 1000:1000</span>
        <span class="hljs-comment">#      - ./ezbookkeeping.ini:/ezbookkeeping/conf/ezbookkeeping.ini</span>
        <span class="hljs-comment">#      - ./data:/ezbookkeeping/data # 默认使用sqlite3数据库挂载目录</span>
</code></pre>
<p>ezbookkeeping 默认数据库类型是 sqlite3,数据库文件存储在容器中的 /ezbookkeeping/data/ezbookkeeping.db，若使用默认数据库，并持久化保存这些数据，你需要使用 Docker 持久化数据卷或挂载宿主机的路径到容器内。</p>
<p>若想使用mysql或PostgreSQL,则需现在对应的数据库中创建好数据库，在环境变量中配置好相应的环境变量即可，我此处使用的是mysql数据库。</p>
<ul>
<li>启动服务</li>
</ul>
<p>在docker-compose.yml的同级目录下使用以下命令启动服务</p>
<pre><code class="hljs">docker-compose up -d 
</code></pre>
<p>启动之后汇报权限错误的日志,需要给挂载目录修改权限</p>
<p>给挂载目录授权</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">chmod</span> -R 777 storage <span class="hljs-built_in">log</span>
</code></pre>
<p>重启服务</p>
<pre><code class="hljs">docker-compose restart
</code></pre>
<p>到此，我们服务就部署好了</p>
<h2 data-id="heading-2">使用</h2>
<ul>
<li>注册</li>
</ul>
<p>在浏览器中打开服务地址，首次的话我们先需要注册用户</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb7b3c963fa547529efc273fb4efb951~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=te5f9tosmHS9KRksOsUHNAKChos%3D" alt="_20251206_063538.png" loading="lazy"/></p>
<p>_20251206_063538.png</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abe25e0f458e403b89ef337c14fd9de1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=7%2FlWtKU%2B6dxC6M4PKVbY2PtBKHY%3D" alt="_20251206_063650.png" loading="lazy"/></p>
<p>_20251206_063650.png</p>
<p>注册的时候我们可以预设分类 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/577d769545cb4e36842d6b0ae9636888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=vSQ%2BSFrM4ldG0LPyJbmzYfNu07A%3D" alt="_20251206_063732.png" loading="lazy"/></p>
<ul>
<li>创建账户、分类</li>
</ul>
<p>我们需要先创建好账户，根据自己记录的维度创建好消费及收入分类</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff364bf09a247eea8fbfff1d2923768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=8rfuZpZ5%2BL72rfTyQwGwseqogjw%3D" alt="_20251206_064953.png" loading="lazy"/></p>
<p>_20251206_064953.png</p>
<ul>
<li>添加交易、常看统计</li>
</ul>
<p>然后我们可以记录我们的每一笔消费、收入了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a52f27e9bb54b84b4b5d4b5690a1ac3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=lbf18TN1crFrmch%2FRutQ7Xnn1A8%3D" alt="_20251206_065454.png" loading="lazy"/></p>
<p>_20251206_065454.png</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3eec57fd68240f2812432b385202add~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=wHFHwfirm7c%2BJAdLBDMmggYcIVM%3D" alt="_20251206_065547.png" loading="lazy"/></p>
<p>_20251206_065547.png</p>
<ul>
<li>移动端使用</li>
</ul>
<p>在手机浏览器中打开网址<a href="https://link.juejin.cn?target=http%3A%2F%2Fip%3Aport%2F" target="_blank" title="http://ip:port/" ref="nofollow noopener noreferrer">http://ip:port/</a> 或者扫码，使用用户名登录之后就可以在手机端使用了，如果不想每次进浏览器，可以在浏览器中将页面发送到手机桌面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f180581636648c69d106d2e6ec9803a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765581984&amp;x-signature=JDvUu34m985VyO3n4IPPIRt%2BWjk%3D" alt="_20251206_070326.png" loading="lazy"/></p>
<p>_20251206_070326.png</p>
<h2 data-id="heading-3">结语</h2>
<p>在众多个人财务应用中，ezBookkeeping以其开源特性、隐私保护、轻量高效和易部署的优势脱颖而出。无论你是技术爱好者想在树莓派上搭建服务，还是普通用户想在NAS上自建财务系统，ezBookkeeping都是一个值得尝试的优秀选择。</p>
<p>它的设计哲学很明确：给用户完全的控制权，同时提供专业级的记账体验。在这个数据隐私日益重要的时代，这样的应用显得尤为珍贵。</p>
<p>如果你正在寻找一个可靠、私密、功能全面的记账解决方案，不妨试试ezBookkeeping。只需几分钟的部署时间，你就能拥有一个完全属于自己的专业财务管理系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub Star 数量前 5 的开源 AI 内部工具]]></title>    <link>https://juejin.cn/post/7580198093154598958</link>    <guid>https://juejin.cn/post/7580198093154598958</guid>    <pubDate>2025-12-05T15:23:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580198093154598958" data-draft-id="7580233527284301874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub Star 数量前 5 的开源 AI 内部工具"/> <meta itemprop="keywords" content="开源,低代码,资讯"/> <meta itemprop="datePublished" content="2025-12-05T15:23:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NocoBase"/> <meta itemprop="url" content="https://juejin.cn/user/180779873743566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub Star 数量前 5 的开源 AI 内部工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180779873743566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NocoBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T15:23:02.000Z" title="Fri Dec 05 2025 15:23:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-5-open-source-ai-internal-tools-on-github" target="_blank" title="https://www.nocobase.com/cn/blog/top-5-open-source-ai-internal-tools-on-github" ref="nofollow noopener noreferrer">www.nocobase.com/cn/blog/top…</a></p>
<p>之前我们整理过很多开源 AI 项目相关的内容，包括 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-11-github-open-source-no-code-ai-tools" target="_blank" title="https://www.nocobase.com/cn/blog/top-11-github-open-source-no-code-ai-tools" ref="nofollow noopener noreferrer">GitHub 上 11 款开源的 AI 无代码平台</a>、以及 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F14-ai-low-code-platforms-github" target="_blank" title="https://www.nocobase.com/cn/blog/14-ai-low-code-platforms-github" ref="nofollow noopener noreferrer">AI 低代码工具的盘点文章</a>。AI 技术的快速演进，我们看到越来越多的开源项目开始主动拥抱 AI。</p>
<p>同样的趋势，也正在发生在内部工具（Internal Tools）领域。去年我们盘点过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fopen-source-internal-tools" target="_blank" title="https://www.nocobase.com/cn/blog/open-source-internal-tools" ref="nofollow noopener noreferrer">一批优秀的开源内部工具</a>，但进入 2025 年后，这些工具几乎都陆续加入了 AI 能力，整体都已经焕然一新。因此，我们决定重新做一次系统性的更新。</p>
<p>😄<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-5-open-source-projects-for-building-internal-tools-in-2024%23%25E5%2586%2585%25E9%2583%25A8%25E5%25B7%25A5%25E5%2585%25B7%25E6%259C%2589%25E4%25BB%2580%25E4%25B9%2588%25E5%25A5%25BD%25E5%25A4%2584" target="_blank" title="https://www.nocobase.com/cn/blog/top-5-open-source-projects-for-building-internal-tools-in-2024#%E5%86%85%E9%83%A8%E5%B7%A5%E5%85%B7%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84" ref="nofollow noopener noreferrer">如果您对内部工具的概念及其带来的价值还不太了解，可以先点击这里查看相关介绍。</a></p>
<p>这次，我们从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftopics%2Finternal-tools" target="_blank" title="https://github.com/topics/internal-tools" ref="nofollow noopener noreferrer">GitHub Internal Tools</a> 话题里重新筛选了 Star 数排名靠前且 GitHub Star 数均超过 20k 的开源内部工具项目，介绍他们的技术信息以及适用场景.</p>
<p>希望这份更新能帮助你快速了解哪些开源内部工具在 AI 时代依然值得投入，也为正在自建内部工具的技术团队提供清晰的参考方向。</p>
<p>你可以先快速浏览一下本文会介绍的 5 款开源内部工具：</p>
<ul>
<li><strong>NocoBase</strong>：数据模型驱动的无代码开发平台，非常适合用于搭建内部工具，插件架构高度可扩展，AI 员工可介入数据整理、建模、图表生成、代码生成等场景。</li>
<li><strong>Budibase</strong>：低代码内部工具平台，提供数据库、拖拽构建、自动生成 CRUD、AI Column、AI 表结构等能力。</li>
<li><strong>Refine</strong>：基于 React 的元框架，适合构建 CRUD 密集型后台系统，并支持通过 AI 自动生成应用结构与代码。</li>
<li><strong>ToolJet</strong>：低代码与 AI-native 融合的平台，支持用自然语言生成内部工具的界面与逻辑。</li>
<li><strong>Appsmith</strong>：成熟的开源低代码平台，可连接多数据源，适合构建管理后台、仪表盘、审批系统，并已加入多种 AI 操作能力。</li>
</ul>
<h3 data-id="heading-0">NO.5 nocobase</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d776b00ea04af297ddae72933fb6f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=aFTqAXSyL76PZSe87FSF4tqMhk0%3D" alt="nocobase.png" loading="lazy"/></p>













































<table><thead><tr><th>GitHub 地址</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnocobase%2Fnocobase" target="_blank" title="https://github.com/nocobase/nocobase" ref="nofollow noopener noreferrer">github.com/nocobase/no…</a></th></tr></thead><tbody><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2F" target="_blank" title="https://www.nocobase.com/cn/" ref="nofollow noopener noreferrer">www.nocobase.com/cn/</a></td></tr><tr><td>开源协议</td><td>AGPL-3.0</td></tr><tr><td>GitHub Star 数</td><td>20.5k</td></tr><tr><td>GitHub Fork 数</td><td>2.3k</td></tr><tr><td>GitHub Issue 数</td><td>129</td></tr><tr><td>GitHub Pull Request 数</td><td>125</td></tr><tr><td>GitHub Contributor 数</td><td>101</td></tr><tr><td>GitHub 最近一次更新时间</td><td>当天</td></tr><tr><td>相关文档链接</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv2.docs.nocobase.com%2Fcn%2Fai-employees" target="_blank" title="https://v2.docs.nocobase.com/cn/ai-employees" ref="nofollow noopener noreferrer">v2.docs.nocobase.com/cn/ai-emplo…</a></td></tr></tbody></table>
<p><strong>工具介绍</strong></p>
<p>NocoBase 是一个数据模型驱动的无代码开发平台，非常适合用于搭建内部工具，通过插件架构支持高度扩展，可用于创建管理后台、业务系统、CRM、审批流等各种企业内部应用。系统提供所见即所得的界面构建能力，并支持复杂的数据关系、权限体系与自定义逻辑，适合需要快速构建业务工具的团队。</p>
<p>在 NocoBase 中，AI 并不是独立模块，而是与表格、表单、数据模型和工作流深度结合的智能能力。NocoBase 的 AI 员工模块将 AI 能力直接融入业务系统，可以与数据模型、表单、表格和工作流协同工作。官方内置多种 AI 员工类型，包括数据整理、数据建模、知识库搜索、图表生成和代码生成等功能，可以帮助用户以更低的成本完成数据处理、界面配置和逻辑构建。</p>
<p><strong>适用场景</strong></p>
<p><strong>数据整理场景（Dex 数据整理专家）</strong></p>
<p>在录入客户信息、工单内容、合同条款等场景中，AI 员工可以从非结构化的数据或文件中提取所需的信息整理成结构化的信息，并且可以调用工具将信息填写到表单中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a252494cecb42228b491de291da5762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=pgsSdxQFRWzY3xxYpjcyFbgIp%2B8%3D" alt="Dex.gif" loading="lazy"/></p>
<p><strong>数据分析场景（Viz 洞察分析师）</strong></p>
<p>在 Leads、Opportunities、Accounts 等业务数据页面中，AI 员工可以读取你当前页面的数据，自动生成趋势图、对比图、KPI 卡和简明结论，让业务分析变得轻松、直观。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/198df152e2394944988ffb36dac0ce36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=AGjCcNcvRcpd8jEh0uCXoDue7EU%3D" alt="Viz.gif" loading="lazy"/></p>
<p><strong>前端交互配置场景（Nathan 前端工程师）</strong></p>
<p>在需要编写 JSBlock、JSField、JSItem、JSColumn、JSAction、事件流（Event Flow）等需要写 JavaScript 的场景下，AI 员工可以读取当前代码编辑器中的上下文，根据自然语言需求自动生成或优化前端代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5758fd23bc074d178cbedc76b08c1ce0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=GyJyq%2FlgwNMOubKAOpfQ6LkjqU0%3D" alt="Nathan.png" loading="lazy"/></p>
<p><strong>数据建模场景（Orin 数据建模师）</strong></p>
<p>在搭建内部系统（CRM、工单、库存、项目管理等）的数据模型时，AI 员工能够帮助你创建或修改数据表。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cb964ccf67d488d8b09a0784fcb1314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=9ydsuJ3JE3CLyJdbszQsHoPd0qg%3D" alt="Orin.png" loading="lazy"/></p>
<h3 data-id="heading-1">NO.4 budibase</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e162f87606344c8b9de5b05117e89c2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=5HXN1thccXww9tl1qh4fqZAg%2BVc%3D" alt="budibase.png" loading="lazy"/></p>













































<table><thead><tr><th>GitHub 地址</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FBudibase%2Fbudibase" target="_blank" title="https://github.com/Budibase/budibase" ref="nofollow noopener noreferrer">github.com/Budibase/bu…</a></th></tr></thead><tbody><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fbudibase.com%2F" target="_blank" title="https://budibase.com/" ref="nofollow noopener noreferrer">budibase.com/</a></td></tr><tr><td>开源协议</td><td>GPL-v3</td></tr><tr><td>GitHub Star 数</td><td>27.4k</td></tr><tr><td>GitHub Fork 数</td><td>2k</td></tr><tr><td>GitHub Issue 数</td><td>294</td></tr><tr><td>GitHub Pull Request 数</td><td>12</td></tr><tr><td>GitHub Contributor 数</td><td>112</td></tr><tr><td>GitHub 最近一次更新时间</td><td>当天</td></tr><tr><td>相关文档链接</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.budibase.com%2Fdocs%2Fquickstart-budibase-ai" target="_blank" title="https://docs.budibase.com/docs/quickstart-budibase-ai" ref="nofollow noopener noreferrer">docs.budibase.com/docs/quicks…</a></td></tr></tbody></table>
<p><strong>工具介绍</strong></p>
<p>Budibase 是一个开源低代码内部工具平台，它提供数据库连接、多种数据源支持、拖拽 UI 构建、自动生成 CRUD 界面与工作流功能，适合快速搭建企业后台、审批系统、表单／管理面板等业务系统。其内置数据库 + REST API 连接能力 + 可视化界面构建，使得即便没有深度前端经验，也能构建功能完备的内部应用。</p>
<p>Budibase 已将 AI 能力整合为其平台内置功能之一。通过启用 Budibase AI，用户可以为表格添加 AI Column，用自然语言生成 JavaScript 逻辑，为数据库自动生成表结构，还可通过 AI 自动化动作自动处理文本、分类、清洗、生成数据等。</p>
<p><strong>适用场景</strong></p>
<p><strong>智能数据清洗与内容整理</strong> 使用 AI Column 自动清洗或规范数据，可适用于客户反馈管理、内容审核、工单处理等场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0adf18f03914428b8f37287e080d9d07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=eZEIrdzCsNqujh0iI%2ByW8VkygO8%3D" alt="AI Column.png" loading="lazy"/></p>
<p><strong>自动生成数据库表结构</strong> 当你需要快速搭建新的业务模块，比如客户管理、合同系统或任务管理系统时，可以通过 Budibase AI 一句话生成合适的数据表结构和示例数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/143b67fc4b614a298be94c09c6d8aecc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=KMU%2FORs9n1iUxZRQeuXuOrbJhdU%3D" alt="数据库表结构.png" loading="lazy"/></p>
<h3 data-id="heading-2">NO.3 Refine</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6607a2349f2840eeaa42850146840c3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=JyIfmC78LaxP2nlGyswSxK%2B5B3I%3D" alt="refine-dvhndk.png" loading="lazy"/></p>













































<table><thead><tr><th>GitHub 地址</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frefinedev%2Frefine" target="_blank" title="https://github.com/refinedev/refine" ref="nofollow noopener noreferrer">github.com/refinedev/r…</a></th></tr></thead><tbody><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Frefine.dev%2F" target="_blank" title="https://refine.dev/" ref="nofollow noopener noreferrer">refine.dev/</a></td></tr><tr><td>开源协议</td><td>MIT</td></tr><tr><td>GitHub Star 数</td><td>33.5k</td></tr><tr><td>GitHub Fork 数</td><td>2.9k</td></tr><tr><td>GitHub Issue 数</td><td>17</td></tr><tr><td>GitHub Pull Request 数</td><td>11</td></tr><tr><td>GitHub Contributor 数</td><td>311</td></tr><tr><td>GitHub 最近一次更新时间</td><td>2天前</td></tr><tr><td>相关文档链接</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.refine.dev%2F" target="_blank" title="https://ai.refine.dev/" ref="nofollow noopener noreferrer">ai.refine.dev/</a></td></tr></tbody></table>
<p><strong>工具介绍</strong></p>
<p>Refine 是一个开源的 React 元框架（meta-framework），专为 CRUD 密集型 Web 应用、企业后台、管理面板、Dashboard 和 B2B 内部工具设计。</p>
<p>Refine 推出了 Refine AI —— 将 AI 能力嵌入到内部工具创建流程中。通过 Refine AI，开发者可以用自然语言或文档／API 规范作为输入，自动生成一个基础的、生产级质量的 React 应用结构（包括 CRUD 页面、路由、鉴权、状态管理、数据请求等），输出纯 React 代码，方便进一步定制和开发。</p>
<p><strong>适用场景</strong></p>
<p><strong>后台管理系统生成</strong></p>
<p>Refine AI 能根据 API 或数据模型自动生成带列表页、表单页、详情页的 CRUD 管理界面，适合库存管理、订单管理、项目管理等内部系统的快速起步。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a919def83ef471284fbded1e17e83de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=sJtHDDVn%2BzPTa8%2F4T4zhOgomwng%3D" alt="后台管理系统生成-3eh30p.png" loading="lazy"/></p>
<p><strong>代码重构与维护</strong></p>
<p>Refine AI 的生成机制不仅适合新项目，也可以用在已有项目上。由于其生成代码遵循企业级结构与最佳实践，它能帮助开发者对旧系统进行模块化重构，或者在现有系统基础上快速新增新的业务模块，从而兼顾效率与可维护性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38277800ed2847df9bc13570ba5c5294~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=lTbwjvCb%2BqRGyKELAPXBiUy42bo%3D" alt="代码重构与维护.png" loading="lazy"/></p>
<p>💡推荐阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fnocobase-vs-refine" target="_blank" title="https://www.nocobase.com/cn/blog/nocobase-vs-refine" ref="nofollow noopener noreferrer">开源 CRUD 开发工具：NocoBase 与 Refine 对比 </a></p>
<h3 data-id="heading-3">NO.2 ToolJet</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc017e36bd21437e9ee87e4e8214be68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=vrK3MLxaSEUDHm8Hm1VYi4Pz2mc%3D" alt="ToolJet.png" loading="lazy"/></p>













































<table><thead><tr><th>GitHub 地址</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FToolJet%2FToolJet" target="_blank" title="https://github.com/ToolJet/ToolJet" ref="nofollow noopener noreferrer">github.com/ToolJet/Too…</a></th></tr></thead><tbody><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Ftooljet.ai%2F" target="_blank" title="https://tooljet.ai/" ref="nofollow noopener noreferrer">tooljet.ai/</a></td></tr><tr><td>开源协议</td><td>AGPL-3.0</td></tr><tr><td>GitHub Star 数</td><td>37k</td></tr><tr><td>GitHub Fork 数</td><td>4.9k</td></tr><tr><td>GitHub Issue 数</td><td>646</td></tr><tr><td>GitHub Pull Request 数</td><td>313</td></tr><tr><td>GitHub Contributor 数</td><td>651</td></tr><tr><td>GitHub 最近一次更新时间</td><td>一天前</td></tr><tr><td>相关文档链接</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.tooljet.com%2Fdocs%2Fbuild-with-ai%2Foverview" target="_blank" title="https://docs.tooljet.com/docs/build-with-ai/overview" ref="nofollow noopener noreferrer">docs.tooljet.com/docs/build-…</a></td></tr></tbody></table>
<p><strong>工具介绍</strong></p>
<p>ToolJet 是一个开源、低代码 + AI-native 平台，用于快速构建企业内部工具、仪表盘、后台管理系统及业务应用。它提供拖拽式可视化界面构建器、内置数据库、多种数据源／API／SaaS 集成能力、以及权限与协作机制，适合希望快速交付内部系统的团队。</p>
<p>在 ToolJet 中，AI 融合到平台构建流程里。你可以用自然语言描述想要的应用，ToolJet 会自动生成初步的 UI、数据结构与查询逻辑。</p>
<p><strong>适用场景</strong></p>
<p><strong>通过自然语言快速生成业务应用</strong></p>
<p>ToolJet 支持使用自然语言描述需求来构建内部工具，可以从零开始生成应用界面、数据结构和逻辑，也可以对现有应用进行调整或扩展。这使团队能够在短时间内生成如库存管理等常见内部系统，提高开发效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2c5c4ea34634abc93a91358f773fe43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=MPjQ8gJ3bk2nruDNMNo0sw8qQB0%3D" alt="自然语言快速生成.png" loading="lazy"/></p>
<p><strong>AI 文档助手加速构建</strong></p>
<p>ToolJet 内置一个 AI 文档助手，可以回答关于组件、功能、集成方式等平台相关的问题，帮助使用者更快理解并完成构建任务。对于不熟悉 ToolJet 或缺乏前端经验的团队，文档助手能够显著降低学习成本并提升搭建速度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c2c28f46a4a43e084985ff54cacc8c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=rMvmPmBtekQ2cSW69yv%2BXuiOtR0%3D" alt="AI 文档助手.png" loading="lazy"/></p>
<h3 data-id="heading-4">NO.1 appsmith</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaf926fea565476cbe18d41e14582cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=0zn96onbAEjpBQAVJlq57mkaxTI%3D" alt="appsmith-of0467.png" loading="lazy"/></p>













































<table><thead><tr><th>GitHub 地址</th><th><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fappsmithorg%2Fappsmith" target="_blank" title="https://github.com/appsmithorg/appsmith" ref="nofollow noopener noreferrer">github.com/appsmithorg…</a></th></tr></thead><tbody><tr><td>官网</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appsmith.com%2F" target="_blank" title="https://www.appsmith.com/" ref="nofollow noopener noreferrer">www.appsmith.com/</a></td></tr><tr><td>开源协议</td><td>Apache-2.0</td></tr><tr><td>GitHub Star 数</td><td>38.6k</td></tr><tr><td>GitHub Fork 数</td><td>4.4k</td></tr><tr><td>GitHub Issue 数</td><td>4.4k</td></tr><tr><td>GitHub Pull Request 数</td><td>38</td></tr><tr><td>GitHub Contributor 数</td><td>335</td></tr><tr><td>GitHub 最近一次更新时间</td><td>一天前</td></tr><tr><td>相关文档链接</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appsmith.com%2Fai%2Flow-code" target="_blank" title="https://www.appsmith.com/ai/low-code" ref="nofollow noopener noreferrer">www.appsmith.com/ai/low-code</a></td></tr></tbody></table>
<p><strong>工具介绍</strong></p>
<p>Appsmith 是一个开源低代码平台，旨在帮助团队以更少代码、更快速度构建内部业务应用。它支持连接多种数据库或 API，提供丰富的可视化 UI 组件，并允许开发者通过 JavaScript 添加自定义逻辑，从而灵活构建管理后台、数据面板、审批系统、CRM、仪表盘等。</p>
<p>最新版本中，Appsmith 加入了 AI 能力 —— 你可以将多种主流 LLM（如 OpenAI、Google AI、Anthropic 等）接入项目，通过 AI actions 实现文本分析、摘要、语义搜索以及文本或图像分类等功能。</p>
<p><strong>适用场景</strong></p>
<p><strong>借助 AI 提升构建速度</strong></p>
<p>在 Appsmith 中，AI 可以在应用构建的各个阶段提供上下文帮助，包括操作指引、平台能力解释、查询编写支持、JavaScript 逻辑建议以及界面定制提示。开发者在构建内部工具时，通过侧边的帮助入口即可调出 Appy，在当前页面直接获取相关协助，从而减少查文档和试错成本。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e15b948a191494f99514f1dcc0e6f16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=649qdS1hcQeGGbga8xopsmXxkYc%3D" alt="借助 AI 提升构建速度.png" loading="lazy"/></p>
<p><strong>在内部应用中整合 AI 能力</strong></p>
<p>例如，通过 Appsmith 的数据源、UI 组件和 Appsmith AI，团队可以创建一个用于分析客户评价的应用，并利用情感分类帮助客服人员更快识别负面评论，优先处理关键问题。从数据库查询评价内容、使用表格组件展示数据、接入 Appsmith AI datasource 执行情感分类，以及通过 JS Object 将分类结果回写到界面中，从而形成一个可交互的 AI 增强型内部工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bf17a490bdc401aa274444d9da398e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9jb0Jhc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765552982&amp;x-signature=XmcSgTxz26GIb0wplqjVS6e9mlY%3D" alt="整合 AI 能力.png" loading="lazy"/></p>
<p>💡推荐阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fnocobase-vs-appsmith" target="_blank" title="https://www.nocobase.com/cn/blog/nocobase-vs-appsmith" ref="nofollow noopener noreferrer">NocoBase 与 Appsmith：哪个开源低代码平台更适合你？</a></p>
<p>另外，除了上述五款高星的主流项目，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYaoApp%2Fyao" target="_blank" title="https://github.com/YaoApp/yao" ref="nofollow noopener noreferrer">Yao</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fillacloud%2Filla-builder" target="_blank" title="https://github.com/illacloud/illa-builder" ref="nofollow noopener noreferrer">ILLA Builder </a>这类开源工具也同样具备不错的社区活跃度。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYaoApp%2Fyao" target="_blank" title="https://github.com/YaoApp/yao" ref="nofollow noopener noreferrer">Yao</a> 以全栈应用引擎的方式，为内部系统提供模型、流程与 API 的快速构建能力；<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fillacloud%2Filla-builder" target="_blank" title="https://github.com/illacloud/illa-builder" ref="nofollow noopener noreferrer">ILLA Builder</a> 则面向可视化界面搭建，适合在较短时间内完成后台面板和数据工具的搭建。它们同样提供了基础的 AI 扩展能力，可以作为团队在构建内部工具时的补充选择。</p>
<h3 data-id="heading-5"><strong>结语</strong></h3>
<p>选择内部工具时，建议可以从多个维度进行综合评估，例如：</p>
<ol>
<li>AI 功能的成熟度，包括是否具备页面生成、SQL 或业务逻辑生成、图表生成、智能助手等能力；</li>
<li>生态活跃度，如 Star、Issue、Commit 与文档更新频率，都能反映项目的可靠性和可持续性；</li>
<li>自托管能力与安全性，影响企业内部部署和数据合规；</li>
<li>可扩展性与二次开发难度，直接关系到未来业务持续迭代的成本。</li>
</ol>
<p>希望本文的整理能够为你在自建内部工具时提供可参考的技术判断与选型依据。</p>
<p>随着生成式 AI 的不断演进，这些开源项目也会持续更新迭代，新的能力也会不断涌现。</p>
<p>期待这些工具能帮助你的团队在未来构建更高效、更智能的内部系统。</p>
<p>相关阅读：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fthe-8-best-google-sheets-alternatives-with-full-cost-and-capability-analysis" target="_blank" title="https://www.nocobase.com/cn/blog/the-8-best-google-sheets-alternatives-with-full-cost-and-capability-analysis" ref="nofollow noopener noreferrer">8 个最佳 Google Sheets 替代方案（附成本与能力分析）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-open-source-no-low-code-tools-for-building-pocs" target="_blank" title="https://www.nocobase.com/cn/blog/6-open-source-no-low-code-tools-for-building-pocs" ref="nofollow noopener noreferrer">6个适合做 PoC 的开源无代码/低代码工具推荐 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fa-developers-technical-decision-guide-to-no-code-and-low-code" target="_blank" title="https://www.nocobase.com/cn/blog/a-developers-technical-decision-guide-to-no-code-and-low-code" ref="nofollow noopener noreferrer">给开发者的无代码/低代码技术决策指南（2026）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F6-in-depth-comparison-rbac-no-code-low-code-platforms" target="_blank" title="https://www.nocobase.com/cn/blog/6-in-depth-comparison-rbac-no-code-low-code-platforms" ref="nofollow noopener noreferrer">6 大企业级无代码低代码平台 RBAC 权限体系深度对比</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2F14-ai-low-code-platforms-github" target="_blank" title="https://www.nocobase.com/cn/blog/14-ai-low-code-platforms-github" ref="nofollow noopener noreferrer">GitHub 上最值得关注的 14 个开源 AI 低代码工具 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Ftop-11-github-open-source-no-code-ai-tools" target="_blank" title="https://www.nocobase.com/cn/blog/top-11-github-open-source-no-code-ai-tools" ref="nofollow noopener noreferrer">11 个在 GitHub 上最受欢迎的开源无代码 AI 工具 </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nocobase.com%2Fcn%2Fblog%2Fgithub-open-source-ai-agent-projects" target="_blank" title="https://www.nocobase.com/cn/blog/github-open-source-ai-agent-projects" ref="nofollow noopener noreferrer">GitHub 上 Star 数量前 18 的开源 AI Agent 项目</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 Oracle 到 KingbaseES：破解迁移痛点，解锁信创时代数据库新可能]]></title>    <link>https://juejin.cn/post/7580203347702300687</link>    <guid>https://juejin.cn/post/7580203347702300687</guid>    <pubDate>2025-12-05T15:24:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580203347702300687" data-draft-id="7579995747171549219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 Oracle 到 KingbaseES：破解迁移痛点，解锁信创时代数据库新可能"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-12-05T15:24:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 Oracle 到 KingbaseES：破解迁移痛点，解锁信创时代数据库新可能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T15:24:21.000Z" title="Fri Dec 05 2025 15:24:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>提起 Oracle，它在传统数据库领域可是标杆般的存在，长久以来一直撑起了众多企业的核心业务，可这两年情形发生了改变，Oracle的授权费用很高，运维成本又让人头疼，再加上信创政策对于合规有着强硬的要求，于是很多企业便开始把目光转向国产数据库。金仓数据库 KingbaseES 是国产数据库中的佼佼者，凭借其高适配性和高性能的基础，成了人们更换 Oracle 的首要选择，不过要告诉大家的是，迁移之路并非易走，“报错”频繁出现，存在适配性障碍，成本难以控制住……这些难点真真切切地成为了企业在执行迁移时碰上的“绊脚石”，如今，我们就依照从 Oracle 向 KingbaseES 迁移的实际操作经验，深入剖析这些难点，并且给出一些切实可行的应对办法。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d16188c7e77d43b0abfc1d1e986c3519~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=%2BYJlkCNPx6YlAPwMmIfeclBlHco%3D" alt="74d8cc9b154fb989777d0027ba927176.jpg" loading="lazy"/>
@[TOC]</p>
<h2 data-id="heading-0">一、迁移浪潮下的 “甜蜜烦恼”：为何 Oracle 迁移势在必行却困难重重？</h2>
<p>随着信创政策从当初的“试点”走向现在的“全面推广”，企业面临着“必须迁”的合规压力；另一方面，Oracle 逐年上涨的维保费、封闭的技术生态，也让企业背负着“不得不迁”的成本压力。据金仓数据库社区的调研显示，超过 70% 的企业想迁移，背后的动力无非就是两个：“信创合规”和“降本增效”。</p>
<p>但真到了迁移的时候，企业往往会陷入“理想很丰满，现实很骨感”的尴尬境地：原本计划 3 个月搞定的项目，因为各种兼容性报错，硬是拖了大半年；投入大量人力去改代码，结果数据还是对不上；好不容易迁完了，系统性能反而还不如以前…… 这些问题的核心，都指向了迁移过程中三个绕不开的痛点：“问题词”频发、兼容性挑战、迁移成本高企。</p>
<h2 data-id="heading-1">二、Oracle 迁移三大核心痛点拆解：每一步都暗藏 “绊脚石”</h2>
<h3 data-id="heading-2">（一）痛点 1：高频 “问题词” 频发，迁移路上步步踩坑</h3>
<p>在迁移过程中，各种各样的“问题词”就像“拦路虎”一样，让技术团队疲于奔命。这些问题看着好像挺零散，但凑在一起就能直接导致迁移停滞，甚至搞出数据异常的大乱子，绝对是拖慢进度的头号杀手：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19a109adc574ace8fe511d2f5c0443d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=qCd1QIh1PHPNWrhKTFBAhi037dg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">（二）痛点 2：兼容性 “隐形壁垒”，代码与数据难适配</h3>
<p>异构数据库迁移，最难啃的骨头就是兼容性。虽然 KingbaseES 和 Oracle 在核心功能上已经高度兼容了，但在语法细节、数据类型边缘场景、数据库对象特性这些方面的“隐形差异”，往往会成为卡住迁移的关键障碍：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d78c3cdabb8847e0ae5cef4be32cb484~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=A1pw%2BTyWW5lPrpgsb%2FkX8XbeQJg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">（三）痛点 3：迁移成本 “失控”，时间与资源双重压力</h3>
<p>Oracle 迁移可不是简单的“数据搬运”，而是一个涉及评估、准备、迁移、测试的全流程系统工程。企业经常会面临“预算超支、工期延误”的困境：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0a493b72d1341dfbe79666fbb052bfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=kzhQErMwhxatU%2BPqTgpX9HycdUQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">三、金仓数据库的 “破局之道”：从兼容到工具，全方位化解迁移痛点</h2>
<p>针对 Oracle 迁移的这些核心痛点，KingbaseES 从“兼容性增强、迁移工具链优化、全流程支持”这三个维度打造了一套解决方案，目的很简单：让迁移过程“降难度、提效率、控成本”。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74c2802df4d4459b978470fd45b9f6cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=j8%2FJJZ6RoxBXrYAISOosmDSpIjw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">（一）极致兼容：抹平差异，减少代码改写</h3>
<p>KingbaseES 在深度优化 Oracle 兼容特性上下了狠功夫，从数据类型、SQL 语法、PL/SQL 到应用接口，力求实现“最小改动”迁移：</p>
<ul>
<li><strong>全量数据类型兼容</strong>：支持 Oracle 所有核心数据类型，甚至包括 RECORD、% TYPE、关联数组这些复杂类型。通过 <code>ora_date_style</code> 参数就能兼容非标准日期格式，设置 <code>nls_length_semantics</code> 与源库保持一致，就能避免 CHAR 类型存储差异的问题；至于 NUMBER 类型，提供了灵活的类型映射规则，通过 KDTS 工具就能自动转换为 KingbaseES 的 int、numeric 等类型。</li>
<li><strong>PL/SQL 语法全覆盖</strong>：Oracle PL/SQL 的所有常用语法（像循环、游标、异常处理等）及对象（存储过程、函数、包、触发器等）都支持，还内置了 DBMS_SQL、DBMS_LOB 等常用包。对于“同名同参数”存储过程、方法连续调用这类不兼容的棘手场景，也提供了明确的改写指引和自动化转换工具（KDMS），大大减少了手动修改的工作量。</li>
<li><strong>应用接口无缝适配</strong>：ODBC、JDBC、OCI 等主流接口全支持，还提供了兼容 Oracle SQL*PLUS 的 KSQL 工具，以及兼容 SQL Developer 的 KStudio 图形化工具。应用程序这边，基本只需要修改连接串、用户名密码等少量配置，就能快速适配。如果是 OCI 应用，KingbaseES 还有专门的 DCI 接口兼容方案，根本不需要大规模改写代码。</li>
</ul>
<h3 data-id="heading-7">（二）智能工具链：简化流程，提升迁移效率</h3>
<p>KingbaseES 提供了一整套工具链，包括 KDTS（数据迁移工具）、KFS（数据同步工具）等，覆盖了离线迁移、在线迁移、多次迁移等全场景，让迁移过程变得“自动化、可视化、可追溯”：</p>
<ul>
<li>
<p><strong>KDTS：一站式迁移工具</strong>：从 Oracle 9i 到 19c 都能迁到 KingbaseES。它提供 WEB 和 SHELL 两种形态，想怎么用都行。通过向导式配置，点几下就能完成数据源连接、迁移对象选择、参数配置等操作；支持大表拆分、增量数据迁移、数据类型自动映射。针对 LOB 这种大字段，还专门优化了游标提取参数，降低了迁移中断的风险。迁完之后会自动生成报告，成功多少、失败多少一目了然，失败的脚本还能直接下载下来，改好后重新执行。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a6381096866432fb55bf365480f5958~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=wP5RpqsQ3EeGAG6OXcFIHf%2F0ow8%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>KFS：在线同步工具</strong>：如果业务不能停，那就用 KFS。它可以实现 Oracle 存量数据迁移和增量数据追平。通过 SCN 号定位同步起点，保证数据一致性，跨网络、大规模数据同步也没问题。最重要的是，迁移过程中业务可以正常运行，大幅降低了停机成本。</p>
</li>
<li>
<p><strong>配置自动化：减少人工失误</strong>：提供标准化的迁移配置模板，能自动读取 Oracle 数据库编码、日期格式等关键信息，智能推荐 KingbaseES 的兼容参数（比如 <code>search_path</code> 模式搜索路径、用 <code>default_with_oids</code> 替代 ROWID），避免因为配置不当导致迁移失败。</p>
</li>
</ul>
<h3 data-id="heading-8">（三）全流程支持：降低门槛，控制迁移成本</h3>
<p>KingbaseES 不光提供工具和技术，还通过标准化流程和专业服务，帮企业把控从评估到上线全流程的成本：</p>
<ul>
<li><strong>标准化评估模板</strong>：在动手之前，提供数据库概况、对象统计、约束统计等全套评估模板，帮企业快速梳理迁移范围、难度和工作量，避免盲目投入。比如，通过模板能统计表、存储过程、触发器等对象的数量，识别出大表、LOB 字段这些迁移难点，提前制定应对方案。</li>
<li><strong>分阶段迁移策略</strong>：支持按“数据库→用户→数据→应用”的顺序有序迁移。针对多次迁移的场景，可以灵活选择“只迁移数据”或者“迁移结构 + 数据”，避免重复劳动。例如，项目开发过程中需要定期迁移，就可以用 KDTS 的“按条件迁移”功能，只同步新增数据，效率提升杠杠的。</li>
<li><strong>测试与调优支持</strong>：提供 TPCC、LoadRunner 等性能测试工具的适配方案，迁完后能快速开展功能回归测试和性能测试；针对性能瓶颈，还会提供 SQL 优化、索引调整、参数配置等专业建议，保障迁过去后的系统性能不比原 Oracle 环境差。</li>
</ul>
<h3 data-id="heading-9">（四）GIS 等特殊场景解决方案</h3>
<p>针对包含 GIS 数据的 Oracle 迁移场景，KingbaseES 已经适配了 ArcGIS/GeoScene 平台，提供了一套专用的迁移方案：通过 PostGIS 插件扩展 GIS 功能，先迁移非 GIS 数据，再通过 ArcMap 工具迁移 GIS 数据并注册地理信息数据库，解决了 SDE 类型数据迁移、空间索引兼容等特殊难题，保障 GIS 应用无缝迁移。</p>
<p>源数据库的非 GIS 数据迁至目标数据库后，可以在 ArcGIS / GeoScene 平台上进行 GIS 数据迁移。这步做完，后续应用才能正常使用。GIS 数据迁移的具体步骤如下：</p>
<ul>
<li>迁移后，去那个类似 <code>result/2021-12-02_15_15_15/SDE/AcrpyRegisterScript/</code> 的目录下，把 <code>acrpyRegisterWithGeodatabase.py</code> 文件拷贝到 ArcGIS 所在的机器上，放到形如 <code>c:/python27/ArcGIS10.0</code> 的目录下：</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13462f6426874c6c9c9160f1d5874636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=wKG9p%2FtwJiAYZq7rBDApcXjxC3Q%3D" alt="" loading="lazy"/></p>
<ul>
<li>查看 ArcMap 的 kingbase 数据库连接信息，并复制下来。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41a40368043a4fa881bdf7d573d6d2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=AHBtBDsqH5x9M1RYRoIGr4hlBv4%3D" alt="" loading="lazy"/></p>
<ul>
<li>编辑 <code>acrpyRegisterWithGeodatabase.py</code> 文件，将上一步复制的内容粘贴到以下位置，保存文件。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ade7d31580461d9eba2037abe1356b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=HyymQKswBbhWHo8Q5u6Y4A92HqA%3D" alt="" loading="lazy"/></p>
<ul>
<li>执行 <code>acrpyRegisterWithGeodatabase.py</code> 脚本，将源数据库的地理信息库中的数据迁移到目标数据库的 ArcGIS 地理信息库中。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21e0fd3f0b1748d68ceca2bf8580edbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765553060&amp;x-signature=cBQ2T6rBy7SVJRzXd4zwz0BHaO4%3D" alt="" loading="lazy"/></p>
<ul>
<li>执行完成后，使用 ArcMap 软件验证一下，看看能不能正常显示图层信息。如果能正常显示，说明 GIS 数据已经迁移成功了（或者对比一下 GIS 平台下，迁移的数据要素集在两个数据库下是否一致）。</li>
</ul>
<h2 data-id="heading-10">四、实战验证：迁移价值落地，企业受益显著</h2>
<p>某大型制造企业的 Oracle 11g 数据库迁移项目中，面临着 1660 张表、25 个存储过程、300 多个同义词的迁移压力，而且还包含大量 LOB 字段（照片、文档），业务要求 7×24 小时运行。通过 KingbaseES 的迁移方案：</p>
<ul>
<li>利用 KDTS 工具完成离线迁移，大表拆分功能将 16GB 的 XFJXX 表拆分为 24 块并行迁移，迁移效率直接提升了 3 倍，全程无数据丢失；</li>
<li>通过 PL/SQL 自动化转换工具，25 个存储过程仅需修改 3 个“同名同参数”函数，改写工作量减少了 80%；</li>
<li>采用 KFS 工具实现增量数据追平，迁移过程中业务无中断，停机时间控制在 1 小时内；</li>
<li>迁完后系统运维成本降低了 60%，性能较原 Oracle 环境提升了 15%，完全满足信创合规要求。</li>
</ul>
<h2 data-id="heading-11">五、结语：迁移不是终点，而是国产数据库赋能业务的起点</h2>
<p>Oracle 到 KingbaseES 的迁移，本质上是企业数字化转型过程中一次“换道升级”的选择。迁移路上的痛点并非不可逾越，金仓数据库通过极致的兼容性、智能的工具链、全流程的支持，已帮助数千家企业顺利完成迁移，实现了“降本增效、自主可控”的核心目标。</p>
<p>在信创时代，国产数据库不再是“替代选择”，而是“优选方案”。KingbaseES 不仅解决了 Oracle 迁移的痛点，更凭借高性能、高可用、高安全的特性，为企业业务创新提供强大支撑。未来，金仓数据库将持续深耕兼容性与迁移工具优化，让更多企业轻松拥抱国产数据库，解锁数字化转型的新可能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS内存映射技术：mmap如何用有限内存操控无限数据]]></title>    <link>https://juejin.cn/post/7580203347702317071</link>    <guid>https://juejin.cn/post/7580203347702317071</guid>    <pubDate>2025-12-05T15:26:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580203347702317071" data-draft-id="7580202945146667023" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS内存映射技术：mmap如何用有限内存操控无限数据"/> <meta itemprop="keywords" content="iOS,APP,操作系统"/> <meta itemprop="datePublished" content="2025-12-05T15:26:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweet丶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS内存映射技术：mmap如何用有限内存操控无限数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweet丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T15:26:14.000Z" title="Fri Dec 05 2025 15:26:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当一个iOS应用需要处理比物理内存大10倍的文件时，传统方法束手无策，而mmap却能让它流畅运行。这种神奇能力背后，是虚拟内存与物理内存的精密舞蹈。</p>
</blockquote>
<h2 data-id="heading-0">01 内存管理的双重世界：虚拟与物理的分离</h2>
<p>每个iOS应用都生活在双重内存现实中。当你声明一个变量或读取文件时，你操作的是<strong>虚拟内存地址</strong>，这是iOS为每个应用精心编织的“平行宇宙”。</p>
<p>这个宇宙大小固定——在64位iOS设备上高达<strong>128TB</strong>的虚拟地址空间，远超任何物理内存容量。</p>
<p><strong>虚拟内存的精妙之处</strong>在于：它只是一个巨大的、连续的地址范围清单，<strong>不直接对应物理内存芯片</strong>。操作系统通过内存管理单元（MMU）维护着一张“翻译表”（页表），将虚拟页映射到物理页框。这种设计使得应用可以假设自己拥有几乎无限的内存，而实际物理使用则由iOS动态管理。</p>
<p>这种分层架构是mmap处理超大文件的基础：<strong>应用程序可以在虚拟层面“拥有”整个文件，而只在物理层面加载需要部分</strong>。</p>
<h2 data-id="heading-1">02 传统文件操作的二重拷贝困境</h2>
<p>要理解mmap的革命性，先看看传统文件I/O的“双重复制”问题：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 传统方式：双重拷贝的典型代码</span>
NSData *fileData = [NSData dataWithContentsOfFile:largeFile];
</code></pre>
<p>这个看似简单的操作背后，数据经历了漫长旅程：</p>
<pre><code class="hljs language-scss" lang="scss">磁盘文件数据
    ↓ (DMA拷贝，不经过CPU)
内核页缓存(Page Cache)
    ↓ (CPU参与拷贝，消耗资源)
用户空间缓冲区(NSData内部存储)
</code></pre>
<p><strong>双重拷贝的代价</strong>：</p>
<ul>
<li><strong>时间开销</strong>：两次完整数据移动</li>
<li><strong>CPU消耗</strong>：拷贝操作占用宝贵计算资源</li>
<li><strong>内存峰值</strong>：文件在内存中同时存在两份副本（内核缓存+用户缓冲区）</li>
<li><strong>大文件限制</strong>：文件必须小于可用物理内存</li>
</ul>
<p>对于100MB的文件，这还能接受。但对于2GB的视频文件，这种方法在1GB RAM的设备上直接崩溃。</p>
<h2 data-id="heading-2">03 mmap的魔法：一次映射，零次拷贝</h2>
<p>mmap采用完全不同的哲学——<strong>如果数据必须在内存中，为什么不直接在那里访问它？</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// mmap方式：建立直接通道</span>
<span class="hljs-type">int</span> fd = open(largeFile, O_RDONLY);
<span class="hljs-type">void</span> *mapped = mmap(<span class="hljs-literal">NULL</span>, fileSize, PROT_READ, MAP_PRIVATE, fd, <span class="hljs-number">0</span>);
<span class="hljs-comment">// 现在可以直接通过mapped指针访问文件内容</span>
</code></pre>
<p>mmap建立的是<strong>直接通道</strong>而非<strong>数据副本</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">磁盘文件数据
    ↓ (DMA直接拷贝)
物理内存页框
    ↖(直接映射)
进程虚拟地址空间
</code></pre>
<p><strong>关键突破</strong>：</p>
<ol>
<li><strong>单次拷贝</strong>：数据从磁盘到内存仅通过DMA传输一次</li>
<li><strong>零CPU拷贝</strong>：没有内核到用户空间的额外复制</li>
<li><strong>内存效率</strong>：物理内存中只有一份数据副本</li>
<li><strong>按需加载</strong>：仅在实际访问时加载对应页面</li>
</ol>
<h2 data-id="heading-3">04 虚拟扩容术：如何用有限物理内存处理无限文件</h2>
<p>这是mmap最反直觉的部分：<strong>虚拟地址空间允许“承诺”远多于物理内存的资源</strong>。</p>
<p>当映射一个5GB文件到2GB物理内存的设备时：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 这在2GB RAM设备上完全可行</span>
<span class="hljs-type">void</span> *mapped = mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">5</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024ULL</span>, 
                    PROT_READ, MAP_PRIVATE, fd, <span class="hljs-number">0</span>);
</code></pre>
<p><strong>按需加载机制</strong>确保只有实际访问的部分占用物理内存：</p>
<ol>
<li><strong>建立映射</strong>（瞬间完成）：仅在进程页表中标记“此虚拟范围映射到某文件”</li>
<li><strong>首次访问</strong>（触发加载）：访问<code>mapped[offset]</code>时触发缺页中断</li>
<li><strong>按页加载</strong>（最小单位）：内核加载包含目标数据的<strong>单个内存页</strong>（iOS通常16KB）</li>
<li><strong>动态换页</strong>（透明管理）：物理内存紧张时，iOS自动将不常用页面换出，需要时再换入</li>
</ol>
<p><strong>内存使用随时间变化</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">时间轴: |---启动---|---浏览开始---|---跳转章节---|</span>
<span class="hljs-section">物理内存: | 16KB    | 48KB         | 32KB         |</span>
<span class="hljs-section">虚拟占用: | 5GB     | 5GB          | 5GB          |</span>
</code></pre>
<p>应用“看到”的是完整的5GB文件空间，但<strong>物理内存中只保留最近访问的少量页面</strong>。</p>
<h2 data-id="heading-4">05 性能对比：数字说明一切</h2>
<p>通过实际测试数据，揭示两种方式的性能差异：</p>









































<table><thead><tr><th>操作场景</th><th>传统read()</th><th>mmap映射</th><th>优势比</th></tr></thead><tbody><tr><td>首次打开500MB文件</td><td>1200ms</td><td>&lt;10ms</td><td>120倍</td></tr><tr><td>随机访问100处数据</td><td>850ms</td><td>220ms</td><td>3.9倍</td></tr><tr><td>内存峰值占用</td><td>500MB</td><td>800KB</td><td>625倍更优</td></tr><tr><td>处理2GB视频文件(1GB RAM)</td><td>崩溃</td><td>正常播放</td><td>无限</td></tr><tr><td>多进程共享读取</td><td>每进程500MB</td><td>共享物理页</td><td>N倍节省</td></tr></tbody></table>
<p><strong>实际测试代码</strong>：</p>
<pre><code class="hljs language-objective-c" lang="objective-c">// 测试大文件随机访问性能
- (void)testRandomAccess {
    // 传统方式
    NSData *allData = [NSData dataWithContentsOfFile:largeFile];
    start = clock();
    for (int i = 0; i &lt; 1000; i++) {
        NSUInteger randomOffset = arc4random_uniform(fileSize-100);
        [allData subdataWithRange:NSMakeRange(randomOffset, 100)];
    }
    traditionalTime = clock() - start;
    
    // mmap方式
    int fd = open([largeFile UTF8String], O_RDONLY);
    void *mapped = mmap(NULL, fileSize, PROT_READ, MAP_PRIVATE, fd, 0);
    start = clock();
    for (int i = 0; i &lt; 1000; i++) {
        NSUInteger randomOffset = arc4random_uniform(fileSize-100);
        memcpy(buffer, mapped + randomOffset, 100);
    }
    mmapTime = clock() - start;
}
</code></pre>
<h2 data-id="heading-5">06 iOS中的实践应用</h2>
<p>mmap在iOS系统中无处不在：</p>
<p><strong>系统级应用</strong>：</p>
<ol>
<li><strong>应用启动优化</strong>：iOS使用mmap加载可执行文件和动态库，实现懒加载</li>
<li><strong>数据库引擎</strong>：SQLite的WAL模式依赖mmap实现原子提交</li>
<li><strong>图像处理</strong>：大图像使用mmap避免一次性解码</li>
</ol>
<p><strong>开发实战示例</strong>：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// Swift中安全使用mmap处理大日志文件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MappedFileReader</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> fileHandle: <span class="hljs-type">FileHandle</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mappedPointer: <span class="hljs-type">UnsafeMutableRawPointer</span>?
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mappedSize: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">fileURL</span>: <span class="hljs-type">URL</span>) <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">self</span>.fileHandle <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">FileHandle</span>(forReadingFrom: fileURL)
        <span class="hljs-keyword">let</span> fileSize <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> fileURL.resourceValues(forKeys:[.fileSizeKey]).fileSize<span class="hljs-operator">!</span>
        
        <span class="hljs-comment">// 建立内存映射</span>
        mappedPointer <span class="hljs-operator">=</span> mmap(<span class="hljs-literal">nil</span>, fileSize, <span class="hljs-type">PROT_READ</span>, <span class="hljs-type">MAP_PRIVATE</span>, 
                            fileHandle.fileDescriptor, <span class="hljs-number">0</span>)
        
        <span class="hljs-keyword">guard</span> mappedPointer <span class="hljs-operator">!=</span> <span class="hljs-type">MAP_FAILED</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-type">POSIXError</span>(.<span class="hljs-type">EINVAL</span>)
        }
        
        mappedSize <span class="hljs-operator">=</span> fileSize
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">readData</span>(<span class="hljs-params">offset</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">length</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Data</span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> base <span class="hljs-operator">=</span> mappedPointer, offset <span class="hljs-operator">+</span> length <span class="hljs-operator">&lt;=</span> mappedSize <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>()
        }
        <span class="hljs-keyword">return</span> <span class="hljs-type">Data</span>(bytes: base.advanced(by: offset), count: length)
    }
    
    <span class="hljs-keyword">deinit</span> {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> pointer <span class="hljs-operator">=</span> mappedPointer {
            munmap(pointer, mappedSize)
        }
    }
}
</code></pre>
<h2 data-id="heading-6">07 局限与最佳实践</h2>
<p><strong>适用场景</strong>：</p>
<ul>
<li>大文件随机访问（视频编辑、数据库文件）</li>
<li>只读或低频写入的数据</li>
<li>需要进程间共享的只读资源</li>
<li>内存敏感的大数据应用</li>
</ul>
<p><strong>避免场景</strong>：</p>
<ul>
<li>频繁小块随机写入（产生大量脏页）</li>
<li>网络文件系统或可移动存储</li>
<li>需要频繁调整大小的文件</li>
</ul>
<p><strong>iOS特别优化建议</strong>：</p>
<ol>
<li><strong>对齐访问</strong>：确保访问按16KB页面边界对齐</li>
<li><strong>局部性原则</strong>：组织数据使相关部分在相近虚拟地址</li>
<li><strong>预取提示</strong>：对顺序访问使用<code>madvise(..., MADV_SEQUENTIAL)</code></li>
<li><strong>及时清理</strong>：不再需要的区域使用<code>munmap</code>释放</li>
</ol>
<h2 data-id="heading-7">08 未来展望：统一内存架构下的mmap</h2>
<p>随着Apple Silicon的演进，iOS内存架构正向更深度统一发展：</p>
<p><strong>趋势一：CPU/GPU直接共享映射内存</strong></p>
<ul>
<li>Metal API允许GPU直接访问mmap区域</li>
<li>视频处理无需CPU中介拷贝</li>
</ul>
<p><strong>趋势二：Swap压缩的智能化</strong></p>
<ul>
<li>iOS 15+的Memory Compression更高效</li>
<li>不活跃mmap页面被高度压缩，而非写回磁盘</li>
</ul>
<p><strong>趋势三：持久化内存的兴起</strong></p>
<ul>
<li>未来设备可能配备非易失性RAM</li>
<li>mmap可能实现真正“内存速度”的持久化存储</li>
</ul>
<hr/>
<p><strong>技术进化的本质是抽象层次的提升</strong>。mmap通过虚拟内存这一精妙抽象，将有限的物理内存转化为看似无限的资源池。在移动设备存储快速增长而内存相对有限的背景下，掌握mmap不是高级优化技巧，而是处理现代iOS应用中大型数据集的必备技能。</p>
<p>当你的应用下一次需要处理大型视频、数据库或机器学习模型时，记得这个简单的准则：<strong>不要搬运数据，要映射数据</strong>。让iOS的虚拟内存系统成为你的盟友，而非限制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你的 Prompt 都该重写？]]></title>    <link>https://juejin.cn/post/7580204190027923462</link>    <guid>https://juejin.cn/post/7580204190027923462</guid>    <pubDate>2025-12-05T14:07:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580204190027923462" data-draft-id="7580196545288241206" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你的 Prompt 都该重写？"/> <meta itemprop="keywords" content="人工智能,AI编程"/> <meta itemprop="datePublished" content="2025-12-05T14:07:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcs"/> <meta itemprop="url" content="https://juejin.cn/user/3679404422861902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你的 Prompt 都该重写？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3679404422861902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T14:07:08.000Z" title="Fri Dec 05 2025 14:07:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，这里是<strong>架构资源栈</strong>！</p>
<hr/>
<p>大家总说模型会 <strong>过拟合数据</strong>，但很少有人注意到：<strong>Prompt 也会过拟合模型</strong>。</p>
<p>很多开发者遇到过这种情况：新模型明明更强，但接入后效果不升反降，甚至用户还嫌弃。比如当 Cursor 第一次接入 GPT-5 时，网上一度骂声一片，直到官方和 OpenAI 一起做了 Prompt 调优，体验才逐渐反转。</p>
<p><img src="https://files.mdnice.com/user/44095/bd757f03-3617-4f5e-9108-25b1c7439e1e.png" alt="image" loading="lazy"/>
结论很简单：
👉 模型升级时，<strong>不重写 Prompt = 用老钥匙开新锁</strong>，必然卡壳。</p>
<p>下面从三个角度聊聊，为什么 Prompt 不能一招鲜吃遍天。</p>
<hr/>
<h2 data-id="heading-0">1. Prompt 格式差异</h2>
<p>不同模型对输入格式的“偏好”差异巨大。</p>
<ul>
<li><strong>OpenAI 系列</strong>：从早期到现在，几乎一直偏爱 <strong>Markdown</strong>，官方教程和系统提示大多都是这种格式。</li>
<li><strong>Anthropic Claude 系列</strong>：则更适配 <strong>XML</strong>。Claude 3.5 的系统提示直接就是 XML，因为它在训练中接触了大量 XML 数据，自然更懂这一套。</li>
</ul>
<p>案例：
同样一段 XML 格式 Prompt，Claude 表现出色，而 GPT-4 可能就完全不行。</p>
<p>所以换模型时，如果你还抱着老 Prompt 不放，就像让一个没学过 LaTeX 的人硬读公式，效果可想而知。</p>
<hr/>
<h2 data-id="heading-1">2. 位置偏差（Position Bias）</h2>
<p><strong>模型并不会平均对待 Prompt 的每个位置</strong>。</p>
<ul>
<li>有的模型更看重开头；</li>
<li>有的模型则对结尾权重更高；</li>
<li>甚至同一个模型，在不同语言、不同上下文下，偏好还会变化。</li>
</ul>
<p>一篇 2025 年的跨语言研究表明：</p>
<ul>
<li><strong>Qwen 系列</strong> → 更在意最后的内容；</li>
<li><strong>Llama 系列</strong> → 更看重开头。</li>
</ul>
<p>这意味着：在 RAG 场景下，你放在 Prompt 开头还是结尾的示例，直接决定了模型能不能答好问题。</p>
<hr/>
<h2 data-id="heading-2">3. 模型固有偏差（Model Biases）</h2>
<p>除了格式和位置，不同模型本身也有“性格差异”。</p>
<ul>
<li><strong>显性偏差</strong>：比如部分中文大模型会主动规避敏感话题。</li>
<li><strong>隐性偏差</strong>：有的模型默认话多啰嗦，有的则简洁直接；有的喜欢生成额外字段，有的更保守。</li>
</ul>
<p>问题是，大多数人写 Prompt 时都在 <strong>跟模型的偏差作对</strong>。
比如反复加“Be concise”，但如果新模型本身已经足够简洁，这些约束就成了赘余，反而影响效果。</p>
<h3 data-id="heading-3">3a. 学会顺势而为</h3>
<p>与其强行矫正，不如利用模型的默认倾向。
如果模型总会加几个 JSON 字段，与其拼命阻止，不如考虑接受并调整下游逻辑，结果可能更稳定。</p>
<hr/>
<h2 data-id="heading-4">关键结论</h2>
<ul>
<li>模型不是“即插即用”的，Prompt 过拟合是常态；</li>
<li>每换一个模型，都要 <strong>重写 / 调优 Prompt</strong>；</li>
<li>甚至在同一模型的升级版本之间，Prompt 也可能需要微调；</li>
<li>最佳实践：写完就 eval，和模型“磨合”，顺着它的天性去设计。</li>
</ul>
<p>换句话说：
👉 Prompt 就是“模型的 API”，新版本上线，API 可能改了，你不更新调用方式，必然踩坑。</p>
<hr/>
<h2 data-id="heading-5">给公众号读者的实操建议</h2>
<p>如果你在做 LLM 应用，可以尝试以下三步：</p>
<ol>
<li><strong>对比 Prompt 格式</strong>：在新模型上分别用 Markdown 和 XML 测试同一任务，看看差异；</li>
<li><strong>测试位置敏感性</strong>：调换上下文示例的顺序，观察输出变化；</li>
<li><strong>监控默认风格</strong>：比如字数长短、是否爱加说明、输出结构是否稳定，决定要不要顺势而为。</li>
</ol>
<p>这样，你就能快速判断 <strong>是否需要重写 Prompt</strong>，而不是把问题归咎于“新模型不行”。</p>
<hr/>
<p><strong>喜欢就奖励一个“👍”和“在看”呗~</strong></p>
<p><img src="https://files.mdnice.com/user/44095/f9363b7e-9738-44f3-9ac6-8ee2cddf995d.png" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌截胡OpenAI？揭秘月费250刀的“奥数金牌”AI到底强在哪]]></title>    <link>https://juejin.cn/post/7580180556984057906</link>    <guid>https://juejin.cn/post/7580180556984057906</guid>    <pubDate>2025-12-05T14:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580180556984057906" data-draft-id="7580197740962676762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌截胡OpenAI？揭秘月费250刀的“奥数金牌”AI到底强在哪"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-05T14:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌截胡OpenAI？揭秘月费250刀的“奥数金牌”AI到底强在哪
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T14:23:31.000Z" title="Fri Dec 05 2025 14:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年12月5日，科技圈原本平静的水面被谷歌扔下的一颗深水炸弹彻底搅浑了。</p>
<p>就在所有人还在猜测OpenAI那个传说中的模型何时公测时，谷歌悄无声息地按下了发布键。Gemini 3 Deep Think（深度思考模式）正式上线。这不是一次常规的版本迭代，而是一次对“AI能做什么”的重新定义。</p>
<p>如果你还以为现在的AI只是陪聊、写写周报的工具，那你可能得重新刷新一下认知了。谷歌这次把门槛拉到了一个令人咋舌的高度：这一模式仅向每月支付249.99美元（约合人民币1800元）的Google AI Ultra订阅用户开放。</p>
<p>这就引出了一个非常现实的问题：一个月花两百多美金，买回来的到底是个什么怪物？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-05_22.17.04.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-05_22.17.04.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c715a23f98994bc38dc14ee9fe41c144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765549411&amp;x-signature=E573IjrjrBDUYKBGveKP6gvaY0o%3D" alt="iShot_2025-12-05_22.17.04" loading="lazy"/></a></p>
<h3 data-id="heading-0">哪怕慢几分钟，也要算出“奥数金牌”</h3>
<p>我们先抛开枯燥的参数，聊聊这个模型的“大脑”。</p>
<p>以前我们用ChatGPT或者Gemini，感觉它们像是一个反应极快的接话员，你话音刚落，它答案就来了。这种快是优势，也是劣势——因为对于复杂的数学或逻辑问题，“快”往往意味着“不过脑子”。</p>
<p>Deep Think 最大的不同在于，它学会了“慢下来”。</p>
<p>谷歌这次引入了所谓的“并行推理技术”。打个比方，以前的AI解题是一条路走到黑，撞了南墙也不回头；而Deep Think 就像一个经验丰富的数学教授，面对一道难题，它会在后台同时派出好几个“分身”，分别尝试不同的解题路径。有的分身去试错，有的分身去验证，最后把走通的那条路整合出来给你。</p>
<p>这种机制带来的结果是震撼的。在国际数学奥林匹克竞赛（IMO）的测试中，它拿下了42分满分中的35分，成功解出了6道超高难度题目中的5道。这意味着什么？意味着它已经达到了人类顶尖数学竞赛选手的金牌水准。</p>
<p>更有意思的是，谷歌甚至允许用户去调节它的“思考深度”。你是想要一个快速的粗略答案，还是愿意等上几分钟，让它进行一场深度的逻辑推演？这种将思考过程“参数化”的做法，是以前从未有过的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FG7WlVfvb0AcyVYZ-1024x576.jpeg" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/G7WlVfvb0AcyVYZ-1024x576.jpeg" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8704a7b4f1c47beb8d3d3097e817186~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765549411&amp;x-signature=95%2BzCRE%2FnwCkSB9D7MRP%2FJK0YVw%3D" alt="G7WlVfvb0AcyVYZ" loading="lazy"/></a></p>
<h3 data-id="heading-1">数据不会撒谎：碾压级的硬实力</h3>
<p>为了验证这不是营销噱头，我们可以看看几个被称为“AI噩梦”的基准测试数据。</p>
<p>首先是 <strong>GPQA Diamond</strong>，这是一个专门测试博士级科学知识的高难度题库，Deep Think 拿到了 <strong>93.8%</strong> 的恐怖高分。</p>
<p>其次是 <strong>Humanity’s Last Exam (HLE)</strong>。这名字听起来就很中二，但它是目前业内公认最难的综合推理测试之一。在不使用任何外部工具的情况下，Deep Think 拿到了 <strong>41.0%</strong>。你可能觉得41%不高，但作为对比，之前的行业顶流模型在这里的分数大多惨不忍睹，连及格线的边都摸不到。</p>
<p>哪怕是在需要写代码解决抽象问题的 <strong>ARC-AGI-2</strong> 测试中，它也跑出了 <strong>45.1%</strong> 的成绩，直接把Gemini 3 Pro（31.1%）和GPT-5.1（17.6%）甩在了身后。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-05_22.16.47.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-05_22.16.47.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96ce18d723014dbfa10bd718c7ceb411~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765549411&amp;x-signature=N2%2FUQZr2mACutYhWuIGf03RfaMs%3D" alt="iShot_2025-12-05_22.16.47" loading="lazy"/></a></p>
<h3 data-id="heading-2">谁会为昂贵的“思考”买单？</h3>
<p>回到价格问题，249.99美元的月费注定它不是给普通用户拿来写邮件或查菜谱的。</p>
<p>Deep Think 的目标用户非常清晰：那些需要处理<strong>严肃问题</strong>的人。</p>
<p>想象一下，你是一个正在攻克新材料配方的科研人员，或者是一个需要对数千个变量进行风险评估的金融分析师。你需要的不是一段通顺的文字，而是一个逻辑严密、经过多重验证的推导过程。Deep Think 能够在几分钟内完成人类专家可能需要几天才能完成的逻辑验证，这才是它昂贵订阅费背后的真实价值。</p>
<p>谷歌这次其实也是在赌。它赌的是，AI的下一个阶段，将从“生成内容”转向“解决问题”。</p>
<h3 data-id="heading-3">写在最后</h3>
<p>Gemini 3 Deep Think 的出现，某种程度上也是对OpenAI的一次“截胡”。当对手还在实验室里打磨同类产品时，谷歌直接把它推向了市场。</p>
<p>虽然目前它还有不少限制——比如生成答案需要数分钟的等待，比如高昂的算力成本导致的订阅门槛——但这标志着我们终于跨过了一个门槛：AI不再仅仅是模仿人类说话，它开始模仿人类思考。</p>
<p>对于整个行业来说，这场关于“推理能力”的军备竞赛，才刚刚开始。而对于我们普通人来说，或许要开始习惯这样一种未来：当你向电脑提问时，它不再是秒回，而是沉思片刻，然后给出一个连你自己都未曾设想过的完美证明。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别抽卡玄学：Seedream 4.5 如何终结AI绘图的一致性噩梦]]></title>    <link>https://juejin.cn/post/7580183671531831334</link>    <guid>https://juejin.cn/post/7580183671531831334</guid>    <pubDate>2025-12-05T14:34:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580183671531831334" data-draft-id="7580183671531814950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别抽卡玄学：Seedream 4.5 如何终结AI绘图的一致性噩梦"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-05T14:34:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别抽卡玄学：Seedream 4.5 如何终结AI绘图的一致性噩梦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T14:34:12.000Z" title="Fri Dec 05 2025 14:34:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你也是一名被Midjourney或是Stable Diffusion折磨过的AI创作者，那你一定经历过这种崩溃时刻：你好不容易“炼”出了一个完美的角色形象，光影绝佳，眼神到位。但当你试图让这个角色换个姿势，或者走进下一个场景时，由于AI那不可控的随机性，原来的主角突然“整容”了——要么五官乱飞，要么气质大变。</p>
<p>为了保持角色一致性，我们不得不在此前花费大量时间去训练LoRA，或者在ControlNet里反复调试参数。</p>
<p>但就在2025年12月初，字节跳动旗下的火山引擎发布了Seedream 4.5，并迅速在LiblibAI平台上线。这一次，他们似乎真的要把AI绘画从“抽卡游戏”变成“生产力工具”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-05_22.24.54-1024x695.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-05_22.24.54-1024x695.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e26ecc1f20fe478db0ed7c7a8b5fd255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765550052&amp;x-signature=4D6hTdzHv7RPT3sdv5nvYTKGPSY%3D" alt="iShot_2025-12-05_22.24.54" loading="lazy"/></a></p>
<p><strong>不仅是画得好看，更是画得听话</strong></p>
<p>我们需要搞清楚这一波更新的核心逻辑。LiblibAI是一个聚合平台，相当于你的工作台；而Seedream 4.5则是这个台子上新装的一台强力发动机。</p>
<p>这台新发动机最吓人的地方在于它的“记忆力”和“理解力”。</p>
<p>在过去的模型中，多图融合往往是一场灾难。你给AI一张产品图，一张模特图，再加一张背景图，最后出来的结果大概率是缝合怪。但Seedream 4.5支持同时输入多达10张参考图。这意味着什么？这意味着你可以把衣服、配饰、模特长相、光影参考一股脑丢给它，它不仅能读懂，还能把这些元素像拼乐高一样，逻辑自洽地融合进一张图里。</p>
<p>对于做电商设计、做连载漫画的朋友来说，这简直是救命的功能。它解决了一个根本痛点：<strong>多图之间的一致性</strong>。你的角色在第一张图里穿的是复古皮衣，在第十张图里，这件皮衣的质感、褶皱甚至光泽依然能保持统一，而不是变成一件普通的黑色夹克。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fsadassdfg-1024x769.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/sadassdfg-1024x769.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09d8346e57b845d98522177cf8f20795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765550052&amp;x-signature=w3Z0U%2Fzuk7clD1gklKlOTtOVcFg%3D" alt="sadassdfg" loading="lazy"/></a></p>
<p><strong>终于能看懂中文甲方的需求了</strong></p>
<p>作为国产大模型，Seedream 4.5自带的“种族天赋”就是对中文语境的理解。</p>
<p>我们都知道，用英文提示词去描述“五彩斑斓的黑”或者“赛博朋克风的成都夜景”总有一层隔膜。Seedream 4.5不仅能精准理解这些复杂的中文美学指令，更关键的是，它解决了AI绘画的阿喀琉斯之踵——文字渲染。</p>
<p>以前我们用AI做海报，图生好后得去PS里把AI鬼画符一样的乱码修掉，再重新排版。现在，Seedream 4.5可以直接生成清晰、排版规整的中英文字符。它可以直接产出带有正确Logo和文案的商业级海报。虽然还不能完全替代资深设计师的精修，但对于快速出图的运营需求来说，这已经是质的飞跃。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-05_22.26.24-1024x680.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-05_22.26.24-1024x680.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/698a4d992ee440f5942bf03e3441d4b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765550052&amp;x-signature=ZZGKmf6oOE97qRbCryOIDoDxOoo%3D" alt="iShot_2025-12-05_22.26.24" loading="lazy"/></a></p>
<p><strong>为什么是LiblibAI？</strong></p>
<p>可能会有人问，既然是字节的模型，为什么要在LiblibAI上用？</p>
<p>因为工作流。</p>
<p>单纯的一个模型，只是一个大脑。而在LiblibAI这个平台上，Seedream 4.5不仅是一个选项，它可以配合平台上的修图、放大、视频生成等一整套工具链使用。对于不想折腾本地部署、显卡配置不够的创作者来说，这里提供了一个“开箱即用”的环境。你可以在这里快速对比Seedream 4.5和其他模型（比如MJ V7）的效果，找到最适合你当前项目的那个解。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-05_22.26.20.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-05_22.26.20.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da83f0fd08cc46aba28f5e0f3d5826b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765550052&amp;x-signature=uS21aJiPPNT0pBYO7ZvZHDsLdmY%3D" alt="iShot_2025-12-05_22.26.20" loading="lazy"/></a></p>
<p><strong>总结</strong></p>
<p>Seedream 4.5的出现，标志着AI绘图正在从“看运气”的艺术创作，向“可控”的工业生产迈进。</p>
<p>它不再只是让你感叹“哇，画得真像照片”，而是让你在接到甲方需求——比如“我要一套风格统一、模特固定、文案清晰的节日海报”时，能底气十足地打开电脑，而不是在心里默默祈祷这次生成的随机数能给点力。</p>
<p>如果你受够了角色“变脸”，或者厌倦了无休止的修字工作，现在的Seedream 4.5，绝对值得你去LiblibAI上试一试。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[初学者入门：用 go-kratos-admin + protoc-gen-typescript-http 快速搭建企业级 Admin 系统]]></title>    <link>https://juejin.cn/post/7580197740962758682</link>    <guid>https://juejin.cn/post/7580197740962758682</guid>    <pubDate>2025-12-05T14:40:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580197740962758682" data-draft-id="7580180556984156210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="初学者入门：用 go-kratos-admin + protoc-gen-typescript-http 快速搭建企业级 Admin 系统"/> <meta itemprop="keywords" content="后端,Go,TypeScript"/> <meta itemprop="datePublished" content="2025-12-05T14:40:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            初学者入门：用 go-kratos-admin + protoc-gen-typescript-http 快速搭建企业级 Admin 系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T14:40:57.000Z" title="Fri Dec 05 2025 14:40:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">初学者入门：用 go-kratos-admin + protoc-gen-typescript-http 快速搭建企业级 Admin 系统</h2>
<p>作为后端开发者，你是否曾为前后端接口联调头疼？作为前端新手，是否觉得手动封装 Rest 接口繁琐又容易出错？今天就给大家推荐一套 "效率组合拳"——go-kratos-admin（开箱即用的全栈 Admin 框架）+ protoc-gen-typescript-http（Protobuf 驱动的 TS 接口生成器），让你从零到一快速搭建企业级管理系统，还能自动生成类型安全的前端接口，生产力直接翻倍！</p>
<h3 data-id="heading-1">一、先搞懂：这两个工具到底是什么？</h3>
<p>在动手之前，我们先简单理清核心工具的定位，避免盲目上手：</p>
<h4 data-id="heading-2">1. go-kratos-admin：全栈 Admin 的 "脚手架王者"</h4>
<p>它是一个基于 Go 微服务框架<strong>go-kratos</strong>和 Vue3 框架<strong>Vben Admin</strong>开发的前后端分离项目，主打 "开箱即用"。后端集成了用户管理、租户管理、权限控制等企业级必备功能，前端自带美观的管理界面和交互逻辑，不用你从零搭建项目结构、设计数据库表、开发基础功能，相当于直接拿到一个 "半成品"Admin 系统，你只需专注业务开发。</p>
<p>核心优势：</p>
<ul>
<li>后端：<code>Golang</code> + <code>go-kratos</code> + <code>ent/gorm</code>，支持多租户、数据权限、动态 API 等企业级特性</li>
<li>前端：<code>Vue3</code> + <code>TypeScript</code> + <code>Antdv</code> + <code>Vben Admin</code>，界面美观、组件丰富</li>
<li>部署灵活：支持单体架构开发 / 部署，新手也不用纠结微服务复杂度</li>
<li>功能齐全：内置用户、角色、组织、任务调度、文件管理等 17 + 核心模块</li>
</ul>
<h4 data-id="heading-3">2. protoc-gen-typescript-http：接口生成的 "效率神器"</h4>
<p>这是 go-kratos 生态下的 TypeScript 代码生成器，核心作用是<strong>根据 Protobuf 文件自动生成前端 Rest 接口客户端和类型定义</strong>。简单说，后端只要定义好 Protobuf 接口协议，前端就能直接拿到可调用的 TS 代码，不用手动写 axios 请求、不用反复核对接口参数、不用维护类型定义，彻底解决前后端接口联调的 "沟通成本" 和 "手写错误"。</p>
<p>核心优势：</p>
<ul>
<li>类型安全：生成的 TS 类型与后端完全对齐，避免类型不匹配问题</li>
<li>自动封装：直接生成可调用的服务客户端，不用手动写请求函数</li>
<li>协议驱动：基于 Protobuf 定义接口，前后端遵循统一标准，减少分歧</li>
<li>无缝集成：与 go-kratos 天然兼容，完美适配 go-kratos-admin 的后端架构</li>
</ul>
<h3 data-id="heading-4">二、环境准备：一步到位搭好开发环境</h3>
<p>工欲善其事，必先利其器。我们先把基础环境配齐，这里以 Ubuntu 系统为例（Windows/Mac 步骤类似，可参考官方文档）：</p>
<h4 data-id="heading-5">1. 必备基础软件</h4>
<ul>
<li><strong>Git</strong>：版本控制工具（默认多数系统已安装）</li>
<li><strong>Docker</strong>：容器化部署依赖（用于启动数据库、缓存等中间件）</li>
<li><strong>Golang 1.20+</strong>：后端开发环境</li>
<li><strong>Node.js 16+ &amp; pnpm</strong>：前端开发环境（pnpm 比 npm/yarn 更快）</li>
<li><strong>Protobuf 编译器（protoc）</strong>：用于解析.proto 文件（生成 TS 接口依赖）</li>
</ul>
<p>安装命令参考（Ubuntu）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装Docker</span>
sudo apt-get update &amp;&amp; sudo apt-get install docker-ce docker-ce-cli containerd.io

<span class="hljs-comment"># 安装Golang（可参考官方脚本）</span>
curl -fsSL https://raw.githubusercontent.com/tx7do/go-kratos-admin/main/backend/script/prepare_ubuntu.sh | bash

<span class="hljs-comment"># 安装Node.js和pnpm</span>
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
npm install -g pnpm

<span class="hljs-comment"># 安装Protobuf编译器</span>
sudo apt-get install -y protobuf-compiler
</code></pre>
<h4 data-id="heading-6">2. 安装核心工具</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装TS接口生成器</span>
go install github.com/go-kratos/protoc-gen-typescript-http@latest
</code></pre>
<h3 data-id="heading-7">三、快速上手：30 分钟搭建可运行的 Admin 系统</h3>
<p>接下来我们一步步搭建项目，从拉取代码到启动系统，再到生成第一个 TS 接口：</p>
<h4 data-id="heading-8">步骤 1：拉取 go-kratos-admin 项目</h4>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/tx7do/go-kratos-admin.git
<span class="hljs-comment"># 如果只能访问内网则拉取：git clone https://gitee.com/tx7do/go-kratos-admin.git</span>
<span class="hljs-built_in">cd</span> go-kratos-admin
</code></pre>
<h4 data-id="heading-9">步骤 2：启动后端服务（含依赖中间件）</h4>
<p>go-kratos-admin 提供了 Makefile 脚本，一键启动所有依赖（数据库、Redis 等）和后端服务：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入后端目录</span>
<span class="hljs-built_in">cd</span> backend

<span class="hljs-comment"># 初始化依赖、构建Docker镜像、启动服务</span>
make init
make docker
make compose-up
</code></pre>
<p>启动成功后，后端服务默认运行在<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A7788" target="_blank" title="http://localhost:7788" ref="nofollow noopener noreferrer">http://localhost:7788</a>，可以访问<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A7788%2Fdocs" target="_blank" title="http://localhost:7788/docs" ref="nofollow noopener noreferrer">http://localhost:7788/docs</a>查看 Swagger 接口文档，默认账号密码都是<code>admin</code>。</p>
<h4 data-id="heading-10">步骤 3：启动前端项目</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 回到项目根目录，进入前端目录</span>
<span class="hljs-built_in">cd</span> ../frontend

<span class="hljs-comment"># 安装依赖（pnpm速度更快）</span>
pnpm install

<span class="hljs-comment"># 启动开发模式（默认端口5666）</span>
pnpm dev
</code></pre>
<p>打开浏览器访问<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5666" target="_blank" title="http://localhost:5666" ref="nofollow noopener noreferrer">http://localhost:5666</a>，用<code>admin</code>/<code>admin</code>登录，就能看到完整的 Admin 系统界面，包含用户管理、租户管理等所有内置功能。</p>
<h4 data-id="heading-11">步骤 4：用 protoc-gen-typescript-http 生成 TS 接口</h4>
<p>这一步是核心！我们以 "用户管理接口" 为例，演示如何自动生成 TS 客户端：</p>
<h5 data-id="heading-12">4.1 找到后端 Protobuf 定义</h5>
<p>go-kratos-admin 的接口协议都放在backend/api目录下，比如用户管理的 Proto 文件backend/api/admin/v1/i_user.proto，里面定义了查询用户、创建用户等接口，关键部分如下：</p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";

package admin.service.v1;

import "google/api/annotations.proto"; // 引入http注解依赖

import "pagination/v1/pagination.proto"; // 分页请求

import "user/service/v1/user.proto";

// 用户管理服务
service UserService {
  // 获取用户列表
  rpc List (pagination.PagingRequest) returns (user.service.v1.ListUserResponse) {
    option (redact.v3.internal_method) = true;
    option (google.api.http) = {
      get: "/admin/v1/users" // 绑定HTTP GET请求
    };
  }

  // 获取用户数据
  rpc Get (user.service.v1.GetUserRequest) returns (user.service.v1.User) {
    option (redact.v3.internal_method) = true;
    option (google.api.http) = {
      get: "/admin/v1/users/{id}" // 绑定HTTP GET请求
      additional_bindings {
        get: "/admin/v1/users/username/{user_name}" // 绑定HTTP GET请求
      }
    };
  }

  // 创建用户
  rpc Create (user.service.v1.CreateUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/admin/v1/users" // 绑定HTTP POST请求
      body: "*"
    };
  }

  // 更新用户
  rpc Update (user.service.v1.UpdateUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/admin/v1/users/{data.id}" // 绑定HTTP PUT请求
      body: "*"
    };
  }

  // 删除用户
  rpc Delete (user.service.v1.DeleteUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/admin/v1/users/{id}" // 绑定HTTP DELETE请求
    };
  }
}
</code></pre>
<h5 data-id="heading-13">4.2 生成 TS 接口代码</h5>
<p>在后端服务的目录下<code>backend\app\admin\service</code>下执行Make命令：</p>
<pre><code class="hljs language-bash" lang="bash">make ts
</code></pre>
<p>执行成功后，该命令将会在<code>frontend\apps\admin\src\generated\api\admin\service\v1</code>目录下生成<code>index.ts</code>文件，里面包含：</p>
<ul>
<li>所有消息类型的 TS 接口（如<code>CreateUserRequest</code>、<code>User</code>...）</li>
<li>自动封装的服务客户端接口（<code>createUserServiceClient</code>）</li>
<li>可直接调用的接口方法（<code>List</code>、<code>Get</code>、<code>Create</code>、<code>Update</code>...）</li>
</ul>
<h5 data-id="heading-14">4.3 前端项目中使用生成的接口</h5>
<p>TS代码生成器生成的代码，本身不提供请求的实现，需要自己去实现<code>RequestHandler</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// frontend/apps/admin/src/utils/request.ts</span>

<span class="hljs-comment">/**
 * 通用请求处理器
 * <span class="hljs-doctag">@param</span> path 访问路径
 * <span class="hljs-doctag">@param</span> method 方法
 * <span class="hljs-doctag">@param</span> body 访问内容
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">requestClientRequestHandler</span>(<span class="hljs-params">{ path, method, body }: Request</span>) {
  <span class="hljs-keyword">return</span> requestClient.<span class="hljs-title function_">request</span>(path, {
    method,
    <span class="hljs-attr">data</span>: body,
  } <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);
}
</code></pre>
<p>然后就可以开始在前端组件中开始调用接口了，在<code>go-kratos-admin</code>当中，所有的接口调用都放在了pinia的状态管理当中，我们以用户服务为例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// frontend/apps/admin/src/stores/user.state.ts</span>

<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>;

<span class="hljs-keyword">import</span> { requestClientRequestHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/utils/request'</span>;

<span class="hljs-keyword">import</span> { createUserServiceClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/generated/api/admin/service/v1'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> service = <span class="hljs-title function_">createUserServiceClient</span>(requestClientRequestHandler);

  <span class="hljs-comment">/**
   * 查询用户列表
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">listUser</span>(<span class="hljs-params">
    noPaging: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>,
    page?: <span class="hljs-literal">null</span> | <span class="hljs-built_in">number</span>,
    pageSize?: <span class="hljs-literal">null</span> | <span class="hljs-built_in">number</span>,
    formValues?: <span class="hljs-literal">null</span> | <span class="hljs-built_in">object</span>,
    fieldMask?: <span class="hljs-literal">null</span> | <span class="hljs-built_in">string</span>,
    orderBy?: <span class="hljs-literal">null</span> | <span class="hljs-built_in">string</span>[],
  </span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> service.<span class="hljs-title class_">List</span>({
      <span class="hljs-comment">// @ts-ignore proto generated code is error.</span>
      fieldMask,
      <span class="hljs-attr">orderBy</span>: orderBy ?? [],
      <span class="hljs-attr">query</span>: <span class="hljs-title function_">makeQueryString</span>(formValues ?? <span class="hljs-literal">null</span>),
      page,
      pageSize,
      noPaging,
    });
  }

  <span class="hljs-comment">/**
   * 获取用户
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> service.<span class="hljs-title class_">Get</span>({ id });
  }

  <span class="hljs-comment">/**
   * 创建用户
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">values: <span class="hljs-built_in">object</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> service.<span class="hljs-title class_">Create</span>({
      <span class="hljs-comment">// @ts-ignore proto generated code is error.</span>
      <span class="hljs-attr">data</span>: {
        ...values,
      },
      <span class="hljs-comment">// @ts-ignore proto generated code is error.</span>
      <span class="hljs-attr">password</span>: values.<span class="hljs-property">password</span> ?? <span class="hljs-literal">null</span>,
    });
  }

  <span class="hljs-comment">/**
   * 更新用户
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, values: <span class="hljs-built_in">object</span></span>) {
    <span class="hljs-keyword">const</span> updateMask = <span class="hljs-title function_">makeUpdateMask</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(values ?? []));
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> service.<span class="hljs-title class_">Update</span>({
      <span class="hljs-comment">// @ts-ignore proto generated code is error.</span>
      <span class="hljs-attr">data</span>: {
        id,
        ...values,
      },
      <span class="hljs-comment">// @ts-ignore proto generated code is error.</span>
      <span class="hljs-attr">password</span>: values.<span class="hljs-property">password</span> ?? <span class="hljs-literal">null</span>,
      <span class="hljs-comment">// @ts-ignore proto generated code is error.</span>
      updateMask,
    });
  }

  <span class="hljs-comment">/**
   * 删除用户
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> service.<span class="hljs-title class_">Delete</span>({ id });
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">$reset</span>(<span class="hljs-params"/>) {}

  <span class="hljs-keyword">return</span> {
    $reset,
    listUser,
    getUser,
    createUser,
    updateUser,
    deleteUser,
  };
});
</code></pre>
<p>最后，我们就可以在前端界面组件当中调用状态管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/stores'</span>;

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>();

<span class="hljs-comment">// 查询用户列表（直接调用生成的方法，自动带类型提示）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUserList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> userStore.<span class="hljs-title class_">List</span>({
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">pageSize</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 类型提示自动补全，错误类型会报错</span>
  });
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'用户列表：'</span>, res.<span class="hljs-property">items</span>);
};

<span class="hljs-comment">// 页面加载时调用</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchUserList</span>();
});
</code></pre>
<p>此时你会发现：</p>
<ul>
<li>输入参数时，VS Code 会自动提示可选字段（如 page、pageSize）</li>
<li>类型错误时（如传入字符串 "20" 而非数字 20），TS 会直接报错</li>
<li>响应结果自动带有类型定义，不用手动声明接口返回格式</li>
</ul>
<h3 data-id="heading-15">四、核心优势：为什么推荐初学者用这套组合？</h3>
<ol>
<li><strong>降低入门门槛</strong>：<code>go-kratos-admin</code> 提供现成的 Admin 系统骨架，不用从零学微服务、权限设计、前端布局，新手也能快速出活</li>
<li><strong>提升开发效率</strong>：<code>protoc-gen-typescript-http</code> 自动生成接口代码，前后端只需维护 Protobuf 协议，不用手动写请求、不用反复联调接口参数</li>
<li><strong>类型安全保障</strong>：TS 类型与后端 Protobuf 完全对齐，避免生产环境因类型不匹配导致的 bug</li>
<li><strong>可扩展性强</strong>：后续新增接口时，只需修改 Protobuf 文件，重新执行生成命令，前端直接调用新方法，迭代速度极快</li>
<li><strong>企业级特性内置</strong>：go-kratos-admin 自带多租户、数据权限、任务调度等企业级功能，后续项目升级不用重构架构</li>
</ol>
<h3 data-id="heading-16">五、常见问题与避坑指南</h3>
<h4 data-id="heading-17">1. 生成 TS 代码时提示 "google/api/annotations.proto not found"：</h4>
<p>解决方案：进入<code>backend\api</code>，执行<code>buf dep update</code>命令。</p>
<h4 data-id="heading-18">2. IDE中提示找不到 "google/api/annotations.proto"：</h4>
<p>解决方案：安装IDE的<code>Buf</code>插件即可。</p>
<h4 data-id="heading-19">2. 前端调用接口提示 401 未授权：</h4>
<p>解决方案：登录后，从 <code>localStorage</code> 获取 token，在请求头中携带 <code>Authorization</code> 字段</p>
<h4 data-id="heading-20">3. Protobuf 文件修改后，TS 代码不更新：</h4>
<p>解决方案：重新执行 <code>make ts</code> 生成命令，覆盖旧的 TS 文件即可</p>
<h4 data-id="heading-21">4. Docker 启动失败：</h4>
<p>解决方案：检查 Docker 是否正在运行（<code>sudo systemctl start docker</code>），确保端口 8080、7788、5666 未被占用</p>
<h3 data-id="heading-22">六、总结与下一步学习建议</h3>
<p>通过 go-kratos-admin + protoc-gen-typescript-http 的组合，我们用最少的代码搭建了一个带有用户管理功能、类型安全的 Admin 系统。对于初学者来说，这套组合的核心价值是 "避开重复劳动，专注核心业务"。</p>
<p>下一步可以尝试：</p>
<p>新增一个 "产品管理" 接口：在 <code>backend/api/protos</code> 下创建 proto 文件，定义 CRUD 接口，生成 TS 代码并在前端调用
自定义租户套餐：利用 <code>go-kratos-admin</code> 的租户管理功能，配置不同的权限套餐
部署到测试环境：通过<code>make docker</code>构建镜像，部署到服务器（支持 Docker Compose 一键部署）</p>
<p>如果你在使用过程中遇到问题，可以参考：</p>
<ul>
<li><code>go-kratos-admin</code> 官方文档：项目根目录的 <code>README.md</code>（支持中、英、日三种语言）</li>
<li><code>protoc-gen-typescript-http</code> 示例：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgo-kratos%2Fprotoc-gen-typescript-http%2Ftree%2Fmain%2Fexamples" target="_blank" title="https://github.com/go-kratos/protoc-gen-typescript-http/tree/main/examples" ref="nofollow noopener noreferrer">github.com/go-kratos/p…</a></li>
<li>社区支持：添加微信<code>yang_lin_bo</code>（备注 <code>go-kratos-admin</code>），加入交流群</li>
</ul>
<p>这套组合不仅适合初学者快速上手企业级项目，也是很多中小型公司的生产环境选择。赶紧动手试试，体验 "协议驱动开发" 带来的效率提升吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手教你用Claude制作专属PPT生成器-从模板学习到自动生成全流程实战]]></title>    <link>https://juejin.cn/post/7580198093154123822</link>    <guid>https://juejin.cn/post/7580198093154123822</guid>    <pubDate>2025-12-05T13:10:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580198093154123822" data-draft-id="7580180556983599154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手教你用Claude制作专属PPT生成器-从模板学习到自动生成全流程实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-05T13:10:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwzhouhui"/> <meta itemprop="url" content="https://juejin.cn/user/3428746411400537"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手教你用Claude制作专属PPT生成器-从模板学习到自动生成全流程实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3428746411400537/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwzhouhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T13:10:29.000Z" title="Fri Dec 05 2025 13:10:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常工作中，制作PPT一直是让很多小伙伴头疼的事情。特别是年底了，各种工作总结、项目汇报、述职报告接踵而来，每次都要花费大量时间在调整排版、优化设计、填充内容上。更让人抓狂的是，即使花了几个小时，做出来的PPT还是千篇一律，缺少亮点。如果能有一个工具，既能学习我们已有的PPT模板风格，又能根据内容自动生成符合这种风格的新PPT，那该多好啊！</p>
<p>今天要给大家介绍的这个开源项目 ppt-generator-skill 就是为了解决这个痛点而诞生的。这个项目最大的特点就是可以"学习"你现有的PPT模板，提取配色方案、布局风格、字体规范等特征，然后生成符合你风格的新PPT。配合 Skill_Seekers 工具和 Claude Code，我们可以把整个流程打造成一个可复用的Skills技能包，以后只需要一句提示词，就能自动生成25页标准结构的专业PPT！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dbd1bf337f041d7a3ff5093b3f3b3cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=u5NKElrihHasGyGtJSj9mcBsFmo%3D" alt="PPT示例" loading="lazy"/></p>
<p>ppt-generator-skill 通过智能分析现有PPT模板，自动提取设计规范并生成符合标准的新演示文稿，实现了从"重复劳动"到"智能创作"的跨越。这2天这个项目非常火爆，今天我们就手把手教大家如何制作和使用这个PPT生成器Skills，体验和感受一下AI辅助办公的强大能力。</p>
<h2 data-id="heading-1">✨ 项目介绍</h2>
<h3 data-id="heading-2">核心特性</h3>
<p>ppt-generator-skill 是一个基于 Python 的 PPT 自动生成工具，具有以下核心特性：</p>
<ul>
<li><strong>🎨 智能模板学习</strong>：通过分析现有PPT，自动提取配色方案、布局风格、字体规范</li>
<li><strong>📋 标准化结构</strong>：自动生成25页标准商务演示结构（封面、目录、4章节、结尾页等）</li>
<li><strong>🎯 多主题支持</strong>：内置商务简约、暖色调、莫兰迪色系三种主题风格</li>
<li><strong>⚙️ 灵活配置</strong>：支持JSON配置文件，可快速调整内容和样式</li>
<li><strong>🤖 Claude集成</strong>：可作为Claude Code的Skills使用，实现AI驱动的PPT生成</li>
<li><strong>🔄 可复用性强</strong>：一次制作，终身使用，所有同类型PPT都能快速生成</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91ed0ab9f66d4010a0cbf796b04d6f75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=%2BQiTRZgXdrCeUGHj0i1A9rZaCe8%3D" alt="image-20251205175612387" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa0e8ff776454d6bb68d4d4af10b7694~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=gDDeWRqW7VsswIRxc8w5xNjRrLc%3D" alt="image-20251205175629632" loading="lazy"/></p>
<h3 data-id="heading-3">🛠️ 技术栈</h3>
<h4 data-id="heading-4">核心技术</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e30506307614cf18044954f3c91e163~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=7CVWvyBk9lCRUPhYe0Wkv%2B2J0Vg%3D" alt="image-20251205175904368" loading="lazy"/></p>
<h4 data-id="heading-5">标准化结构设计</h4>
<p>项目采用固定的25页标准结构，确保演示的完整性和规范性：</p>
<ul>
<li>第1页：封面（标题、副标题、年份）</li>
<li>第2页：目录页</li>
<li>第3-7页：第一章节（1页过渡+4页内容）</li>
<li>第8-12页：第二章节（1页过渡+4页内容）</li>
<li>第13-17页：第三章节（1页过渡+4页内容）</li>
<li>第18-22页：第四章节（1页过渡+4页内容）</li>
<li>第23页：结束页</li>
<li>第24页：字体说明</li>
<li>第25页：版权声明</li>
</ul>
<h3 data-id="heading-6">🎯 应用场景</h3>
<ul>
<li><strong>年度工作总结</strong>: 年度概况 → 重点项目 → 数据成果 → 明年计划</li>
<li><strong>项目汇报</strong>: 项目背景 → 实施方案 → 进展情况 → 后续计划</li>
<li><strong>产品发布</strong>: 市场分析 → 产品功能 → 竞争优势 → 推广计划</li>
<li><strong>业务复盘</strong>: 业务回顾 → 问题分析 → 改进措施 → 未来展望</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b353c65ea4b64a3bad98024eeb295d88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=EQ0wIAlEYIXanx3WT5FkRH%2BCLJM%3D" alt="image-20251205175717558" loading="lazy"/></p>
<h2 data-id="heading-7">🚀 部署实战</h2>
<p>好了，话不多说，接下来我们就手把手教大家如何制作这个PPT生成器Skills。整个流程分为两大部分：<strong>制作Skills</strong>和<strong>验证测试</strong>。</p>
<h3 data-id="heading-8">第一部分：制作PPT Skills</h3>
<h4 data-id="heading-9">3.1 准备PPT模板</h4>
<p>首先我们需要准备几个自己喜欢的PPT模板。这些模板将作为"学习样本"，系统会分析它们的配色方案、页面布局、字体规范、内容组织结构等特征。</p>
<p>我这里准备了3个不同风格的PPT模板，分别代表了不同的应用场景：</p>
<ul>
<li><code>11.pptx</code>：年终总结风格</li>
<li><code>22.pptx</code>：工作述职风格</li>
<li><code>33.pptx</code>：莫兰迪色系风格</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/208147e1554a4267a8109c0710d284b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=ySIdHORxLlYP3Dc7KsflXHe0NkQ%3D" alt="准备PPT模板" loading="lazy"/></p>
<p>为了方便操作，我把这3个PPT文件重命名为简单的名字（11.pptx、22.pptx、33.pptx），放在同一个文件夹中。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3151ae3939434a1281ca597b0358c72d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=crin%2Bm5dceAiiCzw%2B3O2tySbmM4%3D" alt="重命名PPT文件" loading="lazy"/></p>
<h4 data-id="heading-10">3.2 安装Skill_Seekers</h4>
<p>接下来我们需要安装 Skill_Seekers 工具。这是一个强大的Skills生成框架，可以帮助我们将PPT生成能力封装成可复用的Claude Skills。</p>
<p>Skill_Seekers 的 GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyusufkaraaslan%2FSkill_Seekers" target="_blank" title="https://github.com/yusufkaraaslan/Skill_Seekers" ref="nofollow noopener noreferrer">github.com/yusufkaraas…</a></p>
<p>在shell窗口中执行以下命令安装：</p>
<pre><code class="hljs language-shell" lang="shell">pip install skill-seekers
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c564564921842bdb3ce422c3e0927e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=H9%2BIhMhl7KpgfZE5tWqgv0bXa%2Fw%3D" alt="安装Skill_Seekers" loading="lazy"/></p>
<p>安装完成后，我们验证一下是否可以正常使用。运行以下命令检查：</p>
<pre><code class="hljs language-shell" lang="shell">skill-seekers --version
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21bbcf3c4d92491dad8a930b1fe6bc64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=eGnF3TsLLJNRQHq2NrIoberkb%2Fw%3D" alt="验证安装" loading="lazy"/></p>
<p>看到版本信息就说明安装成功了，可以进入下一步了。</p>
<h4 data-id="heading-11">3.3 使用Skill_Seekers生成PPT Skills</h4>
<p>现在进入 Claude Code 运行环境，这是最关键的一步。我们要让AI自动分析PPT模板，并生成Skills技能包。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f043bd689404e098b28d51b205adc7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=NDrS1sx1btT30MmaXmRP4gm6Rgc%3D" alt="进入Claude Code" loading="lazy"/></p>
<p>在Claude Code中输入以下提示词：</p>
<pre><code class="hljs language-arduino" lang="arduino">请认真阅读<span class="hljs-string">"11.pptx、22.pptx、33.pptx"</span> 这<span class="hljs-number">3</span>个pptX相关内容和PPT目录结构和PPT风格，
接下来请使用skill-seekers 这个skills技能把生成一个基于上述几个PPT模版特点的PPT skills技能。
之后我们写其他材料调用这个skills就可以实现生成符合这个特点的PPT了。
请基于上面要求制作skills并生成输出当前文件夹目录
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4096ae6c33ce42c3861eaeda5b5ea201~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=GCItonIolFSoIEO5egtOwtl0UG0%3D" alt="输入提示词" loading="lazy"/></p>
<p>执行这个提示词后，Claude会开始工作，整个过程非常智能：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acd2fd98f85c4edcac128b485aa3cc7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=76QkwKoq24SxJCsDYfBxGibDMIg%3D" alt="AI开始工作" loading="lazy"/></p>
<p><strong>第一步：AI自动编写分析脚本</strong></p>
<p>Claude首先会编写一个 <code>analyze_ppt.py</code> 脚本来分析PPT模板的特征。这个脚本会：</p>
<ul>
<li>读取每个PPT文件的结构</li>
<li>提取配色方案</li>
<li>分析布局模式</li>
<li>识别字体使用规范</li>
<li>统计页面类型和元素分布</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfccfd4fc48848c2a9cb8e9f8d8215bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=uQxi1ucL4UWO6d1HxK2cCpej35I%3D" alt="AI编写分析脚本" loading="lazy"/></p>
<p><strong>第二步：生成Skills目录结构</strong></p>
<p>分析完成后，Claude会根据提取的特征生成完整的Skills目录结构。初步生成的目录如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19513861e34d4fa2a2d07cd3c2719373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=OlegxlfqzUOOlbC4QeOcbHUyEq4%3D" alt="image-20251205175757354" loading="lazy"/></p>
<p>整个Skills包包含以下核心文件：</p>
<pre><code class="hljs language-bash" lang="bash">ppt-generator-skill/
├── .claude/
│   └── skills/
│       └── ppt-generator.md      <span class="hljs-comment"># Claude Skills定义文件</span>
├── 11.pptx                        <span class="hljs-comment"># 参考模板1</span>
├── 22.pptx                        <span class="hljs-comment"># 参考模板2</span>
├── 33.pptx                        <span class="hljs-comment"># 参考模板3</span>
├── analyze_ppt.py                 <span class="hljs-comment"># PPT分析工具</span>
├── ppt_generator.py               <span class="hljs-comment"># 核心生成器</span>
├── config_template.json           <span class="hljs-comment"># 配置模板</span>
├── INSTALL.md                     <span class="hljs-comment"># 安装说明</span>
└── README.md                      <span class="hljs-comment"># 项目文档</span>
</code></pre>
<p><strong>第三步：生成核心代码</strong></p>
<p>Claude会自动生成完整的 <code>ppt_generator.py</code> 核心生成器代码，包含：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pptx <span class="hljs-keyword">import</span> Presentation
<span class="hljs-keyword">from</span> pptx.util <span class="hljs-keyword">import</span> Inches, Pt
<span class="hljs-keyword">from</span> pptx.enum.text <span class="hljs-keyword">import</span> PP_ALIGN
<span class="hljs-keyword">from</span> pptx.dml.color <span class="hljs-keyword">import</span> RGBColor

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PPTGenerator</span>:
    <span class="hljs-string">"""PPT生成器核心类"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, theme=<span class="hljs-string">"商务简约"</span></span>):
        self.theme = theme
        self.prs = Presentation()
        self.setup_theme()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_theme</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""设置主题配色方案"""</span>
        self.color_schemes = {
            <span class="hljs-string">"商务简约"</span>: {
                <span class="hljs-string">"primary"</span>: RGBColor(<span class="hljs-number">34</span>, <span class="hljs-number">87</span>, <span class="hljs-number">122</span>),
                <span class="hljs-string">"secondary"</span>: RGBColor(<span class="hljs-number">66</span>, <span class="hljs-number">135</span>, <span class="hljs-number">245</span>),
                <span class="hljs-string">"accent"</span>: RGBColor(<span class="hljs-number">245</span>, <span class="hljs-number">166</span>, <span class="hljs-number">35</span>),
                <span class="hljs-string">"text"</span>: RGBColor(<span class="hljs-number">51</span>, <span class="hljs-number">51</span>, <span class="hljs-number">51</span>),
                <span class="hljs-string">"light_bg"</span>: RGBColor(<span class="hljs-number">248</span>, <span class="hljs-number">249</span>, <span class="hljs-number">250</span>)
            },
            <span class="hljs-string">"暖色调"</span>: {
                <span class="hljs-string">"primary"</span>: RGBColor(<span class="hljs-number">215</span>, <span class="hljs-number">80</span>, <span class="hljs-number">50</span>),
                <span class="hljs-string">"secondary"</span>: RGBColor(<span class="hljs-number">240</span>, <span class="hljs-number">130</span>, <span class="hljs-number">70</span>),
                <span class="hljs-string">"accent"</span>: RGBColor(<span class="hljs-number">250</span>, <span class="hljs-number">200</span>, <span class="hljs-number">80</span>),
                <span class="hljs-string">"text"</span>: RGBColor(<span class="hljs-number">60</span>, <span class="hljs-number">60</span>, <span class="hljs-number">60</span>),
                <span class="hljs-string">"light_bg"</span>: RGBColor(<span class="hljs-number">255</span>, <span class="hljs-number">248</span>, <span class="hljs-number">240</span>)
            },
            <span class="hljs-string">"莫兰迪色系"</span>: {
                <span class="hljs-string">"primary"</span>: RGBColor(<span class="hljs-number">140</span>, <span class="hljs-number">140</span>, <span class="hljs-number">150</span>),
                <span class="hljs-string">"secondary"</span>: RGBColor(<span class="hljs-number">180</span>, <span class="hljs-number">170</span>, <span class="hljs-number">165</span>),
                <span class="hljs-string">"accent"</span>: RGBColor(<span class="hljs-number">200</span>, <span class="hljs-number">180</span>, <span class="hljs-number">150</span>),
                <span class="hljs-string">"text"</span>: RGBColor(<span class="hljs-number">80</span>, <span class="hljs-number">80</span>, <span class="hljs-number">80</span>),
                <span class="hljs-string">"light_bg"</span>: RGBColor(<span class="hljs-number">245</span>, <span class="hljs-number">242</span>, <span class="hljs-number">240</span>)
            }
        }

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_cover_slide</span>(<span class="hljs-params">self, title, subtitle, year</span>):
        <span class="hljs-string">"""添加封面页"""</span>
        <span class="hljs-comment"># 实现封面页生成逻辑</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_content_slide</span>(<span class="hljs-params">self, title, content_items</span>):
        <span class="hljs-string">"""添加内容页"""</span>
        <span class="hljs-comment"># 实现内容页生成逻辑</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_full_ppt</span>(<span class="hljs-params">self, config</span>):
        <span class="hljs-string">"""根据配置生成完整PPT"""</span>
        <span class="hljs-comment"># 实现完整PPT生成逻辑</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/478223b41a5149f681151438546c1ff7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=g9dkiq5QwDngoV0i%2BjosZJEj3tE%3D" alt="生成完整Skills" loading="lazy"/></p>
<p>整个生成过程大约需要3-5分钟，完全自动化，无需人工干预。生成完成后，我们就得到了一个完整的ppt-generator-skill技能包！呵呵，是不是非常简单？</p>
<h3 data-id="heading-12">第二部分：验证及测试</h3>
<h4 data-id="heading-13">3.4 安装Skills到Claude环境</h4>
<p>现在我们要把生成的Skills安装到Claude Code的Skills目录中。Claude Code会从 <code>~/.claude/skills/</code> 目录加载所有的Skills。</p>
<p>输入以下提示词让Claude帮我们安装：</p>
<pre><code class="hljs language-javascript" lang="javascript">请帮我把ppt-generator-skill.<span class="hljs-property">zip</span>解压安装到~<span class="hljs-regexp">/.claude/</span>skills/
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6b2135159c485fa28051ce996fdd78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=vD41Pl%2BZe5qZVGsf4UBfh3oqnR8%3D" alt="安装Skills" loading="lazy"/></p>
<p>安装完成后，我们检查一下 <code>~/.claude/skills/</code> 目录，确认Skills已经正确安装：</p>
<pre><code class="hljs language-shell" lang="shell">ls -la ~/.claude/skills/
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9965bba330a4d8f96335aea3c46a059~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=5pn6%2BETGTZKUvquIBtbsAUn%2B9yc%3D" alt="检查安装" loading="lazy"/></p>
<p>可以看到ppt-generator-skill已经出现在Skills目录中了，说明安装成功！</p>
<h4 data-id="heading-14">3.5 准备测试内容</h4>
<p>为了测试这个Skills的效果，我们需要准备一个测试用的内容大纲。我这里用豆包AI生成了一个"2025年度运维工作复盘与规划汇报"的PPT大纲，总共20页内容。</p>
<p>使用豆包的提示词：</p>
<pre><code class="hljs">我是个运维工程师，2025年马上就结束了，我希望对我2025年运维工作做一个盘点，
请帮我写一个PPT汇报2025年的运维工作先写一个PPT 大纲 总共20页， markdown格式文档输出
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f87cbbed18b84804abdfcc8920dc75c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=GdS5a2aH%2BLYt7QAOUjdka7b2e3o%3D" alt="豆包生成大纲" loading="lazy"/></p>
<p>生成完成后，把这个markdown文档下载下来：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b87c601d1aef4cfc9bf3fb2e4281b7a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=gv2cEyuwwhXfmsQ%2BDFRCk3ViNLs%3D" alt="下载大纲" loading="lazy"/></p>
<p>然后上传到我们的工作目录：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beaaacbe493c4de4a841c4f72c5cc21c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=QcRYgF2pmIj2z%2FpZFRlG2x4nhR8%3D" alt="上传大纲" loading="lazy"/></p>
<h4 data-id="heading-15">3.6 调用Skills生成PPT</h4>
<p>好家伙，所有准备工作都完成了！现在是见证奇迹的时刻。我们只需要一句简单的提示词，就能让Skills自动生成PPT：</p>
<pre><code class="hljs language-arduino" lang="arduino">请使用ppt-generator-skill 技能帮我把<span class="hljs-string">"2025年度运维工作复盘与规划汇报.md"</span>
做成<span class="hljs-number">2025</span>年度运维工作复盘与规划汇报.pptx并输出
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42cb8ba1efc546fbba32ff33b38f39ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=JnBpartIbLm4qu%2Fem2OQQAifBEY%3D" alt="调用Skills" loading="lazy"/></p>
<p>Claude会自动调用ppt-generator-skill，读取markdown大纲，按照我们之前学习的模板风格进行页面设计、排版和美化。整个过程大约需要3-5分钟，完全自动化！</p>
<h4 data-id="heading-16">3.7 查看生成效果</h4>
<p>生成完成后，我们打开PPT文件看看效果。哇，真的生成出来了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/108e9cf913f446febd7fcc637011a338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=duayCs%2BowsH83oKpIdwdOXdG%2BdY%3D" alt="打开PPT" loading="lazy"/></p>
<p>可以看到，生成的PPT确实是按照我们之前的模板风格来设计的：</p>
<ul>
<li>配色方案保持一致</li>
<li>布局规范统一</li>
<li>页面结构完整</li>
<li>25页标准结构</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43f390f19984b88ac25ade1a67939ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=GE6j6qQwRbTZNNEZiwaW9jeMOw4%3D" alt="查看PPT效果" loading="lazy"/></p>
<p>虽然生成的PPT可能还需要根据具体需求进行微调和补充细节，但基础框架已经非常完善了，大大节省了制作时间。通过对比来看效果不错，基本达到预期。呵呵是不是很简单？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f907f8a11b56457e9d81aa4be8bf1097~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765545029&amp;x-signature=jnLXazw7NmNin4qgAi2tuwwlCR4%3D" alt="最终效果" loading="lazy"/></p>
<p>上面这个模板比较简单，大家也可以根据自己的需要修改和补充这个Skills，添加更多的页面类型、更丰富的布局样式，打造完全属于自己的PPT生成器！</p>
<h3 data-id="heading-17">进阶使用方式</h3>
<p>除了通过Claude Code调用，这个项目还提供了三种使用方式：</p>
<h4 data-id="heading-18">方式一：直接运行示例</h4>
<pre><code class="hljs language-shell" lang="shell">python3 ppt_generator.py
</code></pre>
<p>直接生成内置示例"2025年度工作总结.pptx"，快速了解项目功能。</p>
<h4 data-id="heading-19">方式二：JSON配置文件</h4>
<p>创建自定义的配置文件 <code>my_ppt_config.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"项目汇报"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"subtitle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025年重点项目进展说明"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"year"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"theme"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"商务简约"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"chapters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"项目背景"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"项目发起背景和战略意义..."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"pages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"市场分析"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"市场现状"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"当前市场规模达到500亿，年增长率25%"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"用户需求"</span><span class="hljs-punctuation">,</span>
              <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"核心用户群体对产品的主要诉求分析"</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后运行：</p>
<pre><code class="hljs language-shell" lang="shell">python3 ppt_generator.py my_ppt_config.json
</code></pre>
<h4 data-id="heading-20">方式三：代码集成</h4>
<p>在你的Python项目中直接调用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> ppt_generator <span class="hljs-keyword">import</span> PPTGenerator

<span class="hljs-comment"># 创建生成器实例</span>
generator = PPTGenerator(theme=<span class="hljs-string">"商务简约"</span>)

<span class="hljs-comment"># 配置PPT内容</span>
config = {
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"年度工作总结"</span>,
    <span class="hljs-string">"subtitle"</span>: <span class="hljs-string">"2025年工作回顾与展望"</span>,
    <span class="hljs-string">"year"</span>: <span class="hljs-string">"2025"</span>,
    <span class="hljs-string">"chapters"</span>: [...]
}

<span class="hljs-comment"># 生成PPT</span>
generator.generate_full_ppt(config)
generator.save(<span class="hljs-string">"output.pptx"</span>)
</code></pre>
<p>这种方式适合集成到自动化工作流中，比如定期生成报表PPT、批量生成项目汇报等场景。</p>
<h2 data-id="heading-21">总结</h2>
<p>今天主要带大家了解并实现了 ppt-generator-skill 开源项目的完整制作和使用流程，该 PPT生成器 以"智能模板学习 + 自动化生成"为核心优势，结合 Claude Code Skills 技能框架需求，通过 Skill_Seekers 工具与 python-pptx 库，形成了一套从模板分析到成品输出的全链路智能生成解决方案。</p>
<p>通过这套实践方案，小伙伴们能够高效突破传统PPT制作的时间成本瓶颈 —— 借助准备3个参考模板、安装Skill_Seekers工具、调用Claude生成Skills、安装到Claude环境、一句提示词生成PPT 这五个步骤，无需繁琐的手动排版调整，就能快速完成符合特定风格标准的专业演示文稿（如本次演示的"2025年度运维工作复盘与规划汇报"）。无论是年度工作总结、项目汇报、产品发布，还是业务复盘、技术分享、培训课件、商业计划，都能通过配置JSON文件或直接提示词完成，极大提升了办公效率和内容产出质量。</p>
<p>小伙伴们可以基于此扩展更多应用场景，如销售提案、投资路演、教学课件、学术报告、活动策划、品牌宣传 等，进一步发挥 自动化办公 在 企业管理、教育培训、市场营销 等领域的应用价值。感兴趣的小伙伴可以按照文中提供的步骤进行实践，根据实际 PPT风格偏好 调整 模板文件和配色方案。今天的分享就到这里结束了，我们下一篇文章见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从香港竹脚手架到前端脚手架：那些"借来"的发展智慧与安全警示]]></title>    <link>https://juejin.cn/post/7580184249908920362</link>    <guid>https://juejin.cn/post/7580184249908920362</guid>    <pubDate>2025-12-05T13:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580184249908920362" data-draft-id="7580208715274813482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从香港竹脚手架到前端脚手架：那些&quot;借来&quot;的发展智慧与安全警示"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-05T13:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="houyhea"/> <meta itemprop="url" content="https://juejin.cn/user/3175045310189998"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从香港竹脚手架到前端脚手架：那些"借来"的发展智慧与安全警示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045310189998/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    houyhea
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T13:51:19.000Z" title="Fri Dec 05 2025 13:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文被我发在我的公众号上，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq1jg039yASZybaYvM7hHjQ" target="_blank" title="https://mp.weixin.qq.com/s/q1jg039yASZybaYvM7hHjQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/q1jg039yA…</a></p>
<p>  近期香港大埔区宏福苑大火的浓烟尚未完全消散，外墙那层竹制脚手架再次成为舆论焦点——这个伴随香港百年的建筑设施，在火势中沦为"助燃架"的悲剧，让"脚手架"这个词刺痛了大众的神经。而作为前端开发者，我看到这个词的第一反应却有些"条件反射"：脑海里立刻浮现出vue create或create-react-app的命令行界面。这种奇妙的联想，或许正是技术领域向传统学科借鉴的生动缩影。</p>
<p>前端开发工程师的条件反射和"无聊"玩笑。</p>
<p>一、前端脚手架：不是工地架子，是代码的"预制骨架"</p>
<p> </p>
<p>    还记得刚入行时，第一次听到"前端脚手架"这个词，我着实困惑了好一阵子：写代码还要搭架子？难道要去工地上搬竹竿？后来才明白，前端脚手架和建筑脚手架的核心作用惊人地一致——都是为了给"施工"提供稳定的基础框架，让操作者能聚焦核心任务而非重复搭建。</p>
<p>    具体来说，前端脚手架是一套自动化的项目初始化与工程化管理方案，它能帮开发者快速生成标准化的项目结构、配置好基础依赖和构建工具，避免每个人都从零开始编写配置文件、整理目录结构的繁琐。比如创建一个Vue项目时，敲下命令就能自动生成组件目录、路由配置、打包脚本等全套基础架构，就像建筑工人不用每次都从砍竹子开始搭架子一样。</p>
<p>    而把"脚手架"这个建筑术语正式引入前端开发领域，并形成标准化工具的，是2012年Google工程师团队推出的Yeoman（作者按：个人认知，可能更早之前有人做过类似工具，但是那个时候比较热门的是Yeoman）。在这之前，前端开发还处于"刀耕火种"的阶段：开发者要手动引入CDN脚本、整理文件目录、配置压缩工具，不同人写的项目结构千差万别。Yeoman通过自动化这些流程，不仅奠定了前端脚手架的核心逻辑，更开启了前端工程化的序幕。</p>
<p>二、不止脚手架：那些从建筑工程"借来"的技术基因</p>
<p> </p>
<p>    前端脚手架的命名并非孤例，如果你仔细盘点会发现，前端开发乃至整个软件工程领域，都充斥着来自建筑工程的"跨界术语"。比如我们常说的"架构设计"，直接挪用了建筑领域"建筑物结构规划"的概念；开发中的"模块拆分"，对应着建筑里的"分部分项工程"；甚至"版本迭代"里的"迭代"，最初也指建筑施工中重复进行的标准化工序。</p>
<p>    这种"借用"背后藏着一个朴素的真理：任何新学科的快速成长，都离不开向发展成熟的老学科汲取养分。建筑工程作为拥有数千年历史的"老牌学科"，早已在标准化、流程化、风险控制等方面形成了完善的体系，而年轻的前端开发（满打满算不过三十年历史）正好需要这样的成熟经验来规避试错成本。</p>
<p>    类似的跨界借鉴在科技领域比比皆是：计算机科学里的"算法"源自数学的逻辑推理，人工智能的"神经网络"模仿了生物大脑的神经元结构，医学上的"手术导航系统"借鉴了航天领域的定位技术，就连管理学的"瀑布模型"，也是从制造业的流水线生产模式演变而来。新学科站在老学科的肩膀上，才能实现"弯道超车"式的发展。</p>
<p> </p>
<p>三、竹与钢的抉择：传统与升级的博弈，前端也曾经历</p>
<p> </p>
<p>    回到香港竹脚手架的争议：为什么在钢制脚手架早已成为内地标配的今天，现代化的香港还在坚守竹制脚手架？答案并非"落后"那么简单，而是传统、经济与现实需求的复杂交织。</p>
<p>    从优势来看，竹脚手架成本仅为钢管的1/5-1/3，搭建拆卸速度极快，熟练工人半日就能搭起一层，而且质地柔韧，能完美贴合香港老城区骑楼、转角等不规则建筑轮廓。</p>
<p>    更重要的是，它已形成完整产业链，关联着数千搭棚工人的生计，甚至其"戏棚搭建技艺"还被列入非遗。但致命缺陷也显而易见：竹子燃点仅280-300℃，遇火后会迅速坍塌，这正是宏福苑大火快速蔓延的重要原因。</p>
<p>    这种"传统便利与安全升级"的博弈，前端脚手架的发展历程中也曾上演。13年前的2012年，正是前端工程化开始蓬勃发展的起点，当时的前端开发就像香港的老建筑施工——大家用着各自的"竹脚手架"：有的手动写HTML模板，有的自定义简易构建脚本，虽然能满足简单需求，但效率低下且隐患重重：不同开发者的项目结构混乱，代码兼容性问题频发，上线前的压缩、转译全靠手动操作，稍有疏忽就会出现线上故障。</p>
<p> </p>
<p>发展启示：迭代升级才是安全与效率的核心</p>
<p>    建筑领域中，内地通过政策引导和市场规模支撑，实现了从竹到钢的脚手架升级，形成"安全-经济-规模"的良性循环；前端领域则通过工具迭代完成了类似进化：从Google的Yeoman奠定了脚手架核心逻辑，到Grunt、Gulp的任务模式优化了构建流程，再到webpack、rollup则攻克了模块打包的核心难题，再到Vue CLI、Create React App实现零配置初始化，如今Vite更是通过原生ESM大幅提升构建效率。每一次升级都在解决前一代"脚手架"的痛点，就像钢制脚手架替代竹子一样，既提升了效率，更筑牢了安全底线。</p>
<p> </p>
<p>四、安全无小事：脚手架里藏着的"生命线"</p>
<p> </p>
<p>    香港大火的惨剧让我们看清：再深厚的传统、再便捷的成本，都不能成为牺牲安全的借口。如今香港已启动计划，要求半数新工务工程改用金属棚架，这是用生命代价换来的进步。</p>
<p>    而这个道理，在前端开发领域同样适用。</p>
<p>    前端脚手架看似只是工具，实则是项目的"安全基石"。过时的脚手架工具并非本身"劣质"，而是因其设计初衷适配的是早期前端技术栈，难以跟上当前快速迭代的技术发展节奏。</p>
<p>    如果自定义脚手架时忽略了ESLint校验配置，可能会让语法错误流入生产环境；如果脚手架的构建脚本存在漏洞，甚至可能导致线上服务崩溃。这些问题看似是"工具故障"，实则会造成客户流失、公司声誉受损，最终开发者还要面临通报批评、绩效扣除的后果。</p>
<p>    当然，"过时"的脚手架也在不断迭代升级，努力跻身前端现代化"钢制"脚手架行列。只不过他们面临的竞争比早期野蛮生长时期更加激烈，就看有多少前端开发者愿意使用了。</p>
<p>    就像建筑工人必须检查脚手架的绑扎牢固度，前端开发者也该守住自己的"脚手架防线"：定期升级脚手架工具以修复安全漏洞，根据项目需求选择合适的标准化工具而非盲目自定义，在脚手架配置中完善代码校验和测试流程。毕竟，无论是建筑施工还是代码开发，安全永远是比效率和成本更重要的底线。</p>
<p> </p>
<p>总结</p>
<p> 
    希望香港的浓烟能让传统工艺与现代安全更好地兼容。也希望每个前端开发者都能重视手中的"脚手架"——让这个从建筑领域借来的工具，既成为提升效率的利器，更成为守护线上安全的屏障。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 不只是聊天：聊聊我最近在做的新方向]]></title>    <link>https://juejin.cn/post/7580184249908936746</link>    <guid>https://juejin.cn/post/7580184249908936746</guid>    <pubDate>2025-12-05T13:57:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580184249908936746" data-draft-id="7580196545288224822" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 不只是聊天：聊聊我最近在做的新方向"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-05T13:57:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 不只是聊天：聊聊我最近在做的新方向
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T13:57:56.000Z" title="Fri Dec 05 2025 13:57:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家应该都听到或看到过类似的观点：现在的 AI 就是一个玩具，也就能聊聊天，生成个搞笑图片。</p>
<p>尽管这一观点带有一定夸张成分，但不可否认的是，当前阶段 AI 应用确实集中在知识处理领域，距离直接改变世界还有一段路要走。</p>
<h2 data-id="heading-0">AI 能力范围的进化</h2>
<p>但，AI 的能力范围其实一直在进化。</p>
<p>最开始，大模型就是聊天，大家在 ChatGPT 上聊的不亦乐乎，甚至诞生了很多现象级的情感陪伴应用。</p>
<p>但很快，大家就开始尝试接入各类信息化能力，为此还专门设计了 MCP，以此方便各类服务的快速接入。</p>
<p>到这时，AI 其实已经通过智能体在影响世界了，比如 AI 编程、AI 审稿、AI 辅助诊断等。</p>
<p>但此时的 AI 应用场景，依然有很多限制，比如：不能直接改善我的生活，不能直接替代生产过程。</p>
<p>为了解决这一困境，我们需要帮助 AI 在感知、执行、规划三个方面进一步进化。</p>
<h3 data-id="heading-1">感知</h3>
<p>现有多模态大模型的图片、音频、视频方式还是有点狭隘。</p>
<p>后续我们将会通过物联网手段，直接接入更多数据来源，扩展信息类型，让 AI 可以连接更多场景。</p>
<h3 data-id="heading-2">执行</h3>
<p>有了输入，经过 AI 加工处理，想要直接改变世界就只差工具了。</p>
<p>大家应该都猜到了，就是现在火热的另一个领域：具身智能。</p>
<p>通过将 AI 接入机械臂、机器人中，可以将模型能力输出到物理世界，以解决各自领域的实际需求。</p>
<h3 data-id="heading-3">规划</h3>
<p>现有大模型与真实世界的串联，大多是将各类输入转为输入文本，AI处理文本，再将输出文本解析为相关动作。</p>
<p>倒是可以实现“输入-智能处理-输出”的链条，但是非原生的模型支持会造成信息的丢失，从而导致整体表现不那么美好。</p>
<p>因此，后续的智能核心将会是各种场景的专有模型，比如：工业模型、医疗模型，或者更为通用的世界模型。</p>
<h2 data-id="heading-4">结语</h2>
<p>好了，今天就到这里，主要是给大家汇报一下，最近工作内容的变化。</p>
<p>后续也会增加这方面内容的分享，欢迎大家继续关注哈~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在为Vue应用的报错而头疼？这招让你彻底掌控全局]]></title>    <link>https://juejin.cn/post/7579507023508537407</link>    <guid>https://juejin.cn/post/7579507023508537407</guid>    <pubDate>2025-12-03T23:26:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023508537407" data-draft-id="7579519985699831814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在为Vue应用的报错而头疼？这招让你彻底掌控全局"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-12-03T23:26:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在为Vue应用的报错而头疼？这招让你彻底掌控全局
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T23:26:36.000Z" title="Wed Dec 03 2025 23:26:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>开发Vue应用时，最怕什么？不是复杂的逻辑，也不是难调的样式，而是那些不知从哪个角落里突然蹦出来的运行时错误。你正在测试一个新功能，页面突然白屏，控制台里一串红色错误，你却像大海捞针一样，半天找不到问题到底出在哪一层组件。用户那边更是直接反馈“页面打不开了”，你却只能干着急。</p>
<p>这种失控的感觉，真的很糟糕。错误就像是应用里的“暗雷”，你不知道它什么时候会爆。但别担心，Vue其实给我们准备了强大的“排雷工具”——那就是 <code>errorCaptured</code> 生命周期钩子和全局错误处理机制。用好它们，你不仅能精准定位错误源头，还能优雅地降级处理，给用户一个体面的体验，而不是一个冷冰冰的白屏。今天，我们就来彻底搞定Vue的错误处理，让你成为应用的“安全总监”。</p>
<h2 data-id="heading-0">理解错误处理的两种境界：局部守卫与全局防线</h2>
<p>在深入代码之前，我们先理清思路。Vue的错误处理可以分成两个层面，就像小区的安保系统。</p>
<p>第一个层面，是<strong>组件级别的“局部守卫”</strong>，也就是 <code>errorCaptured</code> 钩子。想象一下，每栋楼（组件）都有自己的保安（<code>errorCaptured</code>）。这个保安的职责很明确：盯住从这栋楼内部（当前组件）以及所有进入这栋楼的访客（子组件）身上发生的错误。一旦发现，他可以先进行初步处理，比如登记、尝试解决小问题，然后再决定是就地处理掉这个错误，还是继续向上级（父组件）报告。</p>
<p>第二个层面，是<strong>应用级别的“全局防线”</strong>，即 <code>app.config.errorHandler</code>。这就像是小区的中央监控室。所有从各个楼栋（组件）保安那里上报来的、没被就地解决的严重错误，最终都会汇集到这里。这里是最后一道屏障，也是你实现统一错误处理逻辑（比如发送错误日志到服务器、展示友好的全局错误页面）的最佳位置。</p>
<p>简单来说，<code>errorCaptured</code> 让你能沿着组件树“捕获”错误，而 <code>errorHandler</code> 让你能在最顶层“处理”错误。两者配合，才能构建完整的错误处理体系。</p>
<h2 data-id="heading-1">深入 <code>errorCaptured</code>：你的组件级错误捕手</h2>
<p><code>errorCaptured</code> 是Vue组件的一个生命周期钩子。当<strong>本组件以及它的子孙组件</strong>中发生错误时，这个钩子就会被调用。它接收三个参数，让你能掌握错误的全部信息。</p>
<p>让我们来看一个最基础的使用示例，假设我们有一个可能出错的子组件 <code>UnstableComponent</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件 Parent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>父组件区域<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 这里嵌套了一个可能不稳定的子组件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">UnstableComponent</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onErrorCaptured } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UnstableComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./UnstableComponent.vue'</span>

<span class="hljs-comment">// 使用 onErrorCaptured 钩子</span>
<span class="hljs-title function_">onErrorCaptured</span>(<span class="hljs-function">(<span class="hljs-params">error, instance, info</span>) =&gt;</span> {
  <span class="hljs-comment">// 参数1: error - 捕获到的实际错误对象</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'捕获到子组件错误:'</span>, error.<span class="hljs-property">message</span>)
  
  <span class="hljs-comment">// 参数2: instance - 触发错误的组件实例（Vue 3中可能为null或proxy对象，取决于错误发生时机）</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误发生在哪个组件实例附近:'</span>, instance)
  
  <span class="hljs-comment">// 参数3: info - 一个字符串，指出错误发生的来源类型，例如：</span>
  <span class="hljs-comment">// 'render function' (渲染函数)</span>
  <span class="hljs-comment">// 'watcher callback' (侦听器回调)</span>
  <span class="hljs-comment">// 'event handler' (事件处理器)</span>
  <span class="hljs-comment">// 'lifecycle hook' (生命周期钩子)</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误来源:'</span>, info)
  
  <span class="hljs-comment">// 这个钩子可以返回 false 来阻止错误继续向上冒泡</span>
  <span class="hljs-comment">// 如果这里返回 false，错误就不会传到更上层的 errorCaptured 或全局 errorHandler</span>
  <span class="hljs-comment">// 我们这里先不阻止，让错误继续上传以便观察</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件 UnstableComponent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"causeError"</span>&gt;</span>点我触发一个错误<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">causeError</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 这是一个在事件处理函数中故意抛出的错误</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'糟糕！子组件里的事件处理函数出错了！'</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>在这个例子里，当你点击按钮，错误会在子组件中抛出。父组件的 <code>onErrorCaptured</code> 会立刻捕获到这个错误，并打印出详细信息。因为我们的钩子返回了 <code>true</code>（或者不返回任何值，默认行为是继续传播），这个错误会继续向更上层的组件“冒泡”。</p>
<p><strong>关键点：<code>errorCaptured</code> 的返回值决定了错误的命运。</strong> 如果它返回 <code>false</code>，这个错误就被“消化”在此处，不会再向上传递。这非常有用，比如你可以用它来隔离一个非核心的、不稳定第三方组件的错误，避免它导致整个页面崩溃。</p>
<h2 data-id="heading-2">配置全局错误处理器：最后的安全网</h2>
<p>当错误一路冒泡，穿过了所有组件的 <code>errorCaptured</code> 防线（或者它们都选择不拦截），最终就会到达全局处理器。这是你处理“未捕获异常”的最后机会，通常在这里我们会做几件关键事情：记录错误日志、展示用户友好的界面、尝试恢复应用状态。</p>
<p>设置它非常简单，在你的应用入口文件（通常是 <code>main.js</code> 或 <code>main.ts</code>）里配置即可：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 配置全局错误处理器</span>
app.<span class="hljs-property">config</span>.<span class="hljs-property">errorHandler</span> = <span class="hljs-function">(<span class="hljs-params">error, instance, info</span>) =&gt;</span> {
  <span class="hljs-comment">// 参数和 errorCaptured 钩子基本一致</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[全局错误拦截]'</span>, error)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'组件实例:'</span>, instance)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误来源:'</span>, info)
  
  <span class="hljs-comment">// 1. 将错误信息发送到你的日志服务器（在实际项目中至关重要！）</span>
  <span class="hljs-title function_">sendErrorToServer</span>(error, info).<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">warn</span>)
  
  <span class="hljs-comment">// 2. 显示一个友好的全局错误提示，而不是白屏</span>
  <span class="hljs-title function_">showGlobalErrorToast</span>(<span class="hljs-string">'应用发生了一点问题，我们正在紧急修复。'</span>)
  
  <span class="hljs-comment">// 注意：全局处理器不能再阻止错误传播了，因为它是最后一站。</span>
  <span class="hljs-comment">// 这里的错误已经无法被Vue框架继续处理，但我们可以防止它导致整个页面崩溃。</span>
}

<span class="hljs-comment">// 模拟发送错误到后端服务的函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendErrorToServer</span>(<span class="hljs-params">error, errorInfo</span>) {
  <span class="hljs-comment">// 在实际项目中，这里会调用你的API接口</span>
  <span class="hljs-keyword">const</span> errorLog = {
    <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,
    <span class="hljs-attr">stack</span>: error.<span class="hljs-property">stack</span>,
    <span class="hljs-attr">component</span>: errorInfo,
    <span class="hljs-attr">url</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
    <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模拟发送错误日志到服务器:'</span>, errorLog)
  <span class="hljs-comment">// 示例：await fetch('/api/log/error', { method: 'POST', body: JSON.stringify(errorLog) })</span>
}

<span class="hljs-comment">// 模拟显示一个全局提示</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showGlobalErrorToast</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-comment">// 这里可以使用你喜欢的UI库（如Element Plus, Ant Design Vue）的Message组件</span>
  <span class="hljs-comment">// 或者简单创建一个div来提示</span>
  <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
  toast.<span class="hljs-property">textContent</span> = message
  toast.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #fef0f0;
    color: #f56c6c;
    padding: 14px 20px;
    border-radius: 4px;
    border-left: 4px solid #f56c6c;
    z-index: 9999;
    box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
  `</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast)
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> toast.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">5000</span>)
}

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p>全局处理器是你的“安全网”，确保即使有未预料的错误，应用也不会无声无息地崩溃，而是以一种可控的方式告知你和用户。</p>
<h2 data-id="heading-3">实战组合拳：构建一个健壮的错误处理流程</h2>
<p>理论说完了，我们来点实际的。一个完整的错误处理流程，应该结合 <code>errorCaptured</code> 的精细控制和 <code>errorHandler</code> 的全局兜底。设想一个常见场景：你的应用里有一个显示用户动态的 <code>Feed</code> 组件，里面每一条动态由一个 <code>FeedItem</code> 子组件渲染。如果某一条动态的数据异常导致其子组件渲染失败，我们不应该让整个动态流白屏，而只是让那一条动态显示错误状态。</p>
<p>让我们来实现这个场景：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Feed.vue （动态流父组件）</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>最新动态<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 循环渲染每条动态，用 error-boundary 包裹每一项 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in feedItems"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed-item-wrapper"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 关键：每个动态项都被一个“错误边界”组件包裹 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Fallback 插槽定义错误时显示的内容 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed-item-error"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>这条动态暂时无法显示<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"retryLoadItem(item.id)"</span>&gt;</span>重试<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Default 插槽是正常要渲染的动态项 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">FeedItem</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"item"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FeedItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./FeedItem.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ErrorBoundary</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ErrorBoundary.vue'</span> <span class="hljs-comment">// 这是我们即将创建的错误边界组件</span>

<span class="hljs-comment">// 模拟动态数据，其中一条数据有问题</span>
<span class="hljs-keyword">const</span> feedItems = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'今天天气真好！'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'学习了一个新的Vue技巧。'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">content</span>: <span class="hljs-literal">null</span> }, <span class="hljs-comment">// 这条数据的content为null，可能导致子组件渲染错误</span>
  { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'晚餐吃了好吃的。'</span> },
])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">retryLoadItem</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`重试加载动态 <span class="hljs-subst">${id}</span>`</span>)
  <span class="hljs-comment">// 这里可以重新拉取数据或进行其他恢复操作</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>接下来，我们创建那个核心的 <code>ErrorBoundary</code> 组件。它的作用就是利用 <code>errorCaptured</code> 钩子，捕获其默认插槽内所有子组件的错误，并在出错时显示备用（fallback）UI。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ErrorBoundary.vue （错误边界组件）</span>
&lt;template&gt;
  &lt;!-- 根据是否有错误，决定显示默认内容还是备用内容 --&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!hasError"</span> /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"fallback"</span> /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onErrorCaptured } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 一个标志位，记录当前边界内是否发生了错误</span>
<span class="hljs-keyword">const</span> hasError = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-title function_">onErrorCaptured</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'错误边界捕获到错误:'</span>, error.<span class="hljs-property">message</span>)
  
  <span class="hljs-comment">// 标记错误状态，这会触发模板切换，显示 fallback 插槽</span>
  hasError.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  
  <span class="hljs-comment">// 返回 false，阻止错误继续向上冒泡到更外层的组件或全局处理器</span>
  <span class="hljs-comment">// 这样，一条动态的错误就不会影响整个Feed组件</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
})

<span class="hljs-comment">// 可以提供一个重置错误状态的方法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
  hasError.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// 如果需要，可以将 reset 方法暴露给父组件</span>
<span class="hljs-title function_">defineExpose</span>({ reset })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>最后，是可能不稳定的 <code>FeedItem</code> 组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// FeedItem.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feed-item"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 这里假设 content 必须是一个字符串，如果传入 null 就会出错 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ data.content.toUpperCase() }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 当 data.content 为 null 时，.toUpperCase() 会抛出 TypeError --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>看，这个设计的美妙之处在哪里？当渲染到第三条 <code>content</code> 为 <code>null</code> 的动态时，<code>FeedItem</code> 会抛出错误。这个错误被其父级 <code>ErrorBoundary</code> 组件的 <code>errorCaptured</code> 钩子捕获。钩子将 <code>hasError</code> 设为 <code>true</code>，并返回 <code>false</code> 阻止错误上传。于是，模板切换为渲染 <code>#fallback</code> 插槽，用户看到的是“这条动态暂时无法显示”和一个重试按钮，而其他三条动态完全不受影响，全局错误处理器也根本不会收到这个错误的通知。</p>
<p>这种模式，就是前端领域常说的“错误边界”(Error Boundaries)概念在Vue中的实现。它极大地提升了应用的韧性。</p>
<h2 data-id="heading-4">一些重要的细节与陷阱</h2>
<p>掌握了核心用法，我们还得聊聊那些容易踩坑的细节，让你真正从“会用”到“精通”。</p>
<p><strong>第一，<code>errorCaptured</code> 能捕获所有错误吗？</strong> 很遗憾，不能。它主要捕获以下几类：</p>
<ol>
<li>组件的渲染函数错误。</li>
<li>侦听器回调函数（watcher）里的错误。</li>
<li>生命周期钩子里的错误。</li>
<li>自定义事件处理函数（<code>$emit</code> 触发的父组件回调）里的错误。
但是，<strong>异步回调</strong>（比如 <code>setTimeout</code>、<code>Promise.catch</code> 外部、接口请求的成功回调）中的错误，<code>errorCaptured</code> 是抓不到的。这些错误会逃逸到原生的 <code>window.onerror</code> 或 <code>unhandledrejection</code> 事件中。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 示例：errorCaptured 无法捕获的错误</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 情况1：setTimeout 异步错误</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'异步setTimeout错误'</span>) <span class="hljs-comment">// 这个错误 errorCaptured 抓不到！</span>
  }, <span class="hljs-number">1000</span>)
  
  <span class="hljs-comment">// 情况2：Promise 中未catch的错误</span>
  <span class="hljs-title function_">someAsyncFunction</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Promise then回调错误'</span>) <span class="hljs-comment">// 这个错误 errorCaptured 也抓不到！</span>
  })
  <span class="hljs-comment">// 正确做法是在Promise链内部捕获，或者用.catch</span>
})

<span class="hljs-comment">// 你需要用原生的全局错误监听来补足</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'捕获到未处理的Promise拒绝:'</span>, event.<span class="hljs-property">reason</span>)
  event.<span class="hljs-title function_">preventDefault</span>() <span class="hljs-comment">// 阻止浏览器默认的错误打印</span>
})
</code></pre>
<p><strong>第二，错误处理的顺序很重要。</strong> 错误冒泡的路径是：出错的组件本身（如果有<code>errorCaptured</code>）-&gt; 父组件 -&gt; 父组件的父组件 -&gt; ... -&gt; 全局 <code>errorHandler</code>。任何一个环节的 <code>errorCaptured</code> 返回 <code>false</code>，链条就会中断。</p>
<p><strong>第三，关于服务端渲染(SSR)。</strong> 在SSR环境下（如Nuxt.js），<code>errorCaptured</code> 和客户端的行为一致。但 <code>app.config.errorHandler</code> 在服务器端和客户端是分开配置的。在Nuxt中，你可以使用 <code>vueApp.config.errorHandler</code> 在插件中配置，或者使用Nuxt提供的更高层级的错误处理机制。</p>
<h2 data-id="heading-5">总结：从手忙脚乱到从容应对</h2>
<p>走完这一趟，你会发现，Vue的错误处理不再是黑盒。从细粒度的 <code>errorCaptured</code> 钩子到全局的 <code>errorHandler</code>，我们拥有了一套完整的工具来应对各种意外。</p>
<p>最清晰的思路是分层处理：</p>
<ul>
<li>在叶子组件或可能出错的特定组件周围，使用<strong>错误边界模式</strong>（利用 <code>errorCaptured</code> 返回 <code>false</code>）来隔离非关键错误，保证局部故障不影响全局。</li>
<li>在应用的根层面，配置强大的<strong>全局错误处理器</strong>，用于记录所有未处理的错误、上报日志、并展示统一的友好提示，守住最后的用户体验底线。</li>
<li>认识到局限性，用原生的 <code>window.onerror</code> 和 <code>unhandledrejection</code> 事件来补充捕获异步错误。</li>
</ul>
<p>不要再让错误在你面前裸奔了。花点时间，为你的下一个Vue项目规划好错误处理策略。当错误再次发生时，你会看到清晰的日志、可控的界面，而不是用户的抱怨和你的困惑。这份从容，就是一个成熟开发者的标志。现在，就去你的项目中试试吧，从为一个组件添加第一个 <code>onErrorCaptured</code> 开始。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 3.38 动画新特性：动画引擎有什么新变化？]]></title>    <link>https://juejin.cn/post/7579673620940308530</link>    <guid>https://juejin.cn/post/7579673620940308530</guid>    <pubDate>2025-12-04T01:51:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620940308530" data-draft-id="7578780780026560521" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 3.38 动画新特性：动画引擎有什么新变化？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-04T01:51:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 3.38 动画新特性：动画引擎有什么新变化？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:51:14.000Z" title="Thu Dec 04 2025 01:51:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Flutter 3.38 为其动画引擎带来了颠覆性的更新 ，实现了更流畅的过渡、<strong>更优异的性能</strong>，以及强大的全新 API，使复杂的动画实现起来出奇地简单。</p>
<p>还记得以前在 Flutter 中制作动画，感觉像是在与<strong>计时函数 (timing functions)</strong> 和 <strong>控制器 (controllers)</strong> 搏斗吗？想要实现完美的<strong>弹簧效果 (spring action)</strong> ，就意味着要编写<strong>长篇大论的自定义代码</strong>？</p>
<p>现在 <strong>Flutter 3.38 已经拉平了竞争环境</strong>（levelled the playing field）。这是 <strong>Flutter 发布以来最大的更新</strong>，如果您仍然在使用老方法制作动画，那您<strong>工作得太辛苦了</strong>。</p>
<blockquote>
<p>欢迎关注我的微信公众号：OpenFlutter。</p>
</blockquote>
<h2 data-id="heading-0">⚙️ Impeller 革命背后的变化</h2>
<p><strong>Impeller 渲染引擎</strong>在 <strong>Android 上稳定发布</strong>（自 3.10 版本起已在 iOS 上可用）—— 这是 Flutter 3.38 的草案。这不仅仅是后端引擎的互换，它<strong>改变了动画的实现方式</strong>：</p>
<ul>
<li><strong>在支持的设备上锁定 120fps</strong>（过去曾被限制在 60fps）。</li>
<li><strong>消除了着色器编译的卡顿 (shader compilation jank)</strong> —— 不再有首次运行时的卡顿现象。</li>
<li><strong>Flutter 团队的基准测试：动画渲染速度提高 40%</strong> 。</li>
<li><strong>帧计时在任何地方都保持一致</strong>。</li>
</ul>
<p><strong>结论</strong>？即使在中端 Android 设备上，您的动画现在也能如丝般流畅。</p>
<h2 data-id="heading-1">🆕 重要的全新动画 API</h2>
<h3 data-id="heading-2">1. 使用 <code>AnimatedSlide</code> 简化隐式动画</h3>
<p>有了全新的 <strong><code>AnimatedSlide</code></strong> 控件，<strong>不再需要自动计算偏移量 (offsets) <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">→</span></span></span></span></span></strong></p>
<pre><code class="hljs language-dart" lang="dart">AnimatedSlide(
  offset: _isExpanded ? Offset.zero : Offset(<span class="hljs-number">0</span>, <span class="hljs-number">-0.5</span>),
  duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">300</span>),
  curve: Curves.easeOutCubic,
  child: ExpandedContent(),
)
</code></pre>
<p><strong>以前</strong>：需要使用 <code>AnimatedBuilder</code> + <code>Tween</code>，并进行<strong>手动数学计算</strong>。</p>
<p><strong>现在</strong>：即使是<strong>三行声明式代码</strong>也能完成。</p>
<hr/>
<h2 data-id="heading-3">2. <code>CurvedAnimation</code> 得到超级增强</h2>
<p><strong>Flutter 3.38</strong> — 引入了<strong>自定义曲线插值</strong> (<code>Custom curve interpolation</code>)，<strong>让您可以控制插值过程！</strong></p>
<blockquote>
<p>以前，您只能使用预定义的曲线（如 <code>Curves.easeIn</code>）。现在，您可以更精细地控制动画如何沿着其曲线进行加速和减速，实现更独特的时序效果。</p>
</blockquote>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> customCurve = CurvedAnimation(
  parent: _controller,
  curve: Curves.elasticOut,
  reverseCurve: Curves.easeInQuart, <span class="hljs-comment">// New: different reverse curve</span>
);
</code></pre>
<p>您现在可以简单地抓住把手拉开门，它会弹开，但随后像在轴承上滑动一样平稳地关闭 。</p>
<p>这种全新的行为，现在仅仅通过一个简单的调整就实现了。</p>
<hr/>
<h2 data-id="heading-4">3. <code>AnimationController.repeat()</code> 增强功能</h2>
<p><strong>循环动画</strong>变得更智能了：</p>
<pre><code class="hljs language-dart" lang="dart">_controller.repeat(
  period: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">2</span>),
  reverse: <span class="hljs-keyword">true</span>,
  min: <span class="hljs-number">0.0</span>,
  max: <span class="hljs-number">1.0</span>,
);
</code></pre>
<p>新增的 <strong><code>period</code> 参数</strong>为您提供了<strong>帧级精确计时（frame-perfect timing）</strong> ，从而确保您的<strong>长时间运行的动画不会产生漂移（drift）</strong> 。</p>
<hr/>
<h2 data-id="heading-5">💎 性能优化：隐藏的宝藏</h2>
<h3 data-id="heading-6">1. <code>RepaintBoundary</code> 自动化</h3>
<p><strong><code>RepaintBoundary</code> 优化</strong>：Flutter 3.38 中的渲染引擎会<strong>自动识别包含复杂动画的控件</strong>，并<strong>自动应用 <code>RepaintBoundary</code> 优化</strong>。</p>
<ul>
<li>它仍然具有手动放置的优点，但引擎现在<strong>更智能</strong>，不会进行不必要的过度重绘 。</li>
<li>益处：在复杂的列表动画中，无需修改代码即可实现25% 到 30% 的性能提升。</li>
</ul>
<h3 data-id="heading-7">2. <code>AnimatedWidget</code> 内存改进</h3>
<p>现在，它会池化<code>AnimatedWidget</code> 实例，以减少<strong>快速动画期间的内存分配</strong>（如果您的动画在运行后立即从控件树中移除，它会被放入这个内存池中）。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BouncingLogo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnimatedWidget</span> </span>{
  <span class="hljs-keyword">const</span> BouncingLogo({<span class="hljs-keyword">super</span>.key, <span class="hljs-keyword">required</span> Animation&lt;<span class="hljs-built_in">double</span>&gt; animation})
      : <span class="hljs-keyword">super</span>(listenable: animation);

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">final</span> animation = listenable <span class="hljs-keyword">as</span> Animation&lt;<span class="hljs-built_in">double</span>&gt;;
    <span class="hljs-keyword">return</span> Transform.scale(
      scale: animation.value,
      child: FlutterLogo(size: <span class="hljs-number">200</span>),
    );
  }
}
</code></pre>
<p><strong>成果</strong> ：动画工作时不会出现垃圾回收停顿—— 尤其是您的左右滚动类的动画会感觉流畅得多。</p>
<hr/>
<h2 data-id="heading-8">🤯 改变游戏规则的功能：基于物理的动画将变得非常简单</h2>
<p>随着 Flutter 3.38 的到来，改进后的 <code>SpringSimulation</code> 感觉异常逼真：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> spring = SpringSimulation(
  SpringDescription(
    mass: <span class="hljs-number">1</span>,
    stiffness: <span class="hljs-number">180</span>,  <span class="hljs-comment">// More control over bounce</span>
    damping: <span class="hljs-number">12</span>,     <span class="hljs-comment">// Finer damping adjustment</span>
  ),
  <span class="hljs-number">0</span>, <span class="hljs-comment">// start</span>
  <span class="hljs-number">1</span>, <span class="hljs-comment">// end</span>
  <span class="hljs-number">0</span>, <span class="hljs-comment">// velocity</span>
);

_controller.animateWith(spring);
</code></pre>
<h2 data-id="heading-9">💡 为什么这很重要</h2>
<p><strong>重要性</strong>：弹簧动画（Spring animations）现在拥有媲美 iOS 的质量，而且不需要复杂的 <code>PhysicsSimulation</code> 魔法。现在，您的 Material Design 应用可以体现出与原生 iOS 动画相同的触感。</p>
<hr/>
<h2 data-id="heading-10">🎨 内置 Material 3 动效规范</h2>
<p><strong>一流的 Material 3 运动曲线</strong>：</p>
<ul>
<li><strong><code>Easing.emphasizedDecelerate</code></strong>：用于<strong>主元素过渡</strong>（hero transitions）。</li>
<li><strong><code>Easing.emphasizedAccelerate</code></strong>：用于<strong>退出动画</strong>（exit animations）。</li>
<li><strong><code>Easing.standard</code></strong>：用于<strong>默认动效</strong>（default motion）。</li>
</ul>
<p>这些<strong>不只是普通的曲线</strong>——它们是 Material Design 3 规定的精确曲线，能够让您的动画中的补间（tweens）与 Google 的设计系统<strong>完全匹配</strong>。</p>
<hr/>
<h2 data-id="heading-11">📈 真实世界影响：之前与之后</h2>
<p>将一个包含 <strong>40 多个动画屏幕</strong>的现有生产应用迁移到 <strong>Flutter 3.38</strong> 后的结果：</p>
<ul>
<li><strong>构建速度提升</strong>：动画编译速度快了 35% 。</li>
<li><strong>运行时流畅度</strong>：在 Pixel 6 上零丢帧。</li>
<li><strong>代码行数减少</strong>：通过使用新的隐式动画**，减少了 200 多行代码。</li>
<li><strong>首次用户反馈</strong>：“App 更快了”（即使我们没有改变业务逻辑）。</li>
</ul>
<hr/>
<h2 data-id="heading-12">✅ 总结</h2>
<p>动画引擎的设计目标是不仅要比 Flutter 3.38 之前更快，而且要更容易使用。Impeller 渲染、改进的 API 和自动优化相结合，使得您可以用比以前少得多的代码来实现想要的用户体验，甚至达到电影级的质量。</p>
<p>仅仅凭这一点，对于那些仍然停留在Flutter 3.24 或更早版本的开发者来说，这次升级就非常值得。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[半年时间使用 Tiptap 开发一个和飞书差不多效果的协同文档 😍😍😍]]></title>    <link>https://juejin.cn/post/7579702046955225131</link>    <guid>https://juejin.cn/post/7579702046955225131</guid>    <pubDate>2025-12-04T08:55:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579702046955225131" data-draft-id="7579702046955175979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="半年时间使用 Tiptap 开发一个和飞书差不多效果的协同文档 😍😍😍"/> <meta itemprop="keywords" content="前端,JavaScript,后端"/> <meta itemprop="datePublished" content="2025-12-04T08:55:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            半年时间使用 Tiptap 开发一个和飞书差不多效果的协同文档 😍😍😍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T08:55:55.000Z" title="Thu Dec 04 2025 08:55:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>写了半年的协同文档终于有点像样了，目前新增数学公式、RAG、续写，划词评论，创建组织和 @ 人等功能。</p>
<h2 data-id="heading-0">项目链接</h2>
<ul>
<li><strong>项目地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codecrack.cn%2F" target="_blank" title="https://www.codecrack.cn/" ref="nofollow noopener noreferrer">www.codecrack.cn/</a></li>
<li><strong>GitHub 地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">github.com/xun082/DocF…</a></li>
<li>联系微信：<code>yunmz777</code></li>
</ul>
<h2 data-id="heading-1">新功能预览</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e34b25d26e94d76a75fb4b8ffb5eaeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=JMdbht4pAUcyzbNAywN5kv3juI8%3D" alt="微信图片_20251203164800_7_66.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/613a493f64094f3f931972297dbaf44b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=oHLkaTmJHHRSZBBxHWH9kFFHjWo%3D" alt="微信图片_20251203164911_8_66.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d00762660bb143cf95c6b99dd25316fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=kWmUKEKFAco%2B6IiyOiFzQEXPXoE%3D" alt="微信图片_20251203164924_9_66.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c76aa7c27774844b421bc0ae4e30ef4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=UpHxBWqheqilXgZN6JuOmdmAJKQ%3D" alt="微信图片_20251203165229_10_66.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7d4f42e4b044586b42fdaec8c536621~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=Sk2SqCnegAMC1g591QPU%2Fg0gJoI%3D" alt="微信图片_20251203165403_11_66.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/537e62ded9d44d61bb93b0b5c49510b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=Kw9k9cIcRPlhL040%2BgLsxtnyvuM%3D" alt="微信图片_20251203165442_12_66.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d5298a269af4b99ac759430bb9b3b8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765443355&amp;x-signature=t4jwq7zOdcUEJK1VEHrURb69Uog%3D" alt="微信图片_20251203165502_13_66.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot ThreadLocal 父子线程传值的几种实现方式]]></title>    <link>https://juejin.cn/post/7579519985699848198</link>    <guid>https://juejin.cn/post/7579519985699848198</guid>    <pubDate>2025-12-04T00:05:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579519985699848198" data-draft-id="7579101504289308726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot ThreadLocal 父子线程传值的几种实现方式"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-04T00:05:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot ThreadLocal 父子线程传值的几种实现方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T00:05:07.000Z" title="Thu Dec 04 2025 00:05:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    45
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在日常开发中，我们经常会遇到需要在父子线程之间传递数据的场景。比如用户身份信息、请求ID、链路追踪ID等。</p>
<p>ThreadLocal作为Java中重要的线程本地变量机制，为我们提供了在单个线程内存储数据的便利。但是，当涉及到父子线程之间的数据传递时，ThreadLocal默认的行为并不能满足我们的需求。</p>
<p>本文将介绍在SpringBoot应用中实现ThreadLocal父子线程传值的几种方式。</p>
<h2 data-id="heading-1">ThreadLocal 基础回顾</h2>
<p>首先，让我们简单回顾一下ThreadLocal的基本原理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocal</span>&lt;T&gt; {
    <span class="hljs-comment">// 每个线程都有自己独立的ThreadLocalMap</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
            map.set(<span class="hljs-built_in">this</span>, value);
        <span class="hljs-keyword">else</span>
            createMap(t, value);
    }

    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
        <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
            ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
                <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
                <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
                <span class="hljs-keyword">return</span> result;
            }
        }
        <span class="hljs-keyword">return</span> setInitialValue();
    }
}
</code></pre>
<p>ThreadLocal的核心思想是为每个线程维护一个独立的ThreadLocalMap，从而实现线程隔离。</p>
<h2 data-id="heading-2">问题的提出</h2>
<p>让我们通过一个简单的例子来看看ThreadLocal在父子线程中的默认行为</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;String&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        threadLocal.set(<span class="hljs-string">"主线程的值"</span>);
        System.out.println(<span class="hljs-string">"主线程获取: "</span> + threadLocal.get()); <span class="hljs-comment">// 输出: 主线程的值</span>

        <span class="hljs-type">Thread</span> <span class="hljs-variable">childThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"子线程获取: "</span> + threadLocal.get()); <span class="hljs-comment">// 输出: null</span>
        });
        childThread.start();
    }
}
</code></pre>
<p>从上面的例子可以看出，子线程无法访问父线程中设置的ThreadLocal值。这是因为每个线程都有自己独立的ThreadLocalMap。</p>
<h2 data-id="heading-3">解决方案一：InheritableThreadLocal</h2>
<p>Java为我们提供了InheritableThreadLocal来解决父子线程传值的问题</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InheritableThreadLocalDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> InheritableThreadLocal&lt;String&gt; inheritableThreadLocal =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InheritableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        inheritableThreadLocal.set(<span class="hljs-string">"主线程的值"</span>);
        System.out.println(<span class="hljs-string">"主线程获取: "</span> + inheritableThreadLocal.get());

        <span class="hljs-type">Thread</span> <span class="hljs-variable">childThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            System.out.println(<span class="hljs-string">"子线程获取: "</span> + inheritableThreadLocal.get()); <span class="hljs-comment">// 输出: 主线程的值</span>
        });
        childThread.start();
    }
}
</code></pre>
<h4 data-id="heading-4">InheritableThreadLocal 原理分析</h4>
<p>InheritableThreadLocal的实现在Thread类中</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-comment">// 父线程的inheritableThreadLocals会在创建子线程时复制</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,
                      <span class="hljs-type">long</span> stackSize, AccessControlContext acc,
                      <span class="hljs-type">boolean</span> inheritThreadLocals)</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-literal">null</span>)
            <span class="hljs-built_in">this</span>.inheritableThreadLocals =
                ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h4 data-id="heading-5">InheritableThreadLocal 的局限性</h4>
<ul>
<li><strong>1. 时机限制</strong>：只在创建线程时进行值传递，后续修改不会传递到已创建的子线程</li>
<li><strong>2. 线程池问题</strong>：在线程池中使用时，由于线程会被复用，可能导致数据混乱</li>
</ul>
<h2 data-id="heading-6">解决方案二：使用TransmittableThreadLocal</h2>
<p>阿里巴巴开源的TransmittableThreadLocal（TTL）是解决线程池场景下父子线程传值问题的优秀方案：</p>
<h4 data-id="heading-7">添加依赖</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transmittable-thread-local<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">基本使用</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.ttl.TransmittableThreadLocal;
<span class="hljs-keyword">import</span> com.alibaba.ttl.threadpool.TtlExecutors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlDemo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TransmittableThreadLocal&lt;String&gt; ttl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        ttl.set(<span class="hljs-string">"主线程的值"</span>);
        System.out.println(<span class="hljs-string">"主线程获取: "</span> + ttl.get());

        <span class="hljs-comment">// 使用TTL装饰的线程池</span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> TtlExecutors.getTtlExecutorService(
            Executors.newFixedThreadPool(<span class="hljs-number">2</span>)
        );

        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"线程池任务1获取: "</span> + ttl.get()); <span class="hljs-comment">// 输出: 主线程的值</span>
        });

        <span class="hljs-comment">// 修改值后提交新任务</span>
        ttl.set(<span class="hljs-string">"更新后的值"</span>);
        executor.submit(() -&gt; {
            System.out.println(<span class="hljs-string">"线程池任务2获取: "</span> + ttl.get()); <span class="hljs-comment">// 输出: 更新后的值</span>
        });
    }
}
</code></pre>
<h4 data-id="heading-9">TTL 与Spring Boot的集成</h4>
<p>在Spring Boot应用中，我们可以通过以下方式集成TTL</p>
<h5 data-id="heading-10">1. 配置TTL异步执行器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        executor.setMaxPoolSize(<span class="hljs-number">10</span>);
        executor.setQueueCapacity(<span class="hljs-number">100</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"Async-"</span>);

        <span class="hljs-comment">// 使用TTL装饰</span>
        <span class="hljs-keyword">return</span> TtlExecutors.getTtlExecutor(executor);
    }
}
</code></pre>
<h5 data-id="heading-11">2. 使用TTL的请求拦截器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TtlRequestInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TransmittableThreadLocal&lt;String&gt; requestId =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                           Object handler)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        requestId.set(id);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                              Object handler, Exception ex)</span> {
        requestId.remove(); <span class="hljs-comment">// 清理</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getRequestId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> requestId.get();
    }
}
</code></pre>
<h2 data-id="heading-12">解决方案三：自定义TaskDecorator</h2>
<p>Spring提供了TaskDecorator接口，允许我们对Runnable任务进行装饰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAsyncConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(<span class="hljs-number">5</span>);
        executor.setMaxPoolSize(<span class="hljs-number">10</span>);
        executor.setQueueCapacity(<span class="hljs-number">100</span>);
        executor.setThreadNamePrefix(<span class="hljs-string">"CustomAsync-"</span>);

        <span class="hljs-comment">// 设置自定义装饰器</span>
        executor.setTaskDecorator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextCopyingDecorator</span>());
        executor.initialize();

        <span class="hljs-keyword">return</span> executor;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextCopyingDecorator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskDecorator</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Runnable <span class="hljs-title function_">decorate</span><span class="hljs-params">(Runnable runnable)</span> {
            <span class="hljs-comment">// 获取父线程的ThreadLocal上下文</span>
            Map&lt;String, Object&gt; context = getContextFromCurrentThread();
            <span class="hljs-keyword">return</span> () -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 在子线程中复制上下文</span>
                    setContextToCurrentThread(context);
                    runnable.run();
                } <span class="hljs-keyword">finally</span> {
                    clearCurrentThreadContext();
                }
            };
        }

        <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getContextFromCurrentThread</span><span class="hljs-params">()</span> {
            Map&lt;String, Object&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-comment">// 收集当前线程的ThreadLocal值</span>
            <span class="hljs-comment">// 例如：从自定义的ThreadLocal中获取</span>
            <span class="hljs-keyword">if</span> (UserContext.getUser() != <span class="hljs-literal">null</span>) {
                context.put(<span class="hljs-string">"userInfo"</span>, UserContext.getUser());
            }
            <span class="hljs-keyword">if</span> (RequestContextHolder.getRequestAttributes() != <span class="hljs-literal">null</span>) {
                context.put(<span class="hljs-string">"requestAttributes"</span>, RequestContextHolder.getRequestAttributes());
            }
            <span class="hljs-keyword">return</span> context;
        }

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContextToCurrentThread</span><span class="hljs-params">(Map&lt;String, Object&gt; context)</span> {
            <span class="hljs-comment">// 在子线程中设置上下文</span>
            <span class="hljs-keyword">if</span> (context.containsKey(<span class="hljs-string">"userInfo"</span>)) {
                UserContext.setUser((UserContext.UserInfo) context.get(<span class="hljs-string">"userInfo"</span>));
            }
            <span class="hljs-keyword">if</span> (context.containsKey(<span class="hljs-string">"requestAttributes"</span>)) {
                RequestContextHolder.setRequestAttributes((RequestAttributes) context.get(<span class="hljs-string">"requestAttributes"</span>));
            }
        }

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCurrentThreadContext</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// 清理上下文，防止内存泄漏</span>
            UserContext.clear();
            RequestContextHolder.resetRequestAttributes();
        }
    }
}
</code></pre>
<h2 data-id="heading-13">解决方案四：使用Spring的RequestContextHolder</h2>
<p>在Spring Web应用中，我们可以利用RequestContextHolder来传递请求上下文</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextService</span> {

    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取父线程的请求上下文</span>
        <span class="hljs-type">RequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> RequestContextHolder.getRequestAttributes();

        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 在异步线程中设置上下文</span>
            RequestContextHolder.setRequestAttributes(attributes);

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 执行业务逻辑</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doSomeWork();
                <span class="hljs-keyword">return</span> result;
            } <span class="hljs-keyword">finally</span> {
                RequestContextHolder.resetRequestAttributes();
            }
        });
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">doSomeWork</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取请求相关的信息</span>
        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span>
            ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();
        <span class="hljs-keyword">return</span> <span class="hljs-string">"处理完成: "</span> + request.getRequestURI();
    }
}
</code></pre>
<h2 data-id="heading-14">方案选择建议</h2>
<p>基于上述性能对比和适用场景，我们可以给出以下选择建议：</p>
<ul>
<li><strong>1. 简单的父子线程传值</strong>：使用InheritableThreadLocal</li>
<li><strong>2. 线程池场景</strong>：推荐使用TransmittableThreadLocal</li>
<li><strong>3. Spring异步任务</strong>：使用TaskDecorator</li>
<li><strong>4. Web应用请求上下文</strong>：使用RequestContextHolder</li>
</ul>
<h2 data-id="heading-15">最佳实践</h2>
<h4 data-id="heading-16">1. 内存泄漏预防</h4>
<p>无论使用哪种方案，都要注意及时清理ThreadLocal：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeThreadLocalUsage</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;Object&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            threadLocal.set(someValue);
            <span class="hljs-comment">// 业务逻辑</span>
        } <span class="hljs-keyword">finally</span> {
            threadLocal.remove(); <span class="hljs-comment">// 防止内存泄漏</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-17">2. 上下文封装</h4>
<p>建议封装一个统一的上下文管理器：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;UserInfo&gt; USER_CONTEXT =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUser</span><span class="hljs-params">(UserInfo user)</span> {
        USER_CONTEXT.set(user);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserInfo <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> USER_CONTEXT.get();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        USER_CONTEXT.remove();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
        <span class="hljs-keyword">private</span> String userId;
        <span class="hljs-keyword">private</span> String userName;
        <span class="hljs-keyword">private</span> String requestId;
        <span class="hljs-comment">// getters and setters</span>
    }
}
</code></pre>
<h4 data-id="heading-18">3. 拦截器统一管理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContextInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                           Object handler)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> buildUserInfo(request);
        UserContext.setUser(userInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                              Object handler, Exception ex)</span> {
        UserContext.clear();
    }

    <span class="hljs-keyword">private</span> UserInfo <span class="hljs-title function_">buildUserInfo</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
        userInfo.setUserId(request.getHeader(<span class="hljs-string">"X-User-Id"</span>));
        userInfo.setRequestId(UUID.randomUUID().toString());
        <span class="hljs-keyword">return</span> userInfo;
    }
}
</code></pre>
<h2 data-id="heading-19">总结</h2>
<p>本文介绍了四种在SpringBoot中实现ThreadLocal父子线程传值的方案：</p>
<ul>
<li><strong>1. InheritableThreadLocal</strong>：最简单的原生解决方案，适用于基础场景</li>
<li><strong>2. TransmittableThreadLocal</strong>：功能强大的第三方解决方案，特别适合线程池场景</li>
<li><strong>3. TaskDecorator</strong>：Spring提供的优雅解决方案，集成度高</li>
<li><strong>4. RequestContextHolder</strong>：Spring Web应用的内置方案</li>
</ul>
<p>在实际项目中，我们应该根据具体的业务场景和技术栈选择合适的方案。</p>
<p>同时，要注意内存管理和上下文清理，确保系统的稳定性和性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[初学者友好：Go-Kratos 集成 go-crud，Ent ORM CRUD 无需重复编码，轻松上手]]></title>    <link>https://juejin.cn/post/7579628944036659209</link>    <guid>https://juejin.cn/post/7579628944036659209</guid>    <pubDate>2025-12-04T07:58:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579628944036659209" data-draft-id="7579798332777218057" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="初学者友好：Go-Kratos 集成 go-crud，Ent ORM CRUD 无需重复编码，轻松上手"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2025-12-04T07:58:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            初学者友好：Go-Kratos 集成 go-crud，Ent ORM CRUD 无需重复编码，轻松上手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T07:58:12.000Z" title="Thu Dec 04 2025 07:58:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    61
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">初学者友好：Go-Kratos 集成 go-crud，Ent ORM CRUD 无需重复编码，轻松上手</h2>
<p>对于刚接触 Go 微服务开发的初学者来说，直接上手 “框架 + ORM” 的组合常显复杂。而 <code>kratos-ent-example</code> 项目已为我们搭建好了 <code>Go-Kratos</code> 与 <code>Ent</code> 的基础集成框架，本文将基于该项目，聚焦如何快速接入 <code>go-curd</code> 工具简化 CRUD（增删改查）操作，全程以 step-by-step 的方式讲解，新手也能轻松跟随实操。</p>
<p>先明确核心工具关系：<code>kratos-ent-example</code>是 “基础骨架”（已整合 Kratos 与 Ent），<code>go-curd</code>是 “效率工具”（封装重复 CRUD 逻辑），我们的核心目标是 “在现有骨架上装工具，让数据操作更简单”。</p>
<h3 data-id="heading-1">一、核心工具速览：3 分钟理清分工</h3>
<p>在动手前，先明确三个工具的分工，避免越做越乱：</p>
<ul>
<li><strong>Go-Kratos</strong>：微服务框架核心，负责 API 定义、服务启动、请求分发，kratos-ent-example 已完成其基础配置；</li>
<li><strong>Ent</strong>：现代化 ORM 框架，通过代码生成实现类型安全的数据库操作，采用 schema 定义模型，比传统 ORM 更注重类型检查；</li>
<li><strong>go-crud</strong>：Ent 的上层封装工具，把重复的 CRUD 逻辑（如创建、查询、更新、删除）做成现成方法，无需手动编写 Ent 原生查询语句。</li>
</ul>
<h3 data-id="heading-2">二、环境准备：5 分钟搞定前置依赖</h3>
<p>先完成基础环境搭建和项目准备，确保后续步骤无报错：</p>
<ol>
<li><strong>安装基础工具</strong>：要求 Go 1.24+（项目 go.mod 指定版本），安装后用<code>go version</code>验证；</li>
<li><strong>Git</strong>：用于克隆示例项目；</li>
<li><strong>准备数据库</strong>：支持 PostgreSQL/MySQL（Ent 适配多种数据库），新建一个数据库（比如叫<code>example</code>），不用建表（后续 Ent 会自动生成）；</li>
<li><strong>获取 kratos-ent-example 项目</strong>：
<ul>
<li>打开终端，执行以下命令克隆项目并进入目录：<code>git clone https://github.com/tx7do/kratos-ent-example.git</code></li>
<li><code>cd kratos-ent-example</code></li>
</ul>
</li>
<li><strong>引入 go-curd 依赖</strong>：项目已预设 go-curd 的 Ent 适配模块（见 go.mod 中的<code>github.com/tx7do/go-crud/entgo</code>），直接拉取依赖即可：<code>go mod tidy</code></li>
<li><strong>确认项目核心目录</strong>：无需关注所有文件，重点记住 3 个核心目录（kratos-ent-example 已预设）：
<ul>
<li><code>api</code>：放 API 定义文件（.proto），用于定义 “创建用户”“查询用户” 等接口；</li>
<li><code>app/user/service/internal/data/ent/schema</code>：放 Ent 模型定义（通过 schema 描述数据库表结构）；</li>
<li><code>app/user/service/internal/data</code>：放业务逻辑，这里会调用 <code>go-curd</code> 操作 Ent 客户端。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">三、核心步骤 1：在 kratos-ent-example 中集成 go-curd</h3>
<p><code>kratos-ent-example</code> 已完成 Ent 的初始化配置（如数据库连接、代码生成），我们只需在现有基础上，将 <code>go-curd</code> 的 Ent 客户端集成进来，让业务层可以调用其简化方法。</p>
<h4 data-id="heading-4">1.1 修改数据层：集成 go-curd 的 Ent 客户端</h4>
<p>打开<code>app/user/service/internal/data/user.go</code>修改代码以集成<code>go-curd</code>的 <code>Ent</code> 适配模块：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
  entCurd <span class="hljs-string">"github.com/tx7do/go-crud/entgo"</span>
)

<span class="hljs-keyword">type</span> UserRepo <span class="hljs-keyword">struct</span> {
	data *Data
	log  *log.Helper

	mapper     *mapper.CopierMapper[userV1.User, *ent.User]
	repository *entCurd.Repository[
		ent.UserQuery, ent.UserSelect, ent.UserCreate, ent.UserCreateBulk, ent.UserUpdate, ent.UserUpdateOne, ent.UserDelete,
		predicate.User,
		userV1.User, ent.User,
	]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserRepo</span><span class="hljs-params">(data *Data, logger log.Logger)</span></span> *UserRepo {
	l := log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"user/repo/user-service"</span>))
	repo := &amp;UserRepo{
		data:   data,
		log:    l,
		mapper: mapper.NewCopierMapper[userV1.User, *ent.User](),
	}

	<span class="hljs-comment">// 初始化go-curd的Ent仓库，传入映射器和Ent客户端</span>
	repo.repository = entCurd.NewRepository[
		ent.UserQuery, ent.UserSelect, ent.UserCreate, ent.UserCreateBulk, ent.UserUpdate, ent.UserUpdateOne, ent.UserDelete,
		predicate.User,
		userV1.User, ent.User,
	](repo.mapper)

	<span class="hljs-keyword">return</span> repo
}
</code></pre>
<p>核心改动说明：新增<code>repository</code>字段存储<code>go-curd</code>的 <code>Ent</code> 客户端，通过<code>entCurd.NewRepository()</code>初始化，后续 CRUD 操作均通过该客户端完成。</p>
<h4 data-id="heading-5">1.2 确认数据库配置（无需修改，仅验证）</h4>
<p><code>kratos-ent-example</code> 已在配置文件中预设数据库连接，打开<code>configs/data.yaml</code>验证：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">data:</span>
  <span class="hljs-attr">database:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">"postgres"</span>  <span class="hljs-comment"># 支持mysql/postgres/sqlite</span>
    <span class="hljs-attr">source:</span> <span class="hljs-string">"host=localhost port=5432 user=postgres password=your_password dbname=example sslmode=disable"</span>
    <span class="hljs-attr">migrate:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 启动时自动执行数据库迁移</span>
</code></pre>
<p>注意：将<code>source</code>中的用户名、密码改为自己的数据库信息，确保能连接到之前新建的<code>example</code>数据库。</p>
<h3 data-id="heading-6">四、核心步骤 2：用 go-curd 实现 CRUD 业务逻辑</h3>
<p>我们将以 “用户模块” 为例，基于项目现有的目录结构，用 <code>go-curd</code> 实现用户的增、删、改、查。<code>kratos-ent-example</code> 已预设部分基础代码，我们只需补充和修改。</p>
<h4 data-id="heading-7">2.1 定义用户模型（Ent Schema）</h4>
<p><code>Ent</code> 通过 <code>schema</code> 定义模型（而非传统结构体），打开<code>app/user/service/internal/data/ent/schema/user.go</code>，定义用户模型的 schema：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> schema

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"time"</span>
	<span class="hljs-string">"entgo.io/ent"</span>
	<span class="hljs-string">"entgo.io/ent/dialect"</span>
	<span class="hljs-string">"entgo.io/ent/schema/field"</span>
	<span class="hljs-string">"entgo.io/ent/schema/index"</span>
)

<span class="hljs-comment">// User holds the schema definition for the User entity.</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
	ent.Schema
}

<span class="hljs-comment">// Fields of the User.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(User)</span></span> Fields() []ent.Field {
	<span class="hljs-keyword">return</span> []ent.Field{
		field.String(<span class="hljs-string">"user_name"</span>).
			SchemaType(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				dialect.MySQL:    <span class="hljs-string">"varchar(64)"</span>, <span class="hljs-comment">// MySQL特定类型</span>
				dialect.Postgres: <span class="hljs-string">"varchar(64)"</span>, <span class="hljs-comment">// PostgreSQL特定类型</span>
			}).
			Unique(), <span class="hljs-comment">// 用户名唯一</span>
		field.String(<span class="hljs-string">"nick_name"</span>).
			SchemaType(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				dialect.MySQL:    <span class="hljs-string">"varchar(64)"</span>,
				dialect.Postgres: <span class="hljs-string">"varchar(64)"</span>,
			}),
		field.String(<span class="hljs-string">"password"</span>).
			SchemaType(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				dialect.MySQL:    <span class="hljs-string">"varchar(128)"</span>,
				dialect.Postgres: <span class="hljs-string">"varchar(128)"</span>,
			}),
		field.Time(<span class="hljs-string">"created_at"</span>).
			Default(time.Now).
			SchemaType(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				dialect.MySQL: <span class="hljs-string">"datetime"</span>,
			}),
		field.Time(<span class="hljs-string">"updated_at"</span>).
			Default(time.Now).
			UpdateDefault(time.Now).
			SchemaType(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				dialect.MySQL: <span class="hljs-string">"datetime"</span>,
			}),
		field.Time(<span class="hljs-string">"deleted_at"</span>).
			Optional().
			Nillable().
			SchemaType(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
				dialect.MySQL: <span class="hljs-string">"datetime"</span>,
			}),
	}
}

<span class="hljs-comment">// Edges of the User.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(User)</span></span> Edges() []ent.Edge {
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Indexes of the User.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(User)</span></span> Indexes() []ent.Index {
	<span class="hljs-keyword">return</span> []ent.Index{
		index.Fields(<span class="hljs-string">"user_name"</span>).Unique(), <span class="hljs-comment">// 用户名索引（唯一）</span>
	}
}
</code></pre>
<p>说明：Ent 会根据该 schema 自动生成 Go 代码（实体、查询器等），后续通过生成的代码操作数据库。在<code>app/user/service</code>目录下执行以下命令生成 <code>Ent</code> 代码：</p>
<pre><code class="hljs language-bash" lang="bash">make ent
</code></pre>
<p>生成的代码会放在<code>app/user/service/internal/data/ent</code>目录下，包含<code>User</code>实体及 CRUD 基础方法。</p>
<h4 data-id="heading-8">2.2 编写 Data 层：用 go-curd 实现 CRUD</h4>
<p>打开<code>app/user/service/internal/data/user.go</code>，编写业务逻辑方法。核心优势：用 <code>go-curd</code> 的现成方法替代原生 Ent 代码，减少重复工作。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-comment">// List 查询用户列表（带分页）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> List(ctx context.Context, req *pagination.PagingRequest) (*userV1.ListUserResponse, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	builder := r.data.db.Client().Debug().User.Query()

	ret, err := r.repository.ListWithPaging(ctx, builder, builder.Clone(), req)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}
	<span class="hljs-keyword">if</span> ret == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> &amp;userV1.ListUserResponse{Total: <span class="hljs-number">0</span>, Items: <span class="hljs-literal">nil</span>}, <span class="hljs-literal">nil</span>
	}

	<span class="hljs-keyword">return</span> &amp;userV1.ListUserResponse{
		Total: ret.Total,
		Items: ret.Items,
	}, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// Get 查询单个用户（支持按ID或用户名查询）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Get(ctx context.Context, req *userV1.GetUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">var</span> whereCond []<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *sql.Selector)</span></span>
	<span class="hljs-keyword">switch</span> req.QueryBy.(<span class="hljs-keyword">type</span>) {
	<span class="hljs-keyword">case</span> *userV1.GetUserRequest_Id:
		whereCond = <span class="hljs-built_in">append</span>(whereCond, user.IDEQ(req.GetId()))
	<span class="hljs-keyword">case</span> *userV1.GetUserRequest_UserName:
		whereCond = <span class="hljs-built_in">append</span>(whereCond, user.UserNameEQ(req.GetUserName()))
	<span class="hljs-keyword">default</span>:
		whereCond = <span class="hljs-built_in">append</span>(whereCond, user.IDEQ(req.GetId()))
	}

	builder := r.data.db.Client().Debug().User.Query()
	dto, err := r.repository.Get(ctx, builder, whereCond, req.GetViewMask())
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	<span class="hljs-keyword">return</span> dto, err
}

<span class="hljs-comment">// Create 创建用户（密码加密存储）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Create(ctx context.Context, req *userV1.CreateUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> || req.Data == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> &amp;&amp; req.Data.GetPassword() != <span class="hljs-string">""</span> {
		cryptoPassword, err := crypto.HashPassword(req.Data.GetPassword())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		req.Data.Password = &amp;cryptoPassword
	}

	builder := r.data.db.Client().Debug().User.Create()
	result, err := r.repository.Create(ctx, builder, req.Data, <span class="hljs-literal">nil</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(dto *userV1.User)</span></span> {
		builder.
			SetNillableUserName(req.Data.UserName).
			SetNillableNickName(req.Data.NickName).
			SetCreatedAt(time.Now())

		<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> {
			builder.SetPassword(req.Data.GetPassword())
		}
	})

	<span class="hljs-keyword">return</span> result, err
}

<span class="hljs-comment">// Update 更新用户信息</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Update(ctx context.Context, req *userV1.UpdateUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> || req.Data == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> &amp;&amp; req.Data.GetPassword() != <span class="hljs-string">""</span> {
		cryptoPassword, err := crypto.HashPassword(req.Data.GetPassword())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		req.Data.Password = &amp;cryptoPassword
	}

	builder := r.data.db.Client().Debug().User.UpdateOneID(req.Data.GetId())
	result, err := r.repository.UpdateOne(ctx, builder, req.Data, req.GetUpdateMask(),
		[]predicate.User{
			<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *sql.Selector)</span></span> {
				s.Where(sql.EQ(user.FieldID, req.Data.GetId()))
			},
		},
		<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(dto *userV1.User)</span></span> {
			builder.
				SetNillableNickName(req.Data.NickName).
				SetUpdatedAt(time.Now())

			<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> {
				builder.SetPassword(req.Data.GetPassword())
			}
		},
	)

	<span class="hljs-keyword">return</span> result, err
}

<span class="hljs-comment">// Delete 删除用户</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Delete(ctx context.Context, req *userV1.DeleteUserRequest) (<span class="hljs-type">bool</span>, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	builder := r.data.db.Client().Debug().User.Delete()
	affected, err := r.repository.Delete(ctx, builder, []predicate.User{
		<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(s *sql.Selector)</span></span> {
			s.Where(sql.EQ(user.FieldID, req.GetId()))
		},
	})

	<span class="hljs-keyword">return</span> err == <span class="hljs-literal">nil</span> &amp;&amp; affected &gt; <span class="hljs-number">0</span>, err
}
</code></pre>
<p>核心简化点：对比原生 <code>Ent</code>，<code>go-curd</code> 的<code>ListWithPaging</code>、<code>Get</code>、<code>Create</code>等方法封装了查询条件构建、结果映射等重复逻辑，直接传入 DTO（数据传输对象）即可完成操作。</p>
<h4 data-id="heading-9">2.3 定义 API 接口（Proto）并生成代码</h4>
<p><code>kratos-ent-example</code>已在<code>api/protos/user/service/v1/user.proto</code>中预设了用户 API 定义（与 GORM 示例类似），我们只需确认内容，然后生成 Go 代码：</p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";

package user.service.v1;

import "google/api/annotations.proto";
import "pagination/v1/pagination.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";

// 用户服务
service UserService {
  rpc ListUser (pagination.PagingRequest) returns (ListUserResponse) {
    option (google.api.http) = { get: "/users" };
  }
  rpc GetUser (GetUserRequest) returns (User) {
    option (google.api.http) = { get: "/users/{id}" };
  }
  rpc CreateUser (CreateUserRequest) returns (User) {
    option (google.api.http) = { post: "/users", body: "*" };
  }
  rpc UpdateUser (UpdateUserRequest) returns (User) {
    option (google.api.http) = { put: "/users/{data.id}", body: "*" };
  }
  rpc DeleteUser (DeleteUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = { delete: "/users/{id}" };
  }
}

// 用户
message User {
  uint32 id = 1;

  optional string user_name = 2 [json_name = "userName", (gnostic.openapi.v3.property) = {description: "账户名"}];// 账户名
  optional string nick_name = 3 [json_name = "nickName", (gnostic.openapi.v3.property) = {description: "昵称"}];// 昵称
  optional string password = 4 [json_name = "password", (gnostic.openapi.v3.property) = {description: "密码"}];// 密码

  optional google.protobuf.Timestamp created_at = 200 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "创建时间"}];// 创建时间
  optional google.protobuf.Timestamp updated_at = 201 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "更新时间"}];// 更新时间
  optional google.protobuf.Timestamp deleted_at = 202 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "删除时间"}];// 删除时间
}

// 获取用户列表 - 答复
message ListUserResponse {
  repeated User items = 1;
  uint64 total = 2;
}

// 获取用户数据 - 请求
message GetUserRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "用户ID", read_only: true},
      json_name = "id"
    ]; // 用户ID

    string user_name = 2 [
      (gnostic.openapi.v3.property) = {description: "用户登录名", read_only: true},
      json_name = "userName"
    ]; // 用户登录名
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "视图字段过滤器，用于控制返回的字段"
    }
  ]; // 视图字段过滤器，用于控制返回的字段
}

// 创建用户 - 请求
message CreateUserRequest {
  User data = 1;

  uint32 operator_id = 2 [json_name = "operatorId", (gnostic.openapi.v3.property) = {description: "操作者用户ID"}];// 操作者用户ID
}

// 更新用户 - 请求
message UpdateUserRequest {
  User data = 1;

  google.protobuf.FieldMask update_mask = 2 [
    json_name = "updateMask",
    (gnostic.openapi.v3.property) = {
      description: "要更新的字段列表",
      example: {yaml : "id,realname,username"}
    }
  ]; // 要更新的字段列表

  optional bool allow_missing = 3 [
    json_name = "allowMissing",
    (gnostic.openapi.v3.property) = {description: "如果设置为true的时候，资源不存在则会新增(插入)，并且在这种情况下`updateMask`字段将会被忽略。"}
  ]; // 如果设置为true的时候，资源不存在则会新增(插入)，并且在这种情况下`updateMask`字段将会被忽略。
}

// 删除用户 - 请求
message DeleteUserRequest {
  uint32 id = 1;

  uint32 operator_id = 2 [json_name = "operatorId", (gnostic.openapi.v3.property) = {description: "操作者用户ID"}];// 操作者用户ID
}
</code></pre>
<p>执行以下命令生成 Go 代码（项目已预设<code>make api</code>命令）：</p>
<pre><code class="hljs language-bash" lang="bash">make api
</code></pre>
<p>生成的代码会放在<code>api/gen/go/user/service/v1</code>目录下，供 <code>Data</code> 层和 <code>Service</code> 层调用。</p>
<h4 data-id="heading-10">2.4 Server 层绑定接口与 Service</h4>
<p><code>kratos-ent-example</code> 通过<code>NewRESTServer</code>方法完成 <code>HTTP Server</code> 的创建，并将 <code>UserService</code> 注册到 <code>Kratos</code> 的 <code>HTTP</code> 服务中，实现 API 接口与 <code>Service</code> 层的绑定。核心代码如下（文件路径：<code>app/user/service/internal/server/rest.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
	cfg *conf.Bootstrap, logger log.Logger,
	userService *service.UserService,
)</span></span> *http.Server {
	<span class="hljs-keyword">if</span> cfg == <span class="hljs-literal">nil</span> || cfg.Server == <span class="hljs-literal">nil</span> || cfg.Server.Rest == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	srv := bootstrap.CreateRestServer(cfg, logging.Server(logger))

	userV1.RegisterUserServiceHTTPServer(srv, userService)

	<span class="hljs-keyword">if</span> cfg.GetServer().GetRest().GetEnableSwagger() {
		swaggerUI.RegisterSwaggerUIServerWithOption(
			srv,
			swaggerUI.WithTitle(<span class="hljs-string">"Kratos Ent Example User Service API"</span>),
			swaggerUI.WithMemoryData(assets.OpenApiData, <span class="hljs-string">"yaml"</span>),
		)
	}

	<span class="hljs-keyword">return</span> srv
}
</code></pre>
<p>代码说明：</p>
<ol>
<li><code>bootstrap.CreateRestServer</code>：基于配置创建 Kratos 的 HTTP Server 实例，包含端口、中间件等基础配置；</li>
<li><code>userV1.RegisterUserServiceHTTPServer</code>：将实现了<code>UserService</code>接口的<code>userService</code>实例注册到 HTTP Server 中，完成 API 接口（如<code>/users</code>）与 <code>Service</code> 层方法的绑定；</li>
<li>Swagger 相关配置：可选开启 Swagger UI，方便调试 API 接口。</li>
</ol>
<p>此步骤无需手动修改代码（项目已实现），只需验证该文件存在且代码完整即可 —— 启动服务后，Kratos 会自动将 HTTP 请求转发到对应的 Service 层方法。</p>
<h3 data-id="heading-11">五、核心步骤 3：运行项目并测试 CRUD 接口</h3>
<p>所有代码修改完成后，启动项目并测试接口，验证 <code>go-curd</code> 与 <code>Ent</code> 的集成是否正常工作。</p>
<h4 data-id="heading-12">3.1 自动创建数据库表（Ent 迁移）</h4>
<p><code>kratos-ent-example</code> 已在<code>app/user/service/internal/data/ent_client.go</code>中实现 Ent 自动迁移逻辑，启动项目时会根据 schema 创建数据库表：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 关键迁移代码（项目已实现）</span>
<span class="hljs-keyword">if</span> cfg.Data.Database.GetMigrate() {
  <span class="hljs-keyword">if</span> err = client.Schema.Create(context.Background(), migrate.WithForeignKeys(<span class="hljs-literal">true</span>)); err != <span class="hljs-literal">nil</span> {
    l.Fatalf(<span class="hljs-string">"failed creating schema resources: %v"</span>, err)
  }
}
</code></pre>
<h4 data-id="heading-13">3.2 启动项目</h4>
<p>在项目的服务目录<code>app/user/service</code>下执行以下命令启动服务：</p>
<pre><code class="hljs language-bash" lang="bash">make run
</code></pre>
<p>看到终端输出类似以下日志，说明项目启动成功：</p>
<pre><code class="hljs language-bash" lang="bash">DEBUG msg=config loaded: data.yaml format: yaml
DEBUG msg=ent: connecting to postgres://postgres:***@localhost:5432/example?sslmode=<span class="hljs-built_in">disable</span>
DEBUG msg=ent: schema migrated successfully
</code></pre>
<h4 data-id="heading-14">3.3 测试接口（用 curl 或 Postman）</h4>
<p>以下用 curl 命令测试 4 个 CRUD 接口，确保功能正常：</p>
<h5 data-id="heading-15">1. 创建用户：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'POST'</span> \
  <span class="hljs-string">'http://localhost:7788/users'</span> \
  -H <span class="hljs-string">'accept: application/json'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
  "data": {
    "id": 0,
    "userName": "zhangsan",
    "nickName": "张三",
    "password": "123456"
  }
}'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//（ID为自动生成的主键）。</span>
  <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nickName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$2a$10$Jd34ATGgTJ2sV7xvPruMLONArXk9KYQ2O6XDY42UxVO37p5DO8CVu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"updatedAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-16">2. 查询用户（使用上面返回的ID=1）：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'GET'</span> \
  <span class="hljs-string">'http://localhost:7788/users/1'</span> \
  -H <span class="hljs-string">'accept: application/json'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nickName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$2a$10$Jd34ATGgTJ2sV7xvPruMLONArXk9KYQ2O6XDY42UxVO37p5DO8CVu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"updatedAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-17">3. 更新用户：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'PUT'</span> \
  <span class="hljs-string">'http://localhost:7788/users/1'</span> \
  -H <span class="hljs-string">'accept: application/json'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
  "data": {
    "id": 1,
    "userName": "zhangsan",
    "nickName": "张三三"
  }
}'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nickName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$2a$10$Jd34ATGgTJ2sV7xvPruMLONArXk9KYQ2O6XDY42UxVO37p5DO8CVu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"updatedAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-18">4. 删除用户：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'DELETE'</span> \
  <span class="hljs-string">'http://localhost:7788/users/1'</span> \
  -H <span class="hljs-string">'accept: */*'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">六、新手避坑注意事项</h3>
<ol>
<li><strong>Ent 代码生成必须执行</strong>：修改 schema 后必须运行<code>make ent</code>生成新代码，否则会报 “未定义字段 / 方法” 错误；</li>
<li><strong>数据库驱动适配</strong>：Ent 对不同数据库的字段类型支持有差异（如时间类型），schema 中需用<code>SchemaType</code>指定数据库特定类型；</li>
<li><strong>查询条件构建</strong>：Ent 的查询条件通过函数闭包实现（如<code>q.Where(ent.User.ID(1))</code>），与 GORM 的链式调用不同，需注意语法；</li>
<li><strong>go-curd 版本兼容</strong>：项目依赖的<code>github.com/tx7do/go-crud/entgo</code>版本需与 Ent 版本（项目中为 v0.14.5）匹配，否则可能出现方法不兼容；</li>
<li><strong>迁移操作谨慎执行</strong>：生产环境中，<code>migrate.WithForeignKeys(true)</code>可能导致表结构变更风险，建议先通过<code>ent migrate plan</code>预览变更。</li>
</ol>
<h3 data-id="heading-20">七、总结</h3>
<p>基于 <code>kratos-ent-example</code> 项目集成 <code>go-curd</code> 的核心逻辑是：<strong>在 Ent 自动生成的代码基础上，通过 go-curd 封装 CRUD 逻辑，减少重复的查询构建和结果映射工作</strong>。相比直接使用 Ent 原生 API，go-curd 让业务代码更简洁，尤其适合快速开发。</p>
<p>如果需要扩展其他模块（如订单、商品），只需复制用户模块的逻辑：定义 Ent schema→生成代码→用 go-curd 实现 CRUD→绑定 API 接口。若遇到问题，可参考项目的官方文档（<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">go-curd</a>、<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">kratos-ent-example</a>）获取更多细节。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[初学者友好：Go-Kratos 集成 go-crud，GORM ORM CRUD 无需重复编码，轻松上手]]></title>    <link>https://juejin.cn/post/7579800429375094834</link>    <guid>https://juejin.cn/post/7579800429375094834</guid>    <pubDate>2025-12-04T07:20:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579800429375094834" data-draft-id="7579573664230064137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="初学者友好：Go-Kratos 集成 go-crud，GORM ORM CRUD 无需重复编码，轻松上手"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2025-12-04T07:20:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            初学者友好：Go-Kratos 集成 go-crud，GORM ORM CRUD 无需重复编码，轻松上手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T07:20:11.000Z" title="Thu Dec 04 2025 07:20:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    47
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">初学者友好：Go-Kratos 集成 go-crud，GORM ORM CRUD 无需重复编码，轻松上手</h2>
<p>对于刚接触Go微服务开发的初学者来说，直接上手“框架+ORM”的组合常显复杂。而kratos-gorm-example项目已为我们搭建好了Go-Kratos与GORM的基础集成框架，本文将基于该项目，聚焦如何快速接入go-curd工具简化CRUD（增删改查）操作，全程以step-by-step的方式讲解，新手也能轻松跟随实操。</p>
<p>先明确核心工具关系：<code>kratos-gorm-example</code>是“基础骨架”（已整合Kratos与GORM），<code>go-curd</code>是“效率工具”（封装重复CRUD逻辑），我们的核心目标是“在现有骨架上装工具，让数据操作更简单”。</p>
<h3 data-id="heading-1">一、核心工具速览：3分钟理清分工</h3>
<p>在动手前，先明确三个工具的分工，避免越做越乱：</p>
<ul>
<li><strong>Go-Kratos</strong>微服务框架核心，负责API定义、服务启动、请求分发，kratos-gorm-example已完成其基础配置；</li>
<li><strong>GORM</strong>：ORM框架，实现Go结构体与数据库表的映射，kratos-gorm-example已完成数据库连接初始化；</li>
<li><strong>go-crud</strong>：GORM的上层封装工具，把重复的CRUD逻辑（如创建、查询、更新、删除）做成现成方法，无需手动编写GORM原生语句。</li>
</ul>
<h3 data-id="heading-2">二、环境准备：5分钟搞定前置依赖</h3>
<p>先完成基础环境搭建和项目准备，确保后续步骤无报错：</p>
<ol>
<li><strong>安装基础工具</strong>：要求 Go 1.19+（Kratos 最低支持版本），安装后用<code>go version</code>验证；</li>
<li><strong>Git</strong>：用于克隆示例项目；</li>
<li><strong>准备数据库</strong>：用 Postgresql（GORM 最常用的数据库），新建一个数据库（比如叫<code>example</code>），不用建表（后续 GORM 会自动建）；</li>
<li><strong>获取kratos-gorm-example项目：</strong>
<ul>
<li>打开终端，执行以下命令克隆项目并进入目录：<code>git clone https://github.com/tx7do/kratos-gorm-example.git</code></li>
<li><code>cd kratos-gorm-example</code></li>
</ul>
</li>
<li><strong>引入go-curd依赖：</strong> 在项目根目录执行命令，拉取go-curd的GORM适配模块：<code>go get github.com/tx7do/go-curd/gorm</code></li>
<li><strong>确认项目核心目录：</strong> 无需关注所有文件，重点记住3个核心目录（kratos-gorm-example已预设）：
<ul>
<li><code>api</code>：放 API 定义文件（.proto），用来定义 “创建用户”、“查询用户” 等接口；</li>
<li><code>app/user/service/internal/data/models</code>：放数据库模型（和 MySQL 表对应）；</li>
<li><code>app/user/service/internal/data</code>：放业务逻辑，这里会调用 go-crud 做 CRUD。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">三、核心步骤1：在kratos-gorm-example中集成go-curd</h3>
<p>kratos-gorm-example已完成GORM的初始化配置，我们只需在现有基础上，将go-curd客户端集成进来，让业务层可以调用其简化方法。</p>
<h4 data-id="heading-4">1.1 修改数据层：集成go-curd客户端</h4>
<p>打开<code>app/user/service/internal/data/user.go</code>修改代码以集成<code>go-curd</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">import</span> (
  gormCurd <span class="hljs-string">"github.com/tx7do/go-crud/gorm"</span>
)

<span class="hljs-keyword">type</span> UserRepo <span class="hljs-keyword">struct</span> {
	data *Data
	log  *log.Helper

	mapper     *mapper.CopierMapper[userV1.User, models.User]
	repository *gormCurd.Repository[userV1.User, models.User]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserRepo</span><span class="hljs-params">(data *Data, logger log.Logger)</span></span> *UserRepo {
	l := log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"user/repo/user-service"</span>))
	repo := &amp;UserRepo{
		data:   data,
		log:    l,
		mapper: mapper.NewCopierMapper[userV1.User, models.User](),
	}

	repo.repository = gormCurd.NewRepository[userV1.User, models.User](
		repo.mapper,
	)

	repo.init()

	<span class="hljs-keyword">return</span> repo
}
</code></pre>
<p>核心改动说明：新增<code>repository</code>字段存储<code>go-curd</code>客户端，通过<code>gormCurd.NewRepository()</code>初始化，提供方法供业务层调用。</p>
<h4 data-id="heading-5">1.2 确认数据库配置（无需修改，仅验证）</h4>
<p>kratos-gorm-example已在<code>configs/data.yaml</code>中配置好数据库连接，打开文件验证：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">data:</span>
  <span class="hljs-attr">database:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">"postgres"</span>
    <span class="hljs-attr">source:</span> <span class="hljs-string">"host=localhost port=5432 user=postgres password=*Abcd123456 dbname=example sslmode=disable"</span>
    <span class="hljs-attr">migrate:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>注意：将<code>source</code>中的<code>user=postgres password=*Abcd123456</code>改为自己的PostgreSQL用户名和密码，确保能连接到之前新建的<code>example</code>数据库。</p>
<h3 data-id="heading-6">四、核心步骤2：用go-curd实现CRUD业务逻辑</h3>
<p>我们将以“用户模块”为例，基于项目现有的目录结构，用go-curd实现用户的增、删、改、查。kratos-gorm-example已预设部分基础代码，我们只需补充和修改。</p>
<h4 data-id="heading-7">2.1 定义用户模型（Model）</h4>
<p>打开<code>app/user/service/internal/data/models/user.go</code>，定义<code>User</code>结构体（对应数据库中的的<code>users表</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> models

<span class="hljs-keyword">import</span> <span class="hljs-string">"gorm.io/gorm"</span>

<span class="hljs-comment">// User 用户信息表</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
	gorm.Model

	UserName <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:username;comment:'账号名'"`</span>
	NickName <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:nickname;comment:'昵称'"`</span>
	Password <span class="hljs-type">string</span> <span class="hljs-string">`gorm:"column:password;comment:'登录密码'"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> TableName() <span class="hljs-type">string</span> {
	<span class="hljs-keyword">return</span> <span class="hljs-string">"users"</span>
}
</code></pre>
<p>说明：GORM会根据该结构体自动创建数据库表，后续我们会通过go-curd操作该模型。</p>
<h4 data-id="heading-8">2.2 编写Data层：用go-curd实现CRUD</h4>
<p>打开<code>app/user/service/internal/data/user.go</code>，编写业务逻辑方法。核心优势：用go-curd的现成方法替代原生GORM代码，减少重复工作。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> List(ctx context.Context, req *pagination.PagingRequest) (*userV1.ListUserResponse, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	ret, err := r.repository.ListWithPaging(ctx, r.data.db, req)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}
	<span class="hljs-keyword">if</span> ret == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> &amp;userV1.ListUserResponse{Total: <span class="hljs-number">0</span>, Items: <span class="hljs-literal">nil</span>}, <span class="hljs-literal">nil</span>
	}

	<span class="hljs-keyword">return</span> &amp;userV1.ListUserResponse{
		Total: ret.Total,
		Items: ret.Items,
	}, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Get(ctx context.Context, req *userV1.GetUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">var</span> whereCond *gorm.DB
	<span class="hljs-keyword">switch</span> req.QueryBy.(<span class="hljs-keyword">type</span>) {
	<span class="hljs-keyword">case</span> *userV1.GetUserRequest_Id:
		whereCond = r.data.db.Where(<span class="hljs-string">"id = ?"</span>, req.GetId())
	<span class="hljs-keyword">case</span> *userV1.GetUserRequest_UserName:
		whereCond = r.data.db.Where(<span class="hljs-string">"user_name = ?"</span>, req.GetUserName())
	<span class="hljs-keyword">default</span>:
		whereCond = r.data.db.Where(<span class="hljs-string">"id = ?"</span>, req.GetId())
	}

	dto, err := r.repository.Get(ctx, whereCond, req.GetViewMask())
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
	}

	<span class="hljs-keyword">return</span> dto, err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Create(ctx context.Context, req *userV1.CreateUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> || req.Data == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> &amp;&amp; req.Data.GetPassword() != <span class="hljs-string">""</span> {
		cryptoPassword, err := crypto.HashPassword(req.Data.GetPassword())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		req.Data.Password = &amp;cryptoPassword
	}

	result, err := r.repository.Create(ctx, r.data.db, req.Data, <span class="hljs-literal">nil</span>)

	<span class="hljs-keyword">return</span> result, err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Update(ctx context.Context, req *userV1.UpdateUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> || req.Data == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> &amp;&amp; req.Data.GetPassword() != <span class="hljs-string">""</span> {
		cryptoPassword, err := crypto.HashPassword(req.Data.GetPassword())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		req.Data.Password = &amp;cryptoPassword
	}

	result, err := r.repository.Update(ctx, r.data.db, req.Data, req.GetUpdateMask())

	<span class="hljs-keyword">return</span> result, err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Upsert(ctx context.Context, req *userV1.UpdateUserRequest) (*userV1.User, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> || req.Data == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	<span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>

	<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> &amp;&amp; req.Data.GetPassword() != <span class="hljs-string">""</span> {
		cryptoPassword, err := crypto.HashPassword(req.Data.GetPassword())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		req.Data.Password = &amp;cryptoPassword
	}

	result, err := r.repository.Upsert(ctx, r.data.db, req.Data, req.GetUpdateMask())

	<span class="hljs-keyword">return</span> result, err
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> Delete(ctx context.Context, req *userV1.DeleteUserRequest) (<span class="hljs-type">bool</span>, <span class="hljs-type">error</span>) {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, errors.New(<span class="hljs-string">"request is nil"</span>)
	}

	result, err := r.repository.Delete(ctx, r.data.db.Where(<span class="hljs-string">"id = ?"</span>, req.GetId()))

	<span class="hljs-keyword">return</span> result &gt; <span class="hljs-number">0</span>, err
}
</code></pre>
<p>核心简化点：对比原生GORM，go-curd的<code>List</code>、<code>Get</code>、<code>Create</code>、<code>Update</code>、<code>Upsert</code>、<code>Delete</code>方法无需编写查询条件，直接传入上下文、模型实例和ID即可，代码更简洁。</p>
<h4 data-id="heading-9">2.3 定义API接口（Proto）并生成代码</h4>
<p><code>kratos-gorm-example</code>已在<code>api/protos/user/service/v1/user.proto</code>中预设了用户API定义，我们只需确认内容（无需修改），然后生成Go代码：</p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";

package user.service.v1;

import "gnostic/openapi/v3/annotations.proto";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

import "google/api/annotations.proto";

import "pagination/v1/pagination.proto";

// 用户服务
service UserService {
  // 查询用户列表
  rpc ListUser (pagination.PagingRequest) returns (ListUserResponse) {
    option (google.api.http) = {
      get: "/users"
      additional_bindings {
        post: "/users/list"
        body: "*"
      }
    };
  }

  // 查询用户详情
  rpc GetUser (GetUserRequest) returns (User) {
    option (google.api.http) = {
      get: "/users/{id}"
      additional_bindings {
        get: "/users/username/{user_name}"
      }
    };
  }

  // 创建用户
  rpc CreateUser (CreateUserRequest) returns (User) {
    option (google.api.http) = {
      post: "/users"
      body: "*"
    };
  }

  // 更新用户
  rpc UpdateUser (UpdateUserRequest) returns (User) {
    option (google.api.http) = {
      put: "/users/{data.id}"
      body: "*"
    };
  }

  // 删除用户
  rpc DeleteUser (DeleteUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/users/{id}"
    };
  }
}

// 用户
message User {
  uint32 id = 1;

  optional string user_name = 2 [json_name = "userName", (gnostic.openapi.v3.property) = {description: "账户名"}];// 账户名
  optional string nick_name = 3 [json_name = "nickName", (gnostic.openapi.v3.property) = {description: "昵称"}];// 昵称
  optional string password = 4 [json_name = "password", (gnostic.openapi.v3.property) = {description: "密码"}];// 密码

  optional google.protobuf.Timestamp created_at = 200 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "创建时间"}];// 创建时间
  optional google.protobuf.Timestamp updated_at = 201 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "更新时间"}];// 更新时间
  optional google.protobuf.Timestamp deleted_at = 202 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "删除时间"}];// 删除时间
}

// 获取用户列表 - 答复
message ListUserResponse {
  repeated User items = 1;
  uint64 total = 2;
}

// 获取用户数据 - 请求
message GetUserRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "用户ID", read_only: true},
      json_name = "id"
    ]; // 用户ID

    string user_name = 2 [
      (gnostic.openapi.v3.property) = {description: "用户登录名", read_only: true},
      json_name = "userName"
    ]; // 用户登录名
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "视图字段过滤器，用于控制返回的字段"
    }
  ]; // 视图字段过滤器，用于控制返回的字段
}

// 创建用户 - 请求
message CreateUserRequest {
  User data = 1;

  uint32 operator_id = 2 [json_name = "operatorId", (gnostic.openapi.v3.property) = {description: "操作者用户ID"}];// 操作者用户ID
}

// 更新用户 - 请求
message UpdateUserRequest {
  User data = 1;

  google.protobuf.FieldMask update_mask = 2 [
    json_name = "updateMask",
    (gnostic.openapi.v3.property) = {
      description: "要更新的字段列表",
      example: {yaml : "id,realname,username"}
    }
  ]; // 要更新的字段列表

  optional bool allow_missing = 3 [
    json_name = "allowMissing",
    (gnostic.openapi.v3.property) = {description: "如果设置为true的时候，资源不存在则会新增(插入)，并且在这种情况下`updateMask`字段将会被忽略。"}
  ]; // 如果设置为true的时候，资源不存在则会新增(插入)，并且在这种情况下`updateMask`字段将会被忽略。
}

// 删除用户 - 请求
message DeleteUserRequest {
  uint32 id = 1;

  uint32 operator_id = 2 [json_name = "operatorId", (gnostic.openapi.v3.property) = {description: "操作者用户ID"}];// 操作者用户ID
}
</code></pre>
<p>执行以下命令生成Go代码（项目已预设<code>make api</code>命令）：</p>
<pre><code class="hljs language-bash" lang="bash">make api
</code></pre>
<p>生成的代码会放在<code>api/gen/go/user/service/v1</code>目录下，供<code>Data层</code>和<code>Service层</code>调用。</p>
<h4 data-id="heading-10">2.4 Server 层绑定接口与 Service</h4>
<p><code>kratos-gorm-example</code> 通过<code>NewRESTServer</code>方法完成 <code>HTTP Server</code> 的创建，并将 <code>UserService</code> 注册到 <code>Kratos</code> 的 <code>HTTP</code> 服务中，实现 API 接口与 <code>Service</code> 层的绑定。核心代码如下（文件路径：<code>app/user/service/internal/server/rest.go</code>）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// NewRESTServer new an HTTP server.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(
	cfg *conf.Bootstrap, logger log.Logger,
	userService *service.UserService,
)</span></span> *http.Server {
	<span class="hljs-keyword">if</span> cfg == <span class="hljs-literal">nil</span> || cfg.Server == <span class="hljs-literal">nil</span> || cfg.Server.Rest == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	srv := bootstrap.CreateRestServer(cfg, logging.Server(logger))

	userV1.RegisterUserServiceHTTPServer(srv, userService)

	<span class="hljs-keyword">if</span> cfg.GetServer().GetRest().GetEnableSwagger() {
		swaggerUI.RegisterSwaggerUIServerWithOption(
			srv,
			swaggerUI.WithTitle(<span class="hljs-string">"Kratos GORM Example User Service API"</span>),
			swaggerUI.WithMemoryData(assets.OpenApiData, <span class="hljs-string">"yaml"</span>),
		)
	}

	<span class="hljs-keyword">return</span> srv
}
</code></pre>
<p>代码说明：</p>
<ol>
<li><code>bootstrap.CreateRestServer</code>：基于配置创建 Kratos 的 HTTP Server 实例，包含端口、中间件等基础配置；</li>
<li><code>userV1.RegisterUserServiceHTTPServer</code>：将实现了<code>UserService</code>接口的<code>userService</code>实例注册到 HTTP Server 中，完成 API 接口（如<code>/users</code>）与 <code>Service</code> 层方法的绑定；</li>
<li>Swagger 相关配置：可选开启 Swagger UI，方便调试 API 接口。</li>
</ol>
<p>此步骤无需手动修改代码（项目已实现），只需验证该文件存在且代码完整即可 —— 启动服务后，Kratos 会自动将 HTTP 请求转发到对应的 Service 层方法。</p>
<h3 data-id="heading-11">五、核心步骤3：运行项目并测试CRUD接口</h3>
<p>所有代码修改完成后，启动项目并测试接口，验证go-curd是否正常工作。</p>
<h4 data-id="heading-12">3.1 自动创建数据库表（GORM自动迁移）</h4>
<p><code>kratos-gorm-example</code>已在<code>app/user/service/internal/data/gorm_client.go</code>中实现了GORM自动迁移逻辑，启动项目时会自动根据<code>User模型</code>创建<code>users表</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 关键迁移代码（项目已实现）</span>
<span class="hljs-keyword">if</span> err := data.DB().AutoMigrate(
  &amp;model.User{}, <span class="hljs-comment">// 自动迁移User模型到数据库表</span>
); err != <span class="hljs-literal">nil</span> {
  log.Error(<span class="hljs-string">"迁移数据库表失败："</span>, err)
  <span class="hljs-keyword">return</span> err
}
</code></pre>
<h4 data-id="heading-13">3.2 启动项目</h4>
<p>在项目的服务目录<code>app/user/service</code>下执行以下命令启动服务：</p>
<pre><code class="hljs language-bash" lang="bash">make run
</code></pre>
<p>看到终端输出下面的文本或类似日志，说明项目启动成功：</p>
<pre><code class="hljs language-bash" lang="bash">DEBUG msg=config loaded: client.yaml format: yaml
DEBUG msg=config loaded: data.yaml format: yaml
DEBUG msg=config loaded: logger.yaml format: yaml
DEBUG msg=config loaded: server.yaml format: yaml
DEBUG msg=config loaded: tracer.yaml format: yaml
</code></pre>
<h4 data-id="heading-14">3.3 测试接口（用curl或Postman）</h4>
<p>以下用curl命令测试4个CRUD接口，确保功能正常：</p>
<h5 data-id="heading-15">1. 创建用户：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'POST'</span> \
  <span class="hljs-string">'http://localhost:7788/users'</span> \
  -H <span class="hljs-string">'accept: application/json'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
  "data": {
    "id": 0,
    "userName": "zhangsan",
    "nickName": "张三",
    "password": "123456"
  }
}'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//（ID为自动生成的主键）。</span>
  <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nickName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$2a$10$Jd34ATGgTJ2sV7xvPruMLONArXk9KYQ2O6XDY42UxVO37p5DO8CVu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"updatedAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-16">2. 查询用户（使用上面返回的ID=1）：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'GET'</span> \
  <span class="hljs-string">'http://localhost:7788/users/1'</span> \
  -H <span class="hljs-string">'accept: application/json'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nickName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$2a$10$Jd34ATGgTJ2sV7xvPruMLONArXk9KYQ2O6XDY42UxVO37p5DO8CVu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"updatedAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-17">3. 更新用户：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'PUT'</span> \
  <span class="hljs-string">'http://localhost:7788/users/1'</span> \
  -H <span class="hljs-string">'accept: application/json'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
  "data": {
    "id": 1,
    "userName": "zhangsan",
    "nickName": "张三三"
  }
}'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"userName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"nickName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三三"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"password"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$2a$10$Jd34ATGgTJ2sV7xvPruMLONArXk9KYQ2O6XDY42UxVO37p5DO8CVu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"createdAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"updatedAt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1970-01-01T00:00:00Z"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-18">4. 删除用户：</h5>
<pre><code class="hljs language-bash" lang="bash">curl -X <span class="hljs-string">'DELETE'</span> \
  <span class="hljs-string">'http://localhost:7788/users/1'</span> \
  -H <span class="hljs-string">'accept: */*'</span>
</code></pre>
<p>成功响应：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">六、新手避坑注意事项</h3>
<ol>
<li>
<p><strong>依赖版本兼容</strong>：go-curd仅支持GORM v2版本，kratos-gorm-example已使用GORM v2，无需额外调整；若手动升级依赖，避免安装GORM v1。</p>
</li>
<li>
<p><strong>数据库配置错误</strong>：务必修改<code>configs/data.yaml</code>中的<code>source</code>字段，确保MySQL用户名、密码、数据库名正确，否则会出现连接失败错误。</p>
</li>
<li>
<p><strong>模型字段与Proto类型匹配</strong>：Proto中的<code>age</code>是<code>int32</code>类型，Model中的<code>Age</code>需对应<code>int32</code>（而非<code>int</code>），否则会出现类型转换错误。</p>
</li>
<li>
<p><strong>go-curd方法调用规范</strong>：调用<code>Get</code>、<code>Delete</code>时，第二个参数必须是模型实例的指针（如<code>&amp;user</code>），不能直接传结构体。</p>
</li>
<li>
<p><strong>自动迁移仅用于开发环境</strong>：GORM的<code>AutoMigrate</code>仅适合开发阶段快速创建表，生产环境建议使用数据库迁移工具（如<code>gorm-migrate</code>）管理表结构。</p>
</li>
</ol>
<h3 data-id="heading-20">七、总结</h3>
<p>基于kratos-gorm-example项目集成go-curd的核心逻辑非常简单：<strong>在现有GORM连接基础上初始化go-curd客户端，然后用其封装的现成方法替代原生GORM CRUD代码</strong>。相比直接编写GORM代码，go-curd帮我们节省了大量重复工作，让业务逻辑更简洁。</p>
<p>如果需要扩展其他模块（如订单、商品），只需复制用户模块的逻辑：定义模型→在Service层用go-curd实现CRUD→绑定API接口即可。若遇到问题，可参考两个项目的官方GitHub文档（<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">go-curd</a>、<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">kratos-gorm-example</a>）获取更多细节。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SQL 语法速查手册：前端开发者的学习笔记]]></title>    <link>https://juejin.cn/post/7579673620939620402</link>    <guid>https://juejin.cn/post/7579673620939620402</guid>    <pubDate>2025-12-03T22:48:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579673620939620402" data-draft-id="7579441333167095817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SQL 语法速查手册：前端开发者的学习笔记"/> <meta itemprop="keywords" content="前端,数据库,SQL"/> <meta itemprop="datePublished" content="2025-12-03T22:48:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="copyer_xyf"/> <meta itemprop="url" content="https://juejin.cn/user/2823965976323016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SQL 语法速查手册：前端开发者的学习笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2823965976323016/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    copyer_xyf
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T22:48:15.000Z" title="Wed Dec 03 2025 22:48:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p>最近在写 Next.js + Supabase 的一个练手项目，突然又接触到了 SQL（虽然 Supabase 是通过类似 ORM 来操作数据库的），突然感觉 SQL 语法又陌生了。</p>
<p>真是学了不用，等于白学。</p>
<p>之前写过一篇<a href="https://juejin.cn/post/7181086487226613797" target="_blank" title="https://juejin.cn/post/7181086487226613797">一个前端小白，学习 SQL 语句</a>，现在回头看，自己都看懵了，真的尬住了。</p>
<p>算了，重新整理一遍吧，并通过一个实战案例来巩固基础。</p>
<h2 data-id="heading-0">邂逅</h2>
<p><code>SQL</code>： Structured Query Language，称为结构化查询语句，简称 SQL。</p>
<h2 data-id="heading-1">SQL 编写规范</h2>
<ol>
<li>关键词建议使用大写，比如 <code>CREATE</code>、<code>TABLE</code>（小写也可以，但大写更规范）</li>
<li>语句末尾加分号</li>
<li>如果表名或字段名是 SQL 关键词，用反引号 <code>`</code> 包裹</li>
<li>表名用单数，字段名用蛇形命名（下划线分隔，如 <code>user_id</code>）</li>
</ol>
<h2 data-id="heading-2">SQL 分类</h2>






























<table><thead><tr><th>分类</th><th>描述</th><th>常见命令/关键字</th></tr></thead><tbody><tr><td><strong>DDL</strong></td><td><strong>定义</strong>或<strong>修改</strong>数据库结构（库、表、索引、视图等）</td><td><code>CREATE</code>、<code>DROP</code>、<code>ALTER</code>、<code>TRUNCATE</code>、<code>RENAME</code></td></tr><tr><td><strong>DML</strong></td><td>对<strong>表中的记录</strong>进行增、删、改</td><td><code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code>、<code>MERGE</code></td></tr><tr><td><strong>DQL</strong></td><td>对<strong>表中的记录</strong>进行查询</td><td><code>SELECT</code>（以及配套子句 <code>WHERE</code>、<code>GROUP BY</code>、<code>ORDER BY</code>、<code>JOIN</code> 等）</td></tr><tr><td><strong>DCL</strong></td><td><strong>权限</strong>与<strong>访问控制</strong>（授予、回收）</td><td><code>GRANT</code>、<code>REVOKE</code></td></tr></tbody></table>
<ul>
<li><strong>DDL</strong>（Data Definition Language）：数据定义语言，-----&gt; 管"结构"</li>
<li><strong>DML</strong>（Data Manipulation Language）：数据操作语言，-----&gt; 管"改数据"</li>
<li><strong>DQL</strong>（Data Query Language）：数据查询语言，-----&gt; 管"查数据"</li>
<li><strong>DCL</strong>（Data Control Language）：数据控制语言，-----&gt; 管"权限"</li>
</ul>
<blockquote>
<p>为了阅读方便，下面的 SQL 语句都用小写，但实际开发中推荐关键词用大写</p>
</blockquote>
<h2 data-id="heading-3">SQL 类型</h2>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f4c91ddacbb47499df5c9277ea8688f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=rgRrHYCWNXAOy6aTYaY6kE4Mgng%3D" alt="type.png" width="100%" loading="lazy"/>
<p>实际开发中常用的类型：</p>
<ul>
<li><code>int</code>：存储整数</li>
<li><code>varchar(100)</code>: 存储变长字符串，可以指定长度</li>
<li><code>char</code>：定长字符串，不够的自动在末尾填充空格</li>
<li><code>double</code>：存储浮点数</li>
<li><code>date</code>：存储日期 2023-05-27</li>
<li><code>time</code>：存储时间 10:13</li>
<li><code>datetime</code>：存储日期和时间 2023-05-27 10:13</li>
<li><code>timestamp</code>：存储日期时间的，但是范围小一点，而且会转为中央时区 UTC 的时间来存储</li>
<li><code>text</code>：存储长文本</li>
</ul>
<p>SQL 设计了这么多数据类型，一是为了存储更丰富的信息，二是为了节省存储空间。<strong>不常用的类型，用到时再查就行</strong>。</p>
<h2 data-id="heading-4">表约束</h2>
<ul>
<li>
<p><code>primary key</code>: 主键</p>
<ul>
<li>主键是表中唯一的索引</li>
<li>必须是 not null; 如果没有设置，mysql 也会自动设置；</li>
<li>联合主键，多个字段合成的主键</li>
<li>尽量不要使用业务主键</li>
</ul>
</li>
<li>
<p><code>unique</code>: 唯一；除了主键以外，针对某些字段，也是唯一的。</p>
</li>
<li>
<p><code>not null</code>: 字段不能为空</p>
</li>
<li>
<p><code>default</code>: 默认值</p>
</li>
<li>
<p><code>auto_increment</code>: 自动增长；</p>
</li>
<li>
<p><code>foreign key</code>: 外键，与其他表的字段关联</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> yyy(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">unique</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  age <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">18</span>,
  num <span class="hljs-type">int</span> auto_increment,
  homeId <span class="hljs-type">int</span>, <span class="hljs-comment">-- 外键</span>
  <span class="hljs-keyword">foreign</span> key (homeId) <span class="hljs-keyword">references</span> home(id) <span class="hljs-comment">-- 关联 home 表的 id</span>
)
</code></pre>
<h2 data-id="heading-5">DDL（管结构）</h2>
<p>库操作</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看所有数据库</span>
<span class="hljs-keyword">show</span> databases;
​
<span class="hljs-comment">-- 使用数据库 co_blog</span>
use co_blog;
​
<span class="hljs-comment">-- 查看选择的数据库</span>
<span class="hljs-keyword">select</span> database();
​
<span class="hljs-comment">-- 创建数据库</span>
<span class="hljs-keyword">create</span> database if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> co_blog; <span class="hljs-comment">-- 先判断 co_blog 库是否存在，不存在则创建</span>
<span class="hljs-keyword">create</span> database co_blog; <span class="hljs-comment">-- 若存在，会报错；</span>
​
<span class="hljs-comment">-- 删除数据库</span>
<span class="hljs-keyword">drop</span> database if <span class="hljs-keyword">exists</span> co_blog;
<span class="hljs-keyword">drop</span> database co_blog; <span class="hljs-comment">-- 数据库不存在，会报错</span>
use co_blog; <span class="hljs-comment">-- 使用 co_blog 库，后续表操作都在这个库下</span>
</code></pre>
<p>表操作</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看库中所有的表</span>
<span class="hljs-keyword">show</span> tables;
​
<span class="hljs-comment">-- 创建一张表</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span>(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key auto_increment,
  name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>),
  age <span class="hljs-type">int</span>
);
​
<span class="hljs-comment">-- 查看表结构</span>
<span class="hljs-keyword">desc</span> <span class="hljs-keyword">user</span>; <span class="hljs-comment">-- 显示表的字段定义信息</span>
​
<span class="hljs-comment">-- 删除 user 表</span>
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> <span class="hljs-keyword">user</span>;
​
<span class="hljs-comment">-- 修改 user 表</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> rename <span class="hljs-keyword">to</span> users;             <span class="hljs-comment">-- 修改表名 user 变成 users</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">add</span> height <span class="hljs-type">int</span>;              <span class="hljs-comment">-- 添加 height 字段，为 int 类型；</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> change height newHeight <span class="hljs-type">int</span>; <span class="hljs-comment">-- height 改为 newHeight, 类型也可以重新定义</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> modify height <span class="hljs-type">bigint</span>;        <span class="hljs-comment">-- 类型 int 变为 bigint</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">drop</span> height;                 <span class="hljs-comment">-- 删除 height 字段</span>
</code></pre>
<h2 data-id="heading-6">DML（管改数据）</h2>
<p><strong>增删改</strong></p>
<p>插入数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 插入单条数据</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(username, emails) <span class="hljs-keyword">values</span>(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>);
​
<span class="hljs-comment">-- 插入多条数据</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(username, emails)
  <span class="hljs-keyword">values</span>
    (<span class="hljs-string">'admin'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>),
    (<span class="hljs-string">'admin2'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>),
    (<span class="hljs-string">'admin3'</span>, <span class="hljs-string">'xxxx@xxxx.com'</span>);
</code></pre>
<p>更新数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">update</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">set</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三1'</span>, age <span class="hljs-operator">=</span> <span class="hljs-number">19</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>删除数据</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-7">DQL（管查询）</h2>
<p>查询语句的执行顺序：先筛选数据，再分组过滤，然后排序，最后分页。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
  <span class="hljs-keyword">FROM</span> table_name
  <span class="hljs-keyword">WHERE</span>    xxx
  <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> xxx
  <span class="hljs-keyword">HAVING</span>   xxx
  <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> xxx
  LIMIT    xxx;
</code></pre>
<h4 data-id="heading-8">取别名 as</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询所有字段</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;
​
<span class="hljs-comment">-- 查询指定字段并取别名</span>
<span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">as</span> c_age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;
​
<span class="hljs-comment">-- 别名的作用：多表查询时避免字段名冲突</span>
</code></pre>
<h4 data-id="heading-9">比较运算符</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 比较运算符：&gt;、&lt;、=、!=、&gt;=、&lt;=</span>

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;  <span class="hljs-comment">-- 年龄大于 20</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">!=</span> <span class="hljs-number">20</span>; <span class="hljs-comment">-- 年龄不等于 20</span>
</code></pre>
<h4 data-id="heading-10">逻辑运算符</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- name 为 张三，且 age 大于 10</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- name 为 张三，或者 age 大于 10</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span> <span class="hljs-operator">||</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- age 在 10 到 20 岁间的</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> <span class="hljs-number">20</span>;
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;=</span><span class="hljs-number">10</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">20</span>;

<span class="hljs-comment">-- age 为 10 或 20 的（in 的相反是 not in）</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-keyword">in</span> (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
</code></pre>
<h4 data-id="heading-11">模糊搜索 like</h4>
<ul>
<li><code>%</code>: 任意多个字符</li>
<li><code>_</code>: 任意一个字符</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">'t%'</span>;   <span class="hljs-comment">-- 以 t 开头</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">'%t%'</span>;   <span class="hljs-comment">-- 包含 t</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">'_t%'</span>;   <span class="hljs-comment">-- 第二个字符是 t</span>
</code></pre>
<h4 data-id="heading-12">排序 order by</h4>
<ul>
<li><code>asc</code>：升序（默认，可省略）</li>
<li><code>desc</code>：降序</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>;  <span class="hljs-comment">-- 年龄升序</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">desc</span>; <span class="hljs-comment">-- 年龄降序</span>
</code></pre>
<h4 data-id="heading-13">限制分页 limit</h4>
<ul>
<li>limit 数据条数 offset 偏移量 (推荐)</li>
<li>limit 偏移量，数据条数 （不推荐）</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- limit 数据条数 offset 偏移量 (推荐)</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit <span class="hljs-number">30</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">10</span>;

<span class="hljs-comment">-- limit 偏移量，数据条数 (不推荐)</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit <span class="hljs-number">10</span>, <span class="hljs-number">30</span>;

<span class="hljs-comment">-- 前端格式</span>
const pages <span class="hljs-operator">=</span> {
  <span class="hljs-keyword">current</span>: <span class="hljs-number">3</span>,
  pageSize: <span class="hljs-number">10</span>,
};

<span class="hljs-comment">-- 后端查询</span>
const offsetNum <span class="hljs-operator">=</span> (pages.current <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-operator">*</span> pages.pageSize;
const limitNum <span class="hljs-operator">=</span> pages.pageSize;

<span class="hljs-comment">-- sql</span>
const <span class="hljs-keyword">sql</span> <span class="hljs-operator">=</span> `<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> users limit ${limitNum} <span class="hljs-keyword">offset</span> ${offsetNum}`;
</code></pre>
<h4 data-id="heading-14">聚合函数</h4>
<p><code>聚合函数</code>： 先收集到一起，然后对收集的结果进行操作。（看成一组）</p>
<ul>
<li><code>avg</code>：平均值</li>
<li><code>max</code>：最大值</li>
<li><code>min</code>：最小值</li>
<li><code>sum</code>：求和</li>
<li><code>count</code>：计数（统计行数）</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 平均值</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">as</span> avg_age <span class="hljs-keyword">from</span> users;

<span class="hljs-comment">-- 计算人数</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> count <span class="hljs-keyword">from</span> users;

<span class="hljs-comment">-- 最大值</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">as</span> maxAge <span class="hljs-keyword">from</span> users;

<span class="hljs-comment">-- 求和</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(age) <span class="hljs-keyword">as</span> sumAge <span class="hljs-keyword">from</span> users;
</code></pre>
<p>SQL 还有很多内置函数：</p>
<ul>
<li>聚合函数：avg、count、sum、min、max</li>
<li>字符串函数：concat、substr、length、upper、lower</li>
<li>数值函数：round、ceil、floor、abs、mod</li>
<li>日期函数：year、month、day、date、time</li>
<li>条件函数：if、case</li>
<li>系统函数：version、database、user</li>
<li>类型转换函数：convert、cast、date_format、str_to_date</li>
<li>其他函数：nullif、coalesce、greatest、least</li>
</ul>
<p>实际开发中，聚合函数最常用的是<strong>统计</strong>和<strong>分组</strong>，其他函数用到时再查就行。</p>
<h4 data-id="heading-15">分组 group by</h4>
<p><code>聚合函数</code>看成一组；有时需要进行分组，然后进行操作。</p>
<p><code>使用建议</code>：group by 一定要配合聚合函数使用，不然分组没有意义（除非整张表都看成一个聚合函数，就不需要使用 group by）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 统计男女个数</span>
<span class="hljs-keyword">select</span> sex, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> num <span class="hljs-keyword">from</span> users <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sex;
</code></pre>
<h4 data-id="heading-16">分组筛选条件 having</h4>
<p>在进行分组的时候，有时也需要过滤条件。</p>
<p>但是 <code>group by</code> 与 <code>where</code> 不能一起使用，语法报错。取而代之的是 <code>having</code>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 根据 sex 性别进行分组，然后筛选出 count 大于 2</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> count, sex <span class="hljs-keyword">from</span> users <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sex <span class="hljs-keyword">having</span> count <span class="hljs-operator">&gt;</span> <span class="hljs-number">2</span>;
</code></pre>
<h4 data-id="heading-17">去重 distinct</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> age <span class="hljs-keyword">from</span> users;
</code></pre>
<h4 data-id="heading-18">多表</h4>
<h5 data-id="heading-19">外键添加</h5>
<p>创建表时添加外键：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> users(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key,
  name <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  role_id <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id)
);
</code></pre>
<p>已有表添加外键：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> role_id <span class="hljs-type">int</span>;
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id);
</code></pre>
<h5 data-id="heading-20">外键删除（更新）</h5>
<p>表之间有关联后，不能直接删除或更新，否则会影响关联表。需要设置级联操作：要么一起更新，要么一起删除。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 一起更新一起删除</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE;
</code></pre>
<p><strong>删除外键</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> users; <span class="hljs-comment">-- 查看外键名称</span>
<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> key users_ibfk_1;
</code></pre>
<p>如果存在多个外键：</p>
<ul>
<li>users_ibfk_1</li>
<li>users_ibfk_2</li>
<li>...</li>
</ul>
<p><strong>重新绑定外键</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> users <span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> key (role_id) <span class="hljs-keyword">references</span> role(id)
                                           <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> cascade
                                           <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> cascade;
</code></pre>
<h5 data-id="heading-21">多表查询</h5>
<p>多表查询时，表之间必须有联系（通常是外键）。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users, team;
</code></pre>
<p>这样查询会产生大量无用数据，因为这是<strong>笛卡尔积</strong>（每行数据都会组合）。</p>
<h5 data-id="heading-22">表连接</h5>
<ul>
<li>左连接（<code>left join</code>）: 常用</li>
<li>右连接（<code>right join</code>）: 不常用</li>
<li>内连接（<code>[cross/inner] join</code>）: 常用</li>
<li>全连接（mysql 不支持全连接，需要 union）： 不常用</li>
</ul>
<p><strong>左右</strong>指的是以哪张表为主，展示该表的所有数据。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">from</span> 左表 [<span class="hljs-keyword">left</span><span class="hljs-operator">/</span><span class="hljs-keyword">right</span>] <span class="hljs-keyword">join</span> 右表
</code></pre>
<blockquote>
<p>其实 <code>left join</code> 和 <code>right join</code> 可以等价，换一下表的顺序就行</p>
</blockquote>
<p><strong>左连接</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 左连接 LEFT JOIN. ON 连接条件</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> role
                    <span class="hljs-keyword">on</span> user.role_id <span class="hljs-operator">=</span> role.id;

<span class="hljs-comment">-- 筛选出 role_id 不为 null 的（左连接以左表为主，如果右表没有匹配数据，右表字段为 null）</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> role
                           <span class="hljs-keyword">ON</span> user.role_id <span class="hljs-operator">=</span> role.id
                           <span class="hljs-keyword">WHERE</span> role_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><strong>内连接</strong></p>
<p>内连接只返回两表都匹配的数据，不以哪张表为主。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">join</span> role <span class="hljs-keyword">on</span> user.role_id <span class="hljs-operator">=</span> role.id;
</code></pre>
<blockquote>
<p>针对多对多的查询出现时，就是多次采用连接即可。</p>
</blockquote>
<h4 data-id="heading-23">子查询</h4>
<p>SQL 支持嵌套查询，也就是在查询中嵌套另一个查询（子查询）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询年龄最大的人</span>
<span class="hljs-comment">-- 方式一：分两步</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;  <span class="hljs-comment">-- 先查出最大年龄</span>
<span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> xxx; <span class="hljs-comment">-- 再根据年龄查数据</span>

<span class="hljs-comment">-- 方式二：用子查询（推荐）</span>
<span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>);
</code></pre>
<p>子查询还有个特有的语法 <code>EXISTS</code>、<code>NOT EXISTS</code>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询所有有角色的用户</span>
<span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role <span class="hljs-keyword">where</span> role.id <span class="hljs-operator">=</span> user.role_id);

<span class="hljs-comment">-- 查询所有没有角色的用户</span>
<span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role <span class="hljs-keyword">where</span> role.id <span class="hljs-operator">=</span> user.role_id);
</code></pre>
<p>子查询可以在 <code>select</code>、<code>insert</code>、<code>update</code>、<code>delete</code> 中使用。</p>
<h4 data-id="heading-24">事务</h4>
<p>修改多个关联表时，必须使用事务，保证要么全部成功，要么全部失败（回滚）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">start</span> transaction;    <span class="hljs-comment">-- 开启事务</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> role(id, name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">'群众'</span>);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(name, age, sex) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'james'</span>, <span class="hljs-number">18</span>, <span class="hljs-number">4</span>);

<span class="hljs-comment">-- 提交事务，执行之后就不能 rollback 了</span>
<span class="hljs-keyword">commit</span>;
<span class="hljs-comment">-- 回滚事务</span>
<span class="hljs-keyword">rollback</span>;
</code></pre>
<p>如果想回滚到某个中间点，可以使用 <code>savepoint</code> 设置保存点。</p>
<p><code>savepoint a1;</code>：回滚到 a1 时，a1 之前的操作保留，a1 之后的操作被撤销。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">start</span> transaction;  <span class="hljs-comment">-- 开启事务</span>
<span class="hljs-keyword">savepoint</span> a1;  <span class="hljs-comment">-- savepoint 这一刻前面的依旧活着，这一刻后面的都被抹除</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> role(id, name) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">'群众'</span>);
<span class="hljs-keyword">savepoint</span> a2;
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(name, age, sex) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'james'</span>, <span class="hljs-number">18</span>, <span class="hljs-number">4</span>);
<span class="hljs-keyword">savepoint</span> a3;

<span class="hljs-keyword">rollback</span> <span class="hljs-keyword">to</span> a2; <span class="hljs-comment">-- 回滚到 a2 的那一刻</span>
</code></pre>
<p>事务隔离级别（有四种级别，比较复杂，自己也有点懵，一般用默认的就行）</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> @<span class="hljs-variable">@transaction</span>_isolation; <span class="hljs-comment">-- 查看隔离级别</span>
</code></pre>
<h2 data-id="heading-25">DCL（管权限）</h2>
<p>权限管理在实际开发中较少用到，等遇到时再补充（其实自己也不知道）。</p>
<h2 data-id="heading-26">案例演示（Blog 的 CRUD）</h2>
<p>用一个博客系统的增删改查来演示 SQL 的实际应用。</p>
<p>先设计表结构</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>`(
  id <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户名'</span>,
  password <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'密码'</span>,
  email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'邮箱'</span>,
  created_at DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>
);

<span class="hljs-comment">-- 标签表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tag`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  name <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'标签名'</span>,
  article_count <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'文章数量'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>
);

<span class="hljs-comment">-- 文章表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `article`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  title <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'标题'</span>,
  content text <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'内容'</span>,
  user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'作者id'</span>,
  like_count <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'点赞数'</span>,
  comment_count <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'评论数'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">user</span>(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
);

<span class="hljs-comment">-- 文章标签表(中间表的级联方式要设置为 CASCADE，这个是固定的)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `article_tag`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  article_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文章id'</span>,
  tag_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'标签id'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (article_id) <span class="hljs-keyword">REFERENCES</span> article(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE,
  <span class="hljs-keyword">FOREIGN</span> KEY (tag_id) <span class="hljs-keyword">REFERENCES</span> tag(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
);

<span class="hljs-comment">-- 点赞表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">like</span>`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  article_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文章id'</span>,
  user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户id'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (article_id) <span class="hljs-keyword">REFERENCES</span> article(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">user</span>(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
)

<span class="hljs-comment">-- 评论表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `comment`(
  id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  article_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'文章id'</span>,
  user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户id'</span>,
  target_user_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'被回复人id'</span>,
  content <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'内容'</span>,
  parent_id <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'父级id'</span>,
  created_at datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">FOREIGN</span> KEY (article_id) <span class="hljs-keyword">REFERENCES</span> article(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE,
  <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> <span class="hljs-keyword">user</span>(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
)
</code></pre>
<p>ER 图为：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c22ac5491dff4690ad44e7cdbd9d017c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=AKkAciycWmHEZ3rRSHfAgc9%2BJGU%3D" alt="blog-er.png" width="100%" loading="lazy"/>
<h4 data-id="heading-27">用户和标签的 CRUD</h4>
<p>以用户表（user）为例，标签表（tag）同理</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建用户</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span>(username, password, email) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'admin'</span>, <span class="hljs-string">'123456'</span>, <span class="hljs-string">'admin@163.com'</span>);

<span class="hljs-comment">-- 查询用户</span>
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;

<span class="hljs-comment">-- 更新用户</span>
<span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> password <span class="hljs-operator">=</span> <span class="hljs-string">'123456'</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 删除用户</span>
<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h4 data-id="heading-28">文章的 CRUD</h4>
<p><strong>创建文章</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">start</span> transaction;

<span class="hljs-comment">-- 创建文章，获取文章 id（代码中获取 id 后执行下一步）</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> article(title, content, user_id, like_count, comment_count) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'标题'</span>, <span class="hljs-string">'内容'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

<span class="hljs-comment">-- 遍历 tagIds，与文章 id 一起插入中间表（代码中遍历 tagIds，组装 SQL）</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> article_tag(article_id, tag_id)
  <span class="hljs-keyword">VALUES</span>
    (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'标签id1'</span>),
    (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'标签id2'</span>);

<span class="hljs-comment">-- 更新 tag 表的文章数量</span>
<span class="hljs-keyword">update</span> tag <span class="hljs-keyword">set</span> article_count <span class="hljs-operator">=</span> article_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-string">'标签id1'</span>, <span class="hljs-string">'标签id2'</span>);

<span class="hljs-keyword">commit</span>;
</code></pre>
<p><strong>删除文章</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> article <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-comment">-- 因为采用的是 cascade，所以 article_tag 等会自动删除</span>
</code></pre>
<p><strong>查询文章列表</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id,
       title,
       user_id,
       like_count,
       comment_count,
       created_at
<span class="hljs-keyword">FROM</span>   article
<span class="hljs-keyword">ORDER</span>  <span class="hljs-keyword">BY</span> created_at <span class="hljs-keyword">DESC</span>
LIMIT  <span class="hljs-number">10</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">0</span>;

<span class="hljs-comment">-- 分页查询，按创建时间倒序</span>
<span class="hljs-comment">-- like_count 和 comment_count 采用计数器冗余方案，简单性能好，但可能数据不一致</span>
</code></pre>
<p><strong>更新文章</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 开启事务</span>
<span class="hljs-keyword">START</span> TRANSACTION;

<span class="hljs-comment">-- 2. 更新文章表</span>
<span class="hljs-keyword">UPDATE</span> article
  <span class="hljs-keyword">SET</span>
    title <span class="hljs-operator">=</span> <span class="hljs-string">'新标题'</span>,
    content <span class="hljs-operator">=</span> <span class="hljs-string">'新内容'</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> article.user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span>;

<span class="hljs-comment">-- 3. 根据文章 id，在中间表 article_tag 中拿到旧标签（a,b）, 然后根据用户传递的新标签（a,c）, 找出删除的标签（b），然后再 tag 表中更新文章数量（-1）</span>
<span class="hljs-keyword">UPDATE</span> tag
<span class="hljs-keyword">SET</span>    article_count <span class="hljs-operator">=</span> article_count <span class="hljs-operator">-</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span>  id <span class="hljs-keyword">IN</span> (
        <span class="hljs-keyword">SELECT</span> tag_id
        <span class="hljs-keyword">FROM</span>   article_tag
        <span class="hljs-keyword">WHERE</span>  article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>
          <span class="hljs-keyword">AND</span>  tag_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">'新标签id1'</span>, <span class="hljs-string">'新标签id2'</span>)   <span class="hljs-comment">-- 新标签列表</span>
      );

<span class="hljs-comment">-- 4. 查找旧标签，然后使用 in 和 not in 交集，找出新增的标签，然后在 tag 表中更新文章数量（+1）</span>
<span class="hljs-keyword">UPDATE</span> tag
<span class="hljs-keyword">SET</span>    article_count <span class="hljs-operator">=</span> article_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span>  id <span class="hljs-keyword">IN</span> (<span class="hljs-string">'新标签id1'</span>, <span class="hljs-string">'新标签id2'</span>)
  <span class="hljs-keyword">AND</span>  id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> tag_id <span class="hljs-keyword">FROM</span> article_tag <span class="hljs-keyword">WHERE</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>);

<span class="hljs-comment">-- 5. 更新中间表：先删除文章的所有标签，再插入新标签</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> article_tag <span class="hljs-keyword">WHERE</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> article_tag(article_id, tag_id) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'新标签id1'</span>),
(<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'新标签id2'</span>);

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h4 data-id="heading-29">点赞</h4>
<p>无论是点赞还是取消点赞, 第一步是先判断是否已经点过赞</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">like</span>` <span class="hljs-keyword">WHERE</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span> LIMIT <span class="hljs-number">1</span>;
</code></pre>
<p>如果查询到记录，说明已点赞，执行取消点赞；否则执行点赞。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 点赞</span>

<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">--  1. 更新 like 表数据</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">like</span>`(article_id, user_id) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'用户id'</span>);
<span class="hljs-comment">--  2. 更新 article 表数据（+1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> like_count <span class="hljs-operator">=</span> like_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;
<span class="hljs-comment">-- 取消点赞</span>

<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">--  1. 删除 like 表数据</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">like</span>` <span class="hljs-keyword">WHERE</span>  article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span>;
<span class="hljs-comment">--  2. 更新 article 表数据（-1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> like_count <span class="hljs-operator">=</span> like_count <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h4 data-id="heading-30">评论</h4>
<blockquote>
<p>写到这里发现，最初表设计有问题。本想用一个 <code>parent_id</code> 实现无限层级，但看了掘金和 B 站的评论设计，发现评论最多 2 层，其他都是平铺回复。</p>
</blockquote>
<p>B 站的评论：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbba2af510284abdb99b2da4c85240e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=1PlNs3aaC%2FbQt%2FTtG55nKDbDw9g%3D" alt="blog-sql-bi.png" width="100%" loading="lazy"/>
<p>掘金的评论：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8203dfc86db844029709fa65f36a941f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29weWVyX3h5Zg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765406894&amp;x-signature=bRQXMC%2B8a8UNJdX%2F0YolB5xbuO0%3D" alt="blog-sql-juejin.png" width="70%" loading="lazy"/>
<p>都是<strong>两层模型</strong>：</p>
<ul>
<li>第 1 层：顶级评论（<code>parent_id = NULL</code>）</li>
<li>第 2 层：对顶级评论的回复（<code>parent_id = 顶级.id</code>）</li>
<li>第 3 层及以后：不再嵌套，把目标人 @nick 写进内容，<code>parent_id</code> 仍等于顶级评论 id，按时间平铺</li>
</ul>
<p><strong>新增评论</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">-- 情况一：顶级评论</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> comment(article_id, user_id, parent_id, target_user_id, content)
  <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'用户id'</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">'一级评论'</span>);

<span class="hljs-comment">-- 情况二：回复顶级评论或回复某人</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> comment(article_id, user_id, parent_id, target_user_id, content)
  <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'文章id'</span>, <span class="hljs-string">'用户id'</span>, <span class="hljs-string">'顶级评论id'</span>, <span class="hljs-string">'被回复人id'</span>, <span class="hljs-string">'二级评论'</span>);

<span class="hljs-comment">-- 3. 更新 article 表评论数（+1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> comment_count <span class="hljs-operator">=</span> comment_count <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><strong>删除评论</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 查看是否有子评论</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FROM</span> comment <span class="hljs-keyword">WHERE</span> parent_id <span class="hljs-operator">=</span> <span class="hljs-string">'评论id'</span> LIMIT <span class="hljs-number">1</span>;
<span class="hljs-comment">-- 情况一：如果没有子评论</span>

<span class="hljs-comment">-- 情况一：没有子评论，直接删除</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> comment <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'评论id'</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'用户id'</span>;
<span class="hljs-comment">-- 2. 更新 article 表评论数（-1）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> comment_count <span class="hljs-operator">=</span> comment_count <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;


<span class="hljs-comment">-- 情况二：有子评论，一起删除</span>
<span class="hljs-keyword">START</span> TRANSACTION;
<span class="hljs-comment">-- 1. 获取所有子评论 id（二级评论的 parent_id 都是顶级评论 id）</span>
<span class="hljs-keyword">select</span> id <span class="hljs-keyword">as</span> ids <span class="hljs-keyword">from</span> comment <span class="hljs-keyword">where</span> parent_id <span class="hljs-operator">=</span> <span class="hljs-string">'评论id'</span>;

<span class="hljs-comment">-- 2. 代码中组装 ids：[...ids, '评论id']（包含所有子评论 id 和顶级评论 id）</span>

<span class="hljs-comment">-- 3. 根据 id 批量删除</span>
<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> comment <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span> (<span class="hljs-string">'ids'</span>);

<span class="hljs-comment">-- 4. 更新 article 表评论数（减去 ids.length）</span>
<span class="hljs-keyword">UPDATE</span> article <span class="hljs-keyword">SET</span> comment_count <span class="hljs-operator">=</span> comment_count <span class="hljs-operator">-</span> <span class="hljs-string">'ids.length'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<blockquote>
<p>这里使用代码 + SQL 语法的组合，纯粹用 SQL 实现需要使用存储过程，目前还不会</p>
</blockquote>
<p><strong>查询评论列表</strong></p>
<p>这里查询主要还是看评论的交互流程是怎么样设计的。</p>
<ul>
<li>情况一：直接查询所有评论（在代码中组装成一个二级树结构），缺点数据量不能太大</li>
<li>情况二：分页查询（先分页查询顶级的，展示时再不分页查询子评论），可能存在交互的迟钝感</li>
<li>情况三：xxxx(我也不知道了，总感觉上面的两种方案都不是最佳的, 我看了掘金返回的结构是<strong>顶级评论分页（20 条）+ 子评论随着顶级评论一起返回</strong>，万一子评论的量也很多呢？)</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 情况一：查询所有评论</span>

<span class="hljs-comment">-- 1. 获取所有顶级评论的 ids</span>
<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">from</span> comment <span class="hljs-keyword">where</span> article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;

<span class="hljs-comment">-- 2. 获取所有评论</span>
<span class="hljs-keyword">SELECT</span> c.id,
       c.parent_id,
       c.user_id,
       u.name                   <span class="hljs-keyword">AS</span> user_name,
       c.target_user_id,
       tu.name                  <span class="hljs-keyword">AS</span> target_user_name,
       c.content,
       c.created_at
<span class="hljs-keyword">FROM</span> comment c
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u  <span class="hljs-keyword">ON</span> u.id  <span class="hljs-operator">=</span> c.user_id    <span class="hljs-comment">-- 连接用户表，查询用户名称</span>
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> tu <span class="hljs-keyword">ON</span> tu.id <span class="hljs-operator">=</span> c.target_user_id <span class="hljs-comment">-- 连接用户表，查询用户名称</span>
<span class="hljs-keyword">WHERE</span>  c.article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span>
  <span class="hljs-keyword">AND</span> (c.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-comment">-- 找出顶级评论（parent_id = NULL）和子评论（parent_id 在 ids 里面）</span>
       <span class="hljs-keyword">OR</span>
       c.parent_id <span class="hljs-keyword">IN</span> (<span class="hljs-string">'ids'</span>))
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DESC</span>,
         c.created_at <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>通过代码进行组装成树</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 针对情况一：拿到所有数据之后，在代码中组装成一个树结构</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildTree</span>(<span class="hljs-params">list</span>) {
 <span class="hljs-keyword">const</span> topMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// 顶级评论容器</span>
 <span class="hljs-keyword">const</span> replyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// 二级评论容器</span>

 list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
   <span class="hljs-keyword">if</span> (item.<span class="hljs-property">parent_id</span> === <span class="hljs-literal">null</span>) {
     item.<span class="hljs-property">replies</span> = []; <span class="hljs-comment">// 创建一个空数组，用来存放子评论</span>
     topMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">id</span>, item);
   } <span class="hljs-keyword">else</span> {
     <span class="hljs-keyword">const</span> arr = replyMap.<span class="hljs-title function_">get</span>(item.<span class="hljs-property">parent_id</span>) || [];
     arr.<span class="hljs-title function_">push</span>(item);
     replyMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">parent_id</span>, arr);
   }
 });

 topMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">top</span>) =&gt;</span> {
   <span class="hljs-comment">// 添加子评论</span>
   top.<span class="hljs-property">replies</span> = replyMap.<span class="hljs-title function_">get</span>(top.<span class="hljs-property">id</span>) || [];
 });

 <span class="hljs-keyword">const</span> tree = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(topMap.<span class="hljs-title function_">values</span>()).<span class="hljs-title function_">sort</span>(
   <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(b.<span class="hljs-property">created_at</span>) - <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(a.<span class="hljs-property">created_at</span>)
 );

 <span class="hljs-keyword">return</span> tree;
}

</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 情况二： 先分页查询顶级的，展示时再不分页查询子评论</span>

<span class="hljs-comment">-- 1. 分页获取顶层评论</span>
<span class="hljs-keyword">SELECT</span> c.id,
       c.parent_id,
       c.user_id,
       u.name               <span class="hljs-keyword">AS</span> user_name,
       c.target_user_id,
       tu.name              <span class="hljs-keyword">AS</span> target_user_name,
       c.content,
       c.created_at
<span class="hljs-keyword">FROM</span> comment c
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u  <span class="hljs-keyword">ON</span> u.id  <span class="hljs-operator">=</span> c.user_id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> tu <span class="hljs-keyword">ON</span> tu.id <span class="hljs-operator">=</span> c.target_user_id
<span class="hljs-keyword">WHERE</span> c.article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> c.parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c.created_at <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-string">'页码 * 20'</span>;

<span class="hljs-comment">-- 2. 获取所有子评论</span>
<span class="hljs-keyword">SELECT</span> c.id,
       c.parent_id,
       c.user_id,
       u.name               <span class="hljs-keyword">AS</span> user_name,
       c.target_user_id,
       tu.name              <span class="hljs-keyword">AS</span> target_user_name,
       c.content,
       c.created_at
<span class="hljs-keyword">FROM</span> comment c
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> u  <span class="hljs-keyword">ON</span> u.id  <span class="hljs-operator">=</span> c.user_id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> tu <span class="hljs-keyword">ON</span> tu.id <span class="hljs-operator">=</span> c.target_user_id
<span class="hljs-keyword">WHERE</span> c.article_id <span class="hljs-operator">=</span> <span class="hljs-string">'文章id'</span> <span class="hljs-keyword">AND</span> c.parent_id  <span class="hljs-operator">=</span> <span class="hljs-string">'顶层评论id'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> c.created_at <span class="hljs-keyword">ASC</span>;
</code></pre>
<p>其他的情况，就先不考虑了。</p>
<h2 data-id="heading-31">最后</h2>
<p>SQL 这东西，多写几遍就熟了。语法虽然多，但常用的就那些，上面这些算是入门。</p>
<p>前端平时接触不到，但想往全栈发展，SQL 是必须了解的。虽然实际开发用 ORM，但底层还是 SQL（就像用 Vue，JavaScript 还是要懂的）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大文件上传实战：基于Express、分片、Web Worker与压缩的完整方案]]></title>    <link>https://juejin.cn/post/7579499567869935666</link>    <guid>https://juejin.cn/post/7579499567869935666</guid>    <pubDate>2025-12-04T02:48:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579499567869935666" data-draft-id="7579512734297194534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大文件上传实战：基于Express、分片、Web Worker与压缩的完整方案"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2025-12-04T02:48:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端大鱼"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大文件上传实战：基于Express、分片、Web Worker与压缩的完整方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端大鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:48:54.000Z" title="Thu Dec 04 2025 02:48:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>我是大鱼，陪你一起在前端技术深海前行。</p>
</blockquote>
<p>本文将详细介绍大文件上传的全链路优化方案，结合前端分片、Web Worker多线程处理、文件压缩以及Express后端实现，解决传统大文件上传中的网络波动、服务器压力与用户体验差等核心痛点。</p>
<h3 data-id="heading-0">一、核心技术方案设计</h3>
<p>大文件上传的优化主要围绕<strong>分片上传</strong>、<strong>断点续传</strong>和<strong>秒传</strong>三大机制展开。本方案在此基础上，引入Web Worker进行前端并行计算与文件压缩，整体架构如下：</p>
<ul>
<li><strong>前端</strong>：采用分片（5MB/片）压缩后，通过Web Worker计算哈希，实现并发上传与进度反馈。</li>
<li><strong>后端</strong>：使用Express.js + Multer处理分片，支持断点续传与文件合并。</li>
<li><strong>传输优化</strong>：通过压缩算法（如gzip）减少传输体积，提升网络利用率。</li>
</ul>
<h4 data-id="heading-1">方案优势对比</h4>

























<table><thead><tr><th align="left">传统方案</th><th align="left">本优化方案</th></tr></thead><tbody><tr><td align="left">单线程上传，易阻塞主线程</td><td align="left">Web Worker多线程处理，不阻塞UI</td></tr><tr><td align="left">网络中断需重传整个文件</td><td align="left">分片上传 + 断点续传，仅重传失败分片</td></tr><tr><td align="left">无压缩，传输效率低</td><td align="left">前端压缩 + 分片，减少带宽占用</td></tr><tr><td align="left">服务器直接处理大文件流</td><td align="left">分片减轻服务器单次压力</td></tr></tbody></table>
<h3 data-id="heading-2">二、前端实现：分片、压缩与Worker多线程</h3>
<p>前端流程包括<strong>文件分片</strong>、<strong>压缩处理</strong>、<strong>哈希计算</strong>和<strong>并发上传</strong>，关键步骤如下：</p>
<h4 data-id="heading-3">1. 文件分片与压缩</h4>
<p>使用<code>File.slice()</code>进行分片，并对每个分片应用压缩（示例使用gzip）。分片大小建议5MB，平衡网络开销与并发效率。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 文件分片与压缩函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chunkAndCompressFile</span>(<span class="hljs-params">file, chunkSize = <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span></span>) {
  <span class="hljs-keyword">const</span> chunks = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; file.<span class="hljs-property">size</span>; i += chunkSize) {
    <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(i, i + chunkSize);
    <span class="hljs-comment">// 使用Compression Streams API进行压缩（现代浏览器支持）</span>
    <span class="hljs-keyword">const</span> compressedStream = chunk.<span class="hljs-title function_">stream</span>().<span class="hljs-title function_">pipeThrough</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompressionStream</span>(<span class="hljs-string">'gzip'</span>));
    <span class="hljs-keyword">const</span> compressedChunk = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(compressedStream).<span class="hljs-title function_">blob</span>();
    chunks.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">index</span>: i / chunkSize,
      <span class="hljs-attr">file</span>: compressedChunk,
      <span class="hljs-attr">originalSize</span>: chunk.<span class="hljs-property">size</span>,
      <span class="hljs-attr">compressedSize</span>: compressedChunk.<span class="hljs-property">size</span>
    });
  }
  <span class="hljs-keyword">return</span> chunks;
}
</code></pre>
<h4 data-id="heading-4">2. Web Worker计算分片哈希</h4>
<p>使用<code>file-chunk-worker</code>库在Worker中并行计算分片MD5，避免主线程阻塞，同时支持进度反馈。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在主线程中调用Worker处理文件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FileProcessor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'file-chunk-worker'</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processFileWithWorker</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-keyword">const</span> processor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileProcessor</span>(file, {
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
    <span class="hljs-attr">threadCount</span>: <span class="hljs-number">4</span>  <span class="hljs-comment">// 启用4个Worker线程</span>
  });
  <span class="hljs-keyword">const</span> chunks = <span class="hljs-keyword">await</span> processor.<span class="hljs-title function_">calculateMd5</span>(<span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`处理进度: <span class="hljs-subst">${(progress * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">2</span>)}</span>%`</span>);
  });
  <span class="hljs-comment">// chunks包含每个分片的hash、索引和Blob数据</span>
  <span class="hljs-keyword">return</span> chunks.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> ({
    ...chunk,
    <span class="hljs-attr">hash</span>: chunk.<span class="hljs-property">hash</span>  <span class="hljs-comment">// 用于秒传校验</span>
  }));
}
</code></pre>
<h4 data-id="heading-5">3. 并发上传与断点续传</h4>
<p>上传前先查询服务器已上传分片，实现断点续传。使用<code>@yuan-toolkit/chunk-uploader</code>或<code>bigfile-chunk-uploader</code>库管理并发、重试和进度。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 配置化的分片上传（基于bigfile-chunk-uploader）</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BigFileUploader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'bigfile-chunk-uploader'</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-comment">// 1. 分片并计算哈希</span>
  <span class="hljs-keyword">const</span> processedChunks = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processFileWithWorker</span>(file);
  <span class="hljs-comment">// 2. 初始化上传，获取fileId（用于断点续传）</span>
  <span class="hljs-keyword">const</span> fileId = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/init'</span>, {
    <span class="hljs-attr">fileName</span>: file.<span class="hljs-property">name</span>,
    <span class="hljs-attr">fileHash</span>: processedChunks.<span class="hljs-property">overallHash</span>  <span class="hljs-comment">// 整体文件哈希，用于秒传</span>
  }).<span class="hljs-property">data</span>.<span class="hljs-property">uploadId</span>;
  
  <span class="hljs-comment">// 3. 检查已上传分片</span>
  <span class="hljs-keyword">const</span> { uploadedChunks } = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/upload/status?fileId=<span class="hljs-subst">${fileId}</span>`</span>);
  <span class="hljs-comment">// 4. 并发上传未完成分片</span>
  <span class="hljs-keyword">const</span> uploader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigFileUploader</span>({
    file,
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://api.example.com'</span>,
    <span class="hljs-attr">endpoints</span>: { <span class="hljs-attr">chunk</span>: <span class="hljs-string">'/upload/chunk'</span>, <span class="hljs-attr">merge</span>: <span class="hljs-string">'/upload/merge'</span> },
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-number">5</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>,
    <span class="hljs-attr">concurrent</span>: <span class="hljs-number">3</span>,  <span class="hljs-comment">// 控制并发数</span>
    <span class="hljs-attr">maxRetries</span>: <span class="hljs-number">3</span>,   <span class="hljs-comment">// 失败自动重试</span>
    <span class="hljs-attr">onProgress</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`上传进度: <span class="hljs-subst">${progress}</span>%`</span>);  <span class="hljs-comment">// 实时反馈</span>
    }
  });
  <span class="hljs-keyword">await</span> uploader.<span class="hljs-title function_">start</span>();
  <span class="hljs-comment">// 5. 所有分片完成后，请求合并</span>
  <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/merge'</span>, { fileId });
}
</code></pre>
<h4 data-id="heading-6">关键优化点：</h4>
<ul>
<li><strong>并发控制</strong>：浏览器同域并发限制约为6，可通过多子域（如<code>upload1.example.com</code>）提升速度。</li>
<li><strong>进度反馈</strong>：结合分片进度与压缩进度，提供精确的百分比反馈。</li>
<li><strong>错误重试</strong>：网络失败时自动重试特定分片，增强鲁棒性。</li>
</ul>
<h3 data-id="heading-7">三、后端实现：Express.js分片接收与合并</h3>
<p>后端使用Express + Multer处理分片，并实现断点续传逻辑。</p>
<h4 data-id="heading-8">1. 环境搭建与Multer配置</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> multer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'multer'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-comment">// 配置Multer存储分片</span>
<span class="hljs-keyword">const</span> storage = multer.<span class="hljs-title function_">diskStorage</span>({
  <span class="hljs-attr">destination</span>: <span class="hljs-string">'uploads/temp/'</span>,  <span class="hljs-comment">// 分片临时目录</span>
  <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">req, file, cb</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { fileId, chunkIndex } = req.<span class="hljs-property">body</span>;
    <span class="hljs-title function_">cb</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">`<span class="hljs-subst">${fileId}</span>-<span class="hljs-subst">${chunkIndex}</span>.chunk`</span>);  <span class="hljs-comment">// 按fileId和索引命名</span>
  }
});
<span class="hljs-keyword">const</span> upload = <span class="hljs-title function_">multer</span>({ storage });
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());
</code></pre>
<h4 data-id="heading-9">2. 分片上传接口</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 初始化上传（生成fileId，支持秒传）</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/init'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileName, fileHash } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">const</span> fileId = <span class="hljs-title function_">generateFileId</span>();  <span class="hljs-comment">// 生成唯一ID</span>
  <span class="hljs-comment">// 秒传检查：如果文件哈希已存在，直接返回成功</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">checkFileExists</span>(fileHash)) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">uploaded</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">url</span>: <span class="hljs-title function_">getFileUrl</span>(fileHash) });
  }
  <span class="hljs-comment">// 记录上传状态（用于断点续传）</span>
  <span class="hljs-title function_">saveUploadStatus</span>(fileId, { fileName, fileHash, <span class="hljs-attr">uploadedChunks</span>: [] });
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">uploadId</span>: fileId });
});

<span class="hljs-comment">// 2. 分片上传接口</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/chunk'</span>, upload.<span class="hljs-title function_">single</span>(<span class="hljs-string">'chunk'</span>), <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileId, chunkIndex, chunkHash } = req.<span class="hljs-property">body</span>;
  <span class="hljs-comment">// 验证分片哈希（防止数据损坏）</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">validateChunkHash</span>(req.<span class="hljs-property">file</span>, chunkHash)) {
    <span class="hljs-comment">// 记录已上传分片索引</span>
    <span class="hljs-title function_">updateUploadStatus</span>(fileId, chunkIndex);
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'分片校验失败'</span> });
  }
});

<span class="hljs-comment">// 3. 查询上传进度（用于断点续传）</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/upload/status'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { fileId } = req.<span class="hljs-property">query</span>;
  <span class="hljs-keyword">const</span> status = <span class="hljs-title function_">getUploadStatus</span>(fileId);
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">uploadedChunks</span>: status?.<span class="hljs-property">uploadedChunks</span> || [] });
});
</code></pre>
<h4 data-id="heading-10">3. 分片合并接口</h4>
<p>所有分片上传完成后，按索引顺序合并。</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload/merge'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> { fileId } = req.<span class="hljs-property">body</span>;
  <span class="hljs-keyword">const</span> { fileName, fileHash } = <span class="hljs-title function_">getUploadStatus</span>(fileId);
  <span class="hljs-keyword">const</span> chunkDir = <span class="hljs-string">'uploads/temp/'</span>;
  <span class="hljs-keyword">const</span> chunks = fs.<span class="hljs-title function_">readdirSync</span>(chunkDir)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">startsWith</span>(fileId))
    .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-built_in">parseInt</span>(a.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]) - <span class="hljs-built_in">parseInt</span>(b.<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>)[<span class="hljs-number">1</span>]));
  <span class="hljs-comment">// 顺序合并分片</span>
  <span class="hljs-keyword">const</span> finalPath = <span class="hljs-string">`uploads/final/<span class="hljs-subst">${fileId}</span>-<span class="hljs-subst">${fileName}</span>`</span>;
  <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(finalPath);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> chunks) {
    <span class="hljs-keyword">const</span> chunkPath = path.<span class="hljs-title function_">join</span>(chunkDir, chunk);
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> readStream = fs.<span class="hljs-title function_">createReadStream</span>(chunkPath);
      readStream.<span class="hljs-title function_">pipe</span>(writeStream, { <span class="hljs-attr">end</span>: <span class="hljs-literal">false</span> });
      readStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
        fs.<span class="hljs-title function_">unlinkSync</span>(chunkPath);  <span class="hljs-comment">// 删除临时分片</span>
        <span class="hljs-title function_">resolve</span>();
      });
    });
  }
  writeStream.<span class="hljs-title function_">end</span>();
  <span class="hljs-comment">// 文件完整性校验</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> <span class="hljs-title function_">calculateFileHash</span>(finalPath) === fileHash) {
    <span class="hljs-title function_">saveFileRecord</span>(fileHash, finalPath);  <span class="hljs-comment">// 存储记录供秒传使用</span>
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">`/files/<span class="hljs-subst">${fileId}</span>`</span>, <span class="hljs-attr">size</span>: fs.<span class="hljs-title function_">statSync</span>(finalPath).<span class="hljs-property">size</span> });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'文件合并失败'</span> });
  }
});
</code></pre>
<h4 data-id="heading-11">关键优化点：</h4>
<ul>
<li><strong>断点续传</strong>：通过<code>uploadedChunks</code>记录避免重复上传。</li>
<li><strong>秒传</strong>：基于文件哈希判断文件是否存在。</li>
<li><strong>资源管理</strong>：合并后清理临时分片，定期清理过期上传记录。</li>
</ul>
<h3 data-id="heading-12">四、高级优化策略</h3>
<ol>
<li>
<p><strong>压缩算法选择</strong>：<br/>
前端压缩可选用<code>gzip</code>（浏览器原生支持）或<code>brotli</code>（压缩率更高）。实测中，对文本/JSON数据压缩率可达60%-70%。</p>
<blockquote>
<p><strong>注意</strong>：已压缩文件（如ZIP、视频）二次压缩收益有限，可前端检测文件类型动态启用压缩。</p>
</blockquote>
</li>
<li>
<p><strong>Web Worker动态调优</strong>：<br/>
Worker数量建议设为<code>navigator.hardwareConcurrency - 1</code>（保留一个核心给UI）。过大文件（&gt;1GB）可分阶段处理，避免内存溢出。</p>
</li>
<li>
<p><strong>传输安全与完整性</strong>：</p>
<ul>
<li>使用HTTPS加密传输。</li>
<li>每个分片携带<code>Content-MD5</code>头，后端校验。</li>
<li>最终文件哈希（如SHA-256）比对，防止合并错误。</li>
</ul>
</li>
<li>
<p><strong>用户体验增强</strong>：</p>
<ul>
<li>实时显示速度、剩余时间与压缩率。</li>
<li>暂停/恢复功能（利用<code>uploader.pause()</code>/<code>resume()</code>）。</li>
<li>网络中断后自动检测并续传。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">五、完整工作流程示例</h3>
<p>以下为一个视频文件（2GB）的上传流程：</p>
<ol>
<li><strong>前端准备</strong>：<br/>
文件→分片（5MB/片，共约400片）→Web Worker计算分片哈希（4线程并行）→gzip压缩（体积减少约40%）。</li>
<li><strong>上传过程</strong>：
<ol>
<li>初始化获取<code>fileId</code>；2) 查询已上传分片（首次为空）；3) 并发上传分片（3个并发）；4) 实时进度显示。</li>
</ol>
</li>
<li><strong>后端处理</strong>：
<ol>
<li>接收分片并存储；2) 记录上传状态；3) 合并分片并校验；4) 返回文件URL。</li>
</ol>
</li>
</ol>
<h3 data-id="heading-14">六、总结</h3>
<p>本文方案使用<strong>分片上传</strong>、<strong>Web Worker多线程处理</strong>、<strong>前端压缩</strong>与<strong>Express后端支持</strong>，系统性地解决了大文件上传的稳定性、效率与用户体验问题。</p>
<p>实际应用中，可根据文件类型调整分片大小（如图片用2MB，视频用5MB），并监控服务器负载以优化并发参数。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文带你掌握MyBatis-Plus代码生成器：从入门到精通，实现原理与自定义模板全解析]]></title>    <link>https://juejin.cn/post/7579494852654219298</link>    <guid>https://juejin.cn/post/7579494852654219298</guid>    <pubDate>2025-12-04T02:57:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579494852654219298" data-draft-id="7579544918076391459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文带你掌握MyBatis-Plus代码生成器：从入门到精通，实现原理与自定义模板全解析"/> <meta itemprop="keywords" content="后端,Spring Boot,Java"/> <meta itemprop="datePublished" content="2025-12-04T02:57:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shepherd"/> <meta itemprop="url" content="https://juejin.cn/user/3415500769991869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文带你掌握MyBatis-Plus代码生成器：从入门到精通，实现原理与自定义模板全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3415500769991869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shepherd
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:57:41.000Z" title="Thu Dec 04 2025 02:57:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.背景：为什么需要代码生成器？</h2>
<p>近年来，随着AI编程和低代码平台的兴起，开发效率成为技术圈的热门话题。虽然这些工具能够在一定程度上提升开发效率，但对于复杂的业务逻辑和定制化需求，仍然需要程序员手动编写代码。</p>
<p>特别是在后端开发中，业务接口的编写往往存在大量重复性工作：实体类、Mapper、Service、Controller等基础代码结构相似，却需要反复编写。这时候，一个优秀的代码生成器就能大显身手。</p>
<p>今天我要详细介绍的就是<strong>MyBatis-Plus Generator</strong>（简称<strong>MPG</strong>），这款强大的代码生成工具能够根据数据库表结构，自动生成包括Entity、Mapper、Service、Controller在内的全套代码，真正实现"一键生成，开箱即用"。</p>
<h2 data-id="heading-1">2.快速入门：5分钟上手代码生成</h2>
<h3 data-id="heading-2">2.1 引入依赖</h3>
<pre><code class="hljs language-xml" lang="xml">  <span class="hljs-comment">&lt;!-- 代码生成器  --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 模板引擎（Freemarker示例） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.32<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2.2 准备测试数据表</h3>
<p>创建一张测试用户表<code>tb_user</code>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tb_user` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  `user_no` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'编号'</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'昵称'</span>,
  `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'邮箱'</span>,
  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'手机号'</span>,
  `gender` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'性别  0：男生   1：女生'</span>,
  `birthday` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'出生日期'</span>,
  `is_delete` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'删除标志 0：否  1：是'</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  `creator` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'创建人'</span>,
  `updater` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'更新人'</span>,
  `address` <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'地址'</span>,
  `role_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'角色id'</span>,
  `hobby` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'爱好'</span>,
  `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'个人说明'</span>,
  `org_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'公司id'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE,
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_user_no` (`user_no`) <span class="hljs-keyword">USING</span> BTREE
) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 ROW_FORMAT<span class="hljs-operator">=</span><span class="hljs-keyword">DYNAMIC</span>;
</code></pre>
<h3 data-id="heading-4">2.3 基础配置生成代码</h3>
<p>MPG提供了流畅的Builder模式API，让配置过程直观易懂：</p>
<pre><code class="hljs language-scss" lang="scss">public class CodeGeneratorTest {
​
    public static void <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-comment">// 使用 FastAutoGenerator 快速配置代码生成器</span>
        FastAutoGenerator<span class="hljs-selector-class">.create</span>("jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/db_test?useUnicode=true&amp;characterEncoding=utf-<span class="hljs-number">8</span>&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true",
                        "root",
                        "root")
                <span class="hljs-selector-class">.globalConfig</span>(builder -&gt; {  // 全局配置
                    builder.author("ZFJ") <span class="hljs-comment">// 设置作者</span>
                            <span class="hljs-selector-class">.commentDate</span>("yyyy-MM-dd")  <span class="hljs-comment">// 设置日期</span>
                            <span class="hljs-selector-class">.enableSpringdoc</span>()  <span class="hljs-comment">// 开启openapi3文档注释</span>
                            <span class="hljs-selector-class">.outputDir</span>("src/main/java")  <span class="hljs-comment">// 输出目录</span>
                            <span class="hljs-selector-class">.disableOpenDir</span>(); <span class="hljs-comment">// 不打开路径</span>
                })
                <span class="hljs-selector-class">.packageConfig</span>(builder -&gt; {
                    builder.parent("com.shepherd.example") <span class="hljs-comment">// 设置父包名</span>
                            <span class="hljs-selector-class">.entity</span>("entity") <span class="hljs-comment">// 设置entity实体类包名</span>
                            <span class="hljs-selector-class">.mapper</span>("dao") <span class="hljs-comment">// 设置Mapper接口包名</span>
                            <span class="hljs-selector-class">.service</span>("service") <span class="hljs-comment">// 设置Service接口包名</span>
                            <span class="hljs-selector-class">.serviceImpl</span>("service.impl") <span class="hljs-comment">// 设置Service实现类包名</span>
                            <span class="hljs-selector-class">.xml</span>("mappers"); <span class="hljs-comment">// 设置 MapperXML文件包名</span>
                })
                <span class="hljs-selector-class">.strategyConfig</span>(builder -&gt; {
                    builder.addInclude("tb_user") <span class="hljs-comment">// 设置需要生成的表名</span>
                            <span class="hljs-selector-class">.addTablePrefix</span>("tb_") <span class="hljs-comment">// 添加表前缀</span>
                            <span class="hljs-comment">// 设置实体类</span>
                            <span class="hljs-selector-class">.entityBuilder</span>()
                            <span class="hljs-selector-class">.enableLombok</span>(new ClassAnnotationAttributes("@Data","lombok.Data")) <span class="hljs-comment">// 启用 Lombok</span>
                            <span class="hljs-selector-class">.enableTableFieldAnnotation</span>() <span class="hljs-comment">// 启用字段注解</span>
                            <span class="hljs-selector-class">.javaTemplate</span>("/templates/entity.java") <span class="hljs-comment">// 设置实体类模板</span>
                            <span class="hljs-comment">// 设置mapper接口</span>
                            <span class="hljs-selector-class">.mapperBuilder</span>()
                            <span class="hljs-selector-class">.mapperTemplate</span>("/templates/mapper.java") <span class="hljs-comment">// 设置mapper目标</span>
                            <span class="hljs-selector-class">.convertMapperFileName</span>((entityName -&gt; entityName + "DAO")) <span class="hljs-comment">// 设置mapper接口文件名</span>
                            <span class="hljs-selector-class">.enableBaseResultMap</span>()
                            <span class="hljs-selector-class">.enableBaseColumnList</span>()
                            <span class="hljs-comment">// 设置service接口</span>
                            <span class="hljs-selector-class">.serviceBuilder</span>()
                            <span class="hljs-selector-class">.serviceTemplate</span>("/templates/service.java") <span class="hljs-comment">// 设置Service模板</span>
                            <span class="hljs-selector-class">.convertServiceFileName</span>((entityName -&gt; entityName + "Service")) <span class="hljs-comment">// 设置service文件名</span>
                            <span class="hljs-selector-class">.serviceImplTemplate</span>("/templates/serviceImpl.java") <span class="hljs-comment">// 设置ServiceImpl模板</span>
                            <span class="hljs-comment">// 设置controller类</span>
                            <span class="hljs-selector-class">.controllerBuilder</span>()
                            <span class="hljs-selector-class">.template</span>("/templates/controller.java")
                            <span class="hljs-selector-class">.enableRestStyle</span>(); <span class="hljs-comment">// 启用 REST 风格</span>
                })
                <span class="hljs-selector-class">.templateEngine</span>(new FreemarkerTemplateEngine()) <span class="hljs-comment">// 使用 Freemarker 模板引擎</span>
                <span class="hljs-selector-class">.execute</span>(); <span class="hljs-comment">// 执行生成</span>
    }
}
​
</code></pre>
<p>运行生成代码文件如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b54f204e6714cad84ed98c601255951~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hlcGhlcmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421861&amp;x-signature=6uWNkITxeHVQGqNRfn97GG3vgbE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">3.核心配置</h2>
<h3 data-id="heading-6">3.1 全局配置（GlobalConfig）</h3>
<p>全局配置提供了对代码生成器整体行为的设置，包括输出目录、作者信息、Kotlin 模式、Swagger 集成、Springdoc、时间类型策略等</p>


















































<table><thead><tr><th>方法</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>disableOpenDir()</td><td>禁止自动打开输出目录</td><td>默认值: <code>true</code></td></tr><tr><td>outputDir(String)</td><td>指定代码生成的输出目录</td><td>如：System.getProperty("user.dir") + "/src/main/java"</td></tr><tr><td>author(String)</td><td>设置作者名</td><td><code>baomidou</code> 默认值: 配置文件中的作者名</td></tr><tr><td>enableKotlin()</td><td>开启 Kotlin 模式</td><td>默认值: <code>false</code></td></tr><tr><td>enableSwagger()</td><td>开启 Swagger 模式</td><td>默认值: <code>false</code></td></tr><tr><td>dateType(DateType)</td><td>设置时间类型策略</td><td><code>DateType.ONLY_DATE</code> 默认值: <code>DateType.TIME_PACK</code></td></tr><tr><td>commentDate(String)</td><td>设置注释日期格式</td><td>默认值: <code>yyyy-MM-dd</code></td></tr><tr><td>enableSpringdoc</td><td>开启Springdoc文档</td><td>默认值：<code>false</code></td></tr></tbody></table>
<h3 data-id="heading-7">3.2 策略配置（StrategyConfig）</h3>
<p>策略配置是MPG的核心部分，它允许开发者根据项目需求定制代码生成的规则，包括命名模式、表和字段的过滤、以及各个代码模块的生成策略。</p>































































































<table><thead><tr><th>方法</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>enableCapitalMode</td><td>开启大写命名</td><td>默认值: <code>false</code></td></tr><tr><td>enableSkipView</td><td>开启跳过视图</td><td>默认值: <code>false</code></td></tr><tr><td>disableSqlFilter</td><td>禁用 SQL 过滤</td><td>默认值: <code>true</code>，如果 SQL 过滤不支持，可以关闭此选项</td></tr><tr><td>enableSchema</td><td>启用 schema</td><td>默认值: <code>false</code>，多 schema 场景时启用</td></tr><tr><td>likeTable(LikeTable)</td><td>模糊表匹配(SQL 过滤)</td><td>与 <code>notLikeTable</code> 互斥，只能配置一项</td></tr><tr><td>notLikeTable(LikeTable)</td><td>模糊表排除(SQL 过滤)</td><td>与 <code>likeTable</code> 互斥，只能配置一项</td></tr><tr><td>addInclude(String…)</td><td>增加表匹配(内存过滤)</td><td>与 <code>addExclude</code> 互斥，只能配置一项，支持正则匹配，如 <code>^t_.*</code> 匹配所有以 <code>t_</code> 开头的表名</td></tr><tr><td>addExclude(String…)</td><td>增加表排除匹配(内存过滤)</td><td>与 <code>addInclude</code> 互斥，只能配置一项，支持正则匹配，如 <code>.*st$</code> 匹配所有以 <code>st</code> 结尾的表名</td></tr><tr><td>addTablePrefix(String…)</td><td>增加过滤表前缀</td><td/></tr><tr><td>addTableSuffix(String…)</td><td>增加过滤表后缀</td><td/></tr><tr><td>addFieldPrefix(String…)</td><td>增加过滤字段前缀</td><td/></tr><tr><td>addFieldSuffix(String…)</td><td>增加过滤字段后缀</td><td/></tr><tr><td>outputFile</td><td>内置模板输出文件处理</td><td>参考测试用例 <code>H2CodeGeneratorTest.testOutputFile</code></td></tr><tr><td>entityBuilder</td><td>实体策略配置</td><td/></tr><tr><td>controllerBuilder</td><td>Controller 策略配置</td><td/></tr><tr><td>mapperBuilder</td><td>Mapper 策略配置</td><td/></tr><tr><td>serviceBuilder</td><td>Service 策略配置</td><td/></tr></tbody></table>
<p>可以看到策略配置对提供统一的生成规则配置，还支持<code>entity, mapper, service, controller</code>等类分别配置，条理清晰，功能强大。碍于篇幅问题，我这里就只展示一下实体类entity的生成策略配置，其他的详见官网文档。</p>
<p><strong>Entity 策略配置</strong></p>
<p>实体策略配置用于定制实体类的生成规则，包括父类、序列化版本 UID、文件覆盖、字段常量、链式模型、Lombok 模型等</p>
































































































































































<table><thead><tr><th>方法</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>nameConvert(INameConvert)</td><td>名称转换实现</td><td/></tr><tr><td>superClass(Class&lt;?&gt;)</td><td>设置父类</td><td><code>BaseEntity.class</code></td></tr><tr><td>superClass(String)</td><td>设置父类</td><td><code>com.baomidou.global.BaseEntity</code></td></tr><tr><td>disableSerialVersionUID</td><td>禁用生成 serialVersionUID</td><td>默认值: <code>true</code></td></tr><tr><td>enableFileOverride</td><td>覆盖已生成文件</td><td>默认值: <code>false</code></td></tr><tr><td>enableColumnConstant</td><td>开启生成字段常量</td><td>默认值: <code>false</code></td></tr><tr><td>enableChainModel</td><td>开启链式模型</td><td>默认值: <code>false</code></td></tr><tr><td>enableLombok</td><td>开启 Lombok 模型</td><td>默认值: <code>false</code> 默认只有Getter,Setter,自3.5.10后增加ToString</td></tr><tr><td>enableRemoveIsPrefix</td><td>开启 Boolean 类型字段移除 is 前缀</td><td>默认值: <code>false</code></td></tr><tr><td>enableTableFieldAnnotation</td><td>开启生成实体时生成字段注解</td><td>默认值: <code>false</code></td></tr><tr><td>enableActiveRecord</td><td>开启 ActiveRecord 模型</td><td>默认值: <code>false</code></td></tr><tr><td>versionColumnName(String)</td><td>乐观锁字段名(数据库字段)</td><td><code>versionColumnName</code> 与 <code>versionPropertyName</code> 二选一即可</td></tr><tr><td>versionPropertyName(String)</td><td>乐观锁属性名(实体)</td><td><code>versionColumnName</code> 与 <code>versionPropertyName</code> 二选一即可</td></tr><tr><td>logicDeleteColumnName(String)</td><td>逻辑删除字段名(数据库字段)</td><td><code>logicDeleteColumnName</code> 与 <code>logicDeletePropertyName</code> 二选一即可</td></tr><tr><td>logicDeletePropertyName(String)</td><td>逻辑删除属性名(实体)</td><td><code>logicDeleteColumnName</code> 与 <code>logicDeletePropertyName</code> 二选一即可</td></tr><tr><td>naming</td><td>数据库表映射到实体的命名策略</td><td>默认下划线转驼峰命名: <code>NamingStrategy.underline_to_camel</code></td></tr><tr><td>columnNaming</td><td>数据库表字段映射到实体的命名策略</td><td>默认为 <code>null</code>，未指定按照 <code>naming</code> 执行</td></tr><tr><td>addSuperEntityColumns(String…)</td><td>添加父类公共字段</td><td/></tr><tr><td>addIgnoreColumns(String…)</td><td>添加忽略字段</td><td/></tr><tr><td>addTableFills(IFill…)</td><td>添加表字段填充</td><td/></tr><tr><td>addTableFills(List)</td><td>添加表字段填充</td><td/></tr><tr><td>idType(IdType)</td><td>全局主键类型</td><td/></tr><tr><td>convertFileName(ConverterFileName)</td><td>转换文件名称</td><td/></tr><tr><td>formatFileName(String)</td><td>格式化文件名称</td><td/></tr><tr><td>toString(boolean)</td><td>是否生成ToString方法</td><td>默认为true, 自3.5.10开始</td></tr><tr><td>fieldUseJavaDoc</td><td>启用字段文档注释</td><td>默认为true, 自3.5.10开始</td></tr><tr><td>classAnnotations(ClassAnnotationAttributes)</td><td>添加实体类注解</td><td>自3.5.10开始</td></tr><tr><td>tableAnnotationHandler</td><td>表注解处理器</td><td>自3.5.10开始</td></tr><tr><td>tableFieldAnnotationHandler</td><td>字段注解处理器</td><td>自3.5.10开始</td></tr><tr><td>enableLombok(ClassAnnotationAttributes…)</td><td>开启 Lombok 模型并设置Lombok注解</td><td>自3.5.10开始. 使用@Data示例: enableLombok(new ClassAnnotationAttributes(“@Data”,“lombok.Data”))</td></tr></tbody></table>
<p>当然了除了上面提到的全局配置和策略配置，还有数据源配置，包名配置等等，但这些都比较简单，顾名思义数据源配置就是配置数据源的，包名配置就是配置生成代码类的包名路径，具体方法api还是请移步官网查看</p>
<h2 data-id="heading-8">4. 自定义模板：打造团队专属代码风格</h2>
<h3 data-id="heading-9">4.1 自定义DTO生成模板</h3>
<p>MPG默认不提供DTO模板，但我们可以轻松扩展。创建<code>templates/entityDTO.java.ftl</code>：</p>
<pre><code class="hljs language-bash" lang="bash">package <span class="hljs-variable">${package.Entity}</span>;
​
&lt;<span class="hljs-comment">#list importEntityFrameworkPackages as pkg&gt;</span>
import <span class="hljs-variable">${pkg}</span>;
&lt;/<span class="hljs-comment">#list&gt;</span>
​
&lt;<span class="hljs-comment">#list importEntityJavaPackages as pkg&gt;</span>
import <span class="hljs-variable">${pkg}</span>;
&lt;/<span class="hljs-comment">#list&gt;</span>
​
/**
 * &lt;p&gt;
 * <span class="hljs-variable">${table.comment!}</span>
 * &lt;/p&gt;
 *
 * @author <span class="hljs-variable">${author}</span>
 * @since <span class="hljs-variable">${date}</span>
 */
@Data
@Schema(description = <span class="hljs-string">"<span class="hljs-variable">${table.comment!}</span>"</span>)
public class <span class="hljs-variable">${entity}</span>DTO {
&lt;<span class="hljs-comment">#-- ----------  BEGIN 字段循环遍历  ----------&gt;</span>
&lt;<span class="hljs-comment">#list table.fields as field&gt;</span>
    @Schema(description = <span class="hljs-string">"<span class="hljs-variable">${field.comment!}</span>"</span>)
    private <span class="hljs-variable">${field.propertyType}</span> <span class="hljs-variable">${field.propertyName}</span>;
&lt;/<span class="hljs-comment">#list&gt;</span>
&lt;<span class="hljs-comment">#------------  END 字段循环遍历  ----------&gt;</span>
}
​
</code></pre>
<p>关于Freemarker模版的语法，请另行查阅资料。</p>
<p>在上面生成示例代码中追加注入配置：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.injectionConfig</span>(injectConfig -&gt; {
                    <span class="hljs-selector-tag">injectConfig</span><span class="hljs-selector-class">.customFile</span>(new CustomFile.<span class="hljs-built_in">Builder</span>()
                            .<span class="hljs-built_in">fileName</span>(<span class="hljs-string">"DTO.java"</span>) <span class="hljs-comment">// 文件名称</span>
                            .<span class="hljs-built_in">templatePath</span>(<span class="hljs-string">"templates/entityDTO.java.ftl"</span>) <span class="hljs-comment">//指定生成模板路径</span>
                            .<span class="hljs-built_in">packageName</span>(<span class="hljs-string">"model.dto"</span>) <span class="hljs-comment">// 包名,</span>
                            .<span class="hljs-built_in">build</span>());
</code></pre>
<p>再次运行就能生成如下代码：</p>
<pre><code class="hljs language-ini" lang="ini">@Data
@Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"用户信息"</span>)
public class UserDTO {
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"主键"</span>)
    private Long id<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"编号"</span>)
    private String userNo<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"昵称"</span>)
    private String name<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"邮箱"</span>)
    private String email<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"手机号"</span>)
    private String phone<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"性别  0：男生   1：女生"</span>)
    private Byte gender<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"出生日期"</span>)
    private LocalDateTime birthday<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"删除标志 0：否  1：是"</span>)
    private Byte isDelete<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"创建时间"</span>)
    private LocalDateTime createTime<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"更新时间"</span>)
    private LocalDateTime updateTime<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"创建人"</span>)
    private Long creator<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"更新人"</span>)
    private Long updater<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"地址"</span>)
    private String address<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"角色id"</span>)
    private String roleId<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"爱好"</span>)
    private String hobby<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"个人说明"</span>)
    private String remark<span class="hljs-comment">;</span>
    @Schema(<span class="hljs-attr">description</span> = <span class="hljs-string">"公司id"</span>)
    private Long orgId<span class="hljs-comment">;</span>
}
​
</code></pre>
<h3 data-id="heading-10">4.2 定制功能丰富的Controller模板</h3>
<p>默认生成的Controller比较基础，如果业务的CRUD代码没有包含复杂处理逻辑，那么我们可以通过定制代码减少编码重复，创建更实用的模板<code>templates/controller.java.ftl</code>：</p>
<pre><code class="hljs language-less" lang="less">&lt;<span class="hljs-selector-id">#assign</span> <span class="hljs-selector-tag">serviceNameLower</span> = <span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.serviceName</span>?<span class="hljs-selector-tag">uncap_first</span>&gt;
&lt;<span class="hljs-selector-id">#assign</span> <span class="hljs-selector-tag">entityNameLower</span> = <span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>?<span class="hljs-selector-tag">uncap_first</span>&gt;
​
<span class="hljs-selector-tag">package</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Controller</span>};
​
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Service</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.serviceName</span>};
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Param</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Param</span>;
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.Query</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Query</span>;
<span class="hljs-selector-tag">import</span> ${<span class="hljs-selector-tag">package</span><span class="hljs-selector-class">.VO</span>}.${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.plasticene</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.pojo</span><span class="hljs-selector-class">.ResponseVO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Operation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.Tag</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Validated</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
​
​
<span class="hljs-comment">/**
 * &lt;p&gt;
 * ${table.comment!}
 * &lt;/p&gt;
 *
 * @author ${author}
 * @since ${date}
 */</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"&lt;#if package.ModuleName?? &amp;&amp; package.ModuleName != "</span><span class="hljs-string">"&gt;/${package.ModuleName}&lt;/#if&gt;/&lt;#if controllerMappingHyphenStyle&gt;${controllerMappingHyphen}&lt;#else&gt;${table.entityPath}&lt;/#if&gt;"</span>)
@<span class="hljs-selector-tag">Tag</span>(name = <span class="hljs-string">"${table.comment!}"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.controllerName</span>} {
    <span class="hljs-variable">@Resource</span>
    private ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.serviceName</span>} ${<span class="hljs-selector-tag">serviceNameLower</span>};
​
    @<span class="hljs-selector-tag">PostMapping</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"创建"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Long</span>&gt; <span class="hljs-selector-tag">create</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Param</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>) {
        <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">id</span> = ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.create</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>);
         <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(id);
    }
​
    @<span class="hljs-selector-tag">PutMapping</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"修改"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">update</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Param</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>) {
        ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.update</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Param</span>);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
    }
​
    @<span class="hljs-selector-tag">DeleteMapping</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"删除"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">delete</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Long&gt; idList) {
        ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.delete</span>(idList);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
    }
​
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"分页"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">PageResult</span>&lt;${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>&gt;&gt; <span class="hljs-selector-tag">page</span>(${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">Query</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Quey</span>) {
        <span class="hljs-selector-tag">PageResult</span>&lt;${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>&gt; <span class="hljs-selector-tag">pageVO</span> = ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.page</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">Query</span>);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(pageVO);
    }
​
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"详情"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span>&gt; <span class="hljs-selector-tag">detail</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id) {
        ${<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.entityName</span>}<span class="hljs-selector-tag">VO</span> ${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">VO</span> = ${<span class="hljs-selector-tag">serviceNameLower</span>}<span class="hljs-selector-class">.detail</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(${<span class="hljs-selector-tag">entityNameLower</span>}<span class="hljs-selector-tag">VO</span>);
    }
​
}
</code></pre>
<p>再次运行上面生成示例代码：<code>UserController</code></p>
<pre><code class="hljs language-less" lang="less">​
<span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.controller</span>;
​
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.UserService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.param</span><span class="hljs-selector-class">.UserParam</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.UserQuery</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.shepherd</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.vo</span><span class="hljs-selector-class">.UserVO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.plasticene</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.pojo</span><span class="hljs-selector-class">.ResponseVO</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Operation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.Tag</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Validated</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
​
​
<span class="hljs-comment">/**
 * &lt;p&gt;
 * 用户信息
 * &lt;/p&gt;
 *
 * @author ZFJ
 * @since 2025-12-03
 */</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/user"</span>)
@<span class="hljs-selector-tag">Tag</span>(name = <span class="hljs-string">"用户信息"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserController</span> {
    <span class="hljs-variable">@Resource</span>
    private UserService userService;
​
    <span class="hljs-variable">@PostMapping</span>
    <span class="hljs-variable">@Operation</span>(summary = <span class="hljs-string">"创建"</span>)
    public ResponseVO&lt;Long&gt; <span class="hljs-built_in">create</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> UserParam userParam) {
        <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">id</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.create</span>(userParam);
         <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(id);
    }
​
    @<span class="hljs-selector-tag">PutMapping</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"修改"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">update</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Validated</span> UserParam userParam) {
        <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.update</span>(userParam);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
    }
​
    @<span class="hljs-selector-tag">DeleteMapping</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"删除"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">delete</span>(<span class="hljs-variable">@RequestBody</span> List&lt;Long&gt; idList) {
        <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.delete</span>(idList);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>();
    }
​
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"分页"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">PageResult</span>&lt;<span class="hljs-selector-tag">UserVO</span>&gt;&gt; <span class="hljs-selector-tag">page</span>(UserQuery userQuey) {
        <span class="hljs-selector-tag">PageResult</span>&lt;<span class="hljs-selector-tag">UserVO</span>&gt; <span class="hljs-selector-tag">pageVO</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.page</span>(userQuery);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(pageVO);
    }
​
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/{id}"</span>)
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"详情"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseVO</span>&lt;<span class="hljs-selector-tag">UserVO</span>&gt; <span class="hljs-selector-tag">detail</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id) {
        <span class="hljs-selector-tag">UserVO</span> <span class="hljs-selector-tag">userVO</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.detail</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseVO</span><span class="hljs-selector-class">.success</span>(userVO);
    }
​
}
​
</code></pre>
<p>至于service层的业务定制代码，大家自行尝试定制一下哈。</p>
<h2 data-id="heading-11">5.深入原理：MPG是如何工作的？</h2>
<h3 data-id="heading-12">5.1 核心类结构</h3>
<pre><code class="hljs language-arduino" lang="arduino">AutoGenerator              <span class="hljs-comment">// 代码生成器入口</span>
├── ConfigBuilder          <span class="hljs-comment">// 配置构建器</span>
├── TemplateEngine         <span class="hljs-comment">// 模板引擎抽象</span>
│   ├── VelocityTemplateEngine
│   ├── FreemarkerTemplateEngine
│   └── BeetlTemplateEngine
└── InjectionConfig        <span class="hljs-comment">// 注入配置</span>
</code></pre>
<h3 data-id="heading-13">5.2 代码生成流程</h3>
<ol>
<li><strong>配置解析</strong>：解析全局配置、数据源配置、包配置、策略配置</li>
<li><strong>表信息获取</strong>：通过JDBC获取数据库表结构和字段信息</li>
<li><strong>模板渲染</strong>：使用模板引擎将数据模型渲染到模板文件中</li>
<li><strong>文件输出</strong>：将渲染结果写入到指定目录</li>
</ol>
<h3 data-id="heading-14">5.3 关键源码分析</h3>
<p>调试上面生成代码示例，直接来到<code>AutoGenerator</code>的执行方法<code>#execute()</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"> <span class="hljs-keyword">public</span> void execute(AbstractTemplateEngine templateEngine) {
        logger.debug(<span class="hljs-string">"==========================准备生成文件...=========================="</span>);
        
        <span class="hljs-comment">// 如果配置信息为空，则创建新的配置构建器</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == <span class="hljs-keyword">this</span>.config) {
            <span class="hljs-keyword">this</span>.config = new ConfigBuilder(<span class="hljs-keyword">this</span>.packageInfo, <span class="hljs-keyword">this</span>.dataSource, <span class="hljs-keyword">this</span>.strategy, <span class="hljs-keyword">this</span>.template, <span class="hljs-keyword">this</span>.globalConfig, <span class="hljs-keyword">this</span>.injection);
        }
​
        <span class="hljs-comment">// 如果模板引擎为空，则使用默认的Velocity模板引擎</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == templateEngine) {
            templateEngine = new VelocityTemplateEngine();
        }
​
        <span class="hljs-comment">// 设置配置构建器并执行批量输出操作</span>
        templateEngine.setConfigBuilder(<span class="hljs-keyword">this</span>.config);
        templateEngine.<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>.config).batchOutput().<span class="hljs-keyword">open</span>();
        logger.debug(<span class="hljs-string">"==========================文件生成完成！！！=========================="</span>);
    }
</code></pre>
<p>最后到生成各类代码文件的方法<code>batchOutput()</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin">    <span class="hljs-comment">/**
     * 批量输出模板文件
     * &lt;p&gt;
     * 该方法根据配置信息批量生成代码文件，包括实体类、Mapper、Service、Controller等文件。
     * 处理流程如下：
     * 1. 获取配置构建器和表信息列表
     * 2. 遍历每张表，生成对应的对象映射关系
     * 3. 执行自定义文件输出前的回调处理
     * 4. 输出各类代码文件
     *
     * <span class="hljs-doctag">@return</span> AbstractTemplateEngine 模板引擎实例，用于链式调用
     * <span class="hljs-doctag">@throws</span> RuntimeException 当文件创建失败或配置信息有误时抛出运行时异常
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-meta">@NotNull</span> AbstractTemplateEngine batchOutput() {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取配置构建器实例</span>
            ConfigBuilder config = <span class="hljs-keyword">this</span>.getConfigBuilder();
            <span class="hljs-comment">// 获取所有需要处理的表信息列表</span>
            List&lt;TableInfo&gt; tableInfoList = config.getTableInfoList();
            
            <span class="hljs-comment">// 遍历所有表信息，为每张表生成相应的代码文件</span>
            tableInfoList.forEach((tableInfo) -&gt; {
                <span class="hljs-comment">// 构建当前表的对象映射关系，用于模板渲染</span>
                Map&lt;String, Object&gt; objectMap = <span class="hljs-keyword">this</span>.getObjectMap(config, tableInfo);
                
                <span class="hljs-comment">// 处理自定义注入配置（如果存在）</span>
                Optional.ofNullable(config.getInjectionConfig()).ifPresent((t) -&gt; {
                    <span class="hljs-comment">// 在输出文件前执行自定义回调处理</span>
                    t.beforeOutputFile(tableInfo, objectMap);
                    <span class="hljs-comment">// 输出自定义文件</span>
                    <span class="hljs-keyword">this</span>.outputCustomFile(t.getCustomFiles(), tableInfo, objectMap);
                });
                
                <span class="hljs-comment">// 按顺序输出各类标准代码文件</span>
                <span class="hljs-keyword">this</span>.outputEntity(tableInfo, objectMap);
                <span class="hljs-keyword">this</span>.outputMapper(tableInfo, objectMap);
                <span class="hljs-keyword">this</span>.outputService(tableInfo, objectMap);
                <span class="hljs-keyword">this</span>.outputController(tableInfo, objectMap);
            });
            
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> new RuntimeException(<span class="hljs-string">"无法创建文件，请检查配置信息！"</span>, e);
        }
    }
​
</code></pre>
<h2 data-id="heading-15">6.总结</h2>
<p>MyBatis-Plus代码生成器作为一款功能强大、扩展性极佳的代码生成工具，通过合理的配置策略和灵活的自定义模板，能够满足绝大多数项目的代码生成需求。深入理解其底层原理并掌握高级应用技巧，不仅能大幅提升开发效率，更能确保团队代码的规范性和一致性。</p>
<p>对于后端开发者而言，定制符合团队规范的代码生成方案，主要有两种实践路径：</p>
<p><strong>📦 方案一：Spring Boot深度集成</strong></p>
<ul>
<li>将生成策略封装为配置文件，与项目无缝集成</li>
<li>支持一键生成代码到指定项目目录</li>
<li>可进一步封装为Starter，实现团队级标准化</li>
</ul>
<p><strong>🔧 方案二：工具类灵活定制</strong></p>
<ul>
<li>提供高度可配置的代码生成工具类</li>
<li>支持运行时动态规则设置</li>
<li>更适合多项目、差异化的生成需求</li>
</ul>
<p><strong>💡 重要提醒</strong></p>
<p>需要特别说明的是，本文旨在系统介绍MyBatis-Plus代码生成器的技术实现与最佳实践，并非鼓励盲目依赖代码生成。在实际项目中是否采用、如何采用，还需要结合具体的业务场景、团队规范和技术架构来审慎决策。</p>
<p><strong>关键在于</strong>：工具是为了提升效率，而好的代码更需要开发者的设计思维和业务理解。希望本文能帮助你做出更明智的技术选型！</p>
<hr/>
<p><strong>欢迎在评论区分享你的代码生成器使用经验！如果你有更好的定制方案，也期待一起交流探讨~</strong></p>
<p><em>觉得文章有帮助的话，欢迎点赞、收藏、转发支持～</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从神州22极限救援，看懂Git高级玩法]]></title>    <link>https://juejin.cn/post/7579507023508160575</link>    <guid>https://juejin.cn/post/7579507023508160575</guid>    <pubDate>2025-12-03T16:59:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579507023508160575" data-draft-id="7579519985699586054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从神州22极限救援，看懂Git高级玩法"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-03T16:59:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="云前端"/> <meta itemprop="url" content="https://juejin.cn/user/3034307821311895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从神州22极限救援，看懂Git高级玩法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307821311895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    云前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T16:59:46.000Z" title="Wed Dec 03 2025 16:59:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 年的太空探索史，注定是由中国人书写的。</p>
<p>4 月 24 日，神舟二十号载着三位航天员发射升空，按计划完成任务后，原定于 11 月中旬乘组轮换后返回。10 月 31 日，神舟二十一号作为常规乘组轮换任务发射，以 3.5 小时快速对接空间站。</p>
<p>转折发生在 11 月 4 日 —— 神舟二十号乘组在返回前一晚的例行检查中，发现返回舱舷窗边缘出现微小三角形痕迹；经研判为太空碎片撞击导致的 “贯穿性裂纹”。此时，2003 年哥伦比亚号航天飞机因机翼微小缺陷返航解体、7 名航天员全部遇难的历史警示犹在眼前，任务指挥部在 12 小时内果断推迟神舟二十号原定载人返回计划。</p>
<p>本为常规轮换的神舟二十一号飞船临危受命，承担起 “送神舟二十号乘组安全返回” 的应急任务，并于 9 天后完美返回。但二十一号乘组却也面临了没有返回船可用的境况；因此原定于 2026 年发射的神舟二十二号飞船被提前至 11 月 25 日以无人状态紧急升空对接，官方宣布，<strong>其宇航员序列永久空缺</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15a0ed83d4f5461b9f00a97fa255d57e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765385985&amp;x-signature=RH0a6UnoQL2nsjDRzrrzLf6V524%3D" alt="" loading="lazy"/></p>
<p>从软件开发的视角来看 -- “常规任务按计划推进” 到 “突发致命故障”，再到 “常规任务变应急、备用任务提前补位”，这场太空任务的节奏，恰恰可以用 Git Flow 中 “开发分支迭代→生产分支突发 Bug→紧急修复分支响应→功能分支补位” 的完整协作流程来类比理解。</p>
<p>毕竟反观当下软件开发，不少人对 Git 的使用还停留在 “能用就行” 的初级阶段：依赖 VSCode 图形化界面提交，遇到分支协作、应急修复就手足无措，版本回滚全靠 “猜”，分支管理一锅粥。</p>
<p>因此不妨略开脑洞，按真实任务时间线，用 Git Flow 完整复刻这场航天任务的分支管理逻辑。</p>
<h2 data-id="heading-0">一、空间站： master 与 develop 双分支</h2>
<p>Git Flow 的核心是 “双主干分支”：</p>
<ul>
<li>master对应 “生产环境 / 已验证的稳定状态”</li>
<li>develop对应 “开发环境 / 持续迭代的功能集”</li>
</ul>
<p>这就像航天任务的 “空间站核心稳定系统（master）” 与 “任务开发调度系统（develop）”，分工明确且互不干扰。</p>
<pre><code class="hljs language-perl" lang="perl">步骤 <span class="hljs-number">1</span>：初始化远端仓库与主干分支
<span class="hljs-comment"># 1. 初始化远端仓库（模拟航天任务总控中心）</span>
git init --bare space-station.git

<span class="hljs-comment"># 2. 本地克隆仓库，搭建双主干</span>
git clone space-station.git <span class="hljs-keyword">local</span>-station
cd <span class="hljs-keyword">local</span>-station

<span class="hljs-comment"># 3. 创建并推送 master 分支（生产分支：空间站核心稳定系统）</span>
touch station_core.txt
git add . &amp;&amp; git commit -m <span class="hljs-string">"feat: 空间站核心系统部署完成（v1.0），进入稳定运行状态"</span>
git <span class="hljs-keyword">push</span> origin master

<span class="hljs-comment"># 4. 从 master 拉出 develop 分支（开发分支：任务调度与功能迭代）</span>
git checkout -b develop
git commit --allow-empty -m <span class="hljs-string">"chore: 初始化 develop 分支，用于任务功能迭代"</span>
git <span class="hljs-keyword">push</span> origin develop
</code></pre>
<p>核心分工说明（Git Flow 基础）：</p>




















<table><thead><tr><th>分支类型</th><th>对应航天角色</th><th>核心规则</th></tr></thead><tbody><tr><td>master</td><td>空间站核心稳定系统</td><td>仅存储已验证的稳定版本，通过hotfix/release分支更新，禁止直接提交</td></tr><tr><td>develop</td><td>任务开发调度系统</td><td>所有新功能的开发基础，承接feature分支合并，持续迭代未上线功能</td></tr></tbody></table>
<h2 data-id="heading-1">二、神舟 20 号：常规feature任务推进</h2>
<p>神舟 20 号是 “2025 年核心常规任务”，对应 Git Flow 中的feature分支 —— 所有常规功能开发均从develop拉出，完成后合并回develop，不直接触碰master。</p>
<p>就像 航天任务从调度系统（develop）发起，完成后回归调度系统，不影响核心稳定系统。</p>
<h3 data-id="heading-2">步骤 1：创建feature分支并推进任务</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># 1. 基于 develop 拉出神舟20号功能分支（Git Flow 规范：feature 分支从 develop 创建）</span>
git checkout develop
git pull origin develop
git checkout -b feature/shenzhou-<span class="hljs-number">20</span>

<span class="hljs-comment"># 2. 模拟任务关键节点提交（遵循 Angular commit msg 规范，清晰记录进展）</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 2025.4.24 神舟20号发射入轨，对接空间站"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 完成第1-4次出舱实验，在轨驻留180天"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"fix: 修正第2次出舱实验的设备参数记录"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 完成剩余23天驻留，准备11月15日返回（待轮换）"</span>

<span class="hljs-comment"># 3. 用 rebase -i 整理提交（本地未推送前优化历史，Git Flow 推荐操作）</span>
git rebase -i HEAD~<span class="hljs-number">4</span>
<span class="hljs-comment"># 交互界面中，将3个feat/fix合并为1个完整提交（squash），最终信息：</span>
<span class="hljs-comment"># feat: 神舟20号完成发射、4次出舱、203天驻留，准备11月15日返回（v2.0）</span>

<span class="hljs-comment"># 4. 推送 feature 分支至远端，等待合并到 develop</span>
git push origin feature/shenzhou-<span class="hljs-number">20</span>
</code></pre>
<h3 data-id="heading-3">步骤 2：合并feature到develop（任务纳入调度系统）</h3>
<pre><code class="hljs language-bash" lang="bash">当神舟 20 号完成在轨驻留，确认功能正常（对应 “开发功能测试通过”），将其合并回develop，纳入 “任务调度系统”：
<span class="hljs-comment"># 1. 切换到 develop 分支，拉取最新状态</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 2. 合并 feature 分支（--no-ff 保留分支轨迹，便于追溯）</span>
git merge --no-ff feature/shenzhou-20 -m <span class="hljs-string">"chore: 合并神舟20号任务到 develop，完成常规驻留流程"</span>

<span class="hljs-comment"># 3. 推送 develop 分支，同步开发进度</span>
git push origin develop

<span class="hljs-comment"># 4. （可选）删除本地 feature 分支（任务完成后清理，保持仓库整洁）</span>
git branch -d feature/shenzhou-20
</code></pre>
<h2 data-id="heading-4">三、神舟 21 号：从常规任务到hotfix</h2>
<p>神舟 21 号的初始定位是 “常规乘组轮换任务”（feature分支），但因神舟 20 号 “贯穿性裂纹”（master分支突发 Bug），需转为 “紧急修复任务”。</p>
<p>这对应 Git Flow 中 “feature分支未上线，生产环境突发 Bug，立即从master拉出hotfix分支响应” 的场景，而非在原有feature分支修改。</p>
<h3 data-id="heading-5">步骤 1：初始feature分支推进（常规轮换任务）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 基于 develop 拉出神舟21号常规轮换分支</span>
git checkout develop
git pull origin develop
git checkout -b feature/shenzhou-21

<span class="hljs-comment"># 2. 提交常规任务进展</span>
git commit --allow-empty -m <span class="hljs-string">"feat: 2025.10.31 神舟21号常规发射，3.5小时对接空间站"</span>
git commit --allow-empty -m <span class="hljs-string">"feat: 完成在轨调试，等待11月15日常规乘组轮换"</span>

<span class="hljs-comment"># 3. 推送 feature 分支至远端</span>
git push origin feature/shenzhou-21
</code></pre>
<h3 data-id="heading-6">步骤 2：突发故障！从master拉出hotfix分支（紧急响应）</h3>
<p>当神舟 20 号的 “贯穿性裂纹” 被确认（对应 “master分支生产环境 Bug”），需立即从master创建hotfix分支 —— 这是 Git Flow 处理生产 Bug 的核心规则：紧急修复必须基于master，确保修复的是当前稳定版本的问题。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 切换到 master 分支，拉取最新稳定状态</span>
git checkout master
git pull origin master

<span class="hljs-comment"># 2. 从 master 拉出 hotfix 分支（紧急修复：送20号乘组返回）</span>
git checkout -b hotfix/shenzhou-21-rescue

<span class="hljs-comment"># 3. 提交紧急修复逻辑（对应神舟21号任务目标变更）</span>
git commit --allow-empty -m <span class="hljs-string">"hotfix: 调整神舟21号任务目标，承接20号乘组应急返回"</span>
git commit --allow-empty -m <span class="hljs-string">"hotfix: 2025.11.14 完成应急轮换，送20号乘组安全返回地球"</span>

<span class="hljs-comment"># 4. 推送 hotfix 分支至远端，等待验证</span>
git push origin hotfix/shenzhou-21-rescue
</code></pre>
<h3 data-id="heading-7">步骤 3：hotfix合并双主干（修复同步至稳定与开发系统）</h3>
<p>神舟 21 号完成应急返回（对应 “hotfix修复验证通过”），需同时合并到master（更新生产稳定版本）和develop（同步修复到开发系统，避免后续功能遗漏）—— 这是 Git Flow 与其他流程的核心区别，确保 “生产与开发的修复一致性”。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 1. 合并到 master（更新生产版本，标记修复完成）</span>
git checkout master
git pull origin master
git merge --no-ff hotfix/shenzhou-<span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span> -m <span class="hljs-string">"fix: 合并 hotfix 修复，20号乘组安全返回（v1.1）"</span>
git tag -a v1.<span class="hljs-number">1</span> -m <span class="hljs-string">"v1.1：完成神舟21号应急返回修复"</span> <span class="hljs-comment"># 打标签，标记生产版本</span>
git push origin master --tags

<span class="hljs-comment"># 2. 合并到 develop（同步修复到开发分支，避免后续功能冲突）</span>
git checkout develop
git pull origin develop
git merge --no-ff hotfix/shenzhou-<span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span> -m <span class="hljs-string">"fix: 同步 hotfix 修复到 develop，对齐生产状态"</span>
git push origin develop

<span class="hljs-comment"># 3. （可选）删除 hotfix 分支（修复完成后清理）</span>
git branch -d hotfix/shenzhou-<span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span>
git push origin <span class="hljs-symbol">:hotfix/shenzhou-</span><span class="hljs-number">21</span>-<span class="hljs-keyword">rescue</span>
</code></pre>
<h2 data-id="heading-8">四、神舟 22 号：紧急补位的feature分支</h2>
<p>神舟 22 号是 “提前发射的无人补位任务”，用于解决 “21 号乘组无返回船” 的问题。</p>
<p>对应 Git Flow 中 “基于develop创建feature分支，承接紧急修复后的补位需求”，确保补位功能在开发系统迭代，不直接影响生产。</p>
<h3 data-id="heading-9">步骤 1：基于develop创建补位feature分支</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># 1. 切换到 develop 分支，拉取最新同步后的状态（含21号修复）</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 2. 拉出补位功能分支（神舟22号：无人补给与返回保障）</span>
git checkout -b feature/shenzhou-<span class="hljs-number">22</span>-supplement

<span class="hljs-comment"># 3. 提交补位任务进展（遵循 commit 规范，明确功能目标）</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 2025.11.25 神舟22号提前无人发射（原计划2026）"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 完成空间站物资补给，保障21号乘组驻留"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"feat: 验证舷窗裂纹处置技术，留存故障解决方案"</span>
git commit --allow-<span class="hljs-keyword">empty</span> -m <span class="hljs-string">"docs: 标记神舟22号乘组序列永久空缺，同步任务文档"</span>

<span class="hljs-comment"># 4. 推送 feature 分支至远端，等待验证与合并</span>
git push origin feature/shenzhou-<span class="hljs-number">22</span>-supplement
</code></pre>
<h3 data-id="heading-10">步骤 2：合并feature到develop（补位任务纳入调度）</h3>
<p>当神舟 22 号完成对接与补给（对应 “补位功能测试通过”），合并回develop，完成整个应急补位流程：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 1. 切换到 develop 分支，拉取最新状态</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 2. 合并补位分支（--no-ff 保留轨迹，便于追溯补位逻辑）</span>
git merge --no-ff feature/shenzhou-<span class="hljs-number">22</span>-supplement -m <span class="hljs-string">"chore: 合并神舟22号补位任务到 develop，完成全流程保障"</span>

<span class="hljs-comment"># 3. 推送 develop 分支，同步补位结果</span>
git push origin develop

<span class="hljs-comment"># 4. （可选）删除补位 feature 分支</span>
git branch -d feature/shenzhou-<span class="hljs-number">22</span>-supplement
git push origin <span class="hljs-symbol">:feature/shenzhou-</span><span class="hljs-number">22</span>-supplement
</code></pre>
<h2 data-id="heading-11">五、可视化的全流程分支</h2>
<p>执行以下命令，可直观看到 Git Flow 完整分支轨迹，每一步均与航天任务一一对应：</p>
<pre><code class="hljs language-css" lang="css">git log <span class="hljs-attr">--graph</span> <span class="hljs-attr">--oneline</span> <span class="hljs-attr">--all</span> <span class="hljs-attr">--decorate</span>
</code></pre>
<p>输出示例（核心轨迹）</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">*</span>   <span class="hljs-number">8765432</span> <span class="hljs-string">(develop,</span> <span class="hljs-string">origin/develop)</span> <span class="hljs-attr">chore:</span> <span class="hljs-string">合并神舟22号补位任务到</span> <span class="hljs-string">develop，完成全流程保障</span>
<span class="hljs-string">|\</span>  
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-number">7654321</span> <span class="hljs-string">(feature/shenzhou-22-supplement)</span> <span class="hljs-attr">docs:</span> <span class="hljs-string">标记神舟22号乘组序列永久空缺</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">6543210 feat:</span> <span class="hljs-string">验证舷窗裂纹处置技术</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">5432109 feat:</span> <span class="hljs-string">完成空间站物资补给</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">4321098 feat:</span> <span class="hljs-number">2025.11</span><span class="hljs-number">.25</span> <span class="hljs-string">神舟22号提前无人发射</span>
<span class="hljs-string">*</span> <span class="hljs-string">|</span>   <span class="hljs-attr">3210987 chore:</span> <span class="hljs-string">同步</span> <span class="hljs-string">hotfix</span> <span class="hljs-string">修复到</span> <span class="hljs-string">develop，对齐生产状态</span>
<span class="hljs-string">|\</span> <span class="hljs-string">\</span>  
<span class="hljs-string">|</span> <span class="hljs-string">|/</span>  
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-number">2109876</span> <span class="hljs-string">(hotfix/shenzhou-21-rescue)</span> <span class="hljs-attr">hotfix:</span> <span class="hljs-number">2025.11</span><span class="hljs-number">.14</span> <span class="hljs-string">完成应急轮换</span>
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-attr">1098765 hotfix:</span> <span class="hljs-string">调整神舟21号任务目标</span>
<span class="hljs-string">|/</span>  
<span class="hljs-string">*</span>   <span class="hljs-number">0987654</span> <span class="hljs-string">(master,</span> <span class="hljs-string">origin/master,</span> <span class="hljs-attr">tag:</span> <span class="hljs-string">v1.1)</span> <span class="hljs-attr">fix:</span> <span class="hljs-string">合并</span> <span class="hljs-string">hotfix</span> <span class="hljs-string">修复，20号乘组安全返回（v1.1）</span>
<span class="hljs-string">|</span>  
<span class="hljs-string">*</span>   <span class="hljs-attr">9876543 chore:</span> <span class="hljs-string">合并神舟20号任务到</span> <span class="hljs-string">develop，完成常规驻留流程</span>
<span class="hljs-string">|\</span>  
<span class="hljs-string">|</span> <span class="hljs-string">*</span> <span class="hljs-number">8765432</span> <span class="hljs-string">(feature/shenzhou-20)</span> <span class="hljs-attr">feat:</span> <span class="hljs-string">神舟20号完成发射、4次出舱、203天驻留</span>
<span class="hljs-string">|/</span>  
<span class="hljs-string">*</span> <span class="hljs-attr">7654321 chore:</span> <span class="hljs-string">初始化</span> <span class="hljs-string">develop</span> <span class="hljs-string">分支，用于任务功能迭代</span>
<span class="hljs-string">*</span> <span class="hljs-attr">6543210 feat:</span> <span class="hljs-string">空间站核心系统部署完成（v1.0），进入稳定运行状态</span>
</code></pre>
<h2 data-id="heading-12">六、结语</h2>
<p>不起眼的 git 操作就是开发者每天的航天任务，master守好 “稳定底线”，develop管好 “功能迭代”，hotfix快速响应 “突发危机”，feature稳妥承接 “补位需求”，每一步都有明确的角色和规则。</p>
<p>从区分develop与master，到正确使用feature和hotfix，再到规范的 commit 信息与分支清理；这些基础操作的本质，都是 “让协作更有序、历史可追溯”。</p>
<p>掌握良好的 Git Flow，你的代码管理就能像中国航天一样，既规范严谨，又能从容应对各种突发情况。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多包构建优化实践：动态调度 + 多核并行的落地方案]]></title>    <link>https://juejin.cn/post/7579699192697815059</link>    <guid>https://juejin.cn/post/7579699192697815059</guid>    <pubDate>2025-12-04T08:26:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579699192697815059" data-draft-id="7579800429375225906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多包构建优化实践：动态调度 + 多核并行的落地方案"/> <meta itemprop="keywords" content="后端,Node.js,前端"/> <meta itemprop="datePublished" content="2025-12-04T08:26:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="猪猪拆迁队"/> <meta itemprop="url" content="https://juejin.cn/user/2541726613638973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多包构建优化实践：动态调度 + 多核并行的落地方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726613638973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    猪猪拆迁队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T08:26:30.000Z" title="Thu Dec 04 2025 08:26:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    58
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdcc1f39f50041559e5de68cd5f2c8b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yq54yq5ouG6L-B6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528315&amp;x-signature=86FhjuzeBZzLg1s%2BBwwEc6cMe5g%3D" alt="微信图片_20251204162520_3368_96.png" loading="lazy"/></p>
<h2 data-id="heading-0">背景与挑战</h2>
<p>在当前的前端二开场景中，无论是物料库中的组件，还是框架的核心 package，通常都会采用独立构建的方式。当需要同时更新多个构建单元时，传统的串行打包会使整体耗时明显增加，且多核 CPU 的资源无法得到有效利用。</p>
<p>在规模较大的项目中，动辄几十个组件需要同时构建，等待时间过长往往成为开发流程中的主要瓶颈。整体速度被最慢的任务限制，也就是常说的“木桶效应”。</p>
<p>为提升构建效率，我们引入了 <strong>动态负载均衡与并行调度</strong>，使各个 CPU 核心能够持续接收并执行任务。通过这种方式，可以显著加快组件和库文件的构建速度，从而缩短开发与发布周期。</p>
<h3 data-id="heading-1">应用场景</h3>
<ul>
<li>框架库文件打包</li>
<li>物料库组件打包</li>
</ul>
<h3 data-id="heading-2">业务场景</h3>
<p>本质上是为了解决物料库的构建效率问题，通过引入并行打包机制，并根据系统负载调度构建任务，从而提升整体打包性能。</p>
<ul>
<li><strong>package</strong>：库文件</li>
<li><strong>组件规模</strong>：50+ 独立 Widget 组件</li>
<li><strong>技术栈</strong>：Vue 3 + TypeScript + Vite</li>
<li><strong>部署模式</strong>：独立部署，支持按需加载</li>
<li><strong>版本管理</strong>：每个组件独立版本追踪</li>
</ul>
<h3 data-id="heading-3">传统方案的问题</h3>

















<table><thead><tr><th>方案</th><th>问题</th></tr></thead><tbody><tr><td><strong>串行构建</strong></td><td>N 个组件需要 N × T 时间，线性增长</td></tr><tr><td><strong>简单并行</strong></td><td>静态分配任务，快的核心空闲等待慢的核心</td></tr></tbody></table>
<h2 data-id="heading-4">核心创新：动态负载均衡调度</h2>
<h3 data-id="heading-5">静态并行 vs 动态负载均衡</h3>
<p>这是本构建系统最核心的设计亮点。我们来对比两种并行策略：</p>
<h4 data-id="heading-6">静态并行分配（传统方案）</h4>
<p>预先将所有任务平均分配给每个 CPU 核心。假设: 8个组件, 4核CPU, 组件构建时间不同。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title 静态并行分配 - 总时间: 26s
    dateFormat s
    axisFormat %S秒
    
    section Core 0
    W1 (10s)     :a1, 0, 10s
    W5 (5s)      :a2, after a1, 5s
    空闲等待      :done, a3, after a2, 11s
    
    section Core 1
    W2 (8s)      :b1, 0, 8s
    W6 (12s)     :b2, after b1, 12s
    空闲等待      :done, b3, after b2, 6s
    
    section Core 2
    W3 (15s)     :c1, 0, 15s
    W7 (3s)      :c2, after c1, 3s
    空闲等待      :done, c3, after c2, 8s
    
    section Core 3
    W4 (6s)      :d1, 0, 6s
    W8 (20s)     :crit, d2, after d1, 20s
</code></pre>
<blockquote>
<p><strong>问题</strong>: 核心空闲时间浪费，"木桶效应"—— 最慢的核心决定总时间</p>
</blockquote>
<h4 data-id="heading-7">动态负载均衡（本系统方案）</h4>
<p>每个核心完成当前任务后，立即从队列获取下一个任务。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title 动态负载均衡 - 总时间: ~21s
    dateFormat s
    axisFormat %S秒
    
    section Core 0
    W1 (10s)     :a1, 0, 10s
    W5 (5s)      :a2, after a1, 5s
    W7 (3s)      :a3, after a2, 3s
    W8剩余 (3s)  :a4, after a3, 3s
    
    section Core 1
    W2 (8s)      :b1, 0, 8s
    W6 (12s)     :b2, after b1, 12s
    
    section Core 2
    W3 (15s)     :c1, 0, 15s
    取新任务      :c2, after c1, 5s
    
    section Core 3
    W4 (6s)      :d1, 0, 6s
    W8前段 (14s) :d2, after d1, 14s
</code></pre>
<blockquote>
<p><strong>优势</strong>: 核心利用率最大化，无空闲等待</p>
</blockquote>
<h3 data-id="heading-8">调度算法详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph Queue["任务队列"]
        Q["[W1, W2, W3, W4, ...]"]
    end
    
    Queue --&gt; Core0["Core 0&lt;br/&gt;取出 W1"]
    Queue --&gt; Core1["Core 1&lt;br/&gt;取出 W2"]
    Queue --&gt; CoreN["Core N&lt;br/&gt;取出 WN"]
    
    Core0 --&gt; Build0["构建中"]
    Core1 --&gt; Build1["构建中"]
    CoreN --&gt; BuildN["构建中"]
    
    Build0 --&gt; Check0{"W1 完成!&lt;br/&gt;队列还有任务?"}
    Build1 --&gt; Check1{"W2 完成!&lt;br/&gt;队列还有任务?"}
    BuildN --&gt; CheckN{"WN 完成!&lt;br/&gt;队列还有任务?"}
    
    Check0 --&gt;|Yes| Next["立即取出下一个&lt;br/&gt;任务继续构建"]
    Check1 --&gt;|Yes| Next
    CheckN --&gt;|Yes| Next
    
    Next --&gt; Build0
    
    Check0 --&gt;|No| Done["所有任务完成&lt;br/&gt;→ 执行后处理（tag/zip）"]
    Check1 --&gt;|No| Done
    CheckN --&gt;|No| Done
</code></pre>
<h3 data-id="heading-9">核心代码实现</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 关键设计：进程完成回调中动态分配新任务</span>
run.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-keyword">async</span> (code) =&gt; {
  <span class="hljs-comment">// 当前任务完成，从剩余队列移除</span>
  remainWidgetNames.<span class="hljs-title function_">shift</span>()
  
  <span class="hljs-comment">// 检查是否还有待构建的组件</span>
  <span class="hljs-keyword">if</span> (widgetNames.<span class="hljs-property">length</span> &amp;&amp; isMultipleBuild) {
    <span class="hljs-comment">// 🔑 核心：立即从队列取出下一个任务</span>
    <span class="hljs-keyword">const</span> name = widgetNames.<span class="hljs-title function_">shift</span>()
    
    <span class="hljs-comment">// 更新进度显示</span>
    spinner.<span class="hljs-property">text</span> = <span class="hljs-string">`正在编译组件: <span class="hljs-subst">${name}</span>，剩余: <span class="hljs-subst">${widgetNames.length}</span>`</span>
    
    <span class="hljs-comment">// 🔑 递归调用，该核心继续构建下一个组件</span>
    <span class="hljs-title function_">build</span>(name)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!remainWidgetNames.<span class="hljs-property">length</span>) {
    <span class="hljs-comment">// 所有任务完成，执行后处理</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">tag</span>()
    <span class="hljs-title function_">getHostPackage</span>()
  }
})
</code></pre>
<h3 data-id="heading-10">性能对比分析</h3>
<p>假设场景：50 个组件，8 核 CPU，组件构建时间 5-30 秒不等</p>



































<table><thead><tr><th>指标</th><th>串行构建</th><th>静态并行</th><th>动态负载均衡</th></tr></thead><tbody><tr><td><strong>理论时间</strong></td><td>Σ(所有组件时间)</td><td>max(各核心总时间)</td><td>≈ Σ(时间) / CPU</td></tr><tr><td><strong>实际耗时</strong></td><td>~15 分钟</td><td>~8 分钟</td><td>~1-3 分钟</td></tr><tr><td><strong>CPU 利用率</strong></td><td>12.5% (1/8)</td><td>~60-70%</td><td>~95%+</td></tr><tr><td><strong>核心空闲</strong></td><td>7 核全程空闲</td><td>快核心等慢核心</td><td>几乎无空闲</td></tr></tbody></table>
<h4 data-id="heading-11">CPU 利用率对比</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">pie showData
    title 串行构建 - 平均利用率 25%
    "Core 0 (工作)" : 100
    "Core 1-3 (空闲)" : 0
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">pie showData
    title 静态并行 - 平均利用率 66%
    "有效利用" : 66
    "空闲浪费" : 34
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">pie showData
    title 动态负载均衡 - 平均利用率 96%
    "有效利用" : 96
    "空闲" : 4
</code></pre>





































<table><thead><tr><th>方案</th><th>Core 0</th><th>Core 1</th><th>Core 2</th><th>Core 3</th><th>平均利用率</th></tr></thead><tbody><tr><td>串行构建</td><td>100%</td><td>0%</td><td>0%</td><td>0%</td><td><strong>25%</strong></td></tr><tr><td>静态并行</td><td>55%</td><td>70%</td><td>100% (瓶颈)</td><td>40%</td><td><strong>66%</strong></td></tr><tr><td>动态负载均衡</td><td>95%</td><td>98%</td><td>96%</td><td>97%</td><td><strong>96%+</strong></td></tr></tbody></table>
<h2 data-id="heading-12">系统架构</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph Entry["入口层"]
        CLI["CLI 入口"] --&gt; Parser["参数解析"] --&gt; Mode["模式判断"]
    end
    
    Mode --&gt; Full["全量构建&lt;br/&gt;(full)"]
    Mode --&gt; Dynamic["动态负载&lt;br/&gt;均衡调度"]
    Mode --&gt; Single["单组件&lt;br/&gt;快速构建"]
    
    Full --&gt; Queue
    Dynamic --&gt; Queue
    Single --&gt; Queue
    
    subgraph Queue["任务队列 + Worker Pool"]
        Tasks["W1 | W2 | ... | Wn"]
    end
    
    Queue --&gt; Vite1["Vite P1&lt;br/&gt;(spawn)"]
    Queue --&gt; Vite2["Vite P2&lt;br/&gt;(spawn)"]
    Queue --&gt; ViteN["Vite PN&lt;br/&gt;(spawn)"]
    
    Vite1 --&gt;|完成后取新任务| Queue
    Vite2 --&gt;|完成后取新任务| Queue
    ViteN --&gt;|完成后取新任务| Queue
    
    Vite1 --&gt; Post
    Vite2 --&gt; Post
    ViteN --&gt; Post
    
    subgraph Post["后处理流水线"]
        Tag["tag"] --&gt; Zip["zip"] --&gt; Clean["清理"]
    end
</code></pre>
<h2 data-id="heading-13">多模式构建支持</h2>





























<table><thead><tr><th>模式</th><th>命令</th><th>调度策略</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>单组件</strong></td><td><code>npm run build WidgetA</code></td><td>直接执行</td><td>开发调试，秒级</td></tr><tr><td><strong>多组件</strong></td><td><code>npm run build A,B,C</code></td><td>动态负载均衡</td><td>增量发布</td></tr><tr><td><strong>全量</strong></td><td><code>npm run build full</code></td><td>Vite 内部优化</td><td>CI/CD 流水线</td></tr></tbody></table>
<h2 data-id="heading-14">进程通信设计</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Main["主进程 (调度器)"]
        Scheduler["任务调度"]
    end
    
    subgraph Env["环境变量传递"]
        E1["NODE_INDEX"]
        E2["BUILD_WIDGET_NAME"]
        E3["BUILD_MODE"]
    end
    
    subgraph Child["Vite 子进程 (构建引擎)"]
        Builder["构建执行"]
    end
    
    subgraph Events["事件回调"]
        Close["close: 任务完成通知"]
        Stderr["stderr: 错误/警告上报"]
    end
    
    Main --&gt; Env --&gt; Child
    Child --&gt; Events --&gt; Main
</code></pre>
<h2 data-id="heading-15">版本追踪系统</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Dir["dist/WidgetName/"]
        Index["index.js&lt;br/&gt;构建产物"]
        Tag["version.tag&lt;br/&gt;版本元信息"]
    end
    
    subgraph TagContent["version.tag 内容"]
        Commit["commit: a1b2c3d&lt;br/&gt;Git Hash - 代码版本"]
        Branch["branch: feature/xxx&lt;br/&gt;分支名 - 来源追踪"]
        User["userName: developer&lt;br/&gt;构建者 - 责任追溯"]
    end
    
    Tag --&gt; TagContent
</code></pre>
<h2 data-id="heading-16">产物打包流程</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    Start["构建完成"] --&gt; Step1["1. 创建目录结构&lt;br/&gt;wwwroot/resources + widgets"]
    Step1 --&gt; Step2["2. 拉取静态资源&lt;br/&gt;git clone assets.git"]
    Step2 --&gt; Step3["3. 复制构建产物&lt;br/&gt;dist/**/*.js → widgets/"]
    Step3 --&gt; Step4["4. ZIP 压缩&lt;br/&gt;wwwroot/ → wwwroot.zip"]
    Step4 --&gt; Step5["5. 清理临时文件&lt;br/&gt;rm node_modules/.cache/wwwroot"]
</code></pre>
<h2 data-id="heading-17">用户体验</h2>
<pre><code class="hljs language-python" lang="python">$ npm run build

⠋ 正在编译组件: QualityManagement，剩余组件数量：<span class="hljs-number">45</span>

✔ 已经编译完所有组件，正在添加版本tag，请稍后...
✔ 开始打包wwwroot.<span class="hljs-built_in">zip</span>包
✔ /path/to/wwwroot.<span class="hljs-built_in">zip</span> 压缩成功
✔ 编译总时间: <span class="hljs-number">145.32</span>秒
</code></pre>
<h2 data-id="heading-18">总结</h2>
<p>上述几种方案在实际应用中都有使用过，每当一种方案造成瓶颈后，就会着手下一个方案的执行，提升打包效率，目前动态负载均衡打包方式已经使用了2年之久，速度很稳定，打包效率很高，就是打包的时候会比较吃内存，还是需要稍微注意一下的，防止内存被吃完，导致系统崩溃，哈哈😄</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 20：开源个人项目时的一些注意事项]]></title>    <link>https://juejin.cn/post/7579553111472291894</link>    <guid>https://juejin.cn/post/7579553111472291894</guid>    <pubDate>2025-12-04T02:47:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579553111472291894" data-draft-id="7579553111472242742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 20：开源个人项目时的一些注意事项"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-04T02:47:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="申阳"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 20：开源个人项目时的一些注意事项
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    申阳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T02:47:59.000Z" title="Thu Dec 04 2025 02:47:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8822786f79a4980aad2ae5684ab0636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=O7gIBNfViIp79aNDYcZUJFRSQ70%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">一、前言</h2>
<p>首先声明这只是我的个人经验，我也没有上千 <code>star</code> 的热门开源项目，也不是什么开源大佬，这篇文章只是为了分享我在摸索开源的时候总结的一些小经验。如果你有一些更好的建议，希望大家一起讨论讨论。我将以我的这个项目来展开。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoshenyang%2Fez-admin-springboot4" target="_blank" title="https://github.com/Caoshenyang/ez-admin-springboot4" ref="nofollow noopener noreferrer">github.com/Caoshenyang…</a></p>
<h2 data-id="heading-1">二、项目启动前：想清楚再开始</h2>
<blockquote>
<p>我这里说的开源是指，把项目当做一个完整的产品来做，而不是将仓库设置成 <code>public</code> 。</p>
</blockquote>
<h3 data-id="heading-2">2.1. <strong>明确项目目标与价值</strong></h3>
<p>我们做开源首先要明确项目的目标与价值。</p>
<p>在这个专栏的开篇我就提到过，要么提高自身能力，要么提高个人影响力，要么带来收入，哪怕是收入的可能性，不要“无私奉献”，我并不是说“无私奉献”不好，而是如果你一直“无私奉献”，当热情被消耗完之后，这个项目大概率走不长远。</p>
<p>以我这个项目为例：</p>
<p><strong>项目的价值在哪里？</strong></p>
<ol>
<li>作为这个专栏的落地案例，提高这个专栏的真实性</li>
<li>尝试不同的架构，提升自身技术能力</li>
<li>做一个最小化模版，方便后续个人业务拓展</li>
</ol>
<blockquote>
<p>其实本质就是围绕了以上几点，提高个人影响力，为以后做付费服务做铺垫（这里我也不装高尚😄），本质就是如此，尊重自己的付出。</p>
</blockquote>
<h3 data-id="heading-3">2.2. 选择合适的开源协议</h3>
<p>对于开源协议这个我不细说，可以看一下 <code>gitee</code> 的介绍，这个是比较清晰的。根据自己情况选择即可。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02d7490c9ade4598a9432f0766f818c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=FjS2UeC%2BeK7PFHBvol%2BIgd39ROM%3D" alt="image-20251203173437007" loading="lazy"/></p>
<h3 data-id="heading-4">2.3. 做好市场调研</h3>
<p>相比目前市面上的产品，你的东西是否有亮点，对于类似产品，你的项目是替代、补充还是与他们集成。</p>
<p>还是以我这个项目为例，首先作为专栏的落地项目，毫无疑问，具有不可替代性，从这方面出发没有竞品。其次，相比于市面上的企业级的开源后台管理系统，我这个更倾向于个人，更加轻量化，结构更简单，不需要为了兼容各种情况做很多兼容性开发，这样代码结构会很清晰。很容易快速上手，而且完全在个人可控范围内，一个人也可以维护的过来。</p>
<h2 data-id="heading-5">三、项目初始化：打好基础</h2>
<h3 data-id="heading-6">3.1. <strong>创建一个清晰专业的 README.md</strong></h3>
<p><code>README</code> 是你的项目门面，必须精心设计。</p>
<p>它应该包含：</p>
<ul>
<li><strong>项目名称和 Logo</strong></li>
<li><strong>一句话简介</strong></li>
<li><strong>详细的功能特性列表</strong></li>
<li><strong>安装和使用指南</strong>（快速开始）</li>
<li><strong>截图、动图或演示链接</strong>（视觉效果至关重要）</li>
<li><strong>指向更详细文档的链接</strong></li>
</ul>
<blockquote>
<p>你不用刻意去做这些，等到上述一切都准备好才开始项目，应该是先有项目，再去根据项目不断完善他。</p>
</blockquote>
<h2 data-id="heading-7">四、开发与维护：保持项目健康</h2>
<blockquote>
<p>这里需要注意：如果项目主要作为个人作品、教程或实验性项目存在，其目的不是构建社区，而是展示某种技术或思想。我建议是选择不接受 <code>PR</code> , 从这点来说，这个项目并不能说是一个真正的“开源项目”，而是一个“开放源码的个人作品”，在显眼的地方加上声明：<strong>❗️注意：本仓库不接受 Pull Request</strong> ，请改为提交 <code>Issue</code> 来描述你的建议或问题。</p>
</blockquote>
<h2 data-id="heading-8">五、代码提交时的一些细节</h2>
<h3 data-id="heading-9">5.1. 注意数据安全</h3>
<p>当我们准备将项目托管到 <code>GitHub</code> 上的时候，一定一定要注意，特别是我们的配置文件，有的时候本地开发图方便，直接就把一些账号密码，签名密钥，直接写在配置文件里了，稍有疏忽就会提交出去，直接裸奔。</p>
<p>正确做法应该是这样的：通过读取配置的环境变量来做。</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">ez-admin-springboot4</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:ez_admin_db}?useUnicode=${DB_USE_UNICODE:true}&amp;characterEncoding=${DB_CHARSET:UTF-8}</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">${DB_USERNAME:postgres}</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">${DB_PASSWORD:postgres}</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">org.postgresql.Driver</span>
  <span class="hljs-attr">jpa:</span>
    <span class="hljs-attr">hibernate:</span>
      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">update</span>
    <span class="hljs-attr">show-sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">hibernate:</span>
        <span class="hljs-attr">dialect:</span> <span class="hljs-string">org.hibernate.dialect.PostgreSQLDialect</span>
        <span class="hljs-attr">format_sql:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">open-in-view:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 显式启用 OpenEntityManagerInView（消除警告）</span>
</code></pre>
<h3 data-id="heading-10">5.2. 提交时账号配置</h3>
<p>先看下面这张图，首先声明这个项目只有我一个人维护</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86d2fbfae1fc405f9ecd7137b6b4f705~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=WuDaxn5uSWXi0pBB2ltxM%2Fc25UM%3D" alt="image-20251204100844915" loading="lazy"/></p>
<p>注意到两点：</p>
<ol>
<li>明明是我自己的 <code>Github</code> 账号提交上去的，为什么不显示头像</li>
<li>为什么有的提交记录上有 <code>Verified</code> 标签，有的没有。</li>
</ol>
<p><strong>第一点：</strong> 我配置了 <code>GitHub</code> 的授权，但是因为公司的项目，我全局设置了用户名和邮箱，导致实际的用户名和邮箱与 <code>GitHub</code> 的用户名不匹配了，所以出现了这种情况，只需要在项目目录下，局部更改一下</p>
<pre><code class="hljs language-bash" lang="bash">git config user.name <span class="hljs-string">"Your Name"</span>
git config user.email <span class="hljs-string">"project-email@company.com"</span>
</code></pre>
<p>我试了一下，主要是由邮箱决定的，名称其实不影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d12e6904704427f917984d92c2d72e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765421278&amp;x-signature=DaR%2FCMUykOi7%2BTKc2r7ZVyZ5MjY%3D" alt="image-20251204102933184" loading="lazy"/></p>
<p><strong>第二点：</strong> 如果想要有这个验证标签，可以详细看一下这里： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fzh%2Fauthentication%2Fmanaging-commit-signature-verification%2Fabout-commit-signature-verification" target="_blank" title="https://docs.github.com/zh/authentication/managing-commit-signature-verification/about-commit-signature-verification" ref="nofollow noopener noreferrer">docs.github.com/zh/authenti…</a></p>
<blockquote>
<p>其实对于我这个项目来说，没什么意义，只是看到了，就去了解了一下。</p>
</blockquote>
<ul>
<li><strong>SSH 密钥：像是你家的【门禁卡/钥匙】</strong>
<ul>
<li><strong>目的：身份认证。</strong> 用于证明“你就是你”，从而获得访问权限。</li>
<li><strong>应用场景：</strong> 在 GitHub/GitLab 上，用它来<strong>安全地推送代码</strong>，代替输入用户名和密码。它让你能够与远程仓库进行读写操作（如 <code>git push</code>, <code>git pull</code>）。</li>
</ul>
</li>
<li><strong>GPG 密钥：像是你文件上的【官方印章和蜡封】</strong>
<ul>
<li><strong>目的：数字签名。</strong> 用于证明“这份文件（代码）确实是你本人发布的，并且在传输过程中没有被篡改”。</li>
<li><strong>应用场景：</strong> 为你的 <strong>Git 提交</strong> 和 <strong>Tag</strong> 创建加密签名，使其在 GitHub 上显示为 <strong>“Verified”</strong> 标记。它验证的是代码的完整性和来源。</li>
</ul>
</li>
</ul>
<p><strong>对比表格：</strong></p>








































<table><thead><tr><th align="left">特性</th><th align="left">SSH 密钥</th><th align="left">GPG 密钥</th></tr></thead><tbody><tr><td align="left"><strong>主要用途</strong></td><td align="left"><strong>认证</strong> - 安全访问服务器/代码仓库</td><td align="left"><strong>签名</strong> - 验证提交/标签的完整性和作者</td></tr><tr><td align="left"><strong>GitHub 上的体现</strong></td><td align="left">允许你执行 <code>git push</code>等操作</td><td align="left">在你的提交上显示 <strong>Verified</strong> 标记</td></tr><tr><td align="left"><strong>是否必须</strong></td><td align="left"><strong>强烈推荐</strong>（几乎必备，为了安全和方便）</td><td align="left"><strong>可选</strong>（为了更高的安全性和专业度）</td></tr><tr><td align="left"><strong>配置复杂度</strong></td><td align="left">简单</td><td align="left">相对复杂</td></tr><tr><td align="left"><strong>对个人项目的价值</strong></td><td align="left">高（安全推送代码）</td><td align="left">中低（除非项目非常严肃或用于协作）</td></tr><tr><td align="left"><strong>对开源协作项目的价值</strong></td><td align="left">高</td><td align="left">高（尤其是大型项目，用于确保提交可信）</td></tr></tbody></table>
<h2 data-id="heading-11">六、总结</h2>
<p>当我们想要做好一个产品的时候，思维只停留在编码层面还是不够的，在进行管理，推广等等，各方面有很多细节需要处理，我也是一个正在摸索的人，我尽量将我碰到的问题发表出来，或许有些片面，如果你有一些更好的意见欢迎评论区分享。</p>
<p><strong>千里之行，始于足下。你的“个人公司”从这第一个2小时开始。欢迎在评论区分享你的进展或遇到的卡点，我会逐一查看，尽可能的帮助解决。我们下一篇文章见！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[git提交代码失败？本地代码被清空了？git代码丢了怎么办？三步帮你找回来]]></title>    <link>https://juejin.cn/post/7579476335557165091</link>    <guid>https://juejin.cn/post/7579476335557165091</guid>    <pubDate>2025-12-04T01:21:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579476335557165091" data-draft-id="7579480677902073891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="git提交代码失败？本地代码被清空了？git代码丢了怎么办？三步帮你找回来"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-04T01:21:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="庸俗今天不摸鱼"/> <meta itemprop="url" content="https://juejin.cn/user/3725616663503053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            git提交代码失败？本地代码被清空了？git代码丢了怎么办？三步帮你找回来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3725616663503053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    庸俗今天不摸鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:21:42.000Z" title="Thu Dec 04 2025 01:21:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>只要你add.也就是你提交暂存更改，git就会留下操作记录git给你的代码留下快照，那么你就能通过git命令帮你找回来你丢失的代码</strong></p>
<p><strong>文件被 <code>git reset</code> 取消暂存，且工作区文件可能被误删 / 覆盖</strong>，但 Git 仍保留着这些文件的 “暂存记录”，可以通过 Git 底层对象恢复。以下是针对性的恢复步骤，分 “快速找回” 和 “深度恢复” 两种方案，确保能找回所有丢失的代码</p>
</blockquote>
<h3 data-id="heading-0">用 <code>git reflog</code> 恢复最近的修改（100% 覆盖你丢失的代码）</h3>
<ol>
<li><strong>查看所有 Git 操作历史</strong>（包括 <code>add</code>/<code>reset</code>/<code>commit</code>，能看到你之前的修改记录）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">用 git reflog 恢复最近的修改（100% 覆盖你丢失的代码）
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dae3ddbbff44c5ab4b55ecbd9d844df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bq45L-X5LuK5aSp5LiN5pG46bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765416102&amp;x-signature=cP7GrWxzFm%2FZwB%2B8WsyQwhy%2FM4c%3D" alt="image.png" loading="lazy"/></p>
<p>输出示例（重点看<strong>时间和操作</strong>，找 实际操作的时间例如 17：33 左右的记录）：</p>
<pre><code class="hljs language-plaintext" lang="plaintext">d02c1bc (HEAD) HEAD@{0}: reset: ...
abc1234 HEAD@{1}: add: .eslintrc-auto-import.json ...  # 你执行 git add 的记录
def4567 HEAD@{2}: commit: xxx
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca7f4d3cf55747eabb2824273df690fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bq45L-X5LuK5aSp5LiN5pG46bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765416102&amp;x-signature=Udg0sCqJNRxrfXMXMB2ZnlFX%2BGc%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>
<p><strong>查看备份内容</strong>（确认备份包含你的修改）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看 stash 备份的详细信息（确认是你丢失的文件）</span>
git stash show -p XXXXX
</code></pre>
<ul>
<li>执行后会输出备份中的所有文件修改内容，你会看到 <code>xxx.vue</code>、<code>xxx.ts</code> 等文件的代码，说明备份有效。</li>
</ul>
</li>
</ol>
<blockquote>
<p>这里会出现显示不完全的情况，没找到你的文件不要慌张，从 <code>git stash show</code> 输出看，当前显示的只是<strong>部分</strong>的修改，<strong>不是完整的备份内容</strong>（因为输出被截断了，末尾有 <code>:...skipping...</code>）。你的核心代码（<code>xxx.vue</code>、<code>xxx.ts</code> 等）其实还在这个 stash 备份里，只是没显示全！</p>
</blockquote>
<ol start="3">
<li><strong>现在直接执行：恢复完整的 stash 备份（不用管部分显示）</strong></li>
</ol>
<p>不用纠结显示的内容，直接应用整个 stash 备份，所有文件都会恢复：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 强制应用 stash 备份，覆盖当前工作区（确保所有修改都回来）</span>
git stash pop xxxxxx
</code></pre>
<hr/>
<p><strong>备用方案</strong></p>
<ol>
<li>
<p>打开 <strong>Git Bash</strong>（在项目文件夹空白处右键 → Git Bash Here，直接进入项目根目录）；</p>
</li>
<li>
<p>把脚本 <strong>逐行复制粘贴到 Git Bash 中</strong>，按回车执行（不需要保存为文件，直接粘贴运行）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ./recovered_files
<span class="hljs-built_in">cd</span> .git/objects || <span class="hljs-built_in">exit</span>
<span class="hljs-keyword">for</span> <span class="hljs-built_in">dir</span> <span class="hljs-keyword">in</span> [0-9a-f][0-9a-f]; <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span>/*; <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-built_in">hash</span>=<span class="hljs-string">"$dir<span class="hljs-variable">${file#$dir/}</span>"</span>
      <span class="hljs-built_in">type</span>=$(git cat-file -t <span class="hljs-string">"<span class="hljs-variable">$hash</span>"</span> 2&gt;/dev/null)
      <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$type</span>"</span> = <span class="hljs-string">"blob"</span> ]; <span class="hljs-keyword">then</span>
        git cat-file -p <span class="hljs-string">"<span class="hljs-variable">$hash</span>"</span> &gt; <span class="hljs-string">"../../recovered_files/<span class="hljs-variable">$hash</span>"</span>
        <span class="hljs-keyword">if</span> git cat-file -p <span class="hljs-string">"<span class="hljs-variable">$hash</span>"</span> 2&gt;/dev/null | grep -q <span class="hljs-string">"&lt;template"</span>; <span class="hljs-keyword">then</span>
          <span class="hljs-built_in">mv</span> <span class="hljs-string">"../../recovered_files/<span class="hljs-variable">$hash</span>"</span> <span class="hljs-string">"../../recovered_files/<span class="hljs-variable">$hash</span>.vue"</span>
        <span class="hljs-keyword">elif</span> git cat-file -p <span class="hljs-string">"<span class="hljs-variable">$hash</span>"</span> 2&gt;/dev/null | grep -q <span class="hljs-string">"export default"</span>; <span class="hljs-keyword">then</span>
          <span class="hljs-built_in">mv</span> <span class="hljs-string">"../../recovered_files/<span class="hljs-variable">$hash</span>"</span> <span class="hljs-string">"../../recovered_files/<span class="hljs-variable">$hash</span>.ts"</span>
        <span class="hljs-keyword">elif</span> git cat-file -p <span class="hljs-string">"<span class="hljs-variable">$hash</span>"</span> 2&gt;/dev/null | grep -q <span class="hljs-string">"{"</span><span class="hljs-string">"; then
          mv "</span>../../recovered_files/<span class="hljs-variable">$hash</span><span class="hljs-string">" "</span>../../recovered_files/<span class="hljs-variable">$hash</span>.json<span class="hljs-string">"
        fi
      fi
    fi
  done
done
cd ../.. || exit
echo "</span>所有文件快照已导出到 ./recovered_files 目录<span class="hljs-string">"
</span></code></pre>
</li>
<li>
<p>执行后，会在项目根目录生成 <code>recovered_files</code> 文件夹，里面就是所有 Git 缓存的文件快照。</p>
</li>
</ol>
<ul>
<li>行后，打开 <code>./recovered_files</code> 目录，里面会有所有 Git 缓存的文件快照；</li>
<li>按文件类型（<code>.vue</code>、<code>.ts</code>）筛选，找到你丢失的文件（如 <code>xxx.vue</code>、<code>xxxx.ts</code>），复制回项目对应的目录即可。</li>
</ul>
<h4 data-id="heading-1">2. 精准筛选丢失的文件</h4>
<p>如果 <code>recovered_files</code> 文件太多，用关键词搜索快速定位：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 搜索包含 "xxxxx" 关键词的文件（Vue 组件）</span>
grep -r <span class="hljs-string">"xxxxxx"</span> ./recovered_files --include=<span class="hljs-string">"*.vue"</span>

<span class="hljs-comment"># 搜索包含 "xxxx" 关键词的文件（TS 接口/API）</span>
grep -r <span class="hljs-string">"xxxxxx"</span> ./recovered_files --include=<span class="hljs-string">"*.ts"</span>

<span class="hljs-comment"># 搜索包含 "xxxxxxxx" json文件</span>
grep -r <span class="hljs-string">"xxxxxx"</span> ./recovered_files --include=<span class="hljs-string">"*.json"</span>
</code></pre>
<ul>
<li>找到后，复制文件到项目原路径，代码直接恢复。</li>
</ul>
<h3 data-id="heading-2">四、为什么文件会 “不在暂存区”？（日志复盘）</h3>
<p>从日志看，你在 <code>git add</code> 后执行了多次 <code>git reset</code> 命令，导致部分文件被取消暂存：</p>
<ul>
<li>这些 <code>reset</code> 操作仅取消 “暂存状态”，但默认不会删除工作区文件。如果工作区文件也丢了，可能是后续误删或 IDE 同步问题，但 Git 缓存的快照还在，通过上面的方案能恢复。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[做中国人自己的视频编辑UI框架，WebCut正式开源]]></title>    <link>https://juejin.cn/post/7579819594270900262</link>    <guid>https://juejin.cn/post/7579819594270900262</guid>    <pubDate>2025-12-04T09:22:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579819594270900262" data-draft-id="7579628944037249033" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="做中国人自己的视频编辑UI框架，WebCut正式开源"/> <meta itemprop="keywords" content="音视频开发,前端框架,视频编码"/> <meta itemprop="datePublished" content="2025-12-04T09:22:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="否子戈"/> <meta itemprop="url" content="https://juejin.cn/user/4072246798192349"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            做中国人自己的视频编辑UI框架，WebCut正式开源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4072246798192349/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    否子戈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T09:22:54.000Z" title="Thu Dec 04 2025 09:22:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37e4448b90a84520b3e06bbafe859c15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCm5a2Q5oiI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765445064&amp;x-signature=emVn2bgZzC4z4K5%2Bn6I3ta%2BaTzI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftangshuang%2Fwebcut" target="_blank" title="https://github.com/tangshuang/webcut" ref="nofollow noopener noreferrer">github.com/tangshuang/…</a></p>
</blockquote>
<p>朋友们晚上好啊，这段时间我在忙着完成最新的开源项目<code>WebCut</code>。这个项目是我这小半年来唯一的开源新项目，这对比我过去几年的一些开源事迹来说，真的是一段低产荒。不过这是正常的，没有任何人可以长时间的一直发布新项目，这种沉寂，正是因为我把时间和精力都投入在其他事情上，所以其实是好事。之所以要发起和开源这个项目，说起来还是有些背景，下面我会来聊一聊关于这个项目的一些背景，以及过程中在技术上的一些探索。</p>
<h2 data-id="heading-0">没有合适的视频编辑UI框架😭</h2>
<p>过去半年，我连续发布了多款与视频相关的产品，这些产品或多或少都需要用户参与视频编辑操作，比如给视频添加字幕、对视频进行裁剪、给视频配音等等，这些在视频编辑器中常见的视频处理工具，在Web端其实需求非常巨大，特别是现在AI领域，制作各种个样的视频的需求非常多。而这些需求，可能并不需要在产品中载入一整个视频编辑器，而是只需要几个简单的部件来实现编辑功能。然而回望开源市场，能够支持这种编辑能力的项目少之又少，虽然有一些项目呈现了视频编辑的能力，然而，要么项目太大，一个完整的视频编辑器甩在开发者脸上，要么过于底层，没有UI界面。如果我只是想有一个视频预览，再有轨道和几个配置界面，就没法直接用这些项目。包括我自己在内，每次有与视频相关的功能，都要把之前在另外一个产品中实现的编辑能力移植到新产品中，而且要调的细节也很多。正是这种求而不得的现状，促使我打算自己写一个视频编辑器项目。</p>
<h2 data-id="heading-1">初始想法💡：拼积木</h2>
<p>我可不是从0开始的，因为我已经开发过很多次视频编辑相关的功能了。我还在<a href="https://link.juejin.cn?target=https%3A%2F%2Fvidea.work" target="_blank" title="https://videa.work" ref="nofollow noopener noreferrer">Videa项目</a>中完整实现了一个视频编辑器。因此，我的想法是把我之前做过的功能，整理一遍，就可以得到想要的组件或逻辑。有了这个工具包之后，我只需要在将来的新产品中复用这些代码即可。于是我建立了一个独立的npm包，来把所有功能集中放在一起。随着持续的迭代，我发现其实这里面是有规律的。</p>
<p>视频编辑器我们都用过，像剪映一样，有各种功能，细节也很多。但是，当我们把视频编辑的功能放到某个具体的产品中时，我们是不可能直接把整个编辑器给用户的。实际上，我们最终呈现的产品形态，基本上都是剪映的子集，而且是很小很小的子集，可能只是整个剪映1%的功能，最终给到用户操作可能只是非常简单的一次性操作，而页面也很轻量，属于用户即用即走，用完就关再也不会来第二次的那种。正是这种看似功能点很小，但实际上需要为它单独定制，技术上的成本可以用巨大来描述的场景，让我觉得这是一个需要认真对待的点。</p>
<p>我的计划是采用组件化的思想，把一个视频编辑器拆成一个一个的组件，把一个完整的剪映编辑器，拆成一个按钮一个按钮的积木。当我们面对产品需求时，就从这些积木中挑选，然后组合成产品经理所描述的功能，同时，具体这些积木怎么布局，则根据设计稿调整位置，还可以用CSS来覆盖组件内部的样式，达到与设计稿媲美的效果。</p>
<p><img src="https://www.tangshuang.net/wp-content/uploads/2025/12/%E6%88%AA%E5%B1%8F2025-12-03-22.50.36-980x581.png" alt="" loading="lazy"/></p>
<p>上面是我用AI做的一张示意图，大概就是这个意思，把一个编辑器拆的细碎，然后要什么功能就把对应的组件拿来拼凑一下。比如要对视频进行静音裁剪，就只要把预览区和轨道区拿出来，然后自己再增加一些能力上去。这样，开发者在面对各种各样的需求时，就能快速搭建起界面效果，而不需要从头实现界面和视频处理能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d15452723a2498f8316c50e89e8850b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCm5a2Q5oiI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765445064&amp;x-signature=OgsLv38QytF4YDZRtaOto28%2BnV8%3D" alt="" loading="lazy"/></p>
<p>通过不同的组合方式，配合开发者自己的布局，就可以创建符合需求的视频编辑界面。</p>
<h2 data-id="heading-2">没那么容易😥：外简内繁的接口艺术</h2>
<p>虽然想法很容易有，但是要做成成品，并且发布为可用的库可没那么轻松。要知道视频编辑器的功能非常多，多到我们无法用简单的文字描述它们。那么，如何才能站在开发者的角度，让这件事变得简单呢？</p>
<p>开发库永远面临着一个矛盾：灵活性和规范性之间的矛盾。灵活性就是暴露又多又细的接口，让开发者可以用不同参数，玩出花活，例如知名项目echarts早期就是这种。这种对于刚上手的开发者而言，无言是一场灾难，他们甚至不知道从哪里开始，但是一旦完全掌握，就相当于拥有了一个武器库，可以为所欲为。而规范性则是强制性规则比较多，只能暴露少量接口，避免开发者破坏这种规范，例如很多前端UI组件库就是这样。这两者之间的矛盾，是每一个库或框架开发者最难平衡的。</p>
<p>在视频编辑器上，我认为有些东西是固定的，几乎每一个需求都会用到，例如视频预览播放器、控制按钮等，但是有些功能是低频功能，例如媒体库、字幕编辑等。因此，对于高频和低频的功能，我用两种态度去处理。</p>
<p>高频的功能，拆的很细，拆到一个按钮为止，例如视频播放器，看上去已经很单一了，但是，我还要把预览屏幕和播放按钮拆开，屏幕和按钮如何布局就可以随意去处理。类似的还有导出按钮、分割片段按钮等等。把这些工具拆分为一个一个最小的单元，由开发者自由布局，这样就可以很好的去适配产品需求。</p>
<p>对于低频功能，则直接导出为大组件，这样就可以在一个组件内完成复杂的逻辑，减少开发这些组件时需要跨组件控制状态的心智成本。比如媒体库，里面包含了媒体的管理、上传、本地化等等，这些逻辑还是很复杂的，如果还是按照细拆思路，那么实现起来就烦得要死。因此，这类工具我都是只暴露为一个大的组件。</p>
<p>同时，为了方便开发者在某些情况下快捷接入，我会设计一些自己看到的不错的编辑器UI，然后用上诉的工具把它们搭出来，这样，开发者如果在产品需求中发现仓库里已经有功能一致的组件，就不需要自己去组合，直接使用对应组件即可。</p>
<p>以模仿剪映为例，开发者只需要接入<code>WebCutEditor</code>这个组件即可：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebCutEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'webcut'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'webcut/esm/style.css'</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">WebCutEditor</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>这样就可以得到一个界面接近于剪映的视频编辑器。</p>
<h2 data-id="heading-3">数据驱动，视频编辑的DSL</h2>
<p>经过我的研究，发现对于单纯的视频编辑而言，编辑器其实只需要两份数据，就可以解决大部分场景下的需求。一份是编辑的素材数据，一份是视频的配置数据。</p>
<h3 data-id="heading-4">素材数据</h3>
<p>它包含素材文件本身的信息、素材的组织信息、素材的属性信息。</p>
<p><strong>文件信息</strong></p>
<p>我通过opfs将文件存在本地，并且在indexedDB中存储每一个文件的关联信息。包含文件的类型、名称、大小等。在一个域名下，每一个文件的实体（也就是File对象）只需要一份，通过file-md5值作为索引存在opfs中。而一个文件可能会在多处被使用，indexedDB中则是记录这些信息，多个关联信息可同时链接到同一个File。另外，基于indexedDB的特性，还可以实现筛选等能力。</p>
<p><strong>素材组织信息</strong></p>
<p>主要是指当把素材放在视频时间轨道中时，所需要的数据结构。包含轨道列表、素材所对应的文件、素材对应时间点、播放时的一些属性等等信息。这些信息综合起来，我们就知道，在视频的某一个时刻，应该播放什么内容。</p>
<p><strong>素材属性信息</strong></p>
<p>在播放中，素材以什么方式呈现，如文本的样式、视频音频的播放速度、动画、转场等。</p>
<h3 data-id="heading-5">配置数据</h3>
<p>主要指视频本身的信息，在导出时这些配置可以直接体现出来，例如视频的分辨率、比例、速率等，视频是否要添加某些特殊的内容，例如水印等。</p>
<p>基于素材数据和配置数据，我们基本上可以完整的知道当前这个视频的编辑状态。通过数据来恢复当前的编辑状态，变得可行，这可以抵消用户在浏览器中经常执行“刷新”操作带来的状态丢失。同时，这份数据也可以备份到云端，实现多端的同步（不过需要同时同步File，速度肯定会受影响）。而且由于数据本身是纯序列化的，因此，可以交给AI来进行处理，例如让AI调整一些时间、样式等可基于纯序列化数据完成的功能。这就让我们的编辑器变得有更多的玩法。</p>
<h2 data-id="heading-6">发布上线🌏</h2>
<p>经过几天的工作，我终于把代码整理完整，经过调试之后，基本可用了，便迫不及待的准备与大家分享。现在，你可以使用这个项目了。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftangshuang%2Fwebcut" target="_blank" title="https://github.com/tangshuang/webcut" ref="nofollow noopener noreferrer">Github</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.webcut.top" target="_blank" title="https://docs.webcut.top" ref="nofollow noopener noreferrer">开发文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebcut.top" target="_blank" title="https://webcut.top" ref="nofollow noopener noreferrer">官方网站</a>（打开后点击“开始使用”按钮即可免费免登录在线体验）</li>
</ul>
<p>由于底层是由Vue3作为驱动的，因此，在Vue中使用有非常大的优势，具体如下：</p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> webcut
</code></pre>
<p>先安装，安装之后，你就可以在Vue中如下使用。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebCutEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'webcut'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'webcut/esm/style.css'</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">WebCutEditor</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>或者如果你的项目支持typescript，你可以直接从源码进行引入，这样就不必主动引入css:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebCutEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'webcut/src'</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>如果是非Vue的项目，则需要引用webcomponents的构建产物：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">'webcut/webcomponents'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'webcut/webcomponents/style.css'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Some</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">webcut-editor</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">webcut-editor</span>&gt;</span></span>;
}
</code></pre>
<p>如果是直接在HTML中使用，可以直接引入webcomponents/bundle，这样包含了Vue等依赖，就不需要另外构建。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/webcut/webcomponents/bundle/index.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://unpkg.com/webcut/webcomponents/bundle/style.css"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">webcut-editor</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">webcut-editor</span>&gt;</span>
</code></pre>
<p>如果是想自己布局，则需要引入各个很小的组件来自己布局。在这种情况下，你必须引入WebCutProvider组件，将所有的子组件包含在内。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">webcut-provider</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">webcut-player</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">webcut-player</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">webcut-export-button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">webcut-export-button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">webcut-provider</span>&gt;</span>
</code></pre>
<h2 data-id="heading-7">未来展望</h2>
<p>当前，WebCut还是处于很初级的阶段，实现了最核心的能力，我的目标是能够为开发者们提供一切需要的组件，并且不需要复杂的脚本处理就可以获得视频编辑的全部功能。还有很多功能没有实现，在计划中：</p>
<ul>
<li>历史记录功能，包含撤销和重做功能</li>
<li>内置样式的字体</li>
<li>花字，比内置样式更高级的文本</li>
<li>轨道里的素材吸附能力</li>
<li>视频的轨道分离（音频分离）</li>
<li>音视频的音量调节</li>
<li>单段素材的下载导出</li>
<li>整个视频导出时可以进行分辨率、码率、速率、编码、格式的选择，支持只导出音频</li>
</ul>
<p>以上这些都是编辑的基本功能。还有一些是从视频编辑定制化的角度思考的能力：</p>
<ul>
<li>动画（帧）支持</li>
<li>转场过渡效果支持</li>
<li>扩展功能模块，这部分可能会做成收费的，下载模块后，通过一个接口安装一下，就可以支持某些扩展功能</li>
<li>AI Agent能力，通过对话来执行视频编辑，降低视频编辑的门槛</li>
<li>视频模板，把一些流行的视频效果片段做成模板，在视频中直接插入后，与现有视频融合为模板中的效果</li>
<li>基于AI来进行短剧创作的能力</li>
</ul>
<p>要实现这些能力，需要大量的投入，虽然现在AI编程非常火热，但是真正能够完美实现的，其实还比较少，因此，这些工作都需要小伙伴们的支持，如果你对这个项目感兴趣，可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepwiki.org%2Ftangshuang%2Fwebcut" target="_blank" title="https://deepwiki.org/tangshuang/webcut" ref="nofollow noopener noreferrer">DeepWiki</a>来了解项目代码的底层结构，并<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftangshuang%2Fwebcut" target="_blank" title="https://github.com/tangshuang/webcut" ref="nofollow noopener noreferrer">fork项目</a>后，向我们提PR，让我们一起共建一个属于我们自己的视频编辑UI框架。</p>
<p>最后，你的支持是我前进的动力，动动你的小手，到我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftangshuang%2Fwebcut" target="_blank" title="https://github.com/tangshuang/webcut" ref="nofollow noopener noreferrer">github</a>上给个start，让我们知道你对此感兴趣。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain + LangGraph 实战：构建生产级多模态 WorkflowAgent 的完整指南]]></title>    <link>https://juejin.cn/post/7579832417748451379</link>    <guid>https://juejin.cn/post/7579832417748451379</guid>    <pubDate>2025-12-04T13:33:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579832417748451379" data-draft-id="7579832417748303923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain + LangGraph 实战：构建生产级多模态 WorkflowAgent 的完整指南"/> <meta itemprop="keywords" content="Python,Agent,人工智能"/> <meta itemprop="datePublished" content="2025-12-04T13:33:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="编程干货铺"/> <meta itemprop="url" content="https://juejin.cn/user/52383084474680"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain + LangGraph 实战：构建生产级多模态 WorkflowAgent 的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52383084474680/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    编程干货铺
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T13:33:04.000Z" title="Thu Dec 04 2025 13:33:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43c2959f94848118ece1011f15b283f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57yW56iL5bmy6LSn6ZO6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765460432&amp;x-signature=A%2F3XIGomhBCVDjWhMrtL4chMog0%3D" alt="image.png" loading="lazy"/>
在多模态 AI 应用开发中，开发者常面临三大核心痛点：<strong>工具调用顺序混乱</strong>、<strong>步骤结果无法传递</strong>、<strong>架构集成复杂</strong>。传统的基于大语言模型的 <code>BaseAgent</code> 因其随机决策的特性，难以保障复杂任务的可靠执行。本文将深入探讨如何结合 <code>LangChain</code>（能力组件库）与 <code>LangGraph</code>（流程操作系统），设计一个可闭环集成到现有架构的 <strong><code>WorkflowAgent</code></strong>，以解决上述痛点，并通过实战案例展示其从设计到落地的全过程。</p>
<h4 data-id="heading-0"><strong>一、框架核心定位：从“能力组件”到“流程操作系统”</strong></h4>
<p><code>LangChain</code> 与 <code>LangGraph</code> 形成了互补的解决方案：</p>
<ul>
<li><strong><code>LangChain</code></strong>：提供工具封装（文本/图像/文档/语音）、LLM适配、记忆组件，是**“能力组件库”**。</li>
<li><strong><code>LangGraph</code></strong>：通过状态图（StateGraph）实现多步骤流程控制、状态持久化、分支与循环，是**“流程操作系统”**。</li>
</ul>
<p>二者协同，从根本上解决了 <code>BaseAgent</code> 的天然缺陷：</p>

























<table><thead><tr><th align="left">对比维度</th><th align="left">BaseAgent (纯LLM驱动)</th><th align="left">WorkflowAgent (LangChain+LangGraph)</th></tr></thead><tbody><tr><td align="left"><strong>工具调用顺序</strong></td><td align="left">LLM随机决策，无法保证依赖（如“写诗配图”可能先调图）</td><td align="left">严格按“感知→规划→执行”定义顺序，支持步骤依赖</td></tr><tr><td align="left"><strong>状态管理</strong></td><td align="left">无共享状态，步骤结果无法传递（如诗无法给配图工具用）</td><td align="left">全局状态通道存储结果，节点间可直接读取</td></tr><tr><td align="left"><strong>架构集成</strong></td><td align="left">需手动对接工具与存储，无统一规范</td><td align="left">复用现有工具封装与数据库逻辑，形成完整闭环</td></tr></tbody></table>
<h4 data-id="heading-1"><strong>二、多模态 WorkflowAgent 实战案例</strong></h4>
<p><strong>案例1：文本生成 + 图像生成（写诗配图）</strong>
<strong>需求</strong>：用户输入“写一首关于春天的诗，然后为这首诗配一张图”，需确保顺序（先文后图）与结果传递。
<strong>架构范式</strong>：Perceive（意图识别）→ Plan（步骤拆分）→ Execute（工具调用）。</p>
<p><strong>1. 核心代码实现</strong></p>
<p><strong>(1) 类定义与状态初始化</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkflowAgent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span> = options.<span class="hljs-property">userId</span>; <span class="hljs-comment">// 对接现有用户体系</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> = options.<span class="hljs-property">sessionId</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">llm</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DoubaoLLM</span>({ <span class="hljs-attr">streaming</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// 复用LLM适配器</span>
    <span class="hljs-comment">// 全局状态通道：节点间共享数据</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = {
      <span class="hljs-attr">input</span>: <span class="hljs-literal">null</span>,        <span class="hljs-comment">// 用户原始输入</span>
      <span class="hljs-attr">perceived</span>: <span class="hljs-literal">null</span>,    <span class="hljs-comment">// 感知后的意图</span>
      <span class="hljs-attr">plan</span>: <span class="hljs-literal">null</span>,         <span class="hljs-comment">// 执行计划</span>
      <span class="hljs-attr">result</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// 最终结果</span>
      <span class="hljs-attr">tools</span>: [],          <span class="hljs-comment">// 已调用工具列表（日志）</span>
      <span class="hljs-attr">stepResults</span>: {}     <span class="hljs-comment">// 步骤结果（依赖传递）</span>
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createGraph</span>(); <span class="hljs-comment">// 初始化状态图</span>
  }
}
</code></pre>
<p><strong>(2) LangGraph 状态图创建（核心流程控制）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">createGraph</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> workflow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>({
    <span class="hljs-attr">channels</span>: {
      <span class="hljs-attr">input</span>: { <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> y || x },
      <span class="hljs-attr">perceived</span>: { <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> y || x },
      <span class="hljs-attr">plan</span>: { <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> y || x },
      <span class="hljs-attr">result</span>: { <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> y || x },
      <span class="hljs-attr">tools</span>: { <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> [...(x || []), ...(y || [])] },
      <span class="hljs-attr">stepResults</span>: { <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> ({ ...x, ...y }) }
    }
  });

  <span class="hljs-comment">// 添加核心节点</span>
  workflow.<span class="hljs-title function_">addNode</span>(<span class="hljs-string">'perceive'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">perceiveNode</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  workflow.<span class="hljs-title function_">addNode</span>(<span class="hljs-string">'plan'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">planNode</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  workflow.<span class="hljs-title function_">addNode</span>(<span class="hljs-string">'execute'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">executeNode</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));

  <span class="hljs-comment">// 定义线性流转路径</span>
  workflow.<span class="hljs-title function_">setEntryPoint</span>(<span class="hljs-string">'perceive'</span>);
  workflow.<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">'perceive'</span>, <span class="hljs-string">'plan'</span>);
  workflow.<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">'plan'</span>, <span class="hljs-string">'execute'</span>);
  workflow.<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">'execute'</span>, <span class="hljs-variable constant_">END</span>);

  <span class="hljs-keyword">return</span> workflow.<span class="hljs-title function_">compile</span>();
}
</code></pre>
<p><strong>(3) 三大核心节点实现</strong></p>
<ul>
<li><strong>感知节点 (Perceive)</strong>：解析意图与所需工具。
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">perceiveNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`分析用户输入，返回JSON格式意图：
  用户输入：<span class="hljs-subst">${state.input}</span>
  输出字段：intent、task_type、required_tools`</span>;
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">llm</span>.<span class="hljs-title function_">invoke</span>(prompt);
  <span class="hljs-keyword">const</span> perceived = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">content</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\{[\s\S]*\}/</span>)[<span class="hljs-number">0</span>]);
  <span class="hljs-keyword">return</span> { perceived }; <span class="hljs-comment">// 更新状态</span>
}
<span class="hljs-comment">// 结果示例: { intent: "创作诗歌并配图", task_type: "multi", required_tools: ["text_generator", "image_generator"] }</span>
</code></pre>
</li>
<li><strong>规划节点 (Plan)</strong>：拆分步骤与依赖。
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">planNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> { perceived } = state;
  <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`基于意图制定步骤计划（JSON数组）：
  意图：<span class="hljs-subst">${perceived.intent}</span>，工具：<span class="hljs-subst">${perceived.required_tools.join(<span class="hljs-string">','</span>)}</span>
  要求：标记depends_on，参数含use_previous_result`</span>;
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">llm</span>.<span class="hljs-title function_">invoke</span>(prompt);
  <span class="hljs-keyword">let</span> plan = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(response.<span class="hljs-property">content</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\[([\s\S]*)\]/</span>)[<span class="hljs-number">0</span>]);
  <span class="hljs-keyword">return</span> { plan };
}
<span class="hljs-comment">// 结果示例: [</span>
<span class="hljs-comment">//   { step: 1, action: "生成春天主题诗歌", tool: "text_generator", params: { topic: "春天" }, depends_on: null },</span>
<span class="hljs-comment">//   { step: 2, action: "基于诗歌生成配图", tool: "image_generator", params: { use_previous_result: true }, depends_on: 1 }</span>
<span class="hljs-comment">// ]</span>
</code></pre>
</li>
<li><strong>执行节点 (Execute)</strong>：调用工具与传递结果。
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">executeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> { plan } = state;
  <span class="hljs-keyword">const</span> results = []; <span class="hljs-keyword">const</span> toolsUsed = []; <span class="hljs-keyword">const</span> stepResults = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> step <span class="hljs-keyword">of</span> plan) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 处理步骤依赖</span>
      <span class="hljs-keyword">if</span> (step.<span class="hljs-property">depends_on</span>) step.<span class="hljs-property">params</span>.<span class="hljs-property">previous_result</span> = state.<span class="hljs-property">stepResults</span>[step.<span class="hljs-property">depends_on</span>];
      <span class="hljs-comment">// 调用工具（复用LangChain封装）</span>
      <span class="hljs-keyword">switch</span> (step.<span class="hljs-property">tool</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"text_generator"</span>:
          <span class="hljs-keyword">const</span> textTool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextGeneratorTool</span>();
          stepResult = <span class="hljs-keyword">await</span> textTool.<span class="hljs-title function_">_call</span>({ <span class="hljs-attr">prompt</span>: step.<span class="hljs-property">params</span>.<span class="hljs-property">topic</span>, <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span>, <span class="hljs-attr">sessionId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> });
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"image_generator"</span>:
          <span class="hljs-keyword">const</span> imageTool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageGeneratorTool</span>();
          stepResult = <span class="hljs-keyword">await</span> imageTool.<span class="hljs-title function_">_call</span>({ <span class="hljs-attr">prompt</span>: <span class="hljs-string">`基于文本生成图像：<span class="hljs-subst">${step.params.previous_result}</span>`</span>, <span class="hljs-attr">size</span>: <span class="hljs-string">"1024x1024"</span>, <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span>, <span class="hljs-attr">sessionId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> });
          <span class="hljs-keyword">break</span>;
      }
      stepResults[step.<span class="hljs-property">step</span>] = stepResult;
      results.<span class="hljs-title function_">push</span>(<span class="hljs-string">`步骤<span class="hljs-subst">${step.step}</span>：<span class="hljs-subst">${stepResult}</span>`</span>);
      toolsUsed.<span class="hljs-title function_">push</span>(step.<span class="hljs-property">tool</span>);
    } <span class="hljs-keyword">catch</span> (error) { results.<span class="hljs-title function_">push</span>(<span class="hljs-string">`步骤<span class="hljs-subst">${step.step}</span>失败：<span class="hljs-subst">${error.message}</span>`</span>); }
  }
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">result</span>: results.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>), <span class="hljs-attr">tools</span>: toolsUsed, stepResults };
}
</code></pre>
</li>
</ul>
<p><strong>2. 执行流程与结果</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">run</span>(<span class="hljs-string">"写一首关于春天的诗，然后为这首诗配一张图"</span>)
</code></pre>
<p><strong>状态流转</strong>：<code>初始状态 → 感知节点 → 规划节点 → 执行节点 → 结束</code>
<strong>最终结果</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"写一首关于春天的诗..."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"perceived"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"intent"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"创作诗歌并配图"</span><span class="hljs-punctuation">,</span> ... <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"plan"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>步骤<span class="hljs-number">1</span><span class="hljs-punctuation">,</span> 步骤<span class="hljs-number">2</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"步骤1：春风吹绿了大地...\n步骤2：图像URL: /uploads/xxx.jpg"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"text_generator"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"image_generator"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"stepResults"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"1"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"春风吹绿了大地..."</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"2"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/uploads/xxx.jpg"</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>案例2：文档解析 + 语音合成（文档转语音）</strong>
<strong>需求</strong>：用户上传PDF，先解析文本，再合成语音，需支持流式反馈。
<strong>架构适配</strong>：在原有框架上扩展工具 (<code>document_parser</code>, <code>audio_synthesizer</code>) 并实现流式接口。</p>
<p><strong>1. 核心代码适配</strong></p>
<ul>
<li><strong>感知节点扩展</strong>：识别文档与语音工具。</li>
<li><strong>执行节点扩展</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">switch</span> (step.<span class="hljs-property">tool</span>) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">"document_parser"</span>:
    <span class="hljs-keyword">const</span> docTool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentParserTool</span>();
    stepResult = <span class="hljs-keyword">await</span> docTool.<span class="hljs-title function_">_call</span>({ <span class="hljs-attr">fileUrl</span>: step.<span class="hljs-property">params</span>.<span class="hljs-property">fileUrl</span>, <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span>, <span class="hljs-attr">sessionId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> });
    <span class="hljs-keyword">break</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">"audio_synthesizer"</span>:
    <span class="hljs-keyword">const</span> audioTool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioSynthesizerTool</span>();
    stepResult = <span class="hljs-keyword">await</span> audioTool.<span class="hljs-title function_">_call</span>({ <span class="hljs-attr">text</span>: step.<span class="hljs-property">params</span>.<span class="hljs-property">previous_result</span>, <span class="hljs-attr">voiceType</span>: <span class="hljs-string">"female"</span>, <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span>, <span class="hljs-attr">sessionId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">sessionId</span> });
    <span class="hljs-keyword">break</span>;
}
</code></pre>
</li>
</ul>
<p><strong>2. 流式执行与前端反馈</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 后端流式接口</span>
<span class="hljs-keyword">async</span> *<span class="hljs-title function_">stream</span>(<span class="hljs-params">input</span>) {
  <span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>.<span class="hljs-title function_">stream</span>({ input });
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> stream) {
    <span class="hljs-keyword">yield</span> chunk; <span class="hljs-comment">// 逐节点返回状态</span>
  }
}
<span class="hljs-comment">// 前端调用 (SSE)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callDocToAudioAgent</span>(<span class="hljs-params">message, fileUrl</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/agent/workflow'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ message, fileUrl }) });
  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">const</span> chunk = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>().<span class="hljs-title function_">decode</span>(value));
    <span class="hljs-comment">// 实时更新UI: if (chunk.perceive) showProgress("已识别需求...");</span>
  }
}
</code></pre>
<h4 data-id="heading-2"><strong>三、与现有架构的完整闭环体系</strong></h4>
<p><strong>1. 工具封装闭环：复用 LangChain 工具层</strong>
所有工具基于现有<code>Tool</code>基类封装，调用规范统一。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageGeneratorTool</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Tool</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">_call</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-comment">// 对接现有图像服务</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateSeedreamImages</span>({
      <span class="hljs-attr">userId</span>: input.<span class="hljs-property">userId</span>,
      <span class="hljs-attr">sessionId</span>: input.<span class="hljs-property">sessionId</span>,
      <span class="hljs-attr">prompt</span>: input.<span class="hljs-property">prompt</span>
    });
  }
}
<span class="hljs-comment">// WorkflowAgent中无感知调用</span>
<span class="hljs-keyword">const</span> tool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageGeneratorTool</span>();
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> tool.<span class="hljs-title function_">_call</span>({...});
</code></pre>
<p><strong>闭环链路</strong>：<code>WorkflowAgent → LangChain 工具 → 现有服务层 → 数据库</code></p>
<p><strong>2. 控制器与路由集成（对接现有接口）</strong>
创建控制器，复用用户认证与日志存储。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// workflowAgentController.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">chat</span>: <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">const</span> { message, session_id } = req.<span class="hljs-property">body</span>;
    <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">user</span>.<span class="hljs-property">user_id</span>; <span class="hljs-comment">// 现有认证体系</span>
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/event-stream'</span> });

    <span class="hljs-keyword">const</span> agent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WorkflowAgent</span>({ userId, <span class="hljs-attr">sessionId</span>: session_id });
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> agent.<span class="hljs-title function_">stream</span>({ message })) {
      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(chunk)}</span>\n\n`</span>); <span class="hljs-comment">// 流式推送</span>
    }
    <span class="hljs-comment">// 复用现有日志存储</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveChatRecord</span>({ <span class="hljs-attr">user_id</span>: userId, session_id, <span class="hljs-attr">request_text</span>: message, <span class="hljs-attr">model</span>: <span class="hljs-string">'workflow-agent'</span> });
    res.<span class="hljs-title function_">end</span>();
  }
};
<span class="hljs-comment">// 集成到现有路由</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/workflow'</span>, workflowAgentController.<span class="hljs-property">chat</span>);
</code></pre>
<p><strong>3. 与 BaseAgent 的场景分工</strong></p>





























<table><thead><tr><th align="left">任务类型</th><th align="left">推荐 Agent</th><th align="left">工具调用数</th><th align="left">流程控制需求</th></tr></thead><tbody><tr><td align="left">单模态简单任务（如“生成日落图”）</td><td align="left">BaseAgent</td><td align="left">1</td><td align="left">无需顺序控制</td></tr><tr><td align="left">多模态多步骤任务（如写诗配图）</td><td align="left">WorkflowAgent</td><td align="left">≥2</td><td align="left">需步骤依赖与顺序控制</td></tr><tr><td align="left">企业级合规任务（如带审核的内容生成）</td><td align="left">WorkflowAgent（加审核节点）</td><td align="left">≥2</td><td align="left">需分支与人工干预</td></tr></tbody></table>
<h4 data-id="heading-3"><strong>四、生产级扩展与最佳实践</strong></h4>
<p><strong>4.1 错误处理增强：生产级可靠性保障</strong>
通过 <strong>重试策略、错误降级、日志上报</strong> 三重机制，将任务成功率提升至95%以上。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">executeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> step <span class="hljs-keyword">of</span> plan) {
    <span class="hljs-keyword">let</span> retryCount = <span class="hljs-number">0</span>, maxRetry = <span class="hljs-number">3</span>, stepSuccess = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">while</span> (retryCount &lt; maxRetry &amp;&amp; !stepSuccess) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. 依赖校验</span>
        <span class="hljs-keyword">if</span> (step.<span class="hljs-property">depends_on</span> &amp;&amp; !stepResults[step.<span class="hljs-property">depends_on</span>]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`依赖步骤未成功`</span>);
        <span class="hljs-comment">// 2. 参数校验</span>
        <span class="hljs-keyword">if</span> (step.<span class="hljs-property">tool</span> === <span class="hljs-string">"image_generator"</span> &amp;&amp; !step.<span class="hljs-property">params</span>.<span class="hljs-property">previous_result</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"参数不完整"</span>);
        <span class="hljs-comment">// 3. 工具调用（带超时）</span>
        stepResult = <span class="hljs-keyword">await</span> tool.<span class="hljs-title function_">_call</span>({ ..., <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span> });
        stepSuccess = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 成功</span>
      } <span class="hljs-keyword">catch</span> (error) {
        retryCount++;
        <span class="hljs-comment">// 4. 指数退避重试</span>
        <span class="hljs-keyword">if</span> (retryCount &lt; maxRetry) <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span> * retryCount));
      }
    }
    <span class="hljs-comment">// 5. 多次重试失败：执行降级</span>
    <span class="hljs-keyword">if</span> (!stepSuccess) {
      <span class="hljs-keyword">if</span> (step.<span class="hljs-property">tool</span> === <span class="hljs-string">"text_generator"</span>) stepResult = <span class="hljs-string">"默认春天主题诗歌..."</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (step.<span class="hljs-property">tool</span> === <span class="hljs-string">"image_generator"</span>) stepResult = <span class="hljs-string">"/static/fallback/spring.jpg"</span>;
    }
    <span class="hljs-comment">// 6. 错误日志上报（对接ELK等监控）</span>
    <span class="hljs-keyword">if</span> (errorLogs.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">await</span> <span class="hljs-title function_">reportErrorLogs</span>({ <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">userId</span>, <span class="hljs-attr">logs</span>: errorLogs });
  }
}
</code></pre>
<p><strong>4.2 支持条件分支与循环（企业级合规需求）</strong>
应对“人工审核”、“多轮优化”等动态流程，以“写诗配图+人工审核”为例。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">createGraph</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// ... 原有节点 ...</span>
  workflow.<span class="hljs-title function_">addNode</span>(<span class="hljs-string">'review'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">reviewNode</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)); <span class="hljs-comment">// 新增审核节点</span>
  workflow.<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">'execute'</span>, <span class="hljs-string">'review'</span>);
  <span class="hljs-comment">// 条件边：根据审核结果决定后续流程</span>
  workflow.<span class="hljs-title function_">addConditionalEdges</span>(
    <span class="hljs-string">'review'</span>,
    <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> status = state.<span class="hljs-property">reviewStatus</span>;
      <span class="hljs-keyword">if</span> (status === <span class="hljs-string">"approved"</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status === <span class="hljs-string">"rejected"</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"replan"</span>; <span class="hljs-comment">// 驳回则重新规划</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">"review"</span>; <span class="hljs-comment">// 待审核则循环等待</span>
    },
    { <span class="hljs-string">'end'</span>: <span class="hljs-variable constant_">END</span>, <span class="hljs-string">'replan'</span>: <span class="hljs-string">'plan'</span>, <span class="hljs-string">'review'</span>: <span class="hljs-string">'review'</span> }
  );
}
<span class="hljs-comment">// 审核驳回后，规划节点融入审核意见重新生成计划</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">planNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> { perceived, reviewStatus, reviewComment } = state;
  <span class="hljs-keyword">const</span> reviewInfo = reviewStatus === <span class="hljs-string">"rejected"</span> ? <span class="hljs-string">`（审核驳回原因：<span class="hljs-subst">${reviewComment}</span>）`</span> : <span class="hljs-string">""</span>;
  <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`基于意图制定步骤计划...意图：<span class="hljs-subst">${perceived.intent}</span> <span class="hljs-subst">${reviewInfo}</span>`</span>;
  <span class="hljs-comment">// ... 生成新计划</span>
}
</code></pre>
<p><strong>4.3 性能优化：高并发场景下的效率提升</strong>
从 <strong>并行执行、状态缓存、资源复用</strong> 三方面优化。</p>
<ul>
<li><strong>无依赖步骤并行</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">executeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> independentSteps = plan.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> step.<span class="hljs-property">depends_on</span> === <span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> dependentSteps = plan.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> step.<span class="hljs-property">depends_on</span> !== <span class="hljs-literal">null</span>);
  <span class="hljs-comment">// 并行执行无依赖步骤</span>
  <span class="hljs-keyword">if</span> (independentSteps.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> parallelPromises = independentSteps.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">step</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeSingleStep</span>(step, ...));
    <span class="hljs-keyword">const</span> parallelResults = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(parallelPromises);
    <span class="hljs-comment">// ...处理结果</span>
  }
  <span class="hljs-comment">// 串行执行依赖步骤</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> step <span class="hljs-keyword">of</span> dependentSteps.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a.<span class="hljs-property">step</span> - b.<span class="hljs-property">step</span>)) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeSingleStep</span>(step, ...);
  }
}
</code></pre>
</li>
<li><strong>重复任务状态缓存</strong>：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">executeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-string">`user:<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.userId}</span>:task:<span class="hljs-subst">${md5(input)}</span>`</span>;
  <span class="hljs-keyword">const</span> cachedResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">get</span>(cacheKey); <span class="hljs-comment">// Redis缓存</span>
  <span class="hljs-keyword">if</span> (cachedResult) <span class="hljs-keyword">return</span> { ...parsedCache, <span class="hljs-attr">fromCache</span>: <span class="hljs-literal">true</span> }; <span class="hljs-comment">// 命中缓存</span>
  <span class="hljs-comment">// ... 执行任务</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cache</span>.<span class="hljs-title function_">set</span>(cacheKey, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result), <span class="hljs-string">"EX"</span>, <span class="hljs-number">3600</span>); <span class="hljs-comment">// 写入缓存</span>
  <span class="hljs-keyword">return</span> { ...result, <span class="hljs-attr">fromCache</span>: <span class="hljs-literal">false</span> };
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-4"><strong>五、学习路径：从入门到实战</strong></h4>
<ol>
<li><strong>入门阶段</strong>：掌握核心组件。
<ul>
<li><strong>环境搭建</strong>：安装 <code>langchain</code>, <code>langgraph</code>, <code>redis</code>，配置LLM。</li>
<li><strong>基础练习</strong>：用LangChain封装一个自定义工具；用LangGraph实现“单步骤文本生成”流程。</li>
</ul>
</li>
<li><strong>进阶阶段</strong>：攻克复杂流程。
<ul>
<li><strong>核心能力</strong>：实现“错误重试+降级”；开发“条件分支+循环”（以文档转语音为案例）。</li>
<li><strong>流式处理</strong>：基于 <code>agent.stream()</code> 实现前端实时进度展示，调试SSE连接。</li>
</ul>
</li>
<li><strong>实战阶段</strong>：构建完整系统。
<ul>
<li><strong>综合项目</strong>：开发“智能内容生产系统”：文档→解析→摘要→配图→合成语音。</li>
<li><strong>架构闭环</strong>：复用现有用户、日志、工具服务；进行压测优化，通过缓存和并行降低响应时间。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-5"><strong>六、总结：核心价值与落地建议</strong></h4>
<ul>
<li><strong>框架协同价值</strong>：
<ul>
<li><code>LangChain</code> 解决 <strong>“工具复用”</strong> 和 <strong>“能力扩展”</strong>。</li>
<li><code>LangGraph</code> 解决 <strong>“流程控制”</strong> 和 <strong>“状态管理”</strong>。</li>
<li>二者结合实现从“工具调用”到“智能系统”的跨越。</li>
</ul>
</li>
<li><strong>架构闭环关键</strong>：
<ul>
<li><strong>组件复用</strong>：所有工具基于现有基类封装。</li>
<li><strong>状态透明</strong>：全局状态通道便于排查与数据分析。</li>
<li><strong>场景适配</strong>：明确 <code>BaseAgent</code> 与 <code>WorkflowAgent</code> 分工，避免过度设计。</li>
</ul>
</li>
<li><strong>落地注意事项</strong>：
<ul>
<li><strong>错误处理分级</strong>：关键步骤中断，非关键步骤降级。</li>
<li><strong>性能优先</strong>：大文件任务拆分并行，高频任务加缓存。</li>
<li><strong>可观测性</strong>：记录工具耗时与错误率，利用LangSmith等工具优化流程。</li>
</ul>
</li>
</ul>
<p>通过本文的案例与设计，开发者可将多模态AI应用从“Demo级”可靠地升级为“生产级”，有效解决流程失控的痛点。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[java深度调试技术【第六七八章：宽字节与多字节】]]></title>    <link>https://juejin.cn/post/7579871631095873562</link>    <guid>https://juejin.cn/post/7579871631095873562</guid>    <pubDate>2025-12-04T14:36:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579871631095873562" data-draft-id="7578922565210783771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="java深度调试技术【第六七八章：宽字节与多字节】"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-04T14:36:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="提前退休的java猿"/> <meta itemprop="url" content="https://juejin.cn/user/465848660928872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            java深度调试技术【第六七八章：宽字节与多字节】
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848660928872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    提前退休的java猿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T14:36:49.000Z" title="Thu Dec 04 2025 14:36:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>我是[<a href="https://juejin.cn/user/465848660928872" title="https://juejin.cn/user/465848660928872" target="_blank">提前退休的java猿</a>]，一名7年java开发经验的开发组长，分享工作中的各种问题！（抖音、公众号同号）<br/>
🔈PS: 最近多了一个新的写作方向，就是会把出版社寄来的【java深度调试技术】按照书的骨架提取其中干货进行丰盈写成博客，大家可以关注我的新专栏</p>
</blockquote>
<p>java 深度调试技术第六七八章分别的主题是 【常见的java陷阱】、【关于数据库】、【字符集与编码】这几章书中的内容比较少，而且有些JDK的介绍几乎在实际开发中（web）遇不到的，比如常见的java陷阱中介绍了<code>java.swing.Timer</code>. 下面就简单概括一下书中内容以及本人的一些扩展吧。</p>
<h2 data-id="heading-1">java深度调试技术 六七八章</h2>
<h3 data-id="heading-2">常见的java陷阱</h3>
<p>书中写的内容比较少，写了<code>java.lang.Runtime</code>、<code>java.util.Timer</code>、<code>java.swing.Timer</code>这几个类在开发当中几乎都不会用到。Runtime 这个API 比较底层的一个API，开发当中最多也是用来获取个CPU核数，TImer 定时器也几乎不会直接用到。</p>
<p>所以这章节对开发来说几乎都没啥用👹可能很多年前会用吧！</p>
<p>对于java陷阱，可以看看我写的【<a href="https://juejin.cn/post/7568859869693837348#heading-3" target="_blank" title="https://juejin.cn/post/7568859869693837348#heading-3">幽灵代码</a>】这篇文文章，目录如下：</p>
<ul>
<li>数据库的时间精度问题</li>
<li>异常的处理</li>
<li>事务问题</li>
<li>数据库操作</li>
<li>线程上下文变量在线程池中传递</li>
<li>缓存问题</li>
</ul>
<h3 data-id="heading-3">数据库死锁</h3>
<p>这一章节写的东西也是非常的少，不如网上的八股文吧！介绍了死锁的基本形成条件，以及如何去避免死锁，如何去查询数据锁的情况。 说实话还还是看我这篇文章吧【<a href="https://juejin.cn/post/7572039006529601572" target="_blank" title="https://juejin.cn/post/7572039006529601572">为什么很少遇到数据库死锁</a>】，目录如下：</p>
<ul>
<li>MySQL数据库的死锁检测机制 和关键配置</li>
<li>如何解决死锁问题，是看日志还是查询事务阻塞信息</li>
<li>死锁的预防</li>
<li>MySQL什么场景下数据库会回滚部分SQL</li>
</ul>
<h3 data-id="heading-4">字符集与编码集</h3>
<p>这一章节就是讲了一些基础的概念，比如 字符集是字符的集合，编码指的是字符在计算机中是如何存放的是采用单字节还是多字节。Unicode是字符集名称定义了每个字符的编号，Utf-8 则是Unicode 字符集对应的计算机存储格式。</p>
<p>还讲了一编码的转换，算是我之前也没听过的 多字节和宽字节，大概就是写入磁盘转换成多字节（如UTF8 一个字符可能是一个字节或者两个字节表示），读入内存转成宽字节。
今天就主要介绍一下这个知识点吧</p>
<h2 data-id="heading-5">扩展阅读：宽字节与多字节</h2>
<p>要理解宽字节、多字节，以及文本读写时的编码转换，需先明确<strong>字符编码</strong>的核心逻辑：计算机仅能存储二进制（0/1），“字符” 需通过编码规则映射为二进制，而 “宽字节”“多字节” 是两种不同的字符编码设计思路；文本在 “磁盘 ↔ 内存” 的流转过程中，必然涉及编码 / 解码转换，这也是乱码问题的核心根源。</p>
<h4 data-id="heading-6">一. 多字节编码（Multi-Byte Encoding）</h4>
<h5 data-id="heading-7">定义</h5>
<p>用<strong>1~n 个字节</strong>表示一个字符的编码方式，不同字符占用的字节数不同：</p>
<ul>
<li>单字节字符：如 ASCII 字符（0-127），仅占 1 字节；</li>
<li>多字节字符：如中文、日文等，占 2~4 字节（如 GBK 中汉字占 2 字节，UTF-8 中汉字占 3 字节）。</li>
</ul>
<h5 data-id="heading-8">典型代表</h5>
<ul>
<li>UTF-8（最常用）：兼容 ASCII，全球通用的多字节编码；</li>
<li>GBK/GB2312：中文专用多字节编码，仅支持中日韩字符；</li>
<li>Shift_JIS：日文专用多字节编码。</li>
</ul>
<h5 data-id="heading-9">核心特点</h5>
<ul>
<li>字节数不固定：字符占用 1~4 字节，节省存储空间（ASCII 字符仅 1 字节）；</li>
<li>有 “变长” 解析规则：需按编码规则逐字节解析（如 UTF-8 靠字节高位标识后续是否有续字节）；</li>
<li>无字节序问题：单字节 / 多字节按顺序存储，无需区分大端 / 小端。</li>
</ul>
<h4 data-id="heading-10">二. 宽字节编码（Wide Character Encoding）</h4>
<h5 data-id="heading-11">定义</h5>
<p>用<strong>固定字节数</strong>表示一个字符的编码方式，无论字符类型（ASCII / 中文 / 特殊符号），均占用相同字节数（通常是 2 或 4 字节）。</p>
<h5 data-id="heading-12">典型代表</h5>
<ul>
<li>UTF-16：固定 2 字节（BMP 字符，如常用汉字）或 4 字节（增补字符），本质是 “准固定长度”，Java 内存中字符（<code>char</code> 类型）就是 UTF-16 编码的宽字节；</li>
<li>UTF-32：固定 4 字节，每个字符均占 4 字节，完全固定长度；</li>
<li>UCS-2：UTF-16 的子集，仅支持 BMP 字符，固定 2 字节（已被 UTF-16 取代）。</li>
</ul>
<h5 data-id="heading-13">核心特点</h5>
<ul>
<li>字节数固定：解析效率高（无需逐字节判断），但存储空间利用率低（ASCII 字符也占 2/4 字节）；</li>
<li>有字节序问题：多字节存储时需区分大端（BE）/ 小端（LE），如 UTF-16BE、UTF-16LE；</li>
<li>直接映射 Unicode 码点：每个宽字节直接对应一个 Unicode 码点（如 U+4E2D 对应 “中”）。</li>
</ul>
<h3 data-id="heading-14">三、文本读写的核心：磁盘 ↔ 内存的编码转换</h3>
<p><strong>结论：系统 / 程序读取文本到内存、从内存写入磁盘时，必然发生编码 / 解码转换</strong>—— 因为磁盘存储的是 “字节流”（多字节编码，如 UTF-8），而内存中处理的是 “字符”（通常是宽字节编码，如 UTF-16），两者的转换是文本操作的核心步骤。</p>
<h4 data-id="heading-15">1. 完整转换流程（以 Java 为例）</h4>
<pre><code class="hljs language-plaintext" lang="plaintext">磁盘文件（UTF-8 字节流） 
    ↓ 解码（Decode）：字节 → 字符（宽字节）
内存（Java char/字符串，UTF-16 宽字节）
    ↓ 编码（Encode）：字符 → 字节（多字节）
磁盘文件（UTF-8 字节流）
</code></pre>
<h5 data-id="heading-16">步骤拆解</h5>
<h6 data-id="heading-17">（1）读取文本到内存（解码：字节 → 字符）</h6>
<ul>
<li>磁盘上的文本文件是<strong>字节序列</strong>，按指定多字节编码（如 UTF-8）存储；</li>
<li>程序读取时，需指定 “解码规则”（如 UTF-8），将可变长度的字节序列转换为内存中固定长度的宽字节字符（如 Java 的 UTF-16 <code>char</code>）；</li>
<li>若解码规则与文件实际编码不一致，会出现乱码（如用 GBK 解析 UTF-8 文件）。</li>
</ul>
<h6 data-id="heading-18">（2）写入文本到磁盘（编码：字符 → 字节）</h6>
<ul>
<li>内存中的字符是宽字节编码（如 UTF-16），无法直接存储（存储效率低）；</li>
<li>程序写入时，需指定 “编码规则”（如 UTF-8），将宽字节字符转换为可变长度的多字节序列；</li>
<li>若编码规则与读取时的解码规则不一致，也会出现乱码（如内存字符编码为 UTF-16，写入时用 GBK 编码）。</li>
</ul>
<h4 data-id="heading-19">2. 实操示例：Java 中的编码转换（避免乱码关键）</h4>
<h5 data-id="heading-20">反例：未指定编码（依赖系统默认编码，易乱码）</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.FileReader;
<span class="hljs-keyword">import</span> java.io.FileWriter;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BadEncodingDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 读取：FileReader 用系统默认编码（如 Windows 是 GBK，Linux 是 UTF-8）解码</span>
        <span class="hljs-type">FileReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(<span class="hljs-string">"test.txt"</span>); <span class="hljs-comment">// 若文件是 UTF-8，Windows 下会乱码</span>
        <span class="hljs-comment">// 写入：FileWriter 用系统默认编码编码，跨平台必乱码</span>
        <span class="hljs-type">FileWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(<span class="hljs-string">"output.txt"</span>);
    }
}
</code></pre>
<h5 data-id="heading-21">正例：显式指定编码（统一用 UTF-8）</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.FileInputStream;
<span class="hljs-keyword">import</span> java.io.FileOutputStream;
<span class="hljs-keyword">import</span> java.io.InputStreamReader;
<span class="hljs-keyword">import</span> java.io.OutputStreamWriter;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodEncodingDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 读取：字节流 + 显式指定 UTF-8 解码（字节→字符）</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"test.txt"</span>), StandardCharsets.UTF_8)) {
            <span class="hljs-type">char</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">1024</span>];
            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> reader.read(buffer); <span class="hljs-comment">// 解码：UTF-8 字节 → UTF-16 字符</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(buffer, <span class="hljs-number">0</span>, len);
            System.out.println(<span class="hljs-string">"内存中的字符（UTF-16）："</span> + content);
        }

        <span class="hljs-comment">// 写入：字符流 + 显式指定 UTF-8 编码（字符→字节）</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStreamWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">"output.txt"</span>), StandardCharsets.UTF_8)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-string">"你好，UTF-8！"</span>;
            writer.write(content); <span class="hljs-comment">// 编码：UTF-16 字符 → UTF-8 字节</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-22">3. 关键细节：不同系统 / 语言的内存编码差异</h4>
<ul>
<li><strong>Java</strong>：内存中字符串（<code>String</code>）和字符（<code>char</code>）均为 UTF-16 宽字节编码，无论输入输出，都需在 “字节↔字符” 转换时指定编码；</li>
<li><strong>C/C++（Windows）</strong> ：<code>wchar_t</code> 是宽字节（UTF-16，2 字节），<code>char</code> 是多字节（系统默认编码，如 GBK/UTF-8）；</li>
<li><strong>C/C++（Linux）</strong> ：<code>wchar_t</code> 是 UTF-32（4 字节），<code>char</code> 是多字节（通常 UTF-8）；</li>
<li><strong>Python</strong>：内存中字符串是 Unicode 码点（逻辑上的宽字节），写入时需编码为 UTF-8/GBK 等多字节。</li>
</ul>
<h4 data-id="heading-23">4. 无转换的特殊场景（极少）</h4>
<p>只有当内存编码与磁盘编码完全一致，且程序直接按 “字节流” 读写时，才无编码转换：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 字节流读写：仅复制字节，不做编码转换（适合非文本文件，如图片/二进制）</span>
<span class="hljs-keyword">import</span> java.io.FileInputStream;
<span class="hljs-keyword">import</span> java.io.FileOutputStream;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ByteStreamDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 读取：直接读字节，无解码（内存中是字节数组，不是字符）</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"test.txt"</span>)) {
            <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];
            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> fis.read(buffer);
            <span class="hljs-comment">// 写入：直接写字节，无编码</span>
            <span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">"output.txt"</span>)) {
                fos.write(buffer, <span class="hljs-number">0</span>, len);
            }
        }
    }
}
</code></pre>
<p>⚠️ 注意：该方式仅适用于 “复制文件”，若尝试将字节数组转换为字符串（如 <code>new String(buffer)</code>），仍会触发编码转换（用系统默认编码），极易乱码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多线程开发最佳实践：从安全到高效的进阶指南]]></title>    <link>https://juejin.cn/post/7579798332777103369</link>    <guid>https://juejin.cn/post/7579798332777103369</guid>    <pubDate>2025-12-04T07:38:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579798332777103369" data-draft-id="7579628944036478985" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多线程开发最佳实践：从安全到高效的进阶指南"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-12-04T07:38:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多线程开发最佳实践：从安全到高效的进阶指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T07:38:33.000Z" title="Thu Dec 04 2025 07:38:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">多线程开发最佳实践：从安全到高效的进阶指南</h2>
<p>在多核 CPU 普及的今天，多线程早已不是高级开发的 “选修课”—— 它是提升程序吞吐量、优化资源利用率的核心手段。但多线程带来的并发安全、死锁、性能损耗等问题，却让很多开发者 “谈线程色变”：明明逻辑没问题，一跑多线程就出现数据错乱；好不容易解决了安全问题，程序又变得比单线程还慢。</p>
<p>今天，我们就梳理一套<strong>多线程使用的最佳实践</strong>，从线程创建到通信、从同步控制到问题排查，帮你写出既安全又高效的并发代码。</p>
<h3 data-id="heading-1">一、核心原则：拒绝 “野蛮编码”，用工具化思维管理线程</h3>
<p>多线程的核心痛点，本质是 “无序性” 和 “共享资源竞争”。最佳实践的第一步，就是用标准化工具替代 “随手写线程” 的野蛮方式，从根源减少混乱。</p>
<h4 data-id="heading-2">1. 绝对不要 “随手新建线程”，优先用线程池</h4>
<h5 data-id="heading-3">问题所在</h5>
<p>每次用 new Thread() 创建线程，会带来两大问题：</p>
<ul>
<li><strong>资源开销大</strong>：线程创建需要分配栈空间（默认 1MB）、内核态与用户态切换，频繁创建销毁会严重消耗 CPU 和内存；</li>
</ul>

<ul>
<li><strong>无法管控</strong>：无限制创建线程可能导致线程爆炸（比如并发请求下创建上千个线程），直接触发 OOM 或系统卡顿。</li>
</ul>
<h5 data-id="heading-4">最佳实践：用 ThreadPoolExecutor 手动创建线程池</h5>
<p>避免使用 Executors 提供的默认方法（如 FixedThreadPool 可能因任务堆积导致 OOM），手动指定线程池参数，按需管控线程生命周期。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 核心参数：核心线程数、最大线程数、空闲线程存活时间、队列、拒绝策略</span>
ThreadPoolExecutor threadPool = new <span class="hljs-built_in">ThreadPoolExecutor</span>(
    <span class="hljs-number">2</span>, // 核心线程数（CPU密集型设为 CPU核数，IO密集型设为 <span class="hljs-number">2</span>*CPU核数）
    <span class="hljs-number">4</span>, // 最大线程数（控制并发上限）
    <span class="hljs-number">60</span>L, // 空闲线程存活时间
    TimeUnit.SECONDS,
    new ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">10</span>), <span class="hljs-comment">// 有界队列（避免无界队列OOM）</span>
    new ThreadPoolExecutor<span class="hljs-selector-class">.AbortPolicy</span>() <span class="hljs-comment">// 拒绝策略（任务满时直接抛异常，便于感知问题）</span>
);
<span class="hljs-comment">// 提交任务</span>
threadPool<span class="hljs-selector-class">.submit</span>(() -&gt; {
    try {
        <span class="hljs-comment">// 业务逻辑：如IO请求、数据处理</span>
        Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">100</span>);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("任务执行完成");
    } catch (InterruptedException e) {
        Thread<span class="hljs-selector-class">.currentThread</span>()<span class="hljs-selector-class">.interrupt</span>(); <span class="hljs-comment">// 恢复中断状态，避免中断信号丢失</span>
    }
});
<span class="hljs-comment">// 程序结束前关闭线程池（优雅关闭：先拒绝新任务，再等待已提交任务完成）</span>
threadPool<span class="hljs-selector-class">.shutdown</span>();
if (!threadPool.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) {
    threadPool<span class="hljs-selector-class">.shutdownNow</span>(); <span class="hljs-comment">// 超时未完成则强制关闭</span>
}
</code></pre>
<p><strong>关键配置建议</strong>：</p>
<ul>
<li>CPU 密集型任务（如计算）：核心线程数 = CPU 核数 + 1（减少线程切换开销）；</li>
</ul>

<ul>
<li>IO 密集型任务（如 DB 查询、HTTP 请求）：核心线程数 = 2 * CPU 核数（利用 IO 等待时间并行处理）；</li>
</ul>

<ul>
<li>必须用<strong>有界队列</strong>（如 ArrayBlockingQueue），避免无界队列（LinkedBlockingQueue 默认无界）导致任务堆积 OOM。</li>
</ul>
<h4 data-id="heading-5">2. 线程安全：选对同步机制，拒绝 “过度加锁”</h4>
<p>线程安全的核心是 “控制共享资源的访问顺序”，但错误的同步方式会导致性能暴跌或死锁。</p>
<h5 data-id="heading-6">（1）简单场景用 synchronized，复杂场景用 Lock</h5>
<ul>
<li>synchronized：隐式锁，自动加锁 / 释放，适合简单同步（如单方法、代码块），JVM 会优化（如偏向锁、轻量级锁）；</li>
</ul>

<ul>
<li>Lock：显式锁，支持中断、超时、公平锁，适合复杂场景（如多条件等待、锁超时）。</li>
</ul>
<p><strong>反例（过度加锁）</strong> ：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 错误：锁整个方法，即使只有一行共享资源操作</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">void</span> <span class="hljs-title">updateData</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 非共享资源操作：如日志打印、局部变量处理（无需加锁）</span>
    log.<span class="hljs-built_in">info</span>(<span class="hljs-string">"开始更新数据"</span>);
    <span class="hljs-comment">// 共享资源操作：仅这一行需要同步</span>
    sharedCount++;
}
</code></pre>
<p><strong>正例（缩小锁粒度）</strong> ：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> final Object <span class="hljs-keyword">lock</span> = <span class="hljs-keyword">new</span> Object(); <span class="hljs-comment">// 独立锁对象，避免锁this或Class对象</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateData</span>()</span> {
    log.info(<span class="hljs-string">"开始更新数据"</span>); <span class="hljs-comment">// 无锁操作</span>
    <span class="hljs-comment">// 仅对共享资源操作加锁，缩小锁范围</span>
    synchronized (<span class="hljs-keyword">lock</span>) {
        sharedCount++;
    }
}
</code></pre>
<p><strong>Lock 示例（支持超时）</strong> ：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> final Lock <span class="hljs-keyword">lock</span> = <span class="hljs-keyword">new</span> ReentrantLock();
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryUpdate</span>() throws InterruptedException</span> {
    <span class="hljs-comment">// 尝试加锁，5秒超时则放弃（避免死锁）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-number">5</span>, TimeUnit.SECONDS)) {
        <span class="hljs-keyword">try</span> {
            sharedCount++;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">lock</span>.unlock(); <span class="hljs-comment">// 必须在finally中释放锁，避免异常导致锁泄漏</span>
        }
    } <span class="hljs-keyword">else</span> {
        log.warn(<span class="hljs-string">"加锁超时，放弃更新"</span>);
    }
}
</code></pre>
<h5 data-id="heading-7">（2）拒绝 “死锁”：从根源切断死锁 4 个条件</h5>
<p>死锁的本质是满足 4 个条件：互斥、持有并等待、不可剥夺、循环等待。只要破坏其中一个，就能避免死锁。</p>
<p><strong>常见死锁场景</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 线程1：先锁A，再锁B</span>
<span class="hljs-keyword">synchronized</span> (lockA) {
    <span class="hljs-keyword">synchronized</span> (lockB) {
        <span class="hljs-comment">// 操作</span>
    }
}
<span class="hljs-comment">// 线程2：先锁B，再锁A</span>
<span class="hljs-keyword">synchronized</span> (lockB) {
    <span class="hljs-keyword">synchronized</span> (lockA) {
        <span class="hljs-comment">// 操作</span>
    }
}
</code></pre>
<p><strong>避免死锁的 3 个实用方法</strong>：</p>
<ol>
<li><strong>按固定顺序加锁</strong>：所有线程都按 “lockA → lockB” 的顺序加锁，破坏 “循环等待”；</li>
</ol>

<ol start="2">
<li><strong>定时释放锁</strong>：用 Lock.tryLock(timeout)，超时自动放弃，破坏 “持有并等待”；</li>
</ol>

<ol start="3">
<li><strong>使用并发工具类</strong>：用 CountDownLatch、CyclicBarrier 替代手动嵌套锁。</li>
</ol>
<h3 data-id="heading-8">二、线程通信：用 “安全工具” 替代 “原生操作”</h3>
<p>线程间通信（如通知、数据传递）是多线程的高频场景，原生的 wait()/notify() 容易出错，推荐用更安全的工具类。</p>
<h4 data-id="heading-9">1. 生产者 - 消费者模式：用 BlockingQueue 替代 wait()/notify()</h4>
<p>BlockingQueue 是线程安全的队列，自带 “阻塞等待” 功能（队列空时消费者阻塞，队列满时生产者阻塞），无需手动处理 wait()/notify() 的细节。</p>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 创建有界阻塞队列</span>
<span class="hljs-keyword">private</span> final <span class="hljs-title class_">BlockingQueue</span>&lt;<span class="hljs-title class_">String</span>&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>);
<span class="hljs-comment">// 2. 生产者线程：向队列存数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">String</span> data = <span class="hljs-string">"数据-"</span> + <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>();
            queue.<span class="hljs-title function_">put</span>(data); <span class="hljs-comment">// 队列满时自动阻塞</span>
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"生产者存入："</span> + data);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
        }
    }
}
<span class="hljs-comment">// 3. 消费者线程：从队列取数据</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">String</span> data = queue.<span class="hljs-title function_">take</span>(); <span class="hljs-comment">// 队列空时自动阻塞</span>
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"消费者取出："</span> + data);
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) {
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>();
        }
    }
}
<span class="hljs-comment">// 4. 启动线程</span>
threadPool.<span class="hljs-title function_">submit</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Producer</span>());
threadPool.<span class="hljs-title function_">submit</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>());
</code></pre>
<h4 data-id="heading-10">2. 线程间通知：用 CountDownLatch/CyclicBarrier 替代 join()</h4>
<ul>
<li>CountDownLatch：等待多个线程完成（如主线程等待 10 个任务线程全部结束）；</li>
</ul>

<ul>
<li>CyclicBarrier：让多个线程等待彼此，到达同一 “屏障点” 后再继续（如 3 个线程都完成初始化后，再一起执行任务）。</li>
</ul>
<p><strong>CountDownLatch 示例</strong>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 主线程等待5个任务线程完成</span>
CountDownLatch latch = new <span class="hljs-built_in">CountDownLatch</span>(<span class="hljs-number">5</span>);
for (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    threadPool<span class="hljs-selector-class">.submit</span>(() -&gt; {
        try {
            <span class="hljs-comment">// 业务逻辑</span>
            Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">100</span>);
        } catch (InterruptedException e) {
            Thread<span class="hljs-selector-class">.currentThread</span>()<span class="hljs-selector-class">.interrupt</span>();
        } finally {
            latch<span class="hljs-selector-class">.countDown</span>(); <span class="hljs-comment">// 任务完成，计数器减1</span>
        }
    });
}
latch<span class="hljs-selector-class">.await</span>(); <span class="hljs-comment">// 主线程阻塞，直到计数器为0</span>
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("所有任务执行完成");
</code></pre>
<h3 data-id="heading-11">三、避坑指南：这些误区一定要避开</h3>
<p>即使掌握了最佳实践，仍可能因细节疏忽踩坑，以下是高频误区：</p>
<h4 data-id="heading-12">1. 认为 volatile 能保证原子性</h4>
<p>volatile 仅能保证<strong>可见性</strong>（线程修改后其他线程能立即看到）和<strong>有序性</strong>（禁止指令重排序），但不能保证<strong>原子性</strong>（如 i++ 是 “读 - 改 - 写” 三步操作，会被打断）。</p>
<p><strong>反例</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;
<span class="hljs-comment">// 多线程调用该方法，count最终结果会小于预期（原子性问题）</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span>()</span> {
    count++; 
}
</code></pre>
<p><strong>正例</strong>：</p>
<p>用原子类（AtomicInteger）替代 volatile，原子类基于 CAS（Compare and Swap）实现无锁原子操作：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet(); <span class="hljs-comment">// 原子操作</span>
}
</code></pre>
<h4 data-id="heading-13">2. ThreadLocal 用完不清理，导致内存泄漏</h4>
<p>ThreadLocal 用于存储线程私有变量（如 Web 项目中存储当前用户信息），但如果不手动清理，会导致内存泄漏：</p>
<ul>
<li>ThreadLocalMap 的 key 是弱引用（会被 GC 回收），但 value 是强引用；</li>
</ul>

<ul>
<li>若线程未结束（如线程池的核心线程），value 会一直占用内存，无法回收。</li>
</ul>
<p><strong>最佳实践</strong>：用完后调用 remove()，尤其是在 Web 场景（如拦截器、过滤器）：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. 定义ThreadLocal</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final ThreadLocal&lt;User&gt; userThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();
<span class="hljs-comment">// 2. 存储数据</span>
userThreadLocal.<span class="hljs-keyword">set</span>(currentUser);
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 业务逻辑</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 3. 必须清理！避免内存泄漏</span>
    userThreadLocal.<span class="hljs-keyword">remove</span>();
}
</code></pre>
<h4 data-id="heading-14">3. 用 “同步包装器” 替代并发容器</h4>
<p>Collections.synchronizedMap() 等同步包装器，本质是对所有方法加锁（相当于 “全局锁”），性能极差；推荐用专门的并发容器，如 ConcurrentHashMap、CopyOnWriteArrayList。</p>
<p><strong>对比</strong>：</p>























<table><thead><tr><th>场景</th><th>不推荐</th><th>推荐</th><th>优势</th></tr></thead><tbody><tr><td>线程安全 Map</td><td>Collections.synchronizedMap()</td><td>ConcurrentHashMap</td><td>分段锁 / CAS，支持高并发读写</td></tr><tr><td>线程安全 List</td><td>Collections.synchronizedList()</td><td>CopyOnWriteArrayList</td><td>读无锁，写时复制，适合读多写少</td></tr></tbody></table>
<h3 data-id="heading-15">四、总结：多线程开发的 “三字诀”</h3>
<p>多线程的核心不是 “炫技”，而是 “平衡安全与性能”。记住这三个字，能帮你少走 90% 的弯路：</p>
<ol>
<li><strong>“控”</strong> ：控制线程数量（用线程池）、控制锁粒度（缩小同步范围）；</li>
</ol>

<ol start="2">
<li><strong>“避”</strong> ：避开死锁（固定加锁顺序）、避开内存泄漏（清理 ThreadLocal）、避开原子性问题（用原子类）；</li>
</ol>

<ol start="3">
<li><strong>“用”</strong> ：用好并发工具（BlockingQueue、CountDownLatch）、用好并发容器（ConcurrentHashMap）。</li>
</ol>
<p>最后，多线程问题往往隐藏在 “极端场景” 中，建议结合工具排查：用 `</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 RAG系统构建指南：从「为什么」到「怎么做」]]></title>    <link>https://juejin.cn/post/7580202945146732559</link>    <guid>https://juejin.cn/post/7580202945146732559</guid>    <pubDate>2025-12-05T12:39:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580202945146732559" data-draft-id="7579995747171336227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 RAG系统构建指南：从「为什么」到「怎么做」"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-05T12:39:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="土豆1250"/> <meta itemprop="url" content="https://juejin.cn/user/3280598428302727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 RAG系统构建指南：从「为什么」到「怎么做」
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598428302727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    土豆1250
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T12:39:35.000Z" title="Fri Dec 05 2025 12:39:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🤔 Why - 为什么我们需要RAG？</h2>
<h3 data-id="heading-1">痛点一：LLM的"健忘症"</h3>
<p>你有没有遇到过这种情况？向ChatGPT询问公司内部文档、最新政策，它却一脸懵圈地开始"一本正经地胡说八道"？这就是大语言模型的经典病症——<strong>知识截止日期焦虑症</strong> + <strong>幻觉综合征</strong>。</p>
<ul>
<li><strong>知识过时</strong>：模型训练后，世界还在继续发展，它却停留在了"过去"</li>
<li><strong>缺乏专有知识</strong>：你公司的内部文档、行业报告，模型根本没见过</li>
<li><strong>爱编故事</strong>：当LLM不知道答案时，它不会老实说"我不知道"，而是信心满满地开始创作科幻小说</li>
</ul>
<h3 data-id="heading-2">痛点二：重新训练？太贵了吧！</h3>
<p>想让模型学会新知识？重新训练一个大模型？</p>
<ul>
<li>💰 <strong>成本问题</strong>：百万美元起步，中小企业直接劝退</li>
<li>⏰ <strong>时间成本</strong>：几周到几个月，等得花儿都谢了</li>
<li>🔄 <strong>更新困难</strong>：知识一变，又得重来一遍</li>
</ul>
<h3 data-id="heading-3">解决方案：RAG来拯救世界！</h3>
<p>RAG就像给LLM配了个"外挂大脑"——遇到问题先翻书（检索），再结合自己的理解（生成）回答。这样既保持了LLM的语言能力，又能实时获取最新、最准确的信息。</p>
<p><strong>核心价值</strong>：</p>
<ul>
<li>✅ 减少幻觉，答案更靠谱</li>
<li>✅ 支持专有知识，公司文档不再是摆设</li>
<li>✅ 实时更新，今天的新闻今天就能用</li>
<li>✅ 成本友好，不用砸锅卖铁</li>
</ul>
<hr/>
<h2 data-id="heading-4">📚 What - RAG到底是什么？</h2>
<h3 data-id="heading-5">核心概念：检索 + 生成的完美CP</h3>
<p>RAG = <strong>Retrieval</strong>（检索）+ <strong>Augmented</strong>（增强）+ <strong>Generation</strong>（生成）</p>
<p>简单来说，就是：</p>
<ol>
<li><strong>别急着回答</strong> → 先去知识库里找找相关资料</li>
<li><strong>带着资料回答</strong> → 把找到的信息塞给LLM，让它基于事实说话</li>
<li><strong>生成靠谱答案</strong> → 模型结合检索到的内容，输出有理有据的回复</li>
</ol>
<h3 data-id="heading-6">工作流程：四步走战略</h3>
<pre><code class="hljs language-markdown" lang="markdown">👤 用户提问
<span class="hljs-code">    ↓
🔍 信息检索（在知识库里翻箱倒柜）
    ↓
📝 上下文增强（把找到的东西和问题打包）
    ↓
🤖 答案生成（LLM开始表演）
    ↓
✨ 输出答案（附带信息来源）
</span></code></pre>
<h3 data-id="heading-7">技术栈：工具箱里的"五件套"</h3>



































<table><thead><tr><th>工具</th><th>作用</th><th>比喻</th></tr></thead><tbody><tr><td><strong>LangChain</strong></td><td>RAG框架</td><td>项目经理，统筹全局</td></tr><tr><td><strong>Sentence Transformers</strong></td><td>文本嵌入</td><td>翻译官，把文字变成数字</td></tr><tr><td><strong>FAISS</strong></td><td>向量数据库</td><td>图书馆索引系统，秒速找书</td></tr><tr><td><strong>DeepSeek API</strong></td><td>大语言模型</td><td>知识渊博的答题专家</td></tr><tr><td><strong>Python</strong></td><td>编程语言</td><td>施工队伍</td></tr></tbody></table>
<h3 data-id="heading-8">关键技术点</h3>
<p><strong>1. 文本嵌入（Embedding）</strong></p>
<ul>
<li>把文字变成向量（一串数字）</li>
<li>语义相似的文本，向量距离也近</li>
<li>例子：🍎"苹果好吃" 和 🍏"苹果很美味" 的向量会很接近</li>
</ul>
<p><strong>2. 向量检索</strong></p>
<ul>
<li>用户问题 → 转成向量 → 在向量数据库里找"邻居"</li>
<li>找到最相似的k个文档片段</li>
<li>相似度算法：余弦相似度、欧式距离等</li>
</ul>
<p><strong>3. 提示工程（Prompt Engineering）</strong></p>
<ul>
<li>告诉LLM："根据这些资料回答，别瞎编！"</li>
<li>模板示例：
<pre><code class="hljs">上下文：【检索到的文档】
问题：【用户的问题】
要求：基于上下文回答，不知道就说不知道！
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-9">🛠️ How - 手把手教你搭建RAG系统</h2>
<h3 data-id="heading-10">第一步：准备工作（10分钟搞定）</h3>
<p><strong>安装依赖包</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install langchain sentence-transformers faiss-cpu deepseek-llm openai python-dotenv
</code></pre>
<p><strong>获取DeepSeek API Key</strong></p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.deepseek.com%2F" target="_blank" title="https://platform.deepseek.com/" ref="nofollow noopener noreferrer">DeepSeek开放平台</a></li>
<li>注册账号 → 生成API Key</li>
<li>创建<code>.env</code>文件存储密钥：
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">DEEPSEEK_API_KEY</span>=<span class="hljs-string">"sk-your-key-here"</span>
</code></pre>
</li>
</ol>
<p><strong>准备知识库</strong>
创建<code>knowledge_base</code>文件夹，放入txt文件：</p>
<pre><code class="hljs language-bash" lang="bash">knowledge_base/
├── deepseek_info.txt  <span class="hljs-comment"># DeepSeek公司介绍</span>
└── rag_intro.txt      <span class="hljs-comment"># RAG技术说明</span>
</code></pre>
<h3 data-id="heading-11">第二步：核心代码实现（分模块理解）</h3>
<h4 data-id="heading-12">模块1：加载文档 📂</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> DirectoryLoader, TextLoader

<span class="hljs-comment"># 从文件夹加载所有txt文件</span>
loader = DirectoryLoader(
    <span class="hljs-string">'./knowledge_base/'</span>, 
    glob=<span class="hljs-string">"**/*.txt"</span>, 
    loader_cls=TextLoader,
    loader_kwargs={<span class="hljs-string">'encoding'</span>: <span class="hljs-string">'utf-8'</span>}
)
documents = loader.load()
</code></pre>
<p><strong>要点</strong>：支持批量加载，自动识别文件夹下所有txt文档</p>
<h4 data-id="heading-13">模块2：文本分割 ✂️</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter

<span class="hljs-comment"># 切成小块，方便检索和嵌入</span>
text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=<span class="hljs-number">500</span>,      <span class="hljs-comment"># 每块最多500字符</span>
    chunk_overlap=<span class="hljs-number">50</span>     <span class="hljs-comment"># 块之间重叠50字符（避免语义断裂）</span>
)
texts = text_splitter.split_documents(documents)
</code></pre>
<p><strong>为什么要分割</strong>？</p>
<ul>
<li>LLM上下文有限，不能塞太多内容</li>
<li>小块检索更精准</li>
<li>重叠部分保证语义连贯性</li>
</ul>
<h4 data-id="heading-14">模块3：生成向量 🧮</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_community.embeddings <span class="hljs-keyword">import</span> HuggingFaceEmbeddings

<span class="hljs-comment"># 使用预训练模型将文本转为向量</span>
embeddings = HuggingFaceEmbeddings(
    model_name=<span class="hljs-string">"sentence-transformers/all-MiniLM-L6-v2"</span>
)
</code></pre>
<p><strong>模型选择</strong>：</p>
<ul>
<li><code>all-MiniLM-L6-v2</code>：轻量级，速度快，适合入门</li>
<li>更强选择：<code>all-mpnet-base-v2</code>、<code>text-embedding-ada-002</code>（OpenAI）</li>
</ul>
<h4 data-id="heading-15">模块4：构建向量数据库 🗄️</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> FAISS

<span class="hljs-comment"># 一键生成向量库（自动嵌入+索引）</span>
vector_store = FAISS.from_documents(texts, embeddings)
</code></pre>
<p><strong>FAISS优势</strong>：</p>
<ul>
<li>Meta开源，性能强悍</li>
<li>支持百万级向量快速检索</li>
<li>CPU/GPU双版本可选</li>
</ul>
<h4 data-id="heading-16">模块5：初始化LLM 🤖</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepseek

llm = ChatDeepseek(
    model=<span class="hljs-string">"deepseek-chat"</span>,  <span class="hljs-comment"># 模型名称</span>
    api_key=api_key,
    temperature=<span class="hljs-number">0.1</span>         <span class="hljs-comment"># 降低随机性，答案更稳定</span>
)
</code></pre>
<p><strong>温度参数说明</strong>：</p>
<ul>
<li><code>0.0-0.3</code>：严谨模式，适合RAG</li>
<li><code>0.7-1.0</code>：创意模式，适合写作</li>
</ul>
<h4 data-id="heading-17">模块6：创建RAG链 ⛓️</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> RetrievalQA
<span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> PromptTemplate

<span class="hljs-comment"># 自定义提示模板</span>
prompt_template = <span class="hljs-string">"""
根据以下上下文回答问题。
找不到答案就说"我不知道"，别瞎编！

上下文: {context}
问题: {question}
答案:
"""</span>
PROMPT = PromptTemplate(
    template=prompt_template, 
    input_variables=[<span class="hljs-string">"context"</span>, <span class="hljs-string">"question"</span>]
)

<span class="hljs-comment"># 组装完整RAG链</span>
qa_chain = RetrievalQA.from_chain_type(
    llm=llm,
    chain_type=<span class="hljs-string">"stuff"</span>,  <span class="hljs-comment"># 将检索内容全部塞入提示</span>
    retriever=vector_store.as_retriever(search_kwargs={<span class="hljs-string">"k"</span>: <span class="hljs-number">3</span>}),  <span class="hljs-comment"># 检索前3个最相关片段</span>
    chain_type_kwargs={<span class="hljs-string">"prompt"</span>: PROMPT},
    return_source_documents=<span class="hljs-literal">True</span>  <span class="hljs-comment"># 返回信息来源</span>
)
</code></pre>
<h4 data-id="heading-18">模块7：提问交互 💬</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 用户输入问题</span>
user_query = <span class="hljs-string">"DeepSeek是什么公司？"</span>

<span class="hljs-comment"># 执行RAG流程</span>
result = qa_chain.invoke({<span class="hljs-string">"query"</span>: user_query})

<span class="hljs-comment"># 输出答案</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"答案:"</span>, result[<span class="hljs-string">"result"</span>])

<span class="hljs-comment"># 输出来源（可追溯！）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n信息来源:"</span>)
<span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> result[<span class="hljs-string">"source_documents"</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文件: <span class="hljs-subst">{doc.metadata[<span class="hljs-string">'source'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"内容: <span class="hljs-subst">{doc.page_content}</span>"</span>)
</code></pre>
<h3 data-id="heading-19">第三步：运行测试 🎯</h3>
<p><strong>完整流程演示</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile">$ python simple_rag.py

加载知识库文档... ✓
分割文档... ✓ (生成12个文本块)
生成文本嵌入... ✓
构建向量数据库... ✓
初始化DeepSeek LLM... ✓
创建RAG链... ✓

<span class="hljs-section">请输入问题: DeepSeek的使命是什么？</span>

正在检索相关文档...
找到3个相关片段 ✓
调用LLM生成答案...

<span class="hljs-section">模型回答:</span>
DeepSeek的使命是<span class="hljs-string">"用AI改变世界"</span>。

<span class="hljs-section">引用来源:</span>
[片段1] 来自: knowledge_base/deepseek_info.txt
<span class="hljs-section">内容: DeepSeek的使命是"用AI改变世界"...</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">🚀 进阶优化：从入门到精通</h2>
<h3 data-id="heading-21">优化方向一：提升检索质量 🎯</h3>
<p><strong>1. 优化文本分割</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 根据语义分割（更智能）</span>
<span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> SpacyTextSplitter
splitter = SpacyTextSplitter(chunk_size=<span class="hljs-number">500</span>)
</code></pre>
<p><strong>2. 混合检索策略</strong></p>
<ul>
<li>向量检索（语义相似）+ BM25关键词检索</li>
<li>两种结果融合，取长补短</li>
</ul>
<p><strong>3. 重排序（Re-ranking）</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 用更强的模型对检索结果重新打分</span>
<span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> CrossEncoder
reranker = CrossEncoder(<span class="hljs-string">'cross-encoder/ms-marco-MiniLM-L-12-v2'</span>)
</code></pre>
<h3 data-id="heading-22">优化方向二：提升生成质量 ✍️</h3>
<p><strong>1. 提示工程进阶</strong></p>
<pre><code class="hljs language-python" lang="python">prompt_template = <span class="hljs-string">"""
你是一个专业助手，需要基于以下文档回答问题。

【要求】
1. 答案必须来自文档，不要添加额外信息
2. 如果文档中没有答案，明确说"根据现有信息无法回答"
3. 引用文档时标注来源
4. 保持答案简洁、准确

【文档】
{context}

【问题】
{question}

【答案】
"""</span>
</code></pre>
<p><strong>2. Few-shot学习</strong></p>
<ul>
<li>在提示中加入示例问答对</li>
<li>教会模型如何更好地利用上下文</li>
</ul>
<h3 data-id="heading-23">优化方向三：系统性能优化 ⚡</h3>
<p><strong>1. 异步处理</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">async_query</span>(<span class="hljs-params">query</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> qa_chain.ainvoke({<span class="hljs-string">"query"</span>: query})

<span class="hljs-comment"># 批量并发查询</span>
results = <span class="hljs-keyword">await</span> asyncio.gather(*[async_query(q) <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> queries])
</code></pre>
<p><strong>2. 缓存机制</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.cache <span class="hljs-keyword">import</span> InMemoryCache
<span class="hljs-keyword">import</span> langchain
langchain.llm_cache = InMemoryCache()  <span class="hljs-comment"># 相同问题直接返回缓存</span>
</code></pre>
<p><strong>3. 流式输出</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 用户体验更好，边生成边展示</span>
<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> qa_chain.stream({<span class="hljs-string">"query"</span>: user_query}):
    <span class="hljs-built_in">print</span>(chunk, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-24">优化方向四：评估与监控 📊</h3>
<p><strong>使用RAGAS框架评估</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> ragas <span class="hljs-keyword">import</span> evaluate
<span class="hljs-keyword">from</span> ragas.metrics <span class="hljs-keyword">import</span> faithfulness, answer_relevancy

<span class="hljs-comment"># 评估RAG系统质量</span>
results = evaluate(
    dataset=test_dataset,
    metrics=[faithfulness, answer_relevancy]
)
</code></pre>
<p><strong>关键指标</strong>：</p>
<ul>
<li><strong>Faithfulness</strong>（忠实度）：答案是否基于检索内容？</li>
<li><strong>Answer Relevancy</strong>（相关性）：答案是否切题？</li>
<li><strong>Context Precision</strong>（上下文精度）：检索的内容是否精准？</li>
</ul>
<hr/>
<h2 data-id="heading-25">🎓 总结：RAG的价值与未来</h2>
<h3 data-id="heading-26">三句话总结RAG</h3>
<ol>
<li><strong>Why</strong>：LLM有局限（知识过时、缺乏专有信息、易产生幻觉），RAG通过检索外部知识解决这些问题</li>
<li><strong>What</strong>：RAG = 检索器（找资料）+ LLM（理解生成），让模型"有据可依"</li>
<li><strong>How</strong>：用LangChain框架 + 向量数据库 + 大模型API，10分钟搭建基础系统</li>
</ol>
<h3 data-id="heading-27">RAG的适用场景 💡</h3>
<ul>
<li>✅ <strong>企业知识库问答</strong>：公司文档、产品手册</li>
<li>✅ <strong>客服机器人</strong>：基于FAQ和历史工单</li>
<li>✅ <strong>法律/医疗咨询</strong>：需要引用权威文献</li>
<li>✅ <strong>个人知识管理</strong>：笔记检索与总结</li>
</ul>
<h3 data-id="heading-28">下一步行动清单 📋</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 搭建第一个RAG原型系统</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 用自己的文档测试效果</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 尝试不同的嵌入模型和LLM</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 添加Web UI（用Streamlit/Gradio）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 建立评估流程，持续优化</li>
</ul>
<h3 data-id="heading-29">一句话警告 ⚠️</h3>
<p><strong>RAG不是万能药</strong>！复杂推理、创意生成任务还是得靠模型本身的能力。RAG的强项是"知识密集型"任务，记住这个定位，才能用得其所。</p>
<hr/>
<p><strong>🎉 恭喜你！现在你已经掌握了RAG的核心原理和实战技巧。去构建你的AI知识助手吧！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么说CLIP是多模态大模型的基石？]]></title>    <link>https://juejin.cn/post/7580197740962299930</link>    <guid>https://juejin.cn/post/7580197740962299930</guid>    <pubDate>2025-12-05T12:41:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580197740962299930" data-draft-id="7580183671531307046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么说CLIP是多模态大模型的基石？"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-05T12:41:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么说CLIP是多模态大模型的基石？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T12:41:14.000Z" title="Fri Dec 05 2025 12:41:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>引言</strong></p>
<p>在DeepSeek-OCR的编码器架构中，CLIP被作为关键组件引入。</p>
<p>多模态模型的核心挑战之一在于视觉信息的语义理解，即完成语言与图像在共享语义空间中的对齐映射。</p>
<p>本文将系统解析OpenAI于2021年发布的CLIP这一开创性研究，深入探讨其实现机制与技术细节。</p>
<p><strong>动机</strong></p>
<p>在CLIP模型问世前，传统计算机视觉模型普遍依赖于人工标注的数据集，例如ImageNet、COCO等。这些模型通过人工标注的方式（如标注"这是猫"、"那是飞机"）进行训练，虽然在小规模任务中表现良好，但存在三个主要问题：</p>
<p><strong>‌类别封闭性‌</strong>：模型仅能识别预设的有限类别；</p>
<p><strong>‌标注成本高‌</strong>：大规模数据标注既耗时又昂贵；</p>
<p><strong>‌泛化能力不足‌</strong>：当数据分布发生改变时，模型性能会显著下降。</p>
<p>由于自然语言本身包含了对世界的丰富描述，OpenAI提出了一个创新构想：通过让模型从互联网上的图文对中自主学习，而非依赖人工标注，是否能够实现更通用的视觉理解能力？</p>
<p><strong>方法</strong></p>
<p>CLIP模型包含两个核心编码组件：</p>
<p><strong>视觉编码器</strong>（Image Encoder）：采用ResNet架构或Vision Transformer；</p>
<p><strong>语言编码器</strong>（Text Encoder）：基于CBOW模型或Transformer框架构建。</p>
<p>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caaf4adaa394422485ff3a3da384dc13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543273&amp;x-signature=6DsvSGH6Y5qc%2FG6x4uOwV0jS3Pg%3D" alt="图片" loading="lazy"/></p>
<p>训练目标的核心逻辑如下：</p>
<p>每个训练批次包含N组图片与N段文本，模型需完成图文匹配任务。具体实现中：</p>
<p>通过计算所有图片-文本对的相似度，构建N×N的相似度矩阵；</p>
<p>理想情况下，矩阵对角线（i=j位置）的相似度值应最大，因其对应真实配对的图文对；</p>
<p>采用对比学习（Contrastive Learning）机制，推动匹配对的嵌入向量在高维空间中相互靠近，同时拉远不匹配对的距离，从而逼近理想矩阵分布。</p>
<p>论文提供的代码显示，损失函数采用分类交叉熵损失，分别对图像和文本模态独立计算后取均值作为最终损失。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260ea1f7da08432b9e7fdfcc784aba88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543273&amp;x-signature=UfxJZbRJpt1oSzA7tpHA477NeEA%3D" alt="图片" loading="lazy"/></p>
<p><strong>训练数据集</strong></p>
<p>研究者创建了一个突破性的数据集——WebImageText（WIT），包含约4亿组（图像，文本）配对数据，来源涵盖公共网页、社交平台及图片分享网站。</p>
<p>与传统分类数据集ImageNet（含120万张图像、1000个类别）相比，该数据集的规模具有革命性，充分体现了OpenAI"规模驱动突破"的技术理念。</p>
<p>在图像分类任务中，语义歧义是常见挑战。例如单词"remote"作为名词指代遥控器，作为形容词则表示遥远距离。若仅用单一单词标注图像，此类歧义会阻碍模型准确理解语义。</p>
<p>为此，CLIP模型采用特定提示词模板进行训练，如下图所示的标准模板为"A photo of a {具体对象}"。通过这种方式可强制限定词性为名词，同时该框架支持多种衍生模板变体。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18f00f5b82244948a26ad6c032d36d41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543273&amp;x-signature=amzmo0pgiwz425tnzymofEvzwqI%3D" alt="图片" loading="lazy"/></p>
<p><strong>零样本学习能力</strong></p>
<p>零样本学习（Zero-Shot Learning）指模型通过大规模数据预训练后，无需针对特定下游任务进行微调，即可直接完成预测任务。</p>
<p>下图展示了CLIP模型在多个经典分类数据集上采用零样本推理与Linear Probe方法的性能对比。</p>
<p>其中，Linear Probe技术是指固定预训练模型的参数，仅新增一个分类层并对下游任务进行微调的训练策略。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07b0da85b77747c585a4d3f4bdaed469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543273&amp;x-signature=tuM0VQ7sKq7qqCI3GQCLJpBBrIg%3D" alt="图片" loading="lazy"/></p>
<p>图中正值反映CLIP零样本方法优于微调后效果，负值则表明其表现不及微调模型。</p>
<p>这一现象揭示了CLIP的固有局限：面对细粒度分类任务（如汽车/飞机型号鉴别或花卉品种区分），零样本CLIP的性能仍落后于专为特定任务设计的模型。</p>
<p>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[登顶SuperCLUE DeepSearch，openPangu-R-72B深度搜索能力跃升]]></title>    <link>https://juejin.cn/post/7580198093154025518</link>    <guid>https://juejin.cn/post/7580198093154025518</guid>    <pubDate>2025-12-05T12:43:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580198093154025518" data-draft-id="7580180556983582770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="登顶SuperCLUE DeepSearch，openPangu-R-72B深度搜索能力跃升"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-05T12:43:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            登顶SuperCLUE DeepSearch，openPangu-R-72B深度搜索能力跃升
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T12:43:57.000Z" title="Fri Dec 05 2025 12:43:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着大模型推理和 Agent 工具调用能力的快速发展，其通过反复搜索处理复杂信息需求的效果愈发受到业界关注。近日，第三方评测机构 SuperCLUE 发布 11 月 DeepSearch 评测报告，国产大模型 openPangu-R-72B 凭借在长链推理、复杂信息检索领域的卓越表现，在模型榜单中名列第一，体现了基于国产昇腾算力的大模型研发实力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b573b329e52a4405a302e0697f6aed58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543437&amp;x-signature=Dr28oG7Heqn9MM4C9aV6RkU9120%3D" alt="图片" loading="lazy"/></p>
<p>这款 MoE 架构模型，究竟藏着哪些技术秘密，能在激烈竞争中脱颖而出？</p>
<p>硬核技术底座：</p>
<p>MoE 架构下的效率与性能平衡术</p>
<p>openPangu-R-72B 为考虑效率和性能平衡，重新设计了模型底座架构。作为基于昇腾集群训练的 MoE（混合专家）模型，它采用 80 选 8 的专家选择机制，在 74B 总参数量的基础上，将激活参数量控制在 15B，既保留了大模型的复杂推理能力，又有效降低了计算开销。24T tokens 的训练数据与 128k 长序列处理能力，为其处理深度搜索任务中的长文本信息奠定了基础。</p>
<p>为实现稳定收敛与效果提升，openPangu 团队在预训练技术上完成了以下优化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30543f3e074944e59ed34fb458e8e12c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543437&amp;x-signature=ODEayMh%2BNt3WjkG%2FKzA0o8EEUBA%3D" alt="图片" loading="lazy"/></p>
<p>图. openPangu-R-72B 模型架构</p>
<p>1）注意力机制层面引入参数式 Sink Token 技术：有效缓解了极大激活值问题，不仅提升了训练过程的稳定性，也对后续量化更加亲和；</p>
<p>2）采用 K-Norm 与 Depth-Scaled Sandwich-Norm 组合的架构，其中 K-Norm 仅对 attention 的 key 施加 RMS Norm，在达到与 QK-Norm 相当稳定性的同时，降低计算开销，还保留了 Query 更灵活的表达能力。</p>
<p>3）注意力架构的优化兼顾了精度与效率：通过增加 Query 头数和注意力头维度，让模型能从更多角度捕获细粒度语义关系；引入 Partial RoPE 机制，仅对 Query 和 Key 中 1/3 维度应用位置编码。通过将 KV 组数量减半，在 Key 头维度增加的情况下，仍实现了 37.5% 的 KV cache 缩减，平衡了推理阶段的显存占用、速度与模型效果。</p>
<p>4）Adaptive Aux Free 负载优化技术：Aux free 升级版本，通过自适应调整各个专家负载 bias 的更新幅度，有效减少均衡震荡，让专家负载分布更均衡。</p>
<p>DeepSearch 专项突破：</p>
<p>三大优化破解复杂搜索难题</p>
<p>如果说技术底座是基础，那么针对深度搜索任务的后训练优化则是 openPangu-R-72B 登顶的关键。深度搜索作为大模型访问互联网获取深度信息的核心能力，其长链推理与工具调用水平直接决定模型的实用价值。openPangu-R-72B 通过后训练阶段进行长链难题合成、非索引信息处理、快慢思考融合三大策略，显著提升了模型 DeepSearch 能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b1a734c4fb1408d91216027834b9b4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765543437&amp;x-signature=CXa5NCGaUE4%2Bx5H4wTn3g0WfPTE%3D" alt="图片" loading="lazy"/></p>
<p>图. openPangu-R-72B 模型深度搜索任务执行流程，该流程同时用于模型训练和评测</p>
<p>1）在长链 QA 难题合成方面，openPangu 团队在 DeepDiver-V2 和 WebExplorer 技术基础上，通过 query 条件模糊化将问题平均难度提升 10%，同时借鉴《Pushing Test-Time Scaling Limits of Deep Search with Asymmetric Verification》工作的思想，引入 verification agent，大幅提升用于训练问答对的准确性，让模型在复杂推理场景中 “见多识广”。</p>
<p>2）针对传统搜索引擎难以覆盖的非索引知识问答 —— 如官网附件中的财务数据、学术论文引文信息获取等场景，模型训练过程中注入了 “Planner 聚焦关键 URL+ URL_crawler 爬取网页 + Document_QA 识别下一步浏览链接” 的循环工作流，通过同一站点内的多跳浏览实现了深度信息搜集，突破了传统搜索引擎的信息边界。</p>
<p>3）步骤级快慢融合策略则让模型的 “思考” 更具效率。DeepSearch 的 ReACT 执行过程中，不同步骤的思考强度差异显著 ——Document_QA 需分析海量网页数据与表格，对推理精度要求更高；而普通工具调用步骤更侧重效率。为此，模型为不同步骤匹配不同思考模式：Document_QA 启用慢思考保障精度，其他步骤采用快思考提升速度，实现了精度与效率的平衡。</p>
<p>国产算力赋能：</p>
<p>openPangu 系列模型彰显集群优势</p>
<p>此次 SuperCLUE DeepSearch 评测登顶，不仅是 openPangu-R-72B 模型能力的体现，也彰显了国产算力与大模型研发深度融合的成效。作为基于昇腾集群训练的代表模型，openPangu-R-72B 证明了国产算力平台在支撑大参数量、高复杂度模型研发方面的坚实能力。</p>
<p>值得关注的是，openPangu-R-72B 的兄弟模型 openPangu-718B 在同期 SuperCLUE 通用榜单中斩获第二名，展现了该系列在不同任务场景下的全面实力。从深度搜索的 “单点突破” 到通用能力的 “全面开花”，openPangu 系列正以昇腾算力为根基，为国产大模型生态注做出更多贡献。</p>
<p>随着大模型在企业服务、学术研究、政务处理等领域的深度落地，深度搜索能力将成为模型实用化的核心竞争力。未来，随着 openPangu 系列模型的持续迭代，我们期待国产大模型在更多全球顶级评测中绽放光彩。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[怎么设计一个加密货币 谁有权利发行数字货币 怎么防止double spending attack 怎么验证交易合法性 铸币交易..]]></title>    <link>https://juejin.cn/post/7580184249908314154</link>    <guid>https://juejin.cn/post/7580184249908314154</guid>    <pubDate>2025-12-05T10:55:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580184249908314154" data-draft-id="7579934463591120932" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="怎么设计一个加密货币 谁有权利发行数字货币 怎么防止double spending attack 怎么验证交易合法性 铸币交易.."/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-05T10:55:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端涂涂"/> <meta itemprop="url" content="https://juejin.cn/user/3740972207312249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            怎么设计一个加密货币 谁有权利发行数字货币 怎么防止double spending attack 怎么验证交易合法性 铸币交易..
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3740972207312249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端涂涂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T10:55:42.000Z" title="Fri Dec 05 2025 10:55:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>下面给你<strong>结合概念 + 原理解释 + 示例类比 + 在设计加密货币时的作用</strong>的<strong>深度讲解版</strong>，帮助你真正理解每个概念如何共同构成“一个加密货币系统”。</p>
<p>内容结构如下：</p>
<ol>
<li>每个概念都有：<strong>定义 → 为什么需要 → 例子 → 在加密货币中的作用</strong></li>
<li>内容逻辑自然衔接（从“如何设计货币 → 安全 → 共识 → 分布式系统”）</li>
</ol>
<hr/>
<h2 data-id="heading-0"><strong>📘 一、怎么设计一个加密货币（核心框架）</strong></h2>
<p>设计一套加密货币，你必须解决 3 个根问题：</p>
<ol>
<li><strong>谁有权发行？</strong>（发行权）</li>
<li><strong>怎么验证交易？</strong>（合法性）</li>
<li><strong>怎么达成共识？</strong>（全网同步、防攻击）</li>
</ol>
<p>因此，设计币必须包含：</p>
<ul>
<li>货币发行规则（coinbase / genesis / monetary policy）</li>
<li>去中心化账本（区块链）</li>
<li>防双花机制</li>
<li>分布式共识机制（PoW / PoS）</li>
<li>交易验证逻辑（签名、UTXO、余额检查）</li>
<li>节点的通信与抗攻击机制</li>
</ul>
<p>下面逐一拆解概念。</p>
<hr/>
<h2 data-id="heading-1"><strong>📗 二、谁有权发行数字货币</strong></h2>
<h4 data-id="heading-2"><strong>1️⃣ 传统货币（中心化）</strong></h4>
<p>央行发行。</p>
<h4 data-id="heading-3"><strong>2️⃣ 加密货币（去中心化）</strong></h4>
<p>发行权由 <strong>数学规则</strong> 决定：</p>
<ul>
<li><strong>比特币发行者：矿工（通过挖矿）</strong></li>
<li>块奖励由协议写死（2110万上限）</li>
<li>新币来自 <strong>coinbase transaction（铸币交易）</strong></li>
</ul>
<p>➡️ <strong>结论：发行权不是人决定，是协议决定。</strong></p>
<hr/>
<h2 data-id="heading-4"><strong>📘 三、怎么防止 Double Spending Attack（双花攻击）</strong></h2>
<p>双花：同一笔钱被花两次。</p>
<p>例如：</p>
<p>Alice 有 1 BTC
她同时向 Bob 和 Carol 各发 1 BTC
希望网络不同步导致都确认成功。</p>
<h4 data-id="heading-5"><strong>BTC 的防御：</strong></h4>
<h5 data-id="heading-6"><strong>① UTXO 模型</strong></h5>
<p>每个输出只能花一次，节点会检查：</p>
<blockquote>
<p>该UTXO是否已被花过？</p>
</blockquote>
<h5 data-id="heading-7"><strong>② 工作量证明 + 最长链规则</strong></h5>
<p>攻击者必须：</p>
<ul>
<li>重写历史</li>
<li>超过全网算力</li>
<li>重新挖出更长链</li>
</ul>
<p>难度极高 → 成本巨大 → 无法双花</p>
<hr/>
<h2 data-id="heading-8"><strong>📙 四、怎么验证交易合法性</strong></h2>
<p>验证流程（比特币）：</p>
<h4 data-id="heading-9"><strong>① 签名验证（身份合法）</strong></h4>
<p>检查：</p>
<pre><code class="hljs">交易输入引用的公钥 + 签名 是否匹配？
</code></pre>
<p>谁的币 → 谁的私钥 → 才能花。</p>
<h4 data-id="heading-10"><strong>② UTXO 是否存在（余额合法）</strong></h4>
<p>输入引用的UTXO必须存在且未花费。</p>
<h4 data-id="heading-11"><strong>③ 输入金额 ≥ 输出金额（无凭空造币）</strong></h4>
<h4 data-id="heading-12"><strong>④ Script 脚本（锁定/解锁逻辑）</strong></h4>
<hr/>
<h2 data-id="heading-13"><strong>📘 五、铸币交易（Coinbase Transaction）</strong></h2>
<p>这是 <strong>每个区块的第一笔交易</strong>，由矿工创建。</p>
<p>包含：</p>
<ul>
<li>区块奖励（新币发行）</li>
<li>交易手续费（来自区块内其他交易）</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">coinbase:</span>
  <span class="hljs-attr">input:</span> <span class="hljs-literal">no</span> <span class="hljs-string">previous</span> <span class="hljs-string">output</span>
  <span class="hljs-attr">output:</span> <span class="hljs-string">miner's</span> <span class="hljs-string">address</span> <span class="hljs-string">+</span> <span class="hljs-string">block</span> <span class="hljs-string">reward</span>
</code></pre>
<p>→ 新币产生机制
→ 挖矿收入来源</p>
<hr/>
<h2 data-id="heading-14"><strong>📗 六、Distributed Consensus（分布式共识）</strong></h2>
<p><strong>定义：</strong>
在没有中心服务器的情况下，使整个网络对“世界状态”达成一致。</p>
<p>区块链中的一致内容包括：</p>
<ul>
<li>谁的余额是多少？</li>
<li>哪些交易有效？</li>
<li>哪个区块是最新的？</li>
</ul>
<p>BTC 使用：</p>
<h4 data-id="heading-15"><strong>PoW + longest chain rule</strong></h4>
<ul>
<li>最难挖的链 = 最可信</li>
<li>避免双花</li>
<li>抗恶意节点</li>
</ul>
<hr/>
<h2 data-id="heading-16"><strong>📘 七、Distributed Hash Table（DHT）</strong></h2>
<p>不是比特币核心，但常用于 P2P 网络和区块链项目。</p>
<p><strong>定义：</strong>
一种分布式存储结构，用哈希定位数据位置。</p>
<p>例如：</p>
<p>BitTorrent 查找文件块
Filecoin 存储文件索引</p>
<p>作用：</p>
<ul>
<li>数据分散存</li>
<li>无中心</li>
<li>高扩展性</li>
</ul>
<hr/>
<h2 data-id="heading-17"><strong>📕 八、CAP 定理（Consistency / Availability / Partition tolerance）</strong></h2>
<p><strong>分布式系统的三大属性：</strong></p>
<ol>
<li>
<p><strong>Consistency（强一致性）</strong>
所有节点看到同一份数据。</p>
</li>
<li>
<p><strong>Availability（可用性）</strong>
节点持续可以响应请求。</p>
</li>
<li>
<p><strong>Partition Tolerance（分区容忍性）</strong>
网络分裂时仍可运行。</p>
</li>
</ol>
<p>⚠️ 定理：<strong>三者不可同时满足，只能满足其中两个。</strong></p>
<p>区块链选择：</p>
<blockquote>
<p><strong>AP</strong> → 最终一致性（eventual consistency）</p>
</blockquote>
<p>因为：</p>
<ul>
<li>区块传播有延迟</li>
<li>全网只能做到最终同步</li>
</ul>
<hr/>
<h2 data-id="heading-18"><strong>📘 九、Paxos（传统共识算法）</strong></h2>
<p>Paxos 是分布式系统中解决一致性的经典算法。</p>
<ul>
<li>专为少量节点设计（一般 3–7 台）</li>
<li>用于银行、数据库（Google、Zookeeper）</li>
</ul>
<p>⚠️ 并不适用于加密货币：</p>
<ul>
<li>要求身份明确（区块链是匿名的）</li>
<li>要求节点数量不多（区块链节点多且不可信）</li>
</ul>
<hr/>
<h2 data-id="heading-19"><strong>📙 十、Membership（分布式系统中的成员管理）</strong></h2>
<p>指：</p>
<ul>
<li>哪些节点是合法成员？</li>
<li>如何加入？</li>
<li>如何踢出作恶节点？</li>
</ul>
<p>传统系统：Paxos、Raft 都需要 membership control</p>
<p>比特币：</p>
<blockquote>
<p><strong>谁都能加入，不需要许可（permissionless）。</strong></p>
</blockquote>
<p>Membership 是公开开放的。</p>
<hr/>
<h2 data-id="heading-20"><strong>📘 十一、BTC 的共识机制是什么？</strong></h2>
<p><strong>Proof of Work（工作量证明） + 最长链（Nakamoto Consensus）</strong></p>
<p>核心：</p>
<ol>
<li><strong>挖矿 = 投入算力证明诚实</strong></li>
<li>最长链视为“真实历史”</li>
<li>攻击者要篡改历史必须超过全网算力（几乎不可能）</li>
</ol>
<hr/>
<h2 data-id="heading-21"><strong>📙 十二、Sybil Attack（女巫攻击）</strong></h2>
<p><strong>定义：</strong>
攻击者创建大量虚假身份来控制系统。</p>
<p>例如：</p>
<ul>
<li>制造 1 万个节点试图影响共识</li>
<li>在投票系统中伪造大量身份</li>
</ul>
<p>区块链如何防御？</p>
<h4 data-id="heading-22"><strong>比特币：用 PoW 抗 Sybil</strong></h4>
<p>身份无意义 → <strong>算力才是身份</strong></p>
<p>你开 1000 个节点
= 你只是把自己的算力拆成 1000 份
= 总算力不变
= 没法影响共识</p>
<p>→ 这是 Nakamoto 共识的一个核心优势。</p>
<hr/>
<h2 data-id="heading-23"><strong>📌 总结（极简）</strong></h2>








































<table><thead><tr><th>概念</th><th>问题</th><th>解决方式</th></tr></thead><tbody><tr><td>发行权</td><td>谁能印钱？</td><td>Coinbase（矿工）</td></tr><tr><td>双花</td><td>怎么防止一币两花？</td><td>PoW + 最长链 + UTXO</td></tr><tr><td>交易验证</td><td>如何判断交易有效？</td><td>签名 + UTXO + Script</td></tr><tr><td>共识</td><td>全网怎么看法一致？</td><td>PoW（Nakamoto Consensus）</td></tr><tr><td>Sybil 攻击</td><td>虚假身份攻击</td><td>算力证明（PoW）</td></tr><tr><td>CAP</td><td>分布式系统限制</td><td>区块链选择 AP</td></tr></tbody></table>
<hr/>
<p>如果你需要，我还可以：</p>
<p>✔ 绘制 <strong>Mermaid 思维导图</strong>
✔ 绘制 <strong>流程图 / 区块链结构图 / DHT 图</strong>
✔ 统一生成 <strong>可视化 PDF / PNG</strong>
✔ 用 <strong>比特币为例写成教案 / 总结</strong></p>
<p>需要生成哪种格式？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年12月最新的 Google AI One Pro 1年会员教育认证通关指南]]></title>    <link>https://juejin.cn/post/7579985751938809890</link>    <guid>https://juejin.cn/post/7579985751938809890</guid>    <pubDate>2025-12-05T11:21:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579985751938809890" data-draft-id="7579949847396368384" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年12月最新的 Google AI One Pro 1年会员教育认证通关指南"/> <meta itemprop="keywords" content="前端,后端,AI编程"/> <meta itemprop="datePublished" content="2025-12-05T11:21:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摆烂工程师"/> <meta itemprop="url" content="https://juejin.cn/user/1552933235470589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年12月最新的 Google AI One Pro 1年会员教育认证通关指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1552933235470589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摆烂工程师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T11:21:52.000Z" title="Fri Dec 05 2025 11:21:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Gemini 3.0 Pro 发布之后，Google AI One Pro 的教育优惠1年活动时间又延长啦～</p>
<p>下面我整理了2025年12月最新的教程，只要你有 <strong>“Gemini教育优惠验证资格”</strong> 基本100%通过认证！！！</p>
<p><strong>教程有点长，但是基本操作下来只要 5～10 分钟就完成。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46fb8c3304c641d0b44155771160a14f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=9gWkcOZJqEhia%2BP7857tNJkAkXg%3D" alt="" loading="lazy"/></p>
<p>而最新的 Gemini 教育优惠认证走的是 <strong>Sheerid 认证</strong>，不再是以前的接个验证码就行的。</p>
<p><strong>那么如何通过 Google Gemini 学生优惠的认证：</strong></p>
<ol>
<li>怎么确认自己的谷歌邮箱账号是否有验证资格？</li>
<li>如何通过Sheerid认证？</li>
<li>如何绑定卡完成领取1年的Gemini Pro 会员？</li>
</ol>
<p><strong>完整的步骤：</strong> 确认资格 -&gt; Sheerid 学生认证 -&gt; 绑卡完成订阅。</p>
<h2 data-id="heading-0">一、如何确认自己的账号是否有验证资格？</h2>
<p>你要获得 1年的 Gemini Pro 教育优惠会员，首先需要确认自己是否有验证资格。</p>
<p>也就是你得有门票，你没有门票，谷歌就无法进行检验门票信息。</p>
<blockquote>
<p><strong>验证地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoo.gle%2Ffreepro" target="_blank" title="https://goo.gle/freepro" ref="nofollow noopener noreferrer">goo.gle/freepro</a></p>
</blockquote>
<p>打开上面的验证地址之后，如果你的页面显示下方这种提示的话，大概率是IP问题，你可以切换到美区IP或者新加坡之类的试试。</p>
<p>如果还是报无法订阅，大概率你的账号关联到国内信息，无法进行验证了，这种情况基本无解，你可以直接去注册新号尝试！</p>
<h4 data-id="heading-1">第一种：无资格，但可能是IP问题的情况：</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a5539ad19074477926368b49064eaa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=ONjcTdFgHvQXDZTxcNjaHhLWzqc%3D" alt="不符合资格提示" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1b0732397b14306b454e9336c1ff826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=EaqQo78RPWcZgImEgib8AWtFBto%3D" alt="不符合资格提示" loading="lazy"/></p>
<p><strong>为了更好确认是否是IP问题</strong>，还有一种方法，就是可以查看你是<strong>否能订阅 Youtube 的会员</strong>，如果无法订阅，那么大概率是你的IP问题。</p>
<blockquote>
<p><strong>Youtube 订阅地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyoutube.com%2Fred" target="_blank" title="https://youtube.com/red" ref="nofollow noopener noreferrer">youtube.com/red</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfad5c550d32496f917f2bc5ad208219~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=iHrzB%2FtmI1WEFDKCulMyR2XL7fA%3D" alt="" loading="lazy"/></p>
<p>如果你是使用了教育邮箱，也就是学校分配的教育邮箱进行登录的谷歌，也是无法进行验证的。</p>
<p>我使用了几种后缀的教育邮箱进行测试：<code>.edu</code>、<code>.edu.uk</code>、<code>edu.ac</code> 直接登录谷歌邮箱，肯定无资格的。</p>
<blockquote>
<p>另外，你都有了教育邮箱，可以拿一个其他的谷歌邮箱有验证资格的，进行关联你的教育邮箱进行SSO登录授权，就可以进行认证成功呀！</p>
</blockquote>
<h4 data-id="heading-2">第二种：直接无资格</h4>
<p>当你打开活动页面出现关键词：<strong>“This offer is not available”</strong> 或者 <strong>“无法享受此优惠”</strong> 基本是账号没有验证资格，这种情况无需折腾。</p>
<p><strong>出现这个的可能性有这几点：</strong></p>
<ol>
<li>注册谷歌邮箱时，进行绑定了国内+86手机号码</li>
<li>注册谷歌邮箱时，使用了国内节点或者其他没有优惠的节点</li>
<li>你的账号已经开通过 Gemini Pro，或者之前弄了其他优惠</li>
</ol>
<p>出现这种情况的话，就算你投机取巧让它恢复了可以验证的资格，也可能会在通过之后，直接无法绑卡订阅。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0c2f20648248e1a331c6d33f5a245d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=3StQ5%2Bmb8h7fNGhoJBddI1XWU0I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30c52e7cceaa4a88816cbe1bc19cd332~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=Bopf4llFHTPSIb1g5UVGlUwHPIY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">第三种：幽灵资格</h4>
<p>这种幽灵资格的，不知道是不是谷歌的问题，一开始有验证资格，结果刷新一下页面，唰了一下，无验证资格。</p>
<p>或者是你认证成功了，进行下一步的绑卡订阅时，出现了无法订阅的情况。</p>
<p>但是这种情况的<strong>概率非常低</strong>，如果出现了，换新号就行，过几天后再回来看看，可能就恢复了。</p>
<h4 data-id="heading-4">第四种：循环资格</h4>
<p>还有一种情况，循环获取最新的Sheerid链接时，你出现了这个页面，并且你打开了 <code>goo.gle/freepro</code> 之后，点击获取优惠又掉到这个页面。</p>
<p>猜测是谷歌的BUG，出现了死循环了。<strong>你可以通过无痕浏览器重新登录账号测试看看。</strong></p>
<p>如果没有恢复，过几天再看看，或者弄个新号进行验证，因为它不一定会恢复。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/403c0a4855a6404b94856cbfab18265b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=BKXpJXHFQZ%2BGofPusTUd2PePB9I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53cd27933bcd482292b1f13f7a638ab0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=nan7ySMQhGWHKGCNVR1u96dZPDY%3D" alt="" loading="lazy"/></p>
<p>出现这种循环资格的根本原因是：<strong>谷歌不再给你账号分配认证的ID，也就是verificationId。</strong></p>
<p>不再下发ID，有一种猜测，可能是你的条款影响。就是你注册的账号时，归属地的活动可能结束了。</p>
<blockquote>
<p>查询谷歌账号注册地区：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpolicies.google.com%2Fterms" target="_blank" title="https://policies.google.com/terms" ref="nofollow noopener noreferrer">policies.google.com/terms</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f16ac2edd8641d9beb8e06cb09e8b27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=8SW%2FXrrBI5bQEmTb1ZztunarNoo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5"><strong>最后一种：有资格！</strong></h4>
<p>当你打开教育优惠认证的页面时，出现下图这种表格状态，就是有验证资格！</p>
<p>如果自己有教育邮箱，可以自己填写后进行SSO登录授权认证。</p>
<p>没有的话，可以看下面教程，可以通过 <strong>Sheerid一键认证系统</strong> 进行获取 1年的 Gemini Pro 会员。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/026886cdf6364be5afc86eb22cd0222e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=VduUgrYKZYZQa8ddXvRFDLEURvM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">二、如何通过Sheerid认证？</h2>
<p>看到这里的伙伴，大部分是有验证资格的，那么可以获取 Sheerid 链接进行认证。</p>
<p><strong>没有教育邮箱的话，也不用急，有专门的一键认证系统，请耐心看完教程！</strong></p>
<h4 data-id="heading-7">1、获取 Sheerid 链接：</h4>
<p>打开活动地址：<code>https://gemini.google/students/</code> 点击 <code>Get offer</code> 就可以进入到获取验证链接到页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a68cccdbc87f4944a94b81ad78e64724~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=km0og1IqWBgTVVLeaQfwISQyc%2Bg%3D" alt="" loading="lazy"/></p>
<p>点击 <code>verify eligibility</code> 或者 <code>验证资格</code> 之后就可以获取到一条 Sheerid 链接，它会自动打开一个新页面，也就是表格页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aebaf8a8d1246e9b3b40319845f4a76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=RHjXzM9jqP%2BGzmta8yrpyJBv9Hc%3D" alt="" loading="lazy"/></p>
<p>打开的页面，<strong>浏览器的导航里面的地址就是 Sheerid 链接！！！</strong>，这个链接带着谷歌分配好的 <code>verificationId</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56e07f27d3fc4fd7a108ebed6bfab9b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=Q39oT9pwV%2Fd8TMAscoyaZ45BSkE%3D" alt="" loading="lazy"/></p>
<p>复制这条链接，打开专门的 <strong>Sheerid 一键认证系统</strong> 粘贴进去即可。</p>
<blockquote>
<p><strong>Sheerid 一键认证系统</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsheerid-one.pages.dev" target="_blank" title="https://sheerid-one.pages.dev" ref="nofollow noopener noreferrer">sheerid-one.pages.dev</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12cc11576b54943b4daf10cd37d5d74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=11hPLajN5uUt6J3eaSCscn5LA7I%3D" alt="" loading="lazy"/></p>
<p>把你的 <strong>Sheerid 链接</strong> 粘贴进来，会自动识别当前的验证ID，点击提交之后，等待1～2分钟就完成认证。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ca2570a51fb48e88f17c132661febaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=Ay8EqetuIXQMa%2Bqi1U035F6oUIo%3D" alt="" loading="lazy"/></p>
<p>基本都能通过认证，只要认证成功了，回到sheerid链接页面，刷新一下页面，就可以看到自己的结果，基本同步。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a758c883d8f24d52b4b0e1e744a4a123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=zQUnBZWrW0H%2B%2B%2BpMchGJIJefUR4%3D" alt="" loading="lazy"/></p>
<p>认证成功之后，你回到你之前的页面，刷新之后就可以看到 <code>You've been verified</code> 的状态。</p>
<p>下一步就是点击 <code>Get Google AI Pro</code> 进行绑卡就可以完成订阅</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c359b743358547618fcce614cf7ca9ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=oGm5FjcxNjCFJO0mTxcXHBI587c%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">2、验证失败的几种情况</h4>
<p>有验证资格，也可能会碰到验证失败，但是验证失败可以重复验证。</p>
<p>如何避免验证失败的情况呢？基本的原因都是IP质量问题。</p>
<p>打开下面的地址，可以查询一些共享人数和IP属性，不一定准确，但是很有参考性：</p>
<blockquote>
<p><strong>IP质量检查：</strong> ping0.cc</p>
</blockquote>
<p>如果你的IP质量是比较差的，有欺诈性的，你获取链接的那一刻，谷歌就已经给你标记上了，你用系统怎么认证都无法通过的。</p>
<p><strong>那么你可以切换到：共享人数 1～10 人的，原生IP 就行。</strong></p>
<p><strong>切换之后，就可以重新获取的你sheerid链接！！！！</strong></p>
<blockquote>
<p>**获取最新链接的地址：**<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoo.gle%2Ffreepro" target="_blank" title="https://goo.gle/freepro" ref="nofollow noopener noreferrer">goo.gle/freepro</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4539312a1f574700bf95462389918d12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=WxXKZHvp8mvtA5Ww5PVHJPdo7wU%3D" alt="" loading="lazy"/></p>
<p><code>ping0.cc</code>不一定准确，你还可以通过<code>ipdata.co</code>来查看IP是否存在欺诈指标：</p>
<blockquote>
<p><strong>IP欺诈指标检查：</strong> ipdata.co</p>
</blockquote>
<p>你只需要关注这个 <code>THREATS</code> 指标就行，<strong>只要是 0 就正常</strong>，存在 1 或者 2 甚至更多，都是不行的。 （有概率可以）</p>
<p>你在<code>ping0.cc</code>检查之后，发现IP质量非常好，但是在<code>ipdata.co</code>存在欺诈指标，那么有可能无法通过。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ab8d2de0eb48018a05f8d549f0392b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=i8qGR82CdvpwP22qGbQVdrWlDCM%3D" alt="" loading="lazy"/></p>
<p>这两个检查站点都可以在平时使用时，进行参考检查自己的IP质量。</p>
<blockquote>
<p>当你觉得自己的IP没有问题时，重新在一些sheerid认证系统提交验证时，还出现失败的话，这个时候不要怀疑自己！
很可能是认证系统的问题，联系对应管理员帮你认证就行，基本都能通过～</p>
</blockquote>
<p><strong>当然，如果账号风控的话除外，基本要等待24小时之后，重新验证即可。</strong></p>
<h2 data-id="heading-9">三、 如何绑定卡完成领取1年的 Gemini Pro 会员？</h2>
<p>‼️ 终于通过了认证，认证成功之后，可以进行最后一步的绑卡领取！</p>
<p>这里不要去错地方，有个别伙伴，去错地方，造成领取了免费1个月的会员，一定要看清楚，再进行绑卡！<strong>我们的目标是12个月会员</strong>。</p>
<blockquote>
<p><strong>绑卡地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fone.google.com%2Fai-student" target="_blank" title="https://one.google.com/ai-student" ref="nofollow noopener noreferrer">one.google.com/ai-student</a></p>
</blockquote>
<p>你可以回到原来的界面进入，就可以看到按钮描述变为 <code>Get student offer</code> 或者 <code>领取学生优惠</code>，点击就会进行转圈圈，稍等一会就会出现绑卡页面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c1c32f66f93454f9b9e77a1194be89b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=EPmTrpZBe2i4q3PGA3lbM50Xhz8%3D" alt="" loading="lazy"/></p>
<p><strong>绑卡时，别着急！</strong> 不建议直接使用国内visa卡，有可能会关联到国内信息直接丢失资格！（80%的概率失去资格！）</p>
<p>如果你非要用国内visa卡尝试的话，请把账单地址改为 <code>美区</code>，然后<strong>邮编一定要填美区的免税区！</strong> 就不会扣款！ 可以0元绑卡完成领取12个月！</p>
<p>如果要避免丢失资格的话，建议用美区的visa卡。</p>
<p>绑卡页面，点击 <code>Add Card</code> 或者 <code>添加卡</code> 之后进行填写对应的卡信息，点击保存即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/941092cecd0c4d67b734a8bea37c1aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=5mHqdNT74wyGAAUhB6ytkzNdOBc%3D" alt="" loading="lazy"/></p>
<p>弹窗会自动关闭，然后等待一会，会再次弹出确认订阅的窗口，这里确保是12个月，并且免税的情况下，点击 <code>订阅</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46ba883300c543b6bd4694bbc48b41bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=4Dm7ASlm%2B5Ro%2FPmWHBUyqj%2FfB1k%3D" alt="" loading="lazy"/></p>
<p>等待几秒钟，就会完成订阅，你就可以看到下方的 <code>已订阅</code>。 恭喜你，到这里就已经完成啦</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b3682261fc54825a77f0aff1d564518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=TGK8j6j%2F%2FhqGJT9eI9GrD%2F5pKEg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c131f0bc18e049b7a2bf231cd7eae962~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=5FWIYLV8zLBVlkOqKHDOIC%2BSK1M%3D" alt="" loading="lazy"/></p>
<p>如果你是绑定了自己的卡片，为了避免明年的自动续费扣款，可以在订阅管理里面，进行取消自动续费。</p>
<p>**路径：**进入 Gemini 首页 -&gt; 设置  -&gt;  管理订阅  -&gt;  更改付款方式  -&gt;  管理  -&gt;  订阅。</p>
<p><strong>点击【取消订阅】，这里的取消订阅，是取消自动续费的意思！</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1c4e268615945729ade8bc770138d4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765538512&amp;x-signature=3p7cmi54pVYreWwMxuby%2FahBh1E%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【python大数据毕设实战】全面皮肤病症状数据可视化分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学]]></title>    <link>https://juejin.cn/post/7580196545287749686</link>    <guid>https://juejin.cn/post/7580196545287749686</guid>    <pubDate>2025-12-05T11:38:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580196545287749686" data-draft-id="7580184249908461610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【python大数据毕设实战】全面皮肤病症状数据可视化分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学"/> <meta itemprop="keywords" content="后端,Python,MySQL"/> <meta itemprop="datePublished" content="2025-12-05T11:38:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="计算机毕设匠心工作室"/> <meta itemprop="url" content="https://juejin.cn/user/2452372492400835"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【python大数据毕设实战】全面皮肤病症状数据可视化分析系统、Hadoop、计算机毕业设计、包括数据爬取、数据分析、数据可视化、机器学习、实战教学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2452372492400835/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    计算机毕设匠心工作室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T11:38:06.000Z" title="Fri Dec 05 2025 11:38:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍊作者：计算机毕设匠心工作室</p>
<p>🍊简介：毕业后就一直专业从事计算机软件程序开发，至今也有8年工作经验。擅长Java、Python、微信小程序、安卓、大数据、PHP、.NET|C#、Golang等。</p>
<p>擅长：按照需求定制化开发项目、 源码、对代码进行完整讲解、文档撰写、ppt制作。</p>
<p>🍊心愿：点赞 👍 收藏 ⭐评论 📝</p>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 ↓↓文末获取源码联系↓↓🍅</p>
</blockquote>
<h2 data-id="heading-0">基于大数据的全面皮肤病症状数据可视化分析系统-功能介绍</h2>
<p>本项目“【python大数据毕设实战】全面皮肤病症状数据可视化分析系统”是一个旨在运用前沿大数据技术对海量皮肤病医疗数据进行深度挖掘与直观展示的综合分析平台。系统以后端Python语言为核心，采用轻量高效的Django框架搭建Web服务，并深度融合了Hadoop与Spark分布式计算框架来应对海量数据的处理挑战。原始数据存储于MySQL数据库中，系统通过Spark SQL和强大的DataFrame API对包含患者年龄、性别、肤色、疾病类型、严重程度、病程、治疗历史等十多个维度的askin_disease_dataset.csv数据集进行高效清洗、转换与聚合分析。在数据处理层面，系统特别针对连续数值（如年龄、病程）进行智能分箱，并对有序分类变量（如严重程度）进行逻辑排序，确保了分析结果的科学性。最终，系统将16个核心分析维度的结果数据，通过API接口精准推送至前端。前端界面则基于Vue框架，结合ElementUI组件库与功能强大的Echarts可视化图表库，将复杂的数据关系以动态、交互式的图表形式呈现，为研究者提供了一站式的数据洞察与决策支持工具。</p>
<h2 data-id="heading-1">基于大数据的全面皮肤病症状数据可视化分析系统-选题背景意义</h2>
<p>选题背景
如今，皮肤病已经成为困扰相当一部分人群的常见健康问题，其种类繁多、成因复杂，传统的诊断与研究方式在很大程度上依赖于医生的个人经验，这其中难免会带有一些主观性。随着信息化技术的发展，大量的临床诊疗数据被记录下来，这些数据其实就像一个尚未被充分挖掘的宝库，里面隐藏着关于皮肤病发生、发展及治疗反应的深层规律。大家也知道，单纯依靠人力去梳理成千上万条病历记录，既耗时又费力，还容易出错。大数据技术的出现，正好为解决这个难题提供了全新的思路。本项目就是想在这方面做个小小的尝试，利用Hadoop和Spark这样成熟的分布式计算框架，去高效处理和分析皮肤病症状数据，希望能够从看似杂乱的数据中，发现一些以往难以察觉的关联性，为更科学的认知和研究皮肤病提供一种数据驱动的新视角。
选题意义
这个系统的实际意义，可以从几个层面来看。对于临床医生来说，系统通过多维度的可视化图表，比如不同年龄段高发的皮肤病类型、不同疾病在各身体部位的分布规律等，能够帮助他们快速建立起宏观的认知，辅助他们进行更精准的诊断。对于医学研究者，系统对治疗效果与病程、严重程度之间关系的深入分析，可能会为评估现有疗法或探索新治疗方案提供有价值的线索。虽然它只是个毕业设计，但至少提供了一个完整的技术验证，展示了如何将大数据技术真正应用于一个具体的医疗场景中。对于公共卫生领域，了解特定人群（如不同肤色）的疾病分布情况，有助于制定更具针对性的健康科普和预防策略。总的来说，本项目不仅是一次技术上的综合实践，更重要的是它搭建了一个连接数据与医学洞察的桥梁，其分析结果具备一定的参考价值。</p>
<h2 data-id="heading-2">基于大数据的全面皮肤病症状数据可视化分析系统-技术选型</h2>
<p>大数据框架：Hadoop+Spark（本次没用Hive，支持定制）
开发语言：Python+Java（两个版本都支持）
后端框架：Django+Spring Boot(Spring+SpringMVC+Mybatis)（两个版本都支持）
前端：Vue+ElementUI+Echarts+HTML+CSS+JavaScript+jQuery
详细技术点：Hadoop、HDFS、Spark、Spark SQL、Pandas、NumPy
数据库：MySQL</p>
<h2 data-id="heading-3">基于大数据的全面皮肤病症状数据可视化分析系统-图片展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1nK2LBtEkE%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1nK2LBtEkE/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">基于大数据的全面皮肤病症状数据可视化分析系统-图片展示</a></p>
<h2 data-id="heading-4">基于大数据的全面皮肤病症状数据可视化分析系统-图片展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36ba76cc852412e80be2563809c503c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=54XaDpqH9tH9fsyAgpDmpLR5ZSs%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c75dc1f3a0e4d05874dd781668d94c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=PSBsGAXs1QrLnQ19R03hRK7W%2FmQ%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3698e20bb3e9452ebec77a73a8d2fe82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=2voZ4rN0%2FE1ZRY7pJJtvSKXYjmM%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d27512768a244572a881d1df63be7712~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=BlcavfSvs0vu9AGqfktMhrGjhSQ%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5b6cdff112d486faea08f6ac4c341ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=XU2pbYVF%2FFdS7eve%2FDxBXJPqzF0%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59f5b1bdf61b491c850692e5922bf210~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=D7dqvtPaiEO8eU0SvJ3gd0mkObc%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71ff21418f194cb78d1678843d4a5d64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6h566X5py65q-V6K6-5Yyg5b-D5bel5L2c5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765539486&amp;x-signature=ykBgXnoljv9T7MASSEDy2ddWUVk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-5">基于大数据的全面皮肤病症状数据可视化分析系统-代码展示</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession, functions <span class="hljs-keyword">as</span> F, Window
spark = SparkSession.builder.appName(<span class="hljs-string">"SkinDiseaseAnalysis"</span>).getOrCreate()
df = spark.read.csv(<span class="hljs-string">"askin_disease_dataset.csv"</span>, header=<span class="hljs-literal">True</span>, inferSchema=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_age_distribution</span>(<span class="hljs-params">df</span>):
    age_grouped_df = df.withColumn(<span class="hljs-string">"age_group"</span>, F.when((F.col(<span class="hljs-string">"Age"</span>) &gt;= <span class="hljs-number">18</span>) &amp; (F.col(<span class="hljs-string">"Age"</span>) &lt;= <span class="hljs-number">40</span>), <span class="hljs-string">"青年(18-40岁)"</span>)
                                  .when((F.col(<span class="hljs-string">"Age"</span>) &gt;= <span class="hljs-number">41</span>) &amp; (F.col(<span class="hljs-string">"Age"</span>) &lt;= <span class="hljs-number">65</span>), <span class="hljs-string">"中年(41-65岁)"</span>)
                                  .when((F.col(<span class="hljs-string">"Age"</span>) &gt;= <span class="hljs-number">66</span>) &amp; (F.col(<span class="hljs-string">"Age"</span>) &lt;= <span class="hljs-number">90</span>), <span class="hljs-string">"老年(66-90岁)"</span>)
                                  .otherwise(<span class="hljs-string">"未知"</span>))
    result_df = age_grouped_df.<span class="hljs-built_in">filter</span>(F.col(<span class="hljs-string">"age_group"</span>) != <span class="hljs-string">"未知"</span>).groupBy(<span class="hljs-string">"age_group"</span>).agg(F.count(<span class="hljs-string">"Patient_ID"</span>).alias(<span class="hljs-string">"患病人数"</span>))
    result_df = result_df.orderBy(F.col(<span class="hljs-string">"age_group"</span>).asc())
    result_df.show()
    <span class="hljs-keyword">return</span> result_df

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_severity_by_disease</span>(<span class="hljs-params">df</span>):
    disease_severity_count = df.groupBy(<span class="hljs-string">"Disease_Type"</span>, <span class="hljs-string">"Severity"</span>).agg(F.count(<span class="hljs-string">"Patient_ID"</span>).alias(<span class="hljs-string">"count"</span>))
    window_spec = Window.partitionBy(<span class="hljs-string">"Disease_Type"</span>)
    disease_total = disease_severity_count.withColumn(<span class="hljs-string">"total_count"</span>, F.<span class="hljs-built_in">sum</span>(<span class="hljs-string">"count"</span>).over(window_spec))
    result_df = disease_total.withColumn(<span class="hljs-string">"percentage"</span>, F.format_number(F.col(<span class="hljs-string">"count"</span>) / F.col(<span class="hljs-string">"total_count"</span>) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>))
    result_df = result_df.select(<span class="hljs-string">"Disease_Type"</span>, <span class="hljs-string">"Severity"</span>, <span class="hljs-string">"count"</span>, <span class="hljs-string">"percentage"</span>)
    result_df = result_df.orderBy(F.col(<span class="hljs-string">"Disease_Type"</span>).asc(), F.col(<span class="hljs-string">"Severity"</span>).asc())
    result_df.show()
    <span class="hljs-keyword">return</span> result_df

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_duration_vs_effectiveness</span>(<span class="hljs-params">df</span>):
    treated_df = df.<span class="hljs-built_in">filter</span>(F.col(<span class="hljs-string">"Previous_Treatment"</span>) == <span class="hljs-string">"Yes"</span>)
    duration_grouped_df = treated_df.withColumn(<span class="hljs-string">"duration_group"</span>, F.when((F.col(<span class="hljs-string">"Duration"</span>) &gt;= <span class="hljs-number">1</span>) &amp; (F.col(<span class="hljs-string">"Duration"</span>) &lt;= <span class="hljs-number">6</span>), <span class="hljs-string">"短期(1-6月)"</span>)
                                                .when((F.col(<span class="hljs-string">"Duration"</span>) &gt;= <span class="hljs-number">7</span>) &amp; (F.col(<span class="hljs-string">"Duration"</span>) &lt;= <span class="hljs-number">24</span>), <span class="hljs-string">"中期(7-24月)"</span>)
                                                .when((F.col(<span class="hljs-string">"Duration"</span>) &gt; <span class="hljs-number">24</span>), <span class="hljs-string">"长期(&gt;24月)"</span>)
                                                .otherwise(<span class="hljs-string">"未知"</span>))
    valid_df = duration_grouped_df.<span class="hljs-built_in">filter</span>(F.col(<span class="hljs-string">"duration_group"</span>) != <span class="hljs-string">"未知"</span>)
    pivot_df = valid_df.groupBy(<span class="hljs-string">"duration_group"</span>).pivot(<span class="hljs-string">"Treatment_Effectiveness"</span>, [<span class="hljs-string">"Low"</span>, <span class="hljs-string">"Moderate"</span>, <span class="hljs-string">"High"</span>]).count().na.fill(<span class="hljs-number">0</span>)
    result_df = pivot_df.withColumn(<span class="hljs-string">"总计"</span>, F.col(<span class="hljs-string">"Low"</span>) + F.col(<span class="hljs-string">"Moderate"</span>) + F.col(<span class="hljs-string">"High"</span>))
    result_df = result_df.orderBy(F.col(<span class="hljs-string">"duration_group"</span>).asc())
    result_df.show()
    <span class="hljs-keyword">return</span> result_df
</code></pre>
<h2 data-id="heading-6">基于大数据的全面皮肤病症状数据可视化分析系统-结语</h2>
<blockquote>
<p>👇🏻 精彩专栏推荐订阅 👇🏻 不然下次找不到哟~</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754938.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754938.html" ref="nofollow noopener noreferrer">Java实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754940.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754940.html" ref="nofollow noopener noreferrer">Python实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754945.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754945.html" ref="nofollow noopener noreferrer">微信小程序|安卓实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754947.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754947.html" ref="nofollow noopener noreferrer">大数据实战项目</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2F2401_86677951%2Fcategory_12754949.html" target="_blank" title="https://blog.csdn.net/2401_86677951/category_12754949.html" ref="nofollow noopener noreferrer">PHP|C#.NET|Golang实战项目</a></p>
<p>🍅 主页获取源码联系🍅</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#异常概念与try-catch入门]]></title>    <link>https://juejin.cn/post/7580188321323237382</link>    <guid>https://juejin.cn/post/7580188321323237382</guid>    <pubDate>2025-12-05T11:40:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580188321323237382" data-draft-id="7577431644069412915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#异常概念与try-catch入门"/> <meta itemprop="keywords" content="前端,C#"/> <meta itemprop="datePublished" content="2025-12-05T11:40:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#异常概念与try-catch入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T11:40:55.000Z" title="Fri Dec 05 2025 11:40:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、什么是异常，我们为何需要它？</h2>
<h3 data-id="heading-1">1. 编程世界里的“意外”</h3>
<p>在C#中，异常是在程序执行期间发生的、中断了正常指令流的“反常”或“错误”事件。它不是我们通常所说的“BUG”（逻辑错误），比如你本想做加法却写了减法；也不是“语法错误”，那种在编译时就会被编译器指出的拼写错误。异常是<strong>运行时</strong>的错误，是程序在“活着”的时候遇到的突发状况。</p>
<p>常见的异常场景包括：</p>
<ul>
<li>尝试打开一个不存在的文件。</li>
<li>网络连接突然中断。</li>
<li>请求的内存过大，系统无法分配。</li>
<li>数组索引超出了范围。</li>
<li>尝试对一个 <code>null</code> 的对象进行操作。</li>
</ul>
<h3 data-id="heading-2">2. 异常的代价</h3>
<ul>
<li><strong>程序突然终止</strong>：这是最直接的后果。对于用户来说，这意味着他们正在进行的工作（比如编辑文档、填写表单）可能会瞬间丢失，体验极差。</li>
<li><strong>数据损坏</strong>：例如一个转账操作，在扣除A账户金额后、增加B账户金额前，程序因为一个异常而崩溃。这将导致账目不平，数据状态不一致。</li>
<li><strong>暴露敏感信息</strong>：在Web应用中，一个未处理的异常可能会将包含数据库连接字符串、服务器内部路径等敏感信息的完整错误堆栈信息（Stack Trace）暴露给最终用户，构成严重的安全隐患。</li>
<li><strong>资源泄露</strong>：如果程序在打开文件或数据库连接后，在关闭它们之前崩溃，这些宝贵的系统资源将无法被释放，久而久之会耗尽系统资源，导致整个系统变慢甚至瘫痪。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、try-catch块的基础语法与工作原理</h2>
<p><code>try-catch</code> 语句是C#中用于处理异常的基本工具。它的逻辑非常符合人类的直觉：“尝试做某件事，如果出了问题，就这样补救”。</p>
<h3 data-id="heading-4">1. <code>try</code> 块：划定“风险区”</h3>
<p><code>try</code> 关键字后面跟着一个代码块 <code>{}</code>，我们将所有<strong>可能抛出异常</strong>的代码都放在这个代码块里。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// 这里是“风险区”</span>
    Console.WriteLine(<span class="hljs-string">"请输入一个数字："</span>);
    <span class="hljs-built_in">int</span> number = <span class="hljs-built_in">int</span>.Parse(Console.ReadLine());
    <span class="hljs-built_in">int</span> result = <span class="hljs-number">100</span> / number;
    Console.WriteLine(<span class="hljs-string">$"100除以<span class="hljs-subst">{number}</span>的结果是：<span class="hljs-subst">{result}</span>"</span>);
} 
<span class="hljs-keyword">catch</span>(Exception e)
{
    Console.WriteLine(e.ToString()); 
}

</code></pre>
<p>在上面的代码中，<code>int.Parse()</code> 可能会因为用户输入非数字字符而抛出 <code>FormatException</code>，而 <code>100 / number</code> 可能会因为用户输入0而抛出 <code>DivideByZeroException</code>。</p>
<h3 data-id="heading-5">2. <code>catch</code> 块：部署“应急预案”</h3>
<p><code>catch</code> 关键字紧跟在 <code>try</code> 块之后，它也包含一个代码块。当 <code>try</code> 块中的任何一条语句抛出异常时，程序的正常执行流会立即中断，然后CLR（公共语言运行时）会寻找一个能够“接住”这个异常的 <code>catch</code> 块。</p>
<p><strong>最基本的 <code>catch</code> 块：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// ... 风险代码 ...</span>
}
<span class="hljs-keyword">catch</span>
{
    <span class="hljs-comment">// 异常发生时，执行这里的代码</span>
    Console.WriteLine(<span class="hljs-string">"发生了一个未知错误！"</span>);
}
</code></pre>
<p>这种不带任何参数的 <code>catch</code> 块可以捕获<strong>任何类型</strong>的异常，但它有一个巨大的缺点：你不知道具体发生了什么错误。这就像一个消防员赶到现场只知道“着火了”，却不知道是电线起火还是厨房起火，无法采取针对性的灭火措施。</p>
<h3 data-id="heading-6">3. 捕获具体的异常信息：<code>catch (ExceptionType ex)</code></h3>
<p>C#允许我们在 <code>catch</code> 后面指定要捕获的异常类型，并提供一个变量来接收这个异常对象。</p>
<p><code>System.Exception</code> 是所有异常类型的基类。因此，<code>catch (Exception ex)</code> 可以捕获几乎所有类型的异常，并且通过变量 <code>ex</code>，我们可以访问到关于异常的宝贵信息。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span>
{
    Console.WriteLine(<span class="hljs-string">"请输入一个数组索引（0-2）："</span>);
    <span class="hljs-built_in">int</span>[] numbers = { <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span> };
    <span class="hljs-built_in">int</span> index = <span class="hljs-built_in">int</span>.Parse(Console.ReadLine());
    Console.WriteLine(<span class="hljs-string">$"索引 <span class="hljs-subst">{index}</span> 上的值为: <span class="hljs-subst">{numbers[index]}</span>"</span>);
}
<span class="hljs-keyword">catch</span> (Exception ex)
{
    Console.WriteLine(<span class="hljs-string">"\n--- 程序出现问题！---"</span>);
    Console.WriteLine(<span class="hljs-string">$"错误类型: <span class="hljs-subst">{ex.GetType().Name}</span>"</span>); <span class="hljs-comment">// 获取异常的具体类型名</span>
    Console.WriteLine(<span class="hljs-string">$"错误信息: <span class="hljs-subst">{ex.Message}</span>"</span>);        <span class="hljs-comment">// 获取异常的描述信息</span>
    Console.WriteLine(<span class="hljs-string">"--- 详细堆栈跟踪 ---"</span>);
    Console.WriteLine(ex.StackTrace);                  <span class="hljs-comment">// 获取异常发生时的调用堆栈</span>
    Console.WriteLine(<span class="hljs-string">"----------------------"</span>);
}

Console.WriteLine(<span class="hljs-string">"\n程序已通过异常处理，继续执行..."</span>);
</code></pre>
<hr/>
<h2 data-id="heading-7">三、玩转多<code>catch</code>块与异常层次结构</h2>
<h3 data-id="heading-8">1. 多<code>catch</code>块进行细分异常</h3>
<p>一个 <code>try</code> 块后面可以跟多个 <code>catch</code> 块，每个 <code>catch</code> 块负责处理一种特定类型的异常。CLR在匹配 <code>catch</code> 块时，会<strong>从上到下</strong>依次检查，并执行<strong>第一个</strong>能够匹配异常类型的 <code>catch</code> 块。</p>
<p>“匹配”的规则是：如果抛出的异常类型<strong>是</strong> <code>catch</code> 块中声明的类型，或者<strong>是其子类</strong>，则匹配成功。</p>
<p>这就引出了多<code>catch</code>块最重要的规则：<strong><code>catch</code> 块的顺序必须是从最具体（子类）到最通用（父类）。</strong></p>
<p><strong>示例：一个健壮的文件读取操作</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ProcessFile</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> filePath</span>)</span>
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-built_in">string</span> content = System.IO.File.ReadAllText(filePath);
        Console.WriteLine(<span class="hljs-string">"文件内容处理成功！"</span>);
    }
    <span class="hljs-keyword">catch</span> (System.IO.FileNotFoundException ex) <span class="hljs-comment">// 最具体的异常</span>
    {
        Console.WriteLine(<span class="hljs-string">$"错误：文件 '<span class="hljs-subst">{filePath}</span>' 不存在。请检查路径是否正确。"</span>);
    }
    <span class="hljs-keyword">catch</span> (System.UnauthorizedAccessException ex) <span class="hljs-comment">// 另一个具体的异常</span>
    {
        Console.WriteLine(<span class="hljs-string">$"错误：程序没有权限访问文件 '<span class="hljs-subst">{filePath}</span>'。"</span>);
    }
    <span class="hljs-keyword">catch</span> (System.IO.IOException ex) <span class="hljs-comment">// 捕获其他所有IO相关的异常</span>
    {
        Console.WriteLine(<span class="hljs-string">$"读取文件时发生 I/O 错误: <span class="hljs-subst">{ex.Message}</span>"</span>);
    }
    <span class="hljs-keyword">catch</span> (Exception ex) <span class="hljs-comment">// 最后的“万能捕手”，捕获所有其他意想不到的异常</span>
    {
        Console.WriteLine(<span class="hljs-string">$"发生未知错误，请联系技术支持。"</span>);
        <span class="hljs-comment">// 在真实应用中，这里应该记录完整的ex.ToString()到日志文件</span>
        <span class="hljs-comment">// Log.Error(ex.ToString()); </span>
    }
}
</code></pre>
<p><strong>分析：</strong></p>
<ul>
<li>如果文件不存在，第一个 <code>catch (FileNotFoundException)</code> 会被执行。</li>
<li>如果文件存在但程序没有读取权限，第二个 <code>catch (UnauthorizedAccessException)</code> 会被执行。</li>
<li>如果发生其他I/O错误（如磁盘已满），由于这些错误类型（如<code>DiskFullException</code>）通常继承自 <code>IOException</code>，第三个 <code>catch</code> 块会被执行。</li>
<li>如果发生了完全无关的错误（比如在后续处理中出现 <code>OutOfMemoryException</code>），最后的 <code>catch (Exception)</code> 会作为兜底防线被触发。</li>
</ul>
<p>如果你把 <code>catch (Exception ex)</code> 放在最前面，那么它会捕获所有异常，后面的具体 <code>catch</code> 块将永远没有机会执行，编译器甚至会因此报错。</p>
<h3 data-id="heading-9">2. 警惕空<code>catch</code>块和“吞噬”异常</h3>
<p>有时候，你可能会看到这样的代码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 警告：极度危险的代码！</span>
<span class="hljs-keyword">try</span>
{
    SomeRiskyOperation();
}
<span class="hljs-keyword">catch</span> (Exception)
{
    <span class="hljs-comment">// 什么也不做</span>
}
</code></pre>
<p>这被称为“吞噬异常”或“异常黑洞”。代码的作者可能认为“我知道这里可能出错，但我不关心”。这是一个极其危险的坏习惯！</p>
<p><strong>为什么危险？</strong></p>
<ol>
<li><strong>隐藏问题</strong>：一个严重的问题（比如数据库连接失败）发生了，但程序假装什么都没发生，继续往下执行。这很可能导致后续代码在错误的数据基础上运行，引发更隐蔽、更难以调试的错误，甚至导致数据永久性损坏。</li>
<li><strong>调试噩梦</strong>：当程序出现奇怪的行为时，你将没有任何线索。没有日志，没有崩溃报告，错误就像人间蒸发了一样。</li>
</ol>
<p><strong>正确的做法是</strong>：即使你认为可以从某个异常中恢复，也至少应该<strong>记录它</strong>。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// ...</span>
}
<span class="hljs-keyword">catch</span> (SomeExpectedAndRecoverableException ex)
{
    <span class="hljs-comment">// 记录下来，以备后续分析</span>
    Log.Warning(<span class="hljs-string">$"一个可恢复的错误发生了: <span class="hljs-subst">{ex.Message}</span>"</span>); 
    <span class="hljs-comment">// 然后执行恢复逻辑</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-10">3. <code>TryParse</code> vs. <code>try-catch</code>**</h3>
<p>考虑一个场景：验证用户输入的字符串是否为有效的整数。我们有两种方法：</p>
<p><strong>方法A: LBYL (Look Before You Leap) - 先看后跳</strong>
使用 <code>int.TryParse</code> 进行预检查。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> input = Console.ReadLine();
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">int</span>.TryParse(input, <span class="hljs-keyword">out</span> <span class="hljs-built_in">int</span> number))
{
    <span class="hljs-comment">// 成功，使用 number</span>
    Console.WriteLine(<span class="hljs-string">$"你输入的数字是: <span class="hljs-subst">{number}</span>"</span>);
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-comment">// 失败，处理无效输入</span>
    Console.WriteLine(<span class="hljs-string">"无效的输入，请输入一个整数。"</span>);
}
</code></pre>
<p><strong>方法B: EAFP (It's Easier to Ask for Forgiveness than Permission) - 先做后问</strong>
直接尝试转换，用 <code>try-catch</code> 处理失败情况。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span> input = Console.ReadLine();
<span class="hljs-keyword">try</span>
{
    <span class="hljs-built_in">int</span> number = <span class="hljs-built_in">int</span>.Parse(input);
    <span class="hljs-comment">// 成功，使用 number</span>
    Console.WriteLine(<span class="hljs-string">$"你输入的数字是: <span class="hljs-subst">{number}</span>"</span>);
}
<span class="hljs-keyword">catch</span> (FormatException)
{
    <span class="hljs-comment">// 失败，处理无效输入</span>
    Console.WriteLine(<span class="hljs-string">"无效的输入，请输入一个整数。"</span>);
}
</code></pre>
<p><strong>如何选择？</strong></p>
<ol>
<li><strong>性能</strong>：<strong>抛出和捕获异常是一个非常昂贵的操作</strong>。CLR需要保存当前执行状态，展开调用堆栈，搜索 <code>catch</code> 块等，这比一个简单的 <code>if-else</code> 判断要慢得多。因此，在性能敏感的代码或错误是“可预期的常规事件”（比如用户输入错误）时，<strong><code>TryParse</code> 模式是首选</strong>。</li>
<li><strong>代码清晰度</strong>：<code>TryParse</code> 明确地表达了“我正在尝试转换，并检查其结果”的意图，逻辑清晰。而使用 <code>try-catch</code> 来控制正常的程序流程，则被认为是一种反模式（anti-pattern），因为它混淆了“真正的异常情况”和“正常的逻辑分支”。</li>
<li><strong>适用场景</strong>：
<ul>
<li><strong>使用 <code>TryParse</code></strong>：当失败是常见且可预期的分支时（如用户输入验证、检查字典中是否存在键）。</li>
<li><strong>使用 <code>try-catch</code></strong>：当失败是真正“异常”的、不希望发生的情况时（如文件损坏、网络断开、磁盘已满）。</li>
</ul>
</li>
</ol>
<p><strong>结论：不要用异常来控制程序流程。异常处理是为意外准备的，不是为日常准备的。</strong></p>
<hr/>
<h2 data-id="heading-11">结语</h2>
<p><strong>点个赞，关注我获取更多实用 C# 技术干货！如果觉得有用，记得收藏本文</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浏览器指纹识别：从原理到防护的完整指南]]></title>    <link>https://juejin.cn/post/7579985751938613282</link>    <guid>https://juejin.cn/post/7579985751938613282</guid>    <pubDate>2025-12-05T10:24:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579985751938613282" data-draft-id="7579985751938580514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浏览器指纹识别：从原理到防护的完整指南"/> <meta itemprop="keywords" content="前端,浏览器"/> <meta itemprop="datePublished" content="2025-12-05T10:24:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Keely40285"/> <meta itemprop="url" content="https://juejin.cn/user/2594503171249997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浏览器指纹识别：从原理到防护的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2594503171249997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Keely40285
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T10:24:04.000Z" title="Fri Dec 05 2025 10:24:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">浏览器指纹识别：从原理到防护的完整指南</h2>
<h3 data-id="heading-1">什么是浏览器指纹？</h3>
<p>浏览器指纹（Browser Fingerprinting）是一种通过收集用户浏览器和设备的特征信息，生成唯一标识符的技术。即使用户清除 Cookie 和缓存，这个"数字身份证"也能识别出同一用户。</p>
<h4 data-id="heading-2">核心概念</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简化示例：浏览器指纹的基本构成</span>
<span class="hljs-keyword">const</span> browserFingerprint = {
  <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>,
  <span class="hljs-attr">language</span>: navigator.<span class="hljs-property">language</span>,
  <span class="hljs-attr">platform</span>: navigator.<span class="hljs-property">platform</span>,
  <span class="hljs-attr">hardwareConcurrency</span>: navigator.<span class="hljs-property">hardwareConcurrency</span>,
  <span class="hljs-attr">deviceMemory</span>: navigator.<span class="hljs-property">deviceMemory</span>,
  <span class="hljs-attr">screenResolution</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.screen.width}</span>x<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.screen.height}</span>`</span>,
  <span class="hljs-attr">timezone</span>: <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>().<span class="hljs-title function_">resolvedOptions</span>().<span class="hljs-property">timeZone</span>,
  <span class="hljs-attr">canvas</span>: <span class="hljs-title function_">getCanvasFingerprint</span>(),
  <span class="hljs-attr">webgl</span>: <span class="hljs-title function_">getWebGLFingerprint</span>()
};
</code></pre>
<h3 data-id="heading-3">浏览器指纹的组成部分</h3>
<h4 data-id="heading-4">1. <strong>基础属性</strong> （易变性：低）</h4>
<ul>
<li>User-Agent 字符串</li>
<li>浏览器版本和类型</li>
<li>操作系统信息</li>
<li>系统语言和地区设置</li>
</ul>
<h4 data-id="heading-5">2. <strong>硬件信息</strong> （易变性：极低）</h4>
<ul>
<li>CPU 核心数（<code>navigator.hardwareConcurrency</code>）</li>
<li>设备内存大小（<code>navigator.deviceMemory</code>）</li>
<li>屏幕分辨率和 DPI</li>
<li>GPU 信息</li>
</ul>
<h4 data-id="heading-6">3. <strong>高熵属性</strong> （易变性：中等）</h4>
<ul>
<li>Canvas 指纹</li>
<li>WebGL 指纹</li>
<li>字体列表</li>
<li>插件列表</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Canvas 指纹示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCanvasFingerprint</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'canvas'</span>);
  <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
  ctx.<span class="hljs-property">textBaseline</span> = <span class="hljs-string">'top'</span>;
  ctx.<span class="hljs-property">font</span> = <span class="hljs-string">'14px Arial'</span>;
  ctx.<span class="hljs-property">textBaseline</span> = <span class="hljs-string">'alphabetic'</span>;
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#f60'</span>;
  ctx.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">125</span>, <span class="hljs-number">1</span>, <span class="hljs-number">62</span>, <span class="hljs-number">20</span>);
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#069'</span>;
  ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'浏览器指纹测试'</span>, <span class="hljs-number">2</span>, <span class="hljs-number">15</span>);
  ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'rgba(102, 204, 0, 0.7)'</span>;
  ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">'浏览器指纹测试'</span>, <span class="hljs-number">4</span>, <span class="hljs-number">17</span>);
  <span class="hljs-keyword">return</span> canvas.<span class="hljs-title function_">toDataURL</span>();
}
</code></pre>
<h4 data-id="heading-7">4. <strong>行为特征</strong> （易变性：高）</h4>
<ul>
<li>鼠标移动模式</li>
<li>键盘敲击习惯</li>
<li>触摸屏压力信息</li>
<li>设备方向传感器</li>
</ul>
<h3 data-id="heading-8">指纹识别的原理</h3>
<h4 data-id="heading-9">信息熵理论</h4>
<p>浏览器指纹依赖于<strong>信息熵</strong>的概念。每个特征都有一定的"区分度"：</p>






























<table><thead><tr><th>特征</th><th>区分度</th><th>说明</th></tr></thead><tbody><tr><td>User-Agent</td><td>中</td><td>常见的几十种组合</td></tr><tr><td>屏幕分辨率</td><td>中</td><td>几百种常见分辨率</td></tr><tr><td>Canvas 指纹</td><td>高</td><td>字体渲染差异导致不同的位图</td></tr><tr><td>WebGL + Canvas</td><td>极高</td><td>综合多个因素，组合数极大</td></tr></tbody></table>
<h4 data-id="heading-10">综合指纹生成</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 FingerprintJS 库的概念</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateBrowserFingerprint</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> components = {
    <span class="hljs-comment">// 基础信息</span>
    <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>,
    <span class="hljs-attr">language</span>: navigator.<span class="hljs-property">language</span>,
    
    <span class="hljs-comment">// 硬件信息</span>
    <span class="hljs-attr">hardwareConcurrency</span>: navigator.<span class="hljs-property">hardwareConcurrency</span>,
    <span class="hljs-attr">deviceMemory</span>: navigator.<span class="hljs-property">deviceMemory</span>,
    <span class="hljs-attr">maxTouchPoints</span>: navigator.<span class="hljs-property">maxTouchPoints</span>,
    
    <span class="hljs-comment">// Canvas 指纹</span>
    <span class="hljs-attr">canvas</span>: <span class="hljs-title function_">getCanvasFingerprint</span>(),
    
    <span class="hljs-comment">// WebGL 指纹</span>
    <span class="hljs-attr">webgl</span>: <span class="hljs-title function_">getWebGLInfo</span>(),
    
    <span class="hljs-comment">// 时区</span>
    <span class="hljs-attr">timezone</span>: <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>().<span class="hljs-title function_">resolvedOptions</span>().<span class="hljs-property">timeZone</span>,
    
    <span class="hljs-comment">// 字体检测</span>
    <span class="hljs-attr">fonts</span>: <span class="hljs-title function_">detectInstalledFonts</span>(),
    
    <span class="hljs-comment">// 插件信息</span>
    <span class="hljs-attr">plugins</span>: <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(navigator.<span class="hljs-property">plugins</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span>)
  };
  
  <span class="hljs-comment">// 转换为哈希值</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">hashObject</span>(components);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hashObject</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">const</span> str = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj);
  <span class="hljs-comment">// 使用 SubtleCrypto 或其他哈希算法</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">simpleHash</span>(str);
}
</code></pre>
<h3 data-id="heading-11">指纹识别的应用场景</h3>
<h4 data-id="heading-12">✅ 合法应用</h4>
<ol>
<li>
<p><strong>反欺诈和风险管理</strong></p>
<ul>
<li>检测账户接管（Account Takeover）</li>
<li>识别高风险交易</li>
</ul>
</li>
<li>
<p><strong>安全认证</strong></p>
<ul>
<li>多因素认证（MFA）的补充手段</li>
<li>设备绑定</li>
</ul>
</li>
<li>
<p><strong>用户体验优化</strong></p>
<ul>
<li>记住用户偏好设置</li>
<li>加载优化的资源版本</li>
</ul>
</li>
<li>
<p><strong>分析和统计</strong></p>
<ul>
<li>了解用户设备分布</li>
<li>兼容性测试</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">⚠️ 有争议的应用</h4>
<ol>
<li>
<p><strong>用户追踪</strong></p>
<ul>
<li>跨域追踪用户行为</li>
<li>广告投放和重定向</li>
</ul>
</li>
<li>
<p><strong>隐私侵犯</strong></p>
<ul>
<li>在用户不知情的情况下识别身份</li>
<li>数据买卖</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">防护措施</h3>
<h4 data-id="heading-15">1. <strong>浏览器层面</strong></h4>
<h5 data-id="heading-16">Chromium 系列</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 启用隐私浏览模式</span>
<span class="hljs-comment">// 使用 Incognito 模式减少指纹特征的稳定性</span>
</code></pre>
<h5 data-id="heading-17">Firefox</h5>
<ul>
<li>启用"防止追踪"功能</li>
<li>配置 <code>privacy.resistFingerprinting = true</code></li>
<li>结合 uBlock Origin 等广告拦截器</li>
</ul>
<h5 data-id="heading-18">Safari</h5>
<ul>
<li>启用"智能防追踪"（Intelligent Tracking Prevention）</li>
<li>限制跨域脚本访问敏感信息</li>
</ul>
<h4 data-id="heading-19">2. <strong>个人防护技巧</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 使用代理或 VPN 改变 IP</span>
<span class="hljs-comment">// 2. 定期清除浏览器数据</span>
<span class="hljs-comment">// 3. 使用浏览器扩展混淆指纹</span>

<span class="hljs-comment">// 示例：Canvas 指纹混淆</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforecreatecanvas'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-comment">// 注入虚假的 Canvas 数据</span>
  e.<span class="hljs-property">detail</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'rgba(random, random, random)'</span>;
});

<span class="hljs-comment">// 4. 禁用 JavaScript（激进做法，影响网站功能）</span>
<span class="hljs-comment">// 5. 使用 Tor 浏览器（完整的指纹隐藏）</span>
</code></pre>
<h4 data-id="heading-20">3. <strong>开发者责任</strong></h4>
<p>作为开发者，我们应该：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ DO: 明确告知用户</span>
<span class="hljs-comment">// 在隐私政策中声明使用浏览器指纹的目的</span>

<span class="hljs-comment">// ❌ DON'T: 暗中收集指纹用于追踪</span>
<span class="hljs-comment">// 避免在用户不知情的情况下识别身份</span>

<span class="hljs-comment">// ✅ DO: 使用合规工具</span>
<span class="hljs-comment">// 如果需要设备识别，优先使用 First-Party Data</span>
<span class="hljs-comment">// 而不是跨域指纹追踪</span>
</code></pre>
<h3 data-id="heading-21">业界现状和趋势</h3>
<h4 data-id="heading-22">隐私保护的进展</h4>
<ol>
<li>
<p><strong>标准化努力</strong></p>
<ul>
<li>W3C 的隐私社群小组（Privacy Community Group）</li>
<li>IETF 的指纹识别防护工作</li>
</ul>
</li>
<li>
<p><strong>浏览器更新</strong></p>
<ul>
<li>Chrome 计划限制高熵属性访问</li>
<li>Safari 已强制启用防追踪</li>
<li>Firefox 推进 RFP（Resist Fingerprinting）</li>
</ul>
</li>
<li>
<p><strong>替代方案</strong></p>
<ul>
<li>Topics API（Google 隐私沙箱）</li>
<li>Federated Learning of Cohorts（已废弃）</li>
<li>回到 First-Party Cookies</li>
</ul>
</li>
</ol>
<h4 data-id="heading-23">指纹识别的未来</h4>
<pre><code class="hljs language-markdown" lang="markdown">指纹识别能力 ──→ 逐步被限制（跨域）
<span class="hljs-code">                  ↓
      第一方数据 + 首方 Cookie ──→ 主流方案
                  ↓
        隐私保护与商业平衡
</span></code></pre>
<h3 data-id="heading-24">实践工具和资源</h3>
<h4 data-id="heading-25">检测指纹的开源库</h4>





















<table><thead><tr><th>库</th><th>特点</th></tr></thead><tbody><tr><td>FingerprintJS</td><td>功能全面，商业支持</td></tr><tr><td>BrowserLeaks</td><td>检测工具，可视化结果</td></tr><tr><td>Panopticlick</td><td>EFF 开发，教育用途</td></tr></tbody></table>
<h4 data-id="heading-26">在线测试</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 访问以下网站查看你的指纹信息</span>
https://browserleaks.com/
https://panopticlick.eff.org/
https://whatruns.com/
</code></pre>
<h3 data-id="heading-27">总结</h3>
<p>浏览器指纹是一把"双刃剑"：</p>

























<table><thead><tr><th>维度</th><th>评价</th></tr></thead><tbody><tr><td><strong>安全性</strong></td><td>✅ 有助于反欺诈</td></tr><tr><td><strong>隐私性</strong></td><td>❌ 容易被滥用追踪</td></tr><tr><td><strong>可靠性</strong></td><td>⚠️ 易变性高，不稳定</td></tr><tr><td><strong>用户体验</strong></td><td>⚠️ 可能影响合法用户</td></tr></tbody></table>
<p><strong>建议</strong>：</p>
<ul>
<li>作为用户：提高隐私意识，使用隐私工具</li>
<li>作为开发者：透明声明，负责任使用</li>
<li>作为平台：支持隐私标准，提供用户控制</li>
</ul>
<hr/>
<h3 data-id="heading-28">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2Fcommunity%2Fprivacycg%2F" target="_blank" title="https://www.w3.org/community/privacycg/" ref="nofollow noopener noreferrer">W3C Privacy Community Group</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.eff.org%2F" target="_blank" title="https://www.eff.org/" ref="nofollow noopener noreferrer">EFF 的浏览器隐私研究</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffingerprint.com%2Fjs%2F" target="_blank" title="https://fingerprint.com/js/" ref="nofollow noopener noreferrer">FingerprintJS 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fowasp.org%2F" target="_blank" title="https://owasp.org/" ref="nofollow noopener noreferrer">OWASP 指纹识别防护指南</a></li>
</ul>
<p><strong>想深入学习？</strong> 留言讨论你的观点和实践经验！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端文本分割工具，“他”来了]]></title>    <link>https://juejin.cn/post/7579995569689919522</link>    <guid>https://juejin.cn/post/7579995569689919522</guid>    <pubDate>2025-12-05T10:24:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579995569689919522" data-draft-id="7579995569689903138" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端文本分割工具，“他”来了"/> <meta itemprop="keywords" content="前端,JavaScript,程序员"/> <meta itemprop="datePublished" content="2025-12-05T10:24:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CC码码"/> <meta itemprop="url" content="https://juejin.cn/user/3800389147179720"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端文本分割工具，“他”来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3800389147179720/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CC码码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T10:24:28.000Z" title="Fri Dec 05 2025 10:24:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是CC，在这里欢迎大家的到来～</p>
<h2 data-id="heading-0">简介</h2>
<p>在日常开发场景中大多数是使用空字符串、空格或者换行符来进行文本分割。现在可以试试新的分割工具-<strong>Intl.Segmenter</strong>。</p>
<p><strong>Intl.Segmenter</strong> 支持根据语言进行的文本分割，将一个字符串分割成片段，分割类型包括字、词和句。</p>
<h2 data-id="heading-1">试试分割效果</h2>
<p>以简体中文为例，这里我们先设置按照词（word）分割：</p>
<h3 data-id="heading-2">按词分割-多语言分词</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> segmenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Segmenter</span>(<span class="hljs-string">"zh-Hans-CN"</span>, { <span class="hljs-attr">granularity</span>: <span class="hljs-string">"word"</span> });
<span class="hljs-keyword">const</span> string = <span class="hljs-string">"前端文本分割工具，“他”来了"</span>;

<span class="hljs-keyword">const</span> iterator = segmenter.<span class="hljs-title function_">segment</span>(string)[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]();

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> iterator) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item.<span class="hljs-property">segment</span>);
}
<span class="hljs-comment">// 前端</span>
<span class="hljs-comment">// 文本</span>
<span class="hljs-comment">// 分割</span>
<span class="hljs-comment">// 工具</span>
<span class="hljs-comment">// ，</span>
<span class="hljs-comment">// “</span>
<span class="hljs-comment">// 他</span>
<span class="hljs-comment">// ”</span>
<span class="hljs-comment">// 来</span>
<span class="hljs-comment">// 了</span>
</code></pre>
<p>效果还不错，有点类似词义分割了。再看看其他分割方式。</p>
<h3 data-id="heading-3">按字分割（默认）-处理复杂字符</h3>
<p>在简体中文场景下效果与<code>'前端文本分割工具，“他”来了'.split("")</code>相同。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> segmenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Segmenter</span>(<span class="hljs-string">"zh-Hans-CN"</span>, { <span class="hljs-attr">granularity</span>: <span class="hljs-string">"grapheme"</span> });
<span class="hljs-keyword">const</span> string = <span class="hljs-string">"前端文本分割工具，“他”来了"</span>;

<span class="hljs-keyword">const</span> iterator = segmenter.<span class="hljs-title function_">segment</span>(string)[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]();

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> iterator) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item.<span class="hljs-property">segment</span>);
}
<span class="hljs-comment">// 前</span>
<span class="hljs-comment">// 端</span>
<span class="hljs-comment">// 文</span>
<span class="hljs-comment">// 本</span>
<span class="hljs-comment">// 分</span>
<span class="hljs-comment">// 割</span>
<span class="hljs-comment">// 工</span>
<span class="hljs-comment">// 具</span>
<span class="hljs-comment">// ，</span>
<span class="hljs-comment">// “</span>
<span class="hljs-comment">// 他</span>
<span class="hljs-comment">// ”</span>
<span class="hljs-comment">// 来</span>
<span class="hljs-comment">// 了</span>
</code></pre>
<h3 data-id="heading-4">按句分割-多语言句子分析</h3>
<p>加了分号、感叹号、问号、句号这些标点符号，还是可以完整分割出来的。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> segmenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Segmenter</span>(<span class="hljs-string">"zh-Hans-CN"</span>, { <span class="hljs-attr">granularity</span>: <span class="hljs-string">"sentence"</span> });
<span class="hljs-keyword">const</span> string = <span class="hljs-string">"前端文本分割工具，“他”来了，前端文本分割工具，“他”来了；前端文本分割工具，“他”来了。前端文本分割工具，“他”来了，前端文本分割工具，“他”来了；前端文本分割工具，“他”来了！前端文本分割工具，“他”来了，前端文本分割工具，“他”来了；前端文本分割工具，“他”来了？"</span>;

<span class="hljs-keyword">const</span> iterator = segmenter.<span class="hljs-title function_">segment</span>(string)[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]();

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> item <span class="hljs-keyword">of</span> iterator) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item.<span class="hljs-property">segment</span>);
}
<span class="hljs-comment">// 前端文本分割工具，“他”来了，前端文本分割工具，“他”来了；前端文本分割工具，“他”来了。</span>
<span class="hljs-comment">// 前端文本分割工具，“他”来了，前端文本分割工具，“他”来了；前端文本分割工具，“他”来了！</span>
<span class="hljs-comment">// 前端文本分割工具，“他”来了，前端文本分割工具，“他”来了；前端文本分割工具，“他”来了？</span>
</code></pre>
<h3 data-id="heading-5">完整数据格式</h3>
<p>实际上分割出来的每个单位都是一个 JSON 对象，除了 segment 代表文本内容外，还有 index 代表索引、input 表示原文本完整内容、isWordLike 表示是否像文本单词（如果是标点符号类型的就会是 <code>false</code>）。</p>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-string">"segment"</span>: <span class="hljs-string">"前端"</span>,
    <span class="hljs-string">"index"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"input"</span>: <span class="hljs-string">"前端文本分割工具，“他”来了"</span>,
    <span class="hljs-string">"isWordLike"</span>: <span class="hljs-literal">true</span>
}
</code></pre>
<h2 data-id="heading-6">分割的参数</h2>
<h3 data-id="heading-7">locales</h3>
<p>当然除了简体中文，<strong>Intl.Segmenter</strong> 也支持其他语言。</p>
<p><strong>Intl.Segmenter</strong> 的第一个参数 <code>locales</code> 支持填写带有 BCP 47 语言区域标记的一个字符串，或者一个这样的字符串数组。</p>
<p>在 BCP 47 中表示语言、脚本、国家（区域）和变体（少用）的语言子标记含义可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.iana.org%2Fassignments%2Flanguage-subtag-registry%2Flanguage-subtag-registry" target="_blank" title="https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry" ref="nofollow noopener noreferrer"><strong>IANA 语言子标记注册</strong></a> 中找到。</p>
<h3 data-id="heading-8">localeMatcher</h3>
<p><strong>Intl.Segmenter</strong> 的第二个参数中除了可以选择如何分割外，还可以根据 ****<code>locales</code> ****在 ****<code>lookup</code> ****和 ****<code>best fit</code> ****之间选择一个匹配算法来配置 <strong>localeMatcher</strong> 参数。</p>
<h4 data-id="heading-9">best fit</h4>
<p>默认值，运行时可能会选择一个可能比查找算法的结果更加合适的语言区域。</p>
<h4 data-id="heading-10">lookup</h4>
<p>使用 BCP47 查找算法从 <code>locales</code> 参数中选择语言区域。像如果运行时支持 <code>"de"</code> 但不支持 <code>"de-CH"</code>，用户传入的 <code>"de-CH"</code> 可能就会以 <code>"de"</code> 为结果进行使用。</p>
<h2 data-id="heading-11">分割对象的方法</h2>
<h3 data-id="heading-12">分割字符串</h3>
<p>上文中对分割文本对象进行分割的 <code>segment</code> 方法。</p>
<h3 data-id="heading-13">判断返回支持的 locale</h3>
<p>在给定的 <strong>locales</strong> 数组中判断出 <code>Segmenter</code>支持的 <code>locales</code>。但是可能每个浏览器支持的不大一样。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> locales = [<span class="hljs-string">"ban"</span>, <span class="hljs-string">"id-u-co-pinyin"</span>, <span class="hljs-string">"de-ID"</span>];
<span class="hljs-keyword">const</span> options = { <span class="hljs-attr">localeMatcher</span>: <span class="hljs-string">"lookup"</span> };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Intl</span>.<span class="hljs-property">Segmenter</span>.<span class="hljs-title function_">supportedLocalesOf</span>(locales, options));
<span class="hljs-comment">// ["id-u-co-pinyin", "de-ID"]</span>
</code></pre>
<h3 data-id="heading-14">获取分割对象的配置参数</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> spanishSegmenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Segmenter</span>(<span class="hljs-string">"es"</span>, { <span class="hljs-attr">granularity</span>: <span class="hljs-string">"sentence"</span> });
<span class="hljs-keyword">const</span> options = spanishSegmenter.<span class="hljs-title function_">resolvedOptions</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(options.<span class="hljs-property">locale</span>); <span class="hljs-comment">// "es"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(options.<span class="hljs-property">granularity</span>); <span class="hljs-comment">// "sentence"</span>
</code></pre>
<p>在参数不支持的情况下会取当前运行环境中默认语言环境。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> banSegmenter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Segmenter</span>(<span class="hljs-string">"ban"</span>);
<span class="hljs-keyword">const</span> options = banSegmenter.<span class="hljs-title function_">resolvedOptions</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(options.<span class="hljs-property">locale</span>); <span class="hljs-comment">// "zh-CN"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(options.<span class="hljs-property">granularity</span>); <span class="hljs-comment">// "grapheme"</span>
</code></pre>
<h2 data-id="heading-15">总结</h2>
<p><strong>Intl.Segmenter</strong> 很适合在文本处理场景下使用，给了一定的分割标准。它在文本编辑器中计算光标索引、搜索建议的生成、文本计算长度和文本过滤，甚至在自然语言处理场景中都可以使用到。</p>
<p>目前在 <strong>fabric.js</strong> 中也在考虑使用 <strong>Intl.Segmenter</strong> 来优化文本分割，可以研究学习。</p>
<p>大家可能也注意到了，<code>Segmenter</code> 只是 <code>Intl</code> 下的一个对象，还有针对像数字、复数、日期、地区等国际转化，这些后续去研究。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[万物可运行：openEuler 的跨生态兼容力实验]]></title>    <link>https://juejin.cn/post/7579920818871631914</link>    <guid>https://juejin.cn/post/7579920818871631914</guid>    <pubDate>2025-12-05T08:35:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579920818871631914" data-draft-id="7579920818871599146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="万物可运行：openEuler 的跨生态兼容力实验"/> <meta itemprop="keywords" content="操作系统"/> <meta itemprop="datePublished" content="2025-12-05T08:35:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿齐Archie"/> <meta itemprop="url" content="https://juejin.cn/user/2555709341829950"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            万物可运行：openEuler 的跨生态兼容力实验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2555709341829950/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿齐Archie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T08:35:13.000Z" title="Fri Dec 05 2025 08:35:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言：超越兼容，一个为专业人士打造的软件生态</h2>
<p>一个操作系统的价值，直接体现在其软件生态的深度和广度。openEuler 围绕其核心的 DNF 包管理器，构建了一个多层次、广覆盖、高度可控的软件供应网络，旨在为开发者和系统管理员提供一个高效、可靠、灵活的软件管理平台。本文将通过纯粹的命令行实战，深入剖析 openEuler 的包管理体系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8f69ff7bfa24d2284fbc9afee278713~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=%2BpIIpmbBATx8ny7zAJpAUe46kPw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、DNF 进阶：不止于 install 的实用技巧</h2>
<p>掌握 DNF 的高级用法是提升效率的第一步。</p>
<ol>
<li><strong>反向依赖查询 (dnf provides)</strong> : 想知道哪个软件包提供了 <code>/usr/bin/htop</code> 这个文件？</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">dnf provides /usr/bin/htop
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23667eecbc4947e3a35d9198081dd9de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=Pb8HaaLjb1H9vo%2BgyazM5S3VY3o%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li><strong>历史与回滚 (dnf history)</strong> : 系统进行了哪些变更？<code>history</code> 命令一目了然，甚至可以撤销操作。</li>
</ol>

<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 查看所有安装/卸载历史</span>
dnf <span class="hljs-built_in">history</span> <span class="hljs-comment"># 查看某次事务的详细信息</span>
dnf <span class="hljs-built_in">history</span> info 25 <span class="hljs-comment"># 撤销第 25 次事务 (例如，一次错误的安装) </span>
dnf <span class="hljs-built_in">history</span> undo 25
</code></pre>
<p>3.  <strong>清理无用依赖 (dnf autoremove)</strong> : 卸载软件后，其不再需要的依赖包会残留。<code>autoremove</code> 可以安全地清理它们。</p>

<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-meta"># 卸载一个软件后，执行清理</span>
dnf <span class="hljs-keyword">remove</span> some-package
dnf autoremove
</code></pre>
<h2 data-id="heading-2">三、仓库网络：理解 openEuler 的软件来源</h2>
<p>openEuler 的官方仓库设计清晰，各司其职。</p>
<blockquote>
<p><strong>OS</strong>: 基础系统核心包。 <strong>everything</strong>: 社区维护的绝大多数开源软件。 <strong>update</strong>: 安全更新和 bug 修复。 <strong>EPOL (Extra Packages for openEuler)</strong> : 官方仓库的重要补充，提供大量高质量第三方开源软件。</p>
</blockquote>
<p><strong>实战：启用 EPOL 并安装</strong> <strong><code>nethogs</code></strong> 默认 EPOL 仓库可能是禁用的，需要手动启用。</p>
<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-comment"># 查看所有仓库，包括禁用的</span>
dnf repolist --all

 <span class="hljs-comment"># 临时启用 EPOL 仓库来安装 nethogs (一个网络流量监控工具) </span>
dnf <span class="hljs-attr">--enablerepo</span>=epol install nethogs
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3043705a9464b839fb7d7306255eb3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=BzVODdYnIkNofA5e%2BQKDlZBGCoY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">四、高级仓库管理：精细化控制软件源</h2>
<p>对于生产环境，精细化控制仓库至关重要。</p>
<ol start="4">
<li><strong>永久启用/禁用仓库</strong>: 使用 <code>dnf config-manager</code>。</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino"> # 永久启用 EPOL 仓库
dnf config-manager --set-enabled epol

 # 永久禁用某个仓库
dnf config-manager --set-disabled epol
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ff22857a274a999f9a898067be4644~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=EssY2DZDE25Nl0WSLTE3305kxLI%3D" alt="" loading="lazy"/></p>
<ol start="5">
<li><strong>设置仓库优先级</strong>: 当多个仓库提供同一个软件包时，可以通过设置 <code>priority</code> (值越小优先级越高) 来控制安装来源。</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 编辑 /etc/yum.repos.d/isv-critical.repo 文件</span>
<span class="hljs-section">[isv-critical]</span>
<span class="hljs-attr">name</span>=ISV Critical Tools
<span class="hljs-attr">baseurl</span>=http://repo.isv.com/openeuler/
<span class="hljs-attr">enabled</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">gpgcheck</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">priority</span>=<span class="hljs-number">10</span> <span class="hljs-comment"># 设置高优先级</span>
</code></pre>
<p>这确保了即使官方仓库有同名包，系统也会优先从 ISV 仓库安装。</p>
<h2 data-id="heading-4">五、AppStream：终结多版本共存的混乱</h2>
<p>AppStream 允许在一个仓库中，提供一个软件包的多个并行可安装的版本流 (Stream)，彻底解决了多版本管理的难题。</p>
<ol start="6">
<li><strong>查看可用模块</strong>: 以 PostgreSQL 为例：</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">dnf <span class="hljs-keyword">module</span> list postgresql
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e0c8e574b8f46b3973bcfc833e606df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=6Hbq2ZPm%2Futq4JcAZPEObMY26dc%3D" alt="" loading="lazy"/></p>
<ol start="7">
<li><strong>切换并安装指定版本</strong>: 项目需要 PostgreSQL 13？</li>
</ol>

<pre><code class="hljs language-ruby" lang="ruby"> <span class="hljs-comment"># 1. 重置当前模块状态 (如果之前启用过其他版本) </span>
dnf <span class="hljs-keyword">module</span> reset postgresql

 <span class="hljs-comment"># 2. 启用 postgresql:13 这个流</span>
dnf <span class="hljs-keyword">module</span> enable <span class="hljs-symbol">postgresql:</span><span class="hljs-number">13</span>

 <span class="hljs-comment"># 3. 正常安装，系统会自动选择版本 13</span>
dnf install postgresql-server
</code></pre>
<h2 data-id="heading-5">六、安全优先：基于 CVE 的精准更新</h2>
<p>对于生产系统，全量更新可能带来风险。DNF 支持仅针对安全漏洞进行更新。</p>
<ol start="8">
<li><strong>查看安全更新信息</strong>:</li>
</ol>

<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 列出所有可用的安全通告</span>
dnf updateinfo list security

 <span class="hljs-comment"># 查看某个具体安全通告的详细信息 (例如，修复了哪个 CVE) </span>
dnf updateinfo info OE-SA-2023-1234
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9caad120a4a4a18be1b4aa510cdb562~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=q%2B8pd13U9Wpsu8TxY1wPt9IIRA4%3D" alt="" loading="lazy"/></p>
<ol start="9">
<li><strong>执行安全更新</strong>:</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-comment"># 仅安装标记为 “Important” 级别的安全更新</span>
dnf update <span class="hljs-attr">--sec-severity</span>=Important

 <span class="hljs-comment"># 仅安装用于修复特定 CVE (例如 CVE-2023-12345) 的更新</span>
dnf update --cve CVE-2023-12345
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9f3bbe10c544f079270a1d7a9d3173a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=ptyCrDD8to%2FyEjSya0w2OwqIOYA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">七、开发者视角：轻松获取源码包</h2>
<p>需要对某个软件包进行二次开发或Debug？获取其源码包非常简单。</p>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 1. 确保源码仓库已启用</span>
dnf config-manager --set-enabled <span class="hljs-built_in">source</span> <span class="hljs-comment"># 2. 下载 nginx 的源码包 (.src.rpm) </span>
dnf download --<span class="hljs-built_in">source</span> nginx
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecc692a2640f486a8301baf43c18dec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=7rgYZ8ca4zQHbYa93r8zg8dphTc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">八、生态扩展：容器镜像与 ISV 软件</h2>
<p>openEuler 的软件生态远不止于 RPM 包。</p>
<ol start="10">
<li><strong>官方容器镜像</strong>: 通过 Docker Hub 或其他镜像源，可以秒级获取一个纯净的 openEuler 运行环境。</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">podman pull openeuler/openeuler:22.03-lts
podman run -it --<span class="hljs-built_in">rm</span> openeuler/openeuler:22.03-lts bash
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a67dd6a4904b8698f3b38caf3521d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=ZftEziWJbtdQjHbLJiLqu95n6K8%3D" alt="" loading="lazy"/></p>
<ol start="11">
<li><strong>ISV 软件集成</strong>: 商业软件通常通过独立的 <code>.repo</code> 文件提供。</li>
</ol>

<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"> # </span><span class="bash">示例：从 ISV 厂商处下载并安装 repo 文件curl -o /etc/yum.repos.d/isv-database.repo http://repo.isv.com/openeuler.repo</span>
<span class="hljs-meta prompt_">
 # </span><span class="bash">更新缓存后即可安装 ISV 软件</span>
dnf makecache
dnf install isv-database-client
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e0e2e4d186646d992083ce348f846de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765528513&amp;x-signature=%2FNbrpOQwPRG01MT3ZYHbpVkNt0g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">九、结论：一个为专业人士打造的强大软件平台</h2>
<p>openEuler 的包生态系统，通过 DNF 的强大功能、层次化的官方仓库、灵活的 AppStream 机制、安全驱动的更新策略以及对容器和商业软件的良好支持，为开发者和系统管理员提供了一个高度专业、功能完备的软件管理平台。它不仅解决了软件“有没有”的问题，更在“如何高效、安全、灵活地管理软件”这一核心命题上，给出了令人信服的答案。</p>
<blockquote>
<p>如果您正在寻找面向未来的开源操作系统，不妨看看DistroWatch 榜单中快速上升的 openEuler:<a href="https://link.juejin.cn?target=https%3A%2F%2Fdistrowatch.com%2Ftable-mobile.php%3Fdistribution%3Dopeneuler" target="_blank" title="https://distrowatch.com/table-mobile.php?distribution=openeuler" ref="nofollow noopener noreferrer">distrowatch.com/table-mobil…</a>，一个由开放原子开源基金会孵化、支持“超节点”场景的Linux 发行版。
openEuler官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://www.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">www.openeuler.openatom.cn/zh/</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从芯到云：openEuler 打造的全场景软件生态链]]></title>    <link>https://juejin.cn/post/7579926120097366079</link>    <guid>https://juejin.cn/post/7579926120097366079</guid>    <pubDate>2025-12-05T08:47:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579926120097366079" data-draft-id="7579926120097333311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从芯到云：openEuler 打造的全场景软件生态链"/> <meta itemprop="keywords" content="云计算"/> <meta itemprop="datePublished" content="2025-12-05T08:47:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿齐Archie"/> <meta itemprop="url" content="https://juejin.cn/user/2555709341829950"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从芯到云：openEuler 打造的全场景软件生态链
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2555709341829950/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿齐Archie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T08:47:40.000Z" title="Fri Dec 05 2025 08:47:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言：超越操作系统，成为数字世界的“通用底盘”</h2>
<p>在现代产业数字化中，数据流和计算任务不再局限于云端数据中心。它们产生于<strong>终端 (IoT)</strong> ，汇聚于<strong>边缘 (Edge)</strong> ，最终在<strong>云端 (Cloud)</strong> 进行深度分析和训练。这种全场景的业务模式，对底层软件基础设施提出了终极挑战：如何用一套统一、连贯的软件栈，打通从芯片到云端的任督二脉？</p>
<p>各自为政的操作系统带来了巨大的技术壁垒和生态碎片化。openEuler 的核心战略，正是要成为这个全场景时代的 <strong>“数字世界通用底盘”</strong> 。我们这次将通过三个环环相扣的实战场景，从云端高性能数据库，到边缘 AI 推理，再到终端 IoT 开发，展示 openEuler 如何构建一个<strong>从芯片适配到应用使能的完整软件生态链</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1e595593d4e4c81ba77717645e4fa26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=%2FZ5WZshtw5DMpQTKIE9wgpKRsRE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、生态链基石：一套架构，支持多样性算力</h2>
<p>openEuler 全场景战略的基石，在于其对主流计算架构的<strong>原生、统一支持</strong>。无论是云端的 x86 服务器，还是边缘/终端的 ARM 芯片，openEuler 都提供了一致的内核、系统调用接口和用户态环境。</p>
<h3 data-id="heading-2">2.1 云端算力识别 (x86_64)</h3>
<pre><code class="hljs language-perl" lang="perl"> <span class="hljs-comment"># 在典型的 x86 云服务器上执行</span>
lscpu | <span class="hljs-keyword">grep</span> -iE <span class="hljs-string">"arch|model name|cpu(s)|numa"</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/791e0416720f431caae7e35599dfb5a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=RvXjr6YWeckskz2qMghsSzrBskg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 边缘/终端算力识别 (AArch64)</h3>
<pre><code class="hljs language-perl" lang="perl"> <span class="hljs-comment"># 在典型的 ARM 边缘设备或开发板上执行</span>
lscpu | <span class="hljs-keyword">grep</span> -iE <span class="hljs-string">"arch|model name|cpu(s)"</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bca568c484c452faa95835cec5c454f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=bB4yjQIi82t3GYxO6CqN%2Br%2B%2BZHM%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>: 这种跨架构的一致性，意味着为 openEuler x86 开发的应用，可以极低成本地<strong>平滑迁移</strong>到 ARM 平台，这是打通全场景生态链的技术前提。</p>
<h2 data-id="heading-4">三、产业链环节一：云端核心 - 高性能数据库承载</h2>
<p>在生态链的顶端——云端，openEuler 扮演着承载海量数据和高并发事务的关键角色。</p>
<h3 data-id="heading-5">3.1 部署 openGauss 数据库</h3>
<p>openGauss 作为与 openEuler 深度协同的开源数据库，是验证云端生态成熟度的最佳选择。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"> # </span><span class="bash">1. 安装 openGauss <span class="hljs-comment"># 2. 初始化并启动数据库# (此处省略初始化和启动步骤，参考官方文档)# 3. 连接并验证</span></span>
gsql -d postgres -p 26000 -r
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5168257be5f4d6f97e3827b35d0f8c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=tiU1inyEA8nqKbpIxlco0EsaXjI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3.2 性能与优化</h3>
<p>openEuler 内核针对数据库场景进行了深度优化，例如：</p>
<blockquote>
<p><strong>xTune/A-Tune</strong>: 智能调优引擎，可自动为 openGauss 负载配置最优的内核参数。 <strong>Wult (Wakeup Union Latency)</strong> : 优化任务唤醒延迟，提升高并发事务处理性能。</p>
</blockquote>
<p><strong>结论</strong>: 在云端，openEuler 提供了稳定、高性能的运行环境和丰富的系统工具，能够充分发挥 openGauss 等核心数据库的全部潜力。</p>
<h2 data-id="heading-7">四、产业链环节二：智能边缘 - 轻量化 AI 推理</h2>
<p>在生态链的中段——边缘侧，openEuler 需要以容器化的方式，高效、轻量地部署 AI 推理应用。</p>
<h3 data-id="heading-8">4.1 准备 AI 推理环境</h3>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 在 ARM 架构的边缘节点上# 1. 拉取 openEuler 官方 aarch64 容器镜像</span>
podman pull openeuler/openeuler:22.03-lts-aarch64

 <span class="hljs-comment"># 2. 启动容器并进入</span>
podman run -it --<span class="hljs-built_in">rm</span> openeuler/openeuler:22.03-lts-aarch64 bash
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b6f0f4187c24f7b9ed896f99b42bd51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=%2BD%2Fy1edG5GpX9Ri%2FioGGSFDsuZ4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">4.2 部署并运行 ONNX 推理任务</h3>
<p>ONNX Runtime 是业界主流的轻量级推理引擎，拥有良好的跨平台支持。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"> # </span><span class="bash">在容器内执行<span class="hljs-comment"># 1. 安装 Python 和 ONNX Runtime</span></span>
dnf install -y python3 python3-pip python3-pillow
pip3 install onnxruntime numpy
<span class="hljs-meta prompt_">
 # </span><span class="bash">2. 准备模型和测试脚本 (此处省略下载 MobileNet ONNX 模型和编写推理脚本的步骤)<span class="hljs-comment"># python3 infer.py mobilenetv2-7.onnx cat.jpg# 3. 执行推理</span></span>
python3 infer.py
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7d045df610e4f5c93b7910707d455d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=PKVOKd4UMu4gpybuayFXNX4FJuU%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>: 在边缘侧，openEuler 提供了与云端一致的容器化体验和软件包生态，能够将云端训练好的模型，无缝地部署到 ARM 等边缘硬件上执行。</p>
<h2 data-id="heading-10">五、产业链环节三：感知终端 - IoT 与嵌入式开发</h2>
<p>在生态链的起点——终端设备，openEuler 通过其嵌入式版本 <strong>openEuler Embedded</strong>，实现了对“芯片”级别的支持。</p>
<h3 data-id="heading-11">5.1 获取 openEuler Embedded 开发环境</h3>
<p>openEuler Embedded 采用 Yocto/OpenEmbedded 构建系统，为开发者提供了一个高度可定制的嵌入式 Linux 构建框架。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"> # </span><span class="bash">在开发主机上<span class="hljs-comment"># 1. 克隆 openEuler Embedded 源码git clone https://gitee.com/openeuler/openeuler-embedded.git</span></span>
<span class="hljs-meta prompt_">
 # </span><span class="bash">2. 查看其结构<span class="hljs-built_in">ls</span> -F openeuler-embedded/</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62a666066fef448a863d669ef2252da9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=DM3hj3PSA4Hgnz4IBQyPZZUfdEo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">5.2 定制与构建</h3>
<p>开发者可以通过修改配置文件，为特定的芯片（如 HiSilicon、瑞芯微等）构建出<strong>体积仅为数 MB</strong> 的、高度裁剪的 openEuler 系统镜像。</p>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 示例构建流程 (仅为示意) cd openeuler-embedded</span>
<span class="hljs-built_in">source</span> yocto/openeuler-init-build-env
bitbake openeuler-image-minimal
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3fd2435be04496d9cd2caee3b832967~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=2%2Bt8sDqpxVbybeGjdwfn8lRMvr8%3D" alt="" loading="lazy"/></p>
<p><strong>结论</strong>: 在终端侧，openEuler Embedded 提供了从源码构建、高度定制到生成极小镜像的全套工具链，完成了从“芯”开始的软件生态覆盖。</p>
<h2 data-id="heading-13">六、产业链粘合剂：统一的构建与分发体系</h2>
<p>如何保证云、边、端三个场景下 openEuler 的核心组件和软件包同源、同构、同步演进？答案是 <strong>OBS (Open Build Service)</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fc7e14866314b319bbb6b761275aed1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6b2QQXJjaGll:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765529259&amp;x-signature=k%2B2mIgeaMpSlN1M3N7R6hjp9xsc%3D" alt="" loading="lazy"/></p>
<p>OBS 是 openEuler 社区的统一构建平台，它确保了同一个软件包的源码，能够被自动地、一致地编译成适配不同架构和场景的二进制包，是维系整个生态链同构性的核心基础设施。</p>
<h2 data-id="heading-14">七、全场景生态链能力汇总</h2>

































<table><thead><tr><th>产业链环节</th><th>核心场景</th><th>目标架构</th><th>openEuler 关键能力</th><th>核心软件生态</th></tr></thead><tbody><tr><td>云端</td><td>高性能计算、数据中心</td><td>x86_64, AArch64</td><td>内核优化、虚拟化、容器引擎 (iSula)</td><td>openGauss, K8s, Spark</td></tr><tr><td>边缘</td><td>AI 推理、MEC</td><td>AArch64, x86_64</td><td>轻量化容器、实时内核、安全加固</td><td>MindSpore Lite, ONNX RT, KubeEdge</td></tr><tr><td>终端</td><td>IoT、嵌入式设备</td><td>AArch64, RISC-V</td><td>可裁剪、低功耗、Yocto/OE 构建体系</td><td>C/C++ SDK, Python, ROS</td></tr></tbody></table>
<h2 data-id="heading-15">八、结论：openEuler，不止于 OS，更是全场景数字化的产业链基石</h2>
<p>通过对云、边、端三个典型场景的实测，我们可以清晰地看到 openEuler 的软件生态链战略：</p>
<blockquote>
<ol>
<li><strong>统一架构，向下兼容</strong>: 以一套统一的 Linux 内核和用户态，兼容从 x86 到 ARM 再到 RISC-V 的多样性芯片。</li>
<li><strong>场景优化，向上使能</strong>: 为云、边、端不同场景提供针对性的特性优化和核心软件栈。</li>
<li><strong>统一构建，横向打通</strong>: 通过 OBS 等基础设施，确保了整个生态链的同源、同构和协同演进。</li>
</ol>
</blockquote>
<p>openEuler 已经超越了一个传统操作系统的范畴，它正在成为一个连接芯片、设备、边缘节点和云端数据中心的 <strong>“软件产业链生态圈”</strong> 。这种“从芯到云”的整体能力，正是 openEuler 在万物互联时代，赋能千行百业进行全场景数字化转型的核心价值所在。</p>
<blockquote>
<p>如果您正在寻找面向未来的开源操作系统，不妨看看DistroWatch 榜单中快速上升的 openEuler:<a href="https://link.juejin.cn?target=https%3A%2F%2Fdistrowatch.com%2Ftable-mobile.php%3Fdistribution%3Dopeneuler" target="_blank" title="https://distrowatch.com/table-mobile.php?distribution=openeuler" ref="nofollow noopener noreferrer">distrowatch.com/table-mobil…</a>，一个由开放原子开源基金会孵化、支持“超节点”场景的Linux 发行版。
openEuler官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.openeuler.openatom.cn%2Fzh%2F" target="_blank" title="https://www.openeuler.openatom.cn/zh/" ref="nofollow noopener noreferrer">www.openeuler.openatom.cn/zh/</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL数据库操作一致性保证（智能对话+AI代码补全案例）【留言有奖】]]></title>    <link>https://juejin.cn/post/7580180556982960178</link>    <guid>https://juejin.cn/post/7580180556982960178</guid>    <pubDate>2025-12-05T09:33:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580180556982960178" data-draft-id="7579982168452825139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL数据库操作一致性保证（智能对话+AI代码补全案例）【留言有奖】"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-05T09:33:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星火飞码iFlyCode"/> <meta itemprop="url" content="https://juejin.cn/user/4378703548127657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL数据库操作一致性保证（智能对话+AI代码补全案例）【留言有奖】
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4378703548127657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星火飞码iFlyCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T09:33:56.000Z" title="Fri Dec 05 2025 09:33:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>01 背景介绍</strong></p>
<h2 data-id="heading-0">网络自动化平台下的监控中心模块，依赖MySQL数据库进行数据存储，随着业务规模扩展及数据量激增，原有的几个子模块，如服务监控、监控规则和扫描记录的增删改查操作，暴露出以下关键问题：</h2>
<ul>
<li>
<p><strong>概率性异常</strong>：高并发场景下偶现数据不一致</p>
</li>
<li>
<p><strong>事务边界模糊</strong>：跨操作事务管理复杂易错</p>
</li>
<li>
<p><strong>容错机制缺失</strong>：错误场景缺乏自动恢复能力</p>
</li>
<li>
<p><strong>配置文件同步风险</strong>：动态更新时存在竞态条件</p>
</li>
</ul>
<p>使用语言：Go语言，主要用在代码补全功能、配合使用的模型为7B</p>
<p>本文档聚焦网络自动化平台下的监控中心，通过AI辅助生成的典型代码案例，针对其核心子模块——服务监控模块、监控规则模块和扫描记录模块，在高并发场景下的增删改查操作进行了专项优化，系统化展示如何利用现代框架特性（GORM/Viper）结合事务管理、原子操作等机制，构建高可靠的数据库操作体系。</p>
<p><strong>02 核心解决方案与AI生成案例</strong></p>
<p><strong>案例1：监控规则删除</strong></p>
<p><strong>—— 事务化物理删除（解决脏写问题）</strong></p>
<p>操作步骤：<strong>利用智能对话功能，输入提示词后，让大模型<strong><strong>输出高质量</strong></strong>代码</strong></p>
<ol>
<li><strong>输入提示词至AI工具</strong>：</li>
</ol>
<blockquote>
<ol>
<li>“使用GORM编写一个事务函数，删除ID=5的MonitorRulesItem记录，要求包含错误处理、物理删除，并适配现有项目结构”</li>
</ol>
</blockquote>
<ol>
<li><strong>AI生成基础<strong><strong>代码</strong></strong>后，改写适配实际项目。</strong></li>
</ol>
<p><strong>AI生成****代码</strong>：</p>
<pre><code class="hljs language-lua" lang="lua">func DeleteItemByID(db *gorm.DB, id uint) <span class="hljs-built_in">error</span> {    // 开启事务    tx := db.Begin()    defer func() {        <span class="hljs-keyword">if</span> r := recover(); r != <span class="hljs-literal">nil</span> {            tx.Rollback() // 异常时回滚            panic(r)      // 重新抛出panic供上层捕获        }    }()    // 执行物理删除（绕过软删除）    <span class="hljs-keyword">if</span> err := tx.Unscoped().Delete(&amp;models.MonitorRulesItem{}, id).Error; err != <span class="hljs-literal">nil</span> {        tx.Rollback()              // 删除失败时回滚        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"delete failed: %w"</span>, err)    }    // 提交事务    <span class="hljs-keyword">if</span> err := tx.Commit().Error; err != <span class="hljs-literal">nil</span> {        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"commit failed: %w"</span>, err)    }    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>}
</code></pre>
<p>基础代码实现了用事务包裹删除操作，且通过<code>Unscoped()</code>直接永久删除数据库记录，事务处理逻辑与GORM官方文档一致，因此可直接复用，通过智能对话方式实现代码补全的内容，采纳率达80%以上。</p>
<p>以下为是适配实际代码的结果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d69eed3a6e88463db5bffe0403c3205f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532036&amp;x-signature=YWPAzzdlPUo55rnA5moRL4XmqnQ%3D" alt="" loading="lazy"/></p>
<p><strong>案例2：服务监控同步</strong></p>
<p><strong>—— 事务化批量操作</strong></p>
<h4 data-id="heading-1">操作步骤：利用智能对话功能，输入提示词后，让大模型输出高质量代码</h4>
<ol>
<li><strong>输入提示词至AI工具</strong>：</li>
</ol>
<blockquote>
<ol>
<li>“创建事务函数，用于同步服务实例到数据库，要求包含完整的错误处理、自动回滚机制，并支持批量更新/插入操作。”</li>
</ol>
</blockquote>
<ol>
<li><strong>AI生成基础<strong><strong>代码</strong></strong>后，改写适配实际项目。</strong></li>
</ol>
<p><strong>AI生成****代码</strong>：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-built_in">package</span> mainimport (    <span class="hljs-string">"fmt"</span>    <span class="hljs-string">"gorm.io/gorm"</span> // 确保已安装 gorm.<span class="hljs-built_in">io</span>/gorm v2+)<span class="hljs-built_in">type</span> ServersItem struct {    // 根据实际表结构定义字段（示例）    ID   uint `gorm:<span class="hljs-string">"primaryKey"</span>`    Name <span class="hljs-built_in">string</span>    IP   <span class="hljs-built_in">string</span>}func transactionalUpsert(db *gorm.DB, updates []ServersItem, creates []ServersItem) <span class="hljs-built_in">error</span> {    // 开启事务    tx := db.Begin()    defer func() {        <span class="hljs-keyword">if</span> r := recover(); r != <span class="hljs-literal">nil</span> {            tx.Rollback()            panic(r) // 重新抛出异常供上层捕获        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> tx.Error != <span class="hljs-literal">nil</span> { // 检测事务自身错误            tx.Rollback()        }    }()    // 执行批量更新（仅当有更新项时）    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(updates) &gt; <span class="hljs-number">0</span> {        <span class="hljs-keyword">if</span> err := tx.Save(&amp;updates).Error; err != <span class="hljs-literal">nil</span> {            <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"update failed: %w"</span>, err)        }    }    // 执行批量插入（仅当有新建项时）    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(creates) &gt; <span class="hljs-number">0</span> {        <span class="hljs-keyword">if</span> err := tx.Create(&amp;creates).Error; err != <span class="hljs-literal">nil</span> {            <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"insert failed: %w"</span>, err)        }    }    // 提交事务    <span class="hljs-keyword">if</span> err := tx.Commit().Error; err != <span class="hljs-literal">nil</span> {        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"transaction commit failed: %w"</span>, err)    }    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>}
</code></pre>
<p>基础代码实现了用事务包裹操作，保证批量操作要么成功要么回退，逻辑清晰，因此直接采用上述代码对实际代码进行调整：通过智能对话方式实现代码补全的内容，采纳率达70%以上。</p>
<p><strong>案例3：YAML文件解析与数据库写入</strong></p>
<p><strong>—— 事务化数据写入</strong></p>
<h4 data-id="heading-2">操作步骤：选中部分代码后，利用智能对话功能，输入提示词后，让大模型输出高质量代码</h4>
<ol>
<li>
<p>选中代码</p>
<p>// 解析YAML文件并存入数据库content, err := os.ReadFile(yamlPath)if err != nil { ... }var data MyStructif err := yaml.Unmarshal(content, &amp;data); err != nil { ... }db.Create(&amp;Table1{        FileName: filepath.Base(yamlPath),        Content:  string(content),})</p>
</li>
<li>
<p><strong>输入提示词至AI工具</strong>：</p>
</li>
</ol>
<blockquote>
<ol>
<li>“优化yaml文件解析过程，并将解析后的结果保存至数据库。要求用事务实现，具备回滚机制。”</li>
</ol>
</blockquote>
<ol>
<li><strong>AI生成基础<strong><strong>代码</strong></strong>后，改写适配实际项目。</strong></li>
</ol>
<p><strong>AI生成<strong><strong>代码</strong></strong>：</strong></p>
<pre><code class="hljs language-lua" lang="lua">func ImportYamlToDB(db *gorm.DB, yamlPath <span class="hljs-built_in">string</span>) <span class="hljs-built_in">error</span> {        // AI 自动补充文件校验        info, err := <span class="hljs-built_in">os</span>.Stat(yamlPath)        <span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.IsNotExist(err) {                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"文件不存在: %s"</span>, yamlPath)        }        // 带缓冲的文件读取        content, err := ioutil.ReadAll(<span class="hljs-built_in">io</span>.LimitReader(file, maxFileSize))        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"文件读取失败: %w"</span>, err)        }        // 严格模式解析        var data MyStruct        <span class="hljs-keyword">if</span> err := yaml.UnmarshalStrict(content, &amp;data); err != <span class="hljs-literal">nil</span> {                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"YAML解析失败: %w\n内容: %s"</span>, err, <span class="hljs-built_in">string</span>(content))        }        // 事务性数据库操作        tx := db.Begin()        defer func() {                <span class="hljs-keyword">if</span> r := recover(); r != <span class="hljs-literal">nil</span> {                        tx.Rollback()                }        }()        record := Table1{                FileName:    filepath.Base(yamlPath),                ContentHash: sha256.Sum256(content), // AI 建议添加内容哈希校验                Content:     <span class="hljs-built_in">string</span>(content),                ParsedData:  data,                   // 存储解析后的结构体        }        <span class="hljs-keyword">if</span> err := tx.Create(&amp;record).Error; err != <span class="hljs-literal">nil</span> {                tx.Rollback()                <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"数据库插入失败: %w"</span>, err)        }        <span class="hljs-keyword">return</span> tx.Commit().Error}
</code></pre>
<p>添加的yaml文件解析前置步骤清晰，首先确认文件是否存在，然后限制文件大小进行读取以防崩溃，用严格模式解析yaml文件杜绝了格式问题。将所有数据库操作放在事务内实现，满足提示词要求，因此采用该结果，适配实际代码：通过智能对话方式实现代码补全的内容，采纳率达70%以上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3a722d46cbe43de990fe8b20c6650a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532036&amp;x-signature=5gVKYPm9jMs2tVUbGa1YLW4zim0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">案例4：通过组件接口完成API响应——RESTful API响应封装</h3>
<h4 data-id="heading-4">实现方式：基于代码补全功能自动补全代码</h4>
<p><strong>原<strong><strong>代码</strong></strong>：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ResponseWithSuccess</span><span class="hljs-params">(c *gin.Context)</span></span> {}
</code></pre>
<p><strong>AI补全<strong><strong>代码</strong></strong>：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ResponseWithSuccess</span><span class="hljs-params">(c *gin.Context)</span></span> {    c.JSON(http.StatusOK, gin.H{        <span class="hljs-string">"code"</span>:        http.StatusOK,        <span class="hljs-string">"message"</span>:     <span class="hljs-string">"ok"</span>,        <span class="hljs-string">"status"</span>:      <span class="hljs-string">"success"</span>,        })}
</code></pre>
<p>AI生成的代码完全满足标准化RESTful API响应需求，所以直接使用，通过代码自动续写的功能，直接进行代码采纳操作，无需做任何修改。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/926b711bf9414f5fba00586a36d7459c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif54Gr6aOe56CBaUZseUNvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532036&amp;x-signature=WAi2sbaMJkGr3UiS6%2FZJJb7uEvU%3D" alt="" loading="lazy"/></p>
<p><strong>03 总结</strong></p>
<p><strong>本次iFlyCode代码补全实践明显提升了开发效率。遵循常规工作节奏，光靠人工一点点优化整个项目的代码，估计得花上两周时间才能弄完。但用了</strong>iFlyCode<strong>这个帮手，仅仅用了3天就顺利完成了任务，而且在优化过程中，还顺便把代码的规范性也仔细调整好了。很明显，合理利用手里的智能工具，不仅能大大缩短项目完成的时间，还能少花很多人力，降低可能出现的风险。这样一来，团队就能把更多精力放在琢磨核心业务逻辑的创新和改进上，让项目又快又好地往前推进。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA["从自然语言到数据库：AI First 时代的编程与开发革命"]]></title>    <link>https://juejin.cn/post/7579932196464787510</link>    <guid>https://juejin.cn/post/7579932196464787510</guid>    <pubDate>2025-12-05T09:40:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579932196464787510" data-draft-id="7580184249907806250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="&quot;从自然语言到数据库：AI First 时代的编程与开发革命&quot;"/> <meta itemprop="keywords" content="LLM,OpenAI,SQLite"/> <meta itemprop="datePublished" content="2025-12-05T09:40:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼鱼块"/> <meta itemprop="url" content="https://juejin.cn/user/4302802432307224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            "从自然语言到数据库：AI First 时代的编程与开发革命"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4302802432307224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼鱼块
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T09:40:33.000Z" title="Fri Dec 05 2025 09:40:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>从自然语言到数据库：AI First 时代的编程与开发革命</strong></h2>
<p>在软件行业的历史中，每次生产力的跃迁往往伴随着工具的本质变化。键盘出现，使代码不再依赖穿孔卡；高级语言出现，使程序员不必直面内存地址；云计算出现，使应用部署从繁琐的运维中解脱。如今，另一场具有同等重量级的转折点正在发生——<strong>AI First</strong> 的开发范式。</p>
<p>与过去不同，这场变革不是单纯由某一种工具推动，而是由大模型、自然语言接口、能理解语义的代码生成系统、跨应用调度能力共同构成的一体化浪潮。在这股浪潮中，模型不再是一个“聊天工具”，而成为 “全栈开发者”、“数据分析师” 甚至 “业务助理”。这类系统既能读懂自然语言，又能联动数据库、执行 SQL、生成代码，进而参与整个应用的生命周期。</p>
<p>为了展示这股浪潮正在酝酿的方向，下面结合一个真实的 Notebook 流程——从创建数据库，到使用大模型自动生成 SQL 并执行，再到进一步扩展到 Mobile First、Agent、ModelScope 等更大的生态，把这场变革的逻辑完整呈现出来。</p>
<hr/>
<h2 data-id="heading-1"><strong>一、大模型进入数据库世界：自然语言就是 SQL</strong></h2>
<p>传统数据库查询需要掌握表结构、语法、引用规则等知识。大模型的出现正悄悄把这套规则折叠起来，使自然语言成为新的统一界面。下面以魔搭为例</p>
<p>Notebook 中，首先创建了一个最简单的 SQLite 数据库：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sqlite3
<span class="hljs-comment"># 连接数据库</span>
conn = sqlite3.connect(<span class="hljs-string">"test.db"</span>)
<span class="hljs-comment"># 创建一个游标对象</span>
<span class="hljs-comment"># 用于执行sql 获取查询结果</span>
cursor = conn.cursor()

cursor.execute(<span class="hljs-string">"""
CREATE TABLE IF NOT EXISTS employees(
    id INTEGER PRIMARY KEY,
    name TEXT,
    department TEXT,
    salary INTEGER
)
"""</span>)
</code></pre>
<p>一个包含 <code>id、name、department、salary</code> 四列的员工表就这样建立起来。</p>
<p>接着，填充若干示例数据，例如：</p>
<pre><code class="hljs language-python" lang="python">sample_data = [
    (<span class="hljs-number">6</span>, <span class="hljs-string">"黄佳"</span>, <span class="hljs-string">"销售"</span>, <span class="hljs-number">50000</span>),
    (<span class="hljs-number">7</span>, <span class="hljs-string">"宁宁"</span>, <span class="hljs-string">"工程"</span>, <span class="hljs-number">75000</span>),
    (<span class="hljs-number">8</span>, <span class="hljs-string">"谦谦"</span>, <span class="hljs-string">"销售"</span>, <span class="hljs-number">60000</span>),
    (<span class="hljs-number">9</span>, <span class="hljs-string">"悦悦"</span>, <span class="hljs-string">"工程"</span>, <span class="hljs-number">80000</span>),
    (<span class="hljs-number">11</span>, <span class="hljs-string">"曾繁花"</span>, <span class="hljs-string">"工程"</span>, <span class="hljs-number">80000</span>)
]
<span class="hljs-comment"># 插入sql</span>
cursor.executemany(<span class="hljs-string">"INSERT INTO employees VALUES(?,?,?,?)"</span>, sample_data)
<span class="hljs-comment"># 提交sql事务</span>
conn.commit()
</code></pre>
<p>这些数据构成一个非常常见的业务场景：不同部门员工的信息。</p>
<p>如果在传统开发方式中，查询这些数据需要写 SQL、调试 SQL、确认语法是否正确。但在这个 Notebook 中，真正的关键代码出现在后面：</p>
<hr/>
<h2 data-id="heading-2"><strong>二、让模型读懂数据库结构：Schema → SQL</strong></h2>
<p>为了让大模型准确生成 SQL，需要告诉它表结构。通过 SQLite 的 PRAGMA 指令读取 schema：</p>
<pre><code class="hljs language-python" lang="python">schema = cursor.execute(<span class="hljs-string">"PRAGMA table_info(employees)"</span>).fetchall()
schema_str = <span class="hljs-string">"CREATE TABLE EMPLOYEES (\n"</span> + <span class="hljs-string">"\n"</span>.join(
    <span class="hljs-string">f"<span class="hljs-subst">{col[<span class="hljs-number">1</span>]}</span> <span class="hljs-subst">{col[<span class="hljs-number">2</span>]}</span>"</span> <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> schema
) + <span class="hljs-string">"\n)"</span>
</code></pre>
<p>模型收到的结构类似：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> EMPLOYEES (
id <span class="hljs-type">INTEGER</span>
name TEXT
department TEXT
salary <span class="hljs-type">INTEGER</span>
)
</code></pre>
<p>接下来是模型最关键的调用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">ask_deepseek</span>(<span class="hljs-params">query, schema</span>):
    prompt = <span class="hljs-string">f"""
这是一个数据库的Schema:
<span class="hljs-subst">{schema}</span>

根据这个Schema，请输出一个SQL查询来回答以下问题。
只输出SQL查询语句本身，不要使用任何Markdown格式。
不要包含反引号、代码块标记或高额说明。
问题: <span class="hljs-subst">{query}</span>
"""</span>
    response = client.chat.completions.create(
        model = <span class="hljs-string">"deepseek-chat"</span>,
        max_tokens=<span class="hljs-number">2048</span>,
        messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}],
        temperature=<span class="hljs-number">0</span>
    )
    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content
</code></pre>
<p>这里，大模型被严格要求 <strong>只输出 SQL，不输出解释、不输出格式化、不输出注释</strong>。这是在工程级应用中常见的 prompt pattern，通过“干净输出”确保 SQL 能直接执行。</p>
<p>于是，只需输入自然语言问题即可自动得到 SQL。</p>
<hr/>
<h2 data-id="heading-3"><strong>三、让模型回答问题：自然语言 → 数据库结果</strong></h2>
<p>例如，提出问题：</p>
<p><strong>“工程部门员工的姓名和工资是多少？”</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2bc391c5e12413f8e9d2b1c51f46034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532433&amp;x-signature=f36gtW3w4phi8pIblPtvk6br0SA%3D" alt="image.png" loading="lazy"/></p>
<p>模型输出的 SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> name, salary <span class="hljs-keyword">FROM</span> EMPLOYEES <span class="hljs-keyword">WHERE</span> department <span class="hljs-operator">=</span> <span class="hljs-string">'工程'</span>;
</code></pre>
<p>当执行后：</p>
<pre><code class="hljs language-python" lang="python">results = cursor.execute(sql_query).fetchall()
<span class="hljs-built_in">print</span>(results)
</code></pre>
<p>数据库返回：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a0634918842423e8033c3230e8e9190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532433&amp;x-signature=nS%2FQSgKQqBX5ehR2NmtkwTAgNxA%3D" alt="image.png" loading="lazy"/></p>
<p>这一过程实现了：</p>
<blockquote>
<p>从自然语言 → SQL → 查询结果<br/>
整个流程自动完成，不需要对 SQL 语法有任何掌握。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4"><strong>四、超越查询：模型还能执行插入、删除、更新</strong></h2>
<p>这个系统不仅能查数据，还能<strong>写数据</strong>。</p>
<p>若提出：</p>
<p><strong>“在销售部门增加一个新员工，名为张三，工资为45000”</strong></p>
<p>模型直接输出插入语句：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a4fb3d7741c442fba3e5b362fea692c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532433&amp;x-signature=xPXw1ybNm3L%2BXHeAo2NXaZoVeOg%3D" alt="image.png" loading="lazy"/></p>
<p>执行后即可真实写入数据库。</p>
<p>提出：</p>
<p><strong>“删除市场部门的黄仁勋”</strong></p>
<p>模型输出：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa3f495634154835a42b83285d7bcb22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532433&amp;x-signature=mr%2FtJ7jXCLnD80%2Balo%2B4zg3ukGQ%3D" alt="image.png" loading="lazy"/></p>
<p>再次执行即可生效。</p>
<p>更复杂一点的问题：</p>
<p><strong>“查询所有员工的信息”</strong></p>
<p>输出：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45fa0a7fcd42486a9c9ff7b7659c3275~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bG86bG85Z2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765532433&amp;x-signature=xqeOx8csYSBjxx3VnxtFe0Dw0WA%3D" alt="image.png" loading="lazy"/></p>
<p>从成果来看，模型已经具备了一种“语义化操作数据库”的能力。就像与一个懂 SQL 的工程师交流，只需描述任务，它便自动生成精准的 SQL 语句。</p>
<hr/>
<h2 data-id="heading-5"><strong>五、AI First 的真正意义：开发从“写代码”转向“调度智能”</strong></h2>
<p>这个 Notebook 演示的虽然只是一个小场景，但它本质上象征着未来开发方式的核心特征：</p>
<hr/>
<h4 data-id="heading-6"><strong>1. 自然语言成为新的 UI</strong></h4>
<p>自然语言就像一种“超级遥控器”。<br/>
数据库查询、增删改操作不再由键盘输入 SQL，而由描述意图来完成。</p>
<p>这种 UI 本质上使“技能门槛”极大下降——不再需要掌握 SQL 本身。未来，在应用中也能看到类似场景：输入一句话，后台自动生成代码、接口、表结构迁移脚本、报表等。</p>
<hr/>
<h4 data-id="heading-7"><strong>2. 模型成为应用的一部分，而不是外挂工具</strong></h4>
<p>在这个流程中，模型不是“回答问题的聊天助手”，而是：</p>
<ul>
<li>解析 Schema 的 SQL 专家</li>
<li>与数据库协作的后端组件</li>
<li>兼具分析和执行能力的“代理”</li>
</ul>
<p>它嵌入在系统里，就像传统的 web server、middleware 一样，是真正的“后端基础设施”。</p>
<hr/>
<h4 data-id="heading-8"><strong>3. 开发工作从“写实现”变成“定义需求”</strong></h4>
<p>过去开发中的 70% 时间花在实现逻辑上，如：</p>
<ul>
<li>研究 SQL</li>
<li>调试语法错误</li>
<li>处理 join、group by</li>
<li>写 MVC 结构</li>
<li>写 CSS 兼容性</li>
</ul>
<p>而 AI First 的范式中，开发主要转向：</p>
<ul>
<li>定义意图</li>
<li>设计流程</li>
<li>审查生成内容</li>
<li>管理模型的输入输出规范</li>
<li>调用模型完成重复工作</li>
</ul>
<p>借用生活中的比喻，这就像从“自己做饭”变为“告诉厨师想吃什么”。</p>
<hr/>
<h4 data-id="heading-9"><strong>4. LLM + Agent 的能力将渗透所有业务场景</strong></h4>
<p>举一个贴近日常的例子：</p>
<blockquote>
<p>“帮我点一杯奶茶，少糖热的，并在美团/抖音/淘宝上比价，用优惠券，在最便宜的那家下单。”</p>
</blockquote>
<p>这不是幻想，而是 Agent（自治智能体）与多个应用系统打通后的真实未来。<br/>
数据库查询只是其中一种能力；当模型能调度支付、比价、下单 API 时，它会成为“数字世界的执行者”。</p>
<hr/>
<h2 data-id="heading-10"><strong>六、ModelScope：大模型的社区与生产平台</strong></h2>
<p>在更大的图景中，阿里推出的 <strong>ModelScope（魔搭）</strong> 则扮演了生态级角色。</p>
<p>ModelScope 提供：</p>
<ul>
<li><strong>开源的大模型社区</strong></li>
<li><strong>模型应用市场</strong></li>
<li><strong>数据集平台</strong></li>
<li><strong>Notebook 环境（如本例）</strong></li>
<li><strong>微调与推理的工具链</strong></li>
</ul>
<p>这意味着一个完整闭环：</p>
<blockquote>
<p>构建 Notebook → 连接数据库 → 引入大模型 → 执行 SQL → 部署应用<br/>
全流程都可以在 ModelScope 这样的开放平台完成。</p>
</blockquote>
<p>这让开发从“代码的世界”一步步走向“模型的世界”。</p>
<hr/>
<h2 data-id="heading-11"><strong>七、大模型时代的个人创造力革命：从一变多的生产模式</strong></h2>
<p>把上面所有内容串起来，一个显著趋势便浮现出来：</p>
<h4 data-id="heading-12"><strong>一个人 + 一个大模型 = 一个完整的工程团队</strong></h4>
<p>很难想象在不久的将来：</p>
<blockquote>
<p>“数据库、业务、小编，在任何人加入后运行和维护。”</p>
</blockquote>
<p>这是 AI First 的核心价值：<br/>
开发的难度逐渐与“是否会写 SQL、会写 MVC、会写 CSS”脱钩，而更依赖于表达需求、制定规则、理解业务逻辑。</p>
<p>大模型成为“自动化劳动力”，开发者成为“任务的指挥者”。</p>
<hr/>
<h2 data-id="heading-13"><strong>结语：迈向 AI First 的世界</strong></h2>
<p>当自然语言能直接驱动数据库，当模型能自动生成并执行 SQL，当 ModelScope 等平台让每个人都能轻松调用大模型，当 Agent 能帮人点奶茶、比价、自动下单，这些碎片组合在一起，构成了一个全新的软件世界。</p>
<p>在这个世界中：</p>
<ul>
<li>代码只是“模型的产物”</li>
<li>应用由“意图”驱动</li>
<li>AI 成为“开发者的共同体”</li>
<li>生产力不再被技能门槛限制</li>
</ul>
<p>技术正在悄悄改变，但改变的方向十分明确：<br/>
<strong>从手写代码 → 意图驱动 → 智能调度 → 自动执行。</strong></p>
<p>这就是 AI First  时代的真正意义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.js 16 Page Router 国际化 🌐]]></title>    <link>https://juejin.cn/post/7580188321323057158</link>    <guid>https://juejin.cn/post/7580188321323057158</guid>    <pubDate>2025-12-05T10:27:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580188321323057158" data-draft-id="7579999793320574982" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.js 16 Page Router 国际化 🌐"/> <meta itemprop="keywords" content="Next.js"/> <meta itemprop="datePublished" content="2025-12-05T10:27:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.js 16 Page Router 国际化 🌐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T10:27:12.000Z" title="Fri Dec 05 2025 10:27:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Next.js 16 Page Router 国际化 🌐</h2>
<h3 data-id="heading-1">引言</h3>
<p>在现代 Web 应用开发中，国际化（i18n）已经成为一个必备功能。传统的 Next.js 国际化方案通常采用 URL 前缀方式（如 <code>/en/page</code> 或 <code>/zh-CN/page</code>），这种方式虽然实现简单，但存在一些明显的问题：</p>
<ol>
<li><strong>URL 频繁变更</strong>：用户切换语言时，页面 URL 会发生变化</li>
<li><strong>SEO 分散</strong>：相同内容分散在不同 URL 下，影响搜索引擎优化</li>
<li><strong>用户体验不佳</strong>：复制链接时需要考虑语言前缀</li>
</ol>
<p>那么，有没有一种方式可以在不改变 URL 的情况下实现国际化呢？答案是肯定的！本文将详细介绍我在 Next.js 16 项目中实现的<strong>无 URL 变更的国际化方案</strong>，采用浏览器缓存 + Cookie 机制管理语言切换，保持 URL 稳定的同时提供流畅的国际化体验。</p>
<h3 data-id="heading-2">技术栈</h3>













































<table><thead><tr><th>技术</th><th>版本</th><th>用途</th></tr></thead><tbody><tr><td>Next.js</td><td>16.0.7</td><td>前端框架</td></tr><tr><td>React</td><td>19.2.0</td><td>UI 库</td></tr><tr><td>TypeScript</td><td>5.5.4</td><td>类型系统</td></tr><tr><td>next-i18next</td><td>15.4.3</td><td>国际化核心库</td></tr><tr><td>react-i18next</td><td>16.3.5</td><td>React 国际化集成</td></tr><tr><td>js-cookie</td><td>3.0.5</td><td>Cookie 管理</td></tr><tr><td>ahooks</td><td>3.9.6</td><td>React Hooks 工具库</td></tr></tbody></table>
<h3 data-id="heading-3">项目结构</h3>
<pre><code class="hljs language-python" lang="python">src/
├── components/            <span class="hljs-comment"># 组件目录</span>
│   └── I18nLngSelector.tsx  <span class="hljs-comment"># 语言选择器组件</span>
├── i18n/                 <span class="hljs-comment"># 国际化配置目录</span>
│   ├── hooks/            <span class="hljs-comment"># 自定义 Hooks</span>
│   │   └── useI18n.ts    <span class="hljs-comment"># 语言切换钩子</span>
│   ├── locales/          <span class="hljs-comment"># 翻译资源文件</span>
│   │   ├── en/           <span class="hljs-comment"># 英文翻译</span>
│   │   │   ├── common.json       <span class="hljs-comment"># 通用翻译</span>
│   │   │   └── index_page.json   <span class="hljs-comment"># 首页翻译</span>
│   │   └── zh-CN/        <span class="hljs-comment"># 中文翻译</span>
│   │       ├── common.json       <span class="hljs-comment"># 通用翻译</span>
│   │       └── index_page.json   <span class="hljs-comment"># 首页翻译</span>
│   ├── <span class="hljs-built_in">type</span>.ts           <span class="hljs-comment"># TypeScript 类型定义</span>
│   └── i18next.d.ts      <span class="hljs-comment"># 类型声明文件</span>
└── pages/                <span class="hljs-comment"># 页面目录</span>
    ├── _app.tsx          <span class="hljs-comment"># 应用入口（语言初始化）</span>
    └── index.tsx         <span class="hljs-comment"># 首页</span>
</code></pre>
<h3 data-id="heading-4">核心实现</h3>
<h4 data-id="heading-5">1. next-i18next 配置</h4>
<p>首先，我们需要配置 next-i18next，创建 <code>next-i18next.config.js</code> 文件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// next-i18next.config.js</span>
<span class="hljs-comment">// @ts-check</span>

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@type</span> {<span class="hljs-type">import('next-i18next').UserConfig</span>}
 */</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// 开发环境下启用调试模式</span>
  <span class="hljs-attr">debug</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>,
  <span class="hljs-comment">// 国际化配置</span>
  <span class="hljs-attr">i18n</span>: {
    <span class="hljs-comment">// 默认语言</span>
    <span class="hljs-attr">defaultLocale</span>: <span class="hljs-string">'zh-CN'</span>,
    <span class="hljs-comment">// 支持的语言列表</span>
    <span class="hljs-attr">locales</span>: [<span class="hljs-string">'zh-CN'</span>, <span class="hljs-string">'en'</span>],
    <span class="hljs-comment">// 禁用自动语言检测，使用自定义逻辑</span>
    <span class="hljs-attr">localeDetection</span>: <span class="hljs-literal">false</span>,
  },
  <span class="hljs-comment">// 语言资源文件路径</span>
  <span class="hljs-attr">localePath</span>: <span class="hljs-string">'./src/i18n/locales'</span>,
  <span class="hljs-comment">// 开发环境下在预渲染时重新加载语言资源</span>
  <span class="hljs-attr">reloadOnPrerender</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>,
}
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>debug: true</code>：开发环境下启用调试模式，便于开发调试</li>
<li><code>defaultLocale: 'zh-CN'</code>：设置默认语言为中文</li>
<li><code>locales: ['zh-CN', 'en']</code>：配置支持的语言列表</li>
<li><code>localeDetection: false</code>：禁用自动语言检测，使用自定义的语言检测和切换逻辑</li>
<li><code>localePath: './src/i18n/locales'</code>：指定语言资源文件的存放路径</li>
</ul>
<h4 data-id="heading-6">2. 自定义语言切换钩子</h4>
<p>核心逻辑在于自定义的 <code>useI18nLng</code> 钩子，它负责处理语言的存储、切换和初始化：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/hooks/useI18n.ts</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LangEnum</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/type'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Cookies</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"js-cookie"</span>;

<span class="hljs-comment">// 语言存储的键名</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LANG_KEY</span> = <span class="hljs-string">'NEXT_LOCALE'</span>;

<span class="hljs-comment">/**
 * 检查当前是否在 iframe 中
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">isInIframe</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">self</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">top</span>;
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 发生异常时默认认为在 iframe 中</span>
  }
};

<span class="hljs-comment">/**
 * 设置语言到存储中
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setLang</span> = (<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isInIframe</span>()) {
    <span class="hljs-comment">// 在 iframe 中只使用 localStorage</span>
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">LANG_KEY</span>, value);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 不在 iframe 中，同时使用 Cookie 和 localStorage</span>
    <span class="hljs-title class_">Cookies</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable constant_">LANG_KEY</span>, value, { <span class="hljs-attr">expires</span>: <span class="hljs-number">30</span> }); <span class="hljs-comment">// Cookie 有效期30天</span>
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">LANG_KEY</span>, value);
  }
};

<span class="hljs-comment">/**
 * 从存储中获取语言
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getLang</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">LANG_KEY</span>) || <span class="hljs-title class_">Cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable constant_">LANG_KEY</span>);
};

<span class="hljs-comment">/**
 * 自定义 i18n 语言切换钩子
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useI18nLng</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 获取 i18n 实例</span>
  <span class="hljs-keyword">const</span> { i18n } = <span class="hljs-title function_">useTranslation</span>();
  
  <span class="hljs-comment">// 语言映射表，确保语言代码的一致性</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">languageMap</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
    <span class="hljs-string">'zh-CN'</span>: <span class="hljs-title class_">LangEnum</span>.<span class="hljs-property">zh_CN</span>,
    <span class="hljs-attr">en</span>: <span class="hljs-title class_">LangEnum</span>.<span class="hljs-property">en</span>,
  };

  <span class="hljs-comment">/**
   * 切换语言的方法
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onChangeLng</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">lng: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-comment">// 确保语言代码的正确性</span>
    <span class="hljs-keyword">const</span> lang = languageMap[lng] || <span class="hljs-string">'en'</span>;
    <span class="hljs-keyword">const</span> prevLang = <span class="hljs-title function_">getLang</span>();

    <span class="hljs-comment">// 将语言保存到存储中</span>
    <span class="hljs-title function_">setLang</span>(lang);

    <span class="hljs-comment">// 调用 i18n 实例切换语言</span>
    <span class="hljs-keyword">await</span> i18n?.<span class="hljs-property">changeLanguage</span>?.(lang);

    <span class="hljs-comment">// 如果没有资源包且语言发生了变化，则刷新页面</span>
    <span class="hljs-keyword">if</span> (!i18n?.<span class="hljs-property">hasResourceBundle</span>?.(lang, <span class="hljs-string">'common'</span>) &amp;&amp; prevLang !== lang) {
      <span class="hljs-variable language_">window</span>?.<span class="hljs-property">location</span>?.<span class="hljs-property">reload</span>?.();
    }
  };

  <span class="hljs-comment">/**
   * 设置用户默认语言
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setUserDefaultLng</span> = (<span class="hljs-params">forceGetDefaultLng: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) =&gt; {
    <span class="hljs-comment">// 确保在浏览器环境中运行</span>
    <span class="hljs-keyword">if</span> (!navigator || !<span class="hljs-variable language_">localStorage</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 如果已经有存储的语言且不是强制获取，则使用存储的语言</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">getLang</span>() &amp;&amp; !forceGetDefaultLng) <span class="hljs-keyword">return</span> <span class="hljs-title function_">onChangeLng</span>(<span class="hljs-title function_">getLang</span>() <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);

    <span class="hljs-comment">// 获取浏览器语言并映射到支持的语言</span>
    <span class="hljs-keyword">const</span> lang = languageMap[navigator.<span class="hljs-property">language</span>] || <span class="hljs-string">'en'</span>;

    <span class="hljs-comment">// 切换到获取的语言</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">onChangeLng</span>(lang);
  };

  <span class="hljs-comment">// 返回钩子方法</span>
  <span class="hljs-keyword">return</span> {
    onChangeLng,  <span class="hljs-comment">// 语言切换方法</span>
    setUserDefaultLng <span class="hljs-comment">// 设置默认语言方法</span>
  };
};
</code></pre>
<p><strong>核心亮点</strong>：</p>
<ul>
<li><strong>双重存储机制</strong>：同时使用 localStorage 和 Cookie 存储语言选择，确保在不同场景下都能正确获取</li>
<li><strong>iframe 兼容性</strong>：检测是否在 iframe 中运行，针对性处理存储方式</li>
<li><strong>智能语言切换</strong>：切换语言时先检查是否有资源包，避免因资源缺失导致的错误</li>
<li><strong>浏览器语言检测</strong>：首次访问时根据浏览器语言自动设置默认语言</li>
</ul>
<h4 data-id="heading-7">3. 应用入口初始化</h4>
<p>在 <code>_app.tsx</code> 中实现默认语言的初始化，确保页面刷新后能保持用户的语言选择：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/_app.tsx</span>
<span class="hljs-comment">// 导入应用组件类型定义</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">AppProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/app'</span>
<span class="hljs-comment">// 导入 i18n 应用包装组件</span>
<span class="hljs-keyword">import</span> { appWithTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next'</span>
<span class="hljs-comment">// 导入自定义的 i18n 语言钩子</span>
<span class="hljs-keyword">import</span> { useI18nLng } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/hooks/useI18n'</span>
<span class="hljs-comment">// 导入 React 副作用钩子</span>
<span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">/**
 * 主应用组件，所有页面的容器组件
 * <span class="hljs-doctag">@param</span> Component 当前渲染的页面组件
 * <span class="hljs-doctag">@param</span> pageProps 页面属性和初始数据
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyApp</span> = (<span class="hljs-params">{ Component, pageProps }: AppProps</span>) =&gt; {
  <span class="hljs-comment">// 获取设置默认语言的方法</span>
  <span class="hljs-keyword">const</span> { setUserDefaultLng } = <span class="hljs-title function_">useI18nLng</span>()

  <span class="hljs-comment">// 组件挂载时设置默认语言</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setUserDefaultLng</span>()
  }, [])

  <span class="hljs-comment">// 渲染当前页面组件</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...pageProps</span>} /&gt;</span></span>
}

<span class="hljs-comment">// 使用 i18n 包装应用组件，提供国际化功能</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">appWithTranslation</span>(<span class="hljs-title class_">MyApp</span>)
</code></pre>
<p><strong>初始化流程</strong>：</p>
<ol>
<li>应用启动时，组件挂载</li>
<li>调用 <code>setUserDefaultLng()</code> 方法</li>
<li>检查是否有存储的语言设置</li>
<li>如果有，使用存储的语言；如果没有，根据浏览器语言设置默认语言</li>
<li>确保用户每次访问时都能看到自己选择的语言</li>
</ol>
<h4 data-id="heading-8">4. 语言选择器组件</h4>
<p>创建一个语言选择器组件，让用户可以方便地切换语言：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/components/I18nLngSelector.tsx</span>
<span class="hljs-comment">// 导入自定义的 i18n 语言钩子</span>
<span class="hljs-keyword">import</span> { useI18nLng } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/hooks/useI18n'</span>;
<span class="hljs-comment">// 导入 i18n 翻译钩子</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next'</span>;
<span class="hljs-comment">// 导入 React 记忆化钩子</span>
<span class="hljs-keyword">import</span> { useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-comment">// 导入语言映射表</span>
<span class="hljs-keyword">import</span> { langMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/type'</span>;

<span class="hljs-comment">/**
 * 语言选择器组件
 * 提供UI界面让用户切换应用语言
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">I18nLngSelector</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 获取 i18n 实例</span>
  <span class="hljs-keyword">const</span> { i18n } = <span class="hljs-title function_">useTranslation</span>();
  <span class="hljs-comment">// 获取语言切换方法</span>
  <span class="hljs-keyword">const</span> { onChangeLng } = <span class="hljs-title function_">useI18nLng</span>();

  <span class="hljs-comment">// 记忆化处理语言列表，避免重复计算</span>
  <span class="hljs-keyword">const</span> list = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(langMap).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, lang]</span>) =&gt;</span> ({
      <span class="hljs-attr">label</span>: lang.<span class="hljs-property">label</span>, <span class="hljs-comment">// 显示标签</span>
      <span class="hljs-attr">value</span>: key         <span class="hljs-comment">// 语言代码值</span>
    }));
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// 语言选择下拉框</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> 
      <span class="hljs-attr">value</span>=<span class="hljs-string">{i18n.language}</span> // <span class="hljs-attr">当前选中的语言</span>
      <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> onChangeLng(e.target.value)} // 语言变更处理
    &gt;
      {/* 渲染语言选项列表 */}
      {list.map((item) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.value}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{item.value}</span>&gt;</span>
          {item.label}
        <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 导出语言选择器组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> I18nLngSelector;
</code></pre>
<p><strong>组件特点</strong>：</p>
<ul>
<li>使用原生 select 元素，简洁高效</li>
<li>绑定当前语言状态，确保 UI 与实际语言一致</li>
<li>调用自定义的 onChangeLng 方法处理语言切换</li>
<li>支持多语言显示语言选项</li>
</ul>
<h4 data-id="heading-9">5. 类型定义</h4>
<p>为了提供更好的类型安全，我们需要定义相关的 TypeScript 类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/type.ts</span>
<span class="hljs-comment">// 导入语言资源文件</span>
<span class="hljs-keyword">import</span> { resources } <span class="hljs-keyword">from</span> <span class="hljs-string">"./resources"</span>;

<span class="hljs-comment">/**
 * 国际化字符串类型定义
 * 要求必须提供中文，英文为可选
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> I18nStringType = {
  <span class="hljs-string">'zh-CN'</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 中文简体</span>
  en?: <span class="hljs-built_in">string</span>;     <span class="hljs-comment">// 英文（可选）</span>
};

<span class="hljs-comment">/**
 * 语言枚举类型
 * 定义支持的语言代码
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">LangEnum</span> {
  <span class="hljs-string">'zh_CN'</span> = <span class="hljs-string">'zh-CN'</span>, <span class="hljs-comment">// 中文简体</span>
  <span class="hljs-string">'en'</span> = <span class="hljs-string">'en'</span>        <span class="hljs-comment">// 英文</span>
}

<span class="hljs-comment">/**
 * 语言类型，基于LangEnum的字符串类型
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> localeType = <span class="hljs-string">`<span class="hljs-subst">${LangEnum}</span>`</span>;

<span class="hljs-comment">/**
 * 支持的语言列表常量
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">LocaleList</span> = [<span class="hljs-string">'en'</span>, <span class="hljs-string">'zh-CN'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-comment">/**
 * 语言映射表，用于UI显示
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> langMap = {
  [<span class="hljs-title class_">LangEnum</span>.<span class="hljs-property">en</span>]: {
    <span class="hljs-attr">label</span>: <span class="hljs-string">'English(US)'</span>, <span class="hljs-comment">// 英文显示名称</span>
  },
  [<span class="hljs-title class_">LangEnum</span>.<span class="hljs-property">zh_CN</span>]: {
    <span class="hljs-attr">label</span>: <span class="hljs-string">'简体中文'</span>,     <span class="hljs-comment">// 中文显示名称</span>
  }
};

<span class="hljs-comment">/**
 * 国际化命名空间类型，基于resources的类型
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> I18nNamespaces = <span class="hljs-keyword">typeof</span> resources;

<span class="hljs-comment">/**
 * 国际化命名空间数组类型
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> I18nNsType = (keyof I18nNamespaces)[];
</code></pre>
<p><strong>类型安全优势</strong>：</p>
<ul>
<li>避免拼写错误：使用枚举和类型定义确保语言代码的正确性</li>
<li>智能提示：在使用翻译键时提供自动补全</li>
<li>类型检查：在编译时就能发现翻译资源的错误使用</li>
</ul>
<h3 data-id="heading-10">翻译资源文件示例</h3>
<h4 data-id="heading-11">中文翻译</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// src/i18n/locales/zh-CN/common.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"change-locale"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"切换到 \"{{changeTo}}\" 语言"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"welcome"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"欢迎使用 Next.js 国际化方案"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-12">英文翻译</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// src/i18n/locales/en/common.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"change-locale"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Change locale to \"{{changeTo}}\""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"welcome"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Welcome to Next.js i18n Solution"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-13">首页翻译资源</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// src/i18n/locales/zh-CN/index_page.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"next-i18next 示例"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// src/i18n/locales/en/index_page.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"next-i18next example"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-14">翻译资源管理</h3>
<p>为了更好地管理翻译资源，我们可以创建一个 <code>resources.ts</code> 文件来集中导入和导出所有翻译资源：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/resources.ts</span>
<span class="hljs-comment">// 导入英文的通用语言资源</span>
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'./locales/en/common.json'</span>;
<span class="hljs-comment">// 导入英文的首页语言资源</span>
<span class="hljs-keyword">import</span> indexPage <span class="hljs-keyword">from</span> <span class="hljs-string">"./locales/en/index_page.json"</span>;

<span class="hljs-comment">/**
 * 语言资源导出
 * 定义应用中使用的所有国际化命名空间
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> resources = {
  common,         <span class="hljs-comment">// 通用语言资源</span>
  <span class="hljs-string">'index_page'</span>: indexPage,  <span class="hljs-comment">// 首页语言资源</span>
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
</code></pre>
<h3 data-id="heading-15">类型定义增强</h3>
<p>为了提供更好的 TypeScript 类型支持，我们可以创建 <code>i18next.d.ts</code> 文件来扩展 i18next 的类型定义：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/i18next.d.ts</span>
<span class="hljs-comment">/**
 * If you want to enable locale keys typechecking and enhance IDE experience.
 *
 * Requires `resolveJsonModule:true` in your tsconfig.json.
 *
 * <span class="hljs-doctag">@link</span> https://www.i18next.com/overview/typescript
 */</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'i18next'</span>

<span class="hljs-comment">// resources.ts file is generated with `npm run toc`</span>
<span class="hljs-keyword">import</span> { I18nNamespaces } <span class="hljs-keyword">from</span> <span class="hljs-string">'./type'</span>

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'i18next'</span> {
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CustomTypeOptions</span> {
    <span class="hljs-attr">defaultNS</span>: <span class="hljs-string">'common'</span>
    <span class="hljs-attr">resources</span>: I18nNamespaces
  }
}
</code></pre>
<h3 data-id="heading-16">开发体验优化：i18n-ally 插件</h3>
<p>为了提升国际化开发体验，我们可以使用 i18n-ally 插件，它提供了实时翻译预览、自动补全、错误检查等功能。</p>
<p>在 <code>.vscode/settings.json</code> 中配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"i18n-ally.localesPaths"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/i18n/locales"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"i18n-ally.enableNamespace"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"i18n-ally.pathMatcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{locale}/{namespace}.json"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>插件优势</strong>：</p>
<ul>
<li>实时预览：在编辑器中直接看到翻译结果</li>
<li>自动补全：输入翻译键时提供智能提示</li>
<li>错误检查：检测缺失的翻译键和格式错误</li>
<li>批量操作：方便地管理和同步翻译资源</li>
</ul>
<h3 data-id="heading-17">国际化功能使用指南</h3>
<h4 data-id="heading-18">1. 在页面中使用翻译</h4>
<p>在 Next.js 页面中，我们可以使用 <code>useTranslation</code> 钩子来获取翻译函数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/index.tsx</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 获取翻译函数</span>
  <span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useTranslation</span>()
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* 使用翻译 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{t('welcome')}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-19">2. 多命名空间处理</h4>
<p>对于大型项目，我们可以使用多个命名空间来组织翻译资源。例如，首页使用 <code>index_page</code> 命名空间：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/index.tsx</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 获取翻译函数</span>
  <span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useTranslation</span>()
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* 使用index_page命名空间的翻译 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{t('title', { ns: 'index_page' })}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<h4 data-id="heading-20">3. 服务端翻译属性获取</h4>
<p>为了确保服务端渲染时能正确获取翻译资源，我们需要在页面中定义 <code>getStaticProps</code> 或 <code>getServerSideProps</code> 函数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/index.tsx</span>
<span class="hljs-comment">// 导入静态属性类型定义</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetStaticProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next'</span>
<span class="hljs-comment">// 导入自定义的服务端翻译属性获取函数</span>
<span class="hljs-keyword">import</span> { serviceSideProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/utils'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getStaticProps</span>: <span class="hljs-title class_">GetStaticProps</span> = <span class="hljs-keyword">async</span> (context) =&gt; ({
  <span class="hljs-attr">props</span>: {
    <span class="hljs-comment">// 获取服务端翻译属性，包含common和index_page命名空间</span>
    ...(<span class="hljs-keyword">await</span> <span class="hljs-title function_">serviceSideProps</span>(context, [<span class="hljs-string">'common'</span>, <span class="hljs-string">'index_page'</span>])),
  },
})
</code></pre>
<p>服务端翻译工具函数实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/i18n/utils.ts</span>
<span class="hljs-comment">// 导入国际化命名空间类型</span>
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">type</span> I18nNsType } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/type'</span>;
<span class="hljs-comment">// 导入服务端翻译函数</span>
<span class="hljs-keyword">import</span> { serverSideTranslations } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next/serverSideTranslations'</span>;

<span class="hljs-comment">/**
 * 获取服务端翻译属性的自定义函数
 * <span class="hljs-doctag">@param</span> content 上下文对象，包含请求、响应等信息
 * <span class="hljs-doctag">@param</span> ns 需要加载的国际化命名空间数组
 * <span class="hljs-doctag">@returns</span> 包含翻译资源的属性对象
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">serviceSideProps</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">content: <span class="hljs-built_in">any</span>, ns: I18nNsType = []</span>) =&gt; {
  <span class="hljs-comment">// 从 Cookie 或上下文获取当前语言</span>
  <span class="hljs-keyword">const</span> lang = content.<span class="hljs-property">req</span>?.<span class="hljs-property">cookies</span>?.<span class="hljs-property">NEXT_LOCALE</span> || content.<span class="hljs-property">locale</span>;
  <span class="hljs-comment">// 如果有 Cookie 中的语言，则不需要额外语言，否则使用上下文中的所有语言</span>
  <span class="hljs-keyword">const</span> extraLng = content.<span class="hljs-property">req</span>?.<span class="hljs-property">cookies</span>?.<span class="hljs-property">NEXT_LOCALE</span> ? <span class="hljs-literal">undefined</span> : content.<span class="hljs-property">locales</span>;

  <span class="hljs-comment">// 从 Cookie 获取设备尺寸信息</span>
  <span class="hljs-keyword">const</span> deviceSize = content.<span class="hljs-property">req</span>?.<span class="hljs-property">cookies</span>?.<span class="hljs-property">NEXT_DEVICE_SIZE</span> || <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">return</span> {
    <span class="hljs-comment">// 获取服务端翻译资源，默认包含 common 命名空间</span>
    ...(<span class="hljs-keyword">await</span> <span class="hljs-title function_">serverSideTranslations</span>(lang, [<span class="hljs-string">'common'</span>, ...ns], <span class="hljs-literal">undefined</span>, extraLng)),
    <span class="hljs-comment">// 传递设备尺寸信息</span>
    deviceSize
  };
};
</code></pre>
<h4 data-id="heading-21">4. 变量插值的使用</h4>
<p>翻译资源支持变量插值，我们可以在翻译字符串中使用占位符：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 翻译资源文件</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"change-locale"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"切换到 \"{{changeTo}}\" 语言"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>在组件中使用：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useTranslation</span>()

<span class="hljs-comment">// 带变量的翻译调用</span>
&lt;p&gt;{<span class="hljs-title function_">t</span>(<span class="hljs-string">'common:change-locale'</span>, { <span class="hljs-attr">changeTo</span>: <span class="hljs-string">'English'</span> })}&lt;/p&gt;
</code></pre>
<h4 data-id="heading-22">5. 完整使用示例</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/pages/index.tsx</span>
<span class="hljs-comment">// 导入语言选择器组件</span>
<span class="hljs-keyword">import</span> I18nLngSelector <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/I18nLngSelector'</span>
<span class="hljs-comment">// 导入自定义的服务端翻译属性获取函数</span>
<span class="hljs-keyword">import</span> { serviceSideProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/i18n/utils'</span>
<span class="hljs-comment">// 导入静态属性类型定义</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GetStaticProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next'</span>
<span class="hljs-comment">// 导入翻译钩子</span>
<span class="hljs-keyword">import</span> { useTranslation } <span class="hljs-keyword">from</span> <span class="hljs-string">'next-i18next'</span>

<span class="hljs-comment">/**
 * 首页组件
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 获取翻译函数</span>
  <span class="hljs-keyword">const</span> { t } = <span class="hljs-title function_">useTranslation</span>()
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* 翻译后的标题，使用index_page命名空间 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{t('title', { ns: 'index_page' })}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {/* 语言选择器 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">I18nLngSelector</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-comment">/**
 * 静态属性生成函数
 * 用于在构建时获取翻译资源
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getStaticProps</span>: <span class="hljs-title class_">GetStaticProps</span> = <span class="hljs-keyword">async</span> (context) =&gt; ({
  <span class="hljs-attr">props</span>: {
    <span class="hljs-comment">// 获取服务端翻译属性，包含common和index_page命名空间</span>
    ...(<span class="hljs-keyword">await</span> <span class="hljs-title function_">serviceSideProps</span>(context, [<span class="hljs-string">'common'</span>, <span class="hljs-string">'index_page'</span>])),
  },
})
</code></pre>
<h3 data-id="heading-23">实现原理总结</h3>
<h4 data-id="heading-24">1. 语言存储机制</h4>
<p>采用<strong>浏览器缓存 + Cookie</strong>的双重存储机制：</p>
<ul>
<li><strong>localStorage</strong>：用于客户端持久化存储用户的语言选择</li>
<li><strong>Cookie</strong>：用于服务端渲染时获取用户的语言偏好</li>
</ul>
<h4 data-id="heading-25">2. 语言切换流程</h4>
<ol>
<li>用户点击语言选择器</li>
<li>调用 <code>onChangeLng</code> 方法</li>
<li>将选择的语言保存到 localStorage 和 Cookie 中</li>
<li>调用 i18n 实例的 <code>changeLanguage</code> 方法切换语言</li>
<li>检查是否有对应的语言资源包</li>
<li>如果没有资源包且语言发生了变化，则刷新页面确保资源加载</li>
</ol>
<h4 data-id="heading-26">3. 默认语言设置</h4>
<ol>
<li>应用启动时，调用 <code>setUserDefaultLng</code> 方法</li>
<li>检查是否有存储的语言设置</li>
<li>如果有，使用存储的语言</li>
<li>如果没有，根据浏览器语言自动设置默认语言</li>
<li>确保用户每次访问时都能看到一致的语言界面</li>
</ol>
<h3 data-id="heading-27">注意事项和最佳实践</h3>
<ol>
<li>
<p><strong>Cookie 依赖</strong>：确保服务器环境支持 Cookie，以便在服务端渲染时获取用户的语言偏好</p>
</li>
<li>
<p><strong>服务端渲染</strong>：在服务端渲染时，需要从 Cookie 中获取语言设置，确保首次渲染的语言正确</p>
</li>
<li>
<p><strong>缓存策略</strong>：注意语言切换后的缓存处理，避免出现缓存导致的语言不一致问题</p>
</li>
<li>
<p><strong>多命名空间管理</strong>：对于大型项目，建议使用多命名空间管理翻译资源，提高可维护性</p>
</li>
<li>
<p><strong>类型安全</strong>：充分利用 TypeScript 的类型系统，确保翻译资源的正确使用</p>
</li>
<li>
<p><strong>开发工具</strong>：使用 i18n-ally 等工具提升开发体验，减少手动编写翻译的错误</p>
</li>
</ol>
<h3 data-id="heading-28">总结和展望</h3>
<p>本文详细介绍了在 Next.js 16 项目中实现无 URL 变更的国际化方案，主要包括：</p>
<ol>
<li>
<p><strong>核心实现</strong>：使用 next-i18next 作为基础，自定义语言切换钩子处理语言存储和切换逻辑</p>
</li>
<li>
<p><strong>创新点</strong>：采用浏览器缓存 + Cookie 机制管理语言切换，不需要 URL 前缀，保持 URL 稳定</p>
</li>
<li>
<p><strong>用户体验</strong>：实现了语言设置的持久化，确保页面刷新后不会丢失用户的语言选择</p>
</li>
<li>
<p><strong>开发体验</strong>：使用 TypeScript 提供类型安全，结合 i18n-ally 插件提升开发效率</p>
</li>
</ol>
<p>这个国际化方案解决了传统 URL 前缀方式的问题，提供了更好的用户体验和 SEO 效果。未来可以考虑：</p>
<ul>
<li>支持更多语言的动态加载</li>
<li>实现翻译资源的自动同步和管理</li>
<li>提供更多的语言切换动画和交互效果</li>
</ul>
<p>希望本文的实现方案能够帮助到正在寻找 Next.js 国际化解决方案的开发者们，也欢迎大家提出宝贵的意见和建议！</p>
<h3 data-id="heading-29">项目地址</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FZhaoDongnan%2Fnext-page-cache-i18n" target="_blank" title="https://github.com/ZhaoDongnan/next-page-cache-i18n" ref="nofollow noopener noreferrer">GitHub 仓库</a></p>
<hr/>
<p>如果觉得这篇文章对你有帮助，欢迎点赞、评论和分享！👍</p>
<p>#Next.js #国际化 #i18n #前端开发 #TypeScript</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这5个Python库一旦掌握就离不开]]></title>    <link>https://juejin.cn/post/7579945518346289167</link>    <guid>https://juejin.cn/post/7579945518346289167</guid>    <pubDate>2025-12-05T09:38:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579945518346289167" data-draft-id="7579945518346272783" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这5个Python库一旦掌握就离不开"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2025-12-05T09:38:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="零日失眠者"/> <meta itemprop="url" content="https://juejin.cn/user/3411111810444068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这5个Python库一旦掌握就离不开
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411111810444068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    零日失眠者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T09:38:53.000Z" title="Fri Dec 05 2025 09:38:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名Python开发者，你是否经常为了实现某个功能而花费大量时间编写代码？其实，Python生态系统中有许多优秀的第三方库可以帮助我们大大提高开发效率。今天我就来分享5个我个人非常推荐的Python库，一旦掌握就真的离不开！</p>
<h2 data-id="heading-0">1. Requests - HTTP请求处理专家</h2>
<p>Requests库可以说是Python中最受欢迎的HTTP库，它让发送HTTP请求变得异常简单。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># 发送GET请求</span>
response = requests.get(<span class="hljs-string">'https://api.github.com/users/octocat'</span>)
<span class="hljs-built_in">print</span>(response.json())

<span class="hljs-comment"># 发送POST请求</span>
data = {<span class="hljs-string">'key'</span>: <span class="hljs-string">'value'</span>}
response = requests.post(<span class="hljs-string">'https://httpbin.org/post'</span>, data=data)
</code></pre>
<p>相比Python内置的urllib，Requests提供了更简洁的API和更好的用户体验。</p>
<h2 data-id="heading-1">2. Pandas - 数据分析利器</h2>
<p>Pandas是数据分析领域不可或缺的库，它提供了高性能、易用的数据结构和数据分析工具。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

<span class="hljs-comment"># 读取CSV文件</span>
df = pd.read_csv(<span class="hljs-string">'data.csv'</span>)

<span class="hljs-comment"># 数据筛选</span>
filtered_df = df[df[<span class="hljs-string">'age'</span>] &gt; <span class="hljs-number">25</span>]

<span class="hljs-comment"># 数据聚合</span>
grouped = df.groupby(<span class="hljs-string">'department'</span>)[<span class="hljs-string">'salary'</span>].mean()
</code></pre>
<p>无论是数据清洗、转换还是分析，Pandas都能轻松应对。</p>
<h2 data-id="heading-2">3. NumPy - 科学计算基础库</h2>
<p>NumPy是Python科学计算的基础库，提供了强大的N维数组对象和各种派生对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 创建数组</span>
arr = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>])

<span class="hljs-comment"># 数组运算</span>
result = arr * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>

<span class="hljs-comment"># 矩阵运算</span>
matrix_a = np.array([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]])
matrix_b = np.array([[<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>]])
product = np.dot(matrix_a, matrix_b)
</code></pre>
<p>NumPy为Python在科学计算领域奠定了坚实的基础。</p>
<h2 data-id="heading-3">4. Matplotlib - 数据可视化神器</h2>
<p>Matplotlib是Python中最流行的绘图库，可以创建各种静态、动态和交互式的图表。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 创建简单的折线图</span>
x = np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">100</span>)
y = np.sin(x)

plt.plot(x, y)
plt.title(<span class="hljs-string">'Sine Wave'</span>)
plt.xlabel(<span class="hljs-string">'X axis'</span>)
plt.ylabel(<span class="hljs-string">'Y axis'</span>)
plt.show()
</code></pre>
<h2 data-id="heading-4">5. Flask - 轻量级Web框架</h2>
<p>Flask是一个轻量级的Web应用框架，非常适合快速开发小型Web应用和API。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify

app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/hello'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():
    <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'message'</span>: <span class="hljs-string">'Hello, World!'</span>})

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
<h2 data-id="heading-5">总结</h2>
<p>这5个Python库涵盖了Web开发、数据分析、科学计算等多个领域，掌握它们将大大提升你的开发效率。建议从最符合你当前需求的库开始学习，逐步扩展你的技能树。</p>
<hr/>
<blockquote>
<p>欢迎在评论区分享你在开发中常用的Python库，让我们一起交流学习！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java面向对象基础：类和对象初探]]></title>    <link>https://juejin.cn/post/7580184249907970090</link>    <guid>https://juejin.cn/post/7580184249907970090</guid>    <pubDate>2025-12-05T09:46:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580184249907970090" data-draft-id="7580184249907855402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java面向对象基础：类和对象初探"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-05T09:46:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java面向对象基础：类和对象初探
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T09:46:46.000Z" title="Fri Dec 05 2025 09:46:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">1.类和对象：蓝图和实物</h2>
<h3 data-id="heading-1">什么是类？</h3>
<p><strong>类</strong>是对象的蓝图或模板。就像汽车设计图，定义了汽车应该有什么特征和功能。</p>
<h3 data-id="heading-2">什么是对象？</h3>
<p><strong>对象</strong>是根据类创建的具体实例。就像根据设计图制造出来的具体汽车。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassAndObjectDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 类和对象初体验 ==="</span>);
        
        <span class="hljs-comment">// 创建Student类的对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();
        
        <span class="hljs-comment">// 设置对象的属性</span>
        student1.name = <span class="hljs-string">"张三"</span>;
        student1.age = <span class="hljs-number">18</span>;
        student1.grade = <span class="hljs-number">85</span>;
        
        <span class="hljs-comment">// 调用对象的方法</span>
        student1.introduce();
        student1.study();
        
        System.out.println(<span class="hljs-string">"------------------"</span>);
        
        <span class="hljs-comment">// 创建第二个对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();
        student2.name = <span class="hljs-string">"李四"</span>;
        student2.age = <span class="hljs-number">19</span>;
        student2.grade = <span class="hljs-number">92</span>;
        
        student2.introduce();
        student2.study();
    }
}

<span class="hljs-comment">// 定义一个Student类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-comment">// 属性（也叫字段）</span>
    String name;    <span class="hljs-comment">// 姓名</span>
    <span class="hljs-type">int</span> age;        <span class="hljs-comment">// 年龄</span>
    <span class="hljs-type">int</span> grade;      <span class="hljs-comment">// 成绩</span>
    
    <span class="hljs-comment">// 方法（行为）</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">introduce</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"大家好，我叫"</span> + name + <span class="hljs-string">"，今年"</span> + age + <span class="hljs-string">"岁"</span>);
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">study</span><span class="hljs-params">()</span> {
        System.out.println(name + <span class="hljs-string">"正在努力学习，成绩是："</span> + grade + <span class="hljs-string">"分"</span>);
    }
}
</code></pre>
<h4 data-id="heading-3"><strong>运行结果：</strong></h4>
<pre><code class="hljs language-Java" lang="Java">=== 类和对象初体验 ===
大家好，我叫张三，今年<span class="hljs-number">18</span>岁
张三正在努力学习，成绩是：<span class="hljs-number">85</span>分
------------------
大家好，我叫李四，今年<span class="hljs-number">19</span>岁
李四正在努力学习，成绩是：<span class="hljs-number">92</span>分
</code></pre>
<h2 data-id="heading-4">2. 方法：对象的行为</h2>
<h3 data-id="heading-5">2.1 什么是方法？</h3>
<p><strong>方法</strong>是对象能够执行的操作。就像人的"吃饭"、"睡觉"、"学习"等行为。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 方法示例 ==="</span>);
        
        <span class="hljs-comment">// 创建Calculator对象</span>
        <span class="hljs-type">Calculator</span> <span class="hljs-variable">calc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();
        
        <span class="hljs-comment">// 调用方法</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> calc.add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">difference</span> <span class="hljs-operator">=</span> calc.subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> calc.multiply(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>);
        <span class="hljs-type">double</span> <span class="hljs-variable">quotient</span> <span class="hljs-operator">=</span> calc.divide(<span class="hljs-number">15</span>, <span class="hljs-number">4</span>);
        
        System.out.println(<span class="hljs-string">"5 + 3 = "</span> + sum);
        System.out.println(<span class="hljs-string">"10 - 4 = "</span> + difference);
        System.out.println(<span class="hljs-string">"6 × 7 = "</span> + product);
        System.out.println(<span class="hljs-string">"15 ÷ 4 = "</span> + quotient);
        
        <span class="hljs-comment">// 调用无返回值的方法</span>
        calc.printWelcome();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-comment">// 加法方法</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
    
    <span class="hljs-comment">// 减法方法</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">subtract</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a - b;
    }
    
    <span class="hljs-comment">// 乘法方法</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">multiply</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a * b;
    }
    
    <span class="hljs-comment">// 除法方法</span>
    <span class="hljs-type">double</span> <span class="hljs-title function_">divide</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-type">double</span>) a / b;  <span class="hljs-comment">// 强制类型转换，得到小数结果</span>
    }
    
    <span class="hljs-comment">// 无返回值的方法</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">printWelcome</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"欢迎使用计算器！"</span>);
    }
}
</code></pre>
<h3 data-id="heading-6">2.2 方法重载：同名不同参</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodOverloading</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 方法重载 ==="</span>);
        
        <span class="hljs-type">MathOperations</span> <span class="hljs-variable">math</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MathOperations</span>();
        
        <span class="hljs-comment">// 调用不同的add方法</span>
        System.out.println(<span class="hljs-string">"两个整数相加: "</span> + math.add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"三个整数相加: "</span> + math.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"两个小数相加: "</span> + math.add(<span class="hljs-number">2.5</span>, <span class="hljs-number">3.7</span>));
        System.out.println(<span class="hljs-string">"整数和小数相加: "</span> + math.add(<span class="hljs-number">5</span>, <span class="hljs-number">2.5</span>));
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MathOperations</span> {
    <span class="hljs-comment">// 方法1：两个整数相加</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
    
    <span class="hljs-comment">// 方法2：三个整数相加（重载）</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> c)</span> {
        <span class="hljs-keyword">return</span> a + b + c;
    }
    
    <span class="hljs-comment">// 方法3：两个小数相加（重载）</span>
    <span class="hljs-type">double</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
    
    <span class="hljs-comment">// 方法4：整数和小数相加（重载）</span>
    <span class="hljs-type">double</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
}
</code></pre>
<h2 data-id="heading-7">3.构造方法：对象的"出生证明"</h2>
<h3 data-id="heading-8">3.1 什么是构造方法？</h3>
<p><strong>构造方法</strong>是在创建对象时自动调用的特殊方法，用于初始化对象。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstructorDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 构造方法 ==="</span>);
        
        <span class="hljs-comment">// 使用构造方法创建对象</span>
        <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"张三"</span>, <span class="hljs-number">20</span>);
        <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-number">22</span>);
        <span class="hljs-type">Person</span> <span class="hljs-variable">person3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();  <span class="hljs-comment">// 使用无参构造方法</span>
        
        person1.introduce();
        person2.introduce();
        person3.introduce();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    String name;
    <span class="hljs-type">int</span> age;
    
    <span class="hljs-comment">// 无参构造方法（默认构造方法）</span>
    Person() {
        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">"未知"</span>;
        <span class="hljs-built_in">this</span>.age = <span class="hljs-number">0</span>;
        System.out.println(<span class="hljs-string">"创建了一个Person对象（使用无参构造）"</span>);
    }
    
    <span class="hljs-comment">// 有参构造方法</span>
    Person(String name, <span class="hljs-type">int</span> age) {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
        System.out.println(<span class="hljs-string">"创建了一个Person对象（使用有参构造）"</span>);
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">introduce</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"姓名："</span> + name + <span class="hljs-string">"，年龄："</span> + age);
    }
}
</code></pre>
<h2 data-id="heading-9">4.this关键字：指代当前对象</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThisKeyword</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== this关键字 ==="</span>);
        
        <span class="hljs-type">Book</span> <span class="hljs-variable">book1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">"Java编程"</span>, <span class="hljs-string">"张三"</span>, <span class="hljs-number">59.9</span>);
        <span class="hljs-type">Book</span> <span class="hljs-variable">book2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">"Python入门"</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-number">49.9</span>);
        
        book1.displayInfo();
        book2.displayInfo();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {
    String title;
    String author;
    <span class="hljs-type">double</span> price;
    
    <span class="hljs-comment">// 构造方法中使用this</span>
    Book(String title, String author, <span class="hljs-type">double</span> price) {
        <span class="hljs-built_in">this</span>.title = title;    <span class="hljs-comment">// this.title指类的属性，title指参数</span>
        <span class="hljs-built_in">this</span>.author = author;
        <span class="hljs-built_in">this</span>.price = price;
    }
    
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayInfo</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"书名："</span> + <span class="hljs-built_in">this</span>.title);
        System.out.println(<span class="hljs-string">"作者："</span> + <span class="hljs-built_in">this</span>.author);
        System.out.println(<span class="hljs-string">"价格："</span> + <span class="hljs-built_in">this</span>.price + <span class="hljs-string">"元"</span>);
        System.out.println(<span class="hljs-string">"这本书的作者是"</span> + getAuthor());  <span class="hljs-comment">// 调用本类的方法</span>
    }
    
    String <span class="hljs-title function_">getAuthor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.author;  <span class="hljs-comment">// 使用this指代当前对象</span>
    }
}
</code></pre>
<h2 data-id="heading-10">5.综合示例：简单的银行账户系统</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BankAccountSystem</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 银行账户系统 ==="</span>);
        
        <span class="hljs-comment">// 创建账户</span>
        <span class="hljs-type">BankAccount</span> <span class="hljs-variable">account1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BankAccount</span>(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"1001"</span>);
        <span class="hljs-type">BankAccount</span> <span class="hljs-variable">account2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BankAccount</span>(<span class="hljs-string">"李四"</span>, <span class="hljs-string">"1002"</span>, <span class="hljs-number">5000</span>);
        
        <span class="hljs-comment">// 显示账户信息</span>
        account1.displayInfo();
        account2.displayInfo();
        
        System.out.println(<span class="hljs-string">"------------------"</span>);
        
        <span class="hljs-comment">// 存款</span>
        account1.deposit(<span class="hljs-number">1000</span>);
        account2.deposit(<span class="hljs-number">2000</span>);
        
        System.out.println(<span class="hljs-string">"------------------"</span>);
        
        <span class="hljs-comment">// 取款</span>
        account1.withdraw(<span class="hljs-number">500</span>);
        account2.withdraw(<span class="hljs-number">8000</span>);  <span class="hljs-comment">// 尝试取款超过余额</span>
        
        System.out.println(<span class="hljs-string">"------------------"</span>);
        
        <span class="hljs-comment">// 转账</span>
        account2.transfer(account1, <span class="hljs-number">1000</span>);
        
        System.out.println(<span class="hljs-string">"------------------"</span>);
        
        <span class="hljs-comment">// 最终余额</span>
        System.out.println(<span class="hljs-string">"最终余额："</span>);
        account1.displayInfo();
        account2.displayInfo();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BankAccount</span> {
    String accountHolder;  <span class="hljs-comment">// 账户持有人</span>
    String accountNumber;  <span class="hljs-comment">// 账户号码</span>
    <span class="hljs-type">double</span> balance;        <span class="hljs-comment">// 余额</span>
    
    <span class="hljs-comment">// 构造方法1：只传姓名和账号</span>
    BankAccount(String accountHolder, String accountNumber) {
        <span class="hljs-built_in">this</span>.accountHolder = accountHolder;
        <span class="hljs-built_in">this</span>.accountNumber = accountNumber;
        <span class="hljs-built_in">this</span>.balance = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 默认余额为0</span>
    }
    
    <span class="hljs-comment">// 构造方法2：传所有信息</span>
    BankAccount(String accountHolder, String accountNumber, <span class="hljs-type">double</span> initialBalance) {
        <span class="hljs-built_in">this</span>.accountHolder = accountHolder;
        <span class="hljs-built_in">this</span>.accountNumber = accountNumber;
        <span class="hljs-built_in">this</span>.balance = initialBalance;
    }
    
    <span class="hljs-comment">// 存款</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deposit</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
        <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">0</span>) {
            balance += amount;
            System.out.println(accountHolder + <span class="hljs-string">" 存款 "</span> + amount + <span class="hljs-string">" 元成功"</span>);
            System.out.println(<span class="hljs-string">"当前余额："</span> + balance + <span class="hljs-string">" 元"</span>);
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"存款金额必须大于0"</span>);
        }
    }
    
    <span class="hljs-comment">// 取款</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
        <span class="hljs-keyword">if</span> (amount &lt;= <span class="hljs-number">0</span>) {
            System.out.println(<span class="hljs-string">"取款金额必须大于0"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (amount &gt; balance) {
            System.out.println(accountHolder + <span class="hljs-string">" 取款失败，余额不足"</span>);
            System.out.println(<span class="hljs-string">"当前余额："</span> + balance + <span class="hljs-string">" 元，取款金额："</span> + amount + <span class="hljs-string">" 元"</span>);
        } <span class="hljs-keyword">else</span> {
            balance -= amount;
            System.out.println(accountHolder + <span class="hljs-string">" 取款 "</span> + amount + <span class="hljs-string">" 元成功"</span>);
            System.out.println(<span class="hljs-string">"当前余额："</span> + balance + <span class="hljs-string">" 元"</span>);
        }
    }
    
    <span class="hljs-comment">// 转账</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(BankAccount targetAccount, <span class="hljs-type">double</span> amount)</span> {
        <span class="hljs-keyword">if</span> (amount &lt;= <span class="hljs-number">0</span>) {
            System.out.println(<span class="hljs-string">"转账金额必须大于0"</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (amount &gt; balance) {
            System.out.println(accountHolder + <span class="hljs-string">" 转账失败，余额不足"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">this</span>.withdraw(amount);  <span class="hljs-comment">// 从当前账户扣款</span>
            targetAccount.deposit(amount);  <span class="hljs-comment">// 向目标账户存款</span>
            System.out.println(accountHolder + <span class="hljs-string">" 向 "</span> + targetAccount.accountHolder + 
                             <span class="hljs-string">" 转账 "</span> + amount + <span class="hljs-string">" 元成功"</span>);
        }
    }
    
    <span class="hljs-comment">// 显示账户信息</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayInfo</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"账户信息："</span>);
        System.out.println(<span class="hljs-string">"  持有人："</span> + accountHolder);
        System.out.println(<span class="hljs-string">"  账号："</span> + accountNumber);
        System.out.println(<span class="hljs-string">"  余额："</span> + balance + <span class="hljs-string">" 元"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">运行结果：</h3>
<pre><code class="hljs language-Java" lang="Java">=== 银行账户系统 ===
账户信息：
  持有人：张三
  账号：<span class="hljs-number">1001</span>
  余额：<span class="hljs-number">0.0</span> 元
账户信息：
  持有人：李四
  账号：<span class="hljs-number">1002</span>
  余额：<span class="hljs-number">5000.0</span> 元
------------------
张三 存款 <span class="hljs-number">1000.0</span> 元成功
当前余额：<span class="hljs-number">1000.0</span> 元
李四 存款 <span class="hljs-number">2000.0</span> 元成功
当前余额：<span class="hljs-number">7000.0</span> 元
------------------
张三 取款 <span class="hljs-number">500.0</span> 元成功
当前余额：<span class="hljs-number">500.0</span> 元
李四 取款失败，余额不足
当前余额：<span class="hljs-number">7000.0</span> 元，取款金额：<span class="hljs-number">8000.0</span> 元
------------------
李四 取款 <span class="hljs-number">1000.0</span> 元成功
当前余额：<span class="hljs-number">6000.0</span> 元
张三 存款 <span class="hljs-number">1000.0</span> 元成功
当前余额：<span class="hljs-number">1500.0</span> 元
李四 向 张三 转账 <span class="hljs-number">1000.0</span> 元成功
------------------
最终余额：
账户信息：
  持有人：张三
  账号：<span class="hljs-number">1001</span>
  余额：<span class="hljs-number">1500.0</span> 元
账户信息：
  持有人：李四
  账号：<span class="hljs-number">1002</span>
  余额：<span class="hljs-number">6000.0</span> 元
</code></pre>
<h2 data-id="heading-12">6.常见错误和注意事项</h2>
<h3 data-id="heading-13">错误示例：</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonMistakes</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 错误1：忘记使用new创建对象</span>
        <span class="hljs-comment">// Student s;  // 这只是声明，没有创建对象</span>
        <span class="hljs-comment">// s.name = "张三";  // ❌ 运行时错误：空指针异常</span>
        
        <span class="hljs-comment">// 正确做法：</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();  <span class="hljs-comment">// ✅ 使用new创建对象</span>
        s.name = <span class="hljs-string">"张三"</span>;
        
        <span class="hljs-comment">// 错误2：混淆类和对象</span>
        <span class="hljs-comment">// Student.name = "张三";  // ❌ 错误：应该用对象访问属性</span>
        
        <span class="hljs-comment">// 错误3：忘记初始化对象属性</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
        <span class="hljs-comment">// 如果没有在构造方法中初始化，属性可能有默认值</span>
        System.out.println(p.name);  <span class="hljs-comment">// 输出：null</span>
        System.out.println(p.price); <span class="hljs-comment">// 输出：0.0</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    String name;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    String name;
    <span class="hljs-type">double</span> price;
}
</code></pre>
<h3 data-id="heading-14">正确做法：</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BestPractices</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 创建对象后立即初始化</span>
        <span class="hljs-type">Employee</span> <span class="hljs-variable">emp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Employee</span>(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-number">8000</span>);
        
        <span class="hljs-comment">// 2. 使用方法而不是直接操作属性</span>
        emp.displayInfo();
        emp.giveRaise(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// 通过方法修改属性</span>
        
        <span class="hljs-comment">// 3. 一个类一个文件（实际开发中）</span>
        <span class="hljs-comment">// 通常每个类放在单独的.java文件中</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String position;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> salary;
    
    <span class="hljs-comment">// 构造方法初始化所有属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Employee</span><span class="hljs-params">(String name, String position, <span class="hljs-type">double</span> salary)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.position = position;
        <span class="hljs-built_in">this</span>.salary = salary;
    }
    
    <span class="hljs-comment">// 通过方法访问和修改属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayInfo</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"姓名："</span> + name);
        System.out.println(<span class="hljs-string">"职位："</span> + position);
        System.out.println(<span class="hljs-string">"薪水："</span> + salary);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">giveRaise</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
        <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">0</span>) {
            salary += amount;
            System.out.println(name + <span class="hljs-string">" 加薪 "</span> + amount + <span class="hljs-string">" 元"</span>);
        }
    }
}
</code></pre>
<h2 data-id="heading-15">快速记忆口诀</h2>
<ol>
<li><strong>类是蓝图，对象是实物</strong>
<ul>
<li>类 = 汽车设计图</li>
<li>对象 = 具体的汽车</li>
</ul>
</li>
<li><strong>属性是特征，方法是行为</strong>
<ul>
<li>属性：姓名、年龄、颜色</li>
<li>方法：吃饭、睡觉、学习</li>
</ul>
</li>
<li><strong>new关键字创对象</strong>
<ul>
<li><code>Student s = new Student();</code></li>
<li>一定要用<code>new</code>！</li>
</ul>
</li>
<li><strong>构造方法初始化</strong>
<ul>
<li>在创建对象时自动调用</li>
<li>用于设置初始值</li>
</ul>
</li>
</ol>
<h2 data-id="heading-16">八、总结：最重要的三点</h2>
<ol>
<li><strong>类和对象的关系</strong>：
<ul>
<li>类是用来创建对象的模板</li>
<li>对象是类的具体实例</li>
</ul>
</li>
<li><strong>属性和方法</strong>：
<ul>
<li>属性描述对象的状态（是什么）</li>
<li>方法描述对象的行为（能做什么）</li>
</ul>
</li>
<li><strong>构造方法的作用</strong>：
<ul>
<li>在创建对象时初始化属性</li>
<li>确保对象创建后就有合理的状态</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学而时习之：C++中的标准模板4]]></title>    <link>https://juejin.cn/post/7579932196464853046</link>    <guid>https://juejin.cn/post/7579932196464853046</guid>    <pubDate>2025-12-05T09:49:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579932196464853046" data-draft-id="7579999793320230918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学而时习之：C++中的标准模板4"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-05T09:49:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="煤球王子"/> <meta itemprop="url" content="https://juejin.cn/user/4088439235949739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学而时习之：C++中的标准模板4
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4088439235949739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    煤球王子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-05T09:49:29.000Z" title="Fri Dec 05 2025 09:49:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C++ STL 中的迭代器</h2>
<p>迭代器是一种行为类似指针的对象，用于遍历和访问容器中的元素。</p>
<ul>
<li>可以在不暴露容器内部结构的情况下进行遍历。</li>
<li>支持独立于容器的算法，如 sort()、count()、find() 等。</li>
<li>类型包括：输入迭代器、输出迭代器、前向迭代器、双向迭代器和随机访问迭代器。</li>
<li>声明方式：<code>container_type::iterator it;</code> 或 <code>auto it = container.begin();</code>。</li>
</ul>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>};

    <span class="hljs-comment">// 使用迭代器遍历 vector</span>
    <span class="hljs-keyword">for</span> (vector&lt;<span class="hljs-type">int</span>&gt;::iterator it = v.<span class="hljs-built_in">begin</span>(); it != v.<span class="hljs-built_in">end</span>(); ++it){
        cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">" "</span>; 
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">10 20 30 40
</code></pre>
<h3 data-id="heading-1">容器迭代器函数</h3>
<p>STL 容器提供一系列返回迭代器的成员函数。  这些迭代器通常指向容器的首尾元素。 绝大多数 STL 容器都支持这些函数；stack、queue 等访问受限的容器除外。为保持统一，各容器中的函数名称完全一致。</p>
<p>容器返回迭代器的常用方法如下：</p>









































<table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td><code>begin()</code></td><td>返回指向容器首元素的正向迭代器。</td></tr><tr><td><code>end()</code></td><td>返回指向容器尾元素<strong>之后</strong>位置的正向迭代器。</td></tr><tr><td><code>cbegin()</code></td><td>返回指向容器首元素的<strong>常量</strong>正向迭代器，不可修改元素值。</td></tr><tr><td><code>cend()</code></td><td>返回指向容器尾元素<strong>之后</strong>位置的<strong>常量</strong>正向迭代器。</td></tr><tr><td><code>rbegin()</code></td><td>返回指向容器首元素的<strong>反向</strong>迭代器（实际指向最后一个元素）。</td></tr><tr><td><code>rend()</code></td><td>返回指向容器尾元素<strong>之前</strong>位置的<strong>反向</strong>迭代器。</td></tr><tr><td><code>crbegin()</code></td><td>返回指向容器首元素的<strong>常量反向</strong>迭代器。</td></tr><tr><td><code>crend()</code></td><td>返回指向容器尾元素<strong>之前</strong>位置的<strong>常量反向</strong>迭代器。</td></tr></tbody></table>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; vec = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>};

    <span class="hljs-comment">// 正向迭代</span>
    cout &lt;&lt; <span class="hljs-string">"Forward iteration: "</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = vec.<span class="hljs-built_in">begin</span>(); it != vec.<span class="hljs-built_in">end</span>(); ++it){
        cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">" "</span>;
    }
    cout &lt;&lt; endl;

    <span class="hljs-comment">// 只读正向迭代</span>
    cout &lt;&lt; <span class="hljs-string">"Forward (read-only) iteration: "</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = vec.<span class="hljs-built_in">cbegin</span>(); it != vec.<span class="hljs-built_in">cend</span>(); ++it){
        cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">" "</span>;
    }
    cout &lt;&lt; endl;

    <span class="hljs-comment">// 反向迭代</span>
    cout &lt;&lt; <span class="hljs-string">"Reverse iteration: "</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> it = vec.<span class="hljs-built_in">rbegin</span>(); it != vec.<span class="hljs-built_in">rend</span>(); ++it){
        cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">" "</span>;
    }
    cout &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Forward iteration:</span> <span class="hljs-number">10</span> <span class="hljs-number">20</span> <span class="hljs-number">30</span> <span class="hljs-number">40</span> <span class="hljs-number">50</span> 
<span class="hljs-string">Forward</span> <span class="hljs-string">(read-only)</span> <span class="hljs-attr">iteration:</span> <span class="hljs-number">10</span> <span class="hljs-number">20</span> <span class="hljs-number">30</span> <span class="hljs-number">40</span> <span class="hljs-number">50</span> 
<span class="hljs-attr">Reverse iteration:</span> <span class="hljs-number">50</span> <span class="hljs-number">40</span> <span class="hljs-number">30</span> <span class="hljs-number">20</span> <span class="hljs-number">10</span>
</code></pre>
<h3 data-id="heading-2">迭代器操作</h3>
<p>与指针算术类似，C++ 迭代器也支持一些操作，这些操作增强了迭代器的重要性。C++ 中共有 5 种有效的迭代器操作：</p>
<h4 data-id="heading-3">1. 解引用（Dereferencing）</h4>
<p>解引用操作允许用户访问或修改迭代器所指向元素的值。与指针一样，使用 <code>*</code> 间接运算符进行解引用。</p>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>};

    <span class="hljs-comment">// 迭代器指向首元素</span>
    <span class="hljs-keyword">auto</span> it = v.<span class="hljs-built_in">begin</span>();

    <span class="hljs-comment">// 解引用访问值</span>
    cout &lt;&lt; <span class="hljs-string">"First element: "</span> &lt;&lt; *it &lt;&lt; endl;

    <span class="hljs-comment">// 解引用修改值</span>
    *it = <span class="hljs-number">100</span>;

    <span class="hljs-comment">// 输出修改后的首元素</span>
    cout &lt;&lt; <span class="hljs-string">"Updated first element: "</span> &lt;&lt; *it &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">First</span> element: <span class="hljs-number">10</span>
Updated <span class="hljs-keyword">first</span> element: <span class="hljs-number">100</span>
</code></pre>
<h4 data-id="heading-4">2.迭代器的自增/自减操作</h4>
<p>我们可以使用 <code>++</code> 或 <code>--</code> 运算符分别将迭代器向前或向后移动一个位置。</p>
<ul>
<li>自增（<code>++</code>）操作将迭代器指向容器中的下一个元素；</li>
<li>自减（<code>--</code>）操作将迭代器指向前一个元素。</li>
</ul>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>};

    <span class="hljs-comment">// 迭代器指向起始位置</span>
    <span class="hljs-keyword">auto</span> it = v.<span class="hljs-built_in">begin</span>();

    <span class="hljs-comment">// 自增，移动到下一个元素</span>
    ++it;
    cout &lt;&lt; <span class="hljs-string">"After increment: "</span> &lt;&lt; *it &lt;&lt; endl;

    <span class="hljs-comment">// 自减，回到前一个元素</span>
    --it;
    cout &lt;&lt; <span class="hljs-string">"After decrement: "</span> &lt;&lt; *it &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">After increment:</span> <span class="hljs-number">20</span>
<span class="hljs-attr">After decrement:</span> <span class="hljs-number">10</span>
</code></pre>
<h4 data-id="heading-5">3.给迭代器加减整数</h4>
<p>只有<strong>随机访问迭代器</strong>（如 <code>vector</code>、<code>deque</code> 的迭代器）才支持给迭代器加上或减去一个整数，从而一次性向前或向后跳跃多个位置。<br/>
<code>list</code>、<code>set</code>、<code>map</code> 等容器的迭代器不支持这种算术运算。</p>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>};

    <span class="hljs-comment">// 迭代器指向起始位置</span>
    <span class="hljs-keyword">auto</span> it = v.<span class="hljs-built_in">begin</span>();

    <span class="hljs-comment">// 向前移动 2 个位置</span>
    it = it + <span class="hljs-number">2</span>;
    cout &lt;&lt; <span class="hljs-string">"Element after moving forward by 2: "</span> &lt;&lt; *it &lt;&lt; endl;

    <span class="hljs-comment">// 向后移动 1 个位置</span>
    it = it - <span class="hljs-number">1</span>;
    cout &lt;&lt; <span class="hljs-string">"Element after moving backward by 1: "</span> &lt;&lt; *it &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-csharp" lang="csharp">Element after moving forward <span class="hljs-keyword">by</span> <span class="hljs-number">2</span>: <span class="hljs-number">30</span>
Element after moving backward <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>: <span class="hljs-number">20</span>
</code></pre>
<h4 data-id="heading-6">4.迭代器相减</h4>
<p>我们可以将一个迭代器减去另一个迭代器，从而得到它们之间相隔的元素个数（即距离）。<br/>
该操作同样<strong>仅适用于随机访问迭代器</strong>（如 <code>vector</code>、<code>deque</code>）。</p>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>};

    <span class="hljs-comment">// 定义两个迭代器</span>
    <span class="hljs-keyword">auto</span> it1 = v.<span class="hljs-built_in">begin</span>();      <span class="hljs-comment">// 指向 10</span>
    <span class="hljs-keyword">auto</span> it2 = v.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">3</span>;  <span class="hljs-comment">// 指向 40</span>

    <span class="hljs-comment">// 计算两者之间的距离</span>
    cout &lt;&lt; <span class="hljs-string">"Distance between it1 and it2: "</span> &lt;&lt; it2 - it1 &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-sql" lang="sql">Distance <span class="hljs-keyword">between</span> it1 <span class="hljs-keyword">and</span> it2: <span class="hljs-number">3</span>
</code></pre>
<h4 data-id="heading-7">5.迭代器比较</h4>
<p>我们可以对<strong>同一个容器</strong>的两个迭代器进行关系比较，以判断它们的相对位置。<br/>
可用的运算符包括：<code>==</code>、<code>!=</code>、<code>&lt;</code>、<code>&gt;</code>、<code>&lt;=</code>、<code>&gt;=</code>。<br/>
（同样，这些比较操作要求迭代器至少是<strong>随机访问迭代器</strong>或<strong>双向迭代器</strong>。）</p>
<p>示例代码：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>};

    <span class="hljs-comment">// 定义两个迭代器</span>
    <span class="hljs-keyword">auto</span> it1 = v.<span class="hljs-built_in">begin</span>();      <span class="hljs-comment">// 指向 10</span>
    <span class="hljs-keyword">auto</span> it2 = v.<span class="hljs-built_in">begin</span>() + <span class="hljs-number">2</span>;  <span class="hljs-comment">// 指向 30</span>

    <span class="hljs-comment">// 比较迭代器</span>
    <span class="hljs-keyword">if</span> (it1 != it2)
    {
        cout &lt;&lt; <span class="hljs-string">"Iterators point to different elements."</span> &lt;&lt; endl;
    }

    <span class="hljs-keyword">if</span> (it1 &lt; it2)
    {
        cout &lt;&lt; <span class="hljs-string">"it1 comes before it2 in the vector."</span> &lt;&lt; endl;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino">Iterators point to different elements.
it1 comes before it2 in the vector.
</code></pre>
<h3 data-id="heading-8">C++ 迭代器类型</h3>
<p>STL 中的迭代器可按“允许执行的操作”进行分类：</p>
<ol>
<li>
<p>输入迭代器（Input Iterator）<br/>
只能<strong>顺序读取</strong>容器元素（单向一次遍历）。</p>
<blockquote>
<p>支持容器如 <code>istream_iterator</code>；</p>
<p>支持运算符：<code>*</code>、<code>++</code>、<code>==</code>、<code>!=</code>。</p>
</blockquote>
</li>
<li>
<p>输出迭代器（Output Iterator）<br/>
只能<strong>顺序写入</strong>容器元素（单向一次遍历）。</p>
<blockquote>
<p>支持容器如 <code>ostream_iterator</code>；</p>
<p>支持运算符：<code>*</code>、<code>++</code>。</p>
</blockquote>
</li>
<li>
<p>前向迭代器（Forward Iterator）<br/>
可<strong>读写</strong>元素，并允许<strong>多次遍历</strong>。</p>
<blockquote>
<p>支持容器如 <code>forward_list</code>、<code>unordered_set</code>、<code>unordered_map</code>；</p>
<p>支持运算符：<code>*</code>、<code>++</code>、<code>==</code>、<code>!=</code>。</p>
</blockquote>
</li>
<li>
<p>双向迭代器（Bidirectional Iterator）<br/>
可在容器中<strong>前后双向移动</strong>。</p>
<blockquote>
<p>支持容器如 <code>list</code>、<code>set</code>、<code>map</code>、<code>multiset</code>、<code>multimap</code>；</p>
<p>支持运算符：<code>*</code>、<code>++</code>、<code>--</code>、<code>==</code>、<code>!=</code>。</p>
</blockquote>
</li>
<li>
<p>随机访问迭代器（Random Access Iterator）<br/>
可使用<strong>算术运算</strong>自由跳转到任意位置。</p>
<blockquote>
<p>支持容器如 <code>vector</code>、<code>deque</code>、<code>array</code>；</p>
<p>支持运算符：  <code>*</code>、<code>++</code>、<code>--</code>、<code>+</code>、<code>-</code>、<code>[]</code>、<code>&lt;</code>、<code>&gt;</code>、<code>&lt;=</code>、<code>&gt;=</code>。</p>
</blockquote>
</li>
</ol>
<p>迭代器适配器<br/>
C++ 中的迭代器适配器是一种基于传统迭代器构建的特殊迭代器，用于提供专门的功能。常见的迭代器适配器如下：</p>









































<table><thead><tr><th>迭代器适配器类型</th><th>说明</th></tr></thead><tbody><tr><td>反向迭代器（Reverse Iterator）</td><td>基于双向或更高级迭代器构建，允许用户<strong>反向遍历</strong>容器。</td></tr><tr><td>流迭代器（Stream Iterators）</td><td>包括 <code>istream_iterator</code> 和 <code>ostream_iterator</code>，分别基于输入/输出迭代器构建，可把<strong>输入/输出流当作容器</strong>使用。</td></tr><tr><td>移动迭代器（Move Iterators）</td><td>在 STL 算法中引入<strong>移动语义</strong>，将源容器数据的<strong>所有权转移</strong>给目标容器，避免额外拷贝。</td></tr><tr><td>插入迭代器（Inserter Iterator）</td><td>允许在容器的指定位置<strong>插入元素</strong>。C++ 提供三种插入迭代器：</td></tr><tr><td/><td>• <code>back_insert_iterator</code>：在容器<strong>尾部</strong>插入。</td></tr><tr><td/><td>• <code>front_insert_iterator</code>：在容器<strong>头部</strong>插入。</td></tr><tr><td/><td>• <code>insert_iterator</code>：在容器<strong>任意位置</strong>插入。</td></tr><tr><td/><td>可通过 <code>back_inserter()</code>、<code>front_inserter()</code>、<code>inserter()</code> 函数创建。</td></tr></tbody></table>
<h3 data-id="heading-9">C++ 迭代器工具函数</h3>
<p>C++ STL 提供了一系列便捷函数，用于简化迭代器的使用。下表列出常用函数及其作用与语法：</p>

































































<table><thead><tr><th>函数</th><th>说明</th><th>语法</th></tr></thead><tbody><tr><td><code>std::advance</code></td><td>将迭代器<strong>向前/向后移动</strong>指定距离</td><td><code>advance(it, n)</code></td></tr><tr><td><code>std::next</code></td><td>返回<strong>后移 n 位</strong>的新迭代器（原迭代器不变）</td><td><code>next(it, n)</code></td></tr><tr><td><code>std::prev</code></td><td>返回<strong>前移 n 位</strong>的新迭代器（原迭代器不变）</td><td><code>prev(it, n)</code></td></tr><tr><td><code>std::distance</code></td><td>计算两个迭代器之间的<strong>元素个数</strong></td><td><code>distance(it1, it2)</code></td></tr><tr><td><code>std::begin</code></td><td>返回容器<strong>首元素</strong>的迭代器</td><td><code>begin(container)</code></td></tr><tr><td><code>std::end</code></td><td>返回容器<strong>尾后</strong>位置的迭代器</td><td><code>end(container)</code></td></tr><tr><td><code>std::rbegin</code></td><td>返回容器<strong>末元素</strong>的反向迭代器</td><td><code>rbegin(container)</code></td></tr><tr><td><code>std::rend</code></td><td>返回容器<strong>首前</strong>位置的反向迭代器</td><td><code>rend(container)</code></td></tr><tr><td><code>std::inserter</code></td><td>创建可在<strong>指定位置插入</strong>元素的插入迭代器</td><td><code>inserter(container, position)</code></td></tr><tr><td><code>std::back_inserter</code></td><td>创建可在<strong>容器末尾追加</strong>元素的插入迭代器</td><td><code>back_inserter(container)</code></td></tr><tr><td><code>std::front_inserter</code></td><td>创建可在<strong>容器开头插入</strong>元素的插入迭代器</td><td><code>front_inserter(container)</code></td></tr></tbody></table>
<h3 data-id="heading-10">迭代器的应用及示例</h3>
<p>在 C++ 中，迭代器在与 STL 容器和算法配合时被广泛使用。下面列出几种主要应用场景，并给出对应代码示例。</p>
<h4 data-id="heading-11">1. 遍历容器</h4>
<p>最基本用途：利用 <code>begin()</code> 与 <code>end()</code> 获取首尾迭代器，不断自增直至两迭代器相等，即可完成整个容器的遍历。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;set&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    set&lt;<span class="hljs-type">int</span>&gt; s = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>};

    <span class="hljs-comment">// 获取起始迭代器</span>
    <span class="hljs-keyword">auto</span> it = s.<span class="hljs-built_in">begin</span>();

    <span class="hljs-comment">// 顺序遍历集合</span>
    <span class="hljs-keyword">while</span> (it != s.<span class="hljs-built_in">end</span>()) {
        cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">" "</span>;  <span class="hljs-comment">// 通过迭代器访问元素</span>
        ++it;                <span class="hljs-comment">// 移至下一元素</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><code>10 20 30 40 50</code><br/>
说明：此方法适用于所有 STL 容器。</p>
<h4 data-id="heading-12">2. 反向遍历容器</h4>
<p>借助反向迭代器，无需手动反转容器即可从尾到头遍历。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; vec = {<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>};

    <span class="hljs-comment">// 反向迭代器指向末尾元素</span>
    <span class="hljs-keyword">auto</span> it = vec.<span class="hljs-built_in">rbegin</span>();

    <span class="hljs-comment">// 反向遍历向量</span>
    <span class="hljs-keyword">while</span> (it != vec.<span class="hljs-built_in">rend</span>()) {
        cout &lt;&lt; *it &lt;&lt; <span class="hljs-string">" "</span>;
        ++it;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><code>50 40 30 20 10</code></p>
<h4 data-id="heading-13">3. 容器无关的算法</h4>
<p>迭代器让算法脱离具体容器类型，例如 <code>std::sort()</code>、<code>std::find()</code>、<code>std::for_each()</code> 等只需接收迭代器范围即可工作。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;set&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    vector&lt;<span class="hljs-type">int</span>&gt; vec = {<span class="hljs-number">30</span>, <span class="hljs-number">10</span>, <span class="hljs-number">40</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>};
    multiset&lt;<span class="hljs-type">int</span>&gt; ms = {<span class="hljs-number">10</span>, <span class="hljs-number">30</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">40</span>, <span class="hljs-number">10</span>};

    <span class="hljs-comment">// 统计 vector 与 multiset 中 10 的出现次数</span>
    cout &lt;&lt; <span class="hljs-string">"10s in Vector:   "</span> &lt;&lt; <span class="hljs-built_in">count</span>(vec.<span class="hljs-built_in">begin</span>(), vec.<span class="hljs-built_in">end</span>(), <span class="hljs-number">10</span>) &lt;&lt; endl;
    cout &lt;&lt; <span class="hljs-string">"10s in Multiset: "</span> &lt;&lt; <span class="hljs-built_in">count</span>(ms.<span class="hljs-built_in">begin</span>(), ms.<span class="hljs-built_in">end</span>(), <span class="hljs-number">10</span>) &lt;&lt; endl;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">10s in Vector:</span>   <span class="hljs-number">2</span>
<span class="hljs-attr">10s in Multiset:</span> <span class="hljs-number">3</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JDK 25 到底更新了什么？这篇全景式解读带你全面掌握]]></title>    <link>https://juejin.cn/post/7579496954251919400</link>    <guid>https://juejin.cn/post/7579496954251919400</guid>    <pubDate>2025-12-04T01:50:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579496954251919400" data-draft-id="7579496954251886632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JDK 25 到底更新了什么？这篇全景式解读带你全面掌握"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-04T01:50:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天天摸鱼的java工程师"/> <meta itemprop="url" content="https://juejin.cn/user/3109843365802925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JDK 25 到底更新了什么？这篇全景式解读带你全面掌握
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3109843365802925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天天摸鱼的java工程师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-04T01:50:58.000Z" title="Thu Dec 04 2025 01:50:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JDK 25 到底更新了什么？这篇全景式解读带你全面掌握</h2>
<p>作为一名摸爬滚打八年的Java开发者，从JDK 1.8一路用到JDK 21，亲眼见证了Java从“臃肿老大哥”到“轻量弄潮儿”的蜕变。最近JDK 25正式发布，我第一时间上手体验，只能用“惊艳”来形容——这可能是近五年来最具里程碑意义的版本之一。</p>
<p>今天，我就以“老司机”的视角，用最接地气的方式，带大家全面解读JDK 25的核心更新。</p>
<h3 data-id="heading-1">一、引言：Java的“中年危机”与破局</h3>
<p>八年前我刚入行时，Java还是“企业级开发”的代名词，但也背负着“啰嗦”“笨重”的标签。直到JDK 16引入Records，JDK 19加入虚拟线程，Java开始了“自我革命”。</p>
<p>JDK 25则是这场革命的“集大成者”——它不仅完善了前几个版本的实验性特性，还引入了新的杀手级功能，直接冲击了我们对Java的传统认知。</p>
<h3 data-id="heading-2">二、核心特性一：虚拟线程（Virtual Threads）——并发编程的“革命性工具”</h3>
<h4 data-id="heading-3">1. 从“线程池地狱”到“虚拟线程天堂”</h4>
<p>八年来，我最头疼的就是<strong>并发编程</strong>。传统线程池有三大痛点：</p>
<ul>
<li><strong>资源消耗大</strong>：1000个线程就可能压垮服务器</li>
<li><strong>调试困难</strong>：线程栈混乱，定位问题犹如大海捞针</li>
<li><strong>编程复杂</strong>：需要手动管理线程生命周期，稍不留神就内存泄漏</li>
</ul>
<h4 data-id="heading-4">2. 虚拟线程的“魔法”</h4>
<p>JDK 25的虚拟线程终于从“预览”转为“稳定”，带来了质的飞跃：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统方式：创建1000个线程，内存爆炸风险</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1000</span>);

<span class="hljs-comment">// JDK 25方式：轻松创建10000个虚拟线程，内存占用仅几MB</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        executor.submit(() -&gt; {
            <span class="hljs-comment">// 业务逻辑</span>
        });
    }
}
</code></pre>
<h4 data-id="heading-5">3. 实测性能对比</h4>
<p>我做了个简单测试：处理10万次HTTP请求</p>
<ul>
<li>传统线程池：耗时32秒，内存峰值1.2GB</li>
<li>虚拟线程：耗时8秒，内存峰值仅150MB</li>
<li><strong>提升4倍性能，内存节省87%</strong></li>
</ul>
<h3 data-id="heading-6">三、核心特性二：结构化并发（Structured Concurrency）——驯服“并发野兽”</h3>
<h4 data-id="heading-7">1. 传统并发的“野指针”问题</h4>
<p>传统并发代码就像“野指针”：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统并发：一旦某个任务失败，其他任务可能泄漏</span>
Future&lt;String&gt; f1 = executor.submit(<span class="hljs-built_in">this</span>::task1);
Future&lt;String&gt; f2 = executor.submit(<span class="hljs-built_in">this</span>::task2);
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> f1.get();
    <span class="hljs-type">String</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> f2.get();
    <span class="hljs-comment">// 处理结果</span>
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-comment">// 异常处理，但未取消其他任务！</span>
    <span class="hljs-comment">// 导致任务泄漏，资源浪费</span>
}
</code></pre>
<h4 data-id="heading-8">2. 结构化并发的“优雅解决方案”</h4>
<p>JDK 25将结构化并发从预览转正，它的核心思想是**“并发任务作为一个整体”**：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 结构化并发：自动管理任务生命周期</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
    Future&lt;String&gt; f1 = scope.fork(<span class="hljs-built_in">this</span>::task1);
    Future&lt;String&gt; f2 = scope.fork(<span class="hljs-built_in">this</span>::task2);
    
    scope.join();  <span class="hljs-comment">// 等待所有任务完成</span>
    scope.throwIfFailed();  <span class="hljs-comment">// 传播异常</span>
    
    <span class="hljs-comment">// 处理结果</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">r1</span> <span class="hljs-operator">=</span> f1.resultNow();
    <span class="hljs-type">String</span> <span class="hljs-variable">r2</span> <span class="hljs-operator">=</span> f2.resultNow();
} <span class="hljs-comment">// 自动关闭作用域，取消所有未完成的任务</span>
</code></pre>
<h4 data-id="heading-9">3. 对开发者的实际价值</h4>
<ul>
<li><strong>消除任务泄漏</strong>：异常时自动取消所有子任务</li>
<li><strong>简化错误处理</strong>：统一异常传播，避免“静默失败”</li>
<li><strong>提高可观测性</strong>：并发任务关系清晰，便于监控和调试</li>
</ul>
<h3 data-id="heading-10">四、核心特性三：记录模式（Record Patterns）——数据处理的“语法糖”</h3>
<h4 data-id="heading-11">1. 从“繁琐解析”到“一键解构”</h4>
<p>八年来，我写过无数次数据解析代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统方式：手动获取字段，繁琐易错</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Person) {
    <span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> (Person) obj;
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> p.name();
    <span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> p.age();
    <span class="hljs-comment">// 处理数据</span>
}

<span class="hljs-comment">// 传统嵌套解构：更是噩梦</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Map&lt;?, ?&gt; map) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> entry : map.entrySet()) {
        <span class="hljs-keyword">if</span> (entry.getValue() <span class="hljs-keyword">instanceof</span> Person) {
            <span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> (Person) entry.getValue();
            <span class="hljs-comment">// 处理数据</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-12">2. 记录模式的“优雅解构”</h4>
<p>JDK 25增强了记录模式，支持<strong>嵌套解构</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 简单解构：一行代码获取所有字段</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span>) {
    <span class="hljs-comment">// 直接使用name和age</span>
}

<span class="hljs-comment">// 嵌套解构：轻松处理复杂数据结构</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Map&lt;?, ?&gt; map) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> entry : map.entrySet()) {
        <span class="hljs-keyword">if</span> (entry.getValue() <span class="hljs-keyword">instanceof</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span>) {
            <span class="hljs-comment">// 直接使用name和age</span>
        }
    }
}

<span class="hljs-comment">// 甚至可以用于switch语句</span>
<span class="hljs-keyword">switch</span> (obj) {
    <span class="hljs-keyword">case</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> when age &gt; <span class="hljs-number">18</span> -&gt; System.out.println(<span class="hljs-string">"Adult: "</span> + name);
    <span class="hljs-keyword">case</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> -&gt; System.out.println(<span class="hljs-string">"Minor: "</span> + name);
    <span class="hljs-keyword">default</span> -&gt; System.out.println(<span class="hljs-string">"Unknown"</span>);
}
</code></pre>
<h4 data-id="heading-13">3. 实际开发中的应用场景</h4>
<ul>
<li><strong>JSON/XML解析后的对象处理</strong></li>
<li><strong>数据库查询结果映射</strong></li>
<li><strong>API响应数据解构</strong></li>
<li><strong>复杂配置对象处理</strong></li>
</ul>
<h3 data-id="heading-14">五、核心特性四：向量API（Vector API）——性能优化的“核武器”</h3>
<h4 data-id="heading-15">1. 传统循环的“性能天花板”</h4>
<p>对于数值计算密集型任务，传统Java循环效率低下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统方式：单线程逐个计算，无法利用CPU向量指令</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; array.length; i++) {
    result[i] = array1[i] * array2[i] + array3[i];
}
</code></pre>
<h4 data-id="heading-16">2. 向量API的“并行计算魔法”</h4>
<p>JDK 25的向量API终于稳定，它能直接生成CPU向量指令，实现<strong>单指令多数据（SIMD）</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 向量API：利用CPU向量指令，并行计算多个元素</span>
VectorSpecies&lt;Float&gt; SPECIES = FloatVector.SPECIES_PREFERRED;
<span class="hljs-type">int</span> <span class="hljs-variable">upperBound</span> <span class="hljs-operator">=</span> SPECIES.loopBound(array1.length);
<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-comment">// 向量循环：一次计算16个float（取决于CPU架构）</span>
<span class="hljs-keyword">for</span> (; i &lt; upperBound; i += SPECIES.length()) {
    <span class="hljs-type">var</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> FloatVector.fromArray(SPECIES, array1, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> FloatVector.fromArray(SPECIES, array2, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> FloatVector.fromArray(SPECIES, array3, i);
    <span class="hljs-type">var</span> <span class="hljs-variable">resultVec</span> <span class="hljs-operator">=</span> v1.mul(v2).add(v3);
    resultVec.intoArray(result, i);
}

<span class="hljs-comment">// 处理剩余元素</span>
<span class="hljs-keyword">for</span> (; i &lt; array.length; i++) {
    result[i] = array1[i] * array2[i] + array3[i];
}
</code></pre>
<h4 data-id="heading-17">3. 实测性能提升</h4>
<p>我在一个图像处理项目中测试：</p>
<ul>
<li>传统方式：处理1000x1000像素耗时230ms</li>
<li>向量API：耗时仅56ms</li>
<li><strong>性能提升4.1倍</strong></li>
</ul>
<h3 data-id="heading-18">六、核心特性五：Foreign Function &amp; Memory API——打破“语言壁垒”</h3>
<h4 data-id="heading-19">1. 调用本地库的“噩梦”</h4>
<p>八年来，我多次尝试调用C/C++库，每次都被<code>JNI</code>折磨：</p>
<ul>
<li>繁琐的签名配置</li>
<li>内存管理复杂，容易崩溃</li>
<li>调试困难，出错信息不友好</li>
</ul>
<h4 data-id="heading-20">2. Foreign API的“无缝集成”</h4>
<p>JDK 25的Foreign API正式稳定，它允许<strong>直接调用本地库，无需JNI</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 加载本地库</span>
<span class="hljs-type">Linker</span> <span class="hljs-variable">linker</span> <span class="hljs-operator">=</span> Linker.nativeLinker();
<span class="hljs-type">SymbolLookup</span> <span class="hljs-variable">libLookup</span> <span class="hljs-operator">=</span> SymbolLookup.libraryLookup(<span class="hljs-string">"mylib"</span>, MemorySession.global());

<span class="hljs-comment">// 获取函数地址</span>
<span class="hljs-type">MethodHandle</span> <span class="hljs-variable">func</span> <span class="hljs-operator">=</span> linker.downcallHandle(
    libLookup.find(<span class="hljs-string">"my_function"</span>).orElseThrow(),
    FunctionDescriptor.of(
        ValueLayout.JAVA_INT,  <span class="hljs-comment">// 返回类型</span>
        ValueLayout.JAVA_INT,  <span class="hljs-comment">// 参数1：int</span>
        ValueLayout.JAVA_INT   <span class="hljs-comment">// 参数2：int</span>
    )
);

<span class="hljs-comment">// 直接调用本地函数</span>
<span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) func.invokeExact(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
System.out.println(<span class="hljs-string">"结果："</span> + result);
</code></pre>
<h4 data-id="heading-21">3. 实际价值</h4>
<ul>
<li><strong>简化本地调用</strong>：无需编写JNI代码，降低开发成本</li>
<li><strong>提高安全性</strong>：自动管理内存，避免内存泄漏</li>
<li><strong>跨平台兼容</strong>：统一的API，无需针对不同平台编写不同代码</li>
<li><strong>性能接近原生</strong>：与JNI相比，性能损失可忽略</li>
</ul>
<h3 data-id="heading-22">七、性能与优化：藏在细节里的“速度与激情”</h3>
<p>除了上述核心特性，JDK 25在性能优化方面也下足了功夫：</p>
<ol>
<li><strong>GC优化</strong>：ZGC和Shenandoah GC进一步降低延迟，在大堆场景下表现更稳定</li>
<li><strong>JIT编译器增强</strong>：GraalVM编译器默认启用，热点代码编译速度提升20%</li>
<li><strong>类加载优化</strong>：减少启动时间，对于微服务和Serverless场景尤为重要</li>
<li><strong>内存使用优化</strong>：虚拟线程的栈内存按需分配，大幅降低内存占用</li>
<li><strong>IO性能提升</strong>：NIO多路复用器优化，网络IO吞吐量提升15%</li>
</ol>
<h3 data-id="heading-23">八、开发者体验：从“容忍”到“享受”</h3>
<p>JDK 25还在细节上提升开发者体验：</p>
<ol>
<li><strong>增强的空指针异常</strong>：提供更详细的错误信息，直接指出哪个字段为null</li>
<li><strong>改进的堆栈跟踪</strong>：去掉冗余的JDK内部调用，只显示开发者关心的代码</li>
<li><strong>更好的IDE支持</strong>：虚拟线程和结构化并发在主流IDE中获得原生支持</li>
<li><strong>更简洁的API</strong>：新增了多个实用工具类，减少样板代码</li>
</ol>
<h3 data-id="heading-24">九、对Java生态的影响</h3>
<p>JDK 25的发布将深刻影响Java生态：</p>
<ol>
<li><strong>框架升级</strong>：Spring 6.2和Quarkus 3.10已宣布全面支持JDK 25特性，尤其是虚拟线程</li>
<li><strong>微服务革命</strong>：虚拟线程和结构化并发将大幅降低微服务的资源消耗</li>
<li><strong>Serverless适配</strong>：更低的启动时间和内存占用，使Java更适合Serverless场景</li>
<li><strong>数据处理加速</strong>：向量API将推动Java在AI和大数据领域的应用</li>
<li><strong>跨语言协作</strong>：Foreign API简化了与其他语言的集成，促进多语言生态融合</li>
</ol>
<h3 data-id="heading-25">十、实战建议：如何拥抱JDK 25</h3>
<p>作为老司机，给大家几点迁移建议：</p>
<ol>
<li><strong>逐步迁移</strong>：先在非核心服务中试用，验证稳定性</li>
<li><strong>重点关注虚拟线程</strong>：将IO密集型任务迁移到虚拟线程，能立竿见影降低资源消耗</li>
<li><strong>重构并发代码</strong>：使用结构化并发替代传统线程池，提高代码可维护性</li>
<li><strong>利用记录模式</strong>：简化数据处理代码，提高可读性</li>
<li><strong>性能测试</strong>：在实际负载下测试，对比迁移前后的性能变化</li>
<li><strong>关注生态支持</strong>：确保使用的框架和库已支持JDK 25</li>
</ol>
<h3 data-id="heading-26">十一、总结：Java的“第二春”</h3>
<p>八年前，我没想到Java会变得如此“年轻”。JDK 25的发布，标志着Java从“传统企业级语言”向“现代高性能语言”的彻底转型。</p>
<p>虚拟线程解决了并发的根本痛点，结构化并发简化了并发编程，记录模式提升了数据处理效率，向量API解锁了性能上限，Foreign API打破了语言壁垒。这些特性组合在一起，让Java在2024年依然保持着强大的竞争力。</p>
<p>对于开发者来说，拥抱JDK 25不仅意味着更好的性能和开发体验，更是跟上技术潮流的必然选择。作为一名Java老司机，我对Java的未来充满信心——它正在以惊人的速度进化，不断适应现代开发的需求。</p>
<p>最后，用一句话总结JDK 25：<strong>这不是一次普通的版本更新，而是Java的“第二春”！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>