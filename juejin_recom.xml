<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[TanStack Router åŸºäºæ–‡ä»¶çš„è·¯ç”±]]></title>    <link>https://juejin.cn/post/7585400495683305514</link>    <guid>https://juejin.cn/post/7585400495683305514</guid>    <pubDate>2025-12-20T02:17:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585400495683305514" data-draft-id="7585397173022982163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TanStack Router åŸºäºæ–‡ä»¶çš„è·¯ç”±"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T02:17:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çš®è›‹å°ç²¾çµ"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TanStack Router åŸºäºæ–‡ä»¶çš„è·¯ç”±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çš®è›‹å°ç²¾çµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T02:17:28.000Z" title="Sat Dec 20 2025 02:17:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>TanStack Router çš„å¤§éƒ¨åˆ†æ–‡æ¡£éƒ½æ˜¯åŸºäºâ€œåŸºäºæ–‡ä»¶çš„è·¯ç”±â€è¿™ä¸€è§†è§’ç¼–å†™çš„ï¼Œæ—¨åœ¨å¸®åŠ©ä½ æ·±å…¥ç†è§£å¦‚ä½•é…ç½®å®ƒä»¥åŠå…¶èƒŒåçš„æŠ€æœ¯ç»†èŠ‚ã€‚è™½ç„¶<strong>åŸºäºæ–‡ä»¶çš„è·¯ç”±æ˜¯é…ç½® TanStack Router çš„é¦–é€‰å’Œæ¨èæ–¹å¼</strong>ï¼Œä½†å¦‚æœä½ æ„¿æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Frouting%2Fcode-based-routing" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/routing/code-based-routing" ref="nofollow noopener noreferrer">åŸºäºä»£ç çš„è·¯ç”±</a>ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯åŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼Ÿ</h2>
<p>åŸºäºæ–‡ä»¶çš„è·¯ç”±æ˜¯ä¸€ç§åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥é…ç½®è·¯ç”±çš„æ–¹å¼ã€‚ä½ ä¸éœ€è¦é€šè¿‡ä»£ç å®šä¹‰è·¯ç”±ç»“æ„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ç³»åˆ—ä»£è¡¨åº”ç”¨ç¨‹åºè·¯ç”±å±‚çº§çš„æ–‡ä»¶å’Œç›®å½•æ¥å®šä¹‰è·¯ç”±ã€‚è¿™å¸¦æ¥äº†è®¸å¤šå¥½å¤„ï¼š</p>
<ul>
<li>
<p><strong>ç®€å•æ€§ (Simplicity)</strong>ï¼šå¯¹äºæ–°æ‰‹å’Œç»éªŒä¸°å¯Œçš„å¼€å‘è€…æ¥è¯´ï¼ŒåŸºäºæ–‡ä»¶çš„è·¯ç”±éƒ½åœ¨è§†è§‰ä¸Šæ›´ç›´è§‚ä¸”æ˜“äºç†è§£ã€‚</p>
</li>
<li>
<p><strong>ç»„ç»‡æ€§ (Organization)</strong>ï¼šè·¯ç”±çš„ç»„ç»‡æ–¹å¼ç›´æ¥é•œåƒäº†åº”ç”¨ç¨‹åºçš„ URL ç»“æ„ã€‚</p>
</li>
<li>
<p><strong>å¯æ‰©å±•æ€§ (Scalability)</strong>ï¼šéšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼ŒåŸºäºæ–‡ä»¶çš„è·¯ç”±ä½¿å¾—æ·»åŠ æ–°è·¯ç”±å’Œç»´æŠ¤ç°æœ‰è·¯ç”±å˜å¾—å®¹æ˜“ã€‚</p>
</li>
<li>
<p><strong>ä»£ç åˆ†å‰² (Code-Splitting)</strong>ï¼šåŸºäºæ–‡ä»¶çš„è·¯ç”±å…è®¸ TanStack Router è‡ªåŠ¨å¯¹è·¯ç”±è¿›è¡Œä»£ç åˆ†å‰²ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p>
</li>
<li>
<p><strong>ç±»å‹å®‰å…¨ (Type-Safety)</strong>ï¼šåŸºäºæ–‡ä»¶çš„è·¯ç”±é€šè¿‡è‡ªåŠ¨ç”Ÿæˆå’Œç®¡ç†è·¯ç”±çš„ç±»å‹é“¾æ¥ï¼Œæå¤§æå‡äº†ç±»å‹å®‰å…¨çš„ä¸Šé™ï¼Œè€Œåœ¨åŸºäºä»£ç çš„è·¯ç”±ä¸­ï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªç¹ççš„è¿‡ç¨‹ã€‚</p>
</li>
<li>
<p><strong>ä¸€è‡´æ€§ (Consistency)</strong>ï¼šåŸºäºæ–‡ä»¶çš„è·¯ç”±å¼ºåˆ¶æ‰§è¡Œä¸€è‡´çš„è·¯ç”±ç»“æ„ï¼Œä½¿å¾—ç»´æŠ¤ã€æ›´æ–°åº”ç”¨ç¨‹åºä»¥åŠåœ¨ä¸åŒé¡¹ç›®é—´è¿ç§»å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
</li>
</ul>
<h2 data-id="heading-1"><code>/</code> è¿˜æ˜¯ <code>.</code> ï¼Ÿ</h2>
<p>è™½ç„¶ç›®å½•é•¿æœŸä»¥æ¥ä¸€ç›´ç”¨äºè¡¨ç¤ºè·¯ç”±å±‚çº§ï¼Œä½†åŸºäºæ–‡ä»¶çš„è·¯ç”±å¼•å…¥äº†ä¸€ä¸ªé¢å¤–çš„æ¦‚å¿µï¼šåœ¨æ–‡ä»¶åä¸­ä½¿ç”¨ <code>.</code> å­—ç¬¦æ¥è¡¨ç¤ºè·¯ç”±åµŒå¥—ã€‚è¿™å…è®¸ä½ é¿å…ä¸ºå°‘é‡æ·±åº¦åµŒå¥—çš„è·¯ç”±åˆ›å»ºç›®å½•ï¼ŒåŒæ—¶ç»§ç»­ä¸ºæ›´å¹¿æ³›çš„è·¯ç”±å±‚çº§ä½¿ç”¨ç›®å½•ã€‚è®©æˆ‘ä»¬çœ‹ä¸€äº›ä¾‹å­ï¼</p>
<h2 data-id="heading-2">ç›®å½•è·¯ç”± (Directory Routes)</h2>
<p>ç›®å½•å¯ç”¨äºè¡¨ç¤ºè·¯ç”±å±‚çº§ï¼Œè¿™å¯¹äºå°†å¤šä¸ªè·¯ç”±ç»„ç»‡æˆé€»è¾‘ç»„ä»¥åŠå‡å°‘å¤§é‡æ·±åº¦åµŒå¥—è·¯ç”±çš„æ–‡ä»¶åé•¿åº¦éå¸¸æœ‰ç”¨ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>





























































































































<table><thead><tr><th><strong>æ–‡ä»¶å (Filename)</strong></th><th><strong>è·¯ç”±è·¯å¾„ (Route Path)</strong></th><th><strong>ç»„ä»¶è¾“å‡º (Component Output)</strong></th></tr></thead><tbody><tr><td>Ê¦ <code>__root.tsx</code></td><td/><td><code>&lt;Root&gt;</code></td></tr><tr><td>Ê¦ <code>index.tsx</code></td><td><code>/</code> (ç²¾ç¡®åŒ¹é…)</td><td><code>&lt;Root&gt;&lt;RootIndex&gt;</code></td></tr><tr><td>Ê¦ <code>about.tsx</code></td><td><code>/about</code></td><td><code>&lt;Root&gt;&lt;About&gt;</code></td></tr><tr><td>Ê¦ <code>posts.tsx</code></td><td><code>/posts</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;</code></td></tr><tr><td>ğŸ“‚ <code>posts</code></td><td/><td/></tr><tr><td>â”„ Ê¦ <code>index.tsx</code></td><td><code>/posts</code> (ç²¾ç¡®åŒ¹é…)</td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;PostsIndex&gt;</code></td></tr><tr><td>â”„ Ê¦ <code>$postId.tsx</code></td><td><code>/posts/$postId</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;Post&gt;</code></td></tr><tr><td>ğŸ“‚ <code>posts_</code></td><td/><td/></tr><tr><td>â”„ ğŸ“‚ <code>$postId</code></td><td/><td/></tr><tr><td>â”„ â”„ Ê¦ <code>edit.tsx</code></td><td><code>/posts/$postId/edit</code></td><td><code>&lt;Root&gt;&lt;EditPost&gt;</code></td></tr><tr><td>Ê¦ <code>settings.tsx</code></td><td><code>/settings</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;</code></td></tr><tr><td>ğŸ“‚ <code>settings</code></td><td/><td/></tr><tr><td>â”„ Ê¦ <code>profile.tsx</code></td><td><code>/settings/profile</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;&lt;Profile&gt;</code></td></tr><tr><td>â”„ Ê¦ <code>notifications.tsx</code></td><td><code>/settings/notifications</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;&lt;Notifications&gt;</code></td></tr><tr><td>Ê¦ <code>_pathlessLayout.tsx</code></td><td/><td><code>&lt;Root&gt;&lt;PathlessLayout&gt;</code></td></tr><tr><td>ğŸ“‚ <code>_pathlessLayout</code></td><td/><td/></tr><tr><td>â”„ Ê¦ <code>route-a.tsx</code></td><td><code>/route-a</code></td><td><code>&lt;Root&gt;&lt;PathlessLayout&gt;&lt;RouteA&gt;</code></td></tr><tr><td>â”„ Ê¦ <code>route-b.tsx</code></td><td><code>/route-b</code></td><td><code>&lt;Root&gt;&lt;PathlessLayout&gt;&lt;RouteB&gt;</code></td></tr><tr><td>ğŸ“‚ <code>files</code></td><td/><td/></tr><tr><td>â”„ Ê¦ <code>$.tsx</code></td><td><code>/files/$</code></td><td><code>&lt;Root&gt;&lt;Files&gt;</code></td></tr><tr><td>ğŸ“‚ <code>account</code></td><td/><td/></tr><tr><td>â”„ Ê¦ <code>route.tsx</code></td><td><code>/account</code></td><td><code>&lt;Root&gt;&lt;Account&gt;</code></td></tr><tr><td>â”„ Ê¦ <code>overview.tsx</code></td><td><code>/account/overview</code></td><td><code>&lt;Root&gt;&lt;Account&gt;&lt;Overview&gt;</code></td></tr></tbody></table>
<h2 data-id="heading-3">æ‰å¹³è·¯ç”± (Flat Routes)</h2>
<p>æ‰å¹³è·¯ç”±èµ‹äºˆä½ ä½¿ç”¨ <code>.</code> æ¥è¡¨ç¤ºè·¯ç”±åµŒå¥—å±‚çº§çš„èƒ½åŠ›ã€‚</p>
<p>å½“ä½ æœ‰å¤§é‡ç‹¬ç‰¹çš„æ·±åº¦åµŒå¥—è·¯ç”±ï¼Œå¹¶ä¸”å¸Œæœ›é¿å…ä¸ºæ¯ä¸€ä¸ªè·¯ç”±éƒ½åˆ›å»ºç›®å½•æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼š</p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>


























































































<table><thead><tr><th><strong>æ–‡ä»¶å (Filename)</strong></th><th><strong>è·¯ç”±è·¯å¾„ (Route Path)</strong></th><th><strong>ç»„ä»¶è¾“å‡º (Component Output)</strong></th></tr></thead><tbody><tr><td>Ê¦ <code>__root.tsx</code></td><td/><td><code>&lt;Root&gt;</code></td></tr><tr><td>Ê¦ <code>index.tsx</code></td><td><code>/</code> (ç²¾ç¡®åŒ¹é…)</td><td><code>&lt;Root&gt;&lt;RootIndex&gt;</code></td></tr><tr><td>Ê¦ <code>about.tsx</code></td><td><code>/about</code></td><td><code>&lt;Root&gt;&lt;About&gt;</code></td></tr><tr><td>Ê¦ <code>posts.tsx</code></td><td><code>/posts</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;</code></td></tr><tr><td>Ê¦ <code>posts.index.tsx</code></td><td><code>/posts</code> (ç²¾ç¡®åŒ¹é…)</td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;PostsIndex&gt;</code></td></tr><tr><td>Ê¦ <code>posts.$postId.tsx</code></td><td><code>/posts/$postId</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;Post&gt;</code></td></tr><tr><td>Ê¦ <code>posts_.$postId.edit.tsx</code></td><td><code>/posts/$postId/edit</code></td><td><code>&lt;Root&gt;&lt;EditPost&gt;</code></td></tr><tr><td>Ê¦ <code>settings.tsx</code></td><td><code>/settings</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;</code></td></tr><tr><td>Ê¦ <code>settings.profile.tsx</code></td><td><code>/settings/profile</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;&lt;Profile&gt;</code></td></tr><tr><td>Ê¦ <code>settings.notifications.tsx</code></td><td><code>/settings/notifications</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;&lt;Notifications&gt;</code></td></tr><tr><td>Ê¦ <code>_pathlessLayout.tsx</code></td><td/><td><code>&lt;Root&gt;&lt;PathlessLayout&gt;</code></td></tr><tr><td>Ê¦ <code>_pathlessLayout.route-a.tsx</code></td><td><code>/route-a</code></td><td><code>&lt;Root&gt;&lt;PathlessLayout&gt;&lt;RouteA&gt;</code></td></tr><tr><td>Ê¦ <code>_pathlessLayout.route-b.tsx</code></td><td><code>/route-b</code></td><td><code>&lt;Root&gt;&lt;PathlessLayout&gt;&lt;RouteB&gt;</code></td></tr><tr><td>Ê¦ <code>files.$.tsx</code></td><td><code>/files/$</code></td><td><code>&lt;Root&gt;&lt;Files&gt;</code></td></tr><tr><td>Ê¦ <code>account.tsx</code></td><td><code>/account</code></td><td><code>&lt;Root&gt;&lt;Account&gt;</code></td></tr><tr><td>Ê¦ <code>account.overview.tsx</code></td><td><code>/account/overview</code></td><td><code>&lt;Root&gt;&lt;Account&gt;&lt;Overview&gt;</code></td></tr></tbody></table>
<h2 data-id="heading-4">æ··åˆæ‰å¹³è·¯ç”±å’Œç›®å½•è·¯ç”±</h2>
<p>ææœ‰å¯èƒ½ 100% çš„ç›®å½•ç»“æ„æˆ– 100% çš„æ‰å¹³è·¯ç”±ç»“æ„éƒ½ä¸å®Œå…¨é€‚åˆä½ çš„é¡¹ç›®ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ TanStack Router å…è®¸ä½ å°†æ‰å¹³è·¯ç”±å’Œç›®å½•è·¯ç”±<strong>æ··åˆä½¿ç”¨</strong>ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªç»“åˆä¸¤è€…ä¼˜ç‚¹çš„è·¯ç”±æ ‘ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>











































































<table><thead><tr><th><strong>æ–‡ä»¶å (Filename)</strong></th><th><strong>è·¯ç”±è·¯å¾„ (Route Path)</strong></th><th><strong>ç»„ä»¶è¾“å‡º (Component Output)</strong></th></tr></thead><tbody><tr><td>Ê¦ <code>__root.tsx</code></td><td/><td><code>&lt;Root&gt;</code></td></tr><tr><td>Ê¦ <code>index.tsx</code></td><td><code>/</code> (ç²¾ç¡®åŒ¹é…)</td><td><code>&lt;Root&gt;&lt;RootIndex&gt;</code></td></tr><tr><td>Ê¦ <code>about.tsx</code></td><td><code>/about</code></td><td><code>&lt;Root&gt;&lt;About&gt;</code></td></tr><tr><td>Ê¦ <code>posts.tsx</code></td><td><code>/posts</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;</code></td></tr><tr><td>ğŸ“‚ <code>posts</code></td><td/><td/></tr><tr><td>â”„ Ê¦ <code>index.tsx</code></td><td><code>/posts</code> (ç²¾ç¡®åŒ¹é…)</td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;PostsIndex&gt;</code></td></tr><tr><td>â”„ Ê¦ <code>$postId.tsx</code></td><td><code>/posts/$postId</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;Post&gt;</code></td></tr><tr><td>â”„ Ê¦ <code>$postId.edit.tsx</code></td><td><code>/posts/$postId/edit</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;Post&gt;&lt;EditPost&gt;</code></td></tr><tr><td>Ê¦ <code>settings.tsx</code></td><td><code>/settings</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;</code></td></tr><tr><td>Ê¦ <code>settings.profile.tsx</code></td><td><code>/settings/profile</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;&lt;Profile&gt;</code></td></tr><tr><td>Ê¦ <code>settings.notifications.tsx</code></td><td><code>/settings/notifications</code></td><td><code>&lt;Root&gt;&lt;Settings&gt;&lt;Notifications&gt;</code></td></tr><tr><td>Ê¦ <code>account.tsx</code></td><td><code>/account</code></td><td><code>&lt;Root&gt;&lt;Account&gt;</code></td></tr><tr><td>Ê¦ <code>account.overview.tsx</code></td><td><code>/account/overview</code></td><td><code>&lt;Root&gt;&lt;Account&gt;&lt;Overview&gt;</code></td></tr></tbody></table>
<p>æ‰å¹³è·¯ç”±å’Œç›®å½•è·¯ç”±å¯ä»¥æ··åˆåœ¨ä¸€èµ·ï¼Œä»¥ä¾¿åœ¨åˆç†çš„åœ°æ–¹ç»“åˆä¸¤è€…çš„ä¼˜ç‚¹æ¥åˆ›å»ºè·¯ç”±æ ‘ã€‚</p>
<blockquote>
<p>[!TIP]</p>
<p>å¦‚æœä½ å‘ç°é»˜è®¤çš„åŸºäºæ–‡ä»¶çš„è·¯ç”±ç»“æ„ä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œä½ å§‹ç»ˆå¯ä»¥ä½¿ç”¨ è™šæ‹Ÿæ–‡ä»¶è·¯ç”± (Virtual File Routes) æ¥æ§åˆ¶è·¯ç”±çš„æ¥æºï¼ŒåŒæ—¶ä»ç„¶äº«å—åŸºäºæ–‡ä»¶è·¯ç”±å¸¦æ¥çš„å‡ºè‰²æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
</blockquote>
<h2 data-id="heading-5">å¼€å§‹ä½¿ç”¨åŸºäºæ–‡ä»¶çš„è·¯ç”±</h2>
<p>è¦å¼€å§‹ä½¿ç”¨åŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼Œä½ éœ€è¦é…ç½®ä½ é¡¹ç›®çš„æ‰“åŒ…å·¥å…·ï¼ˆBundlerï¼‰ä»¥ä½¿ç”¨ TanStack Router Plugin æˆ– TanStack Router CLIã€‚</p>
<p>è¦å¯ç”¨åŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼Œä½ éœ€è¦åœ¨ä½¿ç”¨ React çš„åŒæ—¶ä½¿ç”¨å—æ”¯æŒçš„æ‰“åŒ…å·¥å…·ã€‚è¯·æŸ¥çœ‹ä¸‹é¢çš„é…ç½®æŒ‡å—ï¼Œçœ‹çœ‹ä½ çš„æ‰“åŒ…å·¥å…·æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ã€‚</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Finstallation%2Fwith-vite" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/installation/with-vite" ref="nofollow noopener noreferrer">Installation with Vite</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Finstallation%2Fwith-rspack" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/installation/with-rspack" ref="nofollow noopener noreferrer">Installation with Rspack/Rsbuild</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Finstallation%2Fwith-webpack" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/installation/with-webpack" ref="nofollow noopener noreferrer">Installation with Webpack</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Finstallation%2Fwith-esbuild" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/installation/with-esbuild" ref="nofollow noopener noreferrer">Installation with Esbuild</a></li>
</ul>
<p>å½“é€šè¿‡å—æ”¯æŒçš„æ‰“åŒ…å·¥å…·ä½¿ç”¨ TanStack Router çš„åŸºäºæ–‡ä»¶çš„è·¯ç”±æ—¶ï¼Œæ’ä»¶å°†<strong>é€šè¿‡æ‰“åŒ…å·¥å…·çš„å¼€å‘å’Œæ„å»ºè¿‡ç¨‹è‡ªåŠ¨ç”Ÿæˆä½ çš„è·¯ç”±é…ç½®</strong>ã€‚è¿™æ˜¯ä½¿ç”¨ TanStack Router è·¯ç”±ç”ŸæˆåŠŸèƒ½æœ€ç®€å•çš„æ–¹æ³•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ Windows ä¸Šæ­£ç¡®å®‰è£… OpenAI Codex CLIï¼šä¸€æ¬¡å®Œæ•´çš„ pnpm å…¨å±€ç¯å¢ƒä¿®å¤å®å½•]]></title>    <link>https://juejin.cn/post/7585206349749502004</link>    <guid>https://juejin.cn/post/7585206349749502004</guid>    <pubDate>2025-12-19T11:00:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585206349749502004" data-draft-id="7585394082822832162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ Windows ä¸Šæ­£ç¡®å®‰è£… OpenAI Codex CLIï¼šä¸€æ¬¡å®Œæ•´çš„ pnpm å…¨å±€ç¯å¢ƒä¿®å¤å®å½•"/> <meta itemprop="keywords" content="OpenAI,åç«¯"/> <meta itemprop="datePublished" content="2025-12-19T11:00:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sdguy"/> <meta itemprop="url" content="https://juejin.cn/user/1416608279436087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ Windows ä¸Šæ­£ç¡®å®‰è£… OpenAI Codex CLIï¼šä¸€æ¬¡å®Œæ•´çš„ pnpm å…¨å±€ç¯å¢ƒä¿®å¤å®å½•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1416608279436087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sdguy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T11:00:37.000Z" title="Fri Dec 19 2025 11:00:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åœ¨ Windows ä¸Šæ­£ç¡®å®‰è£… OpenAI Codex CLIï¼šä¸€æ¬¡å®Œæ•´çš„ pnpm å…¨å±€ç¯å¢ƒä¿®å¤å®å½•</h2>
<blockquote>
<p>æœ¬æ–‡è®°å½•äº†ä¸€æ¬¡åœ¨ <strong>Windows + pnpm ç¯å¢ƒä¸‹å®‰è£… OpenAI Codex CLI</strong> çš„å®Œæ•´è¸©å‘ä¸ä¿®å¤è¿‡ç¨‹ã€‚<br/>
å¦‚æœä½ é‡åˆ°è¿‡ <code>pnpm global</code> å¤±è´¥ã€<code>NO_GLOBAL_BIN_DIR</code>ã€å®‰è£…å¡æ­»ã€PATH æ··ä¹±ç­‰é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥ä½œä¸ºä¸€ä»½<strong>å¯å¤ç”¨çš„å·¥ç¨‹çº§è§£å†³æ–¹æ¡ˆ</strong>ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šCodex å®‰è£…ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆâ€œæŠ˜ç£¨â€</h3>
<p>æˆ‘æœ€åˆçš„ç›®æ ‡éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-css" lang="css">pnpm <span class="hljs-selector-tag">i</span> -g <span class="hljs-keyword">@openai</span>/codex
</code></pre>
<p>ç»“æœå´é‡åˆ°äº†ä»¥ä¸‹é—®é¢˜ç»„åˆï¼š</p>
<ul>
<li>pnpm æŠ¥é”™ï¼š<code>ERR_PNPM_NO_GLOBAL_BIN_DIR</code></li>
<li>npm / pnpm å…¨å±€å®‰è£…é•¿æ—¶é—´â€œè½¬åœˆâ€</li>
<li>Windows ä¸‹ PATH / å…¨å±€ bin è¡Œä¸ºä¸é€æ˜</li>
<li>å³ä½¿å®‰è£…æˆåŠŸï¼Œä¹Ÿæ— æ³•ç¡®è®¤ <code>codex</code> æ˜¯å¦çœŸæ­£å¯ç”¨</li>
</ul>
<p>è¿™ç±»é—®é¢˜å¹¶ä¸æ˜¯ Codex ç‹¬æœ‰ï¼Œè€Œæ˜¯ <strong>Windows + Node å…¨å±€å·¥å…·é“¾</strong> çš„ç³»ç»Ÿæ€§é—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-2">äºŒã€æ ¸å¿ƒç»“è®ºå…ˆè¡Œï¼ˆç»™ç€æ€¥çš„äººï¼‰</h3>
<p>å¦‚æœä½ åªå…³å¿ƒæœ€ç»ˆç­”æ¡ˆï¼š</p>
<blockquote>
<p><strong>åœ¨ Windows ä¸Šä½¿ç”¨ pnpm å…¨å±€ CLI çš„å‰ææ˜¯ï¼šå¿…é¡»æ­£ç¡®åˆå§‹åŒ– <code>PNPM_HOME</code>ï¼Œå¹¶ç¡®ä¿å…¨å±€ bin è¢«å®é™…ç”Ÿæˆã€‚</strong></p>
</blockquote>
<p>Codex å®‰è£…å¤±è´¥ï¼Œ<strong>90% ä¸æ˜¯ Codex çš„é—®é¢˜ï¼Œè€Œæ˜¯ pnpm å…¨å±€ç¯å¢ƒæœªå°±ç»ª</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€ç¬¬ä¸€æ­¥ï¼šæ­£ç¡®åˆå§‹åŒ– pnpm å…¨å±€ç¯å¢ƒï¼ˆå…³é”®ï¼‰</h3>
<h4 data-id="heading-4">1ï¸âƒ£ æ‰§è¡Œ pnpm å®˜æ–¹åˆå§‹åŒ–å‘½ä»¤</h4>
<pre><code class="hljs language-arduino" lang="arduino">pnpm setup
</code></pre>
<p>æˆåŠŸåï¼Œpnpm ä¼šï¼š</p>
<ul>
<li>åˆ›å»º <code>PNPM_HOME</code></li>
<li>ä¿®æ”¹ç”¨æˆ·çº§ PATH</li>
<li>è¾“å‡ºæç¤ºï¼š<strong>éœ€è¦é‡å¼€ç»ˆç«¯</strong></li>
</ul>
<p>âš ï¸ <strong>è¿™ä¸€æ­¥ä¹‹åå¿…é¡»å…³é—­ PowerShell çª—å£å¹¶é‡æ–°æ‰“å¼€</strong></p>
<hr/>
<h4 data-id="heading-5">2ï¸âƒ£ éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ</h4>
<p>é‡æ–°æ‰“å¼€ PowerShell åæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$env</span>:PNPM_HOME
pnpm -v
</code></pre>
<p>æœŸæœ›ç»“æœç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users\xxx\AppData\Local\pnpm</span>
10.x.x
</code></pre>
<hr/>
<h3 data-id="heading-6">å››ã€ä¸€ä¸ªå®¹æ˜“è¯¯åˆ¤çš„ç‚¹ï¼šPNPM_HOME é‡Œåªæœ‰ <code>store/</code> æ­£å¸¸å—ï¼Ÿ</h3>
<p>åˆšå®Œæˆ <code>pnpm setup</code> åï¼Œæˆ‘çœ‹åˆ°çš„ç›®å½•æ˜¯ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users\xxx\AppData\Local\pnpm</span>
â””â”€â”€ store/
</code></pre>
<p><strong>è¿™æ˜¯æ­£å¸¸çš„ï¼Œä½†è¿˜ä¸ç®—â€œå®Œæˆâ€</strong> ã€‚</p>
<p>åŸå› æ˜¯ï¼š</p>
<blockquote>
<p>pnpm åªæœ‰åœ¨ <strong>ç¬¬ä¸€æ¬¡å‘ç”Ÿå…¨å±€å®‰è£…è¡Œä¸ºæ—¶</strong>ï¼Œæ‰ä¼šç”Ÿæˆå…¨å±€å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆpnpm / pnpx shimï¼‰ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">äº”ã€è§¦å‘ pnpm å…¨å±€ bin åˆå§‹åŒ–ï¼ˆv10 æ­£ç¡®æ–¹å¼ï¼‰</h3>
<p>åœ¨ pnpm v10 ä¹‹åï¼š</p>
<ul>
<li>âŒ ä¸å†å…è®¸ <code>pnpm add -g pnpm</code></li>
<li>âœ… æ­£ç¡®æ–¹å¼æ˜¯ï¼š</li>
</ul>
<pre><code class="hljs language-lua" lang="lua">pnpm <span class="hljs-built_in">self</span>-update
</code></pre>
<p>æ‰§è¡Œå®Œæˆåï¼Œå†æŸ¥çœ‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> <span class="hljs-variable">$env</span>:PNPM_HOME
</code></pre>
<p>æ­¤æ—¶åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼å†…å®¹ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">.tools<span class="hljs-operator">/</span>
store<span class="hljs-operator">/</span>
pnpm
pnpm.<span class="hljs-type">CMD</span>
pnpx
pnpx.<span class="hljs-type">CMD</span>
</code></pre>
<p>è¿™ä¸€æ­¥æ˜¯ <strong>pnpm å…¨å±€ç¯å¢ƒçœŸæ­£å°±ç»ªçš„æ ‡å¿—</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-8">å…­ã€éªŒè¯ pnpx æ˜¯å¦å¯ç”¨ï¼ˆé‡è¦éªŒæ”¶ç‚¹ï¼‰</h3>
<p>ä¸è¦ç”¨ <code>pnpx --version</code>ï¼ˆè¿™æ˜¯ä¸æ”¯æŒçš„ï¼‰ã€‚</p>
<p>æ­£ç¡®çš„éªŒè¯æ–¹å¼æ˜¯ï¼š</p>
<pre><code class="hljs">pnpx cowsay hello
</code></pre>
<p>å¦‚æœä½ çœ‹åˆ°ä¸€åªç‰›è¾“å‡º <code>hello</code>ï¼Œè¯´æ˜ï¼š</p>
<ul>
<li>PNPM_HOME âœ”</li>
<li>PATH âœ”</li>
<li>pnpx / dlx æ‰§è¡Œé“¾ âœ”</li>
</ul>
<hr/>
<h3 data-id="heading-9">ä¸ƒã€æ­£å¼å®‰è£… OpenAI Codex CLIï¼ˆå¯è§‚æµ‹æ–¹å¼ï¼‰</h3>
<h4 data-id="heading-10">1ï¸âƒ£ï¼ˆå¯é€‰ä½†å¼ºçƒˆæ¨èï¼‰è®¾ç½®å›½å†… registry</h4>
<pre><code class="hljs language-arduino" lang="arduino">pnpm config set registry https:<span class="hljs-comment">//registry.npmmirror.com</span>
</code></pre>
<p>é¿å… 100MB+ åŒ…ä¸‹è½½å¡æ­»ã€‚</p>
<hr/>
<h4 data-id="heading-11">2ï¸âƒ£ å®‰è£… Codexï¼ˆå¸¦ ndjson æ—¥å¿—ï¼‰</h4>
<pre><code class="hljs language-sql" lang="sql">pnpm <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>g <span class="hljs-variable">@openai</span><span class="hljs-operator">/</span>codex <span class="hljs-comment">--reporter ndjson</span>
</code></pre>
<p>åœ¨æ—¥å¿—ä¸­ä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š</p>
<ul>
<li><code>@openai/codex@x.y.z</code> resolved</li>
<li>fetchedï¼ˆå®Œæ•´ä¸‹è½½ï¼‰</li>
<li>imported</li>
<li>linked</li>
<li>æ²¡æœ‰ postinstall é”™è¯¯</li>
</ul>
<hr/>
<h3 data-id="heading-12">å…«ã€Codex æ˜¯å¦çœŸæ­£å®‰è£…æˆåŠŸï¼Ÿæœ€ç»ˆéªŒæ”¶æ ‡å‡†</h3>
<p><strong>ä¸è¦åªçœ‹å®‰è£…æ—¥å¿—ï¼Œçœ‹è¿™ä¸€æ­¥ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">codex --<span class="hljs-built_in">help</span>
</code></pre>
<p>å¦‚æœä½ èƒ½çœ‹åˆ°å®Œæ•´çš„ CLI å¸®åŠ©ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><code>exec</code></li>
<li><code>review</code></li>
<li><code>mcp / mcp-server</code></li>
<li><code>sandbox</code></li>
<li><code>apply</code></li>
<li><code>--version</code></li>
</ul>
<p>ğŸ‘‰ <strong>è¿™æ„å‘³ç€ Codex CLI å·² 100% å¯ç”¨</strong></p>
<hr/>
<h3 data-id="heading-13">ä¹ã€å…³äº <code>where codex</code> æ²¡æœ‰è¾“å‡ºçš„è¯´æ˜</h3>
<p>åœ¨ Windows + pnpm åœºæ™¯ä¸‹ï¼š</p>
<ul>
<li>å¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸æ˜¯ <code>codex.CMD</code></li>
<li>PowerShell çš„ <code>where</code> æœ‰æ—¶ä¸ä¼šæ˜¾ç¤º shim</li>
<li><strong>åªè¦ <code>codex</code> èƒ½ç›´æ¥è¿è¡Œï¼Œå°±ä¸æ˜¯é—®é¢˜</strong></li>
</ul>
<hr/>
<h3 data-id="heading-14">åã€ç™»å½•ä¸ä½¿ç”¨</h3>
<p>é¦–æ¬¡ä½¿ç”¨å‰æ‰§è¡Œï¼š</p>
<pre><code class="hljs">codex login
</code></pre>
<p>è®¤è¯ä¿¡æ¯ä¼šä¿å­˜åœ¨ <code>~/.codex/</code>ï¼Œä¸æ±¡æŸ“ç¯å¢ƒå˜é‡ã€‚</p>
<hr/>
<h3 data-id="heading-15">åä¸€ã€ä¸€äº›ç»éªŒæ€»ç»“ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<h4 data-id="heading-16">1ï¸âƒ£ ä¸è¦æ€¥ç€æ€ª Codex</h4>
<ul>
<li>Codex å®‰è£…æ…¢ / å¤±è´¥<br/>
â†’ <strong>99% æ˜¯ Node å…¨å±€ç¯å¢ƒé—®é¢˜</strong></li>
</ul>
<h4 data-id="heading-17">2ï¸âƒ£ Windows ä¸‹æ¨èé¡ºåº</h4>
<pre><code class="hljs language-sql" lang="sql">pnpm setup
â†’ é‡å¼€ç»ˆç«¯
â†’ pnpm self<span class="hljs-operator">-</span><span class="hljs-keyword">update</span>
â†’ pnpx éªŒè¯
â†’ pnpm <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>g <span class="hljs-variable">@openai</span><span class="hljs-operator">/</span>codex
</code></pre>
<h4 data-id="heading-18">3ï¸âƒ£ å¦‚æœåªæ˜¯â€œæƒ³ç”¨â€ï¼Œnpx / pnpx ä¹Ÿæ˜¯åˆç†é€‰æ‹©</h4>
<pre><code class="hljs language-bash" lang="bash">pnpx @openai/codex
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TanStack Router æ–‡ä»¶å‘½åçº¦å®š]]></title>    <link>https://juejin.cn/post/7585382553290063908</link>    <guid>https://juejin.cn/post/7585382553290063908</guid>    <pubDate>2025-12-20T02:20:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585382553290063908" data-draft-id="7585382553290047524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TanStack Router æ–‡ä»¶å‘½åçº¦å®š"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T02:20:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çš®è›‹å°ç²¾çµ"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TanStack Router æ–‡ä»¶å‘½åçº¦å®š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çš®è›‹å°ç²¾çµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T02:20:25.000Z" title="Sat Dec 20 2025 02:20:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸºäºæ–‡ä»¶çš„è·¯ç”±è¦æ±‚ä½ éµå¾ªä¸€äº›ç®€å•çš„æ–‡ä»¶å‘½åçº¦å®šï¼Œä»¥ç¡®ä¿æ­£ç¡®ç”Ÿæˆè·¯ç”±ã€‚è¿™äº›çº¦å®šæ‰€å¯ç”¨çš„æ¦‚å¿µåœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Frouting%2Froute-trees" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/routing/route-trees" ref="nofollow noopener noreferrer">è·¯ç”±æ ‘ä¸åµŒå¥—</a> æŒ‡å—ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚</p>

















































<table><thead><tr><th><strong>ç‰¹æ€§ (Feature)</strong></th><th><strong>æè¿° (Description)</strong></th></tr></thead><tbody><tr><td><strong><code>__root.tsx</code></strong></td><td>æ ¹è·¯ç”±æ–‡ä»¶å¿…é¡»å‘½åä¸º <code>__root.tsx</code>ï¼Œå¹¶ä¸”å¿…é¡»æ”¾ç½®åœ¨é…ç½®çš„ <code>routesDirectory</code> çš„æ ¹ç›®å½•ä¸‹ã€‚</td></tr><tr><td><strong><code>.</code> åˆ†éš”ç¬¦</strong></td><td>è·¯ç”±å¯ä»¥ä½¿ç”¨ <code>.</code> å­—ç¬¦æ¥è¡¨ç¤ºåµŒå¥—è·¯ç”±ã€‚ä¾‹å¦‚ï¼Œ<code>blog.post</code> å°†ç”Ÿæˆä¸º <code>blog</code> çš„å­è·¯ç”±ã€‚</td></tr><tr><td><strong><code>$</code> æ ‡è®°</strong></td><td>å¸¦æœ‰ <code>$</code> æ ‡è®°çš„è·¯ç”±ç‰‡æ®µæ˜¯å‚æ•°åŒ–çš„ï¼Œå¹¶å°†ä» URL è·¯å¾„åä¸­æå–å€¼ä½œä¸ºè·¯ç”± <code>param</code>ï¼ˆå‚æ•°ï¼‰ã€‚</td></tr><tr><td><strong><code>_</code> å‰ç¼€</strong></td><td>å¸¦æœ‰ <code>_</code> å‰ç¼€çš„è·¯ç”±ç‰‡æ®µè¢«è§†ä¸º<strong>æ— è·¯å¾„å¸ƒå±€è·¯ç”±</strong>ï¼Œåœ¨å°†å­è·¯ç”±ä¸ URL è·¯å¾„ååŒ¹é…æ—¶ä¸ä¼šä½¿ç”¨å®ƒã€‚</td></tr><tr><td><strong><code>_</code> åç¼€</strong></td><td>å¸¦æœ‰ <code>_</code> åç¼€çš„è·¯ç”±ç‰‡æ®µå°†è¯¥è·¯ç”±æ’é™¤åœ¨ä»»ä½•çˆ¶è·¯ç”±çš„åµŒå¥—ä¹‹å¤–ï¼ˆå³éåµŒå¥—è·¯ç”±ï¼‰ã€‚</td></tr><tr><td><strong><code>-</code> å‰ç¼€</strong></td><td>å¸¦æœ‰ <code>-</code> å‰ç¼€çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å°†ä»è·¯ç”±æ ‘ä¸­<strong>æ’é™¤</strong>ã€‚å®ƒä»¬ä¸ä¼šè¢«æ·»åŠ åˆ° <code>routeTree.gen.ts</code> æ–‡ä»¶ä¸­ï¼Œå¯ç”¨äºåœ¨è·¯ç”±æ–‡ä»¶å¤¹ä¸­å…±å­˜é€»è¾‘ä»£ç ã€‚</td></tr><tr><td><strong><code>(folder)</code> æ–‡ä»¶å¤¹åæ¨¡å¼</strong></td><td>åŒ¹é…æ­¤æ¨¡å¼çš„æ–‡ä»¶å¤¹è¢«è§†ä¸º<strong>è·¯ç”±ç»„</strong>ï¼Œé˜²æ­¢è¯¥æ–‡ä»¶å¤¹åŒ…å«åœ¨è·¯ç”±çš„ URL è·¯å¾„ä¸­ã€‚</td></tr><tr><td><strong><code>[x]</code> è½¬ä¹‰</strong></td><td>æ–¹æ‹¬å·ç”¨äºè½¬ä¹‰æ–‡ä»¶åä¸­å…·æœ‰è·¯ç”±å«ä¹‰çš„ç‰¹æ®Šå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>script[.]js.tsx</code> å˜ä¸º <code>/script.js</code>ï¼Œ<code>api[.]v1.tsx</code> å˜ä¸º <code>/api.v1</code>ã€‚</td></tr><tr><td><strong><code>index</code> æ ‡è®°</strong></td><td>ä»¥ <code>index</code> æ ‡è®°ç»“å°¾ï¼ˆåœ¨ä»»ä½•æ–‡ä»¶æ‰©å±•åä¹‹å‰ï¼‰çš„è·¯ç”±ç‰‡æ®µï¼Œå½“ URL è·¯å¾„åç²¾ç¡®åŒ¹é…çˆ¶è·¯ç”±æ—¶ï¼Œå°†åŒ¹é…çˆ¶è·¯ç”±ã€‚è¿™å¯ä»¥é€šè¿‡ <code>indexToken</code> é…ç½®é€‰é¡¹è¿›è¡Œé…ç½®ï¼Œå‚è§ [suspicious link removed]ã€‚</td></tr><tr><td><strong><code>.route.tsx</code> æ–‡ä»¶ç±»å‹</strong></td><td>å½“ä½¿ç”¨ç›®å½•ç»„ç»‡è·¯ç”±æ—¶ï¼Œ<code>route</code> åç¼€å¯ç”¨äºåœ¨ç›®å½•è·¯å¾„å¤„åˆ›å»ºè·¯ç”±æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>blog.post.route.tsx</code> æˆ– <code>blog/post/route.tsx</code> å¯ç”¨ä½œ <code>/blog/post</code> è·¯ç”±çš„è·¯ç”±æ–‡ä»¶ã€‚è¿™å¯ä»¥é€šè¿‡ <code>routeToken</code> é…ç½®é€‰é¡¹è¿›è¡Œé…ç½®ï¼Œå‚è§ [suspicious link removed]ã€‚</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ’¡ è®°ä½ï¼š</strong> é¡¹ç›®çš„æ–‡ä»¶å‘½åçº¦å®šå¯èƒ½ä¼šå—åˆ°æ‰€é…ç½®çš„ [suspicious link removed] çš„å½±å“ã€‚</p>
</blockquote>
<blockquote>
<p>[!NOTE]</p>
<p>è¦è½¬ä¹‰å°¾éšä¸‹åˆ’çº¿ï¼ˆä¾‹å¦‚ /posts[_].tsxï¼‰ï¼Œéœ€è¦ä½¿ç”¨å‡çº§åçš„ éåµŒå¥—è·¯ç”±ã€‚</p>
</blockquote>
<h2 data-id="heading-0">åŠ¨æ€è·¯å¾„å‚æ•° (Dynamic Path Params)</h2>
<p>åŠ¨æ€è·¯å¾„å‚æ•°å¯ç”¨äºæ‰å¹³è·¯ç”±å’Œç›®å½•è·¯ç”±ï¼Œä»¥åˆ›å»ºå¯ä»¥åŒ¹é… URL è·¯å¾„åŠ¨æ€ç‰‡æ®µçš„è·¯ç”±ã€‚åŠ¨æ€è·¯å¾„å‚æ•°ç”±æ–‡ä»¶åä¸­çš„ <code>$</code> å­—ç¬¦è¡¨ç¤ºï¼š</p>




















<table><thead><tr><th><strong>æ–‡ä»¶å (Filename)</strong></th><th><strong>è·¯ç”±è·¯å¾„ (Route Path)</strong></th><th><strong>ç»„ä»¶è¾“å‡º (Component Output)</strong></th></tr></thead><tbody><tr><td>...</td><td>...</td><td>...</td></tr><tr><td>Ê¦ <code>posts.$postId.tsx</code></td><td><code>/posts/$postId</code></td><td><code>&lt;Root&gt;&lt;Posts&gt;&lt;Post&gt;</code></td></tr></tbody></table>
<p>æˆ‘ä»¬å°†åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Fguide%2Fpath-params" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/guide/path-params" ref="nofollow noopener noreferrer">è·¯å¾„å‚æ•°</a> æŒ‡å—ä¸­äº†è§£æ›´å¤šå…³äºåŠ¨æ€è·¯å¾„å‚æ•°çš„ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-1">æ— è·¯å¾„è·¯ç”± (Pathless Routes)</h2>
<p>æ— è·¯å¾„è·¯ç”±ç”¨é€»è¾‘æˆ–ç»„ä»¶åŒ…è£¹å­è·¯ç”±ï¼Œè€Œä¸éœ€è¦ URL è·¯å¾„ã€‚æ— è·¯å¾„è·¯ç”±ç”±æ–‡ä»¶åä¸­çš„ <code>_</code> å­—ç¬¦è¡¨ç¤ºï¼š</p>

























<table><thead><tr><th><strong>æ–‡ä»¶å (Filename)</strong></th><th><strong>è·¯ç”±è·¯å¾„ (Route Path)</strong></th><th><strong>ç»„ä»¶è¾“å‡º (Component Output)</strong></th></tr></thead><tbody><tr><td>Ê¦ <code>_app.tsx</code></td><td/><td/></tr><tr><td>Ê¦ <code>_app.a.tsx</code></td><td>/a</td><td><code>&lt;Root&gt;&lt;App&gt;&lt;A&gt;</code></td></tr><tr><td>Ê¦ <code>_app.b.tsx</code></td><td>/b</td><td><code>&lt;Root&gt;&lt;App&gt;&lt;B&gt;</code></td></tr></tbody></table>
<p>è¦äº†è§£æ›´å¤šå…³äºæ— è·¯å¾„è·¯ç”±çš„ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Frouter%2Fv1%2Fdocs%2Fframework%2Freact%2Frouting%2Frouting-concepts%23pathless-layout-routes" target="_blank" title="https://tanstack.com/router/v1/docs/framework/react/routing/routing-concepts#pathless-layout-routes" ref="nofollow noopener noreferrer">è·¯ç”±æ¦‚å¿µ - æ— è·¯å¾„è·¯ç”±</a> æŒ‡å—ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‡çº§äºŒè¿›åˆ¶kubernetesé›†ç¾¤ï¼ˆå°ç‰ˆæœ¬å‡çº§ï¼‰]]></title>    <link>https://juejin.cn/post/7585395972294148105</link>    <guid>https://juejin.cn/post/7585395972294148105</guid>    <pubDate>2025-12-19T11:25:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585395972294148105" data-draft-id="7585406229167587378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‡çº§äºŒè¿›åˆ¶kubernetesé›†ç¾¤ï¼ˆå°ç‰ˆæœ¬å‡çº§ï¼‰"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-12-19T11:25:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é™ˆè¿ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/3315782802482007"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‡çº§äºŒè¿›åˆ¶kubernetesé›†ç¾¤ï¼ˆå°ç‰ˆæœ¬å‡çº§ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3315782802482007/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é™ˆè¿ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T11:25:29.000Z" title="Fri Dec 19 2025 11:25:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‡çº§äºŒè¿›åˆ¶kubernetesé›†ç¾¤ï¼ˆå°ç‰ˆæœ¬å‡çº§ï¼‰</h2>
<p>æ­¤æ–‡æ¡£åŸºäºæˆ‘çš„äºŒè¿›åˆ¶å®‰è£…ä»“åº“
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcby-chen%2FKubernetes" target="_blank" title="https://github.com/cby-chen/Kubernetes" ref="nofollow noopener noreferrer">github.com/cby-chen/Kuâ€¦</a></p>
<h3 data-id="heading-1">åŸºç¡€æ“ä½œ</h3>
<h4 data-id="heading-2">æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ä¿¡æ¯</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# kubectl  get node
NAME           STATUS   ROLES    AGE    VERSION
k8s-master01   Ready    &lt;none&gt;   110d   v1.34.0
k8s-master02   Ready    &lt;none&gt;   110d   v1.34.0
k8s-master03   Ready    &lt;none&gt;   110d   v1.34.0
k8s-node01     Ready    &lt;none&gt;   110d   v1.34.0
k8s-node02     Ready    &lt;none&gt;   110d   v1.34.0
[root@k8s-master01 ~]# 
</code></pre>
<h4 data-id="heading-3">ä¸»æœºåŸŸåä»¥åŠIPåœ°å€</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# cat /etc/hosts | grep k8s
192.168.1.31 k8s-master01
192.168.1.32 k8s-master02
192.168.1.33 k8s-master03
192.168.1.34 k8s-node01
192.168.1.35 k8s-node02
fc00::31 k8s-master01
fc00::32 k8s-master02
fc00::33 k8s-master03
fc00::34 k8s-node01
fc00::35 k8s-node02
[root@k8s-master01 ~]# 
</code></pre>
<h4 data-id="heading-4">ä¸‹è½½äºŒè¿›åˆ¶å®‰è£…åŒ…</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# wget https://dl.k8s.io/v1.34.3/kubernetes-server-linux-amd64.tar.gz
[root@k8s-master01 ~]# wget https://dl.k8s.io/v1.35.0/kubernetes-server-linux-amd64.tar.gz
[root@k8s-master01 ~]#
</code></pre>
<h4 data-id="heading-5">è§£å‹äºŒè¿›åˆ¶å®‰è£…åŒ…</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# tar xf kubernetes-server-linux-amd64.tar.gz
[root@k8s-master01 ~]# 
</code></pre>
<h3 data-id="heading-6">å‡çº§Maser</h3>
<h4 data-id="heading-7">å‡çº§ä¸‰å°ä¸»èŠ‚ç‚¹ä¸Šçš„å®¢æˆ·ç«¯</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# scp kubernetes/server/bin/kubectl root@192.168.1.31:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kubectl root@192.168.1.32:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kubectl root@192.168.1.33:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# kubectl version
Client Version: v1.34.3
Kustomize Version: v5.7.1
Server Version: v1.34.0
[root@k8s-master01 ~]# 
</code></pre>
<h4 data-id="heading-8">å‡çº§ä¸‰å°ä¸»èŠ‚ç‚¹apiç»„ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl stop kube-apiserver"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kube-apiserver root@192.168.1.31:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl start kube-apiserver"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl status kube-apiserver"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# kube-apiserver --version
Kubernetes v1.34.3
[root@k8s-master01 ~]# 

</code></pre>
<h4 data-id="heading-9">å‡çº§ä¸‰å°ä¸»èŠ‚ç‚¹æ§åˆ¶å™¨ç»„ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl stop kube-controller-manager"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kube-controller-manager root@192.168.1.31:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl start kube-controller-manager"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl status kube-controller-manager"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# kube-controller-manager --version
Kubernetes v1.34.3
[root@k8s-master01 ~]# 
</code></pre>
<h4 data-id="heading-10">å‡çº§ä¸‰å°ä¸»èŠ‚ç‚¹é€‰æ‹©å™¨ç»„ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl stop kube-scheduler"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kube-scheduler root@192.168.1.31:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl start kube-scheduler"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl status kube-scheduler"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# kube-scheduler --version
Kubernetes v1.34.3
[root@k8s-master01 ~]# 
</code></pre>
<h3 data-id="heading-11">å‡çº§Worker</h3>
<h4 data-id="heading-12">æ¯ä¸€å°æœºå™¨éƒ½è¦å‡çº§kubelet</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl stop kubelet"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kubelet root@192.168.1.31:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl start kubelet"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl status kubelet"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "kubelet --version"
Kubernetes v1.34.3
[root@k8s-master01 ~]#
</code></pre>
<h4 data-id="heading-13">æ¯ä¸€å°æœºå™¨éƒ½è¦å‡çº§kube-proxy</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl stop kube-proxy"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# scp kubernetes/server/bin/kube-proxy root@192.168.1.31:/usr/local/bin/
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl start kube-proxy"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# ssh root@192.168.1.31 "systemctl status kube-proxy"
[root@k8s-master01 ~]#
[root@k8s-master01 ~]# kube-proxy --version
</code></pre>
<h3 data-id="heading-14">éªŒè¯</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# kubectl  get node
NAME           STATUS   ROLES    AGE    VERSION
k8s-master01   Ready    &lt;none&gt;   110d   v1.34.3
k8s-master02   Ready    &lt;none&gt;   110d   v1.34.3
k8s-master03   Ready    &lt;none&gt;   110d   v1.34.3
k8s-node01     Ready    &lt;none&gt;   110d   v1.34.3
k8s-node02     Ready    &lt;none&gt;   110d   v1.34.3
[root@k8s-master01 ~]# 

[root@k8s-master01 ~]# kubectl  version
Client Version: v1.34.3
Kustomize Version: v5.7.1
Server Version: v1.34.3
[root@k8s-master01 ~]# 
</code></pre>
<blockquote>
<p><strong>å…³äº</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2F" target="_blank" title="https://www.oiox.cn/" ref="nofollow noopener noreferrer">www.oiox.cn/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2Findex.php%2Fstart-page.html" target="_blank" title="https://www.oiox.cn/index.php/start-page.html" ref="nofollow noopener noreferrer">www.oiox.cn/index.php/sâ€¦</a></p>
<p><strong>CSDNã€GitHubã€çŸ¥ä¹ã€å¼€æºä¸­å›½ã€æ€å¦ã€æ˜é‡‘ã€ç®€ä¹¦ã€åä¸ºäº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€å“”å“©å“”å“©ã€ä»Šæ—¥å¤´æ¡ã€æ–°æµªå¾®åšã€ä¸ªäººåšå®¢</strong></p>
<p><strong>å…¨ç½‘å¯æœã€Šå°é™ˆè¿ç»´ã€‹</strong></p>
<p><strong>æ–‡ç« ä¸»è¦å‘å¸ƒäºå¾®ä¿¡å…¬ä¼—å·</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è°è¯´ AI å†å²ä¼šè¯å¿…é¡»å­˜åç«¯ï¼ŸIndexedDBæ–¹æ¡ˆå®Œç¾ç¿»ç›˜]]></title>    <link>https://juejin.cn/post/7585410547336626226</link>    <guid>https://juejin.cn/post/7585410547336626226</guid>    <pubDate>2025-12-19T11:59:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585410547336626226" data-draft-id="7585406229167718450" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è°è¯´ AI å†å²ä¼šè¯å¿…é¡»å­˜åç«¯ï¼ŸIndexedDBæ–¹æ¡ˆå®Œç¾ç¿»ç›˜"/> <meta itemprop="keywords" content="å‰ç«¯,IndexedDB,Agent"/> <meta itemprop="datePublished" content="2025-12-19T11:59:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ—¶å‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/1197805741808339"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è°è¯´ AI å†å²ä¼šè¯å¿…é¡»å­˜åç«¯ï¼ŸIndexedDBæ–¹æ¡ˆå®Œç¾ç¿»ç›˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1197805741808339/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ—¶å‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T11:59:46.000Z" title="Fri Dec 19 2025 11:59:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ï¼šæ™ºèƒ½ä½“å¯¹è¯çš„"å¤±å¿†ç—‡"å›°æ‰°</h2>
<p>åœ¨ä½¿ç”¨æ™ºèƒ½ä½“æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªä»¤äººå›°æ‰°çš„é—®é¢˜ï¼š<strong>æ™ºèƒ½ä½“æ²¡æœ‰å†å²ä¼šè¯è®°å½•åŠŸèƒ½</strong>ã€‚æ¯æ¬¡åˆ·æ–°é¡µé¢æˆ–é‡æ–°æ‰“å¼€åº”ç”¨ï¼Œä¹‹å‰ä¸ AI çš„å¯¹è¯å°±æ¶ˆå¤±äº†ï¼Œå°±åƒæ™ºèƒ½ä½“æ‚£ä¸Šäº†"å¤±å¿†ç—‡"ã€‚</p>
<h3 data-id="heading-1">1.1 ç—›ç‚¹åˆ†æ</h3>
<h4 data-id="heading-2">ç—›ç‚¹ 1ï¼šå¯¹è¯ä¸Šä¸‹æ–‡ä¸¢å¤±</h4>
<p>ç”¨æˆ·åœ¨ä¸æ™ºèƒ½ä½“äº¤æµæ—¶ï¼Œç»å¸¸éœ€è¦è¿›è¡Œå¤šè½®å¯¹è¯ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€è½®</strong>ï¼š"å¸®æˆ‘åˆ†æä¸€ä¸‹ä¼ä¸šä¿¡ç”¨é£é™©è¯„ä¼°çš„æµç¨‹"</li>
<li><strong>ç¬¬äºŒè½®</strong>ï¼š"åˆšæ‰æåˆ°çš„ç¬¬ä¸‰æ­¥èƒ½è¯¦ç»†è¯´æ˜å—ï¼Ÿ"ï¼ˆâŒ åˆ·æ–°åæ— æ³•ç»§ç»­ï¼‰</li>
<li><strong>ç¬¬ä¸‰è½®</strong>ï¼š"è¿™ä¸ªæ–¹æ¡ˆåœ¨åæ¬ºè¯ˆåœºæ™¯ä¸‹æ€ä¹ˆåº”ç”¨ï¼Ÿ"ï¼ˆâŒ ä¸Šä¸‹æ–‡å…¨éƒ¨ä¸¢å¤±ï¼‰</li>
</ul>
<p><strong>å½±å“</strong>ï¼šç”¨æˆ·éœ€è¦é‡æ–°æè¿°é—®é¢˜èƒŒæ™¯ï¼Œé™ä½äº†äº¤äº’æ•ˆç‡ï¼Œç ´åäº†å¯¹è¯çš„è¿è´¯æ€§ã€‚</p>
<h4 data-id="heading-3">ç—›ç‚¹ 2ï¼šçŸ¥è¯†æ£€ç´¢æ•ˆç‡ä½</h4>
<p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç”¨æˆ·å¯èƒ½ä¼šåå¤æŸ¥è¯¢ç›¸ä¼¼çš„é—®é¢˜ï¼š</p>
<ul>
<li>ä¸Šå‘¨è¯¢é—®è¿‡çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæœ¬å‘¨éœ€è¦å†æ¬¡æŸ¥é˜…</li>
<li>ä¸åŒäº‹è®¨è®ºæ—¶éœ€è¦å›é¡¾ä¹‹å‰ä¸ AI çš„å¯¹è¯å†…å®¹</li>
<li>éœ€è¦æ•´ç† AI ç»™å‡ºçš„å¤šæ¬¡å»ºè®®è¿›è¡Œå¯¹æ¯”</li>
</ul>
<p><strong>å½±å“</strong>ï¼šæ²¡æœ‰å†å²è®°å½•æ„å‘³ç€æ¯æ¬¡éƒ½è¦é‡æ–°æé—®ï¼Œæµªè´¹ AI è®¡ç®—èµ„æºå’Œç”¨æˆ·æ—¶é—´ã€‚</p>
<h4 data-id="heading-4">ç—›ç‚¹ 3ï¼šç”¨æˆ·ä½“éªŒä¸ä½³</h4>
<p>å¯¹æ¯”ä¸»æµçš„ AI å¯¹è¯äº§å“ï¼ˆChatGPTã€Claudeã€æ–‡å¿ƒä¸€è¨€ç­‰ï¼‰ï¼Œç”¨æˆ·å·²ç»ä¹ æƒ¯äº†ä»¥ä¸‹ä½“éªŒï¼š</p>
<ul>
<li>å¯ä»¥éšæ—¶å›é¡¾å†å²å¯¹è¯</li>
<li>å¯ä»¥ç»§ç»­ä¹‹å‰çš„è¯é¢˜</li>
<li>å¯ä»¥åœ¨å¤šä¸ªè®¾å¤‡é—´åˆ‡æ¢ï¼ˆäº‘ç«¯åŒæ­¥ï¼‰</li>
</ul>
<p><strong>å½±å“</strong>ï¼šç¼ºä¹å†å²ä¼šè¯åŠŸèƒ½è®©äº§å“çš„ç”¨æˆ·ä½“éªŒå¤§æ‰“æŠ˜æ‰£ï¼Œé™ä½äº†ç”¨æˆ·ç²˜æ€§ã€‚</p>
<h3 data-id="heading-5">1.2 ä¸ºä»€ä¹ˆå†å²ä¼šè¯å¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<p>ä»äº§å“ä»·å€¼è§’åº¦çœ‹ï¼Œå†å²ä¼šè¯åŠŸèƒ½å¸¦æ¥çš„ä»·å€¼ä¸å®¹å¿½è§†ï¼š</p>





























<table><thead><tr><th>ä»·å€¼ç»´åº¦</th><th>å…·ä½“ä½“ç°</th></tr></thead><tbody><tr><td><strong>æå‡æ•ˆç‡</strong></td><td>å¿«é€Ÿå›é¡¾å†å²æ–¹æ¡ˆï¼Œæ— éœ€é‡å¤æé—®</td></tr><tr><td><strong>å¢å¼ºè¿è´¯æ€§</strong></td><td>æ”¯æŒå¤šè½®å¯¹è¯ï¼Œæ·±åº¦äº¤æµ</td></tr><tr><td><strong>çŸ¥è¯†æ²‰æ·€</strong></td><td>å†å²å¯¹è¯æˆä¸ºä¸ªäººçŸ¥è¯†åº“</td></tr><tr><td><strong>ä¼˜åŒ–å†³ç­–</strong></td><td>å¯¹æ¯”å¤šæ¬¡å’¨è¯¢ç»“æœï¼Œåšå‡ºæ›´å¥½çš„å†³ç­–</td></tr><tr><td><strong>ç”¨æˆ·ç•™å­˜</strong></td><td>ç¬¦åˆç”¨æˆ·ä½¿ç”¨ä¹ æƒ¯ï¼Œæå‡æ»¡æ„åº¦</td></tr></tbody></table>
<h2 data-id="heading-6">äºŒã€æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆé€‰æ‹©å‰ç«¯ IndexedDB æ–¹æ¡ˆï¼Ÿ</h2>
<p>é¢å¯¹è¿™ä¸ªç—›ç‚¹ï¼Œæˆ‘ä»¬æœ‰å¤šç§æŠ€æœ¯æ–¹æ¡ˆå¯é€‰ï¼š</p>
<h3 data-id="heading-7">2.1 æ–¹æ¡ˆå¯¹æ¯”</h3>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>åç«¯æ•°æ®åº“å­˜å‚¨</strong></td><td>æ•°æ®å¯é ã€æ”¯æŒå¤šç«¯åŒæ­¥</td><td>å¢åŠ æœåŠ¡å™¨å‹åŠ›ã€å¼€å‘å‘¨æœŸé•¿ã€ä¾èµ–åç«¯æœåŠ¡</td><td>ä¼ä¸šçº§åº”ç”¨ã€éœ€è¦å¤šç«¯åŒæ­¥</td></tr><tr><td><strong>LocalStorage</strong></td><td>ç®€å•æ˜“ç”¨</td><td>å®¹é‡é™åˆ¶ï¼ˆ5-10MBï¼‰ã€æ— ç´¢å¼•ã€æ€§èƒ½å·®</td><td>ç®€å•é…ç½®å­˜å‚¨</td></tr><tr><td><strong>SessionStorage</strong></td><td>é¡µé¢çº§éš”ç¦»</td><td>åˆ·æ–°å³å¤±æ•ˆã€æ— æ³•æŒä¹…åŒ–</td><td>ä¸´æ—¶æ•°æ®</td></tr><tr><td><strong>IndexedDBï¼ˆâœ… æˆ‘ä»¬çš„é€‰æ‹©ï¼‰</strong></td><td>å¤§å®¹é‡ã€é«˜æ€§èƒ½ã€æ”¯æŒç´¢å¼•ã€ç¦»çº¿å¯ç”¨</td><td>API ç›¸å¯¹å¤æ‚</td><td>å¤§é‡ç»“æ„åŒ–æ•°æ®å­˜å‚¨</td></tr></tbody></table>
<h3 data-id="heading-8">2.2 ä¸ºä»€ä¹ˆé€‰æ‹©å‰ç«¯ IndexedDB æ–¹æ¡ˆï¼Ÿ</h3>
<p>ç»è¿‡æŠ€æœ¯è°ƒç ”å’Œä¸šåŠ¡åˆ†æï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†<strong>åŸºäº IndexedDB çš„å‰ç«¯å­˜å‚¨æ–¹æ¡ˆ</strong>ï¼Œä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š</p>
<h4 data-id="heading-9">âœ… ä¼˜åŠ¿ 1ï¼šæè‡´çš„åŠ è½½é€Ÿåº¦</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¼ ç»Ÿåç«¯æ–¹æ¡ˆï¼šéœ€è¦ç½‘ç»œè¯·æ±‚</span>
ç”¨æˆ·ç‚¹å‡»å†å²å¯¹è¯ â†’ å‘é€ <span class="hljs-variable constant_">HTTP</span> è¯·æ±‚ â†’ ç­‰å¾…æœåŠ¡å™¨å“åº” â†’ æ•°æ®è¿”å› â†’ æ¸²æŸ“
â±ï¸ è€—æ—¶ï¼š500ms - 2000msï¼ˆå–å†³äºç½‘ç»œçŠ¶å†µï¼‰

<span class="hljs-comment">// IndexedDB æ–¹æ¡ˆï¼šæœ¬åœ°è¯»å–</span>
ç”¨æˆ·ç‚¹å‡»å†å²å¯¹è¯ â†’ ä»æœ¬åœ°æ•°æ®åº“è¯»å– â†’ æ¸²æŸ“
â±ï¸ è€—æ—¶ï¼š10ms - 50msï¼ˆçº¯æœ¬åœ°æ“ä½œï¼‰
</code></pre>
<p><strong>æ€§èƒ½æå‡ï¼š10-200 å€ï¼</strong></p>
<h4 data-id="heading-10">âœ… ä¼˜åŠ¿ 2ï¼šå¤©ç„¶çš„ç”¨æˆ·æ•°æ®éš”ç¦»</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ•°æ®æŒ‰ç”¨æˆ· ERP å­˜å‚¨</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConversationRecord</span> {
  <span class="hljs-attr">erp</span>: <span class="hljs-built_in">string</span>;  <span class="hljs-comment">// ç”¨æˆ·å”¯ä¸€æ ‡è¯†</span>
  <span class="hljs-attr">traceId</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">historyMessages</span>: <span class="hljs-title class_">HistoryMessage</span>[];
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// æŸ¥è¯¢æ—¶è‡ªåŠ¨éš”ç¦»</span>
<span class="hljs-keyword">await</span> conversationDB.<span class="hljs-title function_">getByErp</span>(currentUserErp);
</code></pre>
<p>æ¯ä¸ªç”¨æˆ·çš„æ•°æ®å­˜å‚¨åœ¨å„è‡ªçš„æµè§ˆå™¨ä¸­ï¼Œ<strong>å¤©ç„¶å®ç°äº†æ•°æ®éš”ç¦»</strong>ï¼Œæ— éœ€æ‹…å¿ƒæ•°æ®æ³„éœ²æˆ–æ··æ·†ã€‚</p>
<h4 data-id="heading-11">âœ… ä¼˜åŠ¿ 3ï¼šå¤§å¹…é™ä½åç«¯å‹åŠ›</h4>
<p>è®©æˆ‘ä»¬ç”¨æ•°æ®è¯´è¯ï¼š</p>
<p><strong>å‡è®¾åœºæ™¯</strong>ï¼š</p>
<ul>
<li>1000 ä¸ªæ´»è·ƒç”¨æˆ·</li>
<li>æ¯äººæ¯å¤©æŸ¥çœ‹å†å²å¯¹è¯ 10 æ¬¡</li>
<li>æ¯æ¬¡åŠ è½½ 50 æ¡å†å²æ¶ˆæ¯</li>
</ul>
<p><strong>åç«¯æ–¹æ¡ˆçš„èµ„æºæ¶ˆè€—</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">æ¯æ—¥æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ï¼š1000 * <span class="hljs-attr">10</span> = <span class="hljs-number">10</span>,<span class="hljs-number">000</span> æ¬¡/å¤©
æ¯æ¬¡æŸ¥è¯¢å“åº”å¤§å°ï¼š~50KB
æ¯æ—¥æµé‡æ¶ˆè€—ï¼š10,000 * 50KB â‰ˆ 488 MB/å¤©
æ•°æ®åº“è¿æ¥å¼€é”€ï¼šé«˜
æœåŠ¡å™¨ CPU/å†…å­˜å ç”¨ï¼šæ˜¾è‘—
</code></pre>
<p><strong>IndexedDB æ–¹æ¡ˆçš„èµ„æºæ¶ˆè€—</strong>ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">åç«¯è¯·æ±‚æ¬¡æ•°ï¼šä»…åœ¨æ–°å¯¹è¯æ—¶éœ€è¦è°ƒç”¨ SSE æ¥å£
å†å²åŠ è½½è¯·æ±‚ï¼š<span class="hljs-number">0</span> æ¬¡ï¼ˆå®Œå…¨æœ¬åœ°åŒ–ï¼‰
æœåŠ¡å™¨å‹åŠ›ï¼šé™ä½ <span class="hljs-number">90</span><span class="hljs-comment">% ä»¥ä¸Š</span>
åç«¯æˆæœ¬ï¼šæ˜¾è‘—é™ä½
</code></pre>
<p><strong>æˆæœ¬å¯¹æ¯”</strong>ï¼š</p>



































<table><thead><tr><th>ç»´åº¦</th><th>åç«¯æ–¹æ¡ˆ</th><th>IndexedDB æ–¹æ¡ˆ</th><th>èŠ‚çœæ¯”ä¾‹</th></tr></thead><tbody><tr><td>æ•°æ®åº“æŸ¥è¯¢</td><td>10,000 æ¬¡/å¤©</td><td>~100 æ¬¡/å¤©ï¼ˆä»…æ–°å¯¹è¯ï¼‰</td><td><strong>90%</strong></td></tr><tr><td>ç½‘ç»œæµé‡</td><td>488 MB/å¤©</td><td>~10 MB/å¤©</td><td><strong>98%</strong></td></tr><tr><td>æœåŠ¡å™¨è´Ÿè½½</td><td>é«˜</td><td>ä½</td><td><strong>80%+</strong></td></tr><tr><td>å“åº”å»¶è¿Ÿ</td><td>500-2000ms</td><td>10-50ms</td><td><strong>95%</strong></td></tr></tbody></table>
<h4 data-id="heading-12">âœ… ä¼˜åŠ¿ 4ï¼šç¦»çº¿å¯ç”¨æ€§</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å³ä½¿åœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹</span>
<span class="hljs-comment">// ç”¨æˆ·ä¾ç„¶å¯ä»¥ï¼š</span>
âœ… æŸ¥çœ‹æ‰€æœ‰å†å²å¯¹è¯
âœ… æµè§ˆè¿‡å¾€èŠå¤©è®°å½•
âœ… æœç´¢å†å²å†…å®¹ï¼ˆè§„åˆ’ä¸­ï¼‰
</code></pre>
<p>è¿™å¯¹äºç½‘ç»œä¸ç¨³å®šçš„åœºæ™¯ç‰¹åˆ«æœ‰ä»·å€¼ã€‚</p>
<h4 data-id="heading-13">âœ… ä¼˜åŠ¿ 5ï¼šæ•æ·çš„å¼€å‘è¿­ä»£</h4>
<pre><code class="hljs language-diff" lang="diff">åç«¯æ–¹æ¡ˆå¼€å‘å‘¨æœŸï¼š
<span class="hljs-deletion">- æ•°æ®åº“è¡¨è®¾è®¡ï¼š1å¤©</span>
<span class="hljs-deletion">- åç«¯æ¥å£å¼€å‘ï¼š2å¤©</span>
<span class="hljs-deletion">- å‰ç«¯å¼€å‘ï¼š1å¤©</span>
<span class="hljs-deletion">- æ¥å£è”è°ƒæµ‹è¯•ï¼š1å¤©</span>
<span class="hljs-deletion">- æµ‹è¯•ä¼˜åŒ–ï¼š1å¤©</span>
æ€»è®¡ï¼š7å¤©

IndexedDB æ–¹æ¡ˆå¼€å‘å‘¨æœŸï¼š
<span class="hljs-deletion">- æ•°æ®åº“å°è£…ï¼š1å¤©</span>
<span class="hljs-deletion">- å‰ç«¯å¼€å‘é›†æˆï¼š1å¤©</span>
<span class="hljs-deletion">- æµ‹è¯•ä¼˜åŒ–ï¼š1å¤©</span>
æ€»è®¡ï¼š3å¤©
</code></pre>
<p>è€Œä¸”æ— éœ€åè°ƒåç«¯èµ„æºï¼Œ<strong>å‰ç«¯ç‹¬ç«‹å®Œæˆ</strong>ï¼Œè¿­ä»£æ›´åŠ æ•æ·ã€‚</p>
<h4 data-id="heading-14">âœ… ä¼˜åŠ¿ 6ï¼šå¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// IndexedDB æ”¯æŒå¤šç»´åº¦ç´¢å¼•æŸ¥è¯¢</span>
- æŒ‰ç”¨æˆ·æŸ¥è¯¢ï¼š<span class="hljs-title function_">getByErp</span>(erp)
- æŒ‰æ¨¡å—æŸ¥è¯¢ï¼š<span class="hljs-title function_">getByCode</span>(code)
- æŒ‰ä¼šè¯æŸ¥è¯¢ï¼š<span class="hljs-title function_">getByTraceId</span>(traceId)
- å¤åˆæŸ¥è¯¢ï¼š<span class="hljs-title function_">getByErpAndCode</span>(erp, code)
- æ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼šæŒ‰ createdAt ç´¢å¼•æ’åº
</code></pre>
<p>é€šè¿‡åˆç†çš„ç´¢å¼•è®¾è®¡ï¼ŒæŸ¥è¯¢æ€§èƒ½å¯ä»¥åª²ç¾ä¸“ä¸šæ•°æ®åº“ã€‚</p>
<h2 data-id="heading-15">ä¸‰ã€æŠ€æœ¯å®ç°ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªé«˜æ€§èƒ½çš„å‰ç«¯å­˜å‚¨æ–¹æ¡ˆ</h2>
<h3 data-id="heading-16">3.1 æ•´ä½“æ¶æ„</h3>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·ç•Œé¢å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å†å²ä¼šè¯åˆ—è¡¨  â”‚  â”‚  æ¶ˆæ¯å±•ç¤ºåŒº   â”‚  â”‚   è¾“å…¥æ¡†     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¸šåŠ¡é€»è¾‘å±‚                           â”‚
â”‚  - ä¼šè¯ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ‡æ¢ã€åŠ è½½ï¼‰                           â”‚
â”‚  - æ¶ˆæ¯å¤„ç†ï¼ˆå‘é€ã€æ¥æ”¶ã€ä¿å­˜ï¼‰                           â”‚
â”‚  - çŠ¶æ€ç®¡ç†ï¼ˆReact State + Zustandï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IndexedDB      â”‚         â”‚   SSE å®æ—¶é€šä¿¡      â”‚   â”‚
â”‚  â”‚  (æœ¬åœ°æŒä¹…åŒ–)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   (ä¸AIäº¤äº’)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-17">3.2 æ ¸å¿ƒæŠ€æœ¯ç‚¹</h3>
<h4 data-id="heading-18">1. æ•°æ®åº“è®¾è®¡ï¼šç´¢å¼•ä¼˜åŒ–</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ›å»ºå¤šç»´åº¦ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½</span>
objectStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">"traceId"</span>, <span class="hljs-string">"traceId"</span>, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> });
objectStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">"erp"</span>, <span class="hljs-string">"erp"</span>, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> });
objectStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">"code"</span>, <span class="hljs-string">"code"</span>, { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> });
objectStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">"erp_traceId"</span>, [<span class="hljs-string">"erp"</span>, <span class="hljs-string">"traceId"</span>], { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> });
objectStore.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">"erp_code"</span>, [<span class="hljs-string">"erp"</span>, <span class="hljs-string">"code"</span>], { <span class="hljs-attr">unique</span>: <span class="hljs-literal">false</span> });
</code></pre>
<p><strong>ç´¢å¼•ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>å•å­—æ®µç´¢å¼•</strong>ï¼šç”¨äºç®€å•æŸ¥è¯¢ï¼ˆæŒ‰ç”¨æˆ·ã€æŒ‰ä¼šè¯ï¼‰</li>
<li><strong>å¤åˆç´¢å¼•</strong>ï¼šç”¨äºå¤šæ¡ä»¶æŸ¥è¯¢ï¼ˆæŒ‰ç”¨æˆ·+æ¨¡å—ï¼‰</li>
</ul>
<h4 data-id="heading-19">2. æµå¼å¯¹è¯ + å¢é‡ä¿å­˜</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// SSE æµå¼å“åº”å®æ—¶ä¿å­˜</span>
<span class="hljs-keyword">const</span> controller = airobotApi.<span class="hljs-title function_">chat</span>(params, {
  <span class="hljs-attr">onMessage</span>: <span class="hljs-keyword">async</span> (responseAll, done) =&gt; {
    <span class="hljs-comment">// å®æ—¶æ›´æ–° UIï¼ˆæµå¼æ˜¾ç¤ºï¼‰</span>
    <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> 
      msg.<span class="hljs-property">id</span> === assistantMessageId 
        ? { ...msg, <span class="hljs-attr">keyword</span>: responseAll }
        : msg
    ));
    
    <span class="hljs-comment">// å“åº”å®Œæˆåä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“</span>
    <span class="hljs-keyword">if</span> (done) {
      <span class="hljs-keyword">await</span> conversationDB.<span class="hljs-title function_">appendHistoryMessagesByTraceId</span>(
        <span class="hljs-title class_">TraceId</span>,
        [{
          <span class="hljs-attr">id</span>: <span class="hljs-title class_">TraceId</span>,
          <span class="hljs-attr">keyword</span>: responseAll,
          <span class="hljs-attr">type</span>: <span class="hljs-string">"assistant"</span>,
          <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        }]
      );
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHistoryChats</span>(); <span class="hljs-comment">// åˆ·æ–°å†å²åˆ—è¡¨</span>
    }
  }
});
</code></pre>
<p><strong>è®¾è®¡äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… ç”¨æˆ·ç«‹å³çœ‹åˆ° AI å“åº”ï¼ˆæµå¼ä½“éªŒï¼‰</li>
<li>âœ… å“åº”å®Œæˆåè‡ªåŠ¨ä¿å­˜ï¼ˆæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰</li>
<li>âœ… å¼‚æ­¥ä¿å­˜ä¸é˜»å¡ UIï¼ˆä½“éªŒæµç•…ï¼‰</li>
</ul>
<h4 data-id="heading-20">3. æ™ºèƒ½å»é‡æœºåˆ¶</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">add</span>(<span class="hljs-attr">record</span>: <span class="hljs-title class_">ConversationRecord</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; {
  <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„ traceId</span>
  <span class="hljs-keyword">const</span> existing = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getByTraceId</span>(record.<span class="hljs-property">traceId</span>);
  <span class="hljs-keyword">if</span> (existing.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`ä¼šè¯ <span class="hljs-subst">${record.traceId}</span> å·²å­˜åœ¨ï¼Œè·³è¿‡æ·»åŠ `</span>);
    <span class="hljs-keyword">return</span> existing[<span class="hljs-number">0</span>].<span class="hljs-property">id</span>!;
  }
  
  <span class="hljs-comment">// ä¸å­˜åœ¨æ‰æ·»åŠ </span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> transaction = <span class="hljs-variable language_">this</span>.<span class="hljs-property">db</span>!.<span class="hljs-title function_">transaction</span>([<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>], <span class="hljs-string">"readwrite"</span>);
    <span class="hljs-keyword">const</span> request = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">storeName</span>).<span class="hljs-title function_">add</span>({
      ...record,
      <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">updatedAt</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    });
    <span class="hljs-comment">// ...</span>
  });
}
</code></pre>
<p>é¿å…äº†é‡å¤æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</p>
<h4 data-id="heading-21">4. æŒ‰æ—¥æœŸåˆ†ç»„å±•ç¤º</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å°†å†å²ä¼šè¯æŒ‰æ—¥æœŸåˆ†ç»„</span>
<span class="hljs-keyword">const</span> groupedChats = records.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">groups, record</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(record.<span class="hljs-property">createdAt</span>!).<span class="hljs-title function_">toLocaleDateString</span>(<span class="hljs-string">"zh-CN"</span>, {
    <span class="hljs-attr">year</span>: <span class="hljs-string">"numeric"</span>,
    <span class="hljs-attr">month</span>: <span class="hljs-string">"2-digit"</span>,
    <span class="hljs-attr">day</span>: <span class="hljs-string">"2-digit"</span>,
  }).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">"/"</span>);
  
  <span class="hljs-keyword">if</span> (!groups[date]) {
    groups[date] = [];
  }
  
  groups[date].<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">traceId</span>: record.<span class="hljs-property">traceId</span>,
    <span class="hljs-attr">name</span>: record.<span class="hljs-property">keyword</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>) + 
          (record.<span class="hljs-property">keyword</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">20</span> ? <span class="hljs-string">"..."</span> : <span class="hljs-string">""</span>),
    <span class="hljs-attr">active</span>: record.<span class="hljs-property">traceId</span> === currentTraceId,
    <span class="hljs-attr">createdAt</span>: record.<span class="hljs-property">createdAt</span>,
  });
  
  <span class="hljs-keyword">return</span> groups;
}, {} <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">HistoryChatItem</span>[]&gt;);
</code></pre>
<p><strong>å±•ç¤ºæ•ˆæœ</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">2024/12/19
<span class="hljs-bullet">  -</span> å¦‚ä½•è¿›è¡Œä¼ä¸šä¿¡ç”¨è¯„ä¼°ï¼Ÿ
<span class="hljs-bullet">  -</span> åæ¬ºè¯ˆæ¨¡å‹çš„æ ¸å¿ƒæŒ‡æ ‡
  
2024/12/18
<span class="hljs-bullet">  -</span> ä¸ªäººå¾ä¿¡æŠ¥å‘Šè§£è¯»
<span class="hljs-bullet">  -</span> é£é™©é¢„è­¦ç­–ç•¥ä¼˜åŒ–
</code></pre>
<p>ç”¨æˆ·å¯ä»¥å¿«é€Ÿå®šä½åˆ°ç‰¹å®šæ—¥æœŸçš„å¯¹è¯ã€‚</p>
<h3 data-id="heading-22">3.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3>
<h4 data-id="heading-23">ä¼˜åŒ– 1ï¼šå»¶è¿ŸåŠ è½½å†å²æ¶ˆæ¯</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å†å²åˆ—è¡¨åªæ˜¾ç¤ºæ ‡é¢˜ï¼Œç‚¹å‡»æ—¶æ‰åŠ è½½å®Œæ•´æ¶ˆæ¯</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleHistoryChatClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">traceId: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-title function_">setSearchParams</span>({ traceId });
  <span class="hljs-title function_">setCurrentTraceId</span>(traceId);
  
  <span class="hljs-comment">// æ­¤æ—¶æ‰ä» IndexedDB åŠ è½½å®Œæ•´çš„å†å²æ¶ˆæ¯</span>
  <span class="hljs-keyword">const</span> records = <span class="hljs-keyword">await</span> conversationDB.<span class="hljs-title function_">getByTraceId</span>(traceId);
  <span class="hljs-keyword">if</span> (records.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">setMessages</span>(records[<span class="hljs-number">0</span>].<span class="hljs-property">historyMessages</span> || []);
  }
};
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯ï¼ŒèŠ‚çœå†…å­˜å’Œæ¸²æŸ“æ—¶é—´ã€‚</p>
<h4 data-id="heading-24">ä¼˜åŒ– 2ï¼šè¿æ¥ç®¡ç†</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å…³é—­ SSE è¿æ¥</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (sseControllerRef.<span class="hljs-property">current</span>) {
      sseControllerRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">close</span>();
      sseControllerRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
    }
  };
}, []);
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œé¿å…å¤šä¸ª SSE è¿æ¥åŒæ—¶å­˜åœ¨ã€‚</p>
<h4 data-id="heading-25">ä¼˜åŒ– 3ï¼šæ‰¹é‡æ›´æ–° UI</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼Œé¿å…é‡å¤æ¸²æŸ“</span>
<span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> 
  msg.<span class="hljs-property">id</span> === assistantMessageId 
    ? { ...msg, <span class="hljs-attr">keyword</span>: responseAll }
    : msg
));
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼šReact çš„æ‰¹å¤„ç†æœºåˆ¶ç¡®ä¿å¤šæ¬¡çŠ¶æ€æ›´æ–°åªè§¦å‘ä¸€æ¬¡æ¸²æŸ“ã€‚</p>
<h2 data-id="heading-26">å››ã€å®æµ‹æ•°æ®ï¼šé‡åŒ–çš„æ€§èƒ½æå‡</h2>
<p>æˆ‘ä»¬åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­è¿›è¡Œäº†å¯¹æ¯”æµ‹è¯•ï¼š</p>
<h3 data-id="heading-27">æµ‹è¯•ç¯å¢ƒ</h3>
<ul>
<li>ç”¨æˆ·æ•°é‡ï¼š100 äºº</li>
<li>ä¼šè¯æ•°é‡ï¼šæ¯äººå¹³å‡ 20 ä¸ªä¼šè¯</li>
<li>æ¶ˆæ¯æ•°é‡ï¼šæ¯ä¸ªä¼šè¯å¹³å‡ 10 æ¡æ¶ˆæ¯</li>
<li>æµ‹è¯•è®¾å¤‡ï¼šMacBook Pro 2021, Chrome 120</li>
</ul>
<h3 data-id="heading-28">æµ‹è¯•ç»“æœ</h3>









































<table><thead><tr><th>æ“ä½œåœºæ™¯</th><th>åç«¯æ–¹æ¡ˆ</th><th>IndexedDB æ–¹æ¡ˆ</th><th>æå‡å€æ•°</th></tr></thead><tbody><tr><td><strong>åŠ è½½å†å²åˆ—è¡¨</strong></td><td>856 ms</td><td>23 ms</td><td><strong>37x</strong></td></tr><tr><td><strong>æ‰“å¼€å†å²å¯¹è¯</strong></td><td>1240 ms</td><td>18 ms</td><td><strong>69x</strong></td></tr><tr><td><strong>æœç´¢ä¼šè¯</strong></td><td>1560 ms</td><td>45 ms</td><td><strong>35x</strong></td></tr><tr><td><strong>åˆ‡æ¢ä¼šè¯</strong></td><td>720 ms</td><td>12 ms</td><td><strong>60x</strong></td></tr><tr><td><strong>ç¦»çº¿è®¿é—®</strong></td><td>âŒ ä¸å¯ç”¨</td><td>âœ… å¯ç”¨</td><td>-</td></tr></tbody></table>
<h3 data-id="heading-29">ç”¨æˆ·ä½“éªŒæŒ‡æ ‡</h3>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>åç«¯æ–¹æ¡ˆ</th><th>IndexedDB æ–¹æ¡ˆ</th><th>æ”¹å–„å¹…åº¦</th></tr></thead><tbody><tr><td><strong>é¦–æ¬¡åŠ è½½æ—¶é—´</strong></td><td>2.3s</td><td>0.8s</td><td><strong>65%</strong></td></tr><tr><td><strong>æ“ä½œå“åº”æ—¶é—´</strong></td><td>1.2s</td><td>0.03s</td><td><strong>97%</strong></td></tr><tr><td><strong>ç¦»çº¿å¯ç”¨æ€§</strong></td><td>0%</td><td>100%</td><td><strong>+100%</strong></td></tr><tr><td><strong>åç«¯ QPS</strong></td><td>2500/åˆ†é’Ÿ</td><td>250/åˆ†é’Ÿ</td><td><strong>-90%</strong></td></tr></tbody></table>
<h3 data-id="heading-30">æˆæœ¬èŠ‚çº¦ä¼°ç®—</h3>
<p><strong>å‡è®¾ï¼š</strong></p>
<ul>
<li>åç«¯æœåŠ¡å™¨æˆæœ¬ï¼š$200/æœˆï¼ˆ2æ ¸4Gï¼‰</li>
<li>æ•°æ®åº“æˆæœ¬ï¼š$150/æœˆï¼ˆåŸºç¡€å®ä¾‹ï¼‰</li>
<li>å¸¦å®½æˆæœ¬ï¼š$50/æœˆ</li>
</ul>
<p><strong>é‡‡ç”¨ IndexedDB æ–¹æ¡ˆåï¼š</strong></p>
<ul>
<li>åç«¯è´Ÿè½½é™ä½ 90%ï¼Œå¯èŠ‚çœæœåŠ¡å™¨èµ„æº</li>
<li>æ•°æ®åº“æŸ¥è¯¢å‡å°‘ 90%ï¼Œå¯é™çº§æ•°æ®åº“å®ä¾‹</li>
<li>ç½‘ç»œæµé‡å‡å°‘ 98%</li>
</ul>
<p><strong>é¢„è®¡æ¯æœˆèŠ‚çœï¼š$300-400</strong></p>
<h2 data-id="heading-31">äº”ã€æ–¹æ¡ˆçš„ä¸è¶³ä¸æœªæ¥è§„åˆ’</h2>
<h3 data-id="heading-32">5.1 å½“å‰å±€é™æ€§</h3>
<p>è™½ç„¶å‰ç«¯ IndexedDB æ–¹æ¡ˆæœ‰è¯¸å¤šä¼˜åŠ¿ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›å±€é™ï¼š</p>






























<table><thead><tr><th>å±€é™æ€§</th><th>å½±å“</th><th>ç¼“è§£æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>æ— æ³•å¤šç«¯åŒæ­¥</strong></td><td>æ›´æ¢è®¾å¤‡æˆ–æµè§ˆå™¨åæ•°æ®ä¸¢å¤±</td><td>è§„åˆ’äº‘ç«¯åŒæ­¥åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰</td></tr><tr><td><strong>æ•°æ®å¤‡ä»½å›°éš¾</strong></td><td>ç”¨æˆ·æ— æ³•ä¸»åŠ¨å¤‡ä»½æ•°æ®</td><td>æä¾›æ•°æ®å¯¼å‡ºåŠŸèƒ½</td></tr><tr><td><strong>å­˜å‚¨ç©ºé—´é™åˆ¶</strong></td><td>æµè§ˆå™¨æœ‰å­˜å‚¨é…é¢é™åˆ¶ï¼ˆé€šå¸¸ &gt;50MBï¼‰</td><td>å®ç°è‡ªåŠ¨æ¸…ç†è€æ—§æ•°æ®</td></tr><tr><td><strong>éšç§æ¨¡å¼å¤±æ•ˆ</strong></td><td>éšç§/æ— ç—•æ¨¡å¼ä¸‹æ•°æ®ä¸æŒä¹…åŒ–</td><td>æç¤ºç”¨æˆ·åˆ‡æ¢åˆ°æ™®é€šæ¨¡å¼</td></tr></tbody></table>
<h3 data-id="heading-33">5.2 æœªæ¥è§„åˆ’</h3>
<h4 data-id="heading-34">é˜¶æ®µä¸€ï¼šåŠŸèƒ½å®Œå–„ï¼ˆQ4 2025ï¼‰</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¯¹è¯æœç´¢ï¼ˆå…¨æ–‡æ£€ç´¢ï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¯¹è¯å¯¼å‡ºï¼ˆJSON/Markdownï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¯¹è¯åˆ é™¤</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¯¹è¯é‡å‘½å</li>
</ul>
<h4 data-id="heading-35">é˜¶æ®µäºŒï¼šä½“éªŒä¼˜åŒ–ï¼ˆQ1 2026ï¼‰</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ”¯æŒæ•°åƒæ¡å†å²è®°å½•ï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä»£ç å—è¯­æ³•é«˜äº®</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ¶ˆæ¯å¤åˆ¶å’Œå¼•ç”¨</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ¶ˆæ¯åé¦ˆï¼ˆç‚¹èµ/ç‚¹è¸©ï¼‰</li>
</ul>
<h4 data-id="heading-36">é˜¶æ®µä¸‰ï¼šé«˜çº§åŠŸèƒ½ï¼ˆQ2 2026ï¼‰</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> äº‘ç«¯åŒæ­¥ï¼ˆå¯é€‰ï¼Œéœ€åç«¯æ”¯æŒï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ•°æ®åŠ å¯†å­˜å‚¨</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ™ºèƒ½æ ‡ç­¾å’Œåˆ†ç±»</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä¼šè¯åˆ†äº«åŠŸèƒ½</li>
</ul>
<h2 data-id="heading-37">å…­ã€æ€»ç»“ï¼šå‰ç«¯å­˜å‚¨çš„æœ€ä½³å®è·µ</h2>
<p>é€šè¿‡è¿™æ¬¡å®è·µï¼Œæˆ‘ä»¬éªŒè¯äº†<strong>åœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå‰ç«¯å­˜å‚¨æ–¹æ¡ˆå¯ä»¥æ¯”ä¼ ç»Ÿåç«¯æ–¹æ¡ˆæ›´ä¼˜ç§€</strong>ã€‚</p>
<h3 data-id="heading-38">æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<p>âœ… <strong>é€‰æ‹© IndexedDB çš„é»„é‡‘åœºæ™¯</strong>ï¼š</p>
<ol>
<li>æ•°æ®å±äºå•ç”¨æˆ·ä½¿ç”¨ï¼Œæ— éœ€å¤šç«¯åŒæ­¥</li>
<li>æ•°æ®é‡é€‚ä¸­ï¼ˆå‡ åƒåˆ°å‡ ä¸‡æ¡è®°å½•ï¼‰</li>
<li>è¯»å–é¢‘ç‡è¿œé«˜äºå†™å…¥é¢‘ç‡</li>
<li>éœ€è¦å¿«é€Ÿå“åº”çš„ç”¨æˆ·ä½“éªŒ</li>
<li>å¸Œæœ›é™ä½åç«¯æˆæœ¬å’Œå¤æ‚åº¦</li>
</ol>
<p>âœ… <strong>å®ç°é«˜è´¨é‡æ–¹æ¡ˆçš„å…³é”®</strong>ï¼š</p>
<ol>
<li>åˆç†çš„ç´¢å¼•è®¾è®¡ï¼ˆå•å­—æ®µ + å¤åˆç´¢å¼•ï¼‰</li>
<li>å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ</li>
<li>è‰¯å¥½çš„å°è£…å’ŒæŠ½è±¡</li>
<li>æŒç»­çš„æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–</li>
</ol>
<p>âœ… <strong>é‡åŒ–çš„æ”¶ç›Š</strong>ï¼š</p>
<ul>
<li><strong>æ€§èƒ½æå‡</strong>ï¼š37-69 å€åŠ è½½é€Ÿåº¦</li>
<li><strong>æˆæœ¬èŠ‚çº¦</strong>ï¼š90% åç«¯å‹åŠ›é™ä½</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼š97% å“åº”æ—¶é—´ç¼©çŸ­</li>
<li><strong>å¼€å‘æ•ˆç‡</strong>ï¼š3-4 å¤©å³å¯ä¸Šçº¿</li>
</ul>
<h3 data-id="heading-39">æŠ€æœ¯å¯ç¤º</h3>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„æˆåŠŸå‘Šè¯‰æˆ‘ä»¬ï¼š</p>
<blockquote>
<p><strong>ä¸è¦è¿·ä¿¡"åç«¯ä¸‡èƒ½è®º"ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘å’Œå‰ç«¯æŠ€æœ¯é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå‰ç«¯å·²ç»å…·å¤‡äº†å¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å­˜å‚¨çš„èƒ½åŠ›ã€‚åˆç†åˆ©ç”¨æµè§ˆå™¨æä¾›çš„å¼ºå¤§ APIï¼ˆIndexedDBã€Service Workerã€WebAssembly ç­‰ï¼‰ï¼Œå¯ä»¥æ„å»ºå‡ºæ€§èƒ½å“è¶Šã€ç”¨æˆ·ä½“éªŒä¸€æµçš„åº”ç”¨ã€‚</strong></p>
</blockquote>
<p>å‰ç«¯å·¥ç¨‹å¸ˆåº”è¯¥è·³å‡º"åªåšé¡µé¢å±•ç¤º"çš„æ€ç»´å®šå¼ï¼Œä¸»åŠ¨æ€è€ƒï¼š</p>
<ul>
<li>å“ªäº›æ•°æ®å¯ä»¥æ”¾åœ¨å‰ç«¯ï¼Ÿ</li>
<li>å“ªäº›è®¡ç®—å¯ä»¥åœ¨æµè§ˆå™¨å®Œæˆï¼Ÿ</li>
<li>å¦‚ä½•åœ¨å‰åç«¯ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ï¼Ÿ</li>
</ul>
<h3 data-id="heading-40">å†™åœ¨æœ€å</h3>
<p>IndexedDB æ–¹æ¡ˆä¸æ˜¯é“¶å¼¹ï¼Œä½†åœ¨åˆé€‚çš„åœºæ™¯ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæå…·æ€§ä»·æ¯”çš„é€‰æ‹©ã€‚å¸Œæœ›è¿™ä¸ªæ¡ˆä¾‹èƒ½ç»™å¤§å®¶å¸¦æ¥å¯å‘ï¼Œåœ¨é¢å¯¹ç±»ä¼¼é—®é¢˜æ—¶ï¼Œå¤šä¸€ä¸ªè§£å†³æ€è·¯ã€‚</p>
<p>æŠ€æœ¯çš„æœ¬è´¨æ˜¯è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯å †ç Œå·¥å…·ã€‚é€‰æ‹©æœ€é€‚åˆä¸šåŠ¡åœºæ™¯çš„æ–¹æ¡ˆï¼Œæ‰æ˜¯ä¼˜ç§€å·¥ç¨‹å¸ˆçš„ç‰¹è´¨ã€‚</p>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FIndexedDB_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API" ref="nofollow noopener noreferrer">IndexedDB API - MDN</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FServer-sent_events" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events" ref="nofollow noopener noreferrer">Server-Sent Events - MDN</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Frender-and-commit" target="_blank" title="https://react.dev/learn/render-and-commit" ref="nofollow noopener noreferrer">React æ€§èƒ½ä¼˜åŒ–æŒ‡å—</a></li>
</ul>
<p><strong>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œæ¬¢è¿åˆ†äº«ç»™æ›´å¤šå‰ç«¯å°ä¼™ä¼´ï¼</strong> ğŸ’ª</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux ä¼‘çœ æ—¶å†…æ ¸çº¿ç¨‹å†»ç»“æœºåˆ¶è¯´æ˜]]></title>    <link>https://juejin.cn/post/7585390679397826566</link>    <guid>https://juejin.cn/post/7585390679397826566</guid>    <pubDate>2025-12-19T12:57:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585390679397826566" data-draft-id="7585382553289408548" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux ä¼‘çœ æ—¶å†…æ ¸çº¿ç¨‹å†»ç»“æœºåˆ¶è¯´æ˜"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-19T12:57:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_CH"/> <meta itemprop="url" content="https://juejin.cn/user/4074114702122217"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux ä¼‘çœ æ—¶å†…æ ¸çº¿ç¨‹å†»ç»“æœºåˆ¶è¯´æ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4074114702122217/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_CH
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:57:46.000Z" title="Fri Dec 19 2025 12:57:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å†»ç»“æµç¨‹æ¦‚è¿°</h2>
<p>Linuxä¼‘çœ æ—¶çš„å†»ç»“è¿‡ç¨‹åˆ†ä¸º<strong>ä¸¤ä¸ªé˜¶æ®µ</strong>ï¼š</p>
<h3 data-id="heading-1">é˜¶æ®µ1ï¼šå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</h3>
<ul>
<li>è°ƒç”¨ï¼š<code>freeze_processes()</code></li>
<li>è®¾ç½®ï¼š<code>pm_freezing = true</code></li>
<li>è°ƒç”¨ï¼š<code>try_to_freeze_tasks(true)</code> - <code>user_only=true</code></li>
<li>ç›®æ ‡ï¼šåªå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ˆéå†…æ ¸çº¿ç¨‹ï¼‰</li>
</ul>
<h3 data-id="heading-2">é˜¶æ®µ2ï¼šå†»ç»“å†…æ ¸çº¿ç¨‹</h3>
<ul>
<li>è°ƒç”¨ï¼š<code>freeze_kernel_threads()</code></li>
<li>è®¾ç½®ï¼š<code>pm_nosig_freezing = true</code></li>
<li>è°ƒç”¨ï¼š<code>try_to_freeze_tasks(false)</code> - <code>user_only=false</code></li>
<li>ç›®æ ‡ï¼šå†»ç»“å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹</li>
</ul>
<h2 data-id="heading-3">äºŒã€ä»£ç å®ç°åˆ†æ</h2>
<h3 data-id="heading-4">2.1 å†»ç»“åˆ¤æ–­é€»è¾‘</h3>
<p>åœ¨ <code>kernel/freezer.c</code> çš„ <code>freezing_slow_path()</code> å‡½æ•°ä¸­ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">bool</span> <span class="hljs-title function_">freezing_slow_path</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> task_struct *p)</span>
{
    <span class="hljs-keyword">if</span> (p-&gt;flags &amp; (PF_NOFREEZE | PF_SUSPEND_TASK))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (pm_nosig_freezing || cgroup_freezing(p))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ç¬¬äºŒé˜¶æ®µï¼šå†»ç»“æ‰€æœ‰ä»»åŠ¡ï¼ˆåŒ…æ‹¬å†…æ ¸çº¿ç¨‹ï¼‰</span>

    <span class="hljs-keyword">if</span> (pm_freezing &amp;&amp; !(p-&gt;flags &amp; PF_KTHREAD))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ç¬¬ä¸€é˜¶æ®µï¼šåªå†»ç»“éå†…æ ¸çº¿ç¨‹</span>

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€é˜¶æ®µ</strong>ï¼ˆ<code>pm_freezing=true</code>ï¼‰ï¼š<code>!(p-&gt;flags &amp; PF_KTHREAD)</code> - åªå†»ç»“éå†…æ ¸çº¿ç¨‹</li>
<li><strong>ç¬¬äºŒé˜¶æ®µ</strong>ï¼ˆ<code>pm_nosig_freezing=true</code>ï¼‰ï¼šä¼šå†»ç»“æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒ…æ‹¬å†…æ ¸çº¿ç¨‹</li>
</ul>
<h3 data-id="heading-5">2.2 å†»ç»“æµç¨‹ä»£ç </h3>
<p>åœ¨ <code>kernel/power/power.h</code> ä¸­ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_freeze_processes</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    <span class="hljs-comment">// ç¬¬ä¸€é˜¶æ®µï¼šå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</span>
    error = freeze_processes();  <span class="hljs-comment">// è®¾ç½® pm_freezing=true, è°ƒç”¨ try_to_freeze_tasks(true)</span>
    
    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span> error;
    
    <span class="hljs-comment">// ç¬¬äºŒé˜¶æ®µï¼šå†»ç»“å†…æ ¸çº¿ç¨‹</span>
    error = freeze_kernel_threads();  <span class="hljs-comment">// è®¾ç½® pm_nosig_freezing=true, è°ƒç”¨ try_to_freeze_tasks(false)</span>
    
    <span class="hljs-keyword">if</span> (error) {
        thaw_processes();  <span class="hljs-comment">// å¦‚æœå¤±è´¥ï¼Œè§£å†»æ‰€æœ‰è¿›ç¨‹</span>
    }
    
    <span class="hljs-keyword">return</span> error;
}
</code></pre>
<h3 data-id="heading-6">2.3 ä¸å¯å†»ç»“ä»»åŠ¡çš„åˆ¤æ–­</h3>
<p>åœ¨ <code>kernel/power/process.c</code> çš„ <code>try_to_freeze_tasks()</code> å‡½æ•°ä¸­ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* æ£€æŸ¥æ˜¯å¦ä¸å¯å†»ç»“ */</span>
<span class="hljs-keyword">if</span> (p-&gt;flags &amp; PF_NOFREEZE) {
    unfreezable_tasks++;
    <span class="hljs-comment">// æ ‡è®°ä¸ºUNFREEZABLEï¼Œè·³è¿‡ï¼Œä¸è°ƒç”¨freeze_task</span>
    <span class="hljs-keyword">continue</span>;
}

<span class="hljs-comment">/* å°è¯•å†»ç»“ä»»åŠ¡ */</span>
<span class="hljs-keyword">if</span> (!freeze_task(p)) {
    failed_freeze_tasks++;
    <span class="hljs-comment">// æ ‡è®°ä¸ºFAILED_FREEZE</span>
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€å®é™…æ—¥å¿—åˆ†æ</h2>
<p>ä» <code>20251219_12.log</code> æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<h3 data-id="heading-8">3.1 ç¬¬ä¸€é˜¶æ®µï¼šå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.808286]</span> Freezing user space processes ... 
<span class="hljs-section">[   98.808292]</span> LLLLLLLL try_to_freeze_tasks: <span class="hljs-attr">user_only</span>=<span class="hljs-number">1</span>, timeout=<span class="hljs-number">20000</span> ms
<span class="hljs-section">[   98.810973]</span> LLLLLLLL UNFREEZABLE: kthreadd (pid 2), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x208040, state=<span class="hljs-number">1</span>
<span class="hljs-section">[   98.811793]</span> LLLLLLLL UNFREEZABLE: rcu_gp (pid 3), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x4208060, state=<span class="hljs-number">1026</span>
...
</code></pre>
<p><strong>è§‚å¯Ÿ</strong>ï¼š</p>
<ul>
<li><code>user_only=1</code> - åªå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</li>
<li>ä½†æ˜¯ä»ç„¶ä¼šéå†æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒ…æ‹¬å†…æ ¸çº¿ç¨‹</li>
<li>å†…æ ¸çº¿ç¨‹ä¼šè¢«æ ‡è®°ä¸ºUNFREEZABLEï¼ˆå¦‚æœæœ‰PF_NOFREEZEæ ‡å¿—ï¼‰æˆ–è·³è¿‡</li>
</ul>
<h3 data-id="heading-9">3.2 ç¬¬äºŒé˜¶æ®µï¼šå†»ç»“å†…æ ¸çº¿ç¨‹</h3>
<p><strong>é‡è¦å‘ç°</strong>ï¼šä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<strong>ç¬¬ä¸€é˜¶æ®µå°±å¤±è´¥äº†</strong>ï¼Œæ‰€ä»¥æ²¡æœ‰è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[  119.065869]</span> freeze_processes: failed to freeze tasks, error -16
<span class="hljs-section">[  119.066756]</span> freeze_processes: failed with error -16, thawing processes
<span class="hljs-section">[  119.177013]</span> PM: SUSPEND_DEBUG: suspend_prepare: freeze failed, <span class="hljs-attr">error</span>=-<span class="hljs-number">16</span>
<span class="hljs-section">[  119.177018]</span> PM: SUSPEND_DEBUG: suspend_prepare: FORCE SUSPEND enabled, ignoring freeze failure
</code></pre>
<p><strong>å®é™…æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼ˆ<code>freeze_processes()</code>ï¼‰è¶…æ—¶å¤±è´¥ï¼ˆerror -16 = EBUSYï¼‰</li>
<li>ç³»ç»Ÿå¯ç”¨äº†<code>FORCE SUSPEND</code>æ¨¡å¼ï¼Œå³ä½¿å†»ç»“å¤±è´¥ä¹Ÿç»§ç»­æŒ‚èµ·</li>
<li><strong>å› æ­¤æ²¡æœ‰è¿›å…¥ç¬¬äºŒé˜¶æ®µ</strong>ï¼ˆ<code>freeze_kernel_threads()</code>ï¼‰</li>
<li>è¿™æ„å‘³ç€<strong>å†…æ ¸çº¿ç¨‹æ²¡æœ‰è¢«å†»ç»“</strong></li>
</ul>
<p><strong>è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ</strong>ï¼š</p>
<ul>
<li>åªæœ‰3ä¸ªä»»åŠ¡è¢«æˆåŠŸå†»ç»“ï¼ˆéƒ½æ˜¯ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼‰</li>
<li>24ä¸ªä»»åŠ¡æ‹’ç»å†»ç»“ï¼ˆåŒ…æ‹¬kswapd0å’Œjbd2çº¿ç¨‹ï¼‰</li>
<li>95ä¸ªä»»åŠ¡è¢«æ ‡è®°ä¸ºUNFREEZABLEï¼ˆæœ‰PF_NOFREEZEæ ‡å¿—çš„å†…æ ¸çº¿ç¨‹ï¼‰</li>
</ul>
<h2 data-id="heading-10">å››ã€å…³é”®é—®é¢˜å›ç­”</h2>
<h3 data-id="heading-11">Q: åœ¨ä¼‘çœ å”¤é†’æ—¶ï¼Œå†…æ ¸çš„è¿™äº›taskä¹Ÿä¼šå†»ç»“å—ï¼Ÿ</h3>
<p><strong>A: æ˜¯çš„ï¼Œä½†åˆ†ä¸¤ä¸ªé˜¶æ®µï¼Œä¸”æœ‰ä¾‹å¤–</strong></p>
<h3 data-id="heading-12">è¯¦ç»†è¯´æ˜ï¼š</h3>
<ol>
<li>
<p><strong>ç¬¬ä¸€é˜¶æ®µ - åªå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</strong>ï¼š</p>
<ul>
<li>è®¾ç½® <code>pm_freezing = true</code></li>
<li>è°ƒç”¨ <code>try_to_freeze_tasks(true)</code> - <code>user_only=true</code></li>
<li>åœ¨ <code>freezing_slow_path()</code> ä¸­ï¼š<code>if (pm_freezing &amp;&amp; !(p-&gt;flags &amp; PF_KTHREAD))</code></li>
<li><strong>åªå†»ç»“éå†…æ ¸çº¿ç¨‹</strong>ï¼ˆç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ç¬¬äºŒé˜¶æ®µ - å†»ç»“å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼š</p>
<ul>
<li>è®¾ç½® <code>pm_nosig_freezing = true</code></li>
<li>è°ƒç”¨ <code>try_to_freeze_tasks(false)</code> - <code>user_only=false</code></li>
<li>åœ¨ <code>freezing_slow_path()</code> ä¸­ï¼š<code>if (pm_nosig_freezing || cgroup_freezing(p))</code></li>
<li><strong>ä¼šå†»ç»“æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒ…æ‹¬å†…æ ¸çº¿ç¨‹</strong></li>
</ul>
</li>
<li>
<p><strong>ä¾‹å¤– - ä¸å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼š</p>
<ul>
<li>æœ‰ <code>PF_NOFREEZE</code> æ ‡å¿—çš„å†…æ ¸çº¿ç¨‹<strong>ä¸ä¼šè¢«å†»ç»“</strong></li>
<li>åœ¨ <code>try_to_freeze_tasks()</code> ä¸­ä¼šè¢«è·³è¿‡</li>
<li>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹åˆ°95ä¸ªUNFREEZABLEä»»åŠ¡</li>
</ul>
</li>
</ol>
<h3 data-id="heading-13">æ€»ç»“ï¼š</h3>
<ul>
<li>âœ… <strong>ç”¨æˆ·ç©ºé—´è¿›ç¨‹</strong>ï¼šç¬¬ä¸€é˜¶æ®µè¢«å†»ç»“</li>
<li>âœ… <strong>å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼‰ï¼šç¬¬äºŒé˜¶æ®µè¢«å†»ç»“</li>
<li>âŒ <strong>ä¸å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼ˆæœ‰PF_NOFREEZEæ ‡å¿—ï¼‰ï¼šä¸ä¼šè¢«å†»ç»“</li>
</ul>
<h2 data-id="heading-14">äº”ã€ä¸ºä»€ä¹ˆå†…æ ¸çº¿ç¨‹è¦åˆ†ä¸¤ä¸ªé˜¶æ®µå†»ç»“ï¼Ÿ</h2>
<h3 data-id="heading-15">5.1 è®¾è®¡åŸå› </h3>
<ol>
<li>
<p><strong>ç”¨æˆ·ç©ºé—´è¿›ç¨‹ä¼˜å…ˆ</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·ç©ºé—´è¿›ç¨‹å¯èƒ½æ­£åœ¨æ‰§è¡Œå…³é”®æ“ä½œ</li>
<li>éœ€è¦å…ˆç¡®ä¿ç”¨æˆ·ç©ºé—´è¿›ç¨‹åœæ­¢ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´</li>
</ul>
</li>
<li>
<p><strong>å†…æ ¸çº¿ç¨‹å¯èƒ½ä¾èµ–ç”¨æˆ·ç©ºé—´</strong>ï¼š</p>
<ul>
<li>æŸäº›å†…æ ¸çº¿ç¨‹å¯èƒ½æ­£åœ¨å¤„ç†æ¥è‡ªç”¨æˆ·ç©ºé—´çš„è¯·æ±‚</li>
<li>å…ˆå†»ç»“ç”¨æˆ·ç©ºé—´ï¼Œå¯ä»¥é¿å…å†…æ ¸çº¿ç¨‹å¤„ç†åˆ°ä¸€åŠè¢«å†»ç»“</li>
</ul>
</li>
<li>
<p><strong>é”™è¯¯å¤„ç†</strong>ï¼š</p>
<ul>
<li>å¦‚æœç¬¬ä¸€é˜¶æ®µå¤±è´¥ï¼Œåªéœ€è¦è§£å†»ç”¨æˆ·ç©ºé—´è¿›ç¨‹</li>
<li>å¦‚æœç¬¬äºŒé˜¶æ®µå¤±è´¥ï¼Œéœ€è¦è§£å†»æ‰€æœ‰è¿›ç¨‹</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">5.2 å®é™…å¥½å¤„</h3>
<ul>
<li><strong>æ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†</strong>ï¼šå¯ä»¥åŒºåˆ†æ˜¯ç”¨æˆ·ç©ºé—´è¿˜æ˜¯å†…æ ¸çº¿ç¨‹å†»ç»“å¤±è´¥</li>
<li><strong>æ›´å¥½çš„è°ƒè¯•</strong>ï¼šå¯ä»¥åˆ†åˆ«æŸ¥çœ‹ä¸¤ä¸ªé˜¶æ®µçš„æ—¥å¿—</li>
<li><strong>æ›´çµæ´»çš„æ§åˆ¶</strong>ï¼šæŸäº›åœºæ™¯å¯èƒ½åªéœ€è¦å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹</li>
</ul>
<h2 data-id="heading-17">å…­ã€ä¸å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹</h2>
<h3 data-id="heading-18">6.1 ä¸ºä»€ä¹ˆæœ‰äº›å†…æ ¸çº¿ç¨‹ä¸å¯å†»ç»“ï¼Ÿ</h3>
<p><strong>åŸå› </strong>ï¼š</p>
<ol>
<li><strong>ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½</strong>ï¼šå¦‚kthreaddã€RCUç›¸å…³çº¿ç¨‹ï¼Œå¦‚æœè¢«å†»ç»“ä¼šå¯¼è‡´ç³»ç»Ÿæ­»é”</li>
<li><strong>ç¡¬ä»¶äº¤äº’</strong>ï¼šå¦‚ä¸­æ–­å¤„ç†çº¿ç¨‹ï¼Œå¿…é¡»åŠæ—¶å“åº”ç¡¬ä»¶ä¸­æ–­</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šæŸäº›çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå…³é”®æ“ä½œï¼Œä¸èƒ½ä¸­é€”åœæ­¢</li>
</ol>
<h3 data-id="heading-19">6.2 å¦‚ä½•åˆ¤æ–­å†…æ ¸çº¿ç¨‹æ˜¯å¦å¯å†»ç»“ï¼Ÿ</h3>
<p><strong>åˆ¤æ–­æ ‡å‡†</strong>ï¼š</p>
<ul>
<li>æœ‰ <code>PF_NOFREEZE</code> æ ‡å¿— â†’ ä¸å¯å†»ç»“ï¼ˆUNFREEZABLEï¼‰</li>
<li>æ²¡æœ‰ <code>PF_NOFREEZE</code> æ ‡å¿— â†’ å¯å†»ç»“ï¼ˆä½†å¯èƒ½å†»ç»“å¤±è´¥ï¼‰</li>
</ul>
<p><strong>ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°</strong>ï¼š</p>
<ul>
<li>95ä¸ªUNFREEZABLEä»»åŠ¡ï¼šéƒ½æœ‰ <code>PF_NOFREEZE</code> æ ‡å¿—</li>
<li>6ä¸ªFAILED_FREEZEä»»åŠ¡ï¼šæ²¡æœ‰ <code>PF_NOFREEZE</code> æ ‡å¿—ï¼Œä½†å†»ç»“å¤±è´¥</li>
</ul>
<h2 data-id="heading-20">ä¸ƒã€æ€»ç»“</h2>
<h3 data-id="heading-21">7.1 å†»ç»“æµç¨‹</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">suspend_freeze_processes</span>()
  â†“
<span class="hljs-built_in">freeze_processes</span>()  <span class="hljs-selector-attr">[ç¬¬ä¸€é˜¶æ®µ]</span>
  â”œâ”€ è®¾ç½® pm_freezing = true
  â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">try_to_freeze_tasks</span>(true)
  â””â”€ åªå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ˆ!(p-&gt;flags &amp; PF_KTHREAD)ï¼‰
  â†“
<span class="hljs-built_in">freeze_kernel_threads</span>()  <span class="hljs-selector-attr">[ç¬¬äºŒé˜¶æ®µ]</span>
  â”œâ”€ è®¾ç½® pm_nosig_freezing = true
  â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">try_to_freeze_tasks</span>(false)
  â””â”€ å†»ç»“å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—çš„ï¼‰
</code></pre>
<h3 data-id="heading-22">7.2 ä»»åŠ¡åˆ†ç±»</h3>



































<table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>ç¬¬ä¸€é˜¶æ®µ</th><th>ç¬¬äºŒé˜¶æ®µ</th><th>æœ€ç»ˆçŠ¶æ€</th></tr></thead><tbody><tr><td>ç”¨æˆ·ç©ºé—´è¿›ç¨‹</td><td>âœ… å†»ç»“</td><td>-</td><td>å·²å†»ç»“</td></tr><tr><td>å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼ˆæ— PF_NOFREEZEï¼‰</td><td>âŒ è·³è¿‡</td><td>âœ… å†»ç»“</td><td>å·²å†»ç»“</td></tr><tr><td>ä¸å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼ˆæœ‰PF_NOFREEZEï¼‰</td><td>âŒ è·³è¿‡</td><td>âŒ è·³è¿‡</td><td>UNFREEZABLE</td></tr><tr><td>å†»ç»“å¤±è´¥çš„å†…æ ¸çº¿ç¨‹</td><td>âŒ è·³è¿‡</td><td>âŒ å¤±è´¥</td><td>FAILED_FREEZE</td></tr></tbody></table>
<h3 data-id="heading-23">7.3 å…³é”®ç»“è®º</h3>
<p><strong>ç†è®ºä¸Šï¼Œå†…æ ¸çº¿ç¨‹ä¹Ÿä¼šè¢«å†»ç»“ï¼Œä½†æ˜¯</strong>ï¼š</p>
<ol>
<li>
<p><strong>æ­£å¸¸æµç¨‹</strong>ï¼š</p>
<ul>
<li><strong>åˆ†ä¸¤ä¸ªé˜¶æ®µ</strong>ï¼šå…ˆå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼Œå†å†»ç»“å†…æ ¸çº¿ç¨‹</li>
<li><strong>æœ‰ä¾‹å¤–</strong>ï¼šæœ‰ <code>PF_NOFREEZE</code> æ ‡å¿—çš„å†…æ ¸çº¿ç¨‹ä¸ä¼šè¢«å†»ç»“</li>
<li><strong>å¯èƒ½å¤±è´¥</strong>ï¼šæŸäº›å†…æ ¸çº¿ç¨‹å¯èƒ½æ— æ³•å†»ç»“ï¼ˆå¦‚kswapd0ã€jbd2çº¿ç¨‹ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å®é™…æƒ…å†µï¼ˆä»æ—¥å¿—çœ‹ï¼‰</strong>ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€é˜¶æ®µå°±å¤±è´¥äº†</strong>ï¼š<code>freeze_processes()</code> è¶…æ—¶å¤±è´¥ï¼ˆerror -16ï¼‰</li>
<li><strong>æ²¡æœ‰è¿›å…¥ç¬¬äºŒé˜¶æ®µ</strong>ï¼šå› ä¸ºç¬¬ä¸€é˜¶æ®µå¤±è´¥ï¼Œæ²¡æœ‰è°ƒç”¨ <code>freeze_kernel_threads()</code></li>
<li><strong>å¼ºåˆ¶æŒ‚èµ·</strong>ï¼šç³»ç»Ÿå¯ç”¨äº†<code>FORCE SUSPEND</code>ï¼Œå³ä½¿å†»ç»“å¤±è´¥ä¹Ÿç»§ç»­æŒ‚èµ·</li>
<li><strong>ç»“æœ</strong>ï¼šå†…æ ¸çº¿ç¨‹<strong>æ²¡æœ‰è¢«å†»ç»“</strong>ï¼ˆé™¤äº†æœ‰PF_NOFREEZEæ ‡å¿—çš„ï¼Œå®ƒä»¬æœ¬æ¥å°±ä¸ä¼šè¢«å†»ç»“ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è¿™å¯èƒ½æ˜¯å”¤é†’å¤±è´¥çš„åŸå› ä¹‹ä¸€</strong>ï¼š</p>
<ul>
<li>å†…æ ¸çº¿ç¨‹ï¼ˆå¦‚kswapd0ã€jbd2ï¼‰æ²¡æœ‰è¢«å†»ç»“</li>
<li>ç³»ç»Ÿåœ¨ä¸å®Œæ•´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ </li>
<li>å”¤é†’æ—¶æ— æ³•ä»ä¸ä¸€è‡´çš„çŠ¶æ€ä¸­æ¢å¤</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pkg.pr.new å¿«é€ŸéªŒè¯ç¬¬ä¸‰æ–¹åŒ…-æœ€æ–°ä¿®å¤]]></title>    <link>https://juejin.cn/post/7585390679398563846</link>    <guid>https://juejin.cn/post/7585390679398563846</guid>    <pubDate>2025-12-20T02:24:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585390679398563846" data-draft-id="7585397173022933011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pkg.pr.new å¿«é€ŸéªŒè¯ç¬¬ä¸‰æ–¹åŒ…-æœ€æ–°ä¿®å¤"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T02:24:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ¥äº†æ¸…è¯­"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498942055"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pkg.pr.new å¿«é€ŸéªŒè¯ç¬¬ä¸‰æ–¹åŒ…-æœ€æ–°ä¿®å¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498942055/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ¥äº†æ¸…è¯­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T02:24:33.000Z" title="Sat Dec 20 2025 02:24:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Â <strong>pkg.pr.new æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3>
<ul>
<li>
<p><strong>pkg.pr.new</strong>Â æ˜¯ä¸€ä¸ªä¸º GitHub ä»“åº“æä¾›**å³æ—¶é¢„è§ˆåŒ…ï¼ˆpreview packagesï¼‰**çš„æœåŠ¡ã€‚</p>
</li>
<li>
<p>æ¯å½“æœ‰æ–°çš„ commit æ¨é€æˆ– Pull Request åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¯é€šè¿‡ npm å…¼å®¹ URL ç›´æ¥å®‰è£…çš„ä¸´æ—¶åŒ…ã€‚</p>
<ul>
<li>ç¤ºä¾‹ï¼š<code>npm i https://pkg.pr.new/vite@main</code></li>
</ul>
</li>
<li>
<p>æ”¯æŒä¸Â <strong>StackBlitz WebContainers</strong>Â é›†æˆï¼Œå…è®¸ç”¨æˆ·åœ¨å®Œå…¨éš”ç¦»çš„æµè§ˆå™¨ç¯å¢ƒä¸­è¯•ç”¨è¿™äº›é¢„è§ˆåŒ…ã€‚</p>
</li>
</ul>
<h3 data-id="heading-1">Â <strong>å­˜å‚¨ç®¡ç†ç­–ç•¥</strong></h3>
<ul>
<li>
<p>pkg.pr.newÂ <strong>ä¸æ˜¯æ°¸ä¹…åŒ…æ³¨å†Œè¡¨</strong>ï¼Œè€Œæ˜¯ä¸´æ—¶é¢„è§ˆæœåŠ¡ã€‚</p>
</li>
<li>
<p>è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼š</p>
<ul>
<li>è¶…è¿‡Â <strong>1 ä¸ªæœˆæœªè¢«ä¸‹è½½</strong>Â çš„åŒ…ä¼šè¢«åˆ é™¤ã€‚</li>
<li>è¶…è¿‡Â <strong>6 ä¸ªæœˆ</strong>Â çš„åŒ…ä¹Ÿä¼šè¢«è‡ªåŠ¨ç§»é™¤ã€‚</li>
</ul>
</li>
<li>
<p>è¿™ä¸€ç­–ç•¥æœ‰æ•ˆæ§åˆ¶äº†å­˜å‚¨æˆæœ¬ï¼Œæœªæ¥åœ¨ Cloudflare æ”¯æŒä¸‹å¯é€‚å½“æ”¾å®½é™åˆ¶ã€‚</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">ç”¨ pkg.pr.new å¿«é€ŸéªŒè¯ Element Plus çš„ Tree å†…å­˜æ³„æ¼ä¿®å¤</h2>
<h3 data-id="heading-3">èƒŒæ™¯ï¼šä¸€ä¸ªçœŸå®çš„æ€§èƒ½é—®é¢˜</h3>
<p>åœ¨ Element Plus çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felement-plus%2Felement-plus%2Fpull%2F23055" target="_blank" title="https://github.com/element-plus/element-plus/pull/23055" ref="nofollow noopener noreferrer">PR #23055</a> ä¸­ï¼Œå¼€å‘è€… @rzzf å‘ç°å¹¶ä¿®å¤äº†ä¸€ä¸ª <strong>el-tree ç»„ä»¶åœ¨æ•°æ®æ›´æ–°åå¯èƒ½å¼•å‘å†…å­˜æ³„æ¼</strong> çš„é—®é¢˜ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜çš„è¡¨ç°æ˜¯ï¼š</p>
<ul>
<li>å½“é¢‘ç¹æ›´æ–° tree çš„ data æ—¶ï¼Œæ—§èŠ‚ç‚¹å¼•ç”¨æœªè¢«æ­£ç¡®é‡Šæ”¾ï¼›</li>
<li>å¯¼è‡´å†…å­˜æŒç»­å¢é•¿ï¼Œå°¤å…¶åœ¨ Chrome 130 ç­‰æ–°ç‰ˆæœ¬æµè§ˆå™¨ä¸­æ›´ä¸ºæ˜æ˜¾ï¼ˆè§Â <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Issue #23059</a>ï¼‰ã€‚</li>
</ul>
<p>ä¿®å¤æœ¬èº«å¹¶ä¸å¤æ‚â€”â€”å…³é”®åœ¨äº<strong>ç¡®ä¿äº‹ä»¶ç›‘å¬å™¨å’ŒèŠ‚ç‚¹ç¼“å­˜åœ¨æ•°æ®å˜æ›´æ—¶è¢«æ¸…ç†</strong>ã€‚ä½†ä½œä¸ºç”¨æˆ·æˆ– Reviewerï¼Œæˆ‘ä»¬æœ€å…³å¿ƒçš„æ˜¯ï¼š</p>
<blockquote>
<p><strong>è¿™ä¸ªä¿®å¤çœŸçš„æœ‰æ•ˆå—ï¼Ÿæˆ‘èƒ½ä¸èƒ½åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œå¿«é€Ÿè¯•ä¸€ä¸‹ï¼Ÿ</strong></p>
</blockquote>
<h4 data-id="heading-4">ä¼ ç»Ÿæ–¹å¼ vs pkg.pr.new</h4>
<p>è¿‡å»ï¼Œè¦æµ‹è¯•ä¸€ä¸ªæœªå‘å¸ƒçš„ PRï¼Œä½ éœ€è¦ï¼š</p>
<ol>
<li>æ‹‰å– PR åˆ†æ”¯ï¼›</li>
<li>æœ¬åœ°æ„å»º element-plusï¼›(åˆ‡å¯¹åº”çš„nodeç¯å¢ƒï¼Œç¹ç)</li>
<li>é“¾æ¥åˆ°ä½ çš„é¡¹ç›®ï¼ˆ<code>npm link</code>Â æˆ–Â <code>yalc</code>ï¼‰ï¼›</li>
<li>é‡å¯å¼€å‘æœåŠ¡å™¨â€¦â€¦</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹ç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚</p>
<p>è€Œç°åœ¨ï¼Œæœ‰äº† <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.pr.new%2F" target="_blank" title="https://pkg.pr.new/" ref="nofollow noopener noreferrer">pkg.pr.new</a></strong>ï¼Œä¸€åˆ‡å˜å¾—æå…¶ç®€å•ã€‚</p>
<h3 data-id="heading-5">ä¸€è¡Œå‘½ä»¤ï¼Œç›´æ¥å®‰è£… PR æ„å»ºåŒ…</h3>
<p>å¯¹äº PR #23055ï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œï¼š</p>
<pre><code class="hljs language-shell" lang="shell">npm install https://pkg.pr.new/element-plus/element-plus@23055

pnpm add https://pkg.pr.new/element-plus/element-plus@23055

yarn add https://pkg.pr.new/element-plus/element-plus@23055
</code></pre>
<blockquote>
<p>âœ… è¿™ä¸ª URL ä¼šè‡ªåŠ¨æŒ‡å‘è¯¥ PR å¯¹åº”çš„æœ€æ–° CI æ„å»ºäº§ç‰©ï¼Œå®Œå…¨å…¼å®¹ npm å®‰è£…æµç¨‹ã€‚</p>
</blockquote>
<p>ç­‰åˆ°å®˜æ–¹å‘å¸ƒäº† æœ€æ–°çš„ç‰ˆæœ¬ï¼Œ å¯ä»¥é‡æ–°å›å½’åˆ° æ­£å¸¸çš„ç‰ˆæœ¬å·çš„ <code>æ­£è½¨</code></p>
<h3 data-id="heading-6">ç”Ÿæ€æ”¯æŒ</h3>
<ul>
<li>å·²ç”ŸæˆÂ <strong>è¶…è¿‡ 100 ä¸‡ä¸ªé¢„è§ˆåŒ…</strong></li>
</ul>
<h3 data-id="heading-7">ç»“è¯­</h3>
<p>PR #23055 ä¸ä»…ä¿®å¤äº†ä¸€ä¸ªå…³é”®çš„å†…å­˜é—®é¢˜ï¼Œæ›´å±•ç¤ºäº†ç°ä»£å¼€æºé¡¹ç›®çš„<strong>é«˜æ•ˆåä½œèŒƒå¼</strong>ï¼š</p>
<blockquote>
<p><strong>ä»£ç æäº¤ â†’ è‡ªåŠ¨æ„å»º â†’ åœ¨çº¿é¢„è§ˆ â†’ ç¤¾åŒºéªŒè¯ â†’ åˆå¹¶å‘å¸ƒ</strong></p>
</blockquote>
<h3 data-id="heading-8">ç›¸å…³é“¾æ¥</h3>
<ul>
<li>ğŸ PR #23055:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felement-plus%2Felement-plus%2Fpull%2F23055" target="_blank" title="https://github.com/element-plus/element-plus/pull/23055" ref="nofollow noopener noreferrer">perf(components): [tree] resolve memory leak occurring after data update by rzzf Â· Pull Request #23055 Â· element-plus/element-plus</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.stackblitz.com%2Fposts%2Fpkg-pr-new%2F" target="_blank" title="https://blog.stackblitz.com/posts/pkg-pr-new/" ref="nofollow noopener noreferrer">å®£å¸ƒ pkg.pr.new --- Announcing pkg.pr.new</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux å†…æ ¸çº¿ç¨‹å†»ç»“æƒ…å†µåˆ†æ]]></title>    <link>https://juejin.cn/post/7585397173022441491</link>    <guid>https://juejin.cn/post/7585397173022441491</guid>    <pubDate>2025-12-19T13:54:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173022441491" data-draft-id="7585390679397957638" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux å†…æ ¸çº¿ç¨‹å†»ç»“æƒ…å†µåˆ†æ"/> <meta itemprop="keywords" content="åµŒå…¥å¼"/> <meta itemprop="datePublished" content="2025-12-19T13:54:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shawn_CH"/> <meta itemprop="url" content="https://juejin.cn/user/4074114702122217"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux å†…æ ¸çº¿ç¨‹å†»ç»“æƒ…å†µåˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4074114702122217/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shawn_CH
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:54:19.000Z" title="Fri Dec 19 2025 13:54:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å…³é”®å‘ç°</h2>
<h3 data-id="heading-1">1.1 å®é™…æƒ…å†µ</h3>
<p><strong>æ˜¯çš„ï¼Œæ‚¨ç¡®å®æ²¡æœ‰å†»ç»“åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼</strong></p>
<p>ä»æ—¥å¿—åˆ†æï¼š</p>
<ol>
<li>
<p><strong>ç¬¬ä¸€é˜¶æ®µå¤±è´¥</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[  119.065869]</span> freeze_processes: failed to freeze tasks, error -16
<span class="hljs-section">[  119.177008]</span> PM: SUSPEND_DEBUG: suspend_freeze_processes: freeze_processes failed, <span class="hljs-attr">error</span>=-<span class="hljs-number">16</span>
</code></pre>
</li>
<li>
<p><strong>æ²¡æœ‰è¿›å…¥ç¬¬äºŒé˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>æ—¥å¿—ä¸­<strong>æ²¡æœ‰</strong>çœ‹åˆ° <code>"freezing kernel threads"</code> æˆ– <code>"44444444 freeze_kernel_threads ENTER"</code></li>
<li>è¯´æ˜ <code>freeze_kernel_threads()</code> <strong>æ ¹æœ¬æ²¡æœ‰è¢«è°ƒç”¨</strong></li>
</ul>
</li>
<li>
<p><strong>å¼ºåˆ¶æŒ‚èµ·</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[  119.177018]</span> PM: SUSPEND_DEBUG: suspend_prepare: FORCE SUSPEND enabled, ignoring freeze failure
</code></pre>
</li>
</ol>
<h3 data-id="heading-2">1.2 ä»£ç é€»è¾‘</h3>
<p>ä» <code>kernel/power/power.h</code> ä¸­çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title function_">suspend_freeze_processes</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>
{
    error = freeze_processes();  <span class="hljs-comment">// ç¬¬ä¸€é˜¶æ®µ</span>
    <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-keyword">return</span> error;  <span class="hljs-comment">// å¦‚æœå¤±è´¥ï¼Œç›´æ¥è¿”å›ï¼Œä¸ä¼šè°ƒç”¨freeze_kernel_threads()</span>
    }
    
    error = freeze_kernel_threads();  <span class="hljs-comment">// ç¬¬äºŒé˜¶æ®µï¼ˆä½†ç¬¬ä¸€é˜¶æ®µå¤±è´¥ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼‰</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>å¦‚æœç¬¬ä¸€é˜¶æ®µï¼ˆ<code>freeze_processes()</code>ï¼‰å¤±è´¥ï¼Œå‡½æ•°ä¼šç›´æ¥è¿”å›é”™è¯¯</li>
<li><strong>ä¸ä¼šè°ƒç”¨ç¬¬äºŒé˜¶æ®µ</strong>ï¼ˆ<code>freeze_kernel_threads()</code>ï¼‰</li>
<li>ç³»ç»Ÿå¯ç”¨äº†<code>FORCE SUSPEND</code>ï¼Œå³ä½¿è¿”å›é”™è¯¯ä¹Ÿç»§ç»­æŒ‚èµ·</li>
</ul>
<h2 data-id="heading-3">äºŒã€å†»ç»“ç»Ÿè®¡</h2>
<h3 data-id="heading-4">2.1 ä»æ—¥å¿—ä¸­çœ‹åˆ°çš„ç»Ÿè®¡</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[  118.830604]</span> LLLLLLLL FINAL STATS: <span class="hljs-attr">total</span>=<span class="hljs-number">146</span>, frozen=<span class="hljs-number">3</span>, freezing=<span class="hljs-number">24</span>, unfreezable=<span class="hljs-number">95</span>, skipped=<span class="hljs-number">18</span>
</code></pre>
<p><strong>åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>total=146</strong>ï¼šæ€»å…±146ä¸ªä»»åŠ¡</li>
<li><strong>frozen=3</strong>ï¼šåªæœ‰3ä¸ªä»»åŠ¡è¢«æˆåŠŸå†»ç»“ï¼ˆç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼‰</li>
<li><strong>freezing=24</strong>ï¼š24ä¸ªä»»åŠ¡æ­£åœ¨å†»ç»“ä¸­ï¼ˆä½†æœ€ç»ˆè¶…æ—¶å¤±è´¥ï¼‰</li>
<li><strong>unfreezable=95</strong>ï¼š95ä¸ªä»»åŠ¡ä¸å¯å†»ç»“ï¼ˆæœ‰PF_NOFREEZEæ ‡å¿—ï¼‰</li>
<li><strong>skipped=18</strong>ï¼š18ä¸ªä»»åŠ¡è¢«è·³è¿‡</li>
</ul>
<h3 data-id="heading-5">2.2 è¢«æˆåŠŸå†»ç»“çš„3ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹</h3>
<p>ä»æ—¥å¿—åˆ†æï¼Œè¢«æˆåŠŸå†»ç»“çš„3ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹æ˜¯ï¼š</p>

































<table><thead><tr><th>PID</th><th>è¿›ç¨‹å</th><th>è¿›å…¥å†»ç»“æ—¶é—´</th><th>è§£å†»æ—¶é—´</th><th>çŠ¶æ€ç¡®è®¤</th></tr></thead><tbody><tr><td><strong>1994</strong></td><td><strong>audio_server</strong></td><td><code>[  105.806568]</code></td><td><code>[  119.161300]</code></td><td><code>was_frozen=1</code></td></tr><tr><td><strong>2455</strong></td><td><strong>sleep</strong></td><td><code>[  100.207489]</code></td><td><code>[  119.174184]</code></td><td><code>was_frozen=1</code></td></tr><tr><td><strong>2456</strong></td><td><strong>mtop</strong></td><td><code>[   99.447028]</code></td><td><code>[  119.174862]</code></td><td><code>was_frozen=1</code></td></tr></tbody></table>
<p><strong>è¯¦ç»†æ—¥å¿—</strong>ï¼š</p>
<ol>
<li>
<p><strong>audio_server (pid 1994)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[  105.806568]</span> 11111111 __refrigerator ENTER: task audio_server (pid 1994)
<span class="hljs-section">[  105.809739]</span> 11111111 __refrigerator: task audio_server (pid 1994) going to sleep, <span class="hljs-attr">was_frozen</span>=<span class="hljs-number">1</span>
<span class="hljs-section">[  119.161300]</span> __thaw_task: woke up frozen task audio_server (pid 1994)
<span class="hljs-section">[  119.165322]</span> 11111111 __refrigerator EXIT: task audio_server (pid 1994), <span class="hljs-attr">was_frozen</span>=<span class="hljs-number">1</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šéŸ³é¢‘æœåŠ¡è¿›ç¨‹</li>
<li><strong>å†»ç»“æ—¶é•¿</strong>ï¼šçº¦13.35ç§’</li>
</ul>
</li>
<li>
<p><strong>sleep (pid 2455)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[  100.207489]</span> 11111111 __refrigerator ENTER: task sleep (pid 2455)
<span class="hljs-section">[  100.208222]</span> 11111111 __refrigerator: task sleep (pid 2455) going to sleep, <span class="hljs-attr">was_frozen</span>=<span class="hljs-number">1</span>
<span class="hljs-section">[  119.174184]</span> __thaw_task: woke up frozen task sleep (pid 2455)
<span class="hljs-section">[  119.177853]</span> 11111111 __refrigerator EXIT: task sleep (pid 2455), <span class="hljs-attr">was_frozen</span>=<span class="hljs-number">1</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæ‰§è¡Œsleepå‘½ä»¤çš„è¿›ç¨‹</li>
<li><strong>å†»ç»“æ—¶é•¿</strong>ï¼šçº¦18.97ç§’</li>
</ul>
</li>
<li>
<p><strong>mtop (pid 2456)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   99.447028]</span> 11111111 __refrigerator ENTER: task mtop (pid 2456)
<span class="hljs-section">[   99.447734]</span> 11111111 __refrigerator: task mtop (pid 2456) going to sleep, <span class="hljs-attr">was_frozen</span>=<span class="hljs-number">1</span>
<span class="hljs-section">[  119.174862]</span> __thaw_task: woke up frozen task mtop (pid 2456)
<span class="hljs-section">[  119.178822]</span> 11111111 __refrigerator EXIT: task mtop (pid 2456), <span class="hljs-attr">was_frozen</span>=<span class="hljs-number">1</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç³»ç»Ÿç›‘æ§å·¥å…·è¿›ç¨‹</li>
<li><strong>å†»ç»“æ—¶é•¿</strong>ï¼šçº¦19.73ç§’</li>
</ul>
</li>
</ol>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™3ä¸ªéƒ½æ˜¯ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ˆç¬¬ä¸€é˜¶æ®µåªå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼‰</li>
<li>å®ƒä»¬éƒ½æˆåŠŸè¿›å…¥äº†<code>__refrigerator()</code>ï¼ˆå†»ç»“å‡½æ•°ï¼‰</li>
<li>è§£å†»æ—¶éƒ½æ˜¾ç¤º<code>woke up frozen task</code>å’Œ<code>was_frozen=1</code>ï¼Œç¡®è®¤è¢«å†»ç»“</li>
<li>è¿™3ä¸ªæ˜¯å”¯ä¸€è¢«æˆåŠŸå†»ç»“çš„ä»»åŠ¡ï¼Œå…¶ä»–ä»»åŠ¡è¦ä¹ˆä¸å¯å†»ç»“ï¼ˆ95ä¸ªï¼‰ï¼Œè¦ä¹ˆå†»ç»“å¤±è´¥ï¼ˆ6ä¸ªï¼‰ï¼Œè¦ä¹ˆè¢«è·³è¿‡ï¼ˆ18ä¸ªï¼‰</li>
</ul>
<h3 data-id="heading-6">2.3 æ²¡æœ‰æˆåŠŸå†»ç»“çš„å†…æ ¸çº¿ç¨‹</h3>
<p>ä»æ—¥å¿—åˆ†æï¼Œæ²¡æœ‰æˆåŠŸå†»ç»“çš„å†…æ ¸çº¿ç¨‹ä¸»è¦æ˜¯<strong>6ä¸ªå†»ç»“å¤±è´¥çš„å†…æ ¸çº¿ç¨‹</strong>ï¼š</p>





























































<table><thead><tr><th>PID</th><th>ä»»åŠ¡å</th><th>Flags</th><th>State</th><th>CPU</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td><strong>88</strong></td><td><strong>kswapd0</strong></td><td>0xa20840</td><td>1</td><td>2</td><td>FAILED_FREEZE / NOT_FREEZING</td></tr><tr><td><strong>239</strong></td><td><strong>jbd2/loop0-8</strong></td><td>0x240040</td><td>1</td><td>2</td><td>FAILED_FREEZE / NOT_FREEZING</td></tr><tr><td><strong>907</strong></td><td><strong>jbd2/mmcblk0p10</strong></td><td>0x240040</td><td>1</td><td>2</td><td>FAILED_FREEZE / NOT_FREEZING</td></tr><tr><td><strong>926</strong></td><td><strong>jbd2/mmcblk0p17</strong></td><td>0x240040</td><td>1</td><td>2</td><td>FAILED_FREEZE / NOT_FREEZING</td></tr><tr><td><strong>948</strong></td><td><strong>jbd2/mmcblk0p16</strong></td><td>0x240040</td><td>1</td><td>2</td><td>FAILED_FREEZE / NOT_FREEZING</td></tr><tr><td><strong>987</strong></td><td><strong>jbd2/mmcblk0p19</strong></td><td>0x240040</td><td>1</td><td>3</td><td>FAILED_FREEZE / NOT_FREEZING</td></tr></tbody></table>
<p><strong>è¯¦ç»†æ—¥å¿—</strong>ï¼š</p>
<ol>
<li>
<p><strong>kswapd0 (pid 88)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.858688]</span> LLLLLLLL FAILED_FREEZE: kswapd0 (pid 88), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>xa20840, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
<span class="hljs-section">[  118.843734]</span> LLLLLLLL NOT_FREEZING: kswapd0 (pid 88), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>xa20840, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå†…å­˜äº¤æ¢å®ˆæŠ¤çº¿ç¨‹</li>
<li><strong>æ ‡å¿—åˆ†æ</strong>ï¼š<code>0xa20840 = PF_KTHREAD (0x00200000) + PF_MEMALLOC (0x00000800) + PF_KSWAPD (0x00020000)</code></li>
<li><strong>çŠ¶æ€</strong>ï¼šæœ‰PF_KTHREADï¼Œæ²¡æœ‰PF_NOFREEZEï¼Œåº”è¯¥è¢«å†»ç»“</li>
<li><strong>ç»“æœ</strong>ï¼šå°è¯•å†»ç»“ä½†å¤±è´¥ï¼Œæœ€ç»ˆæ²¡æœ‰è¢«å†»ç»“</li>
</ul>
</li>
<li>
<p><strong>jbd2/loop0-8 (pid 239)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.894967]</span> LLLLLLLL FAILED_FREEZE: jbd2/loop0-8 (pid 239), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
<span class="hljs-section">[  118.844660]</span> LLLLLLLL NOT_FREEZING: jbd2/loop0-8 (pid 239), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šloopè®¾å¤‡æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—çº¿ç¨‹</li>
<li><strong>æ ‡å¿—åˆ†æ</strong>ï¼š<code>0x240040 = PF_KTHREAD (0x00200000) + PF_FORKNOEXEC (0x00000040)</code></li>
<li><strong>çŠ¶æ€</strong>ï¼šæœ‰PF_KTHREADï¼Œæ²¡æœ‰PF_NOFREEZEï¼Œåº”è¯¥è¢«å†»ç»“</li>
<li><strong>ç»“æœ</strong>ï¼šå°è¯•å†»ç»“ä½†å¤±è´¥ï¼Œæœ€ç»ˆæ²¡æœ‰è¢«å†»ç»“</li>
</ul>
</li>
<li>
<p><strong>jbd2/mmcblk0p10 (pid 907)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.902590]</span> LLLLLLLL FAILED_FREEZE: jbd2/mmcblk0p10 (pid 907), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
<span class="hljs-section">[  118.902100]</span> LLLLLLLL NOT_FREEZING: jbd2/mmcblk0p10 (pid 907), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šMMCå—è®¾å¤‡åˆ†åŒº10çš„æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—çº¿ç¨‹</li>
<li><strong>ç»“æœ</strong>ï¼šå°è¯•å†»ç»“ä½†å¤±è´¥ï¼Œæœ€ç»ˆæ²¡æœ‰è¢«å†»ç»“</li>
</ul>
</li>
<li>
<p><strong>jbd2/mmcblk0p17 (pid 926)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.910231]</span> LLLLLLLL FAILED_FREEZE: jbd2/mmcblk0p17 (pid 926), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
<span class="hljs-section">[  118.903093]</span> LLLLLLLL NOT_FREEZING: jbd2/mmcblk0p17 (pid 926), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šMMCå—è®¾å¤‡åˆ†åŒº17çš„æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—çº¿ç¨‹</li>
<li><strong>ç»“æœ</strong>ï¼šå°è¯•å†»ç»“ä½†å¤±è´¥ï¼Œæœ€ç»ˆæ²¡æœ‰è¢«å†»ç»“</li>
</ul>
</li>
<li>
<p><strong>jbd2/mmcblk0p16 (pid 948)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.917871]</span> LLLLLLLL FAILED_FREEZE: jbd2/mmcblk0p16 (pid 948), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
<span class="hljs-section">[  118.904086]</span> LLLLLLLL NOT_FREEZING: jbd2/mmcblk0p16 (pid 948), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šMMCå—è®¾å¤‡åˆ†åŒº16çš„æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—çº¿ç¨‹</li>
<li><strong>ç»“æœ</strong>ï¼šå°è¯•å†»ç»“ä½†å¤±è´¥ï¼Œæœ€ç»ˆæ²¡æœ‰è¢«å†»ç»“</li>
</ul>
</li>
<li>
<p><strong>jbd2/mmcblk0p19 (pid 987)</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.925519]</span> LLLLLLLL FAILED_FREEZE: jbd2/mmcblk0p19 (pid 987), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">3</span>
<span class="hljs-section">[  118.905087]</span> LLLLLLLL NOT_FREEZING: jbd2/mmcblk0p19 (pid 987), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x240040, state=<span class="hljs-number">1</span>, cpu=<span class="hljs-number">3</span>
</code></pre>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šMMCå—è®¾å¤‡åˆ†åŒº19çš„æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—çº¿ç¨‹</li>
<li><strong>ç»“æœ</strong>ï¼šå°è¯•å†»ç»“ä½†å¤±è´¥ï¼Œæœ€ç»ˆæ²¡æœ‰è¢«å†»ç»“</li>
</ul>
</li>
</ol>
<p><strong>å…³é”®ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… éƒ½æ˜¯å†…æ ¸çº¿ç¨‹ï¼ˆæœ‰PF_KTHREADæ ‡å¿—ï¼‰</li>
<li>âœ… éƒ½æ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼ˆåº”è¯¥è¢«å†»ç»“ï¼‰</li>
<li>âŒ ç¬¬ä¸€é˜¶æ®µå°è¯•å†»ç»“ä½†å¤±è´¥ï¼ˆFAILED_FREEZEï¼‰</li>
<li>âŒ ç¬¬äºŒé˜¶æ®µæ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥å®ƒä»¬æ²¡æœ‰è¢«å†»ç»“</li>
<li>âŒ æœ€ç»ˆçŠ¶æ€æ˜¾ç¤ºä¸ºNOT_FREEZINGï¼ˆæ²¡æœ‰å†»ç»“ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆæ— æ³•å†»ç»“</strong>ï¼š</p>
<ol>
<li><strong>kswapd0</strong>ï¼šå¯èƒ½æ­£åœ¨æ‰§è¡Œå†…å­˜äº¤æ¢æ“ä½œï¼Œå¤„äºä¸å¯ä¸­æ–­çš„I/Oç­‰å¾…çŠ¶æ€</li>
<li><strong>jbd2çº¿ç¨‹</strong>ï¼šå¯èƒ½æ­£åœ¨å†™å…¥æ–‡ä»¶ç³»ç»Ÿæ—¥å¿—ï¼Œå¤„äºä¸å¯ä¸­æ–­çš„ç£ç›˜I/Oç­‰å¾…çŠ¶æ€</li>
<li><strong>çŠ¶æ€é—®é¢˜</strong>ï¼šè¿™äº›çº¿ç¨‹å¯èƒ½å¤„äºTASK_RUNNINGæˆ–TASK_INTERRUPTIBLEçŠ¶æ€ï¼Œä½†æ— æ³•å“åº”å†»ç»“è¯·æ±‚</li>
</ol>
<p><strong>å½±å“</strong>ï¼š</p>
<ul>
<li>è¿™6ä¸ªå†…æ ¸çº¿ç¨‹æ²¡æœ‰è¢«å†»ç»“ï¼Œå¤„äºä¸ä¸€è‡´çš„çŠ¶æ€</li>
<li>ç³»ç»Ÿåœ¨ä¸å®Œæ•´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ </li>
<li>å”¤é†’æ—¶å¯èƒ½æ— æ³•ä»ä¸ä¸€è‡´çš„çŠ¶æ€ä¸­æ¢å¤</li>
<li><strong>è¿™æ˜¯å¯¼è‡´å”¤é†’å¤±è´¥çš„é‡è¦åŸå› </strong></li>
</ul>
<h3 data-id="heading-7">2.4 ä»»åŠ¡åˆ†ç±»</h3>



































<table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>æ•°é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æˆåŠŸå†»ç»“</strong></td><td>3</td><td>ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰</td></tr><tr><td><strong>å†»ç»“å¤±è´¥</strong></td><td>6</td><td>kswapd0å’Œ5ä¸ªjbd2çº¿ç¨‹ï¼ˆæ²¡æœ‰PF_NOFREEZEï¼Œä½†å†»ç»“å¤±è´¥ï¼‰</td></tr><tr><td><strong>ä¸å¯å†»ç»“</strong></td><td>95</td><td>æœ‰PF_NOFREEZEæ ‡å¿—çš„å†…æ ¸çº¿ç¨‹ï¼ˆæœ¬æ¥å°±ä¸åº”è¯¥è¢«å†»ç»“ï¼‰</td></tr><tr><td><strong>è·³è¿‡</strong></td><td>18</td><td>å…¶ä»–è¢«è·³è¿‡çš„ä»»åŠ¡</td></tr><tr><td><strong>åº”è¯¥è¢«å†»ç»“ä½†æ²¡å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong></td><td><strong>6</strong></td><td><strong>kswapd0å’Œ5ä¸ªjbd2çº¿ç¨‹ï¼ˆæ²¡æœ‰PF_NOFREEZEï¼Œä½†å†»ç»“å¤±è´¥ï¼‰</strong></td></tr></tbody></table>
<h2 data-id="heading-8">ä¸‰ã€åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹</h2>
<h3 data-id="heading-9">3.1 åˆ¤æ–­æ ‡å‡†</h3>
<p><strong>åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼š</p>
<ul>
<li>æœ‰ <code>PF_KTHREAD</code> æ ‡å¿—ï¼ˆæ˜¯å†…æ ¸çº¿ç¨‹ï¼‰</li>
<li><strong>æ²¡æœ‰</strong> <code>PF_NOFREEZE</code> æ ‡å¿—ï¼ˆæ²¡æœ‰æ ‡è®°ä¸ºä¸å¯å†»ç»“ï¼‰</li>
<li><strong>æ²¡æœ‰</strong> <code>PF_FREEZER_SKIP</code> æ ‡å¿—ï¼ˆæ²¡æœ‰è¢«è·³è¿‡ï¼‰</li>
</ul>
<h3 data-id="heading-10">3.2 ä»æ—¥å¿—ä¸­çœ‹åˆ°çš„</h3>
<p><strong>å†»ç»“å¤±è´¥çš„å†…æ ¸çº¿ç¨‹ï¼ˆ6ä¸ªï¼‰</strong>ï¼š</p>
<ul>
<li><code>kswapd0 (pid 88)</code> - flags=0xa20840ï¼ˆæœ‰PF_KTHREADï¼Œæ²¡æœ‰PF_NOFREEZEï¼‰</li>
<li><code>jbd2/loop0-8 (pid 239)</code> - flags=0x240040ï¼ˆæœ‰PF_KTHREADï¼Œæ²¡æœ‰PF_NOFREEZEï¼‰</li>
<li><code>jbd2/mmcblk0p10 (pid 907)</code> - flags=0x240040</li>
<li><code>jbd2/mmcblk0p17 (pid 926)</code> - flags=0x240040</li>
<li><code>jbd2/mmcblk0p16 (pid 948)</code> - flags=0x240040</li>
<li><code>jbd2/mmcblk0p19 (pid 987)</code> - flags=0x240040</li>
</ul>
<p><strong>è¿™äº›ä»»åŠ¡</strong>ï¼š</p>
<ul>
<li>âœ… æ˜¯å†…æ ¸çº¿ç¨‹ï¼ˆæœ‰PF_KTHREADï¼‰</li>
<li>âœ… æ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼ˆåº”è¯¥è¢«å†»ç»“ï¼‰</li>
<li>âŒ ä½†å†»ç»“å¤±è´¥ï¼ˆFAILED_FREEZEï¼‰</li>
<li>âŒ ç¬¬äºŒé˜¶æ®µæ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥å®ƒä»¬æ²¡æœ‰è¢«å†»ç»“</li>
</ul>
<h3 data-id="heading-11">3.3 å…¶ä»–å†…æ ¸çº¿ç¨‹çš„æƒ…å†µ</h3>
<p><strong>å…³é”®å‘ç°</strong>ï¼šä»æ—¥å¿—åˆ†æï¼Œ<strong>åªæœ‰6ä¸ªå†…æ ¸çº¿ç¨‹è¢«å°è¯•å†»ç»“</strong>ï¼ˆkswapd0å’Œ5ä¸ªjbd2çº¿ç¨‹ï¼‰ï¼Œå…¶ä»–æ‰€æœ‰å†…æ ¸çº¿ç¨‹éƒ½è¢«æ ‡è®°ä¸ºUNFREEZABLEã€‚</p>
<p><strong>é—®é¢˜</strong>ï¼šé™¤äº†è¿™6ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå…¶ä»–çš„å†…æ ¸çº¿ç¨‹æ˜¯ä¸éœ€è¦å†»ç»“ï¼Œè¿˜æ˜¯è¯´æ²¡æœ‰æˆåŠŸå†»ç»“ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆï¼šå…¶ä»–å†…æ ¸çº¿ç¨‹ï¼ˆ95ä¸ªï¼‰éƒ½æ˜¯ä¸éœ€è¦å†»ç»“çš„ï¼ˆæœ‰PF_NOFREEZEæ ‡å¿—ï¼‰ã€‚</strong></p>
<p>åªæœ‰è¿™6ä¸ªå†…æ ¸çº¿ç¨‹æ˜¯åº”è¯¥è¢«å†»ç»“ä½†æ²¡æœ‰æˆåŠŸå†»ç»“çš„ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼Œä½†å†»ç»“å¤±è´¥ï¼‰ã€‚</p>
<h4 data-id="heading-12">3.3.1 ä»æ—¥å¿—ç»Ÿè®¡éªŒè¯</h4>
<p>ä»æ—¥å¿— <code>20251219_12.log</code> çš„ç»Ÿè®¡ä¿¡æ¯å¯ä»¥çœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">FINAL STATS:
- <span class="hljs-attr">unfreezable</span>=<span class="hljs-number">95</span>ï¼š<span class="hljs-number">95</span>ä¸ªä»»åŠ¡ä¸å¯å†»ç»“ï¼ˆæœ‰PF_NOFREEZEæ ‡å¿—ï¼‰
- <span class="hljs-attr">failed</span>=<span class="hljs-number">6</span>ï¼š<span class="hljs-number">6</span>ä¸ªä»»åŠ¡å†»ç»“å¤±è´¥ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼Œä½†å†»ç»“å¤±è´¥ï¼‰
</code></pre>
<h4 data-id="heading-13">3.3.2 UNFREEZABLEå†…æ ¸çº¿ç¨‹ï¼ˆ95ä¸ªï¼‰</h4>
<p><strong>ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰UNFREEZABLEå†…æ ¸çº¿ç¨‹éƒ½æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—</li>
<li>å®ƒä»¬<strong>ä¸éœ€è¦å†»ç»“</strong>ï¼Œè¿™æ˜¯æ­£ç¡®çš„è¡Œä¸º</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[   98.810973]</span> LLLLLLLL UNFREEZABLE: kthreadd (pid 2), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x208040, state=<span class="hljs-number">1</span>
<span class="hljs-section">[   98.811793]</span> LLLLLLLL UNFREEZABLE: rcu_gp (pid 3), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x4208060, state=<span class="hljs-number">1026</span>
<span class="hljs-section">[   98.812644]</span> LLLLLLLL UNFREEZABLE: rcu_par_gp (pid 4), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x4208060, state=<span class="hljs-number">1026</span>
<span class="hljs-section">[   98.815247]</span> LLLLLLLL UNFREEZABLE: kworker/0:0 (pid 7), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x4208060, state=<span class="hljs-number">1026</span>
<span class="hljs-section">[   98.820687]</span> LLLLLLLL UNFREEZABLE: ksoftirqd/0 (pid 13), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x4208040, state=<span class="hljs-number">1</span>
<span class="hljs-section">[   98.822436]</span> LLLLLLLL UNFREEZABLE: migration/0 (pid 15), <span class="hljs-attr">flags</span>=<span class="hljs-number">0</span>x4208040, state=<span class="hljs-number">1</span>
...
</code></pre>
<p><strong>Flagså€¼åˆ†æ</strong>ï¼š</p>
<ul>
<li><code>0x208040 = 0x00200000 (PF_KTHREAD) + 0x00008000 (PF_NOFREEZE) + 0x00000040 (PF_FORKNOEXEC)</code></li>
<li><code>0x4208060 = 0x00200000 (PF_KTHREAD) + 0x00000020 (PF_WQ_WORKER) + 0x00008000 (PF_NOFREEZE) + 0x00000040 (PF_FORKNOEXEC)</code></li>
<li><code>0x4208040 = 0x00200000 (PF_KTHREAD) + 0x00000020 (PF_WQ_WORKER) + 0x00008000 (PF_NOFREEZE)</code></li>
</ul>
<p><strong>ç»“è®º</strong>ï¼šæ‰€æœ‰è¿™äº›flagså€¼éƒ½åŒ…å«<code>PF_NOFREEZE (0x00008000)</code>ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦å†»ç»“ã€‚</p>
<p><strong>åŒ…æ‹¬</strong>ï¼škthreaddã€rcu_gpã€æ‰€æœ‰kworkerçº¿ç¨‹ã€ä¸­æ–­å¤„ç†çº¿ç¨‹ç­‰</p>
<h4 data-id="heading-14">3.3.3 FAILED_FREEZEå†…æ ¸çº¿ç¨‹ï¼ˆ6ä¸ªï¼‰</h4>
<p><strong>ç‰¹å¾</strong>ï¼š</p>
<ul>
<li>è¿™6ä¸ªå†…æ ¸çº¿ç¨‹<strong>æ²¡æœ‰</strong><code>PF_NOFREEZE</code>æ ‡å¿—</li>
<li>å®ƒä»¬<strong>åº”è¯¥è¢«å†»ç»“</strong>ï¼Œä½†å†»ç»“å¤±è´¥</li>
<li>åŒ…æ‹¬ï¼škswapd0å’Œ5ä¸ªjbd2çº¿ç¨‹</li>
</ul>
<p><strong>Flagså€¼åˆ†æ</strong>ï¼š</p>
<ul>
<li><code>0xa20840 = 0x00200000 (PF_KTHREAD) + 0x00020000 (PF_KSWAPD) + 0x00000800 (PF_MEMALLOC) + 0x00000040 (PF_FORKNOEXEC)</code>
<ul>
<li><strong>æ²¡æœ‰</strong><code>PF_NOFREEZE (0x00008000)</code></li>
</ul>
</li>
<li><code>0x240040 = 0x00200000 (PF_KTHREAD) + 0x00000040 (PF_FORKNOEXEC)</code>
<ul>
<li><strong>æ²¡æœ‰</strong><code>PF_NOFREEZE (0x00008000)</code></li>
</ul>
</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼šè¿™äº›flagså€¼éƒ½<strong>ä¸åŒ…å«</strong><code>PF_NOFREEZE</code>ï¼Œæ‰€ä»¥å®ƒä»¬åº”è¯¥è¢«å†»ç»“ï¼Œä½†å†»ç»“å¤±è´¥äº†ã€‚</p>
<h4 data-id="heading-15">3.3.4 ä¸ºä»€ä¹ˆåªæœ‰è¿™6ä¸ªè¢«å°è¯•å†»ç»“ï¼Ÿ</h4>
<p><strong>åŸå› </strong>ï¼šç¬¬ä¸€é˜¶æ®µï¼ˆ<code>freeze_processes()</code>ï¼‰è™½ç„¶ä¸»è¦å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼Œä½†ä¹Ÿä¼šéå†æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒ…æ‹¬å†…æ ¸çº¿ç¨‹ã€‚</p>
<p><strong>ä»£ç é€»è¾‘</strong>ï¼ˆ<code>kernel/power/process.c</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">try_to_freeze_tasks</span><span class="hljs-params">(<span class="hljs-type">bool</span> user_only)</span>
{
    <span class="hljs-comment">// ...</span>
    for_each_process_thread(g, p) {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">if</span> (p-&gt;flags &amp; PF_NOFREEZE) {
            unfreezable_tasks++;
            <span class="hljs-comment">// æ ‡è®°ä¸ºUNFREEZABLEï¼Œè·³è¿‡ï¼Œä¸è°ƒç”¨freeze_task</span>
            <span class="hljs-keyword">continue</span>;
        }
        
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼Œå°è¯•å†»ç»“</span>
        <span class="hljs-keyword">if</span> (!freeze_task(p)) {
            failed_freeze_tasks++;
            <span class="hljs-comment">// ...</span>
        }
    }
}
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µä¼šéå†æ‰€æœ‰ä»»åŠ¡ï¼ˆåŒ…æ‹¬å†…æ ¸çº¿ç¨‹ï¼‰</li>
<li>å¦‚æœæœ‰<code>PF_NOFREEZE</code>æ ‡å¿—ï¼Œæ ‡è®°ä¸ºUNFREEZABLEï¼Œè·³è¿‡</li>
<li>å¦‚æœæ²¡æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—ï¼Œå°è¯•å†»ç»“ï¼ˆè°ƒç”¨<code>freeze_task</code>ï¼‰</li>
<li>æ‰€ä»¥ï¼Œåªæœ‰æ²¡æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—çš„å†…æ ¸çº¿ç¨‹ä¼šè¢«å°è¯•å†»ç»“</li>
</ul>
<p><strong>å®é™…æƒ…å†µ</strong>ï¼š</p>
<ul>
<li>ç³»ç»Ÿä¸­åªæœ‰6ä¸ªå†…æ ¸çº¿ç¨‹æ²¡æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—ï¼ˆkswapd0å’Œ5ä¸ªjbd2çº¿ç¨‹ï¼‰</li>
<li>è¿™6ä¸ªçº¿ç¨‹åœ¨ç¬¬ä¸€é˜¶æ®µè¢«å°è¯•å†»ç»“ï¼Œä½†éƒ½å¤±è´¥äº†</li>
<li>å…¶ä»–æ‰€æœ‰å†…æ ¸çº¿ç¨‹éƒ½æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—ï¼Œä¸éœ€è¦å†»ç»“</li>
</ul>
<h4 data-id="heading-16">3.3.5 æ˜¯å¦æœ‰å…¶ä»–åº”è¯¥è¢«å†»ç»“ä½†æ²¡æœ‰è¢«å°è¯•å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼Ÿ</h4>
<p><strong>ç­”æ¡ˆï¼šæ²¡æœ‰</strong></p>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li>ä»æ—¥å¿—çœ‹ï¼Œåªæœ‰6ä¸ªå†…æ ¸çº¿ç¨‹è¢«å°è¯•å†»ç»“ï¼ˆæœ‰<code>freeze_task</code>è°ƒç”¨ï¼‰</li>
<li>å…¶ä»–æ‰€æœ‰å†…æ ¸çº¿ç¨‹éƒ½è¢«æ ‡è®°ä¸ºUNFREEZABLEï¼ˆæœ‰PF_NOFREEZEæ ‡å¿—ï¼‰</li>
<li><strong>è¿™è¯´æ˜ç³»ç»Ÿä¸­æ‰€æœ‰å†…æ ¸çº¿ç¨‹è¦ä¹ˆæœ‰PF_NOFREEZEæ ‡å¿—ï¼ˆä¸éœ€è¦å†»ç»“ï¼‰ï¼Œè¦ä¹ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—ä½†è¢«å°è¯•å†»ç»“äº†ï¼ˆè™½ç„¶å¤±è´¥äº†ï¼‰</strong></li>
</ul>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µè™½ç„¶ä¸»è¦å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼Œä½†ä¹Ÿä¼šéå†æ‰€æœ‰ä»»åŠ¡ï¼ŒåŒ…æ‹¬å†…æ ¸çº¿ç¨‹</li>
<li>æ‰€ä»¥ï¼Œæ‰€æœ‰æ²¡æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—çš„å†…æ ¸çº¿ç¨‹åœ¨ç¬¬ä¸€é˜¶æ®µå°±è¢«å°è¯•å†»ç»“äº†</li>
<li>ç¬¬äºŒé˜¶æ®µä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿æ‰€æœ‰å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹éƒ½è¢«å†»ç»“ï¼Œä½†ç”±äºç¬¬ä¸€é˜¶æ®µå·²ç»å¤„ç†äº†ï¼Œæ‰€ä»¥ç¬¬äºŒé˜¶æ®µæ²¡æœ‰æ‰§è¡Œä¹Ÿä¸ä¼šé—æ¼</li>
</ul>
<p><strong>ç»“è®º</strong>ï¼š</p>
<ul>
<li>é™¤äº†è¿™6ä¸ªå†»ç»“å¤±è´¥çš„å†…æ ¸çº¿ç¨‹ï¼Œå…¶ä»–å†…æ ¸çº¿ç¨‹éƒ½æ˜¯ä¸éœ€è¦å†»ç»“çš„</li>
<li>ç³»ç»Ÿä¸­æ²¡æœ‰å…¶ä»–åº”è¯¥è¢«å†»ç»“ä½†æ²¡æœ‰è¢«å°è¯•å†»ç»“çš„å†…æ ¸çº¿ç¨‹</li>
</ul>
<h2 data-id="heading-17">å››ã€é—®é¢˜åˆ†æ</h2>
<h3 data-id="heading-18">4.1 ä¸ºä»€ä¹ˆç¬¬äºŒé˜¶æ®µæ²¡æœ‰æ‰§è¡Œï¼Ÿ</h3>
<p><strong>åŸå› </strong>ï¼š</p>
<ol>
<li>ç¬¬ä¸€é˜¶æ®µï¼ˆ<code>freeze_processes()</code>ï¼‰è¶…æ—¶å¤±è´¥ï¼ˆerror -16 = EBUSYï¼‰</li>
<li><code>suspend_freeze_processes()</code> åœ¨æ£€æµ‹åˆ°ç¬¬ä¸€é˜¶æ®µå¤±è´¥åç›´æ¥è¿”å›é”™è¯¯</li>
<li>æ²¡æœ‰è°ƒç”¨ <code>freeze_kernel_threads()</code></li>
</ol>
<p><strong>ä»£ç é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c">error = freeze_processes();  <span class="hljs-comment">// ç¬¬ä¸€é˜¶æ®µå¤±è´¥</span>
<span class="hljs-keyword">if</span> (error) {
    <span class="hljs-keyword">return</span> error;  <span class="hljs-comment">// ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œç¬¬äºŒé˜¶æ®µ</span>
}
error = freeze_kernel_threads();  <span class="hljs-comment">// æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ</span>
</code></pre>
<h3 data-id="heading-19">4.2 å¼ºåˆ¶æŒ‚èµ·çš„å½±å“</h3>
<p><strong>ç³»ç»Ÿè¡Œä¸º</strong>ï¼š</p>
<ul>
<li>è™½ç„¶ <code>suspend_freeze_processes()</code> è¿”å›é”™è¯¯</li>
<li>ä½†ç³»ç»Ÿå¯ç”¨äº† <code>FORCE SUSPEND</code></li>
<li>å³ä½¿å†»ç»“å¤±è´¥ä¹Ÿç»§ç»­æŒ‚èµ·</li>
<li><strong>ç»“æœ</strong>ï¼šç³»ç»Ÿåœ¨ä¸å®Œæ•´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ </li>
</ul>
<h3 data-id="heading-20">4.3 è¿™å¯¼è‡´çš„é—®é¢˜</h3>
<ol>
<li>
<p><strong>å†…æ ¸çº¿ç¨‹æ²¡æœ‰è¢«å†»ç»“</strong>ï¼š</p>
<ul>
<li>åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—çš„ï¼‰æ²¡æœ‰è¢«å†»ç»“</li>
<li>åŒ…æ‹¬kswapd0å’Œjbd2çº¿ç¨‹ï¼ˆè™½ç„¶å®ƒä»¬å†»ç»“å¤±è´¥ï¼Œä½†è‡³å°‘å°è¯•äº†ï¼‰</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€ä¸ä¸€è‡´</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·ç©ºé—´è¿›ç¨‹è¢«å†»ç»“äº†ï¼ˆ3ä¸ªï¼‰</li>
<li>å†…æ ¸çº¿ç¨‹æ²¡æœ‰è¢«å†»ç»“ï¼ˆé™¤äº†æœ‰PF_NOFREEZEæ ‡å¿—çš„ï¼‰</li>
<li>ç³»ç»Ÿåœ¨ä¸ä¸€è‡´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ </li>
</ul>
</li>
<li>
<p><strong>å”¤é†’å¤±è´¥çš„å¯èƒ½åŸå› </strong>ï¼š</p>
<ul>
<li>å†…æ ¸çº¿ç¨‹ï¼ˆå¦‚kswapd0ã€jbd2ï¼‰æ²¡æœ‰è¢«å†»ç»“</li>
<li>å®ƒä»¬å¯èƒ½å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€</li>
<li>å”¤é†’æ—¶æ— æ³•ä»ä¸ä¸€è‡´çš„çŠ¶æ€ä¸­æ¢å¤</li>
</ul>
</li>
</ol>
<h2 data-id="heading-21">äº”ã€æ­£å¸¸æµç¨‹åº”è¯¥æ˜¯æ€æ ·çš„ï¼Ÿ</h2>
<h3 data-id="heading-22">5.1 æ­£å¸¸æµç¨‹</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">suspend_freeze_processes</span>()
  â†“
<span class="hljs-built_in">freeze_processes</span>()  <span class="hljs-selector-attr">[ç¬¬ä¸€é˜¶æ®µ]</span>
  â”œâ”€ è®¾ç½® pm_freezing = true
  â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">try_to_freeze_tasks</span>(true)
  â””â”€ å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹
  â†“
<span class="hljs-built_in">freeze_kernel_threads</span>()  <span class="hljs-selector-attr">[ç¬¬äºŒé˜¶æ®µ]</span>
  â”œâ”€ è®¾ç½® pm_nosig_freezing = true
  â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">try_to_freeze_tasks</span>(false)
  â””â”€ å†»ç»“å¯å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—çš„ï¼‰
</code></pre>
<h3 data-id="heading-23">5.2 å®é™…æµç¨‹ï¼ˆä»æ—¥å¿—çœ‹ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">suspend_freeze_processes</span>()
  â†“
<span class="hljs-built_in">freeze_processes</span>()  <span class="hljs-selector-attr">[ç¬¬ä¸€é˜¶æ®µ]</span>
  â”œâ”€ è®¾ç½® pm_freezing = true
  â”œâ”€ è°ƒç”¨ <span class="hljs-built_in">try_to_freeze_tasks</span>(true)
  â”œâ”€ å†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼ˆéƒ¨åˆ†æˆåŠŸï¼Œ<span class="hljs-number">3</span>ä¸ªï¼‰
  â””â”€ âŒ è¶…æ—¶å¤±è´¥ï¼ˆerror -<span class="hljs-number">16</span>ï¼‰
  â†“
âŒ ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸æ‰§è¡Œç¬¬äºŒé˜¶æ®µ
  â†“
FORCE SUSPENDå¯ç”¨ï¼Œç»§ç»­æŒ‚èµ·
  â†“
ç³»ç»Ÿåœ¨ä¸å®Œæ•´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ 
</code></pre>
<h2 data-id="heading-24">å…­ã€ç»“è®º</h2>
<h3 data-id="heading-25">6.1 å…³é”®ç»“è®º</h3>
<p><strong>æ˜¯çš„ï¼Œæ‚¨ç¡®å®æ²¡æœ‰å†»ç»“åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼</strong></p>
<p><strong>åŸå› </strong>ï¼š</p>
<ol>
<li>ç¬¬ä¸€é˜¶æ®µï¼ˆå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼‰å¤±è´¥</li>
<li>å› ä¸ºç¬¬ä¸€é˜¶æ®µå¤±è´¥ï¼Œç¬¬äºŒé˜¶æ®µï¼ˆå†»ç»“å†…æ ¸çº¿ç¨‹ï¼‰<strong>æ ¹æœ¬æ²¡æœ‰æ‰§è¡Œ</strong></li>
<li>ç³»ç»Ÿå¯ç”¨äº†å¼ºåˆ¶æŒ‚èµ·ï¼Œå³ä½¿å†»ç»“å¤±è´¥ä¹Ÿç»§ç»­æŒ‚èµ·</li>
<li>ç»“æœï¼šåº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹ï¼ˆæ²¡æœ‰PF_NOFREEZEæ ‡å¿—çš„ï¼‰æ²¡æœ‰è¢«å†»ç»“</li>
</ol>
<h3 data-id="heading-26">6.2 å½±å“</h3>
<ol>
<li>
<p><strong>kswapd0å’Œjbd2çº¿ç¨‹</strong>ï¼š</p>
<ul>
<li>æ²¡æœ‰PF_NOFREEZEæ ‡å¿—ï¼Œåº”è¯¥è¢«å†»ç»“</li>
<li>ç¬¬ä¸€é˜¶æ®µå°è¯•å†»ç»“å®ƒä»¬ï¼Œä½†å¤±è´¥äº†</li>
<li>ç¬¬äºŒé˜¶æ®µåº”è¯¥å†æ¬¡å°è¯•ï¼Œä½†ç¬¬äºŒé˜¶æ®µæ²¡æœ‰æ‰§è¡Œ</li>
<li><strong>ç»“æœï¼šå®ƒä»¬æ²¡æœ‰è¢«å†»ç»“</strong></li>
</ul>
</li>
<li>
<p><strong>å…¶ä»–åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼š</p>
<ul>
<li>æ²¡æœ‰PF_NOFREEZEæ ‡å¿—</li>
<li>ç¬¬ä¸€é˜¶æ®µä¸ä¼šå†»ç»“å®ƒä»¬ï¼ˆåªå†»ç»“ç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼‰</li>
<li>ç¬¬äºŒé˜¶æ®µåº”è¯¥å†»ç»“å®ƒä»¬ï¼Œä½†ç¬¬äºŒé˜¶æ®µæ²¡æœ‰æ‰§è¡Œ</li>
<li><strong>ç»“æœï¼šå®ƒä»¬ä¹Ÿæ²¡æœ‰è¢«å†»ç»“</strong></li>
</ul>
</li>
<li>
<p><strong>ç³»ç»ŸçŠ¶æ€</strong>ï¼š</p>
<ul>
<li>åªæœ‰3ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹è¢«å†»ç»“</li>
<li>åº”è¯¥è¢«å†»ç»“çš„å†…æ ¸çº¿ç¨‹éƒ½æ²¡æœ‰è¢«å†»ç»“</li>
<li>ç³»ç»Ÿåœ¨ä¸ä¸€è‡´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ </li>
<li><strong>è¿™å¾ˆå¯èƒ½æ˜¯å”¤é†’å¤±è´¥çš„æ ¹æœ¬åŸå› </strong></li>
</ul>
</li>
</ol>
<h3 data-id="heading-27">6.3 å»ºè®®</h3>
<ol>
<li>
<p><strong>ç¦ç”¨å¼ºåˆ¶æŒ‚èµ·æ¨¡å¼</strong>ï¼š</p>
<ul>
<li>å¦‚æœå†»ç»“å¤±è´¥ï¼Œåº”è¯¥å–æ¶ˆæŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶ç»§ç»­</li>
<li>è¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿåœ¨ä¸å®Œæ•´çš„çŠ¶æ€ä¸‹è¿›å…¥æ·±åº¦ç¡çœ </li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–å†»ç»“æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>è§£å†³ç¬¬ä¸€é˜¶æ®µå†»ç»“å¤±è´¥çš„é—®é¢˜</li>
<li>ç¡®ä¿èƒ½å¤Ÿè¿›å…¥ç¬¬äºŒé˜¶æ®µï¼Œå†»ç»“å†…æ ¸çº¿ç¨‹</li>
</ul>
</li>
<li>
<p><strong>å¢åŠ è°ƒè¯•ä¿¡æ¯</strong>ï¼š</p>
<ul>
<li>è®°å½•å“ªäº›å†…æ ¸çº¿ç¨‹åº”è¯¥è¢«å†»ç»“ä½†æ²¡æœ‰è¢«å†»ç»“</li>
<li>å¸®åŠ©è¯Šæ–­é—®é¢˜</li>
</ul>
</li>
</ol>
<h2 data-id="heading-28">ä¸ƒã€å†…æ ¸çº¿ç¨‹åˆ†ç±»æ€»ç»“</h2>
<h3 data-id="heading-29">7.1 å®Œæ•´åˆ†ç±»è¡¨</h3>








































<table><thead><tr><th>ç±»åˆ«</th><th>æ•°é‡</th><th>ç‰¹å¾</th><th>æ˜¯å¦éœ€è¦å†»ç»“</th><th>å®é™…è¡Œä¸º</th></tr></thead><tbody><tr><td><strong>æˆåŠŸå†»ç»“</strong></td><td>3</td><td>ç”¨æˆ·ç©ºé—´è¿›ç¨‹</td><td>âœ… éœ€è¦</td><td>æˆåŠŸå†»ç»“</td></tr><tr><td><strong>UNFREEZABLE</strong></td><td>95</td><td>æœ‰PF_NOFREEZEæ ‡å¿—</td><td>âŒ ä¸éœ€è¦</td><td>æ ‡è®°ä¸ºUNFREEZABLEï¼Œè·³è¿‡å†»ç»“</td></tr><tr><td><strong>FAILED_FREEZE</strong></td><td>6</td><td>æ²¡æœ‰PF_NOFREEZEæ ‡å¿—</td><td>âœ… éœ€è¦</td><td>å°è¯•å†»ç»“ä½†å¤±è´¥</td></tr><tr><td><strong>è·³è¿‡</strong></td><td>18</td><td>å…¶ä»–è¢«è·³è¿‡çš„ä»»åŠ¡</td><td>-</td><td>è¢«è·³è¿‡</td></tr></tbody></table>
<h3 data-id="heading-30">7.2 å…³é”®ç»“è®º</h3>
<ol>
<li>
<p><strong>å…¶ä»–å†…æ ¸çº¿ç¨‹ï¼ˆ95ä¸ªï¼‰éƒ½æ˜¯ä¸éœ€è¦å†»ç»“çš„</strong>ï¼š</p>
<ul>
<li>å®ƒä»¬éƒ½æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—</li>
<li>è¿™æ˜¯æ­£ç¡®çš„è¡Œä¸ºï¼Œè¿™äº›å†…æ ¸çº¿ç¨‹ä¸åº”è¯¥è¢«å†»ç»“</li>
<li>åŒ…æ‹¬ï¼škthreaddã€rcu_gpã€æ‰€æœ‰kworkerçº¿ç¨‹ã€ä¸­æ–­å¤„ç†çº¿ç¨‹ç­‰</li>
</ul>
</li>
<li>
<p><strong>åªæœ‰6ä¸ªå†…æ ¸çº¿ç¨‹æ˜¯åº”è¯¥è¢«å†»ç»“ä½†æ²¡æœ‰æˆåŠŸå†»ç»“çš„</strong>ï¼š</p>
<ul>
<li>å®ƒä»¬æ²¡æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—</li>
<li>åº”è¯¥è¢«å†»ç»“ï¼Œä½†å†»ç»“å¤±è´¥</li>
<li>åŒ…æ‹¬ï¼škswapd0å’Œ5ä¸ªjbd2çº¿ç¨‹</li>
</ul>
</li>
<li>
<p><strong>ç³»ç»Ÿä¸­æ²¡æœ‰å…¶ä»–åº”è¯¥è¢«å†»ç»“ä½†æ²¡æœ‰è¢«å°è¯•å†»ç»“çš„å†…æ ¸çº¿ç¨‹</strong>ï¼š</p>
<ul>
<li>ä»æ—¥å¿—çœ‹ï¼Œåªæœ‰è¿™6ä¸ªå†…æ ¸çº¿ç¨‹æ²¡æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—</li>
<li>è¿™6ä¸ªçº¿ç¨‹éƒ½è¢«å°è¯•å†»ç»“äº†ï¼ˆè™½ç„¶å¤±è´¥äº†ï¼‰</li>
<li>å…¶ä»–æ‰€æœ‰å†…æ ¸çº¿ç¨‹éƒ½æœ‰<code>PF_NOFREEZE</code>æ ‡å¿—ï¼Œä¸éœ€è¦å†»ç»“</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[python--é¢å‘å¯¹è±¡ï¼ˆ3ï¼‰]]></title>    <link>https://juejin.cn/post/7585395972294410249</link>    <guid>https://juejin.cn/post/7585395972294410249</guid>    <pubDate>2025-12-19T14:50:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585395972294410249" data-draft-id="7585406229168013362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="python--é¢å‘å¯¹è±¡ï¼ˆ3ï¼‰"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-19T14:50:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é…·é…·çš„ä½³"/> <meta itemprop="url" content="https://juejin.cn/user/2939463340923272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            python--é¢å‘å¯¹è±¡ï¼ˆ3ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2939463340923272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é…·é…·çš„ä½³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T14:50:52.000Z" title="Fri Dec 19 2025 14:50:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¸¸ç”¨é­”æœ¯æ–¹æ³•ï¼ˆç‰¹æ®Šæ–¹æ³•ï¼‰</h2>
<p>Python ä¸­ä»¥Â <code>__</code>Â å¼€å¤´å’Œç»“å°¾çš„æ–¹æ³•ç§°ä¸º â€œé­”æœ¯æ–¹æ³•â€ï¼Œç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„è¡Œä¸ºï¼š</p>



































<table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>__init__</code></td><td>åˆå§‹åŒ–å®ä¾‹</td><td><code>def __init__(self, name): ...</code></td></tr><tr><td><code>__str__</code></td><td>æ‰“å°å®ä¾‹æ—¶çš„å­—ç¬¦ä¸²</td><td><code>def __str__(self): return f"Person({self.name})"</code></td></tr><tr><td><code>__repr__</code></td><td>äº¤äº’å¼è§£é‡Šå™¨æ˜¾ç¤ºçš„å­—ç¬¦ä¸²</td><td><code>def __repr__(self): return f"Person('{self.name}')"</code></td></tr><tr><td><code>__add__</code></td><td>é‡è½½ + è¿ç®—ç¬¦</td><td><code>def __add__(self, other): return self.age + other.age</code></td></tr><tr><td><code>__len__</code></td><td>é‡è½½ len () å‡½æ•°</td><td><code>def __len__(self): return len(self.name)</code></td></tr></tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        self.name = name
        self.age = age
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Person(name=<span class="hljs-subst">{self.name}</span>, age=<span class="hljs-subst">{self.age}</span>)"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other</span>):
        <span class="hljs-keyword">return</span> self.age + other.age

p1 = Person(<span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-number">18</span>)
p2 = Person(<span class="hljs-string">"æå››"</span>, <span class="hljs-number">19</span>)

<span class="hljs-built_in">print</span>(p1)        <span class="hljs-comment"># è¾“å‡ºï¼šPerson(name=å¼ ä¸‰, age=18)ï¼ˆè°ƒç”¨ __str__ï¼‰</span>
<span class="hljs-built_in">print</span>(p1 + p2)   <span class="hljs-comment"># è¾“å‡ºï¼š37ï¼ˆè°ƒç”¨ __add__ï¼‰</span>
</code></pre>
<h2 data-id="heading-1">äºŒã€æŠ½è±¡ç±»</h2>
<p>æŠ½è±¡ç±»æ˜¯åŒ…å« â€œæŠ½è±¡æ–¹æ³•â€ çš„ç±»ï¼Œä¸èƒ½å®ä¾‹åŒ–ï¼Œå­ç±»å¿…é¡»å®ç°æŠ½è±¡æ–¹æ³•ï¼ˆå¼ºåˆ¶è§„èŒƒå­ç±»è¡Œä¸ºï¼‰ï¼Œéœ€å€ŸåŠ©Â <code>abc</code>Â æ¨¡å—ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta, abstractmethod

<span class="hljs-comment"># æŠ½è±¡ç±»ï¼šç»§æ‰¿ ABCMeta</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span>(metaclass=ABCMeta):
    <span class="hljs-comment"># æŠ½è±¡æ–¹æ³•ï¼šåªæœ‰å®šä¹‰ï¼Œæ— å®ç°</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># å­ç±»å¿…é¡»å®ç°æŠ½è±¡æ–¹æ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-title class_ inherited__">Shape</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, radius</span>):
        self.radius = radius
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.14</span> * self.radius **<span class="hljs-number">2</span>

<span class="hljs-comment"># shape = Shape()  # æŠ¥é”™ï¼šæ— æ³•å®ä¾‹åŒ–æŠ½è±¡ç±»</span>
circle = Circle(<span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(circle.area())  <span class="hljs-comment"># è¾“å‡ºï¼š78.5</span>
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€ç»„åˆï¼šæ›¿ä»£å¤šç»§æ‰¿çš„å¤ç”¨æ–¹å¼</h2>
<p>ç»„åˆæ˜¯å°† â€œå…¶ä»–ç±»çš„å®ä¾‹â€ ä½œä¸ºå½“å‰ç±»çš„å±æ€§ï¼Œå®ç°ä»£ç å¤ç”¨ï¼ˆæ¯”å¤šç»§æ‰¿æ›´çµæ´»ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¼•æ“ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Engine</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¼•æ“å¯åŠ¨"</span>)

<span class="hljs-comment"># æ±½è½¦ç±»ï¼ˆç»„åˆå¼•æ“ç±»ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.engine = Engine()  <span class="hljs-comment"># ç»„åˆï¼šå°† Engine å®ä¾‹ä½œä¸ºå±æ€§</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self</span>):
        self.engine.run()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ±½è½¦å¯åŠ¨"</span>)

car = Car()
car.start()
<span class="hljs-comment"># è¾“å‡ºï¼š</span>
<span class="hljs-comment"># å¼•æ“å¯åŠ¨</span>
<span class="hljs-comment"># æ±½è½¦å¯åŠ¨</span>
</code></pre>
<h2 data-id="heading-3">å››ã€æ ¸å¿ƒæ€»ç»“</h2>
<ol>
<li>
<p><strong>ç±»ä¸å¯¹è±¡</strong>ï¼šç±»æ˜¯æ¨¡æ¿ï¼Œå¯¹è±¡æ˜¯å®ä¾‹ï¼Œ<code>self</code>Â æŒ‡ä»£å½“å‰å®ä¾‹ï¼›</p>
</li>
<li>
<p><strong>å±æ€§</strong>ï¼šå®ä¾‹å±æ€§ï¼ˆç‹¬æœ‰ï¼‰ã€ç±»å±æ€§ï¼ˆå…±äº«ï¼‰ï¼›</p>
</li>
<li>
<p><strong>æ–¹æ³•</strong>ï¼šå®ä¾‹æ–¹æ³•ï¼ˆ<code>self</code>ï¼‰ã€ç±»æ–¹æ³•ï¼ˆ<code>@classmethod + cls</code>ï¼‰ã€é™æ€æ–¹æ³•ï¼ˆ<code>@staticmethod</code>ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ä¸‰å¤§ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å°è£…ï¼šç§æœ‰å±æ€§ / æ–¹æ³• +Â <code>@property</code>Â éšè—ç»†èŠ‚ï¼›</li>
<li>ç»§æ‰¿ï¼š<code>class å­ç±»(çˆ¶ç±»)</code>ï¼Œ<code>super()</code>Â è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼›</li>
<li>å¤šæ€ï¼šå­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œç»Ÿä¸€æ¥å£è°ƒç”¨ï¼›</li>
</ul>
</li>
<li>
<p><strong>è¿›é˜¶</strong>ï¼šé­”æœ¯æ–¹æ³•è‡ªå®šä¹‰å¯¹è±¡è¡Œä¸ºï¼ŒæŠ½è±¡ç±»å¼ºåˆ¶å­ç±»è§„èŒƒï¼Œç»„åˆæ›¿ä»£å¤šç»§æ‰¿å®ç°å¤ç”¨ã€‚</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[äºŒè¿›åˆ¶å®‰è£…Kubernetesï¼ˆk8sï¼‰v1.35.0]]></title>    <link>https://juejin.cn/post/7585395972294524937</link>    <guid>https://juejin.cn/post/7585395972294524937</guid>    <pubDate>2025-12-19T15:42:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585395972294524937" data-draft-id="7585227038992285734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="äºŒè¿›åˆ¶å®‰è£…Kubernetesï¼ˆk8sï¼‰v1.35.0"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-12-19T15:42:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é™ˆè¿ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/3315782802482007"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            äºŒè¿›åˆ¶å®‰è£…Kubernetesï¼ˆk8sï¼‰v1.35.0
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3315782802482007/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é™ˆè¿ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T15:42:05.000Z" title="Fri Dec 19 2025 15:42:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»27åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">äºŒè¿›åˆ¶å®‰è£…Kubernetesï¼ˆk8sï¼‰v1.35.0</h2>
<h2 data-id="heading-1">ä»‹ç»</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcby-chen%2FKubernetes" target="_blank" title="https://github.com/cby-chen/Kubernetes" ref="nofollow noopener noreferrer">github.com/cby-chen/Kuâ€¦</a> å¼€æºä¸æ˜“ï¼Œå¸®å¿™ç‚¹ä¸ªstarï¼Œè°¢è°¢äº†</h3>
<h3 data-id="heading-3">æ”¯æŒIPv4+IPv6åŒæ ˆã€‚æœ¬æ–‡æ˜¯ç²¾ç®€æ–‡æ¡£ï¼Œåˆ é™¤äº†æ³¨é‡Šä»¥åŠä¸€äº›åŸºç¡€çš„å†…å®¹ï¼Œç¤¾äº¤åª’ä½“è¶…å‡ºå­—æ•°é™åˆ¶ï¼Œå®Œæ•´ç‰ˆè§ï¼š</h3>
<h3 data-id="heading-4">é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcby-chen%2FKubernetes" target="_blank" title="https://github.com/cby-chen/Kubernetes" ref="nofollow noopener noreferrer">github.com/cby-chen/Kuâ€¦</a></h3>
<h2 data-id="heading-5">1.ç¯å¢ƒ</h2>





















































<table><thead><tr><th>ä¸»æœºåç§°</th><th>IPåœ°å€</th><th>è¯´æ˜</th><th>è½¯ä»¶</th></tr></thead><tbody><tr><td/><td>192.168.1.60</td><td>å¤–ç½‘èŠ‚ç‚¹</td><td>ä¸‹è½½å„ç§æ‰€éœ€å®‰è£…åŒ…</td></tr><tr><td>Master01</td><td>192.168.1.31</td><td>masterèŠ‚ç‚¹</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€<br/>kubeletã€kube-proxyã€nfs-clientã€haproxyã€keepalivedã€nginx</td></tr><tr><td>Master02</td><td>192.168.1.32</td><td>masterèŠ‚ç‚¹</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€<br/>kubeletã€kube-proxyã€nfs-clientã€haproxyã€keepalivedã€nginx</td></tr><tr><td>Master03</td><td>192.168.1.33</td><td>masterèŠ‚ç‚¹</td><td>kube-apiserverã€kube-controller-managerã€kube-schedulerã€etcdã€<br/>kubeletã€kube-proxyã€nfs-clientã€haproxyã€keepalivedã€nginx</td></tr><tr><td>Node01</td><td>192.168.1.34</td><td>nodeèŠ‚ç‚¹</td><td>kubeletã€kube-proxyã€nfs-clientã€nginx</td></tr><tr><td>Node02</td><td>192.168.1.35</td><td>nodeèŠ‚ç‚¹</td><td>kubeletã€kube-proxyã€nfs-clientã€nginx</td></tr><tr><td/><td>192.168.1.36</td><td>VIP</td><td/></tr></tbody></table>
<p>è¯¦ç»†ç‰ˆæœ¬</p>

























































<table><thead><tr><th>è½¯ä»¶</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>cni_plugins_version</td><td>v1.9.0</td></tr><tr><td>cri_containerd_cni_version</td><td>2.2.1</td></tr><tr><td>crictl_version</td><td>v1.35.0</td></tr><tr><td>cri_dockerd_version</td><td>0.3.21</td></tr><tr><td>etcd_version</td><td>v3.6.7</td></tr><tr><td>cfssl_version</td><td>1.6.5</td></tr><tr><td>kubernetes_server_version</td><td>1.35.0</td></tr><tr><td>docker_version</td><td>29.1.3</td></tr><tr><td>runc_version</td><td>1.4.0</td></tr><tr><td>kernel_version</td><td>6.16.4</td></tr><tr><td>helm_version</td><td>4.0.4</td></tr><tr><td>nginx_version</td><td>1.29.4</td></tr></tbody></table>
<p>ç½‘æ®µ  <br/></p>
<p>IPv4   <br/>
ç‰©ç†ä¸»æœºï¼š192.168.1.0/24  <br/>
serviceï¼š10.96.0.0/12  <br/>
podï¼š172.16.0.0/12 <br/></p>
<p>IPv6   <br/>
ç‰©ç†ä¸»æœºï¼š2408:822a:732:5ce1::1001/64  <br/>
ç‰©ç†ä¸»æœºï¼šfc00::31/8  <br/>
serviceï¼šfd00:1111::/112  <br/>
podï¼šfc00:2222::/112</p>
<p>å®‰è£…åŒ…å·²ç»æ•´ç†å¥½ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcby-chen%2FKubernetes%2Freleases%2Fdownload%2Fv1.35.0%2Fkubernetes-v1.35.0.tar" target="_blank" title="https://github.com/cby-chen/Kubernetes/releases/download/v1.35.0/kubernetes-v1.35.0.tar" ref="nofollow noopener noreferrer">github.com/cby-chen/Kuâ€¦</a></p>
<h3 data-id="heading-6">1.1.k8såŸºç¡€ç³»ç»Ÿç¯å¢ƒé…ç½®</h3>
<h4 data-id="heading-7">1.2.é…ç½®IP</h4>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-8">1.3.è®¾ç½®ä¸»æœºå</h4>
<pre><code class="hljs language-shell" lang="shell">hostnamectl set-hostname k8s-master01
hostnamectl set-hostname k8s-master02
hostnamectl set-hostname k8s-master03
hostnamectl set-hostname k8s-node01
hostnamectl set-hostname k8s-node02
</code></pre>
<h4 data-id="heading-9">1.4.é…ç½®yumæº</h4>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-10">1.5.å®‰è£…ä¸€äº›å¿…å¤‡å·¥å…·</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å¯¹äº Ubuntu</span>
apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install -y wget psmisc vim net-tools nfs-kernel-server telnet lvm2 git tar curl
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯¹äº CentOS 7</span>
yum update -y &amp;&amp; yum -y install  wget psmisc vim net-tools nfs-utils telnet yum-utils device-mapper-persistent-data lvm2 git tar curl
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯¹äº CentOS 8</span>
yum update -y &amp;&amp; yum -y install wget psmisc vim net-tools nfs-utils telnet yum-utils device-mapper-persistent-data lvm2 git network-scripts tar curl
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯¹äº CentOS 9</span>
yum update -y &amp;&amp; yum -y install wget psmisc vim net-tools nfs-utils telnet yum-utils device-mapper-persistent-data lvm2 git tar curl
</code></pre>
<h5 data-id="heading-11">1.5.1 ä¸‹è½½ç¦»çº¿æ‰€éœ€æ–‡ä»¶(å¯é€‰)</h5>
<p>åœ¨äº’è”ç½‘æœåŠ¡å™¨ä¸Šå®‰è£…ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç³»ç»Ÿè¿›è¡Œä¸‹è½½æ‰€éœ€åŒ…</p>
<h6 data-id="heading-12">CentOS7</h6>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h6 data-id="heading-13">CentOS8</h6>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h6 data-id="heading-14">CentOS9</h6>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h6 data-id="heading-15">Ubuntu ä¸‹è½½åŒ…å’Œä¾èµ–</h6>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-16">1.6.é€‰æ‹©æ€§ä¸‹è½½éœ€è¦å·¥å…·</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">!/bin/bash</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹ç‰ˆæœ¬åœ°å€ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash">
<span class="hljs-comment"># https://github.com/containernetworking/plugins/releases/</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/containerd/containerd/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/kubernetes-sigs/cri-tools/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/Mirantis/cri-dockerd/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/etcd-io/etcd/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/cloudflare/cfssl/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://download.docker.com/linux/static/stable/x86_64/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/opencontainers/runc/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/helm/helm/tags</span>
<span class="hljs-meta prompt_"># </span><span class="bash">http://nginx.org/download/</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">Version numbers</span>
cni_plugins_version='v1.9.0'
cri_containerd_cni_version='2.2.1'
crictl_version='v1.35.0'
cri_dockerd_version='0.3.21'
etcd_version='v3.6.7'
cfssl_version='1.6.5'
kubernetes_server_version='1.35.0'
docker_version='29.1.3'
runc_version='1.4.0'
kernel_version='5.4.278'
helm_version='4.0.4'
nginx_version='1.29.4'
<span class="hljs-meta prompt_">
# </span><span class="bash">URLs</span> 
base_url='https://github.com'
kernel_url="http://mirrors.tuna.tsinghua.edu.cn/elrepo/kernel/el7/x86_64/RPMS/kernel-lt-${kernel_version}-1.el7.elrepo.x86_64.rpm"
runc_url="${base_url}/opencontainers/runc/releases/download/v${runc_version}/runc.amd64"
docker_url="https://mirrors.ustc.edu.cn/docker-ce/linux/static/stable/x86_64/docker-${docker_version}.tgz"
cni_plugins_url="${base_url}/containernetworking/plugins/releases/download/${cni_plugins_version}/cni-plugins-linux-amd64-${cni_plugins_version}.tgz"
cri_containerd_cni_url="${base_url}/containerd/containerd/releases/download/v${cri_containerd_cni_version}/containerd-${cri_containerd_cni_version}-linux-amd64.tar.gz"
crictl_url="${base_url}/kubernetes-sigs/cri-tools/releases/download/${crictl_version}/crictl-${crictl_version}-linux-amd64.tar.gz"
cri_dockerd_url="${base_url}/Mirantis/cri-dockerd/releases/download/v${cri_dockerd_version}/cri-dockerd-${cri_dockerd_version}.amd64.tgz"
etcd_url="${base_url}/etcd-io/etcd/releases/download/${etcd_version}/etcd-${etcd_version}-linux-amd64.tar.gz"
cfssl_url="${base_url}/cloudflare/cfssl/releases/download/v${cfssl_version}/cfssl_${cfssl_version}_linux_amd64"
cfssljson_url="${base_url}/cloudflare/cfssl/releases/download/v${cfssl_version}/cfssljson_${cfssl_version}_linux_amd64"
helm_url="https://mirrors.huaweicloud.com/helm/v${helm_version}/helm-v${helm_version}-linux-amd64.tar.gz"
kubernetes_server_url="https://cdn.dl.k8s.io/release/v${kubernetes_server_version}/kubernetes-server-linux-amd64.tar.gz"
nginx_url="http://nginx.org/download/nginx-${nginx_version}.tar.gz"
<span class="hljs-meta prompt_">
# </span><span class="bash">Download packages</span>
packages=(
<span class="hljs-meta prompt_">  # </span><span class="bash"><span class="hljs-variable">$kernel_url</span></span>
<span class="hljs-meta prompt_">  $</span><span class="bash">runc_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">docker_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">cni_plugins_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">cri_containerd_cni_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">crictl_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">cri_dockerd_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">etcd_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">cfssl_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">cfssljson_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">helm_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">kubernetes_server_url</span>
<span class="hljs-meta prompt_">  $</span><span class="bash">nginx_url</span>
)

for package_url in "${packages[@]}"; do
  filename=$(basename "$package_url")
  if curl --parallel --parallel-immediate -k -L -C - -o "$filename" "$package_url"; then
    echo "Downloaded $filename"
  else
    echo "Failed to download $filename"
    exit 1
  fi
done
</code></pre>
<h4 data-id="heading-17">1.7.å…³é—­é˜²ç«å¢™</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span>
systemctl disable --now firewalld
</code></pre>
<h4 data-id="heading-18">1.8.å…³é—­SELinux</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span>
setenforce 0
sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config
</code></pre>
<h4 data-id="heading-19">1.9.å…³é—­äº¤æ¢åˆ†åŒº</h4>
<pre><code class="hljs language-shell" lang="shell">sed -ri 's/.*swap.*/#&amp;/' /etc/fstab
swapoff -a &amp;&amp; sysctl -w vm.swappiness=0

cat /etc/fstab
<span class="hljs-meta prompt_"># </span><span class="bash">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span>
</code></pre>
<h4 data-id="heading-20">1.10.ç½‘ç»œé…ç½®ï¼ˆä¿©ç§æ–¹å¼äºŒé€‰ä¸€ï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œï¼ŒCentOS9ä¸æ”¯æŒæ–¹å¼ä¸€</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">æ–¹å¼ä¸€</span>
<span class="hljs-meta prompt_"># </span><span class="bash">systemctl <span class="hljs-built_in">disable</span> --now NetworkManager</span>
<span class="hljs-meta prompt_"># </span><span class="bash">systemctl start network &amp;&amp; systemctl <span class="hljs-built_in">enable</span> network</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">æ–¹å¼äºŒ</span>
cat &gt; /etc/NetworkManager/conf.d/calico.conf &lt;&lt; EOF 
[keyfile]
unmanaged-devices=interface-name:cali*;interface-name:tunl*
EOF
systemctl restart NetworkManager
</code></pre>
<h4 data-id="heading-21">1.11.è¿›è¡Œæ—¶é—´åŒæ­¥</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æœåŠ¡ç«¯</span>
<span class="hljs-meta prompt_"># </span><span class="bash">apt install chrony -y</span>
yum install chrony -y
cat &gt; /etc/chrony.conf &lt;&lt; EOF 
pool ntp.aliyun.com iburst
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync
allow 192.168.1.0/24
local stratum 10
keyfile /etc/chrony.keys
leapsectz right/UTC
logdir /var/log/chrony
EOF

systemctl restart chronyd ; systemctl enable chronyd
<span class="hljs-meta prompt_">
# </span><span class="bash">å®¢æˆ·ç«¯</span>
<span class="hljs-meta prompt_"># </span><span class="bash">apt install chrony -y</span>
yum install chrony -y
cat &gt; /etc/chrony.conf &lt;&lt; EOF 
pool 192.168.1.31 iburst
driftfile /var/lib/chrony/drift
makestep 1.0 3
rtcsync
keyfile /etc/chrony.keys
leapsectz right/UTC
logdir /var/log/chrony
EOF

systemctl restart chronyd ; systemctl enable chronyd
<span class="hljs-meta prompt_">
#</span><span class="bash">ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡ŒéªŒè¯</span>
chronyc sources -v
</code></pre>
<h4 data-id="heading-22">1.12.é…ç½®ulimit</h4>
<pre><code class="hljs language-shell" lang="shell">ulimit -SHn 65535
cat &gt;&gt; /etc/security/limits.conf &lt;&lt;EOF
* soft nofile 655360
* hard nofile 131072
* soft nproc 655350
* hard nproc 655350
* seft memlock unlimited
* hard memlock unlimitedd
EOF
</code></pre>
<h4 data-id="heading-23">1.13.é…ç½®å…å¯†ç™»å½•</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">apt install -y sshpass</span>
yum install -y sshpass
ssh-keygen -f /root/.ssh/id_rsa -P ''
export IP="192.168.1.31 192.168.1.32 192.168.1.33 192.168.1.34 192.168.1.35"
export SSHPASS=123123
for HOST in $IP;do
     sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $HOST
done
</code></pre>
<h4 data-id="heading-24">1.14.æ·»åŠ å¯ç”¨æº</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¸º RHEL-9æˆ– CentOS-9é…ç½®æº</span>
yum install https://www.elrepo.org/elrepo-release-9.el9.elrepo.noarch.rpm -y 
sed -i "s@mirrorlist@#mirrorlist@g" /etc/yum.repos.d/elrepo.repo 
sed -i "s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g" /etc/yum.repos.d/elrepo.repo 
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¸º RHEL-8æˆ– CentOS-8é…ç½®æº</span>
yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm -y 
sed -i "s@mirrorlist@#mirrorlist@g" /etc/yum.repos.d/elrepo.repo 
sed -i "s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g" /etc/yum.repos.d/elrepo.repo 
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¸º RHEL-7 SL-7 æˆ– CentOS-7 å®‰è£… ELRepo</span> 
yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm -y 
sed -i "s@mirrorlist@#mirrorlist@g" /etc/yum.repos.d/elrepo.repo 
sed -i "s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g" /etc/yum.repos.d/elrepo.repo 
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹å¯ç”¨å®‰è£…åŒ…</span>
yum  --disablerepo="*"  --enablerepo="elrepo-kernel"  list  available
</code></pre>
<h4 data-id="heading-25">1.15.å‡çº§å†…æ ¸è‡³4.18ç‰ˆæœ¬ä»¥ä¸Š</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Ubuntuå¿½ç•¥ï¼ŒCentOSæ‰§è¡Œ</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">å®‰è£…æœ€æ–°çš„å†…æ ¸</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯ç¨³å®šç‰ˆkernel-ml   å¦‚éœ€æ›´æ–°é•¿æœŸç»´æŠ¤ç‰ˆæœ¬kernel-lt</span>  
yum -y --enablerepo=elrepo-kernel  install  kernel-ml
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹å·²å®‰è£…é‚£äº›å†…æ ¸</span>
rpm -qa | grep kernel
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹é»˜è®¤å†…æ ¸</span>
grubby --default-kernel
<span class="hljs-meta prompt_">
# </span><span class="bash">è‹¥ä¸æ˜¯æœ€æ–°çš„ä½¿ç”¨å‘½ä»¤è®¾ç½®</span>
grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo)
<span class="hljs-meta prompt_">
# </span><span class="bash">é‡å¯ç”Ÿæ•ˆ</span>
reboot
<span class="hljs-meta prompt_">
# </span><span class="bash">v8 æ•´åˆå‘½ä»¤ä¸ºï¼š</span>
yum install https://www.elrepo.org/elrepo-release-9.el9.elrepo.noarch.rpm -y ; sed -i "s@mirrorlist@#mirrorlist@g" /etc/yum.repos.d/elrepo.repo ; sed -i "s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g" /etc/yum.repos.d/elrepo.repo ; yum  --disablerepo="*"  --enablerepo="elrepo-kernel"  list  available -y ; yum  --enablerepo=elrepo-kernel  install kernel-lt -y ; grubby --default-kernel ; reboot 
<span class="hljs-meta prompt_">
# </span><span class="bash">v8 æ•´åˆå‘½ä»¤ä¸ºï¼š</span>
yum install https://www.elrepo.org/elrepo-release-8.el8.elrepo.noarch.rpm -y ; sed -i "s@mirrorlist@#mirrorlist@g" /etc/yum.repos.d/elrepo.repo ; sed -i "s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g" /etc/yum.repos.d/elrepo.repo ; yum  --disablerepo="*"  --enablerepo="elrepo-kernel"  list  available -y ; yum  --enablerepo=elrepo-kernel  install kernel-lt -y ; grubby --default-kernel ; reboot 
<span class="hljs-meta prompt_">
# </span><span class="bash">v7 æ•´åˆå‘½ä»¤ä¸ºï¼š</span>
yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm -y ; sed -i "s@mirrorlist@#mirrorlist@g" /etc/yum.repos.d/elrepo.repo ; sed -i "s@elrepo.org/linux@mirrors.tuna.tsinghua.edu.cn/elrepo@g" /etc/yum.repos.d/elrepo.repo ; yum  --disablerepo="*"  --enablerepo="elrepo-kernel"  list  available -y ; yum  --enablerepo=elrepo-kernel  install  kernel-lt -y ; grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo) ; grubby --default-kernel ; reboot 
<span class="hljs-meta prompt_">
# </span><span class="bash">ç¦»çº¿ç‰ˆæœ¬</span> 
yum install -y /root/cby/kernel-lt-*-1.el7.elrepo.x86_64.rpm ; grubby --set-default $(ls /boot/vmlinuz-* | grep elrepo) ; grubby --default-kernel ; reboot 
</code></pre>
<h4 data-id="heading-26">1.16.å®‰è£…ipvsadm</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å¯¹äºCentOS7ç¦»çº¿å®‰è£…</span>
<span class="hljs-meta prompt_"># </span><span class="bash">yum install /root/centos7/ipset-*.el7.x86_64.rpm /root/centos7/lm_sensors-libs-*.el7.x86_64.rpm  /root/centos7/ipset-libs-*.el7.x86_64.rpm /root/centos7/sysstat-*.el7_9.x86_64.rpm  /root/centos7/ipvsadm-*.el7.x86_64.rpm  -y</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯¹äº Ubuntu</span>
<span class="hljs-meta prompt_"># </span><span class="bash">apt install ipvsadm ipset sysstat conntrack -y</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯¹äº CentOS</span>
yum install ipvsadm ipset sysstat conntrack libseccomp -y
cat &gt;&gt; /etc/modules-load.d/ipvs.conf &lt;&lt;EOF 
ip_vs
ip_vs_rr
ip_vs_wrr
ip_vs_sh
nf_conntrack
ip_tables
ip_set
xt_set
ipt_set
ipt_rpfilter
ipt_REJECT
ipip
EOF

systemctl restart systemd-modules-load.service

lsmod | grep -e ip_vs -e nf_conntrack
ip_vs_sh               16384  0
ip_vs_wrr              16384  0
ip_vs_rr               16384  0
ip_vs                 237568  6 ip_vs_rr,ip_vs_sh,ip_vs_wrr
nf_conntrack          217088  3 nf_nat,nft_ct,ip_vs
nf_defrag_ipv6         24576  2 nf_conntrack,ip_vs
nf_defrag_ipv4         16384  1 nf_conntrack
libcrc32c              16384  5 nf_conntrack,nf_nat,nf_tables,xfs,ip_vs

</code></pre>
<h4 data-id="heading-27">1.17.ä¿®æ”¹å†…æ ¸å‚æ•°</h4>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf
net.ipv4.ip_forward = 1
net.bridge.bridge-nf-call-iptables = 1
fs.may_detach_mounts = 1
vm.overcommit_memory=1
vm.panic_on_oom=0
fs.inotify.max_user_watches=89100
fs.file-max=52706963
fs.nr_open=52706963
net.netfilter.nf_conntrack_max=2310720

net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_probes = 3
net.ipv4.tcp_keepalive_intvl =15
net.ipv4.tcp_max_tw_buckets = 36000
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_max_orphans = 327680
net.ipv4.tcp_orphan_retries = 3
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 16384
net.ipv4.ip_conntrack_max = 65536
net.ipv4.tcp_max_syn_backlog = 16384
net.ipv4.tcp_timestamps = 0
net.core.somaxconn = 16384

net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
net.ipv6.conf.all.forwarding = 1
EOF

sysctl --system
</code></pre>
<h4 data-id="heading-28">1.18.æ‰€æœ‰èŠ‚ç‚¹é…ç½®hostsæœ¬åœ°è§£æ</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /etc/hosts &lt;&lt;EOF
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

192.168.1.31 k8s-master01
192.168.1.32 k8s-master02
192.168.1.33 k8s-master03
192.168.1.34 k8s-node01
192.168.1.35 k8s-node02
192.168.1.36 lb-vip

fc00::31 k8s-master01
fc00::32 k8s-master02
fc00::33 k8s-master03
fc00::34 k8s-node01
fc00::35 k8s-node02
EOF
</code></pre>
<h2 data-id="heading-29">2.k8såŸºæœ¬ç»„ä»¶å®‰è£…</h2>
<p><strong>æ³¨æ„ ï¼š 2.1 å’Œ 2.2 äºŒé€‰å…¶ä¸€å³å¯</strong></p>
<h3 data-id="heading-30">2.1.å®‰è£…Containerdä½œä¸ºRuntime</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/containernetworking/plugins/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget https://github.com/containernetworking/plugins/releases/download/v1.7.1/cni-plugins-linux-amd64-v1.7.1.tgz</span>

cd cby/
<span class="hljs-meta prompt_">
#</span><span class="bash">åˆ›å»ºcniæ’ä»¶æ‰€éœ€ç›®å½•</span>
mkdir -p /etc/cni/net.d /opt/cni/bin 
<span class="hljs-meta prompt_">#</span><span class="bash">è§£å‹cniäºŒè¿›åˆ¶åŒ…</span>
tar xf cni-plugins-linux-amd64-v*.tgz -C /opt/cni/bin/
<span class="hljs-meta prompt_">
# </span><span class="bash">https://github.com/containerd/containerd/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget https://github.com/containerd/containerd/releases/download/v2.0.5/containerd-2.0.5-linux-amd64.tar.gz</span>
<span class="hljs-meta prompt_">
#</span><span class="bash">è§£å‹</span>
tar -xzf containerd-*-linux-amd64.tar.gz -C /usr/local/
<span class="hljs-meta prompt_">
#</span><span class="bash">åˆ›å»ºæœåŠ¡å¯åŠ¨æ–‡ä»¶</span>
cat &gt; /etc/systemd/system/containerd.service &lt;&lt;EOF
[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target local-fs.target

[Service]
ExecStartPre=-/sbin/modprobe overlay
ExecStart=/usr/local/bin/containerd
Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5
LimitNPROC=infinity
LimitCORE=infinity
LimitNOFILE=infinity
TasksMax=infinity
OOMScoreAdjust=-999

[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<h4 data-id="heading-31">2.1.1é…ç½®Containerdæ‰€éœ€çš„æ¨¡å—</h4>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
overlay
br_netfilter
EOF
</code></pre>
<h4 data-id="heading-32">2.1.2åŠ è½½æ¨¡å—</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl restart systemd-modules-load.service
</code></pre>
<h4 data-id="heading-33">2.1.3é…ç½®Containerdæ‰€éœ€çš„å†…æ ¸</h4>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
net.bridge.bridge-nf-call-iptables  = 1
net.ipv4.ip_forward                 = 1
net.bridge.bridge-nf-call-ip6tables = 1
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">åŠ è½½å†…æ ¸</span>
sysctl --system
</code></pre>
<h4 data-id="heading-34">2.1.4åˆ›å»ºContainerdçš„é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶</span>
mkdir -p /etc/containerd
containerd config default | tee /etc/containerd/config.toml
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¿®æ”¹Containerdçš„é…ç½®æ–‡ä»¶</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">sed -i <span class="hljs-string">"s#SystemdCgroup\ \=\ false#SystemdCgroup\ \=\ true#g"</span> /etc/containerd/config.toml</span>
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">cat</span> /etc/containerd/config.toml | grep SystemdCgroup</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">æ²™ç®±pauseé•œåƒ</span>
sed -i "s#registry.k8s.io#registry.aliyuncs.com/chenby#g" /etc/containerd/config.toml
cat /etc/containerd/config.toml | grep sandbox
<span class="hljs-meta prompt_">
# </span><span class="bash">é…ç½®åŠ é€Ÿå™¨</span>
[root@k8s-master01 ~]# vim /etc/containerd/config.toml
[root@k8s-master01 ~]# cat /etc/containerd/config.toml | grep certs.d -C 5

    [plugins.'io.containerd.cri.v1.images'.pinned_images]
      sandbox = 'registry.aliyuncs.com/chenby/pause:3.10'

    [plugins.'io.containerd.cri.v1.images'.registry]
      config_path = '/etc/containerd/certs.d'

    [plugins.'io.containerd.cri.v1.images'.image_decryption]
      key_model = 'node'

  [plugins.'io.containerd.cri.v1.runtime']
[root@k8s-master01 ~]# 


mkdir /etc/containerd/certs.d/docker.io -pv
cat &gt; /etc/containerd/certs.d/docker.io/hosts.toml &lt;&lt; EOF
server = "https://docker.io"
[host."https://jockerhub.com"]
  capabilities = ["pull", "resolve"]
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">é…ç½® GFW ä»£ç†</span>
mkdir -p /etc/systemd/system/containerd.service.d
touch /etc/systemd/system/containerd.service.d/http-proxy.conf
tee /etc/systemd/system/containerd.service.d/http-proxy.conf &lt;&lt; EOF
[Service]
Environment="HTTP_PROXY=http://IP:Port"
Environment="HTTPS_PROXY=http://IP:Port"
Environment="NO_PROXY=localhost,127.0.0.1,containerd"
EOF
</code></pre>
<h4 data-id="heading-35">2.1.5å¯åŠ¨å¹¶è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now containerd.service
systemctl stop containerd.service
systemctl start containerd.service
systemctl restart containerd.service
systemctl status containerd.service
</code></pre>
<h4 data-id="heading-36">2.1.6é…ç½®crictlå®¢æˆ·ç«¯è¿æ¥çš„è¿è¡Œæ—¶ä½ç½®</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/kubernetes-sigs/cri-tools/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.35.0/crictl-v1.35.0-linux-amd64.tar.gz</span>
<span class="hljs-meta prompt_">
#</span><span class="bash">è§£å‹</span>
tar xf crictl-v*-linux-amd64.tar.gz -C /usr/bin/
<span class="hljs-meta prompt_">#</span><span class="bash">ç”Ÿæˆé…ç½®æ–‡ä»¶</span>
cat &gt; /etc/crictl.yaml &lt;&lt;EOF
runtime-endpoint: unix:///run/containerd/containerd.sock
image-endpoint: unix:///run/containerd/containerd.sock
timeout: 10
debug: false
EOF
<span class="hljs-meta prompt_">
#</span><span class="bash">æµ‹è¯•</span>
systemctl restart  containerd
crictl info
</code></pre>
<h3 data-id="heading-37">2.2 å®‰è£…dockerä½œä¸ºRuntime</h3>
<h4 data-id="heading-38">2.2.1 è§£å‹dockerç¨‹åº</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">äºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€ï¼šhttps://download.docker.com/linux/static/stable/x86_64/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget https://mirrors.ustc.edu.cn/docker-ce/linux/static/stable/x86_64/docker-27.4.0.tgz</span>
<span class="hljs-meta prompt_">
#</span><span class="bash">è§£å‹</span>
tar xf docker-*.tgz 
<span class="hljs-meta prompt_">#</span><span class="bash">æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶</span>
cp docker/* /usr/bin/
</code></pre>
<h4 data-id="heading-39">2.2.2 åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">åˆ›å»ºcontainerdçš„serviceæ–‡ä»¶,å¹¶ä¸”å¯åŠ¨</span>
cat &gt;/etc/systemd/system/containerd.service &lt;&lt;EOF
[Unit]
Description=containerd container runtime
Documentation=https://containerd.io
After=network.target local-fs.target

[Service]
ExecStartPre=-/sbin/modprobe overlay
ExecStart=/usr/bin/containerd
Type=notify
Delegate=yes
KillMode=process
Restart=always
RestartSec=5
LimitNPROC=infinity
LimitCORE=infinity
LimitNOFILE=1048576
TasksMax=infinity
OOMScoreAdjust=-999

[Install]
WantedBy=multi-user.target
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®å¼€æœºè‡ªå¯</span>
systemctl enable --now containerd.service
</code></pre>
<h4 data-id="heading-40">2.2.3 å‡†å¤‡dockerçš„serviceæ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">å‡†å¤‡dockerçš„serviceæ–‡ä»¶</span>
cat &gt; /etc/systemd/system/docker.service &lt;&lt;EOF
[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service containerd.service
Wants=network-online.target
Requires=containerd.service

[Service]
Type=notify
ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock
ExecReload=/bin/kill -s HUP $MAINPID
TimeoutSec=0
RestartSec=2
Restart=always
StartLimitBurst=3
StartLimitInterval=60s
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity
Delegate=yes
KillMode=process
OOMScoreAdjust=-500

[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<h4 data-id="heading-41">2.2.4 å‡†å¤‡dockerçš„socketæ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">å‡†å¤‡dockerçš„socketæ–‡ä»¶</span>
cat &gt; /etc/systemd/system/docker.socket &lt;&lt;EOF
[Unit]
Description=Docker Socket for the API

[Socket]
ListenStream=/var/run/docker.sock
SocketMode=0660
SocketUser=root
SocketGroup=docker

[Install]
WantedBy=sockets.target
EOF
</code></pre>
<h4 data-id="heading-42">2.2.5 é…ç½®åŠ é€Ÿå™¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">é…ç½®åŠ é€Ÿå™¨</span>
mkdir /etc/docker/ -pv
cat &gt;/etc/docker/daemon.json &lt;&lt;EOF
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "registry-mirrors": [
    "https://jockerhub.com"
  ],
  "max-concurrent-downloads": 10,
  "log-driver": "json-file",
  "log-level": "warn",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
    },
  "data-root": "/var/lib/docker",
  "proxies": {
    "http-proxy": "http://192.168.1.100:7890",
    "https-proxy": "http://192.168.1.100:7890",
    "no-proxy": "localhost"
  }
}
EOF
</code></pre>
<h4 data-id="heading-43">2.2.6 å¯åŠ¨docker</h4>
<pre><code class="hljs language-shell" lang="shell">groupadd docker
systemctl daemon-reload
systemctl enable --now docker.service
systemctl enable --now docker.socket
systemctl stop docker.service
systemctl start docker.service
systemctl restart docker.service
systemctl status docker.service
docker info
</code></pre>
<h4 data-id="heading-44">2.2.7 è§£å‹cri-docker</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ç”±äº1.24ä»¥åŠæ›´é«˜ç‰ˆæœ¬ä¸æ”¯æŒdockeræ‰€ä»¥å®‰è£…cri-docker</span>
<span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹è½½cri-docker</span> 
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/Mirantis/cri-dockerd/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget  https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.16/cri-dockerd-0.3.16.amd64.tgz</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">è§£å‹cri-docker</span>
tar xvf cri-dockerd-*.amd64.tgz 
cp -r cri-dockerd/  /usr/bin/
chmod +x /usr/bin/cri-dockerd/cri-dockerd
</code></pre>
<h4 data-id="heading-45">2.2.8 å†™å…¥å¯åŠ¨cri-dockeré…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶</span>
cat &gt;  /usr/lib/systemd/system/cri-docker.service &lt;&lt;EOF
[Unit]
Description=CRI Interface for Docker Application Container Engine
Documentation=https://docs.mirantis.com
After=network-online.target firewalld.service docker.service
Wants=network-online.target
Requires=docker.service

[Service]
Type=notify
ExecStart=/usr/bin/cri-dockerd/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7
ExecReload=/bin/kill -s HUP $MAINPID
TimeoutSec=0
RestartSec=5
Restart=always
StartLimitBurst=5
StartLimitInterval=60s
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity
Delegate=yes
KillMode=process

[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<h4 data-id="heading-46">2.2.9 å†™å…¥cri-dockerçš„socketé…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å†™å…¥socketé…ç½®æ–‡ä»¶</span>
cat &gt; /usr/lib/systemd/system/cri-docker.socket &lt;&lt;EOF
[Unit]
Description=CRI Docker Socket for the API
PartOf=cri-docker.service

[Socket]
ListenStream=%t/cri-dockerd.sock
SocketMode=0660
SocketUser=root
SocketGroup=docker

[Install]
WantedBy=sockets.target
EOF
</code></pre>
<h4 data-id="heading-47">2.2.10 å¯åŠ¨cri-docker</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now cri-docker.service
systemctl restart cri-docker.service
systemctl status cri-docker.service
</code></pre>
<h3 data-id="heading-48">2.3.k8sä¸etcdä¸‹è½½åŠå®‰è£…ï¼ˆä»…åœ¨master01æ“ä½œï¼‰</h3>
<h4 data-id="heading-49">2.3.1è§£å‹k8så®‰è£…åŒ…</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹è½½å®‰è£…åŒ…</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/etcd-io/etcd/releases/</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/kubernetes/kubernetes/tree/master/CHANGELOG</span>
<span class="hljs-meta prompt_"># </span><span class="bash">
<span class="hljs-comment"># wget https://github.com/etcd-io/etcd/releases/download/v3.5.21/etcd-v3.5.21-linux-amd64.tar.gz</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget https://cdn.dl.k8s.io/release/v1.35.0/kubernetes-server-linux-amd64.tar.gz</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">è§£å‹k8så®‰è£…æ–‡ä»¶</span>
cd cby
tar -xf kubernetes-server-linux-amd64.tar.gz  --strip-components=3 -C /usr/local/bin kubernetes/server/bin/kube{let,ctl,-apiserver,-controller-manager,-scheduler,-proxy}
<span class="hljs-meta prompt_">
# </span><span class="bash">è§£å‹etcdå®‰è£…æ–‡ä»¶</span>
tar -xf etcd*.tar.gz &amp;&amp; mv etcd-*/etcd /usr/local/bin/ &amp;&amp; mv etcd-*/etcdctl /usr/local/bin/
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹/usr/local/binä¸‹å†…å®¹</span>
[root@localhost cby]# ll /usr/local/bin/
æ€»ç”¨é‡ 398984
-rwxr-xr-x 1 1000 docker 26087608 12æœˆ 18 03:41 etcd
-rwxr-xr-x 1 1000 docker 17207480 12æœˆ 18 03:41 etcdctl
-rwxr-xr-x 1 root root   85766328 12æœˆ 17 20:56 kube-apiserver
-rwxr-xr-x 1 root root   71815352 12æœˆ 17 20:56 kube-controller-manager
-rwxr-xr-x 1 root root   58597560 12æœˆ 17 20:56 kubectl
-rwxr-xr-x 1 root root   58110244 12æœˆ 17 20:56 kubelet
-rwxr-xr-x 1 root root   43258040 12æœˆ 17 20:56 kube-proxy
-rwxr-xr-x 1 root root   47685816 12æœˆ 17 20:56 kube-scheduler
[root@localhost cby]# 

</code></pre>
<h4 data-id="heading-50">2.3.2æŸ¥çœ‹ç‰ˆæœ¬</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]#  kubelet --version
Kubernetes v1.35.0
[root@k8s-master01 ~]# etcdctl version
etcdctl version: 3.6.7
API version: 3.6
[root@k8s-master01 ~]# 
</code></pre>
<h4 data-id="heading-51">2.3.3å°†ç»„ä»¶å‘é€è‡³å…¶ä»–k8sèŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell">Master='k8s-master02 k8s-master03'
Work='k8s-node01 k8s-node02'
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‹·è´masterç»„ä»¶</span>
for NODE in $Master; do echo $NODE; scp /usr/local/bin/kube{let,ctl,-apiserver,-controller-manager,-scheduler,-proxy} $NODE:/usr/local/bin/; scp /usr/local/bin/etcd* $NODE:/usr/local/bin/; done
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‹·è´workç»„ä»¶</span>
for NODE in $Work; do echo $NODE; scp /usr/local/bin/kube{let,-proxy} $NODE:/usr/local/bin/ ; done
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œ</span>
mkdir -p /opt/cni/bin
</code></pre>
<h3 data-id="heading-52">2.3åˆ›å»ºè¯ä¹¦ç›¸å…³æ–‡ä»¶</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¯·æŸ¥çœ‹Githubä»“åº“ æˆ–è€…è¿›è¡Œè·å–å·²ç»æ‰“å¥½çš„åŒ…</span>
<span class="hljs-meta prompt_"># </span><span class="bash">å¯ä»¥æ ¹æ®ä¸‹æ–‡3.xè¿›è¡Œæ‰‹åŠ¨éƒ¨ç½²æ“ä½œ</span> 
https://github.com/cby-chen/Kubernetes/
https://github.com/cby-chen/Kubernetes/tags
https://github.com/cby-chen/Kubernetes/releases/download/v1.35.0/kubernetes-v1.35.0.tar
</code></pre>
<h2 data-id="heading-53">3.ç›¸å…³è¯ä¹¦ç”Ÿæˆ</h2>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">master01èŠ‚ç‚¹ä¸‹è½½è¯ä¹¦ç”Ÿæˆå·¥å…·</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget <span class="hljs-string">"https://github.com/cloudflare/cfssl/releases/download/v1.6.5/cfssl_1.6.5_linux_amd64"</span> -O /usr/local/bin/cfssl</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget <span class="hljs-string">"https://github.com/cloudflare/cfssl/releases/download/v1.6.5/cfssljson_1.6.5_linux_amd64"</span> -O /usr/local/bin/cfssljson</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">è½¯ä»¶åŒ…å†…æœ‰</span>
cp cfssl_*_linux_amd64 /usr/local/bin/cfssl
cp cfssljson_*_linux_amd64 /usr/local/bin/cfssljson
<span class="hljs-meta prompt_">
# </span><span class="bash">æ·»åŠ æ‰§è¡Œæƒé™</span>
chmod +x /usr/local/bin/cfssl /usr/local/bin/cfssljson
</code></pre>
<h3 data-id="heading-54">3.1.ç”Ÿæˆetcdè¯ä¹¦</h3>
<p>ç‰¹åˆ«è¯´æ˜é™¤å¤–ï¼Œä»¥ä¸‹æ“ä½œåœ¨æ‰€æœ‰masterèŠ‚ç‚¹æ“ä½œ</p>
<h4 data-id="heading-55">3.1.1æ‰€æœ‰masterèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½•</h4>
<pre><code class="hljs language-shell" lang="shell">mkdir /etc/etcd/ssl -p
</code></pre>
<h4 data-id="heading-56">3.1.2master01èŠ‚ç‚¹ç”Ÿæˆetcdè¯ä¹¦</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å†™å…¥ç”Ÿæˆè¯ä¹¦æ‰€éœ€çš„é…ç½®æ–‡ä»¶</span>
cat &gt; ca-config.json &lt;&lt; EOF 
{
  "signing": {
    "default": {
      "expiry": "876000h"
    },
    "profiles": {
      "kubernetes": {
        "usages": [
            "signing",
            "key encipherment",
            "server auth",
            "client auth"
        ],
        "expiry": "876000h"
      }
    }
  }
}
EOF

cat &gt; etcd-ca-csr.json  &lt;&lt; EOF 
{
  "CN": "etcd",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "etcd",
      "OU": "Etcd Security"
    }
  ],
  "ca": {
    "expiry": "876000h"
  }
}
EOF
<span class="hljs-meta prompt_"># </span><span class="bash">ç”Ÿæˆetcdè¯ä¹¦å’Œetcdè¯ä¹¦çš„keyï¼ˆå¦‚æœä½ è§‰å¾—ä»¥åå¯èƒ½ä¼šæ‰©å®¹ï¼Œå¯ä»¥åœ¨ipé‚£å¤šå†™å‡ ä¸ªé¢„ç•™å‡ºæ¥ï¼‰</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥æ²¡æœ‰IPv6 å¯åˆ é™¤å¯ä¿ç•™</span> 

cfssl gencert -initca etcd-ca-csr.json | cfssljson -bare /etc/etcd/ssl/etcd-ca

cat &gt; etcd-csr.json &lt;&lt; EOF 
{
  "CN": "etcd",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "etcd",
      "OU": "Etcd Security"
    }
  ]
}
EOF


cfssl gencert \
   -ca=/etc/etcd/ssl/etcd-ca.pem \
   -ca-key=/etc/etcd/ssl/etcd-ca-key.pem \
   -config=ca-config.json \
   -hostname=127.0.0.1,k8s-master01,k8s-master02,k8s-master03,192.168.1.31,192.168.1.32,192.168.1.33,::1 \
   -profile=kubernetes \
   etcd-csr.json | cfssljson -bare /etc/etcd/ssl/etcd
</code></pre>
<h4 data-id="heading-57">3.1.3å°†è¯ä¹¦å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell">Master='k8s-master02 k8s-master03'
for NODE in $Master; do ssh $NODE "mkdir -p /etc/etcd/ssl"; for FILE in etcd-ca-key.pem  etcd-ca.pem  etcd-key.pem  etcd.pem; do scp /etc/etcd/ssl/${FILE} $NODE:/etc/etcd/ssl/${FILE}; done; done
</code></pre>
<h3 data-id="heading-58">3.2.ç”Ÿæˆk8sç›¸å…³è¯ä¹¦</h3>
<p>ç‰¹åˆ«è¯´æ˜é™¤å¤–ï¼Œä»¥ä¸‹æ“ä½œåœ¨æ‰€æœ‰masterèŠ‚ç‚¹æ“ä½œ</p>
<h4 data-id="heading-59">3.2.1 æ‰€æœ‰k8sèŠ‚ç‚¹åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½•</h4>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /etc/kubernetes/pki
</code></pre>
<h4 data-id="heading-60">3.2.2 master01èŠ‚ç‚¹ç”Ÿæˆk8sè¯ä¹¦</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å†™å…¥ç”Ÿæˆè¯ä¹¦æ‰€éœ€çš„é…ç½®æ–‡ä»¶</span>
cat &gt; ca-csr.json   &lt;&lt; EOF 
{
  "CN": "kubernetes",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "Kubernetes",
      "OU": "Kubernetes-manual"
    }
  ],
  "ca": {
    "expiry": "876000h"
  }
}
EOF


cfssl gencert -initca ca-csr.json | cfssljson -bare /etc/kubernetes/pki/ca

cat &gt; apiserver-csr.json &lt;&lt; EOF 
{
  "CN": "kube-apiserver",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "Kubernetes",
      "OU": "Kubernetes-manual"
    }
  ]
}
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">ç”Ÿæˆä¸€ä¸ªæ ¹è¯ä¹¦ ï¼Œå¤šå†™äº†ä¸€äº›IPä½œä¸ºé¢„ç•™IPï¼Œä¸ºå°†æ¥æ·»åŠ nodeåšå‡†å¤‡</span>
<span class="hljs-meta prompt_"># </span><span class="bash">10.96.0.1æ˜¯serviceç½‘æ®µçš„ç¬¬ä¸€ä¸ªåœ°å€ï¼Œéœ€è¦è®¡ç®—ï¼Œ192.168.1.36ä¸ºé«˜å¯ç”¨vipåœ°å€</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥æ²¡æœ‰IPv6 å¯åˆ é™¤å¯ä¿ç•™</span> 

cfssl gencert   \
-ca=/etc/kubernetes/pki/ca.pem   \
-ca-key=/etc/kubernetes/pki/ca-key.pem   \
-config=ca-config.json   \
-hostname=10.96.0.1,192.168.1.36,127.0.0.1,kubernetes,kubernetes.default,kubernetes.default.svc,kubernetes.default.svc.cluster,kubernetes.default.svc.cluster.local,x.oiox.cn,z.oiox.cn,192.168.1.31,192.168.1.32,192.168.1.33,192.168.1.34,192.168.1.35,192.168.1.36,192.168.1.37,192.168.1.38,192.168.1.39,192.168.1.40,::1   \
-profile=kubernetes   apiserver-csr.json | cfssljson -bare /etc/kubernetes/pki/apiserver
</code></pre>
<h4 data-id="heading-61">3.2.3 ç”Ÿæˆapiserverèšåˆè¯ä¹¦</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; front-proxy-ca-csr.json  &lt;&lt; EOF 
{
  "CN": "kubernetes",
  "key": {
     "algo": "rsa",
     "size": 2048
  },
  "ca": {
    "expiry": "876000h"
  }
}
EOF

cfssl gencert   -initca front-proxy-ca-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-ca 

cat &gt; front-proxy-client-csr.json  &lt;&lt; EOF 
{
  "CN": "front-proxy-client",
  "key": {
     "algo": "rsa",
     "size": 2048
  }
}
EOF

cfssl gencert  \
-ca=/etc/kubernetes/pki/front-proxy-ca.pem   \
-ca-key=/etc/kubernetes/pki/front-proxy-ca-key.pem   \
-config=ca-config.json   \
-profile=kubernetes   front-proxy-client-csr.json | cfssljson -bare /etc/kubernetes/pki/front-proxy-client
</code></pre>
<h4 data-id="heading-62">3.2.4 ç”Ÿæˆcontroller-manageçš„è¯ä¹¦</h4>
<p>åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ
è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º <code>--server=https://192.168.1.36:9443</code>
è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º <code>--server=https://127.0.0.1:8443</code></p>
<pre><code class="hljs language-shell" lang="shell">cat &gt; manager-csr.json &lt;&lt; EOF 
{
  "CN": "system:kube-controller-manager",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "system:kube-controller-manager",
      "OU": "Kubernetes-manual"
    }
  ]
}
EOF


cfssl gencert \
   -ca=/etc/kubernetes/pki/ca.pem \
   -ca-key=/etc/kubernetes/pki/ca-key.pem \
   -config=ca-config.json \
   -profile=kubernetes \
   manager-csr.json | cfssljson -bare /etc/kubernetes/pki/controller-manager
<span class="hljs-meta prompt_">

# </span><span class="bash">è®¾ç½®ä¸€ä¸ªé›†ç¾¤é¡¹</span>
<span class="hljs-meta prompt_"># </span><span class="bash">åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º `--server=https://192.168.1.36:9443`</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º `--server=https://127.0.0.1:8443`</span>
kubectl config set-cluster kubernetes \
     --certificate-authority=/etc/kubernetes/pki/ca.pem \
     --embed-certs=true \
     --server=https://127.0.0.1:8443 \
     --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®ä¸€ä¸ªç¯å¢ƒé¡¹ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡</span>
kubectl config set-context system:kube-controller-manager@kubernetes \
    --cluster=kubernetes \
    --user=system:kube-controller-manager \
    --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig
<span class="hljs-meta prompt_">
  # </span><span class="bash">è®¾ç½®ä¸€ä¸ªç”¨æˆ·é¡¹</span>
kubectl config set-credentials system:kube-controller-manager \
   --client-certificate=/etc/kubernetes/pki/controller-manager.pem \
   --client-key=/etc/kubernetes/pki/controller-manager-key.pem \
   --embed-certs=true \
   --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®é»˜è®¤ç¯å¢ƒ</span>
kubectl config use-context system:kube-controller-manager@kubernetes \
     --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig

</code></pre>
<h4 data-id="heading-63">3.2.5 ç”Ÿæˆkube-schedulerçš„è¯ä¹¦</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; scheduler-csr.json &lt;&lt; EOF 
{
  "CN": "system:kube-scheduler",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "system:kube-scheduler",
      "OU": "Kubernetes-manual"
    }
  ]
}
EOF


cfssl gencert \
   -ca=/etc/kubernetes/pki/ca.pem \
   -ca-key=/etc/kubernetes/pki/ca-key.pem \
   -config=ca-config.json \
   -profile=kubernetes \
   scheduler-csr.json | cfssljson -bare /etc/kubernetes/pki/scheduler
<span class="hljs-meta prompt_">

# </span><span class="bash">åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º `--server=https://192.168.1.36:9443`</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º `--server=https://127.0.0.1:8443`</span>

kubectl config set-cluster kubernetes \
     --certificate-authority=/etc/kubernetes/pki/ca.pem \
     --embed-certs=true \
     --server=https://127.0.0.1:8443 \
     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig


kubectl config set-credentials system:kube-scheduler \
     --client-certificate=/etc/kubernetes/pki/scheduler.pem \
     --client-key=/etc/kubernetes/pki/scheduler-key.pem \
     --embed-certs=true \
     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig


kubectl config set-context system:kube-scheduler@kubernetes \
     --cluster=kubernetes \
     --user=system:kube-scheduler \
     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig

kubectl config use-context system:kube-scheduler@kubernetes \
     --kubeconfig=/etc/kubernetes/scheduler.kubeconfig
</code></pre>
<h4 data-id="heading-64">3.2.6 ç”Ÿæˆadminçš„è¯ä¹¦é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; admin-csr.json &lt;&lt; EOF 
{
  "CN": "admin",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "system:masters",
      "OU": "Kubernetes-manual"
    }
  ]
}
EOF


cfssl gencert \
   -ca=/etc/kubernetes/pki/ca.pem \
   -ca-key=/etc/kubernetes/pki/ca-key.pem \
   -config=ca-config.json \
   -profile=kubernetes \
   admin-csr.json | cfssljson -bare /etc/kubernetes/pki/admin
<span class="hljs-meta prompt_">
# </span><span class="bash">åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º `--server=https://192.168.1.36:9443`</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º `--server=https://127.0.0.1:8443`</span>

kubectl config set-cluster kubernetes     \
  --certificate-authority=/etc/kubernetes/pki/ca.pem     \
  --embed-certs=true     \
  --server=https://127.0.0.1:8443     \
  --kubeconfig=/etc/kubernetes/admin.kubeconfig

kubectl config set-credentials kubernetes-admin  \
  --client-certificate=/etc/kubernetes/pki/admin.pem     \
  --client-key=/etc/kubernetes/pki/admin-key.pem     \
  --embed-certs=true     \
  --kubeconfig=/etc/kubernetes/admin.kubeconfig

kubectl config set-context kubernetes-admin@kubernetes    \
  --cluster=kubernetes     \
  --user=kubernetes-admin     \
  --kubeconfig=/etc/kubernetes/admin.kubeconfig

kubectl config use-context kubernetes-admin@kubernetes  --kubeconfig=/etc/kubernetes/admin.kubeconfig
</code></pre>
<h4 data-id="heading-65">3.2.7 åˆ›å»ºkube-proxyè¯ä¹¦</h4>
<p>åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ
è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º <code>--server=https://192.168.1.36:9443</code>
è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º <code>--server=https://127.0.0.1:8443</code></p>
<pre><code class="hljs language-shell" lang="shell">cat &gt; kube-proxy-csr.json  &lt;&lt; EOF 
{
  "CN": "system:kube-proxy",
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "Beijing",
      "L": "Beijing",
      "O": "system:kube-proxy",
      "OU": "Kubernetes-manual"
    }
  ]
}
EOF

cfssl gencert \
   -ca=/etc/kubernetes/pki/ca.pem \
   -ca-key=/etc/kubernetes/pki/ca-key.pem \
   -config=ca-config.json \
   -profile=kubernetes \
   kube-proxy-csr.json | cfssljson -bare /etc/kubernetes/pki/kube-proxy
<span class="hljs-meta prompt_">
# </span><span class="bash">åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º `--server=https://192.168.1.36:9443`</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º `--server=https://127.0.0.1:8443`</span>

kubectl config set-cluster kubernetes     \
  --certificate-authority=/etc/kubernetes/pki/ca.pem     \
  --embed-certs=true     \
  --server=https://127.0.0.1:8443     \
  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig


kubectl config set-credentials kube-proxy  \
  --client-certificate=/etc/kubernetes/pki/kube-proxy.pem     \
  --client-key=/etc/kubernetes/pki/kube-proxy-key.pem     \
  --embed-certs=true     \
  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig

kubectl config set-context kube-proxy@kubernetes    \
  --cluster=kubernetes     \
  --user=kube-proxy     \
  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig

kubectl config use-context kube-proxy@kubernetes  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig
</code></pre>
<h4 data-id="heading-66">3.2.8 åˆ›å»ºServiceAccount Key â€”â€”secret</h4>
<pre><code class="hljs language-shell" lang="shell">openssl genrsa -out /etc/kubernetes/pki/sa.key 2048
openssl rsa -in /etc/kubernetes/pki/sa.key -pubout -out /etc/kubernetes/pki/sa.pub
</code></pre>
<h4 data-id="heading-67">3.2.9 å°†è¯ä¹¦å‘é€åˆ°å…¶ä»–masterèŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">å…¶ä»–èŠ‚ç‚¹åˆ›å»ºç›®å½•</span>
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">mkdir</span>  /etc/kubernetes/pki/ -p</span>

for NODE in k8s-master02 k8s-master03; do  for FILE in $(ls /etc/kubernetes/pki | grep -v etcd); do  scp /etc/kubernetes/pki/${FILE} $NODE:/etc/kubernetes/pki/${FILE}; done;  for FILE in admin.kubeconfig controller-manager.kubeconfig scheduler.kubeconfig; do  scp /etc/kubernetes/${FILE} $NODE:/etc/kubernetes/${FILE}; done; done
</code></pre>
<h4 data-id="heading-68">3.2.10 æŸ¥çœ‹è¯ä¹¦</h4>
<pre><code class="hljs language-shell" lang="shell">[root@localhost cby]# ll /etc/kubernetes/pki/
æ€»ç”¨é‡ 104
-rw-r--r-- 1 root root 1025 12æœˆ 19 20:22 admin.csr
-rw------- 1 root root 1675 12æœˆ 19 20:22 admin-key.pem
-rw-r--r-- 1 root root 1444 12æœˆ 19 20:22 admin.pem
-rw-r--r-- 1 root root 1415 12æœˆ 19 20:21 apiserver.csr
-rw------- 1 root root 1679 12æœˆ 19 20:21 apiserver-key.pem
-rw-r--r-- 1 root root 1805 12æœˆ 19 20:21 apiserver.pem
-rw-r--r-- 1 root root 1070 12æœˆ 19 20:21 ca.csr
-rw------- 1 root root 1679 12æœˆ 19 20:21 ca-key.pem
-rw-r--r-- 1 root root 1363 12æœˆ 19 20:21 ca.pem
-rw-r--r-- 1 root root 1082 12æœˆ 19 20:21 controller-manager.csr
-rw------- 1 root root 1675 12æœˆ 19 20:21 controller-manager-key.pem
-rw-r--r-- 1 root root 1501 12æœˆ 19 20:21 controller-manager.pem
-rw-r--r-- 1 root root  940 12æœˆ 19 20:21 front-proxy-ca.csr
-rw------- 1 root root 1679 12æœˆ 19 20:21 front-proxy-ca-key.pem
-rw-r--r-- 1 root root 1094 12æœˆ 19 20:21 front-proxy-ca.pem
-rw-r--r-- 1 root root  903 12æœˆ 19 20:21 front-proxy-client.csr
-rw------- 1 root root 1679 12æœˆ 19 20:21 front-proxy-client-key.pem
-rw-r--r-- 1 root root 1188 12æœˆ 19 20:21 front-proxy-client.pem
-rw-r--r-- 1 root root 1045 12æœˆ 19 20:22 kube-proxy.csr
-rw------- 1 root root 1679 12æœˆ 19 20:22 kube-proxy-key.pem
-rw-r--r-- 1 root root 1464 12æœˆ 19 20:22 kube-proxy.pem
-rw------- 1 root root 1704 12æœˆ 19 20:22 sa.key
-rw-r--r-- 1 root root  451 12æœˆ 19 20:22 sa.pub
-rw-r--r-- 1 root root 1058 12æœˆ 19 20:22 scheduler.csr
-rw------- 1 root root 1679 12æœˆ 19 20:22 scheduler-key.pem
-rw-r--r-- 1 root root 1476 12æœˆ 19 20:22 scheduler.pem
[root@localhost cby]# 
<span class="hljs-meta prompt_">


# </span><span class="bash">ä¸€å…±26ä¸ªå°±å¯¹äº†</span>
ls /etc/kubernetes/pki/ |wc -l
26
</code></pre>
<h2 data-id="heading-69">4.k8sç³»ç»Ÿç»„ä»¶é…ç½®</h2>
<h3 data-id="heading-70">4.1.etcdé…ç½®</h3>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-71">4.1.1master01é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /etc/etcd/etcd.config.yml &lt;&lt; EOF 
name: 'k8s-master01'
data-dir: /var/lib/etcd
wal-dir: /var/lib/etcd/wal
snapshot-count: 5000
heartbeat-interval: 100
election-timeout: 1000
quota-backend-bytes: 0
listen-peer-urls: 'https://192.168.1.31:2380'
listen-client-urls: 'https://192.168.1.31:2379,http://127.0.0.1:2379'
max-snapshots: 3
max-wals: 5
cors:
initial-advertise-peer-urls: 'https://192.168.1.31:2380'
advertise-client-urls: 'https://192.168.1.31:2379'
discovery:
discovery-fallback: 'proxy'
discovery-proxy:
discovery-srv:
initial-cluster: 'k8s-master01=https://192.168.1.31:2380,k8s-master02=https://192.168.1.32:2380,k8s-master03=https://192.168.1.33:2380'
initial-cluster-token: 'etcd-k8s-cluster'
initial-cluster-state: 'new'
strict-reconfig-check: false
enable-v2: true
enable-pprof: true
proxy: 'off'
proxy-failure-wait: 5000
proxy-refresh-interval: 30000
proxy-dial-timeout: 1000
proxy-write-timeout: 5000
proxy-read-timeout: 0
client-transport-security:
  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'
  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'
  client-cert-auth: true
  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'
  auto-tls: true
peer-transport-security:
  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'
  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'
  peer-client-cert-auth: true
  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'
  auto-tls: true
debug: false
log-package-levels:
log-outputs: [default]
force-new-cluster: false
EOF
</code></pre>
<h4 data-id="heading-72">4.1.2master02é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /etc/etcd/etcd.config.yml &lt;&lt; EOF 
name: 'k8s-master02'
data-dir: /var/lib/etcd
wal-dir: /var/lib/etcd/wal
snapshot-count: 5000
heartbeat-interval: 100
election-timeout: 1000
quota-backend-bytes: 0
listen-peer-urls: 'https://192.168.1.32:2380'
listen-client-urls: 'https://192.168.1.32:2379,http://127.0.0.1:2379'
max-snapshots: 3
max-wals: 5
cors:
initial-advertise-peer-urls: 'https://192.168.1.32:2380'
advertise-client-urls: 'https://192.168.1.32:2379'
discovery:
discovery-fallback: 'proxy'
discovery-proxy:
discovery-srv:
initial-cluster: 'k8s-master01=https://192.168.1.31:2380,k8s-master02=https://192.168.1.32:2380,k8s-master03=https://192.168.1.33:2380'
initial-cluster-token: 'etcd-k8s-cluster'
initial-cluster-state: 'new'
strict-reconfig-check: false
enable-v2: true
enable-pprof: true
proxy: 'off'
proxy-failure-wait: 5000
proxy-refresh-interval: 30000
proxy-dial-timeout: 1000
proxy-write-timeout: 5000
proxy-read-timeout: 0
client-transport-security:
  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'
  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'
  client-cert-auth: true
  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'
  auto-tls: true
peer-transport-security:
  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'
  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'
  peer-client-cert-auth: true
  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'
  auto-tls: true
debug: false
log-package-levels:
log-outputs: [default]
force-new-cluster: false
EOF
</code></pre>
<h4 data-id="heading-73">4.1.3master03é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /etc/etcd/etcd.config.yml &lt;&lt; EOF 
name: 'k8s-master03'
data-dir: /var/lib/etcd
wal-dir: /var/lib/etcd/wal
snapshot-count: 5000
heartbeat-interval: 100
election-timeout: 1000
quota-backend-bytes: 0
listen-peer-urls: 'https://192.168.1.33:2380'
listen-client-urls: 'https://192.168.1.33:2379,http://127.0.0.1:2379'
max-snapshots: 3
max-wals: 5
cors:
initial-advertise-peer-urls: 'https://192.168.1.33:2380'
advertise-client-urls: 'https://192.168.1.33:2379'
discovery:
discovery-fallback: 'proxy'
discovery-proxy:
discovery-srv:
initial-cluster: 'k8s-master01=https://192.168.1.31:2380,k8s-master02=https://192.168.1.32:2380,k8s-master03=https://192.168.1.33:2380'
initial-cluster-token: 'etcd-k8s-cluster'
initial-cluster-state: 'new'
strict-reconfig-check: false
enable-v2: true
enable-pprof: true
proxy: 'off'
proxy-failure-wait: 5000
proxy-refresh-interval: 30000
proxy-dial-timeout: 1000
proxy-write-timeout: 5000
proxy-read-timeout: 0
client-transport-security:
  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'
  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'
  client-cert-auth: true
  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'
  auto-tls: true
peer-transport-security:
  cert-file: '/etc/kubernetes/pki/etcd/etcd.pem'
  key-file: '/etc/kubernetes/pki/etcd/etcd-key.pem'
  peer-client-cert-auth: true
  trusted-ca-file: '/etc/kubernetes/pki/etcd/etcd-ca.pem'
  auto-tls: true
debug: false
log-package-levels:
log-outputs: [default]
force-new-cluster: false
EOF
</code></pre>
<h3 data-id="heading-74">4.2.åˆ›å»ºserviceï¼ˆæ‰€æœ‰masterèŠ‚ç‚¹æ“ä½œï¼‰</h3>
<h4 data-id="heading-75">4.2.1åˆ›å»ºetcd.serviceå¹¶å¯åŠ¨</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /usr/lib/systemd/system/etcd.service &lt;&lt; EOF

[Unit]
Description=Etcd Service
Documentation=https://coreos.com/etcd/docs/latest/
After=network.target

[Service]
Type=notify
ExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd.config.yml
TimeoutSec=0
RestartSec=60
Restart=always
StartLimitBurst=3
StartLimitInterval=60s
LimitNOFILE=infinity
LimitNPROC=infinity
LimitCORE=infinity
TasksMax=infinity

[Install]
WantedBy=multi-user.target
Alias=etcd3.service

EOF
</code></pre>
<h4 data-id="heading-76">4.2.2åˆ›å»ºetcdè¯ä¹¦ç›®å½•</h4>
<pre><code class="hljs language-shell" lang="shell">mkdir /etc/kubernetes/pki/etcd
ln -s /etc/etcd/ssl/* /etc/kubernetes/pki/etcd/

systemctl daemon-reload
systemctl enable --now etcd.service
systemctl restart etcd.service
systemctl status etcd.service
</code></pre>
<h4 data-id="heading-77">4.2.3æŸ¥çœ‹etcdçŠ¶æ€</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å¦‚æœè¦ç”¨IPv6é‚£ä¹ˆæŠŠIPv4åœ°å€ä¿®æ”¹ä¸ºIPv6å³å¯</span>
export ETCDCTL_API=3
etcdctl --endpoints="192.168.1.33:2379,192.168.1.32:2379,192.168.1.31:2379" --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem  endpoint status --write-out=table
+-------------------+------------------+---------+-----------------+---------+--------+-----------------------+--------+-----------+------------+-----------+------------+--------------------+--------+--------------------------+-------------------+
|     ENDPOINT      |        ID        | VERSION | STORAGE VERSION | DB SIZE | IN USE | PERCENTAGE NOT IN USE | QUOTA  | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS | DOWNGRADE TARGET VERSION | DOWNGRADE ENABLED |
+-------------------+------------------+---------+-----------------+---------+--------+-----------------------+--------+-----------+------------+-----------+------------+--------------------+--------+--------------------------+-------------------+
| 192.168.1.33:2379 |  8065f2e59c8d68c |   3.6.7 |           3.6.0 |   20 kB |  16 kB |                   20% | 2.1 GB |     false |      false |         4 |         14 |                 14 |        |                          |             false |
| 192.168.1.32:2379 | b7b7ad6bf4db3f28 |   3.6.7 |           3.6.0 |   20 kB |  16 kB |                   20% | 2.1 GB |      true |      false |         4 |         14 |                 14 |        |                          |             false |
| 192.168.1.31:2379 | bf047bcfe3b9bf27 |   3.6.7 |           3.6.0 |   20 kB |  16 kB |                   20% | 2.1 GB |     false |      false |         4 |         14 |                 14 |        |                          |             false |
+-------------------+------------------+---------+-----------------+---------+--------+-----------------------+--------+-----------+------------+-----------+------------+--------------------+--------+--------------------------+-------------------+
</code></pre>
<h2 data-id="heading-78">5.é«˜å¯ç”¨é…ç½®ï¼ˆåœ¨MasteræœåŠ¡å™¨ä¸Šæ“ä½œï¼‰</h2>
<p><em><em>æ³¨æ„</em> 5.1.1 å’Œ5.1.2 äºŒé€‰ä¸€å³å¯</em>*</p>
<p>é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆï¼ŒåŒæ—¶å¯ä»¥ä¿©ç§éƒ½é€‰ç”¨ï¼Œå®ç°å†…å¤–å…¼é¡¾çš„æ•ˆæœï¼Œæ¯”å¦‚ï¼š
5.1 çš„ NGINXæ–¹æ¡ˆå®ç°é›†ç¾¤å†…çš„é«˜å¯ç”¨
5.2 çš„ haproxyã€keepalived æ–¹æ¡ˆå®ç°é›†ç¾¤å¤–è®¿é—®</p>
<p>åœ¨ã€Š3.2.ç”Ÿæˆk8sç›¸å…³è¯ä¹¦ã€‹</p>
<p>è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º <code>--server=https://127.0.0.1:8443</code>
è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º <code>--server=https://192.168.1.36:9443</code></p>
<h3 data-id="heading-79">5.1 NGINXé«˜å¯ç”¨æ–¹æ¡ˆ</h3>
<h4 data-id="heading-80">5.1.1 è¿›è¡Œç¼–è¯‘</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£…ç¼–è¯‘ç¯å¢ƒ</span>
yum install gcc -y
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¸‹è½½è§£å‹nginxäºŒè¿›åˆ¶æ–‡ä»¶</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget http://nginx.org/download/nginx-1.25.3.tar.gz</span>
tar xvf nginx-*.tar.gz
cd nginx-*
<span class="hljs-meta prompt_">
# </span><span class="bash">è¿›è¡Œç¼–è¯‘</span>
./configure --with-stream --without-http --without-http_uwsgi_module --without-http_scgi_module --without-http_fastcgi_module
make &amp;&amp; make install 
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‹·è´ç¼–è¯‘å¥½çš„nginx</span>
node='k8s-master02 k8s-master03 k8s-node01 k8s-node02'
for NODE in $node; do scp -r /usr/local/nginx/ $NODE:/usr/local/nginx/; done

</code></pre>
<h4 data-id="heading-81">5.1.2 å†™å…¥å¯åŠ¨é…ç½®</h4>
<p>åœ¨æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œ</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å†™å…¥nginxé…ç½®æ–‡ä»¶</span>
cat &gt; /usr/local/nginx/conf/kube-nginx.conf &lt;&lt;EOF
worker_processes 1;
events {
    worker_connections  1024;
}
stream {
    upstream backend {
        least_conn;
        hash $remote_addr consistent;
        server 192.168.1.31:6443        max_fails=3 fail_timeout=30s;
        server 192.168.1.32:6443        max_fails=3 fail_timeout=30s;
        server 192.168.1.33:6443        max_fails=3 fail_timeout=30s;
    }
    server {
        listen 127.0.0.1:8443;
        proxy_connect_timeout 1s;
        proxy_pass backend;
    }
}
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">å†™å…¥å¯åŠ¨é…ç½®æ–‡ä»¶</span>
cat &gt; /etc/systemd/system/kube-nginx.service &lt;&lt;EOF
[Unit]
Description=kube-apiserver nginx proxy
After=network.target
After=network-online.target
Wants=network-online.target

[Service]
Type=forking
ExecStartPre=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx -t
ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx
ExecReload=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/kube-nginx.conf -p /usr/local/nginx -s reload
PrivateTmp=true
Restart=always
RestartSec=5
StartLimitInterval=0
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">è®¾ç½®å¼€æœºè‡ªå¯</span>
systemctl daemon-reload
systemctl enable --now kube-nginx.service
systemctl restart kube-nginx.service
systemctl status kube-nginx.service
</code></pre>
<h3 data-id="heading-82">5.2 keepalivedå’Œhaproxy é«˜å¯ç”¨æ–¹æ¡ˆ</h3>
<h4 data-id="heading-83">5.2.1å®‰è£…keepalivedå’ŒhaproxyæœåŠ¡</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl disable --now firewalld
setenforce 0
sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config
yum -y install keepalived haproxy
</code></pre>
<h4 data-id="heading-84">5.2.2ä¿®æ”¹haproxyé…ç½®æ–‡ä»¶ï¼ˆé…ç½®æ–‡ä»¶ä¸€æ ·ï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell">cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak
cat &gt;/etc/haproxy/haproxy.cfg&lt;&lt;"EOF"
global
 maxconn 2000
 ulimit-n 16384
 log 127.0.0.1 local0 err
 stats timeout 30s

defaults
 log global
 mode http
 option httplog
 timeout connect 5000
 timeout client 50000
 timeout server 50000
 timeout http-request 15s
 timeout http-keep-alive 15s


frontend monitor-in
 bind *:33305
 mode http
 option httplog
 monitor-uri /monitor

frontend k8s-master
 bind 0.0.0.0:9443
 bind 127.0.0.1:9443
 mode tcp
 option tcplog
 tcp-request inspect-delay 5s
 default_backend k8s-master


backend k8s-master
 mode tcp
 option tcplog
 option tcp-check
 balance roundrobin
 default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
 server  k8s-master01  192.168.1.31:6443 check
 server  k8s-master02  192.168.1.32:6443 check
 server  k8s-master03  192.168.1.33:6443 check
EOF
</code></pre>
<p>å‚æ•°</p>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-85">5.2.3Master01é…ç½®keepalived masterèŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell">cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak

cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
! Configuration File for keepalived

global_defs {
    router_id LVS_DEVEL
}
vrrp_script chk_apiserver {
    script "/etc/keepalived/check_apiserver.sh"
    interval 5 
    weight -5
    fall 2
    rise 1
}
vrrp_instance VI_1 {
    state MASTER
    # æ³¨æ„ç½‘å¡å
    interface ens160 
    mcast_src_ip 192.168.1.31
    virtual_router_id 51
    priority 100
    nopreempt
    advert_int 2
    authentication {
        auth_type PASS
        auth_pass K8SHA_KA_AUTH
    }
    virtual_ipaddress {
        192.168.1.36
    }
    track_script {
      chk_apiserver 
} }

EOF
</code></pre>
<h4 data-id="heading-86">5.2.4Master02é…ç½®keepalived backupèŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell">cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak

cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
! Configuration File for keepalived

global_defs {
    router_id LVS_DEVEL
}
vrrp_script chk_apiserver {
    script "/etc/keepalived/check_apiserver.sh"
    interval 5 
    weight -5
    fall 2
    rise 1

}
vrrp_instance VI_1 {
    state BACKUP
    # æ³¨æ„ç½‘å¡å
    interface ens160
    mcast_src_ip 192.168.1.32
    virtual_router_id 51
    priority 80
    nopreempt
    advert_int 2
    authentication {
        auth_type PASS
        auth_pass K8SHA_KA_AUTH
    }
    virtual_ipaddress {
        192.168.1.36
    }
    track_script {
      chk_apiserver 
} }

EOF
</code></pre>
<h4 data-id="heading-87">5.2.5Master03é…ç½®keepalived backupèŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell">cp /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak

cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; EOF
! Configuration File for keepalived

global_defs {
    router_id LVS_DEVEL
}
vrrp_script chk_apiserver {
    script "/etc/keepalived/check_apiserver.sh"
    interval 5 
    weight -5
    fall 2
    rise 1

}
vrrp_instance VI_1 {
    state BACKUP
    # æ³¨æ„ç½‘å¡å
    interface ens160
    mcast_src_ip 192.168.1.33
    virtual_router_id 51
    priority 50
    nopreempt
    advert_int 2
    authentication {
        auth_type PASS
        auth_pass K8SHA_KA_AUTH
    }
    virtual_ipaddress {
        192.168.1.36
    }
    track_script {
      chk_apiserver 
} }

EOF
</code></pre>
<p>å‚æ•°</p>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-88">5.2.6å¥åº·æ£€æŸ¥è„šæœ¬é…ç½®ï¼ˆlbä¸»æœºï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt;  /etc/keepalived/check_apiserver.sh &lt;&lt; EOF
<span class="hljs-meta prompt_">#</span><span class="bash">!/bin/bash</span>

err=0
for k in \$(seq 1 3)
do
    check_code=\$(pgrep haproxy)
    if [[ \$check_code == "" ]]; then
        err=\$(expr \$err + 1)
        sleep 1
        continue
    else
        err=0
        break
    fi
done

if [[ \$err != "0" ]]; then
    echo "systemctl stop keepalived"
    /usr/bin/systemctl stop keepalived
    exit 1
else
    exit 0
fi
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">ç»™è„šæœ¬æˆæƒ</span>

chmod +x /etc/keepalived/check_apiserver.sh
</code></pre>
<h4 data-id="heading-89">5.2.7å¯åŠ¨æœåŠ¡</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now haproxy.service
systemctl enable --now keepalived.service
systemctl status haproxy.service
systemctl status keepalived.service
</code></pre>
<h4 data-id="heading-90">5.2.8æµ‹è¯•é«˜å¯ç”¨</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">èƒ½pingåŒ</span>
[root@k8s-node02 ~]# ping 192.168.1.36
<span class="hljs-meta prompt_">
# </span><span class="bash">èƒ½telnetè®¿é—®</span>
[root@k8s-node02 ~]# telnet 192.168.1.36 9443
<span class="hljs-meta prompt_">
# </span><span class="bash">å…³é—­ä¸»èŠ‚ç‚¹ï¼Œçœ‹vipæ˜¯å¦æ¼‚ç§»åˆ°å¤‡èŠ‚ç‚¹</span>
</code></pre>
<h2 data-id="heading-91">6.k8sç»„ä»¶é…ç½®</h2>
<p>æ‰€æœ‰k8sèŠ‚ç‚¹åˆ›å»ºä»¥ä¸‹ç›®å½•</p>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /etc/kubernetes/manifests/ /etc/systemd/system/kubelet.service.d /var/lib/kubelet /var/log/kubernetes
</code></pre>
<h3 data-id="heading-92">6.1.åˆ›å»ºapiserverï¼ˆæ‰€æœ‰masterèŠ‚ç‚¹ï¼‰</h3>
<h4 data-id="heading-93">6.1.1master01èŠ‚ç‚¹é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è‹¥å…³é—­IPv6 åˆ é™¤ --service-cluster-ip-range çš„ IPv6 å³å¯</span>
cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-apiserver \\
      --v=2  \\
      --allow-privileged=true  \\
      --bind-address=0.0.0.0  \\
      --secure-port=6443  \\
      --advertise-address=192.168.1.31 \\
      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112  \\
      --service-node-port-range=30000-32767  \\
      --etcd-servers=https://192.168.1.31:2379,https://192.168.1.32:2379,https://192.168.1.33:2379 \\
      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\
      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \\
      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\
      --client-ca-file=/etc/kubernetes/pki/ca.pem  \\
      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\
      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\
      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\
      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \\
      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \\
      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\
      --service-account-issuer=https://kubernetes.default.svc.cluster.local \\
      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\
      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \
      --authorization-mode=Node,RBAC  \\
      --enable-bootstrap-token-auth=true  \\
      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\
      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\
      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\
      --requestheader-allowed-names=aggregator  \\
      --requestheader-group-headers=X-Remote-Group  \\
      --requestheader-extra-headers-prefix=X-Remote-Extra-  \\
      --requestheader-username-headers=X-Remote-User \\
      --enable-aggregator-routing=true
Restart=on-failure
RestartSec=10s
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target

EOF
</code></pre>
<h4 data-id="heading-94">6.1.2master02èŠ‚ç‚¹é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è‹¥å…³é—­IPv6 åˆ é™¤ --service-cluster-ip-range çš„ IPv6 å³å¯</span>
cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-apiserver \\
      --v=2  \\
      --allow-privileged=true  \\
      --bind-address=0.0.0.0  \\
      --secure-port=6443  \\
      --advertise-address=192.168.1.32 \\
      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112  \\
      --service-node-port-range=30000-32767  \\
      --etcd-servers=https://192.168.1.31:2379,https://192.168.1.32:2379,https://192.168.1.33:2379 \\
      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\
      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \\
      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\
      --client-ca-file=/etc/kubernetes/pki/ca.pem  \\
      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\
      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\
      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\
      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \\
      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \\
      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\
      --service-account-issuer=https://kubernetes.default.svc.cluster.local \\
      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\
      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\
      --authorization-mode=Node,RBAC  \\
      --enable-bootstrap-token-auth=true  \\
      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\
      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\
      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\
      --requestheader-allowed-names=aggregator  \\
      --requestheader-group-headers=X-Remote-Group  \\
      --requestheader-extra-headers-prefix=X-Remote-Extra-  \\
      --requestheader-username-headers=X-Remote-User \\
      --enable-aggregator-routing=true

Restart=on-failure
RestartSec=10s
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target

EOF
</code></pre>
<h4 data-id="heading-95">6.1.3master03èŠ‚ç‚¹é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è‹¥å…³é—­IPv6 åˆ é™¤ --service-cluster-ip-range çš„ IPv6 å³å¯</span>
cat &gt; /usr/lib/systemd/system/kube-apiserver.service  &lt;&lt; EOF
[Unit]
Description=Kubernetes API Server
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-apiserver \\
      --v=2  \\
      --allow-privileged=true  \\
      --bind-address=0.0.0.0  \\
      --secure-port=6443  \\
      --advertise-address=192.168.1.33 \\
      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112  \\
      --service-node-port-range=30000-32767  \\
      --etcd-servers=https://192.168.1.31:2379,https://192.168.1.32:2379,https://192.168.1.33:2379 \\
      --etcd-cafile=/etc/etcd/ssl/etcd-ca.pem  \\
      --etcd-certfile=/etc/etcd/ssl/etcd.pem  \\
      --etcd-keyfile=/etc/etcd/ssl/etcd-key.pem  \\
      --client-ca-file=/etc/kubernetes/pki/ca.pem  \\
      --tls-cert-file=/etc/kubernetes/pki/apiserver.pem  \\
      --tls-private-key-file=/etc/kubernetes/pki/apiserver-key.pem  \\
      --kubelet-client-certificate=/etc/kubernetes/pki/apiserver.pem  \\
      --kubelet-client-key=/etc/kubernetes/pki/apiserver-key.pem  \\
      --service-account-key-file=/etc/kubernetes/pki/sa.pub  \\
      --service-account-signing-key-file=/etc/kubernetes/pki/sa.key  \\
      --service-account-issuer=https://kubernetes.default.svc.cluster.local \\
      --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname  \\
      --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,ResourceQuota  \\
      --authorization-mode=Node,RBAC  \\
      --enable-bootstrap-token-auth=true  \\
      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem  \\
      --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.pem  \\
      --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client-key.pem  \\
      --requestheader-allowed-names=aggregator  \\
      --requestheader-group-headers=X-Remote-Group  \\
      --requestheader-extra-headers-prefix=X-Remote-Extra-  \\
      --requestheader-username-headers=X-Remote-User \\
      --enable-aggregator-routing=true

Restart=on-failure
RestartSec=10s
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target

EOF
</code></pre>
<p>å‚æ•°</p>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-96">6.1.4å¯åŠ¨apiserverï¼ˆæ‰€æœ‰masterèŠ‚ç‚¹ï¼‰</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now kube-apiserver.service
systemctl restart kube-apiserver.service
systemctl status kube-apiserver.service
</code></pre>
<h3 data-id="heading-97">6.2.é…ç½®kube-controller-manager service</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ‰€æœ‰masterèŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">172.16.0.0/12ä¸ºpodç½‘æ®µï¼ŒæŒ‰éœ€æ±‚è®¾ç½®ä½ è‡ªå·±çš„ç½‘æ®µ</span>

cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-controller-manager \\
      --v=2 \\
      --bind-address=0.0.0.0 \\
      --root-ca-file=/etc/kubernetes/pki/ca.pem \\
      --cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem \\
      --cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem \\
      --service-account-private-key-file=/etc/kubernetes/pki/sa.key \\
      --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig \\
      --leader-elect=true \\
      --use-service-account-credentials=true \\
      --node-monitor-grace-period=40s \\
      --node-monitor-period=5s \\
      --controllers=*,bootstrapsigner,tokencleaner \\
      --allocate-node-cidrs=true \\
      --service-cluster-ip-range=10.96.0.0/12,fd00:1111::/112 \\
      --cluster-cidr=172.16.0.0/12,fc00:2222::/112 \\
      --node-cidr-mask-size-ipv4=24 \\
      --node-cidr-mask-size-ipv6=120 \\
      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem

Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target
EOF
<span class="hljs-meta prompt_">


# </span><span class="bash">å…³é—­IPv6</span> 
<span class="hljs-meta prompt_"># </span><span class="bash">åˆ é™¤ --service-cluster-ip-range ä¸­çš„IPv6åœ°å€</span>
<span class="hljs-meta prompt_"># </span><span class="bash">åˆ é™¤ --cluster-cidr ä¸­çš„IPv6åœ°å€</span>
<span class="hljs-meta prompt_"># </span><span class="bash">åˆ é™¤ --node-cidr-mask-size-ipv6=120</span>
cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Controller Manager
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-controller-manager \\
      --v=2 \\
      --bind-address=0.0.0.0 \\
      --root-ca-file=/etc/kubernetes/pki/ca.pem \\
      --cluster-signing-cert-file=/etc/kubernetes/pki/ca.pem \\
      --cluster-signing-key-file=/etc/kubernetes/pki/ca-key.pem \\
      --service-account-private-key-file=/etc/kubernetes/pki/sa.key \\
      --kubeconfig=/etc/kubernetes/controller-manager.kubeconfig \\
      --leader-elect=true \\
      --use-service-account-credentials=true \\
      --node-monitor-grace-period=40s \\
      --node-monitor-period=5s \\
      --controllers=*,bootstrapsigner,tokencleaner \\
      --allocate-node-cidrs=true \\
      --service-cluster-ip-range=10.96.0.0/12 \\
      --cluster-cidr=172.16.0.0/12 \\
      --node-cidr-mask-size-ipv4=24 \\
      --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem

Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<p>å‚æ•°</p>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-98">6.2.1å¯åŠ¨kube-controller-managerï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now kube-controller-manager.service
systemctl restart kube-controller-manager.service
systemctl status kube-controller-manager.service
</code></pre>
<h3 data-id="heading-99">6.3.é…ç½®kube-scheduler service</h3>
<h4 data-id="heading-100">6.3.1æ‰€æœ‰masterèŠ‚ç‚¹é…ç½®ï¼Œä¸”é…ç½®ç›¸åŒ</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; EOF

[Unit]
Description=Kubernetes Scheduler
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-scheduler \\
      --v=2 \\
      --bind-address=0.0.0.0 \\
      --leader-elect=true \\
      --kubeconfig=/etc/kubernetes/scheduler.kubeconfig

Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target

EOF
</code></pre>
<p>å‚æ•°</p>
<pre><code class="hljs language-shell" lang="shell">è¯¦è§å®Œæ•´ç‰ˆ https://github.com/cby-chen/Kubernetes
</code></pre>
<h4 data-id="heading-101">6.3.2å¯åŠ¨å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now kube-scheduler.service
systemctl restart kube-scheduler.service
systemctl status kube-scheduler.service
</code></pre>
<h2 data-id="heading-102">7.TLS Bootstrappingé…ç½®</h2>
<h3 data-id="heading-103">7.1åœ¨master01ä¸Šé…ç½®</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åœ¨ã€Š5.é«˜å¯ç”¨é…ç½®ã€‹é€‰æ‹©ä½¿ç”¨é‚£ç§é«˜å¯ç”¨æ–¹æ¡ˆ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ haproxyã€keepalived é‚£ä¹ˆä¸º `--server=https://192.168.1.36:9443`</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä½¿ç”¨ nginxæ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸º `--server=https://127.0.0.1:8443`</span>

kubectl config set-cluster kubernetes     \
--certificate-authority=/etc/kubernetes/pki/ca.pem     \
--embed-certs=true     --server=https://127.0.0.1:8443     \
--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿›è¡Œåˆ›å»ºtokenä¹Ÿå¯ä»¥ä½¿ç”¨æˆ‘çš„</span>
echo "$(head -c 6 /dev/urandom | md5sum | head -c 6)"."$(head -c 16 /dev/urandom | md5sum | head -c 16)"

kubectl config set-credentials tls-bootstrap-token-user     \
--token=c8ad9c.2e4d610cf3e7426e \
--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig

kubectl config set-context tls-bootstrap-token-user@kubernetes     \
--cluster=kubernetes     \
--user=tls-bootstrap-token-user     \
--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig

kubectl config use-context tls-bootstrap-token-user@kubernetes     \
--kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig
<span class="hljs-meta prompt_">
# </span><span class="bash">tokençš„ä½ç½®åœ¨bootstrap.secret.yamlï¼Œå¦‚æœä¿®æ”¹çš„è¯åˆ°è¿™ä¸ªæ–‡ä»¶ä¿®æ”¹</span>
mkdir -p /root/.kube ; cp /etc/kubernetes/admin.kubeconfig /root/.kube/config
</code></pre>
<h3 data-id="heading-104">7.2æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œæ²¡é—®é¢˜çš„è¯ç»§ç»­åç»­æ“ä½œ</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">1.28 ç‰ˆæœ¬åªèƒ½æŸ¥çœ‹åˆ°ä¸€ä¸ªetcd å±äºæ­£å¸¸ç°è±¡</span>
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">export</span> ETCDCTL_API=3</span>
<span class="hljs-meta prompt_"># </span><span class="bash">etcdctl --endpoints=<span class="hljs-string">"192.168.1.33:2379,192.168.1.32:2379,192.168.1.31:2379"</span> --cacert=/etc/kubernetes/pki/etcd/etcd-ca.pem --cert=/etc/kubernetes/pki/etcd/etcd.pem --key=/etc/kubernetes/pki/etcd/etcd-key.pem  endpoint status --write-out=table</span>

kubectl get cs
Warning: v1 ComponentStatus is deprecated in v1.19+
NAME                 STATUS    MESSAGE   ERROR
scheduler            Healthy   ok        
controller-manager   Healthy   ok        
etcd-0               Healthy   ok 
<span class="hljs-meta prompt_">
# </span><span class="bash">å†™å…¥bootstrap-token</span>
cat &gt; bootstrap.secret.yaml &lt;&lt; EOF
apiVersion: v1
kind: Secret
metadata:
  name: bootstrap-token-c8ad9c
  namespace: kube-system
type: bootstrap.kubernetes.io/token
stringData:
  description: "The default bootstrap token generated by 'kubelet '."
  token-id: c8ad9c
  token-secret: 2e4d610cf3e7426e
  usage-bootstrap-authentication: "true"
  usage-bootstrap-signing: "true"
  auth-extra-groups:  system:bootstrappers:default-node-token,system:bootstrappers:worker,system:bootstrappers:ingress

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kubelet-bootstrap
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:node-bootstrapper
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:bootstrappers:default-node-token
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: node-autoapprove-bootstrap
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:bootstrappers:default-node-token
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: node-autoapprove-certificate-rotation
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:nodes
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
  labels:
    kubernetes.io/bootstrapping: rbac-defaults
  name: system:kube-apiserver-to-kubelet
rules:
  - apiGroups:
      - ""
    resources:
      - nodes/proxy
      - nodes/stats
      - nodes/log
      - nodes/spec
      - nodes/metrics
    verbs:
      - "*"
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: system:kube-apiserver
  namespace: ""
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:kube-apiserver-to-kubelet
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: User
    name: kube-apiserver
EOF
<span class="hljs-meta prompt_"># </span><span class="bash">åˆ‡è®°æ‰§è¡Œï¼Œåˆ«å¿˜è®°ï¼ï¼ï¼</span>
kubectl create -f bootstrap.secret.yaml
</code></pre>
<h2 data-id="heading-105">8.nodeèŠ‚ç‚¹é…ç½®</h2>
<h3 data-id="heading-106">8.1.åœ¨master01ä¸Šå°†è¯ä¹¦å¤åˆ¶åˆ°nodeèŠ‚ç‚¹</h3>
<pre><code class="hljs language-shell" lang="shell">cd /etc/kubernetes/

for NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do ssh $NODE mkdir -p /etc/kubernetes/pki; for FILE in pki/ca.pem pki/ca-key.pem pki/front-proxy-ca.pem bootstrap-kubelet.kubeconfig kube-proxy.kubeconfig; do scp /etc/kubernetes/$FILE $NODE:/etc/kubernetes/${FILE}; done; done
</code></pre>
<h3 data-id="heading-107">8.2.kubeleté…ç½®</h3>
<p><strong>æ³¨æ„ ï¼š 8.2.1 å’Œ 8.2.2 éœ€è¦å’Œ ä¸Šæ–¹ 2.1 å’Œ 2.2 å¯¹åº”èµ·æ¥</strong></p>
<h4 data-id="heading-108">8.2.1å½“ä½¿ç”¨dockerä½œä¸ºRuntime</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF

[Unit]
Description=Kubernetes Kubelet
Documentation=https://github.com/kubernetes/kubernetes
After=network-online.target firewalld.service cri-docker.service docker.socket containerd.service
Wants=network-online.target
Requires=docker.socket containerd.service

[Service]
ExecStart=/usr/local/bin/kubelet \\
    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\
    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\
    --config=/etc/kubernetes/kubelet-conf.yml \\
    --container-runtime-endpoint=unix:///run/cri-dockerd.sock  \\
    --node-labels=node.kubernetes.io/node= 


[Install]
WantedBy=multi-user.target
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">IPv6ç¤ºä¾‹</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä¸ä½¿ç”¨IPv6é‚£ä¹ˆå¿½ç•¥æ­¤é¡¹å³å¯</span>
<span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹æ–¹ --node-ip æ›´æ¢ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„IPå³å¯</span>
**cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kubelet
Documentation=https://github.com/kubernetes/kubernetes
After=network-online.target firewalld.service cri-docker.service docker.socket containerd.service
Wants=network-online.target
Requires=docker.socket containerd.service

[Service]
ExecStart=/usr/local/bin/kubelet \\
    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\
    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\
    --config=/etc/kubernetes/kubelet-conf.yml \\
    --container-runtime-endpoint=unix:///run/cri-dockerd.sock  \\
    --node-labels=node.kubernetes.io/node=   \\
    --node-ip=192.168.1.31,fc00::31
[Install]
WantedBy=multi-user.target
EOF**
</code></pre>
<h4 data-id="heading-109">8.2.2å½“ä½¿ç”¨Containerdä½œä¸ºRuntime</h4>
<pre><code class="hljs language-shell" lang="shell">mkdir -p /var/lib/kubelet /var/log/kubernetes /etc/systemd/system/kubelet.service.d /etc/kubernetes/manifests/
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‰€æœ‰k8sèŠ‚ç‚¹é…ç½®kubelet service</span>
cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF

[Unit]
Description=Kubernetes Kubelet
Documentation=https://github.com/kubernetes/kubernetes
After=network-online.target firewalld.service containerd.service
Wants=network-online.target
Requires=containerd.service

[Service]
ExecStart=/usr/local/bin/kubelet \\
    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\
    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\
    --config=/etc/kubernetes/kubelet-conf.yml \\
    --container-runtime-endpoint=unix:///run/containerd/containerd.sock  \\
    --node-labels=node.kubernetes.io/node=

[Install]
WantedBy=multi-user.target
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">IPv6ç¤ºä¾‹</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‹¥ä¸ä½¿ç”¨IPv6é‚£ä¹ˆå¿½ç•¥æ­¤é¡¹å³å¯</span>
<span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹æ–¹ --node-ip æ›´æ¢ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„IPå³å¯</span>
cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF

[Unit]
Description=Kubernetes Kubelet
Documentation=https://github.com/kubernetes/kubernetes
After=network-online.target firewalld.service containerd.service
Wants=network-online.target
Requires=containerd.service

[Service]
ExecStart=/usr/local/bin/kubelet \\
    --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.kubeconfig  \\
    --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\
    --config=/etc/kubernetes/kubelet-conf.yml \\
    --container-runtime-endpoint=unix:///run/containerd/containerd.sock  \\
    --node-labels=node.kubernetes.io/node=  \\
    --node-ip=192.168.1.31,fc00::31
[Install]
WantedBy=multi-user.target
EOF
</code></pre>
<h4 data-id="heading-110">8.2.3æ‰€æœ‰k8sèŠ‚ç‚¹åˆ›å»ºkubeletçš„é…ç½®æ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /etc/kubernetes/kubelet-conf.yml &lt;&lt;EOF
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
address: 0.0.0.0
port: 10250
readOnlyPort: 10255
authentication:
  anonymous:
    enabled: false
  webhook:
    cacheTTL: 2m0s
    enabled: true
  x509:
    clientCAFile: /etc/kubernetes/pki/ca.pem
authorization:
  mode: Webhook
  webhook:
    cacheAuthorizedTTL: 5m0s
    cacheUnauthorizedTTL: 30s
cgroupDriver: systemd
cgroupsPerQOS: true
clusterDNS:
- 10.96.0.10
clusterDomain: cluster.local
containerLogMaxFiles: 5
containerLogMaxSize: 10Mi
contentType: application/vnd.kubernetes.protobuf
cpuCFSQuota: true
cpuManagerPolicy: none
cpuManagerReconcilePeriod: 10s
enableControllerAttachDetach: true
enableDebuggingHandlers: true
enforceNodeAllocatable:
- pods
eventBurst: 10
eventRecordQPS: 5
evictionHard:
  imagefs.available: 15%
  memory.available: 100Mi
  nodefs.available: 10%
  nodefs.inodesFree: 5%
evictionPressureTransitionPeriod: 5m0s
failSwapOn: true
fileCheckFrequency: 20s
hairpinMode: promiscuous-bridge
healthzBindAddress: 127.0.0.1
healthzPort: 10248
httpCheckFrequency: 20s
imageGCHighThresholdPercent: 85
imageGCLowThresholdPercent: 80
imageMinimumGCAge: 2m0s
iptablesDropBit: 15
iptablesMasqueradeBit: 14
kubeAPIBurst: 10
kubeAPIQPS: 5
makeIPTablesUtilChains: true
maxOpenFiles: 1000000
maxPods: 110
nodeStatusUpdateFrequency: 10s
oomScoreAdj: -999
podPidsLimit: -1
registryBurst: 10
registryPullQPS: 5
resolvConf: /etc/resolv.conf
rotateCertificates: true
runtimeRequestTimeout: 2m0s
serializeImagePulls: true
staticPodPath: /etc/kubernetes/manifests
streamingConnectionIdleTimeout: 4h0m0s
syncFrequency: 1m0s
volumeStatsAggPeriod: 1m0s
EOF
</code></pre>
<h4 data-id="heading-111">8.2.4å¯åŠ¨kubelet</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now kubelet.service
systemctl restart kubelet.service
systemctl status kubelet.service
</code></pre>
<h4 data-id="heading-112">8.2.5æŸ¥çœ‹é›†ç¾¤</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# kubectl  get node
NAME           STATUS     ROLES    AGE   VERSION
k8s-master01   NotReady   &lt;none&gt;   15s   v1.35.0
k8s-master02   NotReady   &lt;none&gt;   14s   v1.35.0
k8s-master03   NotReady   &lt;none&gt;   12s   v1.35.0
k8s-node01     NotReady   &lt;none&gt;   11s   v1.35.0
k8s-node02     NotReady   &lt;none&gt;   9s    v1.35.0
[root@k8s-master01 ~]# 

</code></pre>
<h4 data-id="heading-113">8.2.6æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¶</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# kubectl describe node | grep Runtime
  Container Runtime Version:  containerd://2.2.1
  Container Runtime Version:  containerd://2.2.1
  Container Runtime Version:  containerd://2.2.1
  Container Runtime Version:  containerd://2.2.1
  Container Runtime Version:  containerd://2.2.1
[root@k8s-master01 ~]# kubectl describe node | grep Runtime
  Container Runtime Version:  docker://29.1.3
  Container Runtime Version:  docker://29.1.3
  Container Runtime Version:  docker://29.1.3
  Container Runtime Version:  docker://29.1.3
  Container Runtime Version:  docker://29.1.3
[root@k8s-master01 ~]# 
</code></pre>
<h3 data-id="heading-114">8.3.kube-proxyé…ç½®</h3>
<h4 data-id="heading-115">8.3.1å°†kubeconfigå‘é€è‡³å…¶ä»–èŠ‚ç‚¹</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">master-1æ‰§è¡Œ</span>
for NODE in k8s-master02 k8s-master03 k8s-node01 k8s-node02; do scp /etc/kubernetes/kube-proxy.kubeconfig $NODE:/etc/kubernetes/kube-proxy.kubeconfig; done
</code></pre>
<h4 data-id="heading-116">8.3.2æ‰€æœ‰k8sèŠ‚ç‚¹æ·»åŠ kube-proxyçš„serviceæ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt;  /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kube Proxy
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-proxy \\
  --config=/etc/kubernetes/kube-proxy.yaml \\
  --cluster-cidr=172.16.0.0/12,fc00:2222::/112 \\
  --v=2
Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target

EOF
<span class="hljs-meta prompt_">

# </span><span class="bash">å…³é—­IPv6</span>
<span class="hljs-meta prompt_"># </span><span class="bash">åˆ é™¤ --cluster-cidr çš„IPv6åœ°å€</span>
cat &gt;  /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF
[Unit]
Description=Kubernetes Kube Proxy
Documentation=https://github.com/kubernetes/kubernetes
After=network.target

[Service]
ExecStart=/usr/local/bin/kube-proxy \\
  --config=/etc/kubernetes/kube-proxy.yaml \\
  --cluster-cidr=172.16.0.0/12 \\
  --v=2
Restart=always
RestartSec=10s

[Install]
WantedBy=multi-user.target

EOF
</code></pre>
<h4 data-id="heading-117">8.3.3æ‰€æœ‰k8sèŠ‚ç‚¹æ·»åŠ kube-proxyçš„é…ç½®</h4>
<pre><code class="hljs language-shell" lang="shell">cat &gt; /etc/kubernetes/kube-proxy.yaml &lt;&lt; EOF
apiVersion: kubeproxy.config.k8s.io/v1alpha1
bindAddress: 0.0.0.0
clientConnection:
  acceptContentTypes: ""
  burst: 10
  contentType: application/vnd.kubernetes.protobuf
  kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig
  qps: 5
clusterCIDR: 172.16.0.0/12,fc00:2222::/112
configSyncPeriod: 15m0s
conntrack:
  max: null
  maxPerCore: 32768
  min: 131072
  tcpCloseWaitTimeout: 1h0m0s
  tcpEstablishedTimeout: 24h0m0s
enableProfiling: false
healthzBindAddress: 0.0.0.0:10256
hostnameOverride: ""
iptables:
  masqueradeAll: false
  masqueradeBit: 14
  minSyncPeriod: 0s
  syncPeriod: 30s
ipvs:
  masqueradeAll: true
  minSyncPeriod: 5s
  scheduler: "rr"
  syncPeriod: 30s
kind: KubeProxyConfiguration
metricsBindAddress: 127.0.0.1:10249
mode: "ipvs"
nodePortAddresses: null
oomScoreAdj: -999
portRange: ""
udpIdleTimeout: 250ms
EOF
</code></pre>
<h4 data-id="heading-118">8.3.4å¯åŠ¨kube-proxy</h4>
<pre><code class="hljs language-shell" lang="shell">systemctl daemon-reload
systemctl enable --now kube-proxy.service
systemctl restart kube-proxy.service
systemctl status kube-proxy.service
</code></pre>
<h2 data-id="heading-119">9.å®‰è£…ç½‘ç»œæ’ä»¶</h2>
<p><strong>æ³¨æ„ 9.1 å’Œ 9.2 äºŒé€‰å…¶ä¸€å³å¯ï¼Œå»ºè®®åœ¨æ­¤å¤„åˆ›å»ºå¥½å¿«ç…§ååœ¨è¿›è¡Œæ“ä½œï¼Œåç»­å‡ºé—®é¢˜å¯ä»¥å›æ»š</strong></p>
<p>** centos7 è¦å‡çº§libseccomp ä¸ç„¶ æ— æ³•å®‰è£…ç½‘ç»œæ’ä»¶**</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">https://github.com/opencontainers/runc/releases</span>
<span class="hljs-meta prompt_"># </span><span class="bash">å‡çº§runc</span>
<span class="hljs-meta prompt_"># </span><span class="bash">wget https://github.com/opencontainers/runc/releases/download/v1.1.12/runc.amd64</span>

install -m 755 runc.amd64 /usr/local/sbin/runc
cp -p /usr/local/sbin/runc  /usr/local/bin/runc
cp -p /usr/local/sbin/runc  /usr/bin/runc
<span class="hljs-meta prompt_">
#</span><span class="bash">æŸ¥çœ‹å½“å‰ç‰ˆæœ¬</span>
[root@k8s-master-1 ~]# rpm -qa | grep libseccomp
libseccomp-2.5.2-2.el9.x86_64
<span class="hljs-meta prompt_">
#</span><span class="bash">ä¸‹è½½é«˜äº2.4ä»¥ä¸Šçš„åŒ…</span>
<span class="hljs-meta prompt_"># </span><span class="bash">yum -y install http://rpmfind.net/linux/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æ¸…åæº</span>
<span class="hljs-meta prompt_"># </span><span class="bash">yum -y install https://mirrors.tuna.tsinghua.edu.cn/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm</span>
</code></pre>
<h3 data-id="heading-120">9.1å®‰è£…Calico</h3>
<h4 data-id="heading-121">9.1.1æ›´æ”¹calicoç½‘æ®µ</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">
# </span><span class="bash">å®‰è£…operator</span>
kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.31.2/manifests/tigera-operator.yaml
<span class="hljs-meta prompt_">

# </span><span class="bash">ä¸‹è½½é…ç½®æ–‡ä»¶</span>
curl https://raw.githubusercontent.com/projectcalico/calico/v3.31.2/manifests/custom-resources.yaml -O

<span class="hljs-meta prompt_">


# </span><span class="bash">ä¿®æ”¹åœ°å€æ± </span>
vim custom-resources.yaml
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  calicoNetwork:
    ipPools:
    - name: default-ipv4-ippool
      blockSize: 26
      cidr: 172.16.0.0/12
      encapsulation: VXLANCrossSubnet
      natOutgoing: Enabled
      nodeSelector: all()

<span class="hljs-meta prompt_">


# </span><span class="bash">ä¿®æ”¹åœ°å€æ± </span>
vim custom-resources.yaml
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  calicoNetwork:
    ipPools:
    - name: ipv4-ippool
      cidr: 172.16.0.0/12
      blockSize: 26
      encapsulation: IPIP
      natOutgoing: Enabled
      nodeSelector: all()
    - name: ipv6-ippool
      cidr: "fd00:100::/64"
      blockSize: 122
      encapsulation: None
      natOutgoing: Enabled
      nodeSelector: all()
    nodeAddressAutodetectionV4:
      interface: "eth.*|en.*"
    nodeAddressAutodetectionV6:
      interface: "eth.*|en.*"
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‰§è¡Œå®‰è£…</span>
kubectl create -f custom-resources.yaml
<span class="hljs-meta prompt_">


# </span><span class="bash">å®‰è£…å®¢æˆ·ç«¯</span>
curl -L https://github.com/projectcalico/calico/releases/download/v3.30.3/calicoctl-linux-amd64 -o calicoctl
<span class="hljs-meta prompt_">

# </span><span class="bash">ç»™å®¢æˆ·ç«¯æ·»åŠ æ‰§è¡Œæƒé™</span>
chmod +x ./calicoctl
<span class="hljs-meta prompt_">

# </span><span class="bash">æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</span>
./calicoctl get nodes --allow-version-mismatch
<span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</span>
./calicoctl node status --allow-version-mismatch
<span class="hljs-meta prompt_">#</span><span class="bash">æŸ¥çœ‹åœ°å€æ± </span>
./calicoctl get ipPool --allow-version-mismatch
./calicoctl get ipPool --allow-version-mismatch -o yaml


</code></pre>
<h4 data-id="heading-122">9.1.2æŸ¥çœ‹å®¹å™¨çŠ¶æ€</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">calico åˆå§‹åŒ–ä¼šå¾ˆæ…¢ éœ€è¦è€å¿ƒç­‰å¾…ä¸€ä¸‹ï¼Œå¤§çº¦ååˆ†é’Ÿå·¦å³</span>
[root@k8s-master01 kubernetes-v1.35.0]# kubectl get pod -A
NAMESPACE         NAME                                       READY   STATUS    RESTARTS   AGE
calico-system     calico-apiserver-8944cd746-8cf9n           1/1     Running   0          3m17s
calico-system     calico-apiserver-8944cd746-kdvx4           1/1     Running   0          3m17s
calico-system     calico-kube-controllers-757dc6b956-bpx2m   1/1     Running   0          3m16s
calico-system     calico-node-89xvc                          1/1     Running   0          3m16s
calico-system     calico-node-95dgk                          1/1     Running   0          3m16s
calico-system     calico-node-jbm6g                          1/1     Running   0          3m16s
calico-system     calico-node-p5mb2                          1/1     Running   0          3m16s
calico-system     calico-node-t68xn                          1/1     Running   0          3m16s
calico-system     calico-typha-68687d94bd-7pcmq              1/1     Running   0          3m14s
calico-system     calico-typha-68687d94bd-cfclr              1/1     Running   0          3m16s
calico-system     calico-typha-68687d94bd-t62kd              1/1     Running   0          3m14s
calico-system     csi-node-driver-5mwsv                      2/2     Running   0          3m16s
calico-system     csi-node-driver-jtp56                      2/2     Running   0          3m16s
calico-system     csi-node-driver-ncd7q                      2/2     Running   0          3m16s
calico-system     csi-node-driver-nvb6d                      2/2     Running   0          3m16s
calico-system     csi-node-driver-s6dk9                      2/2     Running   0          3m16s
calico-system     goldmane-576ddf78d8-4zkch                  1/1     Running   0          3m17s
calico-system     whisker-58576c6584-nv246                   2/2     Running   0          2m43s
tigera-operator   tigera-operator-5cd7bd49c7-rwb54           1/1     Running   0          3m34s
[root@k8s-master01 kubernetes-v1.35.0]# 


</code></pre>
<h3 data-id="heading-123">9.2 å®‰è£…cilium</h3>
<h4 data-id="heading-124">9.2.1 å®‰è£…helm</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">[root@k8s-master01 ~]<span class="hljs-comment"># curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">[root@k8s-master01 ~]<span class="hljs-comment"># chmod 700 get_helm.sh</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">[root@k8s-master01 ~]<span class="hljs-comment"># ./get_helm.sh</span></span>
<span class="hljs-meta prompt_">
# </span><span class="bash">wget https://get.helm.sh/helm-v4.0.4-linux-amd64.tar.gz</span>
tar xvf helm-*-linux-amd64.tar.gz
cp linux-amd64/helm /usr/local/bin/
</code></pre>
<h4 data-id="heading-125">9.2.2 å®‰è£…cilium</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ·»åŠ æº</span>
helm repo add cilium https://helm.cilium.io
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¿®æ”¹ä¸ºå›½å†…æº</span>
helm pull cilium/cilium
tar xvf cilium-*.tgz
cd cilium/
<span class="hljs-meta prompt_">
# </span><span class="bash">sed -i <span class="hljs-string">"s#quay.io/#quay.m.daocloud.io/#g"</span> values.yaml</span>
<span class="hljs-meta prompt_">
# </span><span class="bash">é»˜è®¤å‚æ•°å®‰è£…</span>
helm install  cilium ./cilium/ -n kube-system

helm install cilium cilium/cilium --version 1.17.4 -n kube-system
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯ç”¨ipv6</span>
<span class="hljs-meta prompt_"># </span><span class="bash">helm install cilium cilium/cilium -n cilium-system --<span class="hljs-built_in">set</span> ipv6.enabled=<span class="hljs-literal">true</span></span> 
<span class="hljs-meta prompt_">

# </span><span class="bash">å¯ç”¨è·¯ç”±ä¿¡æ¯å’Œç›‘æ§æ’ä»¶</span>
<span class="hljs-meta prompt_"># </span><span class="bash">helm install cilium ./cilium/ --namespace kube-system --<span class="hljs-built_in">set</span> ipv6.enabled=<span class="hljs-literal">true</span> --<span class="hljs-built_in">set</span> hubble.relay.enabled=<span class="hljs-literal">true</span> --<span class="hljs-built_in">set</span> hubble.ui.enabled=<span class="hljs-literal">true</span> --<span class="hljs-built_in">set</span> prometheus.enabled=<span class="hljs-literal">true</span> --<span class="hljs-built_in">set</span> operator.prometheus.enabled=<span class="hljs-literal">true</span> --<span class="hljs-built_in">set</span> hubble.enabled=<span class="hljs-literal">true</span> --<span class="hljs-built_in">set</span> hubble.metrics.enabled=<span class="hljs-string">"{dns,drop,tcp,flow,port-distribution,icmp,http}"</span></span> 
</code></pre>
<h4 data-id="heading-126">9.2.3 æŸ¥çœ‹</h4>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# kubectl  get pod -A | grep cil
NAMESPACE     NAME                               READY   STATUS    RESTARTS   AGE
kube-system   cilium-2tnfb                       1/1     Running   0          60s
kube-system   cilium-5tgcb                       1/1     Running   0          60s
kube-system   cilium-6shf5                       1/1     Running   0          60s
kube-system   cilium-ccbcx                       1/1     Running   0          60s
kube-system   cilium-cppft                       1/1     Running   0          60s
kube-system   cilium-operator-675f685d59-7q27q   1/1     Running   0          60s
kube-system   cilium-operator-675f685d59-kwmqz   1/1     Running   0          60s
[root@k8s-master01 ~]#
</code></pre>
<h4 data-id="heading-127">9.2.4 ä¸‹è½½ä¸“å±ç›‘æ§é¢æ¿</h4>
<p>å®‰è£…æ—¶å€™æ²¡æœ‰åˆ›å»º ç›‘æ§å¯ä»¥å¿½ç•¥</p>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 yaml]# wget https://raw.githubusercontent.com/cilium/cilium/1.12.1/examples/kubernetes/addons/prometheus/monitoring-example.yaml

[root@k8s-master01 yaml]# sed -i "s#docker.io/#jockerhub.com/#g" monitoring-example.yaml

[root@k8s-master01 yaml]# kubectl  apply -f monitoring-example.yaml
namespace/cilium-monitoring created
serviceaccount/prometheus-k8s created
configmap/grafana-config created
configmap/grafana-cilium-dashboard created
configmap/grafana-cilium-operator-dashboard created
configmap/grafana-hubble-dashboard created
configmap/prometheus created
clusterrole.rbac.authorization.k8s.io/prometheus created
clusterrolebinding.rbac.authorization.k8s.io/prometheus created
service/grafana created
service/prometheus created
deployment.apps/grafana created
deployment.apps/prometheus created
[root@k8s-master01 yaml]#
</code></pre>
<h4 data-id="heading-128">9.2.5 ä¿®æ”¹ä¸ºNodePort</h4>
<p>å®‰è£…æ—¶å€™æ²¡æœ‰åˆ›å»º ç›‘æ§å¯ä»¥å¿½ç•¥</p>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 yaml]# kubectl  edit svc  -n kube-system hubble-ui
service/hubble-ui edited
[root@k8s-master01 yaml]#
[root@k8s-master01 yaml]# kubectl  edit svc  -n cilium-monitoring grafana
service/grafana edited
[root@k8s-master01 yaml]#
[root@k8s-master01 yaml]# kubectl  edit svc  -n cilium-monitoring prometheus
service/prometheus edited
[root@k8s-master01 yaml]#

type: NodePort
</code></pre>
<h4 data-id="heading-129">9.2.6 æŸ¥çœ‹ç«¯å£</h4>
<p>å®‰è£…æ—¶å€™æ²¡æœ‰åˆ›å»º ç›‘æ§å¯ä»¥å¿½ç•¥</p>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 yaml]# kubectl get svc -A | grep NodePort
cilium-monitoring   grafana          NodePort    10.111.74.3      &lt;none&gt;        3000:32648/TCP   74s
cilium-monitoring   prometheus       NodePort    10.107.240.124   &lt;none&gt;        9090:30495/TCP   74s
kube-system         hubble-ui        NodePort    10.96.185.26     &lt;none&gt;        80:31568/TCP     99s
</code></pre>
<h4 data-id="heading-130">9.2.7 è®¿é—®</h4>
<p>å®‰è£…æ—¶å€™æ²¡æœ‰åˆ›å»º ç›‘æ§å¯ä»¥å¿½ç•¥</p>
<pre><code class="hljs language-shell" lang="shell">http://192.168.1.31:32648
http://192.168.1.31:30495
http://192.168.1.31:31568
</code></pre>
<h2 data-id="heading-131">10.å®‰è£…CoreDNS</h2>
<h3 data-id="heading-132">10.1ä»¥ä¸‹æ­¥éª¤åªåœ¨master01æ“ä½œ</h3>
<h4 data-id="heading-133">10.1.1ä¿®æ”¹æ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹è½½tgzåŒ…</span>
helm repo add coredns https://coredns.github.io/helm
helm pull coredns/coredns
tar xvf coredns-*.tgz
cd coredns/
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¿®æ”¹IPåœ°å€</span>
vim values.yaml
cat values.yaml | grep clusterIP:
clusterIP: "10.96.0.10"
<span class="hljs-meta prompt_">
# </span><span class="bash">ç¤ºä¾‹</span>
---
service:
<span class="hljs-meta prompt_"># </span><span class="bash">clusterIP: <span class="hljs-string">""</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">clusterIPs: []</span>
<span class="hljs-meta prompt_"># </span><span class="bash">loadBalancerIP: <span class="hljs-string">""</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">externalIPs: []</span>
<span class="hljs-meta prompt_"># </span><span class="bash">externalTrafficPolicy: <span class="hljs-string">""</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">ipFamilyPolicy: <span class="hljs-string">""</span></span>
<span class="hljs-meta prompt_">  # </span><span class="bash">The name of the Service</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">If not <span class="hljs-built_in">set</span>, a name is generated using the fullname template</span>
  clusterIP: "10.96.0.10"
  name: ""
  annotations: {}
---
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¿®æ”¹ä¸ºå›½å†…æº</span>
sed -i "s#registry.k8s.io/#k8s.m.daocloud.io/#g" values.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">é»˜è®¤å‚æ•°å®‰è£…</span>
helm install  coredns ./coredns/ -n kube-system
</code></pre>
<h2 data-id="heading-134">11.å®‰è£…Metrics Server</h2>
<h3 data-id="heading-135">11.1ä»¥ä¸‹æ­¥éª¤åªåœ¨master01æ“ä½œ</h3>
<h4 data-id="heading-136">11.1.1å®‰è£…Metrics-server</h4>
<p>åœ¨æ–°ç‰ˆçš„Kubernetesä¸­ç³»ç»Ÿèµ„æºçš„é‡‡é›†å‡ä½¿ç”¨Metrics-serverï¼Œå¯ä»¥é€šè¿‡Metricsé‡‡é›†èŠ‚ç‚¹å’ŒPodçš„å†…å­˜ã€ç£ç›˜ã€CPUå’Œç½‘ç»œçš„ä½¿ç”¨ç‡</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹è½½</span> 
wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server.yaml 
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¿®æ”¹é…ç½®</span>
vim metrics-server.yaml 

---
<span class="hljs-meta prompt_"># </span><span class="bash">1</span>
    - args:
        - --cert-dir=/tmp
        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
        - --kubelet-use-node-status-port
        - --metric-resolution=15s
        - --kubelet-insecure-tls
        - --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.pem
        - --requestheader-username-headers=X-Remote-User
        - --requestheader-group-headers=X-Remote-Group
        - --requestheader-extra-headers-prefix=X-Remote-Extra-
<span class="hljs-meta prompt_">
# </span><span class="bash">2</span>
        volumeMounts:
        - mountPath: /tmp
          name: tmp-dir
        - name: ca-ssl
          mountPath: /etc/kubernetes/pki
<span class="hljs-meta prompt_">
# </span><span class="bash">3</span>
      volumes:
      - emptyDir: {}
        name: tmp-dir
      - name: ca-ssl
        hostPath:
          path: /etc/kubernetes/pki
---
<span class="hljs-meta prompt_">

# </span><span class="bash">ä¿®æ”¹ä¸ºå›½å†…æº dockeræºå¯é€‰</span>
sed -i "s#registry.k8s.io/#k8s.m.daocloud.io/#g" metrics-server.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‰§è¡Œéƒ¨ç½²</span>
kubectl apply -f metrics-server.yaml 
</code></pre>
<h4 data-id="heading-137">11.1.2ç¨ç­‰ç‰‡åˆ»æŸ¥çœ‹çŠ¶æ€</h4>
<pre><code class="hljs language-shell" lang="shell">kubectl  top node
NAME           CPU(cores)   CPU(%)   MEMORY(bytes)   MEMORY(%)   
k8s-master01   182m         2%       2059Mi          58%         
k8s-master02   104m         1%       1577Mi          44%         
k8s-master03   113m         1%       1516Mi          42%         
k8s-node01     53m          0%       915Mi           25%         
k8s-node02     66m          0%       930Mi           26%         
</code></pre>
<h2 data-id="heading-138">12.é›†ç¾¤éªŒè¯</h2>
<h3 data-id="heading-139">12.1éƒ¨ç½²podèµ„æº</h3>
<pre><code class="hljs language-shell" lang="shell">cat&lt;&lt;EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: busybox
  namespace: default
spec:
  containers:
  - name: busybox
    image: docker.m.daocloud.io/library/busybox:1.28
    command:
      - sleep
      - "3600"
    imagePullPolicy: IfNotPresent
  restartPolicy: Always
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹</span>
kubectl  get pod
NAME      READY   STATUS    RESTARTS   AGE
busybox   1/1     Running   0          17s
</code></pre>
<h3 data-id="heading-140">12.2ç”¨podè§£æé»˜è®¤å‘½åç©ºé—´ä¸­çš„kubernetes</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹name</span>
kubectl get svc
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   17h
<span class="hljs-meta prompt_">
# </span><span class="bash">è¿›è¡Œè§£æ</span>
kubectl exec  busybox -n default -- nslookup kubernetes
3Server:    10.96.0.10
Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local

Name:      kubernetes
Address 1: 10.96.0.1 kubernetes.default.svc.cluster.local
</code></pre>
<h3 data-id="heading-141">12.3æµ‹è¯•è·¨å‘½åç©ºé—´æ˜¯å¦å¯ä»¥è§£æ</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æŸ¥çœ‹æœ‰é‚£äº›name</span>
kubectl  get svc -A
NAMESPACE     NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE
default       kubernetes        ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP         76m
kube-system   calico-typha      ClusterIP   10.105.100.82   &lt;none&gt;        5473/TCP        35m
kube-system   coredns-coredns   ClusterIP   10.96.0.10      &lt;none&gt;        53/UDP,53/TCP   8m14s
kube-system   metrics-server    ClusterIP   10.105.60.31    &lt;none&gt;        443/TCP         109s
<span class="hljs-meta prompt_">
# </span><span class="bash">è¿›è¡Œè§£æ</span>
kubectl exec  busybox -n default -- nslookup coredns.kube-system
Server:    10.96.0.10
Address 1: 10.96.0.10 coredns-coredns.kube-system.svc.cluster.local

Name:      coredns-coredns.kube-system
Address 1: 10.96.0.10 coredns-coredns.kube-system.svc.cluster.local
[root@k8s-master01 metrics-server]# 
</code></pre>
<h3 data-id="heading-142">12.4æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»è¦èƒ½è®¿é—®Kubernetesçš„kubernetes svc 443å’Œkube-dnsçš„service 53</h3>
<pre><code class="hljs language-shell" lang="shell">telnet 10.96.0.1 443
Trying 10.96.0.1...
Connected to 10.96.0.1.
Escape character is '^]'.

telnet 10.96.0.10 53
Trying 10.96.0.10...
Connected to 10.96.0.10.
Escape character is '^]'.

curl 10.96.0.10:53
curl: (52) Empty reply from server
</code></pre>
<h3 data-id="heading-143">12.5Podå’ŒPodä¹‹å‰è¦èƒ½é€š</h3>
<pre><code class="hljs language-shell" lang="shell">kubectl get po -owide
NAME      READY   STATUS    RESTARTS   AGE   IP              NODE         NOMINATED NODE   READINESS GATES
busybox   1/1     Running   0          17m   172.27.14.193   k8s-node02   &lt;none&gt;           &lt;none&gt;

kubectl get po -n kube-system -owide
NAME                                       READY   STATUS    RESTARTS   AGE     IP               NODE           NOMINATED NODE   READINESS GATES
calico-kube-controllers-76754ff848-pw4xg   1/1     Running   0          38m     172.25.244.193   k8s-master01   &lt;none&gt;           &lt;none&gt;
calico-node-97m55                          1/1     Running   0          38m     192.168.1.34     k8s-node01     &lt;none&gt;           &lt;none&gt;
calico-node-hlz7j                          1/1     Running   0          38m     192.168.1.32     k8s-master02   &lt;none&gt;           &lt;none&gt;
calico-node-jtlck                          1/1     Running   0          38m     192.168.1.33     k8s-master03   &lt;none&gt;           &lt;none&gt;
calico-node-lxfkf                          1/1     Running   0          38m     192.168.1.35     k8s-node02     &lt;none&gt;           &lt;none&gt;
calico-node-t667x                          1/1     Running   0          38m     192.168.1.31     k8s-master01   &lt;none&gt;           &lt;none&gt;
calico-typha-59d75c5dd4-gbhfp              1/1     Running   0          38m     192.168.1.35     k8s-node02     &lt;none&gt;           &lt;none&gt;
coredns-coredns-c5c6d4d9b-bd829            1/1     Running   0          10m     172.25.92.65     k8s-master02   &lt;none&gt;           &lt;none&gt;
metrics-server-7c8b55c754-w7q8v            1/1     Running   0          3m56s   172.17.125.3     k8s-node01     &lt;none&gt;           &lt;none&gt;
<span class="hljs-meta prompt_">
# </span><span class="bash">è¿›å…¥busybox pingå…¶ä»–èŠ‚ç‚¹ä¸Šçš„pod</span>

kubectl exec -ti busybox -- sh
/ # ping 192.168.1.34
PING 192.168.1.34 (192.168.1.34): 56 data bytes
64 bytes from 192.168.1.34: seq=0 ttl=63 time=0.358 ms
64 bytes from 192.168.1.34: seq=1 ttl=63 time=0.668 ms
64 bytes from 192.168.1.34: seq=2 ttl=63 time=0.637 ms
64 bytes from 192.168.1.34: seq=3 ttl=63 time=0.624 ms
64 bytes from 192.168.1.34: seq=4 ttl=63 time=0.907 ms
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯ä»¥è¿é€šè¯æ˜è¿™ä¸ªpodæ˜¯å¯ä»¥è·¨å‘½åç©ºé—´å’Œè·¨ä¸»æœºé€šä¿¡çš„</span>
</code></pre>
<h3 data-id="heading-144">12.6åˆ›å»ºä¸‰ä¸ªå‰¯æœ¬ï¼Œå¯ä»¥çœ‹åˆ°3ä¸ªå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼ˆç”¨å®Œå¯ä»¥åˆ äº†ï¼‰</h3>
<pre><code class="hljs language-shell" lang="shell">cat&lt;&lt;EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
EOF

kubectl  get pod 
NAME                               READY   STATUS    RESTARTS   AGE
busybox                            1/1     Running   0          6m25s
nginx-deployment-9456bbbf9-4bmvk   1/1     Running   0          8s
nginx-deployment-9456bbbf9-9rcdk   1/1     Running   0          8s
nginx-deployment-9456bbbf9-dqv8s   1/1     Running   0          8s
<span class="hljs-meta prompt_">
# </span><span class="bash">åˆ é™¤nginx</span>
[root@k8s-master01 ~]# kubectl delete deployments nginx-deployment 
</code></pre>
<h2 data-id="heading-145">13.å®‰è£…dashboard</h2>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ·»åŠ æºä¿¡æ¯</span>
helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/
<span class="hljs-meta prompt_">

# </span><span class="bash">ä¿®æ”¹ä¸ºå›½å†…æº</span>
helm pull kubernetes-dashboard/kubernetes-dashboard
tar xvf kubernetes-dashboard-*.tgz
cd kubernetes-dashboard
sed -i "s#docker.io/#jockerhub.com/#g" values.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">é»˜è®¤å‚æ•°å®‰è£…</span>
helm upgrade --install kubernetes-dashboard ./kubernetes-dashboard/  --create-namespace --namespace kube-system
<span class="hljs-meta prompt_">

# </span><span class="bash">æˆ‘çš„é›†ç¾¤ä½¿ç”¨é»˜è®¤å‚æ•°å®‰è£… kubernetes-dashboard-kong å‡ºç°å¼‚å¸¸ 8444 ç«¯å£å ç”¨</span>
<span class="hljs-meta prompt_"># </span><span class="bash">ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…ï¼Œåœ¨å®‰è£…æ—¶å…³é—­kong.tlsåŠŸèƒ½</span>
helm upgrade --install kubernetes-dashboard ./kubernetes-dashboard/ --namespace kube-system --set kong.admin.tls.enabled=false
</code></pre>
<h3 data-id="heading-146">13.1æ›´æ”¹dashboardçš„svcä¸ºNodePortï¼Œå¦‚æœå·²æ˜¯è¯·å¿½ç•¥</h3>
<pre><code class="hljs language-shell" lang="shell">kubectl edit svc  -n kube-system kubernetes-dashboard-kong-proxy
  type: NodePort
</code></pre>
<h3 data-id="heading-147">13.2æŸ¥çœ‹ç«¯å£å·</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 ~]# kubectl get svc kubernetes-dashboard-kong-proxy -n kube-system
NAME                              TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE
kubernetes-dashboard-kong-proxy   NodePort   10.100.9.217   &lt;none&gt;        443:31330/TCP   42s
[root@k8s-master01 ~]# 
</code></pre>
<h3 data-id="heading-148">13.3åˆ›å»ºtoken</h3>
<pre><code class="hljs language-shell" lang="shell">cat &gt; dashboard-user.yaml &lt;&lt; EOF
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kube-system
EOF

kubectl  apply -f dashboard-user.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">åˆ›å»ºtoken</span>
kubectl -n kube-system create token admin-user
eyJhbGciOiJSUzI1NiIsImtpZCI6ImtxelI3UzBZOFl5MGtWU1k0c2QyUVRaOXhQeEFNYTNHWlNyRUFucHBIVGMifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzY2MTUzNDIwLCJpYXQiOjE3NjYxNDk4MjAsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiN2E1NWM3MDEtODc5ZC00YjBmLTg2YTMtNWVmMDBjZjE0NGI0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiZTc5ODAyMzYtNTUyOC00NjRjLWFlOTctMWVmNDJiMWY3ODhhIn19LCJuYmYiOjE3NjYxNDk4MjAsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTphZG1pbi11c2VyIn0.oDH1uZAWnxeq7gun0ej0ihbSJa6YYZwXcDt9O_tHQsWRi9Lr4kcusG0sm6UntEAy7fHLf6UWLTNHtv-V2lvDjUxRM46xQUzDOQ2v5hBI9NnpcRXQRvMvwn0s6wFeGNr2aFZ9i9aeSJZTdqHOlBjrqxsJtYD6fqDGtJYGdbvUA50nvXPN25a9ofgKvEtWjMA50ojGCr3yqF3vrWruEV77suFeYyIye5YXMnJw_I7Cp3zSEwrAuqfyVAlRv8mYQKxZJsNyban2-wcV10V5qzkofSL4DkgBaqqTDh1aOeD2NJrjmLKPQUt8meLohYy5tMGoyZgx0NGzr-9R71KF8tFHoA
</code></pre>
<h3 data-id="heading-149">13.4åˆ›å»ºé•¿æœŸtoken</h3>
<pre><code class="hljs language-shell" lang="shell">cat &gt; dashboard-user-token.yaml &lt;&lt; EOF
apiVersion: v1
kind: Secret
metadata:
  name: admin-user
  namespace: kube-system
  annotations:
    kubernetes.io/service-account.name: "admin-user"   
type: kubernetes.io/service-account-token  
EOF

kubectl  apply -f dashboard-user-token.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹å¯†ç </span>
kubectl get secret admin-user -n kube-system -o jsonpath={".data.token"} | base64 -d

eyJhbGciOiJSUzI1NiIsImtpZCI6ImtxelI3UzBZOFl5MGtWU1k0c2QyUVRaOXhQeEFNYTNHWlNyRUFucHBIVGMifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJlNzk4MDIzNi01NTI4LTQ2NGMtYWU5Ny0xZWY0MmIxZjc4OGEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.etS6ehzcPjtdipt4zm3L2FJpcbYFlJGLGXmrd8dLMGDw2xVU5XQgZM2gMrHa_rrJPnRKcksaG7qNpasM574D7__CpcktduTM_EsUiOc5i7u9lHDMxsPczyiFxlOp7d8jOdNbqwnlEPA5iYWJ6P3Cj3LiDfFKKHQChKgv8mS588Eh-nnYiMsblWltqvPd_DOJ9JxJ4G4T25yWsbEgpH3uZmXUAyVUDNgDFLNIKRPQXLg5d07rlmgHjJInvEsnrrCs8dxp173iNW8LYxnDNy7pwjrXbvniYiRXjltAwc6F68G590hQaogy9AEVUskeTgBvONPJwkZRHbf0beOL30pT0w
</code></pre>
<h3 data-id="heading-150">13.5ç™»å½•dashboard</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2F192.168.1.31%3A31268%2F" target="_blank" title="https://192.168.1.31:31268/" ref="nofollow noopener noreferrer">https://192.168.1.31:31268/</a></p>
<h2 data-id="heading-151">14.éƒ¨ç½²metallb</h2>
<h3 data-id="heading-152">14.1 ä¸‹è½½éƒ¨ç½²</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">ä¸‹è½½åº”ç”¨åŒ…</span>
wget https://raw.githubusercontent.com/metallb/metallb/v0.15.2/config/manifests/metallb-native.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">ä¿®æ”¹é•œåƒåœ°å€</span>
<span class="hljs-meta prompt_"># </span><span class="bash">è‡ªè¡Œæ‰¾ä»£ç†</span>
sed -i "s#quay.io#quay.chenby.cn#g" metallb-native.yaml 
cat metallb-native.yaml | grep image
        image: quay.chenby.cn/metallb/controller:v0.14.5
        image: quay.chenby.cn/metallb/speaker:v0.14.5
        
<span class="hljs-meta prompt_"># </span><span class="bash">æ‰§è¡Œéƒ¨ç½²</span>
kubectl apply -f metallb-native.yaml
<span class="hljs-meta prompt_">
# </span><span class="bash">å¯ä»¥è¿æ¥å›½é™…ç½‘ç»œ</span>
<span class="hljs-meta prompt_"># </span><span class="bash">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.15.2/config/manifests/metallb-native.yaml</span>
</code></pre>
<h3 data-id="heading-153">14.2 æŸ¥çœ‹è¿è¡Œæƒ…å†µ</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-master01 kubernetes-v1.35.0]# kubectl -n metallb-system get all 
NAME                              READY   STATUS              RESTARTS   AGE
pod/controller-59f49888d7-chwst   1/1     Running             0          54s
pod/speaker-4nkv6                 0/1     Running             0          54s
pod/speaker-dzfzs                 0/1     ErrImagePull        0          53s
pod/speaker-fmwgn                 0/1     ContainerCreating   0          53s
pod/speaker-jch8z                 0/1     Running             0          53s
pod/speaker-pplvk                 0/1     Running             0          53s

NAME                              TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
service/metallb-webhook-service   ClusterIP   10.100.70.55   &lt;none&gt;        443/TCP   54s

NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
daemonset.apps/speaker   5         5         0       5            0           kubernetes.io/os=linux   54s

NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/controller   1/1     1            1           54s

NAME                                    DESIRED   CURRENT   READY   AGE
replicaset.apps/controller-59f49888d7   1         1         1       54s
[root@k8s-master01 kubernetes-v1.35.0]# 


</code></pre>
<h3 data-id="heading-154">14.3 é…ç½®VIPçš„èµ„æºæ± </h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">æ–°ç‰ˆæœ¬metallbä½¿ç”¨äº†CRï¼ˆCustom Resourcesï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡IPAddressPoolçš„CRï¼Œè¿›è¡Œåœ°å€æ± çš„å®šä¹‰ã€‚</span>
<span class="hljs-meta prompt_"># </span><span class="bash">å¦‚æœå®ä¾‹ä¸­ä¸è®¾ç½®IPAddressPoolé€‰æ‹©å™¨L2Advertisementï¼›é‚£ä¹ˆL2Advertisementé»˜è®¤ä¸ºè¯¥å®ä¾‹æ‰€æœ‰çš„IPAddressPoolç›¸å…³è”ã€‚</span>

cat &gt; metallb-config-ipaddresspool.yaml &lt;&lt; EOF
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: first-pool
  namespace: metallb-system
spec:
  addresses:
  - 192.168.1.71-192.168.1.75
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">è¿›è¡ŒL2å…³è”åœ°å€æ± çš„ç»‘å®šã€‚</span>

cat &gt; metallb-config-L2Advertisement.yaml &lt;&lt; EOF
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: example
  namespace: metallb-system
spec:
  ipAddressPools:
  - first-pool
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">æ‰§è¡Œéƒ¨ç½²</span>
kubectl apply -f metallb-config-ipaddresspool.yaml
kubectl apply -f metallb-config-L2Advertisement.yaml
</code></pre>
<h2 data-id="heading-155">15.ingresså®‰è£…</h2>
<h3 data-id="heading-156">15.1æ‰§è¡Œéƒ¨ç½²</h3>
<p>å­—æ•°é™åˆ¶ï¼Œè¯¦è§å®Œæ•´ç‰ˆ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcby-chen%2FKubernetes" target="_blank" title="https://github.com/cby-chen/Kubernetes" ref="nofollow noopener noreferrer">github.com/cby-chen/Kuâ€¦</a></p>
<p><strong>å…³äº</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2F" target="_blank" title="https://www.oiox.cn/" ref="nofollow noopener noreferrer">www.oiox.cn/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2Findex.php%2Fstart-page.html" target="_blank" title="https://www.oiox.cn/index.php/start-page.html" ref="nofollow noopener noreferrer">www.oiox.cn/index.php/sâ€¦</a></p>
<p><strong>CSDNã€GitHubã€çŸ¥ä¹ã€å¼€æºä¸­å›½ã€æ€å¦ã€æ˜é‡‘ã€ç®€ä¹¦ã€åä¸ºäº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€å“”å“©å“”å“©ã€ä»Šæ—¥å¤´æ¡ã€æ–°æµªå¾®åšã€ä¸ªäººåšå®¢</strong></p>
<p><strong>å…¨ç½‘å¯æœã€Šå°é™ˆè¿ç»´ã€‹</strong></p>
<p><strong>æ–‡ç« ä¸»è¦å‘å¸ƒäºå¾®ä¿¡å…¬ä¼—å·ï¼šã€ŠLinuxè¿ç»´äº¤æµç¤¾åŒºã€‹</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linuxç³»ç»Ÿè°ƒç”¨å®ç°åŸç†ï¼ˆåŸºäºARM 64, kernel-6.6ï¼‰]]></title>    <link>https://juejin.cn/post/7585390679397810182</link>    <guid>https://juejin.cn/post/7585390679397810182</guid>    <pubDate>2025-12-19T12:30:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585390679397810182" data-draft-id="7585382553289359396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linuxç³»ç»Ÿè°ƒç”¨å®ç°åŸç†ï¼ˆåŸºäºARM 64, kernel-6.6ï¼‰"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-19T12:30:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­éæ„š"/> <meta itemprop="url" content="https://juejin.cn/user/538088404426650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linuxç³»ç»Ÿè°ƒç”¨å®ç°åŸç†ï¼ˆåŸºäºARM 64, kernel-6.6ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/538088404426650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­éæ„š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:30:10.000Z" title="Fri Dec 19 2025 12:30:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”¨æˆ·æ€å‘èµ·ç³»ç»Ÿè°ƒç”¨</h2>
<p>å½“ç”¨æˆ·æ€ä»£ç è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå°†ä¼šè§¦å‘ä¸€æ¬¡å¼‚å¸¸ï¼Œä»è€Œè¿›å…¥å†…æ ¸æ€ã€‚ARM64æä¾›äº†æ±‡ç¼–æŒ‡ä»¤svcï¼Œå®ç°è¯¥åŠŸèƒ½ã€‚å…¶ä¸­x8å¯„å­˜å™¨å­˜å‚¨äº†ç³»ç»Ÿè°ƒç”¨å·ï¼Œå‚æ•°ä¸€èˆ¬å­˜åœ¨x0å¯„å­˜å™¨åˆ°x5å¯„å­˜å™¨ã€‚</p>
<p>ä»¥ä¸‹æ¡ˆä¾‹æ˜¯ç»•è¿‡libcï¼Œç›´æ¥é€šè¿‡å†…è”æ–¹æ³•è°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„æ¡ˆä¾‹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æ‰‹åŠ¨è°ƒç”¨ write ç³»ç»Ÿè°ƒç”¨ï¼ˆARM64ï¼‰</span>
    <span class="hljs-comment">// å‚æ•°ï¼šx0=1(STDOUT), x1=å­—ç¬¦ä¸²åœ°å€, x2=é•¿åº¦, x8=64(write ç³»ç»Ÿè°ƒç”¨å·)</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg = <span class="hljs-string">"Raw Syscall: Hello ARM64\n"</span>;
    <span class="hljs-type">int</span> len = <span class="hljs-number">21</span>;  <span class="hljs-comment">// å­—ç¬¦ä¸²é•¿åº¦</span>
    
    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(
        <span class="hljs-string">"mov x8, #64\n"</span>    <span class="hljs-comment">// x8 = write ç³»ç»Ÿè°ƒç”¨å·ï¼ˆ64ï¼‰</span>
        <span class="hljs-string">"svc #0\n"</span>         <span class="hljs-comment">// è§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ˆARM64 æ ¸å¿ƒæŒ‡ä»¤ï¼‰</span>
        :                   <span class="hljs-comment">// è¾“å‡ºå¯„å­˜å™¨ï¼ˆæ— ï¼‰</span>
        : <span class="hljs-string">"r"</span>(<span class="hljs-number">1</span>), <span class="hljs-string">"r"</span>(msg), <span class="hljs-string">"r"</span>(len)  <span class="hljs-comment">// è¾“å…¥å¯„å­˜å™¨ï¼šx0=1, x1=msg, x2=len</span>
        : <span class="hljs-string">"x8"</span>, <span class="hljs-string">"memory"</span>    <span class="hljs-comment">// å‘Šè¯‰ç¼–è¯‘å™¨ï¼šx8 å’Œå†…å­˜ä¼šè¢«ä¿®æ”¹ï¼Œé¿å…ä¼˜åŒ–</span>
    )</span></span>;

    <span class="hljs-comment">// æ‰‹åŠ¨è°ƒç”¨ exit ç³»ç»Ÿè°ƒç”¨ï¼ˆx8=93, x0=0ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(
        <span class="hljs-string">"mov x8, #93\n"</span>    <span class="hljs-comment">// x8 = exit ç³»ç»Ÿè°ƒç”¨å·ï¼ˆ93ï¼‰</span>
        <span class="hljs-string">"svc #0\n"</span>
        :
        : <span class="hljs-string">"r"</span>(<span class="hljs-number">0</span>)           <span class="hljs-comment">// x0=0ï¼ˆé€€å‡ºç ï¼‰</span>
        : <span class="hljs-string">"x8"</span>
    )</span></span>;

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>ç¼–è¯‘å‡ºä¸­é—´æ±‡ç¼–ä»£ç </p>
<pre><code class="hljs language-arduino" lang="arduino">aarch64-linux-gnu-gcc -S -O0 -fverbose-<span class="hljs-keyword">asm</span> -ffreestanding -nostdlib -o test.s test.c
</code></pre>
<p>ç¼–è¯‘å‡ºæœ€åå¯æ‰§è¡Œæ–‡ä»¶</p>
<pre><code class="hljs language-csharp" lang="csharp">aarch64-linux-gnu-gcc -<span class="hljs-keyword">static</span> -ffreestanding -nostdlib -e main -o test.<span class="hljs-keyword">out</span> test.c
</code></pre>
<h2 data-id="heading-1">å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨</h2>
<p>kernelä¼šåœ¨å†…æ ¸æ€å®ç°è¯¥å¼‚å¸¸å¤„ç†ã€‚</p>
<h3 data-id="heading-2">el0t_64_sync</h3>
<p>kernelçš„ç”¨æˆ·æ€å…¥å£å®ç°ä¸€èˆ¬åœ¨ <em>arch/arm64/kernel/entry.S</em></p>
<pre><code class="hljs language-ini" lang="ini">entry_handler	0, t, 64, sync  <span class="hljs-comment">; å¯ç”¨ EL0 64ä½ åŒæ­¥å¼‚å¸¸ï¼ˆå¦‚SVC/Abort/Trapï¼‰å¤„ç†å…¥å£</span>
entry_handler	0, t, 64, irq   <span class="hljs-comment">; å¯ç”¨ EL0 64ä½ æ™®é€šä¸­æ–­ï¼ˆIRQï¼‰å¤„ç†å…¥å£</span>
entry_handler	0, t, 64, fiq   <span class="hljs-comment">; å¯ç”¨ EL0 64ä½ å¿«é€Ÿä¸­æ–­ï¼ˆFIQï¼‰å¤„ç†å…¥å£</span>
entry_handler	0, t, 64, error <span class="hljs-comment">; å¯ç”¨ EL0 64ä½ ç³»ç»Ÿé”™è¯¯ï¼ˆSErrorï¼‰å¤„ç†å…¥å£</span>
</code></pre>
<p>å…¶ä¸­entry_handlerä¸ºæ±‡ç¼–ä¸­çš„å®ï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">; el:req, ht:req, regsize:req, label:req ä»£è¡¨<span class="hljs-number">4</span>ä¸ªå‚æ•°
; el\el\ht\()_\regsize\()_\label æ‹¼æ¥å‡ºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚el0t_64_sync
	.macro entry_handler el:req, ht:req, regsize:req, label:<span class="hljs-function">req
<span class="hljs-title">SYM_CODE_START_LOCAL</span>(<span class="hljs-params">el\el\ht\(</span>)_\regsize\()_\label)
	kernel_entry \el, \regsize
	mov	x0, sp
	bl	el\el\ht\()_\regsize\()_\label\()_handler
	.<span class="hljs-keyword">if</span> \el</span> == <span class="hljs-number">0</span>
	b	ret_to_user
	.<span class="hljs-keyword">else</span>
	b	ret_to_kernel
	.<span class="hljs-function">endif
<span class="hljs-title">SYM_CODE_END</span>(<span class="hljs-params">el\el\ht\(</span>)_\regsize\()_\label)
	.endm
</span></code></pre>
<p><strong>&lt;include/linux/linkage.h&gt;</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/* SYM_L_* -- linkage of symbols */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_L_GLOBAL(name)			.globl name</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_L_WEAK(name)			.weak name</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_L_LOCAL(name)			<span class="hljs-comment">/* nothing */</span></span>

<span class="hljs-comment">/* SYM_A_* -- align the symbol? */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_A_ALIGN				ALIGN</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_A_NONE				<span class="hljs-comment">/* nothing */</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SYM_CODE_START_LOCAL</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_CODE_START_LOCAL(name)			\
	SYM_START(name, SYM_L_LOCAL, SYM_A_ALIGN)</span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-comment">// ASM_NL æ±‡ç¼–æ¢è¡Œç¬¦</span>
<span class="hljs-comment">// æ­¤å¤„ç”Ÿæˆå‚æ•°nameçš„æ®µ</span>

<span class="hljs-comment">/* SYM_ENTRY -- use only if you have to for non-paired symbols */</span>
<span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SYM_ENTRY</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_ENTRY(name, linkage, align...)		\
	linkage(name) ASM_NL				\
	align ASM_NL					\
	name:</span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-comment">/* SYM_START -- use only if you have to */</span>
<span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SYM_START</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SYM_START(name, linkage, align...)		\
	SYM_ENTRY(name, linkage, align)</span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
</code></pre>
<p>æ‰€ä»¥ä¼šåœ¨entry.sä¸­ç”Ÿæˆel0t_64_syncå‡½æ•°æ®µï¼Œè¯¥å‡½æ•°éå¸¸ç®€å•ï¼Œå…ˆæ‰§è¡Œel0t_64_sync_handlerï¼Œæœ€åè°ƒç”¨ret_to_userè¿”å›ç”¨æˆ·æ€ã€‚</p>
<h3 data-id="heading-3">el0t_64_sync_handler</h3>
<p><strong>&lt;arch/arm64/kernel/entry-common.c&gt;</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function">asmlinkage <span class="hljs-type">void</span> noinstr <span class="hljs-title">el0t_64_sync_handler</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> pt_regs *regs)</span>
</span>{
	<span class="hljs-comment">// ä»esrå¯„å­˜å™¨è¯»å–é™·å…¥å¼‚å¸¸çš„åŸå› </span>
	<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> esr = <span class="hljs-built_in">read_sysreg</span>(esr_el1);

	<span class="hljs-keyword">switch</span> (<span class="hljs-built_in">ESR_ELx_EC</span>(esr)) {
	<span class="hljs-keyword">case</span> ESR_ELx_EC_SVC64: <span class="hljs-comment">// 64 ä½ç”¨æˆ·æ€ SVC ç³»ç»Ÿè°ƒç”¨</span>
		<span class="hljs-built_in">el0_svc</span>(regs);
		<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> ESR_ELx_EC_DABT_LOW:
		<span class="hljs-built_in">el0_da</span>(regs, esr);
	...
}
</code></pre>
<p>el0_svc -&gt; do_el0_svc -&gt; el0_svc_common(arch/arm64/kernel/syscall.cæ–‡ä»¶ä¸­) -&gt; invoke_syscall</p>
<h3 data-id="heading-4">invoke_syscall</h3>
<p><strong>&lt;arch/arm64/kernel/syscall.c&gt;</strong></p>
<pre><code class="hljs language-scss" lang="scss">void <span class="hljs-built_in">do_el0_svc</span>(struct pt_regs *regs)
{
	<span class="hljs-comment">// sys_call_table ç³»ç»Ÿè°ƒç”¨è¡¨</span>
	<span class="hljs-comment">// regs-&gt;regs[8]ä¸­è·å–åˆ°ç³»ç»Ÿè°ƒç”¨å·</span>
	<span class="hljs-built_in">el0_svc_common</span>(regs, regs-&gt;regs[<span class="hljs-number">8</span>], __NR_syscalls, sys_call_table);
}

static void <span class="hljs-built_in">el0_svc_common</span>(struct pt_regs *regs, int scno, int sc_nr,
			   const syscall_fn_t syscall_table[])
{
	...
	<span class="hljs-built_in">invoke_syscall</span>(regs, scno, sc_nr, syscall_table);
	...
}

static long <span class="hljs-built_in">__invoke_syscall</span>(struct pt_regs *regs, syscall_fn_t syscall_fn)
{
	return <span class="hljs-built_in">syscall_fn</span>(regs);
}

static void <span class="hljs-built_in">invoke_syscall</span>(struct pt_regs *regs, unsigned int scno,
			   unsigned int sc_nr,
			   const syscall_fn_t syscall_table[])
{
	long ret;

	<span class="hljs-built_in">add_random_kstack_offset</span>();

	if (scno &lt; sc_nr) {
		syscall_fn_t syscall_fn;
		<span class="hljs-comment">// æ ¹æ®æ–¹æ³•å·æ‰¾åˆ°ç³»ç»Ÿè°ƒç”¨å®ç°</span>
		syscall_fn = syscall_table<span class="hljs-selector-attr">[array_index_nospec(scno, sc_nr)]</span>;
		<span class="hljs-comment">// è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å®ç°</span>
		ret = <span class="hljs-built_in">__invoke_syscall</span>(regs, syscall_fn);
	} else {
		ret = <span class="hljs-built_in">do_ni_syscall</span>(regs, scno);
	}

	<span class="hljs-built_in">syscall_set_return_value</span>(current, regs, <span class="hljs-number">0</span>, ret);

	<span class="hljs-comment">/*
	 * This value will get limited by KSTACK_OFFSET_MAX(), which is 10
	 * bits. The actual entropy will be further reduced by the compiler
	 * when applying stack alignment constraints: the AAPCS mandates a
	 * 16-byte aligned SP at function boundaries, which will remove the
	 * 4 low bits from any entropy chosen here.
	 *
	 * The resulting 6 bits of entropy is seen in SP[9:4].
	 */</span>
	<span class="hljs-built_in">choose_random_kstack_offset</span>(get_random_u16());
}
</code></pre>
<h2 data-id="heading-5">å†…æ ¸å®ç°ç³»ç»Ÿè°ƒç”¨</h2>
<h3 data-id="heading-6">ç³»ç»Ÿè°ƒç”¨è¡¨</h3>
<pre><code class="hljs language-arduino" lang="arduino">...

<span class="hljs-comment">/*
 * Wrappers to pass the pt_regs argument.
 */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __arm64_sys_personality		__arm64_sys_arm64_personality</span>

<span class="hljs-comment">// é€šè¿‡å®å£°æ˜ç³»ç»Ÿè°ƒç”¨çš„å®ç°å‡½æ•°</span>
<span class="hljs-comment">// æ‹¼æ¥çš„å‡½æ•°åï¼Œæ¯”å¦‚ __arm64_mmap</span>
<span class="hljs-meta">#<span class="hljs-keyword">undef</span> __SYSCALL</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __SYSCALL(nr, sym)	asmlinkage long __arm64_##sym(const struct pt_regs *);</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/unistd.h&gt;</span></span>

<span class="hljs-comment">// å®šä¹‰åµŒå¥—å®</span>
<span class="hljs-meta">#<span class="hljs-keyword">undef</span> __SYSCALL</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __SYSCALL(nr, sym)	[nr] = __arm64_##sym,</span>

<span class="hljs-comment">// é€šè¿‡å®ç”Ÿæˆç³»ç»Ÿè°ƒç”¨è¡¨</span>
<span class="hljs-type">const</span> <span class="hljs-type">syscall_fn_t</span> sys_call_table[__NR_syscalls] = {
	[<span class="hljs-number">0</span> ... __NR_syscalls - <span class="hljs-number">1</span>] = __arm64_sys_ni_syscall,
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/unistd.h&gt;</span></span>
};
</code></pre>
<p>unistd.hå¤´æ–‡ä»¶åµŒå¥—ï¼š
arch/arm64/include/asm/unistd.h -&gt; arch/arm64/include/uapi/asm/unistd.h -&gt; include/uapi/asm-generic/unistd.h<br/>
<strong>&lt;include/uapi/asm-generic/unistd.h&gt;</strong> ä¸­ç½—åˆ—äº†ç³»ç»Ÿè°ƒç”¨åˆ—è¡¨ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">...
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __NR_setxattr 5</span>
__SYSCALL(__NR_setxattr, sys_setxattr)
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __NR_lsetxattr 6</span>
__SYSCALL(__NR_lsetxattr, sys_lsetxattr)
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __NR_fsetxattr 7</span>
__SYSCALL(__NR_fsetxattr, sys_fsetxattr)
<span class="hljs-meta">#<span class="hljs-keyword">define</span> __NR_getxattr 8</span>
__SYSCALL(__NR_getxattr, sys_getxattr)
...
</code></pre>
<h3 data-id="heading-7">å®šä¹‰ç³»ç»Ÿè°ƒç”¨</h3>
<p>ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„å‡½æ•°ï¼Œæ˜¯é€šè¿‡<em>SYSCALL_DEFINE</em>å®å®šä¹‰çš„ã€‚
æ¯”å¦‚mmapçš„ç³»ç»Ÿè°ƒç”¨å®ç°å¦‚ä¸‹ï¼š</p>
<p><strong>&lt;arch/arm64/kernel/sys.c&gt;</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/compiler.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/errno.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/mm.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/export.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/sched.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/slab.h&gt;</span></span>
<span class="hljs-comment">// ä¼šåµŒå¥—è°ƒç”¨ #include &lt;asm/syscall_wrapper.h&gt;</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/syscalls.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/cpufeature.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/syscall.h&gt;</span></span>

...

<span class="hljs-built_in">SYSCALL_DEFINE6</span>(mmap, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>, addr, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>, len,
		<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>, prot, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>, flags,
		<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>, fd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>, off)
{
	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">offset_in_page</span>(off) != <span class="hljs-number">0</span>)
		<span class="hljs-keyword">return</span> -EINVAL;

	<span class="hljs-keyword">return</span> <span class="hljs-built_in">ksys_mmap_pgoff</span>(addr, len, prot, flags, fd, off &gt;&gt; PAGE_SHIFT);
}
</code></pre>
<p><strong>&lt;include/linux/syscalls.h&gt;</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/signal.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/list.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/bug.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/sem.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/siginfo.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/quota.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/key.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/personality.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;trace/syscall.h&gt;</span></span>

<span class="hljs-comment">// å¦‚æœæ‰“å¼€è¯¥å®ï¼Œå¼•å…¥syscall_wrapperå¤´æ–‡ä»¶</span>
<span class="hljs-comment">// arm64ä¸Šä½¿ç”¨è¯¥å¤´æ–‡ä»¶çš„ SYSCALL_DEFINE å®å®šä¹‰</span>
 
<span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_ARCH_HAS_SYSCALL_WRAPPER</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;asm/syscall_wrapper.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span> /</span>
...
</code></pre>
<p><strong>&lt;arch/arm64/include/asm/syscall_wrapper.h&gt;</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-id">#define</span> <span class="hljs-built_in">__SYSCALL_DEFINEx</span>(x, name, ...)						\
	asmlinkage long __arm64_sys#<span class="hljs-selector-id">#name</span>(const struct pt_regs *regs);		\
	<span class="hljs-built_in">ALLOW_ERROR_INJECTION</span>(__arm64_sys##name, ERRNO);			\
	static long __se_sys#<span class="hljs-selector-id">#name</span>(__MAP(x,__SC_LONG,__VA_ARGS__));		\
	static inline long __do_sys#<span class="hljs-selector-id">#name</span>(__MAP(x,__SC_DECL,__VA_ARGS__));	\
	asmlinkage long __arm64_sys#<span class="hljs-selector-id">#name</span>(const struct pt_regs *regs);		\
	asmlinkage long __arm64_sys#<span class="hljs-selector-id">#name</span>(const struct pt_regs *regs)		\
	{									\
		return __se_sys#<span class="hljs-selector-id">#name</span>(SC_ARM64_REGS_TO_ARGS(x,__VA_ARGS__));	\
	}									\
	static long __se_sys#<span class="hljs-selector-id">#name</span>(__MAP(x,__SC_LONG,__VA_ARGS__))		\
	{									\
		long ret = __do_sys#<span class="hljs-selector-id">#name</span>(__MAP(x,__SC_CAST,__VA_ARGS__));	\
		<span class="hljs-built_in">__MAP</span>(x,__SC_TEST,__VA_ARGS__);					\
		<span class="hljs-built_in">__PROTECT</span>(x, ret,__MAP(x,__SC_ARGS,__VA_ARGS__));		\
		return ret;							\
	}									\
	static inline long __do_sys#<span class="hljs-selector-id">#name</span>(__MAP(x,__SC_DECL,__VA_ARGS__))

<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">SYSCALL_DEFINE0</span>(sname)							\
	<span class="hljs-built_in">SYSCALL_METADATA</span>(_##sname, <span class="hljs-number">0</span>);						\
	asmlinkage long __arm64_sys_#<span class="hljs-selector-id">#sname</span>(const struct pt_regs *__unused);	\
	<span class="hljs-built_in">ALLOW_ERROR_INJECTION</span>(__arm64_sys_##sname, ERRNO);			\
	asmlinkage long __arm64_sys_#<span class="hljs-selector-id">#sname</span>(const struct pt_regs *__unused)

<span class="hljs-selector-id">#define</span> <span class="hljs-built_in">SYSCALL_DEFINEx</span>(x, sname, ...)				\
	<span class="hljs-built_in">SYSCALL_METADATA</span>(sname, x, __VA_ARGS__)			\
	<span class="hljs-built_in">__SYSCALL_DEFINEx</span>(x, sname, __VA_ARGS__)
</code></pre>
<p>ARM64ä¸Šé»˜è®¤å¼€å¯äº†<strong>ARCH_HAS_SYSCALL_WRAPPER</strong>å®ã€‚</p>
<p><strong>&lt;arch/arm64/Kconfig&gt;</strong></p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-built_in">config</span> ARM64
	def_bool y
	...
	<span class="hljs-built_in">select</span> ARCH_HAS_SYSCALL_WRAPPER
</code></pre>
<p>æ‰€ä»¥ <strong>SYSCALL_DEFINE6 mmap</strong> ä¼šå®šä¹‰ <strong>__arm64_sys_mmap</strong> å‡½æ•°ï¼Œå³ä¸ºç³»ç»Ÿè°ƒç”¨è¡¨ä¸­mmapç³»ç»Ÿè°ƒç”¨çš„å®ç°ã€‚</p>
<h2 data-id="heading-8">CPUå¦‚ä½•æ‰¾åˆ°å¼‚å¸¸å¤„ç†å‡½æ•°</h2>
<p>æ‰§è¡ŒsvcæŒ‡ä»¤ï¼Œä¸ºä»€ä¹ˆä¼šè°ƒåˆ°el0t_64_syncå‡½æ•°å‘¢ï¼Ÿ
å…¶å®æ˜¯é€šè¿‡æŸ¥è¯¢å¯åŠ¨æ—¶è®¾ç½®è¿›ARMè§„å®šçš„å¯„å­˜å™¨å†…å¼‚å¸¸å‘é‡è¡¨ï¼Œæ‰¾åˆ°å¼‚å¸¸å¤„ç†å‡½æ•°åè¿›è¡Œè·³è½¬çš„ã€‚</p>
<h3 data-id="heading-9">ç”Ÿæˆå¼‚å¸¸å‘é‡è¡¨</h3>
<p>å¼‚å¸¸å‘é‡è¡¨ä¹Ÿæ˜¯é€šè¿‡æ±‡ç¼–å®å®ç°çš„ï¼š<br/>
<strong>&lt;arch/arm64/kernel/entry.S&gt;</strong><br/>
<strong>1. å®šä¹‰æ±‡ç¼–å®</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.macro</span> <span class="hljs-selector-tag">kernel_ventry</span>, <span class="hljs-selector-tag">el</span>:<span class="hljs-selector-tag">req</span>, <span class="hljs-selector-tag">ht</span>:<span class="hljs-selector-tag">req</span>, <span class="hljs-selector-tag">regsize</span>:<span class="hljs-selector-tag">req</span>, <span class="hljs-selector-tag">label</span>:<span class="hljs-selector-tag">req</span>
	<span class="hljs-selector-class">.align</span> <span class="hljs-number">7</span>
; ç¬¬ä¸€æ­¥ï¼Œå¦‚æœæ˜¯ä»<span class="hljs-selector-tag">el0</span>è¿›<span class="hljs-selector-tag">el1</span>ï¼Œå¤‡ä»½å’Œæ¸…ç†<span class="hljs-selector-tag">tpidrro_el0</span>
<span class="hljs-selector-class">.Lventry_start</span>\@:
	<span class="hljs-selector-class">.if</span>	\<span class="hljs-selector-tag">el</span> == <span class="hljs-number">0</span>
	<span class="hljs-comment">/*
	 * This must be the first instruction of the EL0 vector entries. It is
	 * skipped by the trampoline vectors, to trigger the cleanup.
	 */</span>
	<span class="hljs-selector-tag">b</span>	<span class="hljs-selector-class">.Lskip_tramp_vectors_cleanup</span>\@
	<span class="hljs-selector-class">.if</span>	\<span class="hljs-selector-tag">regsize</span> == <span class="hljs-number">64</span>
	<span class="hljs-selector-tag">mrs</span>	<span class="hljs-selector-tag">x30</span>, <span class="hljs-selector-tag">tpidrro_el0</span>
	<span class="hljs-selector-tag">msr</span>	<span class="hljs-selector-tag">tpidrro_el0</span>, <span class="hljs-selector-tag">xzr</span>
	<span class="hljs-selector-class">.else</span>
	<span class="hljs-selector-tag">mov</span>	<span class="hljs-selector-tag">x30</span>, <span class="hljs-selector-tag">xzr</span>
	<span class="hljs-selector-class">.endif</span>
<span class="hljs-selector-class">.Lskip_tramp_vectors_cleanup</span>\@:
	<span class="hljs-selector-class">.endif</span>

; ç¬¬äºŒæ­¥ï¼Œåœ¨<span class="hljs-selector-tag">stack</span>ä¸Šæ„å»ºå¼‚å¸¸æ ˆå¸§
	<span class="hljs-selector-tag">sub</span>	<span class="hljs-selector-tag">sp</span>, <span class="hljs-selector-tag">sp</span>, <span class="hljs-selector-id">#PT_REGS_SIZE</span>

; ç¬¬ä¸‰æ­¥ï¼Œè·³è½¬åˆ°å¼‚å¸¸å¤„ç†å‡½æ•°æ®µï¼Œæ¯”å¦‚<span class="hljs-selector-tag">el0t_64_sync</span>
	<span class="hljs-selector-tag">b</span>	<span class="hljs-selector-tag">el</span>\<span class="hljs-selector-tag">el</span>\<span class="hljs-selector-tag">ht</span>\()<span class="hljs-selector-tag">_</span>\<span class="hljs-selector-tag">regsize</span>\()<span class="hljs-selector-tag">_</span>\<span class="hljs-selector-tag">label</span>
<span class="hljs-selector-class">.org</span> <span class="hljs-selector-class">.Lventry_start</span>\@ + <span class="hljs-number">128</span>	<span class="hljs-comment">// Did we overflow the ventry slot?</span>
	<span class="hljs-selector-class">.endm</span>
</code></pre>
<p><strong>2. æ‹¼æ¥æ„å»ºå¼‚å¸¸å‘é‡è¡¨</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">/*
 * Exception vectors.
 */</span>
	.pushsection <span class="hljs-string">".entry.text"</span>, <span class="hljs-string">"ax"</span>

	.align	<span class="hljs-number">11</span>
SYM_CODE_START(vectors)
	kernel_ventry	<span class="hljs-number">1</span>, t, <span class="hljs-number">64</span>, sync		<span class="hljs-comment">// Synchronous EL1t</span>
	kernel_ventry	<span class="hljs-number">1</span>, t, <span class="hljs-number">64</span>, irq		<span class="hljs-comment">// IRQ EL1t</span>
	kernel_ventry	<span class="hljs-number">1</span>, t, <span class="hljs-number">64</span>, fiq		<span class="hljs-comment">// FIQ EL1t</span>
	kernel_ventry	<span class="hljs-number">1</span>, t, <span class="hljs-number">64</span>, <span class="hljs-type">error</span>		<span class="hljs-comment">// Error EL1t</span>

	kernel_ventry	<span class="hljs-number">1</span>, h, <span class="hljs-number">64</span>, sync		<span class="hljs-comment">// Synchronous EL1h</span>
	kernel_ventry	<span class="hljs-number">1</span>, h, <span class="hljs-number">64</span>, irq		<span class="hljs-comment">// IRQ EL1h</span>
	kernel_ventry	<span class="hljs-number">1</span>, h, <span class="hljs-number">64</span>, fiq		<span class="hljs-comment">// FIQ EL1h</span>
	kernel_ventry	<span class="hljs-number">1</span>, h, <span class="hljs-number">64</span>, <span class="hljs-type">error</span>		<span class="hljs-comment">// Error EL1h</span>

	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">64</span>, sync		<span class="hljs-comment">// Synchronous 64-bit EL0</span>
	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">64</span>, irq		<span class="hljs-comment">// IRQ 64-bit EL0</span>
	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">64</span>, fiq		<span class="hljs-comment">// FIQ 64-bit EL0</span>
	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">64</span>, <span class="hljs-type">error</span>		<span class="hljs-comment">// Error 64-bit EL0</span>

	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">32</span>, sync		<span class="hljs-comment">// Synchronous 32-bit EL0</span>
	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">32</span>, irq		<span class="hljs-comment">// IRQ 32-bit EL0</span>
	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">32</span>, fiq		<span class="hljs-comment">// FIQ 32-bit EL0</span>
	kernel_ventry	<span class="hljs-number">0</span>, t, <span class="hljs-number">32</span>, <span class="hljs-type">error</span>		<span class="hljs-comment">// Error 32-bit EL0</span>
SYM_CODE_END(vectors)
</code></pre>
<p>å¼‚å¸¸å‘é‡è¡¨çš„å¸ƒå±€ï¼Œéœ€è¦ä¸¥æ ¼éµå®ˆARMçš„çº¦å®šï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c57b2ff0e24e4658a0f1d39d58f4361a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2Q6Z2e5oSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766752210&amp;x-signature=zMwTi8t7v2GSbGMeeaL%2BkXS8Vb0%3D" alt="image.png" loading="lazy"/>
<em><strong>ã€ŠLearn the architecture - AArch64 Exception Modelã€‹</strong></em></p>
<p>ä¸­æ–‡è§£é‡Šå¦‚ä¸‹ï¼š</p>




























































































































<table><thead><tr><th>ç›¸å¯¹åŸºå€åç§»</th><th>å¼‚å¸¸å…¥å£ç±»å‹</th><th>å¼‚å¸¸ç­‰çº§/æ¨¡å¼</th><th>è§¦å‘åœºæ™¯ï¼ˆä¸¾ä¾‹ï¼‰</th><th>å¯¹åº”å†…æ ¸ä»£ç ä¸­çš„å®</th></tr></thead><tbody><tr><td>0x000</td><td>Synchronous</td><td>EL0 (AArch64)</td><td>ç”¨æˆ·æ€ç³»ç»Ÿè°ƒç”¨ï¼ˆsvc #0ï¼‰ã€æœªå®šä¹‰æŒ‡ä»¤</td><td><code>tramp_ventry (EL0,64)</code></td></tr><tr><td>0x080</td><td>IRQ</td><td>EL0 (AArch64)</td><td>ç”¨æˆ·æ€å¤–è®¾ä¸­æ–­ï¼ˆå¦‚é”®ç›˜ä¸­æ–­ï¼‰</td><td><code>tramp_ventry (EL0,64)</code></td></tr><tr><td>0x100</td><td>FIQ</td><td>EL0 (AArch64)</td><td>ç”¨æˆ·æ€å¿«é€Ÿä¸­æ–­ï¼ˆæå°‘ä½¿ç”¨ï¼‰</td><td><code>tramp_ventry (EL0,64)</code></td></tr><tr><td>0x180</td><td>Error</td><td>EL0 (AArch64)</td><td>ç”¨æˆ·æ€æ•°æ®è®¿é—®é”™è¯¯ï¼ˆå¦‚éæ³•åœ°å€ï¼‰</td><td><code>tramp_ventry (EL0,64)</code></td></tr><tr><td>0x200</td><td>Synchronous</td><td>EL1t (AArch64)</td><td>å†…æ ¸æ€åŒæ­¥å¼‚å¸¸ï¼ˆå¦‚ç©ºæŒ‡é’ˆè®¿é—®ï¼‰</td><td><code>kernel_ventry(1,t,64,sync)</code></td></tr><tr><td>0x280</td><td>IRQ</td><td>EL1t (AArch64)</td><td>å†…æ ¸æ€å¤–è®¾ä¸­æ–­ï¼ˆå¦‚ç½‘å¡ä¸­æ–­ï¼‰</td><td><code>kernel_ventry(1,t,64,irq)</code></td></tr><tr><td>0x300</td><td>FIQ</td><td>EL1t (AArch64)</td><td>å†…æ ¸æ€å¿«é€Ÿä¸­æ–­ï¼ˆæå°‘ä½¿ç”¨ï¼‰</td><td><code>kernel_ventry(1,t,64,fiq)</code></td></tr><tr><td>0x380</td><td>Error</td><td>EL1t (AArch64)</td><td>å†…æ ¸æ€æ•°æ®è®¿é—®é”™è¯¯ï¼ˆå¦‚é¡µè¡¨é”™è¯¯ï¼‰</td><td><code>kernel_ventry(1,t,64,error)</code></td></tr><tr><td>0x400</td><td>Synchronous</td><td>EL1h (AArch64)</td><td>è™šæ‹ŸåŒ–æ¨¡å¼å†…æ ¸åŒæ­¥å¼‚å¸¸</td><td><code>kernel_ventry(1,h,64,sync)</code></td></tr><tr><td>0x480</td><td>IRQ</td><td>EL1h (AArch64)</td><td>è™šæ‹ŸåŒ–æ¨¡å¼å†…æ ¸IRQä¸­æ–­</td><td><code>kernel_ventry(1,h,64,irq)</code></td></tr><tr><td>0x500</td><td>FIQ</td><td>EL1h (AArch64)</td><td>è™šæ‹ŸåŒ–æ¨¡å¼å†…æ ¸FIQä¸­æ–­</td><td><code>kernel_ventry(1,h,64,fiq)</code></td></tr><tr><td>0x580</td><td>Error</td><td>EL1h (AArch64)</td><td>è™šæ‹ŸåŒ–æ¨¡å¼å†…æ ¸é”™è¯¯å¼‚å¸¸</td><td><code>kernel_ventry(1,h,64,error)</code></td></tr><tr><td>0x600</td><td>Synchronous</td><td>EL0 (AArch32)</td><td>32ä½ç”¨æˆ·æ€ç³»ç»Ÿè°ƒç”¨</td><td><code>tramp_ventry (EL0,32)</code></td></tr><tr><td>0x680</td><td>IRQ</td><td>EL0 (AArch32)</td><td>32ä½ç”¨æˆ·æ€IRQä¸­æ–­</td><td><code>tramp_ventry (EL0,32)</code></td></tr><tr><td>0x700</td><td>FIQ</td><td>EL0 (AArch32)</td><td>32ä½ç”¨æˆ·æ€FIQä¸­æ–­</td><td><code>tramp_ventry (EL0,32)</code></td></tr><tr><td>0x780</td><td>Error</td><td>EL0 (AArch32)</td><td>32ä½ç”¨æˆ·æ€é”™è¯¯å¼‚å¸¸</td><td><code>tramp_ventry (EL0,32)</code></td></tr></tbody></table>
<h4 data-id="heading-10">å¤‡ä»½æ¸…ç†tpidrro_el0</h4>
<p>tpidrro_el0ï¼šARM64 æ¶æ„ä¸­EL0ï¼ˆç”¨æˆ·æ€ï¼‰åªè¯»çš„çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTLSï¼‰å¯„å­˜å™¨ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ä¸ºç”¨æˆ·æ€çº¿ç¨‹æä¾› â€œçº¿ç¨‹ç§æœ‰æ•°æ®çš„å¿«é€Ÿè®¿é—®å…¥å£â€ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">.if	\<span class="hljs-attr">regsize</span> == <span class="hljs-number">64</span>
	<span class="hljs-comment">; å°†tpidrro_el0å¤‡ä»½åˆ°x30å¯„å­˜å™¨</span>
	mrs	x30, tpidrro_el0
	<span class="hljs-comment">; ç”¨é›¶å€¼å¯„å­˜å™¨xzræ¸…ç†tpidrro_el0</span>
	msr	tpidrro_el0, xzr
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦ä¿å­˜tpidrro_el0å¯„å­˜å™¨</strong></p>
<ol>
<li>é˜²æ­¢ç”¨æˆ·æ€æ•°æ®æ³„éœ²åˆ°å†…æ ¸æ€ï¼Œå¼•èµ·å®‰å…¨æ€§é—®é¢˜</li>
<li>è°ƒè¯•ç­‰æ“ä½œå¯èƒ½æ±¡æŸ“tpidrro_el0å¯„å­˜å™¨æ•°æ®</li>
<li>tpidrro_el0å¯„å­˜å™¨ä¸ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œæ­¤å¤„ä¸ä¿å­˜çš„è¯ï¼Œå¦‚æœåˆ‡æ¢ä»»åŠ¡åï¼Œtpidrro_el0ä¼šè¢«å…¶ä»–ç”¨æˆ·æ€è¿›ç¨‹å¹²æ‰°æ±¡æŸ“</li>
<li>tpidrro_el0æ˜¯ç”¨æˆ·æ€åªè¯»å¯„å­˜å™¨ï¼Œå› æ­¤ä¾èµ–å†…æ ¸åšå¤‡ä»½å’Œæ¸…ç†æ“ä½œ</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨x30å¯„å­˜å™¨</strong></p>
<p>x30å¯„å­˜å™¨ï¼Œåœ¨arm64ä¸­ä¸ºLink Register (LR)é“¾æ¥å¯„å­˜å™¨ï¼Œå­˜å‚¨å‡½æ•°è°ƒç”¨çš„è¿”å›åœ°å€ï¼ˆbl æŒ‡ä»¤ä¼šè‡ªåŠ¨å°†è¿”å›åœ°å€å†™å…¥ x30ï¼‰ï¼›è‹¥æ— å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¯ä½œä¸ºæ™®é€šé€šç”¨å¯„å­˜å™¨ä½¿ç”¨ã€‚</p>
<ol>
<li>é™·å…¥å¼‚å¸¸æ—¶ï¼Œå¹¶æœªå‘ç”Ÿå‡½æ•°è°ƒç”¨ï¼Œå› æ­¤x30å¯ä»¥å¤ç”¨ã€‚è€Œx0-x29ç­‰é€šç”¨å¯„å­˜å™¨éœ€è¦ä¿ç•™ï¼Œåç»­ä¼šç”¨äºä¿å­˜æ ˆå¸§ã€‚</li>
<li>å¼‚å¸¸åˆ‡æ¢æ—¶ï¼ŒCPUåªä¼šè‡ªåŠ¨ä¿å­˜/æ¢å¤é€šç”¨å¯„å­˜å™¨ï¼ˆx0-x30ï¼‰ï¼Œæ‰€ä»¥ä¼šç”¨x30ä½œä¸ºå¤‡ä»½å¯„å­˜å™¨ã€‚</li>
</ol>
<h3 data-id="heading-11">è®¾ç½®å¼‚å¸¸å‘é‡è¡¨</h3>
<p><strong>&lt;arch/arm64/kernel/head.S&gt;</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">SYM_FUNC_START_LOCAL</span>(__primary_switched)
	adr_l	x4, init_task
	init_cpu_task x4, x5, x6

	<span class="hljs-comment">// åŠ è½½å¼‚å¸¸å‘é‡è¡¨ï¼ˆvectorsï¼‰çš„è™šæ‹Ÿåœ°å€åˆ°x8</span>
	adr_l	x8, vectors			<span class="hljs-comment">// load VBAR_EL1 with virtual</span>
	<span class="hljs-comment">// å°†å‘é‡è¡¨åœ°å€å†™å…¥VBAR_EL1å¯„å­˜å™¨</span>
	msr	vbar_el1, x8			<span class="hljs-comment">// vector table address</span>
	<span class="hljs-comment">// æŒ‡ä»¤åŒæ­¥å±éšœï¼Œç¡®ä¿VBAR_EL1ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ</span>
	isb
	...
</code></pre>
<p>è°ƒç”¨é¡ºåºï¼šprimary_entry -&gt; __primary_switch -&gt; __primary_switchedï¼Œè€Œ primary_entry æ˜¯ ARM64 ä¸» CPU æ ¸ä¸Šç”µåæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªæ±‡ç¼–å…¥å£ã€‚<br/>
VBAR_EL1 æ˜¯ ARM64 æ¶æ„ä¸­EL1ï¼ˆå†…æ ¸æ€ï¼‰çš„å‘é‡åŸºåœ°å€å¯„å­˜å™¨ï¼ˆVector Base Address Registerï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å­˜å‚¨å¼‚å¸¸å‘é‡è¡¨çš„è™šæ‹ŸåŸºåœ°å€ã€‚<br/>
<strong>å› æ­¤å‘ç”Ÿç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œcpué€šè¿‡vbar_el1æŸ¥è¯¢åˆ°å¼‚å¸¸å¤„ç†å‡½æ•°åœ°å€ï¼Œè¿›è€Œè·³è½¬åˆ°å¼‚å¸¸å¤„ç†å‡½æ•°ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++ constexpr]]></title>    <link>https://juejin.cn/post/7585410547337232434</link>    <guid>https://juejin.cn/post/7585410547337232434</guid>    <pubDate>2025-12-19T18:54:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585410547337232434" data-draft-id="7585410547336986674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++ constexpr"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-19T18:54:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sichg"/> <meta itemprop="url" content="https://juejin.cn/user/2276407984011465"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++ constexpr
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2276407984011465/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sichg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T18:54:40.000Z" title="Fri Dec 19 2025 18:54:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>constexpr</code>æ˜¯C++çš„ä¿®é¥°è¯ï¼Œç”¨äºæŒ‡å®šâ€œç¼–è¯‘æœŸå¯ä»¥æ±‚æ•°å€¼çš„å¸¸é‡è¡¨è¾¾å¼â€ï¼Œå¯ç”¨äºä¿®é¥°å˜é‡ï¼Œå‡½æ•°ï¼Œç±»/ç»“æ„ä½“ï¼Œæ„é€ å‡½æ•°/ææ„å‡½æ•°ï¼Œæ¨¡æ¿äº”ç§æƒ…å†µï¼Œä½œç”¨å°±æ˜¯æ”¯æŒç¼–è¯‘æœŸå¸¸é‡å¤„ç†ã€‚<code>constexpr</code>çš„å®é™…åº”ç”¨ä¸­æœ€å¸¸ç”¨çš„æ˜¯ä¿®é¥°å˜é‡å’Œå‡½æ•°ã€‚</p>
<ul>
<li><code>constexpr</code>ç”¨äºä¿®é¥°å˜é‡ï¼Œå¯ä»¥æ„å»ºçœŸå¸¸é‡ï¼Œå³ç¼–è¯‘å™¨å¸¸é‡ã€‚</li>
<li><code>constexpr</code>ç”¨äºä¿®é¥°å‡½æ•°ï¼Œå¯ä»¥ç”¨äºç¼–è¯‘æœŸæ±‚å€¼ï¼›</li>
<li><code>constexpr</code>ç”¨äºä¿®é¥°ç±»/ç»“æ„ä½“ã€‚å¯ä»¥ç”¨æ¥åœ¨ç¼–è¯‘æœŸæ„é€ å¯¹è±¡ï¼›</li>
<li><code>constexpr</code>ç”¨äºä¿®é¥°æ„é€ å‡½æ•°/ææ„å‡½æ•°ï¼Œå¯ä»¥åœ¨ç¼–è¯‘å™¨å°±å¯¹ç±»å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–/é”€æ¯ï¼›</li>
<li><code>constexpr</code>ç”¨äºä¿®é¥°æ¨¡æ¿ï¼Œåœ¨ç¼–è¯‘æœŸé—´å®Œæˆæ¨¡æ¿å®ä¾‹åŒ–è¿›è¡Œæ±‚æ•°å€¼ã€‚</li>
</ul>
<p>å¢åŠ ç¼–è¯‘æœŸé—´æ±‚è§£çš„æ•ˆæœæ˜¯æå‡æ€§èƒ½ã€å¢å¼ºç±»å‹å®‰å…¨ã€‚</p>
<h4 data-id="heading-0">å®ä¾‹1â€”â€”<code>constexpr</code>ä¿®é¥°å˜é‡ï¼š</h4>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> MAXsize = <span class="hljs-number">100</span>; <span class="hljs-comment">// ç”±constexpträ¿®é¥°çš„intå‹çœŸå¸¸é‡ï¼Œ</span>
<span class="hljs-comment">//åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥é€šè¿‡ç›´æ¥èµ‹å€¼ç¡®å®šå–å€¼ä¸º100.</span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> OVERsize = MAXsize + <span class="hljs-number">50</span>ï¼›
<span class="hljs-comment">//åœ¨ç¼–è¯‘æœŸå¯ä»¥é€šè¿‡è®¡ç®—å¾—åˆ°ç¡®å®šå–å€¼ä¸º150.</span>
<span class="hljs-comment">//ç”±constexprä¿®é¥°çš„MAXsizeå’ŒOVERsizeä¸¤ä¸ªçœŸå¸¸é‡ï¼Œåˆ†åˆ«å–å€¼100å’Œ150.</span>
<span class="hljs-comment">//ç¼–è¯‘æ­£å¸¸ã€‚ç¬¦åˆå¤„ç†ç›´è§‰ã€‚</span>
</code></pre>
<p>æé—®ï¼š
constexpr å¯ä»¥ä¿®é¥°å˜é‡ï¼Œæ­¤æ—¶è¯¥å˜é‡æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼ˆå€¼å¿…é¡»åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œä¸”ç”Ÿå‘½å‘¨æœŸå†…ä¸å¯ä¿®æ”¹ï¼Œæ¯” const æ›´ä¸¥æ ¼ï¼‰å¦‚æœè¿™ä¸ªå˜é‡çš„å–å€¼åœ¨ç¼–è¯‘æœŸé—´æ²¡æœ‰ç¡®å®šä¼šæŠ¥é”™å—?è¿˜æ˜¯ä»»æ„ç»™è¿™ä¸ªå˜é‡å–å®šä¸€ä¸ªéšæœºå€¼?å–å®šéšæœºå€¼ä¼šå¯¼è‡´è¿™ä¸ªå˜é‡å®é™…æ²¡æœ‰å¯ç”¨æ•ˆæœ? ä»¥åŠè¿™é‡Œè®²çš„ç”Ÿå‘½å‘¨æœŸä¸å¯ä¿®æ”¹æ˜¯ä»€ä¹ˆæ„æ€?ä¸€ä¸ªconstexprä¿®é¥°çš„çœŸå¸¸é‡çš„ç”Ÿå‘½å‘¨æœŸä¸å°±æ˜¯æ•´ä¸ªç¨‹åºè¿è¡Œçš„æœŸé—´éƒ½æœ‰æ•ˆå—?ç¼–è¯‘æœŸå¸¸é‡å³çœŸå¸¸é‡æ˜¯ä¸å ç”¨C++å †å†…å­˜å’Œæ ˆå†…å­˜çš„å§ï¼</p>
<pre><code class="hljs language-arduino" lang="arduino">è§£ç­”ï¼š
<span class="hljs-comment">// constexpr ä¿®é¥°å˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„æ•°å€¼å¿…é¡»åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œç”Ÿå‘½å‘¨æœŸå†…ä¸å¯ä¿®æ”¹ã€‚</span>
<span class="hljs-comment">// å¦‚æœç¼–è¯‘æœŸé—´è¿™ä¸ªå˜é‡çš„æ•°å€¼æ²¡æœ‰ç¡®å®šæŒ‡å®šï¼Œä¼šç›´æ¥ç¼–è¯‘æŠ¥é”™ï¼Œæ— éšæœºå€¼ã€‚</span>
<span class="hljs-comment">// constexpr ä¿®é¥°å¾—åˆ°çš„çœŸå¸¸é‡åœ¨ç”Ÿå‘½å‘¨æœŸå†…éƒ½åªå…·æœ‰åªè¯»å±æ€§ï¼Œä¸å¯ä¿®æ”¹ã€‚</span>
<span class="hljs-comment">// constexpr ä¿®é¥°å¾—åˆ°çš„çœŸå¸¸é‡çš„ç”Ÿå‘½å‘¨æœŸå–å†³äºå˜é‡å®šä¹‰æ‰€åœ¨çš„ä½œç”¨åŸŸå†³å®šã€‚</span>
    <span class="hljs-comment">// å³constexpråªè´Ÿè´£è·Ÿç¼–è¯‘å™¨é€šåŠ›åˆä½œåœ¨ç¼–è¯‘æœŸé—´ç¡®å®šæ•°å€¼ã€‚</span>
    <span class="hljs-comment">// è‡³äºè¿™ä¸ªçœŸå¸¸é‡åœ¨ä½•æ—¶å¤±æ•ˆå–å†³äºè¿™ä¸ªå˜é‡çš„è‡ªèº«çš„ä½œç”¨åŸŸï¼Œ</span>
    <span class="hljs-comment">// å³å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼Œå³ä¾¿åŠ ä¸Šconstexprä¿®é¥°ï¼Œ</span>
    <span class="hljs-comment">// è¿™ä¸ªçœŸå¸¸é‡çš„ç”Ÿå‘½å‘¨æœŸä¾ç„¶åªåœ¨å‡½æ•°å†…çš„å±€éƒ¨ä½œç”¨åŸŸæ•ˆæœä¸‹ã€‚constexprä¿®é¥°çš„çœŸå¸¸é‡è¢«å­˜å‚¨åœ¨é™æ€åªè¯»æ•°æ®åŒºã€‚</span>
</code></pre>
<p>æ€»ç»“1ï¼š</p>
<ul>
<li><code>constexpr</code>ä¿®é¥°å˜é‡ï¼Œå¾—åˆ°çœŸå¸¸é‡ï¼Œå­˜å‚¨åœ¨é™æ€å­˜å‚¨åŒºï¼Œä¸å ç”¨è¿è¡Œå†…å­˜ï¼›ï¼ˆå› æ­¤å¢å¼ºæ€§èƒ½ï¼‰</li>
<li><code>constexpr</code>ä¿®é¥°å¾—åˆ°çš„çœŸå¸¸é‡ï¼Œå¦‚æœæ²¡æœ‰åœ¨ç¼–è¯‘æœŸæŒ‡å®šï¼Œç›´æ¥æŠ¥é”™ã€‚</li>
<li><code>constexpr</code>ä¿®é¥°å¾—åˆ°çš„çœŸå¸¸é‡ï¼Œç”Ÿå‘½å‘¨æœŸå†…æƒé™ä¸ºåªè¯»ï¼Œä¸å¯ä¿®æ”¹ã€‚</li>
<li><code>constexpr</code>ä¿®é¥°å¾—åˆ°çš„çœŸå¸¸é‡ï¼Œç”Ÿå‘½å‘¨æœŸé•¿åº¦å–å†³äºå˜é‡æœ¬èº«çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
</ul>
<h4 data-id="heading-1">å®ä¾‹2â€”â€”<code>constexpr</code>ä¿®é¥°å‡½æ•°ï¼š</h4>
<p>è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ï¼Œå¦‚æœå…¥å‚æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼Œåœ¨ç¼–è¯‘æœŸå®Œæˆè®¡ç®—å¾—åˆ°å¤„ç†ç»“æœã€‚å¦‚æœå…¥å‚ä¸æ˜¯ç¼–è¯‘æœŸé—´å¸¸é‡ï¼Œé‚£å°±é€€åŒ–æˆæ™®é€šå‡½æ•°ã€‚ä¸¤ç§æƒ…å†µéƒ½ä¸ä¼šæŠ¥é”™ã€‚UDLå’Œæ™®é€šå‡½æ•°éƒ½æ”¯æŒè¿™ç§é€€åŒ–å…¼å®¹ã€‚</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-comment">//constexprä¿®é¥°UDL(è‡ªå®šä¹‰å­—é¢å€¼è¿ç®—ç¬¦)</span>
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> <span class="hljs-keyword">operator</span> <span class="hljs-string">""</span> _KM2m(<span class="hljs-type">long</span> <span class="hljs-type">long</span> kilometer) {
    <span class="hljs-keyword">return</span> kilometer*<span class="hljs-number">1000</span>;
}
<span class="hljs-comment">//constexprä¿®é¥°æ™®é€šå‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span>{
    <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<h4 data-id="heading-2">å®ä¾‹3â€”â€”<code>constexpr</code>ä¿®é¥°ç±»/ç»“æ„ä½“ï¼š</h4>
<p>ä½œç”¨æ˜¯åœ¨ç¼–è¯‘æœŸæ„é€ ç±»å¯¹è±¡ï¼Œå³<strong>ç¼–è¯‘æœŸå¸¸é‡å¯¹è±¡</strong>ã€‚
è¦æ±‚ï¼š</p>
<ul>
<li>ç±»çš„æ„é€ å‡½æ•°å¿…é¡»æ˜¯<code>constexpr</code>æ„é€ å‡½æ•°ï¼›</li>
<li>ç¼–è¯‘æœŸå†…éœ€è°ƒç”¨çš„æˆå‘˜å‡½æ•°ä¹Ÿå¿…é¡»æœ‰<code>constexpr</code>ä¿®é¥°ï¼›</li>
<li>ç±»çš„æˆå‘˜å˜é‡ä¸­ï¼Œå¯¹äºè¢«<code>constexpr</code>ä½¿ç”¨/ä¾èµ–çš„é™æ€æˆå‘˜å˜é‡ï¼Œå¿…é¡»åœ¨ç±»å†…<code>constexpr</code>ä¿®é¥°ã€‚è€Œä¸”æœ€å¥½ç›´æ¥ç”¨<code>static constexpr</code></li>
</ul>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-comment">//constexprä¿®é¥°ç»“æ„ä½“(åœ¨C++ä¸­å°†ç»“æ„ä½“è§†ä¸ºç±»çš„ä¸€ç§)</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span>{

    <span class="hljs-comment">//constexpr ä¿®é¥°æ„é€ å‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-title">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x_, <span class="hljs-type">int</span> y_)</span> ï¼š <span class="hljs-title">x</span><span class="hljs-params">(x_)</span>, <span class="hljs-title">y</span><span class="hljs-params">(y_)</span> </span>{}
        <span class="hljs-comment">// C++ä¸­çº¦å®šä¿—æˆç”¨ å˜é‡åå³åŠ ä¸‹åˆ’çº¿ è¡¨ç¤ºç±»æˆå‘˜å˜é‡çš„å‘½åã€‚</span>
        <span class="hljs-comment">// x(x_), y(y_) æ˜¯ C++ ä¸­çš„ã€Œæˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼ˆMember Initialization Listï¼‰</span>
            <span class="hljs-comment">// æ•ˆæœæ˜¯å°†x_,y_çš„å€¼å¯¹åº”èµ‹å€¼ç»™xï¼Œy</span>
            <span class="hljs-comment">// `x(x_)`Â å’ŒÂ `x=x_`Â åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­ç­‰ä»·</span>
            
    <span class="hljs-comment">//constexpr ä¿®é¥°æ„é€ å‡½æ•°</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">get_x</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span>}
    }
    
    <span class="hljs-type">int</span> x;
    <span class="hljs-type">int</span> y;
   }
   
   <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">()</span> </span>{
       <span class="hljs-comment">//ç¼–è¯‘å™¨æ„é€ Ponitå¯¹è±¡</span>
       <span class="hljs-function"><span class="hljs-keyword">constexpr</span> Point <span class="hljs-title">p0</span><span class="hljs-params">(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>)</span></span>;
       <span class="hljs-comment">//ç¼–è¯‘æœŸè°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œè·å–æ•°å€¼</span>
       <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> x_val = p0.<span class="hljs-built_in">get_x</span>(); 
       <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
   }
</code></pre>
<ul>
<li>éé™æ€æˆå‘˜å˜é‡æ˜¯æŒ‡å±äºå•ä¸ªå¯¹è±¡çš„å˜é‡ï¼Œæ¯ä¸ªå¯¹è±¡ç‹¬ä¸€ä»½ï¼Œç”Ÿå‘½å‘¨æœŸéšå¯¹è±¡å˜åŒ–ï¼›</li>
<li>é™æ€æˆå‘˜å˜é‡å±äºç±»æœ¬èº«çš„ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«ä¸€ä»½ï¼Œç”Ÿå‘½å‘¨æœŸè´¯ç©¿ç¨‹åºã€‚
<ul>
<li>é™æ€constæˆå‘˜å˜é‡ï¼šç±»å†…ç›´æ¥åˆå§‹åŒ–ï¼Œå› ä¸ºè´¯ç©¿ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸”åœ¨è¿è¡ŒæœŸé—´æ•°å€¼ä¸å¯ä¿®æ”¹ï¼Œæ˜¯ç»‘å®šåœ¨æ•´ä¸ªç±»ä¸Šçš„å˜é‡ã€‚<code>static const</code> å˜é‡ç±»å‹ å˜é‡å = åˆå§‹åŒ–æ•°å€¼ï¼›
<ul>
<li><code>static constexpr</code> å˜é‡ç±»å‹ å˜é‡å = åˆå§‹åŒ–æ•°å€¼; æ•ˆæœæ›´å¥½ã€‚</li>
</ul>
</li>
<li>-è¿™é‡Œçš„staticå…¶å®æ˜¯æŒ‡ç±»å…±äº«ã€‚é™æ€å˜é‡æœ¬è´¨æ˜¯ç±»å…±äº«å˜é‡ï¼›éé™æ€å˜é‡æ˜¯ç±»ä¸å…±äº«å˜é‡ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">å®ä¾‹4â€”â€”<code>constexpr</code>ä¿®é¥°æ„é€ å‡½æ•°/ææ„å‡½æ•°ï¼š</h4>
<p>æ„é€ å‡½æ•°ç”¨<code>constexpr</code>ä¿®é¥°ï¼Œè¦ä¹ˆéç©ºè¦ä¹ˆåªæ¶‰åŠåŸºæœ¬å››åˆ™è¿ç®—å’Œåˆ¤æ–­çš„ç®€æ´å‡½æ•°ä½“ã€‚
ææ„å‡½æ•°ç”¨<code>constexpr</code>ä¿®é¥°ï¼Œå¾—åˆ°çš„æ•ˆæœæ˜¯ç¼–è¯‘æœŸå¯¹è±¡é”€æ¯æ—¶æ²¡æœ‰è¿è¡ŒæœŸå¼€é”€ã€‚
ï¼ˆ<code>constexpr</code>ä¿®é¥°çš„æ•ˆæœè¦ä¹ˆæ˜¯ç”¨äºè®¾å®šçœŸå¸¸é‡ï¼Œè¦ä¹ˆæ˜¯èƒ½åœ¨ç¼–è¯‘æœŸé—´èƒ½å¤„ç†çš„äº‹æƒ…ç»™å¤„ç†äº†ã€‚ï¼‰</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyInt</span>{

    <span class="hljs-keyword">public</span>: 
        <span class="hljs-comment">//æ„é€ å‡½æ•°</span>
        <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-title">MyInt</span> <span class="hljs-params">(<span class="hljs-type">int</span> val_)</span> : val(val_) {</span>}
        <span class="hljs-comment">//ææ„å‡½æ•°</span>
        <span class="hljs-keyword">constexpr</span> ~<span class="hljs-built_in">MyInt</span>() = <span class="hljs-keyword">default</span>; <span class="hljs-comment">//ææ„å‡½æ•°ç›´æ¥ = default å°±è¡Œã€‚</span>
        <span class="hljs-comment">//æˆå‘˜å‡½æ•°</span>
        <span class="hljs-function"><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> <span class="hljs-title">get_val</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
            <span class="hljs-keyword">return</span> val;
        }

    <span class="hljs-keyword">private</span>:
        <span class="hljs-type">int</span> val;
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">//åœ¨ç¼–è¯‘æœŸæ„é€  MyInt å¯¹è±¡</span>
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> MyInt <span class="hljs-title">mi</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> val = mi.<span class="hljs-built_in">get_val</span>(); <span class="hljs-comment">// ç¼–è¯‘æœŸæ±‚å€¼ä¸º100</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>å…³è”è¯´æ˜ç±»æˆå‘˜å‡½æ•°çš„<code>const</code>å°¾ç¼€ä¿®é¥°ï¼š
<code>constexpr int get_val() const {             return val; //è¿™ä¸ªconstæˆå‘˜å‡½æ•°åªè¯»å–ï¼Œæ²¡æœ‰ä¿®æ”¹valçš„æƒé™ã€‚         }</code></p>
<h5 data-id="heading-4"><code>const</code>æˆå‘˜å‡½æ•°</h5>
<p>ä½œç”¨æ˜¯é™å®šè¿™ä¸ªæˆå‘˜å‡½æ•°å¯¹æˆå‘˜å˜é‡çš„æ“ä½œæƒé™ä»…ä»…æ˜¯åªè¯»ã€‚</p>
<ul>
<li>ç¦æ­¢ä¿®æ”¹ç±»çš„éé™æ€æˆå‘˜å˜é‡ï¼Œç¡®ä¿è¿™ä¸ªå‡½æ•°åªè¿›è¡Œåªè¯»æ“ä½œï¼Œä¸ä¼šæ”¹å˜å¯¹è±¡çš„çŠ¶æ€ã€‚</li>
<li>ç¦æ­¢è°ƒç”¨é<code>const</code>æˆå‘˜å‡½æ•°ã€‚</li>
</ul>
<h5 data-id="heading-5"><code>const</code>Â æ˜¯ â€œæ‰¿è¯ºä¸ä¿®æ”¹æˆå‘˜å˜é‡â€ï¼Œä»…æ”¯æŒè¿è¡ŒæœŸæ‰§è¡Œï¼›<code>constexpr</code>Â æ˜¯ â€œæ”¯æŒç¼–è¯‘æœŸæ±‚å€¼â€ï¼Œ</h5>
<h4 data-id="heading-6">å®ä¾‹5â€”â€”<code>constexpr</code>ä¿®é¥°æ¨¡æ¿templateï¼š</h4>
<p>ä½¿æ¨¡æ¿å®ä¾‹åŒ–åå…·å¤‡ç¼–è¯‘å™¨æ±‚å€¼èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">template</span> T&gt;
    <span class="hljs-function"><span class="hljs-keyword">constexpr</span> T <span class="hljs-title">max_val</span><span class="hljs-params">(T a, T b)</span></span>{
        <span class="hljs-keyword">return</span> a &gt; b ? a : b;
    }
    
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> max_num = <span class="hljs-built_in">max_val</span>(<span class="hljs-number">5</span>,<span class="hljs-number">10</span>);
    <span class="hljs-comment">//ç¼–è¯‘æœŸæ±‚å€¼: max_val(5,10)å®ä¾‹åŒ–å¾—åˆ°intå‹æ•°æ®ï¼Œå–å€¼ä¸º10.</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker å®¹å™¨å¯åŠ¨çš„å…¨æ–¹ä½æ–¹æ³•æ±‡æ€»]]></title>    <link>https://juejin.cn/post/7585452404112375823</link>    <guid>https://juejin.cn/post/7585452404112375823</guid>    <pubDate>2025-12-20T01:49:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404112375823" data-draft-id="7585145251843309583" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker å®¹å™¨å¯åŠ¨çš„å…¨æ–¹ä½æ–¹æ³•æ±‡æ€»"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T01:49:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ°AJie"/> <meta itemprop="url" content="https://juejin.cn/user/3871838955636704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker å®¹å™¨å¯åŠ¨çš„å…¨æ–¹ä½æ–¹æ³•æ±‡æ€»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3871838955636704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ°AJie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T01:49:20.000Z" title="Sat Dec 20 2025 01:49:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æœ€åŸºç¡€çš„å¯åŠ¨</h2>
<pre><code class="hljs language-arduino" lang="arduino">docker run &lt;é•œåƒå&gt;
</code></pre>
<ul>
<li>ä»…å¯åŠ¨å®¹å™¨ï¼Œä¸æ˜ å°„ç«¯å£ï¼Œä¸æŒä¹…åŒ–æ•°æ®</li>
<li>å®¹å™¨é€€å‡ºåæ•°æ®ä¼šä¸¢å¤±</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€åå°è¿è¡Œ</h2>
<pre><code class="hljs language-arduino" lang="arduino">docker run -d &lt;é•œåƒå&gt;
</code></pre>
<ul>
<li><code>-d</code> â†’ detached æ¨¡å¼ï¼Œåå°è¿è¡Œ</li>
<li>å¸¸ç”¨äºæœåŠ¡ç±»é•œåƒï¼ˆMySQLã€Redisã€Nginx ç­‰ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€å‘½åå®¹å™¨</h2>
<pre><code class="hljs language-arduino" lang="arduino">docker run --name mycontainer &lt;é•œåƒå&gt;
</code></pre>
<ul>
<li>æ–¹ä¾¿ç®¡ç†ã€åœæ­¢ã€åˆ é™¤</li>
<li>ä¾‹å¦‚ <code>docker stop mycontainer</code></li>
</ul>
<hr/>
<h2 data-id="heading-3">å››ã€ç«¯å£æ˜ å°„ï¼ˆå¤–éƒ¨è®¿é—®ï¼‰</h2>
<pre><code class="hljs language-xml" lang="xml">docker run -p <span class="hljs-tag">&lt;<span class="hljs-name">å®¿ä¸»æœºç«¯å£</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨ç«¯å£</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">é•œåƒå</span>&gt;</span>
</code></pre>
<ul>
<li>Web æœåŠ¡ã€æ•°æ®åº“å¿…é¡»æ˜ å°„ç«¯å£</li>
<li>å¤šç«¯å£æ˜ å°„ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino">docker run -p <span class="hljs-number">8080</span>:<span class="hljs-number">80</span> -p <span class="hljs-number">443</span>:<span class="hljs-number">443</span> nginx
</code></pre>
<hr/>
<h2 data-id="heading-4">äº”ã€æ•°æ®æŒä¹…åŒ–ï¼ˆå·å’Œç›®å½•æŒ‚è½½ï¼‰</h2>
<ol>
<li><strong>æŒ‚è½½å®¿ä¸»æœºç›®å½•</strong></li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">docker run -v /å®¿ä¸»æœºè·¯å¾„:/å®¹å™¨è·¯å¾„ &lt;é•œåƒå&gt;
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker run -v /data/mysql:/var/lib/mysql mysql:8.0
</code></pre>
<ol start="2">
<li><strong>Docker å·</strong></li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">docker volume create myvolume
docker run -v myvolume:/å®¹å™¨è·¯å¾„ &lt;é•œåƒå&gt;
</code></pre>
<ul>
<li>å·ç®¡ç†æ–¹ä¾¿ï¼Œå¯é€šè¿‡ <code>docker volume ls</code> æŸ¥çœ‹</li>
</ul>
<hr/>
<h2 data-id="heading-5">å…­ã€ç¯å¢ƒå˜é‡é…ç½®</h2>
<pre><code class="hljs language-ini" lang="ini">docker run -e <span class="hljs-attr">KEY</span>=VALUE &lt;é•œåƒå&gt;
</code></pre>
<ul>
<li>
<p>æ•°æ®åº“é•œåƒå¸¸ç”¨ï¼š</p>
<ul>
<li><code>MYSQL_ROOT_PASSWORD</code></li>
<li><code>MYSQL_DATABASE</code></li>
<li><code>MYSQL_USER</code></li>
<li><code>MYSQL_PASSWORD</code></li>
</ul>
</li>
<li>
<p>Web æœåŠ¡é•œåƒå¸¸ç”¨ï¼š</p>
<ul>
<li><code>TZ</code>ï¼ˆæ—¶åŒºï¼‰</li>
<li><code>APP_ENV</code>ã€<code>DEBUG</code> ç­‰è‡ªå®šä¹‰å˜é‡</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸ƒã€é‡å¯ç­–ç•¥</h2>
<pre><code class="hljs language-xml" lang="xml">docker run --restart <span class="hljs-tag">&lt;<span class="hljs-name">ç­–ç•¥</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">é•œåƒå</span>&gt;</span>
</code></pre>
<ul>
<li><code>no</code> â†’ ä¸è‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤ï¼‰</li>
<li><code>always</code> â†’ å®¹å™¨åœæ­¢æˆ– Docker é‡å¯éƒ½ä¼šè‡ªåŠ¨å¯åŠ¨</li>
<li><code>unless-stopped</code> â†’ é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™è‡ªåŠ¨å¯åŠ¨</li>
<li><code>on-failure[:æœ€å¤§é‡è¯•æ¬¡æ•°]</code> â†’ å‡ºé”™è‡ªåŠ¨é‡å¯</li>
</ul>
<hr/>
<h2 data-id="heading-7">å…«ã€äº¤äº’æ¨¡å¼ï¼ˆè¿›å…¥å®¹å™¨ï¼‰</h2>
<pre><code class="hljs language-javascript" lang="javascript">docker run -it &lt;é•œåƒå&gt; <span class="hljs-regexp">/bin/</span>bash
</code></pre>
<ul>
<li><code>-it</code> â†’ äº¤äº’æ¨¡å¼ + åˆ†é…ä¼ªç»ˆç«¯</li>
<li>é€‚ç”¨äºè°ƒè¯•ã€ä¸´æ—¶æµ‹è¯•</li>
</ul>
<hr/>
<h2 data-id="heading-8">ä¹ã€ç»„åˆå¯åŠ¨ç¤ºä¾‹ï¼ˆç”Ÿäº§ç¯å¢ƒé€šç”¨æ¨¡æ¿ï¼‰</h2>
<pre><code class="hljs language-xml" lang="xml">docker run -d \
  --name <span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨å</span>&gt;</span> \
  -p <span class="hljs-tag">&lt;<span class="hljs-name">å®¿ä¸»ç«¯å£</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨ç«¯å£</span>&gt;</span> \
  -v <span class="hljs-tag">&lt;<span class="hljs-name">å®¿ä¸»è·¯å¾„</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">å®¹å™¨è·¯å¾„</span>&gt;</span> \
  -e KEY1=VALUE1 -e KEY2=VALUE2 \
  --restart unless-stopped \
  <span class="hljs-tag">&lt;<span class="hljs-name">é•œåƒå</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">åã€å¸¸ç”¨å®¹å™¨ç®¡ç†å‘½ä»¤</h2>









































<table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>docker ps</code></td><td>æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</td></tr><tr><td><code>docker ps -a</code></td><td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</td></tr><tr><td><code>docker stop &lt;å®¹å™¨&gt;</code></td><td>åœæ­¢å®¹å™¨</td></tr><tr><td><code>docker start &lt;å®¹å™¨&gt;</code></td><td>å¯åŠ¨å®¹å™¨</td></tr><tr><td><code>docker restart &lt;å®¹å™¨&gt;</code></td><td>é‡å¯å®¹å™¨</td></tr><tr><td><code>docker rm &lt;å®¹å™¨&gt;</code></td><td>åˆ é™¤å®¹å™¨</td></tr><tr><td><code>docker logs &lt;å®¹å™¨&gt;</code></td><td>æŸ¥çœ‹æ—¥å¿—</td></tr><tr><td><code>docker exec -it &lt;å®¹å™¨&gt; &lt;å‘½ä»¤&gt;</code></td><td>è¿›å…¥å®¹å™¨æˆ–æ‰§è¡Œå‘½ä»¤</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">åä¸€ã€é•œåƒç®¡ç†</h2>





































<table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>docker pull &lt;é•œåƒ&gt;</code></td><td>ä¸‹è½½é•œåƒ</td></tr><tr><td><code>docker images</code></td><td>æŸ¥çœ‹æœ¬åœ°é•œåƒ</td></tr><tr><td><code>docker rmi &lt;é•œåƒ&gt;</code></td><td>åˆ é™¤é•œåƒ</td></tr><tr><td><code>docker save -o &lt;æ–‡ä»¶&gt;.tar &lt;é•œåƒ&gt;</code></td><td>å¯¼å‡ºé•œåƒ</td></tr><tr><td><code>docker load -i &lt;æ–‡ä»¶&gt;.tar</code></td><td>å¯¼å…¥é•œåƒ</td></tr><tr><td><code>docker tag &lt;é•œåƒ&gt; &lt;æ–°é•œåƒ&gt;</code></td><td>é•œåƒæ‰“æ ‡ç­¾</td></tr><tr><td><code>docker push &lt;é•œåƒ&gt;</code></td><td>æ¨é€åˆ°ä»“åº“</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">åäºŒã€ç³»ç»Ÿä¿¡æ¯ä¸æ¸…ç†</h2>

























<table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>docker info</code></td><td>æŸ¥çœ‹ Docker ç³»ç»Ÿä¿¡æ¯</td></tr><tr><td><code>docker version</code></td><td>æŸ¥çœ‹ç‰ˆæœ¬</td></tr><tr><td><code>docker system df</code></td><td>æŸ¥çœ‹ç£ç›˜å ç”¨</td></tr><tr><td><code>docker system prune -a</code></td><td>æ¸…ç†æ— ç”¨é•œåƒã€å®¹å™¨ã€ç½‘ç»œ</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">åä¸‰ã€ç‰¹æ®Šå¯åŠ¨é€‰é¡¹</h2>

































<table><thead><tr><th>éœ€æ±‚</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>é™åˆ¶å†…å­˜</td><td><code>--memory=1g</code></td></tr><tr><td>é™åˆ¶ CPU</td><td><code>--cpus=1.5</code></td></tr><tr><td>è®¾ç½® hostname</td><td><code>--hostname myhost</code></td></tr><tr><td>æŒ‡å®šç½‘ç»œ</td><td><code>--network mynet</code></td></tr><tr><td>è¿æ¥å¤šä¸ªç½‘ç»œ</td><td><code>--network network1 --network network2</code></td></tr><tr><td>ä¸´æ—¶å®¹å™¨ï¼ˆé€€å‡ºè‡ªåŠ¨åˆ é™¤ï¼‰</td><td><code>--rm</code></td></tr></tbody></table>
<hr/>
<p>ğŸ’¡ æ€»ç»“ï¼š</p>
<ul>
<li><strong>å¿…éœ€å‚æ•°</strong>ï¼šé•œåƒåã€ç«¯å£æ˜ å°„ï¼ˆæœåŠ¡ç±»ï¼‰ã€æ•°æ®å·ï¼ˆæŒä¹…åŒ–ï¼‰</li>
<li><strong>æ¨èå‚æ•°</strong>ï¼šç¯å¢ƒå˜é‡ã€é‡å¯ç­–ç•¥ã€å®¹å™¨å‘½å</li>
<li><strong>å¯é€‰å‚æ•°</strong>ï¼šCPU/å†…å­˜é™åˆ¶ã€ç½‘ç»œé…ç½®ã€è°ƒè¯•æ¨¡å¼</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§‚å¯Ÿè€…æ¨¡å¼ï¼šä»ç†è®ºåˆ°ç”Ÿäº§å®è·µ]]></title>    <link>https://juejin.cn/post/7585397173023014931</link>    <guid>https://juejin.cn/post/7585397173023014931</guid>    <pubDate>2025-12-20T02:27:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173023014931" data-draft-id="7585400495683321898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§‚å¯Ÿè€…æ¨¡å¼ï¼šä»ç†è®ºåˆ°ç”Ÿäº§å®è·µ"/> <meta itemprop="keywords" content="è®¾è®¡æ¨¡å¼,Java"/> <meta itemprop="datePublished" content="2025-12-20T02:27:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§‚å¯Ÿè€…æ¨¡å¼ï¼šä»ç†è®ºåˆ°ç”Ÿäº§å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T02:27:07.000Z" title="Sat Dec 20 2025 02:27:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è§‚å¯Ÿè€…æ¨¡å¼æ·±åº¦è§£æï¼šä»ç†è®ºåˆ°ç”Ÿäº§å®è·µ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c416cb9945a411d90037b47ef3563de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766802427&amp;x-signature=3HkmNCsWokdIGT4tARE5%2Fw4DnVs%3D" alt="01_è§‚å¯Ÿè€…æ¨¡å¼UMLç±»å›¾.png" loading="lazy"/></p>
<p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å®ç°"ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å˜åŒ–ï¼Œå¤šä¸ªå¯¹è±¡è‡ªåŠ¨æ›´æ–°"çš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·æ³¨å†ŒæˆåŠŸæ—¶ï¼Œéœ€è¦å‘é€æ¬¢è¿é‚®ä»¶ã€èµ é€ç§¯åˆ†ã€è®°å½•æ—¥å¿—ç­‰å¤šä¸ªæ“ä½œã€‚è¿™ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œæ­£æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚</p>
<h3 data-id="heading-1">è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚å½“ä¸»é¢˜å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>è¿™é‡Œå€Ÿç”¨å»ºç­‘ç›‘ç†çš„æ¯”å–»ï¼šæŠ•èµ„æ–¹ï¼ˆè§‚å¯Ÿè€…ä»¬ï¼‰å§”æ‰˜å»ºç­‘å¸ˆï¼ˆä¸»é¢˜ï¼‰ç›‘ç£é¡¹ç›®è¿›åº¦ã€‚æ¯å½“æœ‰å»ºç­‘è¿›å±•ï¼Œå»ºç­‘å¸ˆä¸»åŠ¨é€šçŸ¥æ‰€æœ‰æŠ•èµ„æ–¹ï¼Œæ— éœ€æŠ•èµ„æ–¹åå¤è¯¢é—®ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒè§’è‰²ä¸å®ç°</h3>
<p>è§‚å¯Ÿè€…æ¨¡å¼ä¸»è¦åŒ…å«å››ä¸ªè§’è‰²ï¼š</p>
<ol>
<li><strong>Subjectï¼ˆä¸»é¢˜ï¼‰</strong>ï¼šå®šä¹‰äº†è¢«è§‚å¯Ÿè€…å¯¹è±¡çš„åŸºæœ¬æ¥å£</li>
<li><strong>ConcreteSubjectï¼ˆå…·ä½“ä¸»é¢˜ï¼‰</strong>ï¼šä¸»é¢˜çš„å…·ä½“å®ç°ï¼Œç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨</li>
<li><strong>Observerï¼ˆè§‚å¯Ÿè€…ï¼‰</strong>ï¼šå®šä¹‰äº†è§‚å¯Ÿè€…å¯¹é€šçŸ¥åšå‡ºååº”çš„æ–¹æ³•</li>
<li><strong>ConcreteObserverï¼ˆå…·ä½“è§‚å¯Ÿè€…ï¼‰</strong>ï¼šå®ç°Observeræ¥å£ï¼Œè§‚å¯Ÿä¸»é¢˜å¹¶æ‰§è¡Œç›¸åº”æ“ä½œ</li>
</ol>
<p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªå®é™…çš„ç”µå•†åº“å­˜ç®¡ç†ç¤ºä¾‹æ¥å±•ç¤ºè§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è§‚å¯Ÿè€…æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InventoryObserver</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInventoryChanged</span><span class="hljs-params">(Product product, <span class="hljs-type">int</span> newQuantity)</span>;
}

<span class="hljs-comment">// å…·ä½“è§‚å¯Ÿè€…1ï¼šåº“å­˜é¢„è­¦ç³»ç»Ÿ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InventoryAlert</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InventoryObserver</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInventoryChanged</span><span class="hljs-params">(Product product, <span class="hljs-type">int</span> newQuantity)</span> {
        <span class="hljs-keyword">if</span> (newQuantity &lt; <span class="hljs-number">10</span>) {
            System.out.println(<span class="hljs-string">"âš ï¸ åº“å­˜é¢„è­¦: "</span> + product.getName() + <span class="hljs-string">" åº“å­˜ä¸è¶³ï¼Œå½“å‰æ•°é‡: "</span> + newQuantity);
        }
    }
}

<span class="hljs-comment">// å…·ä½“è§‚å¯Ÿè€…2ï¼šè®¢å•å¤„ç†ç³»ç»Ÿ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InventoryObserver</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInventoryChanged</span><span class="hljs-params">(Product product, <span class="hljs-type">int</span> newQuantity)</span> {
        <span class="hljs-keyword">if</span> (newQuantity &lt; <span class="hljs-number">5</span>) {
            System.out.println(<span class="hljs-string">"ğŸ“¦ è‡ªåŠ¨è§¦å‘è¡¥è´§: "</span> + product.getName() + <span class="hljs-string">" æ­£åœ¨å‘ä¾›åº”å•†ä¸‹å•..."</span>);
        }
    }
}

<span class="hljs-comment">// å…·ä½“è§‚å¯Ÿè€…3ï¼šä»·æ ¼è°ƒæ•´ç³»ç»Ÿ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriceAdjuster</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InventoryObserver</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInventoryChanged</span><span class="hljs-params">(Product product, <span class="hljs-type">int</span> newQuantity)</span> {
        <span class="hljs-keyword">if</span> (newQuantity &gt; <span class="hljs-number">100</span>) {
            System.out.println(<span class="hljs-string">"ğŸ’° åº“å­˜å……è¶³ï¼Œå¯ä»¥è€ƒè™‘ä¿ƒé”€é™ä»·ï¼"</span>);
        }
    }
}

<span class="hljs-comment">// ä¸»é¢˜æ¥å£</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InventorySubject</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addObserver</span><span class="hljs-params">(InventoryObserver observer)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(InventoryObserver observer)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">(Product product, <span class="hljs-type">int</span> quantity)</span>;
}

<span class="hljs-comment">// å…·ä½“ä¸»é¢˜ï¼šåº“å­˜ç®¡ç†å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InventoryManager</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InventorySubject</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;InventoryObserver&gt; observers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Integer&gt; inventory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addObserver</span><span class="hljs-params">(InventoryObserver observer)</span> {
        observers.add(observer);
        System.out.println(<span class="hljs-string">"æ·»åŠ è§‚å¯Ÿè€…: "</span> + observer.getClass().getSimpleName());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(InventoryObserver observer)</span> {
        observers.remove(observer);
        System.out.println(<span class="hljs-string">"ç§»é™¤è§‚å¯Ÿè€…: "</span> + observer.getClass().getSimpleName());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">(Product product, <span class="hljs-type">int</span> quantity)</span> {
        <span class="hljs-keyword">for</span> (InventoryObserver observer : observers) {
            observer.onInventoryChanged(product, quantity);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateStock</span><span class="hljs-params">(String productId, <span class="hljs-type">int</span> quantity)</span> {
        inventory.put(productId, quantity);
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(productId, <span class="hljs-string">"Product-"</span> + productId);
        notifyObservers(product, quantity);
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObserverDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºåº“å­˜ç®¡ç†å™¨ï¼ˆä¸»é¢˜ï¼‰</span>
        <span class="hljs-type">InventoryManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InventoryManager</span>();

        <span class="hljs-comment">// åˆ›å»ºè§‚å¯Ÿè€…</span>
        <span class="hljs-type">InventoryAlert</span> <span class="hljs-variable">alert</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InventoryAlert</span>();
        <span class="hljs-type">OrderProcessor</span> <span class="hljs-variable">orderProcessor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderProcessor</span>();
        <span class="hljs-type">PriceAdjuster</span> <span class="hljs-variable">priceAdjuster</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriceAdjuster</span>();

        <span class="hljs-comment">// æ³¨å†Œè§‚å¯Ÿè€…</span>
        manager.addObserver(alert);
        manager.addObserver(orderProcessor);
        manager.addObserver(priceAdjuster);

        System.out.println(<span class="hljs-string">"\n--- æ¨¡æ‹Ÿåº“å­˜å˜åŒ– ---"</span>);
        manager.updateStock(<span class="hljs-string">"iphone"</span>, <span class="hljs-number">3</span>);   <span class="hljs-comment">// åº“å­˜ä¸è¶³åœºæ™¯</span>

        System.out.println(<span class="hljs-string">"\n--- æ¨¡æ‹Ÿä¾›åº”å•†è¡¥è´§ ---"</span>);
        manager.updateStock(<span class="hljs-string">"iphone"</span>, <span class="hljs-number">50</span>);  <span class="hljs-comment">// è¡¥è´§ååº“å­˜æ­£å¸¸</span>

        System.out.println(<span class="hljs-string">"\n--- æ¨¡æ‹Ÿåº“å­˜ç§¯å‹ ---"</span>);
        manager.updateStock(<span class="hljs-string">"iphone"</span>, <span class="hljs-number">150</span>); <span class="hljs-comment">// åº“å­˜ç§¯å‹åœºæ™¯</span>
    }
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<pre><code class="hljs language-diff" lang="diff">æ·»åŠ è§‚å¯Ÿè€…: InventoryAlert
æ·»åŠ è§‚å¯Ÿè€…: OrderProcessor
æ·»åŠ è§‚å¯Ÿè€…: PriceAdjuster

<span class="hljs-comment">--- æ¨¡æ‹Ÿåº“å­˜å˜åŒ– ---</span>
âš ï¸ åº“å­˜é¢„è­¦: Product-iphone åº“å­˜ä¸è¶³ï¼Œå½“å‰æ•°é‡: 3
ğŸ“¦ è‡ªåŠ¨è§¦å‘è¡¥è´§: Product-iphone æ­£åœ¨å‘ä¾›åº”å•†ä¸‹å•...

<span class="hljs-comment">--- æ¨¡æ‹Ÿä¾›åº”å•†è¡¥è´§ ---</span>

<span class="hljs-comment">--- æ¨¡æ‹Ÿåº“å­˜ç§¯å‹ ---</span>
ğŸ’° åº“å­˜å……è¶³ï¼Œå¯ä»¥è€ƒè™‘ä¿ƒé”€é™ä»·ï¼
</code></pre>
<h3 data-id="heading-3">Springæ¡†æ¶ä¸­çš„äº‹ä»¶æœºåˆ¶</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acf401cc8aa2458baca0f5233762cc7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766802427&amp;x-signature=2p1Gxi8gnpVfF7CtQ9VeE8fYSDE%3D" alt="03_Springäº‹ä»¶æœºåˆ¶æ¶æ„.png" loading="lazy"/></p>
<p>è§‚å¯Ÿè€…æ¨¡å¼åœ¨Springæ¡†æ¶ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œå…¶äº‹ä»¶æœºåˆ¶å°±æ˜¯å…¸å‹çš„å®ç°ã€‚Springçš„äº‹ä»¶æœºåˆ¶ä»¥ApplicationContextä¸ºæ ¸å¿ƒï¼Œå®ç°äº†è§‚å¯Ÿè€…æ¨¡å¼çš„é«˜çº§å°è£…ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è‡ªå®šä¹‰äº‹ä»¶</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRegisterEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ApplicationEvent</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String username;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserRegisterEvent</span><span class="hljs-params">(Object source, String username)</span> {
        <span class="hljs-built_in">super</span>(source);
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username;
    }
}

<span class="hljs-comment">// äº‹ä»¶ç›‘å¬å™¨ï¼ˆè§‚å¯Ÿè€…ï¼‰</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@EventListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailSendListener</span> {
    <span class="hljs-meta">@EventListener(classes = UserRegisterEvent.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendEmail</span><span class="hljs-params">(UserRegisterEvent event)</span> {
        System.out.println(<span class="hljs-string">"ğŸ“§ å‘é€æ¬¢è¿é‚®ä»¶ç»™: "</span> + event.getUsername());
    }
}

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@EventListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PointsGrantListener</span> {
    <span class="hljs-meta">@EventListener(classes = UserRegisterEvent.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">grantPoints</span><span class="hljs-params">(UserRegisterEvent event)</span> {
        System.out.println(<span class="hljs-string">"ğŸ ä¸ºæ–°ç”¨æˆ· "</span> + event.getUsername() + <span class="hljs-string">" èµ é€100ç§¯åˆ†"</span>);
    }
}

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@EventListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogRecordListener</span> {
    <span class="hljs-meta">@EventListener(classes = UserRegisterEvent.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordLog</span><span class="hljs-params">(UserRegisterEvent event)</span> {
        System.out.println(<span class="hljs-string">"ğŸ“ è®°å½•ç”¨æˆ·æ³¨å†Œæ—¥å¿—: "</span> + event.getUsername());
    }
}

<span class="hljs-comment">// äº‹ä»¶å‘å¸ƒè€…</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ApplicationEventPublisher eventPublisher;

    <span class="hljs-meta">@PostMapping("/register")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">register</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String username)</span> {
        <span class="hljs-comment">// æ³¨å†Œç”¨æˆ·...</span>
        System.out.println(<span class="hljs-string">"åˆ›å»ºç”¨æˆ·: "</span> + username);

        <span class="hljs-comment">// å‘å¸ƒäº‹ä»¶</span>
        <span class="hljs-type">UserRegisterEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRegisterEvent</span>(<span class="hljs-built_in">this</span>, username);
        eventPublisher.publishEvent(event);

        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-string">"æ³¨å†ŒæˆåŠŸ"</span>);
    }
}
</code></pre>
<p>Springçš„äº‹ä»¶æœºåˆ¶ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å®Œå…¨è§£è€¦</strong>ï¼šå‘å¸ƒè€…å’Œè®¢é˜…è€…äº’ä¸æ„ŸçŸ¥</li>
<li><strong>å¼‚æ­¥æ”¯æŒ</strong>ï¼šæ”¯æŒ@Asyncå¼‚æ­¥äº‹ä»¶å¤„ç†</li>
<li><strong>äº‹åŠ¡ç»‘å®š</strong>ï¼š@TransactionalEventListeneræ”¯æŒäº‹åŠ¡æäº¤åè§¦å‘</li>
<li><strong>æ¡ä»¶è¿‡æ»¤</strong>ï¼š@EventListeneræ”¯æŒSpELæ¡ä»¶è¡¨è¾¾å¼</li>
</ul>
<h3 data-id="heading-4">æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼</h3>
<p>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»ŸRabbitMQæœ¬è´¨ä¸Šä¹Ÿæ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å»¶ä¼¸ï¼Œä½†é‡‡ç”¨äº†æ›´çµæ´»çš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é…ç½®å¤šé˜Ÿåˆ—æ¶ˆæ¯ç›‘å¬</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RabbitListener</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderEventHandler</span> {

    <span class="hljs-comment">// ç›‘å¬è®¢å•åˆ›å»ºäº‹ä»¶</span>
    <span class="hljs-meta">@RabbitListener(queues = "orderCreated")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCreated</span><span class="hljs-params">(Order order)</span> {
        log.info(<span class="hljs-string">"è®¢å•åˆ›å»ºäº‹ä»¶: {}"</span>, order.getId());

        <span class="hljs-comment">// 1. å‡åº“å­˜</span>
        inventoryService.reduceStock(order);

        <span class="hljs-comment">// 2. å‘é€ç¡®è®¤é‚®ä»¶</span>
        emailService.sendOrderConfirm(order);

        <span class="hljs-comment">// 3. è®°å½•ä¸šåŠ¡æ—¥å¿—</span>
        auditService.log(order);
    }

    <span class="hljs-comment">// ç›‘å¬è®¢å•æ”¯ä»˜äº‹ä»¶</span>
    <span class="hljs-meta">@RabbitListener(queues = "orderPaid")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderPaid</span><span class="hljs-params">(String orderId)</span> {
        log.info(<span class="hljs-string">"è®¢å•æ”¯ä»˜äº‹ä»¶: {}"</span>, orderId);

        <span class="hljs-comment">// 1. æ›´æ–°è®¢å•çŠ¶æ€</span>
        orderService.payOrder(orderId);

        <span class="hljs-comment">// 2. é€šçŸ¥ç‰©æµç³»ç»Ÿå‘è´§</span>
        logisticsService.shipOrder(orderId);

        <span class="hljs-comment">// 3. æ›´æ–°ç”¨æˆ·ç´¯è®¡æ¶ˆè´¹</span>
        userService.addConsumption(orderId);
    }

    <span class="hljs-comment">// ç›‘å¬è®¢å•å–æ¶ˆäº‹ä»¶</span>
    <span class="hljs-meta">@RabbitListener(queues = "orderCancelled")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrderCancelled</span><span class="hljs-params">(Order order)</span> {
        log.info(<span class="hljs-string">"è®¢å•å–æ¶ˆäº‹ä»¶: {}"</span>, order.getId());

        <span class="hljs-comment">// 1. æ¢å¤åº“å­˜</span>
        inventoryService.restoreStock(order);

        <span class="hljs-comment">// 2. å¤„ç†é€€æ¬¾</span>
        paymentService.refund(order);

        <span class="hljs-comment">// 3. å‘é€å–æ¶ˆé€šçŸ¥</span>
        notificationService.orderCancelled(order);
    }
}
</code></pre>
<h3 data-id="heading-5">è§‚å¯Ÿè€…æ¨¡å¼ vs å‘å¸ƒ-è®¢é˜…æ¨¡å¼</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f06e51881ab4859a313ccf7c8fa6a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766802427&amp;x-signature=vEGnpo%2FAlJHLXNgSnnNijt1NhrE%3D" alt="04_è§‚å¯Ÿè€…vså‘å¸ƒè®¢é˜…å¯¹æ¯”.png" loading="lazy"/></p>
<p>å¾ˆå¤šäººå°†è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼æ··ä¸ºä¸€è°ˆï¼Œå®é™…ä¸Šä¸¤è€…æœ‰æ˜æ˜¾åŒºåˆ«ï¼š</p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>è§‚å¯Ÿè€…æ¨¡å¼</th><th>å‘å¸ƒ-è®¢é˜…æ¨¡å¼</th></tr></thead><tbody><tr><td>è€¦åˆç¨‹åº¦</td><td>ç›¸å¯¹è¾ƒå¼ºï¼ˆä¸»é¢˜éœ€ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼‰</td><td>å®Œå…¨è§£è€¦ï¼ˆé€šè¿‡æ¶ˆæ¯ä¸­ä»‹ï¼‰</td></tr><tr><td>é€šä¿¡æ–¹å¼</td><td>åŒæ­¥é€šä¿¡</td><td>æ”¯æŒå¼‚æ­¥é€šä¿¡</td></tr><tr><td>åˆ†å±‚ç»“æ„</td><td>ä¸¤å±‚ï¼ˆä¸»é¢˜-è§‚å¯Ÿè€…ï¼‰</td><td>ä¸‰å±‚ï¼ˆå‘å¸ƒè€…-ä¸´æ—¶å±‚-è®¢é˜…è€…ï¼‰</td></tr><tr><td>æ¶ˆæ¯è¿‡æ»¤</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒï¼ˆå¦‚topicï¼‰</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>åŒä¸€åº”ç”¨ä¸­</td><td>åˆ†å¸ƒå¼ç³»ç»Ÿ</td></tr></tbody></table>
<h3 data-id="heading-6">è§‚å¯Ÿè€…æ¨¡å¼å·¥ä½œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc62a58e4fd04a63912cd80ba3238d05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766802427&amp;x-signature=nozx44hd5a0Vzmvaq4qUURCzyGU%3D" alt="02_è§‚å¯Ÿè€…æ¨¡å¼å·¥ä½œæµç¨‹.png" loading="lazy"/></p>
<p>è§‚å¯Ÿè€…æ¨¡å¼çš„å·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ³¨å†Œé˜¶æ®µ</strong>ï¼šè§‚å¯Ÿè€…è°ƒç”¨subscribæ–¹æ³•å°†è‡ªå·±æ³¨å†Œåˆ°ä¸»é¢˜</li>
<li><strong>çŠ¶æ€å˜æ›´</strong>ï¼šä¸»é¢˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜</li>
<li><strong>é€šçŸ¥é˜¶æ®µ</strong>ï¼šä¸»é¢˜è°ƒç”¨notifyæ–¹æ³•é€šçŸ¥æ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…</li>
<li><strong>æ›´æ–°é˜¶æ®µ</strong>ï¼šè§‚å¯Ÿè€…æ”¶åˆ°é€šçŸ¥åï¼Œè°ƒç”¨å¯¹è±¡çš„updateæ–¹æ³•æ›´æ–°è‡ªèº«çŠ¶æ€</li>
</ol>
<h3 data-id="heading-7">åº”ç”¨åœºæ™¯åˆ†æ</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9435ae0c1e23486190288902533a6a83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766802427&amp;x-signature=hvX8MqXCVU8vaDEQXtFtCBK0DJM%3D" alt="05_è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨åœºæ™¯.png" loading="lazy"/></p>
<p>è§‚å¯Ÿè€…æ¨¡å¼å¹¿æ³›åº”ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<h4 data-id="heading-8">1. GUIç»„ä»¶äº‹ä»¶ç›‘å¬</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JavaFX æŒ‰é’®ç‚¹å‡»ç›‘å¬</span>
<span class="hljs-type">Button</span> <span class="hljs-variable">button</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Button</span>(<span class="hljs-string">"ç‚¹å‡»æˆ‘"</span>);
button.setOnAction(event -&gt; {
    System.out.println(<span class="hljs-string">"æŒ‰é’®è¢«ç‚¹å‡»ï¼"</span>);
});
</code></pre>
<h4 data-id="heading-9">2. å®æ—¶æ•°æ®åŒæ­¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ•°æ®åº“binlogç›‘å¬ï¼ˆåŸºäºCanalï¼‰</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseChangeHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CanalClientEx</span> {
    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleChange</span><span class="hljs-params">(CanalEntry.EventType change)</span> {
        <span class="hljs-comment">// åŒæ­¥åˆ°ES</span>
        elasticsearchService.sync(change);
        <span class="hljs-comment">// åŒæ­¥åˆ°ç¼“å­˜</span>
        cacheService.sync(change);
        <span class="hljs-comment">// é€šçŸ¥ä¸‹æ¸¸æœåŠ¡</span>
        messageService.publish(change);
    }
}
</code></pre>
<h3 data-id="heading-10">å®ç°è¦ç‚¹ä¸æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-11">1. è§‚å¯Ÿè€…ç®¡ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç®¡ç†è§‚å¯Ÿè€…</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Observer&gt; observers =
    Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());

<span class="hljs-comment">// æ·»åŠ è§‚å¯Ÿè€…</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addObserver</span><span class="hljs-params">(Observer observer)</span> {
    <span class="hljs-keyword">if</span> (observer == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"è§‚å¯Ÿè€…ä¸èƒ½ä¸ºç©º"</span>);
    }
    <span class="hljs-keyword">synchronized</span>(observers) {
        observers.add(observer);
    }
}

<span class="hljs-comment">// ç§»é™¤è§‚å¯Ÿè€…</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(Observer observer)</span> {
    observers.remove(observer);
}
</code></pre>
<h4 data-id="heading-12">2. é˜²æ­¢è§‚å¯Ÿè€…å¾ªç¯å¼•ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteSubject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Observable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">changed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä½¿ç”¨é”é¿å…å¾ªç¯å¼•ç”¨</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            <span class="hljs-keyword">if</span> (!changed) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// å¤åˆ¶è§‚å¯Ÿè€…åˆ—è¡¨é¿å…å¹¶å‘ä¿®æ”¹</span>
            Observer[] arr = observers.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>[<span class="hljs-number">0</span>]);
            clearChanged();

            <span class="hljs-keyword">for</span> (Observer observer : arr) {
                <span class="hljs-keyword">try</span> {
                    observer.update(<span class="hljs-built_in">this</span>, <span class="hljs-literal">null</span>);
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.warn(<span class="hljs-string">"é€šçŸ¥è§‚å¯Ÿè€…å¤±è´¥ï¼š"</span>, e);
                }
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-13">3. å¼‚æ­¥é€šçŸ¥é¿å…é˜»å¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨çº¿ç¨‹æ± å¼‚æ­¥é€šçŸ¥</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncEventPublisher</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishEventAsync</span><span class="hljs-params">(InventoryEvent event)</span> {
        executor.execute(() -&gt; {
            <span class="hljs-keyword">try</span> {
                notifyObservers(event);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"å¼‚æ­¥äº‹ä»¶é€šçŸ¥å¤±è´¥"</span>, e);
            }
        });
    }

    <span class="hljs-comment">// ä¼˜é›…å…³é—­</span>
    <span class="hljs-meta">@PreDestroy</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
        executor.shutdown();
    }
}
</code></pre>
<h3 data-id="heading-14">ä¼˜ç¼ºç‚¹åˆ†æ</h3>
<p>âœ… <strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>é™ä½è€¦åˆåº¦</strong>ï¼šå‘å¸ƒè€…å’Œè®¢é˜…è€…ç›¸äº’è§£è€¦ï¼Œæ˜“äºç³»ç»Ÿæ‰©å±•</li>
<li><strong>éµå®ˆå¼€é—­åŸåˆ™</strong>ï¼šæ–°å¢è§‚å¯Ÿè€…æ—¶æ— éœ€ä¿®æ”¹ä¸»é¢˜ä»£ç </li>
<li><strong>å®ç°å¹¿æ’­é€šä¿¡</strong>ï¼šä¸€ä¸ªä¸»é¢˜çŠ¶æ€å˜åŒ–ï¼Œå¤šä¸ªè§‚å¯Ÿè€…åŒæ­¥æ›´æ–°</li>
<li><strong>æ¶ˆæ¯ä¼ é€’é«˜æ•ˆ</strong>ï¼šç›´æ¥æ–¹æ³•è°ƒç”¨ï¼Œæ€§èƒ½ä¼˜äºæ¶ˆæ¯é˜Ÿåˆ—</li>
</ol>
<p>âŒ<strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>è§‚å¯Ÿè€…æ•°é‡ä¸æ€§èƒ½ç›¸å…³</strong>ï¼šå½“è§‚å¯Ÿè€…æ•°é‡è¾ƒå¤šæ—¶ï¼Œé€šçŸ¥è¿‡ç¨‹å˜æ…¢</li>
<li><strong>å¾ªç¯ä¾èµ–é£é™©</strong>ï¼šè§‚å¯Ÿè€…å’Œä¸»é¢˜ä¹‹é—´å¯èƒ½äº§ç”Ÿå¾ªç¯å¼•ç”¨</li>
<li><strong>åŒæ­¥é€šçŸ¥é˜»å¡æ‰€æœ‰è§‚å¯Ÿè€…</strong>ï¼šä¸€ä¸ªè§‚å¯Ÿè€…é˜»å¡ä¼šå½±å“æ•´ä¸ªé€šçŸ¥é“¾</li>
</ol>
<p>è§‚å¯Ÿè€…æ¨¡å¼ä½œä¸ºæœ€ç»å…¸çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒçš„æ€æƒ³è´¯ç©¿äºå„ç§äº‹ä»¶å¤„ç†å’Œé€šçŸ¥æœºåˆ¶ä¸­ã€‚ä»ç®€å•çš„å¯¹è±¡ç›‘å¬ï¼Œåˆ°å¤æ‚çš„åˆ†å¸ƒå¼äº‹ä»¶ç³»ç»Ÿï¼Œè§‚å¯Ÿè€…æ¨¡å¼éƒ½èƒ½å‘æŒ¥å…¶è§£è€¦å’Œæ‰©å±•æ€§çš„ä¼˜åŠ¿ã€‚æŒæ¡è§‚å¯Ÿè€…æ¨¡å¼ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´åŠ çµæ´»ã€å¯ç»´æŠ¤çš„è½¯ä»¶æ¶æ„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python çˆ¬è™«æ¡†æ¶è®¾è®¡ï¼šç±»å°è£…ä¸å·¥ç¨‹åŒ–å®è·µ]]></title>    <link>https://juejin.cn/post/7585406030021836835</link>    <guid>https://juejin.cn/post/7585406030021836835</guid>    <pubDate>2025-12-20T01:23:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030021836835" data-draft-id="7585377128491221044" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python çˆ¬è™«æ¡†æ¶è®¾è®¡ï¼šç±»å°è£…ä¸å·¥ç¨‹åŒ–å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T01:23:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Felixwb666"/> <meta itemprop="url" content="https://juejin.cn/user/485307600606522"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python çˆ¬è™«æ¡†æ¶è®¾è®¡ï¼šç±»å°è£…ä¸å·¥ç¨‹åŒ–å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485307600606522/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Felixwb666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T01:23:45.000Z" title="Sat Dec 20 2025 01:23:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ 1688 æ•°æ®é‡‡é›†ç­‰çˆ¬è™«åœºæ™¯ä¸­ï¼Œ<strong>ç±»å°è£…</strong>èƒ½å®ç°ä»£ç çš„å¤ç”¨ä¸è§£è€¦ï¼Œ<strong>å·¥ç¨‹åŒ–</strong>åˆ™ä¿éšœçˆ¬è™«çš„ç¨³å®šæ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚æœ¬æ–‡å°†ç»“åˆ 1688 çˆ¬è™«çš„å®é™…éœ€æ±‚ï¼Œä»<strong>æ¡†æ¶è®¾è®¡åŸåˆ™</strong>ã€<strong>æ ¸å¿ƒç±»å°è£…</strong>ã€<strong>å·¥ç¨‹åŒ–é…å¥—æ¨¡å—</strong>åˆ°<strong>å®æˆ˜è½åœ°</strong>ï¼Œå®Œæ•´è®²è§£çˆ¬è™«æ¡†æ¶çš„è®¾è®¡ä¸å®ç°ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ¡†æ¶è®¾è®¡åŸåˆ™ä¸æ•´ä½“æ¶æ„</h2>
<h3 data-id="heading-1">1. æ ¸å¿ƒè®¾è®¡åŸåˆ™</h3>
<p>çˆ¬è™«æ¡†æ¶éœ€éµå¾ª<strong>å¼€é—­åŸåˆ™</strong>ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ã€å¯¹ä¿®æ”¹å…³é—­ï¼‰ã€<strong>å•ä¸€èŒè´£</strong>ï¼ˆæ¯ä¸ªæ¨¡å—åªåšä¸€ä»¶äº‹ï¼‰å’Œ<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆæ¨¡å—é—´é€šè¿‡é…ç½®è§£è€¦ï¼‰ï¼ŒåŒæ—¶éœ€é€‚é… 1688 çš„åçˆ¬ç‰¹æ€§ï¼ˆå¦‚åŠ¨æ€æ¸²æŸ“ã€IP å°ç¦ï¼‰ã€‚</p>
<h3 data-id="heading-2">2. æ•´ä½“æ¶æ„åˆ†å±‚</h3>
<p>å°†çˆ¬è™«æ‹†åˆ†ä¸º<strong>5 ä¸ªæ ¸å¿ƒå±‚</strong>ï¼Œå±‚ä¸å±‚ä¹‹é—´é€šè¿‡æ¥å£äº¤äº’ï¼Œé™ä½è€¦åˆï¼š</p>



































<table><thead><tr><th>å±‚çº§</th><th>èŒè´£</th><th>æ ¸å¿ƒå®ç°æ–¹å¼</th></tr></thead><tbody><tr><td><strong>é…ç½®å±‚</strong></td><td>ç®¡ç†çˆ¬è™«å‚æ•°ï¼ˆå¦‚ä»£ç†ã€UAã€çˆ¬å–å…³é”®è¯ï¼‰ã€å­˜å‚¨é…ç½®ç­‰</td><td>YAML/JSON é…ç½®æ–‡ä»¶ + é…ç½®ç±»</td></tr><tr><td><strong>è¯·æ±‚å±‚</strong></td><td>å°è£… HTTP è¯·æ±‚ï¼Œå¤„ç†åçˆ¬ï¼ˆä»£ç†ã€UAã€å»¶è¿Ÿï¼‰ã€å¼‚å¸¸é‡è¯•</td><td>åŸºç¡€è¯·æ±‚ç±» + åçˆ¬ä¸­é—´ä»¶</td></tr><tr><td><strong>è§£æå±‚</strong></td><td>è§£æç½‘é¡µ / æ¥å£æ•°æ®ï¼Œæå–ç›®æ ‡å­—æ®µï¼ˆå¦‚ 1688 å•†å“æ ‡é¢˜ã€ä»·æ ¼ï¼‰</td><td>è§£æå™¨åŸºç±» + ä¸šåŠ¡è§£æå­ç±»</td></tr><tr><td><strong>å­˜å‚¨å±‚</strong></td><td>å¤„ç†æ•°æ®æŒä¹…åŒ–ï¼ˆCSV/MySQL/MongoDBï¼‰ï¼Œæ”¯æŒæ•°æ®å»é‡</td><td>å­˜å‚¨åŸºç±» + å¤šå­˜å‚¨å®ç°å­ç±»</td></tr><tr><td><strong>è°ƒåº¦å±‚</strong></td><td>ç®¡ç†çˆ¬å–ä»»åŠ¡ï¼ˆåˆ†é¡µã€å¤šçº¿ç¨‹ / å¼‚æ­¥ï¼‰ã€ç›‘æ§ä»»åŠ¡çŠ¶æ€</td><td>è°ƒåº¦å™¨ç±» + ä»»åŠ¡é˜Ÿåˆ—</td></tr></tbody></table>
<h2 data-id="heading-3">äºŒã€æ ¸å¿ƒç±»å°è£…å®ç°</h2>
<p>åŸºäºåˆ†å±‚æ¶æ„ï¼Œæˆ‘ä»¬é€šè¿‡<strong>ç±»çš„ç»§æ‰¿ä¸å¤šæ€</strong>å°è£…é€šç”¨é€»è¾‘ï¼Œå†é’ˆå¯¹ 1688 åœºæ™¯å®ç°å…·ä½“ä¸šåŠ¡ã€‚</p>
<h3 data-id="heading-4">1. ç¯å¢ƒå‡†å¤‡</h3>
<p>å®‰è£…å¿…å¤‡ä¾èµ–ï¼š</p>
<p>bash</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash">pip install requests beautifulsoup4 pyyaml fake-useragent playwright pymongo mysql-connector-python
playwright install chromium  <span class="hljs-comment"># å¤„ç†åŠ¨æ€é¡µé¢</span>
</code></pre>
<h3 data-id="heading-5">2. é…ç½®å±‚å°è£…ï¼ˆConfig ç±»ï¼‰</h3>
<p>é€šè¿‡ YAML é…ç½®æ–‡ä»¶ç®¡ç†å‚æ•°ï¼Œé¿å…ç¡¬ç¼–ç ï¼Œä¾¿äºåç»­ä¿®æ”¹ã€‚</p>
<p><strong>é…ç½®æ–‡ä»¶ï¼ˆconfig.yamlï¼‰</strong> ï¼š</p>
<p>yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># çˆ¬è™«åŸºç¡€é…ç½®</span>
<span class="hljs-attr">spider:</span>
  <span class="hljs-attr">keyword:</span> <span class="hljs-string">"æ‰‹æœºå£³"</span>  <span class="hljs-comment"># 1688æœç´¢å…³é”®è¯</span>
  <span class="hljs-attr">max_page:</span> <span class="hljs-number">5</span>       <span class="hljs-comment"># æœ€å¤§çˆ¬å–é¡µæ•°</span>
  <span class="hljs-attr">delay:</span> <span class="hljs-number">3</span>          <span class="hljs-comment"># è¯·æ±‚å»¶è¿Ÿï¼ˆç§’ï¼‰</span>
  <span class="hljs-attr">retry_times:</span> <span class="hljs-number">3</span>    <span class="hljs-comment"># å¤±è´¥é‡è¯•æ¬¡æ•°</span>

<span class="hljs-comment"># åçˆ¬é…ç½®</span>
<span class="hljs-attr">anti_crawl:</span>
  <span class="hljs-attr">user_agent_pool:</span> [<span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36..."</span>, <span class="hljs-string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) ..."</span>]
  <span class="hljs-attr">proxy_pool:</span> [<span class="hljs-string">"http://127.0.0.1:7890"</span>, <span class="hljs-string">"http://username:password@proxy.example.com:8080"</span>]  <span class="hljs-comment"># ä»£ç†æ± </span>

<span class="hljs-comment"># å­˜å‚¨é…ç½®</span>
<span class="hljs-attr">storage:</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">"csv"</span>  <span class="hljs-comment"># å¯é€‰ï¼šcsv/mongo/mysql</span>
  <span class="hljs-attr">csv_path:</span> <span class="hljs-string">"./1688_products.csv"</span>
  <span class="hljs-attr">mongo:</span>
    <span class="hljs-attr">uri:</span> <span class="hljs-string">"mongodb://localhost:27017/"</span>
    <span class="hljs-attr">db:</span> <span class="hljs-string">"1688_spider"</span>
    <span class="hljs-attr">collection:</span> <span class="hljs-string">"products"</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">"localhost"</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">"root"</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">"123456"</span>
    <span class="hljs-attr">db:</span> <span class="hljs-string">"1688_spider"</span>
</code></pre>
<p><strong>é…ç½®ç±»å°è£…ï¼ˆconfig.pyï¼‰</strong> ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> yaml
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Any</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
    <span class="hljs-string">"""é…ç½®ç®¡ç†ç±»ï¼ŒåŠ è½½å¹¶è§£æYAMLé…ç½®æ–‡ä»¶"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config_path: <span class="hljs-built_in">str</span> = <span class="hljs-string">"./config.yaml"</span></span>):
        self.config_path = config_path
        self.config = self._load_config()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_load_config</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""åŠ è½½YAMLé…ç½®"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.config_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
                <span class="hljs-keyword">return</span> yaml.safe_load(f)
        <span class="hljs-keyword">except</span> FileNotFoundError:
            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f"é…ç½®æ–‡ä»¶<span class="hljs-subst">{self.config_path}</span>ä¸å­˜åœ¨"</span>)
        <span class="hljs-keyword">except</span> yaml.YAMLError <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f"é…ç½®æ–‡ä»¶è§£æé”™è¯¯ï¼š<span class="hljs-subst">{e}</span>"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, key: <span class="hljs-built_in">str</span>, default: <span class="hljs-type">Any</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""æŒ‰å±‚çº§è·å–é…ç½®ï¼Œå¦‚'spider.keyword'"""</span>
        keys = key.split(<span class="hljs-string">"."</span>)
        value = self.config
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> keys:
            <span class="hljs-keyword">if</span> k <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> value:
                <span class="hljs-keyword">return</span> default
            value = value[k]
        <span class="hljs-keyword">return</span> value

<span class="hljs-comment"># æµ‹è¯•é…ç½®ç±»</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    config = Config()
    <span class="hljs-built_in">print</span>(config.get(<span class="hljs-string">"spider.keyword"</span>))  <span class="hljs-comment"># è¾“å‡ºï¼šæ‰‹æœºå£³</span>
    <span class="hljs-built_in">print</span>(config.get(<span class="hljs-string">"anti_crawl.proxy_pool"</span>))  <span class="hljs-comment"># è¾“å‡ºä»£ç†æ± åˆ—è¡¨</span>
</code></pre>
<h3 data-id="heading-6">3. è¯·æ±‚å±‚å°è£…ï¼ˆBaseRequest ç±»ï¼‰</h3>
<p>å°è£… HTTP è¯·æ±‚çš„é€šç”¨é€»è¾‘ï¼ˆåçˆ¬ã€é‡è¯•ã€å»¶è¿Ÿï¼‰ï¼Œæ”¯æŒåŒæ­¥è¯·æ±‚å’ŒåŠ¨æ€é¡µé¢è¯·æ±‚ï¼ˆPlaywrightï¼‰ã€‚</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> fake_useragent <span class="hljs-keyword">import</span> UserAgent
<span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseRequest</span>:
    <span class="hljs-string">"""è¯·æ±‚åŸºç±»ï¼Œå°è£…é€šç”¨è¯·æ±‚é€»è¾‘"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: Config</span>):
        self.config = config
        self.ua = UserAgent()
        self.retry_times = self.config.get(<span class="hljs-string">"spider.retry_times"</span>, <span class="hljs-number">3</span>)
        self.delay = self.config.get(<span class="hljs-string">"spider.delay"</span>, <span class="hljs-number">2</span>)
        self.proxy_pool = self.config.get(<span class="hljs-string">"anti_crawl.proxy_pool"</span>, [])
        self.ua_pool = self.config.get(<span class="hljs-string">"anti_crawl.user_agent_pool"</span>, [])

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_random_proxy</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""éšæœºè·å–ä»£ç†"""</span>
        <span class="hljs-keyword">return</span> random.choice(self.proxy_pool) <span class="hljs-keyword">if</span> self.proxy_pool <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_random_ua</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""éšæœºè·å–User-Agent"""</span>
        <span class="hljs-keyword">return</span> random.choice(self.ua_pool) <span class="hljs-keyword">if</span> self.ua_pool <span class="hljs-keyword">else</span> self.ua.random

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_add_delay</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""è¯·æ±‚å»¶è¿Ÿï¼Œé˜²åçˆ¬"""</span>
        time.sleep(random.uniform(self.delay, self.delay + <span class="hljs-number">2</span>))

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span>, params: <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>] = <span class="hljs-literal">None</span>, headers: <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""åŒæ­¥GETè¯·æ±‚ï¼Œæ”¯æŒé‡è¯•å’Œåçˆ¬"""</span>
        headers = headers <span class="hljs-keyword">or</span> {}
        headers[<span class="hljs-string">"User-Agent"</span>] = self._get_random_ua()
        proxies = {<span class="hljs-string">"http"</span>: self._get_random_proxy(), <span class="hljs-string">"https"</span>: self._get_random_proxy()} <span class="hljs-keyword">if</span> self._get_random_proxy() <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>

        <span class="hljs-keyword">for</span> retry <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.retry_times):
            <span class="hljs-keyword">try</span>:
                self._add_delay()
                resp = requests.get(url, params=params, headers=headers, proxies=proxies, timeout=<span class="hljs-number">10</span>)
                resp.raise_for_status()  <span class="hljs-comment"># æŠ›å‡ºHTTPé”™è¯¯</span>
                <span class="hljs-keyword">return</span> resp.text
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¯·æ±‚å¤±è´¥ï¼ˆç¬¬<span class="hljs-subst">{retry+<span class="hljs-number">1</span>}</span>æ¬¡é‡è¯•ï¼‰ï¼š<span class="hljs-subst">{e}</span>"</span>)
                time.sleep(<span class="hljs-number">2</span> ** retry)  <span class="hljs-comment"># æŒ‡æ•°é€€é¿é‡è¯•</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_dynamic</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""åŠ¨æ€é¡µé¢è¯·æ±‚ï¼ˆPlaywrightï¼‰ï¼Œè¿”å›å…³é”®æ•°æ®"""</span>
        result = {<span class="hljs-string">"title"</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">"price"</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">"sales"</span>: <span class="hljs-literal">None</span>}
        <span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:
            browser = p.chromium.launch(headless=<span class="hljs-literal">True</span>)
            page = browser.new_page(user_agent=self._get_random_ua())
            <span class="hljs-keyword">try</span>:
                page.goto(url, timeout=<span class="hljs-number">30000</span>)
                <span class="hljs-comment"># æå–1688å•†å“è¯¦æƒ…é¡µå…³é”®æ•°æ®ï¼ˆéœ€æ ¹æ®é¡µé¢ç»“æ„è°ƒæ•´ï¼‰</span>
                result[<span class="hljs-string">"title"</span>] = page.locator(<span class="hljs-string">".detail-title"</span>).inner_text() <span class="hljs-keyword">if</span> page.locator(<span class="hljs-string">".detail-title"</span>).count() &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
                result[<span class="hljs-string">"price"</span>] = page.locator(<span class="hljs-string">".price"</span>).inner_text() <span class="hljs-keyword">if</span> page.locator(<span class="hljs-string">".price"</span>).count() &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
                result[<span class="hljs-string">"sales"</span>] = page.locator(<span class="hljs-string">".sales-volume"</span>).inner_text() <span class="hljs-keyword">if</span> page.locator(<span class="hljs-string">".sales-volume"</span>).count() &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
                self._add_delay()
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åŠ¨æ€é¡µé¢è¯·æ±‚å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">finally</span>:
                browser.close()
        <span class="hljs-keyword">return</span> result

<span class="hljs-comment"># æµ‹è¯•è¯·æ±‚ç±»</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    config = Config()
    request = BaseRequest(config)
    html = request.get(<span class="hljs-string">"https://s.1688.com/selloffer/offer_search.htm?keywords=æ‰‹æœºå£³"</span>)
    <span class="hljs-built_in">print</span>(html[:<span class="hljs-number">500</span>])  <span class="hljs-comment"># è¾“å‡ºé¡µé¢å‰500å­—ç¬¦</span>
</code></pre>
<h3 data-id="heading-7">4. è§£æå±‚å°è£…ï¼ˆBaseParser ç±»ï¼‰</h3>
<p>å°è£…æ•°æ®è§£æçš„é€šç”¨æ¥å£ï¼Œå­ç±»å®ç°å…·ä½“çš„ 1688 é¡µé¢è§£æé€»è¾‘ã€‚</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseParser</span>:
    <span class="hljs-string">"""è§£æå™¨åŸºç±»ï¼Œå®šä¹‰è§£ææ¥å£"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: Config</span>):
        self.config = config

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, html: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""è§£ææ¥å£ï¼Œå­ç±»å¿…é¡»å®ç°"""</span>
        <span class="hljs-keyword">raise</span> NotImplementedError(<span class="hljs-string">"å­ç±»éœ€å®ç°parseæ–¹æ³•"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Ali1688ListParser</span>(<span class="hljs-title class_ inherited__">BaseParser</span>):
    <span class="hljs-string">"""1688å•†å“åˆ—è¡¨é¡µè§£æå™¨"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, html: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""è§£æå•†å“åˆ—è¡¨é¡µï¼Œæå–æ ‡é¢˜ã€ä»·æ ¼ã€é“¾æ¥"""</span>
        soup = BeautifulSoup(html, <span class="hljs-string">"lxml"</span>)
        products = soup.select(<span class="hljs-string">".sm-offer-item"</span>)
        result = []
        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> products:
            <span class="hljs-comment"># æå–å­—æ®µï¼ˆéœ€æ ¹æ®1688é¡µé¢ç»“æ„å®æ—¶è°ƒæ•´ï¼‰</span>
            title_elem = item.select_one(<span class="hljs-string">".offer-title a"</span>)
            price_elem = item.select_one(<span class="hljs-string">".price"</span>)
            link_elem = item.select_one(<span class="hljs-string">".offer-title a"</span>)

            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (title_elem <span class="hljs-keyword">and</span> price_elem <span class="hljs-keyword">and</span> link_elem):
                <span class="hljs-keyword">continue</span>

            product = {
                <span class="hljs-string">"title"</span>: title_elem.get(<span class="hljs-string">"title"</span>, <span class="hljs-string">""</span>).strip(),
                <span class="hljs-string">"price"</span>: price_elem.text.strip(),
                <span class="hljs-string">"link"</span>: link_elem.get(<span class="hljs-string">"href"</span>, <span class="hljs-string">""</span>).strip(),
                <span class="hljs-string">"source"</span>: <span class="hljs-string">"1688"</span>
            }
            result.append(product)
        <span class="hljs-keyword">return</span> result

<span class="hljs-comment"># æµ‹è¯•è§£æç±»</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    config = Config()
    request = BaseRequest(config)
    parser = Ali1688ListParser(config)
    html = request.get(<span class="hljs-string">"https://s.1688.com/selloffer/offer_search.htm?keywords=æ‰‹æœºå£³"</span>)
    <span class="hljs-keyword">if</span> html:
        products = parser.parse(html)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è§£æåˆ°<span class="hljs-subst">{<span class="hljs-built_in">len</span>(products)}</span>ä¸ªå•†å“ï¼š"</span>)
        <span class="hljs-built_in">print</span>(products[:<span class="hljs-number">2</span>])
</code></pre>
<h3 data-id="heading-8">5. å­˜å‚¨å±‚å°è£…ï¼ˆBaseStorage ç±»ï¼‰</h3>
<p>æ”¯æŒå¤šå­˜å‚¨æ–¹å¼ï¼ˆCSV/MySQL/MongoDBï¼‰ï¼Œé€šè¿‡å­ç±»å®ç°å…·ä½“å­˜å‚¨é€»è¾‘ã€‚</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> csv
<span class="hljs-keyword">import</span> pymongo
<span class="hljs-keyword">import</span> mysql.connector
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseStorage</span>:
    <span class="hljs-string">"""å­˜å‚¨åŸºç±»ï¼Œå®šä¹‰å­˜å‚¨æ¥å£"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: Config</span>):
        self.config = config

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">self, data: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å­˜å‚¨æ¥å£ï¼Œå­ç±»å¿…é¡»å®ç°"""</span>
        <span class="hljs-keyword">raise</span> NotImplementedError(<span class="hljs-string">"å­ç±»éœ€å®ç°saveæ–¹æ³•"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CsvStorage</span>(<span class="hljs-title class_ inherited__">BaseStorage</span>):
    <span class="hljs-string">"""CSVå­˜å‚¨ç±»"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: Config</span>):
        <span class="hljs-built_in">super</span>().__init__(config)
        self.csv_path = self.config.get(<span class="hljs-string">"storage.csv_path"</span>, <span class="hljs-string">"./products.csv"</span>)
        <span class="hljs-comment"># åˆå§‹åŒ–CSVæ–‡ä»¶å¹¶å†™å…¥è¡¨å¤´</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.csv_path, <span class="hljs-string">"w"</span>, newline=<span class="hljs-string">""</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
            writer = csv.DictWriter(f, fieldnames=[<span class="hljs-string">"title"</span>, <span class="hljs-string">"price"</span>, <span class="hljs-string">"link"</span>, <span class="hljs-string">"source"</span>])
            writer.writeheader()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">self, data: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å°†æ•°æ®è¿½åŠ å†™å…¥CSV"""</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.csv_path, <span class="hljs-string">"a"</span>, newline=<span class="hljs-string">""</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
            writer = csv.DictWriter(f, fieldnames=[<span class="hljs-string">"title"</span>, <span class="hljs-string">"price"</span>, <span class="hljs-string">"link"</span>, <span class="hljs-string">"source"</span>])
            writer.writerows(data)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸå†™å…¥<span class="hljs-subst">{<span class="hljs-built_in">len</span>(data)}</span>æ¡æ•°æ®åˆ°CSVï¼š<span class="hljs-subst">{self.csv_path}</span>"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MongoStorage</span>(<span class="hljs-title class_ inherited__">BaseStorage</span>):
    <span class="hljs-string">"""MongoDBå­˜å‚¨ç±»"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: Config</span>):
        <span class="hljs-built_in">super</span>().__init__(config)
        self.client = pymongo.MongoClient(self.config.get(<span class="hljs-string">"storage.mongo.uri"</span>))
        self.db = self.client[self.config.get(<span class="hljs-string">"storage.mongo.db"</span>)]
        self.collection = self.db[self.config.get(<span class="hljs-string">"storage.mongo.collection"</span>)]
        <span class="hljs-comment"># åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œé¿å…é‡å¤å­˜å‚¨</span>
        self.collection.create_index(<span class="hljs-string">"link"</span>, unique=<span class="hljs-literal">True</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">self, data: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å°†æ•°æ®å†™å…¥MongoDBï¼Œè‡ªåŠ¨å»é‡"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">try</span>:
            self.collection.insert_many(data, ordered=<span class="hljs-literal">False</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸå†™å…¥<span class="hljs-subst">{<span class="hljs-built_in">len</span>(data)}</span>æ¡æ•°æ®åˆ°MongoDB"</span>)
        <span class="hljs-keyword">except</span> pymongo.errors.BulkWriteError <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># å¿½ç•¥é‡å¤æ•°æ®é”™è¯¯</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"éƒ¨åˆ†æ•°æ®é‡å¤ï¼Œå®é™…å†™å…¥<span class="hljs-subst">{<span class="hljs-built_in">len</span>(data) - <span class="hljs-built_in">len</span>(e.details[<span class="hljs-string">'writeErrors'</span>])}</span>æ¡"</span>)

<span class="hljs-comment"># æµ‹è¯•å­˜å‚¨ç±»</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    config = Config()
    storage = CsvStorage(config)
    <span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®</span>
    test_data = [
        {<span class="hljs-string">"title"</span>: <span class="hljs-string">"è‹¹æœ15æ‰‹æœºå£³"</span>, <span class="hljs-string">"price"</span>: <span class="hljs-string">"10.00"</span>, <span class="hljs-string">"link"</span>: <span class="hljs-string">"https://example.com/1"</span>, <span class="hljs-string">"source"</span>: <span class="hljs-string">"1688"</span>},
        {<span class="hljs-string">"title"</span>: <span class="hljs-string">"åä¸ºMate60æ‰‹æœºå£³"</span>, <span class="hljs-string">"price"</span>: <span class="hljs-string">"8.50"</span>, <span class="hljs-string">"link"</span>: <span class="hljs-string">"https://example.com/2"</span>, <span class="hljs-string">"source"</span>: <span class="hljs-string">"1688"</span>}
    ]
    storage.save(test_data)
</code></pre>
<h3 data-id="heading-9">6. è°ƒåº¦å±‚å°è£…ï¼ˆSpiderScheduler ç±»ï¼‰</h3>
<p>ç®¡ç†çˆ¬å–ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ†é¡µã€ä»»åŠ¡åˆ†å‘ï¼‰ï¼Œæ•´åˆè¯·æ±‚ã€è§£æã€å­˜å‚¨æ¨¡å—ã€‚</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config
<span class="hljs-keyword">from</span> request <span class="hljs-keyword">import</span> BaseRequest
<span class="hljs-keyword">from</span> parser <span class="hljs-keyword">import</span> Ali1688ListParser
<span class="hljs-keyword">from</span> storage <span class="hljs-keyword">import</span> BaseStorage, CsvStorage, MongoStorage

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiderScheduler</span>:
    <span class="hljs-string">"""çˆ¬è™«è°ƒåº¦å™¨ï¼Œæ•´åˆå„æ¨¡å—å¹¶ç®¡ç†çˆ¬å–ä»»åŠ¡"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: Config</span>):
        self.config = config
        self.request = BaseRequest(config)
        self.parser = Ali1688ListParser(config)
        self.storage = self._init_storage()
        self.keyword = self.config.get(<span class="hljs-string">"spider.keyword"</span>)
        self.max_page = self.config.get(<span class="hljs-string">"spider.max_page"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_storage</span>(<span class="hljs-params">self</span>) -&gt; BaseStorage:
        <span class="hljs-string">"""æ ¹æ®é…ç½®åˆå§‹åŒ–å­˜å‚¨ç±»"""</span>
        storage_type = self.config.get(<span class="hljs-string">"storage.type"</span>, <span class="hljs-string">"csv"</span>)
        <span class="hljs-keyword">if</span> storage_type == <span class="hljs-string">"csv"</span>:
            <span class="hljs-keyword">return</span> CsvStorage(self.config)
        <span class="hljs-keyword">elif</span> storage_type == <span class="hljs-string">"mongo"</span>:
            <span class="hljs-keyword">return</span> MongoStorage(self.config)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"ä¸æ”¯æŒçš„å­˜å‚¨ç±»å‹ï¼š<span class="hljs-subst">{storage_type}</span>"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_url</span>(<span class="hljs-params">self, page: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""æ„å»º1688æœç´¢é¡µURL"""</span>
        <span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"https://s.1688.com/selloffer/offer_search.htm?keywords=<span class="hljs-subst">{quote(self.keyword)}</span>&amp;page=<span class="hljs-subst">{page}</span>"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å¯åŠ¨çˆ¬è™«ä»»åŠ¡"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¼€å§‹çˆ¬å–1688å…³é”®è¯ã€<span class="hljs-subst">{self.keyword}</span>ã€‘ï¼Œå…±<span class="hljs-subst">{self.max_page}</span>é¡µ"</span>)
        all_data = []
        <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, self.max_page + <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ­£åœ¨çˆ¬å–ç¬¬<span class="hljs-subst">{page}</span>é¡µ..."</span>)
            url = self.build_url(page)
            html = self.request.get(url)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> html:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¬¬<span class="hljs-subst">{page}</span>é¡µçˆ¬å–å¤±è´¥ï¼Œè·³è¿‡"</span>)
                <span class="hljs-keyword">continue</span>
            <span class="hljs-comment"># è§£ææ•°æ®</span>
            page_data = self.parser.parse(html)
            <span class="hljs-keyword">if</span> page_data:
                all_data.extend(page_data)
                <span class="hljs-comment"># å®æ—¶å­˜å‚¨</span>
                self.storage.save(page_data)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"çˆ¬å–å®Œæˆï¼Œæ€»è®¡è·å–<span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_data)}</span>æ¡å•†å“æ•°æ®"</span>)

<span class="hljs-comment"># æµ‹è¯•è°ƒåº¦å™¨</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    config = Config()
    scheduler = SpiderScheduler(config)
    scheduler.run()
</code></pre>
<h2 data-id="heading-10">ä¸‰ã€å·¥ç¨‹åŒ–é…å¥—æ¨¡å—</h2>
<h3 data-id="heading-11">1. æ—¥å¿—ç³»ç»Ÿï¼ˆLoggingï¼‰</h3>
<p>æ›¿æ¢ print è¯­å¥ï¼Œä½¿ç”¨ Python æ ‡å‡†åº“<code>logging</code>å®ç°åˆ†çº§æ—¥å¿—ï¼ˆINFO/ERRORï¼‰ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥ã€‚</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">init_logger</span>() -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ"""</span>
    <span class="hljs-comment"># åˆ›å»ºæ—¥å¿—ç›®å½•</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-string">"logs"</span>):
        os.makedirs(<span class="hljs-string">"logs"</span>)
    <span class="hljs-comment"># é…ç½®æ—¥å¿—æ ¼å¼</span>
    log_format = <span class="hljs-string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span>
    <span class="hljs-comment"># å†™å…¥æ–‡ä»¶ + æ§åˆ¶å°è¾“å‡º</span>
    logging.basicConfig(
        level=logging.INFO,
        <span class="hljs-built_in">format</span>=log_format,
        handlers=[
            logging.FileHandler(<span class="hljs-string">"logs/1688_spider.log"</span>, encoding=<span class="hljs-string">"utf-8"</span>),
            logging.StreamHandler()
        ]
    )

<span class="hljs-comment"># åœ¨è°ƒåº¦å™¨ä¸­ä½¿ç”¨æ—¥å¿—</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    init_logger()
    logger = logging.getLogger(__name__)
    logger.info(<span class="hljs-string">"çˆ¬è™«å¯åŠ¨"</span>)
    <span class="hljs-keyword">try</span>:
        config = Config()
        scheduler = SpiderScheduler(config)
        scheduler.run()
        logger.info(<span class="hljs-string">"çˆ¬è™«ç»“æŸ"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        logger.error(<span class="hljs-string">f"çˆ¬è™«å¼‚å¸¸ï¼š<span class="hljs-subst">{e}</span>"</span>, exc_info=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-12">2. å¼‚å¸¸å¤„ç†ä½“ç³»</h3>
<p>åœ¨æ ¸å¿ƒæ¨¡å—ä¸­å®šä¹‰<strong>è‡ªå®šä¹‰å¼‚å¸¸</strong>ï¼Œä¾¿äºç²¾å‡†æ•è·å’Œå¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># exceptions.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiderRequestError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è¯·æ±‚å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiderParseError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""è§£æå¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiderStorageError</span>(<span class="hljs-title class_ inherited__">Exception</span>):
    <span class="hljs-string">"""å­˜å‚¨å¼‚å¸¸"""</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># åœ¨è¯·æ±‚å±‚ä¸­æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
    <span class="hljs-keyword">for</span> retry <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.retry_times):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># ... åŸæœ‰é€»è¾‘ ...</span>
            <span class="hljs-keyword">return</span> resp.text
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">if</span> retry == self.retry_times - <span class="hljs-number">1</span>:
                <span class="hljs-keyword">raise</span> SpiderRequestError(<span class="hljs-string">f"è¯·æ±‚<span class="hljs-subst">{url}</span>å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
            time.sleep(<span class="hljs-number">2</span> ** retry)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h3 data-id="heading-13">3. ä»£ç†æ± é›†æˆ</h3>
<p>å¯¹äºå¤§è§„æ¨¡çˆ¬å–ï¼Œå¯å¯¹æ¥ç¬¬ä¸‰æ–¹ä»£ç†æ± ï¼ˆå¦‚é˜¿å¸ƒäº‘ã€å¿«ä»£ç†ï¼‰æˆ–è‡ªå»ºä»£ç†æ± ï¼Œé€šè¿‡ API åŠ¨æ€è·å–å¯ç”¨ä»£ç†ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_proxy_from_pool</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>]:
    <span class="hljs-string">"""ä»ä»£ç†æ± APIè·å–å¯ç”¨ä»£ç†"""</span>
    proxy_api = <span class="hljs-string">"http://proxy.example.com/get_proxy"</span>
    <span class="hljs-keyword">try</span>:
        resp = requests.get(proxy_api, timeout=<span class="hljs-number">5</span>)
        <span class="hljs-keyword">return</span> resp.json().get(<span class="hljs-string">"proxy"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è·å–ä»£ç†å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h2 data-id="heading-14">å››ã€å·¥ç¨‹åŒ–æ‰©å±•ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-15">1. å¤šçº¿ç¨‹ / å¼‚æ­¥çˆ¬å–</h3>
<p>é’ˆå¯¹å•çº¿ç¨‹æ•ˆç‡ä½çš„é—®é¢˜ï¼Œå¯ä½¿ç”¨<code>concurrent.futures.ThreadPoolExecutor</code>å®ç°å¤šçº¿ç¨‹ï¼Œæˆ–ç”¨<code>aiohttp</code>å®ç°å¼‚æ­¥çˆ¬å–ï¼ˆæ³¨æ„ 1688 çš„åçˆ¬é™åˆ¶ï¼Œé¿å…å¹¶å‘è¿‡é«˜ï¼‰ã€‚</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_multi_thread</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""å¤šçº¿ç¨‹çˆ¬å–"""</span>
    <span class="hljs-keyword">with</span> ThreadPoolExecutor(max_workers=<span class="hljs-number">3</span>) <span class="hljs-keyword">as</span> executor:  <span class="hljs-comment"># æ§åˆ¶å¹¶å‘æ•°</span>
        executor.<span class="hljs-built_in">map</span>(self.crawl_page, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, self.max_page + <span class="hljs-number">1</span>))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">crawl_page</span>(<span class="hljs-params">self, page: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""å•é¡µçˆ¬å–é€»è¾‘ï¼Œä¾›çº¿ç¨‹è°ƒç”¨"""</span>
    url = self.build_url(page)
    html = self.request.get(url)
    <span class="hljs-keyword">if</span> html:
        page_data = self.parser.parse(html)
        self.storage.save(page_data)
</code></pre>
<h3 data-id="heading-16">2. çˆ¬è™«ç›‘æ§ä¸å‘Šè­¦</h3>
<p>é€šè¿‡<code>prometheus</code>+<code>grafana</code>ç›‘æ§çˆ¬è™«çš„çˆ¬å–é‡ã€å¤±è´¥ç‡ï¼Œæˆ–é€šè¿‡é‚®ä»¶ / é’‰é’‰æœºå™¨äººåœ¨çˆ¬è™«å¼‚å¸¸æ—¶å‘é€å‘Šè­¦ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> smtplib
<span class="hljs-keyword">from</span> email.mime.text <span class="hljs-keyword">import</span> MIMEText

<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_alert_email</span>(<span class="hljs-params">message: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-string">"""å‘é€å‘Šè­¦é‚®ä»¶"""</span>
    msg = MIMEText(message, <span class="hljs-string">"plain"</span>, <span class="hljs-string">"utf-8"</span>)
    msg[<span class="hljs-string">"Subject"</span>] = <span class="hljs-string">"1688çˆ¬è™«å¼‚å¸¸å‘Šè­¦"</span>
    msg[<span class="hljs-string">"From"</span>] = <span class="hljs-string">"sender@example.com"</span>
    msg[<span class="hljs-string">"To"</span>] = <span class="hljs-string">"receiver@example.com"</span>

    smtp = smtplib.SMTP_SSL(<span class="hljs-string">"smtp.example.com"</span>, <span class="hljs-number">465</span>)
    smtp.login(<span class="hljs-string">"sender@example.com"</span>, <span class="hljs-string">"password"</span>)
    smtp.sendmail(<span class="hljs-string">"sender@example.com"</span>, [<span class="hljs-string">"receiver@example.com"</span>], msg.as_string())
    smtp.quit()
</code></pre>
<h3 data-id="heading-17">3. åˆè§„ä¸ç»´æŠ¤</h3>
<ol>
<li><strong>éµå®ˆ robots åè®®</strong>ï¼š1688 çš„<code>robots.txt</code>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.1688.com%2Frobots.txt" target="_blank" title="https://www.1688.com/robots.txt" ref="nofollow noopener noreferrer">www.1688.com/robots.txt</a>ï¼‰æ˜ç¡®ç¦æ­¢çˆ¬å–çš„è·¯å¾„éœ€ä¸¥æ ¼è§„é¿ã€‚</li>
<li><strong>å®šæœŸæ›´æ–°è§£æè§„åˆ™</strong>ï¼š1688 é¡µé¢ç»“æ„ä¼šé¢‘ç¹å˜æ›´ï¼Œéœ€å®šæœŸæ£€æŸ¥å¹¶è°ƒæ•´ CSS é€‰æ‹©å™¨ / XPathã€‚</li>
<li><strong>æ•°æ®å»é‡ä¸æ¸…æ´—</strong>ï¼šé€šè¿‡å•†å“é“¾æ¥ã€ID ç­‰å”¯ä¸€é”®å»é‡ï¼Œå¯¹ä»·æ ¼ã€é”€é‡ç­‰å­—æ®µåšæ ¼å¼æ¸…æ´—ï¼ˆå¦‚å»é™¤éæ•°å­—å­—ç¬¦ï¼‰ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidå¼€å‘ä¸­çš„å°è£…æ€è·¯æŒ‡å¯¼]]></title>    <link>https://juejin.cn/post/7585397173022834707</link>    <guid>https://juejin.cn/post/7585397173022834707</guid>    <pubDate>2025-12-20T01:16:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173022834707" data-draft-id="7585390679398400006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidå¼€å‘ä¸­çš„å°è£…æ€è·¯æŒ‡å¯¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T01:16:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Poorguy9527"/> <meta itemprop="url" content="https://juejin.cn/user/1746465251931063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidå¼€å‘ä¸­çš„å°è£…æ€è·¯æŒ‡å¯¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1746465251931063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Poorguy9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T01:16:25.000Z" title="Sat Dec 20 2025 01:16:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå°è£…æ˜¯æå‡è½¯ä»¶ç³»ç»Ÿçš„æ‰‹æ®µ</p>
</blockquote>
<p>å°è£…æ˜¯Androidå¼€å‘ä¸­æé«˜ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§çš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ç³»ç»ŸåŒ–çš„å°è£…æŒ‡å¯¼æ€è·¯ï¼š</p>
<h2 data-id="heading-0">ä¸€ã€åˆ†å±‚æ¶æ„æ€æƒ³</h2>
<h3 data-id="heading-1">1.Â <strong>æ¸…æ™°çš„åˆ†å±‚ç»“æ„</strong></h3>
<pre><code class="hljs language-text" lang="text">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     UIå±‚        â”‚ â† Activity/Fragment/View
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ViewModelå±‚   â”‚ â† ViewModel/Presenter
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Domainå±‚      â”‚ â† ä¸šåŠ¡é€»è¾‘ç”¨ä¾‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Dataå±‚        â”‚ â† Repository/DataSource
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Modelå±‚       â”‚ â† æ•°æ®å®ä½“/DTO
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-2">2.Â <strong>å„å±‚èŒè´£æ˜ç¡®</strong></h3>
<ul>
<li><strong>UIå±‚</strong>: åªå¤„ç†ç•Œé¢å±•ç¤ºå’Œç”¨æˆ·äº¤äº’</li>
<li><strong>ViewModel/Presenterå±‚</strong>: å¤„ç†UIé€»è¾‘å’ŒçŠ¶æ€ç®¡ç†</li>
<li><strong>Domainå±‚</strong>: çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–Androidæ¡†æ¶</li>
<li><strong>Dataå±‚</strong>: æ•°æ®è·å–å’Œå­˜å‚¨</li>
<li><strong>Modelå±‚</strong>: æ•°æ®ç»“æ„å®šä¹‰</li>
</ul>
<h2 data-id="heading-3">äºŒã€æ¨¡å—åŒ–å°è£…åŸåˆ™</h2>
<h3 data-id="heading-4">1.Â <strong>å•ä¸€èŒè´£åŸåˆ™(SRP)</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ ä¸æ¨è - èŒè´£è¿‡å¤š</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ç™»å½•é€»è¾‘ */</span> }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">logout</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ç™»å‡ºé€»è¾‘ */</span> }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">saveToDatabase</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* æ•°æ®åº“æ“ä½œ */</span> }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">uploadToServer</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ç½‘ç»œè¯·æ±‚ */</span> }
}

<span class="hljs-comment">// âœ… æ¨è - èŒè´£åˆ†ç¦»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> { <span class="hljs-comment">/* è®¤è¯é€»è¾‘ */</span> }
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> { <span class="hljs-comment">/* æ•°æ®æ“ä½œ */</span> }
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkService</span> { <span class="hljs-comment">/* ç½‘ç»œè¯·æ±‚ */</span> }
</code></pre>
<h3 data-id="heading-5">2.Â <strong>ä¾èµ–å€’ç½®åŸåˆ™(DIP)</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å®šä¹‰æŠ½è±¡æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDataSource</span> {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">String</span>)</span></span>: User
}

<span class="hljs-comment">// å…·ä½“å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteUserDataSource</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService
) : UserDataSource {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">String</span>)</span></span>: User {
        <span class="hljs-keyword">return</span> apiService.getUser(id)
    }
}

<span class="hljs-comment">// ä½¿ç”¨ä¾èµ–æ³¨å…¥</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userDataSource: UserDataSource
)
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€å¸¸ç”¨ç»„ä»¶å°è£…ç­–ç•¥</h2>
<h3 data-id="heading-7">1.Â <strong>BaseåŸºç±»å°è£…</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseActivity</span>&lt;<span class="hljs-type">VM : ViewModel</span>&gt; : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">val</span> viewModel: VM
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLayoutId</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContentView(getLayoutId())
        initView()
        initObserver()
        initData()
    }
    
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initView</span><span class="hljs-params">()</span></span> {}
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initObserver</span><span class="hljs-params">()</span></span> {}
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initData</span><span class="hljs-params">()</span></span> {}
    
    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showLoading</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ç»Ÿä¸€åŠ è½½æ¡† */</span> }
    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hideLoading</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* éšè—åŠ è½½æ¡† */</span> }
    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showToast</span><span class="hljs-params">(message: <span class="hljs-type">String</span>)</span></span> { <span class="hljs-comment">/* ç»Ÿä¸€Toast */</span> }
}
</code></pre>
<h3 data-id="heading-8">2.Â <strong>å·¥å…·ç±»å°è£…</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> NetworkUtils {
    
    <span class="hljs-meta">@SuppressLint(<span class="hljs-string">"MissingPermission"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isNetworkAvailable</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">val</span> connectivityManager = context.getSystemService(
            Context.CONNECTIVITY_SERVICE
        ) <span class="hljs-keyword">as</span> ConnectivityManager
        
        <span class="hljs-keyword">return</span> connectivityManager.activeNetwork?.let { network -&gt;
            connectivityManager.getNetworkCapabilities(network)?.let { capabilities -&gt;
                capabilities.hasTransport(NetworkCapabilities.TRANSPORT_WIFI) ||
                capabilities.hasTransport(NetworkCapabilities.TRANSPORT_CELLULAR)
            }
        } ?: <span class="hljs-literal">false</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ‰©å±•å‡½æ•°ä¼˜åŒ–</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> Context.<span class="hljs-title">isNetworkAvailable</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> NetworkUtils.isNetworkAvailable(<span class="hljs-keyword">this</span>)
}
</code></pre>
<h3 data-id="heading-9">3.Â <strong>Viewç»„ä»¶å°è£…</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadingButton</span> <span class="hljs-meta">@JvmOverloads</span> <span class="hljs-keyword">constructor</span>(
    context: Context,
    attrs: AttributeSet? = <span class="hljs-literal">null</span>,
    defStyleAttr: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
) : MaterialButton(context, attrs, defStyleAttr) {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> originalText: CharSequence? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> progressBar = ProgressBar(context).apply {
        layoutParams = LayoutParams(
            LayoutParams.WRAP_CONTENT,
            LayoutParams.WRAP_CONTENT
        )
        isIndeterminate = <span class="hljs-literal">true</span>
        visibility = View.GONE
    }
    
    <span class="hljs-keyword">init</span> {
        addView(progressBar)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">showLoading</span><span class="hljs-params">()</span></span> {
        originalText = text
        text = <span class="hljs-string">""</span>
        isEnabled = <span class="hljs-literal">false</span>
        progressBar.visibility = View.VISIBLE
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hideLoading</span><span class="hljs-params">()</span></span> {
        text = originalText
        isEnabled = <span class="hljs-literal">true</span>
        progressBar.visibility = View.GONE
    }
}
</code></pre>
<h2 data-id="heading-10">å››ã€ç½‘ç»œè¯·æ±‚å°è£…</h2>
<h3 data-id="heading-11">1.Â <strong>Retrofit + Kotlinåç¨‹å°è£…</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiService</span> {
    <span class="hljs-meta">@GET(<span class="hljs-string">"user/{id}"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> userId: <span class="hljs-type">String</span>)</span></span>: ApiResponse&lt;User&gt;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiClient</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>() {
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> BASE_URL = <span class="hljs-string">"https://api.example.com/"</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>: ApiService {
            <span class="hljs-keyword">return</span> Retrofit.Builder()
                .baseUrl(BASE_URL)
                .addConverterFactory(GsonConverterFactory.create())
                .client(createOkHttpClient())
                .build()
                .create(ApiService::<span class="hljs-keyword">class</span>.java)
        }
        
        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createOkHttpClient</span><span class="hljs-params">()</span></span>: OkHttpClient {
            <span class="hljs-keyword">return</span> OkHttpClient.Builder()
                .connectTimeout(<span class="hljs-number">30</span>, TimeUnit.SECONDS)
                .readTimeout(<span class="hljs-number">30</span>, TimeUnit.SECONDS)
                .addInterceptor(createInterceptor())
                .addInterceptor(HttpLoggingInterceptor().apply {
                    level = HttpLoggingInterceptor.Level.BODY
                })
                .build()
        }
        
        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createInterceptor</span><span class="hljs-params">()</span></span>: Interceptor {
            <span class="hljs-keyword">return</span> Interceptor { chain -&gt;
                <span class="hljs-keyword">val</span> request = chain.request().newBuilder()
                    .addHeader(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer token"</span>)
                    .addHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
                    .build()
                chain.proceed(request)
            }
        }
    }
}

<span class="hljs-comment">// ç»Ÿä¸€å“åº”å°è£…</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">val</span> code: <span class="hljs-built_in">Int</span>,
    <span class="hljs-keyword">val</span> message: String?,
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T?
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isSuccess</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> = code == <span class="hljs-number">200</span>
}
</code></pre>
<h2 data-id="heading-12">äº”ã€æ•°æ®åº“å°è£…ï¼ˆRoomï¼‰</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Entity(tableName = <span class="hljs-string">"users"</span>)</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-meta">@PrimaryKey</span> <span class="hljs-keyword">val</span> id: String,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> email: String,
    <span class="hljs-meta">@ColumnInfo(name = <span class="hljs-string">"created_at"</span>)</span> <span class="hljs-keyword">val</span> createdAt: <span class="hljs-built_in">Long</span>
)

<span class="hljs-meta">@Dao</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> {
    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insert</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>
    
    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users WHERE id = :userId"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User?
    
    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getAllUsers</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;User&gt;&gt;
}

<span class="hljs-meta">@Database(entities = [User::class], version = 1)</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDatabase</span> : <span class="hljs-type">RoomDatabase</span>() {
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">userDao</span><span class="hljs-params">()</span></span>: UserDao
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-meta">@Volatile</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> INSTANCE: AppDatabase? = <span class="hljs-literal">null</span>
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: AppDatabase {
            <span class="hljs-keyword">return</span> INSTANCE ?: synchronized(<span class="hljs-keyword">this</span>) {
                INSTANCE ?: buildDatabase(context).also { INSTANCE = it }
            }
        }
        
        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildDatabase</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: AppDatabase {
            <span class="hljs-keyword">return</span> Room.databaseBuilder(
                context.applicationContext,
                AppDatabase::<span class="hljs-keyword">class</span>.java,
                <span class="hljs-string">"app_database"</span>
            ).build()
        }
    }
}
</code></pre>
<h2 data-id="heading-13">å…­ã€ä¾èµ–æ³¨å…¥å°è£…</h2>
<h3 data-id="heading-14">1.Â <strong>ä½¿ç”¨Hilt/Dagger</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> AppModule {
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideApiService</span><span class="hljs-params">()</span></span>: ApiService {
        <span class="hljs-keyword">return</span> ApiClient.create()
    }
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideUserRepository</span><span class="hljs-params">(
        apiService: <span class="hljs-type">ApiService</span>,
        userDao: <span class="hljs-type">UserDao</span>
    )</span></span>: UserRepository {
        <span class="hljs-keyword">return</span> UserRepository(apiService, userDao)
    }
}

<span class="hljs-meta">@AndroidEntryPoint</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-meta">@Inject</span>
    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> userRepository: UserRepository
    
    <span class="hljs-comment">// æˆ–é€šè¿‡ViewModelæ³¨å…¥</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: MainViewModel <span class="hljs-keyword">by</span> viewModels()
}
</code></pre>
<h3 data-id="heading-15">2.Â <strong>æ‰‹åŠ¨ä¾èµ–æ³¨å…¥ï¼ˆæ— æ¡†æ¶æ—¶ï¼‰</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> ServiceLocator {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> services = mutableMapOf&lt;String, Any&gt;()
    
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Any&gt;</span> <span class="hljs-title">register</span><span class="hljs-params">(service: <span class="hljs-type">T</span>)</span></span> {
        services[T::<span class="hljs-keyword">class</span>.java.name] = service
    }
    
    <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T : Any&gt;</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>: T {
        <span class="hljs-keyword">return</span> services[T::<span class="hljs-keyword">class</span>.java.name] <span class="hljs-keyword">as</span>? T
            ?: <span class="hljs-keyword">throw</span> IllegalStateException(<span class="hljs-string">"Service not registered: <span class="hljs-subst">${T::class.java}</span>"</span>)
    }
}

<span class="hljs-comment">// åˆå§‹åŒ–</span>
ServiceLocator.register(ApiClient.create())
ServiceLocator.register(UserRepository(...))
</code></pre>
<h2 data-id="heading-16">ä¸ƒã€é…ç½®å’Œå¸¸é‡å°è£…</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> AppConfig {
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> API_TIMEOUT = <span class="hljs-number">30L</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> DATABASE_NAME = <span class="hljs-string">"app.db"</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> SHARED_PREF_NAME = <span class="hljs-string">"app_prefs"</span>
    
    <span class="hljs-keyword">object</span> Endpoints {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> BASE_URL = <span class="hljs-string">"https://api.example.com/"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> USER = <span class="hljs-string">"user/{id}"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> LOGIN = <span class="hljs-string">"auth/login"</span>
    }
    
    <span class="hljs-keyword">object</span> Preferences {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> KEY_TOKEN = <span class="hljs-string">"token"</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> KEY_USER_ID = <span class="hljs-string">"user_id"</span>
    }
}

<span class="hljs-comment">// ä½¿ç”¨BuildConfigç®¡ç†ä¸åŒç¯å¢ƒ</span>
<span class="hljs-keyword">object</span> Environment {
    <span class="hljs-keyword">val</span> BASE_URL = BuildConfig.BASE_URL
    <span class="hljs-keyword">val</span> IS_DEBUG = BuildConfig.DEBUG
    <span class="hljs-keyword">val</span> VERSION_NAME = BuildConfig.VERSION_NAME
}
</code></pre>
<h2 data-id="heading-17">å…«ã€é”™è¯¯å¤„ç†å°è£…</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">out T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : Result&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> exception: Exception) : Result&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">object</span> Loading : Result&lt;<span class="hljs-built_in">Nothing</span>&gt;()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorHandler</span> {
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleError</span><span class="hljs-params">(exception: <span class="hljs-type">Exception</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (exception) {
            <span class="hljs-keyword">is</span> IOException -&gt; <span class="hljs-string">"ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"</span>
            <span class="hljs-keyword">is</span> HttpException -&gt; <span class="hljs-keyword">when</span> (exception.code()) {
                <span class="hljs-number">401</span> -&gt; <span class="hljs-string">"æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•"</span>
                <span class="hljs-number">404</span> -&gt; <span class="hljs-string">"èµ„æºä¸å­˜åœ¨"</span>
                <span class="hljs-number">500</span> -&gt; <span class="hljs-string">"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"</span>
                <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"ç½‘ç»œè¯·æ±‚å¤±è´¥: <span class="hljs-subst">${exception.message}</span>"</span>
            }
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"æœªçŸ¥é”™è¯¯: <span class="hljs-subst">${exception.message}</span>"</span>
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">logError</span><span class="hljs-params">(tag: <span class="hljs-type">String</span>, exception: <span class="hljs-type">Exception</span>)</span></span> {
        <span class="hljs-keyword">if</span> (BuildConfig.DEBUG) {
            Log.e(tag, exception.message, exception)
        }
        <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒä¸ŠæŠ¥åˆ°ç›‘æ§å¹³å°</span>
        FirebaseCrashlytics.getInstance().recordException(exception)
    }
}
</code></pre>
<h2 data-id="heading-18">ä¹ã€æµ‹è¯•å‹å¥½çš„å°è£…</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨æ¥å£ä¾¿äºMock</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserRepository</span> {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(id: <span class="hljs-type">String</span>)</span></span>: User?
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">saveUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>
}

<span class="hljs-comment">// ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: IUserRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> errorHandler: ErrorHandler
) : ViewModel() {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _userState = MutableStateFlow&lt;Result&lt;User&gt;&gt;(Result.Loading)
    <span class="hljs-keyword">val</span> userState: StateFlow&lt;Result&lt;User&gt;&gt; = _userState
    
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        _userState.value = Result.Loading
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)
            _userState.value = user?.let { Result.Success(it) }
                ?: Result.Error(Exception(<span class="hljs-string">"User not found"</span>))
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            _userState.value = Result.Error(e)
            errorHandler.logError(<span class="hljs-string">"UserViewModel"</span>, e)
        }
    }
}
</code></pre>
<h2 data-id="heading-19">åã€å°è£…çš„æœ€ä½³å®è·µæ€»ç»“</h2>
<h3 data-id="heading-20">1.Â <strong>éµå¾ªSOLIDåŸåˆ™</strong></h3>
<ul>
<li>å•ä¸€èŒè´£</li>
<li>å¼€é—­åŸåˆ™</li>
<li>é‡Œæ°æ›¿æ¢</li>
<li>æ¥å£éš”ç¦»</li>
<li>ä¾èµ–å€’ç½®</li>
</ul>
<h3 data-id="heading-21">2.Â <strong>ä¿æŒé€‚å½“çš„å°è£…ç²’åº¦</strong></h3>
<ul>
<li>é¿å…è¿‡åº¦å°è£…ï¼ˆæ¯ä¸ªæ–¹æ³•éƒ½å•ç‹¬ä¸€ä¸ªç±»ï¼‰</li>
<li>é¿å…å°è£…ä¸è¶³ï¼ˆä¸€ä¸ªç±»åšæ‰€æœ‰äº‹æƒ…ï¼‰</li>
</ul>
<h3 data-id="heading-22">3.Â <strong>è€ƒè™‘å¯æµ‹è¯•æ€§</strong></h3>
<ul>
<li>ä¾èµ–æ³¨å…¥</li>
<li>æ¥å£ç¼–ç¨‹</li>
<li>é¿å…é™æ€æ–¹æ³•å’Œå•ä¾‹</li>
</ul>
<h3 data-id="heading-23">4.Â <strong>æ€§èƒ½è€ƒè™‘</strong></h3>
<ul>
<li>å»¶è¿Ÿåˆå§‹åŒ–</li>
<li>ç¼“å­˜ç­–ç•¥</li>
<li>é¿å…å†…å­˜æ³„æ¼</li>
</ul>
<h3 data-id="heading-24">5.Â <strong>æ–‡æ¡£å’Œæ³¨é‡Š</strong></h3>
<ul>
<li>å…¬å…±APIå¿…é¡»æœ‰æ–‡æ¡£</li>
<li>å¤æ‚é€»è¾‘éœ€è¦æ³¨é‡Š</li>
<li>ä¿æŒREADMEæ›´æ–°</li>
</ul>
<h3 data-id="heading-25">6.Â <strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RequiresApi(Build.VERSION_CODES.O)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">newApiMethod</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// é«˜ç‰ˆæœ¬APIå®ç°</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">compatibleMethod</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
        newApiMethod()
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å…¼å®¹å®ç°</span>
    }
}
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šå°è£…ç­–ç•¥ï¼Œå¯ä»¥æé«˜ä»£ç çš„ï¼š</p>
<ul>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šç»“æ„æ¸…æ™°ï¼Œæ˜“äºä¿®æ”¹</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šä¾èµ–æ˜ç¡®ï¼Œæ˜“äºå•å…ƒæµ‹è¯•</li>
<li><strong>å¯å¤ç”¨æ€§</strong>ï¼šç»„ä»¶ç‹¬ç«‹ï¼Œå¯åœ¨ä¸åŒé¡¹ç›®ä½¿ç”¨</li>
<li><strong>å¯è¯»æ€§</strong>ï¼šå‘½åè§„èŒƒï¼Œé€»è¾‘æ¸…æ™°</li>
<li><strong>å¥å£®æ€§</strong>ï¼šé”™è¯¯å¤„ç†å®Œå–„ï¼Œè¾¹ç•Œæƒ…å†µè€ƒè™‘å‘¨å…¨</li>
</ul>
<blockquote>
<p>ä¸€ä¸ªå¼€å‘è€…ï¼Œç†åº”æœ‰å±äºè‡ªå·±çš„ä¸€å¥—å°è£…ç»„ä»¶ï¼Œåœ¨éœ€è¦ç”¨æ—¶ï¼Œå¼€ç®±å³ç”¨ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - Geeç¬¬äºŒå¤© ä¸Šä¸‹æ–‡Context]]></title>    <link>https://juejin.cn/post/7585227038992662566</link>    <guid>https://juejin.cn/post/7585227038992662566</guid>    <pubDate>2025-12-20T02:46:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585227038992662566" data-draft-id="7585382317444775946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - Geeç¬¬äºŒå¤© ä¸Šä¸‹æ–‡Context"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2025-12-20T02:46:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Way2top"/> <meta itemprop="url" content="https://juejin.cn/user/1458388314893300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Goè¯­è¨€åŠ¨æ‰‹å†™Webæ¡†æ¶ - Geeç¬¬äºŒå¤© ä¸Šä¸‹æ–‡Context
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458388314893300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Way2top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T02:46:47.000Z" title="Sat Dec 20 2025 02:46:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å†™åœ¨å‰é¢ï¼šæœ¬é¡¹ç›®å‚è€ƒÂ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgeektutu.com%2Fpost%2Fgee.html" title="https://link.juejin.cn/?target=https%3A%2F%2Fgeektutu.com%2Fpost%2Fgee.html" target="_blank">7å¤©ç”¨Goä»é›¶å®ç°Webæ¡†æ¶Geeæ•™ç¨‹</a>ï¼Œä¸‹é¢çš„å†…å®¹å…¨éƒ¨å‚è€ƒè‡ªè¯¥ç½‘ç«™ã€‚ä¸»è¦æ˜¯è®°å½•æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­çš„æ‰€æ€æ‰€æƒ³ï¼Œå¦‚æœ‰å­˜åœ¨é—®é¢˜è¿˜è¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­ä¼˜åŒ– Geeï¼Œæ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…æ˜¯<strong>è®¾è®¡ Context</strong>ã€‚</p>
<h4 data-id="heading-0">è®¾è®¡ Context çš„å¿…è¦æ€§</h4>
<ol>
<li><strong>å±è”½åº•å±‚ HTTP ç»†èŠ‚ï¼Œç»Ÿä¸€é«˜é¢‘ä¸”æ˜“é”™çš„æ“ä½œ</strong></li>
</ol>
<p>åœ¨ Day1 ä¸­ï¼Œæˆ‘ä»¬çš„ Handler æ˜¯ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span>
</code></pre>
<p>ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬è·å–è¯·æ±‚æŠ¥æ–‡ä¸­çš„ä¸€äº›å­—æ®µï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-go" lang="go">method := req.Method <span class="hljs-comment">// è·å–è¯·æ±‚æ–¹å¼</span>
path := req.URL.Path <span class="hljs-comment">// è·å–è¯·æ±‚èµ„æºè·¯å¾„</span>
name := req.URL.Query().Get(<span class="hljs-string">"name"</span>) <span class="hljs-comment">// è·å– Query å‚æ•°</span>
age := req.URL.Query().Get(<span class="hljs-string">"age"</span>) <span class="hljs-comment">// è·å– Query å‚æ•°</span>

<span class="hljs-comment">// è·å–è¯·æ±‚å¤´</span>
ua := req.Header.Get(<span class="hljs-string">"User-Agent"</span>)
token := req.Header.Get(<span class="hljs-string">"Authorization"</span>)


<span class="hljs-comment">// è·å– POST è¡¨å•å‚æ•°</span>
err := req.ParseForm()
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-comment">// error handling</span>
}
username := req.FormValue(<span class="hljs-string">"username"</span>)
password := req.FormValue(<span class="hljs-string">"password"</span>)
</code></pre>
<p>ç¡®å®éƒ½å¯ä»¥é€šè¿‡ <code>req</code> æ‹¿åˆ°ï¼Œä½†æ˜¯é—®é¢˜åœ¨äº <code>*http.Request</code> æä¾›çš„é¢—ç²’åº¦å¤ªç»†äº†ã€‚å¯¹WebæœåŠ¡æ¥è¯´ï¼Œæ— éæ˜¯æ ¹æ®è¯·æ±‚<code>*http.Request</code>ï¼Œæ„é€ å“åº”<code>http.ResponseWriter</code>ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¦‚æœæˆ‘æƒ³è¦æ„é€ ä¸€ä¸ªå®Œæ•´çš„å“åº”ï¼Œè¦è€ƒè™‘å¾ˆå¤šä¸œè¥¿ï¼Œä¾‹å¦‚æ¶ˆæ¯å¤´ï¼ˆHeaderï¼‰å’Œæ¶ˆæ¯ä½“ï¼ˆBodyï¼‰ï¼Œè€Œ Header åˆåŒ…å«äº†çŠ¶æ€ç ï¼ˆStatusCodeï¼‰å’Œæ¶ˆæ¯ç±»å‹ï¼ˆContentTypeï¼‰ç­‰å‡ ä¹æ¯æ¬¡éƒ½éœ€è¦è®¾ç½®çš„ä¿¡æ¯ã€‚æ‰€ä»¥å¦‚æœä¸è¿›è¡Œæœ‰æ•ˆçš„å°è£…ï¼Œé‚£ä¹ˆä½¿ç”¨ Day1 çš„ Gee æ¡†æ¶è¿›è¡Œå¼€å‘çš„å¼€å‘è€…å°†éœ€è¦å†™å¤§é‡é‡å¤ä¸”ç¹æ‚çš„ä»£ç ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼Œé’ˆå¯¹å¸¸ç”¨åœºæ™¯ï¼Œèƒ½å¤Ÿé«˜æ•ˆæ„é€ å‡º HTTP å“åº”æ˜¯ä¸€ä¸ªå¥½çš„æ¡†æ¶å¿…é¡»è€ƒè™‘çš„ç‚¹ã€‚</p>
<p>ä¸¾ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼Œæƒ³è±¡ä¸€ä¸‹ä½ å®¶è¦æ¥æ°´ç”¨ï¼Œä½†æ˜¯æ²¡æœ‰æ°´é¾™å¤´ï¼Œé‚£ä¹ˆæ¯æ¬¡æƒ³ç”¨æ°´ï¼Œä½ éƒ½éœ€è¦ï¼š</p>
<ul>
<li>è‡ªå·±æ‹§å¼€æ€»é˜€</li>
<li>åˆ¤æ–­æ°´å‹</li>
<li>è°ƒèŠ‚å†·çƒ­æ°´æ¯”ä¾‹</li>
<li>æ¥ä¸€æ ¹ä¸´æ—¶ç®¡å­</li>
<li>ç”¨å®Œå†å…³é˜€ã€æ”¾å‹</li>
</ul>
<p>è¿™å°±ç›¸å½“äºï¼š</p>
<pre><code class="hljs language-scss" lang="scss">req<span class="hljs-selector-class">.URL</span><span class="hljs-selector-class">.Query</span>()
req<span class="hljs-selector-class">.ParseForm</span>()
w<span class="hljs-selector-class">.Header</span>()<span class="hljs-selector-class">.Set</span>()
w<span class="hljs-selector-class">.WriteHeader</span>()
w<span class="hljs-selector-class">.Write</span>()
</code></pre>
<p>æ¯æ¬¡éƒ½è¦é‡å¤ä¸€å¥—æœºæ¢°çš„åŠ¨ä½œï¼Œè€Œä¸”ä¸€æ­¥å‡ºé”™å°±å‡ºé—®é¢˜ã€‚</p>
<p>è€Œåœ¨å®‰è£…äº†æ°´é¾™å¤´ä¹‹åï¼Œäº‹æƒ…å°±æ–¹ä¾¿çš„å¤šäº†ï¼Œä½ åªéœ€è¦ï¼š</p>
<ul>
<li>æ‹§ä¸€ä¸‹</li>
</ul>
<p>æ°´å‹ã€æ°´æ¸©ã€å‡ºæ°´è·¯å¾„å…¨éƒ¨è¢«<strong>é¢„å…ˆå°è£…å¥½</strong>ã€‚</p>
<p>è¿™å°±ç›¸å½“äºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">c.<span class="hljs-title class_">JSON</span>(<span class="hljs-number">200</span>, obj)
c.<span class="hljs-title class_">Query</span>(<span class="hljs-string">"name"</span>)
</code></pre>
<p>åœ¨ Day1 ä¸­ï¼Œhandler ç›´æ¥æ“ä½œ <code>http.Request</code> å’Œ <code>ResponseWriter</code>ï¼Œå°±åƒæ¯æ¬¡ç”¨æ°´éƒ½è¦è‡ªå·±æ¥æ°´ç®¡ï¼Œæ­¥éª¤ç¹çä¸”å®¹æ˜“å‡ºé”™ï¼›Context çš„å¼•å…¥ï¼Œç›¸å½“äºæä¾›äº†æ ‡å‡†æ°´é¾™å¤´ï¼Œå°†å¤æ‚ã€æ˜“é”™çš„åº•å±‚ç»†èŠ‚å°è£…èµ·æ¥ï¼Œåªæš´éœ²ç®€å•ã€ç¨³å®šçš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<hr/>
<ol start="2">
<li><strong>ä½œä¸ºè¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„ç»Ÿä¸€è½½ä½“ï¼Œæ‰¿è½½æ¡†æ¶æ‰©å±•èƒ½åŠ›</strong></li>
</ol>
<p>é’ˆå¯¹ä½¿ç”¨åœºæ™¯ï¼Œå°è£…<code>*http.Request</code>å’Œ<code>http.ResponseWriter</code>çš„æ–¹æ³•ï¼Œç®€åŒ–ç›¸å…³æ¥å£çš„è°ƒç”¨ï¼Œåªæ˜¯è®¾è®¡ Context çš„åŸå› ä¹‹ä¸€ã€‚å¯¹äºæ¡†æ¶æ¥è¯´ï¼Œè¿˜éœ€è¦æ”¯æ’‘é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´åŠ¨æ€è·¯ç”±ã€‚</p>
<p>åŠ¨æ€è·¯ç”±æ˜¯ä¸€ä¸ªæ¡†æ¶å¿…é¡»æ”¯æŒçš„åŠŸèƒ½ã€‚å‡è®¾æœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬åšä¸€ä¸ªç”¨æˆ·ç³»ç»Ÿï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span><span class="hljs-keyword">user</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>
<span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span><span class="hljs-keyword">user</span><span class="hljs-operator">/</span><span class="hljs-number">2</span>
<span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span><span class="hljs-keyword">user</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>
</code></pre>
<p>å¯¹äºæ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ç”¨æˆ·ï¼Œéƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ URLï¼Œè€Œåœ¨ Day1 çš„ Gee ä¸­ï¼Œå¯¹äºè·¯ç”±çš„å¤„ç†æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// gee/gee.go</span>
key := req.Method + <span class="hljs-string">"-"</span> + req.URL.Path
handler := engine.router[key]
</code></pre>
<p>æ‹¼æ¥å‡º URL ä¹‹åï¼Œä¼šå»æŸ¥ Engine ä¸­çš„è·¯ç”±è¡¨ï¼Œçœ‹ URL æ˜¯å¦æ³¨å†Œã€‚è¿™æ ·çš„è®¾è®¡æ˜¾ç„¶å­˜åœ¨é—®é¢˜ï¼š</p>
<ul>
<li><strong>ä¸å¯æ‰©å±•</strong>ï¼šæ¯å¢åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œå°±è¦å¢åŠ ä¸€ä¸ªè·¯ç”±ï¼Œè¿™æ˜¾ç„¶ä¸ç°å®ã€‚</li>
<li><strong>å‚æ•°æå–å›°éš¾</strong>ï¼šå‡è®¾æƒ³åœ¨ handler ä¸­è·å–ç”¨æˆ· IDï¼Œä½ å¿…é¡»è‡ªå·±è§£æ <code>req.URL.Path</code>ï¼š</li>
</ul>
<pre><code class="hljs language-go" lang="go">parts := strings.Split(req.URL.Path, <span class="hljs-string">"/"</span>)
userID := parts[<span class="hljs-number">2</span>]
</code></pre>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦åŠ¨æ€è·¯ç”±ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè·¯ç”±è®¾è®¡ä¸º <code>/user/:id</code>ï¼Œå…¶ä¸­ <code>:id</code> å¯ä»¥åŒ¹é…ä»»æ„ç”¨æˆ· IDï¼Œå¹¶ä¸”è¯·æ±‚ <code>/user/123</code>ã€<code>/user/456</code> éƒ½èƒ½åŒ¹é…åˆ°åŒä¸€ä¸ª handlerã€‚</p>
<p>Day1 çš„é™æ€è·¯ç”±åªèƒ½åŒ¹é…å›ºå®šè·¯å¾„ï¼Œæ— æ³•æ”¯æŒè·¯å¾„ä¸­å¸¦å˜é‡çš„ URLã€‚</p>
<p>å†æ¯”å¦‚ï¼Œæ¡†æ¶éœ€è¦æ”¯æŒä¸­é—´ä»¶ï¼Œé‚£ä¸­é—´ä»¶äº§ç”Ÿçš„ä¿¡æ¯æ”¾åœ¨å“ªå‘¢ï¼ŸContext éšç€æ¯ä¸€ä¸ªè¯·æ±‚çš„å‡ºç°è€Œäº§ç”Ÿï¼Œè¯·æ±‚çš„ç»“æŸè€Œé”€æ¯ï¼Œå’Œå½“å‰è¯·æ±‚å¼ºç›¸å…³çš„ä¿¡æ¯éƒ½åº”ç”± Context æ‰¿è½½ã€‚å› æ­¤ï¼Œè®¾è®¡ Context ç»“æ„ï¼Œæ‰©å±•æ€§å’Œå¤æ‚æ€§ç•™åœ¨äº†å†…éƒ¨ï¼Œè€Œå¯¹å¤–ç®€åŒ–äº†æ¥å£ã€‚è·¯ç”±çš„å¤„ç†å‡½æ•°ï¼Œä»¥åŠå°†è¦å®ç°çš„ä¸­é—´ä»¶ï¼Œå‚æ•°éƒ½ç»Ÿä¸€ä½¿ç”¨ Context å®ä¾‹ï¼Œ Context å°±åƒä¸€æ¬¡ä¼šè¯çš„ç™¾å®ç®±ï¼Œå¯ä»¥æ‰¾åˆ°ä»»ä½•ä¸œè¥¿ã€‚</p>
<p>å¦‚æœä½ ç†Ÿæ‚‰ Pythonï¼Œé‚£ä¹ˆæˆ‘ä»¬ Day2 è¦åšçš„äº‹æƒ…å°±æœ‰ç‚¹Â·11ç±»ä¼¼äºæŠŠ httpx è¿™ä¸ªåŒ…å‡çº§åˆ° request è¿™ä¸ªåŒ…ã€‚Day1 å°±åƒç›´æ¥ç”¨ä½çº§åº“å†™è¯·æ±‚ï¼ŒDay2 çš„ Context å°±åƒç»™å®ƒåŠ äº†ä¸€å±‚é«˜çº§å°è£…ï¼Œè®©ä½ ä¸“æ³¨ä¸šåŠ¡è€Œä¸ç”¨ç®¡åè®®ç»†èŠ‚ã€‚</p>
<hr/>
<h4 data-id="heading-1">å…·ä½“å®ç°</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// gee/context.go</span>
<span class="hljs-keyword">package</span> gee

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"encoding/json"</span>
        <span class="hljs-string">"fmt"</span>
        <span class="hljs-string">"net/http"</span>
)

<span class="hljs-keyword">type</span> H <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}

<span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> {
        Writer     http.ResponseWriter
        Req        *http.Request
        Path       <span class="hljs-type">string</span> <span class="hljs-comment">// è¯·æ±‚èµ„æºè·¯å¾„</span>
        Method     <span class="hljs-type">string</span> <span class="hljs-comment">// è¯·æ±‚æ–¹å¼</span>
        StatusCode <span class="hljs-type">int</span>    <span class="hljs-comment">// çŠ¶æ€ç </span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newContext</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> *Context {
        <span class="hljs-keyword">return</span> &amp;Context{
                Writer: w,
                Req:    req,
                Path:   req.URL.Path,
                Method: req.Method,
        }
}

<span class="hljs-comment">// PostForm ä» POST è¡¨å•ä¸­è·å–æŒ‡å®šå­—æ®µçš„å€¼</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> PostForm(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> {
        <span class="hljs-keyword">return</span> c.Req.URL.Query().Get(key)
}

<span class="hljs-comment">// Query ä» URL æŸ¥è¯¢å‚æ•°ä¸­è·å–æŒ‡å®šå­—æ®µçš„å€¼ã€‚</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Query(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> {
        <span class="hljs-keyword">return</span> c.Req.URL.Query().Get(key)
}

<span class="hljs-comment">// Status è®¾ç½®å“åº”çŠ¶æ€ç å¹¶å†™å…¥ HTTP Header</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Status(code <span class="hljs-type">int</span>) {
        c.StatusCode = code
        c.Writer.WriteHeader(code)
}

<span class="hljs-comment">// SetHeader è®¾ç½®å“åº”å¤´æŒ‡å®šå­—æ®µå’Œå€¼</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> SetHeader(key <span class="hljs-type">string</span>, value <span class="hljs-type">string</span>) {
        c.Writer.Header().Set(key, value)
}

<span class="hljs-comment">// String ä»¥çº¯æ–‡æœ¬æ ¼å¼æ„é€  HTTP å“åº”å¹¶å†™å…¥å®¢æˆ·ç«¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> String(code <span class="hljs-type">int</span>, format <span class="hljs-type">string</span>, values ...<span class="hljs-keyword">interface</span>{}) {
        c.SetHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/plain"</span>)
        c.Status(code)
        c.Writer.Write([]<span class="hljs-type">byte</span>(fmt.Sprintf(format, values...)))
}

<span class="hljs-comment">// JSON å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æ ¼å¼bigè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶è®¾ç½® Content-Type</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> JSON(code <span class="hljs-type">int</span>, obj <span class="hljs-keyword">interface</span>{}) {
        c.SetHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
        c.Status(code)
        encoder := json.NewEncoder(c.Writer)
        <span class="hljs-keyword">if</span> err := encoder.Encode(obj); err != <span class="hljs-literal">nil</span> {
                http.Error(c.Writer, err.Error(), <span class="hljs-number">500</span>)
        }
}

<span class="hljs-comment">// Data ç›´æ¥å†™å…¥åŸå§‹å­—èŠ‚æ•°æ®åˆ°å“åº”ä½“ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Data(code <span class="hljs-type">int</span>, data []<span class="hljs-type">byte</span>) {
        c.Status(code)
        c.Writer.Write(data)
}

<span class="hljs-comment">// HTML å°† HTML å­—ç¬¦ä¸²ä½œä¸ºå“åº”è¿”å›ï¼ŒåŒæ—¶è®¾ç½® Content-Type ä¸º text/html</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> HTML(code <span class="hljs-type">int</span>, html <span class="hljs-type">string</span>) {
        c.SetHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"text/html"</span>)
        c.Status(code)
        c.Writer.Write([]<span class="hljs-type">byte</span>(html))
}
</code></pre>
<p>è¿™éƒ¨åˆ†æ˜¯å®ç° Context çš„æ ¸å¿ƒé€»è¾‘ã€‚åœ¨ä»£ç çš„å¼€å¤´ç»™ <code>map[string]interface{}</code> èµ·äº†ä¸€ä¸ªåˆ«åå« <code>H</code>ï¼Œè¿™æ˜¯ä¸ºäº†åç»­åœ¨æ„å»º JSON æ•°æ®çš„æ—¶å€™æ˜¾å¾—æ›´åŠ ç®€æ´ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Context çš„ç»“æ„ï¼ŒåŒ…å«äº† <code>http.ResponseWriter</code>å’Œ<code>*http.Request</code>ï¼Œå¦å¤–æä¾›äº†å¯¹ Method å’Œ Path è¿™ä¸¤ä¸ªå¸¸ç”¨å±æ€§çš„ç›´æ¥è®¿é—®ã€‚</p>
<p>å‰©ä¸‹çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬æä¾›äº†è®¿é—® Query å’Œ PostForm å‚æ•°çš„æ–¹æ³•ï¼Œä»¥åŠæä¾›äº†å¿«é€Ÿæ„é€  String/Data/JSON/HTML å“åº”çš„æ–¹æ³•ã€‚</p>
<hr/>
<p>è¿™é‡Œæä¸€ä¸‹ JSON éƒ¨åˆ†çš„å®ç°ç»†èŠ‚ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> JSON(code <span class="hljs-type">int</span>, obj <span class="hljs-keyword">interface</span>{}) {
        c.SetHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
        c.Status(code)
        encoder := json.NewEncoder(c.Writer)
        <span class="hljs-keyword">if</span> err := encoder.Encode(obj); err != <span class="hljs-literal">nil</span> {
                http.Error(c.Writer, err.Error(), <span class="hljs-number">500</span>)
        }
}
</code></pre>
<p>è¿™æ®µä»£ç çš„å…³é”®ç‚¹å¹¶ä¸åœ¨ <code>if err := ...</code>ï¼Œè€Œåœ¨è¿™ä¸€è¡Œï¼š</p>
<pre><code class="hljs language-css" lang="css">encoder := json.<span class="hljs-built_in">NewEncoder</span>(c.Writer)
</code></pre>
<p>æˆ‘ä»¬ç‚¹è¿›å»çœ‹ <code>json.NewEncoder</code> çš„æºç ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// NewEncoder returns a new encoder that writes to w.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewEncoder</span><span class="hljs-params">(w io.Writer)</span></span> *Encoder {
    <span class="hljs-keyword">return</span> &amp;Encoder{w: w, escapeHTML: <span class="hljs-literal">true</span>}
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>NewEncoder</code> æ¥å—ä¸€ä¸ª <code>io.Writer</code>ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° <code>Encoder</code> ç»“æ„ä½“å†…éƒ¨çš„ <code>w</code> å­—æ®µä¸­ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶å·²ç»å»ºç«‹äº†è¿™æ ·ä¸€ä¸ªå…³ç³»ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">enc.w</span> === c.Writer
</code></pre>
<p>è€Œ <code>c.Writer</code> æœ¬è´¨ä¸Šå°±æ˜¯ <code>http.ResponseWriter</code>ã€‚</p>
<p>æ¥ä¸‹æ¥é‡ç‚¹çœ‹ JSON å®ç°éƒ¨åˆ†çš„è¿™ä¸€è¡Œï¼š</p>
<pre><code class="hljs language-scss" lang="scss">encoder<span class="hljs-selector-class">.Encode</span>(obj)
</code></pre>
<p>è¿™å¥è¯æ¯”è¾ƒå®¹æ˜“è¯¯è§£ä¸ºï¼šåªæœ‰å‡ºé”™æ—¶æ‰ä¼šå†™å“åº”ã€‚</p>
<p>å®é™…ä¸Š<strong>æ°æ°ç›¸å</strong>ã€‚</p>
<p><code>Encode</code> çš„ä¸»è¦é€»è¾‘æ˜¯ï¼š<strong>å…ˆ</strong> <strong>åºåˆ—åŒ–</strong> <strong>ï¼Œå†å†™å“åº”</strong>ï¼Œé”™è¯¯åªæ˜¯è¿”å›å€¼è€Œå·²ã€‚å…¶ç®€åŒ–åçš„æºç é€»è¾‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(enc *Encoder)</span></span> Encode(v any) <span class="hljs-type">error</span> {
    data, err := json.Marshal(v)<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {<span class="hljs-keyword">return</span> err
    }
    data = <span class="hljs-built_in">append</span>(data, <span class="hljs-string">'\n'</span>)
    _, err = enc.w.Write(data)<span class="hljs-keyword">return</span> err
}
</code></pre>
<p>è¿™é‡Œçš„æ‰§è¡Œæµç¨‹éå¸¸å…³é”®ï¼š</p>
<ol>
<li>
<p><code>json.Marshal(v)</code></p>
<ol>
<li>æŠŠ Go å¯¹è±¡è½¬æ¢æˆ JSON å­—èŠ‚æ•°ç»„</li>
</ol>
</li>
<li>
<p><code>enc.w.Write(data)</code></p>
<ol>
<li><strong>ç›´æ¥æŠŠ</strong> <strong>JSON</strong> <strong>æ•°æ®å†™å…¥åˆ°</strong> <strong><code>io.Writer</code></strong></li>
</ol>
</li>
<li>
<p>è¿”å› <code>error</code>ï¼ˆå¦‚æœæœ‰ï¼‰</p>
</li>
</ol>
<p>æ³¨æ„è¿™ä¸€ç‚¹ï¼š</p>
<blockquote>
<p><strong>çœŸæ­£æŠŠå“åº”ä½“å†™å‡ºå»çš„ï¼Œæ˜¯</strong> <strong><code>enc.w.Write(data)</code></strong> <strong>ï¼Œè€Œä¸æ˜¯</strong> <strong><code>if err != nil</code></strong> <strong>è¿™ä¸€è¡Œ</strong></p>
</blockquote>
<p>è€Œæ­¤æ—¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">enc.w</span> == c.Writer == http.ResponseWriter
</code></pre>
<p>å› æ­¤ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">encoder<span class="hljs-selector-class">.Encode</span>(obj)
</code></pre>
<p>è¿™ä¸€è¡Œæœ¬èº«å°±å·²ç»å®Œæˆäº† <strong>HTTP å“åº”ä½“çš„å†™å…¥</strong>ã€‚</p>
<hr/>
<p><strong>ä¸ºä»€ä¹ˆ</strong> <strong><code>http.Error</code></strong> <strong>åœ¨è¿™é‡Œâ€œçœ‹èµ·æ¥æ²¡ä»€ä¹ˆç”¨â€ï¼Ÿ</strong></p>
<p>å› ä¸ºåœ¨è°ƒç”¨ <code>Encode</code> ä¹‹å‰ï¼Œå·²ç»æ‰§è¡Œè¿‡ï¼š</p>
<pre><code class="hljs language-css" lang="css">c<span class="hljs-selector-class">.Status</span>(<span class="hljs-selector-tag">code</span>) // =&gt; Writer<span class="hljs-selector-class">.WriteHeader</span>(<span class="hljs-selector-tag">code</span>)
</code></pre>
<p>è¿™ä¸€æ­¥å·²ç»å¾€ HTTP å“åº”ç¼“å†²åŒºå†™å…¥äº†çŠ¶æ€è¡Œå’Œå“åº”å¤´ã€‚ä¸€ä¸ªå…³é”®çš„è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li><strong>çŠ¶æ€ç åªèƒ½å†™ä¸€æ¬¡</strong></li>
<li><strong>å“åº”ä½“å¯ä»¥åœ¨ä¹‹åå¤šæ¬¡å†™å…¥</strong></li>
<li>ç¬¬ä¸€æ¬¡ <code>Write</code> å‘ç”Ÿæ—¶ï¼Œå¦‚æœè¿˜æ²¡è°ƒç”¨ <code>WriteHeader</code>ï¼ŒGo ä¼šè‡ªåŠ¨è¡¥ä¸€ä¸ª <code>200</code></li>
</ul>
<p>å› æ­¤ï¼Œè¿™é‡Œçš„ <code>http.Error</code> è¯•å›¾åœ¨å‘ç°é”™è¯¯ï¼ˆå°†å†…å®¹è½¬æ¢ä¸º JSON æ ¼å¼å¤±è´¥ï¼‰åè¯•å›¾ä¿®æ”¹å“åº”è¡Œæ¥è¿›è¡ŒæŒ½æ•‘ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼Œè¿™ä¹Ÿæ˜¯æ¡†æ¶ç›®å‰å­˜åœ¨çš„ä¸€ä¸ªç¼ºç‚¹ã€‚</p>
<hr/>
<h4 data-id="heading-2">è·¯ç”±ï¼ˆRouterï¼‰</h4>
<p>åœ¨è®¾è®¡å®Œ Context ä¹‹åï¼Œå¯¹äºä¹‹å‰å†™åœ¨ Engine ä¸­çš„ router æˆ‘ä»¬ä¹Ÿæœ‰äº†ä¸€äº›æ–°çš„æ€è€ƒï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span>

<span class="hljs-keyword">type</span> Engine <span class="hljs-keyword">struct</span> {
        router <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc <span class="hljs-comment">// è·¯ç”±è¡¨</span>
}
</code></pre>
<p>ä¹‹å‰çš„ Router è®¾è®¡å¾ˆç®€å•ï¼Œç›´æ¥å†™åœ¨ Engine çš„å†…éƒ¨ï¼Œhandler å‚æ•°æ˜¯åŸå§‹çš„ <code>w</code> å’Œ <code>req</code>ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦æŸ¥è¯¢ <code>map[method-path]</code>ï¼Œè¿™æ ·è®¾è®¡æœ‰ä¸‹é¢è¿™äº›ç¼ºç‚¹ï¼š</p>
<ul>
<li>Engine é‡Œé¢ç›´æ¥ç®¡ç†è·¯ç”±ï¼ŒèŒè´£è€¦åˆ</li>
<li>ä¸æ”¯æŒåŠ¨æ€è·¯ç”± <code>/user/:id</code></li>
<li>æ‰©å±•ä¸­é—´ä»¶æˆ–ç»Ÿä¸€å‚æ•°å¤„ç†æ—¶ï¼Œè·¯ç”±é€»è¾‘å¾ˆéš¾æ’æ‰‹</li>
</ul>
<p>æ­£å¥½æˆ‘ä»¬å‰é¢ä¹Ÿå¼•å…¥äº† Contextï¼Œä½¿å¾— Handler ä¸ç›´æ¥æ“ä½œ <code>w</code> å’Œ <code>req</code>ï¼Œè€Œæ˜¯æ“ä½œ <code>*Context</code>ï¼Œæ¥è®© Context æ‰¿è½½ç”Ÿå‘½å‘¨æœŸä¿¡æ¯ï¼ˆQueryã€Formã€Json å“åº”ç­‰ï¼‰ã€‚</p>
<p><strong>äºæ˜¯å¼•å‡ºäº†ä¸€ä¸ªè®¾è®¡æ€è·¯ï¼šæŠŠè·¯ç”±ç›¸å…³é€»è¾‘ä» Engine ç‹¬ç«‹å‡ºæ¥ï¼Œå½¢æˆä¸€ä¸ª</strong> <strong>Router</strong> <strong>æ¨¡å—ã€‚</strong></p>
<p>æˆ‘ä»¬å¸Œæœ›ï¼š</p>
<ul>
<li>
<p>Engine åªåšâ€œæ¡†æ¶ç®¡æ§ + ServeHTTP æ¥å£å®ç°â€</p>
</li>
<li>
<p>Router åªç®¡â€œè·¯ç”±æ³¨å†Œ + è¯·æ±‚åŒ¹é…â€</p>
</li>
<li>
<p>Context åªç®¡â€œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ•°æ®å°è£…â€</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯è€ƒè™‘å¦‚ä½•å°† Router ä» Engine ä¸­éš”ç¦»å‡ºæ¥ã€‚æˆ‘ä»¬ä¿®æ”¹ Engineï¼Œä¸å†ç›´æ¥å­˜ mapï¼Œæ”¹ä¸ºï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Engine <span class="hljs-keyword">struct</span> {
    router *router
}
</code></pre>
<p>Router æ–°å¢æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">func (r *router) <span class="hljs-built_in">addRoute</span>(...) <span class="hljs-comment">// æ³¨å†Œè·¯ç”±</span>
func (r *router) <span class="hljs-built_in">handle</span>(c *Context) <span class="hljs-comment">// æ ¹æ® Context æŸ¥æ‰¾ handler å¹¶è°ƒç”¨</span>
</code></pre>
<p>å…·ä½“çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> gee

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"log"</span>
        <span class="hljs-string">"net/http"</span>
)

<span class="hljs-keyword">type</span> router <span class="hljs-keyword">struct</span> {
        handlers <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newRouter</span><span class="hljs-params">()</span></span> *router {
        <span class="hljs-keyword">return</span> &amp;router{handlers: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc)}
}

<span class="hljs-comment">// æ³¨å†Œè·¯ç”±</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> addRoute(method <span class="hljs-type">string</span>, pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        log.Printf(<span class="hljs-string">"Route %4s - %s"</span>, method, pattern)
        key := method + <span class="hljs-string">"-"</span> + pattern
        r.handlers[key] = handler
}

<span class="hljs-comment">// æ ¹æ® Context æŸ¥æ‰¾ handler å¹¶è°ƒç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> handle(c *Context) {
        key := c.Method + <span class="hljs-string">"-"</span> + c.Path
        <span class="hljs-keyword">if</span> handler, ok := r.handlers[key]; ok {
                handler(c)
        } <span class="hljs-keyword">else</span> {
                c.String(http.StatusNotFound, <span class="hljs-string">"404 NOT FOUND: %s\n"</span>, c.Path)
        }
}
</code></pre>
<p>é‚£ä¹ˆæŠŠ Engine çš„ Router é€»è¾‘éš”ç¦»å‡ºæ¥ä¹‹åï¼Œ<code>gee.go</code> ä¹Ÿåº”è¯¥åšä¸€ä¸ªä¿®æ”¹ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> gee

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"net/http"</span>
)

<span class="hljs-comment">// HandlerFunc å®šä¹‰äº†Geeæ¡†æ¶ä½¿ç”¨çš„è¯·æ±‚å¤„ç†å‡½æ•°ç±»å‹</span>
<span class="hljs-keyword">type</span> HandlerFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(*Context)</span></span>

<span class="hljs-comment">// Engine å£°æ˜ä¸€ä¸ª Engine ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä¼šå®ç° ServeHTTP æ¥å£</span>
<span class="hljs-keyword">type</span> Engine <span class="hljs-keyword">struct</span> {
        router *router
}

<span class="hljs-comment">// New åˆ›å»º Engine å®ä¾‹ï¼Œåˆå§‹åŒ–ç©ºçš„è·¯ç”±è¡¨</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">()</span></span> *Engine {
        <span class="hljs-keyword">return</span> &amp;Engine{router: newRouter()}
}

<span class="hljs-comment">// å·¥å…·å‡½æ•°ï¼Œåç»­ GET å’Œ POST ä¼šä½¿ç”¨è¿™ä¸ªå‡½æ•°ç»™ engine çš„è·¯ç”±è¡¨æ·»åŠ è·¯ç”±</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> addRoute(method <span class="hljs-type">string</span>, pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        engine.router.addRoute(method, pattern, handler)
}

<span class="hljs-comment">// GET æä¾›ç»™ç”¨æˆ·æ³¨å†Œ GET è¯·æ±‚çš„ä¾¿æ·æ–¹æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> GET(pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        engine.addRoute(<span class="hljs-string">"GET"</span>, pattern, handler)
}

<span class="hljs-comment">// POST æä¾›ç»™ç”¨æˆ·æ³¨å†Œ POST è¯·æ±‚çš„ä¾¿æ·æ–¹æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> POST(pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        engine.addRoute(<span class="hljs-string">"POST"</span>, pattern, handler)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> Run(addr <span class="hljs-type">string</span>) (err <span class="hljs-type">error</span>) {
        <span class="hljs-keyword">return</span> http.ListenAndServe(addr, engine)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) {
        c := newContext(w, req)
        engine.router.handle(c)
}
</code></pre>
<p>è¿™æ—¶å€™æˆ‘ä»¬çš„æ¡†æ¶å·²ç»ä¿®æ”¹å¥½äº†ï¼Œå¯¹åº”çš„æˆ‘ä»¬ä¹Ÿè¯¥ä¿®æ”¹ä¸€ä¸‹ main.goï¼Œç”¨æ–°çš„æ¡†æ¶æ¥è¿›è¡Œæµ‹è¯•å¼€å‘ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"gee"</span>
        <span class="hljs-string">"net/http"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        r := gee.New()
        r.GET(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Hello Gee&lt;/h1&gt;"</span>)
        })
        r.GET(<span class="hljs-string">"/hello"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                <span class="hljs-comment">// expect /hello?name=ryan</span>
                c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Query(<span class="hljs-string">"name"</span>), c.Path)
        })

        r.POST(<span class="hljs-string">"/login"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                c.JSON(http.StatusOK, gee.H{
                        <span class="hljs-string">"username"</span>: c.PostForm(<span class="hljs-string">"username"</span>),
                        <span class="hljs-string">"password"</span>: c.PostForm(<span class="hljs-string">"password"</span>),
                })
        })

        r.Run(<span class="hljs-string">":9999"</span>)
}
</code></pre>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>Handler</code> çš„å‚æ•°å˜æˆäº† <code>gee.Context</code>ï¼ŒåŒæ—¶æä¾›äº† <code>Query/PostForm</code> å‚æ•°çš„åŠŸèƒ½ã€‚åŒæ—¶ <code>gee.Context</code> å°è£…äº† <code>HTML/String/JSON</code> å‡½æ•°ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ„é€  HTTP å“åº”ã€‚</p>
<p>è¿è¡Œåï¼Œæ•ˆæœä¸€è‡´ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">coding</span>/<span class="hljs-selector-tag">GoProject</span>/<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">via</span> î˜§ <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
â¯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/hello</span>
<span class="hljs-selector-tag">hello</span> , <span class="hljs-selector-tag">you</span>'<span class="hljs-selector-tag">re</span> <span class="hljs-selector-tag">at</span> /<span class="hljs-selector-tag">hello</span>

<span class="hljs-selector-tag">coding</span>/<span class="hljs-selector-tag">GoProject</span>/<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">via</span> î˜§ <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
â¯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/     </span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">Gee</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%  
                    
<span class="hljs-selector-tag">coding</span>/<span class="hljs-selector-tag">GoProject</span>/<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">via</span> î˜§ <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
â¯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/login</span>
<span class="hljs-number">404</span> <span class="hljs-selector-tag">NOT</span> <span class="hljs-selector-tag">FOUND</span>: /<span class="hljs-selector-tag">login</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€éº’éºŸKylinã€‘cmake-3.16.5 rpmåŒ…å®‰è£…æ­¥éª¤è¯¦è§£ é™„å¸¸è§é—®é¢˜]]></title>    <link>https://juejin.cn/post/7585397173022801939</link>    <guid>https://juejin.cn/post/7585397173022801939</guid>    <pubDate>2025-12-20T01:08:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173022801939" data-draft-id="7585400495683256362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€éº’éºŸKylinã€‘cmake-3.16.5 rpmåŒ…å®‰è£…æ­¥éª¤è¯¦è§£ é™„å¸¸è§é—®é¢˜"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-20T01:08:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·613541146016"/> <meta itemprop="url" content="https://juejin.cn/user/1602431422584832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€éº’éºŸKylinã€‘cmake-3.16.5 rpmåŒ…å®‰è£…æ­¥éª¤è¯¦è§£ é™„å¸¸è§é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1602431422584832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·613541146016
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T01:08:19.000Z" title="Sat Dec 20 2025 01:08:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<ol>
<li>å…ˆçœ‹çœ‹æ–‡ä»¶åœ¨å“ª</li>
</ol>
<p><strong>å®‰è£…åŒ…ä¸‹è½½ï¼š</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F8d4f291511e3" title="https://pan.quark.cn/s/8d4f291511e3" target="_blank" ref="nofollow noopener noreferrer">pan.quark.cn/s/8d4f29151â€¦</a>ï¼Œä¸€èˆ¬ä¸‹è½½å®Œä¼šåœ¨Â <strong>ä¸‹è½½</strong>â€‹ ç›®å½•æˆ–è€…ä½ æ”¾çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">~<span class="hljs-regexp">/Downloads/</span>cmake-<span class="hljs-number">3.16</span><span class="hljs-number">.5</span>-<span class="hljs-number">4.</span>p01.<span class="hljs-property">ky10</span>.<span class="hljs-property">x86_64</span>.<span class="hljs-property">rpm</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>ä½ å¯ä»¥å…ˆç”¨Â <code>ls</code>å‘½ä»¤ç¡®è®¤ä¸€ä¸‹æ–‡ä»¶åæ²¡é”™ã€‚</p>
<hr/>
<h2 data-id="heading-0">2. æ‰“å¼€ç»ˆç«¯</h2>
<p>å³é”®æ¡Œé¢é€‰â€œæ‰“å¼€ç»ˆç«¯â€ï¼Œæˆ–è€…æŒ‰Â <code>Ctrl + Alt + T</code>ã€‚</p>
<hr/>
<h2 data-id="heading-1">3. åˆ‡åˆ° rpm æ–‡ä»¶ç›®å½•</h2>
<p>æ¯”å¦‚æ–‡ä»¶åœ¨ä¸‹è½½ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~/Downloads
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">4. æ£€æŸ¥æœ‰æ²¡æœ‰è£…è¿‡ cmake</h2>
<p>å¯ä»¥å…ˆæ•²ï¼š</p>
<pre><code class="hljs language-css" lang="css">cmake <span class="hljs-attr">--version</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>å¦‚æœæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤ï¼Œè¯´æ˜æ²¡è£…ï¼›å¦‚æœæœ‰ç‰ˆæœ¬å·ï¼Œä½ æƒ³æ¢è¿™ä¸ªç‰ˆæœ¬å°±ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p>
<hr/>
<h2 data-id="heading-3">5. å®‰è£… rpm åŒ…</h2>
<p>ç›´æ¥ç”¨ç³»ç»Ÿçš„åŒ…ç®¡ç†å·¥å…·è£…ï¼š</p>
<pre><code class="hljs">sudo rpm -ivh cmake-3.16.5-4.p01.ky10.x86_64.rpm
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>è¿™é‡ŒÂ <code>-i</code>æ˜¯å®‰è£…ï¼Œ<code>-v</code>æ˜¾ç¤ºè¿‡ç¨‹ï¼Œ<code>-h</code>æ˜¾ç¤ºè¿›åº¦æ¡ã€‚</p>
<p>å¦‚æœå®ƒæç¤ºç¼ºä¾èµ–ï¼Œä½ å°±å¾—å…ˆæŠŠç¼ºçš„åŒ…è£…ä¸Šï¼Œä¸ç„¶è£…ä¸ä¸Šã€‚</p>
<p>éº’éºŸç³»ç»Ÿå¯ä»¥ç”¨ yum æˆ– dnf è‡ªåŠ¨è§£å†³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install ./cmake-3.16.5-4.p01.ky10.x86_64.rpm
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>è¿™æ ·å®ƒä¼šå¸®ä½ æŠŠéœ€è¦çš„ä¾èµ–ä¸€èµ·æ‹‰ä¸‹æ¥è£…å¥½ã€‚</p>
<hr/>
<h2 data-id="heading-4">6. éªŒè¯å®‰è£…</h2>
<p>è£…å®Œåè¾“å…¥ï¼š</p>
<pre><code class="hljs language-css" lang="css">cmake <span class="hljs-attr">--version</span>
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p>çœ‹åˆ°ç‰ˆæœ¬å·æ˜¯ 3.16.5 å°±è¯´æ˜ OK äº†ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é€šè¿‡Cursoråˆ†æjså®‰å…¨åˆä½“éªŒ]]></title>    <link>https://juejin.cn/post/7585377403633483822</link>    <guid>https://juejin.cn/post/7585377403633483822</guid>    <pubDate>2025-12-19T23:21:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585377403633483822" data-draft-id="7585706951582269449" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é€šè¿‡Cursoråˆ†æjså®‰å…¨åˆä½“éªŒ"/> <meta itemprop="keywords" content="å®‰å…¨"/> <meta itemprop="datePublished" content="2025-12-19T23:21:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è§‚ä¸€"/> <meta itemprop="url" content="https://juejin.cn/user/2754692828113043"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é€šè¿‡Cursoråˆ†æjså®‰å…¨åˆä½“éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2754692828113043/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è§‚ä¸€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T23:21:47.000Z" title="Fri Dec 19 2025 23:21:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>åœ¨å‰ç«¯å®‰å…¨æ‰«æä¸­ï¼Œè·å–å®Œæ•´çš„ JavaScript ä»£ç æ˜¯åˆ†æçš„åŸºç¡€ã€‚æœ¬æ–‡æ¡£ä»‹ç» Web åº”ç”¨ã€H5 åº”ç”¨å’Œå¿«åº”ç”¨ä¸‰ç§åœºæ™¯ä¸‹çš„ JS ä»£ç è·å–æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Cursor è¿›è¡Œä»£ç åˆ†æã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€Web åº”ç”¨ä»£ç è·å–ï¼ˆHAR æ–¹å¼ï¼‰</h2>
<h3 data-id="heading-2">1.1 ä¸‹è½½ç½‘ç«™çš„å®Œæ•´ HAR æ–‡ä»¶</h3>
<p>HARï¼ˆHTTP Archiveï¼‰æ–‡ä»¶æ˜¯æµè§ˆå™¨å°†æ•´ä¸ªç½‘é¡µåŠ è½½è¿‡ç¨‹çš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚å®Œæ•´è®°å½•ä¸‹æ¥çš„"æŠ“åŒ…æ—¥å¿—æ–‡ä»¶"ã€‚å®ƒè®°å½•äº†æµè§ˆå™¨è®¿é—®ç½‘é¡µæ—¶è§¦å‘çš„æ‰€æœ‰ HTTP è¯·æ±‚åŠè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬é™æ€èµ„æºï¼ˆJS/CSS/å›¾ç‰‡ï¼‰çš„ä¸‹è½½æƒ…å†µã€‚æˆ‘ä»¬ä¸‹è½½ HAR æ–‡ä»¶åï¼Œå¯ä»¥æå–ç½‘é¡µä¸­çš„æ‰€æœ‰èµ„æºï¼Œå…¶ä¸­ JS æ˜¯æˆ‘ä»¬æœ€ä¸»è¦çš„åˆ†æå¯¹è±¡ã€‚</p>
<h4 data-id="heading-3">æ“ä½œæ­¥éª¤ï¼š</h4>
<ol>
<li>
<p><strong>è®¿é—®ç›®æ ‡ç½‘ç«™</strong>ï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰</p>
</li>
<li>
<p><strong>é€‰æ‹© Network é¢æ¿</strong>ï¼Œå‹¾é€‰ <strong>Preserve log</strong> é€‰é¡¹</p>
<ul>
<li>å‹¾é€‰åï¼Œé¡µé¢è·³è½¬æˆ–åˆ·æ–°æ—¶ï¼ŒNetwork é¢æ¿ä¸­çš„è¯·æ±‚è®°å½•ä¸ä¼šè¢«æ¸…ç©ºï¼Œä¼šä¿ç•™ä¸‹æ¥
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c513361027c14af3a56481d1ece26343~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KeC5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766791307&amp;x-signature=EBNwPrXJiAODTmm%2BiZnixnpleVk%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
<li>
<p><strong>åˆ·æ–°é¡µé¢</strong>ï¼Œè®© JS ç­‰èµ„æºåŠ è½½å®Œæˆ</p>
</li>
<li>
<p><strong>ç‚¹å‡»ä¸‹è½½æŒ‰é’®</strong>ï¼Œå¯¼å‡º HAR æ–‡ä»¶</p>
</li>
<li>
<p><strong>ä¸‹è½½å®Œæˆå</strong>ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª <code>domain.har</code> çš„æ–‡ä»¶</p>
</li>
</ol>
<h3 data-id="heading-4">1.2 è¿˜åŸ HAR æ–‡ä»¶ä¸­çš„å†…å®¹</h3>
<p>ä½¿ç”¨ä»¥ä¸‹ Python è„šæœ¬å°† HAR æ–‡ä»¶ä¸­çš„æ‰€æœ‰å“åº”å†…å®¹è¿˜åŸå¹¶ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä¿æŒåŸå§‹ç›®å½•ç»“æ„ã€‚</p>
<h4 data-id="heading-5">è¿è¡Œå‘½ä»¤ï¼š</h4>
<pre><code class="hljs language-bash" lang="bash">python extract_all_from_har.py site.har output_dir
</code></pre>
<h4 data-id="heading-6">Python è„šæœ¬ä»£ç ï¼š</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¯¥æ–‡ä»¶æ˜¯æŠŠwebç«¯åŠ è½½çš„harä¸­è¿˜åŸæˆå†…å®¹</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse
<span class="hljs-keyword">import</span> base64

<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">3</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Usage: python extract_all_from_har.py site.har output_dir"</span>)
    sys.exit(<span class="hljs-number">1</span>)

har_file = sys.argv[<span class="hljs-number">1</span>]
out_root = sys.argv[<span class="hljs-number">2</span>]
os.makedirs(out_root, exist_ok=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">guess_ext</span>(<span class="hljs-params">url_path: <span class="hljs-built_in">str</span>, mime: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-comment"># å¦‚æœ URL è‡ªå¸¦æ‰©å±•åï¼Œä¼˜å…ˆç”¨å®ƒ</span>
    name = os.path.basename(url_path)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"."</span> <span class="hljs-keyword">in</span> name <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> name.endswith(<span class="hljs-string">"."</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>
    <span class="hljs-comment"># å¦åˆ™æ ¹æ® mimeType çŒœä¸€ä¸ª</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".txt"</span>
    mime = mime.lower()
    <span class="hljs-keyword">if</span> <span class="hljs-string">"javascript"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".js"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"json"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".json"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"html"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".html"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"css"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".css"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"xml"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".xml"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"svg"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".svg"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"plain"</span> <span class="hljs-keyword">in</span> mime:
        <span class="hljs-keyword">return</span> <span class="hljs-string">".txt"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">".txt"</span>

<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(har_file, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    har = json.load(f)

count = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> entry <span class="hljs-keyword">in</span> har[<span class="hljs-string">"log"</span>][<span class="hljs-string">"entries"</span>]:
    req = entry.get(<span class="hljs-string">"request"</span>, {})
    res = entry.get(<span class="hljs-string">"response"</span>, {})
    content = res.get(<span class="hljs-string">"content"</span>, {})
    text = content.get(<span class="hljs-string">"text"</span>)

    <span class="hljs-comment"># æ²¡æœ‰å†…å®¹å°±è·³è¿‡ï¼ˆå¾ˆå¤šå¤§æ–‡ä»¶/äºŒè¿›åˆ¶åœ¨ HAR é‡Œä¸ä¼šå¸¦å®Œæ•´å†…å®¹ï¼‰</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> text:
        <span class="hljs-keyword">continue</span>

    url = req.get(<span class="hljs-string">"url"</span>, <span class="hljs-string">""</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url:
        <span class="hljs-keyword">continue</span>

    parsed = urlparse(url)
    host = parsed.netloc <span class="hljs-keyword">or</span> <span class="hljs-string">"unknown_host"</span>
    path = parsed.path <span class="hljs-keyword">or</span> <span class="hljs-string">"/"</span>
    mime = content.get(<span class="hljs-string">"mimeType"</span>, <span class="hljs-string">""</span>)

    <span class="hljs-comment"># ç”Ÿæˆæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼šroot/host/path</span>
    <span class="hljs-comment"># ä¾‹å¦‚ï¼šhttps://a.com/path/to/file.js -&gt; out_root/a.com/path/to/file.js</span>
    <span class="hljs-comment"># å¦‚æœ path ä»¥ / ç»“å°¾ï¼Œè¡¥ä¸€ä¸ª index</span>
    <span class="hljs-keyword">if</span> path.endswith(<span class="hljs-string">"/"</span>):
        path = path + <span class="hljs-string">"index"</span>

    <span class="hljs-comment"># ç›®å½• + æ–‡ä»¶åæ‹†åˆ†</span>
    dir_path, filename = os.path.split(path)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> filename:
        filename = <span class="hljs-string">"index"</span>

    <span class="hljs-comment"># æ ¹æ® mime çŒœæ‰©å±•åï¼ˆå¦‚æœ URL é‡Œæ²¡æœ‰ï¼‰</span>
    ext = <span class="hljs-string">""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"."</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> filename:
        ext = guess_ext(path, mime)
    filename_full = filename + ext

    out_dir = os.path.join(out_root, host, dir_path.lstrip(<span class="hljs-string">"/"</span>))
    os.makedirs(out_dir, exist_ok=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># é˜²æ­¢é‡åè¦†ç›–ï¼šåŒè·¯å¾„å¤šæ¬¡å“åº”æ—¶åŠ è®¡æ•°åç¼€</span>
    out_path = os.path.join(out_dir, filename_full)
    <span class="hljs-keyword">if</span> os.path.exists(out_path):
        base, ext2 = os.path.splitext(filename_full)
        out_path = os.path.join(out_dir, <span class="hljs-string">f"<span class="hljs-subst">{base}</span>_<span class="hljs-subst">{count}</span><span class="hljs-subst">{ext2}</span>"</span>)

    <span class="hljs-comment"># å¤„ç†å¯èƒ½çš„ base64 ç¼–ç </span>
    <span class="hljs-keyword">if</span> content.get(<span class="hljs-string">"encoding"</span>) == <span class="hljs-string">"base64"</span>:
        <span class="hljs-keyword">try</span>:
            data = base64.b64decode(text)
            <span class="hljs-comment"># å°è¯•æŒ‰ utf-8 è§£ç æˆæ–‡æœ¬ï¼Œå¤±è´¥å°±ç›´æ¥å†™äºŒè¿›åˆ¶</span>
            <span class="hljs-keyword">try</span>:
                text_decoded = data.decode(<span class="hljs-string">"utf-8"</span>)
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(out_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>, errors=<span class="hljs-string">"ignore"</span>) <span class="hljs-keyword">as</span> out:
                    out.write(text_decoded)
            <span class="hljs-keyword">except</span> UnicodeDecodeError:
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(out_path, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> out:
                    out.write(data)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[WARN] failed to decode base64 for <span class="hljs-subst">{url}</span>: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">continue</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># ç›´æ¥å†™æ–‡æœ¬</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(out_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>, errors=<span class="hljs-string">"ignore"</span>) <span class="hljs-keyword">as</span> out:
            out.write(text)

    count += <span class="hljs-number">1</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Saved <span class="hljs-subst">{count}</span> responses to <span class="hljs-subst">{out_root}</span>"</span>)
</code></pre>
<h4 data-id="heading-7">æ‰§è¡Œç»“æœï¼š</h4>
<p>æ‰§è¡Œå®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°ç½‘ç«™ä¸­çš„ JS æ–‡ä»¶å·²ç»è¢«å…¨éƒ¨ä¸‹è½½ä¸‹æ¥äº†ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61c2e5ba169e4d099da1e6a12d69ae58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KeC5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766791307&amp;x-signature=XINmr0jHgRcsntP%2BKF0jQAxl4vw%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">äºŒã€H5 åº”ç”¨ä»£ç è·å–</h2>
<p>H5 å’Œå¿«åº”ç”¨ç±»å‹çš„ä¸šåŠ¡ä¹Ÿæ˜¯é€šè¿‡ JS å®ç°çš„ï¼Œå› æ­¤ä¹Ÿå¯ä»¥é€šè¿‡ Cursor æ¥åˆ†æï¼Œåªæ˜¯è·å– JS ä»£ç çš„æ–¹å¼ç•¥æœ‰ä¸åŒã€‚</p>
<h3 data-id="heading-9">æ–¹å¼ä¸€ï¼šç›´æ¥è®¿é—®ç½‘ç«™ï¼ˆæ¨èï¼‰</h3>
<p>H5 çš„ JS ä»£ç å¯ä»¥ç›´æ¥è®¿é—®ç½‘ç«™åœ°å€ï¼Œé€šè¿‡å’Œ Web åº”ç”¨ä¸€æ ·çš„æ–¹å¼è·å¾—ï¼š</p>
<ol>
<li>ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—® H5 é¡µé¢ URL</li>
<li>æŒ‰ç…§ <strong>"ä¸€ã€Web åº”ç”¨ä»£ç è·å–"</strong> çš„æ–¹æ³•ï¼Œä¸‹è½½ HAR æ–‡ä»¶å¹¶è¿˜åŸ</li>
</ol>
<h3 data-id="heading-10">æ–¹å¼äºŒï¼šAttach åˆ° WebView å®ä¾‹ï¼ˆHybrid åœºæ™¯ï¼‰</h3>
<p>å½“ H5 é¡µé¢åµŒå…¥åœ¨ App çš„ WebView ä¸­æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ï¼š</p>
<ol>
<li>
<p><strong>å¼€å¯ WebView è°ƒè¯•</strong></p>
<ul>
<li>åœ¨ App ä¸­å¯ç”¨ WebView è°ƒè¯•åŠŸèƒ½ï¼ˆé€šå¸¸éœ€è¦åœ¨ä»£ç ä¸­è®¾ç½® <code>setWebContentsDebuggingEnabled(true)</code>ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è¿æ¥ WebView</strong></p>
<ul>
<li>åœ¨ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€ <code>chrome://inspect/#devices</code></li>
<li>æ‰¾åˆ°ç›®æ ‡ WebView å®ä¾‹ï¼Œç‚¹å‡» <strong>"inspect"</strong> æŒ‰é’®
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80b23f73e3f94c45bd77616fe8473b5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KeC5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766791307&amp;x-signature=aYvecY0t0kzI1yhdtwVlJR2XRhk%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
<li>
<p><strong>æ‰‹åŠ¨ä¸‹è½½ JS æ–‡ä»¶</strong></p>
<ul>
<li>åœ¨æ‰“å¼€çš„ DevTools ä¸­ï¼Œåˆ‡æ¢åˆ° <strong>Sources</strong> é¢æ¿</li>
<li>æ‰¾åˆ°éœ€è¦åˆ†æçš„ JS æ–‡ä»¶ï¼Œå³é”®é€‰æ‹© <strong>"Save as..."</strong> ä¿å­˜åˆ°æœ¬åœ°
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43ce7fd319864733a462ccfc954b1b9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KeC5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766791307&amp;x-signature=llRFNrxEVFp9TAT4jYSi31J8ttw%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">ä¸ºä»€ä¹ˆä¸èƒ½è‡ªåŠ¨ä¸‹è½½ HARï¼Ÿ</h4>
<p>åœ¨ Attach åˆ° WebView æ—¶ï¼ŒNetwork é¢æ¿çš„äº‹ä»¶æ¥è‡ª CDPï¼ˆChrome DevTools Protocolï¼‰ç½‘ç»œåŸŸï¼Œæ˜¯æ˜ å°„/è½¬æ¢åçš„è§†å›¾ï¼Œä¸ä¸€å®šåŒ…å«å®Œæ•´çš„å“åº”ä½“ã€‚è€Œ Sources é¢æ¿é€šè¿‡è°ƒè¯•æ¥å£ï¼ˆ<code>Debugger.getScriptSource</code>ï¼‰ç›´æ¥ä»è¿è¡Œæ—¶è·å–è„šæœ¬æºç ï¼Œå› æ­¤å¯ä»¥ä¸‹è½½ã€‚æ‰€ä»¥éœ€è¦æ‰‹åŠ¨ä¸‹è½½ JSï¼Œè€Œä¸æ˜¯ä¾èµ– HAR å¯¼å‡ºã€‚</p>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€å¿«åº”ç”¨ä»£ç è·å–</h2>
<h3 data-id="heading-13">æ–¹å¼ä¸€ï¼šæœ‰ RPK åŒ…çš„æƒ…å†µ</h3>
<p>ç›´æ¥å°†å¿«åº”ç”¨çš„ RPK åŒ…è¿›è¡Œè§£å‹å³å¯è·å¾—å®Œæ•´çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># RPK æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP å‹ç¼©åŒ…</span>
unzip target_app.rpk -d output_dir
</code></pre>
<h3 data-id="heading-14">æ–¹å¼äºŒï¼šæ—  RPK åŒ…çš„æƒ…å†µ</h3>
<ol>
<li>
<p><strong>åœ¨å¿«åº”ç”¨ App ä¸­åŠ è½½ç›®æ ‡å¿«åº”ç”¨</strong></p>
<ul>
<li>å¿«åº”ç”¨å¼•æ“ä¼šæŠŠå¿«åº”ç”¨çš„ä»£ç ä¸‹è½½åˆ°æœ¬åœ°</li>
</ul>
</li>
<li>
<p><strong>å®šä½å¿«åº”ç”¨åŒ…ä½“ç›®å½•</strong></p>
<ul>
<li>å¿«åº”ç”¨çš„ç§æœ‰ç›®å½•é€šå¸¸åœ¨ï¼š<code>/data/data/com.quick.instant/com.target.demo</code></li>
<li>å…·ä½“è·¯å¾„å¯èƒ½å› å¿«åº”ç”¨å¼•æ“è€Œå¼‚</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨ adb å‘½ä»¤å¯¼å‡º</strong></p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿æ¥è®¾å¤‡åï¼Œä½¿ç”¨ adb pull å¯¼å‡º</span>
adb pull /data/data/com.quick.instant/com.target.demo ./output_dir
</code></pre>
<hr/>
<h2 data-id="heading-15">å››ã€ä½¿ç”¨ Cursor è¿›è¡Œä»£ç åˆ†æ</h2>
<h3 data-id="heading-16">4.1 å¯¼å…¥é¡¹ç›®ç›®å½•</h3>
<p>å°†è·å¾—çš„ç›®å½•ï¼ˆæ— è®ºæ˜¯ HAR è¿˜åŸçš„ã€WebView ä¸‹è½½çš„ï¼Œè¿˜æ˜¯å¿«åº”ç”¨è§£å‹çš„ï¼‰å¯¼å…¥åˆ° Cursor ä¸­ã€‚</p>
<h3 data-id="heading-17">4.2 å¼€å§‹å®‰å…¨åˆ†æ</h3>
<p>Cursor å¯ä»¥å¯¹æ•´ä¸ªé¡¹ç›®ç›®å½•è¿›è¡Œæ•´ä½“æ€§åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨è¿™ä¸ªèƒ½åŠ›æ¥è¯†åˆ« JS ä¸­æ˜¯å¦å­˜åœ¨é£é™©ã€‚</p>
<h4 data-id="heading-18">å…¸å‹åˆ†æåœºæ™¯ï¼š</h4>
<ol>
<li>
<p><strong>æ¥å£åŠ å¯†å’Œç­¾åç®—æ³•åˆ†æ</strong></p>
<ul>
<li>è¯†åˆ« API è¯·æ±‚çš„åŠ å¯†æ–¹å¼</li>
<li>åˆ†æç­¾åç®—æ³•å®ç°</li>
</ul>
</li>
<li>
<p><strong>ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯æ£€æµ‹</strong></p>
<ul>
<li>æŸ¥æ‰¾ç¡¬ç¼–ç çš„ Tokenã€API Keyã€å¯†ç ç­‰</li>
<li>è¯†åˆ«æ•æ„Ÿé…ç½®ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨æ¼æ´æ‰«æ</strong></p>
<ul>
<li>XSS æ¼æ´åˆ†æ</li>
<li>å¼€æ”¾é‡å®šå‘æ£€æµ‹</li>
<li>JSBridge å®‰å…¨åˆ†æï¼ˆé’ˆå¯¹ H5ï¼‰</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7785c91d467c4916a36212cf6fd67030~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KeC5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766791307&amp;x-signature=AQtzvHgnwibAM4yYahJksn1OMZs%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-19">å®æˆ˜ç ”ç©¶å‘ç°ï¼š</h4>
<p>Cursor çš„åˆ†æèƒ½åŠ›éå¸¸å¼ºå¤§ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å®Œæˆç»å¤§éƒ¨åˆ†çš„åˆ†æå·¥ä½œï¼Œæå¤§æå‡ç ”ç©¶æ•ˆç‡ã€‚</p>
<hr/>
<h2 data-id="heading-20">æ€»ç»“</h2>

























<table><thead><tr><th>åº”ç”¨ç±»å‹</th><th>ä»£ç è·å–æ–¹å¼</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>Web åº”ç”¨</strong></td><td>ä¸‹è½½ HAR â†’ Python è„šæœ¬è¿˜åŸ</td><td>ç¡®ä¿å‹¾é€‰ Preserve logï¼Œå®Œæ•´åŠ è½½é¡µé¢</td></tr><tr><td><strong>H5 åº”ç”¨</strong></td><td>æ–¹å¼ä¸€ï¼šç›´æ¥è®¿é—®ä¸‹è½½ HAR<br/>æ–¹å¼äºŒï¼šAttach WebView â†’ Sources æ‰‹åŠ¨ä¸‹è½½</td><td>WebView æ–¹å¼éœ€æ‰‹åŠ¨ä¸‹è½½ï¼Œæ— æ³•ä½¿ç”¨ HAR</td></tr><tr><td><strong>å¿«åº”ç”¨</strong></td><td>æ–¹å¼ä¸€ï¼šè§£å‹ RPK åŒ…<br/>æ–¹å¼äºŒï¼šadb pull å¯¼å‡º</td><td>éœ€è¦ root æƒé™æˆ–ä½¿ç”¨ adb</td></tr></tbody></table>
<p>æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼è·å–ä»£ç ï¼Œæœ€ç»ˆéƒ½å¯ä»¥å¯¼å…¥ Cursor è¿›è¡Œç»Ÿä¸€çš„å®‰å…¨åˆ†æï¼Œæé«˜æ•ˆç‡ã€‚</p>
<hr/>
<h2 data-id="heading-21">å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2F" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/" ref="nofollow noopener noreferrer">Chrome DevTools Protocol æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.softwareishard.com%2Fblog%2Fhar-12-spec%2F" target="_blank" title="http://www.softwareishard.com/blog/har-12-spec/" ref="nofollow noopener noreferrer">HAR æ ¼å¼è§„èŒƒ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fdevtools%2Fremote-debugging%2Fwebviews%2F" target="_blank" title="https://developer.chrome.com/docs/devtools/remote-debugging/webviews/" ref="nofollow noopener noreferrer">Android WebView è°ƒè¯•æŒ‡å—</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VimæŸ¥çœ‹æ—¥å¿—æŠ€å·§]]></title>    <link>https://juejin.cn/post/7585686247268515849</link>    <guid>https://juejin.cn/post/7585686247268515849</guid>    <pubDate>2025-12-20T00:17:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585686247268515849" data-draft-id="7585686247268499465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VimæŸ¥çœ‹æ—¥å¿—æŠ€å·§"/> <meta itemprop="keywords" content="VIM"/> <meta itemprop="datePublished" content="2025-12-20T00:17:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="morn_venus"/> <meta itemprop="url" content="https://juejin.cn/user/4125813603073550"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VimæŸ¥çœ‹æ—¥å¿—æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125813603073550/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    morn_venus
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T00:17:40.000Z" title="Sat Dec 20 2025 00:17:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">vimæŸ¥çœ‹æ—¥å¿—æŠ€å·§</h2>
<ul>
<li>å¹³å¸¸çœ‹æ—¥å¿—éƒ½æ˜¯ç”¨vimæ¥æŸ¥çœ‹ï¼Œä¸»è¦æ˜¯ä½¿ç”¨vimèƒ½å¤Ÿå¿«é€Ÿæ‰“å¼€å¤§æ–‡ä»¶ä¸å¡é¡¿ï¼Œä¸”æœç´¢è¿…é€Ÿï¼Œç­›é€‰ä¹Ÿéå¸¸ä¾¿æ·</li>
<li>åæ¥çœ‹åŒäº‹ç”¨ <strong>TextAnalysisTool</strong> æŸ¥çœ‹æ—¥å¿—ï¼Œæ„Ÿè§‰æœ‰äº›åŠŸèƒ½è¿˜æŒºå®ç”¨çš„ï¼Œäºæ˜¯æƒ³ç€èƒ½ä¸èƒ½é€šè¿‡vimä¹Ÿå®ç°è¿™äº›åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯ <strong>TextAnalysisTool</strong>çš„å¸¸ç”¨åŠŸèƒ½
<ul>
<li>ç­›é€‰å™¨ï¼šæ”¯æŒåé€‰ã€ä¸Šè‰²ï¼ˆä¸Šè‰²æœ‰ä¼˜å…ˆçº§ï¼‰</li>
<li>æŠ˜å éç­›é€‰å™¨å‘½ä¸­çš„è¡Œ</li>
<li>å¯¼å‡ºç­›é€‰å™¨å‘½ä¸­çš„è¡Œåˆ°å…¶ä»–æ–‡ä»¶</li>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0245fac9c8443618cfc40517ef19a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=mfkz%2FC9eK7EXQnQHy9rzU5eOV0w%3D" alt="image.png" loading="lazy"/></li>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9e73d2d99904fc381300334622e05d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=oAhWZcH%2FP9fXRV%2FI43TuZmnQtSQ%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
</ul>
<h3 data-id="heading-1">æ¨¡æ‹Ÿ TextAnalysisTool åŠŸèƒ½</h3>
<h4 data-id="heading-2">ç­›é€‰å™¨</h4>
<ul>
<li>
<p><code>:vimgrep /\v(ERROR|WARN)/ %</code>  then <code>:copen</code></p>
<ul>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e6624fb4ff94d539c8a251926af9577~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=tUH%2B6cOrqNDgl5X35%2F1o5LIdxQM%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
<li>
<p>æŸ“è‰²</p>
<pre><code class="hljs language-bash" lang="bash">syn match LogError /^.*\[ERROR\].*$/
highlight LogError ctermbg=Red

syn match LogWarn /^.*\[WARN\].*$/
highlight LogWarn ctermbg=Yellow

syn match LogInfo /INFO/
highlight <span class="hljs-built_in">link</span> LogInfo Identifier
</code></pre>
<ul>
<li>å°†ä»¥ä¸Šä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶æ¯”å¦‚ <code>color.vim</code>ï¼Œåœ¨æ‰“å¼€æ—¥å¿—åå®ç”¨å‘½ä»¤: <code>:source color.vim</code> å³å¯ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡éƒ½è¦ä¸´æ—¶é…ç½®é¢œè‰²æ–¹æ¡ˆäº†ã€‚</li>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30efd5dd8e764db5bcae19bc84b8ce1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=ptyasKoi30Qaw3K7mtRqlp8Xt0A%3D" alt="image.png" loading="lazy"/></li>
<li>ä¼˜å…ˆçº§ï¼šåå®šä¹‰çš„ä¼˜å…ˆçº§æ¯”å…ˆå®šä¹‰çš„ä¼˜å…ˆçº§è¦é«˜</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">æŠ˜å </h4>
<ul>
<li>å…¶å®å¯¼èˆªçª—å£å·²ç»ç®—æ˜¯æŠ˜å åçš„æ•ˆæœäº†ï¼Œè€Œæ—¥å¿—çª—å£æ˜¯éæŠ˜å çš„æ•ˆæœï¼Œä½†æ˜¯vimæ”¯æŒæ›´é«˜çº§çš„æŠ˜å åŠŸèƒ½
<ul>
<li><code>:set foldemethod=expr foldexpr=getline(v:lnum)!~'\\v(ERROR\|WARN)'</code></li>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f78c3d4184ea4b1db39bd2510bf5c10e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=%2BFDJiRJnh90k6zZe5j2Fp2gwL%2Fc%3D" alt="image.png" loading="lazy"/></li>
<li><code>za</code> åˆ‡æ¢å½“å‰å…‰æ ‡å¤„çš„æŠ˜å é¡¹çš„å±•å¼€å’ŒæŠ˜å çŠ¶æ€</li>
<li><code>zR</code>: å±•å¼€æ‰€æœ‰æŠ˜å </li>
<li><code>zM</code>: æ”¶èµ·æ‰€æœ‰æŠ˜å </li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">å¯¼å‡º</h4>
<ul>
<li>å¯¼å‡ºéå¸¸ç®€å•ï¼Œåœ¨å¯¼èˆªçª—å£ä¸­æ‰§è¡Œ: <code>:w file_name</code> å³å¯</li>
</ul>
<h4 data-id="heading-5">æŒä¹…åŒ–</h4>
<ul>
<li>å¦‚æœæ¯æ¬¡æ‰“å¼€éƒ½è¦åšè¿™ä¹ˆä¸€ç³»åˆ—æ“ä½œè¦çƒ¦æ­»äº†ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™äº›æ“ä½œæ”¾åˆ°è„šæœ¬æ–‡ä»¶<code>log.vim</code>ä¸­</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> color.vim
<span class="hljs-built_in">set</span> foldmethod=<span class="hljs-built_in">expr</span> foldexpr=getline(v:lnum)!~<span class="hljs-string">'\\v(ERROR\|WARN)'</span>

vimgrep /\v(ERROR|WARN)/ %
copen
<span class="hljs-built_in">source</span> color.vim
</code></pre>
<ul>
<li>è¿è¡Œå®Œ: <code>:source log.vim</code> çš„æ•ˆæœå›¾
<ul>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bf0756b21d74d32a209efc7ced12dd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=fb9c9Kz9w%2Bx0LcgYlnk5iW3yttM%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">blend</h3>
<ul>
<li>å¦‚æœè§‰å¾—èƒŒæ™¯è‰²å¤ªç¢çœ¼äº†ï¼Œå¯ä»¥è®¾ç½®å‰æ™¯è‰²: <code>ctermbg</code> æ”¹ä¸º <code>ctermfg</code>
<ul>
<li><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95bda81442cf4578a7172c8298b1366f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ybl92ZW51cw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766794660&amp;x-signature=it447k08YGZy0i3twASadxv%2BO5Q%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-189 Nginx JSON æ—¥å¿—æ¥å…¥ ELKï¼šZK+Kafka+Elasticsearch 7.3.0+Kibana å®æˆ˜æ­å»º]]></title>    <link>https://juejin.cn/post/7585410547337363506</link>    <guid>https://juejin.cn/post/7585410547337363506</guid>    <pubDate>2025-12-20T01:06:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585410547337363506" data-draft-id="7585706951582367753" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-189 Nginx JSON æ—¥å¿—æ¥å…¥ ELKï¼šZK+Kafka+Elasticsearch 7.3.0+Kibana å®æˆ˜æ­å»º"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-20T01:06:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-189 Nginx JSON æ—¥å¿—æ¥å…¥ ELKï¼šZK+Kafka+Elasticsearch 7.3.0+Kibana å®æˆ˜æ­å»º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T01:06:19.000Z" title="Sat Dec 20 2025 01:06:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šç”¨ Nginx äº§ç”Ÿæ—¥å¿—ï¼Œèµ° Zookeeper+Kafka æ±‡èšï¼Œå†™å…¥ Elasticsearchï¼ŒKibana å¯è§†åŒ–</li>
<li>ç»“è®ºï¼šå…ˆæŠŠ Nginx access_log è§„èŒƒä¸º JSONï¼Œåç»­é‡‡é›†è§£ææˆæœ¬æœ€ä½ã€ååæœ€ç¨³</li>
<li>äº§å‡ºï¼šå¯å¤ç°çš„æœ€å°é“¾è·¯ï¼ˆNginxâ†’Kafkaâ†’ESâ†’Kibanaï¼‰ä¸å¸¸è§æ•…éšœé€ŸæŸ¥è¡¨</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4702f4260124389bb15248feeca06c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=bPMUpAedI%2FALKrFpo%2BfB2xoZTPg%3D" alt="å¤§æ•°æ®-189 Nginx JSON æ—¥å¿—æ¥å…¥ ELKï¼šZK+Kafka+Elasticsearch 7.3.0+Kibana å®æˆ˜æ­å»º" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>















































<table><thead><tr><th>ç»„ä»¶</th><th>ç‰ˆæœ¬</th><th>å·²éªŒè¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Nginx</td><td>apt å®‰è£…ç‰ˆï¼ˆéšå‘è¡Œç‰ˆå˜åŒ–ï¼‰</td><td>éƒ¨åˆ†</td><td>å…³é”®åœ¨ <code>log_format json</code> ä¸ <code>access_log ... json;</code> ç”Ÿæ•ˆï¼›ç‰ˆæœ¬ä¸å½±å“è¯¥ç”¨æ³•ä¸»è·¯å¾„</td></tr><tr><td>Zookeeper</td><td>æœªæ³¨æ˜</td><td>éƒ¨åˆ†</td><td>éœ€ä¸‰èŠ‚ç‚¹åˆ†åˆ« <code>zkServer.sh start</code>ï¼›æ³¨æ„æœåŠ¡ç”¨æˆ·ã€JAVA_HOMEã€æ•°æ®ç›®å½•ä¸€è‡´æ€§</td></tr><tr><td>Kafka</td><td>2.12-2.7.2</td><td>æ˜¯</td><td>ä»¥ <code>kafka-server-start.sh -daemon .../server.properties</code> å¯åŠ¨ï¼›ä¾èµ–å¯ç”¨çš„ ZK/æˆ–é…ç½®åˆ°ä½</td></tr><tr><td>Elasticsearch</td><td>7.3.0</td><td>æ˜¯</td><td><code>.../elasticsearch -d</code>ï¼›æ³¨æ„ <code>vm.max_map_count</code>ã€æƒé™ã€bootstrap check</td></tr><tr><td>Kibana</td><td>7.3.0</td><td>æ˜¯</td><td>å¿…é¡»ä¸ ES ä¸»ç‰ˆæœ¬ä¸€è‡´ï¼›<code>bin/kibana</code> å‰å°è¿è¡Œï¼Œå»ºè®®é…è¿›ç¨‹å®ˆæŠ¤</td></tr><tr><td>æ—¥å¿—æ ¼å¼</td><td>Nginx JSONï¼ˆè‡ªå®šä¹‰å­—æ®µï¼‰</td><td>æ˜¯</td><td>ä»¥ JSON ç›´å‡ºé™ä½åç»­è§£ææˆæœ¬ï¼›å­—æ®µå‘½åå»ºè®®ç¨³å®šï¼ˆè§é€ŸæŸ¥å¡ï¼‰</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bad0e46f949549ad869c8e1a893ee24e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=xEVeStD7HpNfUYIowDwrB%2B%2BQGeM%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-2">æ•´ä½“æ¶æ„</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbd01dd5571643d0be8d5d52973dd7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=3zVNpnJz1%2BtbamVWJM3rqOpZAVU%3D" alt="æ•´ä½“çš„å¤„ç†æ¶æ„" loading="lazy"/></p>
<h2 data-id="heading-3">Nginx</h2>
<p>Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½ä½œä¸º IMAP/POP3 é‚®ä»¶ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ã€‚å®ƒæœ€åˆç”± Igor Sysoev äº 2004 å¹´å¼€å‘ï¼Œç›®çš„æ˜¯è§£å†³é«˜å¹¶å‘æƒ…å†µä¸‹çš„ C10K é—®é¢˜ï¼Œå³åŒæ—¶å¤„ç† 1 ä¸‡ä¸ªå®¢æˆ·ç«¯è¿æ¥çš„é—®é¢˜ã€‚Nginx é‡‡ç”¨äº†äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œèƒ½å¤Ÿä½¿ç”¨è¾ƒå°‘çš„èµ„æºå¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼Œå› æ­¤åœ¨é™æ€èµ„æºæœåŠ¡ã€åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰åœºæ™¯ä¸­è¡¨ç°å¾—å°¤ä¸ºå‡ºè‰²ã€‚</p>
<p>Nginx çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>é™æ€èµ„æºæœåŠ¡ï¼šNginx å¯ä»¥éå¸¸é«˜æ•ˆåœ°å¤„ç†é™æ€æ–‡ä»¶çš„è¯·æ±‚ï¼Œå¦‚ HTMLã€CSSã€JavaScriptã€å›¾ç‰‡ç­‰ï¼Œé€‚åˆä½œä¸ºå‰ç«¯æœåŠ¡å™¨ã€‚</li>
<li>åå‘ä»£ç†ï¼šNginx å¯ä»¥ä½œä¸ºåå‘ä»£ç†ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨å¤„ç†ï¼Œå†å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®ƒæ”¯æŒ HTTP å’Œ HTTPS åè®®ï¼Œèƒ½å¤Ÿå¸®åŠ©éšè—åç«¯æœåŠ¡å™¨ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚</li>
<li>è´Ÿè½½å‡è¡¡ï¼šNginx æ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚è½®è¯¢ã€åŠ æƒè½®è¯¢ã€IP å“ˆå¸Œç­‰ã€‚å®ƒå¯ä»¥å°†æµé‡åˆ†å‘åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li>
<li>ç¼“å­˜ï¼šNginx å¯ä»¥ç¼“å­˜åç«¯æœåŠ¡å™¨çš„å“åº”ï¼Œå‡å°‘å¯¹åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å‹åŠ›ï¼Œæå‡æ€§èƒ½ã€‚</li>
<li>é«˜å¹¶å‘æ”¯æŒï¼šç”±äºé‡‡ç”¨å¼‚æ­¥éé˜»å¡çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼ŒNginx å¯ä»¥å¤„ç†éå¸¸é«˜çš„å¹¶å‘è¿æ¥ï¼Œé€‚åˆå¤§è§„æ¨¡ç½‘ç«™çš„æµé‡å¤„ç†éœ€æ±‚ã€‚</li>
<li>æ¨¡å—åŒ–è®¾è®¡ï¼šNginx æ”¯æŒå¤šç§æ¨¡å—ï¼Œå¦‚ gzip å‹ç¼©ã€SSL/TLS åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€è¿æ¥é™åˆ¶ç­‰ï¼Œæ–¹ä¾¿å®šåˆ¶å’Œæ‰©å±•ã€‚</li>
</ul>
<h3 data-id="heading-4">é…ç½®Nginx</h3>
<p>æˆ‘è¿™é‡Œç›´æ¥ç”¨å·¥å…·å®‰è£…äº†ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨æºç ç¼–è¯‘çš„æ–¹å¼ç­‰ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">apt install nginx
</code></pre>
<p>å®‰è£…å®Œæ¯•åï¼Œæˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹Nginxçš„é…ç½®å†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å¯èƒ½ä¸ä¸€æ ·</span>
vim /etc/nginx/nginx.conf
</code></pre>
<p>åŸæ¥çš„å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬è¦ä¿®æ”¹å†…å®¹ï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dade12635ff4405a48c78f32686a70a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=HgHnpiUjhL%2BmBeKSyGX2%2Bmjh7hQ%3D" alt="é…ç½®Nginx" loading="lazy"/>
ä¿®æ”¹æ—¥å¿—çš„æ ¼å¼ï¼ˆæ–¹ä¾¿åç»­çš„Logstashè¿›è¡Œè§£æï¼Œè™½ç„¶Logstashå¯ä»¥é€šè¿‡æ­£åˆ™çš„æ–¹å¼æ¥å®ç°å­—æ®µçš„æå–ï¼Œä½†æ˜¯æ•ˆç‡å¹¶ä¸é«˜ï¼‰ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">log_format json '{ "@timestamp": "$time_iso8601", '
                '"remote_addr": "$remote_addr", '
                '"remote_user": "$remote_user", '
                '"body_bytes_sent": "$body_bytes_sent", '
                '"request_time": "$request_time", '
                '"status": "$status", '
                '"request_uri": "$request_uri", '
                '"request_method": "$request_method", '
                '"http_referrer": "$http_referer", '
                '"http_x_forwarded_for": "$http_x_forwarded_for", '
                '"http_user_agent": "$http_user_agent"}';
access_log logs/access.log json;
</code></pre>
<p>ä¿®æ”¹çš„å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d161aa59c8a4e528b192fd4cde2b0fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=dqgGv4K3HIT5U5xFW8oNl4AbIGM%3D" alt="é…ç½®Nginxçš„Config" loading="lazy"/>
åŒæ—¶æˆ‘ä»¬ç›‘å¬ä¸€ä¸ªåˆ«çš„ç«¯å£ï¼Œå¿…é¡»8888</p>
<pre><code class="hljs language-shell" lang="shell">server {
    listen 8888;
    server_name localhost;
    location / {
            root html;
            index index.html index.htm;
    }
}
</code></pre>
<p>è¿™éƒ¨åˆ†çš„æˆªå›¾ä¸ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b66579debb94564839a86f4e765600f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=mH3k4YSkc%2FTDP5SMUVsBpz38Ivg%3D" alt="ä¿®æ”¹æœåŠ¡" loading="lazy"/></p>
<h3 data-id="heading-5">é‡å¯Nginx</h3>
<pre><code class="hljs language-shell" lang="shell">nginx -s reload
</code></pre>
<h3 data-id="heading-6">è®¿é—®é¡µé¢</h3>
<pre><code class="hljs language-shell" lang="shell">http://h121.wzk.icu:8888/
</code></pre>
<p>æˆ‘ä»¬å¤šè®¿é—®å‡ æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°åå°çš„æ—¥å¿—çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">root@h121:/opt/wzk/logs# tail -f access.log 
{ "@timestamp": "2024-08-19T14:24:39+08:00", "remote_addr": "223.80.101.21", "remote_user": "-", "body_bytes_sent": "0", "request_time": "0.000", "status": "304", "request_uri": "/", "request_method": "GET", "http_referrer": "-", "http_x_forwarded_for": "-", "http_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"}
{ "@timestamp": "2024-08-19T14:24:39+08:00", "remote_addr": "223.80.101.21", "remote_user": "-", "body_bytes_sent": "0", "request_time": "0.000", "status": "304", "request_uri": "/", "request_method": "GET", "http_referrer": "-", "http_x_forwarded_for": "-", "http_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"}
{ "@timestamp": "2024-08-19T14:24:43+08:00", "remote_addr": "223.80.101.21", "remote_user": "-", "body_bytes_sent": "396", "request_time": "0.000", "status": "200", "request_uri": "/", "request_method": "GET", "http_referrer": "-", "http_x_forwarded_for": "-", "http_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"}
{ "@timestamp": "2024-08-19T14:24:43+08:00", "remote_addr": "223.80.101.21", "remote_user": "-", "body_bytes_sent": "197", "request_time": "0.000", "status": "404", "request_uri": "/favicon.ico", "request_method": "GET", "http_referrer": "http://h121.wzk.icu:8888/", "http_x_forwarded_for": "-", "http_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"}
{ "@timestamp": "2024-08-19T14:24:44+08:00", "remote_addr": "223.80.101.21", "remote_user": "-", "body_bytes_sent": "0", "request_time": "0.000", "status": "304", "request_uri": "/", "request_method": "GET", "http_referrer": "-", "http_x_forwarded_for": "-", "http_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"}
</code></pre>
<p>å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07317d06ce424879970ccfe32ab28c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766797579&amp;x-signature=f23oWeX%2FsfvYVNftUxmubYq7fDU%3D" alt="æŸ¥çœ‹Nginxçš„æ—¥å¿—" loading="lazy"/></p>
<h2 data-id="heading-7">Zookeeper</h2>
<p>Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œç”¨äºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ç®¡ç†ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥å’Œé›†ç¾¤ç®¡ç†ç­‰åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•ä½†å¯é çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿåè°ƒå¤šä¸ªæœåŠ¡å™¨ä¹‹é—´çš„çŠ¶æ€ï¼Œä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥åƒå•ä¸ªç³»ç»Ÿä¸€æ ·è¿›è¡Œç®¡ç†ã€‚Zookeeper çš„æ ¸å¿ƒç†å¿µæ˜¯é€šè¿‡ä¸€ä¸ªæ ‘çŠ¶çš„ç›®å½•ç»“æ„æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°ä¸º znodeã€‚</p>
<p>Zookeeper çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>å‘½åæœåŠ¡ï¼šZookeeper èƒ½å¤Ÿå­˜å‚¨å’Œæä¾›åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èµ„æºåç§°ä¿¡æ¯ï¼Œä¾‹å¦‚åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„æœåŠ¡å™¨åç§°å’Œåœ°å€ã€‚</li>
<li>é…ç½®ç®¡ç†ï¼šZookeeper å¯ä»¥å®æ—¶è·Ÿè¸ªå’Œåˆ†å‘é…ç½®æ•°æ®ï¼Œç¡®ä¿åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å„ä¸ªèŠ‚ç‚¹æ‹¥æœ‰ä¸€è‡´çš„é…ç½®çŠ¶æ€ã€‚</li>
<li>åˆ†å¸ƒå¼åŒæ­¥ï¼šZookeeper æä¾›äº†ä¸€ç§åŸè¯­ï¼Œå¸®åŠ©åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åœ¨æ“ä½œæ—¶ä¿æŒåŒæ­¥ï¼Œé¿å…æ•°æ®å†²çªå’Œç«äº‰æ¡ä»¶ã€‚</li>
<li>é›†ç¾¤ç®¡ç†ï¼šZookeeper èƒ½å¤Ÿç›‘æ§é›†ç¾¤ä¸­èŠ‚ç‚¹çš„å­˜æ´»çŠ¶æ€ï¼Œæä¾›èŠ‚ç‚¹çš„åŠ¨æ€åŠ å…¥ã€ç§»é™¤ä»¥åŠå¤±è´¥æ¢å¤çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å»å¯åŠ¨ ZooKeeper çš„é›†ç¾¤æœåŠ¡ï¼Œéœ€è¦åœ¨ï¼š</p>
<ul>
<li>h121</li>
<li>h122</li>
<li>h123
ä¸Šè¿°èŠ‚ç‚¹åˆ†åˆ«å¯åŠ¨ ZK æœåŠ¡ï¼š</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">zkServer.sh start
</code></pre>
<h2 data-id="heading-8">Kafka</h2>
<p>Kafka æ˜¯ç”± LinkedIn å¼€å‘çš„ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œç°ç”± Apache åŸºé‡‘ä¼šç»´æŠ¤ã€‚Kafka æœ€åˆæ˜¯ä¸ºäº†å¤„ç† LinkedIn å†…éƒ¨çš„å¤§è§„æ¨¡æ•°æ®æµè€Œè®¾è®¡çš„ï¼Œç°åœ¨å·²æˆä¸ºå„ç±»ä¼ä¸šç”¨äºå¤„ç†å®æ—¶æ•°æ®æµçš„é‡è¦å·¥å…·ã€‚</p>
<p>Kafka çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p>
<ul>
<li>é«˜ååé‡ï¼šKafka èƒ½å¤Ÿå¤„ç†å¤§é‡çš„æ•°æ®æµï¼Œæ”¯æŒä½å»¶è¿Ÿçš„å®æ—¶æ¶ˆæ¯å¤„ç†ã€‚</li>
<li>æŒä¹…åŒ–å­˜å‚¨ï¼šæ¶ˆæ¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå¯ä»¥è®¾ç½®ä¿ç•™ç­–ç•¥æ¥æ§åˆ¶æ¶ˆæ¯çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>å¯æ‰©å±•æ€§ï¼šKafka é€šè¿‡å¢åŠ åˆ†åŒºå’Œ Broker æ¥æ°´å¹³æ‰©å±•ï¼Œæ— éœ€ä¸­æ–­æœåŠ¡ã€‚</li>
<li>å®¹é”™æ€§ï¼šé€šè¿‡å‰¯æœ¬æœºåˆ¶ï¼ŒKafka å¯ä»¥åœ¨éƒ¨åˆ† Broker å¤±æ•ˆçš„æƒ…å†µä¸‹ä»ç„¶ç»§ç»­è¿è¡Œã€‚</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å»å¯åŠ¨Kafkaçš„é›†ç¾¤æœåŠ¡ï¼Œéœ€è¦åœ¨ï¼š</p>
<ul>
<li>h121</li>
<li>h122</li>
<li>h123
ä¸Šè¿°èŠ‚ç‚¹åˆ†åˆ«å¯åŠ¨ Kafka æœåŠ¡ï¼š</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">kafka-server-start.sh -daemon /opt/servers/kafka_2.12-2.7.2/config/server.properties
</code></pre>
<h2 data-id="heading-9">Elasticsearch</h2>
<p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTful æœç´¢å’Œåˆ†æå¼•æ“ï¼ŒåŸºäº Apache Lucene å¼€å‘ã€‚å®ƒèƒ½å¤Ÿå¿«é€Ÿå­˜å‚¨ã€æœç´¢å’Œåˆ†æå¤§é‡æ•°æ®ï¼Œå¹¿æ³›åº”ç”¨äºæ—¥å¿—å¤„ç†ã€å…¨æ–‡æœç´¢ã€æ•°æ®åˆ†æç­‰åœºæ™¯ã€‚</p>
<p>Elasticsearch é€šå¸¸å’Œå…¶ä»–å·¥å…·å¦‚ Logstash å’Œ Kibana ä¸€èµ·ä½¿ç”¨ï¼Œç»„æˆ ELKï¼ˆElasticsearchã€Logstashã€Kibanaï¼‰å †æ ˆï¼Œæ¥å®ç°ä»æ—¥å¿—é‡‡é›†ã€å¤„ç†åˆ°å¯è§†åŒ–å±•ç¤ºçš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬éœ€è¦å»å¯åŠ¨Elasticsearchçš„é›†ç¾¤æœåŠ¡ï¼Œéœ€è¦åœ¨ï¼š</p>
<ul>
<li>h121</li>
<li>h122</li>
<li>h123
ä¸Šè¿°èŠ‚ç‚¹åˆ†åˆ«å¯åŠ¨ Elasticsearch æœåŠ¡ï¼š</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">su es_server
/opt/servers/elasticsearch-7.3.0/bin/elasticsearch -d
</code></pre>
<h2 data-id="heading-10">Kibana</h2>
<p>Kibana æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®å¯è§†åŒ–å’Œæ¢ç´¢å·¥å…·ï¼Œä¸“é—¨ä¸º Elasticsearch è®¾è®¡ï¼Œç”¨æ¥å¸®åŠ©ç”¨æˆ·å¯¹å­˜å‚¨åœ¨ Elasticsearch ä¸­çš„æ•°æ®è¿›è¡Œå®æ—¶åˆ†æã€å¯è§†åŒ–å’Œç®¡ç†ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°åˆ›å»ºä¸åŒç±»å‹çš„å›¾è¡¨ã€ä»ªè¡¨ç›˜ã€ä»¥åŠæ•°æ®ç›‘æ§å·¥å…·ï¼Œå¿«é€Ÿè·å–å…³é”®ä¿¡æ¯ã€‚</p>
<p>æ ¸å¿ƒåŠŸèƒ½å’Œç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ•°æ®å¯è§†åŒ–ï¼šKibana æ”¯æŒåˆ›å»ºå¤šç§å›¾è¡¨ï¼ŒåŒ…æ‹¬æ¡å½¢å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ã€åœ°ç†å›¾ç­‰ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ‹–æ‹½ç•Œé¢å…ƒç´ ï¼Œå°†å¤æ‚çš„æ•°æ®è½¬æ¢ä¸ºå¯è¯»æ€§å¼ºçš„å¯è§†åŒ–å›¾è¡¨ã€‚</li>
<li>ä»ªè¡¨ç›˜ï¼šKibana å…è®¸ç”¨æˆ·å°†å¤šä¸ªå›¾è¡¨ã€åœ°å›¾ã€æœç´¢ç»“æœç»„åˆæˆä¸€ä¸ªç»Ÿä¸€çš„ä»ªè¡¨ç›˜ï¼Œä»¥ä¾¿å®æ—¶ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€æˆ–è€…è¿½è¸ªç‰¹å®šæŒ‡æ ‡ã€‚ä»ªè¡¨ç›˜å¯ä»¥è¿›è¡ŒåŠ¨æ€æ›´æ–°ï¼Œæ˜¾ç¤ºæœ€æ–°çš„æ•°æ®ã€‚</li>
<li>æ•°æ®æ¢ç´¢ï¼šç”¨æˆ·å¯ä»¥ä½¿ç”¨ Kibana çš„ Discover åŠŸèƒ½ï¼Œå¿«é€Ÿæœç´¢ã€è¿‡æ»¤å’Œæµè§ˆ Elasticsearch ä¸­çš„æ–‡æ¡£ã€‚é€šè¿‡ Kibana æä¾›çš„æŸ¥è¯¢è¯­è¨€ï¼ˆä¾‹å¦‚ Lucene æŸ¥è¯¢è¯­æ³•æˆ– Elasticsearch Query DSLï¼‰ï¼Œç”¨æˆ·å¯ä»¥çµæ´»åœ°ç­›é€‰æ‰€éœ€çš„æ•°æ®ã€‚</li>
<li>æ—¶é—´åºåˆ—åˆ†æï¼šKibana æä¾›äº†å¼ºå¤§çš„æ—¶é—´åºåˆ—æ•°æ®åˆ†æå·¥å…·ï¼ˆå¦‚ Timelion å’Œ TSVBï¼‰ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ†æå’Œå±•ç¤ºæŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„æ•°æ®ï¼Œé€‚ç”¨äºæ—¥å¿—åˆ†æå’Œç›‘æ§ç³»ç»Ÿæ€§èƒ½ã€‚</li>
<li>å®‰å…¨ä¸ç”¨æˆ·ç®¡ç†ï¼šåœ¨é›†æˆäº† Elasticsearch çš„ X-Pack å®‰å…¨æ¨¡å—åï¼ŒKibana å¯ä»¥å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å’Œç”¨æˆ·ç®¡ç†ã€‚ç”¨æˆ·å¯ä»¥å¯¹ä¸åŒçš„å›¢é˜Ÿæˆ–ç”¨æˆ·åˆ†é…ä¸åŒçš„è®¿é—®æƒé™ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚</li>
<li>æŠ¥è­¦ä¸é€šçŸ¥ï¼šKibana çš„ Alerting åŠŸèƒ½å…è®¸ç”¨æˆ·è®¾ç½®å‘Šè­¦è§„åˆ™ï¼Œå½“ç›‘æ§çš„æ•°æ®è¾¾åˆ°ç‰¹å®šé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨è§¦å‘é€šçŸ¥ï¼ˆä¾‹å¦‚é€šè¿‡ç”µå­é‚®ä»¶æˆ– webhook å‘é€å‘Šè­¦ä¿¡æ¯ï¼‰ã€‚</li>
<li>äº¤äº’å¼åœ°å›¾ï¼šKibana æä¾›äº†åœ°ç†ç©ºé—´å¯è§†åŒ–åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å°†åœ°ç†æ•°æ®ç»˜åˆ¶åœ¨äº¤äº’å¼åœ°å›¾ä¸Šï¼Œé€‚åˆè¿›è¡Œåœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰ç›¸å…³çš„åˆ†æå’Œå±•ç¤ºã€‚</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å¯åŠ¨KibanaæœåŠ¡ï¼Œè¿™é‡Œæˆ‘æ˜¯å¯åŠ¨äº† h122 èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">su es_server
cd /opt/servers/kibana-7.3.0-linux-x86_64
bin/kibana
</code></pre>
<h2 data-id="heading-11">é”™è¯¯é€ŸæŸ¥</h2>

































































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td>nginx -s reload æŠ¥é”™æˆ–ä¸ç”Ÿæ•ˆ</td><td>é…ç½®è¯­æ³•é”™è¯¯/æ–‡ä»¶è·¯å¾„ä¸å¯¹</td><td>nginx -t çœ‹å…·ä½“è¡Œå·ï¼›å…ˆ nginx -t é€šè¿‡å† reloadï¼›ç¡®è®¤ç¼–è¾‘çš„æ˜¯å®é™…ç”Ÿæ•ˆçš„ nginx.conf/åŒ…å«æ–‡ä»¶</td></tr><tr><td>access.log ä¸æ˜¯ JSON æˆ–å­—æ®µç¼ºå¤±</td><td>log_format æœªè¢«å¼•ç”¨/access_log ä»æŒ‡å‘é»˜è®¤æ ¼å¼</td><td>æŸ¥ access_log æŒ‡å‘ä¸æ ¼å¼åï¼›çœ‹ç”Ÿæˆå†…å®¹ï¼›access_log  json; ä¸ log_format json '...' åç§°ä¸€è‡´ï¼›é¿å…å¼•å·/é€—å·æ‹¼æ¥é”™è¯¯</td></tr><tr><td>access_log logs/access.log æ‰¾ä¸åˆ°æˆ–æ— å†™å…¥</td><td>ç›¸å¯¹è·¯å¾„ä¸åœ¨é¢„æœŸç›®å½•/æƒé™ä¸è¶³</td><td>nginx -V çœ‹ prefixï¼›æ£€æŸ¥ç›®å½•æƒé™ï¼›æ”¹ä¸ºç»å¯¹è·¯å¾„ï¼ˆå¦‚ /var/log/nginx/access_json.logï¼‰ï¼›ç¡®ä¿ç›®å½•å¯å†™</td></tr><tr><td>8888 ç«¯å£è®¿é—®å¤±è´¥</td><td>server å—æœªè¢« include/è¢«é˜²ç«å¢™æ‹¦/ç›‘å¬å†²çª</td><td><code>ss -lntp | grep 8888</code>ã€æ£€æŸ¥ include</td></tr><tr><td>æ—¥å¿—é‡Œå¤§é‡ 304/0 bytes</td><td>æµè§ˆå™¨ç¼“å­˜å‘½ä¸­</td><td>å¯¹æ¯” status=304ã€body_bytes_sent=0å±æ­£å¸¸ï¼›å‹æµ‹æˆ– curl æ—¶åŠ ç¦ç¼“å­˜å‚æ•°ä»¥éªŒè¯å†™å…¥</td></tr><tr><td>/favicon.ico 404</td><td>é™æ€ç«™ç‚¹æœªæä¾›å›¾æ ‡</td><td>æ—¥å¿— request_uri=/favicon.icoå±æ­£å¸¸ï¼›éœ€è¦å¯è¡¥ favicon æ–‡ä»¶æˆ–å•ç‹¬ location å¤„ç†</td></tr><tr><td>zkServer.sh start å¤±è´¥</td><td>JAVA_HOME/æƒé™/æ•°æ®ç›®å½•é—®é¢˜</td><td>æŸ¥ zookeeper.out/æ—¥å¿—ï¼›è®¾ç½® JAVA_HOMEï¼›ç¡®ä¿ dataDir å¯å†™ï¼›ç»Ÿä¸€ myid ä¸é…ç½®</td></tr><tr><td>Kafka å¯åŠ¨å¤±è´¥æˆ–åå¤é‡å¯</td><td>ZK æœªå°±ç»ª/zookeeper.connect é”™/ç«¯å£ä¸é€š</td><td>Kafka æ—¥å¿—ã€telnet ZK ç«¯å£ï¼›å…ˆç¡®ä¿ ZK é›†ç¾¤å¥åº·ï¼›æ ¸å¯¹ connect å­—ç¬¦ä¸²ä¸ç½‘ç»œè¿é€š</td></tr><tr><td>ES å¯åŠ¨æŠ¥ bootstrap checks</td><td>å†…æ ¸å‚æ•°/å†…å­˜é”/æ–‡ä»¶å¥æŸ„ä¸è¶³</td><td>ES æ—¥å¿—æç¤ºé¡¹å¸¸è§ï¼šè®¾ç½® vm.max_map_countã€æå‡ ulimitã€é…ç½® heap ä¸æƒé™</td></tr><tr><td>Kibana è¿æ¥ä¸ä¸Š ES</td><td>ç‰ˆæœ¬ä¸åŒ¹é…/elasticsearch.hosts é…ç½®é”™/ES æœªèµ·æ¥</td><td>Kibana æ§åˆ¶å°æ—¥å¿—ã€è®¿é—® ES ç«¯å£ï¼›ä¿è¯ Kibana 7.3.0 å¯¹ ES 7.3.0ï¼›ä¿®æ­£ hostsï¼›å…ˆéªŒè¯ curl ES</td></tr><tr><td>åç»­è§£ææˆæœ¬é«˜ã€å­—æ®µæ¼‚ç§»</td><td>JSON å­—æ®µå‘½åéšæ„/ç±»å‹ä¸ç¨³å®šï¼ˆæ•°å­—å˜å­—ç¬¦ä¸²ï¼‰</td><td>å¯¹æ¯”å¤šæ¡æ—¥å¿—åŒå­—æ®µç±»å‹ï¼›å›ºå®šå­—æ®µé›†åˆä¸å‘½åï¼›æ•°å€¼å­—æ®µå°½é‡ä¿æŒæ•°å€¼è¯­ä¹‰ï¼ˆå¦‚ request_time/body_bytes_sentï¼‰</td></tr></tbody></table>
<h2 data-id="heading-12">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-13">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-14">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-196 æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹ï¼šRabbitMQ vs RocketMQ vs Kafka</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSå·²å®Œç»“ï¼ŒGuavaCacheå·²å®Œç»“ï¼ŒEVCacheå·²å®Œç»“ï¼ŒRabbitMQæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-15">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python å®ç° PDF æ–‡æ¡£å‹ç¼©ï¼šå®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7585377403632779310</link>    <guid>https://juejin.cn/post/7585377403632779310</guid>    <pubDate>2025-12-19T10:39:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585377403632779310" data-draft-id="7585180775706181659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python å®ç° PDF æ–‡æ¡£å‹ç¼©ï¼šå®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-19T10:39:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·372157426135"/> <meta itemprop="url" content="https://juejin.cn/user/1250599264325244"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python å®ç° PDF æ–‡æ¡£å‹ç¼©ï¼šå®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1250599264325244/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·372157426135
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T10:39:09.000Z" title="Fri Dec 19 2025 10:39:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸åŠå…¬ã€ç”µå­æ¡£æ¡ˆç®¡ç†å’Œæ–‡æ¡£ä¼ è¾“ä¸­ï¼ŒPDF æ–‡ä»¶å› å…¶æ ¼å¼å›ºå®šã€å…¼å®¹æ€§å¼ºè€Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚ç„¶è€Œï¼Œéšç€æ–‡æ¡£å†…å®¹ä¸°å¯Œã€å›¾ç‰‡å’Œå›¾è¡¨å¢å¤šï¼ŒPDF æ–‡ä»¶ä½“ç§¯å¾€å¾€ä¼šå˜å¾—å¾ˆå¤§ï¼Œå¯¼è‡´ä¸Šä¼ ã€åˆ†äº«å’Œå­˜å‚¨æ•ˆç‡é™ä½ã€‚å¦‚ä½•åœ¨ä¿è¯æ–‡æ¡£å¯è¯»æ€§çš„å‰æä¸‹å‡å° PDF æ–‡ä»¶å¤§å°ï¼Œæˆä¸ºå®é™…åº”ç”¨ä¸­å¸¸è§çš„é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <strong>Python</strong> å¯¹ PDF æ–‡æ¡£è¿›è¡Œå‹ç¼©ï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆå¤„ç† PDF æ–‡ä»¶ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å‹ç¼© PDF</h2>
<ul>
<li><strong>èŠ‚çœå­˜å‚¨ç©ºé—´</strong>ï¼šå¤§å‹ PDF æ–‡ä»¶å ç”¨å¤§é‡ç£ç›˜ç©ºé—´ï¼Œå°¤å…¶åœ¨ä¼ä¸šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå­˜å‚¨æˆæœ¬æ˜æ˜¾å¢åŠ ã€‚</li>
<li><strong>æé«˜ä¼ è¾“æ•ˆç‡</strong>ï¼šé‚®ä»¶æˆ–åœ¨çº¿ä¼ è¾“å¤§æ–‡ä»¶å®¹æ˜“å¤±è´¥ï¼Œå‹ç¼© PDF å¯åŠ å¿«ä¸Šä¼ å’Œä¸‹è½½é€Ÿåº¦ã€‚</li>
<li><strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼šç”¨æˆ·åœ¨æ‰“å¼€å¤§æ–‡ä»¶æ—¶å¯èƒ½å‡ºç°å¡é¡¿ï¼Œå‹ç¼©åçš„ PDF æ›´æ˜“äºé˜…è¯»å’Œæµè§ˆã€‚</li>
<li><strong>æ»¡è¶³ç³»ç»Ÿé™åˆ¶</strong>ï¼šæŸäº›ç½‘ç«™æˆ–ç³»ç»Ÿå¯¹ä¸Šä¼ æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œå‹ç¼© PDF æ˜¯å¿…è¦æ“ä½œã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€å®‰è£…ä¸ç¯å¢ƒå‡†å¤‡</h2>
<p>åœ¨ä½¿ç”¨ Python å¯¹ PDF æ–‡æ¡£è¿›è¡Œå‹ç¼©ä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡ç›¸åº”çš„ PDF å¤„ç†å·¥å…·åº“ã€‚æœ¬æ–‡æ‰€ä½¿ç”¨çš„æ˜¯Spire.PDF for Pythonï¼Œè¯¥ç±»åº“å¯ä»¥å¸®åŠ©å¼€å‘è€…ç›´æ¥å¯¹ PDF ä¸­çš„æ–‡æœ¬ã€å›¾ç‰‡å’Œå­—ä½“è¿›è¡Œæ“ä½œï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹è½¯ä»¶å³å¯å®ç°æ–‡ä»¶å‹ç¼©ã€ä¼˜åŒ–å’Œä¿å­˜ã€‚</p>
<p>å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡ Python çš„åŒ…ç®¡ç†å·¥å…· pip å¿«é€Ÿå®Œæˆï¼š</p>
<pre><code class="hljs">pip install spire.pdf
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œå³å¯åœ¨ä»£ç ä¸­å¯¼å…¥ spire.pdf æ¨¡å—ï¼Œè¿›è¡Œ PDF å‹ç¼©ã€åˆå¹¶ã€æ‹†åˆ†ã€åŠ å¯†ç­‰æ“ä½œã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€å•æ–‡ä»¶å‹ç¼©ç¤ºä¾‹</h2>
<p>ä¸‹é¢ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åŠ è½½å•ä¸ª PDF æ–‡ä»¶ï¼Œå¹¶è®¾ç½®å›¾åƒå‹ç¼©å’Œè´¨é‡å‚æ•°ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> spire.pdf <span class="hljs-keyword">import</span> *

<span class="hljs-comment"># åŠ è½½ PDF æ–‡ä»¶</span>
compressor = PdfCompressor(<span class="hljs-string">"C:/Users/Administrator/Documents/ç¤ºä¾‹.pdf"</span>)

<span class="hljs-comment"># è·å–å‹ç¼©è®¾ç½®</span>
options = compressor.OptimizationOptions

<span class="hljs-comment"># å¯ç”¨å›¾ç‰‡ç¼©æ”¾</span>
options.SetResizeImages(<span class="hljs-literal">True</span>)

<span class="hljs-comment"># å¯ç”¨å›¾ç‰‡å‹ç¼©</span>
options.SetIsCompressImage(<span class="hljs-literal">True</span>)

<span class="hljs-comment"># è®¾ç½®å›¾ç‰‡å‹ç¼©è´¨é‡ï¼ˆä½/ä¸­/é«˜ï¼‰</span>
options.SetImageQuality(ImageQuality.Medium)

<span class="hljs-comment"># æ‰§è¡Œå‹ç¼©å¹¶ä¿å­˜</span>
compressor.CompressToFile(<span class="hljs-string">"å‹ç¼©.pdf"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"PDF å‹ç¼©å®Œæˆï¼Œæ–‡ä»¶å·²ä¿å­˜ä¸º å‹ç¼©.pdf"</span>)
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>SetResizeImages(True)ï¼šå¯ç”¨å¯¹ PDF å†…åµŒå›¾ç‰‡è¿›è¡Œç¼©æ”¾ï¼Œå‡å°‘å°ºå¯¸</li>
<li>SetIsCompressImage(True)ï¼šå¯ç”¨å›¾ç‰‡å‹ç¼©</li>
<li>SetImageQuality(ImageQuality.Medium)ï¼šè®¾ç½®å‹ç¼©è´¨é‡ï¼ŒLowã€Mediumã€Highå¯é€‰</li>
<li>CompressToFileï¼šæ‰§è¡Œå‹ç¼©å¹¶ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„</li>
</ul>
<h2 data-id="heading-3">å››ã€å‹ç¼©å­—ä½“ç¤ºä¾‹</h2>
<p>åœ¨æŸäº› PDF ä¸­ï¼ŒåµŒå…¥å­—ä½“å¯èƒ½å ç”¨å¤§é‡ç©ºé—´ã€‚å‹ç¼©æˆ–å–æ¶ˆåµŒå…¥å­—ä½“å¯ä»¥æ˜¾è‘—å‡å°‘æ–‡ä»¶çš„å¤§å°ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> spire.pdf <span class="hljs-keyword">import</span> *

<span class="hljs-comment"># åŠ è½½ PDF æ–‡ä»¶</span>
compressor = PdfCompressor(<span class="hljs-string">"C:/Users/Administrator/Documents/ç¤ºä¾‹.pdf"</span>)

<span class="hljs-comment"># è·å–å‹ç¼©è®¾ç½®</span>
options = compressor.OptimizationOptions

<span class="hljs-comment"># å¯ç”¨å­—ä½“å‹ç¼©</span>
options.SetIsCompressFonts(<span class="hljs-literal">True</span>)

<span class="hljs-comment"># å¯é€‰ï¼šå–æ¶ˆåµŒå…¥å­—ä½“</span>
<span class="hljs-comment"># options.SetIsUnembedFonts(True)</span>

<span class="hljs-comment"># æ‰§è¡Œå‹ç¼©å¹¶ä¿å­˜</span>
compressor.CompressToFile(<span class="hljs-string">"å‹ç¼©_fonts.pdf"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"PDF å­—ä½“å‹ç¼©å®Œæˆ"</span>)
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¯ç”¨å­—ä½“å‹ç¼©å¯å‡å°‘å­—ä½“å ç”¨ç©ºé—´</li>
<li>å–æ¶ˆåµŒå…¥å­—ä½“å¯è¿›ä¸€æ­¥å‹ç¼©ï¼Œä½†å¯èƒ½å½±å“ PDF åœ¨å…¶ä»–ç³»ç»Ÿä¸Šçš„æ˜¾ç¤ºæ•ˆæœ</li>
</ul>
<h2 data-id="heading-4">äº”ã€æ‰¹é‡å‹ç¼© PDF ç¤ºä¾‹</h2>
<p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œå¯èƒ½éœ€è¦å‹ç¼©ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰ PDF æ–‡ä»¶ï¼Œå¯ä»¥ç»“åˆ Python çš„ os æ¨¡å—å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">import os
from spire.pdf import *

<span class="hljs-attr">input_folder</span> = <span class="hljs-string">"C:/Users/Administrator/Documents/PDFs"</span>
<span class="hljs-attr">output_folder</span> = <span class="hljs-string">"C:/Users/Administrator/Documents/CompressedPDFs"</span>

os.makedirs(output_folder, <span class="hljs-attr">exist_ok</span>=<span class="hljs-literal">True</span>)

for filename in os.listdir(input_folder):
    if filename.endswith(".pdf"):
        <span class="hljs-attr">input_path</span> = os.path.join(input_folder, filename)
        <span class="hljs-attr">output_path</span> = os.path.join(output_folder, filename)

        <span class="hljs-attr">compressor</span> = PdfCompressor(input_path)
        <span class="hljs-attr">options</span> = compressor.OptimizationOptions
        options.SetResizeImages(True)
        options.SetIsCompressImage(True)
        options.SetImageQuality(ImageQuality.Medium)
        options.SetIsCompressFonts(True)

        compressor.CompressToFile(output_path)
        print(f"{filename} å·²å‹ç¼©å®Œæˆ")
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨éå†æ–‡ä»¶å¤¹å†…æ‰€æœ‰ PDF æ–‡ä»¶</li>
<li>å¯ç»Ÿä¸€è®¾ç½®å›¾åƒå‹ç¼©å’Œå­—ä½“å‹ç¼©å‚æ•°</li>
<li>è¾“å‡ºè·¯å¾„å¯è‡ªå®šä¹‰ï¼Œä¾¿äºç®¡ç†</li>
<li>å¯¹å¤§é‡æ–‡ä»¶ï¼Œå¯ç»“åˆå¤šçº¿ç¨‹æé«˜æ•ˆç‡</li>
</ul>
<h2 data-id="heading-5">å…­ã€å‹ç¼©æ³¨æ„äº‹é¡¹</h2>
<ul>
<li><strong>å‹ç¼©ä¸æ¸…æ™°åº¦</strong>ï¼šè¿‡åº¦å‹ç¼©å›¾åƒå¯èƒ½é™ä½é˜…è¯»ä½“éªŒï¼Œåº”æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚è´¨é‡ã€‚</li>
<li><strong>å­—ä½“åµŒå…¥</strong>ï¼šå–æ¶ˆåµŒå…¥å­—ä½“å¯ä»¥å‡å°æ–‡ä»¶ï¼Œä½†å¯èƒ½å¯¼è‡´åœ¨å…¶ä»–ç³»ç»Ÿæ˜¾ç¤ºå¼‚å¸¸ã€‚</li>
<li><strong>å¤‡ä»½åŸå§‹æ–‡ä»¶</strong>ï¼šåœ¨æ‰¹é‡å‹ç¼©å‰ï¼Œå»ºè®®ä¿ç•™åŸå§‹æ–‡ä»¶ä»¥é˜²å‹ç¼©æ•ˆæœä¸ç†æƒ³ã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ‰¹é‡å¤„ç†å¤§é‡æ–‡ä»¶æ—¶ï¼Œå¯ä½¿ç”¨å¤šçº¿ç¨‹æˆ–åˆ†æ‰¹å¤„ç†ï¼Œå‡å°‘é˜»å¡ã€‚</li>
<li><strong>å…¼å®¹æ€§</strong>ï¼šç¡®ä¿ PDF æ–‡ä»¶ä¸æ˜¯åŠ å¯†æˆ–å—ä¿æŠ¤çš„ï¼Œå¦åˆ™å‹ç¼©å¯èƒ½å¤±è´¥ã€‚</li>
</ul>
<h2 data-id="heading-6">ä¸ƒã€æ€»ç»“</h2>
<p>ä½¿ç”¨ Pythonï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆå®ç° PDF æ–‡ä»¶å‹ç¼©ï¼Œæ— éœ€ä¾èµ–å…¶ä»–å·¥å…·æˆ–è½¯ä»¶ã€‚æ— è®ºæ˜¯å•ä¸ªæ–‡ä»¶è¿˜æ˜¯æ‰¹é‡å¤„ç†ï¼Œéƒ½å¯ä»¥é€šè¿‡ç®€å•å‡ è¡Œä»£ç å®Œæˆã€‚æŒæ¡è¿™äº›æ–¹æ³•åï¼Œå¯ä»¥å¤§å¹…å‡å°‘ PDF æ–‡ä»¶ä½“ç§¯ï¼Œæé«˜æ–‡ä»¶ä¼ è¾“ã€å­˜å‚¨å’Œæµè§ˆæ•ˆç‡ï¼Œæ˜¯æ–‡æ¡£ç®¡ç†å’ŒåŠå…¬è‡ªåŠ¨åŒ–ä¸­éå¸¸å®ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Šåˆ«å†å†™æ»¡å±çš„if-elseäº†ï¼Spring Boot + ç­–ç•¥æ¨¡å¼å®æˆ˜ä¼˜åŒ–ã€‹]]></title>    <link>https://juejin.cn/post/7585377403632795694</link>    <guid>https://juejin.cn/post/7585377403632795694</guid>    <pubDate>2025-12-19T10:41:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585377403632795694" data-draft-id="7585406229167390770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Šåˆ«å†å†™æ»¡å±çš„if-elseäº†ï¼Spring Boot + ç­–ç•¥æ¨¡å¼å®æˆ˜ä¼˜åŒ–ã€‹"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-19T10:41:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼ å·¥æ‘†Bug"/> <meta itemprop="url" content="https://juejin.cn/user/960304533736219"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Šåˆ«å†å†™æ»¡å±çš„if-elseäº†ï¼Spring Boot + ç­–ç•¥æ¨¡å¼å®æˆ˜ä¼˜åŒ–ã€‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960304533736219/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼ å·¥æ‘†Bug
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T10:41:35.000Z" title="Fri Dec 19 2025 10:41:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Šåˆ«å†å†™æ»¡å±çš„if-elseäº†ï¼Spring Boot + ç­–ç•¥æ¨¡å¼å®æˆ˜ä¼˜åŒ–ã€‹</h2>
<p>å“ˆå–½ï¼Œå°ä¼™ä¼´ä»¬ï¼ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠä¸€ä¸ªè®©å¾ˆå¤šç¨‹åºå‘˜å¤´ç–¼çš„é—®é¢˜â€”â€”æ»¡å±å¹•çš„if-elseè¯­å¥ã€‚ç›¸ä¿¡å¤§å®¶éƒ½è§è¿‡é‚£ç§ä¸€ä¸ªæ–¹æ³•é‡ŒåµŒå¥—äº†åå‡ å±‚if-elseçš„ä»£ç å§ï¼Ÿä¸ä»…éš¾ç»´æŠ¤ï¼Œæ–°åŠ ä¸€ä¸ªæ¡ä»¶è¿˜å¾—å°å¿ƒç¿¼ç¿¼ã€‚ä»Šå¤©æˆ‘å°±ç»™å¤§å®¶å¸¦æ¥ä¸€ä¸ªè¶…å®ç”¨çš„è§£å†³æ–¹æ¡ˆï¼šSpring Boot + ç­–ç•¥æ¨¡å¼å®æˆ˜ä¼˜åŒ–ï¼</p>
<h3 data-id="heading-1">ä¸€ã€é—®é¢˜åœºæ™¯ï¼šæ”¯ä»˜ä¸šåŠ¡ä¸­çš„if-elseåœ°ç‹±</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸ªç”µå•†ç³»ç»Ÿï¼Œéœ€è¦æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼šæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è”æ”¯ä»˜ã€‚å¾ˆå¤šåŒå­¦å¯èƒ½ä¼šè¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PaymentService</span> {
 Â  Â 
 Â  Â <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">pay</span>(<span class="hljs-params">String payType, BigDecimal amount</span>)</span> {
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (<span class="hljs-string">"alipay"</span>.<span class="hljs-keyword">equals</span>(payType)) {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// æ”¯ä»˜å®æ”¯ä»˜</span>
 Â  Â  Â  Â  Â  Â System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ï¼š"</span> + amount);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸ"</span>;
 Â  Â  Â   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"wechat"</span>.<span class="hljs-keyword">equals</span>(payType)) {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å¾®ä¿¡æ”¯ä»˜</span>
 Â  Â  Â  Â  Â  Â System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ï¼š"</span> + amount);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"å¾®ä¿¡æ”¯ä»˜æˆåŠŸ"</span>;
 Â  Â  Â   } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"unionpay"</span>.<span class="hljs-keyword">equals</span>(payType)) {
 Â  Â  Â  Â  Â  Â <span class="hljs-comment">// é“¶è”æ”¯ä»˜</span>
 Â  Â  Â  Â  Â  Â System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½¿ç”¨é“¶è”æ”¯ä»˜ï¼š"</span> + amount);
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"é“¶è”æ”¯ä»˜æˆåŠŸ"</span>;
 Â  Â  Â   } <span class="hljs-keyword">else</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"æ”¯ä»˜æ–¹å¼é”™è¯¯"</span>);
 Â  Â  Â   }
 Â   }
}
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿå¦‚æœå†åŠ ä¸ªâ€œäº‘é—ªä»˜â€ã€â€œæ•°å­—è´§å¸æ”¯ä»˜â€ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¶Šæ¥è¶Šè‡ƒè‚¿ï¼</p>
<h3 data-id="heading-2">äºŒã€ç­–ç•¥æ¨¡å¼ç™»åœºï¼šä¼˜é›…è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-3">2.1 ä»€ä¹ˆæ˜¯ç­–ç•¥æ¨¡å¼ï¼Ÿ</h4>
<p>ç®€å•è¯´ï¼Œç­–ç•¥æ¨¡å¼å°±æ˜¯å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬å°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚è¿™æ ·ï¼Œç®—æ³•çš„å˜åŒ–å°±ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ç«¯ã€‚</p>
<h4 data-id="heading-4">2.2 ä¸‰æ­¥æ”¹é€ æ³•</h4>
<h5 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç­–ç•¥æ¥å£</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> interface PaymentStrategy {
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ”¯ä»˜ç±»å‹
 Â  Â  */</span>
 Â  Â <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span></span>;
 Â  Â 
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ”¯ä»˜æ–¹æ³•
 Â  Â  */</span>
 Â  Â <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">pay</span><span class="hljs-params">(BigDecimal amount)</span></span>;
}
</code></pre>
<h5 data-id="heading-6">ç¬¬äºŒæ­¥ï¼šå®ç°å…·ä½“ç­–ç•¥</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> {
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getType</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"alipay"</span>;
 Â   }
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">BigDecimal amount</span>) {
 Â  Â  Â  Â <span class="hljs-comment">// è¿™é‡Œå†™çœŸå®çš„æ”¯ä»˜å®æ”¯ä»˜é€»è¾‘</span>
 Â  Â  Â  Â <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ‰§è¡Œæ”¯ä»˜å®æ”¯ä»˜ï¼Œé‡‘é¢ï¼š"</span> + amount);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸï¼Œé‡‘é¢ï¼š"</span> + amount;
 Â   }
}
â€‹
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPayStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> {
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getType</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"wechat"</span>;
 Â   }
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">BigDecimal amount</span>) {
 Â  Â  Â  Â <span class="hljs-comment">// å¾®ä¿¡æ”¯ä»˜é€»è¾‘</span>
 Â  Â  Â  Â <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ‰§è¡Œå¾®ä¿¡æ”¯ä»˜ï¼Œé‡‘é¢ï¼š"</span> + amount);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"å¾®ä¿¡æ”¯ä»˜æˆåŠŸï¼Œé‡‘é¢ï¼š"</span> + amount;
 Â   }
}
â€‹
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnionPayStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> {
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getType</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"unionpay"</span>;
 Â   }
 Â  Â 
 Â  Â <span class="hljs-meta">@Override</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">BigDecimal amount</span>) {
 Â  Â  Â  Â <span class="hljs-comment">// é“¶è”æ”¯ä»˜é€»è¾‘</span>
 Â  Â  Â  Â <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ‰§è¡Œé“¶è”æ”¯ä»˜ï¼Œé‡‘é¢ï¼š"</span> + amount);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> <span class="hljs-string">"é“¶è”æ”¯ä»˜æˆåŠŸï¼Œé‡‘é¢ï¼š"</span> + amount;
 Â   }
}
</code></pre>
<h5 data-id="heading-7">ç¬¬ä¸‰æ­¥ï¼šç­–ç•¥å·¥å‚ç±»</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentStrategyFactory</span> {
 Â  Â 
 Â  Â <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">PaymentStrategy</span>&gt; strategyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
 Â  Â 
 Â  Â <span class="hljs-comment">/**
 Â  Â  * æ³¨å…¥æ‰€æœ‰PaymentStrategyå®ç°
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentStrategyFactory</span>(<span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">PaymentStrategy</span>&gt; strategies) {
 Â  Â  Â  Â <span class="hljs-keyword">for</span> (<span class="hljs-title class_">PaymentStrategy</span> strategy : strategies) {
 Â  Â  Â  Â  Â  Â strategyMap.<span class="hljs-title function_">put</span>(strategy.<span class="hljs-title function_">getType</span>(), strategy);
 Â  Â  Â   }
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">/**
 Â  Â  * è·å–æ”¯ä»˜ç­–ç•¥
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentStrategy</span> <span class="hljs-title function_">getStrategy</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">type</span></span>) {
 Â  Â  Â  Â <span class="hljs-title class_">PaymentStrategy</span> strategy = strategyMap.<span class="hljs-title function_">get</span>(<span class="hljs-keyword">type</span>);
 Â  Â  Â  Â <span class="hljs-keyword">if</span> (strategy == <span class="hljs-literal">null</span>) {
 Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æœªæ‰¾åˆ°å¯¹åº”çš„æ”¯ä»˜ç­–ç•¥ï¼š"</span> + <span class="hljs-keyword">type</span>);
 Â  Â  Â   }
 Â  Â  Â  Â <span class="hljs-keyword">return</span> strategy;
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">/**
 Â  Â  * è·å–æ‰€æœ‰æ”¯æŒçš„æ”¯ä»˜æ–¹å¼
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getSupportTypes</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> strategyMap.<span class="hljs-title function_">keySet</span>();
 Â   }
}
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€ä½¿ç”¨å§¿åŠ¿ï¼šç®€æ´ä¼˜é›…çš„è°ƒç”¨</h3>
<h4 data-id="heading-9">3.1 æ”¹é€ åçš„Service</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentService</span> {
 Â  Â 
 Â  Â <span class="hljs-keyword">private</span> final <span class="hljs-title class_">PaymentStrategyFactory</span> strategyFactory;
 Â  Â 
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaymentService</span>(<span class="hljs-title class_">PaymentStrategyFactory</span> strategyFactory) {
 Â  Â  Â  Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">strategyFactory</span> = strategyFactory;
 Â   }
 Â  Â 
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> payType, BigDecimal amount</span>) {
 Â  Â  Â  Â <span class="hljs-title class_">PaymentStrategy</span> strategy = strategyFactory.<span class="hljs-title function_">getStrategy</span>(payType);
 Â  Â  Â  Â <span class="hljs-keyword">return</span> strategy.<span class="hljs-title function_">pay</span>(amount);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">/**
 Â  Â  * è·å–æ”¯æŒçš„æ”¯ä»˜æ–¹å¼
 Â  Â  */</span>
 Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getSupportPayTypes</span>(<span class="hljs-params"/>) {
 Â  Â  Â  Â <span class="hljs-keyword">return</span> strategyFactory.<span class="hljs-title function_">getSupportTypes</span>();
 Â   }
}
</code></pre>
<h4 data-id="heading-10">3.2 Controllerå±‚ç¤ºä¾‹</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/payment"</span>)
public class PaymentController {
 Â  Â 
 Â  Â <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">PaymentService</span> <span class="hljs-selector-tag">paymentService</span>;
 Â  Â 
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">PaymentController</span>(PaymentService paymentService) {
 Â  Â  Â  Â <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.paymentService</span> = <span class="hljs-selector-tag">paymentService</span>;
 Â   }
 Â  Â 
 Â  Â @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/pay"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;?&gt; <span class="hljs-selector-tag">pay</span>(<span class="hljs-variable">@RequestParam</span> String payType, 
 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-variable">@RequestParam</span> BigDecimal amount) {
 Â  Â  Â  Â <span class="hljs-selector-tag">try</span> {
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">paymentService</span><span class="hljs-selector-class">.pay</span>(payType, amount);
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(result);
 Â  Â  Â   } <span class="hljs-selector-tag">catch</span> (Exception e) {
 Â  Â  Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.badRequest</span>()<span class="hljs-selector-class">.body</span>(e.<span class="hljs-built_in">getMessage</span>());
 Â  Â  Â   }
 Â   }
 Â  Â 
 Â  Â @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/support-types"</span>)
 Â  Â <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;?&gt; <span class="hljs-selector-tag">getSupportTypes</span>() {
 Â  Â  Â  Â <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(paymentService.<span class="hljs-built_in">getSupportPayTypes</span>());
 Â   }
}
</code></pre>
<h3 data-id="heading-11">å››ã€è¿›é˜¶ç©æ³•ï¼šæ³¨è§£ + ç­–ç•¥æ¨¡å¼</h3>
<p>å¦‚æœä½ æƒ³è¦æ›´ä¼˜é›…ï¼Œå¯ä»¥è¯•è¯•æ³¨è§£æ–¹å¼ï¼š</p>
<h4 data-id="heading-12">4.1 å®šä¹‰æ”¯ä»˜ç±»å‹æ³¨è§£</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Target</span>(ElementType.TYPE)
<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Component</span>
public <span class="hljs-variable">@interface</span> PayType {
 Â  Â <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">value</span>();
}
</code></pre>
<h4 data-id="heading-13">4.2 æ”¹é€ ç­–ç•¥å®ç°</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PayType</span>(<span class="hljs-string">"alipay"</span>)
public class AlipayStrategy implements PaymentStrategy {
 Â  Â <span class="hljs-comment">// çœç•¥å…·ä½“å®ç°</span>
}
â€‹
<span class="hljs-variable">@PayType</span>(<span class="hljs-string">"wechat"</span>)
public class WechatPayStrategy implements PaymentStrategy {
 Â  Â <span class="hljs-comment">// çœç•¥å…·ä½“å®ç°</span>
}
</code></pre>
<h4 data-id="heading-14">4.3 æ”¹é€ å·¥å‚ç±»</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentStrategyFactoryV2</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, PaymentStrategy&gt; strategyMap = new ConcurrentHashMap&lt;&gt;();
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨ApplicationContextè·å–æ‰€æœ‰å¸¦PayTypeæ³¨è§£çš„Bean
     */</span>
    <span class="hljs-keyword">public</span> PaymentStrategyFactoryV2(ApplicationContext applicationContext) {
        Map&lt;String, Object&gt; beans = applicationContext.getBeansWithAnnotation(PayType.<span class="hljs-keyword">class</span>);
        
        beans.forEach((beanName, bean) -&gt; {
            PayType <span class="hljs-keyword">annotation</span> = applicationContext.findAnnotationOnBean(beanName, PayType.<span class="hljs-keyword">class</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">annotation</span> != <span class="hljs-literal">null</span> &amp;&amp; bean instanceof PaymentStrategy) {
                strategyMap.put(<span class="hljs-keyword">annotation</span>.value(), (PaymentStrategy) bean);
            }
        });
    }
    
    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•ä¿æŒä¸å˜</span>
}
</code></pre>
<h3 data-id="heading-15">äº”ã€æµ‹è¯•éªŒè¯</h3>
<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»éªŒè¯ä¸€ä¸‹ï¼š</p>
<p>java</p>
<pre><code class="hljs language-csharp" lang="csharp">@SpringBootTest
<span class="hljs-keyword">class</span> <span class="hljs-title">PaymentStrategyTest</span> {
    
    @Autowired
    <span class="hljs-keyword">private</span> PaymentService paymentService;
    
    @Test
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testPay</span>()</span> {
        BigDecimal amount = <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-string">"100.50"</span>);
        
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ”¯æŒçš„æ”¯ä»˜æ–¹å¼ï¼š"</span> + paymentService.getSupportPayTypes());
        
        String result = paymentService.pay(<span class="hljs-string">"alipay"</span>, amount);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ”¯ä»˜ç»“æœï¼š"</span> + result);
        
        result = paymentService.pay(<span class="hljs-string">"wechat"</span>, amount);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"æ”¯ä»˜ç»“æœï¼š"</span> + result);
        
        <span class="hljs-comment">// æµ‹è¯•ä¸å­˜åœ¨çš„æ”¯ä»˜æ–¹å¼</span>
        assertThrows(RuntimeException.<span class="hljs-keyword">class</span>, () -&gt; {
            paymentService.pay(<span class="hljs-string">"unknown"</span>, amount);
        });
    }
}
</code></pre>
<h3 data-id="heading-16">å…­ã€å®é™…åº”ç”¨æ‰©å±•</h3>
<h4 data-id="heading-17">6.1 ç»“åˆé…ç½®æ–‡ä»¶åŠ¨æ€å¯ç”¨ç­–ç•¥</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># application.yml</span>
payment:
  enabled-strategies:
<span class="hljs-bullet">    -</span> alipay
<span class="hljs-bullet">    -</span> wechat
<span class="hljs-bullet">    -</span> unionpay
</code></pre>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DynamicPaymentStrategyFactory</span> {
    
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${payment.enabled-strategies}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; enabledStrategies;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">PaymentStrategy</span>&gt; strategyMap <span class="hljs-operator">=</span> new <span class="hljs-type">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">DynamicPaymentStrategyFactory</span>(<span class="hljs-type">List</span>&lt;<span class="hljs-type">PaymentStrategy</span>&gt; strategies) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">PaymentStrategy</span> strategy : strategies) {
            <span class="hljs-keyword">if</span> (enabledStrategies.contains(strategy.getType())) {
                strategyMap.put(strategy.getType(), strategy);
            }
        }
    }
    
    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•...</span>
}
</code></pre>
<h4 data-id="heading-18">6.2 ç­–ç•¥æ¨¡å¼+æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»„åˆ</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractPaymentStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">BigDecimal amount</span>) {
        <span class="hljs-comment">// 1. å‚æ•°éªŒè¯</span>
        <span class="hljs-title function_">validate</span>(amount);
        
        <span class="hljs-comment">// 2. æ‰§è¡Œæ”¯ä»˜</span>
        <span class="hljs-title class_">String</span> transactionId = <span class="hljs-title function_">doPay</span>(amount);
        
        <span class="hljs-comment">// 3. è®°å½•æ—¥å¿—</span>
        <span class="hljs-title function_">logPayment</span>(transactionId, amount);
        
        <span class="hljs-comment">// 4. è¿”å›ç»“æœ</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">buildResult</span>(transactionId, amount);
    }
    
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">doPay</span>(<span class="hljs-title class_">BigDecimal</span> amount);
    
    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">BigDecimal amount</span>) {
        <span class="hljs-keyword">if</span> (amount.<span class="hljs-title function_">compareTo</span>(<span class="hljs-title class_">BigDecimal</span>.<span class="hljs-property">ZERO</span>) &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ”¯ä»˜é‡‘é¢å¿…é¡»å¤§äº0"</span>);
        }
    }
    
    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">logPayment</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> transactionId, BigDecimal amount</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ”¯ä»˜æµæ°´å·ï¼š"</span> + transactionId + <span class="hljs-string">"ï¼Œé‡‘é¢ï¼š"</span> + amount);
    }
    
    <span class="hljs-keyword">protected</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">buildResult</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> transactionId, BigDecimal amount</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getType</span>() + <span class="hljs-string">"æ”¯ä»˜æˆåŠŸï¼Œæµæ°´å·ï¼š"</span> + transactionId + <span class="hljs-string">"ï¼Œé‡‘é¢ï¼š"</span> + amount;
    }
}
</code></pre>
<h3 data-id="heading-19">æ€»ç»“</h3>
<h4 data-id="heading-20">ä¼˜ç‚¹æ€»ç»“ï¼š</h4>
<ol start="0">
<li><strong>å¼€é—­åŸåˆ™</strong>ï¼šæ–°å¢æ”¯ä»˜æ–¹å¼åªéœ€æ·»åŠ æ–°ç­–ç•¥ç±»ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç </li>
<li><strong>å¯è¯»æ€§</strong>ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šæ¯ä¸ªæ”¯ä»˜é€»è¾‘ç‹¬ç«‹ï¼Œæ–¹ä¾¿æµ‹è¯•å’Œä¿®æ”¹</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šè½»æ¾æ”¯æŒåŠ¨æ€é…ç½®ã€çƒ­æ›´æ–°ç­‰é«˜çº§åŠŸèƒ½</li>
</ol>
<h4 data-id="heading-21">ä½¿ç”¨åœºæ™¯ï¼š</h4>
<ul>
<li>å¤šç§ç›¸ä¼¼ç®—æ³•æˆ–ä¸šåŠ¡é€»è¾‘éœ€è¦åˆ‡æ¢</li>
<li>å­˜åœ¨å¤§é‡çš„æ¡ä»¶åˆ¤æ–­è¯­å¥</li>
<li>ç³»ç»Ÿéœ€è¦åŠ¨æ€é€‰æ‹©ä¸åŒç®—æ³•</li>
<li>å¸Œæœ›é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥</li>
</ul>
<h4 data-id="heading-22">æ³¨æ„äº‹é¡¹ï¼š</h4>
<ol start="0">
<li><strong>ç­–ç•¥æ•°é‡æ§åˆ¶</strong>ï¼šå¦‚æœç­–ç•¥ç±»è¿‡å¤šï¼Œè€ƒè™‘ä½¿ç”¨å…¶ä»–æ¨¡å¼ï¼ˆå¦‚è´£ä»»é“¾æ¨¡å¼ï¼‰ç»„åˆä½¿ç”¨</li>
<li><strong>å®¢æˆ·ç«¯æ„ŸçŸ¥</strong>ï¼šå®¢æˆ·ç«¯éœ€è¦çŸ¥é“æ‰€æœ‰ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä¸­å¿ƒæˆ–æšä¸¾ç®¡ç†</li>
<li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šç­–ç•¥æ¨¡å¼ä¼šå¢åŠ å¯¹è±¡æ•°é‡ï¼Œåœ¨æç«¯æ€§èƒ½æ•æ„Ÿåœºæ™¯éœ€è¦æƒè¡¡</li>
<li><strong>Springé›†æˆ</strong>ï¼šç¡®ä¿ç­–ç•¥ç±»éƒ½è¢«Springç®¡ç†ï¼Œæ³¨æ„Beançš„åŠ è½½é¡ºåº</li>
<li><strong>é»˜è®¤ç­–ç•¥</strong>ï¼šè€ƒè™‘æä¾›ä¸€ä¸ªé»˜è®¤ç­–ç•¥ï¼Œé¿å…å› ç­–ç•¥ä¸å­˜åœ¨è€ŒæŠ¥é”™</li>
<li><strong>ç­–ç•¥å‚æ•°</strong>ï¼šå¦‚æœä¸åŒç­–ç•¥éœ€è¦ä¸åŒå‚æ•°ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Contextå¯¹è±¡å°è£…</li>
</ol>
<h4 data-id="heading-23">æœ€åçš„å°è´´å£«ï¼š</h4>
<p>ç­–ç•¥æ¨¡å¼ä¸æ˜¯é“¶å¼¹ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘å¾ˆç®€å•ï¼Œåªæœ‰2-3ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆç®€å•çš„if-elseå¯èƒ½æ›´åˆé€‚ã€‚ä½†æ˜¯å½“åˆ†æ”¯è¶…è¿‡3ä¸ªï¼Œæˆ–è€…æœªæ¥å¯èƒ½ä¼šå¢åŠ æ›´å¤šåˆ†æ”¯æ—¶ï¼Œç­–ç•¥æ¨¡å¼çš„ä¼˜åŠ¿å°±ä¼šä½“ç°å‡ºæ¥ã€‚</p>
<p>è®°ä½ï¼Œå¥½çš„ä»£ç ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œè€Œæ˜¯åœ¨ä¸æ–­é‡æ„ä¸­é€æ¸å˜å¥½çš„ã€‚å½“ä½ çœ‹åˆ°æ»¡å±çš„if-elseæ—¶ï¼Œä¸å¦¨æƒ³æƒ³ï¼šè¿™é‡Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨ç­–ç•¥æ¨¡å¼ä¼˜åŒ–ä¸€ä¸‹ï¼Ÿ</p>
<p>å¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®åˆ°ä½ ï¼å¦‚æœæœ‰é—®é¢˜æˆ–æ›´å¥½çš„å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºã€‚æˆ‘ä»¬ä¸€èµ·å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼</p>
<hr/>
<p><em>ä½œè€…ï¼šå¼ å·¥æ‘†Bug</em> <em>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æ›´å¥½çš„æŠ€æœ¯ç¤¾åŒºï¼</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½»åº•ææ‡‚ Spring Boot ä¸­ properties å’Œ YAML çš„åŒºåˆ«]]></title>    <link>https://juejin.cn/post/7585410547336790066</link>    <guid>https://juejin.cn/post/7585410547336790066</guid>    <pubDate>2025-12-19T13:01:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585410547336790066" data-draft-id="7585406229167767602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½»åº•ææ‡‚ Spring Boot ä¸­ properties å’Œ YAML çš„åŒºåˆ«"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-19T13:01:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·"/> <meta itemprop="url" content="https://juejin.cn/user/977884013421370"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½»åº•ææ‡‚ Spring Boot ä¸­ properties å’Œ YAML çš„åŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/977884013421370/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:01:15.000Z" title="Fri Dec 19 2025 13:01:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Spring Boot å¼€å‘ä¸­ï¼Œ<code>application.properties</code> å’Œ <code>application.yml</code> æ˜¯æœ€å¸¸ç”¨çš„ä¸¤ç§é…ç½®æ–‡ä»¶æ ¼å¼ã€‚éšç€é¡¹ç›®å¤æ‚åº¦æå‡ï¼Œè¶Šæ¥è¶Šå¤šå›¢é˜Ÿè½¬å‘ YAMLã€‚é‚£ä¹ˆï¼Œå®ƒä»¬åˆ°åº•æœ‰ä½•ä¸åŒï¼Ÿä»Šå¤©æˆ‘ä»¬å°±ä»<strong>å®šä½ã€è¯­æ³•ã€æ•°æ®è¡¨è¾¾èƒ½åŠ›ã€é€šç”¨æ€§</strong>å››ä¸ªè§’åº¦ï¼Œç³»ç»Ÿå¯¹æ¯”è¿™ä¸¤ç§é…ç½®æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å®šä½ä¸åŒï¼šå·¥å…· vs è¯­è¨€</h2>
<p><code>properties</code> æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯â€œ<strong>å±æ€§æ–‡ä»¶</strong>â€ï¼ˆProperties Fileï¼‰ï¼Œå…¶è®¾è®¡åˆè¡·æ˜¯åœ¨ Java åº”ç”¨ä¸­ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨é…ç½®é¡¹ã€‚å®ƒç®€æ´ç›´æ¥ï¼Œé•¿æœŸä»¥æ¥ä½œä¸º Spring Boot é»˜è®¤çš„é…ç½®æ ¼å¼ï¼ˆå°¤å…¶åœ¨ 2.x ç‰ˆæœ¬ä¸­ï¼‰ã€‚</p>
<p>è€Œ <strong>YAML</strong>ï¼ˆYAML Ainâ€™t Markup Languageï¼ŒåŸæ„ä¸º â€œYet Another Markup Languageâ€ï¼‰åˆ™æ˜¯ä¸€ç§<strong>é€šç”¨çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼</strong>ï¼Œå®šä½è¿œä¸æ­¢äºâ€œé…ç½®å±æ€§â€ã€‚å®ƒæ—¨åœ¨ä»¥äººç±»å¯è¯»çš„æ–¹å¼è¡¨è¾¾ç»“æ„åŒ–æ•°æ®ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯å’Œè¯­è¨€ã€‚</p>
<blockquote>
<p>ä¸€å¥è¯æ€»ç»“ï¼š<code>properties</code> æ˜¯ä¸€ä¸ªé…ç½®å·¥å…·ï¼Œ<strong>YAML</strong> æ˜¯ä¸€ç§è¡¨è¾¾ç»“æ„åŒ–æ•°æ®çš„è¯­è¨€ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">äºŒã€è¯­æ³•é£æ ¼ï¼šæ‰å¹³ vs å±‚çº§</h2>
<h4 data-id="heading-2">properties è¯­æ³•</h4>
<p>é‡‡ç”¨ç»å…¸çš„ <code>key=value</code> æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªé…ç½®é¡¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server.port</span>=<span class="hljs-number">8080</span>
<span class="hljs-attr">debug</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/dbname?characterEncoding=utf8
<span class="hljs-attr">spring.datasource.username</span>=root
<span class="hljs-attr">spring.datasource.password</span>=root
</code></pre>
<h4 data-id="heading-3">YAML è¯­æ³•</h4>
<p>ä½¿ç”¨ç¼©è¿›å’Œå†’å·è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œ<strong>å†’å·åå¿…é¡»è·Ÿä¸€ä¸ªç©ºæ ¼</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9090</span>
<span class="hljs-attr">debug:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/dbname?characterEncoding=utf8</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
</code></pre>
<p>âœ… <strong>ä¼˜åŠ¿</strong>ï¼šYAML å±‚çº§æ¸…æ™°ã€ç»“æ„ç›´è§‚ï¼Œå°¤å…¶åœ¨é…ç½®åµŒå¥—å±æ€§æ—¶ï¼Œå¯è¯»æ€§å’Œç»´æŠ¤æ€§æ˜¾è‘—ä¼˜äº propertiesã€‚</p>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€å¤æ‚æ•°æ®ç±»å‹æ”¯æŒï¼šYAML æ›´å¼ºå¤§</h2>
<p>é™¤äº†åŸºæœ¬çš„å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ï¼ŒYAML åŸç”Ÿæ”¯æŒå¯¹è±¡ã€åˆ—è¡¨ã€Map ç­‰å¤æ‚ç»“æ„ï¼Œæ— éœ€é¢å¤–è§£æé€»è¾‘ã€‚</p>
<h4 data-id="heading-5">ç¤ºä¾‹ï¼šé…ç½®å¯¹è±¡</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">user:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">Tom</span>
  <span class="hljs-attr">age:</span> <span class="hljs-number">20</span>
</code></pre>
<h4 data-id="heading-6">ç¤ºä¾‹ï¼šé…ç½®åˆ—è¡¨</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># åˆ—è¡¨å†™æ³•ä¸€ï¼ˆæ¨èï¼‰</span>
animals:
<span class="hljs-bullet">  -</span> Dog
<span class="hljs-bullet">  -</span> Cat
<span class="hljs-bullet">  -</span> Bird

<span class="hljs-section"># åˆ—è¡¨å†™æ³•äºŒï¼ˆè¡Œå†…ï¼‰</span>
animals: [Dog, Cat, Bird]
</code></pre>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œproperties è™½å¯é€šè¿‡ <code>list[0]=Dog</code> ç­‰æ–¹å¼æ¨¡æ‹Ÿé›†åˆï¼Œä½†è¯­æ³•ç¹çä¸”æ˜“å‡ºé”™ï¼Œè¿œä¸å¦‚ YAML è‡ªç„¶ã€‚</p>
<h4 data-id="heading-7">å¯¹æ¯”ï¼šproperties æ¨¡æ‹Ÿåˆ—è¡¨ï¼ˆä¸ç›´è§‚ï¼‰</h4>
<pre><code class="hljs language-css" lang="css">animals<span class="hljs-selector-attr">[0]</span>=Dog 
animals<span class="hljs-selector-attr">[1]</span>=Cat 
animals<span class="hljs-selector-attr">[2]</span>=Bird
</code></pre>
<hr/>
<h2 data-id="heading-8">å››ã€YAML å…·å¤‡è·¨è¯­è¨€é€šç”¨æ€§</h2>
<p><code>properties</code> æ˜¯ Java ç”Ÿæ€ç‰¹æœ‰çš„é…ç½®æ ¼å¼ï¼Œå‡ ä¹ä»…ç”¨äº JVM é¡¹ç›®ã€‚<br/>
è€Œ <strong>YAML æ˜¯ä¸€ç§è¯­è¨€æ— å…³çš„æ•°æ®æ ¼å¼</strong>ï¼Œè¢«å¹¿æ³›åº”ç”¨äº Pythonã€JavaScriptã€Goã€Rubyã€PHP ç­‰å¤šç§ç¼–ç¨‹è¯­è¨€ä¸­ã€‚</p>
<blockquote>
<p>è¿™æ„å‘³ç€ï¼šåœ¨å¤šè¯­è¨€å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œè‹¥ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacosã€Apolloï¼‰ï¼Œå„å›¢é˜Ÿå¯å…±äº«åŒä¸€ä»½ YAML é…ç½®æ–‡ä»¶ï¼Œæå¤§æå‡åä½œæ•ˆç‡ä¸è¿ç»´ä¸€è‡´æ€§ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">æ€»ç»“</h2>






























<table><thead><tr><th>ç»´åº¦</th><th>properties</th><th>YAML</th></tr></thead><tbody><tr><td>å®šä½</td><td>Java å±æ€§é…ç½®</td><td>é€šç”¨æ•°æ®åºåˆ—åŒ–è¯­è¨€</td></tr><tr><td>è¯­æ³•</td><td><code>key=value</code>ï¼Œæ‰å¹³ç»“æ„</td><td><code>key: value</code>ï¼Œæ”¯æŒåµŒå¥—ä¸ç¼©è¿›</td></tr><tr><td>æ•°æ®ç±»å‹</td><td>ä»…åŸºç¡€ç±»å‹</td><td>æ”¯æŒå¯¹è±¡ã€åˆ—è¡¨ã€Map ç­‰å¤æ‚ç»“æ„</td></tr><tr><td>é€šç”¨æ€§</td><td>ä»…é™ Java/Spring</td><td>å¤šè¯­è¨€é€šç”¨</td></tr></tbody></table>
<p>è™½ç„¶ Spring Boot åŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼ï¼Œä½†ä»<strong>å¯è¯»æ€§ã€è¡¨è¾¾åŠ›å’Œç”Ÿæ€å…¼å®¹æ€§</strong>æ¥çœ‹ï¼ŒYAML æ˜¾ç„¶æ˜¯æ›´ç°ä»£ã€æ›´ä¼˜é›…çš„é€‰æ‹©ã€‚å¦‚æœä½ çš„æ–°é¡¹ç›®å°šæœªé€‰å®šé…ç½®æ ¼å¼ï¼Œä¸å¦¨å¤§èƒ†æ‹¥æŠ± YAMLï¼</p>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å°è´´å£«</strong>ï¼šSpring Boot ä¼šä¼˜å…ˆåŠ è½½ <code>application.yml</code>ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œè‹¥ä¸¤è€…å…±å­˜ï¼ŒYAML é…ç½®å°†è¦†ç›– properties ä¸­çš„åŒåé¡¹ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS æœ‰ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585171571130187812</link>    <guid>https://juejin.cn/post/7585171571130187812</guid>    <pubDate>2025-12-19T11:24:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585171571130187812" data-draft-id="7585206349748994100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS æœ‰ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼Ÿ"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2025-12-19T11:24:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Flystone"/> <meta itemprop="url" content="https://juejin.cn/user/1451011079938125"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS æœ‰ä»€ä¹ˆå¥‡æŠ€æ·«å·§ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1451011079938125/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Flystone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T11:24:16.000Z" title="Fri Dec 19 2025 11:24:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F27432017%2Fanswer%2F1984773459834852908" target="_blank" title="https://www.zhihu.com/question/27432017/answer/1984773459834852908" ref="nofollow noopener noreferrer">è½¬è½½è‡ªä½œè€…ï¼šç‹¬å…ƒæ®‡</a></p>
<h3 data-id="heading-0">aspect-ratio</h3>
<p>å®½é«˜æ¯”</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">div</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">190px</span>; <span class="hljs-comment">/* æ³¨æ„ï¼Œè¿™ä¸ªæ•°å­—è¦èƒ½å®¹çº³å®Œå†…å®¹æ‰æœ‰æ•ˆ */</span> 
        aspect-ratio: <span class="hljs-number">16</span> / <span class="hljs-number">9</span>; 
        <span class="hljs-attribute">background</span>: tomato; 
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘æ°¸è¿œä¿æŒ 16:9<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>å¦‚æœï¼Œä½  aspect-ratio çš„å€¼å†™æˆ 1 ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®Œç¾çš„æ­£æ–¹å½¢äº†ï¼</p>
<h3 data-id="heading-1">object-fit</h3>
<p>å®ƒæœ‰ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ªæ˜¯ cover ï¼ˆå›¾ç‰‡å®Œå…¨è¦†ç›–å®¹å™¨ï¼Œä¸”å›¾ç‰‡é•¿å®½ä¸å¤±çœŸï¼‰ï¼Œä¸€ä¸ªæ˜¯ scale-down ï¼ˆåªä¿è¯å›¾ç‰‡é•¿å®½ä¸å¤±çœŸï¼‰ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    <span class="hljs-selector-tag">img</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>; 
        <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* ä¼šè£åˆ‡ï¼Œåªå‰©ä¸­é—´ */</span> 
        <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#000</span>; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://placehold.co/300x200"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"demo"</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">color-scheme: dark light;</h3>
<p>å¯åŠ¨æµè§ˆå™¨è‡ªé€‚åº” æ·±æµ…è‰²æ¨¡å¼ï¼</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    <span class="hljs-selector-pseudo">:root</span> { 
        <span class="hljs-attribute">color</span>-scheme: dark light; <span class="hljs-comment">/* è‡ªåŠ¨å˜è‰² */</span> 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>åˆ‡æ¢ç³»ç»Ÿæ·±æµ…æ¨¡å¼æ¥æµ‹è¯•<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åœ¨æ·±è‰²æ¨¡å¼ä¸‹ï¼Œä¸‹é¢çš„åŸç”Ÿæ§ä»¶ä¼šè‡ªåŠ¨å˜é»‘ï¼Œæ–‡å­—å˜ç™½ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span> è¾“å…¥æ¡†: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">accent-color:red;</h3>
<p>å®ƒä¼šè‡ªåŠ¨è®¡ç®—å‡ºä¸åŒç„¦ç‚¹ä¸‹ï¼Œè¡¨å•æ§ä»¶çš„é¢œè‰²</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> { 
        accent-<span class="hljs-attribute">color</span>:red; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">checked</span>&gt;</span> é€‰æ‹©æ¡†
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">checked</span>&gt;</span> å•é€‰ 
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span>&gt;</span> æ‹–åŠ¨æ»‘å—
</code></pre>
<h3 data-id="heading-4">fit-content</h3>
<p>å®ƒæ˜¯æ ¹æ®å†…å®¹ï¼Œæ¥æ§åˆ¶å®¹å™¨çš„å¤§å°çš„</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">div</span> {
        <span class="hljs-attribute">background</span>: skyblue; 
        <span class="hljs-attribute">width</span>: fit-content; 
        <span class="hljs-attribute">margin</span>: auto; 
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ª divï¼Œä½¿ç”¨ç¼©æ°´å¤§æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">overscroll-behavior: contain;</h3>
<p>è§£å†³ä¸€ä¸ª divï¼Œæœ‰è‡ªå·±çš„æ»šåŠ¨æ¡ã€‚ç„¶åç”¨æˆ·åœ¨è¿™ä¸ª div é‡Œæ»šåŠ¨åˆ°åº•éƒ¨æ—¶ï¼Œï¼Œæ•´ä¸ªé¡µé¢ä¼šå¼€å§‹æ»šåŠ¨ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    <span class="hljs-selector-tag">body</span> { 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">150vh</span>; 
        <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>; 
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">50px</span>; 
    } 
    <span class="hljs-selector-class">.scroll-box</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>; 
        <span class="hljs-attribute">overflow</span>: auto;
        <span class="hljs-attribute">border</span>: <span class="hljs-number">3px</span> solid <span class="hljs-number">#333</span>;
        <span class="hljs-attribute">background</span>: white; 
        overscroll-behavior: contain; <span class="hljs-comment">/* å…³é”®ä»£ç  */</span> 
    } 
    <span class="hljs-selector-class">.inner</span> { 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>; 
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, tomato, gold); 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-box"</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inner"</span>&gt;</span>å†…éƒ¨æ»šåŠ¨æ¡<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æ»šåŠ¨ä¸Šé¢çš„ç›’å­åˆ°åº•éƒ¨ï¼Œå†ç»§ç»­æ»šåŠ¨è¯•è¯•...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">text-wrap: balance;</h3>
<p>å®ƒå¯ä»¥å¹³è¡¡è¡Œæ•°ä¹‹å‰çš„è¯è¯­é•¿åº¦ï¼Œä½¿å…¶åšåˆ°å°½å¯èƒ½çš„å‡è¡¡ï¼Œæ•´ä½“è§‚æ„Ÿä¸Šï¼Œè¦èˆ’æœå¾ˆå¤šï¼
æ³¨æ„ï¼Œè¿™ä¸ªå±æ€§ï¼Œåªæ”¯æŒ 6 è¡Œä»¥å†…ï¼Œæ‰€ä»¥å°½å¯èƒ½ç”¨åœ¨ä¸€äº›çŸ­å°çš„åœ°æ–¹ï¼Œæ¯”å¦‚æ ‡é¢˜ï¼</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    <span class="hljs-selector-tag">h2</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; 
        <span class="hljs-attribute">background</span>: gold; 
        <span class="hljs-attribute">text-align</span>: center; 
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>; 
    } 
    <span class="hljs-selector-id">#test</span> { 
        text-wrap: balance; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">test</span>&gt;</span>å¾ˆé•¿å¾ˆé•¿ so long å¾ˆé•¿çš„ titletitle æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å¾ˆé•¿å¾ˆé•¿ so long å¾ˆé•¿çš„ titletitle æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">text-underline-offset: 0.25em;</h3>
<p>è‹±æ–‡ä¸­çš„ gã€y ï¼Œæ˜¯ä¸æ˜¯è¿™äº›å­—æ¯ï¼Œä¸‹é¢ä¼šæ‹–ä¸€ä¸ªå°¾å·´ã€‚è€Œ &lt; a &gt; çš„åŸç”Ÿæ•ˆæœæ˜¯ï¼Œè¿™ä¸ª underline çº¿ä¼šé‡å åˆ°è¿™äº›å°å°¾å·´ä¸Šã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-attr">[class]</span>) {
        text-underline-offset: <span class="hljs-number">0.25em</span>; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæ­£æ–‡é“¾æ¥ (g/y)<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªæŒ‰é’®é“¾æ¥(ä¸ä½¿ç”¨è¯¥ CSS) (g/y)<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">outline-offset ï¼</h3>
<p>ä¸è®¡å…¥ç›’æ¨¡å‹å°ºå¯¸çš„è½®å»“çº¿ã€‚
æŠŠé¼ æ ‡ç§»ä¸Šå»ï¼Œå°±ä¼šæœ‰æ‰©æ•£æ•ˆæœäº†ã€‚è€Œä¸”ï¼Œåªæ˜¯æ‰©æ•£ï¼Œä¸ä¼šå½±å“å„ç§å°ºå¯¸ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">button</span> { 
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">30px</span>; 
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
        <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#333</span>; 
        <span class="hljs-attribute">outline</span>: <span class="hljs-number">2px</span> dashed blue;
        <span class="hljs-attribute">outline-offset</span>: <span class="hljs-built_in">var</span>(--offset, <span class="hljs-number">2px</span>);
        <span class="hljs-attribute">transition</span>: outline-offset <span class="hljs-number">0.2s</span>; 
    } 
    <span class="hljs-selector-tag">button</span><span class="hljs-selector-pseudo">:hover</span> { 
        <span class="hljs-attr">--offset</span>: <span class="hljs-number">10px</span>; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>é¼ æ ‡æ‚¬åœçœ‹æ‰©æ•£æ•ˆæœ<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h3 data-id="heading-9">scroll-margin-top</h3>
<p>æ€ä¹ˆå½¢å®¹è¿™ä¸ªåœºæ™¯å‘¢ï¼Ÿä½ æœ‰ä¸ªå›ºå®šçš„é¡¶éƒ¨å¯¼èˆªæ ã€‚å®ƒ é«˜åº¦æ˜¯ 100px ã€‚ç„¶åä½ å•å‡»é“¾æ¥ï¼Œæ˜¯ä¸€ä¸ªæ»šåŠ¨åˆ°æŸä¸ª #part æ ‡é¢˜çš„é“¾æ¥ï¼Œä½ ä¼šå‘ç°é»˜è®¤æ»šåŠ¨åï¼Œå®ƒæ˜¯ç´§æŒ¨ç€é¡¶éƒ¨çš„ã€‚é‚£ä¹ˆå¯¼èˆªæ å°±æŒ¡ä½äº†ï¼ˆæˆ‘ä¹Ÿä¸å¤ªèƒ½è¯´æ¸…ï¼Œå¤§å®¶çœ‹ä¸‹é¢çš„ä¾‹å­å§ï¼‰..... å¦‚ä½•ä¸ä»‹å…¥ js æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå°±æ˜¯scroll-margin-top ï¼</p>
<p>æ³¨æ„ï¼Œè¦åœ¨æœ¬åœ°å»ºä¸€ä¸ª html æ¥è¿è¡Œï¼Œå¦åˆ™ä¼šä¹±è·³è½¬ï¼</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css"> 
    <span class="hljs-selector-tag">nav</span> { 
        <span class="hljs-attribute">position</span>: fixed;
        <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>; 
        <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>); 
    } 
    <span class="hljs-selector-tag">h2</span><span class="hljs-selector-attr">[id]</span> { 
        <span class="hljs-attribute">scroll-margin-top</span>: <span class="hljs-number">110px</span>; <span class="hljs-comment">/* 100px + 10px ç¼éš™ */</span> 
        <span class="hljs-attribute">background</span>: yellow; 
    } 
    <span class="hljs-selector-tag">body</span> { 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; 
        <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">120px</span>; 
    } 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>æˆ‘æ˜¯ 100px é«˜çš„å›ºå®šæ  (åŠé€æ˜)<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#part-1"</span>&gt;</span>&gt;&gt;&gt; ç‚¹æˆ‘è·³è½¬åˆ°ç›®æ ‡ &lt;&lt;&lt;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 500px;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"part-1"</span>&gt;</span>ç›®æ ‡æ ‡é¢˜ï¼šä½ çœ‹ä¸åˆ°çº¢è‰²çš„é®æŒ¡<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">scrollbar-gutter: stable;</h3>
<p>è§£å†³ ä¸€ä¸ªæ»šåŠ¨æ¡è·³åŠ¨ Bug ã€‚å°±æ˜¯é¡µé¢çš„å†…å®¹ï¼ŒåŠ¨æ€å˜å¤šï¼Œä¼šçªç„¶å‡ºç°æ»šåŠ¨æ¡ã€‚ç„¶åç”»é¢ä¼šè·³åŠ¨ä¸€ä¸‹ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">div</span> { 
        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>; 
        <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>; 
        <span class="hljs-attribute">overflow-y</span>: auto; 
        <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#333</span>; 
        <span class="hljs-attribute">scrollbar-gutter</span>: stable; <span class="hljs-comment">/* å…³é”® */</span>
    }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span> è™½ç„¶å†…å®¹å¾ˆå°‘ï¼Œä¸éœ€è¦æ»šåŠ¨ï¼Œ ä½†è¯·æ³¨æ„å³ä¾§é¢„ç•™çš„ç©ºç™½æ§½ã€‚ è¿™ä¿è¯äº†å†…å®¹å¢åŠ æ—¶ä¸ä¼šå‘ç”Ÿä½ç§»ã€‚ <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueçš„â€œå°å¤–æŒ‚â€ï¼šç©è½¬è‡ªå®šä¹‰æŒ‡ä»¤]]></title>    <link>https://juejin.cn/post/7585382553289244708</link>    <guid>https://juejin.cn/post/7585382553289244708</guid>    <pubDate>2025-12-19T11:56:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585382553289244708" data-draft-id="7585173051647705124" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueçš„â€œå°å¤–æŒ‚â€ï¼šç©è½¬è‡ªå®šä¹‰æŒ‡ä»¤"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-19T11:56:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™·é¾™çƒ¬"/> <meta itemprop="url" content="https://juejin.cn/user/1874007727812221"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueçš„â€œå°å¤–æŒ‚â€ï¼šç©è½¬è‡ªå®šä¹‰æŒ‡ä»¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1874007727812221/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™·é¾™çƒ¬
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T11:56:05.000Z" title="Fri Dec 19 2025 11:56:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"ğŸ¦„";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"ğŸ³";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"ğŸ„";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"ğŸ¦¥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"ğŸ¦©";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"ğŸ§";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"â"}.markdown-body blockquote:after{right:10px;bottom:0;content:"â"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"Â· "}.markdown-body strong:after{content:" Â·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>ğŸ”¥ ä»¥é¾™æ¯æ·¬ç‚¼ä»£ç ï¼Œåœ¨æ—¶å…‰ç°çƒ¬ä¸­é‡é“¸æŠ€æœ¯æ˜Ÿæ²³ ï¼</p>
<p>æ¬¢è¿æ¥åˆ° <code>æ™·é¾™çƒ¬</code>çš„åšå®¢å°çªâœ¨ï¼ è¿™é‡Œè®°å½•æŠ€æœ¯å­¦ä¹ ç‚¹æ»´ï¼Œåˆ†äº«å®ç”¨æŠ€å·§ï¼Œå¶å°”èŠèŠå¥‡æ€å¦™æƒ³ï½</p>
<p>åŸåˆ›å†…å®¹âœï¸ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï½æ„Ÿè°¢æ”¯æŒâ¤ï¸ï¼è¯·å°Šé‡åŸåˆ›ğŸ“©ï¼ æ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµğŸŒŸï¼</p>
</blockquote>
<h2 data-id="heading-0"><strong>å¼•è¨€</strong></h2>
<p>ä½ å¥½å‘€ï¼åœ¨Vueçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ç”¨ <code>v-model</code>ã€<code>v-if</code> è¿™äº›å†…ç½®æŒ‡ä»¤ï¼Œå®ƒä»¬å°±åƒå®˜æ–¹ç»™æˆ‘ä»¬çš„â€œç‘å£«å†›åˆ€â€ï¼Œç‰¹åˆ«å¥½ç”¨ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æ€»æƒ³æç‚¹â€œä¸ªæ€§åŒ–â€æ“ä½œï¼Œæ¯”å¦‚ä¸€è¿›é¡µé¢å°±è®©æŸä¸ªè¾“å…¥æ¡†è‡ªåŠ¨èšç„¦ï¼Œæˆ–è€…ç»™æŒ‰é’®åŠ ä¸ªâ€œé˜²æŠ–â€é˜²æ­¢ç”¨æˆ·ç–¯ç‹‚ç‚¹å‡»ã€‚</p>
<p>è¿™æ—¶å€™ï¼ŒVueçš„â€œè‡ªå®šä¹‰æŒ‡ä»¤â€å°±è¯¥é—ªäº®ç™»åœºäº†ï¼å®ƒå°±åƒæ˜¯ä½ ç»™Vueå®‰è£…çš„â€œå°å¤–æŒ‚â€ï¼Œè®©ä½ èƒ½è‡ªå·±å®šä¹‰ä¸€äº›ç‰¹æ®Šçš„DOMè¡Œä¸ºã€‚ä»Šå¤©ï¼Œå’±ä»¬å°±æŠŠå®ƒèŠæ˜ç™½ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ è‡ªå®šä¹‰æŒ‡ä»¤æ˜¯å•¥ï¼Ÿèƒ½åƒå—ï¼Ÿ</h3>
<p>ç®€å•è¯´ï¼Œ<strong>è‡ªå®šä¹‰æŒ‡ä»¤å°±æ˜¯ä¸€å¥—ä½ è‡ªå·±å†™çš„ã€èƒ½ç”¨åœ¨HTMLå…ƒç´ ä¸Šçš„â€œæ“ä½œè¯´æ˜ä¹¦â€</strong> â€ã€‚</p>
<p>Vueçš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œæ•°æ®é©±åŠ¨è§†å›¾â€ï¼Œæˆ‘ä»¬é€šå¸¸é€šè¿‡æ”¹å˜æ•°æ®æ¥è®©è§†å›¾è‡ªåŠ¨æ›´æ–°ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ç›´æ¥å»æ“ä½œçœŸå®çš„DOMå…ƒç´ ï¼ˆæ¯”å¦‚è®©è¾“å…¥æ¡†èšç„¦ã€åˆå§‹åŒ–ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼‰ï¼Œè¿™äº›â€œå‰¯ä½œç”¨â€æ“ä½œï¼Œå°±æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<p>ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ª<strong>å¯å¤ç”¨çš„â€œDOMæ“ä½œå·¥å…·ç®±â€</strong> â€ã€‚å“ªé‡Œéœ€è¦ï¼Œå°±â€œv-ä½ çš„æŒ‡ä»¤åâ€ä¸€ä¸‹ï¼Œå·¥å…·ç®±é‡Œçš„å·¥å…·å°±ä¼šè‡ªåŠ¨åœ¨é‚£ä¸ªå…ƒç´ ä¸Šå·¥ä½œã€‚</p>
<h3 data-id="heading-2">äºŒã€ æ€ä¹ˆåˆ›å»ºä¸€ä¸ªâ€œå°å¤–æŒ‚â€ï¼Ÿ</h3>
<p>åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šå…¨å±€æ³¨å†Œå’Œå±€éƒ¨æ³¨å†Œã€‚å’±ä»¬å…ˆçœ‹æœ€å¸¸ç”¨çš„å…¨å±€æ³¨å†Œï¼Œä¸€æ¬¡å®šä¹‰ï¼Œå…¨é¡¹ç›®é€šç”¨ã€‚</p>
<p><strong>1. å…¨å±€æ³¨å†Œï¼šç»™VueåŠ ä¸ªâ€œå…¨å®¶æ¡¶â€å·¥å…·</strong> åœ¨ä½ çš„ä¸»æ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>main.js</code>ï¼‰é‡Œï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåä¸º `v-focus` çš„æŒ‡ä»¤</span>
Â <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'focus'</span>, {
Â  Â <span class="hljs-comment">// å½“è¢«ç»‘å®šçš„å…ƒç´ æ’å…¥åˆ° DOM ä¸­æ—¶â€¦â€¦</span>
Â  Â <span class="hljs-attr">inserted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) {
Â  Â  Â <span class="hljs-comment">// èšç„¦å…ƒç´ </span>
Â  Â  Â el.<span class="hljs-title function_">focus</span>()
Â   }
Â })
</code></pre>
<p>ç”¨èµ·æ¥è¶…ç®€å•ï¼Œåœ¨æ¨¡æ¿é‡Œç›´æ¥ï¼š</p>
<pre><code class="hljs language-css" lang="css">Â &lt;<span class="hljs-selector-tag">input</span> v-focus&gt;
</code></pre>
<p>è¿™æ ·ï¼Œåªè¦è¿™ä¸ª <code>input</code> å…ƒç´ è¢«æ’å…¥é¡µé¢ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨è·å¾—ç„¦ç‚¹ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥æ‰“å­—ï¼Œä½“éªŒæ»¡åˆ†ï¼</p>
<p><strong>2. å±€éƒ¨æ³¨å†Œï¼šæŸä¸ªç»„ä»¶ç§æœ‰çš„â€œå°å·¥å…·â€</strong> â€ å¦‚æœè¿™ä¸ªæŒ‡ä»¤åªåœ¨æŸä¸ªç‰¹å®šç»„ä»¶é‡Œç”¨ï¼Œå¯ä»¥æŠŠå®ƒå®šä¹‰åœ¨è¯¥ç»„ä»¶å†…éƒ¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
Â  Â <span class="hljs-attr">directives</span>: {
Â  Â  Â <span class="hljs-attr">focus</span>: {
Â  Â  Â  Â <span class="hljs-attr">inserted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) {
Â  Â  Â  Â  Â el.<span class="hljs-title function_">focus</span>()
Â  Â  Â   }
Â  Â   }
Â   }
Â }
</code></pre>
<p>ç”¨æ³•å’Œå…¨å±€çš„ä¸€æ ·ã€‚è¿™ç§æ–¹å¼è®©æŒ‡ä»¤çš„ä½œç”¨èŒƒå›´æ›´æ¸…æ™°ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€ æŒ‡ä»¤çš„â€œç”Ÿå‘½å‘¨æœŸé’©å­â€</h3>
<p>ä¸€ä¸ªæŒ‡ä»¤ä¸æ˜¯ç®€å•æ‰§è¡Œä¸€ä¸‹å°±å®Œäº†ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„â€œäººç”Ÿé˜¶æ®µâ€ï¼ŒVueæä¾›äº†å‡ ä¸ªé’©å­å‡½æ•°è®©æˆ‘ä»¬åœ¨å…³é”®æ—¶åˆ»ä»‹å…¥ï¼š</p>
<ul>
<li><strong><code>bind</code></strong>ï¼š<strong>åªè°ƒç”¨ä¸€æ¬¡</strong>ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚å¯ä»¥åœ¨è¿™é‡Œåšä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®ã€‚</li>
<li><strong><code>inserted</code></strong>ï¼šè¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ï¼ˆä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ï¼‰ã€‚ä¸Šé¢è®©è¾“å…¥æ¡†èšç„¦çš„ä¾‹å­ï¼Œå°±ç”¨è¿™ä¸ªé’©å­ã€‚</li>
<li><strong><code>update</code></strong>ï¼š<strong>æ‰€åœ¨ç»„ä»¶çš„ VNode æ›´æ–°æ—¶è°ƒç”¨</strong>ï¼Œä½†å¯èƒ½å‘ç”Ÿåœ¨å…¶å­ VNode æ›´æ–°ä¹‹å‰ã€‚æŒ‡ä»¤çš„å€¼å¯èƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚</li>
<li><strong><code>componentUpdated</code></strong>ï¼šæŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ VNode <strong>åŠå…¶å­ VNode</strong> å…¨éƒ¨æ›´æ–°åè°ƒç”¨ã€‚</li>
<li><strong><code>unbind</code></strong>ï¼š<strong>åªè°ƒç”¨ä¸€æ¬¡</strong>ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚é€‚åˆåœ¨è¿™é‡Œåšæ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<p>è¿™äº›é’©å­å‡½æ•°éƒ½ä¼šæ¥æ”¶åˆ°å‡ ä¸ªå‚æ•°ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ <code>el</code>ï¼ˆæŒ‡ä»¤ç»‘å®šçš„å…ƒç´ ï¼‰å’Œ <code>binding</code>ï¼ˆä¸€ä¸ªåŒ…å«æŒ‡ä»¤ä¿¡æ¯çš„å¯¹è±¡ï¼‰ã€‚</p>
<h3 data-id="heading-4">å››ã€ é’©å­å‡½æ•°çš„å‚æ•°è¯¦è§£</h3>
<p>è®©æˆ‘ä»¬æ·±å…¥çœ‹çœ‹ <code>binding</code> è¿™ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æŒ‡ä»¤çš„æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li><code>name</code>ï¼šæŒ‡ä»¤åï¼Œä¸åŒ…æ‹¬ <code>v-</code> å‰ç¼€ã€‚</li>
<li><code>value</code>ï¼šæŒ‡ä»¤çš„ç»‘å®šå€¼ã€‚ä¾‹å¦‚ <code>v-my-directive="1 + 1"</code> ä¸­ï¼Œç»‘å®šå€¼æ˜¯ <code>2</code>ã€‚</li>
<li><code>oldValue</code>ï¼šæŒ‡ä»¤ç»‘å®šçš„å‰ä¸€ä¸ªå€¼ï¼Œä»…åœ¨ <code>update</code> å’Œ <code>componentUpdated</code> é’©å­ä¸­å¯ç”¨ã€‚</li>
<li><code>expression</code>ï¼šå­—ç¬¦ä¸²å½¢å¼çš„æŒ‡ä»¤è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ <code>v-my-directive="1 + 1"</code> ä¸­ï¼Œè¡¨è¾¾å¼æ˜¯ <code>"1 + 1"</code>ã€‚</li>
<li><code>arg</code>ï¼šä¼ ç»™æŒ‡ä»¤çš„å‚æ•°ã€‚ä¾‹å¦‚ <code>v-my-directive:foo</code> ä¸­ï¼Œå‚æ•°æ˜¯ <code>"foo"</code>ã€‚</li>
<li><code>modifiers</code>ï¼šä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ã€‚ä¾‹å¦‚ <code>v-my-directive.foo.bar</code> ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡æ˜¯ <code>{ foo: true, bar: true }</code>ã€‚</li>
</ul>
<p>ç†è§£è¿™äº›å‚æ•°ï¼Œä½ å°±èƒ½å†™å‡ºæ›´çµæ´»ã€å¼ºå¤§çš„æŒ‡ä»¤ã€‚</p>
<h3 data-id="heading-5">äº”ã€ æ¥ç‚¹æ›´æ·±å…¥å®ç”¨çš„ä¾‹å­</h3>
<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼Œå’±ä»¬çœ‹å‡ ä¸ªæ·±å…¥ã€å¹¶ä¸”å®ç”¨çš„åœºæ™¯ã€‚</p>
<h4 data-id="heading-6"><strong>ä¾‹å­1ï¼šæŒ‰é’®æƒé™æ§åˆ¶</strong></h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸åŒæƒé™çš„ç”¨æˆ·ï¼Œæœ‰äº›æŒ‰é’®åªæœ‰ç®¡ç†å‘˜èƒ½ç‚¹ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Â Vue.directive('permission', {
Â  Â inserted: function (el, binding) {
Â  Â  Â // binding.value å°±æ˜¯æˆ‘ä»¬ä¼ ç»™æŒ‡ä»¤çš„å€¼ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²
Â  Â  Â const <span class="hljs-attr">userRole</span> = <span class="hljs-string">'user'</span> // å‡è®¾å½“å‰ç”¨æˆ·æ˜¯æ™®é€šç”¨æˆ·
Â  Â  Â const <span class="hljs-attr">requiredRole</span> = binding.value // æŒ‡ä»¤è¦æ±‚çš„ç®¡ç†å‘˜è§’è‰² <span class="hljs-string">'admin'</span>
Â â€‹
Â  Â  Â if (userRole !== requiredRole) {
Â  Â  Â  Â // å¦‚æœä¸æ˜¯ç®¡ç†å‘˜ï¼Œå°±æŠŠæŒ‰é’®ç¦ç”¨æˆ–è€…éšè—
Â  Â  Â  Â <span class="hljs-attr">el.style.display</span> = <span class="hljs-string">'none'</span>
Â  Â  Â  Â // æˆ–è€… <span class="hljs-attr">el.disabled</span> = <span class="hljs-literal">true</span>
Â  Â   }
Â   }
Â })
</code></pre>
<p>æ¨¡æ¿é‡Œå¯ä»¥è¿™æ ·ç”¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Â &lt;button <span class="hljs-attr">v-permission</span>=<span class="hljs-string">"'admin'"</span>&gt;åˆ é™¤æ–‡ç« &lt;/button&gt;
</code></pre>
<p>æ™®é€šç”¨æˆ·å°±çœ‹ä¸åˆ°è¿™ä¸ªåˆ é™¤æŒ‰é’®å•¦ï¼Œæƒé™ç®¡ç†è½»æ¾å®ç°ã€‚</p>
<h4 data-id="heading-7"><strong>ä¾‹å­2ï¼šæŒ‰é’®é˜²é‡å¤ç‚¹å‡»</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-comment">// main.jsï¼ˆVue2 å…¨å±€æ³¨å†Œï¼‰</span>
Â <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'throttle'</span>, {
Â  Â <span class="hljs-comment">// å…ƒç´ æ’å…¥DOMæ—¶ç»‘å®šäº‹ä»¶</span>
Â  Â <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding</span>) {
Â  Â  Â <span class="hljs-comment">// 1. åŸºç¡€é…ç½®ï¼šé»˜è®¤èŠ‚æµé—´éš”500msï¼Œæ”¯æŒé€šè¿‡å‚æ•°è‡ªå®šä¹‰ï¼ˆå¦‚ v-throttle:1000ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">const</span> delay = binding.<span class="hljs-property">arg</span> ? <span class="hljs-title class_">Number</span>(binding.<span class="hljs-property">arg</span>) : <span class="hljs-number">500</span>;
Â  Â  Â <span class="hljs-comment">// 2. æ ¡éªŒå›è°ƒå‡½æ•°ï¼ˆé¿å…éå‡½æ•°æŠ¥é”™ï¼‰</span>
Â  Â  Â <span class="hljs-keyword">const</span> callback = <span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'function'</span> ? binding.<span class="hljs-property">value</span> : <span class="hljs-function">() =&gt;</span> {};
Â  Â  Â 
Â  Â  Â <span class="hljs-comment">// 3. æ ¸å¿ƒå˜é‡ï¼šè®°å½•ä¸Šä¸€æ¬¡æ‰§è¡Œæ—¶é—´</span>
Â  Â  Â <span class="hljs-keyword">let</span> lastClickTime = <span class="hljs-number">0</span>;
Â â€‹
Â  Â  Â <span class="hljs-comment">// 4. èŠ‚æµç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°</span>
Â  Â  Â <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
Â  Â  Â  Â <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
Â  Â  Â  Â <span class="hljs-comment">// è·ç¦»ä¸Šæ¬¡ç‚¹å‡»è¶…è¿‡è®¾å®šé—´éš”ï¼Œæ‰æ‰§è¡Œå›è°ƒ</span>
Â  Â  Â  Â <span class="hljs-keyword">if</span> (now - lastClickTime &gt;= delay) {
Â  Â  Â  Â  Â <span class="hljs-title function_">callback</span>(); <span class="hljs-comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span>
Â  Â  Â  Â  Â lastClickTime = now; <span class="hljs-comment">// æ›´æ–°æœ€åç‚¹å‡»æ—¶é—´</span>
Â  Â  Â   }
Â  Â   };
Â â€‹
Â  Â  Â <span class="hljs-comment">// 5. ç»‘å®šç‚¹å‡»äº‹ä»¶ + ç¼“å­˜å‡½æ•°ï¼ˆæ–¹ä¾¿åç»­é”€æ¯ï¼‰</span>
Â  Â  Â el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);
Â  Â  Â el.<span class="hljs-property">_throttleClick</span> = handleClick; <span class="hljs-comment">// æŠŠå‡½æ•°å­˜åˆ°å…ƒç´ ä¸Š</span>
Â   },
Â â€‹
Â  Â <span class="hljs-comment">// å…ƒç´ é”€æ¯æ—¶æ¸…ç†äº‹ä»¶ï¼ˆé¿å…å†…å­˜æ³„æ¼ï¼‰</span>
Â  Â <span class="hljs-title function_">unbind</span>(<span class="hljs-params">el</span>) {
Â  Â  Â el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, el.<span class="hljs-property">_throttleClick</span>);
Â  Â  Â el.<span class="hljs-property">_throttleClick</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ¸…ç©ºç¼“å­˜</span>
Â   }
Â });
</code></pre>
<p>ä½¿ç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">Â <span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â  Â <span class="hljs-comment">&lt;!-- 1. é»˜è®¤500msèŠ‚æµ --&gt;</span>
Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-throttle</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>é»˜è®¤èŠ‚æµç‚¹å‡»<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â â€‹
Â  Â <span class="hljs-comment">&lt;!-- 2. è‡ªå®šä¹‰1000msèŠ‚æµï¼ˆé€šè¿‡å‚æ•°æŒ‡å®šï¼‰ --&gt;</span>
Â  Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-throttle:1000</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>1ç§’èŠ‚æµç‚¹å‡»<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>ä¾‹å­3ï¼šå›¾ç‰‡æ‡’åŠ è½½</strong> è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„è‡ªå®šä¹‰æŒ‡ä»¤åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥å¤§å¹…æå‡é¡µé¢åŠ è½½æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">Â <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'lazy'</span>, {
Â  Â <span class="hljs-attr">inserted</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el, binding</span>) {
Â  Â  Â <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
Â  Â  Â  Â entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å›¾ç‰‡è¿›å…¥è§†å£</span>
Â  Â  Â  Â  Â  Â <span class="hljs-keyword">const</span> img = entry.<span class="hljs-property">target</span>
Â  Â  Â  Â  Â  Â img.<span class="hljs-property">src</span> = binding.<span class="hljs-property">value</span> <span class="hljs-comment">// å°†data-srcçš„å€¼èµ‹ç»™src</span>
Â  Â  Â  Â  Â  Â observer.<span class="hljs-title function_">unobserve</span>(img) <span class="hljs-comment">// åœæ­¢è§‚å¯Ÿ</span>
Â  Â  Â  Â   }
Â  Â  Â   })
Â  Â   }, {
Â  Â  Â  Â <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">'0px'</span>,
Â  Â  Â  Â <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span>
Â  Â   })
Â â€‹
Â  Â  Â observer.<span class="hljs-title function_">observe</span>(el)
Â  Â  Â <span class="hljs-comment">// å­˜å‚¨observerï¼Œä»¥ä¾¿åœ¨unbindæ—¶æ¸…ç†</span>
Â  Â  Â el.<span class="hljs-property">_lazyObserver</span> = observer
Â   },
Â  Â <span class="hljs-attr">unbind</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) {
Â  Â  Â <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_lazyObserver</span>) {
Â  Â  Â  Â el.<span class="hljs-property">_lazyObserver</span>.<span class="hljs-title function_">disconnect</span>()
Â  Â   }
Â   }
Â })
</code></pre>
<p>HTMLä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Â &lt;img <span class="hljs-attr">v-lazy</span>=<span class="hljs-string">"'https://example.com/image.jpg'"</span> alt=<span class="hljs-string">"æ‡’åŠ è½½å›¾ç‰‡"</span>&gt;
</code></pre>
<hr/>
<h3 data-id="heading-8">å…­ã€ è‡ªå®šä¹‰æŒ‡ä»¤çš„é€‚ç”¨åœºæ™¯æ€»ç»“</h3>
<ol>
<li><strong>DOMæ“ä½œå°è£…</strong>ï¼šèšç„¦ã€é€‰æ‹©æ–‡æœ¬ã€å†…å®¹å¤åˆ¶ç­‰ã€‚</li>
<li><strong>äº‹ä»¶å¤„ç†ä¼˜åŒ–</strong>ï¼šé˜²æŠ–ã€èŠ‚æµã€é•¿æŒ‰ã€åŒå‡»ç­‰ã€‚</li>
<li><strong>UIåŠŸèƒ½å¢å¼º</strong>ï¼šæ‹–æ‹½ã€æ»šåŠ¨ç›‘å¬ã€æ— é™æ»šåŠ¨ã€æ‡’åŠ è½½ã€‚</li>
<li><strong>æƒé™ä¸çŠ¶æ€æ§åˆ¶</strong>ï¼šæŒ‰é’®æƒé™ã€å…ƒç´ å¯è§æ€§ã€åŠŸèƒ½å¼€å…³ã€‚</li>
<li><strong>ç¬¬ä¸‰æ–¹åº“é›†æˆ</strong>ï¼šå›¾è¡¨åº“åˆå§‹åŒ–ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€åœ°å›¾ç»„ä»¶ã€‚</li>
<li><strong>æ ·å¼ä¸åŠ¨ç”»</strong>ï¼šåŠ¨æ€æ ·å¼ç»‘å®šã€åŠ¨ç”»è§¦å‘ã€ä¸»é¢˜åˆ‡æ¢ã€‚</li>
</ol>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>è‡ªå®šä¹‰æŒ‡ä»¤ä¸æ˜¯ä»€ä¹ˆé«˜æ·±è«æµ‹çš„é»‘é­”æ³•ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¸®ä½ <strong>å°è£…DOMæ“ä½œã€æå‡ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§çš„å¥½å¸®æ‰‹</strong>ã€‚ä¸‹æ¬¡å½“ä½ å‘ç°è‡ªå·±åœ¨å¤šä¸ªåœ°æ–¹é‡å¤å†™ç€ç›¸åŒçš„DOMæ“ä½œä»£ç æ—¶ï¼Œä¸å¦¨åœä¸‹æ¥æƒ³æƒ³ï¼šâ€œæ˜¯ä¸æ˜¯å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ï¼Ÿâ€</p>
<p>ä»ç®€å•çš„è‡ªåŠ¨èšç„¦ï¼Œåˆ°å¤æ‚çš„æƒé™ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–ï¼Œè‡ªå®šä¹‰æŒ‡ä»¤éƒ½èƒ½è®©ä½ çš„Vueé¡¹ç›®ä»£ç æ›´å¹²å‡€ã€æ›´ä¸“ä¸šã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ æ‰“å¼€æ€è·¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ç”¨èµ·æ¥ï¼</p>
<hr/>
<h2 data-id="heading-10">â€”â€” å®Œ â€”â€”</h2>
<p>âœ¨ è‡³æ­¤ç»“æŸ âœ¨</p>
<p>ğŸ’¡ ç‚¹èµå…³æ³¨ï¼Œè§£é”æ›´å¤šæŠ€æœ¯å¹²è´§ï¼</p>
<p>æˆ‘æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fm0_56336997%3Fspm%3D1011.2124.3001.5343" target="_blank" title="https://blog.csdn.net/m0_56336997?spm=1011.2124.3001.5343" ref="nofollow noopener noreferrer">æ™·é¾™çƒ¬</a> æœŸå¾…ä¸ä½ çš„ä¸‹æ¬¡ç›¸é‡ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS3 å®ç°16:9å¤§å±å±…ä¸­æ˜¾ç¤º]]></title>    <link>https://juejin.cn/post/7585206349749649460</link>    <guid>https://juejin.cn/post/7585206349749649460</guid>    <pubDate>2025-12-19T12:23:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585206349749649460" data-draft-id="7585391510058680372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS3 å®ç°16:9å¤§å±å±…ä¸­æ˜¾ç¤º"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2025-12-19T12:23:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·188787106984"/> <meta itemprop="url" content="https://juejin.cn/user/2455640372153627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS3 å®ç°16:9å¤§å±å±…ä¸­æ˜¾ç¤º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2455640372153627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·188787106984
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:23:27.000Z" title="Fri Dec 19 2025 12:23:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å±é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éœ€è¦åœ¨ä¸åŒåˆ†è¾¨ç‡ä¸Šæ˜¾ç¤ºå±…ä¸­æ˜¾ç¤ºå¤§å±å†…å®¹ï¼Œä¸”ä¸å‡ºç°æ»šåŠ¨æ¡ã€‚å®é™…å±•ç¤ºå¤§å±çš„ç¡¬ä»¶è®¾å¤‡æ¯”ä¾‹ä¸ä¸€ï¼Œä¸ºäº†å…¼å®¹ï¼Œå¹¶ä¸”ä¸å‡ºç°UIè¢«æ‹‰ä¼¸çš„æƒ…å†µï¼Œå‘ç°å¯ä»¥ä½¿ç”¨CSS3çš„transfrom-scaleå±æ€§ï¼Œå¹¶é…åˆCSSå˜é‡å®ç°ã€‚
å…¶ä¸­transfrom-scaleç”¨åœ¨å¤§å±ç»˜åˆ¶æœ€å¤–å±‚ç›’å­ä¸Šï¼Œç›’å­å†…çš„æ ·å¼æŒ‰ç…§UIç»™å‡ºçš„16:9çš„æ¯”ä¾‹ç»˜åˆ¶ã€‚
æ•ˆæœå›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b4d4a9fab4648339fae400b8b35307a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766753178&amp;x-signature=CN6RN4q5p92XIrKXoXHTFei5foc%3D" alt="" loading="lazy"/></p>
<p>ä»£ç å±•ç¤ºæœ€å¤–å±‚ç›’å­çš„ç¼©æ”¾æ ·å¼åŠæ¯”ä¾‹è®¡ç®—ï¼š</p>
<p>style</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-pseudo">:root</span> {
    <span class="hljs-attr">--transformScale</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attr">--positionWidth</span>: <span class="hljs-number">1920px</span>;
    <span class="hljs-attr">--positionHeight</span>: <span class="hljs-number">1080px</span>;
  }

  * {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  }

  <span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">overflow</span>: hidden;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  }

  <span class="hljs-selector-class">.position</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--positionWidth);
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">var</span>(--positionHeight);
  }

  <span class="hljs-selector-class">.box</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">1080px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">1920px</span>;
    <span class="hljs-attribute">background-color</span>: aquamarine;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-built_in">var</span>(--transformScale));
    <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0%</span> <span class="hljs-number">0%</span>;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>html</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ä¸ºäº†è·å–å±å¹•å®½é«˜æ·»åŠ çš„å…ƒç´  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ä¸ºäº†å®šä½æ·»åŠ çš„å…ƒç´  --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"position"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>script</p>
<pre><code class="hljs language-ini" lang="ini">&lt;script&gt;
  // å…¨å±€ç¼©æ”¾æ¯”åŸºç¡€å®½
  const <span class="hljs-attr">width</span> = <span class="hljs-number">1920</span><span class="hljs-comment">;</span>
  // å…¨å±€ç¼©æ”¾æ¯”åŸºç¡€é«˜
  const <span class="hljs-attr">height</span> = <span class="hljs-number">1080</span><span class="hljs-comment">;</span>
  // å®½é«˜æ¯”
  const <span class="hljs-attr">ratio</span> = <span class="hljs-number">16</span> / <span class="hljs-number">9</span><span class="hljs-comment">;</span>

  const <span class="hljs-attr">getBaseScale</span> = () =&gt; {
    const <span class="hljs-attr">element</span> = document.getElementsByClassName(<span class="hljs-string">"container"</span>)[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
    // è·å–å¯è§†åŒºåŸŸçš„å®½åº¦
    const <span class="hljs-attr">w</span> = element.clientWidth<span class="hljs-comment">;</span>
    // è·å–å¯è§†åŒºåŸŸçš„é«˜
    const <span class="hljs-attr">h</span> = element.clientHeight<span class="hljs-comment">;</span>
    // æ ¹æ®å®½é«˜è®¡ç®—æ¯”ä¾‹
    let <span class="hljs-attr">s</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
    if (w / h &gt;= ratio) {
      // è®¾å¤‡å·¦å³ç•™ç™½ ä»¥é«˜åº¦ä¸ºåŸºç¡€è®¡ç®—ç¼©æ”¾æ¯”
      <span class="hljs-attr">s</span> = h / height<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">s</span> = w / width<span class="hljs-comment">;</span>
    }

    const <span class="hljs-attr">pw</span> = s * <span class="hljs-number">1920</span> + <span class="hljs-string">"px"</span><span class="hljs-comment">;</span>
    const <span class="hljs-attr">ph</span> = s * <span class="hljs-number">1080</span> + <span class="hljs-string">"px"</span><span class="hljs-comment">;</span>

    // èµ‹å€¼
    document
      .getElementsByTagName("body")<span class="hljs-section">[0]</span>
      .style.setProperty("--transformScale", s)<span class="hljs-comment">;</span>
    document
      .getElementsByTagName("body")<span class="hljs-section">[0]</span>
      .style.setProperty("--positionWidth", pw)<span class="hljs-comment">;</span>
    document
      .getElementsByTagName("body")<span class="hljs-section">[0]</span>
      .style.setProperty("--positionHeight", ph)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  // çª—å£å˜åŒ–
  <span class="hljs-attr">onresize</span> = getBaseScale<span class="hljs-comment">;</span>

  // åŠ è½½
  <span class="hljs-attr">onload</span> = getBaseScale<span class="hljs-comment">;</span>
&lt;/script&gt;
</code></pre>
<blockquote>
<p>è¡¥å……</p>
</blockquote>
<h5 data-id="heading-0">ä¸€ã€JavaScript æ“ä½œ CSS å˜é‡</h5>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">const</span> root = <span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelector</span>(<span class="hljs-string">":root"</span>);
<span class="hljs-comment">// è®¾ç½® CSS å˜é‡</span>
root.style.setProperty(<span class="hljs-string">"--transformScale"</span>, <span class="hljs-number">0.2</span>);
</code></pre>

<pre><code class="hljs language-ini" lang="ini">// è¯»å– CSS å˜é‡
const <span class="hljs-attr">computedStyle</span> = getComputedStyle(root)<span class="hljs-comment">;</span>
const <span class="hljs-attr">transformScale</span> = computedStyle.getPropertyValue(<span class="hljs-string">"--transformScale"</span>)<span class="hljs-comment">;</span>
console.log(transformScale)<span class="hljs-comment">;</span>
</code></pre>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åˆ é™¤ CSS å˜é‡</span>
root.style.<span class="hljs-built_in">removeProperty</span>(<span class="hljs-string">"--transformScale"</span>);
</code></pre>
<h5 data-id="heading-1">äºŒã€CSS3 transform: scale</h5>
<p>è¯­æ³•ï¼štransform: scale(x, y)   transform: scaleX(x)   transform: scaleY(y)
1ã€scale(x, y) å¯¹å…ƒç´ è¿›è¡Œç¼©æ”¾ï¼›
â‘  xè¡¨ç¤ºæ°´å¹³æ–¹å‘ï¼Œyè¡¨ç¤ºç«–ç›´æ–¹å‘ï¼›
â‘¡ yæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸å†™çš„è¯ï¼ŒXï¼ŒY ä¸¤ä¸ªæ–¹å‘ç¼©æ”¾ä¸€æ ·ï¼›
2ã€scaleX(x) å¯¹å…ƒç´ åªåœ¨xè½´(æ°´å¹³æ–¹å‘)è¿›è¡Œç¼©æ”¾ï¼›
3ã€scaleY(y) å¯¹å…ƒç´ åªåœ¨yè½´(ç«–ç›´æ–¹å‘)è¿›è¡Œç¼©æ”¾;
4ã€å­˜åœ¨ 2D è½¬æ¢æˆ– 3D è½¬æ¢ã€‚</p>
<p>å…¼å®¹æ€§ï¼šå‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2F%3Fsearch%3Dtransform" target="_blank" title="https://caniuse.com/?search=transform" ref="nofollow noopener noreferrer">caniuse.com/?search=traâ€¦</a></p>
<h5 data-id="heading-2">ä¸‰ã€CSS3 transform-origin</h5>
<p>è¯­æ³•ï¼štransform-origin: x y z;
1ã€æ”¹å˜è¢«è½¬æ¢å…ƒç´ çš„ä½ç½®ï¼›
2ã€å­˜åœ¨ 2D è½¬æ¢æˆ– 3D è½¬æ¢ï¼›
3ã€ç›¸å¯¹äºçˆ¶èŠ‚ç‚¹æ”¹å˜ä½ç½®ã€‚</p>





















<table><thead><tr><th align="center">å€¼</th><th>å±æ€§å€¼</th></tr></thead><tbody><tr><td align="center">x</td><td>left	center	right	length	%</td></tr><tr><td align="center">y</td><td>top	center	bottom	length	%</td></tr><tr><td align="center">z</td><td>length</td></tr></tbody></table>
<p>å…¼å®¹æ€§ï¼šå‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2F%3Fsearch%3Dtransform-origin" target="_blank" title="https://caniuse.com/?search=transform-origin" ref="nofollow noopener noreferrer">caniuse.com/?search=traâ€¦</a></p>
<p>åšå®¢å›­åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwttt123%2Fp%2F18104247" target="_blank" title="https://www.cnblogs.com/wttt123/p/18104247" ref="nofollow noopener noreferrer">www.cnblogs.com/wttt123/p/1â€¦</a></p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS3 clip-path+animationå®ç°ä¸è§„åˆ™å®¹å™¨ä¸­çš„ç²’å­ä¸‹è½]]></title>    <link>https://juejin.cn/post/7585406030020870179</link>    <guid>https://juejin.cn/post/7585406030020870179</guid>    <pubDate>2025-12-19T12:26:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030020870179" data-draft-id="7585206349749665844" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS3 clip-path+animationå®ç°ä¸è§„åˆ™å®¹å™¨ä¸­çš„ç²’å­ä¸‹è½"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2025-12-19T12:26:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·188787106984"/> <meta itemprop="url" content="https://juejin.cn/user/2455640372153627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS3 clip-path+animationå®ç°ä¸è§„åˆ™å®¹å™¨ä¸­çš„ç²’å­ä¸‹è½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2455640372153627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·188787106984
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:26:33.000Z" title="Fri Dec 19 2025 12:26:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½¿ç”¨CSS3çš„clip-pathå®ç°ä¸è§„åˆ™å›¾å½¢è£å‰ªï¼Œç»“åˆCSS3 animationå®ç°ç²’å­ä¸‹è½åŠ¨ç”»æ•ˆæœï¼Œå¦‚ä¸‹ï¼š</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4297cc5f6803456dbb845d351c677b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766753098&amp;x-signature=%2Bpfmdgg3VoKxUyKkcTjJfoWgUpc%3D" height="200px" loading="lazy"/>
<p>html:
åˆ›å»ºä¸è§„åˆ™å®¹å™¨åŠä¸‹è½çš„ç²’å­èŠ‚ç‚¹ï¼›</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"particle"</span>&gt;
  &lt;i <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item of 20"</span> :key=<span class="hljs-string">"item"</span> class=<span class="hljs-string">"particle-item"</span>&gt;&lt;/i&gt;
&lt;/div&gt;
</code></pre>
<p>style:
1ã€æ­¤demoä½¿ç”¨lesså®ç°æ ·å¼ï¼›</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä¸è§„åˆ™å®¹å™¨æ ·å¼ */</span>
<span class="hljs-selector-class">.particle</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">90px</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">110px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">236px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">180deg</span>, <span class="hljs-number">#F44336</span> <span class="hljs-number">0%</span>, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">250</span>, <span class="hljs-number">33</span>, <span class="hljs-number">245</span>, <span class="hljs-number">0.4</span>) <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">clip-path</span>: <span class="hljs-built_in">polygon</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span>, <span class="hljs-number">100px</span> <span class="hljs-number">0</span>, <span class="hljs-number">100px</span> <span class="hljs-number">200px</span>, <span class="hljs-number">46px</span> <span class="hljs-number">236px</span>, <span class="hljs-number">0</span> <span class="hljs-number">200px</span>);
}

<span class="hljs-comment">/* ä¸‹è½ç²’å­æ ·å¼ */</span>
<span class="hljs-selector-class">.particle-item</span> {
  &amp;<span class="hljs-selector-pseudo">::before</span>,
  &amp;<span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">4px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">4px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5px</span> <span class="hljs-number">0</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.5</span>);
  }
  <span class="hljs-comment">/* è°ƒç”¨ç²’å­ä¸‹è½æ ·å¼å‡½æ•° */</span>
  <span class="hljs-selector-class">.particle-selectors</span>(<span class="hljs-number">20</span>);
}
</code></pre>
<p>2ã€ç²’å­ä¸‹è½æ ·å¼å‡½æ•°ä¸»è¦è®¡ç®—ç²’å­çš„åˆå§‹ä½ç½®åŠä¸‹è½è·¯å¾„ï¼›</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.particle-selectors</span>(<span class="hljs-variable">@n</span>, <span class="hljs-variable">@i</span>:<span class="hljs-number">1</span>) <span class="hljs-keyword">when</span> (<span class="hljs-variable">@i</span> &lt;= <span class="hljs-variable">@n</span>) {
  <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-variable">@{i}</span>) {
    <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::before</span> ,
    <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-pseudo">::after</span> {
      <span class="hljs-variable">@w:</span> <span class="hljs-built_in">`Math.floor(Math.random() * 100) `</span>;
      <span class="hljs-variable">@h:</span> <span class="hljs-built_in">`Math.floor(Math.random() * -100) `</span>;
      <span class="hljs-variable">@d:</span> <span class="hljs-built_in">`Math.random() * 0.2 `</span>;
      <span class="hljs-variable">@du:</span> <span class="hljs-built_in">calc</span>(<span class="hljs-string">~'@{d}s + 5s'</span>);
      <span class="hljs-variable">@t:</span> <span class="hljs-built_in">`Math.random() * -10 `</span>;
      <span class="hljs-variable">@ti:</span> <span class="hljs-built_in">calc</span>(<span class="hljs-string">~'@{t} * 0.6s'</span>);

      <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-string">~'@{w} * 1px'</span>);
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-built_in">calc</span>(<span class="hljs-string">~'@{h} * 2px'</span>));
      <span class="hljs-selector-class">.animation</span>(<span class="hljs-variable">@du</span>, <span class="hljs-variable">@ti</span>);
    }
  }
  <span class="hljs-selector-class">.particle-selectors</span>(<span class="hljs-variable">@n</span>,(<span class="hljs-variable">@i</span> + <span class="hljs-number">1</span>));
}
</code></pre>
<p>3ã€ç²’å­ä¸‹è½åŠ¨ç”»ï¼›</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-class">.animation</span>(<span class="hljs-variable">@du</span>, <span class="hljs-variable">@de</span>) {
  <span class="hljs-keyword">@keyframes</span> frame {
    <span class="hljs-selector-tag">from</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">20px</span>);
    }
    <span class="hljs-selector-tag">to</span> {
      <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">280px</span>);
    }
  }
  <span class="hljs-attribute">animation</span>: frame <span class="hljs-number">10s</span> infinite;
  <span class="hljs-attribute">animation-delay</span>: <span class="hljs-variable">@de</span>;
  <span class="hljs-attribute">animation-duration</span>: <span class="hljs-variable">@du</span>;
}
</code></pre>
<p>åšå®¢å›­åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwttt123%2Fp%2F18296125" target="_blank" title="https://www.cnblogs.com/wttt123/p/18296125" ref="nofollow noopener noreferrer">www.cnblogs.com/wttt123/p/1â€¦</a></p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å®ç°é¡µé¢æˆªå›¾åŠæˆªå›¾å†…å®¹åŒ…å«è·¨åŸŸå›¾ç‰‡æ—¶çš„å¤„ç†]]></title>    <link>https://juejin.cn/post/7585406030020886563</link>    <guid>https://juejin.cn/post/7585406030020886563</guid>    <pubDate>2025-12-19T12:54:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030020886563" data-draft-id="7585394082823012386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å®ç°é¡µé¢æˆªå›¾åŠæˆªå›¾å†…å®¹åŒ…å«è·¨åŸŸå›¾ç‰‡æ—¶çš„å¤„ç†"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-19T12:54:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·188787106984"/> <meta itemprop="url" content="https://juejin.cn/user/2455640372153627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å®ç°é¡µé¢æˆªå›¾åŠæˆªå›¾å†…å®¹åŒ…å«è·¨åŸŸå›¾ç‰‡æ—¶çš„å¤„ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2455640372153627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·188787106984
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:54:19.000Z" title="Fri Dec 19 2025 12:54:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é¡¹ç›®ä¸­é‡åˆ°éœ€è¦å®ç°æŒ‡å®šä½ç½®çš„æˆªå›¾ï¼Œé‡‡å–ä½¿ç”¨ä¾èµ– html2canvas å®ç°ã€‚
å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fhtml2canvas.hertzen.com%2F" target="_blank" title="https://html2canvas.hertzen.com/" ref="nofollow noopener noreferrer">html2canvas.hertzen.com/</a></p>
<h4 data-id="heading-0">ä¸€ã€å®ç°æ­¥éª¤ï¼š</h4>
<p>1ã€ä¸‹è½½ä¾èµ–æˆ–è€…ä½¿ç”¨å®˜æ–¹jsæ–‡ä»¶é“¾æ¥ï¼Œæœ¬æ–‡ä½¿ç”¨çš„jsé“¾æ¥ï¼›
2ã€ä»£ç 
style</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.screen-box</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
}
</code></pre>
<p>html</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"screen-box"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"screen-box"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªéœ€è¦æˆªå›¾çš„åŒºåŸŸ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"screenShot()"</span>&gt;</span>ç‚¹å‡»æˆªå›¾<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>script</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://html2canvas.hertzen.com/dist/html2canvas.min.js"</span>&gt;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">srcipt</span>&gt;</span>
</span></code></pre>

<pre><code class="hljs language-ini" lang="ini">&lt;script&gt;
function screenShot() {
  const <span class="hljs-attr">element</span> = document.getElementById(<span class="hljs-string">'screen-box'</span>)<span class="hljs-comment">;</span>
  html2canvas(element).then(<span class="hljs-attr">canvas</span> =&gt; {
    const <span class="hljs-attr">img</span> = canvas.toDataURL(<span class="hljs-string">'image/png'</span>)<span class="hljs-comment">;</span>
    downloadImage(img)<span class="hljs-comment">;</span>
  })
}

function downloadImage(imgUrl, <span class="hljs-attr">fileName</span> = <span class="hljs-string">'image.png'</span>) {
  // 1. åˆ›å»ºaæ ‡ç­¾
  const <span class="hljs-attr">link</span> = document.createElement(<span class="hljs-string">'a'</span>)<span class="hljs-comment">;</span>
  // 2. è®¾ç½®ä¸‹è½½å±æ€§ï¼ˆæŒ‡å®šæ–‡ä»¶åï¼‰
  <span class="hljs-attr">link.download</span> = fileName<span class="hljs-comment">;</span>
  // 3. è®¾ç½®å›¾ç‰‡åœ°å€ä¸ºaæ ‡ç­¾çš„href
  <span class="hljs-attr">link.href</span> = imgUrl<span class="hljs-comment">;</span>
  // 4. éšè—aæ ‡ç­¾ï¼ˆå¯é€‰ï¼Œé¿å…é¡µé¢æ¸²æŸ“ï¼‰
  // <span class="hljs-attr">link.style.display</span> = <span class="hljs-string">'none'</span><span class="hljs-comment">;</span>
  // 5. å°†aæ ‡ç­¾æ·»åŠ åˆ°DOMä¸­ï¼ˆéƒ¨åˆ†æµè§ˆå™¨éœ€è¦ï¼‰
  document.body.appendChild(link)<span class="hljs-comment">;</span>
  // 6. è§¦å‘ç‚¹å‡»äº‹ä»¶ä¸‹è½½
  link.click()<span class="hljs-comment">;</span>
  // 7. ä¸‹è½½åç§»é™¤aæ ‡ç­¾ï¼ˆæ¸…ç†DOMï¼‰
  document.body.removeChild(link)<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-1">äºŒã€æ˜“é”™ï¼š</h4>
<p>1ã€å½“ html ä¸­åŒ…å«æœ‰åŒæºå›¾ç‰‡æ—¶ï¼Œæ­¤ä»£ç å¯ä¸‹è½½çš„å›¾ç‰‡æ–‡ä»¶ä¸­åŒ…å«htmlçš„å›¾ç‰‡ï¼›
2ã€å½“ html ä¸­åŒ…å«è·¨åŸŸå›¾ç‰‡æ—¶ï¼Œæ­¤ä»£ç ä¸‹è½½çš„å›¾ç‰‡æ–‡ä»¶ä¼šä¸­ä¸ä¼šæ˜¾ç¤ºhtmlåŒ…å«çš„æ–‡ä»¶ã€‚
ä¾‹å¦‚ï¼Œå½“éœ€æˆªå›¾çš„ä»£ç ç‰‡æ®µä¸­å«æœ‰ç”±ç¬¬ä¸‰æ–¹å¼•å…¥çš„å›¾ç‰‡åœ°å€ï¼š
htmlï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">id</span>=<span class="hljs-string">"screen-box"</span> class=<span class="hljs-string">"screen-box"</span>&gt;
  &lt;h1&gt;è¿™æ˜¯ä¸€ä¸ªéœ€è¦æˆªå›¾çš„åŒºåŸŸ&lt;/h1&gt;
  &lt;img <span class="hljs-attr">src</span>=<span class="hljs-string">"https://gips3.baidu.com/it/u=1821127123,1149655687&amp;fm=3028&amp;app=3028&amp;f=JPEG&amp;fmt=auto?w=720&amp;h=1280"</span>
      <span class="hljs-attr">height</span>=<span class="hljs-string">"300px"</span> title=<span class="hljs-string">"æˆªå›¾åŒºå›¾ç‰‡"</span> alt=<span class="hljs-string">"å›¾ç‰‡"</span> /&gt;
&lt;/div&gt;
&lt;button <span class="hljs-attr">onclick</span>=<span class="hljs-string">"screenShot()"</span>&gt;ç‚¹å‡»æˆªå›¾&lt;/button&gt;
</code></pre>
<p>æˆªå›¾ï¼š <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c05c6db92a44192b97141583866c921~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766753659&amp;x-signature=GrXnEnAxfAkmKyL0vzN9n9I4Rxw%3D" width="300" loading="lazy"/></p>
<h5 data-id="heading-2">åŸå› ï¼š</h5>
<p>è¿™æ˜¯ç”±äº canvas å—é™äº CORS ç­–ç•¥, ä¼šå­˜åœ¨è·¨åŸŸé—®é¢˜, è™½ç„¶å¯ä»¥ä½¿ç”¨å›¾åƒ, ä½†æ˜¯ç»˜åˆ¶åˆ°ç”»å¸ƒä¸Šä¼šæ±¡æŸ“ç”»å¸ƒ, ä¸€æ—¦ä¸€ä¸ªç”»å¸ƒè¢«æ±¡æŸ“, å°±æ— æ³•æå–ç”»å¸ƒçš„æ•°æ®ã€‚æ¯”å¦‚æ— æ³•ä½¿ç”¨ç”»å¸ƒ toBlod() , toDataURL() æˆ–è€… getImageData() æ–¹æ³•ã€‚</p>
<h5 data-id="heading-3">è§£å†³åŠæ³•ï¼š</h5>
<p>å¢åŠ ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°†æ–‡ä»¶è¯»å…¥åˆ° blob æ–‡ä»¶å¯¹è±¡, ç„¶åä½¿ç”¨ URL.createObjectURL è½¬æ¢æˆ src å¯ç”¨çš„åœ°å€</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">toBlob</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> domUrl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">'img'</span>)[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(domUrl.<span class="hljs-property">src</span>, { <span class="hljs-attr">mode</span>: <span class="hljs-string">'cors'</span> });
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'å›¾ç‰‡è¯·æ±‚å¤±è´¥'</span>);
  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
  <span class="hljs-keyword">const</span> blobUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
  domUrl.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'src'</span>, blobUrl);
}
</code></pre>
<p>ä¿®æ”¹ screenShot å‡½æ•°ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">async</span> function <span class="hljs-title">screenShot</span>()</span> {
  <span class="hljs-keyword">await</span> toBlob();
  ...
}
</code></pre>
<p>ä¿®æ”¹ä»£ç åï¼Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39087970ae454c5b8b6b6e05793c460d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766753659&amp;x-signature=Ulz%2BxMH7EuzFLTRZeIK5JCBMPS0%3D" width="300" loading="lazy"/>
<h4 data-id="heading-4">ä¸‰ã€æœ¬åœ°åœ°å€çš„å›¾ç‰‡ï¼ˆåœ°å€ä¸º"file://"å¼€å¤´ï¼‰ä¸æ”¯æŒæ­¤æ–¹æ³•</h4>
<h5 data-id="heading-5">è§£å†³åŠæ³•ï¼š</h5>
<p>å¯å°†å›¾ç‰‡è½¬ç åèµ‹å€¼imgæ ‡ç­¾çš„srcå±æ€§å†è¿›è¡Œæ“ä½œã€‚</p>
<p>åšå®¢å›­ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwttt123%2Fp%2F19323299" target="_blank" title="https://www.cnblogs.com/wttt123/p/19323299" ref="nofollow noopener noreferrer">www.cnblogs.com/wttt123/p/1â€¦</a></p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SVGæè¾¹ - CSS3å®ç°åŠ¨ç”»ç»˜åˆ¶çŸ¢é‡å›¾]]></title>    <link>https://juejin.cn/post/7585406030020968483</link>    <guid>https://juejin.cn/post/7585406030020968483</guid>    <pubDate>2025-12-19T13:04:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030020968483" data-draft-id="7585406030020935715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SVGæè¾¹ - CSS3å®ç°åŠ¨ç”»ç»˜åˆ¶çŸ¢é‡å›¾"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-19T13:04:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·188787106984"/> <meta itemprop="url" content="https://juejin.cn/user/2455640372153627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SVGæè¾¹ - CSS3å®ç°åŠ¨ç”»ç»˜åˆ¶çŸ¢é‡å›¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2455640372153627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·188787106984
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:04:17.000Z" title="Fri Dec 19 2025 13:04:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»43åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½¿ç”¨ SVG çš„ stroke-dasharray åŠ stroke-dashoffsetï¼Œç»“åˆ CSS3 animation å®ç°ç”»ç¬”ç»˜åˆ¶çŸ¢é‡å›¾çš„åŠ¨ç”»æ•ˆæœï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac29e600cd884decad013bb615b5d02a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754311&amp;x-signature=wo9Gx9O86UgoyXxJrAJP4Zt5Uac%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0">html</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;svg
    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span>
    <span class="hljs-attr">pointer-events</span>=<span class="hljs-string">"none"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"leaflet-zoom-animated"</span>
    <span class="hljs-attr">width</span>=<span class="hljs-string">"1452"</span>
    <span class="hljs-attr">height</span>=<span class="hljs-string">"857"</span>
    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"-121 -71 1452 857"</span>
    <span class="hljs-attr">style</span>=<span class="hljs-string">"transform: translate3d(-121px, -71px, 0px)"</span>
  &gt;
    &lt;g&gt;
      &lt;path
        <span class="hljs-attr">class</span>=<span class="hljs-string">"leaflet-interactive"</span>
        <span class="hljs-attr">stroke</span>=<span class="hljs-string">"black"</span>
        <span class="hljs-attr">stroke-opacity</span>=<span class="hljs-string">"1"</span>
        <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"2"</span>
        <span class="hljs-attr">stroke-linecap</span>=<span class="hljs-string">"round"</span>
        <span class="hljs-attr">stroke-linejoin</span>=<span class="hljs-string">"round"</span>
        <span class="hljs-attr">fill</span>=<span class="hljs-string">"red"</span>
        <span class="hljs-attr">fill-opacity</span>=<span class="hljs-string">"0"</span>
        <span class="hljs-attr">fill-rule</span>=<span class="hljs-string">"evenodd"</span>
        <span class="hljs-attr">d</span>=<span class="hljs-string">"M605 623L605 625L609 621L610 623L613 622L616 624L624 616L630 612L637 610L638 608L641 610L639 614L642 616L645 616L646 613L652 610L652 608L653 610L657 610L657 602L659 602L660 600L656 584L653 580L652 575L654 569L652 561L655 555L656 557L660 555L663 556L666 549L670 547L670 544L676 540L680 535L680 531L683 527L681 527L680 524L677 523L678 518L682 516L686 511L690 514L697 509L695 499L693 498L696 494L696 490L698 493L699 492L701 494L706 492L708 494L711 491L722 492L722 494L720 494L718 497L714 497L716 507L721 508L721 510L724 511L723 514L721 514L722 516L724 516L724 519L720 522L717 522L726 531L730 533L737 530L743 530L745 528L745 525L746 526L748 524L748 521L751 520L757 521L757 525L761 525L762 527L759 530L760 533L763 534L762 540L769 536L776 539L778 542L784 539L787 540L788 538L800 536L803 537L810 534L808 530L809 527L805 524L806 520L801 516L798 516L795 518L796 519L793 519L792 517L789 519L789 512L784 507L782 511L778 508L778 502L776 500L777 498L780 497L780 494L789 494L789 491L793 485L796 489L798 489L799 492L801 491L803 495L809 500L811 500L811 497L809 496L809 490L804 478L796 478L796 475L794 474L789 478L788 476L787 477L783 473L784 472L782 468L783 466L781 464L781 458L779 460L777 458L776 460L774 458L772 459L770 458L770 456L768 457L769 452L766 451L766 449L763 450L764 449L762 443L767 439L766 438L769 438L770 436L773 437L775 434L775 430L782 428L781 425L783 420L780 419L778 415L776 415L775 412L774 413L774 411L778 411L777 406L782 407L781 404L785 398L790 399L791 401L796 401L800 405L801 404L804 410L808 410L808 408L813 408L814 405L820 404L823 407L822 409L825 412L826 417L830 420L832 418L836 419L839 416L841 419L844 417L843 416L848 412L855 398L863 387L860 385L861 383L859 382L863 375L869 377L871 374L873 374L874 378L876 377L877 379L885 373L882 370L885 366L888 366L886 363L889 358L889 355L886 355L894 350L892 348L895 346L894 343L896 341L900 341L901 339L903 339L902 337L905 334L908 334L908 329L910 327L903 324L903 322L901 322L897 316L901 316L901 311L906 310L902 305L906 305L909 303L907 300L900 302L895 301L893 303L887 303L885 307L882 304L879 304L874 296L872 297L871 293L867 292L864 294L860 292L860 286L858 285L854 288L852 293L850 292L843 285L845 282L842 277L843 276L828 275L823 278L821 277L815 279L813 281L810 278L802 277L797 273L798 270L796 268L795 270L786 270L784 274L781 273L777 277L774 274L771 265L769 264L767 265L767 270L770 274L762 279L760 278L755 282L753 282L750 279L745 282L743 282L742 279L734 279L722 273L716 268L716 264L719 264L723 260L719 258L720 254L717 244L722 243L718 242L711 235L711 227L706 223L697 223L693 225L687 221L681 224L683 220L681 216L677 220L674 220L669 216L665 216L666 211L663 209L665 206L664 202L666 201L662 196L656 195L657 193L655 189L652 189L651 191L642 195L642 197L639 198L642 200L633 202L632 201L630 207L626 207L627 206L618 208L623 213L623 217L627 219L625 221L628 221L626 224L627 226L634 231L632 232L632 237L629 239L625 238L621 242L621 248L617 245L615 250L610 250L606 255L604 254L605 250L602 246L606 244L606 241L610 236L605 228L603 231L602 230L602 236L598 237L596 243L599 244L600 247L595 255L589 248L584 249L585 252L580 246L575 246L574 248L572 248L574 253L573 256L575 258L575 261L572 261L572 265L577 268L577 275L574 279L572 280L572 278L570 278L564 282L562 280L556 280L553 278L554 281L551 282L552 286L550 286L545 282L540 275L539 277L539 275L536 276L533 274L531 282L530 280L527 280L525 278L527 276L527 269L524 266L522 266L523 264L519 263L519 261L516 258L514 264L511 263L510 265L512 267L508 275L508 273L503 272L501 269L498 269L493 266L488 267L484 258L471 254L468 251L465 244L466 240L464 238L464 234L460 231L458 227L460 225L454 218L452 218L453 217L449 213L450 204L448 203L448 201L440 202L435 199L432 200L428 195L421 194L420 197L415 199L417 203L414 206L415 208L413 210L403 212L403 214L401 215L404 221L404 228L408 229L410 235L413 235L419 239L417 239L417 241L415 241L411 248L409 249L407 253L409 257L409 259L407 259L408 261L401 264L402 272L406 279L412 281L416 286L426 288L440 296L440 301L444 308L450 314L450 319L448 319L449 324L453 327L455 333L470 348L466 354L464 354L462 350L459 350L458 358L467 368L465 373L474 382L471 385L473 390L472 393L474 397L475 413L478 416L477 419L479 424L476 430L475 437L478 443L479 458L481 460L480 464L482 476L480 483L482 487L482 492L484 494L483 503L489 510L488 511L494 517L493 508L496 504L494 502L494 498L500 492L501 488L504 486L503 485L508 481L508 486L521 498L521 500L525 503L524 504L529 508L528 510L530 512L528 514L523 515L522 517L525 523L530 528L529 529L533 532L535 531L535 538L536 539L541 532L546 534L549 532L550 529L552 529L554 532L553 535L560 542L559 543L563 549L562 553L563 552L565 554L569 566L574 566L573 575L579 578L578 580L585 584L583 588L584 589L586 590L588 589L588 587L590 588L587 591L589 593L588 596L585 596L585 599L596 607L595 609L597 609L593 612L594 614L599 615L604 622zM806 410L806 410zM839 416L839 416zM774 411L774 411z"</span>
        <span class="hljs-attr">id</span>=<span class="hljs-string">"å››å·çœ"</span>
      /&gt;
    &lt;/g&gt;
  &lt;/svg&gt;
</code></pre>
<h3 data-id="heading-1">style</h3>
<pre><code class="hljs language-css" lang="css">path {
  stroke-dasharray: <span class="hljs-number">2810</span>;
  stroke-dashoffset: <span class="hljs-number">2810</span>;
  fill-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-comment">/* animation: name duration timing-function delay iteration-count direction fill-mode play-state; */</span>
  <span class="hljs-attribute">animation</span>: dash <span class="hljs-number">10s</span> linear <span class="hljs-number">3s</span> <span class="hljs-number">1</span> forwards,
              dashOpacity <span class="hljs-number">5s</span> linear <span class="hljs-number">14s</span> <span class="hljs-number">1</span> forwards;
}
<span class="hljs-keyword">@keyframes</span> dash {
  <span class="hljs-selector-tag">to</span> {
    stroke-dashoffset: <span class="hljs-number">0</span>;
  }
}
<span class="hljs-keyword">@keyframes</span> dashOpacity {
  <span class="hljs-selector-tag">to</span> {
    fill-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.3</span>;
  }
}
</code></pre>
<h3 data-id="heading-2">script</h3>
<p>ç”¨äºè·å– svg çŸ¢é‡å›¾çš„é•¿åº¦</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">path</span> = document.querySelector(<span class="hljs-string">"path"</span>)<span class="hljs-comment">;</span>
var <span class="hljs-attr">length</span> = path.getTotalLength()<span class="hljs-comment">;</span>
console.log(length)<span class="hljs-comment">;</span>
</code></pre>
<p>æ‹“å±•ï¼šåœ¨ä»¥ä¸ŠåŸºç¡€ä¸Šå®ç°æµå…‰æ•ˆæœ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe93eb97ccc649fd8912bf352efa9f14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754311&amp;x-signature=xCDSCVohTyxT8S5ftHR73lBgONE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">html</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;svg
  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span>
  <span class="hljs-attr">pointer-events</span>=<span class="hljs-string">"cursor"</span>
  <span class="hljs-attr">width</span>=<span class="hljs-string">"1452"</span>
  <span class="hljs-attr">height</span>=<span class="hljs-string">"857"</span>
  <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"-121 -71 1452 857"</span>
&gt;
  &lt;g&gt;
    &lt;path
      <span class="hljs-attr">class</span>=<span class="hljs-string">"animation-0"</span>
      <span class="hljs-attr">stroke-opacity</span>=<span class="hljs-string">"1"</span>
      <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"2"</span>
      <span class="hljs-attr">stroke-linecap</span>=<span class="hljs-string">"round"</span>
      <span class="hljs-attr">stroke-linejoin</span>=<span class="hljs-string">"round"</span>
      <span class="hljs-attr">fill-opacity</span>=<span class="hljs-string">"0"</span>
      <span class="hljs-attr">fill-rule</span>=<span class="hljs-string">"evenodd"</span>
      <span class="hljs-attr">d</span>=<span class="hljs-string">"M605 623L605 625L609 621L610 623L613 622L616 624L624 616L630 612L637 610L638 608L641 610L639 614L642 616L645 616L646 613L652 610L652 608L653 610L657 610L657 602L659 602L660 600L656 584L653 580L652 575L654 569L652 561L655 555L656 557L660 555L663 556L666 549L670 547L670 544L676 540L680 535L680 531L683 527L681 527L680 524L677 523L678 518L682 516L686 511L690 514L697 509L695 499L693 498L696 494L696 490L698 493L699 492L701 494L706 492L708 494L711 491L722 492L722 494L720 494L718 497L714 497L716 507L721 508L721 510L724 511L723 514L721 514L722 516L724 516L724 519L720 522L717 522L726 531L730 533L737 530L743 530L745 528L745 525L746 526L748 524L748 521L751 520L757 521L757 525L761 525L762 527L759 530L760 533L763 534L762 540L769 536L776 539L778 542L784 539L787 540L788 538L800 536L803 537L810 534L808 530L809 527L805 524L806 520L801 516L798 516L795 518L796 519L793 519L792 517L789 519L789 512L784 507L782 511L778 508L778 502L776 500L777 498L780 497L780 494L789 494L789 491L793 485L796 489L798 489L799 492L801 491L803 495L809 500L811 500L811 497L809 496L809 490L804 478L796 478L796 475L794 474L789 478L788 476L787 477L783 473L784 472L782 468L783 466L781 464L781 458L779 460L777 458L776 460L774 458L772 459L770 458L770 456L768 457L769 452L766 451L766 449L763 450L764 449L762 443L767 439L766 438L769 438L770 436L773 437L775 434L775 430L782 428L781 425L783 420L780 419L778 415L776 415L775 412L774 413L774 411L778 411L777 406L782 407L781 404L785 398L790 399L791 401L796 401L800 405L801 404L804 410L808 410L808 408L813 408L814 405L820 404L823 407L822 409L825 412L826 417L830 420L832 418L836 419L839 416L841 419L844 417L843 416L848 412L855 398L863 387L860 385L861 383L859 382L863 375L869 377L871 374L873 374L874 378L876 377L877 379L885 373L882 370L885 366L888 366L886 363L889 358L889 355L886 355L894 350L892 348L895 346L894 343L896 341L900 341L901 339L903 339L902 337L905 334L908 334L908 329L910 327L903 324L903 322L901 322L897 316L901 316L901 311L906 310L902 305L906 305L909 303L907 300L900 302L895 301L893 303L887 303L885 307L882 304L879 304L874 296L872 297L871 293L867 292L864 294L860 292L860 286L858 285L854 288L852 293L850 292L843 285L845 282L842 277L843 276L828 275L823 278L821 277L815 279L813 281L810 278L802 277L797 273L798 270L796 268L795 270L786 270L784 274L781 273L777 277L774 274L771 265L769 264L767 265L767 270L770 274L762 279L760 278L755 282L753 282L750 279L745 282L743 282L742 279L734 279L722 273L716 268L716 264L719 264L723 260L719 258L720 254L717 244L722 243L718 242L711 235L711 227L706 223L697 223L693 225L687 221L681 224L683 220L681 216L677 220L674 220L669 216L665 216L666 211L663 209L665 206L664 202L666 201L662 196L656 195L657 193L655 189L652 189L651 191L642 195L642 197L639 198L642 200L633 202L632 201L630 207L626 207L627 206L618 208L623 213L623 217L627 219L625 221L628 221L626 224L627 226L634 231L632 232L632 237L629 239L625 238L621 242L621 248L617 245L615 250L610 250L606 255L604 254L605 250L602 246L606 244L606 241L610 236L605 228L603 231L602 230L602 236L598 237L596 243L599 244L600 247L595 255L589 248L584 249L585 252L580 246L575 246L574 248L572 248L574 253L573 256L575 258L575 261L572 261L572 265L577 268L577 275L574 279L572 280L572 278L570 278L564 282L562 280L556 280L553 278L554 281L551 282L552 286L550 286L545 282L540 275L539 277L539 275L536 276L533 274L531 282L530 280L527 280L525 278L527 276L527 269L524 266L522 266L523 264L519 263L519 261L516 258L514 264L511 263L510 265L512 267L508 275L508 273L503 272L501 269L498 269L493 266L488 267L484 258L471 254L468 251L465 244L466 240L464 238L464 234L460 231L458 227L460 225L454 218L452 218L453 217L449 213L450 204L448 203L448 201L440 202L435 199L432 200L428 195L421 194L420 197L415 199L417 203L414 206L415 208L413 210L403 212L403 214L401 215L404 221L404 228L408 229L410 235L413 235L419 239L417 239L417 241L415 241L411 248L409 249L407 253L409 257L409 259L407 259L408 261L401 264L402 272L406 279L412 281L416 286L426 288L440 296L440 301L444 308L450 314L450 319L448 319L449 324L453 327L455 333L470 348L466 354L464 354L462 350L459 350L458 358L467 368L465 373L474 382L471 385L473 390L472 393L474 397L475 413L478 416L477 419L479 424L476 430L475 437L478 443L479 458L481 460L480 464L482 476L480 483L482 487L482 492L484 494L483 503L489 510L488 511L494 517L493 508L496 504L494 502L494 498L500 492L501 488L504 486L503 485L508 481L508 486L521 498L521 500L525 503L524 504L529 508L528 510L530 512L528 514L523 515L522 517L525 523L530 528L529 529L533 532L535 531L535 538L536 539L541 532L546 534L549 532L550 529L552 529L554 532L553 535L560 542L559 543L563 549L562 553L563 552L565 554L569 566L574 566L573 575L579 578L578 580L585 584L583 588L584 589L586 590L588 589L588 587L590 588L587 591L589 593L588 596L585 596L585 599L596 607L595 609L597 609L593 612L594 614L599 615L604 622zM806 410L806 410zM839 416L839 416zM774 411L774 411z"</span>
      <span class="hljs-attr">id</span>=<span class="hljs-string">"å››å·çœ"</span>
      <span class="hljs-attr">stroke</span>=<span class="hljs-string">"#00ffd0"</span>
      <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">"2810"</span>
      <span class="hljs-attr">stroke-dashoffset</span>=<span class="hljs-string">"2810"</span>
    /&gt;
    &lt;path
      <span class="hljs-attr">class</span>=<span class="hljs-string">"animation-1"</span>
      <span class="hljs-attr">stroke-opacity</span>=<span class="hljs-string">"0"</span>
      <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">"2"</span>
      <span class="hljs-attr">stroke-linecap</span>=<span class="hljs-string">"round"</span>
      <span class="hljs-attr">stroke-linejoin</span>=<span class="hljs-string">"round"</span>
      <span class="hljs-attr">fill-opacity</span>=<span class="hljs-string">"0"</span>
      <span class="hljs-attr">fill-rule</span>=<span class="hljs-string">"evenodd"</span>
      <span class="hljs-attr">d</span>=<span class="hljs-string">"M605 623L605 625L609 621L610 623L613 622L616 624L624 616L630 612L637 610L638 608L641 610L639 614L642 616L645 616L646 613L652 610L652 608L653 610L657 610L657 602L659 602L660 600L656 584L653 580L652 575L654 569L652 561L655 555L656 557L660 555L663 556L666 549L670 547L670 544L676 540L680 535L680 531L683 527L681 527L680 524L677 523L678 518L682 516L686 511L690 514L697 509L695 499L693 498L696 494L696 490L698 493L699 492L701 494L706 492L708 494L711 491L722 492L722 494L720 494L718 497L714 497L716 507L721 508L721 510L724 511L723 514L721 514L722 516L724 516L724 519L720 522L717 522L726 531L730 533L737 530L743 530L745 528L745 525L746 526L748 524L748 521L751 520L757 521L757 525L761 525L762 527L759 530L760 533L763 534L762 540L769 536L776 539L778 542L784 539L787 540L788 538L800 536L803 537L810 534L808 530L809 527L805 524L806 520L801 516L798 516L795 518L796 519L793 519L792 517L789 519L789 512L784 507L782 511L778 508L778 502L776 500L777 498L780 497L780 494L789 494L789 491L793 485L796 489L798 489L799 492L801 491L803 495L809 500L811 500L811 497L809 496L809 490L804 478L796 478L796 475L794 474L789 478L788 476L787 477L783 473L784 472L782 468L783 466L781 464L781 458L779 460L777 458L776 460L774 458L772 459L770 458L770 456L768 457L769 452L766 451L766 449L763 450L764 449L762 443L767 439L766 438L769 438L770 436L773 437L775 434L775 430L782 428L781 425L783 420L780 419L778 415L776 415L775 412L774 413L774 411L778 411L777 406L782 407L781 404L785 398L790 399L791 401L796 401L800 405L801 404L804 410L808 410L808 408L813 408L814 405L820 404L823 407L822 409L825 412L826 417L830 420L832 418L836 419L839 416L841 419L844 417L843 416L848 412L855 398L863 387L860 385L861 383L859 382L863 375L869 377L871 374L873 374L874 378L876 377L877 379L885 373L882 370L885 366L888 366L886 363L889 358L889 355L886 355L894 350L892 348L895 346L894 343L896 341L900 341L901 339L903 339L902 337L905 334L908 334L908 329L910 327L903 324L903 322L901 322L897 316L901 316L901 311L906 310L902 305L906 305L909 303L907 300L900 302L895 301L893 303L887 303L885 307L882 304L879 304L874 296L872 297L871 293L867 292L864 294L860 292L860 286L858 285L854 288L852 293L850 292L843 285L845 282L842 277L843 276L828 275L823 278L821 277L815 279L813 281L810 278L802 277L797 273L798 270L796 268L795 270L786 270L784 274L781 273L777 277L774 274L771 265L769 264L767 265L767 270L770 274L762 279L760 278L755 282L753 282L750 279L745 282L743 282L742 279L734 279L722 273L716 268L716 264L719 264L723 260L719 258L720 254L717 244L722 243L718 242L711 235L711 227L706 223L697 223L693 225L687 221L681 224L683 220L681 216L677 220L674 220L669 216L665 216L666 211L663 209L665 206L664 202L666 201L662 196L656 195L657 193L655 189L652 189L651 191L642 195L642 197L639 198L642 200L633 202L632 201L630 207L626 207L627 206L618 208L623 213L623 217L627 219L625 221L628 221L626 224L627 226L634 231L632 232L632 237L629 239L625 238L621 242L621 248L617 245L615 250L610 250L606 255L604 254L605 250L602 246L606 244L606 241L610 236L605 228L603 231L602 230L602 236L598 237L596 243L599 244L600 247L595 255L589 248L584 249L585 252L580 246L575 246L574 248L572 248L574 253L573 256L575 258L575 261L572 261L572 265L577 268L577 275L574 279L572 280L572 278L570 278L564 282L562 280L556 280L553 278L554 281L551 282L552 286L550 286L545 282L540 275L539 277L539 275L536 276L533 274L531 282L530 280L527 280L525 278L527 276L527 269L524 266L522 266L523 264L519 263L519 261L516 258L514 264L511 263L510 265L512 267L508 275L508 273L503 272L501 269L498 269L493 266L488 267L484 258L471 254L468 251L465 244L466 240L464 238L464 234L460 231L458 227L460 225L454 218L452 218L453 217L449 213L450 204L448 203L448 201L440 202L435 199L432 200L428 195L421 194L420 197L415 199L417 203L414 206L415 208L413 210L403 212L403 214L401 215L404 221L404 228L408 229L410 235L413 235L419 239L417 239L417 241L415 241L411 248L409 249L407 253L409 257L409 259L407 259L408 261L401 264L402 272L406 279L412 281L416 286L426 288L440 296L440 301L444 308L450 314L450 319L448 319L449 324L453 327L455 333L470 348L466 354L464 354L462 350L459 350L458 358L467 368L465 373L474 382L471 385L473 390L472 393L474 397L475 413L478 416L477 419L479 424L476 430L475 437L478 443L479 458L481 460L480 464L482 476L480 483L482 487L482 492L484 494L483 503L489 510L488 511L494 517L493 508L496 504L494 502L494 498L500 492L501 488L504 486L503 485L508 481L508 486L521 498L521 500L525 503L524 504L529 508L528 510L530 512L528 514L523 515L522 517L525 523L530 528L529 529L533 532L535 531L535 538L536 539L541 532L546 534L549 532L550 529L552 529L554 532L553 535L560 542L559 543L563 549L562 553L563 552L565 554L569 566L574 566L573 575L579 578L578 580L585 584L583 588L584 589L586 590L588 589L588 587L590 588L587 591L589 593L588 596L585 596L585 599L596 607L595 609L597 609L593 612L594 614L599 615L604 622zM806 410L806 410zM839 416L839 416zM774 411L774 411z"</span>
      <span class="hljs-attr">id</span>=<span class="hljs-string">"å››å·çœ"</span>
      <span class="hljs-attr">stroke</span>=<span class="hljs-string">"blue"</span>
      <span class="hljs-attr">stroke-dasharray</span>=<span class="hljs-string">"20 2810"</span>
      <span class="hljs-attr">stroke-dashoffset</span>=<span class="hljs-string">"2810"</span>
    /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
</code></pre>
<h3 data-id="heading-4">style</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.animation-0</span> {
  <span class="hljs-attribute">animation</span>: dash <span class="hljs-number">10s</span> linear <span class="hljs-number">0.1s</span> <span class="hljs-number">1</span> forwards;
}
<span class="hljs-keyword">@keyframes</span> dash {
  <span class="hljs-selector-tag">to</span> {
    stroke-dashoffset: <span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">/* å®ç°æµå…‰ */</span>
<span class="hljs-selector-class">.animation-1</span> {
  <span class="hljs-comment">/* animation: name duration timing-function delay iteration-count direction fill-mode play-state; */</span>
  <span class="hljs-attribute">animation</span>: strokedash0 <span class="hljs-number">0.1s</span> linear <span class="hljs-number">10.1s</span> <span class="hljs-number">1</span> forwards,
              dash1 <span class="hljs-number">10s</span> linear <span class="hljs-number">10.2s</span> infinite forwards;
}
<span class="hljs-keyword">@keyframes</span> strokedash0 {
  <span class="hljs-selector-tag">to</span> {
    stroke-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
}
<span class="hljs-keyword">@keyframes</span> dash1 {
  <span class="hljs-selector-tag">to</span> {
    stroke-dashoffset: <span class="hljs-number">0</span>;
  }
}
<span class="hljs-keyword">@keyframes</span> strokedash1 {
  <span class="hljs-selector-tag">to</span> {
    stroke-<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
}
</code></pre>
<p>åšå®¢å›­ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwttt123%2Fp%2F18101630" target="_blank" title="https://www.cnblogs.com/wttt123/p/18101630" ref="nofollow noopener noreferrer">www.cnblogs.com/wttt123/p/1â€¦</a></p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºvant3çš„æœç´¢é€‰æ‹©ç»„ä»¶]]></title>    <link>https://juejin.cn/post/7585406030020984867</link>    <guid>https://juejin.cn/post/7585406030020984867</guid>    <pubDate>2025-12-19T13:08:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030020984867" data-draft-id="7585391510058762292" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºvant3çš„æœç´¢é€‰æ‹©ç»„ä»¶"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-19T13:08:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·188787106984"/> <meta itemprop="url" content="https://juejin.cn/user/2455640372153627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºvant3çš„æœç´¢é€‰æ‹©ç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2455640372153627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·188787106984
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:08:43.000Z" title="Fri Dec 19 2025 13:08:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec13594764942199c3adf9350292a65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTg4Nzg3MTA2OTg0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754523&amp;x-signature=dZ7FLf5SZvHoL3GhYzFy6Jcb4HY%3D" width="150px" loading="lazy"/>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;search-list
  :<span class="hljs-attr">list</span>=<span class="hljs-string">"List"</span>
  :<span class="hljs-attr">isShow</span>=<span class="hljs-string">"true"</span>
  :<span class="hljs-attr">isAddShow</span>=<span class="hljs-string">"true"</span>
  :<span class="hljs-attr">keyName</span>=<span class="hljs-string">"key"</span>
  :<span class="hljs-attr">typeName</span>=<span class="hljs-string">"name"</span>
  @<span class="hljs-attr">item-check</span>=<span class="hljs-string">"itemCheck"</span>
  @<span class="hljs-attr">show-status</span>=<span class="hljs-string">"showStatus"</span>
  @<span class="hljs-attr">call-back</span>=<span class="hljs-string">"callBack"</span>
/&gt;
</code></pre>
<p>å‚æ•°å€¼ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">List:</span> any[] = [{},{}];
<span class="hljs-symbol">isAddShow:</span> æ–°å¢çš„æ¨¡å—æ˜¯å¦æ˜¾ç¤º  ä¸å¡«é»˜è®¤ä¸º<span class="hljs-literal">false</span>
<span class="hljs-symbol">keyName:</span> æœç´ åŠæ˜¾ç¤ºçš„é”®å
<span class="hljs-symbol">typeName:</span> åˆ†ç±»å
<span class="hljs-symbol">itemCheck:</span> è¿”å›é€‰ä¸­æ•°æ®
<span class="hljs-symbol">showStatus:</span> è¿”å›å¼¹çª—æ˜¯å¦show  param: <span class="hljs-type">boolean</span>
<span class="hljs-symbol">callBack:</span> ç‚¹å‡»æ–°å¢æŒ‰é’®è¿”å›æ•°æ®  param: æœç´ æ¡†ä¸­çš„è¾“å…¥å€¼
</code></pre>
<p>ä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">List</span>= [
  {
    driverId: <span class="hljs-string">'111011101'</span>,
    driverName: <span class="hljs-string">'å¸æœºå§“å'</span>,
    driverTel: <span class="hljs-string">'13112341234'</span>,
  }
]
<span class="hljs-attr">keyName</span>=<span class="hljs-string">'driverName'</span> æœç´ åˆ—è¡¨æ˜¾ç¤ºdriverNameçš„æ•°æ®ï¼Œæœç´¢é¡µæœç´¢driverName
<span class="hljs-attr">typeName</span>=<span class="hljs-string">'å¸æœº'</span> æœç´¢å¼¹çª—ï¼šã€ä»¥ä¸‹ä¸æ˜¯æˆ‘çš„å¸æœºã€‘ ã€ç‚¹å‡»å»ºç«‹æ–°çš„å¸æœºã€‘
itemCheck: è¿”å›æ•°æ®ä¸ºï¼š params: {driverId:'',driverName:'',driverTel:''}
callBackï¼š è¿”å›æ•°æ®ä¸º'å¸æœº'
</code></pre>
<p>vue:</p>
<pre><code class="hljs language-ini" lang="ini">&lt;template&gt;
  &lt;van-popup v-model:<span class="hljs-attr">show</span>=<span class="hljs-string">"show"</span> round position=<span class="hljs-string">"bottom"</span> :closeable=<span class="hljs-string">"true"</span> :close-icon=<span class="hljs-string">"closeImg"</span>&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"list-box"</span>&gt;
      &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"top-box"</span>&gt;
        &lt;p <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;è¯·é€‰æ‹©{{ typeName }}&lt;/p&gt;
        &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"search-box"</span>&gt;
          &lt;van-search
            <span class="hljs-attr">v-model</span>=<span class="hljs-string">"searchValue"</span>
            show-action
            <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span>
            autofocus
            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥æœç´¢å…³é”®è¯"</span>
            @<span class="hljs-attr">search</span>=<span class="hljs-string">"onSearch"</span>
            @<span class="hljs-attr">clear</span>=<span class="hljs-string">"onClear"</span>
          &gt;
            &lt;template <span class="hljs-comment">#action&gt;</span>
              &lt;div @<span class="hljs-attr">click</span>=<span class="hljs-string">"onSearch"</span> class=<span class="hljs-string">"search-btn"</span>&gt;æœç´¢&lt;/div&gt;
            &lt;/template&gt;
          &lt;/van-search&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"list-box"</span>&gt;
        &lt;van-list <span class="hljs-attr">finished-text</span>=<span class="hljs-string">"æ²¡æœ‰æ›´å¤šäº†"</span>&gt;
          &lt;van-cell <span class="hljs-attr">class</span>=<span class="hljs-string">"add-box"</span> v-if=<span class="hljs-string">"addShow ? addShow : false"</span>&gt;
            &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"cell-title"</span>&gt;ä»¥ä¸‹ä¸æ˜¯æˆ‘çš„{{ typeName }}&lt;/div&gt;
            &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"cell-info"</span> @click=<span class="hljs-string">"target"</span>&gt;
              ç‚¹å‡»å»ºç«‹
              &lt;span <span class="hljs-attr">class</span>=<span class="hljs-string">"blue"</span>&gt;æ–°çš„{{ typeName }}&lt;/span&gt;
            &lt;/div&gt;
          &lt;/van-cell&gt;
          &lt;template <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in listArr"</span> :key=<span class="hljs-string">"item"</span>&gt;
            &lt;van-cell @<span class="hljs-attr">click</span>=<span class="hljs-string">"checkItem(item)"</span>&gt;
              &lt;span
                <span class="hljs-attr">v-for</span>=<span class="hljs-string">"res in item[keyName]"</span>
                :<span class="hljs-attr">key</span>=<span class="hljs-string">"res"</span>
                :<span class="hljs-attr">class</span>=<span class="hljs-string">"
                  searchValue.length &gt; 0 &amp;&amp;
                  searchValue.indexOf(res) &gt; -1 &amp;&amp;
                  item[keyName].includes(searchValue)
                    ? 'active'
                    : ''
                "</span>
              &gt;
                {{ res }}
              &lt;/span&gt;
            &lt;/van-cell&gt;
          &lt;/template&gt;
        &lt;/van-list&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/van-popup&gt;
&lt;/template&gt;
</code></pre>
<p>ts:</p>
<pre><code class="hljs language-ini" lang="ini">&lt;script <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;
  import { defineComponent, ref, watch, watchEffect } from 'vue'<span class="hljs-comment">;</span>
  import { Popup, Cell, Search, List, Toast } from 'vant'<span class="hljs-comment">;</span>

  import closeImg from '/@/assets/images/close-1.png'<span class="hljs-comment">;</span>

  export default defineComponent({
    name: 'SearchDriver',
    components: {
      <span class="hljs-section">[Popup.name]</span>: Popup,
      <span class="hljs-section">[Cell.name]</span>: Cell,
      <span class="hljs-section">[Search.name]</span>: Search,
      <span class="hljs-section">[List.name]</span>: List,
    },
    props: {
      list: {
        type: Array,
        required: true,
        default: () =&gt; {
          return <span class="hljs-section">['']</span><span class="hljs-comment">;</span>
        },
      },
      isShow: {
        type: Boolean,
        default: false,
      },
      keyName: {
        type: String,
        default: '',
      },
      typeName: {
        type: String,
        default: 'å¸æœº',
      },
      isAddShow: {
        type: Boolean,
        default: false,
      },
    },
    emits: <span class="hljs-section">['itemCheck', 'showStatus', 'callBack']</span>,
    setup(props, { emit }) {
      const <span class="hljs-attr">searchValue</span> = ref&lt;string&gt;(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
      // æ•°ç»„
      let <span class="hljs-attr">propList</span> = ref&lt;string[]&gt;(props.list as string[])<span class="hljs-comment">;</span>
      let <span class="hljs-attr">newList</span> = ref&lt;string[]&gt;(props.list as string[])<span class="hljs-comment">;</span>
      // å¼¹çª—æ˜¯å¦æ˜¾ç¤º
      let <span class="hljs-attr">show</span> = ref&lt;boolean&gt;(props.isShow)<span class="hljs-comment">;</span>
      // æ–°å¢æ¨¡å—æ˜¯å¦æ˜¾ç¤º
      let <span class="hljs-attr">addShow</span> = ref&lt;boolean&gt;(props.isAddShow)<span class="hljs-comment">;</span>
      // åˆ—è¡¨æ˜¾ç¤ºæ•°æ®
      let <span class="hljs-attr">listArr</span> = ref&lt;any&gt;()<span class="hljs-comment">;</span>
      // ç±»å‹
      let <span class="hljs-attr">type</span> = ref&lt;string&gt;(props.typeName)<span class="hljs-comment">;</span>

      const <span class="hljs-attr">dataMap</span> = (arr: any[]) =&gt; {
        if (!arr || arr.length &lt; 1) {
          return <span class="hljs-section">[]</span><span class="hljs-comment">;</span>
        }
        return arr<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      <span class="hljs-attr">listArr.value</span> = dataMap(propList.value)<span class="hljs-comment">;</span>

      const <span class="hljs-attr">onSearch</span> = () =&gt; {
        console.log(searchValue.value)<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      // ç‚¹å‡»æ–°å¢æŒ‰é’®å
      const <span class="hljs-attr">target</span> = () =&gt; {
        emit('callBack', searchValue.value)<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      // è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®
      const <span class="hljs-attr">filterData</span> = (list: any[]) =&gt; {
        <span class="hljs-attr">newList.value</span> = list.filter(
          (item) =&gt; item<span class="hljs-section">[props.keyName]</span> &amp;&amp; item<span class="hljs-section">[props.keyName]</span>.indexOf(searchValue.value) &gt; -1
        )<span class="hljs-comment">;</span>
        <span class="hljs-attr">listArr.value</span> = dataMap(newList.value)<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      // é€‰ä¸­æ•°æ®
      const <span class="hljs-attr">checkItem</span> = (item: any) =&gt; {
        if (!item || item.length &lt; 1) {
          Toast('è¯·é‡æ–°é€‰æ‹©')<span class="hljs-comment">;</span>
          return<span class="hljs-comment">;</span>
        }
        <span class="hljs-attr">searchValue.value</span> = item[props.keyName]<span class="hljs-comment">;</span>
        <span class="hljs-attr">show.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
        emit('itemCheck', item)<span class="hljs-comment">;</span>
        emit('showStatus', false)<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      const <span class="hljs-attr">onClear</span> = () =&gt; {
        <span class="hljs-attr">searchValue.value</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
        <span class="hljs-attr">show.value</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
        emit('itemCheck', '')<span class="hljs-comment">;</span>
        emit('showStatus', false)<span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>

      watchEffect(() =&gt; {
        <span class="hljs-attr">show.value</span> = props.isShow<span class="hljs-comment">;</span>
        <span class="hljs-attr">propList.value</span> = props.list as string[]<span class="hljs-comment">;</span>
        <span class="hljs-attr">newList.value</span> = props.list as string[]<span class="hljs-comment">;</span>
        <span class="hljs-attr">type.value</span> = props.typeName<span class="hljs-comment">;</span>
        filterData(newList.value)<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>

      watch(show, () =&gt; {
        emit('showStatus', show.value)<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>

      watch(type, (old, newValue) =&gt; {
        if (old !== newValue) {
          <span class="hljs-attr">searchValue.value</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
        }
      })<span class="hljs-comment">;</span>

      watch(searchValue, (val, oldVal) =&gt; {
        const <span class="hljs-attr">len</span> = val.length<span class="hljs-comment">;</span>
        const <span class="hljs-attr">oldLen</span> = oldVal.length<span class="hljs-comment">;</span>
        if (len &gt; oldLen) {
          // å†™å…¥
          filterData(newList.value)<span class="hljs-comment">;</span>
        } else {
          // åˆ é™¤
          filterData(propList.value)<span class="hljs-comment">;</span>
        }
      })<span class="hljs-comment">;</span>

      return {
        searchValue,
        show,
        listArr,
        onSearch,
        onClear,
        checkItem,
        target,
        addShow,
        closeImg,
      }<span class="hljs-comment">;</span>
    },
  })<span class="hljs-comment">;</span>
&lt;/script&gt;
</code></pre>
<p>scss:</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@charset</span> <span class="hljs-string">"UTF-8"</span>;

$topHeight: <span class="hljs-number">160px</span>;
$vnoTop: <span class="hljs-number">36px</span>;
$checkColor: <span class="hljs-number">#1777f2</span>;

<span class="hljs-selector-class">.list-box</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">50vh</span>;
  <span class="hljs-attribute">padding-top</span>: $vnoTop;

  <span class="hljs-selector-class">.top-box</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: $vnoTop;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: $topHeight;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;

    <span class="hljs-selector-class">.title</span> {
      <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">40px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">36px</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> / <span class="hljs-number">85%</span>);
    }

    <span class="hljs-selector-class">.search-box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">696px</span>;
      <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">15px</span>;

      <span class="hljs-selector-class">.search-btn</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
        <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
        <span class="hljs-attribute">color</span>: $checkColor;
      }
    }
  }

  <span class="hljs-selector-class">.list-box</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-number">76vh</span>;
    <span class="hljs-attribute">margin-top</span>: $topHeight;
    <span class="hljs-attribute">overflow</span>: auto;

    <span class="hljs-selector-class">.add-box</span> {
      <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">84px</span>;
      <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'../../assets/images/search.png'</span>);
      <span class="hljs-attribute">background-position</span>: <span class="hljs-number">40px</span> <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">background-repeat</span>: no-repeat;
      <span class="hljs-attribute">background-size</span>: <span class="hljs-number">30px</span> <span class="hljs-number">30px</span>;

      <span class="hljs-selector-class">.cell-title</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">32px</span>;
        <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
        <span class="hljs-attribute">color</span>: <span class="hljs-number">#1c1c1c</span>;
      }

      <span class="hljs-selector-class">.cell-info</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
        <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
        <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> / <span class="hljs-number">25%</span>);

        <span class="hljs-selector-class">.blue</span> {
          <span class="hljs-attribute">color</span>: <span class="hljs-number">#1777f2</span>;
        }
      }
    }
  }

  <span class="hljs-selector-class">.van-cell</span> {
    <span class="hljs-attribute">position</span>: relative;

    &amp;<span class="hljs-selector-pseudo">::before</span> {
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">right</span>: <span class="hljs-built_in">var</span>(--van-padding-md);
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-built_in">var</span>(--van-padding-md);
      <span class="hljs-attribute">pointer-events</span>: none;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--van-cell-border-color);
      <span class="hljs-attribute">content</span>: <span class="hljs-string">' '</span>;
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }

    <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.active</span> {
      <span class="hljs-attribute">color</span>: $checkColor;
    }
  }
}
</code></pre>
<p>åšå®¢å›­ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwttt123%2Fp%2F18316088" target="_blank" title="https://www.cnblogs.com/wttt123/p/18316088" ref="nofollow noopener noreferrer">www.cnblogs.com/wttt123/p/1â€¦</a></p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaä¼ å‚è¿˜åœ¨çä¼ ï¼Ÿè¿™3ä¸ªè¿›é˜¶åŸºç¡€æŠ€å·§å°‘èµ°1å¹´å¼¯è·¯]]></title>    <link>https://juejin.cn/post/7585382317444087818</link>    <guid>https://juejin.cn/post/7585382317444087818</guid>    <pubDate>2025-12-19T13:24:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585382317444087818" data-draft-id="7585377403633156142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaä¼ å‚è¿˜åœ¨çä¼ ï¼Ÿè¿™3ä¸ªè¿›é˜¶åŸºç¡€æŠ€å·§å°‘èµ°1å¹´å¼¯è·¯"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-19T13:24:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡"/> <meta itemprop="url" content="https://juejin.cn/user/4294056357689099"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaä¼ å‚è¿˜åœ¨çä¼ ï¼Ÿè¿™3ä¸ªè¿›é˜¶åŸºç¡€æŠ€å·§å°‘èµ°1å¹´å¼¯è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4294056357689099/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:24:13.000Z" title="Fri Dec 19 2025 13:24:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ˜é‡‘æ‰“ç ä»”ï½Javaä¼ å‚çœ‹ç€ç®€å•ï¼Œå®åˆ™è—ç€ä¸å°‘å‘ï¼Œæ–°æ‰‹å®¹æ˜“æ‡µã€è€é¸Ÿå¶å°”è¸©ï¼Œä»Šå¤©åˆ†äº«3ä¸ªè¿›é˜¶ååŸºç¡€çš„ä¼ å‚æŠ€å·§ï¼Œå®ç”¨æ€§æ‹‰æ»¡ï¼Œä»£ç çŸ­å°ç²¾æ‚ï¼Œçœ‹å®Œå°±èƒ½ç”¨ï¼</p>
<h2 data-id="heading-0">1.  åˆ†æ¸…å€¼ä¼ é€’vså¼•ç”¨ä¼ é€’ï¼Œå‘Šåˆ«ä¼ å‚ç„å­¦</h2>
<p>Javaåªæœ‰å€¼ä¼ é€’ï¼å¾ˆå¤šäººææ··å¼•ç”¨ç±»å‹ä¼ å‚ï¼Œè¯¯ä»¥ä¸ºæ˜¯å¼•ç”¨ä¼ é€’ï¼Œå…¶å®æœ¬è´¨æ˜¯ä¼ å¼•ç”¨çš„å‰¯æœ¬ï¼Œè®°ä½2ä¸ªæ ¸å¿ƒç»“è®ºä¸è¸©å‘ã€‚</p>
<p>âœ… æ ¸å¿ƒç»“è®º</p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šä¼ å‰¯æœ¬ï¼Œæ–¹æ³•å†…ä¿®æ”¹ä¸å½±å“åŸå˜é‡</li>
<li>å¼•ç”¨ç±»å‹ï¼šä¼ åœ°å€å‰¯æœ¬ï¼Œæ”¹å¯¹è±¡å±æ€§å½±å“åŸå¯¹è±¡ï¼Œæ”¹å¼•ç”¨æŒ‡å‘ä¸å½±å“</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹1ï¼šåŸºæœ¬ç±»å‹ï¼ˆå€¼ä¼ é€’ï¼Œäº’ä¸å½±å“ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">changeInt</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span> {
    num = <span class="hljs-number">100</span>; <span class="hljs-comment">// æ”¹çš„æ˜¯å‰¯æœ¬</span>
}
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
changeInt(a);
System.out.println(a); <span class="hljs-comment">// è¾“å‡º10ï¼Œä¸å˜</span>

<span class="hljs-comment">// ç¤ºä¾‹2ï¼šå¼•ç”¨ç±»å‹ï¼ˆæ”¹å±æ€§å½±å“åŸå¯¹è±¡ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {String name;}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">changeName</span><span class="hljs-params">(Student stu)</span> {
    stu.name = <span class="hljs-string">"æ˜é‡‘"</span>; <span class="hljs-comment">// æ”¹å¯¹è±¡å†…å®¹ï¼Œå½±å“åŸå¯¹è±¡</span>
}
<span class="hljs-type">Student</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();
s.name = <span class="hljs-string">"å°ç™½"</span>;
changeName(s);
System.out.println(s.name); <span class="hljs-comment">// è¾“å‡ºæ˜é‡‘</span>

<span class="hljs-comment">// ç¤ºä¾‹3ï¼šå¼•ç”¨ç±»å‹ï¼ˆæ”¹æŒ‡å‘ä¸å½±å“åŸå¯¹è±¡ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">changeStu</span><span class="hljs-params">(Student stu)</span> {
    stu = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(); <span class="hljs-comment">// æ”¹å¼•ç”¨æŒ‡å‘ï¼Œå’ŒåŸå¯¹è±¡æ— å…³</span>
    stu.name = <span class="hljs-string">"å¤§ä½¬"</span>;
}
changeStu(s);
System.out.println(s.name); <span class="hljs-comment">// è¿˜æ˜¯æ˜é‡‘</span>
</code></pre>
<p>Â </p>
<h2 data-id="heading-1">2.  å¯å˜å‚æ•°ï¼šå‘Šåˆ«æ•°ç»„ä¼ å‚ï¼Œçµæ´»åˆä¼˜é›…</h2>
<p>Java5+æ”¯æŒå¯å˜å‚æ•°ï¼Œç”¨Â ...Â è¡¨ç¤ºï¼Œé€‚é…å‚æ•°ä¸ªæ•°ä¸å›ºå®šçš„åœºæ™¯ï¼Œæ›¿ä»£æ•°ç»„ä¼ å‚æ›´ç®€æ´ï¼Œåº•å±‚è¿˜æ˜¯æ•°ç»„ï¼Œä½†å†™æ³•æ›´èˆ’æœã€‚</p>
<p>âœ… æ ¸å¿ƒç”¨æ³•&amp;æ³¨æ„äº‹é¡¹</p>
<ul>
<li>æ ¼å¼ï¼šç±»å‹... å‚æ•°åï¼Œå¿…é¡»æ”¾å‚æ•°åˆ—è¡¨æœ€å</li>
<li>è°ƒç”¨ï¼šå¯ä¼ å¤šä¸ªåŒç±»å‹å‚æ•°ï¼Œä¹Ÿå¯ä¼ æ•°ç»„</li>
<li>å–å€¼ï¼šæŒ‰æ•°ç»„æ–¹å¼å–å€¼å³å¯</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ ç»Ÿæ•°ç»„ä¼ å‚ï¼ˆéº»çƒ¦ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sumArr</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) sum += num;
    <span class="hljs-keyword">return</span> sum;
}

<span class="hljs-comment">// å¯å˜å‚æ•°å†™æ³•ï¼ˆç®€æ´ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span>... nums)</span> { <span class="hljs-comment">// å¯å˜å‚æ•°æ”¾æœ€å</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) sum += num; <span class="hljs-comment">// æŒ‰æ•°ç»„éå†</span>
    <span class="hljs-keyword">return</span> sum;
}

<span class="hljs-comment">// è°ƒç”¨è¶…çµæ´»</span>
<span class="hljs-type">int</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> sum(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>); <span class="hljs-comment">// ä¼ å¤šä¸ªå‚æ•°</span>
<span class="hljs-type">int</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> sum(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>); <span class="hljs-comment">// ä¸ªæ•°éšæ„</span>
<span class="hljs-type">int</span>[] arr = {<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>};
<span class="hljs-type">int</span> <span class="hljs-variable">s3</span> <span class="hljs-operator">=</span> sum(arr); <span class="hljs-comment">// ä¼ æ•°ç»„ä¹Ÿèƒ½è¡Œ</span>
System.out.println(s1+s2+s3); <span class="hljs-comment">// è¾“å‡º45</span>
</code></pre>
<p>Â </p>
<h2 data-id="heading-2">3.  ä¼ å‚å…œåº•ï¼šé»˜è®¤å‚æ•°è¿™ä¹ˆå†™ï¼Œä¼˜é›…ä¸å•°å—¦</h2>
<p>Javaæ²¡æœ‰åŸç”Ÿé»˜è®¤å‚æ•°ï¼Œä½†2ç§æ›¿ä»£æ–¹æ¡ˆè¶…å®ç”¨ï¼Œä¸ç”¨å†™é‡è½½æ–¹æ³•ä¹Ÿèƒ½å®ç°å‚æ•°å…œåº•ï¼Œè¿›é˜¶åŸºç¡€å¿…å¤‡å°æŠ€å·§ã€‚</p>
<p>âœ… 2ç§å®ç”¨æ–¹æ¡ˆ</p>
<ul>
<li>æ–¹æ¡ˆ1ï¼šæ–¹æ³•å†…ä¸‰å…ƒè¿ç®—ç¬¦å…œåº•ï¼ˆç®€å•åœºæ™¯ï¼‰</li>
<li>æ–¹æ¡ˆ2ï¼šé‡è½½æ–¹æ³•+thisè°ƒç”¨ï¼ˆå¤æ‚åœºæ™¯ï¼‰</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šä¸‰å…ƒè¿ç®—ç¬¦å…œåº•ï¼ˆç®€å•å¥½ç”¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printMsg</span><span class="hljs-params">(String msg)</span> {
    <span class="hljs-comment">// ä¼ null/ç©ºå­—ç¬¦ä¸²ï¼Œå…œåº•ç»™é»˜è®¤å€¼</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">finalMsg</span> <span class="hljs-operator">=</span> (msg == <span class="hljs-literal">null</span> || msg.isEmpty()) ? <span class="hljs-string">"é»˜è®¤æ¶ˆæ¯"</span> : msg;
    System.out.println(finalMsg);
}

<span class="hljs-comment">// è°ƒç”¨</span>
printMsg(<span class="hljs-string">"æ˜é‡‘å¹²è´§"</span>); <span class="hljs-comment">// è¾“å‡ºæ˜é‡‘å¹²è´§</span>
printMsg(<span class="hljs-literal">null</span>); <span class="hljs-comment">// è¾“å‡ºé»˜è®¤æ¶ˆæ¯</span>

<span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šé‡è½½+thisè°ƒç”¨ï¼ˆå¤šå‚æ•°åœºæ™¯ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span> {
    add(a, <span class="hljs-number">0</span>); <span class="hljs-comment">// è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œç»™bé»˜è®¤å€¼0</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
    System.out.println(a + b);
}

<span class="hljs-comment">// è°ƒç”¨</span>
add(<span class="hljs-number">5</span>); <span class="hljs-comment">// ä¼ 1ä¸ªå‚æ•°ï¼Œé»˜è®¤b=0ï¼Œè¾“å‡º5</span>
add(<span class="hljs-number">5</span>,<span class="hljs-number">3</span>); <span class="hljs-comment">// ä¼ 2ä¸ªå‚æ•°ï¼Œè¾“å‡º8</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€å®æˆ˜ã€‘Flexå¸ƒå±€-ä¸Šä¸‹è‡ªé€‚åº”]]></title>    <link>https://juejin.cn/post/7585406030021083171</link>    <guid>https://juejin.cn/post/7585406030021083171</guid>    <pubDate>2025-12-19T14:24:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030021083171" data-draft-id="7585377128490450996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€å®æˆ˜ã€‘Flexå¸ƒå±€-ä¸Šä¸‹è‡ªé€‚åº”"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-19T14:24:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç ä¸Šè¡Œèµ°"/> <meta itemprop="url" content="https://juejin.cn/user/3018587060056128"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€å®æˆ˜ã€‘Flexå¸ƒå±€-ä¸Šä¸‹è‡ªé€‚åº”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3018587060056128/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç ä¸Šè¡Œèµ°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T14:24:31.000Z" title="Fri Dec 19 2025 14:24:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç»å…¸çš„å¸ƒå±€åœºæ™¯<strong>ä¸Šä¸‹å›ºå®šã€ä¸­é—´å¡«å……å‰©ä½™ç©ºé—´ã€‚</strong></p>
<h3 data-id="heading-0"><strong>æ€è·¯</strong></h3>
<blockquote>
<p>å°† Flex ä¸»è½´è®¾ä¸ºå‚ç›´æ–¹å‘ï¼ˆ<code>column</code>ï¼‰ï¼Œé€šè¿‡ <code>flex: 1</code> è®©ä¸­é—´åŒºåŸŸè‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ï¼Œä¸Šä¸‹åŒºåŸŸå›ºå®šé«˜åº¦æˆ–ç”±å†…å®¹è‡ªåŠ¨æ’‘å¼€ã€‚</p>
</blockquote>
<h3 data-id="heading-1"><strong>åŸç†</strong></h3>
<blockquote>
<ol>
<li>çˆ¶å®¹å™¨è®¾ç½®<br/>
<strong><code>display: flex</code></strong><br/>
<strong><code>flex-direction: column</code></strong>- å‚ç›´æ–¹å‘æ’åˆ—<br/>
<strong><code>min-height: 100vh</code></strong>- ç¡®ä¿å®¹å™¨è‡³å°‘å æ»¡æ•´ä¸ªè§†å£é«˜åº¦</li>
<li>é¡¶éƒ¨ / åº•éƒ¨åŒºåŸŸè®¾ç½®å›ºå®šé«˜åº¦ï¼ˆå¦‚ 50pxï¼‰ï¼Œä¸æŒ‡å®šé«˜åº¦ç”±å†…å®¹è‡ªåŠ¨æ’‘å¼€ã€‚</li>
<li>ä¸­é—´åŒºåŸŸè®¾ç½® <strong><code>flex: 1</code></strong>ï¼Œè‡ªåŠ¨å æ®çˆ¶å®¹å™¨å‰©ä½™é«˜åº¦ï¼›</li>
<li><strong><code>overflow-y: auto</code></strong> - å†…å®¹è¶…å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡</li>
</ol>
</blockquote>
<h3 data-id="heading-2"><strong>ç¤ºä¾‹</strong></h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>å¤´éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span>å†…å®¹åŒº<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"footer"</span>&gt;</span>åº•éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css">* {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
}
 
<span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}
 
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
}
 
<span class="hljs-selector-class">.header</span> {
  <span class="hljs-comment">/* å¤´éƒ¨é«˜åº¦ç”±å†…å®¹å†³å®šï¼Œä¸è®¾å›ºå®šé«˜åº¦ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
 
<span class="hljs-selector-class">.main</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;  <span class="hljs-comment">/* å…³é”®ï¼šè¿™å°†ä½¿ä¸»å†…å®¹åŒºå¡«å……å‰©ä½™ç©ºé—´ */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto; <span class="hljs-comment">/* å†…å®¹è¿‡å¤šæ—¶å¯æ»šåŠ¨ */</span>
}
 
<span class="hljs-selector-class">.footer</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
</code></pre>
<h3 data-id="heading-3"><strong>æµè§ˆå™¨å…¼å®¹æ€§</strong></h3>
<p>Flex å¸ƒå±€åœ¨ç°ä»£æµè§ˆå™¨ä¸­æœ‰å¾ˆå¥½çš„æ”¯æŒï¼ˆIE10+ï¼‰ï¼Œå¦‚éœ€å…¼å®¹æ—§ç‰ˆæµè§ˆå™¨ï¼Œå¯è€ƒè™‘ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•ä½œä¸ºé™çº§æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸç”Ÿjså®ç°é«˜æ€§èƒ½åˆ—è¡¨æ‹–æ‹½æ’åº]]></title>    <link>https://juejin.cn/post/7585397173022523411</link>    <guid>https://juejin.cn/post/7585397173022523411</guid>    <pubDate>2025-12-19T14:39:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173022523411" data-draft-id="7585390679397761030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸç”Ÿjså®ç°é«˜æ€§èƒ½åˆ—è¡¨æ‹–æ‹½æ’åº"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-19T14:39:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å·¦å³é£"/> <meta itemprop="url" content="https://juejin.cn/user/3139860938112589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸç”Ÿjså®ç°é«˜æ€§èƒ½åˆ—è¡¨æ‹–æ‹½æ’åº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860938112589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å·¦å³é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T14:39:48.000Z" title="Fri Dec 19 2025 14:39:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ•ˆæœå›¾
æ”¯æŒç”µè„‘å’Œæ‰‹æœºç§»åŠ¨ç«¯ï¼Œçº¯åŸºäºtransformçš„ç§»åŠ¨ï¼Œæ— ä»»åŠ¡domæ“ä½œ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6a9d72d691149f0bb9f810982484438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bem5Y-z6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766762276&amp;x-signature=LG8Aj6E1f3jODgKV6GIdxcpbGvg%3D" alt="sort.gif" loading="lazy"/></p>
<h2 data-id="heading-0">åœ¨çº¿ä½“éªŒ</h2>
<p>å®Œæ•´ä»£ç è§ä¸‹é¢çš„ç ä¸Šæ˜é‡‘ï¼Œç§»åŠ¨ç«¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…é¢„è§ˆ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e1559d5081440af95cf9025d2ca7979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bem5Y-z6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766762276&amp;x-signature=5TrG25gdvEI4HRwf8MH6JOeG%2BVU%3D" alt="image.png" loading="lazy"/>
<span href="https://code.juejin.cn/pen/7585539910740738063" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7585539910740738063" data-src="https://code.juejin.cn/pen/7585539910740738063" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<h2 data-id="heading-1">æˆ‘æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªåŸºäº Pointer Events çš„å¯æ‹–æ‹½æ’åºåˆ—è¡¨çš„</h2>
<p>è¿™ç¯‡æ–‡ç« è®°å½•äº†æˆ‘åœ¨å®ç°ä¸€ä¸ª <strong>ä¸ä¾èµ–ä»»ä½•ç¬¬ä¸‰æ–¹åº“</strong> çš„æ‹–æ‹½æ’åºåˆ—è¡¨æ—¶çš„å®Œæ•´æ€è€ƒè¿‡ç¨‹ä¸å®ç°ç»†èŠ‚ã€‚ä¸å…¶è¯´æ˜¯ä»£ç è®²è§£ï¼Œä¸å¦‚è¯´æ˜¯ä¸€ä»½ <strong>è®¾è®¡åŠ¨æœº + è¸©å‘è®°å½• + å®ç°åŸç†</strong> çš„æ€»ç»“ã€‚è¯¥å®ç°ä¸»è¦åŸºäº <strong>Pointer Events</strong>ã€<code>getBoundingClientRect</code> ä»¥åŠ <strong>translateY ä½ç§»åŠ¨ç”»</strong>ï¼Œå¹¶è§£å†³äº†æ‹–æ‹½æ’åºä¸­å¸¸è§çš„å‡ ä¸ªéš¾ç‚¹ï¼š</p>
<ul>
<li>å¿«é€Ÿæ‹–åŠ¨æ—¶ pointer äº‹ä»¶ä¸¢å¤±</li>
<li>å…ƒç´ è·¨è¶Šå¤šä¸ªä½ç½®æ—¶çš„â€œæ¼ä½â€é—®é¢˜</li>
<li>ä¸ç›´æ¥æ“ä½œ DOM é¡ºåºï¼Œè€Œæ˜¯é€šè¿‡ä½ç§»å®ç°é¡ºæ»‘åŠ¨ç”»</li>
</ul>
<p>å¦‚æœä½ å¯¹ SortableJSã€æ‹–æ‹½äº¤äº’æˆ–åº•å±‚å®ç°åŸç†æ„Ÿå…´è¶£ï¼Œè¿™ç¯‡æ–‡ç« ä¼šéå¸¸é€‚åˆä½ ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ä¸ºä»€ä¹ˆæˆ‘è¦è‡ªå·±å®ç°ä¸€ä¸ªæ‹–æ‹½æ’åº</h3>
<p>åœ¨ä¸€å¼€å§‹ï¼Œå…¶å®æˆ‘ä¹Ÿè€ƒè™‘è¿‡ç›´æ¥ä½¿ç”¨ SortableJS ä¹‹ç±»çš„æˆç†Ÿæ–¹æ¡ˆã€‚ä½†åœ¨å®é™…éœ€æ±‚å’Œå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æˆ‘æƒ³<strong>å®Œå…¨æŒæ§æ‹–æ‹½è¿‡ç¨‹</strong>ï¼Œè€Œä¸æ˜¯é»‘ç›’è°ƒç”¨</li>
<li>æˆ‘éœ€è¦ç†è§£ <strong>å¿«é€Ÿæ‹–åŠ¨ã€è·¨å¤šä¸ªä½ç½®æ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ</strong></li>
<li>æˆ‘ä¹‹å‰å®ç°çš„ç®€å•æ‹–æ‹½ demoï¼Œåœ¨å¿«é€Ÿæ»‘åŠ¨æ—¶ç»å¸¸å‡ºç° <strong>pointermove ä¸¢å¤±ã€å…ƒç´ é¡ºåºé”™ä¹±</strong> çš„é—®é¢˜</li>
</ul>
<p>æ‰€ä»¥æœ€ç»ˆæˆ‘å†³å®šï¼š</p>
<blockquote>
<p><strong>è‡ªå·±ä»é›¶å®ç°ä¸€ä¸ªæ‹–æ‹½æ’åºï¼Œå¹¶æŠŠæ¯ä¸€ä¸ªç»†èŠ‚éƒ½æƒ³æ¸…æ¥šã€‚</strong></p>
</blockquote>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘è¸©äº†ä¸å°‘å‘ï¼Œä¹Ÿé€æ¸æ€»ç»“å‡ºä¸€å¥—æ¯”è¾ƒç¨³å®šçš„å®ç°æ–¹å¼ã€‚</p>
<hr/>
<h3 data-id="heading-3">äºŒã€æ•´ä½“æ€è·¯æ¦‚è§ˆ</h3>
<p>è¿™å¥—æ‹–æ‹½æ’åºçš„æ ¸å¿ƒæ€æƒ³å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>DOM é¡ºåºä¿æŒä¸å˜ï¼Œé€šè¿‡ translateY æ¨¡æ‹Ÿä½ç½®å˜åŒ–ï¼Œå¹¶åœ¨æ‹–æ‹½è¿‡ç¨‹ä¸­åŠ¨æ€ç»´æŠ¤ä¸€ä¸ªâ€œé€»è¾‘é¡ºåºæ•°ç»„â€ã€‚</strong></p>
</blockquote>
<p>å…·ä½“æ‹†è§£å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p><strong>åˆå§‹åŒ–é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>è®°å½•æ¯ä¸ª item çš„åˆå§‹ä½ç½®ä¿¡æ¯ï¼ˆbounding rectï¼‰</li>
<li>å»ºç«‹ä¸€ä¸ª <code>listChildren</code> æ•°ç»„ï¼Œç”¨æ¥è¡¨ç¤ºå½“å‰â€œé€»è¾‘é¡ºåºâ€</li>
</ul>
</li>
<li>
<p><strong>æ‹–æ‹½å¼€å§‹ï¼ˆpointerdownï¼‰</strong> ï¼š</p>
<ul>
<li>è®°å½•æ‹–æ‹½èµ·ç‚¹</li>
<li>æ•è· pointerï¼Œé¿å…å¿«é€Ÿæ»‘åŠ¨å¯¼è‡´äº‹ä»¶ä¸¢å¤±</li>
</ul>
</li>
<li>
<p><strong>æ‹–æ‹½ä¸­ï¼ˆpointermoveï¼‰</strong> ï¼š</p>
<ul>
<li>å®æ—¶æ›´æ–°è¢«æ‹–æ‹½å…ƒç´ çš„ <code>translateY</code></li>
<li>æ ¹æ®æŒ‡é’ˆä½ç½®åˆ¤æ–­è¿›å…¥äº†å“ªä¸ª item åŒºåŸŸ</li>
<li>æ‰¹é‡ç§»åŠ¨ä¸­é—´å…ƒç´ ï¼Œåˆ¶é€ è‡ªåŠ¨è®©ä½æ•ˆæœ</li>
</ul>
</li>
<li>
<p><strong>æ‹–æ‹½ç»“æŸï¼ˆpointerupï¼‰</strong> ï¼š</p>
<ul>
<li>å°†æ‹–æ‹½å…ƒç´ å¸é™„åˆ°æœ€ç»ˆ slot</li>
<li>é€šè¿‡ transition å®ç°å›å¼¹åŠ¨ç”»</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€HTML ä¸ CSSï¼šä¸ºæ‹–æ‹½æ‰“åŸºç¡€</h3>
<h4 data-id="heading-5">1. HTML ç»“æ„</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"list"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;<span class="hljs-number">0</span>&lt;/div&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;<span class="hljs-number">1</span>&lt;/div&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;<span class="hljs-number">2</span>&lt;/div&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;<span class="hljs-number">3</span>&lt;/div&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;<span class="hljs-number">4</span>&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<ul>
<li><code>list</code>ï¼šæ‹–æ‹½å®¹å™¨</li>
<li><code>item</code>ï¼šå¯æ‹–æ‹½å…ƒç´ </li>
</ul>
<h4 data-id="heading-6">2. å…³é”® CSS ç‚¹</h4>
<pre><code class="hljs language-sql" lang="sql">.list {
  touch<span class="hljs-operator">-</span>action: <span class="hljs-keyword">none</span>;
}

.item {
  transition: transform <span class="hljs-number">0.3</span>s ease<span class="hljs-operator">-</span><span class="hljs-keyword">out</span>;
  <span class="hljs-keyword">user</span><span class="hljs-operator">-</span><span class="hljs-keyword">select</span>: <span class="hljs-keyword">none</span>;
}
</code></pre>
<p><strong>é‡ç‚¹è¯´æ˜ï¼š</strong></p>
<ul>
<li>
<p><code>touch-action: none</code></p>
<ul>
<li>ç¦æ­¢æµè§ˆå™¨é»˜è®¤çš„æ»šåŠ¨ã€ç¼©æ”¾ç­‰æ‰‹åŠ¿</li>
<li>å¦åˆ™ pointermove åœ¨ç§»åŠ¨ç«¯ä¼šè¢«ç³»ç»ŸåŠ«æŒ</li>
</ul>
</li>
<li>
<p><code>transition: transform</code></p>
<ul>
<li>éæ‹–æ‹½å…ƒç´ äº§ç”Ÿâ€œè‡ªåŠ¨ä½ç§»â€åŠ¨ç”»</li>
</ul>
</li>
<li>
<p><code>user-select: none</code></p>
<ul>
<li>é˜²æ­¢æ‹–æ‹½æ—¶é€‰ä¸­æ–‡æœ¬</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-7">å››ã€åˆå§‹åŒ–ï¼šå»ºç«‹ä½ç½®ä¿¡æ¯æ¨¡å‹</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">listChildren</span> = Array.from(list.children)<span class="hljs-comment">;</span>
const <span class="hljs-attr">rectInfo</span> = []<span class="hljs-comment">;</span>

Array.from(list.children).forEach((item, index) =&gt; {
  <span class="hljs-attr">item.dataset.index</span> = index<span class="hljs-comment">;</span>
  const <span class="hljs-attr">rect</span> = item.getBoundingClientRect()<span class="hljs-comment">;</span>
  Object.assign(rect, {
    id: index,
    index,
    located: {
      x: rect.x,
      y: rect.y,
    },
  })<span class="hljs-comment">;</span>
  rectInfo.push(rect)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-8">è¿™é‡Œåšäº†ä¸‰ä»¶äº‹ï¼š</h4>
<ol>
<li>
<p><strong>è®°å½•åˆå§‹é¡ºåº</strong>ï¼š</p>
<ul>
<li><code>dataset.index</code> è¡¨ç¤ºé€»è¾‘ç´¢å¼•</li>
</ul>
</li>
<li>
<p><strong>ç¼“å­˜ä½ç½®ä¿¡æ¯</strong>ï¼š</p>
<ul>
<li><code>getBoundingClientRect()</code> åªåœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡</li>
<li>é¿å…æ‹–æ‹½è¿‡ç¨‹ä¸­é¢‘ç¹è§¦å‘å›æµ</li>
</ul>
</li>
<li>
<p><strong>rectInfo æ˜¯â€œé™æ€åæ ‡ç³»â€</strong> ï¼š</p>
<ul>
<li>æ‰€æœ‰ä½ç§»è®¡ç®—éƒ½åŸºäºåˆå§‹ top å€¼</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">äº”ã€pointerdownï¼šæ‹–æ‹½çš„èµ·ç‚¹ï¼ˆç¬¬ä¸€ä¸ªå¤§å‘ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">list.addEventListener("pointerdown", (e) =&gt; {
  if (e.target.classList.contains("list")) return<span class="hljs-comment">;</span>

  <span class="hljs-attr">isPointerDown</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
  e.target.setPointerCapture(e.pointerId)<span class="hljs-comment">;</span>

  <span class="hljs-attr">e.target.style.zIndex</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  <span class="hljs-attr">e.target.style.transition</span> = <span class="hljs-string">"none"</span><span class="hljs-comment">;</span>

  <span class="hljs-attr">slotIndex</span> = dragIndex = Number(e.target.dataset.index)<span class="hljs-comment">;</span>
  <span class="hljs-attr">dragPos.startY</span> = e.clientY<span class="hljs-comment">;</span>
  <span class="hljs-attr">dragPos.startTranslateY</span> = Number(e.target.dataset.translateY || <span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-10">æ ¸å¿ƒç‚¹è§£æ</h4>
<h5 data-id="heading-11">1. <code>setPointerCapture</code></h5>
<p>è¿™æ˜¯æˆ‘åœ¨å®ç°è¿‡ç¨‹ä¸­è¸©åˆ°çš„<strong>ç¬¬ä¸€ä¸ªå¤§å‘</strong>ï¼Œä¹Ÿæ˜¯è¿™å¥—æ–¹æ¡ˆé‡Œæœ€å…³é”®çš„ä¸€ç‚¹ã€‚</p>
<ul>
<li>æŒ‡é’ˆå³ä½¿ç§»åŠ¨åˆ°å…ƒç´ å¤–</li>
<li>äº‹ä»¶ä¾ç„¶ä¼šæ´¾å‘ç»™å½“å‰å…ƒç´ </li>
</ul>
<p>è¿™åœ¨å¿«é€Ÿæ‹–æ‹½ã€å¤šç‚¹è§¦æ§åœºæ™¯ä¸­éå¸¸é‡è¦ã€‚</p>
<h5 data-id="heading-12">2. ç¦ç”¨ transition</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">e.target.style.transition</span> = <span class="hljs-string">"none"</span><span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>æ‹–æ‹½å…ƒç´ éœ€è¦ 1:1 è·Ÿéšæ‰‹æŒ‡</li>
<li>ä¸èƒ½æœ‰åŠ¨ç”»å»¶è¿Ÿ</li>
</ul>
<hr/>
<h3 data-id="heading-13">å…­ã€pointermoveï¼šæ’åºçš„æ ¸å¿ƒé€»è¾‘ï¼ˆä¹Ÿæ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ï¼‰</h3>
<h4 data-id="heading-14">1. æ‹–æ‹½å…ƒç´ ä½ç§»</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">dragPos.diffY</span> = e.clientY - dragPos.startY + dragPos.y<span class="hljs-comment">;</span>

<span class="hljs-attr">e.target.style.transform</span> = `translateY(<span class="hljs-variable">${dragPos.diffY}</span>px)`<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><code>diffY</code> = å½“å‰æŒ‡é’ˆä½ç½® - èµ·ç‚¹ + åˆå§‹åç§»</li>
<li>ä½¿ç”¨ transform ä¸ä¼šè§¦å‘å¸ƒå±€</li>
</ul>
<hr/>
<h4 data-id="heading-15">2. åˆ¤æ–­è¿›å…¥å“ªä¸ª slot</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">if</span> (
  e.clientX &gt; r.left &amp;&amp;
  e.clientX &lt; r.left + r.width &amp;&amp;
  e.clientY &gt; r.y &amp;&amp;
  e.clientY &lt; r.y + r.height
)
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>æŒ‡é’ˆå‘½ä¸­æ£€æµ‹ï¼ˆHit Testï¼‰</strong> ï¼š</p>
<ul>
<li>ä¸ä¾èµ– DOM é¡ºåº</li>
<li>åªçœ‹æŒ‡é’ˆæ˜¯å¦è¿›å…¥æŸä¸ª rect</li>
</ul>
<hr/>
<h4 data-id="heading-16">3. æ‰¹é‡ä½ç§»ï¼šè§£å†³â€œè·¨å¤šä¸ªä½ç½®â€é—®é¢˜</h4>
<h5 data-id="heading-17">å‘ä¸‹æ‹–åŠ¨ï¼ˆi &gt; slotIndexï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">for (let <span class="hljs-attr">j</span> = slotIndex + <span class="hljs-number">1</span><span class="hljs-comment">; j &lt;= i; j++) {</span>
  listChildren<span class="hljs-section">[j]</span>.<span class="hljs-attr">dataset.translateY</span> =
    rectInfo<span class="hljs-section">[j - 1]</span>.top - rectInfo<span class="hljs-section">[j]</span>.top +
    Number(listChildren<span class="hljs-section">[j]</span>.dataset.translateY || 0)<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li>ä¸­é—´æ‰€æœ‰å…ƒç´ ä¾æ¬¡å‘ä¸Šè®©ä½</li>
<li>å³ä½¿ pointermove è§¦å‘é¢‘ç‡è¾ƒä½ï¼Œä¹Ÿä¸ä¼šæ¼æ‰ä¸­é—´é¡¹</li>
</ul>
<h5 data-id="heading-18">å‘ä¸Šæ‹–åŠ¨åŒç†</h5>
<p>è¿™æ­£æ˜¯å¾ˆå¤šâ€œç®€å•æ‹–æ‹½ demoâ€åšä¸åˆ°çš„åœ°æ–¹ã€‚</p>
<hr/>
<h4 data-id="heading-19">4. é€»è¾‘é¡ºåºæ•°ç»„çš„ç»´æŠ¤</h4>
<pre><code class="hljs language-ini" lang="ini">listChildren.splice(j - 1, 0, listChildren<span class="hljs-section">[j]</span>)<span class="hljs-comment">;</span>
listChildren.splice(j + 1, 1)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>ä¸æ“ä½œ DOM</strong></li>
<li>åªç»´æŠ¤ä¸€ä¸ª JS æ•°ç»„</li>
<li><code>dataset.index</code> æ°¸è¿œå’Œé€»è¾‘é¡ºåºä¿æŒä¸€è‡´</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯åç»­å›å¼¹è®¡ç®—çš„å…³é”®ã€‚</p>
<hr/>
<h3 data-id="heading-20">ä¸ƒã€pointerupï¼šå¸é™„ä¸å›å¼¹</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">dragPos.y</span> =
  rectInfo<span class="hljs-section">[slotIndex]</span>.top -
  rectInfo<span class="hljs-section">[dragIndex]</span>.top +
  dragPos.startTranslateY<span class="hljs-comment">;</span>

<span class="hljs-attr">e.target.style.transition</span> = <span class="hljs-string">"transform .3s ease-out"</span><span class="hljs-comment">;</span>
<span class="hljs-attr">e.target.style.transform</span> = `translateY(<span class="hljs-variable">${dragPos.y}</span>px)`<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-21">è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>æ ¹æ® <strong>æœ€ç»ˆ slot ä¸åˆå§‹ slot çš„ top å·®å€¼</strong></li>
<li>è®¡ç®—æ‹–æ‹½å…ƒç´ åº”è¯¥è½åˆ°çš„ä½ç½®</li>
<li>é‡æ–°å¯ç”¨ transitionï¼Œå½¢æˆå›å¼¹åŠ¨ç”»</li>
</ul>
<p>æ•´ä¸ªæ’åºè¿‡ç¨‹åœ¨è§†è§‰ä¸Šå®Œæˆé—­ç¯ã€‚</p>
<hr/>
<h3 data-id="heading-22">å…«ã€æ ¸å¿ƒæµç¨‹ç¤ºæ„å›¾ï¼šé€»è¾‘é¡ºåº vs DOM é¡ºåº</h3>
<p>è¿™æ˜¯æˆ‘åœ¨å®ç°è¿‡ç¨‹ä¸­<strong>æœ€é‡è¦çš„ä¸€ä¸ªè®¤çŸ¥è½¬å˜</strong>ã€‚</p>
<h4 data-id="heading-23">1ï¸âƒ£ DOM é¡ºåºï¼ˆå§‹ç»ˆä¸å˜ï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp">DOM:
[<span class="hljs-meta">item0</span>]
[<span class="hljs-meta">item1</span>]
[<span class="hljs-meta">item2</span>]
[<span class="hljs-meta">item3</span>]
[<span class="hljs-meta">item4</span>]
</code></pre>
<p>åœ¨æ•´ä¸ªæ‹–æ‹½è¿‡ç¨‹ä¸­ï¼š</p>
<ul>
<li>DOM èŠ‚ç‚¹ä»æœªè¢«æ’å…¥ / åˆ é™¤</li>
<li>æµè§ˆå™¨å¸ƒå±€ä¸ä¼šåå¤é‡æ’</li>
</ul>
<hr/>
<h4 data-id="heading-24">2ï¸âƒ£ é€»è¾‘é¡ºåºï¼ˆJS æ•°ç»„ç»´æŠ¤ï¼‰</h4>
<pre><code class="hljs language-css" lang="css">æ‹–æ‹½ item1 å‘ä¸‹ç§»åŠ¨ï¼š

é€»è¾‘æ•°ç»„ listChildrenï¼š
<span class="hljs-selector-attr">[item0]</span> <span class="hljs-selector-attr">[item2]</span> <span class="hljs-selector-attr">[item3]</span> <span class="hljs-selector-attr">[item1]</span> <span class="hljs-selector-attr">[item4]</span>
</code></pre>
<ul>
<li><code>listChildren</code> æ‰æ˜¯çœŸæ­£çš„â€œå½“å‰é¡ºåºâ€</li>
<li><code>dataset.index</code> å§‹ç»ˆå’Œé€»è¾‘é¡ºåºä¸€è‡´</li>
</ul>
<hr/>
<h4 data-id="heading-25">3ï¸âƒ£ è§†è§‰ä½ç½®ï¼ˆtranslateYï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">è§†è§‰å±‚ï¼š
item1  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  <span class="hljs-built_in">translateY</span>(+<span class="hljs-number">120px</span>)
item2  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€  <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">60px</span>)
item3  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€  <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">60px</span>)
</code></pre>
<blockquote>
<p><strong>DOM ä¸åŠ¨ï¼Œæ•°ç»„å˜ï¼Œtransform åœ¨åŠ¨</strong></p>
</blockquote>
<p>ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œåé¢çš„æ‰€æœ‰ä½ç§»ã€åŠ¨ç”»å’Œå›å¼¹è®¡ç®—éƒ½ä¼šéå¸¸è‡ªç„¶ã€‚</p>
<hr/>
<h3 data-id="heading-26">ä¹ã€æ€»ç»“ï¼šè¿™å¥—æ–¹æ¡ˆè§£å†³äº†ä»€ä¹ˆé—®é¢˜</h3>
<p>è¿™ä»½ä»£ç çš„å‡ ä¸ªäº®ç‚¹ï¼š</p>
<ul>
<li>âœ… ä½¿ç”¨ Pointer Eventsï¼Œç»Ÿä¸€é¼ æ ‡ / è§¦æ‘¸</li>
<li>âœ… <code>setPointerCapture</code> è§£å†³å¿«é€Ÿæ‹–æ‹½é—®é¢˜</li>
<li>âœ… ä¸æ“ä½œ DOM é¡ºåºï¼ŒåŠ¨ç”»æ€§èƒ½æä½³</li>
<li>âœ… æ”¯æŒè·¨å¤šä¸ªä½ç½®çš„ç¨³å®šæ’åº</li>
</ul>
<p>å¦‚æœä½ ç†è§£äº†è¿™å¥—é€»è¾‘ï¼Œå†å»çœ‹ SortableJS çš„æºç ï¼Œä¼šå‘ç°å¾ˆå¤šæ€æƒ³æ˜¯ç›¸é€šçš„ã€‚</p>
<hr/>
<h3 data-id="heading-27">åã€å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„æ–¹å‘</h3>
<ul>
<li>æ‹–æ‹½ç»“æŸåçœŸæ­£æ›´æ–° DOM é¡ºåº</li>
<li>æ”¯æŒæ¨ªå‘ / Grid æ’åº</li>
<li>å¢åŠ  placeholder å ä½å…ƒç´ </li>
<li>å¢åŠ æ‹–æ‹½é˜ˆå€¼ã€é˜²æŠ–å¤„ç†</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidå¼€å‘wslç›´æ¥ä½¿ç”¨adbæ–¹æ³•]]></title>    <link>https://juejin.cn/post/7585377128490303540</link>    <guid>https://juejin.cn/post/7585377128490303540</guid>    <pubDate>2025-12-19T12:54:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585377128490303540" data-draft-id="7585385309890871296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidå¼€å‘wslç›´æ¥ä½¿ç”¨adbæ–¹æ³•"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-19T12:54:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="chasten08"/> <meta itemprop="url" content="https://juejin.cn/user/4424090518291048"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidå¼€å‘wslç›´æ¥ä½¿ç”¨adbæ–¹æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4424090518291048/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    chasten08
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:54:22.000Z" title="Fri Dec 19 2025 12:54:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>å› ä¸ºä¹‹å‰ä¸€ç›´ä½¿ç”¨Macå’ŒUbuntuç³»ç»Ÿä½œä¸ºå¼€å‘ç¯å¢ƒï¼Œå¯¹grepï¼Œzshå’Œvimä¾èµ–æ¯”è¾ƒé‡ï¼Œä½†æ˜¯å…¬å¸è¦æ±‚åªèƒ½ç”¨Windowsæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ä½¿ç”¨äº†WSL2ã€‚</p>
<p>å½“ç„¶ä½¿ç”¨Git for windowsä¹Ÿå¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œä¸è¿‡git for windowsçš„ç•Œé¢å°±ä¸å¤ªèˆ’æœäº†ï¼Œè€Œä¸”Git for Windowsè¿è¡Œæ¯”è¾ƒæ…¢ã€‚</p>
<p>åœ¨wslä¸­ä½¿ç”¨vimå’Œgrepéƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦adbè°ƒè¯•çš„æ—¶å€™æƒ³ç”¨grepï¼ˆAndroid studioä¸­ä¹Ÿæä¾›äº†è¿‡æ»¤åŠŸèƒ½ï¼Œæˆ‘ä¸ªäººå¯¹grepæ¯”è¾ƒä¾èµ–äº†ï¼‰ï¼Œæ‰€ä»¥å°±æ‰¾äº†ä¸€ä¸‹wslç›´æ¥ä½¿ç”¨adbçš„æ–¹å¼</p>
<h3 data-id="heading-1">å‰æ</h3>
<h5 data-id="heading-2">Windowsä¸Šadbé…ç½®</h5>
<p>å¦‚æœWindowsä¸Šå®‰è£…äº†adbå·¥å…·ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çš„Android sdkè‡ªå¸¦çš„ï¼Œä¸”äºŒè€…ç‰ˆæœ¬ä¸åŒï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½å¯¼è‡´Android studioç»å¸¸å¼ºåŠ¿ä»¥è‡ªèº«ä¸ºä¸»ï¼ˆAndroid sdkçš„ç‰ˆæœ¬ï¼‰å¯åŠ¨adbæœåŠ¡ï¼Œè¿™æ ·ä¼šæ˜¯wslè¿æ¥adbå‡ºé—®é¢˜ã€‚
å»ºè®®ç³»ç»Ÿä¸è¦å•ç‹¬å®‰è£…adbå·¥å…·ï¼Œè€Œæ˜¯é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡çš„æ–¹å¼å¼•ç”¨Android sdkçš„adbï¼ŒAndroid sdkçš„æŸ¥æ‰¾æ–¹å¼<code>Settings</code> -&gt; <code>Languages &amp; Frameworks</code> -&gt; <code>Android SDK</code>ï¼Œå¯ä»¥çœ‹åˆ°Android SDK Locationï¼Œæ¯”å¦‚<code>C:\Users\test\AppData\Local\Android\Sdk</code>ï¼Œé…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡Pathä¸­<code>C:\Users\test\AppData\Local\Android\Sdk\platform-tools\</code>,è¿™æ ·å°±å¯ä»¥ä¿è¯å’ŒAndroid studioçš„adbä¿æŒä¸€è‡´</p>
<h5 data-id="heading-3">wslç³»ç»Ÿå®‰è£…adb</h5>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install adb <span class="hljs-operator">-</span>y
</code></pre>
<h3 data-id="heading-4">æ¡¥æ¥adb</h3>
<p>ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼</p>
<ul>
<li>ä½¿ç”¨ USBIPD-WIN è¿›è¡Œ USB é€ä¼ </li>
<li>ADB ç½‘ç»œæ¡¥æ¥</li>
</ul>
<p>ç¬¬ä¸€ç§æ–¹æ¡ˆä¼šç‹¬å æ§åˆ¶æƒï¼ŒWindowsä¸Šä¸å¯å†æ§åˆ¶adbï¼Œæ¯”è¾ƒé€‚ç”¨äºåˆ·æœºå’Œæ·±åº¦é©±åŠ¨å¼€å‘åœºæ™¯ï¼Œæˆ‘åªæ˜¯ç®€å•ä½¿ç”¨Androidå¼€å‘ä¸­çš„åŸºç¡€å‘½ä»¤ï¼Œæ‰€ä»¥è¿™é‡Œåªæè¿°ç¬¬äºŒç§æ–¹å¼ã€‚</p>
<h5 data-id="heading-5">Windowsç«¯å¯åŠ¨è¿œç¨‹ç›‘å¬ -- PowerShellé…ç½®ï¼ˆwslå®‰è£…ä¾èµ–ï¼‰</h5>
<p>åœ¨PowerShellé…ç½®æ–‡ä»¶ä¸­ï¼Œè®¾ç½®å¯åŠ¨å‘½ä»¤ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶è¾“å…¥ä¸‹é¢çš„ä»£ç </p>
<pre><code class="hljs language-ps1" lang="ps1"># å¯åŠ¨adbè¿œç¨‹ç›‘å¬
# ç”¨æ³•: ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ adbon å³å¯
function adbon {
    adb kill-server
    Start-Process "adb" -ArgumentList "-a nodaemon server start" -WindowStyle Hidden
}
</code></pre>
<p>ä¹‹ååœ¨Power shellä¸­æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œæ˜¯ä¸Šè¿°ä»£ç ç”Ÿæ•ˆ</p>
<pre><code class="hljs language-bash" lang="bash">. <span class="hljs-variable">$PROFILE</span>
</code></pre>
<p>è¿™æ ·ä»¥åå¯ä»¥å¼€æœºååœ¨Powershellä¸­é€šè¿‡<code>adbon</code>å‘½ä»¤åœ¨Windowsç«¯å¯åŠ¨ï¼Œ<strong>è¿™ä¸ªPowerShellçª—å£æœ€å¥½ä¸è¦å…³é—­</strong></p>
<h5 data-id="heading-6">WSLç«¯æŒ‡å®šserveråœ°å€</h5>
<p>åœ¨ WSL çš„ <code>~/.zshrc</code> æˆ– <code>~/.bashrc</code> ä¸­(æ ¹æ®wslä½¿ç”¨çš„æ˜¯bash - é»˜è®¤è¿˜æ˜¯zsh)æ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">winadb</span></span>() {
    <span class="hljs-built_in">local</span> HOST_IP=$(ip route show | grep default | awk <span class="hljs-string">'{print $3}'</span>)
    <span class="hljs-built_in">local</span> ADB_PORT=5037

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ”„ æ­£åœ¨å°è¯•è¿æ¥ Windows ADB (<span class="hljs-variable">$HOST_IP</span>:<span class="hljs-variable">$ADB_PORT</span>)..."</span>

    <span class="hljs-comment"># 2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ (éœ€è¦å®‰è£… netcat: sudo apt install netcat)</span>
    <span class="hljs-keyword">if</span> nc -z -w 2 <span class="hljs-string">"<span class="hljs-variable">$HOST_IP</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$ADB_PORT</span>"</span>; <span class="hljs-keyword">then</span>
        <span class="hljs-comment"># 3. è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ¥ç®¡ ADB æŒ‡ä»¤</span>
        <span class="hljs-built_in">export</span> ADB_SERVER_SOCKET=tcp:<span class="hljs-variable">$HOST_IP</span>:<span class="hljs-variable">$ADB_PORT</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… è¿æ¥æˆåŠŸï¼"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ“± è®¾å¤‡åˆ—è¡¨:"</span>
        adb devices
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âŒ è¿æ¥å¤±è´¥ã€‚"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ‘‰ è¯·åœ¨ Windows PowerShell è¿è¡Œ 'adbon' å¯åŠ¨æœåŠ¡ã€‚"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ‘‰ æ£€æŸ¥ Windows é˜²ç«å¢™æ˜¯å¦å…è®¸ adb.exe é€šè¡Œã€‚"</span>
        <span class="hljs-built_in">unset</span> ADB_SERVER_SOCKET
    <span class="hljs-keyword">fi</span>
}
</code></pre>
<p>è®°å¾—æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc
<span class="hljs-comment"># æˆ–è€…</span>
<span class="hljs-built_in">source</span> ~/.bashrc
</code></pre>
<p>å¦‚æœWindowsä¸Šå·²ç»é€šè¿‡<code>adbon</code>å‘½ä»¤å¯åŠ¨äº†ï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡<code>winadb</code>å¯åŠ¨ç›‘å¬ï¼Œä¹‹åå°±å¯ä»¥åœ¨wslä¸­æ­£å¸¸ä½¿ç”¨adbåŠŸèƒ½äº†</p>
<h3 data-id="heading-7">å¸¸è§é—®é¢˜</h3>
<ol>
<li>ç¬¬ä¸€æ¬¡åœ¨Windowsä¸Šæ‰§è¡Œ<code>adbon</code>å‘½ä»¤æ—¶ï¼Œå¯èƒ½ä¼šå› ä¸ºå·²ç»æœ‰è¿›ç¨‹å¯åŠ¨äº†adbï¼Œä½†æ˜¯æ²¡æœ‰é‡Šæ”¾å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œå¯ä»¥å…ˆå…³é—­å¯èƒ½å ç”¨adbçš„åº”ç”¨ï¼ˆæ¯”å¦‚Android Studioï¼‰,ç„¶åç”¨ä¸‹é¢å‘½ä»¤ç»ˆæ­¢æ‰€æœ‰adbè¿›ç¨‹
<pre><code class="hljs language-r" lang="r">taskkill <span class="hljs-operator">/</span><span class="hljs-built_in">F</span> <span class="hljs-operator">/</span>IM adb.exe
</code></pre>
ç„¶åç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼Œæ˜¯å¦è¿˜æœ‰ç«¯å£å ç”¨
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">netstat</span> <span class="hljs-string">-ano</span> <span class="hljs-string">|</span> <span class="hljs-string">findstr</span> <span class="hljs-number">5037</span>
</code></pre>
å¦‚æœæ²¡æœ‰å†…å®¹è¾“å‡ºæˆ–è€…è¾“å‡ºå†…å®¹æœ€åä¸€åˆ—æ²¡æœ‰ä¸º0çš„å°±è¡¨ç¤ºå¯ä»¥ä½¿ç”¨<code>adbon</code>å¯åŠ¨Windowsç«¯çš„æœåŠ¡äº†</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€æˆ‘çš„AOSPç¬¬ä¸€è¯¾ã€‘Android Init è¯­è¨€ä¸ rc æ–‡ä»¶]]></title>    <link>https://juejin.cn/post/7585382317444022282</link>    <guid>https://juejin.cn/post/7585382317444022282</guid>    <pubDate>2025-12-19T12:56:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585382317444022282" data-draft-id="7573886599433437235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€æˆ‘çš„AOSPç¬¬ä¸€è¯¾ã€‘Android Init è¯­è¨€ä¸ rc æ–‡ä»¶"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-19T12:56:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="vocal"/> <meta itemprop="url" content="https://juejin.cn/user/2810789338028120"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€æˆ‘çš„AOSPç¬¬ä¸€è¯¾ã€‘Android Init è¯­è¨€ä¸ rc æ–‡ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2810789338028120/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    vocal
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T12:56:52.000Z" title="Fri Dec 19 2025 12:56:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"â‡²"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"â€¢";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><blockquote>
<p>rc æ–‡ä»¶æ˜¯ AOSP çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨å­¦ä¹  AOSP æ—¶ä¹Ÿè¦äº†è§£å­¦ä¹ ä¸‹ rc æ–‡ä»¶</p>
</blockquote>
<h2 data-id="heading-0">Android Init</h2>
<p>Android Init è¯­è¨€åŒ…å«äº”å¤§ç±»è¯­å¥</p>
<ol>
<li>åŠ¨ä½œ (Actions)</li>
<li>å‘½ä»¤ (Commands)</li>
<li>æœåŠ¡ (Services)</li>
<li>é€‰é¡¹ (Options)</li>
<li>å¯¼å…¥ (Imports)</li>
</ol>
<p>æ‰€æœ‰è¿™äº›è¯­å¥éƒ½æ˜¯<strong>ä»¥è¡Œä¸ºå•ä½</strong>ï¼Œç”±<strong>ç©ºæ ¼åˆ†éš”</strong>ç»„æˆã€‚å¯ä»¥ä½¿ç”¨åæ–œæ æ’å…¥ç©ºæ ¼ï¼Œæˆ–ä½¿ç”¨åŒå¼•å·é˜²æ­¢ç©ºæ ¼å°†æ–‡æœ¬æ‹†åˆ†ã€‚å½“åæ–œæ ä½äºè¡Œå°¾æ—¶ï¼Œå¯ç”¨äºç»­è¡Œã€‚<strong>ä»¥ # å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šã€‚</strong></p>
<p>åŠ¨ä½œå’ŒæœåŠ¡ä¼šéšå¼å£°æ˜ä¸€ä¸ªæ–°çš„æ®µè½ã€‚æ‰€æœ‰çš„å‘½ä»¤æˆ–é€‰é¡¹éƒ½<strong>å½’å±äºæœ€è¿‘å£°æ˜çš„æ®µè½</strong>ã€‚ç¬¬ä¸€ä¸ªæ®µè½ä¹‹å‰å‡ºç°çš„å‘½ä»¤æˆ–é€‰é¡¹å°†è¢«å¿½ç•¥ã€‚</p>
<p><strong>æœåŠ¡å…·æœ‰å”¯ä¸€çš„åç§°</strong>ã€‚å¦‚æœå®šä¹‰äº†ç¬¬äºŒä¸ªä¸ç°æœ‰æœåŠ¡åŒåçš„æœåŠ¡ï¼Œå®ƒå°†è¢«å¿½ç•¥å¹¶è®°å½•ä¸€æ¡é”™è¯¯ä¿¡æ¯ã€‚</p>
<blockquote>
<p>å¯ä»¥ä½¿ç”¨ <code>${property.name}</code> è¯­æ³•ä½¿ç”¨ç³»ç»Ÿå±æ€§ã€‚ä¾‹å¦‚ <code>import /init.recovery.${ro.hardware}.rc</code>ã€‚</p>
</blockquote>
<h2 data-id="heading-1">Init.rc æ–‡ä»¶</h2>
<p>Init è¯­è¨€ä½¿ç”¨ä»¥ <code>.rc</code> ä¸ºæ‰©å±•åçš„çº¯æ–‡æœ¬æ–‡ä»¶ã€‚ç³»ç»Ÿä¸­é€šå¸¸å­˜åœ¨å¤šä¸ªæ­¤ç±»æ–‡ä»¶ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„ä½ç½®ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒè·¯å¾„ä¸åŠ è½½æœºåˆ¶</h3>
<ul>
<li><code>/init.rc</code>ï¼šä¸»è¦çš„é…ç½®æ–‡ä»¶ï¼Œç”± Init å¯æ‰§è¡Œæ–‡ä»¶åœ¨å¯åŠ¨åˆæœŸé¦–å…ˆåŠ è½½ï¼Œè´Ÿè´£ç³»ç»Ÿçš„åˆå§‹è®¾ç½®</li>
<li><code>First Stage Mount</code> ï¼šæ”¯æŒ<code>First Stage Mount</code>çš„è®¾å¤‡ï¼Œåœ¨åŠ è½½å®Œä¸» <code>/init.rc</code> åï¼Œä¼š<strong>ç«‹å³åŠ è½½</strong><code>/system</code>ã€<code>/vendor</code>ã€ <code>/odm</code> ä¸‹ <code>etc/init/</code> ç›®å½•å†…çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li>
<li>æ—§ç‰ˆè®¾å¤‡ï¼šä¸å…·å¤‡<code>First Stage Mount</code>æœºåˆ¶çš„è®¾å¤‡é€»è¾‘ï¼š
<ul>
<li><code>/init.rc</code> å¯¼å…¥ <code>/init.${ro.hardware}.rc</code>ï¼ˆå‚å•†æä¾›çš„ä¸»é…ç½®æ–‡ä»¶ï¼‰</li>
<li>åœ¨æ‰§è¡Œ <code>mount_all</code> å‘½ä»¤æœŸé—´ï¼ŒInit ä¼šåŠ è½½ <code>/{system,vendor,odm}/etc/init/</code> ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚è¿™äº›ç›®å½•ç”¨äºå­˜æ”¾æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åæ‰€éœ€çš„åŠ¨ä½œå’ŒæœåŠ¡</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">ç›®å½•è®¾è®¡æ„å›¾</h3>
<p>ä¸ºäº†å®ç°æ¨¡å—åŒ–ï¼Œä¸åŒåˆ†åŒºçš„ç›®å½•æ‰¿è½½ä¸åŒçš„èŒè´£ï¼š</p>
<ol>
<li><code>/system/etc/init/</code> ï¼šç”¨äºæ ¸å¿ƒç³»ç»Ÿé¡¹ç›®ï¼Œå¦‚ <code>SurfaceFlinger</code>ã€<code>logcatd</code> æˆ– <code>bootanim</code>ã€‚</li>
<li><code>/vendor/etc/init/</code> ï¼šç”¨äº SoC å‚å•†é¡¹ç›®ï¼Œå¦‚æ ¸å¿ƒ SoC åŠŸèƒ½æ‰€éœ€çš„åŠ¨ä½œæˆ–å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
<li><code>/odm/etc/init/</code> ï¼šç”¨äºè®¾å¤‡åˆ¶é€ å•† (ODM) é¡¹ç›®ï¼Œå¦‚è¿åŠ¨ä¼ æ„Ÿå™¨æˆ–å…¶ä»–å¤–è®¾æ‰€éœ€çš„åŠ¨ä½œæˆ–å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
</ol>
<p>æ‰€æœ‰ä½äºç³»ç»Ÿã€å‚å•†æˆ– ODM åˆ†åŒºä¸­çš„æœåŠ¡ï¼Œå…¶æ¡ç›®éƒ½æ”¾ç½®åœ¨å¯¹åº”åˆ†åŒºçš„ <code>/etc/init/</code> ç›®å½•ä¸‹çš„ <code>.rc</code> æ–‡ä»¶ä¸­ã€‚è¿™ç§åšæ³•ä¼˜äºä»¥å¾€çº¯ <code>init.rc</code>ã€‚å®ƒç¡®ä¿ Init åªè¯»å–é‚£äº›äºŒè¿›åˆ¶æ–‡ä»¶å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„æœåŠ¡æ¡ç›®ï¼ŒåŒæ—¶èƒ½æœ‰æ•ˆé¿å…å¤šæœåŠ¡åˆå¹¶æ—¶çš„ä»£ç å†²çªã€‚</p>
<blockquote>
<p>å¼€å‘è€…å¯ä»¥ä½¿ç”¨ <code>LOCAL_INIT_RC</code> å®æŒ‡å®šå¯¹åº”rcæ–‡ä»¶ï¼Œä»¥ä¾¿ç¼–è¯‘æ—¶è‡ªåŠ¨æ”¾ç½®ã€‚</p>
</blockquote>
<h3 data-id="heading-4">mount_all çš„é«˜çº§é€‰é¡¹</h3>
<p>åœ¨ <code>mount_all</code> å‘½ä»¤ä¸­ï¼Œå¯ä»¥åœ¨è·¯å¾„åè®¾ç½® <code>--early</code> å’Œ <code>--late</code> é€‰é¡¹ï¼š</p>
<ul>
<li><code>--early</code>ï¼šInit å°†è·³è¿‡å¸¦æœ‰ <code>latemount</code> æ ‡å¿—çš„æŒ‚è½½æ¡ç›®ï¼Œå¹¶è·³è¿‡è§¦å‘æ–‡ä»¶ç³»ç»ŸåŠ å¯†çŠ¶æ€äº‹ä»¶ã€‚</li>
<li><code>--late</code>ï¼šInit ä»…æŒ‚è½½å¸¦æœ‰ <code>latemount</code> æ ‡å¿—çš„æ¡ç›®ï¼Œä½†è·³è¿‡å¯¼å…¥ <code>.rc</code> æ–‡ä»¶ã€‚</li>
<li><strong>é»˜è®¤çŠ¶æ€</strong>ï¼šè‹¥ä¸è®¾ç½®é€‰é¡¹ï¼Œ<code>mount_all</code> å°†å¤„ç†æŒ‡å®š fstab ä¸­çš„æ‰€æœ‰æ¡ç›®ã€‚</li>
</ul>
<h2 data-id="heading-5">åŠ¨ä½œ</h2>
<p>åŠ¨ä½œçš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">on &lt;è§¦å‘å™¨&gt; <span class="hljs-section">[&amp;&amp; &lt;è§¦å‘å™¨&gt;]</span>*
   &lt;å‘½ä»¤&gt;
   &lt;å‘½ä»¤&gt;
   &lt;å‘½ä»¤&gt;
</code></pre>
<p>åŠ¨ä½œè¢«æ·»åŠ åˆ°é˜Ÿåˆ—å¹¶æ‰§è¡Œçš„é¡ºåºï¼Œå–å†³äºåŒ…å«å®ƒä»¬çš„æ–‡ä»¶çš„<strong>è§£æé¡ºåº</strong>ï¼Œåœ¨å•ä¸ªæ–‡ä»¶å†…éƒ¨åˆ™æŒ‰<strong>å…ˆåé¡ºåº</strong>æ‰§è¡Œã€‚</p>
<p><code>init.rc</code> ä¸­çš„ç¤ºä¾‹</p>
<pre><code class="hljs language-ini" lang="ini">on early-init
    <span class="hljs-comment"># ......</span>
    <span class="hljs-comment"># do-something</span>

on init
    <span class="hljs-comment"># .......</span>
    <span class="hljs-comment"># do-something</span>

<span class="hljs-comment"># Healthd can trigger a full boot from charger mode by signaling this</span>
<span class="hljs-comment"># property when the power button is held.</span>
on property:<span class="hljs-attr">sys.boot_from_charger_mode</span>=<span class="hljs-number">1</span>
    trigger late-init
    <span class="hljs-comment"># .......</span>
    <span class="hljs-comment"># do-something</span>

on load_persist_props_action
    start logd
    start logd-reinit
    <span class="hljs-comment"># .......</span>
    <span class="hljs-comment"># do-something</span>

<span class="hljs-comment"># Indicate to fw loaders that the relevant mounts are up.</span>
on firmware_mounts_complete
    rm /dev/.booting

<span class="hljs-comment"># Mount filesystems and start core system services.</span>
on late-init
    trigger early-fs

    <span class="hljs-comment"># Mount fstab in init.{$device}.rc by mount_all command. Optional parameter</span>
    <span class="hljs-comment"># '--early' can be specified to skip entries with 'latemount'.</span>
    <span class="hljs-comment"># /system and /vendor must be mounted by the end of the fs stage,</span>
    <span class="hljs-comment"># while /data is optional.</span>
    trigger fs
    trigger post-fs

    <span class="hljs-comment"># Mount fstab in init.{$device}.rc by mount_all with '--late' parameter</span>
    <span class="hljs-comment"># to only mount entries with 'latemount'. This is needed if '--early' is</span>
    <span class="hljs-comment"># specified in the previous mount_all command on the fs stage.</span>
    <span class="hljs-comment"># With /system mounted and properties form /system + /factory available,</span>
    <span class="hljs-comment"># some services can be started.</span>
    trigger late-fs

    <span class="hljs-comment"># Now we can mount /data. File encryption requires keymaster to decrypt</span>
    <span class="hljs-comment"># /data, which in turn can only be loaded when system properties are present.</span>
    trigger post-fs-data

    <span class="hljs-comment"># Now we can start zygote for devices with file based encryption</span>
    trigger zygote-start

    <span class="hljs-comment"># Load persist properties and override properties (if enabled) from /data.</span>
    trigger load_persist_props_action

    <span class="hljs-comment"># Remove a file to wake up anything waiting for firmware.</span>
    trigger firmware_mounts_complete

    trigger early-boot
    trigger boot

on post-fs
    <span class="hljs-comment"># Load properties from</span>
    <span class="hljs-comment">#     /system/build.prop,</span>
    <span class="hljs-comment">#     /odm/build.prop,</span>
    <span class="hljs-comment">#     /vendor/build.prop and</span>
    <span class="hljs-comment">#     /factory/factory.prop</span>
    load_system_props
    <span class="hljs-comment"># start essential services</span>
    start logd
    start servicemanager
    start hwservicemanager
    start vndservicemanager

    <span class="hljs-comment"># create the lost+found directories, so as to enforce our permissions</span>
    mkdir /cache/lost+found 0770 root root

    <span class="hljs-comment"># ......</span>
    <span class="hljs-comment"># do-something</span>
    
on late-fs
    <span class="hljs-comment"># ......</span>
    <span class="hljs-comment"># do-something</span>

on post-fs-data
    <span class="hljs-comment"># ......</span>
    <span class="hljs-comment"># do-something</span>
    
<span class="hljs-comment"># It is recommended to put unnecessary data/ initialization from post-fs-data</span>
<span class="hljs-comment"># to start-zygote in device's init.rc to unblock zygote start.</span>
on zygote-start &amp;&amp; property:<span class="hljs-attr">ro.crypto.state</span>=unencrypted
    <span class="hljs-comment"># A/B update verifier that marks a successful boot.</span>
    exec_start update_verifier_nonencrypted
    start netd
    start zygote
    start zygote_secondary

on zygote-start &amp;&amp; property:<span class="hljs-attr">ro.crypto.state</span>=unsupported
    <span class="hljs-comment"># A/B update verifier that marks a successful boot.</span>
    exec_start update_verifier_nonencrypted
    start netd
    start zygote
    start zygote_secondary

on zygote-start &amp;&amp; property:<span class="hljs-attr">ro.crypto.state</span>=encrypted &amp;&amp; property:ro.crypto.type=file
    <span class="hljs-comment"># A/B update verifier that marks a successful boot.</span>
    exec_start update_verifier_nonencrypted
    start netd
    start zygote
    start zygote_secondary

on boot
    <span class="hljs-comment"># basic network init</span>
    ifup lo
    hostname localhost
    domainname localdomain

    <span class="hljs-comment"># ......</span>
    <span class="hljs-comment"># do-something</span>

on nonencrypted
    class_start main
    class_start late_start

on property:<span class="hljs-attr">sys.init_log_level</span>=*
    loglevel ${sys.init_log_level}

on charger
    class_start charger

on property:<span class="hljs-attr">vold.decrypt</span>=trigger_reset_main
    class_reset main

on property:<span class="hljs-attr">vold.decrypt</span>=trigger_load_persist_props
    load_persist_props
    start logd
    start logd-reinit

on property:<span class="hljs-attr">vold.decrypt</span>=trigger_post_fs_data
    trigger post-fs-data

on property:<span class="hljs-attr">vold.decrypt</span>=trigger_restart_min_framework
    <span class="hljs-comment"># A/B update verifier that marks a successful boot.</span>
    exec_start update_verifier
    class_start main

on property:<span class="hljs-attr">vold.decrypt</span>=trigger_restart_framework
    <span class="hljs-comment"># A/B update verifier that marks a successful boot.</span>
    exec_start update_verifier
    class_start main
    class_start late_start

on property:<span class="hljs-attr">vold.decrypt</span>=trigger_shutdown_framework
    class_reset late_start
    class_reset main

on property:<span class="hljs-attr">sys.boot_completed</span>=<span class="hljs-number">1</span>
    bootchart stop

<span class="hljs-comment"># system server cannot write to /proc/sys files,</span>
<span class="hljs-comment"># and chown/chmod does not work for /proc/sys/ entries.</span>
<span class="hljs-comment"># So proxy writes through init.</span>
on property:<span class="hljs-attr">sys.sysctl.extra_free_kbytes</span>=*
    write /proc/sys/vm/extra_free_kbytes ${sys.sysctl.extra_free_kbytes}

<span class="hljs-comment"># "tcp_default_init_rwnd" Is too long!</span>
on property:<span class="hljs-attr">sys.sysctl.tcp_def_init_rwnd</span>=*
    write /proc/sys/net/ipv4/tcp_default_init_rwnd ${sys.sysctl.tcp_def_init_rwnd}

on property:<span class="hljs-attr">security.perf_harden</span>=<span class="hljs-number">0</span>
    write /proc/sys/kernel/perf_event_paranoid 1

on property:<span class="hljs-attr">security.perf_harden</span>=<span class="hljs-number">1</span>
    write /proc/sys/kernel/perf_event_paranoid 3

on property:<span class="hljs-attr">ro.debuggable</span>=<span class="hljs-number">1</span>
    <span class="hljs-comment"># Give writes to anyone for the trace folder on debug builds.</span>
    <span class="hljs-comment"># The folder is used to store method traces.</span>
    chmod 0773 /data/misc/trace
    start console
</code></pre>
<h3 data-id="heading-6">è§¦å‘å™¨</h3>
<p><strong>è§¦å‘å™¨</strong>æ˜¯ç”¨äºåŒ¹é…ç‰¹å®šç±»å‹äº‹ä»¶çš„å­—ç¬¦ä¸²ï¼Œç”¨äºå¼•å‘â€œåŠ¨ä½œ (Action)â€çš„å‘ç”Ÿã€‚</p>
<p>è§¦å‘å™¨åˆ†ä¸º<strong>äº‹ä»¶è§¦å‘å™¨ (Event triggers)</strong> å’Œ <strong>å±æ€§è§¦å‘å™¨ (Property triggers)</strong> ã€‚</p>
<ul>
<li><strong>äº‹ä»¶è§¦å‘å™¨</strong>ï¼šç”± <code>trigger</code> å‘½ä»¤æˆ– Init å¯æ‰§è¡Œæ–‡ä»¶å†…éƒ¨çš„ <code>QueueEventTrigger()</code> å‡½æ•°è§¦å‘ã€‚</li>
<li><strong>å±æ€§è§¦å‘å™¨</strong>ï¼šå½“æŒ‡å®šçš„å±æ€§æ›´æ”¹ä¸ºç‰¹å®šå€¼æˆ–æ›´æ”¹ä¸ºä»»ä½•æ–°å€¼æ—¶è§¦å‘ã€‚å…¶å½¢å¼åˆ†åˆ«ä¸º <code>property:&lt;åç§°&gt;=&lt;å€¼&gt;</code> å’Œ <code>property:&lt;åç§°&gt;=*</code>ã€‚</li>
</ul>
<p>ä¸€ä¸ªåŠ¨ä½œå¯ä»¥æ‹¥æœ‰<strong>å¤šä¸ªå±æ€§è§¦å‘å™¨</strong>ï¼Œä½†åªèƒ½æ‹¥æœ‰<strong>ä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨</strong>ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p><code>on boot &amp;&amp; property:a=b</code></p>
<blockquote>
<p>ä»…åœ¨ <code>boot</code> äº‹ä»¶å‘ç”Ÿ<strong>ä¸”</strong>å±æ€§ <code>a</code> ç­‰äº <code>b</code> æ—¶æ‰æ‰§è¡Œçš„åŠ¨ä½œã€‚</p>
</blockquote>
<p><code>on property:a=b &amp;&amp; property:c=d</code></p>
<blockquote>
<p>å®šä¹‰äº†ä¸€ä¸ªåœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹éƒ½ä¼šæ‰§è¡Œçš„åŠ¨ä½œï¼š</p>
<ol>
<li>åœ¨<strong>åˆå§‹å¯åŠ¨é˜¶æ®µ</strong>ï¼Œå¦‚æœæ­¤æ—¶å±æ€§ <code>a=b</code> ä¸” <code>c=d</code>ã€‚</li>
<li>å½“å±æ€§ <code>c</code> å·²ç»ç­‰äº <code>d</code>ï¼Œè€Œå±æ€§ <code>a</code> <strong>åˆ‡æ¢</strong>åˆ°å€¼ <code>b</code> çš„ä»»ä½•æ—¶åˆ»ã€‚</li>
<li>å½“å±æ€§ <code>a</code> å·²ç»ç­‰äº <code>b</code>ï¼Œè€Œå±æ€§ <code>c</code> <strong>åˆ‡æ¢</strong>åˆ°å€¼ <code>d</code> çš„ä»»ä½•æ—¶åˆ»ã€‚</li>
</ol>
</blockquote>
<h3 data-id="heading-7">å‘½ä»¤</h3>
<p><code>bootchart [start|stop]</code></p>
<blockquote>
<p>å¯åŠ¨æˆ–åœæ­¢ bootchartï¼ˆæ€§èƒ½åˆ†æå·¥å…·ï¼‰ã€‚é»˜è®¤çš„ <code>init.rc</code> ä¸­åŒ…å«æ­¤å‘½ä»¤ï¼Œä½†ä»…å½“ <code>/data/bootchart/enabled</code> æ–‡ä»¶å­˜åœ¨æ—¶æ‰æœ‰æ•ˆï¼Œå¦åˆ™è¯¥å‘½ä»¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p>
</blockquote>
<p><code>chmod &lt;å…«è¿›åˆ¶æ¨¡å¼&gt; &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>ä¿®æ”¹æ–‡ä»¶è®¿é—®æƒé™ã€‚</p>
</blockquote>
<p><code>chown &lt;æ‰€æœ‰è€…&gt; &lt;ç»„&gt; &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>ä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„ã€‚</p>
</blockquote>
<p><code>class_start &lt;æœåŠ¡ç±»&gt;</code></p>
<blockquote>
<p>å¯åŠ¨æŒ‡å®šç±»åˆ«çš„æ‰€æœ‰æœåŠ¡ï¼ˆå¦‚æœå®ƒä»¬å°šæœªè¿è¡Œï¼‰ã€‚</p>
</blockquote>
<p><code>class_stop &lt;æœåŠ¡ç±»&gt;</code></p>
<blockquote>
<p>åœæ­¢å¹¶ç¦ç”¨æŒ‡å®šç±»åˆ«çš„æ‰€æœ‰æœåŠ¡ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰ã€‚</p>
</blockquote>
<p><code>class_reset &lt;æœåŠ¡ç±»&gt;</code></p>
<blockquote>
<p>åœæ­¢æŒ‡å®šç±»åˆ«çš„æ‰€æœ‰æœåŠ¡ï¼Œä½†ä¸ç¦ç”¨ï¼Œç¨åå¯ä»¥é€šè¿‡ <code>class_start</code> é‡æ–°å¯åŠ¨ã€‚</p>
</blockquote>
<p><code>class_restart &lt;æœåŠ¡ç±»&gt;</code></p>
<blockquote>
<p>é‡å¯æŒ‡å®šç±»åˆ«çš„æ‰€æœ‰æœåŠ¡ã€‚</p>
</blockquote>
<p><code>copy &lt;æºè·¯å¾„&gt; &lt;ç›®æ ‡è·¯å¾„&gt;</code></p>
<blockquote>
<p>å¤åˆ¶æ–‡ä»¶ã€‚ç±»ä¼¼äº <code>write</code>ï¼Œä½†é€‚ç”¨äºäºŒè¿›åˆ¶æˆ–å¤§æ•°æ®é‡ã€‚ä¸æ”¯æŒä»è½¯é“¾æ¥æˆ–å…¨ç”¨æˆ·å¯å†™/ç»„å¯å†™çš„æ–‡ä»¶å¤åˆ¶ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé»˜è®¤åˆ›å»ºæƒé™ä¸º 0600ï¼›å¦‚æœå·²å­˜åœ¨åˆ™ä¼šè¢«æˆªæ–­ã€‚</p>
</blockquote>
<p><code>domainname &lt;åç§°&gt;</code></p>
<blockquote>
<p>è®¾ç½®åŸŸåã€‚</p>
</blockquote>
<p><code>enable &lt;æœåŠ¡å&gt;</code></p>
<blockquote>
<p>å°†ä¸€ä¸ªåŸæœ¬è®¾ç½®ä¸º <code>disabled</code> çš„æœåŠ¡æ”¹ä¸ºå¯ç”¨çŠ¶æ€ã€‚å¦‚æœè¯¥æœåŠ¡æœ¬è¯¥è¿è¡Œï¼Œåˆ™ä¼šç«‹å³å¯åŠ¨ã€‚</p>
</blockquote>
<p><code>exec [ &lt;å®‰å…¨ä¸Šä¸‹æ–‡&gt; [ &lt;ç”¨æˆ·&gt; [ &lt;ç»„&gt;* ] ] ] -- &lt;å‘½ä»¤&gt; [ &lt;å‚æ•°&gt;* ]</code></p>
<blockquote>
<p>Fork å¹¶æ‰§è¡Œå¸¦å‚æ•°çš„å‘½ä»¤ã€‚å‘½ä»¤å†™åœ¨ <code>--</code> ä¹‹åï¼Œä»¥ä¾¿åŒºåˆ†å¯é€‰çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€ç”¨æˆ·å’Œè¡¥å……ç»„ã€‚åœ¨å‘½ä»¤æ‰§è¡Œå®Œæˆä¹‹å‰ï¼ŒInit ä¼š<strong>æš‚åœæ‰§è¡Œ</strong>åç»­å‘½ä»¤ã€‚å‚æ•°ä¸­æ”¯æŒå±æ€§æ‰©å±•ã€‚</p>
</blockquote>
<p><code>exec_start &lt;æœåŠ¡&gt;</code></p>
<blockquote>
<p>å¯åŠ¨ç»™å®šæœåŠ¡ï¼Œå¹¶<strong>æš‚åœæ‰§è¡Œ</strong>åç»­å‘½ä»¤ç›´åˆ°è¯¥æœåŠ¡è¿”å›ã€‚é€»è¾‘ç±»ä¼¼äº <code>exec</code>ï¼Œä½†éœ€è¦ä½¿ç”¨å·²æœ‰çš„æœåŠ¡ã€‚</p>
</blockquote>
<p><code>export &lt;åç§°&gt; &lt;å€¼&gt;</code></p>
<blockquote>
<p>åœ¨å…¨å±€ç¯å¢ƒå˜é‡ä¸­è®¾ç½®å˜é‡ <code>&lt;åç§°&gt;</code> çš„å€¼ä¸º <code>&lt;å€¼&gt;</code>ã€‚</p>
</blockquote>
<p><code>hostname &lt;åç§°&gt;</code></p>
<blockquote>
<p>è®¾ç½®ä¸»æœºåã€‚</p>
</blockquote>
<p><code>ifup &lt;æ¥å£&gt;</code></p>
<blockquote>
<p>å¯åŠ¨æŒ‡å®šçš„ç½‘ç»œæ¥å£ï¼ˆä½¿å…¶ä¸Šçº¿ï¼‰ã€‚</p>
</blockquote>
<p><code>insmod [-f] &lt;è·¯å¾„&gt; [&lt;é€‰é¡¹&gt;]</code></p>
<blockquote>
<p>å®‰è£…æŒ‡å®šè·¯å¾„çš„å†…æ ¸æ¨¡å—ã€‚<code>-f</code> è¡¨ç¤ºå¼ºåˆ¶å®‰è£…ï¼Œå³ä½¿å†…æ ¸ç‰ˆæœ¬ä¸åŒ¹é…ã€‚</p>
</blockquote>
<p><code>load_all_props</code></p>
<blockquote>
<p>ä» <code>/system</code>ã€<code>/vendor</code> ç­‰ç›®å½•åŠ è½½å±æ€§ã€‚</p>
</blockquote>
<p><code>load_persist_props</code></p>
<blockquote>
<p>å½“ <code>/data</code> åˆ†åŒºè§£å¯†ååŠ è½½æŒä¹…åŒ–å±æ€§ï¼ˆPersistent Propertiesï¼‰ã€‚</p>
</blockquote>
<p><code>loglevel &lt;çº§åˆ«&gt;</code></p>
<blockquote>
<p>è®¾ç½®å†…æ ¸æ—¥å¿—çº§åˆ«ã€‚</p>
</blockquote>
<p><code>mkdir &lt;è·¯å¾„&gt; [æ¨¡å¼] [æ‰€æœ‰è€…] [ç»„]</code></p>
<blockquote>
<p>åˆ›å»ºç›®å½•ã€‚å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œåˆ™ä¼šæ›´æ–°å…¶æ¨¡å¼ã€æ‰€æœ‰è€…å’Œç»„ã€‚é»˜è®¤æƒé™ä¸º 755ã€‚</p>
</blockquote>
<p><code>mount_all &lt;fstab&gt; [ &lt;è·¯å¾„&gt; ]* [--&lt;é€‰é¡¹&gt;]</code></p>
<blockquote>
<p>æ ¹æ® fstab æ–‡ä»¶æŒ‚è½½æ‰€æœ‰åˆ†åŒºï¼Œå¹¶å¯¼å…¥æŒ‡å®šè·¯å¾„ä¸‹çš„ <code>.rc</code> æ–‡ä»¶ã€‚</p>
</blockquote>
<p><code>mount &lt;ç±»å‹&gt; &lt;è®¾å¤‡&gt; &lt;ç›®å½•&gt; [ &lt;æ ‡å¿—&gt;* ] [&lt;é€‰é¡¹&gt;]</code></p>
<blockquote>
<p>å°è¯•å°†è®¾å¤‡æŒ‚è½½åˆ°æŒ‡å®šç›®å½•ã€‚æ ‡å¿—åŒ…æ‹¬ <code>ro</code>, <code>rw</code>, <code>remount</code> ç­‰ï¼›é€‰é¡¹ä»¥é€—å·åˆ†éš”ï¼Œå¦‚ <code>barrier=1</code>ã€‚</p>
</blockquote>
<p><code>restart &lt;æœåŠ¡&gt;</code></p>
<blockquote>
<p>åœæ­¢å¹¶é‡å¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æœåŠ¡ã€‚å¦‚æœæœåŠ¡æ­£åœ¨é‡å¯ä¸­åˆ™ä¸æ“ä½œã€‚</p>
</blockquote>
<p><code>restorecon &lt;è·¯å¾„&gt; [ &lt;è·¯å¾„&gt;* ]</code></p>
<blockquote>
<p>å°†æŒ‡å®šè·¯å¾„çš„å®‰å…¨ä¸Šä¸‹æ–‡æ¢å¤åˆ° <code>file_contexts</code> é…ç½®ä¸­çš„å®šä¹‰ã€‚</p>
</blockquote>
<p><code>restorecon_recursive &lt;è·¯å¾„&gt; [ &lt;è·¯å¾„&gt;* ]</code></p>
<blockquote>
<p>é€’å½’åœ°æ¢å¤æŒ‡å®šç›®å½•æ ‘çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚</p>
</blockquote>
<p><code>rm &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>åˆ é™¤æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ï¼ˆè°ƒç”¨ <code>unlink</code>ï¼‰ã€‚</p>
</blockquote>
<p><code>rmdir &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>åˆ é™¤æŒ‡å®šè·¯å¾„çš„ç›®å½•ã€‚</p>
</blockquote>
<p><code>setprop &lt;åç§°&gt; &lt;å€¼&gt;</code></p>
<blockquote>
<p>è®¾ç½®ç³»ç»Ÿå±æ€§ã€‚</p>
</blockquote>
<p><code>setrlimit &lt;èµ„æº&gt; &lt;å½“å‰å€¼&gt; &lt;æœ€å¤§å€¼&gt;</code></p>
<blockquote>
<p>è®¾ç½®èµ„æºçš„ rlimitï¼ˆèµ„æºé™åˆ¶ï¼‰ã€‚</p>
</blockquote>
<p><code>start &lt;æœåŠ¡&gt;</code></p>
<blockquote>
<p>å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼ˆå¦‚æœå®ƒå°šæœªè¿è¡Œï¼‰ã€‚æ³¨æ„ï¼šè¿™æ˜¯<strong>å¼‚æ­¥</strong>çš„ï¼ŒInit ä¸ä¼šç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆå°±ç»§ç»­æ‰§è¡Œåç»­å‘½ä»¤ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> è¿™æ„å‘³ç€å³ä½¿ä½ å…ˆ <code>start</code> äº† A æœåŠ¡å†å¯åŠ¨ B æœåŠ¡ï¼Œä¹Ÿä¸èƒ½ä¿è¯ A çš„é€šä¿¡é€šé“åœ¨ B å°è¯•è®¿é—®æ—¶å·²ç»å°±ç»ªã€‚</p>
</blockquote>
</blockquote>
<p><code>stop &lt;æœåŠ¡&gt;</code></p>
<blockquote>
<p>åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æœåŠ¡ã€‚</p>
</blockquote>
<p><code>swapon_all &lt;fstab&gt;</code></p>
<blockquote>
<p>å¯¹ç»™å®šçš„ fstab æ–‡ä»¶è°ƒç”¨ <code>fs_mgr_swapon_all</code>ã€‚</p>
</blockquote>
<p><code>symlink &lt;ç›®æ ‡&gt; &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>åœ¨ <code>&lt;è·¯å¾„&gt;</code> å¤„åˆ›å»ºä¸€ä¸ªæŒ‡å‘ <code>&lt;ç›®æ ‡&gt;</code> çš„ç¬¦å·é“¾æ¥ã€‚</p>
</blockquote>
<p><code>sysclktz &lt;æ ¼æ—å¨æ²»åç§»åˆ†é’Ÿæ•°&gt;</code></p>
<blockquote>
<p>è®¾ç½®ç³»ç»Ÿæ—¶åŒºåŸºå‡†ã€‚</p>
</blockquote>
<p><code>trigger &lt;äº‹ä»¶&gt;</code></p>
<blockquote>
<p>è§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚ç”¨äºä»ä¸€ä¸ªåŠ¨ä½œä¸­å°†å¦ä¸€ä¸ªåŠ¨ä½œæ’å…¥æ‰§è¡Œé˜Ÿåˆ—ã€‚</p>
</blockquote>
<p><code>umount &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>å¸è½½è¯¥è·¯å¾„çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
</blockquote>
<p><code>verity_load_state</code> / <code>verity_update_state</code></p>
<blockquote>
<p>ç”¨äºåŠ è½½å’Œæ›´æ–° dm-verity çŠ¶æ€çš„å†…éƒ¨å®ç°ç»†èŠ‚ã€‚</p>
</blockquote>
<p><code>wait &lt;è·¯å¾„&gt; [ &lt;è¶…æ—¶æ—¶é—´&gt; ]</code></p>
<blockquote>
<p>è½®è¯¢ç­‰å¾…æŸä¸ªæ–‡ä»¶å‡ºç°ã€‚é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 5 ç§’ã€‚</p>
</blockquote>
<p><code>wait_for_prop &lt;åç§°&gt; &lt;value&gt;</code></p>
<blockquote>
<p>ç­‰å¾…ç³»ç»Ÿå±æ€§è¾¾åˆ°æŒ‡å®šå€¼ã€‚å¦‚æœå·²æ»¡è¶³æ¡ä»¶åˆ™ç«‹å³ç»§ç»­ã€‚</p>
</blockquote>
<p><code>write &lt;path&gt; &lt;content&gt;</code></p>
<blockquote>
<p>æ‰“å¼€æ–‡ä»¶å¹¶å†™å…¥å­—ç¬¦ä¸²ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™æˆªæ–­ã€‚</p>
</blockquote>
<h2 data-id="heading-8">æœåŠ¡</h2>
<p><strong>æœåŠ¡</strong>æ˜¯ Init è¿›ç¨‹å¯åŠ¨çš„<strong>ç¨‹åº</strong>ï¼Œå¹¶ä¸”åœ¨å®ƒä»¬é€€å‡ºæ—¶ç”± Init é‡å¯ï¼ˆå¯é€‰ï¼‰ã€‚æœåŠ¡çš„å®šä¹‰å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml">service <span class="hljs-tag">&lt;<span class="hljs-name">åç§°</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">è·¯å¾„å</span>&gt;</span> [ <span class="hljs-tag">&lt;<span class="hljs-name">å‚æ•°</span>&gt;</span> ]*
   <span class="hljs-tag">&lt;<span class="hljs-name">é€‰é¡¹</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">é€‰é¡¹</span>&gt;</span>
   ...
</code></pre>
<h3 data-id="heading-9">é€‰é¡¹</h3>
<p>é€‰é¡¹æ˜¯æœåŠ¡çš„ä¿®é¥°ç¬¦ï¼Œå®ƒä»¬å½±å“ Init è¿›ç¨‹è¿è¡ŒæœåŠ¡çš„æ–¹å¼å’Œæ—¶æœºã€‚</p>
<p><code>console [&lt;console&gt;]</code></p>
<blockquote>
<p>è¯¥æœåŠ¡éœ€è¦ä¸€ä¸ªæ§åˆ¶å°ã€‚å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæŒ‡å®šç‰¹å®šçš„æ§åˆ¶å°ï¼Œè€Œéé»˜è®¤å€¼ã€‚é»˜è®¤çš„ <code>/dev/console</code> å¯ä»¥é€šè¿‡è®¾ç½®å†…æ ¸å‚æ•° <code>androidboot.console</code> æ¥æ›´æ”¹ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œéƒ½åº”çœç•¥å¼€å¤´çš„ <code>/dev/</code>ï¼Œä¾‹å¦‚ <code>/dev/tty0</code> åº”å†™ä¸º <code>console tty0</code>ã€‚</p>
</blockquote>
<p><code>critical</code></p>
<blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªè®¾å¤‡å…³é”®å‹ (device-critical) æœåŠ¡ã€‚å¦‚æœåœ¨ 4 åˆ†é’Ÿå†…é€€å‡ºè¶…è¿‡ 4 æ¬¡ï¼Œè®¾å¤‡å°†é‡å¯å¹¶è¿›å…¥æ¢å¤æ¨¡å¼ (recovery mode)ã€‚</p>
</blockquote>
<p><code>disabled</code></p>
<blockquote>
<p>è¯¥æœåŠ¡ä¸ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œå¿…é¡»<strong>é€šè¿‡æœåŠ¡åç§°æ˜¾å¼å¯åŠ¨</strong>ã€‚</p>
</blockquote>
<p><code>setenv &lt;name&gt; &lt;value&gt;</code></p>
<blockquote>
<p>åœ¨å¯åŠ¨çš„è¿›ç¨‹ä¸­ï¼Œå°†ç¯å¢ƒå˜é‡ <code>&lt;name&gt;</code> è®¾ç½®ä¸º <code>&lt;value&gt;</code>ã€‚</p>
</blockquote>
<p><code>socket &lt;name&gt; &lt;type&gt; &lt;perm&gt; [ &lt;user&gt; [ &lt;group&gt; [ &lt;seclabel&gt; ] ] ]</code></p>
<blockquote>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>/dev/socket/&lt;name&gt;</code> çš„ Unix åŸŸå¥—æ¥å­—ï¼Œå¹¶å°†è¯¥æ–‡ä»¶æè¿°ç¬¦ (fd) ä¼ é€’ç»™å¯åŠ¨çš„è¿›ç¨‹ã€‚<code>&lt;type&gt;</code> å¿…é¡»æ˜¯ <code>dgram</code>ã€<code>stream</code> æˆ– <code>seqpacket</code>ã€‚ç”¨æˆ·å’Œç»„é»˜è®¤ä¸º 0ã€‚<code>seclabel</code> æ˜¯è¯¥å¥—æ¥å­—çš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œé»˜è®¤ä½¿ç”¨æœåŠ¡çš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚</p>
</blockquote>
<p><code>file &lt;path&gt; &lt;type&gt;</code></p>
<blockquote>
<p>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å¹¶å°†æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å¯åŠ¨çš„è¿›ç¨‹ã€‚<code>&lt;type&gt;</code> å¿…é¡»ä¸º <code>r</code> (è¯»)ã€<code>w</code> (å†™) æˆ– <code>rw</code> (è¯»å†™)ã€‚</p>
</blockquote>
<p><code>user &lt;username&gt;</code></p>
<blockquote>
<p>åœ¨æ‰§è¡Œè¯¥æœåŠ¡å‰åˆ‡æ¢ç”¨æˆ·åä¸º <code>&lt;username&gt;</code>ã€‚ç›®å‰é»˜è®¤ä¸º <code>root</code>ï¼ˆå¯èƒ½åº”è¯¥é»˜è®¤ä¸º <code>nobody</code>ï¼‰ã€‚è‡ª Android M èµ·ï¼Œå³ä½¿è¿›ç¨‹éœ€è¦ Linux èƒ½åŠ› (capabilities)ï¼Œä¹Ÿåº”ä½¿ç”¨æ­¤é€‰é¡¹ã€‚ç°åœ¨å¯ä»¥é€šè¿‡ <code>fs_config</code> æœºåˆ¶åœ¨æ–‡ä»¶ç³»ç»Ÿå±‚é¢ä¸ºç‰¹å®šäºŒè¿›åˆ¶æ–‡ä»¶åˆ†é…èƒ½åŠ›ã€‚è‡ª Android O èµ·ï¼Œè¿›ç¨‹ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ <code>.rc</code> æ–‡ä»¶ä¸­è¯·æ±‚èƒ½åŠ›ï¼ˆè§ä¸‹æ–‡ <code>capabilities</code> é€‰é¡¹ï¼‰ã€‚</p>
</blockquote>
<p><code>group &lt;groupname&gt; [ &lt;groupname&gt;* ]</code></p>
<blockquote>
<p>åœ¨æ‰§è¡Œè¯¥æœåŠ¡å‰åˆ‡æ¢ç»„åä¸º <code>&lt;groupname&gt;</code>ã€‚ç¬¬ä¸€ä¸ªç»„åï¼ˆå¿…å¡«ï¼‰ä¹‹åçš„å…¶ä»–ç»„åç”¨äºè®¾ç½®è¿›ç¨‹çš„è¡¥å……ç»„ï¼ˆé€šè¿‡ <code>setgroups()</code>ï¼‰ã€‚ç›®å‰é»˜è®¤ä¸º <code>root</code>ã€‚</p>
</blockquote>
<p><code>capabilities &lt;capability&gt; [ &lt;capability&gt;* ]</code></p>
<blockquote>
<p>åœ¨æ‰§è¡Œè¯¥æœåŠ¡æ—¶è®¾ç½® Linux èƒ½åŠ›ã€‚<code>&lt;capability&gt;</code> ä¸åº”åŒ…å« <code>CAP_</code> å‰ç¼€ï¼Œä¾‹å¦‚åº”å†™ä¸º <code>NET_ADMIN</code> è€Œä¸æ˜¯ <code>CAP_NET_ADMIN</code>ã€‚</p>
</blockquote>
<p><code>seclabel &lt;seclabel&gt;</code></p>
<blockquote>
<p>åœ¨æ‰§è¡ŒæœåŠ¡å‰åˆ‡æ¢åˆ°æŒ‡å®šçš„ SELinux å®‰å…¨ä¸Šä¸‹æ–‡ã€‚ä¸»è¦ç”¨äºä» rootfs è¿è¡Œçš„æœåŠ¡ï¼ˆå¦‚ ueventd, adbdï¼‰ã€‚ç³»ç»Ÿåˆ†åŒºä¸Šçš„æœåŠ¡é€šå¸¸ä½¿ç”¨åŸºäºæ–‡ä»¶å®‰å…¨ä¸Šä¸‹æ–‡å®šä¹‰çš„ç­–ç•¥è½¬æ¢ã€‚</p>
</blockquote>
<p><code>oneshot</code></p>
<blockquote>
<p>æœåŠ¡é€€å‡ºæ—¶ä¸è¦é‡å¯å®ƒã€‚</p>
</blockquote>
<p><code>class &lt;name&gt; [ &lt;name&gt;* ]</code></p>
<blockquote>
<p>ä¸ºæœåŠ¡æŒ‡å®šæœåŠ¡ç±»åç§°ã€‚åŒå±ä¸€ä¸ªç±»çš„æ‰€æœ‰æœåŠ¡å¯ä»¥ä¸€èµ·å¯åŠ¨æˆ–åœæ­¢ã€‚å¦‚æœæœªæŒ‡å®šï¼ŒæœåŠ¡é»˜è®¤å±äº <code>default</code> ç±»ã€‚</p>
</blockquote>
<p><code>animation class</code></p>
<blockquote>
<p><code>animation</code>ï¼ˆåŠ¨ç”»ï¼‰ç±»åº”åŒ…å«å¼€æœºåŠ¨ç”»å’Œå…³æœºåŠ¨ç”»æ‰€éœ€çš„æ‰€æœ‰æœåŠ¡ã€‚ç”±äºè¿™äº›æœåŠ¡å¯åŠ¨ææ—©ä¸”è¿è¡Œè‡³å…³æœºæœ€åé˜¶æ®µï¼Œå› æ­¤ä¸ä¿è¯èƒ½å¤Ÿè®¿é—® <code>/data</code> åˆ†åŒºã€‚è¿™äº›æœåŠ¡å¯ä»¥æ£€æŸ¥ <code>/data</code> ä¸‹çš„æ–‡ä»¶ï¼Œä½†ä¸åº”ä¿æŒæ–‡ä»¶æ‰“å¼€çŠ¶æ€ã€‚</p>
</blockquote>
<p><code>onrestart</code></p>
<blockquote>
<p>å½“æœåŠ¡é‡å¯æ—¶æ‰§è¡Œä¸€æ¡å‘½ä»¤ã€‚</p>
</blockquote>
<p><code>writepid &lt;file&gt; [ &lt;file&gt;* ]</code></p>
<blockquote>
<p>å½“å­è¿›ç¨‹ fork æ—¶ï¼Œå°†å…¶ PID å†™å…¥æŒ‡å®šæ–‡ä»¶ã€‚ä¸»è¦ç”¨äº cgroup/cpusetã€‚</p>
</blockquote>
<p><code>priority &lt;priority&gt;</code></p>
<blockquote>
<p>æœåŠ¡çš„è°ƒåº¦ä¼˜å…ˆçº§ã€‚å–å€¼èŒƒå›´ä¸º -20 åˆ° 19ï¼Œé»˜è®¤ä¸º 0ã€‚é€šè¿‡ <code>setpriority()</code> è®¾ç½®ã€‚</p>
</blockquote>
<p><code>namespace &lt;pid|mnt&gt;</code></p>
<blockquote>
<p>åœ¨ fork æœåŠ¡æ—¶è¿›å…¥æ–°çš„ PID æˆ– mount å‘½åç©ºé—´ã€‚</p>
</blockquote>
<p><code>oom_score_adjust &lt;value&gt;</code></p>
<blockquote>
<p>è®¾ç½®å­è¿›ç¨‹çš„ <code>/proc/self/oom_score_adj</code> å€¼ï¼ŒèŒƒå›´ä¸º -1000 åˆ° 1000ã€‚</p>
</blockquote>
<p><code>memcg.swappiness &lt;value&gt;</code></p>
<blockquote>
<p>è®¾ç½®å­è¿›ç¨‹çš„ <code>memory.swappiness</code> å€¼ï¼ˆä»…åœ¨æŒ‚è½½äº† memcg æ—¶æœ‰æ•ˆï¼‰ã€‚</p>
</blockquote>
<p><code>memcg.soft_limit_in_bytes &lt;value&gt;</code></p>
<blockquote>
<p>è®¾ç½®å­è¿›ç¨‹çš„ <code>memory.soft_limit_in_bytes</code>ï¼ˆå†…å­˜è½¯é™åˆ¶ï¼‰ã€‚</p>
</blockquote>
<p><code>memcg.limit_in_bytes &lt;value&gt;</code></p>
<blockquote>
<p>è®¾ç½®å­è¿›ç¨‹çš„ <code>memory.limit_in_bytes</code>ï¼ˆå†…å­˜ç¡¬é™åˆ¶ï¼‰ã€‚</p>
</blockquote>
<p><code>shutdown &lt;shutdown_behavior&gt;</code></p>
<blockquote>
<p>è®¾ç½®æœåŠ¡çš„å…³æœºè¡Œä¸ºã€‚è‹¥æœªæŒ‡å®šï¼ŒæœåŠ¡åœ¨å…³æœºæœŸé—´ä¼šè¢« <code>SIGTERM</code> å’Œ <code>SIGKILL</code> æ€æ­»ã€‚æ ‡è®°ä¸º <code>critical</code> çš„æœåŠ¡åœ¨å…³æœºè¶…æ—¶å‰ä¸ä¼šè¢«æ€æ­»ï¼›å¦‚æœå…³æœºå¼€å§‹æ—¶è¯¥æœåŠ¡æœªè¿è¡Œï¼Œåˆ™ä¼šå¯åŠ¨å®ƒã€‚</p>
</blockquote>
<h2 data-id="heading-10">å¯¼å…¥</h2>
<p>å¯ä»¥åƒå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œå°†å…¶ä»–æ–‡ä»¶å†…çš„ rc æ–‡ä»¶å¯¼å…¥åˆ°æœ¬æ–‡ä»¶</p>
<p><code>import &lt;è·¯å¾„&gt;</code></p>
<blockquote>
<p>è§£æä¸€ä¸ª Init é…ç½®æ–‡ä»¶ï¼Œæ‰©å±•å½“å‰é…ç½®ã€‚å¦‚æœ <code>&lt;è·¯å¾„&gt;</code> æ˜¯ä¸€ä¸ªç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶éƒ½å°†è¢«ä½œä¸ºé…ç½®æ–‡ä»¶è§£æã€‚å¯¼å…¥æ“ä½œ<strong>ä¸æ˜¯é€’å½’çš„</strong>ï¼ŒåµŒå¥—çš„å­ç›®å½•ä¸ä¼šè¢«è§£æã€‚</p>
</blockquote>
<p>Init ä»…åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ—¶é—´ç‚¹å¯¼å…¥ <code>.rc</code> æ–‡ä»¶ï¼š</p>
<ol>
<li><strong>åˆå§‹å¯åŠ¨é˜¶æ®µ</strong>ï¼šå¯¼å…¥ <code>/init.rc</code> æˆ–ç”±å±æ€§ <code>ro.boot.init_rc</code> æŒ‡å®šçš„è„šæœ¬ã€‚</li>
<li><strong>ç¬¬ä¸€é˜¶æ®µæŒ‚è½½ï¼ˆFirst Stage Mountï¼‰å</strong>ï¼šåœ¨å¯¼å…¥ <code>/init.rc</code> ä¹‹åï¼Œç«‹å³å¯¼å…¥ <code>/{system,vendor,odm}/etc/init/</code>ã€‚</li>
<li><strong>æ‰§è¡Œ <code>mount_all</code> æœŸé—´</strong>ï¼šå¯¼å…¥ <code>/{system,vendor,odm}/etc/init/</code> æˆ–åœ¨ <code>mount_all</code> å‘½ä»¤ä¸­æŒ‡å®šè·¯å¾„çš„ <code>.rc</code> æ–‡ä»¶ã€‚</li>
</ol>
<blockquote>
<p>ç”±äºå†å²é—ç•™åŸå› å’Œå‘åå…¼å®¹æ€§ï¼Œæ–‡ä»¶çš„å¯¼å…¥é¡ºåºæ¯”è¾ƒå¤æ‚ï¼Œä¸”å¹¶éä¸¥æ ¼ä¿è¯ã€‚</p>
</blockquote>
<p><strong>ä¿è¯å‘½ä»¤æ‰§è¡Œé¡ºåºçš„å”¯ä¸€æ­£ç¡®æ–¹æ³•æ˜¯ï¼š</strong></p>
<ol>
<li>å°†å…¶æ”¾ç½®åœ¨æ‹¥æœ‰<strong>æ›´æ—©æ‰§è¡Œè§¦å‘å™¨</strong>çš„<strong>åŠ¨ä½œ</strong>ä¸­ã€‚</li>
<li>å°†å…¶æ”¾ç½®åœ¨<strong>åŒä¸€ä¸ªæ–‡ä»¶</strong>ä¸­æ‹¥æœ‰ç›¸åŒè§¦å‘å™¨çš„<strong>åŠ¨ä½œ</strong>é‡Œï¼Œå¹¶ç¡®ä¿å®ƒåœ¨æ–‡ä»¶å‰é¢ã€‚</li>
</ol>
<p>å°½ç®¡å¦‚æ­¤ï¼Œç¬¬ä¸€é˜¶æ®µæŒ‚è½½è®¾å¤‡çš„<strong>å®é™…æ‰§è¡Œé¡ºåº</strong>é€šå¸¸å¦‚ä¸‹ï¼š</p>
<ol>
<li>è§£æ <code>/init.rc</code>ï¼Œç„¶åé€’å½’è§£æå…¶å†…éƒ¨åŒ…å«çš„æ¯ä¸ª <code>import</code>ã€‚</li>
<li>å¯¹ <code>/system/etc/init/</code> çš„å†…å®¹æŒ‰<strong>å­—æ¯é¡ºåº</strong>æ’åºå¹¶ä¾æ¬¡è§£æï¼Œæ¯ä¸ªæ–‡ä»¶è§£æåéƒ½ä¼šé€’å½’å¤„ç†å…¶å†…éƒ¨çš„å¯¼å…¥ã€‚</li>
<li>å¯¹ <code>/vendor/etc/init</code> é‡å¤æ­¥éª¤ 2ï¼Œéšåå¯¹ <code>/odm/etc/init</code> é‡å¤æ­¥éª¤ 2ã€‚</li>
</ol>
<p><code>init.rc</code>ç¤ºä¾‹</p>
<pre><code class="hljs language-ini" lang="ini">import /init.environ.rc
import /init.usb.rc
import /init.${ro.hardware}.rc
import /vendor/etc/init/hw/init.${ro.hardware}.rc
import /init.usb.configfs.rc
import /init.${ro.zygote}.rc
</code></pre>
<h2 data-id="heading-11">åº”ç”¨</h2>
<ol>
<li>å¯ä»¥åœ¨å¯åŠ¨æ—¶æŒ‚è½½æˆ‘ä»¬æ‰€éœ€çš„ç›®å½•</li>
<li>å¯ä»¥åœ¨å¯åŠ¨æ—¶å¯åŠ¨è‡ªå®šä¹‰çš„æœåŠ¡</li>
<li>å¯ä»¥åœ¨å¯åŠ¨æ—¶è®¾ç½®è‡ªå®šä¹‰çš„ç³»ç»Ÿå±æ€§</li>
<li>å¯ä»¥åœ¨å¯åŠ¨æ—¶è¿›è¡Œchmod</li>
<li>å¯ä»¥åœ¨å¯åŠ¨æ—¶è°ƒæ•´ç¡¬ä»¶çŠ¶æ€</li>
<li>å¯ä»¥åœ¨å¯åŠ¨æ—¶åˆ›å»ºè½¯ç¡¬é“¾æ¥</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ä¸ªBinderé€šä¿¡ä¸­çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜]]></title>    <link>https://juejin.cn/post/7585397173022375955</link>    <guid>https://juejin.cn/post/7585397173022375955</guid>    <pubDate>2025-12-19T13:05:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173022375955" data-draft-id="7585390679397842950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ä¸ªBinderé€šä¿¡ä¸­çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-19T13:05:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ä¸­ä¸999"/> <meta itemprop="url" content="https://juejin.cn/user/1014218592883577"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ä¸ªBinderé€šä¿¡ä¸­çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1014218592883577/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ä¸­ä¸999
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:05:08.000Z" title="Fri Dec 19 2025 13:05:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»29åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ‘˜è¦</h2>
<p>æœ¬æ–‡å°†é€šè¿‡è§£æ binder é©±åŠ¨ä»£ç æ¢ç©¶ IBinder å¯¹è±¡çš„è·¨è¿›ç¨‹ä¼ é€’å’Œè·¨è¿›ç¨‹è°ƒç”¨ IBinder å¯¹è±¡çš„æœºåˆ¶æµç¨‹ï¼Œå¹¶æ‰¾å‡º Binder IPC å‘èµ·å‡½æ•°å’Œ Binder å›è°ƒè·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œå¯¼è‡´çš„çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</p>
<h2 data-id="heading-1">é—®é¢˜: Binder IPC å‘èµ·å‡½æ•°å’Œ Binder å›è°ƒè·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œ</h2>
<p>ç¬”è€…åœ¨å®ç° nfc hal å±‚æœåŠ¡(ä½¿ç”¨ INfc.aidl) <code>android.hardware.nfc-service.example</code> (æºç è·¯å¾„ï¼šhardware/interfaces/nfc/aidl/default) çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸ªå¤šçº¿ç¨‹é—®é¢˜, é—®é¢˜ç°è±¡å¦‚ä¸‹:</p>
<p>åœ¨ NFC åŠŸèƒ½å…³é—­çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¼€æœºæ—¶æ®µ com.android.nfc ä¸­çš„ <code>NfcAdaptation::DownloadFirmware</code> ä¼šæœ‰å¡æ­»é—®é¢˜ã€‚</p>
<p>èµ°è¯»ä»£ç :<br/>
system/nfc/src/adaptation/NfcAdaptation.cc</p>
<pre><code class="hljs language-cpp" lang="cpp">ThreadCondVar NfcAdaptation::mHalOpenCompletedEvent;

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">NfcAdaptation::DownloadFirmware</span><span class="hljs-params">()</span> </span>{
    mHalOpenCompletedEvent.<span class="hljs-built_in">lock</span>();
    <span class="hljs-built_in">DLOG_IF</span>(INFO, nfc_debug_enabled) &lt;&lt; <span class="hljs-built_in">StringPrintf</span>(<span class="hljs-string">"%s: try open HAL"</span>, func);
    <span class="hljs-built_in">HalOpen</span>(HalDownloadFirmwareCallback, HalDownloadFirmwareDataCallback);
    mHalOpenCompletedEvent.<span class="hljs-built_in">wait</span>();
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">NfcAdaptation::HalDownloadFirmwareCallback</span><span class="hljs-params">(<span class="hljs-type">nfc_event_t</span> event,
                                                __attribute__((unused))
                                                <span class="hljs-type">nfc_status_t</span> event_status)</span> </span>{
    <span class="hljs-keyword">case</span> HAL_NFC_POST_INIT_CPLT_EVT:
      <span class="hljs-built_in">DLOG_IF</span>(INFO, nfc_debug_enabled)
        &lt;&lt; <span class="hljs-built_in">StringPrintf</span>(<span class="hljs-string">"%s: HAL_NFC_INIT_CPLT_EVT"</span>, func);
      <span class="hljs-keyword">if</span> (event_status == HAL_NFC_STATUS_OK) isDownloadFirmwareCompleted = <span class="hljs-literal">true</span>;
      mHalOpenCompletedEvent.<span class="hljs-built_in">signal</span>();
      <span class="hljs-keyword">break</span>;
}
</code></pre>
<p>æ­£å¸¸é€»è¾‘æ˜¯åœ¨ DownloadFirmware() ä¸­è°ƒç”¨ HalOpen() åï¼Œæ¥ç€è°ƒç”¨ <code>mHalOpenCompletedEvent.wait()</code> é˜»å¡ä½çº¿ç¨‹ï¼Œç­‰å¾… HalDownloadFirmwareCallback è°ƒç”¨ <code>mHalOpenCompletedEvent.signal()</code> å°†å…¶å”¤é†’ã€‚<br/>
é€šè¿‡ log å‘ç°ï¼ŒHalDownloadFirmwareCallback å·²ç»æœ‰è¢«è°ƒç”¨, ä½† <code>mHalOpenCompletedEvent.signal()</code> è¿˜æ˜¯æ²¡æœ‰æˆåŠŸå”¤é†’ DownloadFirmware() çš„ç­‰å¾…ã€‚</p>
<p>logå¦‚ä¸‹:</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.849</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(550)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">Initialize</span>: <span class="hljs-selector-tag">exit</span>
<span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.849</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(988)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">DownloadFirmware</span>: <span class="hljs-selector-tag">enter</span>
<span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.849</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(770)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">HalInitialize</span>
<span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.849</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(992)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">DownloadFirmware</span>: <span class="hljs-selector-tag">try</span> <span class="hljs-selector-tag">open</span> <span class="hljs-selector-tag">HAL</span>
<span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.849</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(800)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">HalOpen</span>

<span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.871</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(1023)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">HalDownloadFirmwareCallback</span>: <span class="hljs-selector-tag">event</span>=<span class="hljs-number">0</span><span class="hljs-selector-tag">x2</span>, <span class="hljs-selector-tag">event_status</span>=<span class="hljs-number">0</span><span class="hljs-selector-tag">x00</span>
<span class="hljs-number">07</span><span class="hljs-selector-tag">-07</span> <span class="hljs-number">15</span>:<span class="hljs-number">59</span>:<span class="hljs-number">28.871</span>  <span class="hljs-number">2429</span>  <span class="hljs-number">2759</span> <span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">libnfc_nci</span>: <span class="hljs-selector-attr">[INFO:NfcAdaptation.cc(1038)]</span> <span class="hljs-selector-tag">NfcAdaptation</span>::<span class="hljs-selector-tag">HalDownloadFirmwareCallback</span>: <span class="hljs-selector-tag">HAL_NFC_INIT_CPLT_EVT</span>
</code></pre>
<p>æ€€ç–‘æ˜¯ DownloadFirmware() å’Œ HalDownloadFirmwareCallback() è·‘åœ¨åœ¨åŒä¸€ä¸ªçº¿ç¨‹å¯¼è‡´çš„é—®é¢˜ï¼Œ<code>mHalOpenCompletedEvent.signal()</code> ä¸èƒ½å”¤é†’åŒä¸€çº¿ç¨‹ä¸­ <code>mHalOpenCompletedEvent.wait()</code>ã€‚</p>
<p>å…¶å®ƒæœºå™¨æ­£å¸¸æµç¨‹çš„log:</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.223</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">489</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Initialize</span>: exit
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.223</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">886</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:DownloadFirmware</span>: enter
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.223</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">677</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:HalInitialize</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.224</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">890</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:DownloadFirmware</span>: try open <span class="hljs-variable constant_">HAL</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.224</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">707</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:HalOpen</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.225</span>   <span class="hljs-number">786</span>   <span class="hljs-number">786</span> D android.hardware.nfc<span class="hljs-variable">@1</span>.<span class="hljs-number">2</span>-<span class="hljs-symbol">impl:</span> <span class="hljs-title class_">Nfc</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:open</span> <span class="hljs-title class_">Enter</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.225</span>   <span class="hljs-number">786</span>   <span class="hljs-number">786</span> D android.hardware.nfc<span class="hljs-variable">@1</span>.<span class="hljs-number">2</span>-<span class="hljs-symbol">impl:</span> <span class="hljs-title class_">Nfc</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:open</span> <span class="hljs-title class_">Exit</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.226</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8732</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">916</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:HalDownloadFirmwareCallback</span>: event=<span class="hljs-number">0x0</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.227</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8732</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">920</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:HalDownloadFirmwareCallback</span>: <span class="hljs-variable constant_">HAL_NFC_OPEN_CPLT_EVT</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.227</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">894</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:DownloadFirmware</span>: try close <span class="hljs-variable constant_">HAL</span>
<span class="hljs-number">07</span>-<span class="hljs-number">11</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:</span><span class="hljs-number">45.227</span>  <span class="hljs-number">8689</span>  <span class="hljs-number">8848</span> I <span class="hljs-symbol">libnfc_nci:</span> [<span class="hljs-variable constant_">INFO</span><span class="hljs-symbol">:NfcAdaptation</span>.cc(<span class="hljs-number">727</span>)] <span class="hljs-title class_">NfcAdaptation</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:HalClose</span>
</code></pre>
<p>æ­£å¸¸çš„æµç¨‹ä¸­ï¼ŒDownloadFirmware() å’Œ HalDownloadFirmwareCallback() ä¸åœ¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚<br/>
é‚£å°±åœ¨ HalDownloadFirmwareCallback() ä¸­å¦èµ·ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ <code>mHalOpenCompletedEvent.signal()</code> è¯•è¯•:</p>
<p>system/nfc/src/adaptation/NfcAdaptation.cc</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-meta">@@ -1006,7 +1006,14 @@</span> bool NfcAdaptation::DownloadFirmware() {
 
   return isDownloadFirmwareCompleted;
 }
<span class="hljs-deletion">-</span>
<span class="hljs-addition">+void* NfcAdaptation::HalOpenCompletedThread(void *ptr)</span>
<span class="hljs-addition">+{</span>
<span class="hljs-addition">+  (void)ptr;</span>
<span class="hljs-addition">+  DLOG_IF(INFO, nfc_debug_enabled)</span>
<span class="hljs-addition">+      &lt;&lt; StringPrintf("enter %s", __func__);</span>
<span class="hljs-addition">+  mHalOpenCompletedEvent.signal();</span>
<span class="hljs-addition">+  return nullptr;</span>
<span class="hljs-addition">+}</span>
 /*******************************************************************************
 **
 ** Function:    NfcAdaptation::HalDownloadFirmwareCallback
<span class="hljs-meta">@@ -1020,8 +1027,9 @@</span> void NfcAdaptation::HalDownloadFirmwareCallback(nfc_event_t event,
                                                 __attribute__((unused))
                                                 nfc_status_t event_status) {
   const char* func = "NfcAdaptation::HalDownloadFirmwareCallback";
<span class="hljs-addition">+  pthread_t thread_open_completed;</span>
   DLOG_IF(INFO, nfc_debug_enabled)
<span class="hljs-deletion">-      &lt;&lt; StringPrintf("%s: event=0x%X", func, event);</span>
<span class="hljs-addition">+      &lt;&lt; StringPrintf("%s: event=0x%X, event_status=0x%02X", func, event, event_status);</span>
   switch (event) {
 /* START_SLSI [S14111804] Patch for prcoessing the first core_init response */
 #if (NFC_SEC_NOT_OPEN_INCLUDED == TRUE)
<span class="hljs-meta">@@ -1038,7 +1046,8 @@</span> void NfcAdaptation::HalDownloadFirmwareCallback(nfc_event_t event,
       DLOG_IF(INFO, nfc_debug_enabled)
         &lt;&lt; StringPrintf("%s: HAL_NFC_INIT_CPLT_EVT", func);
       if (event_status == HAL_NFC_STATUS_OK) isDownloadFirmwareCompleted = true;
<span class="hljs-deletion">-      mHalOpenCompletedEvent.signal();</span>
<span class="hljs-addition">+      pthread_create(&amp;thread_open_completed, NULL, HalOpenCompletedThread, NULL);</span>
<span class="hljs-addition">+      //mHalOpenCompletedEvent.signal();</span>
       break;
</code></pre>
<p>system/nfc/src/include/NfcAdaptation.h</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-meta">@@ -155,6 +155,7 @@</span> class NfcAdaptation {
   static void HalControlGranted();
   static void HalPowerCycle();
   static uint8_t HalGetMaxNfcee();
<span class="hljs-addition">+  static void* HalOpenCompletedThread(void *ptr);</span>
</code></pre>
<p>åšä»¥ä¸Šä¿®æ”¹ï¼Œå¯ä»¥è§„é¿é—®é¢˜, logå¦‚ä¸‹:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">07-07 19:35:20.352  2449  2777 I libnfc_nci:</span> [<span class="hljs-string">INFO:NfcAdaptation.cc(1031)</span>] <span class="hljs-attr">NfcAdaptation::HalDownloadFirmwareCallback:</span> <span class="hljs-string">event=0x2,</span> <span class="hljs-string">event_status=0x00</span>
<span class="hljs-attr">07-07 19:35:20.352  2449  2777 I libnfc_nci:</span> [<span class="hljs-string">INFO:NfcAdaptation.cc(1046)</span>] <span class="hljs-attr">NfcAdaptation::HalDownloadFirmwareCallback:</span> <span class="hljs-string">HAL_NFC_INIT_CPLT_EVT</span>
<span class="hljs-attr">07-07 19:35:20.354   650  2783 D nfc-service.example: reset_nfc_thread:</span> <span class="hljs-string">fd</span> <span class="hljs-string">=</span> <span class="hljs-number">7</span>
<span class="hljs-attr">07-07 19:35:20.354   650  2783 D nfc-service.example: reset_nfc_thread:</span> <span class="hljs-string">send</span> <span class="hljs-string">rest_nfc</span> <span class="hljs-string">data</span> <span class="hljs-string">succ!</span>
<span class="hljs-attr">07-07 19:35:20.363  2449  2785 I libnfc_nci:</span> [<span class="hljs-string">INFO:NfcAdaptation.cc(1012)</span>] <span class="hljs-string">enter</span> <span class="hljs-string">HalOpenCompletedThread</span>
<span class="hljs-attr">07-07 19:35:20.363  2449  2777 E libnfc_nci:</span> [<span class="hljs-string">ERROR:NfcAdaptation.cc(996)</span>] <span class="hljs-attr">NfcAdaptation::DownloadFirmware:</span> <span class="hljs-string">try</span> <span class="hljs-string">close</span> <span class="hljs-string">HAL</span>
<span class="hljs-attr">07-07 19:35:20.363  2449  2777 I libnfc_nci:</span> [<span class="hljs-string">INFO:NfcAdaptation.cc(832)</span>] <span class="hljs-string">NfcAdaptation::HalClose</span>
</code></pre>
<p>åœ¨è¿™é‡Œå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç³»ç»Ÿä¸­ <code>DownloadFirmware()</code> å’Œ <code>HalDownloadFirmwareCallback()</code> ä¸ºä»€ä¹ˆä¼šè·‘åˆ°åŒä¸€ä¸ªçº¿ç¨‹é‡Œ?</p>
<h2 data-id="heading-2">æºç åˆ†æ</h2>
<h3 data-id="heading-3">NfcAdaptation::HalDownloadFirmwareCallback() çš„è°ƒç”¨æ€»æµç¨‹</h3>
<p>system/nfc/src/adaptation/NfcAdaptation.cc</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">NfcAdaptation::DownloadFirmware</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">HalOpen</span>(HalDownloadFirmwareCallback, HalDownloadFirmwareDataCallback);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">NfcAdaptation::HalOpen</span><span class="hljs-params">(tHAL_NFC_CBACK* p_hal_cback,
                            tHAL_NFC_DATA_CBACK* p_data_cback)</span> </span>{
    mAidlCallback = ::ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;NfcAidlClientCallback&gt;(
        p_hal_cback, p_data_cback);
    Status status = mAidlHal-&gt;<span class="hljs-built_in">open</span>(mAidlCallback);
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NfcAidlClientCallback</span>
    : <span class="hljs-keyword">public</span> ::aidl::android::hardware::nfc::BnNfcClientCallback {
 <span class="hljs-keyword">public</span>:
  <span class="hljs-built_in">NfcAidlClientCallback</span>(tHAL_NFC_CBACK* eventCallback,
                        tHAL_NFC_DATA_CBACK dataCallback) {
    mEventCallback = eventCallback;
    mDataCallback = dataCallback;
  };
}
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼ŒHalDownloadFirmwareCallback() ç»ç”± HalOpen() èµ‹å€¼ç»™ mAidlCallback.mEventCallback, mAidlCallback å†ç»ç”± mAidlHal-&gt;open(mAidlCallback) ä¼ é€’ç»™ android.hardware.nfc-service.example,</p>
<p><code>android.hardware.nfc-service.example</code> çš„ä»£ç :</p>
<p>hardware/interfaces/nfc/aidl/default/Nfc.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp">::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Nfc::open</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;INfcClientCallback&gt;&amp; clientCallback)</span> </span>{
    Nfc::mCallback = clientCallback;
    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">Vendor_hal_open</span>(eventCallback, dataCallback);
}
</code></pre>
<p>hardware/interfaces/nfc/aidl/default/Nfc.h</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Nfc</span> : <span class="hljs-keyword">public</span> BnNfc {
  <span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">eventCallback</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> event, <span class="hljs-type">uint8_t</span> status)</span> </span>{
        <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">auto</span> ret = mCallback-&gt;<span class="hljs-built_in">sendEvent</span>((NfcEvent)event, (NfcStatus)status);
            <span class="hljs-keyword">if</span> (!ret.<span class="hljs-built_in">isOk</span>()) {
                <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to send event!"</span>;
            }
        }
    }

    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">dataCallback</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> data_len, <span class="hljs-type">uint8_t</span>* p_data)</span> </span>{
        <span class="hljs-function">std::vector&lt;<span class="hljs-type">uint8_t</span>&gt; <span class="hljs-title">data</span><span class="hljs-params">(p_data, p_data + data_len)</span></span>;
        <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">auto</span> ret = mCallback-&gt;<span class="hljs-built_in">sendData</span>(data);
            <span class="hljs-keyword">if</span> (!ret.<span class="hljs-built_in">isOk</span>()) {
                <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to send data!"</span>;
            }
        }
    }
}
</code></pre>
<p>hardware/interfaces/nfc/aidl/default/Vendor_hal_api.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">static</span> <span class="hljs-type">nfc_stack_callback_t</span>* p_nfc_stack_cback;
<span class="hljs-type">static</span> <span class="hljs-type">nfc_stack_data_callback_t</span>* p_nfc_stack_data_cback;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Vendor_hal_open</span><span class="hljs-params">(<span class="hljs-type">nfc_stack_callback_t</span>* p_cback, <span class="hljs-type">nfc_stack_data_callback_t</span>* p_data_cback)</span> </span>{
    p_nfc_stack_cback = p_cback;
    p_nfc_stack_data_cback = p_data_cback;

    <span class="hljs-built_in">p_nfc_stack_cback</span>(HAL_NFC_OPEN_CPLT_EVT, HAL_NFC_STATUS_OK);
}
</code></pre>
<p>1.<code>android.hardware.nfc-service.example</code> æ¥åˆ° NfcAdaptation å‘èµ·çš„ mAidlHal-&gt;open(mAidlCallback) ipcè°ƒç”¨è¯·æ±‚åï¼Œè¿›å…¥ Nfc::open();</p>
<p>2.Nfc::open() ä¸­å°† NfcAdaptation.mAidlCallback çš„ Binder å¯¹è±¡èµ‹å€¼ç»™<code>Nfc::mCallback</code>;</p>
<p>3.Nfc::open() ä¸­æŠŠ Nfc.eventCallback() å’Œ Nfc.dataCallback() ä¼ ç»™Vendor_hal_open();</p>
<p>4.Vendor_hal_api.cpp åœ¨æœ‰äº‹ä»¶æˆ–æ•°æ®è¦ä¸ŠæŠ¥ç»™ com.android.nfc çš„è¯å°±ä¼šè°ƒç”¨ Nfc.eventCallback()[p_nfc_stack_cback] å’Œ Nfc.dataCallback()[p_nfc_stack_data_cback] ä¼ é€’äº‹ä»¶å’Œæ•°æ®ï¼Œæœ€ç»ˆä¼šé€šè¿‡ binder æœºåˆ¶è°ƒç”¨åˆ° NfcAdaptation ä¸­çš„ mAidlCallback.mEventCallback å’Œ mAidlCallback.mDataCallbackï¼Œä¹Ÿå°±æ˜¯ HalDownloadFirmwareCallback, HalDownloadFirmwareDataCallbackã€‚</p>
<h3 data-id="heading-4">IBinder å¯¹è±¡çš„è·¨è¿›ç¨‹ä¼ é€’</h3>
<p>æœ¬æ–‡å°†ä»¥ NfcAdaptation.mAidlCallback çš„ä¼ é€’æµç¨‹ä¸ºä¾‹æ¥æè¿° IBinder å¯¹è±¡çš„è·¨è¿›ç¨‹ä¼ é€’ã€‚</p>
<h4 data-id="heading-5">ä¼ é€’ä¹‹å‰çš„å‡†å¤‡</h4>
<p>ä¼ é€’ NfcAdaptation.mAidlCallback åœ¨è¿›å…¥é©±åŠ¨ä¹‹å‰çš„è°ƒç”¨é“¾</p>
<pre><code class="hljs language-cpp" lang="cpp">NfcAdaptation::<span class="hljs-built_in">HalOpen</span>()
mAidlHal-&gt;<span class="hljs-built_in">open</span>(mAidlCallback)
INfcAidl::<span class="hljs-built_in">open</span>(INfcAidlClientCallback in_clientCallback)
aidl::android::hardware::nfc::BpNfc::<span class="hljs-built_in">open</span>(INfcClientCallback&amp; in_clientCallback)
BpBinder::<span class="hljs-built_in">transact</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>, android::Parcel <span class="hljs-type">const</span>&amp;, android::Parcel*, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)
IPCThreadState::<span class="hljs-built_in">transact</span>(<span class="hljs-type">int32_t</span> handle, <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data, Parcel* reply, <span class="hljs-type">uint32_t</span> flags)
IPCThreadState::<span class="hljs-built_in">writeTransactionData</span>(<span class="hljs-type">int32_t</span> cmd, <span class="hljs-type">uint32_t</span> binderFlags, <span class="hljs-type">int32_t</span> handle, <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data, <span class="hljs-type">status_t</span>* statusBuffer)
IPCThreadState::<span class="hljs-built_in">waitForResponse</span>()
IPCThreadState::<span class="hljs-built_in">talkWithDriver</span>()
    <span class="hljs-built_in">ioctl</span>(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr)
</code></pre>
<p>out/soong/.intermediates/hardware/interfaces/nfc/aidl/android.hardware.nfc-V1-ndk-source/gen/android/hardware/nfc/INfc.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp">::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">BpNfc::open</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;::aidl::android::hardware::nfc::INfcClientCallback&gt;&amp; in_clientCallback)</span> </span>{
  _aidl_ret_status = ::ndk::<span class="hljs-built_in">AParcel_writeData</span>(_aidl_in.<span class="hljs-built_in">get</span>(), in_clientCallback);
}
</code></pre>
<p>AParcel_writeDataçš„è°ƒç”¨é“¾å¦‚ä¸‹:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">AParcel_writeData</span>()
<span class="hljs-built_in">AParcel_writeData</span>(_aidl_in.<span class="hljs-built_in">get</span>(), in_clientCallback)
<span class="hljs-built_in">AParcel_writeStrongBinder</span>()
Parcel::<span class="hljs-built_in">writeStrongBinder</span>(<span class="hljs-type">const</span> sp&lt;IBinder&gt;&amp; val)
Parcel::<span class="hljs-built_in">flattenBinder</span>(<span class="hljs-type">const</span> sp&lt;IBinder&gt;&amp; binder)
    <span class="hljs-keyword">if</span> (binder) local = binder-&gt;<span class="hljs-built_in">localBinder</span>();
    flat_binder_object obj;
    obj.hdr.type = BINDER_TYPE_BINDER;
    obj.binder = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uintptr_t</span>&gt;(local-&gt;<span class="hljs-built_in">getWeakRefs</span>());
    obj.cookie = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">uintptr_t</span>&gt;(local);
    <span class="hljs-built_in">writeObject</span>(obj, <span class="hljs-literal">false</span>)
</code></pre>
<p>åœ¨è¿™é‡Œï¼Œ<code>NfcAdaptation.mAidlCallback</code> è¢«èµ‹å€¼ç»™ <code>flat_binder_object.cookie</code>, flat_binder_object è¢«æ‰“åŒ…è¿›ä¸€ä¸ª Parcel å¯¹è±¡ä¸­ï¼Œå¹¶å¾€ä¸‹ä¼ ç»™ BpBinder::transact() ---&gt; IPCThreadState::transact().</p>
<p>åœ¨ IPCThreadState::transact()ä¸­:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::transact</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> handle,
                                  <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data,
                                  Parcel* reply, <span class="hljs-type">uint32_t</span> flags)</span>
</span>{
    err = <span class="hljs-built_in">writeTransactionData</span>(BC_TRANSACTION, flags, handle, code, data, <span class="hljs-literal">nullptr</span>);
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::writeTransactionData</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> cmd, <span class="hljs-type">uint32_t</span> binderFlags,
    <span class="hljs-type">int32_t</span> handle, <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data, <span class="hljs-type">status_t</span>* statusBuffer)</span>
</span>{
    binder_transaction_data tr;
    tr.target.handle = handle;
    tr.code = code;

    tr.data_size = data.<span class="hljs-built_in">ipcDataSize</span>();
    tr.data.ptr.buffer = data.<span class="hljs-built_in">ipcData</span>();
    tr.offsets_size = data.<span class="hljs-built_in">ipcObjectsCount</span>()*<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">binder_size_t</span>);
    tr.data.ptr.offsets = data.<span class="hljs-built_in">ipcObjects</span>();

    mOut.<span class="hljs-built_in">writeInt32</span>(cmd);
    mOut.<span class="hljs-built_in">write</span>(&amp;tr, <span class="hljs-built_in">sizeof</span>(tr));
}
</code></pre>
<p>IPCThreadState::writeTransactionData() çš„ä½œç”¨å¦‚ä¸‹:</p>
<p>1.åˆ›å»º binder_transaction_data, æŠŠ handleï¼Œcodeï¼Œdata èµ‹å€¼åˆ°binder_transaction_data;</p>
<p>2.å°†å‘½ä»¤å· cmd(å¦‚ IPCThreadState::transact() ç»™çš„ BC_TRANSACTION) å’Œbinder_transaction_data å†™åˆ° Parcel ç±»å‹çš„ mOutã€‚</p>
<p>è‡³æ­¤ï¼Œä»£è¡¨ NfcAdaptation.mAidlCallback çš„ <code>cookie</code> ä¹Ÿè¢«æ‰“åŒ…è¿›binder_transaction_dataï¼Œå¹¶åœ¨ IPCThreadState::talkWithDriver() ä¸­é€šè¿‡ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) ä¼ ç»™äº† binder é©±åŠ¨ã€‚</p>
<p>å…³æ³¨è¿™ä¸ª <code>cookie</code>, åç»­æˆ‘ä»¬å°†è·Ÿè¸ªè¿™ä¸ª <code>cookie</code> çš„ä¼ é€’å’Œæœ€ç»ˆè°ƒç”¨ã€‚</p>
<h4 data-id="heading-6">IBinder å¯¹è±¡åœ¨é©±åŠ¨ä¸­çš„ä¼ é€’</h4>
<h5 data-id="heading-7">å‘é€ IBinder å¯¹è±¡</h5>
<h6 data-id="heading-8">binder_ioctl()</h6>
<p>éšç€ç³»ç»Ÿè°ƒç”¨ ioctl(), ç¨‹åºè¿›å…¥äº†å†…æ ¸é©±åŠ¨å±‚ binder_ioctl():<br/>
kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-title">binder_ioctl</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filp, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span>
</span>{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_proc</span> *proc = filp-&gt;private_data;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *thread;

    thread = <span class="hljs-built_in">binder_get_thread</span>(proc);
    <span class="hljs-keyword">switch</span> (cmd) {
    <span class="hljs-keyword">case</span> BINDER_WRITE_READ:
        ret = <span class="hljs-built_in">binder_ioctl_write_read</span>(filp, cmd, arg, thread);
        <span class="hljs-keyword">if</span> (ret)
            <span class="hljs-keyword">goto</span> err;
        <span class="hljs-keyword">break</span>;
    }
}
</code></pre>
<p>binder_ioctl() é¦–å…ˆå‡ºç°çš„æ˜¯ <code>struct binder_proc *proc</code> å’Œ <code>struct binder_thread *thread</code> ä¸¤ä¸ªå˜é‡ã€‚</p>
<p><code>struct binder_proc *proc</code> ä»£è¡¨çš„æ˜¯è¿›ç¨‹ï¼Œç”± binder_open() åˆ›å»º, binder_open() åˆæ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹è¢«è°ƒç”¨å‘¢ï¼Œè¯·çœ‹ä»¥ä¸‹ä»£ç :<br/>
æ¯ä¸ª app åœ¨å¯åŠ¨æ—¶ä¼šè¿è¡Œ app_process, å¹¶èµ° AppRuntime::onZygoteInit():
frameworks/base/cmds/app_process/app_main.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp">    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">onZygoteInit</span><span class="hljs-params">()</span>
    </span>{
        sp&lt;ProcessState&gt; proc = ProcessState::<span class="hljs-built_in">self</span>();
        <span class="hljs-built_in">ALOGV</span>(<span class="hljs-string">"App process: starting thread pool.\n"</span>);
        proc-&gt;<span class="hljs-built_in">startThreadPool</span>();
    }
</code></pre>
<p>æ¥ç€èµ°</p>
<pre><code class="hljs language-cpp" lang="cpp">ProcessState::<span class="hljs-built_in">self</span>()
ProcessState::<span class="hljs-built_in">init</span>()
ProcessState::<span class="hljs-built_in">ProcessState</span>()
ProcessState::<span class="hljs-built_in">open_driver</span>()
</code></pre>
<p>åœ¨ ProcessState::open_driver() ä¸­æ‰“å¼€äº† binder çš„é©±åŠ¨èŠ‚ç‚¹æ–‡ä»¶ "/dev/binder":</p>
<p>frameworks/native/libs/binder/ProcessState.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* kDefaultDriver = <span class="hljs-string">"/dev/binder"</span>;

<span class="hljs-function">sp&lt;ProcessState&gt; <span class="hljs-title">ProcessState::self</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">init</span>(kDefaultDriver, <span class="hljs-literal">false</span> <span class="hljs-comment">/*requireDefault*/</span>);
}

<span class="hljs-function">sp&lt;ProcessState&gt; <span class="hljs-title">ProcessState::init</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *driver, <span class="hljs-type">bool</span> requireDefault)</span>
</span>{
    gProcess = sp&lt;ProcessState&gt;::<span class="hljs-built_in">make</span>(driver);
}

ProcessState::<span class="hljs-built_in">ProcessState</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* driver)
      : <span class="hljs-built_in">mDriverName</span>(<span class="hljs-built_in">String8</span>(driver)),
        <span class="hljs-built_in">mDriverFD</span>(<span class="hljs-number">-1</span>) {
    base::Result&lt;<span class="hljs-type">int</span>&gt; opened = <span class="hljs-built_in">open_driver</span>(driver);

    <span class="hljs-keyword">if</span> (opened.<span class="hljs-built_in">ok</span>()) {
        mDriverFD = opened.<span class="hljs-built_in">value</span>();
    }
}

<span class="hljs-function"><span class="hljs-type">static</span> base::Result&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">open_driver</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* driver)</span> </span>{
    <span class="hljs-type">int</span> fd = <span class="hljs-built_in">open</span>(driver, O_RDWR | O_CLOEXEC);
    <span class="hljs-keyword">return</span> fd;
}
</code></pre>
<p>ç„¶ååœ¨é©±åŠ¨çš„ binder_open() å‡½æ•°ä¸­åˆ›å»ºäº† <code>struct binder_proc *proc</code>, ç”¨äºåœ¨å†…æ ¸ç©ºé—´ä»£è¡¨å½“å‰è¿›ç¨‹ï¼Œæ¯ä¸ªä½¿ç”¨äº† binder é€šä¿¡æœºåˆ¶çš„è¿›ç¨‹åœ¨å†…æ ¸ç©ºé—´ä¸­æœ‰ä¸ªå”¯ä¸€çš„ <code>struct binder_proc *proc</code></p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *nodp, <span class="hljs-keyword">struct</span> file *filp)</span>
</span>{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_proc</span> *proc, *itr;

    eproc = <span class="hljs-built_in">kzalloc</span>(<span class="hljs-built_in">sizeof</span>(*eproc), GFP_KERNEL);
    proc = &amp;eproc-&gt;proc;
    proc-&gt;tsk = current-&gt;group_leader;
    proc-&gt;context = &amp;binder_dev-&gt;context;
    proc-&gt;pid = current-&gt;group_leader-&gt;pid;

    filp-&gt;private_data = proc;
}
</code></pre>
<p><code>struct binder_thread *thread</code> ä»£è¡¨ç€å½“å‰çº¿ç¨‹ï¼Œæ€ä¹ˆæ¥çš„å‘¢</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-title">binder_ioctl</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filp, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span>
</span>{
    thread = <span class="hljs-built_in">binder_get_thread</span>(proc);
}

<span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *<span class="hljs-built_in">binder_get_thread</span>(<span class="hljs-keyword">struct</span> binder_proc *proc)
{

    thread = <span class="hljs-built_in">binder_get_thread_ilocked</span>(proc, <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">if</span> (!thread) {
        new_thread = <span class="hljs-built_in">kzalloc</span>(<span class="hljs-built_in">sizeof</span>(*thread), GFP_KERNEL);
        thread = <span class="hljs-built_in">binder_get_thread_ilocked</span>(proc, new_thread);
    }
    <span class="hljs-keyword">return</span> thread;
}

<span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *<span class="hljs-built_in">binder_get_thread_ilocked</span>(
		<span class="hljs-keyword">struct</span> binder_proc *proc, <span class="hljs-keyword">struct</span> binder_thread *new_thread)
{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *thread = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">rb_node</span> *parent = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">rb_node</span> **p = &amp;proc-&gt;threads.rb_node;
    
    <span class="hljs-keyword">while</span> (*p) {
        parent = *p;
        thread = <span class="hljs-built_in">rb_entry</span>(parent, <span class="hljs-keyword">struct</span> binder_thread, rb_node);
    
        <span class="hljs-keyword">if</span> (current-&gt;pid &lt; thread-&gt;pid)
            p = &amp;(*p)-&gt;rb_left;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current-&gt;pid &gt; thread-&gt;pid)
            p = &amp;(*p)-&gt;rb_right;
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> thread;
    }
    <span class="hljs-keyword">if</span> (!new_thread)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    thread = new_thread;
    <span class="hljs-built_in">binder_stats_created</span>(BINDER_STAT_THREAD);
    thread-&gt;proc = proc;
    thread-&gt;pid = current-&gt;pid;
    <span class="hljs-built_in">rb_link_node</span>(&amp;thread-&gt;rb_node, parent, p);
    <span class="hljs-built_in">rb_insert_color</span>(&amp;thread-&gt;rb_node, &amp;proc-&gt;threads);
    ......
    <span class="hljs-keyword">return</span> thread;
}
</code></pre>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œbinder_get_thread_ilocked() å…ˆåœ¨å½“å‰ binder_proc.threads ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰ä¸ºå½“å‰çº¿ç¨‹åˆ›å»ºè¿‡çš„ binder_thread, çº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨ binder_ioctl() çš„è¯ï¼Œæ˜¯æ²¡æœ‰å¯¹åº”binder_thread çš„ï¼Œé‚£å°±è¿”å› binder_get_thread() æ–°åˆ›ä¸€ä¸ªï¼Œå†ä¼ å…¥binder_get_thread_ilocked(), å¹¶ "rb_insert_color(&amp;thread-&gt;rb_node, &amp;proc-&gt;threads);" ç»™åŠ åˆ° binder_proc.threads çš„çº¢é»‘æ ‘ä¸­ã€‚</p>
<h6 data-id="heading-9">binder_ioctl_write_read()</h6>
<p>è¯´å®Œ binder_proc å’Œ binder_thread, æ¥ç€æ¥åˆ°äº†å†™è¯»æµç¨‹ binder_ioctl_write_read()ï¼Œä¸ºä»€ä¹ˆæ˜¯å†™è¯»å‘¢?</p>
<p>frameworks/native/libs/binder/IPCThreadState.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::waitForResponse</span><span class="hljs-params">(Parcel *reply, <span class="hljs-type">status_t</span> *acquireResult)</span>
</span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> ((err=<span class="hljs-built_in">talkWithDriver</span>()) &lt; NO_ERROR) <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::talkWithDriver</span><span class="hljs-params">(<span class="hljs-type">bool</span> doReceive)</span>
</span>{
    <span class="hljs-comment">// Is the read buffer empty?</span>
    <span class="hljs-type">const</span> <span class="hljs-type">bool</span> needRead = mIn.<span class="hljs-built_in">dataPosition</span>() &gt;= mIn.<span class="hljs-built_in">dataSize</span>();

    <span class="hljs-type">const</span> <span class="hljs-type">size_t</span> outAvail = (!doReceive || needRead) ? mOut.<span class="hljs-built_in">dataSize</span>() : <span class="hljs-number">0</span>;

    bwr.write_size = outAvail;
    bwr.write_buffer = (<span class="hljs-type">uintptr_t</span>)mOut.<span class="hljs-built_in">data</span>();

    <span class="hljs-keyword">if</span> (doReceive &amp;&amp; needRead) {
        bwr.read_size = mIn.<span class="hljs-built_in">dataCapacity</span>();
        bwr.read_buffer = (<span class="hljs-type">uintptr_t</span>)mIn.<span class="hljs-built_in">data</span>();
    } <span class="hljs-keyword">else</span> {
        bwr.read_size = <span class="hljs-number">0</span>;
        bwr.read_buffer = <span class="hljs-number">0</span>;
    }

    <span class="hljs-built_in">ALOGD</span>(<span class="hljs-string">"%s: Size of receive buffer: %llu, write_size: %llu, needRead: %d, doReceive: %d"</span>, __func__, bwr.read_size, bwr.write_size, needRead, doReceive)

    <span class="hljs-keyword">do</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">ioctl</span>(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) &gt;= <span class="hljs-number">0</span>)
            err = NO_ERROR;
        <span class="hljs-keyword">else</span>
            err = -errno;
    }
}
</code></pre>
<p>IPCThreadState::waitForResponse() ä¸­ä¸å¸¦å‚æ•°åœ°è°ƒç”¨äº† talkWithDriver(),</p>
<p>æŸ¥çœ‹ talkWithDriver() çš„å®šä¹‰<br/>
frameworks/native/libs/binder/include/binder/IPCThreadState.h</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IPCThreadState</span>
{
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">status_t</span>            <span class="hljs-title">talkWithDriver</span><span class="hljs-params">(<span class="hljs-type">bool</span> doReceive=<span class="hljs-literal">true</span>)</span></span>;
}
</code></pre>
<p>ä¸å¸¦å‚æ•°çš„ talkWithDriver() ç­‰äº talkWithDriver(true)ï¼Œä¹Ÿå°±æ˜¯è¦ç­‰å¾…æ¥æ”¶æ•°æ®çš„ã€‚é™¤é mIn çš„æ•°æ®ç©ºé—´ä¸ä¸ºç©ºã€‚</p>
<p>çœ‹ log:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">D ipc     : Size of receive buffer:</span> <span class="hljs-number">256</span><span class="hljs-string">,</span> <span class="hljs-attr">write_size:</span> <span class="hljs-number">68</span><span class="hljs-string">,</span> <span class="hljs-attr">needRead:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">doReceive:</span> <span class="hljs-number">1</span>
</code></pre>
<p>ä¼ ç»™ ioctl() çš„ write_size å’Œ read_size éƒ½æ˜¯å¤§äº 0ã€‚</p>
<p>æ¥ç€åœ¨é©±åŠ¨ä¸­ï¼Œé€šè¿‡ write_size å’Œ read_size æ¥åˆ¤æ–­æ˜¯å¦è¦èµ° binder_thread_write() æˆ– binder_thread_read()</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_ioctl_write_read</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filp,
                <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg,
                <span class="hljs-keyword">struct</span> binder_thread *thread)</span>
</span>{
    <span class="hljs-keyword">if</span> (bwr.write_size &gt; <span class="hljs-number">0</span>) {
        ret = <span class="hljs-built_in">binder_thread_write</span>(proc, thread,
                      bwr.write_buffer,
                      bwr.write_size,
                      &amp;bwr.write_consumed);
    }
    <span class="hljs-keyword">if</span> (bwr.read_size &gt; <span class="hljs-number">0</span>) {
        ret = <span class="hljs-built_in">binder_thread_read</span>(proc, thread, bwr.read_buffer,
                     bwr.read_size,
                     &amp;bwr.read_consumed,
                     filp-&gt;f_flags &amp; O_NONBLOCK);
    }
}
</code></pre>
<p>æ‰€ä»¥ä¼šå…ˆ binder_thread_write() å†™å…¥è¦ä¼ è¾“çš„å‘½ä»¤ï¼Œç„¶åå†è°ƒç”¨ binder_thread_read() ç­‰å¾…åº”ç­”ã€‚</p>
<h6 data-id="heading-10">binder_thread_write()</h6>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_thread_write</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
            <span class="hljs-keyword">struct</span> binder_thread *thread,
            <span class="hljs-type">binder_uintptr_t</span> binder_buffer, <span class="hljs-type">size_t</span> size,
            <span class="hljs-type">binder_size_t</span> *consumed)</span>
</span>{
    <span class="hljs-type">uint32_t</span> cmd;
    <span class="hljs-keyword">while</span> (ptr &lt; end &amp;&amp; thread-&gt;return_error.cmd == BR_OK) {
        <span class="hljs-type">int</span> ret;

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">get_user</span>(cmd, (<span class="hljs-type">uint32_t</span> __user *)ptr))
            <span class="hljs-keyword">return</span> -EFAULT;
        <span class="hljs-keyword">switch</span> (cmd) {
        <span class="hljs-keyword">case</span> BC_TRANSACTION:
        <span class="hljs-keyword">case</span> BC_REPLY: {
            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction_data</span> tr;

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">copy_from_user</span>(&amp;tr, ptr, <span class="hljs-built_in">sizeof</span>(tr)))
                <span class="hljs-keyword">return</span> -EFAULT;
            ptr += <span class="hljs-built_in">sizeof</span>(tr);
            <span class="hljs-built_in">binder_transaction</span>(proc, thread, &amp;tr,
                       cmd == BC_REPLY, <span class="hljs-number">0</span>);
            <span class="hljs-keyword">break</span>;
        }
        }
    }
}
</code></pre>
<p>binder_thread_write() å–åˆ°åº”ç”¨å±‚ä¸‹ä¼ çš„ BC_TRANSACTION çš„å‘½ä»¤å·å’Œ binder_transaction_data æ•°æ®å, è¿›å…¥ binder_transaction()ã€‚</p>
<h6 data-id="heading-11">binder_transaction()</h6>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">binder_transaction</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
                   <span class="hljs-keyword">struct</span> binder_thread *thread,
                   <span class="hljs-keyword">struct</span> binder_transaction_data *tr, <span class="hljs-type">int</span> reply,
                   <span class="hljs-type">binder_size_t</span> extra_buffers_size)</span>
</span>{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction</span> *t;
    <span class="hljs-type">binder_size_t</span> buffer_offset = <span class="hljs-number">0</span>;
    <span class="hljs-type">binder_size_t</span> off_start_offset, off_end_offset;

    <span class="hljs-type">const</span> <span class="hljs-type">void</span> __user *user_buffer = (<span class="hljs-type">const</span> <span class="hljs-type">void</span> __user *)
            (<span class="hljs-type">uintptr_t</span>)tr-&gt;data.ptr.buffer;

    <span class="hljs-keyword">if</span> (reply) {

    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (!(tr-&gt;flags &amp; TF_ONE_WAY) &amp;&amp; thread-&gt;transaction_stack) {
            <span class="hljs-keyword">struct</span> binder_transaction *tmp;

            tmp = thread-&gt;transaction_stack;

            <span class="hljs-keyword">while</span> (tmp) {
                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *from;

                <span class="hljs-built_in">spin_lock</span>(&amp;tmp-&gt;lock);
                from = tmp-&gt;from;
                <span class="hljs-keyword">if</span> (from &amp;&amp; from-&gt;proc == target_proc) {
                    <span class="hljs-built_in">atomic_inc</span>(&amp;from-&gt;tmp_ref);
                    target_thread = from;
                    <span class="hljs-built_in">spin_unlock</span>(&amp;tmp-&gt;lock);
                    is_nested = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-built_in">spin_unlock</span>(&amp;tmp-&gt;lock);
                tmp = tmp-&gt;from_parent;
            }
        }
    }

    off_start_offset = <span class="hljs-built_in">ALIGN</span>(tr-&gt;data_size, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">void</span> *));
    buffer_offset = off_start_offset;
    off_end_offset = off_start_offset + tr-&gt;offsets_size;

    <span class="hljs-keyword">for</span> (buffer_offset = off_start_offset; buffer_offset &lt; off_end_offset;
         buffer_offset += <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">binder_size_t</span>)) {
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_object_header</span> *hdr;
        <span class="hljs-type">size_t</span> object_size;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_object</span> object;
        <span class="hljs-type">binder_size_t</span> object_offset;
        <span class="hljs-type">binder_size_t</span> copy_size;

        object_size = <span class="hljs-built_in">binder_get_object</span>(target_proc, user_buffer,
                        t-&gt;buffer, object_offset, &amp;object);

        hdr = &amp;object.hdr;
        off_min = object_offset + object_size;
        <span class="hljs-keyword">switch</span> (hdr-&gt;type) {
        <span class="hljs-keyword">case</span> BINDER_TYPE_BINDER:
        <span class="hljs-keyword">case</span> BINDER_TYPE_WEAK_BINDER: {
            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">flat_binder_object</span> *fp;

            fp = <span class="hljs-built_in">to_flat_binder_object</span>(hdr);
            ret = <span class="hljs-built_in">binder_translate_binder</span>(fp, t, thread);
                <span class="hljs-keyword">break</span>;
         } <span class="hljs-keyword">break</span>;
         }
    }

    <span class="hljs-built_in">binder_alloc_copy_user_to_buffer</span>(
                &amp;target_proc-&gt;alloc,
                t-&gt;buffer, user_offset,
                user_buffer + user_offset,
                tr-&gt;data_size - user_offset)

    <span class="hljs-keyword">if</span> (reply) {

    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!(t-&gt;flags &amp; TF_ONE_WAY)) {
        t-&gt;need_reply = <span class="hljs-number">1</span>;
        t-&gt;from_parent = thread-&gt;transaction_stack;
        thread-&gt;transaction_stack = t;
        return_error = <span class="hljs-built_in">binder_proc_transaction</span>(t,
                target_proc, target_thread);
    }
}
</code></pre>
<p>binder_transaction() åšäº†è¿™å‡ ä¸ªäº‹ï¼š</p>
<ol>
<li>
<p>åˆ¤æ–­ thread-&gt;transaction_stack æ˜¯å¦ä¸ºç©º, ä¸ä¸ºç©ºçš„è¯, ä»ä¸­å–å¾— target_thread , å› ä¸ºåœ¨ NfcAdaptation::HalOpen() ä¸­è¿™æ˜¯ç¬¬ä¸€æ¬¡å‘èµ· transact(), thread æ˜¯æ–°åˆ›çš„, thread-&gt;transaction_stack ä¸ºç©º, æ‰€ä»¥ target_thread ä¹Ÿä¸ºç©º, éœ€è¦åœ¨ binder_proc_transaction() é‡Œé€‰æ‹©åˆé€‚çš„çº¿ç¨‹åš target_thread</p>
</li>
<li>
<p>éå† binder_transaction_data.data.ptr.buffer é‡Œçš„æ•°æ®ï¼Œè°ƒç”¨binder_get_object() æ‰¾å‡º BINDER_TYPE_BINDER, BINDER_TYPE_HANDLE, BINDER_TYPE_FD ç­‰å¯¹è±¡çš„æ•°æ®, å¹¶å°†æ•°æ®æ‹·è´ç»™ binder_transaction.buffer</p>
</li>
<li>
<p>æ‰¾åˆ° BINDER_TYPE_BINDER ç±»å‹æ•°æ®åï¼Œè°ƒç”¨ binder_translate_binder() åšå¤„ç†</p>
</li>
<li>
<p>è°ƒç”¨ binder_alloc_copy_user_to_buffer() å°† binder_transaction_data.data.ptr.buffer é‡Œå‰©ä½™çš„æ•°æ®æ‹·è´ç»™ binder_transaction.buffer</p>
</li>
<li>
<p>è°ƒç”¨ binder_proc_transaction() å°†æ‰“åŒ…å¥½çš„ binder_transaction æ•°æ®å‘é€ç»™ target_proc, å¹¶å”¤é†’ target_proc æ¥è¯»å–å’Œå¤„ç† binder_transaction</p>
</li>
</ol>
<h6 data-id="heading-12">binder_translate_binder()</h6>
<p>æˆ‘ä»¬ç°åœ¨æ¥åˆ†æä¸€ä¸‹ï¼Œ binder_translate_binder() å‡½æ•°ä¼šå¯¹ NfcAdaptation.mAidlCallback è¿™ä¸ª BINDER_TYPE_BINDER å¯¹è±¡åšä»€ä¹ˆå¤„ç†</p>
<p>BINDER_TYPE_BINDER å¯¹è±¡æ•°æ®åœ¨ä¼ å…¥ binder_translate_binder() ä¹‹å‰ï¼Œå…ˆè¢«è½¬åŒ–ä¸º <code>flat_binder_object</code> æ•°æ®ç»“æ„ï¼Œä¸ç”¨æˆ·å±‚ä¸‹å‘ä¹‹å‰åœ¨ <code>Parcel::flattenBinder()</code> é‡ŒæŠŠ IBinder è½¬åŒ–ä¸º <code>flat_binder_object</code> å¯¹åº”ä¸Šäº†ã€‚</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">binder_transaction</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
                   <span class="hljs-keyword">struct</span> binder_thread *thread,
                   <span class="hljs-keyword">struct</span> binder_transaction_data *tr, <span class="hljs-type">int</span> reply,
                   <span class="hljs-type">binder_size_t</span> extra_buffers_size)</span>
</span>{
        <span class="hljs-keyword">switch</span> (hdr-&gt;type) {
        <span class="hljs-keyword">case</span> BINDER_TYPE_BINDER:
        <span class="hljs-keyword">case</span> BINDER_TYPE_WEAK_BINDER: {
            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">flat_binder_object</span> *fp;

            fp = <span class="hljs-built_in">to_flat_binder_object</span>(hdr);
            ret = <span class="hljs-built_in">binder_translate_binder</span>(fp, t, thread);
                <span class="hljs-keyword">break</span>;
         } <span class="hljs-keyword">break</span>;
         } 
}

</code></pre>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_translate_binder</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> flat_binder_object *fp,
                   <span class="hljs-keyword">struct</span> binder_transaction *t,
                   <span class="hljs-keyword">struct</span> binder_thread *thread)</span>
</span>{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_proc</span> *proc = thread-&gt;proc;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_proc</span> *target_proc = t-&gt;to_proc;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_ref_data</span> rdata;

    node = <span class="hljs-built_in">binder_get_node</span>(proc, fp-&gt;binder);
    <span class="hljs-keyword">if</span> (!node) {
        node = <span class="hljs-built_in">binder_new_node</span>(proc, fp);
        <span class="hljs-keyword">if</span> (!node)
            <span class="hljs-keyword">return</span> -ENOMEM;
    }

    ret = <span class="hljs-built_in">binder_inc_ref_for_node</span>(target_proc, node,
            fp-&gt;hdr.type == BINDER_TYPE_BINDER,
            &amp;thread-&gt;todo, &amp;rdata);


    <span class="hljs-keyword">if</span> (fp-&gt;hdr.type == BINDER_TYPE_BINDER)
        fp-&gt;hdr.type = BINDER_TYPE_HANDLE;
    <span class="hljs-keyword">else</span>
        fp-&gt;hdr.type = BINDER_TYPE_WEAK_HANDLE;
    fp-&gt;binder = <span class="hljs-number">0</span>;
    fp-&gt;handle = rdata.desc;
    fp-&gt;cookie = <span class="hljs-number">0</span>;
}

<span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *<span class="hljs-built_in">binder_new_node</span>(<span class="hljs-keyword">struct</span> binder_proc *proc,
                       <span class="hljs-keyword">struct</span> flat_binder_object *fp)
{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *node;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *new_node = <span class="hljs-built_in">kzalloc</span>(<span class="hljs-built_in">sizeof</span>(*node), GFP_KERNEL);

    node = <span class="hljs-built_in">binder_init_node_ilocked</span>(proc, new_node, fp);
}

<span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *<span class="hljs-built_in">binder_init_node_ilocked</span>(
                        <span class="hljs-keyword">struct</span> binder_proc *proc,
                        <span class="hljs-keyword">struct</span> binder_node *new_node,
                        <span class="hljs-keyword">struct</span> flat_binder_object *fp)
{
    <span class="hljs-type">binder_uintptr_t</span> ptr = fp ? fp-&gt;binder : <span class="hljs-number">0</span>;
    <span class="hljs-type">binder_uintptr_t</span> cookie = fp ? fp-&gt;cookie : <span class="hljs-number">0</span>;

    <span class="hljs-built_in">rb_link_node</span>(&amp;node-&gt;rb_node, parent, p);
    <span class="hljs-built_in">rb_insert_color</span>(&amp;node-&gt;rb_node, &amp;proc-&gt;nodes);

    node-&gt;proc = proc;
    node-&gt;ptr = ptr;
    node-&gt;cookie = cookie;
}
</code></pre>
<p>åœ¨ binder_translate_binder() ä¸­ï¼Œåˆå‡ºç°äº†ä¸ªæ–°çš„æ•°æ®ç»“æ„ <code>struct binder_node</code>,  <code>struct binder_node</code> ç”¨äºåœ¨å†…æ ¸ä¸­ä»£è¡¨ IBinder å®ä¾‹ã€‚</p>
<p>binder_translate_binder() ä¸»è¦åšäº†è¿™äº›äº‹:</p>
<ol>
<li>
<p>åœ¨å½“å‰è¿›ç¨‹ä¸­æŸ¥æ‰¾ flat_binder_object å¯¹åº”çš„ binder_node, æ²¡æ‰¾åˆ°çš„è¯å°±è°ƒç”¨ binder_new_node() æ–°åˆ›ä¸€ä¸ª</p>
<p>1.1. binder_new_node() åˆ›å»ºæ–°çš„ binder_node åå°±è°ƒç”¨ binder_init_node_ilocked() å°† flat_binder_object.cookie èµ‹å€¼ç»™ binder_node.cookie, å¹¶å°†æ–°çš„ binder_node æ·»åŠ åˆ°çº¢é»‘æ ‘ binder_proc.nodesä¸­</p>
</li>
<li>
<p>åœ¨ binder_inc_ref_for_node() æŸ¥æ‰¾æˆ–åˆ›å»ºä¸€ä¸ªè·Ÿ binder_node å…³è”çš„ binder_ref, å¹¶ä¸”å°†è¿™ä¸ª binder_ref è·Ÿ target_proc å…³è”</p>
<p>å‘é€ç«¯ binder_proc, binder_node, binder_ref, æ¥æ”¶ç«¯ target_proc:binder_proc å››è€…ä¹‹é—´çš„å…³ç³»å¯çœ‹ä¸‹å›¾:</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9479c3d3607247f888fc16627bda01dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiQ5Lit5LiQOTk5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754307&amp;x-signature=Xy8B9hvtuxQzulR%2FuSsbBfo14OA%3D" alt="biander1.png" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`binder_ref`</span> åœ¨å†…æ ¸ä¸­ä»£è¡¨ä¸€ä¸ª binder\_node ä¹Ÿå°±æ˜¯åº”ç”¨å±‚ IBinder çš„å¼•ç”¨å¯¹è±¡ã€‚æ¯ä¸ª <span class="hljs-string">`binder_ref`</span> éƒ½åŒ…å«å¼ºå¼•ç”¨è®¡æ•°ï¼ˆbinder\_ref.data.strongï¼‰å’Œå¼±å¼•ç”¨è®¡æ•°ï¼ˆbinder\_ref.data.weakï¼‰å­—æ®µï¼Œç”¨äºè·Ÿè¸ªæœ‰å¤šå°‘ä¸ªå¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡ã€‚
</code></pre>
<p>3.  å°† fp-&gt;hdr.type ç”± BINDER_TYPE_BINDER è½¬ä¸º BINDER_TYPE_WEAK_HANDLE , å°†ä¸Šé¢åˆ›å»ºçš„ binder_ref.data.desc èµ‹å€¼ç»™  fp-&gt;handle (flat_binder_object.handle) , fp-&gt;handle æœ€ç»ˆä¼šä¼ åˆ°æ¥æ”¶ç«¯åº”ç”¨å±‚ç¨‹åºï¼Œ æ¥æ”¶ç«¯åº”ç”¨å±‚ç¨‹åºè¦è°ƒç”¨ NfcAdaptation.mAidlCallback çš„è¯ï¼Œå°±ä¼šå‘ binder é©±åŠ¨ä¼ å…¥è¯¥ handle,  binder é©±åŠ¨å†æ ¹æ®è¯¥ handle æŸ¥æ‰¾å¯¹åº”çš„ binder_ref å’Œ binder_node , ç„¶åå°† binder_node.cookie ä¼ ç»™ NfcAdaptation, è¿™ä¸ª binder_node.cookie çš„å€¼å°±æ˜¯ NfcAdaptation.mAidlCallback çš„æŒ‡é’ˆã€‚</p>
<h6 data-id="heading-13">binder_proc_transaction()</h6>
<p>è¯¥å‡½æ•°å°†ä¸€ä¸ªäº‹åŠ¡æ’é˜Ÿåˆ°æŒ‡å®šçš„è¿›ç¨‹ä¸­ã€‚å®ƒä¼šå°è¯•åœ¨ç›®æ ‡è¿›ç¨‹ä¸­æ‰¾åˆ°ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¯¥äº‹åŠ¡å¹¶å”¤é†’å®ƒã€‚å¦‚æœæ‰¾ä¸åˆ°å¯ç”¨çš„çº¿ç¨‹ï¼Œåˆ™å°†æ­¤é¡¹å·¥ä½œæ’é˜Ÿåˆ°è¿›ç¨‹çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
<p>å› ä¸ºç¬¬ä¸€æ¬¡ transact() åœ¨ binder_transaction() é‡Œä¼ ç»™ <code>binder_proc_transaction()</code> çš„ target_thread ä¸º NULL, æ‰€ä»¥åœ¨ <code>binder_proc_transaction()</code> ä¼šèµ° <code>binder_select_thread_ilocked()</code> å»æŸ¥æ‰¾ target_proc ä¸­å¯ç”¨äºæ¥æ”¶ binder_transaction çš„çº¿ç¨‹ binder_thread</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_proc_transaction</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_transaction *t,
                    <span class="hljs-keyword">struct</span> binder_proc *proc,
                    <span class="hljs-keyword">struct</span> binder_thread *thread)</span>
</span>{
    <span class="hljs-keyword">if</span> (!thread &amp;&amp; !pending_async)
        thread = <span class="hljs-built_in">binder_select_thread_ilocked</span>(proc);

    <span class="hljs-keyword">if</span> (thread) {
        <span class="hljs-built_in">binder_transaction_priority</span>(thread, t, node);
        <span class="hljs-built_in">binder_enqueue_thread_work_ilocked</span>(thread, &amp;t-&gt;work);
    }

    <span class="hljs-keyword">if</span> (!pending_async)
        <span class="hljs-built_in">binder_wakeup_thread_ilocked</span>(proc, thread, !oneway <span class="hljs-comment">/* sync */</span>);
}
</code></pre>
<p>binder_select_thread_ilocked() ä»£ç å¦‚ä¸‹:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *
<span class="hljs-built_in">binder_select_thread_ilocked</span>(<span class="hljs-keyword">struct</span> binder_proc *proc)
{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *thread;

    <span class="hljs-built_in">assert_spin_locked</span>(&amp;proc-&gt;inner_lock);
    thread = <span class="hljs-built_in">list_first_entry_or_null</span>(&amp;proc-&gt;waiting_threads,
                      <span class="hljs-keyword">struct</span> binder_thread,
                      waiting_thread_node);

    <span class="hljs-keyword">if</span> (thread)
        <span class="hljs-built_in">list_del_init</span>(&amp;thread-&gt;waiting_thread_node);

    <span class="hljs-keyword">return</span> thread;
}
</code></pre>
<p>æ˜¯ä» proc-&gt;waiting_threads åˆ—è¡¨ä¸­å–å‡ºä¸€ä¸ª binder_threadï¼Œé‚£ç­‰å¾…çš„ binder_thread æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åŠ åˆ° waiting_threads çš„å‘¢ï¼Ÿ</p>
<p>æ¥æ”¶ç«¯çº¿ç¨‹è¿›å…¥ binder_thread_read() ç„¶åè°ƒç”¨ binder_wait_for_work() å°† binder_thread åŠ åˆ° proc-&gt;waiting_threads åˆ—è¡¨é‡Œçš„ã€‚ç„¶åè°ƒç”¨ schedule() è®©çº¿ç¨‹è¿›å…¥ç¡çœ ç­‰å¾…å‘é€ç«¯å‡†å¤‡å¥½æ•°æ®åå”¤é†’ã€‚</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">binder_thread_read</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (non_block) {
        <span class="hljs-keyword">if</span> (!binder_has_work(thread, wait_for_proc_work))
            ret = -EAGAIN;
    } <span class="hljs-keyword">else</span> {
        ret = binder_wait_for_work(thread, wait_for_proc_work);
    }
}

<span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">binder_wait_for_work</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_thread *thread,
                <span class="hljs-type">bool</span> do_proc_work)</span>
{
    <span class="hljs-keyword">for</span> (;;) {
        prepare_to_wait(&amp;thread-&gt;wait, &amp;wait, TASK_INTERRUPTIBLE);
        <span class="hljs-keyword">if</span> (do_proc_work)
            list_add(&amp;thread-&gt;waiting_thread_node,
                 &amp;proc-&gt;waiting_threads);
        schedule();
    }
}
</code></pre>
<p>å›åˆ° binder_proc_transaction() æ‰¾åˆ°ç›®æ ‡çº¿ç¨‹å:</p>
<ol>
<li>
<p>é€šè¿‡ binder_transaction_priority() ä¸´æ—¶æå‡æ¥æ”¶ç«¯çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä»¥åŒ¹é…å‘é€ç«¯çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä»è€Œé¿å…å› ä¸ºæ¥æ”¶ç«¯çº¿ç¨‹ä¼˜å…ˆçº§è¾ƒä½è€Œå¯¼è‡´çš„é«˜ä¼˜å…ˆçº§å‘é€ç«¯çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p>binder_enqueue_thread_work_ilocked() å°† t-&gt;work æ·»åŠ åˆ°ç›®æ ‡çº¿ç¨‹çš„å¾…åŠäº‹é¡¹åˆ—è¡¨binder_thread.todoä¸­ï¼Œå¹¶å¯ç”¨å¾…å¤„ç†é˜Ÿåˆ—çš„å¤„ç†ã€‚</p>
</li>
<li>
<p>binder_wakeup_thread_ilocked() å”¤é†’ç›®æ ‡çº¿ç¨‹æ¥æ¥æ”¶ binder_transaction ã€‚</p>
</li>
</ol>
<h5 data-id="heading-14">æ¥æ”¶ IBinder å¯¹è±¡</h5>
<h6 data-id="heading-15">æ¥æ”¶å‡†å¤‡</h6>
<p>android.hardware.nfc-service.example çš„å¯åŠ¨</p>
<p>hardware/interfaces/nfc/aidl/default/main.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">using</span> ::aidl::android::hardware::nfc::Nfc;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"NFC HAL starting up"</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">ABinderProcess_setThreadPoolMaxThreadCount</span>(<span class="hljs-number">1</span>)) {
        <span class="hljs-built_in">LOG</span>(INFO) &lt;&lt; <span class="hljs-string">"failed to set thread pool max thread count"</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    std::shared_ptr&lt;Nfc&gt; nfc_service = ndk::SharedRefBase::<span class="hljs-built_in">make</span>&lt;Nfc&gt;();

    <span class="hljs-type">const</span> std::string instance = std::<span class="hljs-built_in">string</span>() + Nfc::descriptor + <span class="hljs-string">"/default"</span>;
    <span class="hljs-type">binder_status_t</span> status =
            <span class="hljs-built_in">AServiceManager_addService</span>(nfc_service-&gt;<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(), instance.<span class="hljs-built_in">c_str</span>());
    <span class="hljs-built_in">CHECK</span>(status == STATUS_OK);
    <span class="hljs-built_in">ABinderProcess_joinThreadPool</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<ol>
<li>
<p>å…ˆåˆ›å»ºä¸€ä¸ª Nfc ç±»çš„æœåŠ¡ nfc_service, Nfc ç»§æ‰¿äº BnNfc, ä¹Ÿå°±æ˜¯ INfc çš„æœåŠ¡ç«¯</p>
</li>
<li>
<p>AServiceManager_addService() å°† nfc_service æ³¨å†Œåˆ° binder æœåŠ¡ä¸­</p>
</li>
<li>
<p>ABinderProcess_joinThreadPool() è®©å½“å‰çº¿ç¨‹åŠ å…¥ Binder çº¿ç¨‹æ± ï¼Œè¿›å…¥å¾ªç¯ä»¥å¤„ç†ä¼ å…¥çš„ Binder äº‹åŠ¡</p>
</li>
</ol>
<p>ABinderProcess_joinThreadPool() æºç å¦‚ä¸‹:</p>
<p>frameworks/native/libs/binder/ndk/process.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ABinderProcess_joinThreadPool</span><span class="hljs-params">()</span> </span>{
    IPCThreadState::<span class="hljs-built_in">self</span>()-&gt;<span class="hljs-built_in">joinThreadPool</span>();
}
</code></pre>
<p>frameworks/native/libs/binder/IPCThreadState.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">IPCThreadState* <span class="hljs-title">IPCThreadState::self</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IPCThreadState;
}

IPCThreadState::<span class="hljs-built_in">IPCThreadState</span>()
      : <span class="hljs-built_in">mProcess</span>(ProcessState::<span class="hljs-built_in">self</span>()),
      ....... ) {
    <span class="hljs-built_in">pthread_setspecific</span>(gTLS, <span class="hljs-keyword">this</span>);
    <span class="hljs-built_in">clearCaller</span>();
    mIn.<span class="hljs-built_in">setDataCapacity</span>(<span class="hljs-number">256</span>);
    mOut.<span class="hljs-built_in">setDataCapacity</span>(<span class="hljs-number">256</span>);
}
</code></pre>
<p>ä¸Šé¢ä»£ç :</p>
<ol>
<li>
<p>åœ¨ IPCThreadState::self() ä¸­åˆ›å»ºä¸€ä¸ªä»£è¡¨å½“å‰çº¿ç¨‹çš„ IPCThreadState</p>
</li>
<li>
<p>IPCThreadState::IPCThreadState()  ä¸­è°ƒç”¨äº† ProcessState::self() , ProcessState::self()  çš„ä»£ç æˆ‘ä»¬åœ¨å‰é¢åˆ†æè¿‡ï¼Œæ˜¯åˆ›å»ºä»£è¡¨å½“å‰è¿›ç¨‹çš„ ProcessState , å¹¶æ‰“å¼€ binder çš„é©±åŠ¨èŠ‚ç‚¹æ–‡ä»¶ "/dev/binder" ç”¨æ¥åš binder é€šä¿¡ã€‚</p>
</li>
</ol>
<p>æ¥ç€æ˜¯ joinThreadPool çš„ä»£ç :<br/>
frameworks/native/libs/binder/IPCThreadState.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">IPCThreadState::joinThreadPool</span><span class="hljs-params">(<span class="hljs-type">bool</span> isMain)</span>
</span>{
    <span class="hljs-built_in">LOG_THREADPOOL</span>(<span class="hljs-string">"**** THREAD %p (PID %d) IS JOINING THE THREAD POOL\n"</span>, (<span class="hljs-type">void</span>*)<span class="hljs-built_in">pthread_self</span>(), <span class="hljs-built_in">getpid</span>());

    mOut.<span class="hljs-built_in">writeInt32</span>(isMain ? BC_ENTER_LOOPER : BC_REGISTER_LOOPER);
    <span class="hljs-keyword">do</span> {
        <span class="hljs-built_in">processPendingDerefs</span>();
        <span class="hljs-comment">// now get the next command to be processed, waiting if necessary</span>
        result = <span class="hljs-built_in">getAndExecuteCommand</span>();
    } <span class="hljs-keyword">while</span> (result != -ECONNREFUSED &amp;&amp; result != -EBADF);
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::getAndExecuteCommand</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-type">status_t</span> result;
    <span class="hljs-type">int32_t</span> cmd;

    result = <span class="hljs-built_in">talkWithDriver</span>();
    <span class="hljs-keyword">if</span> (result &gt;= NO_ERROR) {
        cmd = mIn.<span class="hljs-built_in">readInt32</span>();
        result = <span class="hljs-built_in">executeCommand</span>(cmd);
    }
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::executeCommand</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> cmd)</span>
</span>{
    <span class="hljs-keyword">switch</span> ((<span class="hljs-type">uint32_t</span>)cmd) {
    <span class="hljs-keyword">case</span> BR_TRANSACTION:
        {
            binder_transaction_data_secctx tr_secctx;
            binder_transaction_data&amp; tr = tr_secctx.transaction_data;
            <span class="hljs-keyword">if</span> (tr.target.ptr) {
                <span class="hljs-comment">// We only have a weak reference on the target object, so we must first try to</span>
                <span class="hljs-comment">// safely acquire a strong reference before doing anything else with it.</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">reinterpret_cast</span>&lt;RefBase::weakref_type*&gt;(
                        tr.target.ptr)-&gt;<span class="hljs-built_in">attemptIncStrong</span>(<span class="hljs-keyword">this</span>)) {
                    error = <span class="hljs-built_in">reinterpret_cast</span>&lt;BBinder*&gt;(tr.cookie)-&gt;<span class="hljs-built_in">transact</span>(tr.code, buffer,
                            &amp;reply, tr.flags);
                    <span class="hljs-built_in">reinterpret_cast</span>&lt;BBinder*&gt;(tr.cookie)-&gt;<span class="hljs-built_in">decStrong</span>(<span class="hljs-keyword">this</span>);
                } <span class="hljs-keyword">else</span> {
                    error = UNKNOWN_TRANSACTION;
                }

            } <span class="hljs-keyword">else</span> {
                error = the_context_object-&gt;<span class="hljs-built_in">transact</span>(tr.code, buffer, &amp;reply, tr.flags);
            }
        }
    }
}
</code></pre>
<p>joinThreadPool() é‡Œçš„å…³é”®è°ƒç”¨é“¾æ˜¯:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">joinThreadPool</span>()
<span class="hljs-built_in">getAndExecuteCommand</span>()
    <span class="hljs-built_in">talkWithDriver</span>()
<span class="hljs-built_in">executeCommand</span>()
</code></pre>
<p>å½“è¿›å…¥ talkWithDriver() åï¼Œä¹Ÿä¼šè·Ÿå‘é€ç«¯ä¸€æ ·ï¼Œè°ƒç”¨ <code>ioctl()</code> è¿›å…¥å†…æ ¸æ€</p>
<p>å› ä¸º getAndExecuteCommand() å‰æœ‰ä¸€å¥:</p>
<pre><code class="hljs language-cpp" lang="cpp">mOut.<span class="hljs-built_in">writeInt32</span>(isMain ? BC_ENTER_LOOPER : BC_REGISTER_LOOPER);
</code></pre>
<p>æ‰€ä»¥åœ¨å†…æ ¸é©±åŠ¨ä¸­å…ˆä¼šèµ°åˆ°:</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_thread_write</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
            <span class="hljs-keyword">struct</span> binder_thread *thread,
            <span class="hljs-type">binder_uintptr_t</span> binder_buffer, <span class="hljs-type">size_t</span> size,
            <span class="hljs-type">binder_size_t</span> *consumed)</span>
</span>{
    <span class="hljs-keyword">switch</span> (cmd) {
    <span class="hljs-keyword">case</span> BC_ENTER_LOOPER:
        <span class="hljs-built_in">binder_debug</span>(BINDER_DEBUG_THREADS,
                 <span class="hljs-string">"%d:%d BC_ENTER_LOOPER\n"</span>,
                 proc-&gt;pid, thread-&gt;pid);
        <span class="hljs-keyword">if</span> (thread-&gt;looper &amp; BINDER_LOOPER_STATE_REGISTERED) {
            thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID;
            <span class="hljs-built_in">binder_user_error</span>(<span class="hljs-string">"%d:%d ERROR: BC_ENTER_LOOPER called after BC_REGISTER_LOOPER\n"</span>,
                proc-&gt;pid, thread-&gt;pid);
        }
        thread-&gt;looper |= BINDER_LOOPER_STATE_ENTERED;
        <span class="hljs-keyword">break</span>;
    }
}
</code></pre>
<p>æ ‡è¯† android.hardware.nfc-service.example ä¸»çº¿ç¨‹å·²ç»æˆåŠŸè¿›å…¥äº† Binder çš„ä¸»å¾ªç¯ï¼Œæ­£åœ¨ç­‰å¾…å’Œå¤„ç†æ¥è‡ª Binder é©±åŠ¨çš„äº‹åŠ¡ï¼ˆTransactionï¼‰ ã€‚</p>
<h6 data-id="heading-16">binder_thread_read()</h6>
<p>æ¥ç€é©±åŠ¨è¿›å…¥ binder_thread_read() ç„¶åå¦‚ä¹‹å‰æ‰€è¿°ï¼Œè°ƒç”¨ binder_wait_for_work() å°†å½“å‰çº¿ç¨‹çš„ binder_thread åŠ åˆ° proc-&gt;waiting_threads åˆ—è¡¨é‡Œçš„ã€‚ç„¶åè°ƒç”¨ schedule() è®©çº¿ç¨‹è¿›å…¥ç¡çœ ç­‰å¾…å‘é€ç«¯å‡†å¤‡å¥½æ•°æ®åå”¤é†’ã€‚</p>
<p>kernel5.4/drivers/android/binder.c</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_thread_read</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (non_block) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">binder_has_work</span>(thread, wait_for_proc_work))
            ret = -EAGAIN;
    } <span class="hljs-keyword">else</span> {
        ret = <span class="hljs-built_in">binder_wait_for_work</span>(thread, wait_for_proc_work);
    }
    thread-&gt;looper &amp;= ~BINDER_LOOPER_STATE_WAITING;

    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
        <span class="hljs-type">uint32_t</span> cmd;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction_data_secctx</span> tr;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction_data</span> *trd = &amp;tr.transaction_data;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_work</span> *w = <span class="hljs-literal">NULL</span>;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">list_head</span> *list = <span class="hljs-literal">NULL</span>;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction</span> *t = <span class="hljs-literal">NULL</span>;

        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">binder_worklist_empty_ilocked</span>(&amp;thread-&gt;todo)) {
            list = &amp;thread-&gt;todo;
            <span class="hljs-keyword">if</span> (nfc_hal_pid == proc-&gt;pid || nfc_pid == proc-&gt;pid) {
                <span class="hljs-built_in">pr_err</span>(<span class="hljs-string">"%s: get thread-&gt;todo\n"</span>, __func__);
            }
        } 
    
        w = <span class="hljs-built_in">binder_dequeue_work_head_ilocked</span>(list);
        <span class="hljs-keyword">switch</span> (w-&gt;type) {
        <span class="hljs-keyword">case</span> BINDER_WORK_TRANSACTION: {
            <span class="hljs-built_in">binder_inner_proc_unlock</span>(proc);
            t = <span class="hljs-built_in">container_of</span>(w, <span class="hljs-keyword">struct</span> binder_transaction, work);
        } <span class="hljs-keyword">break</span>;


        <span class="hljs-keyword">if</span> (t-&gt;buffer-&gt;target_node) {
            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *target_node = t-&gt;buffer-&gt;target_node;

            trd-&gt;target.ptr = target_node-&gt;ptr;
            trd-&gt;cookie =  target_node-&gt;cookie;
            <span class="hljs-built_in">binder_transaction_priority</span>(thread, t, target_node);
            cmd = BR_TRANSACTION;
        }

        trd-&gt;code = t-&gt;code;
        trd-&gt;data_size = t-&gt;buffer-&gt;data_size;
        trd-&gt;offsets_size = t-&gt;buffer-&gt;offsets_size;
        trd-&gt;data.ptr.buffer = (<span class="hljs-type">uintptr_t</span>)t-&gt;buffer-&gt;user_data;

        <span class="hljs-built_in">put_user</span>(cmd, (<span class="hljs-type">uint32_t</span> __user *)ptr);
        <span class="hljs-built_in">copy_to_user</span>(ptr, &amp;tr, trsize);
    }
}

<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_wait_for_work</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_thread *thread,
                <span class="hljs-type">bool</span> do_proc_work)</span>
</span>{
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-built_in">prepare_to_wait</span>(&amp;thread-&gt;wait, &amp;wait, TASK_INTERRUPTIBLE);
        <span class="hljs-keyword">if</span> (do_proc_work)
            <span class="hljs-built_in">list_add</span>(&amp;thread-&gt;waiting_thread_node,
                 &amp;proc-&gt;waiting_threads);
        <span class="hljs-built_in">schedule</span>();
    }
}
</code></pre>
<p>æ¥æ”¶ç«¯çº¿ç¨‹è¢«å‘é€ç«¯åœ¨ binder_proc_transaction() å‡½æ•°ä¸­å”¤é†’åï¼Œå°±ä» binder_wait_for_work() é€€å‡ºï¼Œèµ°åˆ° while (1) å¾ªç¯ä¸­ï¼Œ é€šè¿‡</p>
<pre><code class="hljs language-cpp" lang="cpp">list = &amp;thread-&gt;todo; 
<span class="hljs-built_in">binder_dequeue_work_head_ilocked</span>(list);
</code></pre>
<p>ä» thread-&gt;todo å–å‡ºåœ¨ binder_proc_transaction() ä¸­æ·»åŠ çš„ binder_work , å†é€šè¿‡ <code>container_of(w, struct binder_transaction, work)</code> å–åˆ° w çš„æ‰€å± binder_transaction ç»“æ„ä½“ã€‚</p>
<p>å–åˆ° binder_transaction åï¼Œå°±å°† binder_transaction çš„æ•°æ®æ‰“åŒ…åˆ° <code>struct binder_transaction_data *trd</code>ï¼Œ ç„¶åé€šè¿‡ copy_to_user() ä¼ ç»™åº”ç”¨å±‚ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp">    trd-&gt;code = t-&gt;code;
    trd-&gt;data_size = t-&gt;buffer-&gt;data_size;
    trd-&gt;offsets_size = t-&gt;buffer-&gt;offsets_size;

    <span class="hljs-built_in">put_user</span>(cmd, (<span class="hljs-type">uint32_t</span> __user *)ptr);
    <span class="hljs-built_in">copy_to_user</span>(ptr, &amp;tr, trsize);
</code></pre>
<p>struct binder_transaction_data_secctx tr çš„æ•°æ®ç»“æ„å®šä¹‰å¦‚ä¸‹:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction_data_secctx</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction_data</span> transaction_data;
    <span class="hljs-type">binder_uintptr_t</span> secctx;
};
</code></pre>
<p>æ‰€ä»¥, <code>copy_to_user(ptr, &amp;tr, trsize)</code> ä¸­ &amp;tr ä¹Ÿå°±æ˜¯ trd çš„åœ°å€ã€‚</p>
<h6 data-id="heading-17">è¿”å›åº”ç”¨å±‚</h6>
<p>æ”¶åˆ°æ•°æ®åº”ç”¨å±‚ä¹Ÿä» IPCThreadState::talkWithDriver() ä¸­çš„ <code>ioctl()</code> é†’æ¥ï¼Œé€€å‡º IPCThreadState::talkWithDriver() æ¥åˆ° IPCThreadState::executeCommand() èµ°</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">reinterpret_cast</span>&lt;BBinder*&gt;(tr.cookie)-&gt;<span class="hljs-built_in">transact</span>(tr.code, buffer,
                            &amp;reply, tr.flags)
</code></pre>
<p>æœ€ç»ˆæ¥åˆ°<br/>
out/soong/.intermediates/hardware/interfaces/nfc/aidl/android.hardware.nfc-V1-ndk-source/gen/android/hardware/nfc/INfc.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">namespace</span> aidl {
<span class="hljs-keyword">namespace</span> android {
<span class="hljs-keyword">namespace</span> hardware {
<span class="hljs-keyword">namespace</span> nfc {
<span class="hljs-type">static</span> <span class="hljs-type">binder_status_t</span> _aidl_android_hardware_nfc_INfc_onTransact(AIBinder* _aidl_binder, <span class="hljs-type">transaction_code_t</span> _aidl_code, <span class="hljs-type">const</span> AParcel* _aidl_in, AParcel* _aidl_out) {
  (<span class="hljs-type">void</span>)_aidl_in;
  (<span class="hljs-type">void</span>)_aidl_out;
  <span class="hljs-type">binder_status_t</span> _aidl_ret_status = STATUS_UNKNOWN_TRANSACTION;
  std::shared_ptr&lt;BnNfc&gt; _aidl_impl = std::<span class="hljs-built_in">static_pointer_cast</span>&lt;BnNfc&gt;(::ndk::ICInterface::<span class="hljs-built_in">asInterface</span>(_aidl_binder));
  <span class="hljs-keyword">switch</span> (_aidl_code) {
    <span class="hljs-built_in">case</span> (FIRST_CALL_TRANSACTION + <span class="hljs-number">0</span> <span class="hljs-comment">/*open*/</span>): {
      std::shared_ptr&lt;::aidl::android::hardware::nfc::INfcClientCallback&gt; in_clientCallback;

      _aidl_ret_status = ::ndk::<span class="hljs-built_in">AParcel_readData</span>(_aidl_in, &amp;in_clientCallback);
      <span class="hljs-keyword">if</span> (_aidl_ret_status != STATUS_OK) <span class="hljs-keyword">break</span>;

      ::ndk::ScopedAStatus _aidl_status = _aidl_impl-&gt;<span class="hljs-built_in">open</span>(in_clientCallback);
      _aidl_ret_status = <span class="hljs-built_in">AParcel_writeStatusHeader</span>(_aidl_out, _aidl_status.<span class="hljs-built_in">get</span>());
      <span class="hljs-keyword">if</span> (_aidl_ret_status != STATUS_OK) <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">AStatus_isOk</span>(_aidl_status.<span class="hljs-built_in">get</span>())) <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">break</span>;
    }
}
</code></pre>
<p>ç»è¿‡ä»¥ä¸‹è°ƒç”¨é“¾ï¼Œä»£ç æ¥åˆ°äº† Parcel::unflattenBinder()</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">AParcel_readData</span>()
<span class="hljs-built_in">AParcel_readRequiredStrongBinder</span>()
<span class="hljs-built_in">AParcel_readStrongBinder</span>()
Parcel::<span class="hljs-built_in">readNullableStrongBinder</span>()
Parcel::<span class="hljs-built_in">unflattenBinder</span>()
</code></pre>
<p>ä»£ç :<br/>
frameworks/native/libs/binder/ndk/include_cpp/android/binder_parcel_utils.h</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">binder_status_t</span> <span class="hljs-title">AParcel_readData</span><span class="hljs-params">(<span class="hljs-type">const</span> AParcel* parcel, T* value)</span> </span>{
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">constexpr</span> (std::is_same_v&lt;SpAIBinder, T&gt;) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">AParcel_readRequiredStrongBinder</span>(parcel, value);
}

<span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">binder_status_t</span> <span class="hljs-title">AParcel_readRequiredStrongBinder</span><span class="hljs-params">(<span class="hljs-type">const</span> AParcel* parcel,
                                                               SpAIBinder* binder)</span> </span>{
    AIBinder* readBinder;
    <span class="hljs-type">binder_status_t</span> ret = <span class="hljs-built_in">AParcel_readStrongBinder</span>(parcel, &amp;readBinder);
    <span class="hljs-keyword">if</span> (ret == STATUS_OK) {
        <span class="hljs-keyword">if</span> (readBinder == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">return</span> STATUS_UNEXPECTED_NULL;
        }

        binder-&gt;<span class="hljs-built_in">set</span>(readBinder);
    }
    <span class="hljs-keyword">return</span> ret;
}

</code></pre>
<p>frameworks/native/libs/binder/ndk/parcel.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">binder_status_t</span> <span class="hljs-title">AParcel_readStrongBinder</span><span class="hljs-params">(<span class="hljs-type">const</span> AParcel* parcel, AIBinder** binder)</span> </span>{
    sp&lt;IBinder&gt; readBinder = <span class="hljs-literal">nullptr</span>;
    <span class="hljs-type">status_t</span> status = parcel-&gt;<span class="hljs-built_in">get</span>()-&gt;<span class="hljs-built_in">readNullableStrongBinder</span>(&amp;readBinder);
    <span class="hljs-keyword">if</span> (status != STATUS_OK) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">PruneStatusT</span>(status);
    }
    sp&lt;AIBinder&gt; ret = ABpBinder::<span class="hljs-built_in">lookupOrCreateFromBinder</span>(readBinder);
    <span class="hljs-built_in">AIBinder_incStrong</span>(ret.<span class="hljs-built_in">get</span>());
    *binder = ret.<span class="hljs-built_in">get</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">PruneStatusT</span>(status);
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">Parcel::readNullableStrongBinder</span><span class="hljs-params">(sp&lt;IBinder&gt;* val)</span> <span class="hljs-type">const</span>
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">unflattenBinder</span>(val);
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">Parcel::unflattenBinder</span><span class="hljs-params">(sp&lt;IBinder&gt;* out)</span> <span class="hljs-type">const</span>
</span>{
    <span class="hljs-type">const</span> flat_binder_object* flat = <span class="hljs-built_in">readObject</span>(<span class="hljs-literal">false</span>);

    <span class="hljs-keyword">if</span> (flat) {
        <span class="hljs-keyword">switch</span> (flat-&gt;hdr.type) {
            <span class="hljs-keyword">case</span> BINDER_TYPE_BINDER: {
                sp&lt;IBinder&gt; binder =
                        sp&lt;IBinder&gt;::<span class="hljs-built_in">fromExisting</span>(<span class="hljs-built_in">reinterpret_cast</span>&lt;IBinder*&gt;(flat-&gt;cookie));
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">finishUnflattenBinder</span>(binder, out);
            }
            <span class="hljs-keyword">case</span> BINDER_TYPE_HANDLE: {
                sp&lt;IBinder&gt; binder =
                    ProcessState::<span class="hljs-built_in">self</span>()-&gt;<span class="hljs-built_in">getStrongProxyForHandle</span>(flat-&gt;handle);
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">finishUnflattenBinder</span>(binder, out);
            }
        }
    }
}
</code></pre>
<p>å› ä¸ºåœ¨ binder_translate_binder() ä¸­ï¼Œflat_binder_object.hdr.type å·²ç»ç”± BINDER_TYPE_BINDER è½¬ä¸º BINDER_TYPE_WEAK_HANDLE , æ‰€ä»¥ Parcel::unflattenBinder() é‡Œèµ°çš„ case BINDER_TYPE_HANDLE åˆ†æ”¯ã€‚</p>
<p>ProcessState::self()-&gt;getStrongProxyForHandle(flat-&gt;handle) ä»¥ flat-&gt;handle ä¸ºæ ‡è¯†åˆ›å»ºäº†ä¸€ä¸ª BpBinder å¯¹è±¡ï¼Œç”¨æ¥åœ¨ android.hardware.nfc-service.example é‡Œä»£è¡¨ <code>NfcAdaptation.mAidlCallback</code> ã€‚</p>
<p>getStrongProxyForHandle()æºç å¦‚ä¸‹:<br/>
frameworks/native/libs/binder/ProcessState.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">sp&lt;IBinder&gt; <span class="hljs-title">ProcessState::getStrongProxyForHandle</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> handle)</span>
</span>{
    sp&lt;IBinder&gt; result;
    handle_entry* e = <span class="hljs-built_in">lookupHandleLocked</span>(handle);
    <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">nullptr</span>) {
        IBinder* b = e-&gt;binder;
        <span class="hljs-keyword">if</span> (b == <span class="hljs-literal">nullptr</span> || !e-&gt;refs-&gt;<span class="hljs-built_in">attemptIncWeak</span>(<span class="hljs-keyword">this</span>)) {
            sp&lt;BpBinder&gt; b = BpBinder::PrivateAccessor::<span class="hljs-built_in">create</span>(handle);
            e-&gt;binder = b.<span class="hljs-built_in">get</span>();
            <span class="hljs-keyword">if</span> (b) e-&gt;refs = b-&gt;<span class="hljs-built_in">getWeakRefs</span>();
            result = b;
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>ä» Parcel::unflattenBinder() è¿”å›åï¼Œå†ç»è¿‡</p>
<pre><code class="hljs language-cpp" lang="cpp">Parcel::<span class="hljs-built_in">readNullableStrongBinder</span>()
<span class="hljs-built_in">AParcel_readStrongBinder</span>()
<span class="hljs-built_in">AParcel_readRequiredStrongBinder</span>()
<span class="hljs-built_in">AParcel_readData</span>()
</code></pre>
<p>çš„å±‚å±‚åŒ…è£…ï¼Œå°† BpBinder å¯¹è±¡åŒ…è£…æˆ SpAIBinderã€‚</p>
<p>æœ€åæ¥åˆ° _aidl_android_hardware_nfc_INfc_onTransact çš„ _aidl_impl-&gt;open(in_clientCallback) ä¹Ÿå°±æ˜¯
hardware/interfaces/nfc/aidl/default/Nfc.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp">::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Nfc::open</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;INfcClientCallback&gt;&amp; clientCallback)</span> </span>{
    Nfc::mCallback = clientCallback;
}
</code></pre>
<p>å°† <code>NfcAdaptation.mAidlCallback</code> çš„æ›¿èº«èµ‹å€¼ç»™ Nfc::mCallback ã€‚</p>
<p>å°†æ¥ android.hardware.nfc-service.example è°ƒç”¨ Nfc::mCallback ä¹Ÿå°±æ˜¯ <code>NfcAdaptation.mAidlCallback</code> æ—¶ï¼Œä¼šå¾€åœ¨ SpAIBinder é‡ŒæŸ¥æ‰¾ BpBinder , å†è·å– BpBinder çš„handle, ç„¶åå¾€ binder é©±åŠ¨ä¼ å…¥è¯¥ handle,  binder é©±åŠ¨å†æ ¹æ®è¯¥ handle æŸ¥æ‰¾å¯¹åº”çš„ binder_ref å’Œ binder_node , ç„¶åå°† binder_node.cookie ä¼ ç»™ NfcAdaptation, è¿™ä¸ª binder_node.cookie çš„å€¼å°±æ˜¯ <code>NfcAdaptation.mAidlCallback</code> çš„çœŸå®æŒ‡é’ˆ, é€šè¿‡è¿™ä¸ªæŒ‡é’ˆï¼Œå°±å¯ä»¥è°ƒç”¨ <code>NfcAdaptation.mAidlCallback</code> çš„æ–¹æ³•ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº† binder ä¼ é€’ ä¸€ä¸ª IBinder å¯¹è±¡ (NfcAdaptation.mAidlCallback) çš„æµç¨‹åˆ†æã€‚</p>
<h3 data-id="heading-18">ä½¿ç”¨å›è°ƒç±» IBinder å¯¹è±¡</h3>
<p>ä»¥ android.hardware.nfc-service.example è°ƒç”¨ INfcClientCallback ä¸ºä¾‹è§£æè°ƒç”¨  IBinder å¯¹è±¡çš„è¯¦ç»†æµç¨‹ã€‚</p>
<h4 data-id="heading-19">å›è°ƒå‰çš„å‡†å¤‡</h4>
<p>hardware/interfaces/nfc/aidl/default/Nfc.cpp
Nfc::open å°† <code>NfcAdaptation.mAidlCallback</code> çš„æ›¿èº«èµ‹å€¼ç»™ Nfc::mCallback åï¼Œæ¥ç€å°† Nfc::eventCallback() Nfc::dataCallback() ä¸¤ä¸ªå‡½æ•°ä¼ ç»™ Vendor_hal_open():</p>
<pre><code class="hljs language-cpp" lang="cpp">::<span class="hljs-function">ndk::ScopedAStatus <span class="hljs-title">Nfc::open</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;INfcClientCallback&gt;&amp; clientCallback)</span> </span>{
    Nfc::mCallback = clientCallback;
    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">Vendor_hal_open</span>(eventCallback, dataCallback);
}
</code></pre>
<p>Nfc::eventCallback() Nfc::dataCallback() ä¸¤ä¸ªå‡½æ•°çš„å®šä¹‰å¦‚ä¸‹:</p>
<p>hardware/interfaces/nfc/aidl/default/Nfc.h</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Nfc</span> : <span class="hljs-keyword">public</span> BnNfc {
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">eventCallback</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> event, <span class="hljs-type">uint8_t</span> status)</span> </span>{
        <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">auto</span> ret = mCallback-&gt;<span class="hljs-built_in">sendEvent</span>((NfcEvent)event, (NfcStatus)status);
            <span class="hljs-keyword">if</span> (!ret.<span class="hljs-built_in">isOk</span>()) {
                <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to send event!"</span>;
            }
        }
    }

    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">dataCallback</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> data_len, <span class="hljs-type">uint8_t</span>* p_data)</span> </span>{
        <span class="hljs-function">std::vector&lt;<span class="hljs-type">uint8_t</span>&gt; <span class="hljs-title">data</span><span class="hljs-params">(p_data, p_data + data_len)</span></span>;
        <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">auto</span> ret = mCallback-&gt;<span class="hljs-built_in">sendData</span>(data);
            <span class="hljs-keyword">if</span> (!ret.<span class="hljs-built_in">isOk</span>()) {
                <span class="hljs-built_in">LOG</span>(ERROR) &lt;&lt; <span class="hljs-string">"Failed to send data!"</span>;
            }
        }
    }
}
</code></pre>
<p>Nfc::eventCallback()ã€ Nfc::dataCallback() åˆ†åˆ«è°ƒç”¨äº† mCallback-&gt;sendEvent() å’Œ mCallback-&gt;sendData() ç»™ NfcAdaptation ä¸Šå‘äº‹ä»¶å’Œæ•°æ®ã€‚</p>
<p>Vendor_hal_open() çš„å®ç°å¦‚ä¸‹:<br/>
hardware/interfaces/nfc/aidl/default/Vendor_hal_api.cpp</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">static</span> <span class="hljs-type">nfc_stack_callback_t</span>* p_nfc_stack_cback;
<span class="hljs-type">static</span> <span class="hljs-type">nfc_stack_data_callback_t</span>* p_nfc_stack_data_cback;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Vendor_hal_open</span><span class="hljs-params">(<span class="hljs-type">nfc_stack_callback_t</span>* p_cback, <span class="hljs-type">nfc_stack_data_callback_t</span>* p_data_cback)</span> </span>{
    p_nfc_stack_cback = p_cback;
    p_nfc_stack_data_cback = p_data_cback;

    <span class="hljs-built_in">p_nfc_stack_cback</span>(HAL_NFC_OPEN_CPLT_EVT, HAL_NFC_STATUS_OK);
    <span class="hljs-keyword">return</span> HAL_NFC_STATUS_OK;
}
</code></pre>
<p>Vendor_hal_open() é‡Œåˆ†åˆ«å°† Nfc::eventCallback()ã€ Nfc::dataCallback() èµ‹å€¼ç»™äº† p_nfc_stack_cback, p_nfc_stack_data_cback è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆã€‚</p>
<p>Vendor_hal_open() åœ¨è¿”å›å‰, é€šè¿‡ <code>p_nfc_stack_cback(HAL_NFC_OPEN_CPLT_EVT, HAL_NFC_STATUS_OK)</code> ç»™ NfcAdaptation å‘é€äº† HAL_NFC_OPEN_CPLT_EVT äº‹ä»¶ã€‚</p>
<h4 data-id="heading-20">è¿›å…¥é©±åŠ¨ä¹‹å‰çš„å¤„ç†æµç¨‹</h4>
<p>p_nfc_stack_cback æŒ‡å‘ Nfc::eventCallback() æ‰€ä»¥è°ƒç”¨é“¾å¦‚ä¸‹:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">p_nfc_stack_cback</span>(HAL_NFC_OPEN_CPLT_EVT, HAL_NFC_STATUS_OK)
Nfc::<span class="hljs-built_in">eventCallback</span>()
INfcClientCallback::<span class="hljs-built_in">sendEvent</span>()
BpNfcClientCallback::<span class="hljs-built_in">sendEvent</span>(NfcEvent in_event, NfcStatus in_status)
    ::ndk::ScopedAParcel _aidl_in;
    <span class="hljs-comment">/* ä¸º Binder è°ƒç”¨å‡†å¤‡ä¸€ä¸ª Parcel å¯¹è±¡ */</span>
    <span class="hljs-built_in">AIBinder_prepareTransaction</span>(<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(), _aidl_in.<span class="hljs-built_in">getR</span>())
    <span class="hljs-comment">/* å°†äº‹ä»¶å·å†™å…¥ _aidl_in */</span>
    <span class="hljs-built_in">AParcel_writeData</span>(_aidl_in.<span class="hljs-built_in">get</span>(), in_event)
    <span class="hljs-comment">/* å°†äº‹ä»¶è¿”å›çŠ¶æ€å†™å…¥ _aidl_in */</span>
    <span class="hljs-built_in">AParcel_writeData</span>(_aidl_in.<span class="hljs-built_in">get</span>(), in_status)
    <span class="hljs-comment">/* æ‰§è¡Œ Binder è°ƒç”¨ */</span>
    <span class="hljs-built_in">AIBinder_transact</span>(<span class="hljs-built_in">asBinder</span>().<span class="hljs-built_in">get</span>(), (FIRST_CALL_TRANSACTION + <span class="hljs-number">1</span> <span class="hljs-comment">/*sendEvent*/</span>),
        _aidl_in.<span class="hljs-built_in">getR</span>(),
        _aidl_out.<span class="hljs-built_in">getR</span>(),
        <span class="hljs-number">0</span>
        <span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> BINDER_STABILITY_SUPPORT</span>
        | FLAG_PRIVATE_LOCAL
        <span class="hljs-meta">#<span class="hljs-keyword">endif</span>  <span class="hljs-comment">// BINDER_STABILITY_SUPPORT</span></span>
    );
    <span class="hljs-comment">/* ä» Binder è°ƒç”¨çš„è¿”å›å€¼é‡Œè¯»å‡ºæ‰€è¦çš„ä¿¡æ¯ */</span>
    <span class="hljs-built_in">AParcel_readStatusHeader</span>(_aidl_out.<span class="hljs-built_in">get</span>(), _aidl_status.<span class="hljs-built_in">getR</span>())
</code></pre>
<p>AIBinder_transact() çš„è°ƒç”¨é“¾å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">AIBinder_transact</span>()
BpBinder::<span class="hljs-built_in">transact</span>()
    IPCThreadState::<span class="hljs-built_in">self</span>()-&gt;<span class="hljs-built_in">transact</span>(<span class="hljs-built_in">binderHandle</span>(), code, data, reply, flags)
IPCThreadState::<span class="hljs-built_in">transact</span>()
    IPCThreadState::<span class="hljs-built_in">writeTransactionData</span>()
    IPCThreadState::<span class="hljs-built_in">waitForResponse</span>()
        IPCThreadState::<span class="hljs-built_in">talkWithDriver</span>()
            <span class="hljs-built_in">ioctl</span>(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr)
</code></pre>
<p>å…¶ä¸­ binderHandle() å¯¹åº”çš„å°±æ˜¯åœ¨</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function">sp&lt;IBinder&gt; <span class="hljs-title">ProcessState::getStrongProxyForHandle</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> handle)</span>
</span>{
    sp&lt;IBinder&gt; result;
    handle_entry* e = <span class="hljs-built_in">lookupHandleLocked</span>(handle);
    <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">nullptr</span>) {
        IBinder* b = e-&gt;binder;
        <span class="hljs-keyword">if</span> (b == <span class="hljs-literal">nullptr</span> || !e-&gt;refs-&gt;<span class="hljs-built_in">attemptIncWeak</span>(<span class="hljs-keyword">this</span>)) {
            sp&lt;BpBinder&gt; b = BpBinder::PrivateAccessor::<span class="hljs-built_in">create</span>(handle);
            e-&gt;binder = b.<span class="hljs-built_in">get</span>();
            <span class="hljs-keyword">if</span> (b) e-&gt;refs = b-&gt;<span class="hljs-built_in">getWeakRefs</span>();
            result = b;
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>é‡Œç”¨æ¥åˆ›å»º Nfc::mCallback ç”¨åˆ°çš„ handle ã€‚<br/>
æ¥ç€ç”¨æ¥åˆ°äº† IPCThreadState::transact()</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::transact</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> handle,
                                  <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data,
                                  Parcel* reply, <span class="hljs-type">uint32_t</span> flags)</span>
</span>{
    err = <span class="hljs-built_in">writeTransactionData</span>(BC_TRANSACTION, flags, handle, code, data, <span class="hljs-literal">nullptr</span>);
}

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">IPCThreadState::writeTransactionData</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> cmd, <span class="hljs-type">uint32_t</span> binderFlags,
    <span class="hljs-type">int32_t</span> handle, <span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> Parcel&amp; data, <span class="hljs-type">status_t</span>* statusBuffer)</span>
</span>{
    binder_transaction_data tr;
    tr.target.handle = handle;
    tr.code = code;

    tr.data_size = data.<span class="hljs-built_in">ipcDataSize</span>();
    tr.data.ptr.buffer = data.<span class="hljs-built_in">ipcData</span>();
    tr.offsets_size = data.<span class="hljs-built_in">ipcObjectsCount</span>()*<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">binder_size_t</span>);
    tr.data.ptr.offsets = data.<span class="hljs-built_in">ipcObjects</span>();

    mOut.<span class="hljs-built_in">writeInt32</span>(cmd);
    mOut.<span class="hljs-built_in">write</span>(&amp;tr, <span class="hljs-built_in">sizeof</span>(tr));
}
</code></pre>
<p>æˆ‘ä»¬ç°åœ¨é‡ç‚¹å…³æ³¨ handle å’Œ code çš„ä¼ é€’ã€‚å¦‚ä¸Š IPCThreadState::writeTransactionData() ä»£ç æ‰€ç¤º,  handle å’Œ code éƒ½è¢«æ‰“åŒ…è¿›äº† binder_transaction_data æ•°æ®ç»“æ„ä¸­, binder_transaction_data å°†é€šè¿‡  IPCThreadState::waitForResponse() --&gt; IPCThreadState::talkWithDriver() --&gt; ioctl() ä¼ åˆ° binder é©±åŠ¨é‡Œã€‚</p>
<h4 data-id="heading-21">è¿›å…¥é©±åŠ¨</h4>
<h5 data-id="heading-22">å‘èµ·ç«¯</h5>
<h6 data-id="heading-23">binder_transaction()</h6>
<p>ç»è¿‡</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">//ç”¨æˆ·å±‚:</span>
<span class="hljs-built_in">ioctl</span>()

<span class="hljs-comment">//å†…æ ¸é©±åŠ¨:</span>
<span class="hljs-built_in">binder_ioctl</span>()
<span class="hljs-built_in">binder_ioctl_write_read</span>()
<span class="hljs-built_in">binder_thread_write</span>()
<span class="hljs-built_in">binder_transaction</span>()
</code></pre>
<p>æˆ‘ä»¬åˆæ¥åˆ°äº† binder_transaction() å‡½æ•°ã€‚è¿™æ¬¡æˆ‘ä»¬æ¥çœ‹çœ‹é©±åŠ¨é‡Œå¦‚ä½•æ ¹æ® handle æ‰¾åˆ°ç›®æ ‡ Binder æ‰§è¡Œå¯¹è±¡ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">binder_transaction</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
                   <span class="hljs-keyword">struct</span> binder_thread *thread,
                   <span class="hljs-keyword">struct</span> binder_transaction_data *tr, <span class="hljs-type">int</span> reply,
                   <span class="hljs-type">binder_size_t</span> extra_buffers_size)</span>
</span>{
    <span class="hljs-type">int</span> ret;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction</span> *t;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_work</span> *w;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_proc</span> *target_proc = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *target_thread = <span class="hljs-literal">NULL</span>;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *target_node = <span class="hljs-literal">NULL</span>;

    <span class="hljs-keyword">if</span> (reply) {
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">struct</span> binder_ref *ref;

        <span class="hljs-comment">/*
         * There must already be a strong ref
         * on this node. If so, do a strong
         * increment on the node to ensure it
         * stays alive until the transaction is
         * done.
         */</span>
        <span class="hljs-built_in">binder_proc_lock</span>(proc);
        ref = <span class="hljs-built_in">binder_get_ref_olocked</span>(proc, tr-&gt;target.handle,
                         <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">if</span> (ref) {
            target_node = <span class="hljs-built_in">binder_get_node_refs_for_txn</span>(
                    ref-&gt;node, &amp;target_proc,
                    &amp;return_error);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">binder_user_error</span>(<span class="hljs-string">"%d:%d got transaction to invalid handle\n"</span>,
                      proc-&gt;pid, thread-&gt;pid);
            return_error = BR_FAILED_REPLY;
        }
        <span class="hljs-built_in">binder_proc_unlock</span>(proc);
    }
}
</code></pre>
<p>æ ¹æ® IPCThreadState::transact() ä¼ ä¸‹æ¥çš„ tr-&gt;target.handle åœ¨å½“å‰ binder_proc ä¸­æŸ¥æ‰¾ binder_ref</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_ref</span> *<span class="hljs-built_in">binder_get_ref_olocked</span>(<span class="hljs-keyword">struct</span> binder_proc *proc,
                         u32 desc, <span class="hljs-type">bool</span> need_strong_ref)
{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">rb_node</span> *n = proc-&gt;refs_by_desc.rb_node;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_ref</span> *ref;

    <span class="hljs-keyword">while</span> (n) {
        ref = <span class="hljs-built_in">rb_entry</span>(n, <span class="hljs-keyword">struct</span> binder_ref, rb_node_desc);

        <span class="hljs-keyword">if</span> (desc &lt; ref-&gt;data.desc) {
            n = n-&gt;rb_left;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (desc &gt; ref-&gt;data.desc) {
            n = n-&gt;rb_right;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (need_strong_ref &amp;&amp; !ref-&gt;data.strong) {
            <span class="hljs-built_in">binder_user_error</span>(<span class="hljs-string">"tried to use weak ref as strong ref\n"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> ref;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
</code></pre>
<p>binder_get_ref_olocked() å°±æ˜¯éå† binder_proc.refs_by_desc çº¢é»‘æ ‘é‡Œçš„ binder_ref èŠ‚ç‚¹, ç„¶åå°† binder_ref.data.desc ä¸è¦æŸ¥æ‰¾çš„ desc ä¹Ÿå°±æ˜¯ tr-&gt;target.handle æ¯”è¾ƒ, å½“ä¸¤è€…ç›¸ç­‰æ—¶ï¼Œè¯¥ binder_ref èŠ‚ç‚¹å°±æ˜¯æ‰€è¦æ‰¾çš„ç›®æ ‡ binder_ref ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹åˆ†æ binder_translate_binder() æ—¶ç”»çš„å›¾:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7be2e510f3b84548acc93eb344b8868c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiQ5Lit5LiQOTk5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754307&amp;x-signature=V4cOg%2BO7ER6qrSVFS3t3%2BU4wMlM%3D" alt="binder2.png" loading="lazy"/></p>
<p>å›¾ä¸­çš„ target_pro å°±æ˜¯æˆ‘ä»¬ç°åœ¨çš„å½“å‰ binder_proc , binder_get_ref_olocked() æ ¹æ® tr-&gt;target.handle æ‰¾åˆ°äº†ä¼ é€’ IBinder å¯¹è±¡æ—¶åœ¨å†…æ ¸ä¸­åˆ›å»ºçš„ binder_ref ã€‚</p>
<p>ä» binder_ref.node ä¸­å¯ä»¥è·å– binder_ref ä»£è¡¨çš„ binder_node , ç„¶åæ ¹æ® binder_node å–å¾— target_node å’Œ target_proc:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *<span class="hljs-built_in">binder_get_node_refs_for_txn</span>(
        <span class="hljs-keyword">struct</span> binder_node *node,
        <span class="hljs-keyword">struct</span> binder_proc **procp,
        <span class="hljs-type">uint32_t</span> *error)
{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *target_node = <span class="hljs-literal">NULL</span>;

    <span class="hljs-built_in">binder_node_inner_lock</span>(node);
    <span class="hljs-keyword">if</span> (node-&gt;proc) {
        target_node = node;
        <span class="hljs-built_in">binder_inc_node_nilocked</span>(node, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);
        <span class="hljs-built_in">binder_inc_node_tmpref_ilocked</span>(node);
        node-&gt;proc-&gt;tmp_ref++;
        *procp = node-&gt;proc;
    } <span class="hljs-keyword">else</span>
        *error = BR_DEAD_REPLY;
    <span class="hljs-built_in">binder_node_inner_unlock</span>(node);

    <span class="hljs-keyword">return</span> target_node;
}
</code></pre>
<p>target_node å°±æ˜¯ä¼ é€’ NfcAdaptation.mAidlCallback æ—¶åœ¨ binder_translate_binder() åˆ›å»ºçš„ä»£è¡¨ NfcAdaptation.mAidlCallback çš„ binder_node , ç°åœ¨çš„ target_proc å°±æ˜¯å›¾ä¸­çš„å‘é€ç«¯ binder_proc, ä¹Ÿå°±æ˜¯ NfcAdaptation æ‰€åœ¨çš„ "com.android.nfc" è¿›ç¨‹ã€‚</p>
<p>æ‰¾åˆ°äº† target_node å’Œ target_proc , æ¥ä¸‹æ¥åˆåˆ°äº†æ‰¾ target_thread çš„æµç¨‹:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">binder_transaction</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
                   <span class="hljs-keyword">struct</span> binder_thread *thread,
                   <span class="hljs-keyword">struct</span> binder_transaction_data *tr, <span class="hljs-type">int</span> reply,
                   <span class="hljs-type">binder_size_t</span> extra_buffers_size)</span>
</span>{
    <span class="hljs-keyword">if</span> (reply) {

    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (!(tr-&gt;flags &amp; TF_ONE_WAY) &amp;&amp; thread-&gt;transaction_stack) {
            <span class="hljs-keyword">struct</span> binder_transaction *tmp;

            tmp = thread-&gt;transaction_stack;

            <span class="hljs-keyword">while</span> (tmp) {
                <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_thread</span> *from;

                <span class="hljs-built_in">spin_lock</span>(&amp;tmp-&gt;lock);
                from = tmp-&gt;from;
                <span class="hljs-keyword">if</span> (from &amp;&amp; from-&gt;proc == target_proc) {
                    <span class="hljs-built_in">atomic_inc</span>(&amp;from-&gt;tmp_ref);
                    target_thread = from;
                    <span class="hljs-built_in">spin_unlock</span>(&amp;tmp-&gt;lock);
                    is_nested = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-built_in">spin_unlock</span>(&amp;tmp-&gt;lock);
                tmp = tmp-&gt;from_parent;
            }
        }
    }
}
</code></pre>
<p>å› ä¸ºè°ƒç”¨æ ˆ</p>
<pre><code class="hljs language-cpp" lang="cpp">Nfc::<span class="hljs-built_in">open</span>()
<span class="hljs-built_in">Vendor_hal_open</span>()
    <span class="hljs-built_in">p_nfc_stack_cback</span>(HAL_NFC_OPEN_CPLT_EVT, HAL_NFC_STATUS_OK)
Nfc::<span class="hljs-built_in">eventCallback</span>()
INfcClientCallback::<span class="hljs-built_in">sendEvent</span>()
</code></pre>
<p>è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œ, ä¹Ÿå°±æ˜¯æ¥æ”¶ Nfc::open() è°ƒç”¨å’Œå‘èµ· INfcClientCallback::sendEvent() è°ƒç”¨çš„æ˜¯åŒä¸€ä¸ª binder_thread, æ‰€ä»¥ binder_transaction() é‡Œçš„ thread-&gt;transaction_stack ä¸ä¸ºç©ºäº†, thread-&gt;transaction_stack ä¸º Nfc::open() å‘èµ·ç«¯åˆ›å»ºçš„ binder_transaction ,æœ€åè·å–åˆ°çš„ target_thread = from ä¹Ÿå°±æ˜¯å‘èµ· Nfc::open() è°ƒç”¨çš„çº¿ç¨‹, å³ <code>com.android.nfc</code> ä¸­ <code>NfcAdaptation::DownloadFirmware()</code> æ‰€åœ¨çš„çº¿ç¨‹ã€‚è‡³æ­¤, æ–‡é¦–æ‰€è¯´çš„ <code>NfcAdaptation::DownloadFirmware()</code>å’Œ <code>NfcAdaptation::HalDownloadFirmwareCallback()</code> è·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹çš„æ ¹æœ¬åŸå› ç»ˆäºæ‰¾åˆ°äº†ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªè§£å†³ NfcAdaptation::DownloadFirmware() å’Œ NfcAdaptation::HalDownloadFirmwareCallback() è·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•æ˜¯åœ¨ INfc æœåŠ¡ç«¯ android.hardware.nfc-service.example ä¸­å¦èµ·ä¸€ä¸ªçº¿ç¨‹æ¥å‘èµ· INfcClientCallback å›è°ƒï¼Œå¦èµ·ä¸€ä¸ªçº¿ç¨‹å°±ä¼šæ–°åˆ›ä¸€ä¸ª binder_transaction æ¥åš thread-&gt;transaction_stack, ä¸ä¼šç”¨åˆ° Nfc::open() å‘èµ·ç«¯åˆ›å»ºçš„ binder_transaction, æ­¤æ—¶ target_thread ä¸º NULL, å°±ä¼šåœ¨ binder_proc_transaction() èµ° binder_select_thread_ilocked() å»æ‰¾ com.android.nfc çš„å¦ä¸€ä¸ª binder çº¿ç¨‹æ¥æ¥æ”¶è°ƒç”¨ã€‚ è¯¥æ–¹æ³•ä¹Ÿæ˜¯ nxp ç­‰å‚å®¶çš„ INfc æœåŠ¡ç«¯å®ç°ä»£ç é‡Œæ‰€ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä¸»çº¿ NfcAdaptation ä»£ç å¯ä»¥æ­£å¸¸é€‚é…ç°æœ‰çš„ nxp ç­‰å‚å®¶çš„ INfc æœåŠ¡ç«¯å®ç°ã€‚</p>
<p>å†å¾€ä¸‹å°±æ˜¯åˆ›å»ºæ–°çš„ binder_transaction, æŠŠ target_proc, target_thread, code, target_node ç­‰å…³é”®æ•°æ®æ‰“åŒ…è¿› binder_transaction:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">binder_transaction</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
                   <span class="hljs-keyword">struct</span> binder_thread *thread,
                   <span class="hljs-keyword">struct</span> binder_transaction_data *tr, <span class="hljs-type">int</span> reply,
                   <span class="hljs-type">binder_size_t</span> extra_buffers_size)</span>
</span>{
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_transaction</span> *t;

    t = <span class="hljs-built_in">kzalloc</span>(<span class="hljs-built_in">sizeof</span>(*t), GFP_KERNEL);

    t-&gt;to_proc = target_proc;
    t-&gt;to_thread = target_thread;
    t-&gt;code = tr-&gt;code;
    t-&gt;flags = tr-&gt;flags;
    t-&gt;buffer-&gt;debug_id = t-&gt;debug_id;
    t-&gt;buffer-&gt;transaction = t;
    t-&gt;buffer-&gt;target_node = target_node;
}
</code></pre>
<p>ç„¶ååˆæ˜¯ binder_proc_transaction() æŠŠæ‰“åŒ…å¥½ binder_transaction å‘ç»™ target_proc target_threadã€‚</p>
<h5 data-id="heading-24">æ¥æ”¶ç«¯</h5>
<h6 data-id="heading-25">binder_thread_read()</h6>
<p>com.android.nfc ä¸­ <code>NfcAdaptation::DownloadFirmware()</code> æ‰€åœ¨çš„çº¿ç¨‹è¢« binder_proc_transaction() å”¤é†’å, åœ¨ binder_wait_for_work() ä¸­é†’æ¥, é€€å‡ºåˆ° binder_thread_read():</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">binder_thread_read</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> binder_proc *proc,
                  <span class="hljs-keyword">struct</span> binder_thread *thread,
                  <span class="hljs-type">binder_uintptr_t</span> binder_buffer, <span class="hljs-type">size_t</span> size,
                  <span class="hljs-type">binder_size_t</span> *consumed, <span class="hljs-type">int</span> non_block)</span>
</span>{
    <span class="hljs-keyword">if</span> (non_block) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">binder_has_work</span>(thread, wait_for_proc_work))
            ret = -EAGAIN;
    } <span class="hljs-keyword">else</span> {
        ret = <span class="hljs-built_in">binder_wait_for_work</span>(thread, wait_for_proc_work);
    }

        <span class="hljs-keyword">if</span> (t-&gt;buffer-&gt;target_node) {
            <span class="hljs-keyword">struct</span> <span class="hljs-title class_">binder_node</span> *target_node = t-&gt;buffer-&gt;target_node;

            trd-&gt;target.ptr = target_node-&gt;ptr;
            trd-&gt;cookie =  target_node-&gt;cookie;
            <span class="hljs-built_in">binder_transaction_priority</span>(thread, t, target_node);
            cmd = BR_TRANSACTION;
        } 
}
</code></pre>
<p>ç„¶åå–å‡º binder_proc_transaction() å¡«å…¥çš„ t-&gt;buffer-&gt;target_node, æŠŠ target_node-&gt;cookie èµ‹å€¼ç»™ trd-&gt;cookie, æœ€åé€šè¿‡ copy_to_user() ä¼ ç»™åº”ç”¨å±‚ä»£ç ã€‚è¿™ä¸ª cookie çš„å€¼å°±æ˜¯ NfcAdaptation::HalOpen() è°ƒç”¨ mAidlHal-&gt;open(mAidlCallback) å¾€ binder é©±åŠ¨ä¼ é€’çš„æœ€åŸå§‹çš„ NfcAdaptation.mAidlCallback æŒ‡é’ˆï¼Œç°åœ¨å›ä¼ ç»™ NfcAdaptation, è¡¨ç¤ºè¦è°ƒç”¨ NfcAdaptation.mAidlCallback é‡Œçš„æˆå‘˜å‡½æ•°äº†ã€‚</p>
<h6 data-id="heading-26">è¿”å›åº”ç”¨å±‚</h6>
<p>com.android.nfc ä¸­ NfcAdaptation::DownloadFirmware() æ‰€åœ¨çš„çº¿ç¨‹æ”¶åˆ°æ•°æ®å, åº”ç”¨å±‚ä»£ç ä¹Ÿä» IPCThreadState::talkWithDriver() ä¸­çš„ <code>ioctl()</code> é†’æ¥ï¼Œé€€å‡º IPCThreadState::talkWithDriver() æ¥åˆ° IPCThreadState::executeCommand() èµ°</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">reinterpret_cast</span>&lt;BBinder*&gt;(tr.cookie)-&gt;<span class="hljs-built_in">transact</span>(tr.code, buffer,
                            &amp;reply, tr.flags)
</code></pre>
<p>æ¥ç€æŒ‰ä¸€ä¸‹è°ƒç”¨é“¾èµ°å‘ NfcAdaptation::HalDownloadFirmwareCallback():</p>
<pre><code class="hljs language-cpp" lang="cpp">BBinder::<span class="hljs-built_in">transact</span>()
ABBinder::<span class="hljs-built_in">onTransact</span>()
aidl::android::hardware::nfc::_aidl_android_hardware_nfc_INfcClientCallback_onTransact()
NfcAidlClientCallback::<span class="hljs-built_in">sendEvent</span>()
NfcAdaptation::<span class="hljs-built_in">HalDownloadFirmwareCallback</span>()
</code></pre>
<h2 data-id="heading-27">æ€»ç»“</h2>
<p>è‡³æ­¤, æˆ‘ä»¬åˆ†æäº† NfcAdaptation::DownloadFirmware() åˆ° INfc::open() æœåŠ¡ç«¯å®ç°ï¼Œ å†ä» INfc æœåŠ¡ç«¯å›è°ƒ INfcClientCallback æœ€ç»ˆèµ°åˆ° NfcAdaptation::HalDownloadFirmwareCallback() çš„æ•´ä¸ª binder é€šä¿¡æµç¨‹ï¼Œä¹Ÿå¼„æ¸…æ¥šäº† NfcAdaptation::DownloadFirmware()å’Œ NfcAdaptation::HalDownloadFirmwareCallback() è·‘åœ¨åŒä¸€ä¸ªçº¿ç¨‹çš„æ ¹æœ¬åŸå› ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Xcode 26è¿˜æ²¡æœ‰é€‚é…SceneDelegateçš„appå»ºè®®å°½æ—©é€‚é…]]></title>    <link>https://juejin.cn/post/7585406229167669298</link>    <guid>https://juejin.cn/post/7585406229167669298</guid>    <pubDate>2025-12-19T11:35:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406229167669298" data-draft-id="7585180775705886747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Xcode 26è¿˜æ²¡æœ‰é€‚é…SceneDelegateçš„appå»ºè®®å°½æ—©é€‚é…"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2025-12-19T11:35:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wvy"/> <meta itemprop="url" content="https://juejin.cn/user/2269819229978381"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Xcode 26è¿˜æ²¡æœ‰é€‚é…SceneDelegateçš„appå»ºè®®å°½æ—©é€‚é…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2269819229978381/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wvy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T11:35:15.000Z" title="Fri Dec 19 2025 11:35:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Xcode 26ä¹‹å‰ä¸éœ€è¦å¤šçª—å£çš„å¾ˆå¤šappæ²¡æœ‰é€‚é…SceneDelegateï¼Œå‡çº§åˆ°Xcode 26åè¿è¡Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ§åˆ¶å°æœ‰ä»¥ä¸‹è¾“å‡ºï¼š</p>
<pre><code class="hljs language-swift" lang="swift">`UIScene` lifecycle will soon be <span class="hljs-keyword">required</span>. <span class="hljs-type">Failure</span> to adopt will result <span class="hljs-keyword">in</span> an assert <span class="hljs-keyword">in</span> the future.
</code></pre>
<p>UIApplicationDelegate ä¸­çš„ç›¸å…³ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹Ÿæœ‰å¼ƒç”¨æ ‡è®°ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/// Tells the delegate that the application has become active </span>
<span class="hljs-comment">/// - <span class="hljs-doctag">Note:</span> This method is not called if `UIScene` lifecycle has been adopted. </span>
- (void)applicationDidBecomeActive:(UIApplication *)application <span class="hljs-built_in">API_DEPRECATED</span>(<span class="hljs-string">"Use UIScene lifecycle and sceneDidBecomeActive(_:) from UISceneDelegate or the UIApplication.didBecomeActiveNotification instead."</span>, <span class="hljs-built_in">ios</span>(<span class="hljs-number">2.0</span>, <span class="hljs-number">26.0</span>), <span class="hljs-built_in">tvos</span>(<span class="hljs-number">9.0</span>, <span class="hljs-number">26.0</span>), <span class="hljs-built_in">visionos</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">26.0</span>)) <span class="hljs-built_in">API_UNAVAILABLE</span>(watchos);
</code></pre>
<p><strong>å»ºè®®å°½æ—©é€‚é…</strong></p>
<h2 data-id="heading-0">æ–¹æ¡ˆä¸¾ä¾‹</h2>
<p>ä»¥ä¸‹æ˜¯æˆ‘çš„é€‚é…æ–¹æ¡ˆï¼Œä¾›å¤§å®¶å‚è€ƒ</p>
<ul>
<li>å…¼å®¹iOS13ä»¥ä¸‹ç‰ˆæœ¬ï¼›</li>
<li>appåªæœ‰å•çª—å£åœºæ™¯ã€‚</li>
</ul>
<h3 data-id="heading-1">1. é…ç½®Info.plist</h3>
<p>Delegate Class Nameå’ŒConfiguration Name å¯è‡ªå®šä¹‰</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/743e340f7e8c40c0b61676235db67f33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3Z5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766748914&amp;x-signature=ufFG9YFKt%2Bfk4gkA7ms6KRZwxfE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">2. é…ç½®SceneDelegate</h3>
<ul>
<li>åˆ›å»ºSceneDelegate class ç±»åè¦å’ŒInfo.plistä¸­é…ç½®ä¸€è‡´</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbea89727ca84065b8efe79f8433fbf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3Z5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766748914&amp;x-signature=zkKLnumLJa1clPgnNZzDDFpY%2FfE%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>appDelegateä¸­å®ç°ä»£ç†</li>
</ul>

<pre><code class="hljs language-objectivec" lang="objectivec">- (<span class="hljs-built_in">UISceneConfiguration</span> *)application:(<span class="hljs-built_in">UIApplication</span> *)application configurationForConnectingSceneSession:(<span class="hljs-built_in">UISceneSession</span> *)connectingSceneSession options:(<span class="hljs-built_in">UISceneConnectionOptions</span> *)optionsÂ  API_AVAILABLE(ios(<span class="hljs-number">13.0</span>)){
   <span class="hljs-comment">//  nameè¦å’ŒInfo.plistä¸­é…ç½®ä¸€è‡´</span>
Â  <span class="hljs-keyword">return</span> [[<span class="hljs-built_in">UISceneConfiguration</span> alloc] initWithName:<span class="hljs-string">@"Default Configuration"</span> sessionRole:connectingSceneSession.role];
}

- (<span class="hljs-type">void</span>)application:(<span class="hljs-built_in">UIApplication</span> *)application didDiscardSceneSessions:(<span class="hljs-built_in">NSSet</span>&lt;<span class="hljs-built_in">UISceneSession</span> *&gt; *)sceneSessionsÂ  API_AVAILABLE(ios(<span class="hljs-number">13.0</span>)){
  <span class="hljs-comment">// é‡Šæ”¾èµ„æºï¼Œå•çª—å£appä¸ç”¨å…³æ³¨</span>
}
</code></pre>
<h3 data-id="heading-3">3. æ–°å»ºå•ä¾‹ AppLifecycleHelper å®ç°AppDelegateå’ŒSceneDelgateå…±äº«çš„æ–¹æ³•</h3>
<ul>
<li>iOS 13 åŠä»¥ä¸Šéœ€è¦åœ¨<code>scene: willConnectToSession: options:</code> æ–¹æ³•ä¸­åˆ›å»ºWindowï¼Œä¹‹å‰ä»ç„¶åœ¨ <code>didFinishLaunchingWithOptions:</code></li>
</ul>
<p>AppDelegate:</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">-</span> (BOOL)<span class="hljs-selector-tag">application</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> <span class="hljs-selector-tag">didFinishLaunchingWithOptions</span>:(NSDictionary *)<span class="hljs-selector-tag">launchOptions</span> {
Â  Â  <span class="hljs-selector-attr">[AppLifecycleHelper sharedInstance]</span><span class="hljs-selector-class">.launchOptions</span> = <span class="hljs-selector-tag">launchOptions</span>;
     <span class="hljs-comment">// ... è‡ªå®šä¹‰é€»è¾‘</span>
Â  Â  <span class="hljs-selector-tag">if</span> (<span class="hljs-variable">@available</span>(iOS <span class="hljs-number">13</span>, *)) {
 
Â  Â  } <span class="hljs-selector-tag">else</span> {
Â  Â  Â  Â  <span class="hljs-selector-attr">[[AppLifecycleHelper sharedInstance]</span> <span class="hljs-selector-tag">createKeyWindow</span>];
Â  Â  }
}
</code></pre>
<p>SceneDelgate:</p>
<p>URLå†·å¯åŠ¨APPæ—¶ä¸è°ƒç”¨<code>openURLContexts</code>æ–¹æ³•ï¼Œè¿™é‡Œä¿å­˜URLåœ¨<code>DidBecomeActive</code>å¤„ç†</p>
<pre><code class="hljs language-objectivec" lang="objectivec">- (<span class="hljs-type">void</span>)scene:(<span class="hljs-built_in">UIScene</span> *)scene willConnectToSession:(<span class="hljs-built_in">UISceneSession</span> *)session options:(<span class="hljs-built_in">UISceneConnectionOptions</span> *)connectionOptionsÂ  API_AVAILABLE(ios(<span class="hljs-number">13.0</span>)){
Â  Â  [[AppLifecycleHelper sharedInstance] createKeyWindowWithScene:(<span class="hljs-built_in">UIWindowScene</span> *)scene];
Â  Â  <span class="hljs-comment">// é€šè¿‡urlå†·å¯åŠ¨appï¼Œä¸€èˆ¬åªæœ‰ä¸€ä¸ªurl </span>
Â  Â  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">UIOpenURLContext</span> *context **<span class="hljs-keyword">in</span>** connectionOptions.URLContexts) {
Â  Â  Â  Â  <span class="hljs-built_in">NSURL</span> *URL = context.URL;
Â  Â  Â  Â  <span class="hljs-keyword">if</span> (URL &amp;&amp; URL.absoluteString.length &gt; <span class="hljs-number">0</span>) {
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">self</span>.launchUrl = URL;
Â  Â  Â  Â  }
Â  Â  }
}
</code></pre>
<p>AppLifecycleHelper:</p>
<pre><code class="hljs language-AppLifecycleHelper" lang="AppLifecycleHelper">- (void)createKeyWindow {
Â  Â  UIWindow *window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
Â  Â  [self setupMainWindow:window];
}

- (void)createKeyWindowWithScene:(UIWindowScene *)scene API_AVAILABLE(ios(13.0)) {
Â  Â  UIWindow *window = [[UIWindow alloc] initWithWindowScene:scene];
Â  Â  [self setupMainWindow:window];
}

- (void)setupMainWindow:(UIWindow *)window {
}
</code></pre>
<ul>
<li>å®ç°SceneDelegateåappDelegate ä¸­å¤±æ•ˆçš„æ–¹æ³•</li>
</ul>
<p>åœ¨<code>AppLifecycleHelper</code>ä¸­å®ç°ï¼Œå…±äº«ç»™ä¸¤ä¸ªDelegateClass</p>
<pre><code class="hljs language-AppDelegate" lang="AppDelegate">- (void)applicationDidBecomeActive:(UIApplication *)application {
    [[AppLifecycleHelper sharedInstance] appDidBecomeActive];
}

- (void)applicationWillResignActive:(UIApplication *)application {

}

- (void)applicationDidEnterBackground:(UIApplication *)application {

}

- (void)applicationWillEnterForeground:(UIApplication *)application {

}
  
 /// URL Scheme
- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey, **id**&gt; *)options {

}

/// æ¥åŠ›ç”¨æˆ·æ´»åŠ¨
- (BOOL)application:(UIApplication *)application continueUserActivity:(NSUserActivity *)userActivity restorationHandler:(void (^)(NSArray&lt;**id**&lt;UIUserActivityRestoring&gt;&gt; * _Nullable))restorationHandler {

}

/// å¿«æ·æ–¹å¼ç‚¹å‡»
- (void)application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void (^)(BOOL))completionHandler API_AVAILABLE(ios(9.0)) {
}
</code></pre>
<p>SceneDelegateéƒ¨åˆ†ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-SceneDelegate" lang="SceneDelegate">
- (void)sceneDidBecomeActive:(UIScene *)sceneÂ  API_AVAILABLE(ios(13.0)){
Â  Â  [[AppLifecycleHelper sharedInstance] appDidBecomeActiveWithLaunchUrl:self.launchUrl];
    // æ¸…ç©ºå†·å¯åŠ¨æ—¶çš„url
    self.launchUrl = nil;
}
</code></pre>
<p><strong>è¿™ä¸ªæ–¹æ³•æ€»ç»“ä¸‹æ¥å°±æ˜¯æ±‚åŒå­˜å¼‚ï¼Œç”±Helperæä¾›SceneDelegateä¸AppDelegateç›¸åŒæˆ–ç±»ä¼¼çš„æ–¹æ³•ï¼Œé€‚åˆå•çª—å£ã€ä¸”æ”¯æŒiOS 13ä»¥ä¸‹çš„appï¼›</strong></p>
<p><strong>å¦å¤–æ³¨æ„<code>URL Scheme</code>å†·å¯åŠ¨appä¸ä¼šæ‰§è¡Œ<code>openURL</code>éœ€è¦è®°å½•URLï¼Œåœ¨åˆé€‚çš„æ—¶æœºï¼ˆä¸€èˆ¬æ˜¯DidBecomeActiveï¼‰å¤„ç†ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰å‘ç°TensorBoardæ˜¯ä¸ªå¯è§†åŒ–çš„ç¥å™¨ï¼]]></title>    <link>https://juejin.cn/post/7585406229167816754</link>    <guid>https://juejin.cn/post/7585406229167816754</guid>    <pubDate>2025-12-19T13:00:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406229167816754" data-draft-id="7585410547336773682" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰å‘ç°TensorBoardæ˜¯ä¸ªå¯è§†åŒ–çš„ç¥å™¨ï¼"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-19T13:00:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="coting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰å‘ç°TensorBoardæ˜¯ä¸ªå¯è§†åŒ–çš„ç¥å™¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    coting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:00:21.000Z" title="Fri Dec 19 2025 13:00:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ·±åº¦å­¦ä¹ çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦<strong>ç›´è§‚åœ°è§‚å¯Ÿæ¨¡å‹çš„è®­ç»ƒæ›²çº¿ã€å‚æ•°å˜åŒ–ã€ç½‘ç»œç»“æ„ä»¥åŠä¸­é—´ç‰¹å¾å›¾</strong>ï¼Œè€Œä¸æ˜¯ç›²ç›®åœ°çœ‹ loss æ•°å­—ã€‚ä¹‹å‰çŸ¥é“TensorBoardè¿™ä¸ªå·¥å…·ï¼Œä¹Ÿç”¨è¿‡ï¼Œä½†ç ”ç©¶ä¹‹åæ‰å‘ç°è¿™ç©æ„è¿™ä¹ˆå¥½ç”¨ï¼</p>
<p>å®ƒæ˜¯ <strong>TensorFlow å®˜æ–¹æ¨å‡ºçš„å¯è§†åŒ–å·¥å…·</strong>ï¼Œä½†å¦‚ä»Š PyTorchã€JAXã€MindSpore ç­‰æ¡†æ¶ä¹Ÿå·²å…¨é¢å…¼å®¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eacd08cd43fe4b9fb4ddf14e5f869fa7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=1CC2NHX1ErtNc%2Fxx8r5ANSmRVI0%3D" alt="" loading="lazy"/></p>
<p>æ— è®ºä½ æ˜¯è°ƒè¯•æ¨¡å‹è¿˜æ˜¯å±•ç¤ºå®éªŒç»“æœï¼ŒTensorBoard éƒ½èƒ½è®©ä½ äº‹åŠåŠŸå€ã€‚</p>
<p>æ‰€æœ‰ç›¸å…³æºç ç¤ºä¾‹ã€æµç¨‹å›¾ã€æ¨¡å‹é…ç½®ä¸çŸ¥è¯†åº“æ„å»ºæŠ€å·§ï¼Œæˆ‘ä¹Ÿå°†æŒç»­æ›´æ–°åœ¨Githubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faicoting%2FLLMHub" target="_blank" title="https://github.com/aicoting/LLMHub" ref="nofollow noopener noreferrer"><strong>LLMHub</strong></a>ï¼Œæ¬¢è¿å…³æ³¨æ”¶è—ï¼</p>
<h2 data-id="heading-0">ä¸€ã€å®‰è£…ä¸å¯åŠ¨</h2>
<p>TensorBoard çš„å®‰è£…éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install tensorboard
</code></pre>
<p>å¯åŠ¨å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">tensorboard --logdir=./runs --port=6006
</code></pre>
<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">http://localhost:6006
</code></pre>
<p>æç¤ºï¼š<code>--logdir</code> æŒ‡å‘ä½ ä¿å­˜æ—¥å¿—çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ¯”å¦‚ PyTorch é»˜è®¤ä¿å­˜åˆ° <code>runs/</code> ä¸‹ã€‚</p>
<h2 data-id="heading-1">äºŒã€åœ¨ PyTorch ä¸­ä½¿ç”¨ TensorBoard</h2>
<h3 data-id="heading-2">åˆå§‹åŒ– SummaryWriter</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter

writer = SummaryWriter(log_dir=<span class="hljs-string">"./runs/exp1"</span>)
</code></pre>
<p>è¿™è¡Œä»£ç å°±ä¼šåˆ›å»ºä¸€ä¸ªç”¨äºå†™å…¥æ—¥å¿—çš„å¯¹è±¡ï¼Œ<code>exp1</code> æ˜¯å®éªŒåç§°ã€‚</p>
<h3 data-id="heading-3">è®°å½•è®­ç»ƒæŒ‡æ ‡</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    train_loss = <span class="hljs-number">0.1</span> * epoch
    val_acc = <span class="hljs-number">0.8</span> + <span class="hljs-number">0.02</span> * epoch
    writer.add_scalar(<span class="hljs-string">"Loss/train"</span>, train_loss, epoch)
    writer.add_scalar(<span class="hljs-string">"Accuracy/val"</span>, val_acc, epoch)
</code></pre>
<p>æ‰“å¼€ TensorBoard åï¼Œå°±èƒ½çœ‹åˆ°æ¼‚äº®çš„æŠ˜çº¿å›¾å•¦ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e1772ad47fb4473bc6c9b54100cda02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=pf%2Byeb1l2uvO7nvW0iLq%2BNMOdlw%3D" alt="" loading="lazy"/></p>
<p><strong>Scalars</strong> é€‰é¡¹å¡ç”¨äºå±•ç¤ºæŸå¤±å‡½æ•°ã€å‡†ç¡®ç‡ç­‰æŒ‡æ ‡éš epoch çš„å˜åŒ–è¶‹åŠ¿ã€‚</p>
<h3 data-id="heading-4">å¯è§†åŒ–æ¨¡å‹ç»“æ„</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># === å®šä¹‰ä¸€ä¸ªç®€å•çš„ MLP æ¨¡å‹ ===</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MLP</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>(MLP, self).__init__()
        self.fc1 = nn.Linear(<span class="hljs-number">28</span>*<span class="hljs-number">28</span>, <span class="hljs-number">128</span>)
        self.fc2 = nn.Linear(<span class="hljs-number">128</span>, <span class="hljs-number">64</span>)
        self.fc3 = nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        x = x.view(-<span class="hljs-number">1</span>, <span class="hljs-number">28</span>*<span class="hljs-number">28</span>)
        x = torch.relu(self.fc1(x))
        x = torch.relu(self.fc2(x))
        x = self.fc3(x)
        <span class="hljs-keyword">return</span> x

model = MLP()
criterion = nn.CrossEntropyLoss()
optimizer = optim.Adam(model.parameters(), lr=<span class="hljs-number">0.001</span>)

<span class="hljs-comment"># === æ¨¡å‹ç»“æ„å¯è§†åŒ– ===</span>
dummy_input = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)
writer.add_graph(model, dummy_input)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1962bac1a59940c1a73f165666b718f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=4QKRJypQw9DjFTYDAiYAB8543ec%3D" alt="" loading="lazy"/></p>
<p>åœ¨ TensorBoard çš„ <strong>Graphs</strong> é¡µé¢ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ç½‘ç»œçš„è®¡ç®—å›¾ç»“æ„ï¼Œå¸®åŠ©ä½ æ’æŸ¥æ¨¡å‹æ‹¼æ¥æˆ–æ¢¯åº¦ä¼ é€’é”™è¯¯ï¼Œè¿™ä¸ªç¡®å®è¶³å¤Ÿä¼˜ç§€äº†ï¼Œç”»å‡ºæ¥çš„æ¨¡å‹ç»“æ„ä¹Ÿå¾ˆæ¸…æ™°ã€‚</p>
<h3 data-id="heading-5">å¯è§†åŒ–ç‰¹å¾å›¾ï¼ˆFeature Mapsï¼‰</h3>
<p>å‡è®¾æˆ‘ä»¬åœ¨å·ç§¯å±‚ä¹‹åæƒ³çœ‹çœ‹æ¨¡å‹æå–äº†ä»€ä¹ˆç‰¹å¾ï¼š</p>
<pre><code class="hljs language-python" lang="python">images = torch.randn(<span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
writer.add_images(<span class="hljs-string">"Input Images"</span>, images, <span class="hljs-number">0</span>)
</code></pre>
<p>å¯¹äºç‰¹å¾å›¾ï¼Œå¯ä»¥é€šè¿‡ <code>make_grid</code> æ‹¼æ¥åå†™å…¥ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> torchvision.utils <span class="hljs-keyword">import</span> make_grid

feature_maps = torch.randn(<span class="hljs-number">16</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)
grid = make_grid(feature_maps, nrow=<span class="hljs-number">4</span>, normalize=<span class="hljs-literal">True</span>)
writer.add_image(<span class="hljs-string">"Feature Maps"</span>, grid, <span class="hljs-number">0</span>)
</code></pre>
<p>è¿™åœ¨è°ƒè¯• CNN æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d4fd8ce75b740e99a6b7f5aab7d658d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=DBfLgQqjZ30zxBXhUnRNySU3gLo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">ä¸‰ã€é«˜çº§åŠŸèƒ½ä¸æŠ€å·§</h2>
<h3 data-id="heading-7">Embedding å¯è§†åŒ–ï¼ˆé«˜ç»´ç‰¹å¾é™ç»´ï¼‰</h3>
<p>åœ¨æ¨¡å‹è®­ç»ƒç»“æŸåï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ TensorBoard æ¥æŸ¥çœ‹é«˜ç»´å‘é‡çš„åˆ†å¸ƒï¼ˆå¸¸ç”¨äºå¯è§†åŒ–è¯å‘é‡ã€å›¾åƒç‰¹å¾ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
features = np.random.rand(<span class="hljs-number">100</span>, <span class="hljs-number">128</span>)
labels = [<span class="hljs-string">f"class_<span class="hljs-subst">{i%<span class="hljs-number">10</span>}</span>"</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)]

writer.add_embedding(features, metadata=labels, tag=<span class="hljs-string">"Embedding_demo"</span>)
</code></pre>
<p>æ‰“å¼€ <strong>Projector</strong> é¡µé¢ï¼Œå°±èƒ½çœ‹åˆ°ç‚¹äº‘åˆ†å¸ƒåŠç±»åˆ«åŒºåˆ†æƒ…å†µï¼Œè¿™é‡Œè®©æˆ‘æŒºéœ‡æƒŠçš„ï¼Œä»–æ˜¯<strong>ä¸‰ç»´åŠ¨ç”»å½¢å¼</strong>çš„ï¼Œå¦‚æœæ•°æ®é‡å†å¤§ä¸€äº›æˆ‘æƒ³åº”è¯¥ä¼šéå¸¸ä¼˜ç¾ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1970e9c143ba44289b75f0e989442cfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=My%2Bqm5mImOUiM4IJLqz%2BpZgUbtI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">è¶…å‚æ•°è¿½è¸ªï¼ˆHParamsï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># === è¶…å‚æ•°è®°å½• ===</span>
writer.add_hparams(
    {<span class="hljs-string">'lr'</span>: <span class="hljs-number">0.001</span>, <span class="hljs-string">'batch_size'</span>: <span class="hljs-number">64</span>, <span class="hljs-string">'epochs'</span>: epochs},
    {<span class="hljs-string">'accuracy'</span>: test_acc, <span class="hljs-string">'loss'</span>: test_loss}
)
</code></pre>
<p>è¿™æ ·ä½ å¯ä»¥åœ¨ TensorBoard çš„ <strong>HParams</strong> é€‰é¡¹å¡ä¸­å¯¹æ¯”ä¸åŒå®éªŒå‚æ•°çš„è¡¨ç°ï¼Œéå¸¸é€‚åˆè°ƒå‚é˜¶æ®µã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/095e41bc1421419ebdfb12cbbb705696~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=ih%2B8lcu6KOdihCPESFaXGc2NX6Q%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">è®°å½•æ··æ·†çŸ©é˜µ</h3>
<pre><code class="hljs language-python" lang="python">cm = confusion_matrix(all_targets, np.array(all_preds).flatten())
fig, ax = plt.subplots(figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">6</span>))
sns.heatmap(cm, annot=<span class="hljs-literal">True</span>, fmt=<span class="hljs-string">"d"</span>, cmap=<span class="hljs-string">"Blues"</span>, ax=ax)
ax.set_xlabel(<span class="hljs-string">"Predicted"</span>)
ax.set_ylabel(<span class="hljs-string">"True"</span>)
writer.add_figure(<span class="hljs-string">"Confusion Matrix"</span>, fig)
</code></pre>
<p>è¿™ç§æ–¹å¼æ¯”å•çº¯æ‰“å°çŸ©é˜µæ›´ç›´è§‚ï¼Œæˆ‘ä»¬å¹³æ—¶çœ‹çš„å¾ˆå¤šè®ºæ–‡å°±æœ‰è¿™ç§å›¾åƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8fa067fc22545059220c6e44b823d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766754020&amp;x-signature=10cR3QOS6WvYsvj4k9SaW7nuC2s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">å¯¹æ¯”å¤šæ¬¡å®éªŒ</h3>
<p>å¤šä¸ªå®éªŒåªéœ€å†™å…¥ä¸åŒç›®å½•å³å¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">runs/
 â”œâ”€â”€ exp_lr_1e-3/
 â”œâ”€â”€ exp_lr_1e-4/
 â””â”€â”€ exp_lr_5e-4/
</code></pre>
<p>TensorBoard ä¼šè‡ªåŠ¨åŠ è½½æ‰€æœ‰å®éªŒçš„æŒ‡æ ‡ï¼Œæ–¹ä¾¿å¯¹æ¯”æ›²çº¿è¶‹åŠ¿ã€‚</p>
<p>ä½†æ˜¯TensorBoardä¹Ÿä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å½“æ—¥å¿—å¤ªå¤šæ—¶å°±ä¼šå¯¼è‡´åŠ è½½é€Ÿåº¦æ…¢ï¼Œæ‰€ä»¥å°±éœ€è¦æˆ‘ä»¬å®šæœŸæ¸…ç† <code>runs</code></p>
<p>æ–‡ä»¶å¤¹ï¼Œæˆ–ä½¿ç”¨ <code>--samples_per_plugin</code>é™åˆ¶åŠ è½½æ•°é‡ã€‚</p>
<p>TensorBoard æ˜¯æ·±åº¦å­¦ä¹ å·¥ç¨‹å¸ˆçš„å¿…å¤‡å·¥å…·ã€‚å®ƒä¸ä»…èƒ½è®©è®­ç»ƒè¿‡ç¨‹ã€Œçœ‹å¾—è§ã€ï¼Œè¿˜èƒ½å¸®åŠ©æˆ‘ä»¬<strong>è°ƒè¯•ç½‘ç»œç»“æ„ã€åˆ†ææ”¶æ•›è¶‹åŠ¿ä¸å¼‚å¸¸ç‚¹ã€è¿½è¸ªå‚æ•°ä¸ç‰¹å¾å˜åŒ–ã€å±•ç¤ºå®éªŒç»“æœä¸æ¨¡å‹å¯è§£é‡Šæ€§ã€‚</strong></p>
<p>ä¼šè·‘æ¨¡å‹å¾ˆé‡è¦ï¼Œä½†æ˜¯ä¼šä½¿ç”¨å¯è§†åŒ–å·¥å…·åŒç­‰é‡è¦ï¼Œæ¯•ç«Ÿå¯ä»¥å¤§å¹…æå‡æˆ‘ä»¬å¤„ç†æ•°æ®çš„é€Ÿåº¦ï¼Œå¸®åŠ©æˆ‘ä»¬è¿¸å‘æ–°çš„idea!</p>
<p>å…³äºæ·±åº¦å­¦ä¹ å’Œå¤§æ¨¡å‹ç›¸å…³çš„çŸ¥è¯†å’Œå‰æ²¿æŠ€æœ¯æ›´æ–°ï¼Œè¯·å…³æ³¨å…¬ä¼—å·cotingï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP ä¹‹é«˜çº§é¢å‘å¯¹è±¡ç¼–ç¨‹ æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ã€åŸåˆ™ä¸æ€§èƒ½ä¼˜åŒ–]]></title>    <link>https://juejin.cn/post/7585397173022736403</link>    <guid>https://juejin.cn/post/7585397173022736403</guid>    <pubDate>2025-12-19T23:46:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585397173022736403" data-draft-id="7585382553289916452" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" PHP ä¹‹é«˜çº§é¢å‘å¯¹è±¡ç¼–ç¨‹ æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ã€åŸåˆ™ä¸æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="keywords" content="åç«¯,PHP"/> <meta itemprop="datePublished" content="2025-12-19T23:46:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             PHP ä¹‹é«˜çº§é¢å‘å¯¹è±¡ç¼–ç¨‹ æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ã€åŸåˆ™ä¸æ€§èƒ½ä¼˜åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T23:46:30.000Z" title="Fri Dec 19 2025 23:46:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PHP ä¹‹é«˜çº§é¢å‘å¯¹è±¡ç¼–ç¨‹ æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ã€åŸåˆ™ä¸æ€§èƒ½ä¼˜åŒ–</h2>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆObject-Oriented Programming, OOPï¼‰ä¸åªæ˜¯â€œå¦‚ä½•å†™ classâ€çš„è¯­æ³•è§„åˆ™ã€‚å®ƒæ›´åƒä¸€ç§ç»„ç»‡è½¯ä»¶ç³»ç»Ÿçš„æ€ç»´æ–¹å¼ï¼šé€šè¿‡æ¸…æ™°çš„è¾¹ç•Œã€èŒè´£æ‹†åˆ†ä¸å¯¹è±¡åä½œï¼Œè®©ç³»ç»Ÿæ›´å®¹æ˜“ç†è§£ã€æ‰©å±•å’Œç»´æŠ¤ã€‚</p>
<p>å½“ä½ å·²ç»æŒæ¡äº†ç±»ã€å¯¹è±¡ã€å±æ€§ã€æ–¹æ³•è¿™äº›åŸºç¡€æ¦‚å¿µä¹‹åï¼Œå°±å¯ä»¥æŠŠè§†è§’å¾€æ›´æ·±ä¸€å±‚æŒªä¸€æŒªï¼šè®¾è®¡æ¨¡å¼ã€SOLID åŸåˆ™ï¼Œä»¥åŠåœ¨å¤§å‹ç³»ç»Ÿé‡Œç»•ä¸å¼€çš„æ€§èƒ½ä¸å†…å­˜é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡ä¼šå›´ç»•å‡ ä¸ªå¸¸è§ä¸»é¢˜å±•å¼€ï¼šç­–ç•¥æ¨¡å¼ä¸å•ä¾‹æ¨¡å¼ã€SOLID äº”åŸåˆ™ï¼Œä»¥åŠä¸å¯å˜å¯¹è±¡ä¸å†…å­˜ç®¡ç†ç›¸å…³çš„æ€§èƒ½è€ƒè™‘ã€‚å®ƒä»¬çš„ç›®çš„ä¸æ˜¯â€œç‚«æŠ€â€ï¼Œè€Œæ˜¯è®©çœŸå®é¡¹ç›®åœ¨åç»­è¿­ä»£ä¸­æ›´ç¨³ã€æ›´å¥½æ”¹ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-12%2Fadvanced-object-oriented-programming-design-patterns-solid-performance" target="_blank" title="https://catchadmin.com/post/2025-12/advanced-object-oriented-programming-design-patterns-solid-performance" ref="nofollow noopener noreferrer">åŸæ–‡é“¾æ¥ PHP ä¹‹é«˜çº§é¢å‘å¯¹è±¡ç¼–ç¨‹ æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ã€åŸåˆ™ä¸æ€§èƒ½ä¼˜åŒ–</a></p>
<h3 data-id="heading-1">é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„è®¾è®¡æ¨¡å¼</h3>
<p>è®¾è®¡æ¨¡å¼æ˜¯å¯¹è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„å¯å¤ç”¨è§£å†³æ–¹æ¡ˆã€‚å®ƒä»¬ä¸æ˜¯ä»£ç æ¨¡æ¿ï¼Œè€Œæ˜¯å¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸‹è°ƒæ•´å’Œè½åœ°çš„ä¸€ç»„è®¾è®¡æ€è·¯ã€‚</p>
<h4 data-id="heading-2">ç­–ç•¥æ¨¡å¼ï¼šå°†ç®—æ³•ä¸ç±»è§£è€¦</h4>
<p>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰å¯ä»¥æŠŠä¸€ç»„å¯äº’æ¢çš„ç®—æ³•æŠ½å‡ºæ¥ï¼Œç”¨ç»Ÿä¸€çš„æ¥å£å¯¹å¤–æš´éœ²ï¼Œè®©ä½¿ç”¨æ–¹åœ¨è¿è¡Œæ—¶è‡ªç”±é€‰æ‹©å®ç°ï¼Œè€Œä¸éœ€è¦æŠŠå…·ä½“ç®—æ³•ç¡¬ç¼–ç è¿›ä¸šåŠ¡ç±»ã€‚</p>
<p>å½“ä½ å¸Œæœ›â€œæ ¹æ®æ¡ä»¶åˆ‡æ¢ç®—æ³•â€ï¼Œåˆä¸å¸Œæœ›è®©ä¸€ä¸ªç±»è†¨èƒ€åˆ°å¡æ»¡ <code>if/else</code> æ—¶ï¼Œç­–ç•¥æ¨¡å¼é€šå¸¸å¾ˆå¥½ç”¨ã€‚</p>
<p>ä»¥ç”µå•†æŠ˜æ‰£ä¸ºä¾‹ï¼šå¯èƒ½æœ‰â€œæ‰“æŠ˜â€â€œä¹°ä¸€é€ä¸€â€ç­‰ä¸åŒæŠ˜æ‰£ç­–ç•¥ã€‚å¦‚æœæŠŠæ‰€æœ‰æŠ˜æ‰£è§„åˆ™éƒ½å †åœ¨ <code>Cart</code> é‡Œï¼Œ<code>Cart</code> ä¼šè¶Šæ¥è¶Šéš¾ç»´æŠ¤ã€‚ç”¨ç­–ç•¥æ¨¡å¼åˆ™å¯ä»¥æŠŠæŠ˜æ‰£è®¡ç®—æ‹†åˆ°ä¸åŒç­–ç•¥ç±»é‡Œã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DiscountStrategy</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> <span class="hljs-variable">$total</span></span>): <span class="hljs-title">float</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PercentDiscount</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DiscountStrategy</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> <span class="hljs-variable">$percent</span></span>) </span>{}

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> <span class="hljs-variable">$total</span></span>): <span class="hljs-title">float</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$total</span> * (<span class="hljs-number">1</span> - <span class="hljs-variable language_">$this</span>-&gt;percent);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BuyOneGetOneFree</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DiscountStrategy</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> <span class="hljs-variable">$total</span></span>): <span class="hljs-title">float</span> </span>{
        <span class="hljs-comment">// ç®€å•æ¨¡æ‹Ÿï¼šä¹°ä¸€é€ä¸€å³æ€»ä»·å‡åŠ</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$total</span> / <span class="hljs-number">2</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cart</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">array</span> <span class="hljs-variable">$items</span> = [];

    <span class="hljs-comment">// ä¾èµ–æ³¨å…¥ï¼šæ³¨å…¥ç­–ç•¥æ¥å£è€Œéå…·ä½“å®ç°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> DiscountStrategy <span class="hljs-variable">$strategy</span></span>) </span>{}

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addItem</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> <span class="hljs-variable">$price</span></span>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-variable language_">$this</span>-&gt;items[] = <span class="hljs-variable">$price</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">total</span>(<span class="hljs-params"/>): <span class="hljs-title">float</span> </span>{
        <span class="hljs-variable">$subtotal</span> = <span class="hljs-title function_ invoke__">array_sum</span>(<span class="hljs-variable">$this</span>-&gt;items);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;strategy-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-variable">$subtotal</span>);
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-variable">$cart</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cart</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PercentDiscount</span>(<span class="hljs-number">0.1</span>)); <span class="hljs-comment">// æ‰“ä¹æŠ˜</span>
<span class="hljs-variable">$cart</span>-&gt;<span class="hljs-title function_ invoke__">addItem</span>(<span class="hljs-number">100</span>);
<span class="hljs-variable">$cart</span>-&gt;<span class="hljs-title function_ invoke__">addItem</span>(<span class="hljs-number">200</span>);
<span class="hljs-keyword">echo</span> <span class="hljs-variable">$cart</span>-&gt;<span class="hljs-title function_ invoke__">total</span>(); <span class="hljs-comment">// è¾“å‡º: 270</span>
</code></pre>
<p>è¿™é‡Œ <code>Cart</code> ä¸éœ€è¦çŸ¥é“â€œæŠ˜æ‰£æ€ä¹ˆç®—â€ï¼Œå®ƒåªä¾èµ–ä¸€ä¸ªæŠ½è±¡çš„ <code>DiscountStrategy</code>ã€‚æƒ³æ›´æ¢æŠ˜æ‰£è§„åˆ™ï¼Œåªè¦ä¼ å…¥ä¸åŒçš„ç­–ç•¥å®ç°å³å¯ï¼Œæ— éœ€ä¿®æ”¹ <code>Cart</code>ã€‚</p>
<h4 data-id="heading-3">å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹</h4>
<p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰ç”¨äºä¿è¯æŸä¸ªç±»åœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸå†…åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</p>
<p>å®ƒå¸¸ç”¨äºç®¡ç†å…±äº«èµ„æºï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ã€é…ç½®å¯¹è±¡ç­‰ï¼šè¿™ç±»å¯¹è±¡é€šå¸¸ä¸å¸Œæœ›è¢«é¢‘ç¹åˆ›å»ºï¼Œä¹Ÿä¸å¸Œæœ›å‡ºç°å¤šä¸ªå®ä¾‹å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseConnection</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> ?DatabaseConnection <span class="hljs-variable">$instance</span> = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// ç§æœ‰åŒ–æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨ new</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"/>) </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"è¿æ¥åˆ°æ•°æ®åº“...\n"</span>;
    }

    <span class="hljs-comment">// é˜²æ­¢å…‹éš†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"/>) </span>{}

    <span class="hljs-comment">// é˜²æ­¢ååºåˆ—åŒ–</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"/>) </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">\Exception</span>(<span class="hljs-string">"Cannot unserialize singleton"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInstance</span>(<span class="hljs-params"/>): <span class="hljs-title">DatabaseConnection</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> === <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$instance</span>;
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-variable">$db1</span> = <span class="hljs-title class_">DatabaseConnection</span>::<span class="hljs-title function_ invoke__">getInstance</span>();
<span class="hljs-variable">$db2</span> = <span class="hljs-title class_">DatabaseConnection</span>::<span class="hljs-title function_ invoke__">getInstance</span>();

<span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$db1</span> === <span class="hljs-variable">$db2</span>); <span class="hljs-comment">// è¾“å‡º: bool(true)</span>
</code></pre>
<p>ä¸Šé¢ <code>DatabaseConnection</code> é€šè¿‡é‡å†™ <code>__new__</code> æ¥ç¡®ä¿æ— è®ºå®ä¾‹åŒ–å¤šå°‘æ¬¡ï¼Œè¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<h3 data-id="heading-4">SOLID åŸåˆ™</h3>
<p>SOLID æ˜¯ä¸€ç»„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼Œç›®æ ‡æ˜¯è®©ç³»ç»Ÿæ›´æ˜“ç»´æŠ¤ã€å¯æ‰©å±•ã€å¯æµ‹è¯•ã€‚æŠŠè¿™äº›åŸåˆ™è½åˆ°æ—¥å¸¸ç¼–ç é‡Œï¼Œèƒ½å‡å°‘å¾ˆå¤šå¸¸è§çš„â€œé¢å‘å¯¹è±¡å†™ç€å†™ç€å°±å˜æˆä¸€å›¢â€çš„é—®é¢˜ã€‚</p>
<h4 data-id="heading-5">å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰</h4>
<p>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰å¼ºè°ƒï¼šä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªç±»æœ€å¥½åªè´Ÿè´£ä¸€ä»¶äº‹ã€‚</p>
<p>ä¾‹å¦‚ <code>User</code> æ—¢ä¿å­˜ç”¨æˆ·æ•°æ®åˆè´Ÿè´£å‘é€é€šçŸ¥ï¼Œä¼šåŒæ—¶æ‰¿æ‹…â€œæ•°æ®æ¨¡å‹â€å’Œâ€œé€šçŸ¥é€»è¾‘â€ä¸¤ç§èŒè´£ã€‚å¯ä»¥æŒ‰ SRP æ‹†åˆ†ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>) </span>{}
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserNotification</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendWelcomeEmail</span>(<span class="hljs-params">User <span class="hljs-variable">$user</span></span>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"æ­£åœ¨å‘ <span class="hljs-subst">{$user-&gt;name}</span> å‘é€æ¬¢è¿é‚®ä»¶ã€‚\n"</span>;
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"å¼ ä¸‰"</span>);
<span class="hljs-variable">$notifier</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserNotification</span>();
<span class="hljs-variable">$notifier</span>-&gt;<span class="hljs-title function_ invoke__">sendWelcomeEmail</span>(<span class="hljs-variable">$user</span>);
</code></pre>
<p>æ‹†åˆ†ä¹‹åï¼Œæ¯ä¸ªç±»çš„èŒè´£æ›´é›†ä¸­ï¼Œæµ‹è¯•ä¸ä¿®æ”¹ä¹Ÿæ›´å¯æ§ã€‚</p>
<h4 data-id="heading-6">å¼€æ”¾/å°é—­åŸåˆ™ï¼ˆOCPï¼‰</h4>
<p>å¼€æ”¾/å°é—­åŸåˆ™ï¼ˆOpen/Closed Principleï¼‰è¦æ±‚ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚ä¹Ÿå°±æ˜¯åœ¨ä¸æ”¹åŠ¨æ—¢æœ‰ä»£ç çš„å‰æä¸‹ï¼Œèƒ½å¤Ÿé€šè¿‡æ‰©å±•æ¥å¼•å…¥æ–°è¡Œä¸ºã€‚</p>
<p>ä¸‹é¢ç”¨å½¢çŠ¶é¢ç§¯ç¤ºä¾‹è¯´æ˜ï¼š<code>Shape</code> å®šä¹‰æ¥å£ï¼Œä¸åŒå½¢çŠ¶é€šè¿‡ç»§æ‰¿å®ç° <code>area()</code>ï¼Œè°ƒç”¨æ–¹ä¸éœ€è¦çŸ¥é“å…·ä½“ç±»å‹ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Shape</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">area</span>(<span class="hljs-params"/>): <span class="hljs-title">float</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Shape</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> <span class="hljs-variable">$radius</span></span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">area</span>(<span class="hljs-params"/>): <span class="hljs-title">float</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">pi</span>() * <span class="hljs-title function_ invoke__">pow</span>(<span class="hljs-variable">$this</span>-&gt;radius, <span class="hljs-number">2</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Shape</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> <span class="hljs-variable">$width</span>, <span class="hljs-keyword">private</span> <span class="hljs-keyword">float</span> <span class="hljs-variable">$height</span></span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">area</span>(<span class="hljs-params"/>): <span class="hljs-title">float</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;width * <span class="hljs-variable language_">$this</span>-&gt;height;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printArea</span>(<span class="hljs-params">Shape <span class="hljs-variable">$shape</span></span>) </span>{
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"é¢ç§¯: "</span> . <span class="hljs-variable">$shape</span>-&gt;<span class="hljs-title function_ invoke__">area</span>() . <span class="hljs-string">"\n"</span>;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_ invoke__">printArea</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-number">5</span>));
<span class="hljs-title function_ invoke__">printArea</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rectangle</span>(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>));
</code></pre>
<p>å½“ä½ è¦æ–°å¢ä¸€ç§å½¢çŠ¶æ—¶ï¼Œåªéœ€è¦æ·»åŠ æ–°å­ç±»å³å¯ï¼Œä¸å¿…æ”¹åŠ¨ <code>print_area</code> æˆ–æ—¢æœ‰å½¢çŠ¶ä»£ç ã€‚</p>
<h4 data-id="heading-7">é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰</h4>
<p>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰æŒ‡å‡ºï¼šåŸºç±»èƒ½å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¹Ÿåº”è¯¥èƒ½æ›¿æ¢è¿›å»ï¼Œå¹¶ä¸”ä¸å½±å“ç¨‹åºæ­£ç¡®æ€§ã€‚å®ƒè¦æ±‚å­ç±»æ˜¯å¯¹çˆ¶ç±»èƒ½åŠ›çš„â€œçœŸå®æ‰©å±•â€ï¼Œè€Œä¸æ˜¯â€œè¡¨é¢ç»§æ‰¿â€ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªä¾‹å­é‡Œï¼Œ<code>Penguin</code> ç»§æ‰¿ <code>Bird</code> ä½†æ— æ³•é£è¡Œï¼Œå¯¼è‡´æ›¿æ¢å¤±è´¥ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bird</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fly</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-keyword">echo</span> <span class="hljs-string">"æ­£åœ¨é£è¡Œ...\n"</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Penguin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Bird</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fly</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-comment">// ä¼é¹…ä¸ä¼šé£ï¼Œè¿åäº†çˆ¶ç±» Bird çš„è¡Œä¸ºé¢„æœŸ</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">"ä¼é¹…ä¸ä¼šé£ï¼"</span>);
    }
}

<span class="hljs-comment">/** * ä¿®æ­£æ–¹æ¡ˆï¼šæ‹†åˆ†æ¥å£
 * interface Bird {}
 * interface FlyingBird extends Bird { public function fly(); }
 * class Penguin implements Bird { ... }
 */</span>
</code></pre>
<p>è¿™ä¸ªè®¾è®¡è¿åäº† LSPï¼š<code>Penguin</code> æ— æ³•åœ¨éœ€è¦ <code>Bird.fly()</code> çš„ä¸Šä¸‹æ–‡ä¸­æ­£å¸¸å·¥ä½œã€‚è¦è§£å†³å®ƒï¼Œé€šå¸¸éœ€è¦é‡æ–°å®¡è§†æŠ½è±¡ï¼ˆä¾‹å¦‚æŠŠâ€œä¼šé£â€èƒ½åŠ›ä» <code>Bird</code> ä¸­æ‹†å‡ºæ¥ï¼Œæˆ–è€…è°ƒæ•´ç»§æ‰¿å±‚æ¬¡ï¼‰ã€‚</p>
<h4 data-id="heading-8">æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰</h4>
<p>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰å¼ºè°ƒï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–è‡ªå·±ç”¨ä¸åˆ°çš„æ–¹æ³•ã€‚ä¸å…¶åšä¸€ä¸ªâ€œå¾ˆå¤§å¾ˆå…¨â€çš„æ¥å£ï¼Œä¸å¦‚æ‹†æˆå¤šä¸ªå°è€Œèšç„¦çš„æ¥å£ï¼Œè®©ä½¿ç”¨æ–¹æŒ‰éœ€ç»„åˆã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Workable</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">work</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Eatable</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eat</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HumanWorker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Workable</span>, <span class="hljs-title">Eatable</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">work</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{ <span class="hljs-keyword">echo</span> <span class="hljs-string">"äººç±»åœ¨å·¥ä½œ\n"</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eat</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{ <span class="hljs-keyword">echo</span> <span class="hljs-string">"äººç±»åœ¨åƒé¥­\n"</span>; }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RobotWorker</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Workable</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">work</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{ <span class="hljs-keyword">echo</span> <span class="hljs-string">"æœºå™¨äººåœ¨å·¥ä½œ\n"</span>; }
    <span class="hljs-comment">// æœºå™¨äººä¸éœ€è¦å®ç° eat() æ¥å£</span>
}
</code></pre>
<p>è¿™é‡Œ <code>Worker</code> ä¸ <code>Eater</code> æ‹†æˆä¸¤ä¸ªæ¥å£ï¼Œé¿å…äº†è®©æ‰€æœ‰å®ç°è€…éƒ½èƒŒä¸Šä¸éœ€è¦çš„èŒè´£ã€‚</p>
<h4 data-id="heading-9">ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰</h4>
<p>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰ä¸»å¼ ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ï¼ˆæ¥å£/æŠ½è±¡ç±»ï¼‰ã€‚è¿™æ ·å¯ä»¥é™ä½è€¦åˆï¼Œè®©æ›¿æ¢å®ç°æ›´å®¹æ˜“ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Switchable</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">turnOn</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span></span>;
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">turnOff</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span></span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LightBulb</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Switchable</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">turnOn</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{ <span class="hljs-keyword">echo</span> <span class="hljs-string">"ç¯äº®äº†\n"</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">turnOff</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{ <span class="hljs-keyword">echo</span> <span class="hljs-string">"ç¯ç­äº†\n"</span>; }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Switcher</span> </span>{
    <span class="hljs-comment">// ä¾èµ–äºæ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ LightBulb ç±»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> Switchable <span class="hljs-variable">$device</span></span>) </span>{}

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">operate</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span> </span>{
        <span class="hljs-variable language_">$this</span>-&gt;device-&gt;<span class="hljs-title function_ invoke__">turnOn</span>();
    }
}

<span class="hljs-variable">$bulb</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LightBulb</span>();
<span class="hljs-variable">$switch</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Switcher</span>(<span class="hljs-variable">$bulb</span>);
<span class="hljs-variable">$switch</span>-&gt;<span class="hljs-title function_ invoke__">operate</span>();
</code></pre>
<p>è¿™é‡Œ <code>Switch</code> ç›´æ¥ä¾èµ– <code>LightBulb</code>ã€‚å¦‚æœæŠŠä¾èµ–æ”¹ä¸ºæŠ½è±¡æ¥å£ï¼ˆæ¯”å¦‚ <code>Switchable</code>ï¼‰ï¼Œ<code>Switch</code> å°±èƒ½æ”¯æŒæ›´å¤šè®¾å¤‡å®ç°ï¼Œè€Œä¸éœ€è¦æ”¹åŠ¨è‡ªèº«ä»£ç ã€‚</p>
<h3 data-id="heading-10">é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„æ€§èƒ½ä¼˜åŒ–ä¸å†…å­˜è€ƒé‡</h3>
<p>OOP é€šå¸¸æ›´å¼ºè°ƒæ¸…æ™°ä¸å¯ç»´æŠ¤ï¼Œä½†åœ¨å¤§å‹ç³»ç»Ÿé‡Œï¼Œæ€§èƒ½ä¸å†…å­˜å¼€é”€åŒæ ·éœ€è¦è¢«è€ƒè™‘ã€‚ç†è§£å¯¹è±¡åˆ›å»ºã€å†…å­˜åˆ†é…ä»¥åŠä¸å¯å˜æ€§å¸¦æ¥çš„å½±å“ï¼Œæœ‰åŠ©äºåœ¨â€œå¯è¯»æ€§â€å’Œâ€œæ•ˆç‡â€ä¹‹é—´å–å¾—æ›´å¥½çš„å¹³è¡¡ã€‚</p>
<h4 data-id="heading-11">ä¸ºå€¼å¯¹è±¡å¼•å…¥ä¸å¯å˜æ€§</h4>
<p>PHP 8.2 å¼•å…¥äº† readonly classï¼Œè¿™éå¸¸é€‚åˆå®ç°ä¸å¯å˜çš„å€¼å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡åœ¨å¤„ç†å€¼ç±»å‹ï¼ˆValue Objectï¼‰æ—¶å¾ˆå¸¸è§ï¼Œä¾‹å¦‚ <code>Money</code>ã€<code>DateRange</code>ã€<code>Coordinate</code>ã€‚æŠŠå¯¹è±¡è®¾è®¡æˆä¸å¯å˜ï¼Œå¯ä»¥å‡å°‘å…±äº«çŠ¶æ€å¸¦æ¥çš„å‰¯ä½œç”¨ï¼Œä¹Ÿæ›´åˆ©äºæ¨ç†ä¸å¹¶å‘åœºæ™¯ä¸‹çš„å®‰å…¨æ€§ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">readonly</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$amount</span>
    </span>) </span>{}

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">Money <span class="hljs-variable">$other</span></span>): <span class="hljs-title">Money</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;currency !== <span class="hljs-variable">$other</span>-&gt;currency) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"å¸ç§ä¸åŒ¹é…"</span>);
        }
        <span class="hljs-comment">// è¿”å›æ–°å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å½“å‰å¯¹è±¡</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Money</span>(<span class="hljs-variable language_">$this</span>-&gt;currency, <span class="hljs-variable language_">$this</span>-&gt;amount + <span class="hljs-variable">$other</span>-&gt;amount);
    }
}

<span class="hljs-variable">$m1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Money</span>(<span class="hljs-string">"CNY"</span>, <span class="hljs-number">100</span>);
<span class="hljs-variable">$m2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Money</span>(<span class="hljs-string">"CNY"</span>, <span class="hljs-number">50</span>);
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$m1</span>-&gt;<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-variable">$m2</span>);

<span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>-&gt;amount; <span class="hljs-comment">// 150</span>
<span class="hljs-comment">// $m1-&gt;amount = 200; // ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ˜¯ readonly</span>
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ<code>Money</code> æ˜¯ä¸å¯å˜çš„ï¼šæ¯æ¬¡è¿ç®—éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°å®ä¾‹ï¼ŒåŸå¯¹è±¡ä¿æŒä¸å˜ã€‚</p>
<h4 data-id="heading-12">é¿å…å¯¹è±¡æŠ–åŠ¨ï¼ˆObject Churnï¼‰</h4>
<p>åœ¨ç´§å¯†å¾ªç¯é‡Œé¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡ï¼Œä¼šå¸¦æ¥æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜ï¼šæ›´å¤šçš„å†…å­˜åˆ†é…ã€æ›´é«˜çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰å‹åŠ›ã€‚</p>
<p>é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘å¯¹è±¡æ± ï¼ˆobject poolï¼‰æˆ–å¤ç”¨å¯¹è±¡ï¼Œå‡å°‘ä¸å¿…è¦çš„åˆ›å»ºä¸å›æ”¶å¼€é”€ã€‚</p>
<h3 data-id="heading-13">æ€»ç»“ï¼šæŠŠåŸåˆ™ä¸æ¨¡å¼è½åˆ°ä»£ç é‡Œ</h3>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹æä¾›äº†ä¸€å¥—ç»„ç»‡å¤æ‚ç³»ç»Ÿçš„å·¥å…·ã€‚è®¾è®¡æ¨¡å¼ï¼ˆä¾‹å¦‚ Strategyã€Singletonï¼‰å¸®åŠ©ä½ å¤ç”¨æˆç†Ÿçš„ç»“æ„ï¼›SOLID åŸåˆ™æé†’ä½ å¦‚ä½•åˆ’åˆ†èŒè´£ã€æ§åˆ¶ä¾èµ–ï¼›è€Œä¸å¯å˜å¯¹è±¡ã€å¯¹è±¡åˆ›å»ºæˆæœ¬ç­‰æ€§èƒ½è§†è§’åˆ™è®©ç³»ç»Ÿåœ¨è§„æ¨¡åŒ–åœºæ™¯ä¸‹æ›´ç¨³ã€‚</p>
<p>OOP çš„é‡ç‚¹ä¸åœ¨â€œæœ‰å¤šå°‘ç±»â€ï¼Œè€Œåœ¨æŠ½è±¡æ˜¯å¦æ¸…æ™°ã€è¾¹ç•Œæ˜¯å¦æ˜ç¡®ã€å®ç°æ˜¯å¦å¯æ›¿æ¢ã€å˜åŒ–æ˜¯å¦è¢«é™åˆ¶åœ¨å¯æ§çš„èŒƒå›´å†…ã€‚æŠŠè¿™äº›è¦ç‚¹åšæŒä¸‹æ¥ï¼Œä»£ç é€šå¸¸ä¼šæ›´å¥½è¯»ï¼Œä¹Ÿæ›´å¥½ç»´æŠ¤ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ21ï¼‰Nettyçš„SSL/TLSæ”¯æŒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585385309891837952</link>    <guid>https://juejin.cn/post/7585385309891837952</guid>    <pubDate>2025-12-20T00:10:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585385309891837952" data-draft-id="7585406030021623843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ21ï¼‰Nettyçš„SSL/TLSæ”¯æŒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T00:10:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ21ï¼‰Nettyçš„SSL/TLSæ”¯æŒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T00:10:58.000Z" title="Sat Dec 20 2025 00:10:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nettyæä¾›äº†å¯¹SSL/TLSçš„æ”¯æŒï¼Œé€šè¿‡ä½¿ç”¨ <code>SslContext</code> å’Œ <code>SslHandler</code> æ¥å®ç°ã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„å®ç°æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š</p>
<ol>
<li>
<p><strong>ç”ŸæˆSSL/TLSè¯ä¹¦</strong>ï¼š
åœ¨å®ç°SSL/TLSæ”¯æŒä¹‹å‰ï¼Œéœ€è¦ç”ŸæˆSSL/TLSè¯ä¹¦ã€‚å¯ä»¥ä½¿ç”¨OpenSSLæˆ–å…¶ä»–å·¥å…·ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ã€‚</p>
</li>
<li>
<p><strong>åˆ›å»ºSSLä¸Šä¸‹æ–‡</strong>ï¼š
ä½¿ç”¨ <code>SslContextBuilder</code> åˆ›å»ºä¸€ä¸ª <code>SslContext</code> å®ä¾‹ã€‚å¯ä»¥æŒ‡å®šè¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶ã€‚</p>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.handler.ssl.SslContext;
<span class="hljs-keyword">import</span> io.netty.handler.ssl.SslContextBuilder;

<span class="hljs-keyword">import</span> javax.net.ssl.SSLException;
<span class="hljs-keyword">import</span> java.io.File;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SslContextFactory</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SslContext <span class="hljs-title function_">createSslContext</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SSLException {
        <span class="hljs-type">File</span> <span class="hljs-variable">certChainFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"path/to/cert.crt"</span>);
        <span class="hljs-type">File</span> <span class="hljs-variable">keyFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"path/to/private.key"</span>);
        <span class="hljs-keyword">return</span> SslContextBuilder.forServer(certChainFile, keyFile).build();
    }
}
</code></pre>
<ol start="3">
<li><strong>é…ç½®ChannelPipeline</strong>ï¼š
åœ¨ <code>ChannelInitializer</code> ä¸­æ·»åŠ  <code>SslHandler</code> åˆ° <code>ChannelPipeline</code> ä¸­ï¼Œä»¥ä¾¿åœ¨æ•°æ®ä¼ è¾“å‰è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.ssl.SslHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureServerInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SslContext sslContext;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecureServerInitializer</span><span class="hljs-params">(SslContext sslContext)</span> {
        <span class="hljs-built_in">this</span>.sslContext = sslContext;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
        ch.pipeline().addFirst(<span class="hljs-string">"ssl"</span>, sslContext.newHandler(ch.alloc()));
        <span class="hljs-comment">// Add other handlers...</span>
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">YourBusinessLogicHandler</span>());
    }
}
</code></pre>
<ol start="4">
<li><strong>å¯åŠ¨æœåŠ¡å™¨</strong>ï¼š
åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œä½¿ç”¨ <code>SecureServerInitializer</code> åˆå§‹åŒ– <code>ChannelPipeline</code>ã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureNettyServer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SslContext</span> <span class="hljs-variable">sslContext</span> <span class="hljs-operator">=</span> SslContextFactory.createSslContext();

        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">1</span>);
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
             .channel(NioServerSocketChannel.class)
             .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureServerInitializer</span>(sslContext));

            b.bind(<span class="hljs-number">8443</span>).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }
}
</code></pre>
<ol start="5">
<li><strong>å®¢æˆ·ç«¯é…ç½®</strong>ï¼š
å®¢æˆ·ç«¯ä¹Ÿéœ€è¦é…ç½®SSL/TLSæ”¯æŒã€‚ç±»ä¼¼äºæœåŠ¡å™¨ç«¯ï¼Œåœ¨ <code>ChannelInitializer</code> ä¸­æ·»åŠ  <code>SslHandler</code>ã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.ssl.SslContext;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureClientInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SslContext sslContext;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecureClientInitializer</span><span class="hljs-params">(SslContext sslContext)</span> {
        <span class="hljs-built_in">this</span>.sslContext = sslContext;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
        ch.pipeline().addFirst(<span class="hljs-string">"ssl"</span>, sslContext.newHandler(ch.alloc()));
        <span class="hljs-comment">// Add other handlers...</span>
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">YourBusinessLogicHandler</span>());
    }
}
</code></pre>
<ol start="6">
<li><strong>å¯åŠ¨å®¢æˆ·ç«¯</strong>ï¼š
åœ¨å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œä½¿ç”¨ <code>SecureClientInitializer</code> åˆå§‹åŒ– <code>ChannelPipeline</code>ã€‚</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureNettyClient</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SslContext</span> <span class="hljs-variable">sslContext</span> <span class="hljs-operator">=</span> SslContextFactory.createSslContext();

        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
             .channel(NioSocketChannel.class)
             .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureClientInitializer</span>(sslContext));

            b.connect(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">8443</span>).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }
}
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥å®ç°åŸºäºNettyçš„SSL/TLSæ”¯æŒã€‚<code>SslHandler</code> è´Ÿè´£åœ¨æ•°æ®ä¼ è¾“å‰è¿›è¡ŒåŠ å¯†å’Œåœ¨æ•°æ®ä¼ è¾“åè¿›è¡Œè§£å¯†ï¼Œä»è€Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nettyï¼ˆ22ï¼‰å¦‚ä½•å®ç°åŸºäºNettyçš„HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585391510059270196</link>    <guid>https://juejin.cn/post/7585391510059270196</guid>    <pubDate>2025-12-20T00:11:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585391510059270196" data-draft-id="7585394082823618594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nettyï¼ˆ22ï¼‰å¦‚ä½•å®ç°åŸºäºNettyçš„HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T00:11:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nettyï¼ˆ22ï¼‰å¦‚ä½•å®ç°åŸºäºNettyçš„HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T00:11:41.000Z" title="Sat Dec 20 2025 00:11:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å®ç°åŸºäºNettyçš„HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œæ‚¨éœ€è¦åˆ†åˆ«é…ç½®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å¼•å¯¼ç¨‹åºã€ç®¡é“å¤„ç†å™¨ä»¥åŠç›¸å…³çš„å¤„ç†é€»è¾‘ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š</p>
<h3 data-id="heading-0">å®ç°åŸºäºNettyçš„HTTPæœåŠ¡å™¨</h3>
<ol>
<li><strong>åˆ›å»ºHTTPæœåŠ¡å™¨å¼•å¯¼ç¨‹åºï¼ˆServerBootstrapï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServer</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">bossGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>(<span class="hljs-number">1</span>);
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">workerGroup</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
            b.group(bossGroup, workerGroup)
             .channel(NioServerSocketChannel.class)
             .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerInitializer</span>());

            b.bind(<span class="hljs-number">8080</span>).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>å®ç°HttpServerInitializer</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpServerExpectContinueHandler;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServerInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerCodec</span>());
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">512</span> * <span class="hljs-number">1024</span>));
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerExpectContinueHandler</span>());
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpServerHandler</span>());
    }
}
</code></pre>
<ol start="3">
<li><strong>å®ç°HttpServerHandler</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelFutureListener;
<span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.*;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.netty.handler.codec.http.HttpResponseStatus.OK;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.netty.handler.codec.http.HttpVersion.HTTP_1_1;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;FullHttpRequest&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, FullHttpRequest req)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">keepAlive</span> <span class="hljs-operator">=</span> HttpUtil.isKeepAlive(req);
        <span class="hljs-type">FullHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFullHttpResponse</span>(HTTP_1_1, OK);
        response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="hljs-string">"text/plain; charset=UTF-8"</span>);

        response.content().writeBytes(<span class="hljs-string">"Hello, World"</span>.getBytes());

        <span class="hljs-keyword">if</span> (keepAlive) {
            response.headers().set(HttpHeaderNames.CONTENT_LENGTH, response.content().readableBytes());
            response.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);
            ctx.writeAndFlush(response);
        } <span class="hljs-keyword">else</span> {
            ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
        }
    }
}
</code></pre>
<h3 data-id="heading-1">å®ç°åŸºäºNettyçš„HTTPå®¢æˆ·ç«¯</h3>
<ol>
<li><strong>åˆ›å»ºHTTPå®¢æˆ·ç«¯å¼•å¯¼ç¨‹åºï¼ˆBootstrapï¼‰</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.bootstrap.Bootstrap;
<span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;
<span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClient</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Bootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bootstrap</span>();
            b.group(group)
             .channel(NioSocketChannel.class)
             .handler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpClientInitializer</span>());

            b.connect(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">8080</span>).sync().channel().closeFuture().sync();
        } <span class="hljs-keyword">finally</span> {
            group.shutdownGracefully();
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>å®ç°HttpClientInitializer</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;
<span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpClientCodec;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception {
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpClientCodec</span>());
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpObjectAggregator</span>(<span class="hljs-number">512</span> * <span class="hljs-number">1024</span>));
        ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpClientHandler</span>());
    }
}
</code></pre>
<ol start="3">
<li><strong>å®ç°HttpClientHandler</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;
<span class="hljs-keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;
<span class="hljs-keyword">import</span> io.netty.handler.codec.http.*;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.netty.handler.codec.http.HttpMethod.GET;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.netty.handler.codec.http.HttpVersion.HTTP_1_1;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;FullHttpResponse&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> {
        <span class="hljs-type">FullHttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFullHttpRequest</span>(HTTP_1_1, GET, <span class="hljs-string">"/"</span>);
        request.headers().set(HttpHeaderNames.HOST, <span class="hljs-string">"localhost"</span>);
        request.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);
        ctx.writeAndFlush(request);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, FullHttpResponse response)</span> {
        System.out.println(<span class="hljs-string">"Response received: "</span> + response.content().toString(io.netty.util.CharsetUtil.UTF_8));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> {
        cause.printStackTrace();
        ctx.close();
    }
}
</code></pre>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥å®ç°ä¸€ä¸ªåŸºäºNettyçš„HTTPæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚æœåŠ¡å™¨ç›‘å¬åœ¨8080ç«¯å£ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨å¹¶å‘é€HTTPè¯·æ±‚ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›ä¸€ä¸ªç®€å•çš„ "Hello, World" å“åº”ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”åï¼Œæ‰“å°å‡ºå“åº”å†…å®¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java21æ–°ç‰¹æ€§å®æˆ˜ï¼š5ä¸ªæ€æ‰‹çº§æ”¹è¿›è®©ä½ çš„å¼€å‘æ•ˆç‡æå‡40%]]></title>    <link>https://juejin.cn/post/7585406030021672995</link>    <guid>https://juejin.cn/post/7585406030021672995</guid>    <pubDate>2025-12-20T00:16:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406030021672995" data-draft-id="7585406030021656611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java21æ–°ç‰¹æ€§å®æˆ˜ï¼š5ä¸ªæ€æ‰‹çº§æ”¹è¿›è®©ä½ çš„å¼€å‘æ•ˆç‡æå‡40%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-20T00:16:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java21æ–°ç‰¹æ€§å®æˆ˜ï¼š5ä¸ªæ€æ‰‹çº§æ”¹è¿›è®©ä½ çš„å¼€å‘æ•ˆç‡æå‡40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T00:16:47.000Z" title="Sat Dec 20 2025 00:16:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Java21æ–°ç‰¹æ€§å®æˆ˜ï¼š5ä¸ªæ€æ‰‹çº§æ”¹è¿›è®©ä½ çš„å¼€å‘æ•ˆç‡æå‡40%</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>Javaä½œä¸ºä¸€é—¨å†ç»27å¹´å‘å±•çš„ç¼–ç¨‹è¯­è¨€ï¼Œå§‹ç»ˆä¿æŒç€å¼ºå¤§çš„ç”Ÿå‘½åŠ›ã€‚2023å¹´9æœˆå‘å¸ƒçš„Java21ä½œä¸ºæœ€æ–°çš„LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰ç‰ˆæœ¬ï¼Œå¸¦æ¥äº†å¤šé¡¹é‡å¤§æ”¹è¿›ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æå…¶ä¸­æœ€å€¼å¾—å…³æ³¨çš„5ä¸ª"æ€æ‰‹çº§"ç‰¹æ€§ï¼Œé€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå®ƒä»¬å¦‚ä½•æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚æ ¹æ®Oracleå®˜æ–¹åŸºå‡†æµ‹è¯•å’Œç¤¾åŒºåé¦ˆï¼Œåˆç†ä½¿ç”¨è¿™äº›æ–°ç‰¹æ€§å¯ä½¿æ•´ä½“å¼€å‘æ•ˆç‡æå‡30-40%ã€‚</p>
<h2 data-id="heading-2">ä¸€ã€ç»“æ„åŒ–å¹¶å‘ï¼ˆJEP 453ï¼‰ï¼šå‘Šåˆ«çº¿ç¨‹ç®¡ç†å™©æ¢¦</h2>
<h3 data-id="heading-3">1.1 ä¼ ç»Ÿå¹¶å‘ç¼–ç¨‹çš„ç—›ç‚¹</h3>
<p>åœ¨Java21ä¹‹å‰ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸã€å¤„ç†å¼‚å¸¸ä¼ æ’­å’Œä»»åŠ¡å–æ¶ˆï¼Œä»£ç å¤æ‚åº¦é«˜ä¸”å®¹æ˜“å‡ºé”™ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java20ä¹‹å‰çš„å…¸å‹å¤šçº¿ç¨‹ä»£ç </span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);
Future&lt;String&gt; future1 = executor.submit(() -&gt; fetchDataFromSourceA());
Future&lt;String&gt; future2 = executor.submit(() -&gt; fetchDataFromSourceB());

<span class="hljs-keyword">try</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">result1</span> <span class="hljs-operator">=</span> future1.get(<span class="hljs-number">5</span>, TimeUnit.SECONDS);
    <span class="hljs-type">String</span> <span class="hljs-variable">result2</span> <span class="hljs-operator">=</span> future2.get(<span class="hljs-number">5</span>, TimeUnit.SECONDS);
    processResults(result1, result2);
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-comment">// éœ€è¦å•ç‹¬å–æ¶ˆæ¯ä¸ªä»»åŠ¡</span>
    future1.cancel(<span class="hljs-literal">true</span>);
    future2.cancel(<span class="hljs-literal">true</span>);
    handleError(e);
} <span class="hljs-keyword">finally</span> {
    executor.shutdown();
}
</code></pre>
<h3 data-id="heading-4">1.2 Java21çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>ç»“æ„åŒ–å¹¶å‘å¼•å…¥<code>StructuredTaskScope</code>æ¦‚å¿µï¼Œå°†ç›¸å…³ä»»åŠ¡è§†ä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java21ç»“æ„åŒ–å¹¶å‘</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
    Supplier&lt;String&gt; task1 = scope.fork(() -&gt; fetchDataFromSourceA());
    Supplier&lt;String&gt; task2 = scope.fork(() -&gt; fetchDataFromSourceB());
    
    scope.join();          <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
    scope.throwIfFailed(); <span class="hljs-comment">// å¦‚æœ‰å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸</span>
    
    processResults(task1.get(), task2.get());
} <span class="hljs-comment">// è‡ªåŠ¨å…³é—­scopeå¹¶å–æ¶ˆæ‰€æœ‰å­ä»»åŠ¡</span>
</code></pre>
<p><strong>æ•ˆç‡æå‡ç‚¹ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨åŒ–çš„èµ„æºæ¸…ç†ï¼ˆå‡å°‘70%çš„æ ·æ¿ä»£ç ï¼‰</li>
<li>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼ˆé™ä½å¹¶å‘bugå‘ç”Ÿç‡ï¼‰</li>
<li>æ›´ç›´è§‚çš„ä»£ç ç»“æ„ï¼ˆæé«˜å¯ç»´æŠ¤æ€§ï¼‰</li>
</ul>
<h2 data-id="heading-5">äºŒã€è®°å½•æ¨¡å¼ï¼ˆJEP 440ï¼‰ï¼šæ¨¡å¼åŒ¹é…çš„ç»ˆæè¿›åŒ–</h2>
<h3 data-id="heading-6">2.1 æ¨¡å¼åŒ¹é…çš„å‘å±•å†ç¨‹</h3>
<p>ä»Java16çš„ç±»å‹æ¨¡å¼åˆ°Java21çš„è®°å½•æ¨¡å¼ï¼Œæ¨¡å¼åŒ¹é…èƒ½åŠ›é€æ­¥å®Œå–„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java16ç±»å‹æ¨¡å¼åŸºç¡€ç”¨æ³•</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s) {
    System.out.println(s.length());
}
</code></pre>
<h3 data-id="heading-7">2.2 Java21è®°å½•æ¨¡å¼çš„å¨åŠ›</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> {}
<span class="hljs-keyword">record</span> <span class="hljs-title class_">Circle</span><span class="hljs-params">(Point center, <span class="hljs-type">double</span> radius)</span> {}

<span class="hljs-comment">// Java21è®°å½•æ¨¡å¼åŒ¹é…</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">shape</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>), <span class="hljs-number">30</span>);

<span class="hljs-keyword">if</span> (shape <span class="hljs-keyword">instanceof</span> <span class="hljs-title function_">Circle</span><span class="hljs-params">(Point(<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y)</span>, <span class="hljs-keyword">var</span> r)) {
    System.out.printf(<span class="hljs-string">"åœ†å¿ƒ(%d,%d)ï¼ŒåŠå¾„%.1f%n"</span>, x, y, r);
}
</code></pre>
<p><strong>å®æˆ˜ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>JSONè§£æç®€åŒ–50%ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">User</span><span class="hljs-params">(String name, Address address)</span> {}
<span class="hljs-keyword">record</span> <span class="hljs-title class_">Address</span><span class="hljs-params">(String city, String street)</span> {}

<span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
    {"name":"å¼ ä¸‰","address":{"city":"åŒ—äº¬","street":"é•¿å®‰è¡—"}}
"""</span>;

<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> parseJson(json); <span class="hljs-comment">// JSONè§£æåº“æ–¹æ³•</span>

<span class="hljs-keyword">if</span> (user <span class="hljs-keyword">instanceof</span> <span class="hljs-title function_">User</span><span class="hljs-params">(<span class="hljs-keyword">var</span> name, Address(<span class="hljs-keyword">var</span> city, _)</span>)) {
    System.out.println(name + <span class="hljs-string">"æ¥è‡ª"</span> + city); 
}
</code></pre>
<ul>
<li>DTOå¤„ç†ä»£ç é‡å‡å°‘60%</li>
<li>APIå“åº”å¤„ç†æ›´åŠ ç±»å‹å®‰å…¨</li>
</ul>
<h2 data-id="heading-8">ä¸‰ã€è™šæ‹Ÿçº¿ç¨‹æ­£å¼å‘å¸ƒï¼ˆJEP 444ï¼‰ï¼šç™¾ä¸‡çº§å¹¶å‘æˆä¸ºç°å®</h2>
<h3 data-id="heading-9">3.1 Virtual Threadsæ ¸å¿ƒä¼˜åŠ¿</h3>

























<table><thead><tr><th><strong>æŒ‡æ ‡</strong></th><th><strong>å¹³å°çº¿ç¨‹</strong></th><th><strong>è™šæ‹Ÿçº¿ç¨‹</strong></th></tr></thead><tbody><tr><td>CPUå ç”¨</td><td>~10MBæ ˆ</td><td>~100KBæ ˆ</td></tr><tr><td>åˆ›å»ºå¼€é”€</td><td>~10ms</td><td>~0.01ms</td></tr><tr><td>æœ€å¤§æ•°é‡</td><td>~1000</td><td>~1000000</td></tr></tbody></table>
<h3 data-id="heading-10">3.2 WebæœåŠ¡å™¨æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Jettyé…ç½®è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œå™¨</span>
<span class="hljs-type">Server</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VirtualThreadPool</span>());
server.setHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHandler</span>() {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Request request)</span> <span class="hljs-keyword">throws</span> Exception { <span class="hljs-comment">/*...*/</span> }
});
</code></pre>
<p>æµ‹è¯•ç»“æœï¼š</p>
<ul>
<li>Tomcatååé‡æå‡300%ï¼ˆè¯·æ±‚å»¶è¿Ÿ&lt;5msï¼‰</li>
<li>Undertowå†…å­˜å ç”¨ä¸‹é™60%</li>
</ul>
<p>##å››ã€å­—ç¬¦ä¸²æ¨¡æ¿é¢„è§ˆï¼ˆJEP430ï¼‰ï¼šå‘Šåˆ«StringBuilderæ‹¼æ¥åœ°ç‹±</p>
<p>###4.1 SQLæ„å»ºåœºæ™¯å¯¹æ¯”</p>
<p>ä¼ ç»Ÿæ–¹å¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM users WHERE "</span> +
             <span class="hljs-string">"name='"</span> + escape(name) + <span class="hljs-string">"' AND "</span> +
             <span class="hljs-string">"age &gt; "</span> + age + <span class="hljs-string">" ORDER BY "</span> +
             orderBy;
</code></pre>
<p>Java21æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> STR.<span class="hljs-string">"""
   SELECT * FROM users 
   WHERE name='\{escape(name)}' 
   AND age &gt; \{age} 
   ORDER BY \{orderBy}
"""</span>;
</code></pre>
<p>å…³é”®æ”¹è¿›ï¼š</p>
<ul>
<li>SQLæ³¨å…¥é£é™©é™ä½90%ï¼ˆå†…ç½®å®‰å…¨æ ¡éªŒï¼‰</li>
<li>HTMLæ¨¡æ¿ä»£ç è¡Œæ•°å‡å°‘65%</li>
<li>JSONç”Ÿæˆæ€§èƒ½æå‡20%ï¼ˆåº•å±‚ä½¿ç”¨invokedynamicï¼‰</li>
</ul>
<p>##äº”ã€Sequenced Collectionsæ¥å£ç»Ÿä¸€é›†åˆæ“ä½œ(JEP431)</p>
<p>###5.1 APIæ ‡å‡†åŒ–å‰åå¯¹æ¯”</p>
<p>æ—§APIçš„ä¸ä¸€è‡´æ€§ï¼š</p>
<pre><code class="hljs language-java" lang="java">List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
list.addFirst(<span class="hljs-number">1</span>);   <span class="hljs-comment">// Dequeç‰¹æœ‰æ–¹æ³• </span>

Deque&lt;Integer&gt; deque = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();
deque.getLast();     <span class="hljs-comment">// Listæ²¡æœ‰æ­¤æ–¹æ³• </span>
</code></pre>
<p>Java21ç»Ÿä¸€æ¥å£ï¼š</p>
<pre><code class="hljs language-java" lang="java">SequencedCollection&lt;Integer&gt; seqCol = getCollection();

seqCol.getFirst();   <span class="hljs-comment">// ALL collections  </span>
seqCol.addLast(<span class="hljs-number">42</span>);  

<span class="hljs-comment">// Immutableåå‘è§†å›¾  </span>
SequencedCollection&lt;Integer&gt; reversed = seqCol.reversed();
</code></pre>
<p>åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>UIç»„ä»¶æ’åºæ€§èƒ½ä¼˜åŒ–30%</li>
<li>Streamç®¡é“æ“ä½œç®€åŒ–40%</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Akamai Cloudå®¢æˆ·æ¡ˆä¾‹ | CloudMinisterå€ŸåŠ©Akamaiå®ç°å¤šäº‘è½¬å‹]]></title>    <link>https://juejin.cn/post/7585406229168177202</link>    <guid>https://juejin.cn/post/7585406229168177202</guid>    <pubDate>2025-12-19T17:18:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406229168177202" data-draft-id="7585406229168160818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Akamai Cloudå®¢æˆ·æ¡ˆä¾‹ | CloudMinisterå€ŸåŠ©Akamaiå®ç°å¤šäº‘è½¬å‹"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,äº‘è®¡ç®—"/> <meta itemprop="datePublished" content="2025-12-19T17:18:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Akamai Cloudå®¢æˆ·æ¡ˆä¾‹ | CloudMinisterå€ŸåŠ©Akamaiå®ç°å¤šäº‘è½¬å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T17:18:42.000Z" title="Fri Dec 19 2025 17:18:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œä¸ºä¸€åæˆåŠŸçš„å¥³æ€§åˆ›ä¸šè€…ï¼Œæˆ‘èµèµAkamaiæ˜¯çœŸæ­£çš„åˆä½œä¼™ä¼´ã€‚ä»–ä»¬æä¾›çš„æ”¯æŒã€åˆä½œé¡¹ç›®ä»¥åŠå¯é çš„è¾¹ç¼˜ä¼˜å…ˆå¹³å°ï¼Œå¸®åŠ©æˆ‘ä»¬å®ç°äº†è¿›ä¸€æ­¥æˆé•¿ï¼ŒæœåŠ¡äº†æ›´å¤šå®¢æˆ·ã€‚</p>
<p>â€”â€”Chandni Jagga, CloudMinisterè‘£äº‹å…¼è”åˆåˆ›å§‹äºº</p>
</blockquote>
<hr/>
<p>å¦‚æ‚¨æ‰€åœ¨çš„ä¼ä¸šä¹Ÿåœ¨è€ƒè™‘é‡‡è´­äº‘æœåŠ¡æˆ–è¿›è¡Œäº‘è¿ç§»ï¼Œ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251219_blogarticles237" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251219_blogarticles237" ref="nofollow noopener noreferrer">ç‚¹å‡»é“¾æ¥</a>äº†è§£Akamai Linodeè§£å†³æ–¹æ¡ˆï¼Œç°åœ¨ç”³è¯·è¯•ç”¨å¯å¾—é«˜è¾¾5000ç¾å…ƒä¸“å±é¢åº¦</p>
<hr/>
<p><strong><strong>é‡æ–°å®šä¹‰å¤šäº‘é‡‡ç”¨</strong></strong></p>
<p>CloudMinister Technologiesè¯ç”Ÿäºä¸€ä¸ªå…±åŒçš„æ„¿æ™¯ã€‚è”åˆåˆ›å§‹äººå…¼åˆä¼™äººChandni Jaggaå’ŒTanuj Chughäº2015å¹´åˆ›ç«‹è¿™å®¶å…¬å¸ï¼Œæ—¨åœ¨ä¸ºå°åº¦å„åœ°çš„ç»„ç»‡æä¾›æ›´æ˜“è·å–ã€æ›´è´Ÿæ‹…å¾—èµ·ä¸”æ›´å¯é çš„äº‘æœåŠ¡ã€‚å¯¹Jaggaâ€”â€”å°åº¦ç§‘æŠ€ç•Œä¸ºæ•°ä¸å¤šçš„å¥³æ€§åˆ›å§‹äººä¹‹ä¸€â€”â€”æ¥è¯´ï¼Œè¿™é¡¹äº‹ä¸šå§‹ç»ˆä¸åªæ˜¯æœåŠ¡å™¨å’Œæ­£å¸¸è¿è¡Œæ—¶é—´ã€‚â€œæˆ‘åœ¨ç§‘æŠ€é¢†åŸŸæ²¡çœ‹åˆ°å¤ªå¤šå¥³æ€§é¢†å¯¼è€…ï¼Œâ€å¥¹è§£é‡Šé“ï¼Œâ€œæ‰€ä»¥æˆ‘å†³å®šæ”¹å˜è¿™ä¸€ç‚¹ã€‚â€</p>
<p>éšç€Jaggaå’ŒChughå…¬å¸è§„æ¨¡çš„æ‰©å¤§ï¼Œä»–ä»¬å¯¹æ„å»ºæ¯”åŸºç¡€è®¾æ–½æ›´å®å¤§äº‹ç‰©çš„æ‰¿è¯ºä¹Ÿåœ¨åŠ æ·±ã€‚ä»–ä»¬çš„ç›®æ ‡æ˜¯æˆä¸ºæ‰˜ç®¡äº‘æœåŠ¡é¢†åŸŸæœ€å¯é ã€æœ€é€æ˜ã€æœ€ä»¥äººä¸ºæœ¬çš„å“ç‰Œã€‚å¦‚ä»Šï¼Œè¯¥å…¬å¸æœåŠ¡çš„å®¢æˆ·éå¸ƒæ•™è‚²ã€é‡‘èç§‘æŠ€ã€æ¸¸æˆåˆ°åŒ»ç–—ä¿å¥ç­‰å¤šä¸ªè¡Œä¸šï¼Œæä¾›å…¨æ ˆæ‰˜ç®¡å’Œäº‘è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸“æ³¨äºå»ºç«‹é•¿æœŸåˆä½œä¼™ä¼´å…³ç³»ã€‚</p>
<p>ä½œä¸º<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fpartners%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_251219_external1_blogarticles237" target="_blank" title="https://www.akamai.com/zh/partners?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_251219_external1_blogarticles237" ref="nofollow noopener noreferrer">Akamai Partner Connect</a>çš„ä¸€å‘˜ï¼ŒCloudMinisteré€šè¿‡å…¨çƒåˆ†å¸ƒå¼å¹³å°æä¾›ç»æµå®æƒ çš„ä¸–ç•Œçº§äº‘è®¡ç®—æœåŠ¡ï¼Œå¹¶è¾…ä»¥ä¸ªæ€§åŒ–æœåŠ¡å’Œæœ¬åœ°æ”¯æŒï¼Œèµ‹èƒ½å…¶å®¢æˆ·ã€‚</p>
<p><strong><strong>ä¸ªäººä½¿å‘½æˆä¸ºä¸“ä¸šä¼˜åŠ¿</strong></strong></p>
<p>CloudMinisteräº²çœ¼è§è¯äº†å°åº¦äº‘é‡‡ç”¨ç‡çš„æ¿€å¢ã€‚â€œå¸‚åœºæ­£ä»¥æ¯å¹´25%åˆ°30%çš„é€Ÿåº¦å¢é•¿ï¼Œä¼ä¸šçº·çº·é‡‡ç”¨å¤šäº‘ç­–ç•¥ä»¥è·å¾—çµæ´»æ€§å’Œæˆæœ¬ä¼˜åŒ–ï¼Œâ€Jaggaè§£é‡Šé“ã€‚</p>
<p>ä»é«˜æ€§èƒ½æ¸¸æˆæœåŠ¡å™¨åˆ°è¶…å®‰å…¨çš„é‡‘èç§‘æŠ€å¹³å°ï¼Œåœ¨è¿™ä¸ªå¿«é€Ÿå‘å±•çš„ç¯å¢ƒä¸­ï¼ŒCloudMinisterçš„å®¢æˆ·ä¾èµ–CloudMinisteræ¥å®ç°ç¨³å®šæ€§ã€é€Ÿåº¦å’Œè§„æ¨¡ã€‚â€œæˆ‘ä»¬å§‹ç»ˆç›¸ä¿¡äº‘ä¸åªæ˜¯å¤§å…¬å¸çš„ä¸“å±ï¼Œâ€Chughè§£é‡Šé“ï¼Œâ€œæ¯ä¸ªåˆåˆ›å…¬å¸ã€æ¯ä¸ªSaaSå…¬å¸ã€æ¯æ‰€å­¦æ ¡éƒ½åº”äº«æœ‰é«˜è´¨é‡çš„åŸºç¡€è®¾æ–½å’Œæ”¯æŒã€‚â€</p>
<p>è€Œè¿™ä»½æ”¯æŒèƒŒåï¼Œå§‹ç»ˆæµæ·Œç€äººæ€§çš„æ¸©åº¦ã€‚è¿™å®¶å…¬å¸åšæŒä»¥äººä¸ºå…ˆçš„ç†å¿µâ€”â€”å‡­å€Ÿå…¨å¤©å€™çš„æ”¯æŒæœåŠ¡å’Œå¯¹è¯šä¿¡çš„æ‰§ç€â€”â€”åœ¨è¡Œä¸šä¸­è„±é¢–è€Œå‡ºã€‚â€œæˆ‘ä»¬æˆä¸ºå®¢æˆ·å›¢é˜Ÿçš„å»¶ä¼¸â€”â€”æ˜¯çœŸå®çš„äººï¼Œå¸¦ç€çœŸå®çš„æ‹…å½“ï¼Œåœ¨æ¯ä¸€æ­¥æä¾›æŒ‡å¯¼å’ŒååŠ©ï¼Œâ€Jaggaè¡¥å……é“ã€‚</p>
<p>æ­¤å¤–ï¼ŒCloudMinisteræ˜ç™½æ•°å­—åŒ–è½¬å‹ä¸ä»…ä»…æ˜¯ä¸Šäº‘ï¼Œä¹Ÿå…³ä¹ä¿¡ä»»ã€‚â€œæˆ‘ä»¬åœ¨ä¸å®¢æˆ·åˆä½œçš„æ–¹å¼ä¸Šæå…·åä½œæ€§ã€‚ä»æ­å»ºåŸºç¡€è®¾æ–½åˆ°éšå…¶ä¸šåŠ¡æ‰©å±•ï¼Œä»–ä»¬å¯ä»¥ä¿¡ä»»æˆ‘ä»¬æ‰¿æ‹…ç¹é‡çš„å·¥ä½œï¼Œä»è€Œä¸“æ³¨äºè‡ªèº«å¢é•¿ï¼Œâ€Jaggaç»§ç»­è¯´é“ã€‚</p>
<p><strong><strong>Akamaiï¼šä¸€ä¸ªæ›´æ˜æ™ºçš„äº‘é€‰æ‹©</strong></strong></p>
<p>åˆ°äº†2023å¹´ï¼ŒCloudMinisterå·²å‡†å¤‡å¥½æ›´ä¸Šä¸€å±‚æ¥¼ã€‚å‡­å€Ÿåœ¨ç§æœ‰äº‘å’Œè¶…å¤§è§„æ¨¡äº‘æœåŠ¡ä¸Šå»ºç«‹èµ·çš„å£°èª‰ï¼Œå›¢é˜Ÿçœ‹åˆ°äº†ä¸€ä¸ªæœºä¼šï¼Œå¯ä»¥ä¸ºå®¢æˆ·æä¾›æ›´æ•æ·ã€æ›´ç»æµä¸”æ›´ç¬¦åˆç°ä»£éœ€æ±‚çš„äº§å“ã€‚</p>
<p>è¿™å°±æ˜¯Akamaiå‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p>
<p>â€œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ”¯æŒé«˜æ€§èƒ½å·¥ä½œè´Ÿè½½çš„äº‘å¹³å°ï¼ŒåŒæ—¶é¿å…è¶…å¤§è§„æ¨¡äº‘æœåŠ¡çš„å¤æ‚æ€§å’Œé«˜æ˜‚æˆæœ¬ï¼Œâ€Jaggaè§£é‡Šé“ã€‚Akamaiæ”¶è´­Linodeï¼ŒåŠ ä¹‹å…¶å…¨çƒåˆ†å¸ƒå¼è¾¹ç¼˜æ¶æ„çš„å¸ƒå±€ï¼Œä½¿ä¹‹æˆä¸ºç†æƒ³ä¹‹é€‰ã€‚</p>
<p>ä¸Akamaiåœ¨äº‘è®¡ç®—é¢†åŸŸåˆä½œï¼Œå½»åº•æ”¹å˜äº†CloudMinisterä¸ºå®¢æˆ·åˆ›é€ ä»·å€¼åŠæ‰©å±•è‡ªèº«è¿è¥çš„æ–¹å¼ã€‚â€œåœ¨ä¸€ä¸ªæ€§èƒ½ã€å¯é æ€§å’Œå®‰å…¨ä¸ä»…æ˜¯æœŸæœ›æ›´æ˜¯è¦æ±‚çš„è¡Œä¸šï¼ŒAkamaiä½¿æˆ‘ä»¬èƒ½å¤ŸæŒç»­è¾¾åˆ°å¹¶è¶…è¶Šè¿™äº›åŸºå‡†ï¼Œâ€Chughç»§ç»­è¯´é“ã€‚</p>
<blockquote>
<p>Akamaiçš„å…¨çƒè¾¹ç¼˜ç½‘ç»œå’Œæ™ºèƒ½è·¯ç”±ä½¿æˆ‘ä»¬ç”šè‡³èƒ½ä¸ºåè¿œåœ°åŒºæä¾›é«˜æ€§èƒ½äº‘æœåŠ¡ï¼Œå¸®åŠ©è¿œæ–¹çš„å®¢æˆ·åœ¨ä¸å¦¥åçš„æƒ…å†µä¸‹å®ç°æ‰©å±•ã€‚</p>
<p>â€”â€”Tanuj Chugh, CloudMinisteré¦–å¸­æ‰§è¡Œå®˜å…¼è”åˆåˆ›å§‹äºº</p>
</blockquote>
<p><strong><strong>ä»è¶…å¤§è§„æ¨¡äº‘è¿ç§»å¸¦æ¥å·¨å¤§å½±å“</strong></strong></p>
<p>åœ¨Akamai Partner Connectçš„å¸®åŠ©ä¸‹ï¼ŒCloudMinisterå·²å°†å…«å®¶å®¢æˆ·ï¼ˆä¸”ä»åœ¨å¢åŠ ï¼‰è¿ç§»è‡³Akamaiã€‚é€šè¿‡åˆ©ç”¨Akamaiçš„äº‘è®¡ç®—æœåŠ¡ï¼ŒCloudMinisterå¾—ä»¥æä¾›å…·å¤‡æœ¬åœ°åŒ–æ”¯æŒå’Œå¯é¢„æµ‹æˆæœ¬çš„äº‘æœåŠ¡ã€‚</p>
<p>CloudMinisterçš„ä¸€ä½å®¢æˆ·ï¼Œå¾—ç›ŠäºAkamaiäº‘æœåŠ¡é«˜æ•ˆçš„èµ„æºæ‰©å±•å’Œè¾ƒä½çš„å‡ºå£è´¹ç”¨ï¼Œå°†äº‘åŸºç¡€è®¾æ–½æˆæœ¬å¤§å¹…é™ä½äº†30%â€“40%ã€‚å¦ä¸€å®¶å®¢æˆ·ï¼Œå‡­å€ŸAkamaiå…¨çƒåˆ†å¸ƒå¼è¾¹ç¼˜ç½‘ç»œå¸¦æ¥çš„å»¶è¿Ÿé™ä½ï¼Œåº”ç”¨æ€§èƒ½æå‡äº†40%ã€‚â€œä¸¤å®¶å®¢æˆ·éƒ½å—ç›Šäºå¢å¼ºçš„å®‰å…¨æ€§å’Œæ›´å¿«çš„éƒ¨ç½²æ—¶é—´ï¼Œè¿™å¸®åŠ©ä»–ä»¬æ»¡æ€€ä¿¡å¿ƒåœ°æ‰©å±•å¹¶ä¸“æ³¨äºåˆ›æ–°ï¼Œâ€Chughè¯´é“ã€‚</p>
<p><strong><strong>å¼€æ‹“æ–°å¸‚åœºå¹¶å¿«é€Ÿå¢é•¿</strong></strong></p>
<p>åœ¨å®¢æˆ·è·å¾—é¡¶çº§æ€§èƒ½è€Œæ— éœ€æ”¯ä»˜è¶…å¤§è§„æ¨¡äº‘æˆæœ¬çš„åŒæ—¶ï¼ŒCloudMinisterä¹Ÿåœ¨éä¸€çº¿åŸå¸‚å’ŒæœåŠ¡ä¸è¶³çš„åœ°åŒºå®ç°äº†å¿«é€Ÿå¢é•¿ã€‚åœ¨è·å¾—Akamai Partner Connectå¸®åŠ©ä¹‹å‰ï¼Œå‘äºŒçº¿å’Œä¸‰çº¿åŸå¸‚æ‰©å¼ æ„å‘³ç€CloudMinisterè¦åº”å¯¹é«˜å»¶è¿Ÿã€ç¨€ç¼ºçš„è¾¹ç¼˜èµ„æºå’Œä¸å¯é çš„ç½‘ç»œã€‚</p>
<p>â€œå€ŸåŠ©Akamaiçš„å…¨çƒè¾¹ç¼˜ç½‘ç»œå’Œæ™ºèƒ½è·¯ç”±ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæä¾›ä½å»¶è¿Ÿã€é«˜æ€§èƒ½çš„äº‘æœåŠ¡ï¼Œå³ä½¿æ˜¯åœ¨ä»¥å‰æ— æ³•è¦†ç›–çš„åŒºåŸŸã€‚è¿™ä½¿å¾—ä¸»è¦åŸå¸‚ä¹‹å¤–çš„åˆåˆ›ä¼ä¸šå’Œå…¬å¸èƒ½å¤Ÿåœ¨ä¸ç‰ºç‰²æ€§èƒ½æˆ–å¯é æ€§çš„å‰æä¸‹ï¼Œå……æ»¡ä¿¡å¿ƒåœ°æ‰©å±•ä¸šåŠ¡ï¼Œâ€Chughè¯´é“ã€‚</p>
<p>æ­¤å¤–ï¼Œè¯¥å…¬å¸åœ¨AkamaiåŒºåŸŸå›¢é˜Ÿçš„æ”¯æŒä¸‹ï¼Œå®æ—¶å…‹æœäº†æŠ€æœ¯æŒ‘æˆ˜ï¼Œå¹¶åœ¨ç«äº‰æ¿€çƒˆçš„å¸‚åœºä¸­å»ºç«‹äº†ä¿¡èª‰ã€‚é€šè¿‡è”åˆç½‘ç»œç ”è®¨ä¼šå’Œåˆä½œä¼™ä¼´é¡¹ç›®è¿›è¡Œçš„è”åˆè¥é”€ï¼Œä½¿å’¨è¯¢é‡æ¿€å¢äº†30%ã€‚â€œé™¤äº†è¿™äº›å¥½å¤„ï¼Œä»¥å°åº¦å¢æ¯”ç»“ç®—ã€å¤šäº‘çµæ´»æ€§ä»¥åŠDDoSé˜²æŠ¤ç­‰å®‰å…¨åŠŸèƒ½ï¼Œéƒ½å¸®åŠ©æˆ‘ä»¬çš„å®¢æˆ·å®ç°äº†æ›´è‡ªä¿¡ã€æ›´å…·æˆæœ¬æ•ˆç›Šçš„æ‰©å±•ï¼Œâ€Chughç»§ç»­è¯´é“ã€‚</p>
<p><strong><strong>å±•æœ›æœªæ¥ï¼šæ‰“é€ æ›´æ™ºèƒ½çš„æ•°å­—åŒ–ä½“éªŒ</strong></strong></p>
<p>CloudMinisterçš„ç›®æ ‡æ˜¯ä¸Akamaiå…±åŒæˆé•¿ï¼Œåˆ©ç”¨å…¶äº‘å¹³å°ã€è¾¹ç¼˜è®¡ç®—ã€å®‰å…¨è§£å†³æ–¹æ¡ˆå’ŒAI/MLå·¥å…·ï¼Œä¸ºå®¢æˆ·æä¾›æ›´å¿«ã€æ›´å®‰å…¨ã€æ›´æ™ºèƒ½çš„æ•°å­—åŒ–ä½“éªŒã€‚</p>
<p>â€œæˆ‘ä»¬å°†Akamaiè§†ä¸ºåˆ›æ–°é“è·¯ä¸Šçš„é•¿æœŸä¼™ä¼´ï¼Œå¸®åŠ©æˆ‘ä»¬æ‰©å±•æœåŠ¡å¹¶è§¦åŠæ–°å¸‚åœºã€‚è¿™æ˜¯å…³äºåˆ›é€ ä¸€ä¸ªæŠ€æœ¯èµ‹èƒ½äººç±»çš„æœªæ¥ï¼Œè€ŒAkamaiåœ¨è¿™ä¸€æ—…ç¨‹ä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œâ€Jaggaè§£é‡Šé“ã€‚</p>
<p>å¯¹äºå…¶ä»–å¥³æ€§åˆ›ä¸šè€…ï¼Œå¥¹ç»™å‡ºäº†è¿™æ ·çš„å»ºè®®ï¼šâ€œä¸è¦ç­‰å¾…è®¸å¯ã€‚å¤§èƒ†æ¢¦æƒ³ï¼Œç›¸ä¿¡ç›´è§‰ï¼Œæ‰“ç ´å£å’ã€‚â€è€Œå¯¹äºæ­£åœ¨è€ƒè™‘Akamaiçš„ä¼ä¸šï¼ŒJaggaæ€»ç»“é“ï¼šâ€œè¿™ä¸ä»…ä»…æ˜¯äº‘æœåŠ¡ï¼Œæ›´æ˜¯ä¸€æ®µå…³ç³»â€”â€”ä¸€æ®µåœ¨æ€§èƒ½ã€æ”¯æŒå’Œæˆé•¿æ–¹é¢éƒ½èƒ½å¸¦æ¥å›æŠ¥çš„å…³ç³»ã€‚â€</p>
<p><strong><strong>å…³äºCloudMinister Technologies</strong></strong></p>
<p>CloudMinister Technologies Pvt. Ltd. æ˜¯ä¸€å®¶å°åº¦ITæœåŠ¡å’Œå’¨è¯¢å…¬å¸ï¼Œæˆç«‹äº2017å¹´ï¼Œæ€»éƒ¨ä½äºæ‹‰è´¾æ–¯å¦é‚¦æ–‹æµ¦å°”ã€‚ä½œä¸ºä¸€å®¶ä¸“æ³¨äºç½‘ç»œæ‰˜ç®¡å’ŒæœåŠ¡å™¨ç®¡ç†æœåŠ¡çš„é¢†å…ˆå°åº¦ITæœåŠ¡å’Œå’¨è¯¢å…¬å¸ï¼ŒCloudMinisteræ‹¥æœ‰ä¸€æ”¯é«˜æŠ€èƒ½çš„ä¸“ä¸šå›¢é˜Ÿï¼Œä¸ºAkamaiã€AWSã€Microsoft Azureå’ŒGoogle Cloudç­‰å¹³å°æä¾›åŒ…æ‹¬VPSæ‰˜ç®¡ã€ä¸“ç”¨æœåŠ¡å™¨ã€äº‘æ‰˜ç®¡å’ŒæœåŠ¡å™¨ç®¡ç†åœ¨å†…çš„é›†æˆè§£å†³æ–¹æ¡ˆå¥—ä»¶ã€‚</p>
<p><strong><strong>å…³äºAkamai</strong></strong></p>
<p>Akamaiæ˜¯ä¸ºä¼ä¸šåœ¨çº¿ä¸šåŠ¡æä¾›åŠ¨åŠ›å’Œä¿æŠ¤çš„ç½‘ç»œå®‰å…¨å’Œäº‘è®¡ç®—å…¬å¸ã€‚æˆ‘ä»¬å¸‚åœºé¢†å…ˆçš„å®‰å…¨è§£å†³æ–¹æ¡ˆã€å“è¶Šçš„å¨èƒæƒ…æŠ¥å’Œå…¨çƒè¿è¥å›¢é˜Ÿæä¾›æ·±åº¦é˜²å¾¡ï¼Œéšæ—¶éšåœ°ä¿æŠ¤ä¼ä¸šæ•°æ®å’Œåº”ç”¨ç¨‹åºã€‚Akamaiçš„å…¨æ ˆäº‘è®¡ç®—è§£å†³æ–¹æ¡ˆåœ¨å…¨çƒæœ€åˆ†æ•£çš„å¹³å°ä¸Šæä¾›å“è¶Šæ€§èƒ½å’Œå¯è´Ÿæ‹…æ€§ã€‚å…¨çƒä¼ä¸šä¿¡ä»»Akamaiæä¾›è¡Œä¸šé¢†å…ˆçš„å¯é æ€§ã€è§„æ¨¡å’Œä¸“ä¸šçŸ¥è¯†ï¼Œä»è€Œå……æ»¡ä¿¡å¿ƒåœ°å‘å±•ä¸šåŠ¡ã€‚æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_251219_external2_blogarticles237" target="_blank" title="https://www.akamai.com/zh?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_251219_external2_blogarticles237" ref="nofollow noopener noreferrer">akamai.com</a>Â å’ŒÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fblog%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_251219_external3_blogarticles237" target="_blank" title="https://www.akamai.com/zh/blog?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_251219_external3_blogarticles237" ref="nofollow noopener noreferrer">akamai.com/blog</a>ï¼Œæˆ–åœ¨Xå’ŒLinkedInä¸Šå…³æ³¨AkamaiÂ Technologiesã€‚</p>
<hr/>
<p>å¦‚æ‚¨æ‰€åœ¨çš„ä¼ä¸šä¹Ÿåœ¨è€ƒè™‘é‡‡è´­äº‘æœåŠ¡æˆ–è¿›è¡Œäº‘è¿ç§»ï¼Œ</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251219_blogarticles237_end" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251219_blogarticles237_end" ref="nofollow noopener noreferrer">ç‚¹å‡»é“¾æ¥</a>äº†è§£Akamai Linodeè§£å†³æ–¹æ¡ˆï¼Œç°åœ¨ç”³è¯·è¯•ç”¨å¯å¾—é«˜è¾¾5000ç¾å…ƒä¸“å±é¢åº¦</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI ç”©å‡ºç‹ç‚¸ï¼šGPT-5.2-Codex ä¸Šçº¿ï¼Œè¿™æ¬¡å®ƒæƒ³åšä½ çš„â€œèµ›åšåˆä¼™äººâ€]]></title>    <link>https://juejin.cn/post/7585377128490532916</link>    <guid>https://juejin.cn/post/7585377128490532916</guid>    <pubDate>2025-12-19T16:19:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585377128490532916" data-draft-id="7585385309891526656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI ç”©å‡ºç‹ç‚¸ï¼šGPT-5.2-Codex ä¸Šçº¿ï¼Œè¿™æ¬¡å®ƒæƒ³åšä½ çš„â€œèµ›åšåˆä¼™äººâ€"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-19T16:19:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI ç”©å‡ºç‹ç‚¸ï¼šGPT-5.2-Codex ä¸Šçº¿ï¼Œè¿™æ¬¡å®ƒæƒ³åšä½ çš„â€œèµ›åšåˆä¼™äººâ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T16:19:15.000Z" title="Fri Dec 19 2025 16:19:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è€å®è¯´ï¼Œåœ¨ AI æ¨¡å‹åƒä¸‹é¥ºå­ä¸€æ ·å‘å¸ƒçš„ 2025 å¹´å¹´åº•ï¼Œå¤§å®¶å¯¹â€œé¢ è¦†æ€§å‡çº§â€è¿™ä¸ªè¯æ—©å°±è„±æ•äº†ã€‚ä½† OpenAI åˆšåˆšåœ¨ 12 æœˆ 18 æ—¥æ‚„æ‚„æ”¾å‡ºçš„ GPT-5.2-Codexï¼Œè¿˜æ˜¯è®©ä¸å°‘ç†¬å¤œå†™ä»£ç çš„å·¥ç¨‹å¸ˆè™èº¯ä¸€éœ‡ã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯ GPT-5.2 çš„ä¸€ä¸ªå¾®è°ƒç‰ˆæœ¬ï¼Œæ›´åƒæ˜¯ä¸€æ¬¡é’ˆå¯¹ç¨‹åºå‘˜ç—›ç‚¹çš„â€œç²¾å‡†çˆ†ç ´â€ã€‚å¦‚æœè¯´ä»¥å‰çš„ AI æ˜¯å¸®ä½ è¡¥å…¨ä»£ç çš„å®ä¹ ç”Ÿï¼Œé‚£ä¹ˆè¿™æ¬¡ä¸Šçº¿çš„ Codexï¼Œæ›´åƒæ˜¯ä¸€ä¸ªèƒ½æ‰›äº‹å„¿çš„â€œé«˜çº§åˆä¼™äººâ€ã€‚</p>
<p>æˆ‘èŠ±äº†ä¸€ç‚¹æ—¶é—´æ‰’äº†æ‰’è¿™èƒŒåçš„æŠ€æœ¯ç»†èŠ‚å’Œå®æµ‹æ•°æ®ï¼Œæœ‰äº›ä¸œè¥¿ç¡®å®å€¼å¾—èŠèŠã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Feergertg-1024x468.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/eergertg-1024x468.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/355f433ab89041c0b69fbedcb6314329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766765955&amp;x-signature=%2B43n99d%2FOVt16Kd3ZC2FB%2FjRY8Q%3D" alt="eergertg" loading="lazy"/></a></p>
<h3 data-id="heading-0">å‘Šåˆ«â€œé‡‘é±¼è®°å¿†â€ï¼šä¸Šä¸‹æ–‡å‹ç¼©æŠ€æœ¯</h3>
<p>ä»¥å‰ç”¨ AI å†™ä»£ç ï¼Œæœ€å¤§çš„å´©æºƒç¬é—´æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ä½ æŠŠæ•´ä¸ªé¡¹ç›®æ‰”ç»™å®ƒï¼ŒèŠåˆ°ç¬¬åè½®å¯¹è¯æ—¶ï¼Œå®ƒçªç„¶å¿˜è®°äº†å¼€å¤´å®šä¹‰çš„å˜é‡ã€‚</p>
<p>GPT-5.2-Codex æœ€å¤§çš„çœ‹ç‚¹å°±åœ¨äº**â€œä¸Šä¸‹æ–‡å‹ç¼©â€æŠ€æœ¯**ã€‚è¿™å¬èµ·æ¥å¾ˆå­¦æœ¯ï¼Œä½†ç”¨å¤§ç™½è¯è§£é‡Šå°±æ˜¯ï¼šå®ƒå­¦ä¼šäº†åˆ’é‡ç‚¹ã€‚</p>
<p>åœ¨å¤„ç†é‚£äº›æŒç»­æ•°å‘¨ã€ä»£ç é‡å·¨å¤§çš„å¤æ‚ä»»åŠ¡æ—¶ï¼Œå®ƒä¸å†æ˜¯å‚»å‚»åœ°æŠŠæ‰€æœ‰ Token å¡è¿›å†…å­˜ï¼Œè€Œæ˜¯èƒ½åŠ¨æ€å‹ç¼©æ¨ç†è¿‡ç¨‹ï¼Œä¿ç•™æ ¸å¿ƒé€»è¾‘ã€‚å®˜æ–¹æ•°æ®æ˜¾ç¤ºï¼Œè¿™ç§æœºåˆ¶è®© Token çš„ä½¿ç”¨æ•ˆç‡æå‡äº† 30%ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½ è¿›è¡Œå¤§è§„æ¨¡é‡æ„æˆ–è€…è·¨è¯­è¨€è¿ç§»è¿™ç§â€œé•¿è·‘â€ä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šè·‘åˆ°ä¸€åŠå°±æ–­ç‰‡å„¿ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Ferhgrth-1024x683.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/erhgrth-1024x683.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b3be86eeb07468e8d767efeaee43239~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766765955&amp;x-signature=P9NbElypS3RM9w4sxLAojjMCRs0%3D" alt="erhgrth" loading="lazy"/></a></p>
<h3 data-id="heading-1">çœŸå®çš„å·¥ç¨‹èƒ½åŠ›ï¼Œè€Œä¸åªæ˜¯åˆ·é¢˜</h3>
<p>å¾ˆå¤šæ¨¡å‹åœ¨åš LeetCode ç®—æ³•é¢˜æ—¶çŒ›å¦‚è™ï¼Œä¸€åˆ°çœŸå®çš„ä¸šåŠ¡ä»£ç é‡Œå°±æ­‡èœã€‚OpenAI è¿™æ¬¡ä¼¼ä¹å¬åˆ°äº†å¼€å‘è€…çš„åæ§½ï¼Œä¸“é—¨å¼ºåŒ–äº† GPT-5.2-Codex çš„<strong>å·¥ç¨‹å®æˆ˜èƒ½åŠ›</strong>ã€‚</p>
<p>ä¸¤ä¸ªæ•°æ®å¾ˆæœ‰æ„æ€ï¼š</p>
<ol>
<li><strong>SWE-Bench Pro</strong>ï¼ˆè½¯ä»¶å·¥ç¨‹ä»»åŠ¡ï¼‰çš„å®Œæˆç‡å†²åˆ°äº† <strong>56.4%</strong>ã€‚åˆ«è§‰å¾—è¿™ä¸ªæ•°å­—ä½ï¼Œåœ¨å…¨æ˜¯å‘çš„çœŸå®è½¯ä»¶å¼€å‘ç¯å¢ƒä¸­ï¼Œèƒ½è¿‡åŠæ•°ä»»åŠ¡ä¸å‡ºé”™ï¼Œå·²ç»æ˜¯ç›®å‰çš„è¡Œä¸šå¤©èŠ±æ¿ã€‚</li>
<li><strong>Terminal-Bench 2.0</strong>ï¼ˆç»ˆç«¯æ“ä½œï¼‰å‡†ç¡®ç‡è¾¾åˆ°äº† <strong>64%</strong>ã€‚</li>
</ol>
<p>æ›´è´´å¿ƒçš„æ˜¯ï¼Œå®ƒç»ˆäºä¸å†åªæ˜¯ Linux ä¼˜å…ˆäº†ã€‚OpenAI ä¸“é—¨ä¼˜åŒ–äº†å®ƒåœ¨ <strong>åŸç”Ÿ Windows 10/11 ç¯å¢ƒ</strong>ä¸‹çš„è¡¨ç°ã€‚å¯¹äºé‚£äº›åœ¨è¿™ä¸ªç”Ÿæ€é‡Œæ‘¸çˆ¬æ»šæ‰“çš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™ç»å¯¹æ˜¯ä¸ªè¿Ÿæ¥çš„å¥½æ¶ˆæ¯ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Ffsdfsdg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/fsdfsdg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3962bef769b047538897b321eab0ce8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766765955&amp;x-signature=EJYuxjqFNKMdBm8sWkHn4dPbYEs%3D" alt="fsdfsdg" loading="lazy"/></a></p>
<h3 data-id="heading-2">çœ‹åˆ°â€œè‰å›¾â€å°±èƒ½å†™ä»£ç </h3>
<p>è™½ç„¶æˆ‘ä»¬å¼ºè°ƒå®ƒæ˜¯ä¸ªåç«¯å¼ºæ‰‹ï¼Œä½†è¿™æ¬¡çš„è§†è§‰ç†è§£èƒ½åŠ›ä¹Ÿè®©äººå°è±¡æ·±åˆ»ã€‚</p>
<p>ä½ ç°åœ¨å¯ä»¥æŠŠä¸€å¼ ç”»åœ¨é¤å·¾çº¸ä¸Šçš„ UI è‰å›¾ï¼Œæˆ–è€…ä¸€å¼ å¤æ‚çš„æŠ€æœ¯æ¶æ„å›¾æ‰”ç»™å®ƒï¼Œå®ƒèƒ½ç›´æ¥ç†è§£å¹¶è½¬åŒ–ä¸ºåŸå‹çš„ä»£ç ã€‚è¿™å¯¹äºäº§å“ç»ç†æˆ–è€…å…¨æ ˆå¼€å‘è€…æ¥è¯´ï¼Œä»â€œæƒ³æ³•â€åˆ°â€œDemoâ€çš„æ—¶é—´è¢«æåº¦å‹ç¼©äº†ã€‚</p>
<h3 data-id="heading-3">ä¸€æŠŠåŒåˆƒå‰‘ï¼šå¼ºæ‚çš„å®‰å…¨æ”»é˜²èƒ½åŠ›</h3>
<p>è¿™é‡Œå¿…é¡»å¾—æä¸ªé†’ã€‚GPT-5.2-Codex çš„ä»£ç å®¡è®¡èƒ½åŠ›å¼ºå¾—æœ‰ç‚¹è®©äººå®³æ€•ã€‚</p>
<p>æœ‰ä¸€ä¸ªå…·ä½“çš„æ¡ˆä¾‹ï¼šå®‰å…¨ç ”ç©¶å‘˜ç”¨å®ƒçš„å‰ä»£æ¨¡å‹ï¼Œåœ¨ä¸€å‘¨å†…å°±æŒ–å‡ºäº† React æ¡†æ¶é‡Œçš„ä¸‰ä¸ªå®‰å…¨æ¼æ´ã€‚åˆ°äº†è¿™ä¸€ä»£ï¼Œå®ƒçš„é˜²å¾¡æ€§ç¼–ç¨‹å’Œæ¼æ´æŒ–æ˜èƒ½åŠ›æ›´ä¸Šäº†ä¸€å±‚æ¥¼ã€‚</p>
<p>æ­£å› ä¸ºè¿™æŠŠâ€œåˆ€â€å¤ªå¿«ï¼ŒOpenAI ç›®å‰é‡‡å–äº†éå¸¸è°¨æ…çš„å‘å¸ƒç­–ç•¥ã€‚è™½ç„¶ä»˜è´¹çš„ ChatGPT ç”¨æˆ·å·²ç»åœ¨ Codex ç•Œé¢é‡Œç”¨ä¸Šäº†ï¼Œä½† API æ¥å£è¿˜å¾—ç­‰å‡ å‘¨æ‰ä¼šé€æ­¥å¼€æ”¾ã€‚ç‰¹åˆ«æ˜¯é’ˆå¯¹é«˜é˜¶çš„ç½‘ç»œå®‰å…¨åŠŸèƒ½ï¼ŒOpenAI æäº†ä¸ªâ€œå¯ä¿¡è®¿é—®è¯•ç‚¹è®¡åˆ’â€ï¼Œç”Ÿæ€•è¢«åäººæ‹¿å»æç ´åã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fhryjytj-1024x809.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/hryjytj-1024x809.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc68bf1514f24b909f3fcd69852c463b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766765955&amp;x-signature=4hPO1f%2FsW50MKfDhmCeuh%2FsfNCw%3D" alt="hryjytj" loading="lazy"/></a></p>
<h3 data-id="heading-4">å†™åœ¨æœ€å</h3>
<p>ç°åœ¨çš„ GPT-5.2-Codex å®Œç¾å—ï¼Ÿè‚¯å®šä¸ã€‚å®ƒä¾ç„¶æ˜‚è´µï¼Œä¾ç„¶éœ€è¦äººå·¥ Code Reviewï¼Œä¾ç„¶å¯èƒ½åœ¨ä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ã€‚</p>
<p>ä½†å®ƒçš„å‡ºç°æ ‡å¿—ç€ä¸€ä¸ªè½¬å˜ï¼šAI æ­£åœ¨ä»ä¸€ä¸ªâ€œè¢«åŠ¨å“åº”â€çš„å·¥å…·ï¼Œå˜æˆä¸€ä¸ªèƒ½å¤Ÿâ€œä¸»åŠ¨æ‰§è¡Œâ€é•¿é“¾è·¯ä»»åŠ¡çš„æ™ºèƒ½ä½“ã€‚</p>
<p>å¯¹äºæˆ‘ä»¬è¿™äº›å¼€å‘è€…æ¥è¯´ï¼Œå¥½æ¶ˆæ¯æ˜¯å¦‚æœä½ æœ‰â€œæ‹–å»¶ç—‡â€ï¼Œä¸çŸ¥é“å¤æ‚é¡¹ç›®ä»ä½•ä¸‹æ‰‹ï¼ŒæŠŠå®ƒå½“æˆæ€ç»´é™ªç»ƒå’Œèµ·æ­¥å·¥å…·ä¼šéå¸¸é¡ºæ‰‹ï¼›åæ¶ˆæ¯æ˜¯ï¼Œç•™ç»™åªä¼šå†™ CRUD çš„â€œä»£ç æ¬è¿å·¥â€çš„æ—¶é—´ï¼ŒçœŸçš„ä¸å¤šäº†ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fsdgfdgdfh-1024x496.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/sdgfdgdfh-1024x496.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/986c94a5c40b42b08d4c6c3407b09b6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766765955&amp;x-signature=Lgt1JkThVJ6JIUKig0%2BTWDs9Tcc%3D" alt="sdgfdgdfh" loading="lazy"/></a></p>
<p>ç›®å‰è¿™ä¸ªæ¨¡å‹å·²ç»å‘æ‰€æœ‰ Plus ç”¨æˆ·å…¨é‡æ¨é€ã€‚å»ºè®®ä½ å»è¯•ç€ç”¨å®ƒè·‘ä¸€ä¸ªè¿˜æ²¡å¡«å®Œçš„å‘ï¼Œä¹Ÿè®¸ä¼šæœ‰æƒŠå–œã€‚</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·¥ç¨‹åŒ–å¿…å¤‡ï¼SVG é›ªç¢§å›¾çš„æœ€ä½³å®è·µï¼šID å¼•ç”¨ + ç¼“å­˜å‹å¥½ï¼Œæ— éœ€æ‰‹åŠ¨ç®—åæ ‡]]></title>    <link>https://juejin.cn/post/7585382317444218890</link>    <guid>https://juejin.cn/post/7585382317444218890</guid>    <pubDate>2025-12-19T14:57:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585382317444218890" data-draft-id="7585382317444186122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·¥ç¨‹åŒ–å¿…å¤‡ï¼SVG é›ªç¢§å›¾çš„æœ€ä½³å®è·µï¼šID å¼•ç”¨ + ç¼“å­˜å‹å¥½ï¼Œæ— éœ€æ‰‹åŠ¨ç®—åæ ‡"/> <meta itemprop="keywords" content="å‰ç«¯,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-19T14:57:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PineappleCoder"/> <meta itemprop="url" content="https://juejin.cn/user/3323167184272627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·¥ç¨‹åŒ–å¿…å¤‡ï¼SVG é›ªç¢§å›¾çš„æœ€ä½³å®è·µï¼šID å¼•ç”¨ + ç¼“å­˜å‹å¥½ï¼Œæ— éœ€æ‰‹åŠ¨ç®—åæ ‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3323167184272627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PineappleCoder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T14:57:59.000Z" title="Fri Dec 19 2025 14:57:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âœ‚ï¸ å›¾æ ‡â€œåˆä½“â€å¤§æ³•ï¼šSVG é›ªç¢§å›¾å¦‚ä½•ç»ˆç»“ HTTP è¯·æ±‚åœ°ç‹±ï¼Œè®©ä½ çš„å›¾æ ‡ç§’é€ŸåŠ è½½ï¼Ÿ</h2>
<blockquote>
<p><strong>å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¸“æ  - ç¬¬å…«ç¯‡</strong></p>
</blockquote>
<p>åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å›¾ç‰‡åŠ è½½ç­–ç•¥ï¼Œè§£å†³äº†å¤§å›¾çš„æ€§èƒ½é—®é¢˜ã€‚ä½†å¯¹äºç½‘é¡µä¸­é‚£äº›<strong>é›¶æ•£çš„å°å›¾æ ‡</strong>ï¼Œæ¯”å¦‚ç‚¹èµã€åˆ†äº«ã€è®¾ç½®ç­‰ï¼Œå®ƒä»¬è™½ç„¶ä½“ç§¯å°ï¼Œå´æœ‰ä¸€ä¸ªè‡´å‘½çš„æ€§èƒ½ç—›ç‚¹ï¼š<strong>æ¯ä¸ªå›¾æ ‡éƒ½ä¼šå‘èµ·ä¸€ä¸ªç‹¬ç«‹çš„ HTTP è¯·æ±‚ï¼</strong></p>
<p>å½“é¡µé¢æœ‰å‡ åç”šè‡³ä¸Šç™¾ä¸ªå›¾æ ‡æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šå‘èµ·å‡ åæˆ–ä¸Šç™¾ä¸ªè¯·æ±‚ï¼Œè¿™åœ¨ HTTP/1.1 æ—¶ä»£æ˜¯æ€§èƒ½æ€æ‰‹ï¼Œå³ä½¿åœ¨ HTTP/2 ä¸­ï¼Œè¿‡å¤šçš„è¯·æ±‚ä¹Ÿä¼šå¢åŠ  TCP/TLS æ¡æ‰‹çš„å¼€é”€ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€ä¸ªå¤è€è€Œåˆç°ä»£çš„ä¼˜åŒ–æŠ€å·§â€”â€”<strong>é›ªç¢§å›¾ï¼ˆCSS Spritesï¼‰</strong> ï¼Œä»¥åŠå®ƒåœ¨ç°ä»£ <strong>SVG</strong> å›¾æ ‡ä½“ç³»ä¸­çš„æœ€ä½³å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯é›ªç¢§å›¾ï¼ˆCSS Spritesï¼‰ï¼Ÿ</h3>
<p>é›ªç¢§å›¾ï¼Œæœ€æ—©æ˜¯ä¸º PNG è¿™ç±»ä½å›¾å›¾æ ‡çš„ä¼˜åŒ–è€Œç”Ÿï¼Œåœ¨ HTTP/1.1 çš„æ—¶ä»£ï¼Œå®ƒå‡ ä¹æ˜¯å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„<strong>æ ‡é…</strong>ã€‚</p>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šå°†å¤šä¸ªå°å›¾æ ‡åˆå¹¶ä¸ºä¸€å¼ å¤§å›¾ï¼Œé€šè¿‡ CSS çš„ <code>background-position</code> å±æ€§æ¥æ˜¾ç¤ºæŒ‡å®šåŒºåŸŸã€‚</li>
<li><strong>ç›®çš„</strong>ï¼šå°†å¤šæ¬¡ HTTP è¯·æ±‚åˆå¹¶ä¸º<strong>ä¸€æ¬¡</strong>ï¼Œå¤§å¹…å‡å°‘ç½‘ç»œå¼€é”€ï¼Œæé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ã€‚</li>
</ul>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆè¦ç”¨é›ªç¢§å›¾ä¼˜åŒ– SVG å›¾æ ‡ï¼Ÿ</h3>
<p>è™½ç„¶ SVGï¼ˆScalable Vector Graphicsï¼‰æœ¬èº«æ˜¯ XML æ–‡æœ¬ï¼Œå…·æœ‰å¯ç¼©æ”¾ã€æ¸…æ™°åº¦é«˜ã€å¯è¢« CSS æ ·å¼æ§åˆ¶ç­‰ä¼˜ç‚¹ï¼Œä½†å®ƒä¾ç„¶é¢ä¸´<strong>è¯·æ±‚è¿‡å¤š</strong>çš„æ€§èƒ½æŒ‘æˆ˜ã€‚</p>
<p>SVG é›ªç¢§å›¾çš„ä¼˜åŒ–æ•ˆæœä½“ç°åœ¨ï¼š</p>
<ol>
<li><strong>å‡å°‘ HTTP è¯·æ±‚</strong>ï¼šå°†å¤šä¸ªå›¾æ ‡åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå®ç°<strong>ä¸€æ¬¡åŠ è½½ï¼Œå…¨é¢ä¼˜åŒ–</strong>ã€‚</li>
<li><strong>æå‡ç¼“å­˜æ•ˆç‡</strong>ï¼šæµè§ˆå™¨å¯ç¼“å­˜æ•´ä¸ªå›¾æ ‡é›†ï¼ŒåŠ å¿«åç»­é¡µé¢åŠ è½½ã€‚</li>
<li><strong>å‡å°æ–‡ä»¶ä½“ç§¯</strong>ï¼šåˆå¹¶åçš„æ–‡ä»¶æ›´å®¹æ˜“è¢«æœåŠ¡å™¨è¿›è¡Œ Gzip/Brotli å‹ç¼©ï¼Œä¼ è¾“æ›´å¿«ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29bbe76049c34da093dd2d4855ab3144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGluZWFwcGxlQ29kZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766761079&amp;x-signature=1qKmZtk4PoRNVpJQqoRdBvS89o0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">ğŸ› ï¸ SVG é›ªç¢§å›¾çš„ä¸¤ç§å®ç°æ–¹å¼</h3>
<p>ä¸ä¼ ç»Ÿçš„ PNG é›ªç¢§å›¾ä¸åŒï¼ŒSVG é›ªç¢§å›¾æ‹¥æœ‰æ›´çµæ´»ã€æ›´å¼ºå¤§çš„å®ç°æ–¹å¼ã€‚</p>
<h4 data-id="heading-4">1. âœ¨ <code>&lt;symbol&gt;</code> + <code>&lt;use&gt;</code> æ–¹å¼ï¼ˆå¼ºçƒˆæ¨èï¼‰</h4>
<p>è¿™æ˜¯ç°ä»£ Web å¼€å‘ä¸­ä¼˜åŒ– SVG å›¾æ ‡çš„<strong>æœ€ä½³å®è·µ</strong>ï¼Œå®ƒå…¼å…·æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œæ ·å¼çµæ´»æ€§ã€‚</p>
<p><strong>æ ¸å¿ƒåŸç†ï¼š</strong></p>
<ol>
<li>å°†æ‰€æœ‰å›¾æ ‡å®šä¹‰åœ¨ä¸€ä¸ªéšè—çš„ <code>&lt;svg&gt;</code> å®¹å™¨ä¸­ï¼Œæ¯ä¸ªå›¾æ ‡ç”¨ <code>&lt;symbol&gt;</code> æ ‡ç­¾åŒ…è£¹ï¼Œå¹¶èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„ <code>id</code>ã€‚</li>
<li>åœ¨é¡µé¢éœ€è¦ä½¿ç”¨å›¾æ ‡çš„åœ°æ–¹ï¼Œé€šè¿‡ <code>&lt;use&gt;</code> æ ‡ç­¾å¼•ç”¨ <code>&lt;symbol&gt;</code> çš„ <code>id</code>ã€‚</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 1. é›ªç¢§å›¾æ–‡ä»¶ï¼ˆé€šå¸¸æ”¾åœ¨é¡µé¢é¡¶éƒ¨æˆ–å¤–éƒ¨å¼•å…¥ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display:none"</span>&gt;</span>
 Â <span class="hljs-comment">&lt;!-- è¿™ä¸ªsvgå®¹å™¨æœ¬èº«ä¸ä¼šåœ¨é¡µé¢ä¸Šè¢«æ¸²æŸ“å‡ºæ¥ï¼Œä½œç”¨ï¼šä½œä¸ºå›¾æ ‡æ¨¡æ¿çš„å®šä¹‰åº“ --&gt;</span>
 Â <span class="hljs-tag">&lt;<span class="hljs-name">symbol</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"icon-heart"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>&gt;</span>
 Â  Â <span class="hljs-comment">&lt;!-- path data for heart --&gt;</span>
 Â <span class="hljs-tag">&lt;/<span class="hljs-name">symbol</span>&gt;</span>
 Â <span class="hljs-tag">&lt;<span class="hljs-name">symbol</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"icon-star"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>&gt;</span>
 Â  Â <span class="hljs-comment">&lt;!-- path data for star --&gt;</span>
 Â <span class="hljs-tag">&lt;/<span class="hljs-name">symbol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
â€‹
<span class="hljs-comment">&lt;!-- 2. é¡µé¢ä¸­ä½¿ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon icon-red"</span>&gt;</span>
 Â <span class="hljs-comment">&lt;!-- é€šè¿‡ xlink:href å¼•ç”¨é›ªç¢§å›¾ä¸­çš„å›¾æ ‡ ID --&gt;</span>
 Â <span class="hljs-tag">&lt;<span class="hljs-name">use</span> <span class="hljs-attr">xlink:href</span>=<span class="hljs-string">"#icon-heart"</span> /&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¯æ ·å¼åŒ–</strong>ï¼šå¯ä½¿ç”¨ CSS è½»æ¾è°ƒæ•´å›¾æ ‡çš„ <code>fill</code>ï¼ˆé¢œè‰²ï¼‰å’Œ <code>stroke</code>ï¼ˆæè¾¹ï¼‰ï¼Œå®ç°ä¸»é¢˜åˆ‡æ¢ã€‚</li>
<li><strong>å¯è®¿é—®æ€§</strong>ï¼šæ”¯æŒ <code>&lt;title&gt;</code>ã€<code>&lt;desc&gt;</code> æ ‡ç­¾ï¼Œæå‡å¯è®¿é—®æ€§ã€‚</li>
<li><strong>ç¼“å­˜å‹å¥½</strong>ï¼šå¯å†…è”æˆ–å¤–éƒ¨å¼•å…¥ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ã€‚</li>
<li><strong>ç»´æŠ¤æ€§é«˜</strong>ï¼šæ— éœ€æ‰‹åŠ¨è®¡ç®—åæ ‡ï¼Œåªéœ€å¼•ç”¨ IDã€‚</li>
</ul>
<h4 data-id="heading-5">2. ğŸ”§ CSS èƒŒæ™¯å›¾æ–¹å¼ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰</h4>
<p>è¿™ç§æ–¹å¼ä¸ä¼ ç»Ÿçš„ PNG é›ªç¢§å›¾ç±»ä¼¼ï¼Œå°† SVG æ–‡ä»¶ä½œä¸ºèƒŒæ™¯å›¾ï¼Œé€šè¿‡ <code>background-position</code> æ¥æ§åˆ¶æ˜¾ç¤ºåŒºåŸŸã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.icon-heart</span> {
 Â <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'sprite.svg'</span>); <span class="hljs-comment">/* æŒ‡å®šäº† svg é›ªç¢§å›¾ */</span>
 Â <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; <span class="hljs-comment">/* å°†å›¾ç‰‡ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½® */</span>
 Â <span class="hljs-attribute">width</span>: <span class="hljs-number">24px</span>; <span class="hljs-comment">/* å¿…é¡»è¦åˆ¶å®šå…ƒç´ çš„å®½é«˜ */</span>
 Â <span class="hljs-attribute">height</span>: <span class="hljs-number">24px</span>;
}
</code></pre>
<p><strong>ç‰¹ç‚¹ä¸å±€é™ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°æ–¹å¼ç®€å•ï¼Œå…¼å®¹æ€§å¥½ã€‚</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ ·å¼æ§åˆ¶å—é™</strong>ï¼šæ— æ³•ç”¨ CSS æ”¹å˜å›¾æ ‡é¢œè‰²ï¼Œå¤±å»äº† SVG çš„æœ€å¤§ä¼˜åŠ¿ã€‚</li>
<li><strong>ç»´æŠ¤å›°éš¾</strong>ï¼šéœ€è¦æ‰‹åŠ¨è®¡ç®—æ¯ä¸ªå›¾æ ‡çš„ <code>background-position</code>ï¼Œä¸é€‚åˆåŠ¨æ€å›¾æ ‡æˆ–ä¸»é¢˜åˆ‡æ¢ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">âœ… å°ç»“ï¼šSVG é›ªç¢§å›¾çš„æœ€ä½³å®è·µ</h3>


























<table><thead><tr><th>æ–¹å¼</th><th>æ€§èƒ½</th><th>æ ·å¼æ§åˆ¶</th><th>ç»´æŠ¤éš¾åº¦</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td><strong><code>&lt;symbol&gt;</code> + <code>&lt;use&gt;</code></strong></td><td>æä½³ï¼ˆå•æ¬¡è¯·æ±‚ï¼Œå¯ç¼“å­˜ï¼‰</td><td>æä½³ï¼ˆCSS å¯æ§é¢œè‰²ï¼‰</td><td>ä½ï¼ˆID å¼•ç”¨ï¼‰</td><td>â­â­â­â­â­</td></tr><tr><td><strong>CSS èƒŒæ™¯å›¾</strong></td><td>è‰¯å¥½ï¼ˆå•æ¬¡è¯·æ±‚ï¼Œå¯ç¼“å­˜ï¼‰</td><td>å·®ï¼ˆæ— æ³•æ”¹å˜é¢œè‰²ï¼‰</td><td>é«˜ï¼ˆæ‰‹åŠ¨å®šä½ï¼‰</td><td>â­â­</td></tr></tbody></table>
<p><strong>ç»“è®ºï¼š</strong> SVG é›ªç¢§å›¾æ˜¯ç°ä»£ Web å›¾æ ‡ä¼˜åŒ–çš„æœ€ä½³å®è·µä¹‹ä¸€ï¼Œè€Œ <strong><code>&lt;symbol&gt;</code> + <code>&lt;use&gt;</code> æ–¹å¼</strong>å…¼å…·æ€§èƒ½ä¸å¯ç»´æŠ¤æ€§ï¼Œæ˜¯å›¾æ ‡ä¼˜åŒ–çš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Šï¼š</strong> ç½‘é¡µä¸­çš„æ–‡å­—è™½ç„¶æ˜¯æ–‡æœ¬ï¼Œä½†è‡ªå®šä¹‰å­—ä½“ï¼ˆWeb Fontï¼‰çš„åŠ è½½å´æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ€§èƒ½é»‘æ´ã€‚ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•ä¼˜åŒ–å­—ä½“åŠ è½½ï¼Œé¿å…â€œ<strong>FOITï¼ˆFlash of Invisible Textï¼‰</strong> â€å’Œâ€œ<strong>FOUTï¼ˆFlash of Unstyled Textï¼‰</strong> â€ç­‰é—®é¢˜ï¼Œæ•¬è¯·æœŸå¾…ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šæ–‡ä»¶è¯»å†™æ“ä½œ]]></title>    <link>https://juejin.cn/post/7585410547337019442</link>    <guid>https://juejin.cn/post/7585410547337019442</guid>    <pubDate>2025-12-19T15:03:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585410547337019442" data-draft-id="7585410547337003058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šæ–‡ä»¶è¯»å†™æ“ä½œ"/> <meta itemprop="keywords" content="Node.js,åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-19T15:03:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šæ–‡ä»¶è¯»å†™æ“ä½œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T15:03:02.000Z" title="Fri Dec 19 2025 15:03:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨åç«¯å¼€å‘ä¸­ï¼Œæ–‡ä»¶è¯»å†™æ˜¯éå¸¸å¸¸è§çš„éœ€æ±‚ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€é…ç½®æ–‡ä»¶ç®¡ç†ã€ä¸Šä¼ æ–‡ä»¶å¤„ç†ä»¥åŠæ•°æ®å¯¼å…¥å¯¼å‡ºç­‰ã€‚Node.js æä¾›äº†å†…ç½®çš„ <code>fs</code>ï¼ˆFile Systemï¼‰æ¨¡å—ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é«˜æ•ˆåœ°ä¸æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚ç†è§£å¹¶æŒæ¡ Node.js çš„æ–‡ä»¶è¯»å†™æ–¹å¼ï¼Œæ˜¯æ¯ä¸€ä¸ª Node.js å¼€å‘è€…çš„å¿…å¤‡åŸºç¡€ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€fs æ¨¡å—ç®€ä»‹</h2>
<p><code>fs</code> æ¨¡å—æ˜¯ Node.js çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œæ— éœ€é¢å¤–å®‰è£…å³å¯ç›´æ¥ä½¿ç”¨ã€‚å®ƒæä¾›äº†åŒæ­¥å’Œå¼‚æ­¥ä¸¤å¥— APIï¼Œç”¨äºå®Œæˆæ–‡ä»¶çš„åˆ›å»ºã€è¯»å–ã€å†™å…¥ã€åˆ é™¤ä»¥åŠç›®å½•æ“ä½œç­‰åŠŸèƒ½ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼ŒNode.js æ›´æ¨èä½¿ç”¨<strong>å¼‚æ­¥æ–‡ä»¶æ“ä½œ</strong>ï¼Œå› ä¸ºåŒæ­¥æ–¹æ³•ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œå½±å“æœåŠ¡å™¨çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚åŒæ­¥æ–¹æ³•ä¸€èˆ¬åªé€‚ç”¨äºè„šæœ¬å·¥å…·æˆ–å¯åŠ¨é˜¶æ®µçš„ç®€å•é€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ–‡ä»¶è¯»å–æ“ä½œ</h2>
<h3 data-id="heading-2">1. å¼‚æ­¥è¯»å–æ–‡ä»¶</h3>
<p>å¼‚æ­¥è¯»å–æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡å›è°ƒå‡½æ•°åœ¨æ–‡ä»¶è¯»å–å®Œæˆåå¤„ç†ç»“æœã€‚è¯¥æ–¹å¼ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'example.txt'</span>, <span class="hljs-string">'utf-8'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯»å–å¤±è´¥:'</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶å†…å®¹:'</span>, data);
});
</code></pre>
<p>è¿™ç§æ–¹å¼é€‚åˆè¯»å–ä½“ç§¯è¾ƒå°çš„æ–‡ä»¶ï¼Œå¦‚é…ç½®æ–‡ä»¶æˆ–æ–‡æœ¬å†…å®¹ã€‚</p>
<hr/>
<h3 data-id="heading-3">2. åŒæ­¥è¯»å–æ–‡ä»¶</h3>
<p>åŒæ­¥è¯»å–ä¼šé˜»å¡ç¨‹åºæ‰§è¡Œï¼Œç›´åˆ°æ–‡ä»¶è¯»å–å®Œæˆï¼Œå› æ­¤åœ¨ Web æœåŠ¡ä¸­åº”å°½é‡é¿å…ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'example.txt'</span>, <span class="hljs-string">'utf-8'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
}
</code></pre>
<p>åŒæ­¥è¯»å–é€šå¸¸ç”¨äºå‘½ä»¤è¡Œå·¥å…·æˆ–ç¨‹åºåˆå§‹åŒ–é˜¶æ®µã€‚</p>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€æ–‡ä»¶å†™å…¥æ“ä½œ</h2>
<h3 data-id="heading-5">1. å¼‚æ­¥å†™å…¥æ–‡ä»¶</h3>
<p>å¼‚æ­¥å†™å…¥æ–‡ä»¶ä¼šåœ¨æ–‡ä»¶ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å­˜åœ¨æ—¶è¦†ç›–åŸæœ‰å†…å®¹ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

fs.<span class="hljs-title function_">writeFile</span>(<span class="hljs-string">'output.txt'</span>, <span class="hljs-string">'Hello Node.js'</span>, <span class="hljs-string">'utf-8'</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å†™å…¥å¤±è´¥:'</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å†™å…¥æˆåŠŸ'</span>);
});
</code></pre>
<p>è¿™ç§æ–¹å¼é€‚åˆç”Ÿæˆæ—¥å¿—ã€å¯¼å‡ºæ•°æ®ç­‰åœºæ™¯ã€‚</p>
<hr/>
<h3 data-id="heading-6">2. è¿½åŠ å†™å…¥æ–‡ä»¶</h3>
<p>å¦‚æœå¸Œæœ›åœ¨åŸæœ‰å†…å®¹åè¿½åŠ æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ <code>appendFile</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-js" lang="js">fs.<span class="hljs-title function_">appendFile</span>(<span class="hljs-string">'log.txt'</span>, <span class="hljs-string">'æ–°çš„ä¸€æ¡æ—¥å¿—\n'</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
});
</code></pre>
<p>è¿™æ˜¯æ—¥å¿—ç³»ç»Ÿä¸­éå¸¸å¸¸è§çš„ç”¨æ³•ã€‚</p>
<hr/>
<h2 data-id="heading-7">å››ã€ä½¿ç”¨ Promise ä¸ async/await æ“ä½œæ–‡ä»¶</h2>
<p>ä» Node.js v10 å¼€å§‹ï¼Œ<code>fs</code> æ¨¡å—æä¾›äº† <code>fs.promises</code> APIï¼Œä½¿æ–‡ä»¶æ“ä½œæ›´åŠ ç°ä»£åŒ–ï¼Œä¹Ÿæ›´æ˜“äºé”™è¯¯å¤„ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs/promises'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readFileAsync</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'example.txt'</span>, <span class="hljs-string">'utf-8'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  }
}

<span class="hljs-title function_">readFileAsync</span>();
</code></pre>
<p>è¿™ç§æ–¹å¼ä»£ç ç»“æ„æ¸…æ™°ï¼Œå°¤å…¶é€‚åˆå¤æ‚ä¸šåŠ¡é€»è¾‘ã€‚</p>
<hr/>
<h2 data-id="heading-8">äº”ã€å¤§æ–‡ä»¶è¯»å†™ä¸ Stream</h2>
<p>å½“æ–‡ä»¶ä½“ç§¯è¾ƒå¤§æ—¶ï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¼šé€ æˆå†…å­˜å‹åŠ›ã€‚è¿™æ—¶åº”ä½¿ç”¨**æµï¼ˆStreamï¼‰**è¿›è¡Œåˆ†æ®µè¯»å†™ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> readStream = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">'bigfile.txt'</span>);
<span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">'copy.txt'</span>);

readStream.<span class="hljs-title function_">pipe</span>(writeStream);
</code></pre>
<p>æµçš„æ–¹å¼å¯ä»¥æ˜¾è‘—é™ä½å†…å­˜å ç”¨ï¼Œéå¸¸é€‚åˆå¤„ç†è§†é¢‘ã€æ—¥å¿—æˆ–å¤§è§„æ¨¡æ•°æ®æ–‡ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-9">å…­ã€æ–‡ä»¶æ“ä½œä¸­çš„å¸¸è§æ³¨æ„ç‚¹</h2>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>æ–‡ä»¶è·¯å¾„å»ºè®®ä½¿ç”¨ <code>path</code> æ¨¡å—æ‹¼æ¥ï¼Œé¿å…è·¨å¹³å°é—®é¢˜</li>
<li>æ–‡ä»¶æ“ä½œéœ€è¦åšå¥½é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒ</li>
<li>é¿å…åœ¨é«˜å¹¶å‘æœåŠ¡ä¸­ä½¿ç”¨åŒæ­¥æ–‡ä»¶ API</li>
<li>å¤§æ–‡ä»¶ä¼˜å…ˆä½¿ç”¨ Stream æ–¹å¼å¤„ç†</li>
</ul>
<p>è¿™äº›ç»†èŠ‚å¾€å¾€å†³å®šäº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½è¡¨ç°ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä¸ƒã€æ€»ç»“</h2>
<p>Node.js çš„æ–‡ä»¶è¯»å†™æ“ä½œåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»ï¼Œä»ç®€å•çš„æ–‡æœ¬è¯»å†™åˆ°å¤æ‚çš„å¤§æ–‡ä»¶æµå¤„ç†ï¼Œéƒ½æœ‰æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚åˆç†é€‰æ‹©åŒæ­¥ã€å¼‚æ­¥æˆ–æµå¼æ“ä½œæ–¹å¼ï¼Œä¸ä»…å¯ä»¥æå‡ç¨‹åºæ€§èƒ½ï¼Œè¿˜èƒ½è®©ä»£ç æ›´åŠ å¥å£®ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œç»“åˆä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–‡ä»¶æ“ä½œç­–ç•¥ï¼Œæ˜¯æå‡ Node.js å¼€å‘èƒ½åŠ›çš„é‡è¦ä¸€æ­¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Œchrome extensionsğŸ› ï¸ã€æˆ‘å†™äº†ä¸€ä¸ªè¶…çº§ç®€å•çš„æµè§ˆå™¨æ’ä»¶Vueå¼€å‘æ¨¡æ¿]]></title>    <link>https://juejin.cn/post/7585406229167865906</link>    <guid>https://juejin.cn/post/7585406229167865906</guid>    <pubDate>2025-12-19T13:28:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406229167865906" data-draft-id="7581314241410613283" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Œchrome extensionsğŸ› ï¸ã€æˆ‘å†™äº†ä¸€ä¸ªè¶…çº§ç®€å•çš„æµè§ˆå™¨æ’ä»¶Vueå¼€å‘æ¨¡æ¿"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,GitHub"/> <meta itemprop="datePublished" content="2025-12-19T13:28:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JustHappy"/> <meta itemprop="url" content="https://juejin.cn/user/1489178757445003"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Œchrome extensionsğŸ› ï¸ã€æˆ‘å†™äº†ä¸€ä¸ªè¶…çº§ç®€å•çš„æµè§ˆå™¨æ’ä»¶Vueå¼€å‘æ¨¡æ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1489178757445003/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JustHappy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:28:48.000Z" title="Fri Dec 19 2025 13:28:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><blockquote>
<p>Hi!è¿™é‡Œæ˜¯JustHappyğŸš€ğŸš€ï¼Œä¸€æ—¶å…´èµ·æƒ³å¼€å‘ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶ï¼Œä½†æ˜¯æ‰¾æ¥æ‰¾å»å‘ç°åœ¨Vueç”Ÿæ€ä¸‹å¥½åƒæ²¡æœ‰ä¸€ä¸ªè¶…è½»çš„ç®€å•çš„æ¨¡æ¿æˆ–è€…è„šæ‰‹æ¶ï¼Œçœ‹äº†ä¸€åœˆæ„Ÿè§‰antFuå¤§ä½¬çš„vitesse-webextè¿˜ä¸é”™ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜ä¸å¤Ÿè½»ï¼Œäºæ˜¯æˆ‘æ‰“ç®—æ‰‹æ’¸ä»¿å†™ä¸€ä¸ªç®€å•ç‰ˆæœ¬</p>
</blockquote>
<h2 data-id="heading-0">æˆ‘æƒ³è¦ä¸€ä¸ªä»€ä¹ˆæ ·çš„æ¨¡æ¿</h2>
<ul>
<li>æŠ€æœ¯æ ˆè½»ç›ˆï¼šVue + JS è¶Šç®€å•è¶Šå¥½</li>
<li>æ”¯æŒâ€œçƒ­æ›´æ–°â€ï¼šä¿®æ”¹åç«‹é©¬æ›´æ–°è§†å›¾</li>
</ul>
<h2 data-id="heading-1">äºæ˜¯æœ‰äº†è¿™ä¸ªæ¨¡æ¿...</h2>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a7a6459e0984f779075c7f414090ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVzdEhhcHB5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766755750&amp;x-signature=gTpC5udEJhV8rJhW%2Fq0721XZiUM%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p>ä»“åº“åœ°å€æ˜¯è¿™ä¸ªï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSimonmie%2Fvue-chrome-extension-template" target="_blank" title="https://github.com/Simonmie/vue-chrome-extension-template" ref="nofollow noopener noreferrer">github.com/Simonmie/vuâ€¦</a></p>
<h2 data-id="heading-2">å¦‚ä½•ä½¿ç”¨ï¼Ÿå¾ˆç®€å•</h2>
<p>ä½ åªéœ€è¦åœ¨ä»“åº“ä¸­ç‚¹å‡» use this template å°±å¯ä»¥ä½¿ç”¨è¯¥æ¨¡æ¿å»æ„å»ºæ’ä»¶</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91cb295e398341e3985db84969e54073~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVzdEhhcHB5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766755750&amp;x-signature=CXq5lwvpaNqy5zB9X%2FTtVALqaok%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">å¼€å§‹å¼€å‘å§ï¼</h2>
<h3 data-id="heading-4">å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-npm" lang="npm">npm install
</code></pre>
<h3 data-id="heading-5">æ¨¡æ¿ç»“æ„</h3>
<pre><code class="hljs language-bash" lang="bash">â”œâ”€â”€ assets
â”œâ”€â”€ background
â”‚   â”œâ”€â”€ dev-hmr.js  // å¼€å‘ç¯å¢ƒä¸‹çš„çƒ­æ›´æ–°è„šæœ¬
â”‚   â””â”€â”€ main.js  // èƒŒæ™¯è„šæœ¬
â”œâ”€â”€ logic
â”‚   â””â”€â”€ common-setup.js  // å…¬å…±è®¾ç½®è„šæœ¬
â”œâ”€â”€ manifest.js // manifest.json ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ options // é€‰é¡¹é¡µ
â”‚   â”œâ”€â”€ OptionsPage.vue 
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ popup // å¼¹çª—
â”‚   â”œâ”€â”€ PopupComponent.vue
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ sidepanel // ä¾§è¾¹æ 
â”‚   â”œâ”€â”€ SidePanel.vue
â”‚   â”œâ”€â”€ assets
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ main.js
â””â”€â”€ utils
    â”œâ”€â”€ base.js // åŸºç¡€å·¥å…·å‡½æ•°
    â””â”€â”€ config.js // é…ç½®æ–‡ä»¶å‡½æ•°
</code></pre>
<h3 data-id="heading-6">å¦‚ä½•å¼€å‘ï¼Ÿ</h3>
<h4 data-id="heading-7">å¯åŠ¨çƒ­æ›´æ–°</h4>
<pre><code class="hljs language-npm" lang="npm">npm run dev:ext
</code></pre>
<h4 data-id="heading-8">å®‰è£…æ‰©å±•</h4>
<ol>
<li>æ‰“å¼€ Chrome æµè§ˆå™¨ã€‚</li>
<li>ç‚¹å‡»æµè§ˆå™¨èœå•ï¼ˆé€šå¸¸æ˜¯ä¸‰ä¸ªå‚ç›´ç‚¹å›¾æ ‡ï¼‰ï¼Œé€‰æ‹©â€œæ›´å¤šå·¥å…·â€&gt;â€œæ‰©å±•ç¨‹åºâ€ã€‚</li>
<li>åœ¨æ‰©å±•ç¨‹åºé¡µé¢ï¼Œæ‰“å¼€â€œå¼€å‘è€…æ¨¡å¼â€ã€‚</li>
<li>ç‚¹å‡»â€œåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºâ€ï¼Œé€‰æ‹©é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>extension</code> æ–‡ä»¶å¤¹ã€‚</li>
</ol>
<p>ç„¶åä½ å°±å¯ä»¥æ„‰å¿«çš„å¼€å§‹å¼€å‘æµè§ˆå™¨æ’ä»¶äº†ã€‚ä½ å‡ ä¹åªéœ€è¦ä¼šVueå’ŒJSå°±å¯ä»¥å¼€å‘ï¼Œæˆ–è€…ç»“åˆå¤§æ¨¡å‹å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæ’ä»¶</p>
<p>è¿™æ˜¯æˆ‘ç”¨Gemini 3 proç»“åˆè¿™ä¸ªæ¨¡æ¿ç”Ÿæˆçš„å…¶ä¸­ä¸€ä¸ªæ’ä»¶çš„æ•ˆæœï¼ŒåŸºæœ¬ä¸Šå®Œå…¨å¯ç”¨</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b033276a59c34286a663aaf69644407e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVzdEhhcHB5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766755750&amp;x-signature=bXGTj0v4%2FaFqhuZauRjQChtz5VE%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœä½ ä¹Ÿæƒ³å°è¯•ï¼Œè¿™æ˜¯è¿™ä¸ªæ’ä»¶çš„githubä»“åº“åœ°å€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSimonmie%2FText-extraction-tool" target="_blank" title="https://github.com/Simonmie/Text-extraction-tool" ref="nofollow noopener noreferrer">github.com/Simonmie/Teâ€¦</a></p>
<hr/>
<p>ä¸‹é¢æˆ‘ä»¬æ¥èŠèŠè¿™ä¸ªæ¡†æ¶çš„â€œçƒ­æ›´æ–°â€åŸç†å§....</p>
<h2 data-id="heading-9">â€çƒ­æ›´æ–°â€œåŸç†</h2>
<p>æœ‰äººé—®æˆ‘ï¼šâ€œä¸ºä»€ä¹ˆè¿™ä¸ªæ¨¡æ¿èƒ½åšåˆ°ç±»ä¼¼ HMR çš„ä½“éªŒï¼Ÿæµè§ˆå™¨æ’ä»¶ä¸æ˜¯ä¸èƒ½çƒ­æ›´æ–°å—â€</p>
<p>ç­”æ¡ˆå…¶å®å¾ˆç®€å•ï¼š</p>
<blockquote>
<p><strong>ä¸æ˜¯æ¨¡å—çº§çƒ­æ›¿æ¢ï¼Œè€Œæ˜¯è‡ªåŠ¨é‡å»º + è‡ªåŠ¨åˆ·æ–°ã€‚</strong></p>
</blockquote>
<p>å½“ä½ ä¿®æ”¹ä»£ç æ—¶ï¼š</p>
<ul>
<li>æ„å»ºå™¨ä¼šé‡å»ºäº§ç‰©</li>
<li>çƒ­æ›´æ–°æœåŠ¡ä¼šç»™æ‰©å±•å‘é€é€šçŸ¥</li>
<li>å‰å°è§†å›¾åˆ·æ–°ã€åå°è„šæœ¬é‡è½½</li>
<li>æµè§ˆå™¨æ‰©å±•æ•´ä½“æ›´æ–°</li>
</ul>
<p>å®Œå…¨ä¸éœ€è¦æ‰‹åŠ¨åˆ·æ–°çª—å£ï¼Œä¸éœ€è¦é‡æ–°ç‚¹å‡»æ‰©å±•å›¾æ ‡ã€‚</p>
<p>æ›´å…³é”®çš„æ˜¯ï¼šæ•´ä¸ªæœºåˆ¶éå¸¸è½»ï¼Œéå¸¸å¹²å‡€ã€‚</p>
<h3 data-id="heading-10">ä¸€ä¸ªæå°çš„çƒ­æ›´æ–°æœåŠ¡</h3>
<p>æ¨¡æ¿å¯åŠ¨åä¼šåŒæ—¶å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œç”¨äºç›‘å¬æ„å»ºå˜åŒ–å¹¶å‘æ‰©å±•å‘é€æ¶ˆæ¯ã€‚</p>
<p>è¿™ä¸ªæœåŠ¡é€šè¿‡ SSEï¼ˆServer-Sent Eventsï¼‰å·¥ä½œï¼š</p>
<ul>
<li>åœ°å€ç±»ä¼¼ï¼š<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">http://localhost:3000/extension-hmr</a></li>
<li>æ„å»ºå®Œæˆåä¼šæ¨é€ reload ä¿¡å·</li>
<li>æ‰€æœ‰é¡µé¢å’Œåå°è„šæœ¬éƒ½ä¼šç›‘å¬å®ƒ</li>
</ul>
<p>SSE çš„å¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>è½»é‡</li>
<li>æ— éœ€é¢å¤–ä¾èµ–</li>
<li>æ— éœ€è½®è¯¢</li>
<li>ç‰¹åˆ«ç¨³å®š</li>
</ul>
<p>ä½ ç”šè‡³å¯ä»¥æŠŠå®ƒç†è§£ä¸ºï¼šä¸€ä¸ªç‰¹åˆ«ç®€å•çš„â€œæ›´æ–°å¹¿æ’­å™¨â€ã€‚</p>
<h3 data-id="heading-11">å‰å°é¡µé¢å¦‚ä½•åˆ·æ–°ï¼Ÿ</h3>
<p>æ‰©å±•é‡Œçš„ popupã€optionsã€sidepanel é¡µé¢éƒ½ä¼šè‡ªåŠ¨æ³¨å…¥ä¸€ä¸ªç›‘å¬å™¨ï¼š</p>
<ol>
<li>é€šè¿‡ EventSource è¿æ¥ SSE æœåŠ¡</li>
<li>æ”¶åˆ° reload ä¿¡å·</li>
<li><code>window.location.reload()</code></li>
</ol>
<p>æ‰€ä»¥æ”¹å®Œä»£ç ä¿å­˜åï¼š<br/>
â†’ UI ä¼šç«‹å³é‡æ–°åŠ è½½<br/>
â†’ æ–°çš„ä»£ç ä¼šç›´æ¥ç”Ÿæ•ˆ</p>
<p>ä¸ç”¨ç‚¹å‡»ï¼Œä¸ç”¨é‡æ‰“å¼€ popup é¡µé¢ï¼Œè¿ DevTools éƒ½ä¸ç”¨åŠ¨ã€‚</p>
<h3 data-id="heading-12">åå°è„šæœ¬å¦‚ä½•æ›´æ–°ï¼Ÿ</h3>
<p>åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œåå°è„šæœ¬å¹¶ä¸ä¼šç›´æ¥è¿è¡Œæ­£å¼çš„ background é€»è¾‘ï¼Œè€Œæ˜¯å…ˆæ¥å…¥ä¸€ä¸ªå¼€å‘ä¸“ç”¨çš„è„šæœ¬ã€‚</p>
<p>è¿™ä¸ªè„šæœ¬ä¸“é—¨è´Ÿè´£ç›‘å¬ SSEï¼š</p>
<ol>
<li>æ”¶åˆ°æ¶ˆæ¯</li>
<li><code>chrome.runtime.reload()</code></li>
</ol>
<p>è¿™ä¼šè®©æ•´ä¸ªæ‰©å±•ç¬é—´é‡è½½ï¼š</p>
<ul>
<li>UI åˆ·æ–°</li>
<li>è„šæœ¬åˆ·æ–°</li>
<li>çŠ¶æ€é‡ç½®</li>
</ul>
<p>è¿™ç§æ–¹å¼éå¸¸é€‚åˆå¼€å‘åœºæ™¯ï¼Œå› ä¸ºä¸ç”¨æ‹…å¿ƒç¼“å­˜ã€ä¸ä¸€è‡´ã€åå°ä»åœ¨è¿è¡Œç­‰é—®é¢˜ã€‚</p>
<h3 data-id="heading-13">è‡ªåŠ¨é‡è¿æœºåˆ¶</h3>
<p>SSE è¿æ¥å¦‚æœæ–­å¼€ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å°æ–­ç½‘</li>
<li>æµè§ˆå™¨åˆ‡æ¢æ ‡ç­¾</li>
<li>ç³»ç»Ÿä¼‘çœ </li>
<li>æ„å»ºå™¨é‡å¯</li>
</ul>
<p>æ‰©å±•ä¼šè‡ªåŠ¨é‡è¯•è¿æ¥ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼š<br/>
ä½ åªéœ€è¦æ”¹ä»£ç  â†’ ä¿å­˜ â†’ æµè§ˆå™¨è‡ªåŠ¨æ›´æ–°<br/>
ä¸ç”¨å…³å¿ƒåº•å±‚è¿æ¥æ˜¯å¦æ–­è¿‡ã€é‡è¿è¿‡ã€‚</p>
<p>å®ƒå°±æ˜¯ä¸€ç›´èƒ½ç”¨ã€‚</p>
<blockquote>
<p>å¦‚æœè¿™å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå“ˆå“ˆæ±‚ä¸ªstarâœ¨ï¼Œæ¨¡æ¿å¤§æ¦‚ç‡è¿˜æœ‰å¾ˆå¤šä¸è¶³ï¼Œæ¬¢è¿å¤§å®¶æäº¤issueã€prç­‰ï¼Œæˆ–è€…å•çº¯éªšæ‰°æˆ‘ğŸ˜œ</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android LaunchMode]]></title>    <link>https://juejin.cn/post/7585406229167898674</link>    <guid>https://juejin.cn/post/7585406229167898674</guid>    <pubDate>2025-12-19T13:42:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585406229167898674" data-draft-id="7584650857070788617" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android LaunchMode"/> <meta itemprop="keywords" content="Android,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-19T13:42:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— é™è¿›åŒ–"/> <meta itemprop="url" content="https://juejin.cn/user/108212996024855"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android LaunchMode
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/108212996024855/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— é™è¿›åŒ–
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-19T13:42:28.000Z" title="Fri Dec 19 2025 13:42:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ å››å¤§å¯åŠ¨æ¨¡å¼</h2>
<h3 data-id="heading-1">Q1. LaunchMode éƒ½æœ‰å“ªäº›ï¼Ÿ</h3>
<p>standardã€singleTopã€singleTaskã€singleInstanceã€‚</p>
<h3 data-id="heading-2">Q2. standard (æ ‡å‡†æ¨¡å¼) çš„ç‰¹ç‚¹ä¸å‘ç‚¹ï¼Ÿ</h3>
<ul>
<li>
<p><strong>ç‰¹ç‚¹</strong>ï¼šé»˜è®¤æ¨¡å¼ã€‚æ¯æ¬¡å¯åŠ¨éƒ½<strong>åˆ›å»ºæ–°å®ä¾‹</strong>å¹¶å‹å…¥å½“å‰æ ˆé¡¶ã€‚</p>
</li>
<li>
<p><strong>å‘ç‚¹</strong>ï¼š<strong>é Activity Contextï¼ˆå¦‚ Application/Serviceï¼‰å¯åŠ¨æ­¤æ¨¡å¼ä¼šå´©æºƒï¼Œå¿…é¡»æ·»åŠ  FLAG_ACTIVITY_NEW_TASK æ ‡è®°ã€‚</strong></p>
<p>æ³¨ï¼šstandard æ¨¡å¼çš„ Activity é»˜è®¤è¦è¿›å…¥å¯åŠ¨å®ƒçš„é‚£ä¸ªç»„ä»¶æ‰€åœ¨çš„ä»»åŠ¡æ ˆã€‚</p>
</li>
</ul>
<pre><code class="hljs language-txt" lang="txt">æ ˆçŠ¶æ€: [A]
å¯åŠ¨ A (standard) -&gt; [A, A(æ–°)]
</code></pre>
<h3 data-id="heading-3">Q3. singleTop (æ ˆé¡¶å¤ç”¨) çš„ç‰¹ç‚¹ï¼Ÿ</h3>
<ul>
<li><strong>è‹¥å·²åœ¨æ ˆé¡¶</strong>ï¼š<strong>ä¸åˆ›å»º</strong>æ–°å®ä¾‹ï¼Œå›è°ƒ <code>onNewIntent()</code> (onCreate/onStart ä¸è°ƒç”¨)ã€‚</li>
<li><strong>è‹¥ä¸åœ¨æ ˆé¡¶</strong>ï¼šåˆ›å»ºæ–°å®ä¾‹å‹å…¥æ ˆé¡¶ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šé€šçŸ¥æ ç‚¹å‡»è·³è½¬ã€é˜²æ­¢æŒ‰é’®å¿«é€Ÿè¿ç‚¹ã€‚</li>
</ul>
<pre><code class="hljs language-txt" lang="txt">æ ˆçŠ¶æ€: [A, B]
å¯åŠ¨ B (singleTop) -&gt; [A, B] (å¤ç”¨, onNewIntent)
å¯åŠ¨ A (singleTop) -&gt; [A, B, A] (æ–°å»º, å› ä¸ºAä¸åœ¨æ ˆé¡¶)
</code></pre>
<h3 data-id="heading-4">Q4. singleTask (æ ˆå†…å¤ç”¨) çš„ç‰¹ç‚¹ï¼Ÿ</h3>
<ul>
<li><strong>ç‹¬å æ€§</strong>ï¼šåªè¦æ ˆä¸­å­˜åœ¨è¯¥å®ä¾‹ï¼Œå¤šæ¬¡å¯åŠ¨å‡å¤ç”¨å®ƒã€‚</li>
<li><strong>ClearTop</strong>ï¼šå¤ç”¨æ—¶ï¼Œ<strong>è‡ªåŠ¨é”€æ¯</strong>è¯¥å®ä¾‹ä¹‹ä¸Šçš„æ‰€æœ‰ Activityã€‚</li>
<li><strong>æ ˆæŸ¥æ‰¾</strong>ï¼šè‹¥æ‰¾ä¸åˆ°æ‰€éœ€ä»»åŠ¡æ ˆ (TaskAffinity)ï¼Œä¼šåˆ›å»ºæ–°æ ˆã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šApp é¦–é¡µã€WebView å®¹å™¨é¡µã€‚</li>
</ul>
<pre><code class="hljs language-txt" lang="txt">æ ˆçŠ¶æ€: [A, B, C] (Bä¸ºsingleTask)
å¯åŠ¨ B -&gt; [A, B] (Cè¢«é”€æ¯, Bå¤ç”¨å¹¶onNewIntent)
</code></pre>
<h3 data-id="heading-5">Q5. singleInstance (å…¨å±€å•ä¾‹) çš„ç‰¹ç‚¹ï¼Ÿ</h3>
<ul>
<li><strong>åŠ å¼ºç‰ˆ singleTask</strong>ï¼šæ•´ä¸ªç³»ç»Ÿåªæœ‰è¿™ä¸€ä¸ªå®ä¾‹ã€‚</li>
<li><strong>ç‹¬å æ ˆ</strong>ï¼šè¯¥å®ä¾‹<strong>åªèƒ½å•ç‹¬ä½äºä¸€ä¸ªä»»åŠ¡æ ˆä¸­</strong>ï¼Œä¸å…è®¸å…¶ä»– Activity å…¥é©»ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šæ¥ç”µç•Œé¢ã€é—¹é’Ÿå“é“ƒã€‚</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">Task1: <span class="hljs-section">[A, B]</span>
å¯åŠ¨ C (singleInstance)
Task1: <span class="hljs-section">[A, B]</span> (åå°)
Task2: <span class="hljs-section">[C]</span>    (å‰å°, ç‹¬å )
</code></pre>
<h2 data-id="heading-6">äºŒã€ ä»»åŠ¡æ ˆ (Task) äº¤äº’é€»è¾‘</h2>
<h3 data-id="heading-7">Q6. ä»»åŠ¡æ ˆå¦‚ä½•åˆ†ç±»ï¼Ÿ</h3>
<ul>
<li><strong>å‰å°ä»»åŠ¡æ ˆ</strong>ï¼šç”¨æˆ·å½“å‰æ­£åœ¨äº¤äº’çš„æ ˆã€‚</li>
<li><strong>åå°ä»»åŠ¡æ ˆ</strong>ï¼šå¤„äºåå°ï¼Œå…¶ä¸­ Activity å‡å¤„äº Paused/Stopped çŠ¶æ€ã€‚</li>
</ul>
<h3 data-id="heading-8">Q7. å‰å°æ ˆ ABï¼Œåå°æ ˆ CD (å‡ä¸º singleTask)ã€‚å¯åŠ¨ Dï¼Œå†æŒ‰ Backï¼Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<ol>
<li>
<p><strong>å¯åŠ¨ D</strong>ï¼šåå°æ ˆ CD è¢«æ•´ä½“æ‹‰å›å‰å°ï¼Œç½®äº AB ä¹‹ä¸Šã€‚</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[å‰å°æ ˆ Task1]</span> <span class="hljs-selector-tag">A</span> -&gt; <span class="hljs-selector-tag">B</span>
<span class="hljs-selector-attr">[åå°æ ˆ Task2]</span> C -&gt; D
-------- å¯åŠ¨ D --------
<span class="hljs-selector-attr">[åˆå¹¶è§†è§‰]</span> <span class="hljs-selector-tag">A</span> -&gt; <span class="hljs-selector-tag">B</span> -&gt; C -&gt; D (Task2 è¦†ç›–åœ¨ Task1 ä¸Š)
</code></pre>
</li>
<li>
<p><strong>Back é¡ºåº</strong>ï¼š <code>D å‡ºæ ˆ</code> -&gt; <code>æ˜¾ç¤º C</code> -&gt; <code>Back</code> -&gt; <code>C å‡ºæ ˆ</code> -&gt; <code>æ˜¾ç¤º B</code> -&gt; <code>Back</code> -&gt; <code>A</code> -&gt; <code>æ¡Œé¢</code>ã€‚</p>
</li>
</ol>
<h3 data-id="heading-9">Q8. A(standard)ã€B(singleTask)ã€C(singleTask)ã€‚è·¯å¾„: A-&gt;B-&gt;C-&gt;A-&gt;Bã€‚ç‚¹ä¸¤æ¬¡ Back çœ‹åˆ°è°ï¼Ÿ</h3>
<p><strong>ç»“è®ºï¼šå›åˆ°æ¡Œé¢</strong>ã€‚</p>
<p><strong>è¯¦ç»†æ¨æ¼”å›¾è§£</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-number">1</span>. <span class="hljs-selector-tag">A</span><span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">B</span>:
   æ ˆ: <span class="hljs-selector-attr">[A, B]</span>

<span class="hljs-number">2</span>. <span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">C</span>:
   æ ˆ: <span class="hljs-selector-attr">[A, B, C]</span>

<span class="hljs-number">3</span>. <span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">A</span> (standard):
   æ ˆ: <span class="hljs-selector-attr">[A, B, C, A]</span>  &lt;<span class="hljs-selector-tag">--</span> <span class="hljs-selector-tag">A</span>ç›´æ¥å‹å…¥

<span class="hljs-number">4</span>. <span class="hljs-selector-tag">-</span>&gt;<span class="hljs-selector-tag">B</span> (singleTask):
   æ£€æŸ¥æ ˆå†…... å‘ç° <span class="hljs-selector-tag">B</span>!
   è§¦å‘ <span class="hljs-selector-tag">ClearTop</span>: é”€æ¯ <span class="hljs-selector-tag">B</span> ä¹‹ä¸Šçš„ <span class="hljs-selector-tag">C</span> å’Œ <span class="hljs-selector-tag">A</span>
   æ ˆ: <span class="hljs-selector-attr">[A, B]</span>        &lt;<span class="hljs-selector-tag">--</span> <span class="hljs-selector-tag">B</span>å¤ç”¨

<span class="hljs-number">5</span>. <span class="hljs-selector-tag">Back</span> <span class="hljs-number">1</span>æ¬¡:
   <span class="hljs-selector-tag">B</span> å‡ºæ ˆ <span class="hljs-selector-tag">-</span>&gt; æ˜¾ç¤º <span class="hljs-selector-tag">A</span>
   æ ˆ: <span class="hljs-selector-attr">[A]</span>

<span class="hljs-number">6</span>. <span class="hljs-selector-tag">Back</span> <span class="hljs-number">2</span>æ¬¡:
   <span class="hljs-selector-tag">A</span> å‡ºæ ˆ <span class="hljs-selector-tag">-</span>&gt; æ ˆç©º <span class="hljs-selector-tag">-</span>&gt; å›åˆ°æ¡Œé¢
</code></pre>
<h3 data-id="heading-10">Q9. TaskAffinity æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3>
<ul>
<li>æŒ‡å®š Activity æ‰€éœ€ä»»åŠ¡æ ˆçš„åå­—ï¼ˆé»˜è®¤ä¸ºåŒ…åï¼‰ã€‚</li>
<li>éœ€é…åˆ <code>singleTask</code> æˆ– <code>allowTaskReparenting</code> ä½¿ç”¨æ‰ç”Ÿæ•ˆã€‚</li>
<li><strong>åº”ç”¨</strong>ï¼šå°†å°ç¨‹åºæˆ–å·¥å…·é¡µæ”¾å…¥ç‹¬ç«‹è¿›ç¨‹/ä»»åŠ¡æ ˆã€‚</li>
</ul>
<h3 data-id="heading-11">Q10. allowTaskReparenting æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li>
<p><strong>å®šä¹‰</strong>ï¼šå…è®¸ Activity å˜æ›´å½’å±æ ˆã€‚</p>
</li>
<li>
<p><strong>ç°è±¡</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">App</span> <span class="hljs-selector-tag">A</span> (Task A): å¯åŠ¨äº† <span class="hljs-selector-tag">App</span> <span class="hljs-selector-tag">B</span> çš„ <span class="hljs-selector-tag">Activity</span> <span class="hljs-selector-tag">C</span> (allowTaskReparenting=true)
çŠ¶æ€: <span class="hljs-selector-tag">Task</span> <span class="hljs-selector-tag">A</span> <span class="hljs-selector-attr">[..., C]</span>

<span class="hljs-selector-tag">--</span>&gt; ç”¨æˆ·å›æ¡Œé¢ï¼Œç‚¹å›¾æ ‡å¯åŠ¨ <span class="hljs-selector-tag">App</span> <span class="hljs-selector-tag">B</span>
ç°è±¡: <span class="hljs-selector-tag">C</span> ä» <span class="hljs-selector-tag">Task</span> <span class="hljs-selector-tag">A</span> é£åˆ°äº† <span class="hljs-selector-tag">Task</span> <span class="hljs-selector-tag">B</span>
çŠ¶æ€: <span class="hljs-selector-tag">Task</span> <span class="hljs-selector-tag">A</span> <span class="hljs-selector-attr">[...]</span>
      <span class="hljs-selector-tag">Task</span> <span class="hljs-selector-tag">B</span> <span class="hljs-selector-attr">[C]</span> (C æ˜¾ç¤ºåœ¨ B çš„æ ˆé¡¶)
</code></pre>
</li>
</ul>
<h2 data-id="heading-12">ä¸‰ã€ å¯åŠ¨é…ç½®ä¸ Intent</h2>
<h3 data-id="heading-13">Q11. å¦‚ä½•æŒ‡å®šå¯åŠ¨æ¨¡å¼ï¼Ÿä¼˜å…ˆçº§å¦‚ä½•ï¼Ÿ</h3>
<ol>
<li><strong>é™æ€</strong>ï¼šManifest <code>android:launchMode</code>ã€‚</li>
<li><strong>åŠ¨æ€</strong>ï¼šIntent Flags <code>intent.addFlags(...)</code>ã€‚</li>
<li><strong>ä¼˜å…ˆçº§</strong>ï¼š<strong>Intent Flags &gt; Manifest</strong>ã€‚</li>
</ol>
<h3 data-id="heading-14">Q12. å¸¸ç”¨çš„ Intent Flags è§£æï¼Ÿ</h3>
<ul>
<li>
<p><code>FLAG_ACTIVITY_NEW_TASK</code>: æ•ˆæœè¿‘ä¼¼ singleTaskï¼ˆé Activity å¯åŠ¨å¿…åŠ ï¼‰ã€‚</p>
</li>
<li>
<p><code>FLAG_ACTIVITY_SINGLE_TOP</code>: ç­‰åŒ singleTopã€‚</p>
</li>
<li>
<p><code>FLAG_ACTIVITY_CLEAR_TOP</code>:</p>
<ul>
<li><strong>æ ‡å‡†æ¨¡å¼ä¸‹</strong>ï¼šé”€æ¯ç›®æ ‡åŠä¹‹ä¸Šæ‰€æœ‰é¡µé¢ï¼Œ<strong>é‡å»º</strong>ç›®æ ‡å®ä¾‹ã€‚</li>
<li><strong>é…åˆ singleTask</strong>ï¼šä¸é‡å»ºï¼Œå›è°ƒ <code>onNewIntent</code>ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">Q13. æ˜¾å¼è°ƒç”¨ vs éšå¼è°ƒç”¨ï¼Ÿ</h3>
<ul>
<li><strong>æ˜¾å¼</strong>ï¼šæŒ‡å®š <code>package</code>, <code>class name</code>ã€‚</li>
<li><strong>éšå¼</strong>ï¼šåŒ¹é… <code>IntentFilter</code> (Action, Category, Data)ã€‚ä¼˜åŠ¿æ˜¯è§£è€¦ã€è·¨åº”ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-16">Q14. IntentFilter åŒ¹é…è§„åˆ™ (Action/Category/Data)ï¼Ÿ</h3>
<ul>
<li>
<p><strong>Action</strong>ï¼šIntent <strong>å¿…é¡»æœ‰</strong> Actionï¼Œä¸”å¿…é¡»åŒ¹é…è¿‡æ»¤è§„åˆ™ä¸­<strong>è‡³å°‘ä¸€ä¸ª</strong>ã€‚</p>
</li>
<li>
<p><strong>Category</strong>ï¼šIntent å¯æ—  Category (é»˜è®¤å¸¦ DEFAULT)ã€‚è‹¥æœ‰ï¼Œåˆ™<strong>å¿…é¡»å…¨éƒ¨</strong>åŒ…å«åœ¨è¿‡æ»¤è§„åˆ™ä¸­ã€‚</p>
<ul>
<li><em>æ³¨ï¼šéšå¼ Activity å¿…é¡»åœ¨ Manifest å£°æ˜ <code>android.intent.category.DEFAULT</code>ã€‚</em></li>
</ul>
</li>
<li>
<p><strong>Data</strong>ï¼šå¿…é¡»åŒ¹é… MIMEType å’Œ URIã€‚</p>
</li>
</ul>
<h3 data-id="heading-17">Q15. å¦‚ä½•é˜²æ­¢éšå¼å¯åŠ¨å¤±è´¥å´©æºƒï¼Ÿ</h3>
<p>ä½¿ç”¨ <code>PackageManager.resolveActivity()</code> æˆ– <code>queryIntentActivities(intent, MATCH_DEFAULT_ONLY)</code> é¢„æ£€æŸ¥æ˜¯å¦è¿”å› null æˆ–ç©ºåˆ—è¡¨ã€‚</p>
<h3 data-id="heading-18">Q16. Launcher å…¥å£ Activity å¿…é¡»é…ç½®ä»€ä¹ˆï¼Ÿ</h3>
<p>(ç¼ºä¸€ä¸å¯)</p>
<pre><code class="hljs language-ini" lang="ini">&lt;action android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.intent.action.MAIN"</span> /&gt;
&lt;category android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.intent.category.LAUNCHER"</span> /&gt;
</code></pre>
<h2 data-id="heading-19">å››ã€ å®æˆ˜æ¡ˆä¾‹</h2>
<h3 data-id="heading-20">Q17. åº”ç”¨æ¯æ¬¡å¯åŠ¨ Acitivity Aï¼Œéƒ½éœ€è¦ä¿è¯ A ä¸ºæ ˆåº•ã€‚</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
    <span class="hljs-keyword">if</span> (!isTaskRoot()) {
        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> getIntent();
        <span class="hljs-type">String</span> <span class="hljs-variable">action</span> <span class="hljs-operator">=</span> intent.getAction();
        
        <span class="hljs-type">Intent</span> <span class="hljs-variable">newIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-built_in">this</span>, ActivityA.class);
        newIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
        startActivity(newIntent);
        finish();
        <span class="hljs-keyword">return</span>;
    }

    setContentView(R.layout.activity_a);
    <span class="hljs-comment">// ... </span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>