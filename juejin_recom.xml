<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[2026 年 PHP 开发者进阶 快速高效开发学习习惯]]></title>    <link>https://juejin.cn/post/7589838714450657321</link>    <guid>https://juejin.cn/post/7589838714450657321</guid>    <pubDate>2025-12-31T23:48:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450657321" data-draft-id="7589838714450640937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026 年 PHP 开发者进阶 快速高效开发学习习惯"/> <meta itemprop="keywords" content="PHP,后端"/> <meta itemprop="datePublished" content="2025-12-31T23:48:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026 年 PHP 开发者进阶 快速高效开发学习习惯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:48:29.000Z" title="Wed Dec 31 2025 23:48:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2026 年 PHP 开发者进阶 快速高效开发学习习惯</h2>
<h3 data-id="heading-1">为什么 2026 年的进阶方式不同了</h3>
<p>2026 年，成为更好的 PHP 开发者，靠的不是记住更多语法技巧，而是养成<strong>复利习惯</strong>——那些可重复的小实践，每周都在悄悄改善代码库。</p>
<p>行业的方向很明确：</p>
<ul>
<li><strong>PHP 变得更具表达力、更安全</strong>（PHP 8.4 和 8.5 带来的改进，日常工作中都能感受到）</li>
<li><strong>工具变得更严格，也更有价值</strong>——能捕获那些一直让我们付出代价的生产故障（类型错误、null 处理、不安全的数组、不完整的重构）</li>
<li><strong>安全和供应链成为工程基础</strong>，不再是某个独立部门的事（Composer audit 和 OWASP 思维已经是常见词汇）</li>
</ul>
<p>所以 2026 年的进阶公式不是励志海报，而是一套习惯：</p>
<ul>
<li>减少意外</li>
<li>缩短反馈循环</li>
<li>让正确性比聪明更容易</li>
</ul>
<p>接下来介绍真正有效的习惯——不是纸上谈兵。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Flevel-up-php-developer-high-impact-habits" target="_blank" title="https://catchadmin.com/post/2026-01/level-up-php-developer-high-impact-habits" ref="nofollow noopener noreferrer">原文 2026 年 PHP 开发者进阶 快速高效开发学习习惯</a></p>
<h3 data-id="heading-2">习惯 1：把升级当作每周维护，别等到年底恐慌</h3>
<p>PHP 8.5 于 2025 年 11 月 20 日发布，包含管道操作符、URI 扩展、克隆时修改属性等改进开发体验的功能。</p>
<p>PHP 8.4 引入了属性钩子和非对称可见性——都能减少样板代码，降低意外修改的风险。</p>
<p>具体功能不是重点，重要的是信号：现代 PHP 让代码更容易做到：</p>
<ul>
<li>明确表达不变量</li>
<li>难以被误用</li>
<li>安全重构</li>
</ul>
<h4 data-id="heading-3">实用的升级习惯（可扩展到多个仓库）</h4>
<p>每周（或每两周）做一次简短的升级检查：</p>
<ol>
<li>升级依赖的补丁版本</li>
<li>运行测试 + 静态分析</li>
<li>持续发布小升级</li>
</ol>
<p>避免"六个月依赖雪崩"阻塞真正的工作。</p>
<p><strong>具体步骤：</strong></p>
<p><strong>1. 固定平台版本，让 Composer 在不同机器上解析一致：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.3"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"platform"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8.3.0"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2. 在 CI 中添加"未来 PHP"版本的任务，提前处理兼容性：</strong></p>
<ul>
<li>保持主运行时稳定</li>
<li>添加第二个任务，在下一个小版本上运行测试</li>
<li>逐步修复不兼容</li>
</ul>
<p><strong>3. 读官方发布说明，别只看博客摘要</strong></p>
<p>官方 PHP 8.5 和 8.4 发布公告简短且可操作。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>不再把"学习 PHP"当作琐碎知识，而是把它当作一个活跃的运行时——它会改变工程约束。</p>
<h3 data-id="heading-4">习惯 2：把"数据边界"作为默认架构策略</h3>
<p>大多数 PHP 生产 bug 都不奇特，通常是：</p>
<ul>
<li>数组缺少键</li>
<li>字符串应该是 int</li>
<li>可空值没被当作可空处理</li>
<li>"临时"输入格式变成了永久格式</li>
</ul>
<p>修复方法无聊但强大：<strong>尽早把不可信输入转换成类型化对象，别在系统里传原始数组。</strong></p>
<h4 data-id="heading-5">简单的 DTO 边界（框架无关）</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateOrderInput</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$customerId</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$totalCents</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
    </span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;customerId === <span class="hljs-string">''</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'customerId is required'</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;totalCents &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'totalCents must be positive'</span>);
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[A-Z]{3}$/'</span>, <span class="hljs-variable">$this</span>-&gt;currency)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'currency must be ISO-4217 like "USD"'</span>);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromArray</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$payload</span></span>): <span class="hljs-title">self</span>
    </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">self</span>(
            customerId: (<span class="hljs-keyword">string</span>)(<span class="hljs-variable">$payload</span>[<span class="hljs-string">'customerId'</span>] ?? <span class="hljs-string">''</span>),
            totalCents: (<span class="hljs-keyword">int</span>)(<span class="hljs-variable">$payload</span>[<span class="hljs-string">'totalCents'</span>] ?? <span class="hljs-number">0</span>),
            currency: <span class="hljs-title function_ invoke__">strtoupper</span>(<span class="hljs-title function_ invoke__">trim</span>((<span class="hljs-keyword">string</span>)(<span class="hljs-variable">$payload</span>[<span class="hljs-string">'currency'</span>] ?? <span class="hljs-string">''</span>))),
        );
    }
}
</code></pre>
<p>服务层不用猜了，接收的是保证的结构。</p>
<h4 data-id="heading-6">用枚举表示"允许的值"，别用注释</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">OrderStatus</span>: <span class="hljs-title">string</span>
</span>{
    <span class="hljs-keyword">case</span> Created = <span class="hljs-string">'CREATED'</span>;
    <span class="hljs-keyword">case</span> Paid = <span class="hljs-string">'PAID'</span>;
    <span class="hljs-keyword">case</span> Cancelled = <span class="hljs-string">'CANCELLED'</span>;
}
</code></pre>
<p>这样就消除了：</p>
<ul>
<li>无效字符串状态</li>
<li>拼写错误 bug</li>
<li>一半的 <code>if ($status === '...')</code> 混乱</li>
</ul>
<h4 data-id="heading-7">想要"可读但不可写"时用非对称可见性</h4>
<p>PHP 8.4 的非对称可见性非常适合不应从外部修改的领域对象。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shipment</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">string</span> <span class="hljs-variable">$status</span> = <span class="hljs-string">'CREATED'</span>,
    </span>) </span>{}

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">markInTransit</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;status = <span class="hljs-string">'IN_TRANSIT'</span>;
    }
}
</code></pre>
<p><strong>为什么这个习惯有用：</strong></p>
<p>不再依赖纪律（"请传正确的结构"），而是依赖约束（"不正确就快速失败"）。</p>
<h3 data-id="heading-8">习惯 3：把不变量放在它保护的状态旁边</h3>
<p>很多 PHP 代码库里，验证是分散的：</p>
<ul>
<li>控制器验证一点</li>
<li>服务验证一点</li>
<li>仓储再验证一点</li>
<li>生产环境还是出现"不可能"的状态</li>
</ul>
<p>PHP 8.4 属性钩子能在属性访问时强制执行规则，不用写无尽的 setter 样板。</p>
<h4 data-id="heading-9">现实的不变量："已付金额不能超过总额"</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$cents</span>,
    </span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;cents &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Money cannot be negative'</span>);
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[A-Z]{3}$/'</span>, <span class="hljs-variable">$this</span>-&gt;currency)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Invalid currency'</span>);
        }
    }
}

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Invoice</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> Money <span class="hljs-variable">$total</span>,
    </span>) </span>{}

    <span class="hljs-keyword">public</span> Money <span class="hljs-variable">$paid</span> {
        <span class="hljs-title function_ invoke__">set</span> (Money <span class="hljs-variable">$value</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span>-&gt;currency !== <span class="hljs-variable language_">$this</span>-&gt;total-&gt;currency) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Currency mismatch'</span>);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span>-&gt;cents &gt; <span class="hljs-variable language_">$this</span>-&gt;total-&gt;cents) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'Overpayment not allowed'</span>);
            }
            <span class="hljs-variable language_">$this</span>-&gt;paid = <span class="hljs-variable">$value</span>;
        }
    }
}
</code></pre>
<p><strong>注意：</strong> 别用钩子隐藏 IO 或副作用。钩子用于验证和转换；IO 保持显式。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>领域规则更难绕过，重构时更容易推理。</p>
<h3 data-id="heading-10">习惯 4：用管道操作符让转换可读</h3>
<p>PHP 8.5 包含管道操作符，最适合可预测的命名转换。</p>
<p>在请求规范化、映射和数据塑形中会立即感受到——这些地方 PHP 代码经常变成嵌套调用或"临时变量汤"。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimAll</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">'trim'</span>, <span class="hljs-variable">$xs</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dropEmpty</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-title function_ invoke__">array_filter</span>(<span class="hljs-variable">$xs</span>, fn(<span class="hljs-variable">$x</span>) =&gt; <span class="hljs-variable">$x</span> !== <span class="hljs-string">''</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lower</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_map</span>(fn(<span class="hljs-variable">$x</span>) =&gt; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$x</span>), <span class="hljs-variable">$xs</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unique</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-title function_ invoke__">array_unique</span>(<span class="hljs-variable">$xs</span>));
}

<span class="hljs-variable">$tags</span> = [<span class="hljs-string">'  PHP '</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'Backend'</span>, <span class="hljs-string">'php'</span>, <span class="hljs-string">'backend '</span>];

<span class="hljs-variable">$normalized</span> = <span class="hljs-variable">$tags</span>
    |&gt; <span class="hljs-title function_ invoke__">trimAll</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">dropEmpty</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">lower</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">unique</span>(...);

<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$normalized</span>);
</code></pre>
<p><strong>经验法则：</strong> 每个步骤能用 2-4 个词总结，管道就有帮助。步骤需要一段话，就别内联。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>意图更清晰，减少审查时间和重构风险。</p>
<h3 data-id="heading-11">习惯 5：把静态分析加入日常反馈循环</h3>
<p>静态分析是 PHP 中最可靠的"技能倍增器"之一。原因很简单：PHP 灵活，灵活性就是 bug 藏身之处。</p>
<p>PHPStan 2.0 是重要里程碑（2024 年发布，2025 年广泛采用）。</p>
<p>不用静态分析，就是选择在运行时发现本可以在编译时发现的问题。</p>
<h4 data-id="heading-12">不会引起反抗的采用策略</h4>
<p>从能实现的级别开始，然后收紧。</p>
<p>示例 <code>phpstan.neon</code>：</p>
<pre><code class="hljs language-neon" lang="neon">parameters:
  level: 6
  paths:
    - src
  reportUnmatchedIgnoredErrors: true
</code></pre>
<p>在 CI 中：</p>
<pre><code class="hljs language-bash" lang="bash">vendor/bin/phpstan analyse --memory-limit=1G
</code></pre>
<p>然后迭代：</p>
<ul>
<li><strong>级别 6</strong>：清理明显问题</li>
<li><strong>级别 7-8</strong>：强制更好的类型和 null 处理</li>
<li><strong>级别 9-10</strong>：仅在代码库准备好后</li>
</ul>
<h4 data-id="heading-13">最重要的实践：给数组加类型</h4>
<p>未类型化的数组会让分析失效。尽可能用 DTO，数组不可避免时就注释：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> array&lt;int, array{sku: string, qty: int}&gt;
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseItems</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$payload</span></span>): <span class="hljs-title">array</span>
</span>{
    <span class="hljs-variable">$items</span> = [];
    <span class="hljs-keyword">foreach</span> ((<span class="hljs-variable">$payload</span>[<span class="hljs-string">'items'</span>] ?? []) <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) {
        <span class="hljs-variable">$items</span>[] = [
            <span class="hljs-string">'sku'</span> =&gt; (<span class="hljs-keyword">string</span>)(<span class="hljs-variable">$row</span>[<span class="hljs-string">'sku'</span>] ?? <span class="hljs-string">''</span>),
            <span class="hljs-string">'qty'</span> =&gt; (<span class="hljs-keyword">int</span>)(<span class="hljs-variable">$row</span>[<span class="hljs-string">'qty'</span>] ?? <span class="hljs-number">0</span>),
        ];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$items</span>;
}
</code></pre>
<p><strong>为什么这个习惯有用：</strong></p>
<p>学会表达正确性约束，工具成为始终在线的审查者。</p>
<h3 data-id="heading-14">习惯 6：写保护业务规则的测试，别只追求覆盖率</h3>
<p>2026 年，测试工具继续与现代 PHP 对齐：</p>
<ul>
<li>PHPUnit 11 需要 PHP 8.2+</li>
<li>Pest 4 目标 PHP 8.3+</li>
</ul>
<p>这不是琐事，是信号：要用现代测试工具，运行时得跟上。</p>
<h4 data-id="heading-15">测什么（高 ROI 目标）</h4>
<p>时间有限就测那些关乎金钱或信任的规则：</p>
<ul>
<li>折扣和舍入</li>
<li>幂等性（重复支付请求）</li>
<li>权限检查（谁能看到什么）</li>
<li>取消/退款窗口</li>
<li>库存预留</li>
</ul>
<p>一个能捕获真实 bug 的小例子：舍入行为。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Discount</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$priceCents</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$percent</span></span>): <span class="hljs-title">int</span>
    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$percent</span> &lt; <span class="hljs-number">0</span> || <span class="hljs-variable">$percent</span> &gt; <span class="hljs-number">100</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">'percent must be 0..100'</span>);
        }
        <span class="hljs-variable">$cut</span> = (<span class="hljs-keyword">int</span>) <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$priceCents</span> * (<span class="hljs-variable">$percent</span> / <span class="hljs-number">100</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">max</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">$priceCents</span> - <span class="hljs-variable">$cut</span>);
    }
}
</code></pre>
<p>Pest 风格测试（紧凑但可读）：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">'applies discount with correct rounding'</span>, function () {
    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Discount</span>();
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">999</span>, <span class="hljs-number">10</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">899</span>); <span class="hljs-comment">// 99.9 rounds to 100</span>
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">10</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">900</span>);
});

<span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">'rejects invalid percent'</span>, function () {
    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Discount</span>();
    <span class="hljs-title function_ invoke__">expect</span>(fn() =&gt; <span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">1000</span>, -<span class="hljs-number">1</span>))-&gt;<span class="hljs-title function_ invoke__">toThrow</span>(<span class="hljs-title class_">InvalidArgumentException</span>::<span class="hljs-variable language_">class</span>);
    <span class="hljs-title function_ invoke__">expect</span>(fn() =&gt; <span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">101</span>))-&gt;<span class="hljs-title function_ invoke__">toThrow</span>(<span class="hljs-title class_">InvalidArgumentException</span>::<span class="hljs-variable language_">class</span>);
});
</code></pre>
<h4 data-id="heading-16">习惯中的习惯：把计算和 IO 分开</h4>
<p>业务逻辑和数据库调用、HTTP 调用混在一起，测试就变得困难且缓慢——所以人们不写了。</p>
<p>进阶做法是为计算写纯函数/服务，把 IO 放在接口后面。这不是"企业架构"，是可测试性。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>学会为正确性和可维护性设计，而不只是"让端点工作"。</p>
<h3 data-id="heading-17">习惯 7：把依赖卫生变成不可协商的构建步骤</h3>
<p>Composer 的 <code>audit</code> 命令是最简单的胜利之一。Composer 文档说得很清楚，audit 会根据公告检查已安装的包（默认用 Packagist），用退出代码检测废弃的包，可以在 CI 中用。</p>
<h4 data-id="heading-18">在 CI 中添加（别指望"有人会运行"）</h4>
<pre><code class="hljs language-bash" lang="bash">composer install --no-interaction --no-progress --prefer-dist
composer audit --format=summary
</code></pre>
<h4 data-id="heading-19">用 Composer 脚本变成开发者习惯</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"check"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"composer validate --no-interaction"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"composer audit --format=summary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"vendor/bin/phpstan analyse --memory-limit=1G"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"vendor/bin/phpunit"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>现在开发者运行：</p>
<pre><code class="hljs language-bash" lang="bash">composer check
</code></pre>
<p>一个命令，一致的结果。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>把供应链风险当作工程质量的一部分，而不是"稍后安全部门的事"。</p>
<h3 data-id="heading-20">习惯 8：把 OWASP 当思维模型，别当合规清单</h3>
<p>OWASP Top 10 是面向开发者的意识基线。OWASP 指出，最新版本是 OWASP Top 10:2026。</p>
<p>访问控制失效仍是主要风险（2021 年是 A01，2026 年还是 A01）。</p>
<p><strong>换句话说：</strong> 授权错误仍是出事故最快的方式之一。</p>
<h4 data-id="heading-21">每周习惯：找一类访问控制 bug 并消除</h4>
<p>常见模式：按 ID 取记录，不限定到已认证用户/租户。</p>
<p><strong>糟糕的模式：</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$order</span> = <span class="hljs-variable">$repo</span>-&gt;<span class="hljs-title function_ invoke__">findById</span>((<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'orderId'</span>]);
</code></pre>
<p><strong>更好：</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$userId</span> = <span class="hljs-variable">$auth</span>-&gt;<span class="hljs-title function_ invoke__">userId</span>();
<span class="hljs-variable">$orderId</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'orderId'</span>];
<span class="hljs-variable">$order</span> = <span class="hljs-variable">$repo</span>-&gt;<span class="hljs-title function_ invoke__">findForUser</span>(<span class="hljs-variable">$orderId</span>, <span class="hljs-variable">$userId</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$order</span> === <span class="hljs-literal">null</span>) {
    <span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-number">404</span>);
    <span class="hljs-keyword">exit</span>;
}
</code></pre>
<h4 data-id="heading-22">另一个高影响习惯：到处用预处理语句</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">'SELECT * FROM users WHERE email = :email'</span>);
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>([<span class="hljs-string">'email'</span> =&gt; <span class="hljs-variable">$email</span>]);
<span class="hljs-variable">$user</span> = <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">fetch</span>();
</code></pre>
<p>不用记住每个 OWASP 类别，把它当覆盖地图用：</p>
<ul>
<li>访问控制</li>
<li>输入处理</li>
<li>配置错误</li>
<li>供应链故障</li>
</ul>
<p><strong>为什么这个习惯有用：</strong></p>
<p>把安全本能直接构建到实现决策里。</p>
<h3 data-id="heading-23">习惯 9：把可观测性当代码特性，别只当基础设施</h3>
<p>大多数工程师只在出问题后才关心日志，这是倒着来的。</p>
<p>进阶习惯是给重要代码路径加仪表：</p>
<ul>
<li>认证事件</li>
<li>支付状态转换</li>
<li>外部 API 调用</li>
<li>重试和回退</li>
<li>"不可能"的分支</li>
</ul>
<h4 data-id="heading-24">最小的结构化日志模式（PSR-3 风格）</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-variable">$logger</span>-&gt;<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'payment.authorize.started'</span>, [
    <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$orderId</span>,
    <span class="hljs-string">'provider'</span> =&gt; <span class="hljs-string">'stripe'</span>,
    <span class="hljs-string">'idempotency_key'</span> =&gt; <span class="hljs-variable">$key</span>,
]);

<span class="hljs-keyword">try</span> {
    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$gateway</span>-&gt;<span class="hljs-title function_ invoke__">authorize</span>(<span class="hljs-variable">$command</span>);
    <span class="hljs-variable">$logger</span>-&gt;<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'payment.authorize.ok'</span>, [
        <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$orderId</span>,
        <span class="hljs-string">'provider_ref'</span> =&gt; <span class="hljs-variable">$res</span>-&gt;reference,
    ]);
} <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Throwable</span> <span class="hljs-variable">$e</span>) {
    <span class="hljs-variable">$logger</span>-&gt;<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">'payment.authorize.failed'</span>, [
        <span class="hljs-string">'order_id'</span> =&gt; <span class="hljs-variable">$orderId</span>,
        <span class="hljs-string">'error'</span> =&gt; <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>(),
        <span class="hljs-string">'exception'</span> =&gt; <span class="hljs-variable">$e</span>::<span class="hljs-variable language_">class</span>,
    ]);
    <span class="hljs-keyword">throw</span> <span class="hljs-variable">$e</span>;
}
</code></pre>
<h4 data-id="heading-25">事故时有回报的习惯：关联 ID</h4>
<ul>
<li>传入请求有关联 ID 头就重用</li>
<li>没有就生成一个</li>
<li>放在该请求的每个日志行里</li>
</ul>
<p>把"我们有日志"变成"我们能追踪单个用户操作"。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>减少平均理解时间（MTTU），不只是平均恢复时间。</p>
<h3 data-id="heading-26">习惯 10：性能工作从测量开始，别猜</h3>
<p>PHP 中性能问题通常来自：</p>
<ul>
<li>N+1 数据库查询</li>
<li>大量序列化/反序列化</li>
<li>对大数据集的无界循环</li>
<li>昂贵代码路径中缺少缓存</li>
</ul>
<p>高影响习惯是每周选一个端点做"性能阅读"：</p>
<ul>
<li>它运行多少查询？</li>
<li>响应有多大？</li>
<li>p95 延迟是多少？</li>
<li>在并发下会发生什么？</li>
</ul>
<h4 data-id="heading-27">实用的微优化习惯：消除可避免的分配</h4>
<p>处理大数据时，生成器能减少内存压力：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">declare</span>(strict_types=<span class="hljs-number">1</span>);

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@return</span> Generator&lt;int, array{sku: string, qty: int}&gt;
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">streamItems</span>(<span class="hljs-params"><span class="hljs-keyword">iterable</span> <span class="hljs-variable">$rows</span></span>): <span class="hljs-title">Generator</span>
</span>{
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$rows</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) {
        <span class="hljs-keyword">yield</span> [
            <span class="hljs-string">'sku'</span> =&gt; (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$row</span>[<span class="hljs-string">'sku'</span>],
            <span class="hljs-string">'qty'</span> =&gt; (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$row</span>[<span class="hljs-string">'qty'</span>],
        ];
    }
}
</code></pre>
<p>别混淆微优化和真正的胜利。真正的胜利通常是查询塑形和缓存。</p>
<p><strong>为什么这个习惯有用：</strong></p>
<p>学会把代码决策和生产行为（延迟、吞吐量、成本）联系起来。</p>
<h3 data-id="heading-28">习惯 11：建立复利的个人工程循环</h3>
<p>强大的开发者不靠情绪，靠循环：</p>
<ol>
<li>改点小东西</li>
<li>快速拿到反馈</li>
<li>重复</li>
</ol>
<p>2026 年对 PHP 效果好的循环：</p>
<ul>
<li><strong>编码前：</strong> 定义输入/输出形状（DTO、枚举、值对象）</li>
<li><strong>编码时：</strong> 保持函数小，清晰命名转换（管道有帮助）</li>
<li><strong>推送前：</strong> 运行 <code>composer check</code>（audit + 静态分析 + 测试）</li>
<li><strong>审查中：</strong> 找不变量、边界、访问控制和"安静的复杂性"</li>
<li><strong>发布后：</strong> 在风险更改的地方加日志/指标</li>
</ul>
<p>这不是仪式，是发布经得起时间考验的代码的方式。</p>
<h3 data-id="heading-29">30 天提升 PHP 水平的计划</h3>
<p>想要能实际执行的，这样做：</p>
<h4 data-id="heading-30">第 1 周：现代工具基线</h4>
<ul>
<li>CI 中加 <code>composer audit</code></li>
<li>加 PHPStan 在适度级别并让它通过</li>
<li>加 <code>composer check</code> 脚本用于本地运行</li>
</ul>
<h4 data-id="heading-31">第 2 周：数据边界和不变量</h4>
<ul>
<li>给 2-3 个关键端点引入 DTO 边界</li>
<li>在一个模块里用枚举替换字符串状态字段</li>
<li>在构造函数或属性钩子里加不变量</li>
</ul>
<h4 data-id="heading-32">第 3 周：重要的测试</h4>
<ul>
<li>给金钱/舍入/折扣或其他"业务核心"加测试</li>
<li>运行时允许的话，转向现代测试基线（PHPUnit 11 / Pest）</li>
</ul>
<h4 data-id="heading-33">第 4 周：安全和生产反馈</h4>
<ul>
<li>给顶级敏感资源审计访问控制（OWASP A01 思维）</li>
<li>给风险流程加关联 ID + 结构化日志</li>
<li>选一个端点减少查询数量或有效负载大小</li>
</ul>
<p>月底会注意到复利效应：更少回归，更快审查，更清晰重构。</p>
<h3 data-id="heading-34">结论</h3>
<p>现代 PHP（8.4 和 8.5）提供了减少样板、提高表达力的工具——属性钩子、非对称可见性、管道操作符等。</p>
<p>但这些工具只有在习惯创建的系统中才重要：</p>
<ul>
<li>输入尽早变成类型化数据</li>
<li>不变量靠近状态</li>
<li>分析和测试持续运行</li>
<li>依赖自动审计</li>
<li>安全思维是实现的一部分</li>
<li>生产反馈在日志和指标里可见</li>
</ul>
<p>真实团队里的"进阶"就是这样：不是英雄式重构，而是无聊的习惯，复利到代码库变得更容易改变而不是破坏。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite 3实战：我用这5个优化技巧让HMR构建速度提升了40%]]></title>    <link>https://juejin.cn/post/7589881050769440802</link>    <guid>https://juejin.cn/post/7589881050769440802</guid>    <pubDate>2026-01-01T00:17:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589881050769440802" data-draft-id="7589893170387091456" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite 3实战：我用这5个优化技巧让HMR构建速度提升了40%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-01T00:17:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite 3实战：我用这5个优化技巧让HMR构建速度提升了40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T00:17:18.000Z" title="Thu Jan 01 2026 00:17:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vite 3实战：我用这5个优化技巧让HMR构建速度提升了40%</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>在现代前端开发中，构建工具的性能直接影响开发体验和效率。Vite 3作为新一代的前端构建工具，以其极快的冷启动和热模块替换（HMR）速度赢得了广泛关注。然而，在实际项目中，随着代码量和依赖的增加，HMR的响应时间可能会逐渐变慢。本文将分享我在一个中型项目中通过5个优化技巧将HMR构建速度提升40%的实战经验，希望能为开发者提供有价值的参考。</p>
<hr/>
<h3 data-id="heading-2">主体</h3>
<h4 data-id="heading-3">1. 理解Vite的HMR机制</h4>
<p>在深入优化之前，我们需要理解Vite的HMR工作原理。Vite利用浏览器原生ES模块（ESM）的特性，实现了按需编译和即时更新。其核心优势在于：</p>
<ul>
<li><strong>按需编译</strong>：仅编译当前页面所需的模块，而非整个应用。</li>
<li><strong>基于ESM的HMR</strong>：通过WebSocket与浏览器通信，实现模块的热替换。</li>
</ul>
<p>然而，以下因素可能导致HMR变慢：</p>
<ul>
<li>依赖预构建（Pre-bundling）未优化</li>
<li>过多的文件监听（File Watcher）</li>
<li>未合理配置缓存</li>
<li>插件性能瓶颈</li>
</ul>
<p>接下来，我将介绍5个具体优化点及其效果。</p>
<hr/>
<h4 data-id="heading-4">2. 优化技巧1：精准配置依赖预构建</h4>
<p>Vite在首次启动时会使用<code>esbuild</code>对<code>node_modules</code>中的依赖进行预构建（Pre-bundling）。默认情况下，Vite会自动扫描<code>import</code>语句来确定需要预构建的依赖项，但这一过程可能不够高效。</p>
<p><strong>优化方法：</strong></p>
<ol>
<li><strong>显式指定依赖项</strong>：在<code>vite.config.js</code>中通过<code>optimizeDeps.include</code>手动列出需要预构建的依赖项，减少扫描时间。
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">optimizeDeps</span>: {
    <span class="hljs-attr">include</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'react-dom'</span>, <span class="hljs-string">'lodash-es'</span>],
  },
}
</code></pre>
</li>
<li><strong>排除无需预构建的库</strong>：某些库已经是ESM格式（如<code>lodash-es</code>），可以通过<code>optimizeDeps.exclude</code>跳过预构建。</li>
</ol>
<p><strong>效果：</strong> HMR响应时间减少约15%。</p>
<hr/>
<h4 data-id="heading-5">3. 优化技巧2：减少文件监听范围</h4>
<p>默认情况下，Vite会监听项目根目录下的所有文件变动以触发HMR。但在大型项目中，这会带来显著的开销。</p>
<p><strong>优化方法：</strong></p>
<ol>
<li><strong>配置忽略文件规则</strong>：通过<code>server.watch.ignored</code>排除无关文件的监听（如<code>.git</code>, <code>dist</code>, <code>node_modules</code>）。
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">watch</span>: {
      <span class="hljs-attr">ignored</span>: [<span class="hljs-string">'**/node_modules/**'</span>, <span class="hljs-string">'**/.git/**'</span>],
    },
  },
}
</code></pre>
</li>
<li><strong>使用更高效的监听库</strong>：在Linux/macOS环境下可启用<code>usePolling: false</code>以提升性能。</li>
</ol>
<p><strong>效果：</strong> HMR响应时间减少约8%。</p>
<hr/>
<h4 data-id="heading-6">4. 优化技巧3：合理利用缓存策略</h4>
<p>Vite默认会将预构建的依赖缓存到<code>node_modules/.vite/deps</code>中。但在某些场景下（如频繁切换分支），缓存可能失效或重复生成。</p>
<p><strong>优化方法：</strong></p>
<ol>
<li><strong>持久化缓存位置</strong>：通过设置环境变量更改缓存目录以避免重复生成。
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> VITE_CACHE_DIR=/path/to/custom/cache
</code></pre>
</li>
<li><strong>强制跳过缓存检查</strong>: （仅限开发环境）在调试时通过命令行参数禁用缓存检查以节省时间：
<pre><code class="hljs language-bash" lang="bash">vite --force
</code></pre>
</li>
</ol>
<p>注意⚠️ ：生产环境应避免跳过缓存以保证一致性。</p>
<hr/>
<p>#### 5． 4． Optimization Technique # 4 : Fine-Tuning Plugin Performance</p>
<p>Plugins are powerful but can become bottlenecks if not optimized properly.For example,a poorly written plugin might block the main thread during compilation or introduce unnecessary transformations.To address this :</p>
<ul>
<li>
<p>Audit Your Plugins ：Disable plugins one by one in development mode to identify performance bottlenecks.A common culprit is legacy plugin designed for Webpack that haven’t been fully adapted to Vite’s ESM-based pipeline.You may need alternatives like @rollup/plugin-babel instead of babel-loader.Moreover,vitest provides lighter-weight testing integration compared with Jest+transformers组合拳攻击力十足！</p>
</li>
<li>
<p>Lazy-Load Heavy Plugins ：If certain plugins are only needed during production builds (e.g.,@vitejs/plugin-legacy),load them conditionally based on process.env.NODE_ENV.This prevents them from slowing down HMR cycles unnecessarily ：</p>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {    
<span class="hljs-attr">plugins</span>:[    
process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span> ? <span class="hljs-title function_">legacy</span>() : <span class="hljs-literal">null</span>,    
],    
}     
</code></pre>
<p>Results showed ~10% improvement here alone after auditing three third-party plugins being used unnecessarily during dev模式下的战斗场景激烈程度可想而知！</p>
<hr/>
<p>#### 6． 5． Optimization Technique #5 : Parallelizing Tasks with Worker Threads</p>
<p>While esbuild handles most transforms efficiently via Go’s parallelism,some tasks like TypeScript type checking can still block Node.js’ single-threaded event loop.To mitigate this,the following approaches were employed :</p>
<p>1.Use fork-ts-checker-webpack-plugin Alternative ：In Vite land,vitest provides worker-based type checking via poolOptions.<sup>[1]</sup> Alternatively,tsparticles(?)can be run as a separate process during development using Concurrently or similar tools without blocking HMR updates itself!</p>
<p>2.Optimize CSS Processing ：For projects with significant CSS splitting需求,consider using lightning-css (written in Rust) over traditional PostCSS pipelines where possible.This reduced样式表相关更新时间由500ms→200ms左右!</p>
<p>Final result was an additional7%,bringing total gains up to40%.Not bad for a few hours’ work!</p>
<hr/>
<h3 data-id="heading-7">Conclusion</h3>
<p>Through targeted optimizations spanning dependency management,file watching,caching strategies,and plugin configuration,I managed to reduce HMT build times by40%in our mid-sized React+TypeScript project.The key takeaway is that while Vites out-of-the-box experience is excellent,there remains ample room for customization depending on specific project needs and scale.For teams experiencing slowdowns during development周期长度较长的情况下尤其值得尝试这些方法以提高生产力水平！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第2章 Nest.js入门]]></title>    <link>https://juejin.cn/post/7589881050769522722</link>    <guid>https://juejin.cn/post/7589881050769522722</guid>    <pubDate>2026-01-01T00:31:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589881050769522722" data-draft-id="7589893170387107840" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第2章 Nest.js入门"/> <meta itemprop="keywords" content="前端,NestJS,AI编程"/> <meta itemprop="datePublished" content="2026-01-01T00:31:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XiaoYu2002"/> <meta itemprop="url" content="https://juejin.cn/user/251124329220663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第2章 Nest.js入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/251124329220663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XiaoYu2002
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-01T00:31:41.000Z" title="Thu Jan 01 2026 00:31:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>学习Nest.js可以通过官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nestjs.com%2F" target="_blank" title="https://docs.nestjs.com/" ref="nofollow noopener noreferrer">Documentation | NestJS - A progressive Node.js framework</a>。Nest官方文档如图2-1所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1105352608e74486b3d161b05e3bd0cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=1I%2BPJDptMSilrHcrVRncgeKk3NQ%3D" alt="image-20251211155326802" loading="lazy"/></p>
<p align="center">
 <b> 图2-1 Nest.js官方文档</b>
</p>
<p>英文掌握薄弱可采用全文翻译为中文或者在浏览器扩展中下载插件“沉浸式翻译 - 网页翻译插件 | PDF翻译 | 免费"，配置后，可通过快捷键进行中英文对照翻译，更适合阅读理解，如图2-2所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50018b37607e4292809072841f2b7774~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=xBu7VRRYm8yTdxi3%2BkSnPa%2BnUDs%3D" alt="image-20251211224527050" loading="lazy"/></p>
<p align="center">
 <b> 图2-2 Nest.js官方文档-局部翻译</b>
</p>
<p>如果没有学习过Nest.js，第一个疑惑是它是干什么的？Nest.js是提供HTTP服务的框架。并且Nest.js是基于Express实现（即Nest.js底层是默认基于Express封装，也可以选择Fastify），并没有采用原生实现。</p>
<p>Express和Fastify要如何抉择？Express适合做业务层，而Fastify适合做网关层，根据自己实际情况决定。</p>
<h2 data-id="heading-0">2.1 安装Nest.js</h2>
<p>假如你从未使用过Nest.js，那么第一步是先通过官方文档安装NestJS 命令行工具（CLI），安装后可以在系统的任何目录下使用nest 命令。通过win+R组合快捷键呼出运行窗口，输入cmd进入终端，复制以下命令回车执行。</p>
<p>Vue.js 2的主流时期也是采用CLI的方式构建项目，后续逐渐迁移到Vite中，而NestJS的CLI使用方式和过往的CLI都是一致的。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//全局安装 NestJS 命令行工具（CLI）</span>
npm i -g <span class="hljs-meta">@nestjs</span>/cli
</code></pre>
<p>安装结束之后，通过nest --version命令检测NestJS 命令行工具是否安装成功，如图2-3所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/170d63a46dc14437a2140f44723eb99b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=dX1rTRIUFKUY%2BLPlz7AK8XdxZEQ%3D" alt="image-20251211160755034" loading="lazy"/></p>
<p align="center">
 <b> 图2-3 Nest.js命令行工具安装</b>
</p>
<p>第二步就可以构建一个Nest.js项目，通过在终端输入以下命令构建项目。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// nest new &lt;项目名&gt;</span>
nest <span class="hljs-keyword">new</span> app
</code></pre>
<p>会生成如下问题：Which package manager would you ❤️  to use?（您将使用哪个包管理器），有npm、yarn和pnpm可选，推荐pnpm。项目构建成功如图2-4所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b28e7778ab61463d8b8e098c4e32caa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=ah2GVBzRioqbnI8kOdK1%2BFdUfwo%3D" alt="image-20251211161804681" loading="lazy"/></p>
<p align="center">
 <b> 图2-4 Nest.js构建项目</b>
</p>
<p>Nest.js构建的项目结构目录如图2-5所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caccdef48231442a8f1cbae77cc7b72c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=1vxZFGNcyWDgeead1uhTgo%2BoQdQ%3D" alt="image-20251211162120635" loading="lazy"/></p>
<p align="center">
 <b> 图2-5 Nest.js项目结构目录</b>
</p>
<p>从上往下解释分为四部分：</p>
<p>（1）node_modules文件夹：各种项目依赖包，在构建项目时就装好了，无需再次安装。</p>
<p>（2）src文件夹：源代码存放处。</p>
<p>（3）test文件夹：端到端(E2E)测试目录，这个不管。</p>
<p>（4）各类配置文件。</p>
<p>src文件夹下有四个ts文件，作用如下：</p>
<pre><code class="hljs language-ts" lang="ts">├── main.<span class="hljs-property">ts</span>                    <span class="hljs-comment">// 应用入口文件</span>
├── app.<span class="hljs-property">module</span>.<span class="hljs-property">ts</span>              <span class="hljs-comment">// 根模块（AppModule）</span>
├── app.<span class="hljs-property">controller</span>.<span class="hljs-property">ts</span>          <span class="hljs-comment">// 根控制器</span>
├── app.<span class="hljs-property">service</span>.<span class="hljs-property">ts</span>             <span class="hljs-comment">// 根服务</span>
└── app.<span class="hljs-property">controller</span>.<span class="hljs-property">spec</span>.<span class="hljs-property">ts</span>     <span class="hljs-comment">// 控制器单元测试</span>
</code></pre>
<p>配置文件总结如表1-1所示。</p>
<p align="center">
 <b> 表1-1 Nest.js项目结构-配置文件</b>
</p>







































































<table><thead><tr><th align="left">文件名</th><th align="left">类型</th><th align="left">主要作用</th><th align="left">关联工具/框架</th></tr></thead><tbody><tr><td align="left">package.json</td><td align="left">项目配置</td><td align="left">定义项目依赖、脚本命令、基本信息</td><td align="left">Node.js / npm</td></tr><tr><td align="left">package-lock.json</td><td align="left">依赖锁</td><td align="left">锁定依赖版本，确保一致性</td><td align="left">npm</td></tr><tr><td align="left">.gitignore</td><td align="left">忽略规则</td><td align="left">指定哪些文件/目录不应提交到 Git</td><td align="left">Git</td></tr><tr><td align="left">.prettierrc</td><td align="left">代码格式化</td><td align="left">配置代码格式化规则（Prettier）</td><td align="left">Prettier</td></tr><tr><td align="left">eslint.config.mjs</td><td align="left">代码检查</td><td align="left">配置 ESLint 代码质量检查规则</td><td align="left">ESLint</td></tr><tr><td align="left">nest-cli.json</td><td align="left">CLI 配置</td><td align="left">NestJS 命令行工具的配置文件</td><td align="left">NestJS CLI</td></tr><tr><td align="left">tsconfig.json</td><td align="left">TS 配置</td><td align="left">TypeScript 编译器配置（开发环境）</td><td align="left">TypeScript</td></tr><tr><td align="left">tsconfig.build.json</td><td align="left">TS 构建配置</td><td align="left">TypeScript 生产构建配置</td><td align="left">TypeScript / NestJS</td></tr><tr><td align="left">jest-e2e.json</td><td align="left">测试配置</td><td align="left">端到端(E2E)测试的 Jest 配置</td><td align="left">Jest</td></tr><tr><td align="left">README.md</td><td align="left">文档</td><td align="left">项目说明文档</td><td align="left">-</td></tr></tbody></table>
<p>以上是初始化项目的基础介绍。</p>
<h2 data-id="heading-1">2.2 src文件夹内容介绍</h2>
<p>src文件夹下的app.controller.spec.ts单元测试文件在开发中是基本不会用到的，因此删除该文件。每次打包构建的时候都会重新创建该单元测试文件，因此我们在nest-cli.json配置文件中添加generateOptions配置项，将spec置为false，做完以上操作，构建项目就不会重新创建app.controller.spec.ts文件了。</p>
<pre><code class="hljs language-ts" lang="ts">{
  <span class="hljs-string">"$schema"</span>: <span class="hljs-string">"https://json.schemastore.org/nest-cli"</span>,
  <span class="hljs-string">"collection"</span>: <span class="hljs-string">"@nestjs/schematics"</span>,
  <span class="hljs-string">"sourceRoot"</span>: <span class="hljs-string">"src"</span>,
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"deleteOutDir"</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-string">"generateOptions"</span>: {
    <span class="hljs-string">"spec"</span>: <span class="hljs-literal">false</span>
  }
}
</code></pre>
<p>此时src文件夹下4个文件的关联性就很强，文件功能如下4点：</p>
<p>（1）app.controller.ts：控制层，类似前端的路由。</p>
<p>（2）app.module.ts：协调app.controller.ts和app.service.ts文件，我们可以将app.module.ts文件理解为依赖注入的容器，通过@Module()装饰器实现模块整合。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.controller'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<p>（3）app.service.ts：具体业务实现。</p>
<p>以上3个文件夹分层和MVC架构具备一定的相似性，只不过没有view（视图层）。</p>
<p>（4） main.ts：应用启动入口，创建应用并实现应用的端口监听。</p>
<p>项目启动命令从package.json中的scripts配置项中查看，使用npm run start或者npm run start:dev都可以。启动项目之后到main.ts文件中查看具体端口（默认是3000端口），然后到浏览器中输入<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2F%25E8%25BF%259B%25E8%25A1%258C%25E8%25AE%25BF%25E9%2597%25AE%25E3%2580%2582" target="_blank" title="http://localhost:3000/%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E3%80%82" ref="nofollow noopener noreferrer">http://localhost:3000/进行访问。</a></p>
<p>Nest.js项目启动后展现的内容是来自app.service.ts文件的具体业务内容，如图2-6所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/782aa0cd544a4ab28026fa077a513b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=C069AlAR50oFnxcsktipDYZl2SM%3D" alt="image-20251211164534329" loading="lazy"/></p>
<p align="center">
 <b> 图2-6 Nest.js项目启动-初始化效果</b>
</p>
<h2 data-id="heading-2">2.3 Nest命令</h2>
<p>在终端输入Nest g --help就可以将所有的nest命令弹出，其中有些nest命令可用于创建nest元素，即nest文件，该部分命令总结如表1-2所示。</p>
<p align="center">
 <b> 表1-2 Nest.js命令行部分命令</b>
</p>









































































































<table><thead><tr><th align="left">名称 (Name)</th><th align="left">别名 (Alias)</th><th align="left">描述 (Description)</th></tr></thead><tbody><tr><td align="left"><strong>application</strong></td><td align="left">application</td><td align="left">生成一个新的应用工作空间</td></tr><tr><td align="left"><strong>class</strong></td><td align="left">cl</td><td align="left">生成一个新的类</td></tr><tr><td align="left"><strong>configuration</strong></td><td align="left">config</td><td align="left">生成 CLI 配置文件</td></tr><tr><td align="left"><strong>controller</strong></td><td align="left">co</td><td align="left">生成控制器声明</td></tr><tr><td align="left"><strong>decorator</strong></td><td align="left">d</td><td align="left">生成自定义装饰器</td></tr><tr><td align="left"><strong>filter</strong></td><td align="left">f</td><td align="left">生成过滤器声明</td></tr><tr><td align="left"><strong>gateway</strong></td><td align="left">ga</td><td align="left">生成网关声明（WebSocket）</td></tr><tr><td align="left"><strong>guard</strong></td><td align="left">gu</td><td align="left">生成守卫声明</td></tr><tr><td align="left"><strong>interceptor</strong></td><td align="left">itc</td><td align="left">生成拦截器声明</td></tr><tr><td align="left"><strong>interface</strong></td><td align="left">itf</td><td align="left">生成接口</td></tr><tr><td align="left"><strong>library</strong></td><td align="left">lib</td><td align="left">在 monorepo 中生成新的库</td></tr><tr><td align="left"><strong>middleware</strong></td><td align="left">mi</td><td align="left">生成中间件声明</td></tr><tr><td align="left"><strong>module</strong></td><td align="left">mo</td><td align="left">生成模块声明</td></tr><tr><td align="left"><strong>pipe</strong></td><td align="left">pi</td><td align="left">生成管道声明</td></tr><tr><td align="left"><strong>provider</strong></td><td align="left">pr</td><td align="left">生成提供者声明</td></tr><tr><td align="left"><strong>resolver</strong></td><td align="left">r</td><td align="left">生成 GraphQL 解析器声明</td></tr><tr><td align="left"><strong>resource</strong></td><td align="left">res</td><td align="left">生成新的 CRUD 资源</td></tr><tr><td align="left"><strong>service</strong></td><td align="left">s</td><td align="left">生成服务声明</td></tr><tr><td align="left"><strong>sub-app</strong></td><td align="left">app</td><td align="left">在 monorepo 中生成新的子应用</td></tr></tbody></table>
<p>如果我们想在src文件夹下创建一个xiaoyu模块，我们需要找到src文件夹，创建xiaoyu文件夹，在xiaoyu文件夹下创建xiaoyu.module.ts文件，并且在app.module.ts中将XiaoyuModule注册到模块中。注意：我们可以在@Module()装饰器的imports配置项中导入其他模块。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// app.module.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.controller'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">XiaoyuModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./xiaoyu/xiaoyu.module'</span>;

<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">XiaoyuModule</span>],
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}

</code></pre>
<p>但如果通过命令，只需要在终端通过nest g mo xiaoyu就能自动化的完成以上操作，包括自动在app.module.ts文件中注册模块。在终端中体现为新增xiaoyu.module.ts文件，改变app.module.ts文件，如图2-7所示。这可以减少我们一定的心智负担。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be863d9d7b2f4e8b936a54cd55dc7f5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=tN6Drv8s90MrYEO3HzYT6X7E6Pc%3D" alt="image-20251211165629149" loading="lazy"/></p>
<p align="center">
 <b> 图2-7 nest g mo xiaoyu命令效果</b>
</p>
<p>除了注册模块，还可以创建service服务层，命令为：nest g s xiaoyu；创建controller控制层，命令为：nest g co xiaoyu。如图2-8所示。xiaoyu.controller.ts和xiaoyu.service.ts文件通过命令生成后，会自动关联到xiaoyu.module.ts文件中，无需开发者额外补充操作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04e75b1d3da14066b03add9ecafcf148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=rBPW3TRnchzWLNlaRC8X9C0un6s%3D" alt="image-20251211213027460" loading="lazy"/></p>
<p align="center">
 <b> 图2-8 nest g s/co xiaoyu命令效果</b>
</p>
<p>我们可以看到这些命令都在一定程度上体现对应的功能，例如刚才三点，因此通过理解关联就很容易记住。</p>
<p>（1）nest g mo &lt;模块名称&gt;=&gt; module（模块）。</p>
<p>（2）nest g s &lt;服务名称&gt;=&gt; service（服务）。</p>
<p>（3）nest g co &lt;控制器名称&gt;=&gt; controller（控制）。</p>
<p>但常用的命令操作主要为：nest g res &lt;模块名称&gt;。表1-2的解释是生成增删改查的资源，听起来并不好理解，实际是生成一份完整结构的增删改查模块--Demo级别。</p>
<p>当我们在终端输入该命令：nest g res user，会弹出一段话What transport layer do you use?（你要使用哪种传输层协议？），然后给出如下5种选择：</p>
<p>（1）REST API。通过传统的 HTTP 路由方式提供接口，是最常用、最直观的 Web 接口风格。</p>
<p>（2）GraphQL（code first）。通过代码定义 GraphQL 架构，让类型和解析逻辑都由代码自动生成。（不好用）</p>
<p>（3）GraphQL（schema first）。先写 .graphql Schema，再根据 Schema 编写解析逻辑，更适合规范化协作。（不好用）</p>
<p>（4）Microservice（non-HTTP）。微服务，通过消息队列、TCP、gRPC 等方式实现服务间通信。</p>
<p>（5）WebSockets。用于创建实时、双向通信的长连接服务，如聊天室或实时推送。</p>
<p>我们选择第一种REST API就可以了。</p>
<p>此时会弹出第二个问题：Would you like to generate CRUD entry points?（你想生成增删改查的模板吗？），选Y（Yes），然后就会开始生成资源。</p>
<p>nest g res user命令效果如图2-9所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5261b3e8330a4887aff90bdc0d77731e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=n%2F2s6RQ4v0I0t9zYjVbFeF7a0GI%3D" alt="image-20251211214834047" loading="lazy"/></p>
<p align="center">
 <b> 图2-9 nest g res user命令效果</b>
</p>
<p>可以看到该命令一下就创建出controller、module、service三层文件（自动化配置），这些文件内部都会自动初始化一份基础的代码。其文件作用与2.2小节所介绍的src文件夹下的三个同类型文件的作用是一致的。因此展现的内容在user.service.ts文件中，而路由在user.controller.ts文件中。我们打开user.controller.ts文件可以看到默认的get和post方法以及一些参数方法。</p>
<p>如果想要测试Patch，Delete等请求，需要在VSCode中下载rest client，然后在test测试文件夹下创建index.http文件用于发送各种不同的请求来测试API接口。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// user.controller.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">Post</span>, <span class="hljs-title class_">Body</span>, <span class="hljs-title class_">Patch</span>, <span class="hljs-title class_">Param</span>, <span class="hljs-title class_">Delete</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./user.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CreateUserDto</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./dto/create-user.dto'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UpdateUserDto</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./dto/update-user.dto'</span>;

<span class="hljs-meta">@Controller</span>(<span class="hljs-string">'user'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> userService: UserService</span>) {} <span class="hljs-comment">// 来自业务层的展示内容</span>

  <span class="hljs-meta">@Post</span>()
  <span class="hljs-title function_">create</span>(<span class="hljs-params"><span class="hljs-meta">@Body</span>() createUserDto: CreateUserDto</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">create</span>(createUserDto);
  }

  <span class="hljs-meta">@Get</span>()
  <span class="hljs-title function_">findAll</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">findAll</span>(); <span class="hljs-comment">// 触发默认get请求后，返回业务层中的findAll方法下的展示内容。</span>
  }

  <span class="hljs-meta">@Get</span>(<span class="hljs-string">':id'</span>)
  <span class="hljs-title function_">findOne</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">'id'</span>) id: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">findOne</span>(+id);
  }

  <span class="hljs-meta">@Patch</span>(<span class="hljs-string">':id'</span>)
  <span class="hljs-title function_">update</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">'id'</span>) id: <span class="hljs-built_in">string</span>, <span class="hljs-meta">@Body</span>() updateUserDto: UpdateUserDto</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">update</span>(+id, updateUserDto);
  }

  <span class="hljs-meta">@Delete</span>(<span class="hljs-string">':id'</span>)
  <span class="hljs-title function_">remove</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">'id'</span>) id: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">remove</span>(+id);
  }
}
</code></pre>
<p>因此，只需要在原有URL的后缀添加/user就能访问到user模块下的默认get请求，而get请求的是user.service.ts业务层的内容，/user路由访问效果如图2-10所示。到这里，我们就理解控制层和业务层之间的联系合作（同时在模块层导入注册），并且完成了一次基础的模块创建并展示使用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d748dd3fd4f149e183bd00d31b513105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767832301&amp;x-signature=E0HCjU4Vttw2NfH4lAS2JyBeQpw%3D" alt="image-20251211223437609" loading="lazy"/></p>
<p align="center">
 <b> 图2-10 /user路由的访问效果</b>
</p>
<p>除此之外还有dto和entities两个文件夹，两个文件夹作用如下所示：</p>
<p>（1）dto文件夹：数据验证层。主要功能有：定义 API 请求、数据验证（使用 class-validator）、数据转换（使用 class-transformer）等等。内部有create-user.dto.ts和update-user.dto.ts文件，分别用来创建和更新用户的DTO。例如数据验证的做法如下代码所示。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// create-user.dto.ts</span>
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">IsNotEmpty</span>,<span class="hljs-title class_">IsString</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'class-validator'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateUserDto</span> {
    <span class="hljs-meta">@IsNotEmpty</span>() <span class="hljs-comment">// 验证-不能为空</span>
    <span class="hljs-meta">@IsString</span>() <span class="hljs-comment">// 验证-需要是一个字符串</span>
    <span class="hljs-attr">account</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 账号</span>
    <span class="hljs-meta">@IsNotEmpty</span>()
    <span class="hljs-meta">@IsString</span>()
    <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 密码</span>
}
</code></pre>
<p>（2）entities文件夹：实体层。定义数据库的，即映射数据库表结构（ORM 概念），但我们数据库使用Prisma7，所以不在entities文件夹定义，这里用不上了。</p>
<p>所以nest g res &lt;模块名称&gt;做到了nest g mo/s/co &lt;模块名称&gt;的合并效果并且还有额外的数据验证层和实体层，因此nest g res相对于连续写3个命令来创建对应模块结构会更为简便，在日常使用会更加高频。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 Parallel.ForEachAsync：C#.NET 并行调度模型揭秘]]></title>    <link>https://juejin.cn/post/7589893170387009536</link>    <guid>https://juejin.cn/post/7589893170387009536</guid>    <pubDate>2025-12-31T23:04:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589893170387009536" data-draft-id="7589881050769326114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Parallel.ForEachAsync：C#.NET 并行调度模型揭秘"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-31T23:04:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Parallel.ForEachAsync：C#.NET 并行调度模型揭秘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:04:56.000Z" title="Wed Dec 31 2025 23:04:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<pre><code class="hljs language-csharp" lang="csharp">┌──────────────┐
│ 数据源枚举器 │  IEnumerable / IAsyncEnumerable
└──────┬───────┘
       ↓
┌────────────────────┐
│ 并发调度器（Pump） │  ← 控制最多 N 个任务
└──────┬─────────────┘
       ↓
┌────────────────────┐
│ <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-title">Body</span>(<span class="hljs-params">item</span>)   │  ← 异步逻辑
└──────┬─────────────┘
       ↓
┌────────────────────┐
│ 完成 / 异常 / 取消 │
└────────────────────┘
</span></code></pre>
<ul>
<li>
<p>不是一次性启动所有任务</p>
</li>
<li>
<p>是一个 “边消费、边执行、边补位” 的模型</p>
</li>
</ul>
<h3 data-id="heading-1">核心设计目标</h3>
<blockquote>
<p>在异步场景下，维持固定并发度，持续消耗数据源，直到完成</p>
</blockquote>





















<table><thead><tr><th>痛点</th><th>ForEachAsync 的解法</th></tr></thead><tbody><tr><td>Task.WhenAll 不限流</td><td>MaxDegreeOfParallelism</td></tr><tr><td>SemaphoreSlim 模板繁琐</td><td>内建</td></tr><tr><td>async foreach 调度复杂</td><td>自动处理</td></tr></tbody></table>
<h3 data-id="heading-2">调度模型核心：滑动窗口（Sliding Window）</h3>
<h4 data-id="heading-3">并发度不是“一次性分配”</h4>
<p>假设：</p>
<pre><code class="hljs language-csharp" lang="csharp">MaxDegreeOfParallelism = <span class="hljs-number">3</span>
items = [A, B, C, D, E, F]
</code></pre>
<p>执行顺序是这样的：</p>
<pre><code class="hljs language-css" lang="css">启动 <span class="hljs-selector-tag">A</span>  <span class="hljs-selector-tag">B</span>  C   （占满 <span class="hljs-number">3</span> 个槽位）
      │  │  │
      │  │  └─ C 完成 → 启动 D
      │  └──── <span class="hljs-selector-tag">B</span> 完成 → 启动 E
      └─────── <span class="hljs-selector-tag">A</span> 完成 → 启动 F
</code></pre>
<p>这就是滑动窗口</p>
<p>任何时刻：</p>
<ul>
<li>
<p>运行中的任务 ≤ <code>MaxDegreeOfParallelism</code></p>
</li>
<li>
<p>永远“有空位就补”</p>
</li>
</ul>
<h3 data-id="heading-4">内部不是 Parallel.For，而是 Task 泵</h3>
<p>关键认知</p>
<blockquote>
<p>Parallel.ForEachAsync 并没有复用 Parallel.For 的线程切分模型</p>
</blockquote>
<p>原因很简单：</p>
<ul>
<li>
<p><code>Parallel.For</code> → 同步代码 + 线程</p>
</li>
<li>
<p><code>ForEachAsync</code> → 异步代码 + <code>continuation</code></p>
</li>
</ul>
<p>内部本质是一个 <code>Task Pump</code>（任务泵）</p>
<p>伪代码级理解（高度简化）</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">async</span> Task <span class="hljs-title">RunAsync</span>()</span>
{
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> enumerator = source.GetEnumerator();
    <span class="hljs-keyword">var</span> runningTasks = <span class="hljs-keyword">new</span> List&lt;Task&gt;();

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)
    {
        <span class="hljs-keyword">while</span> (runningTasks.Count &lt; maxDegree &amp;&amp; enumerator.MoveNext())
        {
            <span class="hljs-keyword">var</span> item = enumerator.Current;
            runningTasks.Add(ProcessAsync(item));
        }

        <span class="hljs-keyword">if</span> (runningTasks.Count == <span class="hljs-number">0</span>)
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">var</span> finished = <span class="hljs-keyword">await</span> Task.WhenAny(runningTasks);
        runningTasks.Remove(finished);
    }
}
</code></pre>
<p>真实实现更复杂（异常、取消、<code>ValueTask</code>、<code>ExecutionContext</code>），</p>
<h3 data-id="heading-5">为什么它天然适合 async，而 Parallel.For 不行？</h3>
<p>对比一下两者的“调度单位”</p>

















<table><thead><tr><th>API</th><th>调度单位</th></tr></thead><tbody><tr><td>Parallel.For</td><td>线程 + 同步委托</td></tr><tr><td>ForEachAsync</td><td>Task / ValueTask</td></tr></tbody></table>
<p><code>async</code> 的关键特性：</p>
<ul>
<li>
<p><code>await</code> 会 释放线程</p>
</li>
<li>
<p>继续执行靠 <code>Continuation</code></p>
</li>
<li>
<p>不绑定固定线程</p>
</li>
</ul>
<p>所以 <code>ForEachAsync</code>：</p>
<ul>
<li>
<p>不关心“用哪个线程”</p>
</li>
<li>
<p>只关心“同时有多少个未完成任务”</p>
</li>
</ul>
<h3 data-id="heading-6">枚举器访问是串行的</h3>
<blockquote>
<p>数据源的枚举（MoveNext）是串行的</p>
</blockquote>
<p>也就是说：</p>
<pre><code class="hljs language-csharp" lang="csharp">items.GetEnumerator().MoveNext()
</code></pre>
<p>只会在 一个调度上下文 中执行，不会并发访问枚举器。</p>
<p>为什么？</p>
<ul>
<li>
<p><code>IEnumerable&lt;T&gt;</code> 默认 不是线程安全的</p>
</li>
<li>
<p>并发枚举会直接炸</p>
</li>
</ul>
<p>所以 <code>ForEachAsync</code> 的并行点在：</p>
<ul>
<li>
<p><code>Body</code> 执行</p>
</li>
<li>
<p>不是枚举阶段</p>
</li>
</ul>
<h3 data-id="heading-7">异常与取消的调度策略</h3>
<h4 data-id="heading-8">异常模型</h4>
<ul>
<li>
<p>任意一个 <code>Body</code> 抛异常</p>
</li>
<li>
<p>会：</p>
<ul>
<li>
<p>请求取消</p>
</li>
<li>
<p>等待已启动任务结束</p>
</li>
<li>
<p>最终聚合抛出异常</p>
</li>
</ul>
</li>
</ul>
<p>行为类似：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Task.WhenAll(...)
</code></pre>
<h4 data-id="heading-9">CancellationToken 不是“硬中断”</h4>
<p><code>Token</code> 被取消后：</p>
<ul>
<li>
<p>不再启动新任务</p>
</li>
<li>
<p>已启动任务 需要自己响应 <code>ct</code></p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Parallel.ForEachAsync(items, <span class="hljs-keyword">async</span> (item, ct) =&gt;
{
    ct.ThrowIfCancellationRequested();
    <span class="hljs-keyword">await</span> DoAsync(item, ct);
});
</code></pre>
<h3 data-id="heading-10">为什么返回 ValueTask 而不是 Task？</h3>
<p>原因只有一个：性能</p>
<ul>
<li>
<p>Body 很可能：</p>
<ul>
<li>
<p>同步完成</p>
</li>
<li>
<p>快速失败</p>
</li>
</ul>
</li>
<li>
<p><code>ValueTask</code>：</p>
<ul>
<li>
<p>避免不必要的 <code>Task</code> 分配</p>
</li>
<li>
<p>降低 <code>GC</code> 压力</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">和 SemaphoreSlim 手写模型的本质对比</h3>
<p>手写版本</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> sem = <span class="hljs-keyword">new</span> SemaphoreSlim(<span class="hljs-number">5</span>);

<span class="hljs-keyword">var</span> tasks = items.Select(<span class="hljs-keyword">async</span> item =&gt;
{
    <span class="hljs-keyword">await</span> sem.WaitAsync();
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">await</span> ProcessAsync(item);
    }
    <span class="hljs-keyword">finally</span>
    {
        sem.Release();
    }
});

<span class="hljs-keyword">await</span> Task.WhenAll(tasks);
</code></pre>
<p><code>ForEachAsync</code> 内部其实就是：</p>
<ul>
<li>
<p><code>SemaphoreSlim</code> + <code>Task.WhenAny</code></p>
</li>
<li>
<p>加上：</p>
<ul>
<li>
<p>枚举安全</p>
</li>
<li>
<p>异常聚合</p>
</li>
<li>
<p>取消传播</p>
</li>
<li>
<p><code>ExecutionContext</code> 管理</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-12">什么时候不该用 Parallel.ForEachAsync？</h3>
<ul>
<li>
<p>强顺序依赖</p>
</li>
<li>
<p>需要复杂生产者-消费者关系</p>
</li>
<li>
<p>需要背压、缓冲区</p>
</li>
<li>
<p>多阶段流水线</p>
</li>
</ul>
<p>这些场景用：</p>
<ul>
<li>
<p><code>Channel</code></p>
</li>
<li>
<p><code>TPL Dataflow</code></p>
</li>
</ul>
<h3 data-id="heading-13">总结</h3>
<blockquote>
<p>Parallel.ForEachAsync = 一个为 async 设计的、滑动窗口式的并发任务调度器</p>
</blockquote>
<p>它不是魔法，也不是线程并行，而是：</p>
<ul>
<li>
<p>控并发</p>
</li>
<li>
<p>自动补位</p>
</li>
<li>
<p>资源友好</p>
</li>
<li>
<p>工程可控</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（15）Hibernate中如何定义一个实体的主键？]]></title>    <link>https://juejin.cn/post/7589838714450591785</link>    <guid>https://juejin.cn/post/7589838714450591785</guid>    <pubDate>2025-12-31T23:06:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450591785" data-draft-id="7589839433320792127" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（15）Hibernate中如何定义一个实体的主键？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T23:06:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（15）Hibernate中如何定义一个实体的主键？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:06:43.000Z" title="Wed Dec 31 2025 23:06:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Hibernate中，定义实体的主键是非常重要的步骤。主键用于唯一标识数据库表中的每一行记录。我们通常使用注解来定义实体的主键。</p>
<p>以下是一些常见的注解来定义实体的主键：</p>
<ol>
<li><code>@Id</code>：标记字段为实体的主键。</li>
<li><code>@GeneratedValue</code>：指定主键的生成策略。</li>
<li><code>@Column</code>：指定数据库表中列的详细信息。</li>
</ol>
<h3 data-id="heading-0">主键生成策略</h3>
<p><code>@GeneratedValue</code>注解有几种常用的生成策略：</p>
<ol>
<li><strong>AUTO</strong>：默认策略，JPA提供的主键生成方式，依据底层数据库的不同自动选择合适的生成策略。</li>
<li><strong>IDENTITY</strong>：采用数据库的自增长字段，如MySQL的AUTO_INCREMENT。</li>
<li><strong>SEQUENCE</strong>：使用数据库的序列，主要适用于Oracle数据库。</li>
<li><strong>TABLE</strong>：通过一张表来生成主键，该表通常用于模拟序列。</li>
</ol>
<h3 data-id="heading-1">示例代码</h3>
<p>下面是一个完整的示例，通过不同的生成策略来定义实体的主键。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<h5 data-id="heading-5">使用 AUTO 生成策略</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.AUTO)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-6">使用 IDENTITY 生成策略</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-7">使用 SEQUENCE 生成策略</h5>
<p>如果使用SEQUENCE策略，需要在数据库中创建一个序列。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SEQUENCE student_seq <span class="hljs-keyword">START</span> <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span> INCREMENT <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.SequenceGenerator;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "student_seq")</span>
    <span class="hljs-meta">@SequenceGenerator(name = "student_seq", sequenceName = "student_seq", allocationSize = 1)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-8">使用 TABLE 生成策略</h5>
<p>如果使用TABLE策略，需要在数据库中创建一个主键生成表。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> hibernate_sequences (
    sequence_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    sequence_next_val <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">PRIMARY</span> KEY (sequence_name)
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> hibernate_sequences (sequence_name, sequence_next_val) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'student_seq'</span>, <span class="hljs-number">1</span>);
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.TableGenerator;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.TABLE, generator = "student_gen")</span>
    <span class="hljs-meta">@TableGenerator(name = "student_gen", table = "hibernate_sequences", pkColumnName = "sequence_name",
                    valueColumnName = "sequence_next_val", pkColumnValue = "student_seq", allocationSize = 1)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-9">事务管理</h3>
<p>在进行数据库操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 向数据库添加一个对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student);

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-10">总结</h3>
<p>通过以上示例，可以看出Hibernate提供了多种策略来生成实体的主键，包括<code>AUTO</code>、<code>IDENTITY</code>、<code>SEQUENCE</code>和<code>TABLE</code>。不同的策略适用于不同的数据库和场景。理解这些主键生成策略，并在实际项目中正确应用，可以有效地管理数据库表中的主键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（16）什么是Hibernate的乐观锁？]]></title>    <link>https://juejin.cn/post/7589838714450608169</link>    <guid>https://juejin.cn/post/7589838714450608169</guid>    <pubDate>2025-12-31T23:07:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450608169" data-draft-id="7589838742552051731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（16）什么是Hibernate的乐观锁？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T23:07:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（16）什么是Hibernate的乐观锁？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:07:26.000Z" title="Wed Dec 31 2025 23:07:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的乐观锁（Optimistic Locking）是一种并发控制机制，用于防止在多个事务并发访问相同数据时出现数据冲突。乐观锁的基本思想是，每次读取数据时不进行实际的加锁操作，而是在提交更新时检查数据是否已经被其他事务修改。如果数据在此期间被其他事务修改，则当前事务会回滚并重新尝试。</p>
<h3 data-id="heading-0">乐观锁的实现</h3>
<p>乐观锁通常通过版本号（version）字段实现。每次更新数据时，都会检查版本号是否一致，并将版本号加1。</p>
<h3 data-id="heading-1">示例代码</h3>
<p>下面是一个完整的示例，展示如何在Hibernate中使用乐观锁。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;
<span class="hljs-keyword">import</span> javax.persistence.Version;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@Version</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> version;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> version;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setVersion</span><span class="hljs-params">(<span class="hljs-type">int</span> version)</span> {
        <span class="hljs-built_in">this</span>.version = version;
    }
}
</code></pre>
<h3 data-id="heading-5">乐观锁示例代码</h3>
<p>下面的示例展示了如何在并发环境中使用乐观锁。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateOptimisticLockingExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        
        <span class="hljs-comment">// 第一个会话</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session1</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction1</span> <span class="hljs-operator">=</span> session1.beginTransaction();
        
        <span class="hljs-comment">// 第二个会话</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session2</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction2</span> <span class="hljs-operator">=</span> session2.beginTransaction();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 在第一个会话中获取对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> session1.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Session1 - Student: "</span> + student1.getName() + <span class="hljs-string">", Age: "</span> + student1.getAge() + <span class="hljs-string">", Version: "</span> + student1.getVersion());

            <span class="hljs-comment">// 在第二个会话中获取相同的对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> session2.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Session2 - Student: "</span> + student2.getName() + <span class="hljs-string">", Age: "</span> + student2.getAge() + <span class="hljs-string">", Version: "</span> + student2.getVersion());

            <span class="hljs-comment">// 修改并更新对象</span>
            student1.setAge(<span class="hljs-number">21</span>);
            session1.update(student1);
            transaction1.commit();
            System.out.println(<span class="hljs-string">"Session1 - Updated Student: "</span> + student1.getName() + <span class="hljs-string">", Age: "</span> + student1.getAge() + <span class="hljs-string">", Version: "</span> + student1.getVersion());

            <span class="hljs-comment">// 尝试在第二个会话中提交修改</span>
            student2.setAge(<span class="hljs-number">22</span>);
            session2.update(student2);
            transaction2.commit(); <span class="hljs-comment">// 这里会抛出异常，因为版本号不一致</span>

        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction2 != <span class="hljs-literal">null</span>) {
                transaction2.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session1 != <span class="hljs-literal">null</span>) {
                session1.close();
            }
            <span class="hljs-keyword">if</span> (session2 != <span class="hljs-literal">null</span>) {
                session2.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>配置乐观锁</strong>：在实体类中添加一个<code>@Version</code>注解的字段，通常为整数类型。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Version</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> version;
</code></pre>
</li>
<li>
<p><strong>示例场景</strong>：</p>
<ul>
<li>在第一个会话中获取同一个Student对象，修改其属性并提交更新。</li>
<li>在第二个会话中获取同一个Student对象，也修改其属性并试图提交更新。</li>
<li>由于版本号不一致，第二个会话在提交更新时会抛出异常（<code>org.hibernate.StaleObjectStateException</code>）。</li>
</ul>
</li>
<li>
<p><strong>事务管理</strong>：在事务中进行数据操作，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
</li>
</ol>
<h3 data-id="heading-7">总结</h3>
<p>乐观锁是一种有效的并发控制机制，通过版本号字段可以防止多个事务并发修改相同数据时出现数据冲突。在Hibernate中，通过<code>@Version</code>注解可以非常方便地实现乐观锁。理解并正确应用乐观锁，可以有效地提高应用的并发处理能力和数据一致性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025：生活是个缓慢受锤的过程]]></title>    <link>https://juejin.cn/post/7589856408710266895</link>    <guid>https://juejin.cn/post/7589856408710266895</guid>    <pubDate>2025-12-31T17:54:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589856408710266895" data-draft-id="7589870367763071016" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025：生活是个缓慢受锤的过程"/> <meta itemprop="keywords" content="Android,年终总结"/> <meta itemprop="datePublished" content="2025-12-31T17:54:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="芦半山"/> <meta itemprop="url" content="https://juejin.cn/user/149189312913511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025：生活是个缓慢受锤的过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189312913511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    芦半山
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T17:54:56.000Z" title="Wed Dec 31 2025 17:54:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每到岁末，都盼望一场大雪。然而在上海，这种渴求近乎成为一种奢望。</p>
<p>尤记得高三那年的除夕夜，漫天大雪，铺天盖地。我一个人站在楼顶，在明灭的烟火里思考着前路。胸膛里燃烧着一团烈火，仿佛一切严寒和黑暗都无法将其熄灭。如今十几年过去，我开始慢慢读懂王小波在《黄金时代》里的这段话：</p>
<blockquote>
<p>那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。</p>
</blockquote>
<h2 data-id="heading-0">工作</h2>
<p>这把现实的锤，最常落下的地方，便是工作。</p>
<p>有时我会恍惚，这套不断向上的职级体系，是否是学生时代的另一种延伸？只不过当年的分数换成了绩效，排名换成了职级。而最终的结果，往往都是手段变成了目的本身。以至于我们不再追求把事情做对，而是如何让上位者满意。</p>
<p>这种习惯甚至会改变我们的认知。就像水往低处流一样，让上位者满意总是会诱使我们滑向那些更轻松、更显眼的环节。譬如只有可量化、可被看见的东西才值得努力；譬如用一系列行业黑话，去粉饰原本平淡的工作；譬如揣摩领导的喜好，美其名曰向上管理。以至于那些不可量化、不便展示、真正需要长期主义的事情，常常被我们遗忘，譬如对价值的坚守，对审美的追求，对技术的深挖。</p>
<p>这种改变，甚至在某一瞬间滋生出了连我自己都感到害怕的念头。</p>
<p>我的本职工作是负责系统稳定性。但在绩效导向的逻辑下，我脑中竟然闪过这样阴暗的想法：不如拖着让问题暴露得更彻底些？因为只有当问题变得紧急且严重，解决时的可见度才更高，上位者才更容易看见我的价值。</p>
<p>这种念头让我背脊发凉，因为它与我的初心大相径庭。</p>
<p>但身在局中，谁又能完全免俗？在这套评价体系里，我们太容易把情绪交到别人手里。哪怕只是一次微小的负面反馈，都足以在深夜引发一场自我怀疑： 是我不够努力？还是职场能力太差？</p>
<p>直到在一期《圆桌派》上，看到窦文涛问作曲家陈其钢：“怎么能承认你是最牛的呢？”陈其钢淡淡回应：“不需要你承认。只有有这种胆量的人，才能最终获得他应有的生命力。如果是你的标准来做我的事，那我没有灵魂的。”</p>
<p>这句话如春上惊雷点醒了我。从小到大，我们习惯于活在分数和排名的坐标系中，以至于忘了坐标系本身是可以由自己定义的。</p>
<p>于是今年我试着做出一个改变：<strong>将评价权收归主体，做自己认为正确的事情，淡化他人的评价。</strong></p>
<p>我相信每个人内心深处都有自己笃定的价值锚点，自信，不应该来自他人的夸赞，而应来自内心对“做成了某件事”的诚实认可。同理，改进，不应该变成对外界评价的归顺，而应该是面对事实的一种反思。这不是拒绝外界反馈，而是学会区分：哪些是基于事实的理性矫正，哪些是基于立场的偏见与噪音。</p>
<p>另外，这一年我还有个很深的体悟：<strong>言语是对行动的拖累。</strong></p>
<p>那些困难或者重要的工作，一旦在未完成前就向人夸夸其谈，往往会无疾而终。</p>
<p>好比我曾跟几位好友信誓旦旦地说，要把ART里的GC机制全面梳理写成文章。源码看了好几遍，牛皮也吹出去了，结果却是迟迟未动笔。究其原因，似乎是那种提前预支的成就感在作祟。仿佛在向别人炫耀计划的那一刻，心理上就已经完成了这件事，原本用于攻坚的动力便随之泄了气。</p>
<p>古人云：事以秘成。如今想来，这不仅是怕别人惦记，也是为了保持成事前的那股劲头。</p>
<p>回想刚工作那会儿，正值《得到》等知识付费产品上线。我每天沉迷于学习各种课程，沉溺在一种虚假的“有文化”的幻觉中。于是生活中也变得夸夸其谈，好为人师。但我心里清楚，那些脱口而出的金句，不过是对他人观点的拙劣复述，并无半点真知灼见。这种飘飘然，反而成了我成长道路上的阻碍。</p>
<p>明代吕坤在《呻吟语》中曾将人的资质分为三等：深沉厚重，是第一等资质；磊落豪雄，是第二等资质；聪明才辨，是第三等资质。</p>
<p>这句话后来成了曾国藩的识人用人之道，如今也成了我的一面镜子。年轻时，我们总以为聪明才辨是绝世珍宝，后来才懂得，深沉厚重最为难得。</p>
<h2 data-id="heading-1">AI</h2>
<p>AI，是今年一个无论如何也逃不掉的话题。市面上的夸赞声、质疑声、嘲讽声已经够多，我想没必要再表达情绪性的观点了。</p>
<p>对于AI的态度我只有三句话：<strong>保持谦卑，躬身入局，放下立场。</strong></p>
<p><strong>保持谦卑，是因为我曾经吃过傲慢的亏。</strong>“你看，我说过这玩意不行吧？”，“还不都是泡沫”，几年前我对AI的态度就是这样，事实上我既没深入学习过AI，也没深入使用过AI。</p>
<p>而我之所以敢如此傲慢，是因为世界运行有个基本的法则：失败乃常态。因此，做一个悲观的看衰者在统计学上永远是占优的。但这种“正确”毫无意义，除了滋养虚妄的优越感，只会让自己固步自封。</p>
<p><strong>破除偏见最好的方式就是躬身入局</strong>。这绝不是随便找两个模型、问几个无关痛痒的问题那么简单。真正的入局，是愿意为最先进的生产力付费，是将它们无缝嵌入到自己的工作流中，日复一日地磨合。在这个过程中，你会经历一种复杂的情绪：既会称赞它的无所不知，也会恼怒它的胡说八道；既会惊叹它的灵光乍现，也会抱怨它的反复横跳。</p>
<p>如今，我大半的时间都在与AI交互。写代码、查BUG、学新知。它最大的价值，在于极大地延展了我的知识半径。</p>
<p>举个例子，前段时间遇到一个用户层的SIGBUS错误，在AI的辅助下，我硬是将其根因追溯到了Hypervisor层，这在以前几乎是不可能的。但这并非因为AI能直接给出答案，而是它改变了我分析问题的路径。</p>
<p>当一个复杂问题出现时，我不再急于直接分析，而是先利用AI快速补齐整个错误路径上的所有知识盲区。譬如分析SIGBUS，我会先让AI帮我把虚拟地址到物理地址的映射过程整体梳理一遍。一旦知道了所有中间环节，定位问题便如同开了天眼，如鱼得水。</p>
<p>当然，我时刻警惕着它的幻觉。AI由于训练数据的滞后，对新机制的理解不够精准，所以我制定了一个原则：AI负责广度，我负责精度。 对于关键逻辑的推导，我一定会亲自阅读源码进行双重校验。因此对我而言，AI更像是一位博学但偶尔马虎的伙伴，我会参考它的思路，但会亲自掌舵，甚至在它跑偏时，用我的分析去纠正它。</p>
<p>这也让我看清了AI与高阶工程师的本质区别。</p>
<p>AI分析问题，很像是一个勤奋的初中级工程师。它擅长关联和归类。每当看到一个新问题，便习惯性地往之前的经验库里套。这背后是概率统计，而非严密的逻辑推理。</p>
<p>而真正的资深老手，核心能力在于逻辑闭环。他们不轻信表面的相似，而是把中间每一环的逻辑推导落实到位。哪怕是细微的表象差异，也可能指向完全不同的根因。</p>
<p>当然，<strong>相比于学习新工具，更难的或许是克服心魔</strong>，这也是我想说的最后一点：放下立场。</p>
<p>事物的诞生总是充满兴奋和焦虑，大家都在比拼速度、圈定领地，生怕自己落后。而面对AI时，这种焦虑又增加一层：害怕自己被取代。事实上，AI的进化速度确实超过预期，以至于很多程序员从最开始的嗤之以鼻，到现在的瑟瑟发抖。</p>
<p>但我时刻提醒自己：千万不要陷入“如何保住饭碗”的防御性思考。</p>
<p>因为这本质上是“屁股决定脑袋”的立场偏见，而非理性的趋势判断。试想，如果AI真的能完成90%的业务代码，那现有程序员的价值一定被大幅削弱。此时再去论证“程序员有什么特殊性是AI无法取代的”，近乎于缘木求鱼。万一趋势就是这个工种的整体消亡或大幅缩减呢？覆巢之下，焉有完卵。</p>
<p>所以真正的解法是跳出“程序员”三个字，去理解商业的底层逻辑。你的工作之所以存在，不是因为你会写代码，而是因为你是商业链条中解决问题的一环。代码只是工具，解决问题、交付价值才是目的。</p>
<p>如今AI的到来，彻底重构了人们获取信息、形成决策、输出生产力的方式。这势必会摧毁大量旧的业态，但也必然会催生出大量新的机会。</p>
<p>因此，与其在旧的工种里带着立场去抵触，不如抬起头来，多关注产业动向，去理解新的商业闭环是如何构建的。在这个剧烈变化的时代，或许只有跳出写代码的执念，才能在新的生态位中，找到职业生涯的第二春。</p>
<h2 data-id="heading-2">生活</h2>
<p>我在一家公司已经八年了，这种惯性足以把生活磨平，以至于想不起昨天和今天有什么不同。</p>
<p>平淡当然不是坏事。看着孩子一天天长大，我常常觉得这种平淡甚至值得珍惜。它意味着一家人都好好的，没有过多的波折和风浪。可是内心总有一些微弱的悸动，想要突破和改变。或许这就是许多人生活趋于稳定后的通病：一边渴望安稳，一边又害怕被安稳悄无声息地驯化。</p>
<p>今年书读的很少，运动也少。我一直觉得，读书和运动是性价比极高的生活方式，花不了几个钱，回报却颇为丰厚，只不过需要耐得住性子和克服得了懒惰。所以门槛不在于经济条件，而在于个人意志。</p>
<p>零散的时间基本都用来刷抖音。抖音还是要少刷。短视频说到底是标签化和情绪化的产物，里面的很多观点要么是刻意迎合情绪，要么背后有推手推波助澜，看似吸引眼球，实则养分不多。更重要的是，它会悄悄改变人的耐心，让专注和沉思的能力逐渐变弱。</p>
<p>新的一年，希望多读一些好书，历史的，文学的。安排一些日常的运动项目，比如游泳就是不错的选择。多计划几次出游，看看不同的山河。尝试一些新的技能，让自己对新鲜事物保持好奇。</p>
<p>写到这里，窗外夜色已深。</p>
<p>2026，愿那团曾在风雪中燃烧的烈火，依旧可以照亮今日的长夜。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的AI八股网站在2026年第一天上线啦！]]></title>    <link>https://juejin.cn/post/7589838714450624553</link>    <guid>https://juejin.cn/post/7589838714450624553</guid>    <pubDate>2025-12-31T23:42:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450624553" data-draft-id="7589530529452687369" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的AI八股网站在2026年第一天上线啦！"/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2025-12-31T23:42:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的AI八股网站在2026年第一天上线啦！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T23:42:01.000Z" title="Wed Dec 31 2025 23:42:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天是2026年的第一天，大家新年好呀~</p>
<p>新年新气象，我也要带给大家一些新的东西。</p>
<h2 data-id="heading-0">1.前言</h2>
<p>过去这一年，AI 的发展可以说是<strong>肉眼可见地加速</strong>。大模型从概念验证走向产业落地，从实验室走向真实世界，甚至开始重塑整个技术生态。</p>
<p>AI如日中天，全球大模型第一股的竞速，也传来智谱靴子落地的声响。 这不仅是资本市场的一个重要节点，更是一个<strong>明确的信号</strong>：<strong>AI，已经不再是未来趋势，而是正在发生的现实。</strong></p>
<p>与此同时，各大厂也纷纷下场抢人。从算法、平台到应用层，岗位需求持续扩大，越来越多的同学开始把目光投向 AI 方向的系统学习，希望能在这个时代浪潮中找到自己的位置。</p>
<p>这段时间，我也明显感受到关注我文章的同学越来越多了。</p>
<p>但随之而来的，是一个很真实的反馈：</p>
<p>“文章很好，但有点零散”<br/>
“能不能有一个体系化的地方，方便查、方便学？”</p>
<p>以前，大家更多是从我的文章里<strong>被动接收</strong>某一个知识点，但真正的学习，尤其是 AI 这种高度体系化的领域，<strong>一定需要一个完整、可持续、可反复回看的知识结构。</strong></p>
<p>而同学们的需要，恰恰就是我持续输出的最大动力。</p>
<p>其实，<strong>四个月前</strong>，我就已经有了搭建自己网站的想法，但真正做起来，才发现这远远不只是搭个网站那么简单。</p>
<p>在这四个月里，我做了几件事：</p>
<ul>
<li>从零搭建网站架构</li>
<li>反复推翻、重构整体知识框架</li>
<li>一篇一篇地打磨内容逻辑和表达方式</li>
</ul>
<p>有很多个夜晚，都是在<strong>十二点之后</strong>，敲完最后一行文档，点下保存，才松一口气，关掉电脑。</p>
<p>也正是这样，一点点积累下来，我终于把这个网站<a href="https://link.juejin.cn?target=https%3A%2F%2Faicoting.cn" target="_blank" title="https://aicoting.cn" ref="nofollow noopener noreferrer">aicoting|AI算法面试学习</a>完整地呈现在了大家面前。</p>
<h2 data-id="heading-1">2.网站里有什么？</h2>
<p>它不是炫技型内容，而是一个<strong>真正能陪你从入门走到进阶，走到实战的知识库</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c18c089b4c264708a094ad52c23228a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=FDJlVx783G%2F1UU82tzDwYHSnk5M%3D" alt="" loading="lazy"/></p>
<p>其中包含了从开发语言Python教程，机器学习，深度学习，AI&amp;大模型全套知识文档，建议新手小白依次食用，当然，大佬们可以按需查看，其中每一个部分都倾注了我相当多的心血，下面我简单介绍一下各个部分。</p>
<h3 data-id="heading-2">2.1 python</h3>
<p>首先是Python部分， Python，是 AI 的基础。可以毫不夸张地说，<strong>AI 领域 90% 以上的代码，都是用 Python 写的</strong>，如果不掌握 Python，AI 这张入场券，基本是拿不到的。</p>
<p>因此，在 Python 部分，我把内容拆成了三块：</p>
<ul>
<li><strong>基础篇</strong>：语法、数据结构、流程控制</li>
<li><strong>进阶篇</strong>：语言特性、底层机制、工程思维</li>
<li><strong>生态篇</strong>：正式走向 AI，开始接触 NumPy、Pandas、可视化等工具</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/923f2c28e7204d63b6d25e3cb947bc42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=7rGVKixsTgxaijcfHmhUk4NbRIE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6907a06f318845b0b5b81b165af74571~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=BCjTC%2FgXP2sFHA5W4R99HWETYG4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 机器学习</h3>
<p>其次是机器学习，机器学习讲解的相当全面，从数理基础开始，到特征工程、再到各种经典机器学习方法，以及强化学习等内容，全部系统覆盖。</p>
<p>而且这里有一个我一直坚持的原则：<strong>不只讲概念，一定要落到实践。</strong></p>
<p>所以你看到的不是一堆抽象定义，而是：</p>
<ul>
<li>图文并茂的讲解</li>
<li>理论与代码一一对应</li>
<li>每一个示例都有真实实验结果</li>
</ul>
<p>更重要的是<strong>所有代码，全部在 GitHub 开源，</strong> 你可以直接跑、直接改、直接用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e152a63343be421c9b7e871aeddbd445~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=SHs88o73sIkTARCmoaQgdl8RBNY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/241d1f95f69a4723b98972b3c124c638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=wDYHA847x8fss3fMnKbapFt5xgI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.3 深度学习</h3>
<p>在掌握了机器学习之后，就可以正式进入深度学习的世界了。</p>
<p>这一部分，我从最基础的神经网络讲起，一步步拆解各种<strong>经典网络结构和设计思想</strong>。</p>
<p>包括但不限于CNN 系列、ResNet、LSTM、Transformer以及它们背后的演化逻辑，不是简单背模型，而是帮助你真正理解<strong>为什么要这么设计？解决了什么问题？</strong></p>
<p>可以说，这一部分是很多同学实现质变的关键。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c036e78927914e78a793b5c1144c1f1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=H4tINkDAjDs55gEUt3S0S4LkxKo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/038b390b43db4da5b9b73eb471658b44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=KT%2FwEQdLcsAOgz%2Bo875fKy%2BjQvA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">2.4 AI&amp;大模型</h3>
<p>掌握了机器学习和深度学习的所有内容之后，你就可以开始阅读AI&amp;大模型中的内容了，也就是当今如日中天的大模型，从大模型架构、大模型训练到大模型微调、部署、评估，再到落地应用RAG，Agent等等，AI&amp;大模型是我花费心血最多的一部分内容，绝对干货满满！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84fcfdb9f806434a820bda2f19af5e9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=XkLa%2BM1l78ynikbg4o9OoJOgmzc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58a7c179b6cc4f8da4a95cde95abe53f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=oZytzVWlmaI18vdWWUU%2BUQNm0gU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2.5 面试八股</h3>
<p>最后，我还为准备面试的同学们准备了算法面试八股，后续会持续更新！帮助大家在关键时刻，<strong>少踩坑，多拿 offer！</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a2efc61228a474ca6c4a824c5fbe9e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=w%2FWgoAd7puMFLoNM8naIFNIICx8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e1ddbcd03f547de9a424296bcfa587d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767829320&amp;x-signature=F7r%2Fg4SFJhZ276GdzgAcBQ%2B%2FQwY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">3.结语</h2>
<p>新的一年，我希望这个网站，能成为你学习 AI 路上的一个可靠伙伴。</p>
<p>不焦虑、不浮躁，一步一步，把基础打牢，把方向走稳。</p>
<p><strong>2026 年，我们一起努力，一起进步！</strong></p>
<p>更多实时更新内容请关注公众号<strong>aicoting</strong>哦！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《5-Day AI Agents Intensive》- 认识 Agents]]></title>    <link>https://juejin.cn/post/7589835342146011146</link>    <guid>https://juejin.cn/post/7589835342146011146</guid>    <pubDate>2025-12-31T17:07:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589835342146011146" data-draft-id="7589897523268370442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《5-Day AI Agents Intensive》- 认识 Agents "/> <meta itemprop="keywords" content="AI编程,Trae,Agent"/> <meta itemprop="datePublished" content="2025-12-31T17:07:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="去码头整点薯片"/> <meta itemprop="url" content="https://juejin.cn/user/3104676568631917"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《5-Day AI Agents Intensive》- 认识 Agents 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3104676568631917/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    去码头整点薯片
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T17:07:49.000Z" title="Wed Dec 31 2025 17:07:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>基于 Google X × Kaggle《AI Agents Intensive》Day 1 白皮书</p>
</blockquote>
<h2 data-id="heading-0"><strong>一、从“被动 AI”到“自主 AI Agent”的转变</strong></h2>
<p>传统 AI 系统主要以<strong>被动响应</strong>为主：</p>
<ul>
<li>回答问题</li>
<li>翻译文本</li>
<li>基于单一 prompt 生成内容</li>
</ul>
<p>这类系统的特点是：</p>
<p><strong>输入 → 推理 → 输出</strong>，流程线性，几乎不具备持续行动能力。</p>
<p>而白皮书提出的核心转变在于：</p>
<blockquote>
<p>AI 正从“对话式工具”演进为<strong>自主、目标导向的智能体（Agent）</strong> 。</p>
</blockquote>
<p>AI Agent 的关键特征包括：</p>
<ul>
<li>拥有明确目标（goal-oriented）</li>
<li>能进行多步规划</li>
<li>能调用工具执行真实动作</li>
<li>能根据执行结果持续调整策略</li>
<li>在较少人工干预下完成复杂任务</li>
</ul>
<hr/>
<h2 data-id="heading-1"><strong>二、AI Agent 的三大核心组成</strong></h2>
<p>白皮书将 Agent 的基本结构拆分为三个部分：</p>
<h3 data-id="heading-2"><strong>1. Model（模型）：Agent 的“思考中枢”</strong></h3>
<p>模型通常是一个 LLM，但在 Agent 架构中，它的职责并不只是“生成文本”。</p>
<p>其核心作用是：</p>
<ul>
<li>作为推理引擎（reasoning engine）</li>
<li>动态管理上下文（context window）</li>
<li>决定当前阶段哪些信息是“重要的”</li>
</ul>
<p>模型需要在以下信息中做取舍与编排：</p>
<ul>
<li>当前任务目标</li>
<li>历史行动与观察结果</li>
<li>来自工具的返回数据</li>
<li>长期或短期记忆内容</li>
</ul>
<p><strong>模型并不直接执行动作，只负责决策与判断。</strong></p>
<hr/>
<h3 data-id="heading-3"><strong>2. Tools（工具）：Agent 的“行动能力”</strong></h3>
<p>工具是 Agent 与外部世界或内部系统交互的方式，例如：</p>
<ul>
<li>外部 API（搜索、地图、支付、物流等）</li>
<li>内部业务系统（CRM、订单系统）</li>
<li>数据库 / 向量库</li>
<li>可执行代码环境（如受控的 Python Sandbox）</li>
</ul>
<p>关键点在于：</p>
<ul>
<li><strong>模型负责决定“用哪个工具”</strong></li>
<li><strong>编排层负责真正调用工具</strong></li>
<li>工具返回的结果（Observation）会重新进入模型上下文</li>
</ul>
<hr/>
<h3 data-id="heading-4"><strong>3. Orchestration Layer（编排层）：Agent 的“控制中枢”</strong></h3>
<p>编排层不是简单的流程控制器，而是 Agent 的治理核心，主要职责包括：</p>
<ul>
<li>管理 <strong>思考 → 行动 → 观察</strong> 的运行循环</li>
<li>执行推理策略（如 Chain-of-Thought、ReAct）</li>
<li>维护 Agent 的运行状态与记忆</li>
<li>定义 Agent 的角色、规则和约束</li>
</ul>
<p>可以将其理解为：</p>
<blockquote>
<p><strong>模型负责“想什么”，工具负责“做什么”，编排层负责“什么时候做、怎么串起来”。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-5"><strong>三、Agent 的核心运行机制：Think – Act – Observe 循环</strong></h2>
<p>白皮书强调，Agent 的本质是一个持续运行的循环，而非一次性推理。</p>
<h3 data-id="heading-6"><strong>标准运行流程示例：组织团队出行</strong></h3>
<ol start="0">
<li>
<p><strong>接收任务（Mission）</strong></p>
<ul>
<li>明确目标：组织团队旅行</li>
</ul>
</li>
<li>
<p><strong>环境扫描（Scan）</strong></p>
<ul>
<li>可用工具：日历、预订系统</li>
<li>当前上下文与已有信息</li>
</ul>
</li>
<li>
<p><strong>规划（Think）</strong></p>
<ul>
<li>判断下一步行动</li>
<li>例如：先获取团队成员名单</li>
</ul>
</li>
<li>
<p><strong>执行（Act）</strong></p>
<ul>
<li>编排层调用对应工具（如 get_team_roster）</li>
</ul>
</li>
<li>
<p><strong>观察（Observe）</strong></p>
<ul>
<li>工具返回结果</li>
<li>将结果写入上下文</li>
</ul>
</li>
<li>
<p><strong>循环迭代</strong></p>
<ul>
<li>基于新信息重新规划</li>
<li>直到任务完成</li>
</ul>
</li>
</ol>
<p>这一机制同样适用于：</p>
<ul>
<li>客服问题处理</li>
<li>订单查询</li>
<li>多步骤业务流程</li>
</ul>
<hr/>
<h2 data-id="heading-7"><strong>四、Agent 能力分级（Agent Capability Taxonomy）</strong></h2>
<p>为了帮助工程实践中的系统设计，白皮书提出了 Agent 能力的分级模型。</p>
<h3 data-id="heading-8"><strong>Level 0：纯语言模型</strong></h3>
<ul>
<li>无工具</li>
<li>仅依赖训练数据</li>
<li>无法获取实时信息</li>
</ul>
<h3 data-id="heading-9"><strong>Level 1：连接型问题解决者</strong></h3>
<ul>
<li>具备工具调用能力</li>
<li>能访问实时数据</li>
<li>可完成单步或简单多步任务</li>
</ul>
<hr/>
<h3 data-id="heading-10"><strong>Level 2：战略型问题解决者（Context Engineering）</strong></h3>
<p>核心能力是：<strong>上下文工程（Context Engineering）</strong></p>
<p>典型特征：</p>
<ul>
<li>能将上一步输出转化为下一步更精确的输入</li>
<li>主动减少噪声，提高检索与决策质量</li>
</ul>
<p>示例：</p>
<ul>
<li>先计算两个地址的中点</li>
<li>再基于精确坐标搜索高评分咖啡店</li>
</ul>
<hr/>
<h3 data-id="heading-11"><strong>Level 3：多 Agent 协作系统</strong></h3>
<p>特点：</p>
<ul>
<li>Agent 可以把其他 Agent 当作工具</li>
<li>支持目标级别的任务委派</li>
<li>子 Agent 具备自主规划能力</li>
</ul>
<p>例如：</p>
<ul>
<li>项目管理 Agent</li>
<li>市场研究 Agent</li>
<li>数据分析 Agent</li>
</ul>
<p>这不再是函数调用，而是 <strong>Agent-to-Agent 的目标委托</strong>。</p>
<hr/>
<h3 data-id="heading-12"><strong>Level 4：自我进化系统</strong></h3>
<p>前沿形态，具备：</p>
<ul>
<li>自我能力评估</li>
<li>发现能力缺口</li>
<li>动态创建新 Agent 或工具</li>
</ul>
<p>例如：</p>
<ul>
<li>自动创建情感分析 Agent</li>
<li>自动配置权限与能力边界</li>
</ul>
<hr/>
<h2 data-id="heading-13"><strong>五、生产环境中的关键工程问题（AgentOps）</strong></h2>
<h3 data-id="heading-14"><strong>1. 模型选择与模型路由</strong></h3>
<ul>
<li>不追求单一“最强模型”</li>
<li>根据任务复杂度进行模型路由</li>
<li>平衡性能、成本与稳定性</li>
</ul>
<hr/>
<h3 data-id="heading-15"><strong>2. 工具设计与 Function Calling</strong></h3>
<p>工具必须具备：</p>
<ul>
<li>清晰的功能描述</li>
<li>明确的参数规范</li>
<li>结构化返回格式</li>
</ul>
<p>这通常以 OpenAPI / Function Calling 的形式实现，确保模型能正确调用与解析结果。</p>
<hr/>
<h3 data-id="heading-16"><strong>3. 记忆系统设计</strong></h3>
<ul>
<li><strong>短期记忆</strong>：当前任务的行动-观察序列</li>
<li><strong>长期记忆</strong>：跨会话的偏好、经验、知识</li>
</ul>
<p>工程上通常以 RAG + 向量数据库的形式实现。</p>
<hr/>
<h2 data-id="heading-17"><strong>六、测试、调试与可观测性</strong></h2>
<h3 data-id="heading-18"><strong>1. 评估方式的变化</strong></h3>
<ul>
<li>无法使用传统的“输入-输出断言”</li>
<li>更关注输出质量与约束遵守情况</li>
<li>常见方法：LLM-as-a-Judge</li>
</ul>
<hr/>
<h3 data-id="heading-19"><strong>2. 调试的核心：可观测性（Observability）</strong></h3>
<p>白皮书明确指出：</p>
<blockquote>
<p><strong>OpenTelemetry Trace 是调试 Agent 的关键工具</strong></p>
</blockquote>
<p>Trace 可以完整记录：</p>
<ul>
<li>每一步 prompt</li>
<li>推理过程</li>
<li>工具选择与参数</li>
<li>工具返回结果</li>
<li>整体执行轨迹</li>
</ul>
<p>这相当于 Agent 的“飞行记录仪”。</p>
<hr/>
<h3 data-id="heading-20"><strong>3. 用户反馈闭环</strong>（很重要 黄金数据集）</h3>
<ul>
<li>用户问题 → 复现 → 转化为测试用例</li>
<li>不断扩充 golden dataset</li>
<li>防止同类问题再次发生</li>
</ul>
<hr/>
<h2 data-id="heading-21"><strong>七、安全、权限与治理</strong></h2>
<h3 data-id="heading-22"><strong>1. Defense in Depth（纵深防御）</strong></h3>
<ul>
<li>规则引擎（硬约束）</li>
<li>AI Guard Models（软约束，用 ai 约束 ai）</li>
</ul>
<hr/>
<h3 data-id="heading-23"><strong>2. Agent 身份与最小权限原则</strong></h3>
<ul>
<li>Agent 是系统中的独立主体</li>
<li>拥有独立身份与权限</li>
<li>权限精细化控制，防止越权访问</li>
</ul>
<hr/>
<h3 data-id="heading-24"><strong>3. Agent 治理与控制平面</strong></h3>
<ul>
<li>所有通信经由统一网关</li>
<li>集中策略控制</li>
<li>统一监控日志、指标与 Trace</li>
</ul>
<hr/>
<h2 data-id="heading-25"><strong>八、学习与演化机制</strong></h2>
<p>Agent 的持续改进来源于：</p>
<ul>
<li>运行日志与 Trace</li>
<li>用户反馈</li>
<li>外部规则或环境变化</li>
</ul>
<p>进阶实践包括：</p>
<ul>
<li>Agent Simulation / Agent Gym</li>
<li>使用合成数据与安全环境进行压力测试</li>
</ul>
<hr/>
<h2 data-id="heading-26"><strong>九、典型系统示例</strong></h2>
<h3 data-id="heading-27"><strong>Google Co-Scientist</strong></h3>
<ul>
<li>多 Agent 科研协作系统</li>
<li>任务分解、假设生成、实验设计</li>
<li>接近 Level 3 / Level 4</li>
</ul>
<h3 data-id="heading-28"><strong>AlphaEvolve</strong></h3>
<ul>
<li>算法生成与优化系统</li>
<li>AI + 自动演化机制</li>
<li>人类定义评估标准与约束</li>
</ul>
<hr/>
<h2 data-id="heading-29"><strong>十、总结</strong></h2>
<p>白皮书的核心结论是：</p>
<blockquote>
<p><strong>成功的 AI Agent 系统不是模型驱动的，而是工程驱动的。</strong></p>
</blockquote>
<p>Agent 的价值来自于：</p>
<ul>
<li>模型（推理）</li>
<li>工具（行动）</li>
<li>编排层（控制）</li>
<li>治理、安全、可观测性</li>
</ul>
<p>开发者的角色也正在变化：</p>
<blockquote>
<p>从“写代码的人”，转向“设计和治理智能系统的架构师”。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年12月总结]]></title>    <link>https://juejin.cn/post/7589839433320726591</link>    <guid>https://juejin.cn/post/7589839433320726591</guid>    <pubDate>2025-12-31T17:15:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839433320726591" data-draft-id="7589903499598757942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年12月总结"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-31T17:15:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="袁庭新"/> <meta itemprop="url" content="https://juejin.cn/user/1207714136735408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年12月总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1207714136735408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    袁庭新
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T17:15:37.000Z" title="Wed Dec 31 2025 17:15:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是袁庭新。2025年的最后一个月已经圆满结束，借此机会对本月的工作进行一次总结与回顾。</p>
<h2 data-id="heading-0">课程研发</h2>
<p>一直想讲一门如何赚钱的课，这就是《微信商业生态平民创业》这门课设计的初衷，这个月编写了2节这门课的讲义，但还未完成录制，现总计录制了20节，计划是24节课程。</p>
<p>放在以前软件开发和我们绝大多数人是没有关系，随着大模型基础服务平台的崛起，你可能无法想象现在不懂任何编程技术零基础也可快速上手定制开发出自己的智能体应用出来，并上线到各大平台，如微信小程序、豆包等。</p>
<p>这个月我也集中注意力开发了7个实用的智能体，无须编程，完全采用可视化的设计方式，快速搭建的AI Agent。</p>
<ul>
<li>批判性思维训练智能体设计开发实战</li>
<li>文档整理AI智能体设计开发实战</li>
<li>高等数学助手AI智能体设计开发实战</li>
<li>简历优化大师AI智能体设计开发实战</li>
<li>专业模拟面试官AI智能体设计开发实战</li>
<li>职业咨询顾问AI智能体设计开发实战</li>
<li>面试准备助手 AI智能体设计开发实战</li>
</ul>
<p>这个7个智能体的讲义已经编写完成，图文并茂，边学边练，计划在2026年1月份开始录制成课程。</p>
<h2 data-id="heading-1">文章输出</h2>
<p>12月，累计发布原创文章3篇，并同步分享至公众号、稀土掘金、CSDN、知乎、简书和B站等多个平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b13684fcf14a49098747ca0a226ad461~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=GS39KaK58mApxwfBVceH0ip7KN8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">讲座授课</h2>
<p>12月，我先后赴兰州工商学院和西安工程大学开展线下报告，与两校学生进行了面对面的深度交流，累计覆盖270人次。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ffd5edee1448c28d65233f3ea2003b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=5OOLLWflMwenJElYhr2uLh9V8Wo%3D" alt="" loading="lazy"/></p>
<p>这是同学们在现场学习的照片，看得出来大家对AI的学习热情非常高！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10ffa4c19e94423988fde6c13fa0b85c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=DVh9PaoaTJqRPZyPCddvOTrzee8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">运营店铺</h2>
<p>12月份，我投入了大量时间在淘宝店铺、小鹅通和B站课堂的运营工作上，包括课程创建、海报设计以及内容上架与发布等。</p>
<p>下图是淘宝店铺后台管理系统：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa5318850b924149a2f1d38a85d61b42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=hSEqBUc2bCi2qeeTh7IOFryIU4E%3D" alt="" loading="lazy"/></p>
<p>下图是小鹅通店铺H5展示样式：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beca9de9918e4b2fa623772b426264e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=QEICeolkZ6DCfTT6Cqv0MStXcVA%3D" alt="" loading="lazy"/></p>
<p>下图是B站小店上架的产品：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9544f347cb21449e9f9972a5bcc63581~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=EN1wcqD%2BobYWlDi1GXf9wyYqVyE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">物料研发</h2>
<p>这个月，我在市场支持物料的研发上投入了不少精力，主要围绕三类核心宣传素材展开：一是课程推广海报的设计，用于清晰传达课程亮点与价值；二是项目合伙人招募海报的创意与制作，旨在吸引志同道合的合作伙伴；三是证书宣传海报的策划与输出，用以增强学员的学习获得感和项目的权威感。</p>
<p>现在回想上学那会儿，就他妈跟个傻逼似的，只知道上课、刷题、考试。如果能重新来过，一定会探索如何创业或参与到创业团队。可人生就是这样子，总是伴随着遗憾！</p>
<p>大家来看看我做的这张长图海报，觉得怎么样？欢迎提提意见！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3c5e1aae522405a8b6a39696cb91d0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=jJDaBYA3hWRb3YbgbjLDnn78Ka8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">知识星球</h2>
<p>12月份，在「人人都要学AI」知识星球中，我共发布了3篇主题内容。同时对星球的海报做了设计，并已在星球亮点中推上线了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c2ee45c5bd34a569f6e7c22f8ee0742~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=Qj5K0IkMjSjfNEIxFoBY4%2ByGPNY%3D" alt="" loading="lazy"/></p>
<p>如果有需要，你可以通过以下方式进入星球～</p>
<h2 data-id="heading-6">组织考试</h2>
<p>兰州工商学院百名同学齐学AI，并选择考取人工智能技术证书。他们用行动诠释“未来已来，我已就位”🚀</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10dd7102ceb045e7a6419ebbbf613153~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=7Kw9idh1MuKhwqHK4qtEcXbFhJM%3D" alt="" loading="lazy"/></p>
<p>见证百位兰州工商学院同学的蜕变✨</p>
<p>不只“卷”商业知识，更跨界“卷”起了AI技术，纷纷考取AI职业技术证书💡</p>
<p>未来的商业领袖，不仅要懂管理，更要懂科技！为你们的远见和行动力点赞👏</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9222dc8d6f4466cac95d514f1b7144a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KKB5bqt5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767806136&amp;x-signature=NfbpWmR4f%2F%2BpI5umLsjPvMUnrWE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">新成员加入</h2>
<p>有个好消息想和大家分享：这个月，我们团队迎来了一位新伙伴！不仅年轻帅气，而且业务能力非常扎实，充满干劲。2026年已经开启，新的一年里，我们将并肩同行、携手探索，在彼此支持中不断成长，一起奔赴更加美好的明天！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[设计模式和设计原则-中高级架构思路-面向接口编程]]></title>    <link>https://juejin.cn/post/7589838742551986195</link>    <guid>https://juejin.cn/post/7589838742551986195</guid>    <pubDate>2025-12-31T17:03:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838742551986195" data-draft-id="7589903499598725174" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="设计模式和设计原则-中高级架构思路-面向接口编程"/> <meta itemprop="keywords" content="设计模式"/> <meta itemprop="datePublished" content="2025-12-31T17:03:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自由生长2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            设计模式和设计原则-中高级架构思路-面向接口编程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自由生长2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T17:03:55.000Z" title="Wed Dec 31 2025 17:03:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>历史文章参见</p>
<p><a href="https://juejin.cn/post/7588104741610717194" target="_blank" title="https://juejin.cn/post/7588104741610717194">设计模式-23种设计模式的说法-掘金</a></p>
<p><a href="https://juejin.cn/post/7542907839314133030" title="https://juejin.cn/post/7542907839314133030" target="_blank">每日知识-设计模式-状态机模式-掘金</a></p>
<p><a href="https://juejin.cn/post/7545489121936670770" title="https://juejin.cn/post/7545489121936670770" target="_blank">每日知识-设计模式-观察者模式 - 掘金</a></p>
<p><a href="https://juejin.cn/post/7080911756247171079" title="https://juejin.cn/post/7080911756247171079" target="_blank">cpp笔记第3篇-C++多线程单例模式单例模式 - 掘金</a></p>
<hr/>
<p>今天讲讲面向接口编程的核心思想，它可以看到各种设计模式的一种杂糅。</p>
<h3 data-id="heading-0">面向接口编程的核心思想</h3>
<p>以实际的代码举例子，我最近在写一个安卓的笔记程序，使用到了面向接口的编程方法，下面我以具体的类举例来说明面向接口编程的思想，以及后文解释，面向接口编程可以体现哪些设计模式。</p>
<h4 data-id="heading-1">一、依赖接口，而不是具体实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 面向具体类（耦合）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoteListManager</span> {
    <span class="hljs-keyword">private</span> MainActivity activity; <span class="hljs-comment">// 直接依赖 MainActivity</span>
}

<span class="hljs-comment">// ✅ 面向接口（解耦）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoteListManager</span> {
    <span class="hljs-keyword">private</span> INoteListCallback callback; <span class="hljs-comment">// 依赖接口</span>
    <span class="hljs-comment">// 优势：只要接口不变，实现类怎么变都行</span>
}
</code></pre>
<h4 data-id="heading-2">二、在这个场景中的体现</h4>
<h5 data-id="heading-3">1. 定义接口（契约）</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// INoteListCallback.java - 定义"契约"</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">INoteListCallback</span> {
    <span class="hljs-comment">// 定义需要什么方法，不关心怎么实现</span>
    String <span class="hljs-title function_">formatTimestamp</span><span class="hljs-params">(<span class="hljs-type">long</span> timestamp)</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">dpToPx</span><span class="hljs-params">(<span class="hljs-type">int</span> dp)</span>;
    NoteDbHelper <span class="hljs-title function_">getDbHelper</span><span class="hljs-params">()</span>;
}
</code></pre>
<h5 data-id="heading-4">2. 实现接口（具体实现）</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MainActivity.java - 实现接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">INoteListCallback</span> {
    <span class="hljs-comment">// 提供具体实现</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">formatTimestamp</span><span class="hljs-params">(<span class="hljs-type">long</span> timestamp)</span> {
        <span class="hljs-comment">// 具体怎么格式化，MainActivity 自己决定</span>
    }
}
</code></pre>
<h5 data-id="heading-5">3. 使用接口（依赖抽象）</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NoteListManager.java - 只依赖接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoteListManager</span> {
    <span class="hljs-keyword">private</span> INoteListCallback callback; <span class="hljs-comment">// 只依赖接口，不依赖具体类</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">displayNote</span><span class="hljs-params">(Note note)</span> {
        <span class="hljs-comment">// 通过接口调用，不知道具体是哪个类实现的</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> callback.formatTimestamp(note.getTimestamp());
    }
}
</code></pre>
<h4 data-id="heading-6">三、面向接口编程的优势</h4>
<h5 data-id="heading-7">1. 解耦</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NoteListManager 不知道 MainActivity 的存在</span>
<span class="hljs-comment">// 它只知道有一个对象实现了 INoteListCallback 接口</span>
<span class="hljs-comment">// 可以是 MainActivity，也可以是 TestActivity，也可以是 MockActivity</span>
</code></pre>
<h5 data-id="heading-8">2. 可测试性</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 测试时，可以用 Mock 实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MockCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">INoteListCallback</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">formatTimestamp</span><span class="hljs-params">(<span class="hljs-type">long</span> timestamp)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Mock时间"</span>; <span class="hljs-comment">// 测试用的简单实现</span>
    }
}

<span class="hljs-comment">// 测试 NoteListManager</span>
<span class="hljs-type">NoteListManager</span> <span class="hljs-variable">manager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoteListManager</span>();
manager.initialize(listView, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockCallback</span>()); <span class="hljs-comment">// 用 Mock 测试</span>
</code></pre>
<h5 data-id="heading-9">3. 可扩展性</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 以后可以有不同的实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherActivity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">INoteListCallback</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">formatTimestamp</span><span class="hljs-params">(<span class="hljs-type">long</span> timestamp)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"另一种格式"</span>; <span class="hljs-comment">// 不同的实现方式</span>
    }
}

<span class="hljs-comment">// NoteListManager 不需要改，只需要传入不同的实现</span>
manager.initialize(listView, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnotherActivity</span>());
</code></pre>
<h4 data-id="heading-10">四、设计原则体现</h4>
<h5 data-id="heading-11">1. 依赖倒置原则（DIP）</h5>
<pre><code class="hljs">高层模块（NoteListManager）不应该依赖低层模块（MainActivity）
两者都应该依赖抽象（INoteListCallback）
</code></pre>
<h5 data-id="heading-12">2. 开闭原则（OCP）</h5>
<pre><code class="hljs">对扩展开放：可以添加新的实现类
对修改关闭：NoteListManager 不需要修改
</code></pre>
<h4 data-id="heading-13">五、优点总结</h4>
<pre><code class="hljs language-markdown" lang="markdown">面向接口编程 = 定义接口（契约）
<span class="hljs-code">            = 实现接口（具体实现）
            = 使用接口（依赖抽象）
            = 解耦、可测试、可扩展
</span></code></pre>
<p>Callback 就是面向接口编程思想的实际体现。下面我们看看哪些具体的设计模式都跟面向接口编程有关。</p>
<h2 data-id="heading-14">与面向接口编程有关的设计模式</h2>
<p>常见的一种是策略模式。当然，面向接口编程不仅体现在<strong>策略模式</strong>中，还贯穿于<strong>多种行为型和结构型模式</strong>。</p>
<h3 data-id="heading-15">一、在行为型模式中的体现</h3>
<h4 data-id="heading-16">1. <strong>观察者模式（Observer）</strong> ⭐️ 高度体现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 定义接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observer</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(String message)</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subject</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerObserver</span><span class="hljs-params">(Observer o)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObserver</span><span class="hljs-params">(Observer o)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyObservers</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 实现接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Observer</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(String message)</span> {
        System.out.println(<span class="hljs-string">"收到消息: "</span> + message);
    }
}

<span class="hljs-comment">// 使用接口</span>
<span class="hljs-type">NewsPublisher</span> <span class="hljs-variable">publisher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NewsPublisher</span>();
publisher.registerObserver(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>());  <span class="hljs-comment">// 依赖接口，不依赖具体类</span>
</code></pre>
<p><strong>接口思维</strong>：Observer是观察者的抽象，Subject是主题的抽象。双方通过接口通信。</p>
<h4 data-id="heading-17">2. <strong>命令模式（Command）</strong> ⭐️ 核心就是接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 定义命令接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Command</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 不同实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 保存逻辑</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DeleteCommand</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Command</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 删除逻辑</span>
    }
}

<span class="hljs-comment">// 使用命令</span>
<span class="hljs-type">Button</span> <span class="hljs-variable">saveBtn</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Button</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveCommand</span>());  <span class="hljs-comment">// 传入接口</span>
</code></pre>
<p><strong>接口思维</strong>：将请求封装为对象，所有命令都实现Command接口，调用者只依赖接口。</p>
<h4 data-id="heading-18">3. <strong>状态模式（State）</strong></h4>
<p><a href="https://juejin.cn/post/7542907839314133030" target="_blank" title="https://juejin.cn/post/7542907839314133030">每日知识-设计模式-状态模式- 掘金</a></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">State</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Context context)</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteStateA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">State</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(Context context)</span> {
        context.setState(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteStateB</span>());  <span class="hljs-comment">// 切换到另一个状态</span>
    }
}
</code></pre>
<p><strong>接口思维</strong>：状态抽象为接口，上下文对象依赖State接口而不是具体状态。</p>
<h4 data-id="heading-19">4. <strong>模板方法模式（Template Method）</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataProcessor</span> {
    <span class="hljs-comment">// 模板方法 - 定义算法骨架</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">()</span> {
        readData();      <span class="hljs-comment">// 固定步骤</span>
        transformData(); <span class="hljs-comment">// 抽象方法，子类实现</span>
        saveData();      <span class="hljs-comment">// 固定步骤</span>
    }
    
    <span class="hljs-comment">// 抽象方法 - 通过实现来变化</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transformData</span><span class="hljs-params">()</span>;
}
</code></pre>
<p><strong>接口思维</strong>：虽然用抽象类，但思想一致 - 定义算法框架，具体步骤由子类实现。</p>
<h3 data-id="heading-20">二、在结构型模式中的体现</h3>
<h4 data-id="heading-21">1. <strong>适配器模式（Adapter）</strong> - 核心是统一接口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 目标接口（期望的接口）</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MediaPlayer</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">(String audioType, String fileName)</span>;
}

<span class="hljs-comment">// 已有的类，接口不兼容</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mp4Player</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playMp4</span><span class="hljs-params">(String fileName)</span> { <span class="hljs-comment">/*...*/</span> }
}

<span class="hljs-comment">// 适配器 - 实现目标接口，包装已有类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mp4Adapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MediaPlayer</span> {
    <span class="hljs-keyword">private</span> Mp4Player mp4Player;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span><span class="hljs-params">(String audioType, String fileName)</span> {
        <span class="hljs-keyword">if</span> (audioType.equals(<span class="hljs-string">"mp4"</span>)) {
            mp4Player.playMp4(fileName);  <span class="hljs-comment">// 适配</span>
        }
    }
}
</code></pre>
<p><strong>接口思维</strong>：通过适配器统一不同系统的接口，客户端只依赖MediaPlayer接口。</p>
<h4 data-id="heading-22">2. <strong>桥接模式（Bridge）</strong> - 抽象与实现分离</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 抽象部分</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">protected</span> Color color;  <span class="hljs-comment">// 桥接 - 组合Color接口</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Shape</span><span class="hljs-params">(Color color)</span> {
        <span class="hljs-built_in">this</span>.color = color;
    }
    
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 实现部分接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Color</span> {
    String <span class="hljs-title function_">fill</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 具体实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Red</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Color</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">fill</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"红色"</span>;
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-type">Shape</span> <span class="hljs-variable">circle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Red</span>());  <span class="hljs-comment">// 通过接口组合</span>
</code></pre>
<p><strong>接口思维</strong>：将抽象（Shape）与实现（Color）解耦，通过接口组合。</p>
<h4 data-id="heading-23">3. <strong>代理模式（Proxy）</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Image</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RealImage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Image</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 实际加载图片</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyImage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Image</span> {  <span class="hljs-comment">// 代理类也实现相同接口</span>
    <span class="hljs-keyword">private</span> RealImage realImage;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">display</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (realImage == <span class="hljs-literal">null</span>) {
            realImage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealImage</span>();  <span class="hljs-comment">// 延迟加载</span>
        }
        realImage.display();
    }
}
</code></pre>
<p><strong>接口思维</strong>：代理类和真实类实现相同的接口，客户端无感知。</p>
<h3 data-id="heading-24">三、在创建型模式中的体现</h3>
<h4 data-id="heading-25">1. <strong>工厂方法模式（Factory Method）</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">use</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Creator</span> {
    Product <span class="hljs-title function_">createProduct</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// 工厂方法 - 返回接口</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteCreator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Creator</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">createProduct</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteProduct</span>();  <span class="hljs-comment">// 返回具体产品，但声明为Product接口</span>
    }
}
</code></pre>
<p><strong>接口思维</strong>：工厂返回接口类型，客户端不依赖具体产品类。</p>
<h4 data-id="heading-26">2. <strong>抽象工厂模式（Abstract Factory）</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">GUIFactory</span> {
    Button <span class="hljs-title function_">createButton</span><span class="hljs-params">()</span>;
    Checkbox <span class="hljs-title function_">createCheckbox</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Button</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">paint</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// 客户端代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
    <span class="hljs-keyword">private</span> Button button;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Application</span><span class="hljs-params">(GUIFactory factory)</span> {  <span class="hljs-comment">// 依赖工厂接口</span>
        button = factory.createButton();
    }
}
</code></pre>
<p><strong>接口思维</strong>：整套产品族通过接口定义，具体工厂实现接口。</p>
<h3 data-id="heading-27">四、面向接口编程的层次</h3>
<h4 data-id="heading-28">第一层：技术实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 简单的接口定义与实现</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">A</span> { <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span>; }
<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">A</span> { ... }
</code></pre>
<h4 data-id="heading-29">第二层：设计模式</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 模式级别的接口应用</span>
<span class="hljs-comment">// 1. 策略模式：定义算法族，使其可以互换</span>
<span class="hljs-comment">// 2. 观察者模式：定义发布-订阅的通信机制</span>
<span class="hljs-comment">// 3. 命令模式：将请求封装为对象</span>
<span class="hljs-comment">// 4. 状态模式：将状态抽象为接口</span>
</code></pre>
<h4 data-id="heading-30">第三层：架构思想</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 系统架构层面的接口</span>
<span class="hljs-comment">// - 依赖倒置：高层模块不依赖低层模块，都依赖抽象</span>
<span class="hljs-comment">// - 接口隔离：多个专用接口优于一个通用接口</span>
<span class="hljs-comment">// - 六边形架构：通过端口（接口）与外部世界通信</span>
</code></pre>
<h3 data-id="heading-31">五、实际项目中的应用启示</h3>
<h4 data-id="heading-32">何时选择哪种模式？</h4>








































<table><thead><tr><th>场景</th><th>适合的模式</th><th>接口的作用</th></tr></thead><tbody><tr><td>算法可互换</td><td>策略模式</td><td>定义算法接口</td></tr><tr><td>对象状态变化</td><td>状态模式</td><td>定义状态接口</td></tr><tr><td>请求需要封装</td><td>命令模式</td><td>定义命令接口</td></tr><tr><td>解耦通知机制</td><td>观察者模式</td><td>定义观察者接口</td></tr><tr><td>统一不同接口</td><td>适配器模式</td><td>定义目标接口</td></tr><tr><td>延迟/控制访问</td><td>代理模式</td><td>定义主体接口</td></tr></tbody></table>
<h4 data-id="heading-33">一个综合示例：电商订单系统</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 策略模式：不同的折扣策略</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">DiscountStrategy</span> {
    <span class="hljs-type">double</span> <span class="hljs-title function_">calculateDiscount</span><span class="hljs-params">(Order order)</span>;
}

<span class="hljs-comment">// 状态模式：订单状态</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderState</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">next</span><span class="hljs-params">(Order order)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">previous</span><span class="hljs-params">(Order order)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Order order)</span>;
}

<span class="hljs-comment">// 观察者模式：订单状态通知</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderObserver</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(Order order)</span>;
}

<span class="hljs-comment">// 命令模式：订单操作</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderCommand</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">undo</span><span class="hljs-params">()</span>;
}
</code></pre>
<h3 data-id="heading-34">总结</h3>
<p>面向接口编程是<strong>贯穿所有设计模式的灵魂思想</strong>：</p>
<ol>
<li><strong>策略模式</strong>：最直接的体现，但远不止于此</li>
<li><strong>行为型模式</strong>中大部分都基于接口：
<ul>
<li>观察者、命令、状态、策略等核心都是接口抽象</li>
</ul>
</li>
<li><strong>结构型模式</strong>通过接口实现结构解耦：
<ul>
<li>适配器统一接口，桥接分离抽象与实现</li>
</ul>
</li>
<li><strong>创建型模式</strong>通过接口隐藏创建细节</li>
</ol>
<p><strong>核心思想</strong>：面向接口编程不仅仅是写一个<code>interface</code>，而是：</p>
<ul>
<li><strong>依赖抽象，而不是具体</strong></li>
<li><strong>定义契约，而不是实现</strong></li>
<li><strong>关注能做什么，而不是怎么做</strong></li>
</ul>
<p>这在GoF的23种设计模式中都有深刻体现，是面向对象设计的精髓所在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十天谈下二十亿美金：Meta豪掷千金买下的中国AI天才，到底凭什么？]]></title>    <link>https://juejin.cn/post/7589839433320546367</link>    <guid>https://juejin.cn/post/7589839433320546367</guid>    <pubDate>2025-12-31T15:08:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839433320546367" data-draft-id="7589838714450149417" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十天谈下二十亿美金：Meta豪掷千金买下的中国AI天才，到底凭什么？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-31T15:08:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十天谈下二十亿美金：Meta豪掷千金买下的中国AI天才，到底凭什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T15:08:34.000Z" title="Wed Dec 31 2025 15:08:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>硅谷的冬天通常很冷，但扎克伯格最近的一把火烧得格外旺。</p>
<p>就在刚刚过去的2025年年底，科技圈爆出了一颗深水炸弹：Meta正式以数十亿美元（外界估值约20亿至30亿美金）拿下了AI应用Manus的母公司蝴蝶效应。</p>
<p>这笔交易有多夸张？这是Meta成立以来，继收购WhatsApp和Scale AI之后的第三大收购案。更离谱的是，从双方坐下来谈判到签字画押，仅仅用了10天。</p>
<p>对于一家万亿市值的巨头来说，这种决策速度简直就是“冲动消费”。但如果你看懂了Manus这家公司，或许会感叹：扎克伯格这次不仅没疯，反而精明得可怕。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fsdgsfggfhfgh-1024x708.jpg" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/sdgsfggfhfgh-1024x708.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/225fa393ede14323821a057d96b2d7b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767798514&amp;x-signature=HqcTPKLQo9Q05PNihEiTsCxMXl4%3D" alt="sdgsfggfhfgh" loading="lazy"/></a></p>
<h2 data-id="heading-0">不做聊天的AI，专做“打工人”</h2>
<p>为什么一家成立没几年的公司能值几十亿美金？</p>
<p>在ChatGPT还要你费尽口舌写提示词的时候，Manus已经进化成了你的“数字分身”。</p>
<p>Manus的核心逻辑非常简单粗暴：它不陪聊，只干活。</p>
<p>这是一款通用型AI智能体（Agent）。以前我们用AI，是问它“怎么做表”；用Manus，你直接说“帮我把这些数据整理成表，顺便分析一下趋势，发给我老板”。然后，它就会自己去规划步骤、调用工具、写代码、甚至操作浏览器，最后把成品交给你。</p>
<p>这正是扎克伯格梦寐以求的“手脑并用”。</p>
<p>Meta手里握着强大的Llama系列大模型，这就像有一个绝顶聪明的大脑，但苦于没有一双灵活的手去接触用户。Manus就是那双“手”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasdasfsdgf-1024x682.jpg" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asdasfsdgf-1024x682.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb1698aba5fc4a3092da1b6218b3e03d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767798514&amp;x-signature=8d00TY%2BRIzgvPal8UyFeuLGmLGU%3D" alt="asdasfsdgf" loading="lazy"/></a></p>
<p>数据不会骗人。Manus上线仅仅9个月，年度经常性收入（ARR）就突破了1亿美元。这在SaaS领域简直是神迹，Slack当年做到这一步用了好几年。而且最恐怖的是，它几乎没花什么市场推广费，全是靠产品力硬生生杀出来的。</p>
<h2 data-id="heading-1">那个来自华科大的90后</h2>
<p>这笔交易的另一个主角，是蝴蝶效应的创始人肖弘。</p>
<p>这是一位典型的中国新一代极客。本科毕业于华中科技大学，从武汉起步，在微信生态里摸爬滚打过，最后把公司总部设在了新加坡，把目光投向了全球。</p>
<p>肖弘的故事给所有技术创业者打了一剂强心针：不靠混圈子，不靠资历，只要你的产品足够硬，硬到能在这个星球上最高水平的竞技场里通过GAIA基准测试，硬到能让硅谷巨头感到威胁，那你就是赢家。</p>
<p>收购完成后，蝴蝶效应不会被拆散，而是保持独立运营。肖弘本人将出任Meta的副总裁，直接向核心高层汇报。这不仅是一次财务上的暴富，更是一次技术话语权的跃升。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasdasfdf.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asdasfdf.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afcf0b38348a47c19538ee47db99940d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767798514&amp;x-signature=QvXoJA9uSAwcCjekfPr0VDx5ccA%3D" alt="asdasfdf" loading="lazy"/></a></p>
<h2 data-id="heading-2">扎克伯格的焦虑与野心</h2>
<p>Meta为什么要这么急？</p>
<p>2025年的AI战场已经变天了。单纯比拼模型参数的时代正在过去，DeepSeek等来自中国的开源模型在性能上步步紧逼，让Meta引以为傲的Llama护城河显得岌岌可危。</p>
<p>扎克伯格很清楚，下一个万亿赛道不在于谁的模型背书更多，而在于谁能先拿出一个“超级智能助手”。他需要一个能直接面对消费者、能直接产生现金流、能直接解决复杂任务的杀手级应用。</p>
<p>Manus补上了Meta版图里最缺的那一块拼图。</p>
<p>通过这笔收购，Meta瞬间拥有了已被市场验证的智能体技术架构。扎克伯格所谓的“个人赋能新时代”，因为Manus的加入，从一句空洞的口号变成了触手可及的现实。</p>
<h2 data-id="heading-3">留给我们的思考</h2>
<p>这无疑是一场双赢。Meta买到了通往未来的船票，Manus团队获得了顶级资源的支持。</p>
<p>但站在大洋彼岸的我们，看着这样一家流淌着中国技术基因、由中国团队打造的顶级公司，最终被海外巨头收入囊中，心情多少有些复杂。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasafsdggfd-1024x654.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asafsdggfd-1024x654.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/252c8afb6cad4869af3bbcd0fa6b130a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767798514&amp;x-signature=Wu%2BhDAPwVbfvrFg%2BU7kXkrr2h%2BI%3D" alt="asafsdggfd" loading="lazy"/></a></p>
<p>这证明了中国开发者的创新能力绝对是世界级的。真格基金、红杉中国等早期投资人的眼光毒辣，也证明了本土资本在发掘初期项目上的敏锐。</p>
<p>然而，为什么我们的巨头此前只开出了数千万美元的报价？为什么顶级的创新苗子最终要在海外才能长成参天大树？</p>
<p>Manus的成功是孤例，也不会是绝唱。像HeyGen、PixVerse这样在海外风生水起的中国背景AI公司还有很多。Meta的这一掷千金，或许是一记警钟，也是一声号角：</p>
<p>应用层的战争才刚刚开始，谁能做出真正好用的东西，谁就能定义下一个十年。只不过这一次，定价权掌握在了那些真正懂产品的人手里。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[饺子的 2025 年终总结]]></title>    <link>https://juejin.cn/post/7589839019717034034</link>    <guid>https://juejin.cn/post/7589839019717034034</guid>    <pubDate>2025-12-31T15:46:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839019717034034" data-draft-id="7589823928414502938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="饺子的 2025 年终总结"/> <meta itemprop="keywords" content="年终总结"/> <meta itemprop="datePublished" content="2025-12-31T15:46:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="清汤饺子"/> <meta itemprop="url" content="https://juejin.cn/user/4300945218607197"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            饺子的 2025 年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945218607197/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    清汤饺子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T15:46:11.000Z" title="Wed Dec 31 2025 15:46:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>往年的总结总是有迹可循：工作项目做了什么事、学了什么技术、读了什么书、爬了哪些山、去了哪里旅游。</p>
<p>2025 年我依然在高速奔跑，但不同的是我的脚下有了更踏实的实土，耳边少了很多焦虑的阵风。</p>
<hr/>
<h2 data-id="heading-0">💻 前端：从“开荒”到“架构”</h2>
<p>2025 年，是结束一份 5 年长期稳定工作后的全新起点。进入新环境、新同事、新项目、新节奏，一切都是新的。我以为我会需要一段适应期，但出乎意料的是，这种变化反而激发了我更多的热情和活力。</p>
<h3 data-id="heading-1">业务与成长</h3>
<p>今年我跟随团队作战，跟随着项目一起经历高速的迭代。在开放真诚的氛围里，我拿到了入职后的第一个 <strong>S 绩效</strong>。<br/>
如果说过去我是在“做项目”，今年我更多地是在“沉淀系统”。我开始意识到，技术不只是为了实现功能，更是为了在混沌中建立秩序。</p>
<h3 data-id="heading-2">博客与输出</h3>
<p>今年在内部博客产出了 10 篇深度文章。相比往年追求“技术的广度”，今年的每一篇都更偏向于「问题总结」和「Tech Design」。<br/>
我喜欢这种“解码”的过程：从 AIGC 的埋点设计，到毫秒级下载的性能瓶颈，再到支付能力的架构演进。每一篇文章，都是一次认知版本更新。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f713ad99af4441eb980a23d5928463d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=Ank9jr8pPUU8w0sn3whPhG%2Bf9d8%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">🌿 生活：在烟火气中“回血”</h2>
<p>2025 年，把自己重养一遍。</p>
<h3 data-id="heading-4">身体与自我</h3>
<p>今年我对自己的身体进行了两次重要的“重塑”：做了正畸和近视手术。</p>
<ul>
<li><strong>舞蹈</strong>：上了 100+ 节舞蹈课。在舞蹈室里，那种全神贯注的投入让我享受心流的快乐。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d229c38a8d4b464590ff45ac5e81f5cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=fNj6%2FTnDIgDYSuz%2BgSqkb6%2BerJY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd48f4cbf1994c22adcdf988deca4d63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=bBvsVtPKcTvvPWDFGwL5BrJijuU%3D" alt="d95258463d4b212310c749afe4132e4d.jpg" loading="lazy"/></p>
<ul>
<li><strong>户外</strong>：去了日本，去了川西，徒步过，也听了 Livehouse。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8927d92b61d4772b44a258cb6aefe3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=2Cv6mwLmOTo%2FdAzdUj4Z9FytgiU%3D" alt="cd9b1833d9d0e06a2cc8fab565162439.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86578737c7194885a7d5ce033e273e33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=6tKp%2BAGZ0LHoU%2BLhAu8xtfhKbrQ%3D" alt="45da7c02380a2083fc55a1d9e3dc1836.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ccb3d7ca58e444281903006b2cd63f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=H1cI0eZmsnOALc%2FxIFSfbvt%2BF38%3D" alt="59b6240a284749797d0eb51222c20e59.jpg" loading="lazy"/></p>
<h3 data-id="heading-5">认知与内在</h3>
<p>2025 年，我几乎戒掉了电视剧，手机使用时长保持在 2-3 小时。</p>
<ul>
<li><strong>阅读</strong>：继续保持阅读的习惯，内心更加充盈。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e8c9c7772640f2992b62fe64026a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=eLvVY3xJdM9p6umReAYIh%2BlQ7rE%3D" alt="f402fffe62e92044912021e28c3cac26.jpg" loading="lazy"/></p>
<ul>
<li><strong>厨艺</strong>：有了拿手菜后，喜欢上了做饭。在切菜和翻炒的频率中，我感受到了生活最本质的踏实感。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ef6501c2a104d6da095d9eefbccd241~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=U4k6eGMMiZyxUidf4Hm7f9zfwko%3D" alt="8288a9a4707b3fe680df00df9095c986.jpg" loading="lazy"/></p>
<ul>
<li><strong>整理</strong>：我变得非常喜欢整理房间。每一次收纳，都是对内心世界的一次“重构”。</li>
</ul>
<h3 data-id="heading-6">陪伴</h3>
<ul>
<li><strong>带父母旅游：</strong> 今年最值得的一件事，就是有能力也有时间带父母出去走走。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a58368cf39344fdba1b2bd1516fc3a9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=0z%2FQWOEmYv0efBlP0nn1EgtVmgM%3D" alt="a35c7cf7c7d0ef2102e0cf67a30342ec.jpg" loading="lazy"/></p>
<ul>
<li><strong>养的猫比以前更黏人了：</strong> 也许是因为陪伴它的时间变多了，它也感受到了我的松弛。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79870b031ac841ecb6e2c1859a62f384~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5riF5rGk6aW65a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767801407&amp;x-signature=KELGaDBfW6LnyAQxTpzZZXZALQ4%3D" alt="image.png" loading="lazy"/></p>
<p>我不再是一个人在战斗，而是在一个温馨、稳定的系统里，不断向内探索。</p>
<hr/>
<h2 data-id="heading-7">✍️ 写在最后：你好，30 岁</h2>
<p>2025 年，我的目标更加明确，我不再害怕“停下来”，在平淡的生活中遇到了一个更喜欢的自己。我喜欢这样的 30 岁。</p>
<p>2026 年，继续保持热爱❤️</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你不看会后悔的2025年终总结]]></title>    <link>https://juejin.cn/post/7589838714450444329</link>    <guid>https://juejin.cn/post/7589838714450444329</guid>    <pubDate>2025-12-31T15:49:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714450444329" data-draft-id="7589838714450329641" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你不看会后悔的2025年终总结"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2025-12-31T15:49:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你不看会后悔的2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T15:49:56.000Z" title="Wed Dec 31 2025 15:49:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">总结个der！</h2>
<h2 data-id="heading-1">新年快乐！</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84bab9a70994488d92156f7708c2dd5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767800996&amp;x-signature=aASfayjwHWRXy1VAZjQcf0dgA%2Bg%3D" alt="new_year.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的2025年终总结]]></title>    <link>https://juejin.cn/post/7589823928414650394</link>    <guid>https://juejin.cn/post/7589823928414650394</guid>    <pubDate>2025-12-31T14:05:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589823928414650394" data-draft-id="7589839019716886578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的2025年终总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-31T14:05:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="奈德丽"/> <meta itemprop="url" content="https://juejin.cn/user/620537392934711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/620537392934711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    奈德丽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T14:05:46.000Z" title="Wed Dec 31 2025 14:05:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我的2025年终总结</h2>
<p>时间过得好快呀，2025年就这么快过去了，明天开始就是2026年啦，小蛇游得可真快，到马儿来接力了。</p>
<h4 data-id="heading-1">我与家人以及朋友</h4>
<p>首先值得高兴的是今年身体棒棒的，很少感冒，感冒了也不用吃药几分钟之后就好了。</p>
<p>常回家看看。今年端午回家啦，去看了外公外婆和奶奶，今年国庆回家了，特别开心，给爸爸妈妈买了一些羊奶牛奶。
老姐经常会给我带很多好吃的，像酱牛肉（很下饭）、橘子</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img2@main/2025/12/31/1767188501367-aa658c6a-08a1-46dc-878c-6586e3a64f58.jpg" alt="" loading="lazy"/></p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img19@main/2025/12/31/1767188712636-2ed2260d-670e-4337-ac0e-d6984b9fb541.jpg" alt="" loading="lazy"/></p>
<p>丽给我买了好多好吃的，酱板鸭，童胖子、杨矮子、仙都、新金泰，常德的酱板鸭都吃了个遍</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img2@main/2025/12/31/1767187107947-70016dd9-3e6a-4a78-a874-3be22017fd36.jpg" alt="" loading="lazy"/></p>
<p>收到铁子从东北寄来的哈尔冰红肠</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img16@main/2025/12/31/1767188573472-faecbe53-d96d-4c5f-b5de-473b4733fe07.jpg" alt="" loading="lazy"/></p>
<p>收到了组长给我做的牛肉辣酱，比超市里面买的好吃噢</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/12/31/1767186968232-042d876e-8e50-450c-be7b-c8dc7e7c2e57.jpg" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">户外运动</h4>
<p>今年进行的户外运动比较少，麻田岭徒步、北灵山徒步 &amp; 骑马、跑了几次香山、去坡风岭看红叶、刷了刷百望山，甚至和我姐和丽丽去了一次小土包（景山）</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img13@main/2025/12/31/1767186763282-8f4ead0b-fdec-4469-b22b-daf5cb1d4986.jpg" alt="" loading="lazy"/></p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img1@main/2025/12/31/1767186773624-997f2590-ba9a-4e95-bc93-42e16977ec70.jpg" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">在掘金上持续输出文章</h4>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img17@main/2025/12/31/1767188904383-ebd52ce1-6378-405c-9046-8881fee82edc.jpg" alt="" loading="lazy"/></p>
<p>一篇《程序员自己设计开发的五子棋，炫酷又不失可爱》发布在掘金之后，无意之中爆火了，上了掘金综合榜第一名，那会儿我还隔几十分钟就去掘金看看，有没有新的点赞和收藏，特别逗的就是，我当时点赞才四五十的时候，心里想着，要是能突破100就好了，过了几个小时，也如愿以偿，收获了那么多的点赞， 这篇文章的初衷，是分享一下我写的五子棋小游戏，我觉得很有创意的一点是不同于经典的黑白子，它可以选取不同样式的棋子，还有朋友说希望它能上线，最终因为非技术因素，没有将它上线。 这一篇文章的爆火，鼓舞了我继续写作，由此也开启了我在掘金的写作之路，之后我持续总结了自己在工作中遇到的一些问题，将这些问题展现在了博客上面，希望对其他人也有一些用处。
在这个创作的过程中，除了得到了一些小伙伴的认可，也有一些小惊喜，那就是第一次收到了一个来自hongkong的小伙伴的百元赞赏，在这再次特别感谢！</p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/12/31/1767183832107-d37e7982-199c-4ab0-8b92-3fe6a2b2f480.jpg" alt="" loading="lazy"/></p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img7@main/2025/12/31/1767183847307-30ec899e-3c4b-49b8-ad26-1fb5374ee465.jpg" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">和 li 过了一周年纪念日</h4>
<p>和丽在一起的一周年，我们来吃了她喜欢吃的烤牛肠，她喜欢烤牛肠到了什么程度呢，甚至是想要跑去韩国专门吃一顿。我说北京也有正宗的烤牛肠店呢，以后有机会去韩国吃，要不先去六日都尝尝呢 qaq
一会和她一块吃火锅，一起跨个年！
<img src="https://fastly.jsdelivr.net/gh/bucketio/img15@main/2025/12/31/1767184116645-e534f3c2-9e45-4f61-b01e-d21732cd194a.jpg" alt="" loading="lazy"/></p>
<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img14@main/2025/12/31/1767185182056-6c2e3eae-4713-42c9-96a7-d7a78b3f3591.jpg" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">对未来的展望</h4>
<p>2026年持续学习！
2026多花时间陪伴家人！
2026 期待更健康的自我，多进行户外运动，去拥抱大自然！</p>

<p><img src="https://fastly.jsdelivr.net/gh/bucketio/img4@main/2025/12/31/1767184006877-8a69a717-538e-415e-abe2-bf8df54dd947.jpg" alt="" loading="lazy"/></p>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HBuilderX 4.87 无法正常读取 macOS 环境配置的解决方案]]></title>    <link>https://juejin.cn/post/7589828902158630962</link>    <guid>https://juejin.cn/post/7589828902158630962</guid>    <pubDate>2025-12-31T14:27:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828902158630962" data-draft-id="7589839019716952114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HBuilderX 4.87 无法正常读取 macOS 环境配置的解决方案"/> <meta itemprop="keywords" content="前端,uni-app"/> <meta itemprop="datePublished" content="2025-12-31T14:27:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗鸽"/> <meta itemprop="url" content="https://juejin.cn/user/676954894513319"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HBuilderX 4.87 无法正常读取 macOS 环境配置的解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/676954894513319/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗鸽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T14:27:20.000Z" title="Wed Dec 31 2025 14:27:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我的电脑配置是 macOS Sequoia 15.6.1（M2 芯片）。最近使用 HBuilderX 4.87 打包 APP 时出现卡住、无法正常打包的问题。本文给出解决方案。</p>
<p>隔了几个月，最近要用 uni-app 打包一下 APP。我像之前那样打开了 HBuilderX，更新并打包 Android APP，却发现提示我需要配置 Node.js。</p>
<p>我很奇怪，我都是用 fnm 管理 Node.js，几个项目 Node.js 用得好好的，没啥问题啊，为什么会这样呢？🤔</p>
<p>我百思不得其解，直到我打开了 HBuilderX 提示的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhx.dcloud.net.cn%2FTutorial%2FconfigureEnvironmentVariables" target="_blank" title="https://hx.dcloud.net.cn/Tutorial/configureEnvironmentVariables" ref="nofollow noopener noreferrer">关联链接</a>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc1707becab34a1eac3cf0a3f9a4b187~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uX6bi9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796040&amp;x-signature=ISuhVZdX8IQTct%2Bt516EUix8WbY%3D" alt="HBuilderX macOS 环境变量" loading="lazy"/></p>
<blockquote>
<p>Hbuilder X 从 4.41 版本开始调整 cli 项目使用本地的 node 执行编译，如果用户未安装并正确配置 Node.js 会警告报错。</p>
</blockquote>
<blockquote>
<p>目前只从 bash 中读取环境变量，需要确保配置到 bash 中</p>
</blockquote>
<p>Bro，从 4.41 版本更新到 4.87 版本，还是不能从 macOS 10.15 开始默认使用的 zsh 读取环境变量，体验真是太差了。😅</p>
<p>我搜索了 DCloud 论坛里面，有好哥哥提到将 <code>~/.zshrc</code> 里的内容复制粘贴到 <code>~/.bash_profile</code> 就能用了。如果你感兴趣可以尝试一下这个方案，但我尝试时发现还是会卡住无法继续，HBuilderX 日志提示 fnm 不存在。</p>
<p>进一步地，如果我去掉了 <code>~/.bash_profile</code> 里面的 fnm，只是按照官方指南那样设置 Node.js PATH，仍然没办法正常使用。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">HBuilderX</span>
export PATH="$PATH:$HOME/Library/Application Support/fnm/aliases/default/bin"
<span class="hljs-meta prompt_">
# </span><span class="bash">Android Studio</span>
export ANDROID_HOME=$HOME/Library/Android/sdk
export ANDROID_SDK_ROOT=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_SDK_ROOT/emulator
export PATH=$PATH:$ANDROID_SDK_ROOT/tools
export PATH=$PATH:$ANDROID_SDK_ROOT/tools/bin
export PATH=$PATH:$ANDROID_SDK_ROOT/platform-tools
<span class="hljs-meta prompt_">
# </span><span class="bash">Java</span>
alias use-java17='/usr/libexec/java_home -v 17 --exec java -version'
alias use-java8='/usr/libexec/java_home -v 1.8 --exec java -version'

</code></pre>
<p>直到我偶然设置了全局的 Node.js 版本，重启 HBuilderX，结果可以正常打包了！但如果我去掉 <code>~/.bash_profile</code> 里面的 Node.js PATH，重启 HBuilderX，又没法正常打包了！</p>
<p>我综合几次实验，得出的结论是，<code>~/.bash_profile</code> 里面 Node.js PATH 只起到了一个欺骗 HBuilderX 的作用，并不会使用里面 PATH 对应的 Node.js，实际上使用的是 fnm 在全局设置的 Node.js。我完全无法理解这种事情，也不好说这是 fnm 的弊端，还是 HBuilderX 的缺陷 😱</p>
<p>如果你尝试好哥哥的方案无法正常运行，那可以尝试一下我的方案：</p>
<ol>
<li>设置 <code>~/.bash_profile</code>，如上所示；</li>
<li>切换到 <code>~</code> 目录下，运行一下 <code>fnm use [打包项目所需的 Node.js]</code>；</li>
<li>重启 HBuilderX，打包 APP。</li>
</ol>
<p>希望对你有所帮助！元旦快乐！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用链表实现了简单版本的malloc/free函数]]></title>    <link>https://juejin.cn/post/7589835342145781770</link>    <guid>https://juejin.cn/post/7589835342145781770</guid>    <pubDate>2025-12-31T14:31:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589835342145781770" data-draft-id="7589564203873026111" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用链表实现了简单版本的malloc/free函数"/> <meta itemprop="keywords" content="C++,数据结构"/> <meta itemprop="datePublished" content="2025-12-31T14:31:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="pdudo"/> <meta itemprop="url" content="https://juejin.cn/user/2981531267892856"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用链表实现了简单版本的malloc/free函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2981531267892856/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    pdudo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T14:31:10.000Z" title="Wed Dec 31 2025 14:31:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用链表实现了简单版本的malloc函数</h2>
<p><code>malloc</code>函数可以在堆上分配内存，本文简单实现了一个最简单<code>malloc</code>函数。</p>
<h3 data-id="heading-1">什么是虚拟地址</h3>
<p>在现代操作系统中，进程在运行时候，操作系统将会为其分虚拟内存（<code>VM</code>），从进程的角度看来，它是独占所有内存的。</p>
<p>所以，进程在运行中，其虚拟地址空间如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c378cf4bc2448c6b5a916c42683479c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=i2c9RNVJ3ICctVitpMfZKmf9plc%3D" alt="图片.png" loading="lazy"/></p>
<p>可以简单理解为，每一个进程启动，在进程看来，它都像是获得了整个内存空间。其中堆在数据区之后，堆可以动态的进行扩展和收缩，当需要扩展堆内存的时候，只需要将堆顶指针(<code>brk</code>)向上移动，当需要收缩内存的时候，只需要将堆顶指针(<code>brk</code>)向下移动。</p>
<p>如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/673908d4659e49c6a0248c2b48de4a1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=n%2Bk3KfCmarj523aOcrUTitsEZco%3D" alt="图片.png" loading="lazy"/></p>
<h3 data-id="heading-2">使用<code>C</code>如何操作堆内存</h3>
<p>注意前提，<code>brk</code>是需要在类<code>Unix</code>操作系统中，比如所熟知的<code>Linux</code>操作系统，类<code>Unix</code>操作系统内核都提供了<code>brk()</code>接口，<code>libc</code>封装了该接口，称之为<code>sbrk()</code>，使用该接口可以扩充、缩减堆内存。</p>
<p>首先，要调用<code>sbrk()</code>函数，需要包含<code>unistd.h</code>头文件，<code>sbrk()</code>该函数说明如下：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/* Increase or decrease the end of accessible data space by DELTA bytes.
   If successful, returns the address the previous end of data space
   (i.e. the beginning of the new space, if DELTA &gt; 0);
   returns (void *) -1 for errors (with errno set).  */</span>
<span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> *<span class="hljs-title">sbrk</span> <span class="hljs-params">(<span class="hljs-type">intptr_t</span> __delta)</span> __THROW</span>;
</code></pre>
<p>该函数可以增加、所缩小数据空间，单位为字节，当传入大于0的时候，则是扩展堆、当传入小于0的时候，择时缩小堆、如果出错，则返回<code>(void *) - 1</code>。</p>
<p>当想获取一下堆顶的地址，只需要传入<code>0</code>即可，注意，需要将返回值与<code>(void *) -1</code>判断是否已经完成操作。</p>
<p>具体代码如下：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
​
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
​
    <span class="hljs-type">char</span> *address = <span class="hljs-built_in">sbrk</span>(<span class="hljs-number">0</span>);
​
    <span class="hljs-keyword">if</span> (address == (<span class="hljs-type">void</span> *)<span class="hljs-number">-1</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"获取堆顶地址失败"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
​
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"当前进程虚拟内存堆顶(brk)地址：%p\n"</span>,address);
​
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>上述代码运行后会返回当前堆顶的地址。执行过程如下：</p>
<pre><code class="hljs language-bash" lang="bash">➜  tests ./a.out 
当前进程虚拟内存堆顶(brk)地址：0x5c94a0f73000
➜  tests 
</code></pre>
<p>这里举一个扩充堆内存，存入数据的例子：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
​
<span class="hljs-comment">// 返回当前堆顶地址</span>
<span class="hljs-type">void</span> *<span class="hljs-title function_">getSprkAddress</span><span class="hljs-params">()</span> {
    <span class="hljs-type">char</span> *address = sbrk(<span class="hljs-number">0</span>);
​
    <span class="hljs-keyword">if</span> (address == (<span class="hljs-type">void</span> *)<span class="hljs-number">-1</span>) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"获取堆顶地址失败"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
    }
​
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"当前进程虚拟内存堆顶(brk)地址：%p\n"</span>,address);
    <span class="hljs-keyword">return</span> address;
}
​
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
​
    <span class="hljs-comment">// 打印初始空间</span>
    getSprkAddress();
​
    <span class="hljs-comment">// 申请 40个字节（int占用4个字节、10个int）</span>
    <span class="hljs-type">int</span> length = <span class="hljs-number">10</span>;
​
    <span class="hljs-type">int</span> *<span class="hljs-built_in">array</span> = sbrk(<span class="hljs-keyword">sizeof</span>(*<span class="hljs-built_in">array</span>) * length);
    getSprkAddress();
​
    <span class="hljs-comment">// 向数组写入数据</span>
    <span class="hljs-type">int</span> i;
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;length;i++) {
        <span class="hljs-built_in">array</span>[i] = i+<span class="hljs-number">1</span>;
    }
​
    <span class="hljs-comment">// 读取数据</span>
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;length;i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"xx: %d\n"</span>,<span class="hljs-built_in">array</span>[i]);
    }
​
    <span class="hljs-comment">// 回收空间</span>
    <span class="hljs-type">void</span> *delSpace = sbrk(<span class="hljs-number">0</span> - (<span class="hljs-keyword">sizeof</span>(*<span class="hljs-built_in">array</span>) * length));
    getSprkAddress();
​
    <span class="hljs-comment">// 再次访问不属于自己的内存空间</span>
    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;length;i++) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"xx: %d\n"</span>,<span class="hljs-built_in">array</span>[i]);
    }
​
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>该程序申请了<code>40</code>个字节的堆地址，将堆顶指针，向上移动了40个字节，继而写入10个数据，而后将其读取出来，最后回收空间，再次访问不属于自己的内存空间。程序执行结果如下：</p>
<pre><code class="hljs language-makefile" lang="makefile">➜  tests ./a.out     
当前进程虚拟内存堆顶(brk)地址：0x59b2fbddd000
当前进程虚拟内存堆顶(brk)地址：0x59b2fbdfe028
<span class="hljs-section">xx: 1</span>
<span class="hljs-section">xx: 2</span>
<span class="hljs-section">xx: 3</span>
<span class="hljs-section">xx: 4</span>
<span class="hljs-section">xx: 5</span>
<span class="hljs-section">xx: 6</span>
<span class="hljs-section">xx: 7</span>
<span class="hljs-section">xx: 8</span>
<span class="hljs-section">xx: 9</span>
<span class="hljs-section">xx: 10</span>
当前进程虚拟内存堆顶(brk)地址：0x59b2fbdfe000
[1]    49058 segmentation fault (core dumped)  ./a.out
➜  tests 
</code></pre>
<p>申请堆空间后，写入了数据，回收了空间，想再次读取，引发了系统崩溃，因为该进程访问了不属于它的空间。如果回收后，再次申请，会触发初始化，数据也并不存在了，修改代码：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 回收空间</span>
void *delSpace = <span class="hljs-built_in">sbrk</span>(<span class="hljs-number">0</span> - (sizeof(*array) * length));
<span class="hljs-built_in">getSprkAddress</span>();
​
<span class="hljs-comment">// 再次申请空间</span>
<span class="hljs-built_in">sbrk</span>((sizeof(*array) * length));
​
<span class="hljs-comment">// 再次访问地址数据</span>
for (i=<span class="hljs-number">0</span>;i&lt;length;i++) {
    <span class="hljs-built_in">printf</span>("xx: %d\n",array[i]);
}
</code></pre>
<p>执行的结果为：</p>
<pre><code class="hljs language-makefile" lang="makefile">➜  tests gcc ./main.c
➜  tests ./a.out     
当前进程虚拟内存堆顶(brk)地址：0x628ab9140000
当前进程虚拟内存堆顶(brk)地址：0x628ab9161028
<span class="hljs-section">xx: 1</span>
<span class="hljs-section">xx: 2</span>
<span class="hljs-section">xx: 3</span>
<span class="hljs-section">xx: 4</span>
<span class="hljs-section">xx: 5</span>
<span class="hljs-section">xx: 6</span>
<span class="hljs-section">xx: 7</span>
<span class="hljs-section">xx: 8</span>
<span class="hljs-section">xx: 9</span>
<span class="hljs-section">xx: 10</span>
当前进程虚拟内存堆顶(brk)地址：0x628ab9161000
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
<span class="hljs-section">xx: 0</span>
➜  tests 
</code></pre>
<h3 data-id="heading-3">实现自己的<code>malloc</code></h3>
<p>实际的代码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fpdudo%2Fgolearn%2Fblob%2Fmaster%2Fmy_malloc%2Fmain.c" target="_blank" title="https://gitee.com/pdudo/golearn/blob/master/my_malloc/main.c" ref="nofollow noopener noreferrer">gitee.com/pdudo/golea…</a></p>
<p>要实现自己的<code>malloc</code>，有以下几个事项需要注意：</p>
<ul>
<li>底层数据如何存储</li>
<li>简单的分配、释放</li>
<li>空块合并、内存复用</li>
<li>数据对齐</li>
</ul>
<h4 data-id="heading-4">底层数据如何存储</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b29782bd59b740f9b1ea59615330c462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=idFl7%2FcW1XE9zYOBJeLCM5w%2F4K8%3D" alt="图片.png" loading="lazy"/></p>
<p>比较简单的一种方式，可以用<strong>链表</strong>来作为分配内存块的最小单位，这样的话，后期合并、分割内存块都会相对而言简单一点。</p>
<p>上图中，<code>black</code>是一个内存块头，记录了内存块的具体信息，包括：内存块大小、内存块状态、下一个节点地址等。而后就是实际的内存了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544f47de805e4f16b26b3a0ed52fb6e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=N8SmUIMFVi2bBefV3JDMZoY2i%2Bo%3D" alt="图片.png" loading="lazy"/></p>
<h4 data-id="heading-5">最简单的增加和删除</h4>
<p>可以先来看看最简单的新增和删除内存块。</p>
<p>关于新增：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b30f918faaa1416cbe0e6ad42851d247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=J6M0nBlo7OZsrK8b7fjolVVtGBM%3D" alt="图片.png" loading="lazy"/></p>
<p>如果是新增内存块，只需要将<code>brk</code>指针向上移动即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b9cbbb856af4e05a87c489a4ab0a7a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=hRzrV7k5dTZZ28yUXdJf4KnT7aE%3D" alt="图片.png" loading="lazy"/></p>
<p>如果是<code>free</code>内存，如果是要删除最上层的内存块，只需要将<code>brk</code>指针往后挪动即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e35942e19fd4e8dbe3a8a1b4045290b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=dP7CSs7Tsim6xKtTMfx6Dgol8%2B0%3D" alt="图片.png" loading="lazy"/></p>
<p>如果是删除除最上层的节点外，只需要将<code>black</code>的<code>status</code>标记为空即可，即，表示这块内存可以被使用。</p>
<p>比如，要删除第一个节点，后面还有节点数据的时候，就可以使用逻辑删除操作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00f9f3d083f342a6a1239d134fb5de53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=JPVi4o1W9VkTC8rykyUK88exEuU%3D" alt="图片.png" loading="lazy"/></p>
<h4 data-id="heading-6">内存合并</h4>
<p>当有多个内存块被逻辑删除的时候，就必须进行内存合并了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b38dce10ab2449b98b5fc755c4ae467f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=x8uS8Nax79S8nzFFC1wLmIWVsms%3D" alt="图片.png" loading="lazy"/></p>
<p>当有连续的内存块都被逻辑删除的时候，就可以进行合并，注意：<strong>连续内存块是指链表连续，和物理地址连续，才能进行合并</strong>，否则无法进行合并，因为内存申请，必须是一整块的，连续的地址；对于链表而言，通过下一跳的方式，不足以证明，地址是相邻的，可以被合并的。</p>
<p>当逻辑合并之后，后续合并的<code>black</code>将被作为实际内存返回，图示如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a53f5d23ec22439498e0022a2df6e401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=3stX8BGbpczA1A%2FQyGeQWG%2FOqc8%3D" alt="图片.png" loading="lazy"/></p>
<h4 data-id="heading-7">内存复用</h4>
<p>内存复用，情况分2种，一种是申请的内存，刚好和其中有一个空闲块的实际内存一致，则直接返回，还有一种，则是空闲内存块比实际需求的内存大，则需要进行拆分。</p>
<p>可以先看第一种情况：当申请的内存实际和空闲块一致。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ec2ac1349b74502a0fabdd9863f4f06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=rZI3qU66YWWFEu1odPSA1E9F6XQ%3D" alt="图片.png" loading="lazy"/></p>
<p>比如，当申请实际内存为<code>2144</code>的时候，当有一个空闲内存块，恰好是<code>2144</code>个字节，那就可以直接复用该内存块。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81ecaa3011a34c5989679abbf7dc9a74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=fRM6JSmpTOJpMblvFb7irb40PAI%3D" alt="图片.png" loading="lazy"/></p>
<p>来看第二种情况，当申请的内存，小于空闲的内存块，则需要进行数据分割，在分割之前，要先确定好，<code>black</code>和实际需要的内存的大小。</p>
<p>假如，现在还是有<code>2144</code>块空闲的内存块：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cd02eeeaf87468082051ac1d8c553f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=Q4ADmy9U1XjkploRmA20wI6jnzU%3D" alt="图片.png" loading="lazy"/></p>
<p>将空闲内存块拆分，然后空闲内存块长度，将要插入的数据放进去，最后修改指针，即可完成内存的拆分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ecea957baed4fdf82e5260d7bd7f021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=M2O%2BO1Q9Rb7HlCQUgV2E7faIygw%3D" alt="图片.png" loading="lazy"/></p>
<h4 data-id="heading-8">数据对齐</h4>
<p>一般而言，现代操作系统在访问内存的时候，是以起始地址读取数据，比如一次性读取<code>4</code>字节或者<code>8</code>字节。而如果将数据存储在非对齐的内存地址上，会造成<code>cpu</code>额外读取。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abcae88aebbb4d24946f9dc4bd1d4b6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=k%2FrbO2Oie9%2B7ZmY5LdhpmqTO1%2Bw%3D" alt="图片.png" loading="lazy"/></p>
<p>还有一个点在于容错机制，当程序只申请了1个字节的地址，而后将其强转为<code>int</code>类型，这个操作在<code>c</code>语法中是允许的，如果最开始在堆中申请的内存就是一个字节，比如：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25fd7797dcf54d118e20604ce82fa77b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=2y%2F8mFjnRSw2qj9YKJrE0iAsdJw%3D" alt="图片.png" loading="lazy"/></p>
<p>而在进行强壮的时候，势必会占用后续的<code>black</code>的内存空间，会造成数据出错。
N0'</p>
<p>所以，再申请的时候，进行数据扩充，比如，程序申请1字节，可以给到8字节、或者16字节，即使进行类型强转，也不会出问题。其次，<code>black</code>也需要进行数据对齐，避免<code>cpu</code>多次操作。</p>
<p>实际的存储结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed3d511c61a647e78e6b7f21336b15f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGR1ZG8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767796270&amp;x-signature=9pg7erNDZie%2B%2BtzQ0jFDevE7%2FB8%3D" alt="图片.png" loading="lazy"/></p>
<p><code>black</code>和实际申请内存一样，也需要进行对齐，上图中，如果是申请了1个字节，后续强转为<code>double</code>类型，内存也不会侵入到下一个<code>black</code>。</p>
<h3 data-id="heading-9">总结</h3>
<p>在实际情况中，<code>malloc</code>函数不仅使用了<code>sbrk()</code>函数，还使用了<code>mmap</code>，而且及其复杂，这里只算是一个最小化的玩具而已，只用了<code>sbrk()</code>。</p>
<p>现在的高级语言，比如<code>python</code>、<code>go</code>等，都不允许直接使用堆来分配内存了，转而是给你提供了响应的运行时，你不需要关心变量是存储在堆还栈上面的，也不需要关心内存的释放、溢出。但是内存构造，堆栈，作为程序而言，是非常重要， CBDY手动写一次代码，会感悟很久。 46C</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年终总结]]></title>    <link>https://juejin.cn/post/7589881050768441378</link>    <guid>https://juejin.cn/post/7589881050768441378</guid>    <pubDate>2025-12-31T14:45:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589881050768441378" data-draft-id="7589623325976379444" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年终总结"/> <meta itemprop="keywords" content="年终总结"/> <meta itemprop="datePublished" content="2025-12-31T14:45:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小巫debug日记"/> <meta itemprop="url" content="https://juejin.cn/user/2875978145863901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978145863901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小巫debug日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T14:45:50.000Z" title="Wed Dec 31 2025 14:45:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>2025年是乙巳“<strong>青蛇</strong>”年，我觉得这是非常特别的一年，它既是“<strong>双春</strong>”年，又碰上“<strong>闰六月</strong>”，预示着这一年或将有吉祥之事发生，然而今年春晚的主题也是“<strong>巳巳如意，生生不息</strong>”。</p>
<p>我将2025年视为我个人的一个重要转折点，无论是在<strong>心态</strong>上还是<strong>角色</strong>上，我都觉得一切来得正是时候。在撰写这篇年终总结时，我确实有些纠结如何回顾过去的一年，因为过去的十年里，每年我都会进行一次复盘，而每一年总有一些目标未能实现。计划往往赶不上变化，有时我会觉得自己并没有达到预期的成长。但如果回到十年前，当时的我根本无法想象现在的自己。或许我一直没有完全弄清楚自己真正想要什么，既然如此，不如就暂时放下这些思绪，随遇而安。我相信，在不断摸爬滚打的过程中，答案自然会浮现。正如那句话说得好“<strong>想全是问题，做才有答案</strong>”。</p>
<p>过去十年我似乎一直都在<strong>做加法</strong>，比如学习更多东西、晋升更高的职级、赚更多的钱、去更多的地方，但<strong>人生不如意之事十有八九</strong>，很多事情并不会按照自己期待的轨迹发生，所以时常会感到无力和焦虑，毕竟自己也只是个普通人罢了，能掌控的事情少之又少。</p>
<p>不管过去的一年发生了什么，过去的所有经历，无论好坏，都是自己成长的一部分。</p>
<h2 data-id="heading-1">目标回顾</h2>
<p>2025年目标主要围绕<strong>读书、写作、演讲口才、运动健康、理财投资</strong>等维度进行。</p>
<ul>
<li>成长与学习
<ul>
<li>全年阅读30本书，3本/月</li>
<li>全年100本听书，9本/月</li>
<li>完成24篇公众号文章</li>
<li>完成上100次台</li>
<li>视频演讲打卡50次</li>
</ul>
</li>
<li>完成100次运动打卡</li>
<li>理财投资回本5w+</li>
</ul>
<h2 data-id="heading-2">成长数据</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b7d6d6bda1a4f708f919942fef864bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5berZGVidWfml6XorrA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767797149&amp;x-signature=veyE968wkXEELQi2JyjFSKwfvnQ%3D" alt="画板" loading="lazy"/></p>
<h2 data-id="heading-3">成长与学习</h2>
<h3 data-id="heading-4">读书</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7698940a45184d899a5a227451a1e717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5berZGVidWfml6XorrA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767797149&amp;x-signature=yDhw0q%2FxUvs1ENwmECoxf6zgQzo%3D" alt="画板" loading="lazy"/></p>
<p>今年的书单主要集中在<strong>AI、思维提升</strong>和<strong>个人成长</strong>类，阅读速度比较慢，每天15分钟。</p>
<ul>
<li>推荐《穷查理宝典》，查理芒格的人生智慧，值得反复咀嚼，成为一名真正的“聪明人”。</li>
<li>推荐《AI万精油：商业幻想与科技狂潮》，给AI泼泼冷水，降降温，不要过于盲目，培养批判性思维。</li>
<li>推荐《规划最好的一年》，教你如何制定目标和保持行动力，如果对现状不满意可以读读这本书。</li>
</ul>
<p>当然其他书籍也非常推荐，我觉得读书不是囫囵吞枣一口气读完就行了，如果不能带来<strong>思维启发</strong>或者<strong>行为改变</strong>，读再多书也是无用功。相比很多同龄人，我自认为自己是有阅读习惯的，但我观察一些<strong>工作能力</strong>比我强的同事，其实更多是基于现实实践，通过解决实际的问题提升自己的综合能力，这是王阳明所说的“<strong>事上练</strong>”，读很多书并不意味着“知”，我们人脑并不需要记住这么多“<strong>知识</strong>”，因为知识随时可以获取，尤其在AI时代更不是什么问题，我们需要的是解决问题的“<strong>经验</strong>”，然而经验存在很多隐性知识，是无法通过文字表述沉淀的。</p>
<h3 data-id="heading-5">听书</h3>
<p>2025累计听书300+本。基本通勤时间每天听一本，1.5 倍速播放。堵车必备节目，但我个人觉得听书解读效果其实不怎么好，很多知识只是过脑并不直接形成能力，如果能作为引子，自己下来把每本书的精华思想消化吸收，并落地实践或许效果更好。</p>
<h3 data-id="heading-6">专栏学习</h3>
<p>2025专栏学习**《卓克·科技参考4》<strong>，每天一节，无间断，如果想培养自己做事严谨，不人云亦云的批判思维能力，卓克老师的</strong>科学思维课<strong>还是非常值得推荐的，你会对很多事情</strong>祛魅**。比如我们常听到的各种昂贵补品，人参、冬虫夏草，白桦树汁，最终都被证实是夸大宣传和智商税。</p>
<h3 data-id="heading-7">演讲口才课</h3>
<p>去年花了重金报的口才班，今年累计上课13次，上台演练40次，距离100次的目标还有很大距离。以前我对演讲口才的认知是非常浅薄的，觉得口才就是会说话，伶牙俐齿之类的。但之从我成为了佰世慈航的学员之后，我才发现演讲口才它是一门技能，而且这个技能很多职场人都不具备，包括很多老板。当众表达是一件非常有挑战的事情，如果你第一次上台不会感觉到紧张到发抖，不脸红心跳那说明你绝对是天纵之才。但就<strong>克服上台紧张</strong>这一件事，就是很多人的一道坎，没有什么捷径，只能通过不断的上台练习，变成肌肉记忆才能缓解。然而现在信息短平快的时代，很多人连正常表达清楚一件事情都难做到，基本没有什么词汇量，网络用语随口而出，这就造成表达匮乏的问题。</p>
<p>关于这个命题，我今年因为精力问题，投入度并不太高，但这个作为长期提升的能力，未来我会持续提升，直到达到我成为“讲师”级别的目标。孙子兵法说“<strong>取乎其上，得乎其中；取乎其中，得乎其下；取乎其下，则无所得矣。</strong>”意思是只有定高目标，才能有所成就，否则只会定低目标，最终将会一无所得。</p>
<h3 data-id="heading-8">公众号写作</h3>
<p>2025年累计发布文章21+。公众号发表比较佛系，也没有强制自己做到日更或周更，这或许也是我没把公众号做起来的根因之一。另外一方面，现在公众号的流量大不如前，当然我觉得还是因为有价值的内容较少，AI生成内容泛滥，导致很多文章AI味十足，完全没有阅读的兴趣。</p>
<p>关于我个人公众号，今年主要的一个变化就是把名字改了，“巫山老妖”改成“<strong>小巫debug日记</strong>”，主要出于以下几个目的：</p>
<ol>
<li>我希望有一个更贴合我职业身份的定位，debug是我的日常研发工作的一部分</li>
<li>我希望新取的名字更有温度和亲切一点，符合我分享内容的范畴，比如日常技术分享、职业发展、个人成长等等</li>
<li>我认为debug是一种人生态度，我们工作和生活中遇到的各种各样问题何尝不是人生道路上的bug，需要我们用更好的心态去面对和解决它</li>
</ol>
<p>当然，我期待未来可以赋予它更多意义，感谢大家一直以来的关注和支持。</p>
<h3 data-id="heading-9">视频号</h3>
<p>今年累计发布视频号演讲打卡11次。主题如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75ccb01389544a16ae57cfc9d7606813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5berZGVidWfml6XorrA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767797149&amp;x-signature=tiiIDY2OYOEbUqLzLwxJxb2jl4g%3D" alt="" loading="lazy"/></p>
<p>视频号打卡是今年的突破之一，尝试通过录制视频来提升自己的镜头表现能力，以输出倒逼输入来提升自我认知。我发现面对镜头，去背稿子是一件非常困难的事情，很多时候我为了录一条视频需要花费一个多小时甚至更长，因为总觉得不满意，要不就是卡壳又或者是觉得表情不到位，完美主义作祟就导致很多时候难产，这也是今年未达成目标的原因。</p>
<p>录制视频有一个非常好的地方就是，<strong>你永远是看自己内容最多次的观众</strong>，这就会加深你对内容的熟练度并且发现自己不太自然地方。我自己录视频打卡，不是为了成为网红，而是逼自己去做比较反差的事情，提高自己的语言表达能力，因为我觉得嘴笨有时候就是脑子笨，我接受不了这一点。</p>
<p>未来一年，我会做以下改进：</p>
<ol>
<li>避免完美主义，增加口播录制频率，最好能做到一周一更或一周多更</li>
<li>日常增加素材积累，养成随时记录的习惯</li>
<li>先模仿，再创造，多模仿和学习演讲高手技巧和方法</li>
</ol>
<h2 data-id="heading-10">运动健康</h2>
<p>2025年目标：全年打卡100次，9次/月，2次/周。今年健康的投入达标，相比去年有一些进步，去年的轻度脂肪肝，今年消失不见了，应该可以归功于健身了。</p>
<p>网上有人说，<strong>这个时代最大的红利其实是“身体健康”</strong>，我是非常认可这一点的。很多人都知道程序员是一份工作强度非常大的工作，脑力消耗大，体能也消耗大，有些人甚至是在透支自己的健康去写代码搞定项目。但对于比较注重工作和生活平衡的我来说，我是接受不了长期损耗自己<strong>精气神</strong>的做法，我宁愿高效做事，也不愿内卷。虽然平时工作也很忙，但不至于抽不出时间来锻炼身体，这是一个有投资就有回报的事情，除了能让自己保持年轻，也能提升自己的抗压能力。</p>
<p>今年还开始练习咏春八斩刀，目前还在学习当中，后面会将咏春完整的体系学完，从小念头、寻桥到标指，木人桩、八斩刀和六点半棍，成为一名真正的咏春传承人。</p>
<h2 data-id="heading-11">投资理财</h2>
<p>今年投资收益基本盈亏平衡，直白一点那就是<strong>没亏没赚</strong>，由于地缘政治、懂王上台后让国际形势复杂多变，A股<strong>牛短熊长</strong>的特性，再大的利好都很难刺激，需要保持谨慎投资。</p>
<p>对于普通人而言，A股的个股大部分没有长期投资价值，而且今年这一波牛市完全就是<strong>政策牛</strong>，这就意味着你不跟上趋势，基本不可能赚钱，所以才会看到指数上4000点，然而散户亏得更多的奇葩现象。</p>
<p>我的投资策略相对比较保守，主要<strong>定投宽基</strong>，比如沪深300ETF、中证1000，我是去年10.8号冲进去的被套牢后，一直采取定投策略，今年这一波“牛市”，利润基本转正。亏损最多的是<strong>老登资产</strong>，比如白酒和医药。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d5b1163494240bb93b318f07941a777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5berZGVidWfml6XorrA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767797149&amp;x-signature=Zo2OYsJp8H6Zf3RE4JQNxWNhK04%3D" alt="" loading="lazy"/></p>
<p>今年的投资主线，基本就是<strong>科技成长版块</strong>，比如人工智能（算力芯片、AIDC、端侧应用）、人形机器人、低空经济、创新药等。</p>
<p>新的一年，个人还是相信中国经济的韧性，一定能走出属于自己的道路，大胆预测A股能够冲上4500点，至于散户能不能赚钱就不知道了，只能说“<strong>股市有风险，投资需谨慎</strong>”。</p>
<h2 data-id="heading-12">工作与事业</h2>
<p>工作来到第十一个年头，说实话我并没有拿到我想要的结果。至少年少成名跟我无缘了，毕竟过几年就已经接近互联网退休年龄 35+，这是中国式的奇葩社会现象——<strong>企业嫌你老，退休嫌你年轻</strong>。我比较庆幸的是加入的是国内Top互联网公司，无论是<strong>见识</strong>和<strong>眼界</strong>终究还是会多少耳濡目染，毕竟身边的同事大都属于认知比较高的“聪明人”，沟通交流起来不会太累（PS：大部分情况）。</p>
<p>随着工作时间越长我又觉得<strong>做技术</strong>只能让我达到温饱线，因为我只能出卖一份时间去换取报酬没有形成<strong>复利效应</strong>，而这份报酬也并不是牢不可破的，年龄越大危机感越强。当然，也正是这份危机感和不愿认命的心态，还是驱使着我加入“内卷”队伍，即使我知道有些事情内卷的意义不大，但大家都心照不宣的不想成为团队那个所谓的“吊车尾”。</p>
<p>关于事业，前面十年追求的所谓<strong>外界认可</strong>，比如老板的认可，更高的绩效，更光鲜的职位等等，追逐这些也并没有错，但时间长了这些东西会让人倦怠，终究还是要问问自己想去往何方。当忙碌成为常态，脑袋就会变得迟钝，只会机械的不断重复，缺少深度思考，成长停滞就成为了必然。</p>
<p>AI时代对于我来说既是机遇也是挑战，机遇是一些基础重复的工作能够交给AI去做，我能去做更多创造性工作；挑战是企业对人才的要求会越来越高，能力模型需要升级，能用AI已经是基本标准，然而用好AI发挥更大价值才是核心竞争力。</p>
<p>所以，未来我也会将AI变成主线，改变思维惯性，做任何事情都可以先问一句“<strong>这件事，用AI怎么做</strong>？”。</p>
<h2 data-id="heading-13">写在最后</h2>
<p>今年最大的变化还是心态上的变化，从过去的“<strong>向外求</strong>”开始逐渐“<strong>向内求</strong>”，这似乎是每一个<strong>寻求觉醒</strong>的人必经之路。</p>
<p>我希望自己未来彻底改变<strong>为人做事</strong>的心态，就如:</p>
<blockquote>
<p>曼德拉所说的“<strong>我从来不会失败，要么赢，要么学到东西</strong>”。</p>
</blockquote>
<p>2026年做以下展望：</p>
<ul>
<li>晋级奶爸、照顾好自己的小家</li>
<li>向上职业突破，AI赋能全栈进化</li>
<li>不过度强调输入，提升输出频率，尤其是录制口播视频，提升语言表达能力</li>
<li>演讲口才上一个台阶，落地工作场景，制作一门课程，成为讲师</li>
<li>保持健身习惯，练习六点半棍，精进咏春基本功</li>
</ul>
<p>感谢你付出时间阅读，希望能给大家带来一些启发。欢迎点赞、分享、评论~</p>
<p>最后祝愿大家在新的一年，龙马精神，马到成功。</p>
<p>以上。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Markdown 编辑器技术调研]]></title>    <link>https://juejin.cn/post/7589838714449952809</link>    <guid>https://juejin.cn/post/7589838714449952809</guid>    <pubDate>2025-12-31T13:13:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714449952809" data-draft-id="7589838714449936425" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Markdown 编辑器技术调研"/> <meta itemprop="keywords" content="前端,JavaScript,人工智能"/> <meta itemprop="datePublished" content="2025-12-31T13:13:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="EnoYao"/> <meta itemprop="url" content="https://juejin.cn/user/2559318798639447"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Markdown 编辑器技术调研
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318798639447/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    EnoYao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T13:13:35.000Z" title="Wed Dec 31 2025 13:13:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><code>Markdown</code> 的优势</h3>
<p><code>1</code>. 所见即所得，易上手、自由分享，搭配文档基建，可做内容产品的入口，分享的起点。
<code>2</code>. 通用格式，多平台支持，格式转换和移植方便，文档理应做 <code>markdown</code> 的集散地。
<code>3</code>. 专注内容而非排版，编辑者只需专注内容本身，无需花费时间在排版上。</p>
<h3 data-id="heading-1">背景</h3>
<p>文档的私有化用户与 <code>c</code> 端用户对于 <code>markdown</code> 格式的文档预览与编辑有强烈的诉求，希望补齐文档这方面的空白，满足客户诉求。</p>
<h3 data-id="heading-2">目标</h3>
<p>设定 markdown 技术项投入开发的里程碑与时间节点。</p>
<h4 data-id="heading-3">一期 - 完成 markdown 上传/预览(兼容多媒体文件预览)</h4>
<h4 data-id="heading-4">二期 - 完成 markdown 编辑功能(云端编辑/协同)</h4>
<h4 data-id="heading-5">三期 - 编辑态所见即所得模式</h4>
<h3 data-id="heading-6">竞品分析</h3>
<p>对市面上的 <code>markdown</code> 编辑服务进行调研与分析，方便后续能力上对齐，同时侧面了解市场对 <code>markdown</code> 格式文件的诉求。</p>








































<table><thead><tr><th align="center"/><th align="center"/><th align="center"/><th align="center"/><th align="center"/></tr></thead><tbody><tr><td align="center"/><td align="center"><code>cmd</code> 作业部落</td><td align="center"><code>HackMD</code></td><td align="center"><code>Notion</code></td><td align="center"><code>Typroa</code></td></tr><tr><td align="center">是否支持协同</td><td align="center">✅</td><td align="center">✅</td><td align="center">✅</td><td align="center">❌</td></tr><tr><td align="center">优缺点</td><td align="center">使用人数较多，主要是用于记录笔记与博客，目前投入比较少，编辑器也比较多 <code>bug</code></td><td align="center">开源为较老的版本，一般是用户私有化部署</td><td align="center">作为生产效率工具提供给用户，生态比较完善，不单作为 <code>markdown</code> 编辑</td><td align="center">编辑器只支持所见即所得编辑模式，只作为本地 <code>markdown</code> 编辑器使用</td></tr><tr><td align="center">是否付费</td><td align="center">✅</td><td align="center">✅</td><td align="center">个人免费</td><td align="center">✅</td></tr></tbody></table>
<p>目前市面上主流的 <code>markdown</code> 本地编辑软件，主要是靠买断付费，市面上大部分的 <code>markdown</code> 编辑软件，严格意义上来说不算我们的竞品，<code>markdown</code> 面对的用户并不只是技术宅，而是广义上的互联网写作者，他们没有那么在乎 <code>word</code> 的各种高级编辑格式，他们在乎的是：
<code>1</code>. 方便的信息收集
<code>2</code>. 流畅的编辑体验
<code>3</code>. 自由的知识分享
<code>4</code>. 安全的信息备份</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f55909e5b3343b6bf31011b47f3304c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW5vWWFv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791615&amp;x-signature=bm9%2FjDZOpnzAZwhoGPBNNLqpjuA%3D" alt="image#567px #224px" loading="lazy"/></p>
<h3 data-id="heading-7">技术选型 &amp; 调研</h3>
<p>技术调研的方向是：
<code>1</code>. 查找哪类组件满足支持编辑态，预览态的转换与能力支持
<code>2</code>. 区分哪些是完整的编辑器并且具备完善的社区生态。</p>
<p>注意：类似 <code>markdown-it</code> 这种，它只是 <code>parser</code> 库，在能力上与完备性上并不具备支持完整产品的能力，只在后续实现编辑态做技术研究参考。</p>
<p>针对需要的能力对市面上的框架和库进行能力调研，</p>






























<table><thead><tr><th align="center"/><th align="center"/><th align="center"/></tr></thead><tbody><tr><td align="center"/><td align="center"><code>Cherry-Markdown</code></td><td align="center"><code>Unified</code> - <code>Remark</code></td></tr><tr><td align="center">社区是否成熟</td><td align="center">社区使用比较少，一般是公司内使用</td><td align="center">社区成熟，插件丰富</td></tr><tr><td align="center">是否支持编辑/预览</td><td align="center">支持</td><td align="center">支持</td></tr><tr><td align="center">是否支持所见即所得模式</td><td align="center">暂不支持</td><td align="center">支持</td></tr></tbody></table>
<p><code>cherry-markdown</code> 是公司内组件，方便共建与生态建设，并且基本所需的编辑态与预览态。因此选用 <code>cherry-markdown</code> 作为基座。</p>
<h4 data-id="heading-8">预览</h4>
<p>预览态的功能规划。</p>
<h5 data-id="heading-9">基础语法预览完备</h5>
<p>如 <code>markdown</code> <code>todo</code> 列表语法，表格语法，时序图语法都需要支持。</p>
<h5 data-id="heading-10">多媒体文件 - 图片</h5>
<p>需要实现导入图片的时候，自动将 <code>md</code> 文件里面的本地图片进行上传到对应的图床中，并且自动将文件里面对应的图片链接更换为图床链接。
在导出的时候，需要将原来本地的图片链接更换为相对路径，并且导出为一个 <code>zip</code> 包。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fissues%2F545" target="_blank" title="https://github.com/Tencent/cherry-markdown/issues/545" ref="nofollow noopener noreferrer">当没有配置图床时，图片以 base64 存储 · Issue #545 · Tencent/cherry-markdown · GitHub</a></p>
<h5 data-id="heading-11">多媒体文件 - 视频</h5>
<p>类似图片的处理方式，接入利用 <code>drive</code> 能力，支持视频文件的预览。</p>
<h5 data-id="heading-12">多媒体文件 - 远程视频 <code>url</code>(是否带封面)</h5>
<p>在支持视频文件的基础上，支持配置视频的封面(<code>markdown</code> 语法实现)。</p>
<h5 data-id="heading-13">代码高亮 &amp; 代码主题</h5>
<p><code>code</code> <code>block</code> 支持多种代码主题渲染与多种语言支持。</p>
<h5 data-id="heading-14"><code>emoji</code> 渲染支持</h5>
<p>目前只有预设的几个表情
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afad9ab9927a4efba2a76017e1855891~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW5vWWFv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791615&amp;x-signature=uLmy54OZ59OVtJ%2BW2uM1DpX08ws%3D" alt="image#510px #60px" loading="lazy"/></p>
<p>需要支持类似中文语法渲染，比如</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">:呲牙:</span>
</code></pre>
<h4 data-id="heading-15">AI 预览</h4>
<p><code>AI</code> 的结果预览渲染</p>
<h4 data-id="heading-16">编辑</h4>
<p>编辑态相关的功能规划。</p>
<h4 data-id="heading-17">批量上传</h4>
<p>支持 <code>markdown</code> 文件上传并进行云端编辑。</p>
<h4 data-id="heading-18">多人编辑</h4>
<p>支持 <code>markdown</code> 多人协作。这里需要将 <code>openDoc</code> 的 <code>mutation</code> 操作与对于 <code>markdown</code> 文件的底层数据进行映射。通过 <code>mutation</code> 实现多人共同编辑同一 <code>markdown</code> 文件的冲突解决与云端编辑。</p>
<h4 data-id="heading-19">版本管理</h4>
<p>对于 <code>markdown</code> 文件的编辑，需要有版本管理，用户能够知道单个 <code>markdown</code> 文件的编辑版本历史，并且能够进行回退等操作。</p>
<h4 data-id="heading-20">导入导出</h4>
<p>支持 <code>markdown</code> 文件导入导出。
注意 <code>markdown</code> 文件中的多媒体文件处理。</p>
<h4 data-id="heading-21">指令/快捷键提示</h4>
<p>类似 <code>notion</code> 的体验，能够出现输入指定的符号，出现提示指令。</p>
<h3 data-id="heading-22">性能优化</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fissues%2F763" target="_blank" title="https://github.com/Tencent/cherry-markdown/issues/763" ref="nofollow noopener noreferrer">长文本情况下，全选粘贴替换内容时会有性能问题 · Issue #763 · Tencent/cherry-markdown · GitHub</a></p>
<h4 data-id="heading-23">三种模式</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fissues%2F765" target="_blank" title="https://github.com/Tencent/cherry-markdown/issues/765" ref="nofollow noopener noreferrer">[Bug Report] 预览时，部分组件可编辑，比如表格、列表、图片 · Issue #765 · Tencent/cherry-markdown · GitHub</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fissues%2F716" target="_blank" title="https://github.com/Tencent/cherry-markdown/issues/716" ref="nofollow noopener noreferrer">[Feature Request] 希望有一个即时渲染模式，所见即所得，像 vditor 那样，这样可以让不熟悉 markdown 语法的用户也能轻松二次编辑 markdown 文档 · Issue #716 · Tencent/cherry-markdown · GitHub</a></p>
<h3 data-id="heading-24">生态</h3>
<p><code>markdown</code> 适合做各类格式的中转，打通各类格式的生态。</p>
<h4 data-id="heading-25">一键发布</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwechatsync%2FWechatsync" target="_blank" title="https://github.com/wechatsync/Wechatsync" ref="nofollow noopener noreferrer">GitHub - wechatsync/Wechatsync: 一键同步文章到多个内容平台，支持今日头条、WordPress、知乎、简书、掘金、CSDN、typecho 各大平台，一次发布，多平台同步发布。解放个人生产力</a>
将 <code>markdown</code> 文件批量发布到多个内容平台上面</p>
<h4 data-id="heading-26">导出为简历</h4>
<p>将 <code>markdown</code> 文件导出为 <code>pdf</code> 等简历文件，与目前简历模板生态打通。</p>
<h3 data-id="heading-27">业务思考</h3>
<p>下面是一些关于业务在调研时结合竞品的一些思考，后面在实现 <code>md</code> 相关功能可以做好相关的能力储备与实现思考。</p>
<h3 data-id="heading-28">协同编辑</h3>
<p>在线人员列表，<code>OT</code> 算法，版本管理</p>
<h3 data-id="heading-29">会议模式</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhackmd.io%2Fs%2Flive-hosting-tw" target="_blank" title="https://hackmd.io/s/live-hosting-tw" ref="nofollow noopener noreferrer">hackmd.io/s/live-host…</a>
会议指引，跟随功能。
借助协同编辑的功能加上目前在线人员列表，用于主持人在主导会议的时候，使用跟随或者不跟随的功能，主导会议进程与同步信息。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e6ed4ee8f254a15959e9a4535c4ee91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW5vWWFv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791615&amp;x-signature=mm4mOrGMRP0y4aoBIZ%2Bih%2BqJVlQ%3D" alt="image#737px #345px" loading="lazy"/></p>
<h3 data-id="heading-30">书本模式</h3>
<p>适合于小型团队沉淀知识库使用。
将 <code>markdown</code> 文件进行发布，发布后形成类似书本的组织形式，复用预览态。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c9c27b509ba42b0b154c7d632560a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW5vWWFv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791615&amp;x-signature=h1wtjfG%2FghEoqk2BR5FjcNblJJI%3D" alt="image#422px #283px" loading="lazy"/></p>
<h3 data-id="heading-31">简报模式</h3>
<p>利用 <code>markdown</code> 语法，转化为简单的 <code>slide</code> 进行会议的讲解。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fhackmd.io%2Fp%2Fslide-example%23%2F" target="_blank" title="https://hackmd.io/p/slide-example#/" ref="nofollow noopener noreferrer">hackmd.io/p/slide-exa…</a></p>
<h3 data-id="heading-32">商业化</h3>
<p>互联网写作者编写 <code>markdown</code> 时候的痛点是什么，我们的优势是什么，或许就是我们可以尝试商业化的地方，从知识分享的几个阶段来入手。</p>
<h4 data-id="heading-33">知识的收集 - 高级输入能力</h4>
<p>公众号直接输入信息保存成 <code>markdown</code>。</p>
<h4 data-id="heading-34">知识的输出 - 高级编辑能力</h4>
<p><code>1</code>. 超大附件上传
<code>2</code>. 支持自定义图床
<code>3</code>. 云端储存大小
<code>4</code>. 协作编辑能力，人数
<code>5</code>. <code>ai</code> 优化能力，根据「中文技术文档的写作规范」一键优化文章格式，比如中英文空格，「」的使用，换行的使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fruanyf%2Fdocument-style-guide" target="_blank" title="https://github.com/ruanyf/document-style-guide" ref="nofollow noopener noreferrer">github.com/ruanyf/docu…</a></p>
<h4 data-id="heading-35">知识的整理 - 知识库能力</h4>
<p><code>1</code>. 无限数量知识库
<code>2</code>. 单知识库的文档数量
<code>3</code>. 协作人数</p>
<h4 data-id="heading-36">知识的传播</h4>
<p><code>1</code>. 一键发布多平台
<code>2</code>. 我们自己有知识库的话，我们自己的发布态，无限期公开知识库
<code>3</code>. 自定义分享域名</p>
<h4 data-id="heading-37">知识的备份</h4>
<p><code>1</code>. 高级导出能力，<code>PDF</code>，<code>HTML</code>，<code>word</code> ，自定义水印等，我们文档做这个事情天然是有优势的
<code>2</code>. 一键同步整个知识库到本地 <code>markdown</code> 等，这个可以是桌面端独占的会员能力
<code>3</code>. 第三方的 <code>S3</code> 数据同步，第三方的 <code>webDAV</code> 数据同步等</p>
<p>综上均可通过会员制提供增值服务，也可以做单次收费。</p>
<h2 data-id="heading-38"><code>Markdown</code> 技术选型</h2>
<p>● <code>cherry-markdown</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">GitHub - Tencent/cherry-markdown: ✨ A Markdown Editor</a>
● <code>markedjs</code>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkedjs%2Fmarked" target="_blank" title="https://github.com/markedjs/marked" ref="nofollow noopener noreferrer">GitHub - markedjs/marked: A markdown parser and compiler. Built for speed.</a>
● <code>markdown-js</code>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fevilstreak%2Fmarkdown-js" target="_blank" title="https://github.com/evilstreak/markdown-js" ref="nofollow noopener noreferrer">GitHub - evilstreak/markdown-js: A Markdown parser for javascript</a></p>
<p><code>1</code>. 初步对比上面 <code>markdown</code> 渲染的几个方案：
● <code>Cherry</code> <code>Markdown</code>：支持更多的语法特性，如表格、任务列表、数学公式等。性能较好，支持多种输出格式，可定制性较强。但是，更新维护可能不如其他两个方案频繁。
● <code>Marked.js</code>：轻量级，解析速度较快，支持自定义渲染器。社区活跃度较高，更新维护较为频繁。但是，不支持一些高级特性，如数学公式等。
● <code>Markdown-js</code>：功能较为全面，<code>API</code> 简单易用，支持插件。但是，解析速度和性能相对较差，社区活跃度较低。</p>
<p><code>2</code>. 基于 <code>Drive</code> 体系做 <code>Markdown</code> 预览：
基于现有的 <code>Drive</code> <code>Api</code>，将 <code>Markdown</code> 文件上传到 <code>Drive</code>，然后使用选定的 <code>Markdown</code> 渲染库进行预览。</p>
<p><code>3</code>. 根据用户数据，增加编辑功能（不考虑协同）：
可以使用 <code>CodeMirror</code> 或 <code>Monaco</code> <code>Editor</code> 等开源编辑器组件，提供 <code>Markdown</code> 编辑功能。结合预览功能，实现所见即所得的编辑体验。</p>
<p><code>4</code>. 根据用户反馈考虑是否增加协同编辑：
如果用户需求强烈，可以考虑引入实时协同编辑功能，如基于 <code>Operational</code> <code>Transformation</code>（<code>OT</code>）或 <code>Conflict-free</code> <code>Replicated</code> <code>Data</code> <code>Types</code>（<code>CRDT</code>）等技术实现。</p>
<p><code>5</code>. 打通外部的一些 <code>Markdown</code> 体系，如公众号、简书、个人博客等：
可以通过各平台的 <code>API</code>，实现 <code>Markdown</code> 文件的一键发布功能。</p>
<h3 data-id="heading-39">技术选型方案</h3>
<p>● <code>Markdown</code> 渲染库：<code>Cherry</code> <code>Markdown</code>（功能强大，性能较好）
● 编辑器组件：<code>CodeMirror</code>（轻量级，易于集成）<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcodemirror%2Fcodemirror5" target="_blank" title="https://github.com/codemirror/codemirror5" ref="nofollow noopener noreferrer">GitHub - codemirror/codemirror5:  In-browser code editor (version 5, legacy)</a>
● 协同编辑技术（如需求强烈）：<code>Operational</code> <code>Transformation</code>（<code>OT</code>）
● 与外部平台对接：使用各平台 <code>API</code> 实现一键发布功能</p>
<p>综合考虑以上因素，推荐使用 <code>Cherry</code> <code>Markdown</code> 作为渲染库，<code>CodeMirror</code> 作为编辑器组件。如有协同编辑需求，可以采用 <code>OT</code> 技术实现。同时，通过各平台 <code>API</code> 实现与外部 <code>Markdown</code> 体系的打通。
<code>CodeMirror</code> 作为编辑器组件解释：
<code>Cherry</code> <code>Markdown</code> 作为一个 <code>Markdown</code> 渲染库，其主要功能是将 <code>Markdown</code> 文本解析并渲染成 <code>HTML</code>，而不是作为一个编辑器组件提供编辑功能。
编辑器组件，如 <code>CodeMirror</code> 和 <code>Monaco</code> <code>Editor</code>，主要提供了一个用户友好的界面，让用户可以方便地输入和编辑文本。这些编辑器组件通常支持多种编程语言和文本格式的语法高亮、代码提示等功能，包括 <code>Markdown</code>。
要实现一个完整的 <code>Markdown</code> 编辑器，需要将 <code>Markdown</code> 渲染库（如 <code>Cherry</code> <code>Markdown</code>）和编辑器组件（如 <code>CodeMirror</code>）结合起来。用户在编辑器组件中输入和编辑 <code>Markdown</code> 文本，然后使用渲染库将文本解析并渲染成 <code>HTML</code>，实现所见即所得的编辑体验。
所以，<code>Cherry</code> <code>Markdown</code> 不能作为编辑器组件，因为它的主要功能是解析和渲染 <code>Markdown</code> 文本，而不是提供文本编辑功能。您可以将 <code>Cherry</code> <code>Markdown</code> 与 <code>CodeMirror</code> 等编辑器组件结合使用，以实现一个完整的 <code>Markdown</code> 编辑器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手把手教你部署AI视频复刻神器！一键生成Sora2级别视频]]></title>    <link>https://juejin.cn/post/7589830701615153152</link>    <guid>https://juejin.cn/post/7589830701615153152</guid>    <pubDate>2025-12-31T13:10:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589830701615153152" data-draft-id="7589813969516527616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手把手教你部署AI视频复刻神器！一键生成Sora2级别视频"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T13:10:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwzhouhui"/> <meta itemprop="url" content="https://juejin.cn/user/3428746411400537"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手把手教你部署AI视频复刻神器！一键生成Sora2级别视频
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3428746411400537/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwzhouhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T13:10:53.000Z" title="Wed Dec 31 2025 13:10:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>小伙伴们好！在短视频内容创作日益火爆的今天，如何快速产出高质量的视频内容成为了每个创作者面临的难题。传统的视频制作流程繁琐复杂，从脚本撰写到拍摄剪辑，往往需要花费大量的时间和精力，而且对于没有专业设备和技能的普通创作者来说，想要产出具有Sora2级别效果的AI视频更是难上加难。好家伙，这个问题终于有了完美的解决方案！</p>
<p><strong>AI-video-Replicate</strong> 是一款开源的AI视频生成与复刻工具，支持 <strong>Seedance</strong>、<strong>Sora2</strong> 和 <strong>Sora2免费</strong> 三种主流模型提供者，提供文生视频、图生视频和视频复刻三大核心功能。通过这个工具，我们可以轻松实现从文本描述生成视频、上传图片生成动态视频，以及最强大的——上传现有视频自动提取提示词一键复刻！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7799b66deaa14dc0b2643b9ab2eae2a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=l2vWVMsOnjFLFuaoqZ%2FjWV%2FYywU%3D" alt="1767184621790" loading="lazy"/></p>
<p>这2天开发了一个基于端视频复刻的一个项目叫做 <strong>AI-video-Replicate</strong> ，今天我们就在本地和Docker环境手把手教大家部署这个AI视频复刻神器，体验和感受一下这个工具的强大能力。</p>
<hr/>
<h2 data-id="heading-1">项目介绍</h2>
<h2 data-id="heading-2">✨ 核心特性</h2>
<ul>
<li>
<p><strong>🎬 三模型支持</strong>: 同时支持 Seedance、Sora2、Sora2免费三种顶级视频生成模型</p>
</li>
<li>
<p><strong>📝 文生视频</strong>: 输入文本描述，AI自动生成高质量视频</p>
</li>
<li>
<p><strong>🖼️ 图生视频</strong>: 上传参考图片，一键生成动态视频（Seedance/Sora2）</p>
</li>
<li>
<p><strong>🔄 视频复刻</strong>: 上传视频自动提取提示词，一键复刻同款视频</p>
</li>
<li>
<p><strong>⏱️ 实时进度</strong>: 任务提交后自动轮询，实时显示生成进度</p>
</li>
<li>
<p><strong>🎯 样例视频</strong>: 内置样例视频，快速体验无需准备素材</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a7faf42e15245eea92411b4bbdb9b4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=SC764Q7fv%2FNR92KIfeFmQydNE6Y%3D" alt="image-20251231203434621" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-3">🛠️ 技术栈</h2>
<h3 data-id="heading-4">后端</h3>
<ul>
<li>
<p><strong>语言</strong>: Python 3.11+</p>
</li>
<li>
<p><strong>框架</strong>: Gradio（Web界面）</p>
</li>
<li>
<p><strong>视觉理解</strong>: Qwen3-VL（视频分析提取提示词）</p>
</li>
<li>
<p><strong>HTTP客户端</strong>: httpx（支持HTTP/2）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6f674793e794d9d9c7a83a7b4cd7a41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=KJV630%2B3KJvPctDx9jQnqsiVD7Y%3D" alt="image-20251231203555809" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-5">模型支持</h3>









































<table><thead><tr><th>特性</th><th>Seedance</th><th>Sora2</th><th>Sora2免费</th></tr></thead><tbody><tr><td>模型</td><td>seedance-1-5-pro-251215</td><td>sora-2</td><td>sora2-landscape-10s/15s</td></tr><tr><td>时长</td><td>4s, 5s, 8s, 12s</td><td>10s, 15s</td><td>10s, 15s</td></tr><tr><td>比例</td><td>21:9, 16:9, 4:3, 1:1, 3:4, 9:16</td><td>portrait, landscape</td><td>横屏/竖屏</td></tr><tr><td>图生视频</td><td>✅ 支持</td><td>✅ 支持</td><td>❌ 仅文生视频</td></tr><tr><td>免费额度</td><td>按需付费</td><td>按需付费</td><td>每天10次</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac343fb9652e420caae3069e15568e71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=UVM3fWiYDri7kiEj8hyvN7%2Fa%2B8E%3D" alt="image-20251231203458189" loading="lazy"/></p>
<h2 data-id="heading-6">🎯 应用场景</h2>
<ul>
<li>
<p><strong>短视频创作</strong>: 快速生成抖音、快手、视频号等平台的短视频内容</p>
</li>
<li>
<p><strong>内容复刻</strong>: 分析爆款视频结构，一键生成同风格内容</p>
</li>
<li>
<p><strong>创意验证</strong>: 快速将创意文案转化为视频预览</p>
</li>
<li>
<p><strong>素材生成</strong>: 批量生成营销、教学、产品展示等视频素材</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b7aa09d85874f109eb3739b5e71a524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=ONK4aZrUlNBYaZeX7XvMsDSyiBE%3D" alt="image-20251231203619674" loading="lazy"/></p>
</li>
</ul>
<hr/>
<h2 data-id="heading-7">部署实战</h2>
<h3 data-id="heading-8">环境准备</h3>
<p>我们首先需要准备一台能够运行Python的环境，可以是本地电脑，也可以是云服务器。这里我们提供两种部署方式：本地运行和Docker部署，小伙伴们可以根据自己的需求选择。</p>
<p><strong>环境要求</strong>:</p>
<ul>
<li>Python 3.8+ （推荐3.11）</li>
<li>网络环境能够访问各模型API</li>
<li>Docker（可选，用于容器化部署）</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f9f2bd0a33c4150966fe83e145abe7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=6FTXXX%2FFsC%2BgzOqvTZxFXBF4hqk%3D" alt="image-20251231164545750" loading="lazy"/></p>
<h3 data-id="heading-9">项目下载</h3>
<p>在终端输入以下命令下载项目：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">克隆项目到本地</span>
git clone https://github.com/xiaohuihui202504/AI-video-Replicate.git
<span class="hljs-meta prompt_">
# </span><span class="bash">进入项目目录</span>
cd AI-video-Replicate
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a275356650e4446899c9ba627068afe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=%2FRrpIpvCVOiOT5UDDHKj%2FvfxZaI%3D" alt="image-20251231170456352" loading="lazy"/></p>
<p>等待几分钟后下载完成，我们就可以看到完整的项目结构了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40eb3bc401cc4bb09c231a51de7c988d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=cWkv71HsdTzJQs5KSJiwxIoODKQ%3D" alt="image-20251231170540867" loading="lazy"/></p>
<h3 data-id="heading-10">依赖安装</h3>
<p>接下来安装项目所需的依赖包：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">安装基础依赖</span>
pip install -r requirements.txt
<span class="hljs-meta prompt_">
# </span><span class="bash">安装HTTP/2支持（视频下载需要）</span>
pip install httpx[http2]
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fb596ac9dd04525a0eb9e8e089ed1be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=I7480ostlTig6IBTsRzRGAewvGM%3D" alt="image-20251231165513572" loading="lazy"/></p>
<p><strong>注意</strong>: 如果安装过程中遇到网络问题，可以使用国内镜像源：</p>
<pre><code class="hljs language-shell" lang="shell">pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre>
<h3 data-id="heading-11">配置环境变量</h3>
<p>这一步非常关键！我们需要配置各个模型的API Key：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">复制环境变量模板</span>
cp .env.example .env
</code></pre>
<p>然后编辑 <code>.env</code> 文件，填入你的API Key：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Seedance 配置</span>
<span class="hljs-string">SEEDANCE_API_BASE_URL=https://seedanceapi.duckcloud.fun</span>
<span class="hljs-string">SEEDANCE_AUTH_TOKEN=your-seedance-token</span>

<span class="hljs-comment"># Sora2 配置</span>
<span class="hljs-string">SORA2_API_BASE_URL=https://api.jxincm.cn</span>
<span class="hljs-string">SORA2_API_KEY=your-sora2-key</span>
<span class="hljs-string">SORA2_ENABLED=true</span>

<span class="hljs-comment"># Sora2免费 配置</span>
<span class="hljs-string">SORA2FREE_API_BASE_URL=https://rendersora2api.duckcloud.fun</span>
<span class="hljs-string">SORA2FREE_API_KEY=your-free-key</span>

<span class="hljs-comment"># Qwen3-VL 配置（视频分析用）</span>
<span class="hljs-string">QWEN_API_BASE_URL=https://api-inference.modelscope.cn/v1</span>
<span class="hljs-string">QWEN_API_KEY=your-qwen-key</span>
<span class="hljs-string">QWEN_MODEL_ID=Qwen/Qwen3-VL-8B-Instruct</span>

<span class="hljs-comment"># Gradio 端口</span>
<span class="hljs-string">GRADIO_PORT=7860</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1444cc3952b473bbda161872ae88397~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=JEXDzPMxfOXSxssQsSsZkNtPAQs%3D" alt="image-20251231165654142" loading="lazy"/></p>
<p><strong>API Key获取方式</strong>:</p>
<ul>
<li><strong>Seedance</strong>: 联系服务提供商获取</li>
<li><strong>Sora2</strong>: 访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.jxincm.cn%2Fregister%3Faff%3DSeEB" target="_blank" title="https://api.jxincm.cn/register?aff=SeEB" ref="nofollow noopener noreferrer">api.jxincm.cn/register?af…</a> 注册获取</li>
<li><strong>Sora2免费</strong>: 默认已配置，每天10次免费额度</li>
<li><strong>Qwen3-VL</strong>: 访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn" target="_blank" title="https://modelscope.cn" ref="nofollow noopener noreferrer">modelscope.cn</a> 注册获取</li>
</ul>
<h3 data-id="heading-12">方式一：本地启动</h3>
<p>配置完成后，直接运行启动命令：</p>
<pre><code class="hljs language-shell" lang="shell">python app.py
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6bbccf18ca241f89bb67502cfdf3d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=ZQ%2Bax5cvGNWZSD%2FUuuW%2BHxXZPBc%3D" alt="image-20251231170706211" loading="lazy"/></p>
<p>启动成功后，打开浏览器访问 <code>http://localhost:7860</code> 即可看到Web界面。</p>
<h3 data-id="heading-13">方式二：Docker部署（推荐）</h3>
<p>如果你更喜欢容器化部署，可以使用Docker：</p>
<p><strong>1. 构建镜像</strong></p>
<pre><code class="hljs language-shell" lang="shell">docker build -t ai-video-replicate:latest .
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a22b9a9acf4aa3a38867398339659c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=HXBGvrISCZ8f%2BHhfnQ8Bu14N%2FAk%3D" alt="image-20251231170958813" loading="lazy"/></p>
<p>容器镜像构建后我们通过下面的命令查看容器镜像是否构建成功</p>
<pre><code class="hljs">docker images
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/468ca66509df43efb1ce3b297c115e36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=scTHfugvpb5FloWllQkBqYX6NVY%3D" alt="image-20251231171141207" loading="lazy"/></p>
<p><strong>2. 运行容器</strong></p>
<pre><code class="hljs language-shell" lang="shell">docker run -d \
  --name ai-video-replicate \
  -p 7860:7860 \
  -e SEEDANCE_AUTH_TOKEN=your-seedance-token \
  -e SORA2_API_KEY=your-sora2-key \
  -e SORA2FREE_API_KEY=your-free-key \
  -e QWEN_API_KEY=your-qwen-key \
  ai-video-replicate:latest
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf0936fd9d4946e296286038598a0eb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=sbJNuhIKOrsHVPEz3sRFa8aYY28%3D" alt="image-20251231171743722" loading="lazy"/></p>
<p><strong>3. 使用 docker-compose（更推荐）</strong></p>
<p>创建好 <code>.env</code> 文件后，直接运行：</p>
<pre><code class="hljs language-shell" lang="shell">docker-compose up -d
</code></pre>
<h3 data-id="heading-14">功能测试</h3>
<p>启动成功后，让我们来测试各个核心功能！</p>
<p>输入请求地址<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A7860" target="_blank" title="http://127.0.0.1:7860" ref="nofollow noopener noreferrer">http://127.0.0.1:7860</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9495064ac7c040c9a0700c6fc5b95e2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=4lzKJzAtxI1v57HGQ%2FsPnCPVGNA%3D" alt="image-20251231171837195" loading="lazy"/></p>
<h4 data-id="heading-15">文生视频测试</h4>
<ol>
<li>选择模型提供者（seedance / sora2 / sora2free）</li>
<li>输入视频描述提示词，例如：<code>一只可爱的橘猫在阳光下打盹，毛发在微风中轻轻飘动</code></li>
<li>选择模型、时长和比例</li>
<li>点击"生成视频"按钮</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93c5d643f7e44ce1812ded92d19674c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=iKdK590WlEFslkh9W2EOxqDoS6M%3D" alt="image-20251231172438718" loading="lazy"/></p>
<h4 data-id="heading-16">视频复刻测试（核心功能）</h4>
<p>这是本项目最强大的功能！操作步骤如下：</p>
<p><strong>Step 1</strong>: 点击"加载样例视频"或上传想要复刻的短视频</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b18fa84cec6b416683ca7f10ac943a8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=1V2ypf60ROg%2BdFvSCDUfAQ72Dwc%3D" alt="加载样例" loading="lazy"/></p>
<p><strong>Step 2</strong>: 点击"提取视频提示词"按钮</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d446307b20e846f7bf6307ed5f003c1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=i0GhHVJ%2Bkf5%2FiGAOyCgMQNMKE4k%3D" alt="提取提示词" loading="lazy"/></p>
<p><strong>Step 3</strong>: 系统会自动分析视频并生成 SORA2 风格提示词</p>
<p>提取的提示词采用专业的三段式结构：</p>
<ul>
<li><strong>Style</strong>: 视觉纹理、光照质量、色彩调板、氛围</li>
<li><strong>Cinematography</strong>: 摄像机运动、镜头特性、布光方案、情绪基调</li>
<li><strong>Scene Breakdown</strong>: 场景分解、动作序列、背景音</li>
</ul>
<p><strong>Step 4</strong>: 确认或修改提示词，选择模型参数后生成新视频</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e181c8812bd48eebda232fc8bf54b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=WTsrO93qFQA7K%2BCtLn%2BBJ8czggM%3D" alt="生成复刻" loading="lazy"/></p>
<p><strong>Step 5</strong>: 等待生成完成，查看复刻效果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d992845b6174af99d9d46682b627b29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=s0%2Fz4mMORHjLrh8AunjkwoP5IVE%3D" alt="复刻结果" loading="lazy"/></p>
<p>视频：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fdecf21a7c645e983790fdb8b34d772~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767791452&amp;x-signature=m9PzYJCgC5WZNoOpyi8GQuigbhI%3D" alt="cc89e21e-7519-4a40-8197-af0cd8b03f46 (1)" loading="lazy"/></p>
<p>通过对比来看效果还不错吧？呵呵，是不是非常简单！</p>
<p>体验地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn%2Fstudios%2Fwwwzhouhui%2FAI-video-Replicate%2Fsummary" target="_blank" title="https://modelscope.cn/studios/wwwzhouhui/AI-video-Replicate/summary" ref="nofollow noopener noreferrer">modelscope.cn/studios/www…</a></p>
<hr/>
<h2 data-id="heading-17">总结</h2>
<p>今天主要带大家了解并实现了 <strong>AI-video-Replicate</strong> 这款AI视频生成与复刻工具的完整部署流程，该工具以"<strong>多模型集成 + Qwen3-VL视频分析</strong>"为核心优势，结合短视频创作和内容复刻需求，通过 Gradio Web界面与 Python后端，形成了一套从文本/图片/视频输入到AI视频生成的全链路解决方案。</p>
<p>通过这套实践方案，内容创作者能够高效突破传统视频制作的痛点——借助一键部署（包括环境配置、依赖安装、API Key配置），无需专业的视频剪辑技能和昂贵的设备投入，就能快速生成Sora2级别的AI视频（如本次演示的"视频复刻"功能）。无论是文生视频、图生视频，还是视频提示词提取、一键复刻同款，都能通过简单的Web界面操作完成，极大提升创作效率和内容产出速度。</p>
<p>感兴趣的小伙伴可以按照文中提供的步骤进行实践，根据实际创作需求调整模型选择和提示词参数。今天的分享就到这里结束了，我们下一篇文章见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[通过ChatGPT+Nano Banana定制一个 PPT 生成的工作流]]></title>    <link>https://juejin.cn/post/7589828902158549042</link>    <guid>https://juejin.cn/post/7589828902158549042</guid>    <pubDate>2025-12-31T13:28:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828902158549042" data-draft-id="7589494074982907955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="通过ChatGPT+Nano Banana定制一个 PPT 生成的工作流"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T13:28:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="超级东哥CyberFD"/> <meta itemprop="url" content="https://juejin.cn/user/4323692639162087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            通过ChatGPT+Nano Banana定制一个 PPT 生成的工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4323692639162087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    超级东哥CyberFD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T13:28:38.000Z" title="Wed Dec 31 2025 13:28:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近在研究如何用模型来生成 PPT或者形成相关的视频素材，Nano Banana Pro进行图片生成的质量看起来非常不错，很多人都用它生成像黑板报、信息流图、手绘画板各种各样风格的样式图片。谷歌的 NotebookLM 生成的 Audio Overview，它最近生成的 Slide Deck（幻灯片）风格也很棒。</p>
<p>网上各种博主都有发表一些图片生成、PPT 生成的工作流，我这里就将最近收集到的工作流，结合自己的工作环境输出一份自己的工作流，如果有和我类似情况的朋友可以借鉴参考</p>
<p>我的环境：</p>
<ul>
<li>ChatGPT plus</li>
<li>谷歌 Gemini</li>
</ul>
<h2 data-id="heading-1">制作一个PPT 生成的工作流</h2>
<p>在制作PPT 之前，我们先构思一下整体工作流需要几个步骤</p>
<ol>
<li>规划planner : 先让大模型结合我输入的内容，帮我生成对应的PPT大纲和每张片子的画图数据</li>
<li>画图artist  : 通过谷歌 Gemini调用Nano Banana的能力，去输出每一张片子的图画</li>
</ol>
<p>可以在以上两步中进行都进行迭代校准：确认清楚PPT 大纲、图片的风格等</p>
<h2 data-id="heading-2">🎨 第一步，输出准备规划提示词</h2>
<p>提示词如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">```</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Slide</span> <span class="hljs-string">Deck</span> <span class="hljs-string">(幻灯片演示文稿)</span> 
<span class="hljs-attr">description:</span> <span class="hljs-string">生成针对</span> <span class="hljs-string">Nano</span> <span class="hljs-string">Banana</span> <span class="hljs-string">Pro</span> <span class="hljs-string">优化的专业幻灯片大纲和视觉提示词。它将你的内容转化为带有即用型设计线索的结构化叙事，让你能够即时生成高质量的幻灯片图像。输出结果组织灵活，便于在渲染最终幻灯片之前微调提示词或调整文本。</span>
<span class="hljs-meta">---
</span>
<span class="hljs-string">你是一位世界级的演示文稿设计师和故事讲述者。你创作的幻灯片在视觉上令人震撼、极其精美，并能有效地传达复杂的信息。你的特点是：既精通设计，又极具讲故事的天赋。</span>

<span class="hljs-string">你制作的幻灯片能根据源素材和目标受众进行调整。凡事皆有故事，而你要找到最佳的讲述方式。你结合了顶尖设计师的创造力与专业知识。</span>

<span class="hljs-string">本幻灯片主要设计用于**阅读和分享**。其结构应当不言自明，即便没有演讲者也能轻松理解。叙事逻辑和所有有用的数据都应包含在幻灯片的文本和视觉元素中。幻灯片应包含足够的语境，以便任何视觉图像都能被独立理解。如果有助于叙事，你可以添加某些包含更密集信息（从源素材中提取）的幻灯片。</span>

<span class="hljs-string">你现在正在为下述幻灯片演示编写一份**大纲**。</span>

<span class="hljs-string">我们将把这份大纲提供给一位专家级设计师，由其制作最终的实际演示文稿。</span>

<span class="hljs-string">幻灯片内容应使用中文。占位符应保留中文。</span>

<span class="hljs-string">**首先**，在编写幻灯片大纲之前，你必须根据内容主题和用户请求生成一个全局性的**风格指令（STYLE</span> <span class="hljs-string">INSTRUCTIONS）**块。这应该被包裹在代码块中。</span>

<span class="hljs-string">&lt;STYLE_INSTRUCTION_EXAMPLE&gt;</span>
<span class="hljs-attr">Design Aesthetic:</span> <span class="hljs-string">一种受建筑蓝图和高端技术期刊启发的干净、精致、极简主义的编辑风格。整体感觉是精准、清晰和充满智慧的优雅。</span>
<span class="hljs-attr">Background Color:</span> <span class="hljs-string">一种微妙的、有纹理的灰白色，十六进制代码</span> <span class="hljs-comment">#F8F7F5，让人联想到高质量的绘图纸。</span>
<span class="hljs-attr">Primary Font:</span> <span class="hljs-string">Neue</span> <span class="hljs-string">Haas</span> <span class="hljs-string">Grotesk</span> <span class="hljs-string">Display</span> <span class="hljs-string">Pro。用于所有幻灯片标题和主要标题。应使用粗体渲染，以增强冲击力和清晰度。</span>
<span class="hljs-attr">Secondary Font:</span> <span class="hljs-string">Tiempos</span> <span class="hljs-string">Text。用于所有正文、副标题和注释。其高可读性和经典感与干净的无衬线标题形成专业的对比。</span>
<span class="hljs-attr">Color Palette:</span>
<span class="hljs-attr">Primary Text Color:</span> <span class="hljs-string">深板岩灰，#2F3542。</span>
<span class="hljs-string">Primary</span> <span class="hljs-string">Accent</span> <span class="hljs-string">Color</span> <span class="hljs-string">(用于高光、图表和关键元素):</span> <span class="hljs-string">充满活力的智能蓝，#007AFF。</span>
<span class="hljs-attr">Visual Elements:</span>
<span class="hljs-string">一致使用精细、准确的线条、示意图和干净的矢量图形。视觉效果是概念性和抽象的，旨在阐述想法而非描绘写实场景。布局空间感强且结构化，优先考虑信息层级和可读性。不包含页码、页脚、Logo</span> <span class="hljs-string">或页眉。</span>
<span class="hljs-string">&lt;/STYLE_INSTRUCTION_EXAMPLE&gt;</span>

<span class="hljs-string">使用以下结构作为模板，但要根据具体的叙事动态调整美学、字体和颜色：</span>

<span class="hljs-string">```markdown</span>
<span class="hljs-string">你是架构师（The</span> <span class="hljs-string">Architect），一个旨在将指令可视化为高端蓝图风格数据展示的精密</span> <span class="hljs-string">AI。你的输出是精确、分析性且美学上精美的。</span>

<span class="hljs-string">**核心指令</span> <span class="hljs-string">(CORE</span> <span class="hljs-string">DIRECTIVES):**</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">分析用户提示词的结构、意图和关键要素。</span>

<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">将指令转化为干净、结构化的视觉隐喻（蓝图、展示图、原理图）。</span>

<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">使用特定的、克制的调色板和字体系列，以获得最大的清晰度和专业影响力。</span>

<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">所有视觉输出必须严格保持</span> <span class="hljs-number">16</span><span class="hljs-string">:9</span> <span class="hljs-string">的长宽比。</span>

<span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">以三联画（triptych）或基于网格的布局呈现信息，保持文本和视觉的平衡。</span>

<span class="hljs-string">**风格指令</span> <span class="hljs-string">(STYLE</span> <span class="hljs-string">INSTRUCTIONS):**</span>
<span class="hljs-attr">Design Aesthetic:</span> [<span class="hljs-string">描述整体风格，例如：极简主义、俏皮、商务、建筑风格等</span>]
<span class="hljs-attr">Background Color:</span> [<span class="hljs-string">描述及十六进制代码</span>]
<span class="hljs-attr">Primary Font:</span> [<span class="hljs-string">标题字体名称</span>]
<span class="hljs-attr">Secondary Font:</span> [<span class="hljs-string">正文字体名称</span>]
<span class="hljs-attr">Color Palette:</span>
    <span class="hljs-attr">Primary Text Color:</span> [<span class="hljs-string">十六进制代码</span>]
    <span class="hljs-attr">Primary Accent Color:</span> [<span class="hljs-string">十六进制代码</span>]
<span class="hljs-attr">Visual Elements:</span> [<span class="hljs-string">描述线条、形状、图像风格、摄影与矢量的使用等</span>]

<span class="hljs-string">**绘制内容</span> <span class="hljs-string">(CONTENT</span> <span class="hljs-string">TO</span> <span class="hljs-string">DRAW):**</span>


<span class="hljs-string">```</span>

<span class="hljs-string">对于本次特定的幻灯片演示，我们需要内容侧重于：</span>
{<span class="hljs-string">Custom</span> <span class="hljs-string">Prompt</span>, <span class="hljs-string">描述你想要创建的幻灯片，默认为：添加高层级大纲，或引导受众、风格和重点："为初学者创建一个风格大胆且俏皮的演示文稿，重点在于分步说明。"</span>}

<span class="hljs-string">我们在下方还附上了一些针对本幻灯片的制作人说明，这将有助于指导演示文稿的整体结构和叙事。</span>

<span class="hljs-string">请记住以下大纲编写规则：</span>

<span class="hljs-string">*</span> <span class="hljs-string">专注于演示文稿的大纲以及每张幻灯片应涵盖的内容。</span>
<span class="hljs-string">*</span> <span class="hljs-string">每张幻灯片的描述必须全面且结构严谨。</span>
<span class="hljs-string">*</span> <span class="hljs-string">**第</span> <span class="hljs-number">1</span> <span class="hljs-string">页必须是封面页，最后一页必须是封底页。**</span> <span class="hljs-string">请注意，这两张幻灯片的视觉风格和布局应与内部内容页截然不同（例如，使用“海报式”布局、醒目的排版或满版出血图像），以设定基调并提供强有力的结尾。</span>
<span class="hljs-string">*</span> <span class="hljs-string">对于每一张幻灯片，你必须严格按照以下</span> <span class="hljs-number">4</span> <span class="hljs-string">个部分输出内容：</span>
<span class="hljs-string">//</span> <span class="hljs-string">NARRATIVE</span> <span class="hljs-string">GOAL</span> <span class="hljs-string">(叙事目标)</span>
<span class="hljs-string">(解释这张幻灯片在整个故事弧光中的具体叙事目的)</span>
<span class="hljs-string">//</span> <span class="hljs-string">KEY</span> <span class="hljs-string">CONTENT</span> <span class="hljs-string">(关键内容)</span>
<span class="hljs-string">(列出标题、副标题和正文/要点。每一个具体数据点都必须能追溯到源材料。)</span>
<span class="hljs-string">//</span> <span class="hljs-string">VISUAL</span> <span class="hljs-string">(视觉画面)</span>
<span class="hljs-string">(描述支持该观点所需的图像、图表、图形或抽象视觉元素。)</span>
<span class="hljs-string">//</span> <span class="hljs-string">LAYOUT</span> <span class="hljs-string">(布局结构)</span>
<span class="hljs-string">(描述构图、层级、空间安排或焦点。)</span>
<span class="hljs-string">*</span> <span class="hljs-string">保留源素材中的关键要素。</span>
<span class="hljs-string">*</span> <span class="hljs-string">每一个具体的数据点...都必须能直接追溯到源素材。</span>
<span class="hljs-string">*</span> <span class="hljs-string">所有细节都需要提及，因为设计师之后将无法访问源内容。</span>
<span class="hljs-string">*</span> <span class="hljs-string">永远假设听众比你想象的更专业、更感兴趣、更聪明。</span>

<span class="hljs-string">**至关重要</span> <span class="hljs-string">(CRITICAL):**</span>

<span class="hljs-string">*</span> <span class="hljs-string">**生成的幻灯片切勿超过</span> <span class="hljs-number">20</span> <span class="hljs-string">页。**</span>
<span class="hljs-string">*</span> <span class="hljs-string">避免使用“标题：副标题”的格式作为标题；这种格式显得非常有</span> <span class="hljs-string">AI</span> <span class="hljs-string">感。相反，应通过**叙事性的主题句**将整个演示文稿串联起来。</span>
<span class="hljs-string">*</span> <span class="hljs-string">明确避免陈词滥调的“AI</span> <span class="hljs-string">废话（AI</span> <span class="hljs-string">slop）”模式。切勿使用诸如“不仅仅是</span> [<span class="hljs-string">X</span>]<span class="hljs-string">，而是</span> [<span class="hljs-string">Y</span>]<span class="hljs-string">”之类的短语。</span>
<span class="hljs-string">*</span> <span class="hljs-string">使用直接、自信、主动的人类语言。</span>
<span class="hljs-string">*</span> <span class="hljs-string">切勿包含任何供作者插入姓名、日期等的占位符幻灯片。</span>
<span class="hljs-string">*</span> <span class="hljs-string">切勿要求包含知名人物的逼真照片。</span>
<span class="hljs-string">*</span> <span class="hljs-string">**切勿以通用的“有任何问题吗？”或“谢谢”幻灯片结尾。**</span> <span class="hljs-string">相反，封底应为经过设计的结束语、有意义的引用或强有力的视觉总结，以此锚定整个叙事。</span>
<span class="hljs-string">```</span>
</code></pre>
<p>可以根据自己的情况，来修改上述提示词</p>
<p>我自己将该提示词通过 ChatGPT 的 GPT 定义了一个智能体</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0c3e81334974f15a6007aa29fdbf775~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5Lic5ZOlQ3liZXJGRA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767792517&amp;x-signature=bVPm02jgsYhFLJsjlU9tUAbp%2BKs%3D" alt="image.png" loading="lazy"/></p>
<p>如果你不嫌麻烦，可以每次都复制一下上述提示词，再输入你的素材内容</p>
<h2 data-id="heading-3">🎨 第二步，输入素材输出PPT大纲和图像数据</h2>
<p>最后输出的效果是这样的</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">你是「时间胶囊策展人」（The</span> <span class="hljs-string">Time-Capsule</span> <span class="hljs-string">Curator），一个把技术故事转译成“可阅读、可分享”的高质感叙事版式的设计系统。你的输出强调：时间纵深、因果对照、可复现流程，并把“讨论的情绪”与“事实的落点”并排呈现。</span>

<span class="hljs-string">**核心指令</span> <span class="hljs-string">(CORE</span> <span class="hljs-string">DIRECTIVES):**</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">把“十年前的讨论”与“十年后的现实”做成强对比信息结构：当时怎么想</span> <span class="hljs-string">→</span> <span class="hljs-string">后来发生了什么</span> <span class="hljs-string">→</span> <span class="hljs-string">谁更接近真实。</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">用分步流程呈现系统：抓取</span> <span class="hljs-string">→</span> <span class="hljs-string">组装提示词</span> <span class="hljs-string">→</span> <span class="hljs-string">调用模型</span> <span class="hljs-string">→</span> <span class="hljs-string">解析</span> <span class="hljs-string">→</span> <span class="hljs-string">生成静态网页</span> <span class="hljs-string">→</span> <span class="hljs-string">排名与索引。</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">强调可复现与可扩展：数据来源、格式约束、评分聚合方式、成本与时间。</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">视觉上把“HN</span> <span class="hljs-string">论坛感（黑白/荧光点缀/等宽字体）”与“档案馆/时间胶囊（纸张纹理/时间戳/封条元素）”融合。</span>
<span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">所有视觉输出严格</span> <span class="hljs-number">16</span><span class="hljs-string">:9；以网格布局为骨架；信息密度可高但层级必须清晰；不放页眉页脚/Logo/页码。</span>

<span class="hljs-string">**风格指令</span> <span class="hljs-string">(STYLE</span> <span class="hljs-string">INSTRUCTIONS):**</span>
<span class="hljs-attr">Design Aesthetic:</span> <span class="hljs-string">“HN</span> <span class="hljs-string">终端</span> <span class="hljs-string">+</span> <span class="hljs-string">档案馆时间胶囊”混合风格。大标题像新闻头条，正文像代码审阅，辅以时间戳与封条符号，整体克制但俏皮。</span>
<span class="hljs-attr">Background Color:</span> <span class="hljs-string">暖灰纸张纹理</span> <span class="hljs-comment">#F6F3EE（内页），封面/封底用深夜黑 #0B0F14 做强对比。</span>
<span class="hljs-attr">Primary Font:</span> <span class="hljs-string">IBM</span> <span class="hljs-string">Plex</span> <span class="hljs-string">Sans</span> <span class="hljs-string">Condensed（标题，粗体，紧凑有冲击力）。</span>
<span class="hljs-attr">Secondary Font:</span> <span class="hljs-string">IBM</span> <span class="hljs-string">Plex</span> <span class="hljs-string">Mono（正文/数据/提示词片段，提升“可复现”气质）。</span>
<span class="hljs-attr">Color Palette:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Primary Text Color:</span> <span class="hljs-string">炭黑</span> <span class="hljs-comment">#101418</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">Inverse</span> <span class="hljs-string">Text</span> <span class="hljs-string">(深底反白):</span> <span class="hljs-string">雾白</span> <span class="hljs-comment">#E8EEF6</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Primary Accent:</span> <span class="hljs-string">HN</span> <span class="hljs-string">橙</span> <span class="hljs-comment">#FF6600（关键数字/标签）</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Secondary Accent:</span> <span class="hljs-string">电蓝</span> <span class="hljs-comment">#4DA3FF（“十年后结果”一侧）</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Muted Lines:</span> <span class="hljs-string">石墨灰</span> <span class="hljs-comment">#2A313A（分隔线/网格）</span>
<span class="hljs-attr">Visual Elements:</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">贯穿元素：时间戳（YYYY-MM-DD）、“档案袋封条”、细网格、注释箭头、对照分栏（当时/后来）。</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">图表偏“信息图</span> <span class="hljs-string">+</span> <span class="hljs-string">代码块卡片”：流程图、成本/请求量柱状、排名榜单、示例线程卡片。</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">禁用：名人写实肖像、花哨拟物</span> <span class="hljs-string">3D、过度渐变。</span>

<span class="hljs-string">**绘制内容</span> <span class="hljs-string">(CONTENT</span> <span class="hljs-string">TO</span> <span class="hljs-string">DRAW):**</span>
<span class="hljs-string">围绕一篇文章《Auto-grading</span> <span class="hljs-string">decade-old</span> <span class="hljs-string">Hacker</span> <span class="hljs-string">News</span> <span class="hljs-string">discussions</span> <span class="hljs-string">with</span> <span class="hljs-string">hindsight》（2025-12-10）构建一套“系统</span> <span class="hljs-string">+</span> <span class="hljs-string">结果</span> <span class="hljs-string">+</span> <span class="hljs-string">启示”的时间胶囊叙事：从触发事件，到</span> <span class="hljs-number">31</span><span class="hljs-string">×30=930</span> <span class="hljs-string">条线程批量分析，再到</span> <span class="hljs-string">Hall</span> <span class="hljs-string">of</span> <span class="hljs-string">Fame</span> <span class="hljs-string">排名与伦理反思。</span>
<span class="hljs-string">幻灯片大纲（≤20页）</span>
<span class="hljs-number">1</span><span class="hljs-string">)</span> <span class="hljs-string">封面：把十年前的争论交给“十年后的眼睛”</span>
<span class="hljs-string">NARRATIVE</span> <span class="hljs-string">GOAL（叙事目标）</span>
<span class="hljs-string">用“时间胶囊”氛围建立主题：用后见之明自动批改旧</span> <span class="hljs-string">Hacker</span> <span class="hljs-string">News</span> <span class="hljs-string">讨论。</span>

<span class="hljs-string">KEY</span> <span class="hljs-string">CONTENT（关键内容）</span>

<span class="hljs-string">主标题：用后见之明自动批改十年前的</span> <span class="hljs-string">Hacker</span> <span class="hljs-string">News</span>

<span class="hljs-string">副标题：把</span> <span class="hljs-number">2015</span> <span class="hljs-string">年</span> <span class="hljs-number">12</span> <span class="hljs-string">月的讨论做成可阅读的“历史网页档案”</span>

<span class="hljs-string">小字角标：2025-12-10（文章日期）</span> 
<span class="hljs-string">karpathy</span>

<span class="hljs-string">VISUAL（视觉画面）</span>
<span class="hljs-string">深底海报式：中心一个“封存档案袋”图形，封条上写“Dec</span> <span class="hljs-number">2015</span> <span class="hljs-string">→</span> <span class="hljs-string">Dec</span> <span class="hljs-number">2025</span><span class="hljs-string">”。右下角像终端闪烁光标“&gt;”.</span>

<span class="hljs-string">LAYOUT（布局结构）</span>
<span class="hljs-string">满版深色背景；标题居中大字；副标题一行；角标时间戳；极少元素但强对比。</span>

<span class="hljs-number">2</span><span class="hljs-string">)</span> <span class="hljs-string">触发点：从“预测未来的幻觉”转向“回看过去的真实”</span>
<span class="hljs-string">NARRATIVE</span> <span class="hljs-string">GOAL</span>
<span class="hljs-string">交代项目为什么出现：先看到模型“幻想未来”，然后决定用模型“回看过去”。</span>

<span class="hljs-string">KEY</span> <span class="hljs-string">CONTENT</span>

<span class="hljs-string">起因：看到一个</span> <span class="hljs-string">HN</span> <span class="hljs-string">线程——Gemini</span> <span class="hljs-string">Pro</span> <span class="hljs-number">3</span><span class="hljs-string">“幻觉”出</span> <span class="hljs-number">10</span> <span class="hljs-string">年后的</span> <span class="hljs-string">HN</span> <span class="hljs-string">首页</span>

<span class="hljs-string">随后有人贴出“正好</span> <span class="hljs-number">10</span> <span class="hljs-string">年前”的</span> <span class="hljs-string">HN</span> <span class="hljs-string">首页：2015</span> <span class="hljs-string">年</span> <span class="hljs-number">12</span> <span class="hljs-string">月</span>

<span class="hljs-string">人类读者开始“心里打分”：哪些评论有远见？哪些离谱？</span> 
<span class="hljs-string">karpathy</span>

<span class="hljs-string">VISUAL</span>
<span class="hljs-string">左右对照卡片：左“10</span> <span class="hljs-string">years</span> <span class="hljs-string">from</span> <span class="hljs-string">now</span> <span class="hljs-string">(hallucinated)”右“10</span> <span class="hljs-string">years</span> <span class="hljs-string">ago</span> <span class="hljs-string">(real)”。中间一根时间轴穿针引线。</span>

<span class="hljs-string">LAYOUT</span>
<span class="hljs-string">两列对照</span> <span class="hljs-string">+</span> <span class="hljs-string">底部一条时间轴；关键动词用橙色高亮：幻觉</span> <span class="hljs-string">/</span> <span class="hljs-string">回看</span> <span class="hljs-string">/</span> <span class="hljs-string">打分。</span>

</code></pre>
<p>主要有三大板块内容</p>
<ul>
<li>核心指令 (CORE DIRECTIVES)</li>
<li>风格指令 (STYLE INSTRUCTIONS)</li>
<li>每张片子的图像元素和效果要求</li>
</ul>
<p>在这一步，如果你发现输出的风格不符合你的预期，可以进一步沟通进行修改，反复迭代直到整个方案你觉得满意为止</p>
<p>比如我喜欢手绘风格的，我和要求GPT</p>
<pre><code class="hljs">我要的视觉风格是 ：插画或手绘感，采用柔和插画或轻松手绘笔触，增强亲和力与友好度；背景颜色采用带有细微纹理的柔和米白色，带细微纹理；字体使用中文手写圆体；连接线条带有手绘波浪感，不完全笔直 请帮我更新一下 PPT 大纲和图像方案
</code></pre>
<h2 data-id="heading-4">🎨 第三步，开始画图</h2>
<p>这一步是最爽的一步，打开谷歌 Gemini，选择上工具“生成图片”</p>
<p>复制上一步生成的</p>
<ul>
<li>核心指令 (CORE DIRECTIVES)</li>
<li>风格指令 (STYLE INSTRUCTIONS)</li>
</ul>
<p>加上第一张幻灯片的图像内容</p>
<p>点击开始，等待绘画完成即可</p>
<p>重复粘贴第二张片子的内容进去，可以一直保持相同的图像风格</p>
<h2 data-id="heading-5">🎨 第四步，迭代直到完美</h2>
<p>在这一步，因为每张PPT片子都是独立生成的，是可以不断通过和Gemini去沟通每一张片子的修改内容</p>
<p>直到输出的图片符合你的要求</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于在 Fabric.js 中注册字体覆盖的问题]]></title>    <link>https://juejin.cn/post/7589838714449985577</link>    <guid>https://juejin.cn/post/7589838714449985577</guid>    <pubDate>2025-12-31T13:54:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714449985577" data-draft-id="7589828815939715126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于在 Fabric.js 中注册字体覆盖的问题"/> <meta itemprop="keywords" content="后端,Node.js"/> <meta itemprop="datePublished" content="2025-12-31T13:54:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="佳佳_"/> <meta itemprop="url" content="https://juejin.cn/user/2392133664511719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于在 Fabric.js 中注册字体覆盖的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392133664511719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    佳佳_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T13:54:08.000Z" title="Wed Dec 31 2025 13:54:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天发现生成定制图片中的字体变成了默认字体。因为特殊原因，定制中的字体使用的后端生成的方式。生成字体图片的服务是 Node.js 写的，通过 fabric.js 生成对应的图片。字体的注册是通过 <code>fabric.nodeCanvas.registerFont</code> 方法实现的。</p>
<p>尝试重启 Node.js 服务后，短时间内字体是对的，但是很快就再次失效，变成了默认字体。</p>
<p>因为最近的改动就是增加了几种字体，代码并没有改动，于是排查的重点就在这几个新增的字体上。</p>
<p>最终发现有两个字体文件是相同的（前端网页中注册字体时使用了不同的 fontFamily）。依次测试这两个字体（fontFamily）时，第一次这两个字体都是正确的，但是第二次时先注册的字体就会变成默认字体。</p>
<p>注册字体的代码：</p>
<pre><code class="hljs language-js" lang="js">fabric.<span class="hljs-property">nodeCanvas</span>.<span class="hljs-title function_">registerFont</span>(fontPath, {
  <span class="hljs-attr">family</span>: fontFamily,
  <span class="hljs-attr">weight</span>: <span class="hljs-string">'normal'</span>,
  <span class="hljs-attr">style</span>: <span class="hljs-string">'normal'</span>
})
</code></pre>
<p>其中 <code>fabric.nodeCanvas</code> 实际上来自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcanvas" target="_blank" title="https://www.npmjs.com/package/canvas" ref="nofollow noopener noreferrer">node-canvas</a> 包。其注册字体的代码如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">registerFont</span> (src, fontFace) {
  <span class="hljs-comment">// TODO this doesn't need to be on Canvas; it should just be a static method</span>
  <span class="hljs-comment">// of `bindings`.</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Canvas</span>.<span class="hljs-title function_">_registerFont</span>(fs.<span class="hljs-title function_">realpathSync</span>(src), fontFace)
}
</code></pre>
<p>上面 <code>_registerFont</code> 方法绑定到的是 C++ 代码 <code>Canvas::RegisterFont</code>。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-built_in">StaticMethod</span>&lt;&amp;Canvas::RegisterFont&gt;(<span class="hljs-string">"_registerFont"</span>, napi_default_method)
</code></pre>
<p><code>Canvas::RegisterFont</code> 方法的实现如下：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span>
<span class="hljs-title">Canvas::RegisterFont</span><span class="hljs-params">(<span class="hljs-type">const</span> Napi::CallbackInfo&amp; info)</span> </span>{
  Napi::Env env = info.<span class="hljs-built_in">Env</span>();
  <span class="hljs-keyword">if</span> (!info[<span class="hljs-number">0</span>].<span class="hljs-built_in">IsString</span>()) {
    Napi::Error::<span class="hljs-built_in">New</span>(env, <span class="hljs-string">"Wrong argument type"</span>).<span class="hljs-built_in">ThrowAsJavaScriptException</span>();
    <span class="hljs-keyword">return</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!info[<span class="hljs-number">1</span>].<span class="hljs-built_in">IsObject</span>()) {
    Napi::Error::<span class="hljs-built_in">New</span>(env, GENERIC_FACE_ERROR).<span class="hljs-built_in">ThrowAsJavaScriptException</span>();
    <span class="hljs-keyword">return</span>;
  }

  std::string filePath = info[<span class="hljs-number">0</span>].<span class="hljs-built_in">As</span>&lt;Napi::String&gt;();
  PangoFontDescription *sys_desc = <span class="hljs-built_in">get_pango_font_description</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)(filePath.<span class="hljs-built_in">c_str</span>()));

  <span class="hljs-keyword">if</span> (!sys_desc) {
    Napi::Error::<span class="hljs-built_in">New</span>(env, <span class="hljs-string">"Could not parse font file"</span>).<span class="hljs-built_in">ThrowAsJavaScriptException</span>();
    <span class="hljs-keyword">return</span>;
  }

  PangoFontDescription *user_desc = <span class="hljs-built_in">pango_font_description_new</span>();

  <span class="hljs-comment">// now check the attrs, there are many ways to be wrong</span>
  Napi::Object js_user_desc = info[<span class="hljs-number">1</span>].<span class="hljs-built_in">As</span>&lt;Napi::Object&gt;();

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> use FontParser on these values just like the FontFace API works</span>
  <span class="hljs-type">char</span> *family = <span class="hljs-built_in">str_value</span>(js_user_desc.<span class="hljs-built_in">Get</span>(<span class="hljs-string">"family"</span>), <span class="hljs-literal">NULL</span>, <span class="hljs-literal">false</span>);
  <span class="hljs-type">char</span> *weight = <span class="hljs-built_in">str_value</span>(js_user_desc.<span class="hljs-built_in">Get</span>(<span class="hljs-string">"weight"</span>), <span class="hljs-string">"normal"</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-type">char</span> *style = <span class="hljs-built_in">str_value</span>(js_user_desc.<span class="hljs-built_in">Get</span>(<span class="hljs-string">"style"</span>), <span class="hljs-string">"normal"</span>, <span class="hljs-literal">false</span>);

  <span class="hljs-keyword">if</span> (family &amp;&amp; weight &amp;&amp; style) {
    <span class="hljs-built_in">pango_font_description_set_weight</span>(user_desc, Canvas::<span class="hljs-built_in">GetWeightFromCSSString</span>(weight));
    <span class="hljs-built_in">pango_font_description_set_style</span>(user_desc, Canvas::<span class="hljs-built_in">GetStyleFromCSSString</span>(style));
    <span class="hljs-built_in">pango_font_description_set_family</span>(user_desc, family);

    <span class="hljs-keyword">auto</span> found = std::<span class="hljs-built_in">find_if</span>(font_face_list.<span class="hljs-built_in">begin</span>(), font_face_list.<span class="hljs-built_in">end</span>(), [&amp;](FontFace&amp; f) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">pango_font_description_equal</span>(f.sys_desc, sys_desc);
    });

    <span class="hljs-keyword">if</span> (found != font_face_list.<span class="hljs-built_in">end</span>()) {
      <span class="hljs-built_in">pango_font_description_free</span>(found-&gt;user_desc);
      found-&gt;user_desc = user_desc;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">register_font</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *) filePath.<span class="hljs-built_in">c_str</span>())) {
      FontFace face;
      face.user_desc = user_desc;
      face.sys_desc = sys_desc;
      <span class="hljs-built_in">strncpy</span>((<span class="hljs-type">char</span> *)face.file_path, (<span class="hljs-type">char</span> *) filePath.<span class="hljs-built_in">c_str</span>(), <span class="hljs-number">1023</span>);
      font_face_list.<span class="hljs-built_in">push_back</span>(face);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">pango_font_description_free</span>(user_desc);
      Napi::Error::<span class="hljs-built_in">New</span>(env, <span class="hljs-string">"Could not load font to the system's font host"</span>).<span class="hljs-built_in">ThrowAsJavaScriptException</span>();

    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">pango_font_description_free</span>(user_desc);
    <span class="hljs-keyword">if</span> (!env.<span class="hljs-built_in">IsExceptionPending</span>()) {
      Napi::Error::<span class="hljs-built_in">New</span>(env, GENERIC_FACE_ERROR).<span class="hljs-built_in">ThrowAsJavaScriptException</span>();
    }
  }

  <span class="hljs-built_in">free</span>(family);
  <span class="hljs-built_in">free</span>(weight);
  <span class="hljs-built_in">free</span>(style);
  fontSerial++;
}
</code></pre>
<p>从上面的可以看到，注册时会查找是否已经有了相同的<wbr><strong>字体描述 <code>sys_desc</code></strong> 的字体。如果有，则会释放<strong>用户字体描述 <code>user_desc</code></strong>，替换为新的。</wbr></p>
<blockquote>
<p>如何判定字体描述相同（<code>pango_font_description_equal</code>），这里看不到源码。根据豆包回答，会比较这些属性：<code>family</code>、<code>weight</code>、<code>style</code>、<code>stretch</code>、<code>variant</code>、<code>size</code>。</p>
</blockquote>
<p>本次的问题就是由于这个机制导致的。
注册的两个字体的 fontFamily 对应的字体文件的文件名虽然不一样，但其实是同一个字体。
后注册字体的 <code>user_desc</code> 会替换之前的，导致之前的 fontFamily 就失效。</p>
<p>没找到通过代码自动更改字体的 <code>sys_desc</code> 信息的方法，暂时的解决方案是：<mark>使用 <strong>FontForge</strong>，打开字体文件，点击「Element」→「Font Info」→「PS Names」，修改「Fontname」「Family Name」「Name For Humans」，最后导出为一个新的字体文件。</mark></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（13） Hibernate的一级缓存是什么？]]></title>    <link>https://juejin.cn/post/7589838714449870889</link>    <guid>https://juejin.cn/post/7589838714449870889</guid>    <pubDate>2025-12-31T12:06:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714449870889" data-draft-id="7589828815939567670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（13） Hibernate的一级缓存是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T12:06:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（13） Hibernate的一级缓存是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:06:52.000Z" title="Wed Dec 31 2025 12:06:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的一级缓存（First-Level Cache）是Hibernate Session范围内的缓存，默认情况下是启用的。一级缓存只在当前的Session范围内生效，并且无法跨Session共享。一级缓存的主要作用是减少数据库的访问次数，提高应用程序的性能。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>Session范围内</strong>：一级缓存仅在当前Session范围内有效，Session关闭后缓存失效。</li>
<li><strong>自动启用</strong>：一级缓存默认启用，开发者无需额外配置。</li>
<li><strong>缓存实体</strong>：在同一个Session中，多次访问相同的实体时，Hibernate会从缓存中读取，而不是每次都访问数据库。</li>
<li><strong>事务一致性</strong>：一级缓存保证在同一个Session和事务中的数据一致性。</li>
</ol>
<h3 data-id="heading-1">示例项目结构</h3>
<p>为了深入理解一级缓存，下面是一个完整的示例，包括如何配置Hibernate文件、定义实体类、以及演示一级缓存的行为。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">一级缓存示例代码</h3>
<p>下面的示例展示了一级缓存的基本行为，包括如何在同一个Session中多次访问同一个实体，以及在不同Session中访问同一个实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateFirstLevelCacheExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 向数据库添加一个测试对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student);

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 演示一级缓存的行为</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 第一次查询，发出SQL语句</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"First Query: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            <span class="hljs-comment">// 第二次查询，从一级缓存中读取，不发出SQL语句</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">sameStudent</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Second Query: "</span> + sameStudent.getName() + <span class="hljs-string">", Age: "</span> + sameStudent.getAge());

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 不同Session中访问同一个实体，发出SQL语句</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 新的Session中查询，发出SQL语句</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"New Session Query: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>第一次查询</strong>：在同一个Session中，第一次查询会发出SQL语句，从数据库中读取数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 第一次查询，发出SQL语句</span>
<span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
System.out.println(<span class="hljs-string">"First Query: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
</code></pre>
</li>
<li>
<p><strong>第二次查询</strong>：在同一个Session中，第二次查询相同的实体时，Hibernate会从一级缓存中读取数据，不会发出SQL语句。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 第二次查询，从一级缓存中读取，不发出SQL语句</span>
<span class="hljs-type">Student</span> <span class="hljs-variable">sameStudent</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
System.out.println(<span class="hljs-string">"Second Query: "</span> + sameStudent.getName() + <span class="hljs-string">", Age: "</span> + sameStudent.getAge());
</code></pre>
</li>
<li>
<p><strong>不同Session中的查询</strong>：在不同的Session中查询同一个实体时，Hibernate会再次发出SQL语句，因为一级缓存只在当前Session范围内有效。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 新的Session中查询，发出SQL语句</span>
<span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
System.out.println(<span class="hljs-string">"New Session Query: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">事务管理</h3>
<p>在进行数据库操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 持久化操作</span>
    transaction.commit();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
        transaction.rollback();
    }
    e.printStackTrace();
}
</code></pre>
<h3 data-id="heading-8">总结</h3>
<p>Hibernate的一级缓存是Session范围内的缓存，默认情况下是启用的。它通过在同一个Session中缓存实体对象，减少了对数据库的访问，提高了应用程序的性能。通过实际的代码示例，可以看到一级缓存如何在同一个Session中有效地缓存和读取实体对象。理解Hibernate的一级缓存概念，对于优化数据访问和提高应用程序性能具有重要意义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（14）什么是Hibernate的二级缓存？]]></title>    <link>https://juejin.cn/post/7589828815939584054</link>    <guid>https://juejin.cn/post/7589828815939584054</guid>    <pubDate>2025-12-31T12:07:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828815939584054" data-draft-id="7589564203872960575" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（14）什么是Hibernate的二级缓存？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T12:07:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（14）什么是Hibernate的二级缓存？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:07:40.000Z" title="Wed Dec 31 2025 12:07:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的二级缓存（Second-Level Cache）是超出Session范围的缓存，可以在多个Session之间共享。二级缓存用来存储那些在不同事务之间共享的数据，减少对数据库的访问，提高应用程序的性能。与一级缓存不同，二级缓存是可选的，需要显式配置和启用。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>Session工厂范围内共享</strong>：二级缓存可以在多个Session之间共享数据。</li>
<li><strong>可配置</strong>：需要显式配置缓存提供者和缓存策略。</li>
<li><strong>缓存实体和集合</strong>：可以缓存实体、集合和查询结果。</li>
<li><strong>持久性缓存</strong>：常用于缓存那些不经常修改的数据。</li>
</ol>
<h3 data-id="heading-1">主要组件</h3>
<ol>
<li><strong>缓存提供者</strong>：例如 Ehcache、Infinispan、Hazelcast 等。</li>
<li><strong>缓存策略</strong>：配置缓存的使用策略，例如读写、只读等。</li>
</ol>
<h3 data-id="heading-2">示例项目结构</h3>
<p>为了深入理解二级缓存，下面是一个完整的示例，包括如何配置Hibernate文件、定义实体类、以及演示二级缓存的行为。</p>
<h4 data-id="heading-3">配置文件 <code>hibernate.cfg.xml</code></h4>
<p>假设使用Ehcache作为二级缓存提供者。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 二级缓存配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_query_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">Ehcache 配置文件 <code>ehcache.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:noNamespaceSchemaLocation</span>=<span class="hljs-string">"http://www.ehcache.org/ehcache.xsd"</span>
         <span class="hljs-attr">updateCheck</span>=<span class="hljs-string">"false"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">defaultCache</span>
            <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">"10000"</span>
            <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"300"</span>
            <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"600"</span>
            <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">"LRU"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Student"</span>
           <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">"10000"</span>
           <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
           <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"300"</span>
           <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"600"</span>
           <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
           <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">"LRU"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-6">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> org.hibernate.annotations.Cache;
<span class="hljs-keyword">import</span> org.hibernate.annotations.CacheConcurrencyStrategy;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-7">二级缓存示例代码</h3>
<p>下面的示例展示了二级缓存的基本行为，包括如何在多个Session中共享缓存数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateSecondLevelCacheExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 向数据库添加一个测试对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student);

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 第一次查询，发出SQL语句，并将数据放入二级缓存</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"First Query: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 第二次查询，从二级缓存中读取数据，不发出SQL语句</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Second Query: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>配置二级缓存</strong>：在<code>hibernate.cfg.xml</code>中启用二级缓存，指定缓存提供者和缓存策略。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.cache.use_query_cache"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong>配置Ehcache</strong>：在<code>ehcache.xml</code>中配置缓存区域及其属性。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"com.example.domain.Student"</span>
       <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">"10000"</span>
       <span class="hljs-attr">eternal</span>=<span class="hljs-string">"false"</span>
       <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">"300"</span>
       <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">"600"</span>
       <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">"false"</span>
       <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">"LRU"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>注解实体类</strong>：使用<code>@Cache</code>注解和<code>@CacheConcurrencyStrategy</code>指定缓存策略。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
}
</code></pre>
</li>
<li>
<p><strong>第一次查询</strong>：在一个新的Session中查询实体，将数据放入二级缓存。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
</code></pre>
</li>
<li>
<p><strong>第二次查询</strong>：在另一个新的Session中查询相同的实体，从二级缓存中读取数据，不发出SQL语句。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">事务管理</h3>
<p>在进行数据库操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 持久化操作</span>
    transaction.commit();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
        transaction.rollback();
    }
    e.printStackTrace();
}
</code></pre>
<h3 data-id="heading-10">总结</h3>
<p>Hibernate的二级缓存是超出Session范围的缓存，可以在多个Session之间共享数据。它通过减少数据库的访问次数，提高了应用程序的性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[libicu-62.1-6.ky10.x86_64.rpm 安装步骤详解（麒麟V10系统）]]></title>    <link>https://juejin.cn/post/7589830701615071232</link>    <guid>https://juejin.cn/post/7589830701615071232</guid>    <pubDate>2025-12-31T12:10:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589830701615071232" data-draft-id="7589830701615054848" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="libicu-62.1-6.ky10.x86_64.rpm 安装步骤详解（麒麟V10系统）"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-31T12:10:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户613541146016"/> <meta itemprop="url" content="https://juejin.cn/user/1602431422584832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            libicu-62.1-6.ky10.x86_64.rpm 安装步骤详解（麒麟V10系统）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1602431422584832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户613541146016
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:10:51.000Z" title="Wed Dec 31 2025 12:10:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p><strong>1. 先看装没装</strong>​</p>
<p>打开终端，输入：</p>
<pre><code class="hljs language-css" lang="css">rpm -<span class="hljs-selector-tag">q</span> libicu
</code></pre>
<p>要是显示没装，就继续往下走。</p>
<hr/>
<p><strong>2. 找到 rpm 文件</strong>​</p>
<p><strong>安装包下载：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F3cfd8ff1d21a" title="https://pan.quark.cn/s/3cfd8ff1d21a" target="_blank" ref="nofollow noopener noreferrer">pan.quark.cn/s/3cfd8ff1d…</a>，把 <code>libicu-62.1-6.ky10.x86_64.rpm</code>放到一个方便的地方，比如 <code>/home/你的用户名/下载/</code>或者 <code>/tmp</code>。</p>
<hr/>
<p><strong>3. 开始安装</strong>​</p>
<p>用管理员权限（root）来装，命令格式是：</p>
<pre><code class="hljs">sudo rpm -ivh 文件的完整路径
</code></pre>
<p>具体例子：</p>
<pre><code class="hljs language-bash" lang="bash">sudo rpm -ivh /tmp/libicu-62.1-6.ky10.x86_64.rpm
</code></pre>
<p>等着跑完进度条就行了。</p>
<hr/>
<p><strong>4. 验证一下</strong>​</p>
<p>装完再查一次：</p>
<pre><code class="hljs language-css" lang="css">rpm -<span class="hljs-selector-tag">q</span> libicu
</code></pre>
<p>能显示出 <code>libicu-62.1-6.ky10.x86_64</code>就说明搞定了。</p>
<hr/>
<p><strong>5. 万一报错了（最常见的是缺依赖）</strong> ​</p>
<p>如果报错说缺别的库，别慌。麒麟系统一般自带 yum，用它自动解决依赖更省事：</p>
<pre><code class="hljs language-bash" lang="bash">sudo yum install ./libicu-62.1-6.ky10.x86_64.rpm
</code></pre>
<p>注意这里前面要加 <code>./</code>或者写全路径，让 yum 知道你要装的是本地文件。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Worktrunk 完全指南：让 Git Worktree 和 Claude Code 和平共处]]></title>    <link>https://juejin.cn/post/7589828815939633206</link>    <guid>https://juejin.cn/post/7589828815939633206</guid>    <pubDate>2025-12-31T12:27:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828815939633206" data-draft-id="7589838714449887273" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Worktrunk 完全指南：让 Git Worktree 和 Claude Code 和平共处"/> <meta itemprop="keywords" content="前端,AI编程,Claude"/> <meta itemprop="datePublished" content="2025-12-31T12:27:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cos"/> <meta itemprop="url" content="https://juejin.cn/user/1698115646132254"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Worktrunk 完全指南：让 Git Worktree 和 Claude Code 和平共处
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1698115646132254/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cos
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:27:31.000Z" title="Wed Dec 31 2025 12:27:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cosine.ren%2Fpost%2Fgit-worktrunk-guide" target="_blank" title="https://blog.cosine.ren/post/git-worktrunk-guide" ref="nofollow noopener noreferrer">blog.cosine.ren/post/git-wo…</a></p>
</blockquote>
<h2 data-id="heading-0">写在前面</h2>
<p>最近用 Claude Code 写代码的频率越来越高，有时候会同时开三四个任务：一个在修 bug，一个在加新功能，一个在 review 中，还有一个在跑测试验证新点子。问题来了：它们都需要独立的工作目录，不然会互相串代码。</p>
<p>Git 的 <code>worktree</code> 功能本来就是为这种场景设计的，但原生命令实在有些啰嗦。传统创建一个新 worktree 要这样：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree add -b feature-auth ../myproject-feature-auth
<span class="hljs-built_in">cd</span> ../myproject-feature-auth
</code></pre>
<p>删掉它又得回到主目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ../myproject
git worktree remove ../myproject-feature-auth
git branch -d feature-auth
</code></pre>
<p>分支名要输三次，每次都要手动 <code>cd</code>。干这事儿多了，会觉得有些浪费生命，这也是我之前为什么不喜欢 worktree。</p>
<p>直到发现 <a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2F" target="_blank" title="https://worktrunk.dev/" ref="nofollow noopener noreferrer">Worktrunk</a>，才发现 worktree 管理原来可以这么优雅（当然还有很多别的工具）。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmax_sixty%2Fstatus%2F2006077845391724739" target="_blank" title="https://x.com/max_sixty/status/2006077845391724739" ref="nofollow noopener noreferrer">x.com/max_sixty/s…</a></p>
<p>用下来感觉非常好，写一篇博客卖一卖安利。</p>
<h2 data-id="heading-1">Worktrunk 是什么</h2>
<p>简单来说，Worktrunk 是一个 <strong>Git Worktree 的 CLI 包装工具</strong>，专门为<strong>并行运行多个 AI Agent</strong> 的场景优化。它的核心理念是：</p>
<blockquote>
<p><strong>每个 worktree 对应一个分支，用分支名管理 worktree，路径自动生成。</strong></p>
</blockquote>
<p>对比一下命令差异就能感受到差异：</p>






























<table><thead><tr><th>任务</th><th>Worktrunk</th><th>原生 Git</th></tr></thead><tbody><tr><td>切换到某个 worktree</td><td><code>wt switch feat</code></td><td><code>cd ../repo.feat</code></td></tr><tr><td>创建 worktree + 启动 Claude</td><td><code>wt switch -c -x claude feat</code></td><td><code>git worktree add -b feat ../repo.feat &amp;&amp; cd ../repo.feat &amp;&amp; claude</code></td></tr><tr><td>清理当前 worktree</td><td><code>wt remove</code></td><td><code>cd ../repo &amp;&amp; git worktree remove ../repo.feat &amp;&amp; git branch -d feat</code></td></tr><tr><td>列出所有 worktree 状态</td><td><code>wt list</code></td><td><code>git worktree list</code> (只显示路径)</td></tr></tbody></table>
<p>基本就是把 <code>git worktree</code> 的操作复杂度从「记三个参数」降到「说个分支名」。</p>
<h2 data-id="heading-2">为什么需要 Worktrunk?</h2>
<p>如果你只是偶尔用一下 worktree，原生命令当然就行了。但当你需要<strong>频繁并行开发</strong>（比如同时跑多个 AI Agent）或者<strong>需要自动化流程</strong>（创建 worktree 后自动装依赖、跑测试）的时候，Worktrunk 能省下不少时间和心智负担。它本质上是把「用 worktree 的正确姿势」固化成了工具。</p>
<h2 data-id="heading-3">安装与配置</h2>
<h3 data-id="heading-4">安装</h3>
<p><strong>macOS/Linux (推荐 Homebrew)：</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew install max-sixty/worktrunk/wt
</code></pre>
<p><strong>或者用 Cargo：</strong></p>
<pre><code class="hljs language-bash" lang="bash">cargo install worktrunk
</code></pre>
<h3 data-id="heading-5">Shell 集成</h3>
<p>装完之后<strong>必须跑这一步</strong>，否则 <code>wt switch</code> 无法切换目录：</p>
<pre><code class="hljs language-bash" lang="bash">wt config shell install
</code></pre>
<p>它会在你的 <code>.zshrc</code> 或 <code>.bashrc</code> 里加一段函数，让 <code>wt</code> 命令可以改变当前 shell 的工作目录。</p>
<p>装完重启终端，跑 <code>wt --version</code> 确认安装成功。</p>
<h2 data-id="heading-6">核心命令详解</h2>
<h3 data-id="heading-7"><code>wt switch</code> - 切换/创建 Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fswitch%2F" target="_blank" title="https://worktrunk.dev/switch/" ref="nofollow noopener noreferrer">wt switch | Worktrunk</a></p>
<p>这是最常用的命令，用法极简：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 切换到已存在的 worktree (分支名 feat)</span>
wt switch feat

<span class="hljs-comment"># 基于主分支 main 创建新 worktree + 分支 feat</span>
wt switch -c feat

<span class="hljs-comment"># 创建 worktree + 自动启动 Claude Code</span>
wt switch -c feat -x claude

<span class="hljs-comment"># 基于 dev 分支创建新 worktree + 分支 feat-new (而不是 main) + 自动启动 claude</span>
wt switch -c feat-new -b dev -x claude
</code></pre>
<p><strong>路径规则</strong>： Worktrunk 会自动在主仓库的<strong>同级目录</strong>下创建 worktree，命名格式是 <code>&lt;repo&gt;.&lt;branch&gt;</code>。比如主仓库在 <code>~/code/myproject</code>，分支 <code>feat</code> 的 worktree 就在 <code>~/code/myproject.feat</code>。</p>
<p><strong>参数说明</strong>：</p>
<ul>
<li><code>-c</code> / <code>--create</code>：创建新 worktree + 分支</li>
<li><code>-x &lt;cmd&gt;</code>：切换后自动执行命令 (比如 <code>claude</code>, <code>code</code>, <code>npm install</code>)</li>
<li><code>-b &lt;base&gt;</code>：指定基础分支 (默认是 <code>main</code>)</li>
</ul>

























<table><thead><tr><th>Shortcut</th><th>含义</th></tr></thead><tbody><tr><td><code>^</code></td><td>默认分支（main/master）</td></tr><tr><td><code>@</code></td><td>当前分支/工作树</td></tr><tr><td><code>-</code></td><td>之前的工作目录（例如 <code>cd -</code> ）</td></tr><tr><td/><td/></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">wt switch -                      <span class="hljs-comment"># Back to previous</span>
wt switch ^                      <span class="hljs-comment"># Default branch worktree</span>
wt switch --create fix --base=@  <span class="hljs-comment"># Branch from current HEAD</span>
</code></pre>
<h4 data-id="heading-8">实战场景</h4>
<p>假设你在跑三个并行任务：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Terminal 1: 修复认证 bug</span>
wt switch -c -x claude fix-auth

<span class="hljs-comment"># Terminal 2: 重构 API</span>
wt switch -c -x claude refactor-api

<span class="hljs-comment"># Terminal 3: 加新功能</span>
wt switch -c -x claude feat-dashboard
</code></pre>
<p>每个 Claude 实例跑在独立目录里，互不干扰。</p>
<h3 data-id="heading-9"><code>wt list</code> - 查看所有 Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Flist%2F" target="_blank" title="https://worktrunk.dev/list/" ref="nofollow noopener noreferrer">wt list | Worktrunk</a></p>
<pre><code class="hljs language-bash" lang="bash">wt list
</code></pre>
<p>输出大概长这样:</p>
<pre><code class="hljs language-bash" lang="bash">wt list
  Branch       Status        HEAD±    main↕  Remote⇅  Commit    Age   Message
@ feature-api  +   ↕⇡     +54   -5   ↑4  ↓1   ⇡3      ec97decc  30m   Add API tests
^ main             ^⇅                         ⇡1  ⇣1  6088adb3  4d    Merge fix-auth: hardened to…
+ fix-auth         ↕|                ↑2  ↓1     |     127407de  5h    Add secure token storage

○ Showing 3 worktrees, 1 with changes, 2 ahead, 1 column hidden
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7338c58af7841be90ac2fdbd1eaae97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767788851&amp;x-signature=5bLsTOb8NbUHYlJe57%2BIwRewF4k%3D" alt="" loading="lazy"/></p>
<p>比原生 <code>git worktree list</code> 强很多，可以看到很多信息</p>
<ul>
<li><strong>Git 状态</strong>：有多少未提交/未追踪文件</li>
<li><strong>CI 状态</strong>：如果配置了 GitHub Actions,会显示最新的构建状态</li>
</ul>
<p>对于管理多个 worktree 来说,这个视图非常实用。</p>
<h3 data-id="heading-10"><code>wt remove</code> - 清理 Worktree</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fremove%2F" target="_blank" title="https://worktrunk.dev/remove/" ref="nofollow noopener noreferrer">wt remove | Worktrunk</a></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除当前 worktree + 分支</span>
wt remove

<span class="hljs-comment"># 删除指定 worktree</span>
wt remove feature-branch
wt remove old-feature another-branch

<span class="hljs-comment"># 删除 worktree 但保留分支</span>
wt remove --no-delete-branch feature-branch

<span class="hljs-comment"># 强制删除未合并的分支</span>
wt remove -D experimental
</code></pre>
<h3 data-id="heading-11"><code>wt merge</code> - 合并工作流</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fmerge%2F" target="_blank" title="https://worktrunk.dev/merge/" ref="nofollow noopener noreferrer">wt merge | Worktrunk</a></p>
<p>这个命令封装了「合并 → 清理」的完整流程：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 把当前 worktree 合并到默认分支 如 main</span>
wt merge
<span class="hljs-comment"># 把当前 worktree 合并到 dev 分支</span>
wt merge dev
<span class="hljs-comment"># 合并后保留工作树</span>
wt merge --no-remove
<span class="hljs-comment"># 保留提交历史（不合并）</span>
wt merge --no-squash
<span class="hljs-comment"># 跳过提交/合并（除非使用 --no-rebase 参数，否则 rebase 仍会运行）</span>
wt merge --no-commit
</code></pre>
<p>如果配置了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fhook%2F" target="_blank" title="https://worktrunk.dev/hook/" ref="nofollow noopener noreferrer"><strong>pre-merge hook</strong></a>，会在合并前自动跑测试或 lint。</p>
<h3 data-id="heading-12"><code>wt select</code> - 交互式选择器</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fselect%2F" target="_blank" title="https://worktrunk.dev/select/" ref="nofollow noopener noreferrer">wt select | Worktrunk</a></p>
<p>如果你记不清 worktree 名字,可以用 <code>select</code> 命令:</p>
<pre><code class="hljs language-bash" lang="bash">wt select
</code></pre>
<p>会弹出一个 fzf 风格的界面,用方向键选择要切换的 worktree。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db7db9a9a114ac6ac6a4697197ee3ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY29z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767788851&amp;x-signature=b1KFa4lgCDpAeGIx0biuEE%2FOsrU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-13">Hooks</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fhook%2F" target="_blank" title="https://worktrunk.dev/hook/" ref="nofollow noopener noreferrer">wt hook | Worktrunk</a></p>
<p>Worktrunk 支持在 worktree 生命周期的不同阶段执行命令，同时支持全局用户 hook 配置（<code>~/.config/worktrunk/config.toml</code> ）和项目 hook 配置（ <code>.config/wt.toml</code>）
好的,我只给你补充 Hook 系统这一段内容:</p>
<h3 data-id="heading-14">Hook 类型一览</h3>





















































<table><thead><tr><th>Hook</th><th>触发时机</th><th>阻塞模式</th><th>失败即停</th></tr></thead><tbody><tr><td><code>post-create</code></td><td>worktree 创建后</td><td>是</td><td>否</td></tr><tr><td><code>post-start</code></td><td>worktree 创建后</td><td>否(后台)</td><td>否</td></tr><tr><td><code>post-switch</code></td><td>每次切换后</td><td>否(后台)</td><td>否</td></tr><tr><td><code>pre-commit</code></td><td>merge 时提交前</td><td>是</td><td>是</td></tr><tr><td><code>pre-merge</code></td><td>合并到目标分支前</td><td>是</td><td>是</td></tr><tr><td><code>post-merge</code></td><td>合并成功后</td><td>是</td><td>否</td></tr><tr><td><code>pre-remove</code></td><td>worktree 删除前</td><td>是</td><td>是</td></tr></tbody></table>
<p><strong>阻塞模式</strong>: 命令执行完成前,主流程会等待<br/>
<strong>失败即停</strong>: 第一个失败的命令会中止整个操作</p>
<h3 data-id="heading-15">核心 Hooks 说明</h3>
<p><strong>post-create</strong> - worktree 创建后立即执行,会阻塞直到完成:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-create]</span>
<span class="hljs-attr">install</span> = <span class="hljs-string">"npm ci"</span>                    <span class="hljs-comment"># 安装依赖</span>
<span class="hljs-attr">migrate</span> = <span class="hljs-string">"npm run db:migrate"</span>        <span class="hljs-comment"># 数据库迁移</span>
<span class="hljs-attr">env</span> = <span class="hljs-string">"cp .env.example .env"</span>          <span class="hljs-comment"># 复制环境配置</span>
</code></pre>
<p><strong>post-start</strong> - worktree 创建后在后台执行,不阻塞切换:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-start]</span>
<span class="hljs-attr">build</span> = <span class="hljs-string">"npm run build"</span>               <span class="hljs-comment"># 构建项目</span>
<span class="hljs-attr">server</span> = <span class="hljs-string">"npm run dev"</span>                <span class="hljs-comment"># 启动开发服务器</span>
</code></pre>
<p>日志输出到 <code>.git/wt-logs/{branch}-{source}-post-start-{name}.log</code></p>
<p><strong>post-switch</strong> - 每次 <code>wt switch</code> 后在后台执行(无论是新建、切换还是切到当前):</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">post-switch</span> = <span class="hljs-string">"echo 'Switched to {{ branch }}'"</span>
</code></pre>
<p><strong>pre-commit</strong> - merge 时提交前执行,失败即停:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-commit]</span>
<span class="hljs-attr">format</span> = <span class="hljs-string">"cargo fmt -- --check"</span>       <span class="hljs-comment"># 代码格式检查</span>
<span class="hljs-attr">lint</span> = <span class="hljs-string">"cargo clippy -- -D warnings"</span>  <span class="hljs-comment"># Lint 检查</span>
</code></pre>
<p><strong>pre-merge</strong> - 合并到目标分支前执行,失败即停:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-merge]</span>
<span class="hljs-attr">test</span> = <span class="hljs-string">"cargo test"</span>                   <span class="hljs-comment"># 运行测试</span>
<span class="hljs-attr">build</span> = <span class="hljs-string">"cargo build --release"</span>       <span class="hljs-comment"># 生产构建</span>
</code></pre>
<p><strong>post-merge</strong> - 合并成功后在目标分支的 worktree 执行(如果存在),否则在主 worktree 执行:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">post-merge</span> = <span class="hljs-string">"cargo install --path ."</span>
</code></pre>
<p><strong>pre-remove</strong> - worktree 删除前执行,失败即停:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[pre-remove]</span>
<span class="hljs-attr">cleanup</span> = <span class="hljs-string">"rm -rf /tmp/cache/{{ branch }}"</span>
</code></pre>
<h3 data-id="heading-16">模板变量</h3>
<p>Hook 命令支持模板变量,运行时自动展开:</p>






































































<table><thead><tr><th>变量</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td><code>{{ repo }}</code></td><td>my-project</td><td>仓库名</td></tr><tr><td><code>{{ branch }}</code></td><td>feature-foo</td><td>分支名</td></tr><tr><td><code>{{ worktree }}</code></td><td>/path/to/worktree</td><td>worktree 绝对路径</td></tr><tr><td><code>{{ worktree_name }}</code></td><td>my-project.feature-foo</td><td>worktree 目录名</td></tr><tr><td><code>{{ repo_root }}</code></td><td>/path/to/main</td><td>主仓库根路径</td></tr><tr><td><code>{{ default_branch }}</code></td><td>main</td><td>默认分支名</td></tr><tr><td><code>{{ commit }}</code></td><td>a1b2c3d4e5f6...</td><td>HEAD 完整 SHA</td></tr><tr><td><code>{{ short_commit }}</code></td><td>a1b2c3d</td><td>HEAD 短 SHA</td></tr><tr><td><code>{{ remote }}</code></td><td>origin</td><td>主远程名称</td></tr><tr><td><code>{{ remote_url }}</code></td><td><a href="https://link.juejin.cn?target=mailto%3Agit%40github.com" target="_blank" title="mailto:git@github.com" ref="nofollow noopener noreferrer">git@github.com</a>:user/repo.git</td><td>远程 URL</td></tr><tr><td><code>{{ upstream }}</code></td><td>origin/feature</td><td>上游跟踪分支</td></tr><tr><td><code>{{ target }}</code></td><td>main</td><td>目标分支(仅 merge hooks)</td></tr></tbody></table>
<h3 data-id="heading-17">安全机制</h3>
<p>项目 hook(<code>.config/wt.toml</code>)首次运行需要用户批准:</p>
<pre><code class="hljs language-plain" lang="plain">▲ repo needs approval to execute 3 commands:
○ post-create install:
  echo 'Installing dependencies...'
❯ Allow and remember? [y/N]
</code></pre>
<ul>
<li>批准记录保存在用户配置中</li>
<li>命令变更需要重新批准</li>
<li><code>--yes</code> 跳过提示(适用于 CI)</li>
<li><code>--no-verify</code> 完全跳过 hooks</li>
</ul>
<p>管理批准记录:</p>
<pre><code class="hljs language-bash" lang="bash">wt hook approvals add      <span class="hljs-comment"># 预批准当前项目所有命令</span>
wt hook approvals clear    <span class="hljs-comment"># 清除当前项目批准</span>
wt hook approvals clear --global  <span class="hljs-comment"># 清除全局批准</span>
</code></pre>
<h3 data-id="heading-18">用户级 Hooks</h3>
<p>在 <code>~/.config/worktrunk/config.toml</code> 中配置的 hook 会对所有仓库生效,且不需要批准:</p>






























<table><thead><tr><th>维度</th><th>项目 hook</th><th>用户 hook</th></tr></thead><tbody><tr><td>配置位置</td><td><code>.config/wt.toml</code></td><td><code>~/.config/worktrunk/config.toml</code></td></tr><tr><td>作用范围</td><td>单个仓库</td><td>所有仓库</td></tr><tr><td>需要批准</td><td>是</td><td>否</td></tr><tr><td>执行顺序</td><td>后执行</td><td>先执行</td></tr></tbody></table>
<p>我觉得看下来，这个 hook 非常重要，可以<strong>复用主 worktree 的缓存</strong>:</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[post-create]</span>
<span class="hljs-comment"># 软链接 node_modules 避免重复安装</span>
<span class="hljs-attr">cache</span> = <span class="hljs-string">"ln -sf {{ repo_root }}/node_modules node_modules"</span>
<span class="hljs-attr">env</span> = <span class="hljs-string">"cp {{ repo_root }}/.env.local .env"</span>
</code></pre>
<h3 data-id="heading-19">独立运行 Hooks</h3>
<p>除了自动触发,也可以手动运行 hook 进行测试或重试:</p>
<pre><code class="hljs language-bash" lang="bash">wt hook pre-merge           <span class="hljs-comment"># 运行 pre-merge hooks</span>
wt hook pre-merge --<span class="hljs-built_in">yes</span>     <span class="hljs-comment"># 跳过批准提示(适用于 CI)</span>
wt hook show                <span class="hljs-comment"># 查看所有已配置的 hooks</span>
</code></pre>
<p><strong>适用场景</strong>: Hook 开发测试、CI 流水线、失败后重试等。</p>
<h3 data-id="heading-20">Claude Code 插件监测状态</h3>
<pre><code class="hljs language-bash" lang="bash">claude plugin marketplace add max-sixty/worktrunk
claude plugin install worktrunk@worktrunk
</code></pre>
<h4 data-id="heading-21">手动设置状态标记</h4>
<p>除了自动追踪 Claude 状态,你也可以手动给 worktree 设置任何标记，用于其他工作流：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 给当前分支设置标记</span>
wt config state marker <span class="hljs-built_in">set</span> <span class="hljs-string">"🚧"</span>

<span class="hljs-comment"># 给指定分支设置标记</span>
wt config state marker <span class="hljs-built_in">set</span> <span class="hljs-string">"✅"</span> --branch feature

<span class="hljs-comment"># 直接操作 Git Config (高级用法)</span>
git config worktrunk.state.feature.marker <span class="hljs-string">'{"marker":"💬","set_at":0}'</span>
</code></pre>
<h4 data-id="heading-22">Statusline 状态栏</h4>
<p><code>wt list statusline --claude-code</code> 可以输出一行紧凑的状态信息,用于 Claude Code 的状态栏显示:</p>
<pre><code class="hljs language-plain" lang="plain">~/w/myproject.feature-auth !🤖 @+42 -8 ↑3 ⇡1 ● | Opus
</code></pre>
<h2 data-id="heading-23">LLM Commit Messages 自动生成提交信息</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2Fllm-commits%2F" target="_blank" title="https://worktrunk.dev/llm-commits/" ref="nofollow noopener noreferrer">LLM Commit Messages | Worktrunk</a></p>
<p>Worktrunk 可以调用 LLM 自动生成 commit message，集成在 <code>wt merge</code>、<code>wt step commit</code>、<code>wt step squash</code> 等命令中。</p>
<p>不配置也能用，默认会基于文件名生成简单的 message，但配置 LLM 后能生成更有意义的提交信息。</p>
<h3 data-id="heading-24">安装与配置</h3>
<p><strong>1. 安装 llm 工具</strong></p>
<p>使用的是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fllm.datasette.io%2F" target="_blank" title="https://llm.datasette.io/" ref="nofollow noopener noreferrer">llm</a>：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install -U llm
<span class="hljs-comment"># 或者直接 brew</span>
brew install llm
</code></pre>
<p><strong>2. 配置 API Key</strong></p>
<p>选择你喜欢的 LLM 提供商：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 Claude (推荐)</span>
llm install llm-anthropic
llm keys <span class="hljs-built_in">set</span> anthropic
<span class="hljs-comment"># 输入你的 Anthropic API Key</span>

<span class="hljs-comment"># 或者使用 OpenAI</span>
llm keys <span class="hljs-built_in">set</span> openai
<span class="hljs-comment"># 输入你的 OpenAI API Key</span>
</code></pre>
<p><strong>3. 配置 Worktrunk</strong></p>
<p>创建配置文件（如果还没有）：</p>
<pre><code class="hljs language-bash" lang="bash">wt config create
</code></pre>
<p>编辑 <code>~/.config/worktrunk/config.toml</code>，添加：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"llm"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"claude-3-5-haiku-latest"</span>]  <span class="hljs-comment"># 或 gpt-4o-mini</span>
</code></pre>
<h3 data-id="heading-25">使用场景</h3>
<p>配置完成后，以下命令会自动生成 commit message：</p>
<p><strong>场景 1: 合并分支时生成 squash commit</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt merge
◎ Squashing 3 commits into a single commit (5 files, +48)...
◎ Generating squash commit message...
   feat(auth): Implement JWT authentication system

   - Add JWT token generation and validation
   - Implement refresh token mechanism
   - Add middleware <span class="hljs-keyword">for</span> protected routes
</code></pre>
<p><strong>场景 2: 提交当前变更</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt step commit
◎ Generating commit message...
   fix(api): Handle null response <span class="hljs-keyword">in</span> user endpoint
</code></pre>
<p><strong>场景 3: 把多个 commit 压缩成一个</strong></p>
<pre><code class="hljs language-bash" lang="bash">$ wt step squash
◎ Squashing 5 commits...
◎ Generating squash commit message...
   refactor(ui): Modernize component architecture
</code></pre>
<h3 data-id="heading-26">使用其他 AI 工具</h3>
<p>除了 <code>llm</code>，任何能从 stdin 读取提示词并输出文本的工具都行：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-comment"># 使用 aichat</span>
<span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"aichat"</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"-m"</span>, <span class="hljs-string">"claude:claude-3-5-haiku-latest"</span>]

<span class="hljs-comment"># 使用自定义脚本</span>
<span class="hljs-section">[commit-generation]</span>
<span class="hljs-attr">command</span> = <span class="hljs-string">"./scripts/generate-commit.sh"</span>
</code></pre>
<h3 data-id="heading-27">Fallback 行为</h3>
<p>如果没配置 LLM，Worktrunk 会生成基于文件名的简单 message：</p>
<pre><code class="hljs language-plain" lang="plain">Changes to auth.rs &amp; config.rs
</code></pre>
<h2 data-id="heading-28">CI 状态集成</h2>
<p>如果你用 GitHub Actions,Worktrunk 可以在 <code>wt list</code> 里显示构建状态:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置 GitHub Token</span>
wt config github.token <span class="hljs-string">"ghp_xxxxxxxxxxxx"</span>

<span class="hljs-comment"># 之后 wt list 就会显示 CI 状态</span>
wt list
</code></pre>
<h2 data-id="heading-29">实战工作流</h2>
<h3 data-id="heading-30">并行跑多个 Claude Code</h3>
<p>假设你在用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzellij.dev%2F" target="_blank" title="https://zellij.dev/" ref="nofollow noopener noreferrer">Zellij</a> 或 Tmux 管理多个终端窗口:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Pane 1: 修 bug</span>
wt switch -c -x claude fix-login-bug

<span class="hljs-comment"># Pane 2: 重构</span>
wt switch -c -x claude refactor-utils

<span class="hljs-comment"># Pane 3: 新功能</span>
wt switch -c -x claude feat-export
</code></pre>
<p>每个 Claude 在独立目录里工作,你可以随时切回主目录看全局状态:</p>
<pre><code class="hljs language-bash" lang="bash">wt switch main
wt list
</code></pre>
<h3 data-id="heading-31">临时验证想法</h3>
<p>有时候你想快速验证一个想法,但不想污染当前分支:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建临时 worktree</span>
wt switch -c -x code experiment

<span class="hljs-comment"># 验证完毕,直接删掉</span>
wt remove
</code></pre>
<p>因为 worktree 是独立目录,删掉不会影响其他分支。</p>
<h3 data-id="heading-32">Review PR 时跑代码</h3>
<p>有 PR 来了,你想在本地跑一下代码:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基于 PR 分支创建 worktree</span>
wt switch -c review-pr-123 -b origin/pr-123

<span class="hljs-comment"># 装依赖、跑测试</span>
npm install
npm run <span class="hljs-built_in">test</span>

<span class="hljs-comment"># Review 完毕,清理</span>
wt remove
</code></pre>
<h2 data-id="heading-33">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fworktrunk.dev%2F" target="_blank" title="https://worktrunk.dev/" ref="nofollow noopener noreferrer">Worktrunk 官网</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Fclaude-code-best-practices" target="_blank" title="https://www.anthropic.com/engineering/claude-code-best-practices" ref="nofollow noopener noreferrer">Anthropic - Claude Code Best Practices</a> (官方推荐的 worktree 工作流)</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fincident.io%2Fblog%2Fshipping-faster-with-claude-code-and-git-worktrees" target="_blank" title="https://incident.io/blog/shipping-faster-with-claude-code-and-git-worktrees" ref="nofollow noopener noreferrer">incident.io - Shipping faster with Claude Code and Git Worktrees</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdocs%2Fgit-worktree" target="_blank" title="https://git-scm.com/docs/git-worktree" ref="nofollow noopener noreferrer">Git Worktree 官方文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[月哥创业3年，还活着！]]></title>    <link>https://juejin.cn/post/7589835342145601546</link>    <guid>https://juejin.cn/post/7589835342145601546</guid>    <pubDate>2025-12-31T12:36:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589835342145601546" data-draft-id="7589839019716689970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="月哥创业3年，还活着！"/> <meta itemprop="keywords" content="前端,面试,全栈"/> <meta itemprop="datePublished" content="2025-12-31T12:36:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端要努力"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288395479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            月哥创业3年，还活着！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288395479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端要努力
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:36:50.000Z" title="Wed Dec 31 2025 12:36:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">说什么呢</h3>
<ul>
<li>18年9月入行，到现在7年多了。。真特码快！粉丝们一步一步看着月哥的成长，感谢大家一直以来的陪伴，和支持！谢谢大家！</li>
<li>写了很多东西，删掉了很多，怕发不出来，思来想去分享一些踩坑经验，和一些浅薄的所见所闻</li>
<li>话会很难听，心态弱的人别看，看完你会骂我！</li>
<li><strong>本故事纯属虚构，如有雷同纯属巧合！</strong></li>
</ul>
<h2 data-id="heading-1">营收篇-大家最感兴趣的</h2>
<ul>
<li>
<p>1000w的越南盾是肯定有的，全浪掉了。。。。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09fe5854636c49f4aafc893eeb7067b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767789410&amp;x-signature=ZbtE%2B9ReU9d7MlQT0DSUvItjrQE%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>挣钱在某些成面来说是一件很简单的事情</p>
</li>
<li>
<p>月入10w越南盾，和呼吸一样简单。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4fca0dddf54a2999d46b7e7ce02620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767789410&amp;x-signature=%2BDl9xs7tfOS6ZBiycZIkHezhg2g%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>哈哈，不逗你们了，正片开始！</p>
</li>
</ul>
<h2 data-id="heading-2">创业篇</h2>
<h3 data-id="heading-3">回到地方创业</h3>
<ul>
<li>
<p>水深的一批，和zf打交道，做了学历提升、考g、考研之类的。。。。然后就是竹篮打水一场空，没啥可聊的其实，反正这玩意，不是短期的生意，你得去做长期打算才能起来量。</p>
</li>
<li>
<p>核心原因就是竞争太激烈，市场调研没做好，光喝酒了，，，哈哈。转头一看一大堆。我日，有些时候得服输，硬上没的好。</p>
</li>
<li>
<p>那个时候招聘销售，我们都给交社保，很多竞品企业压根就不交社保，可能是上海回去的不理解当地行情，有点小钱，不在乎，我觉得这个是应该做的，但是确实是提高了很多成本，然后挣的还不够交给员工社保，笑死了。。。</p>
</li>
<li>
<p>本来去年9月份关掉的话其实亏的不多，我说再熬一年，然后今年9月份全部关停，宣告失败。其实早都要关掉了，但是一个员工怀孕了，没办法，我们得配合她拿完各种补贴。不然说不过去，虽然我可以直接关，我们都是实交的工资注册资金，打官司都没用，公司没钱，早都亏完了，但是亏就亏了，不差这一点了，落个心安，员工也很理解我们，确实一直在亏钱。。好聚好散，等月哥好起来。哈哈！</p>
</li>
<li>
<p>没有欠一分钱工资，还是可以的，不算太失败，哈哈！</p>
</li>
<li>
<p>还是年少轻狂，就像打德州扑克一样，你被套池了，flod 掉你又不甘心，然后all in ，全输掉了。及时止损是一种很强的能力，现在想想，当时还不如换辆迈巴赫，最起码现在还有残值。那个时候每个月的成本都是几十万，现在想想真的可笑，哈哈！
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73ccd9547b02430aaee598bde71b2295~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767789410&amp;x-signature=%2F0JUPQmq1vcKyqHTR0LymPR%2FvFA%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>这些东西是没有任何技术壁垒的，就像奶茶店，火锅店一样，有钱就能干，失败的比例相当大，先手+关系，才能在本地业务吃的深。外来户前期会交很多学费，如果你手里只有几十万，或者小百十万，老老实实守住钱袋子，别乱搞，，你那点钱，打不出水花。。。</p>
</li>
</ul>
<h3 data-id="heading-4">跨境电商</h3>
<ul>
<li>我当时做跨境卖货培训，其实这个一直在做，美区，东南亚，现在已经有前端同学全职在做了，夫妻两个在做，挺不错的。当时业务太多，扩大规模干，确实出成绩了。。坚持做就行。一个月整个几万不是难事。</li>
<li>我们当时去贵州和当地的茶叶企业谈的，当时都谈的差不多，第一笔大概500个就够了，我们在上海有仓库，但是当时涉及到gq收购，和贸易战生意没谈成。现在tt的茶叶生意，依旧很火爆，挺可惜的，手里没那么多现金，这个事情现在依旧可以做。。。前期吃人脉，吃资金！</li>
<li>现在保留一些挣钱的品类，慢慢做。培训暂时没精力搞，程序员培训明年稳定之后可能继续跨境继续开课一波。</li>
</ul>
<h3 data-id="heading-5">足疗店趣事</h3>
<ul>
<li>这个在某些情况是暴利的。但是我胆子比较小，我只喜欢做合法的生意，我们就讲合法的生意哈！</li>
<li>当时我们准备在我们老家开一个足疗店，纯绿色哈，别想歪。然后就开始选址，敲定规模，包括前期投入的资金，一堆破事。。。</li>
<li>老家房租便宜，最好的地段当时看了400多平，然后前期投入在200个+，投资人大概5个，后面一算细账感觉很奇怪。</li>
<li>装修是大头，这里水更深，我艹。。。</li>
<li>共计11个房间，客单价在150左右，每个月上满，纯利在11个w左右，然后5个投资人，一个人也就2个w左右，这特么做什么，不够费事的。这还是最优的情况下。</li>
<li>没开店你就要开始培训技师，在开店之前都是要正常付工资的，一般第一个月保底在12000左右，看颜值和技术，你10个技师，你每个月的运营成本就在10几个w，但是客单价小房间这么少，肯定不好挣钱的。</li>
<li>我当时给到的意见就是，扩大规模，投资人不能超过3个，不然没意思。</li>
<li>回本周期最起码三年，最后算笔细账，就没干了。没太大的搞头，遍地都是，没有壁垒，朋友都劝我别搞，然后就不了了之了。</li>
<li>什么奶茶店，饭店 ，，，别碰就完了。</li>
</ul>
<h3 data-id="heading-6">海外班</h3>
<ul>
<li>
<p>成绩出来的不少，我们一直在坚持做，第一年的时候就已经亏本了，到现在我们每周3次的直播，依旧在坚持做，但是你看我一次没有宣传，学员问我们为什么还继续做，因为我知道这件事是正确的事，语言的学习是长期的，我想通过自己的努力告诉你们，坚持正确的事。亏就亏，我认。我只是没宣传，不代表我没继续服务。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc479464a39d438ba5b1c71928308cb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767789410&amp;x-signature=fYWuCinzLXFMBYORIyy%2FIMP1bgk%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>我在这个阶段认识了非常多国外牛批的人，提升了我自己的个人认知，我们明年会开班，德语+英语+技术，全球选择工作的权利，，，</p>
</li>
<li>
<p>本来日语在计划之中，身为退役军人的我，情感比较强烈，最近中日关系大家也之后，这个钱不挣也罢，现在就是去你md，tmd我要干你们小日子。cnmd!</p>
</li>
<li>
<p>我们后续会推出，月票，季票，年票，国外班的面试辅导，会单独的抽离出来。</p>
</li>
<li>
<p>现在出海的很多业务，都是商机！</p>
</li>
</ul>
<h3 data-id="heading-7">总结-精力过于分散</h3>
<ul>
<li>失败的原因，精力过于分散，我无论哪一行，我如果垂直下去，我肯定能做出来，为什么关掉跳出来，第一持续亏损，第二因为小孩要回上海读书，最重要一点是觉得没意义了。。。</li>
<li>专注自己擅长的事，把事做好。</li>
<li>低调做人，</li>
</ul>
<h2 data-id="heading-8">投资篇</h2>
<ul>
<li>不擅长，但是圈子里面一堆牛批的人。。。他们真的很牛批。没精力去整这些，我只能说月入百万都是弟弟！</li>
<li>基金目前小亏</li>
<li>黄金大赚，我400多1g买的，因为之前缺钱，600多卖掉的，因为此事，我老婆骂了我好久。没办法，，，我不喜欢借钱，不喜欢欠人情，所以卖掉周转，白干一场，本金也没了。。。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e33d86ae76d8474abaf9a92833d3adcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767789410&amp;x-signature=NFSCeONrvaKX2j8bVubptiBS1tY%3D" alt="" loading="lazy"/></li>
<li>当年全仓黄金，yyds，哈哈！</li>
<li>有些东西该你的就是你的，不该你的成为回忆，内心其实没太大波澜。</li>
</ul>
<h2 data-id="heading-9">人脉篇</h2>
<ul>
<li>结识了一堆老板，，，，结识了很多技术大佬</li>
<li>人脉的第一性原则，利益互换，，当你自身没能力的时候，你没有人脉可言。</li>
<li>一定要记住，你强了之后，周围人都是强者，你弱的时候，周围都是弱者，想要变强革新自己，或者拿钱开路。等量才能交换。为此，我不知送了多礼，请了多少饭局！</li>
<li>别和负能量的人为伍，人性弱点，很多人见不得你好的。。。。你可以要饭，但是你不能变强，，，这点不细聊。技术圈子相对来说还是比较单纯的。</li>
<li>我现在已经戒酒了，你们懂的。很多都是虚的，我八块腹肌都喝没了，我回老家的时候是120多斤，现在快160了，艹，，，专心搞技术。</li>
<li>我老婆说我肚子像怀孕6个月了。fck,怀念从前，这张照片是我刚干前端那会，我日了。现在就不发了，哈哈，大肚皮。99归1
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5327a0f1bed04756af7ed55170f55f9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv6KaB5Yqq5Yqb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767789410&amp;x-signature=cEP11OKt4%2Fq2KJl5cN7Tuj9z9bA%3D" alt="" loading="lazy"/></li>
</ul>
<h2 data-id="heading-10">培训篇</h2>
<p>市场一直都在，现在就是人多，竞争激烈。岗位也很多。ai在杀死一批人，也在创造一批就业。对于很多人来说，行情好你依旧找不到好工作！</p>
<h4 data-id="heading-11">线上</h4>
<ul>
<li>我们现在有前端培训，后端培训，ai全栈培训。</li>
<li>面试培训是刚需，存量市场比较大，割韭菜的比较多。我们做了这么久，基本上都是拼口碑的。</li>
<li>大家比较谨慎的原因就是怕被割韭菜，有些机构的宣传真敢，，我艹。看了一眼假，但是噱头强，，不知道的人以为很牛批，就业人的数量，比学员人数还多，我艹，你敢信，我艹。。。。</li>
<li>我们在认真的改革，做好培训</li>
</ul>
<h4 data-id="heading-12">线下</h4>
<ul>
<li>目前在上海，我们现在一直在亏，因为人少，我们收的都是有工作经验的，离职的同学，目前不收0基础，学历低就业太难了。</li>
</ul>
<h2 data-id="heading-13">前端篇</h2>
<p>你记住一点，你只要技术强，你就能有各种出路，，，无关年龄和学历，剩下的就是拼搏，去锻炼自己的技术，技术这一行，技术是核心竞争力。</p>
<h3 data-id="heading-14">前端还能干吗？</h3>
<ul>
<li>目前前端被自媒体说的，已经死一万次了，每次出来新的ai，前端已死，前端已死，后面发现，这玩意能够高度的提升效率，但是替代程序员，目前来看不可能。。。。</li>
<li>再问你有退路吗？如果没有，别想七想八，疯狂的学习技术，才能有出路。</li>
<li>行情卷，因为人多，岗位不少，优质人才依旧难求，菜逼一堆，天天叫嚣，，，你除了菜，而且还不学，你肯定难找到好工作，因为你已经放弃了自己。</li>
</ul>
<h3 data-id="heading-15">你为啥迟迟进不了大厂</h3>
<ul>
<li>菜、懒、不愿意学。三分钟热度！</li>
<li>别和我说，年纪大、学历低，早干啥去了。</li>
<li>坑不还是你自己踩的，而且越踩越深，直到爬不出来了，才会后悔，</li>
<li>然后还是老样子，道理你都知道，想得到，又不愿意做到，那些专科的年纪大的同学，拿到价值，你又说别人是卷王，，，你怎么不说别人努力，你玩的时候别人在学，你浪费的时间别人都熬住了，拿到价值不是顺理成章！</li>
<li>对于当下来说，很多履历是进不了了，因为之前的机会被你浪费掉了，但是涨薪，多挣钱是可以做到的。</li>
</ul>
<h3 data-id="heading-16">转行</h3>
<ul>
<li>我就一句话， 前端你都学不好，你转个蛋！转了还是菜。只能掉进另一个坑！浪费钱，浪费时间，不如时间花在自己提升这块。</li>
</ul>
<h3 data-id="heading-17">保持良好的现金流（单位越南盾）</h3>
<ul>
<li>如果你月入5万，存款只有100多个，别去上车500个以上的fz，现在行情下千万别成为f奴，，，，量力而为。</li>
<li>因为程序员这行，可能不是可持续性高收入的工作。</li>
<li>很多人说月入5w很多，在我的视野里也就一般，别去透支未来，就像月哥一样，明明可以退休，偏要迎难而上，最后碰了一头的包！</li>
</ul>
<h3 data-id="heading-18">活的精彩</h3>
<ul>
<li>有钱才会精彩，别犟，等你真正几百个的时候再来和我犟，还没到这个水平的时候，低调挣钱，存款在你手，天下你才有。</li>
<li>有钱之后你才能玩的开始，你才能拥有精彩人生。。。</li>
<li>不然的话就是活的难受，想干的事，干不了，然后说我无欲无求，你要无欲无求，你把钱捐给我，你倒是出家啊，你为什么没去，不还是脱离不了世俗。</li>
<li>你躺平不了的，一旦你有了家庭，有了孩子，还要赡养父母，你已经不是在为你自己而活，你已不是你，，，，</li>
</ul>
<h2 data-id="heading-19">心态篇</h2>
<p><strong>失败的原因，就是放弃了自己，每个人都可以变好，从任何年纪开始，都是新生，别去顾虑他人眼光，都关注自己技术深度和荷包厚度。</strong></p>
<h4 data-id="heading-20">焦虑</h4>
<ul>
<li>你为什么会焦虑？比方让你一年挣100个小目标，你肯定不会焦虑，因为这个压根就完不成，因为没几个马云、马斯克，，，但是让你去做涨薪，进大厂这种事，你就会焦虑，因为你有完成这件事的实力，但是你不去做，你自然焦虑。</li>
<li>我身边有大龄、专科、还有大龄+专科的同学都有进大厂的案例，，，，，这时候有人就会跳出来说，幸存者偏差了，，，我想说很难吗？你来说一说难在哪里？</li>
<li>难在你没实力，难在你执行力差，难在你懒惰，难在你躺平十多年，，，，还是说公司卡年纪，卡学历，卡履历！</li>
<li>在前端圈，你花十年进阶自己，你不牛批才怪。那时候你就会说，我为什么要进大厂！</li>
<li>和优秀的人对比，找差距，然后补齐差价，不一定能大成，但是绝对会让你的收入大涨！</li>
<li>抱怨和焦虑，说明你内心还想变好。那就利用这股劲，去行动。结果或许不由人，但过程每一步，都算数，持续学习，有事情做，焦虑的状态自然无！</li>
</ul>
<h4 data-id="heading-21">保持自信</h4>
<ul>
<li>失败！什么特么叫做失败，，，就算我现在嘎了，我也不会后悔我现在所做，我觉得很精彩呀。我死的那一刻回忆我的所做所为，不错，优秀，，，这辈子不枉此生！</li>
</ul>
<h4 data-id="heading-22">强者论</h4>
<ul>
<li>你弱你有理，所以你的职场发展不顺利，你想成为强者，但是你的执行力太差，然后导致你的能力太差，在就业市场上你就是弱者，你没有更好的选择，别人大厂offer拿到手软，你是外包都嫌弃，不愿意给你涨薪水。</li>
<li>话不好听，因为要拿实力说话，没有实力，别抱怨，你会活的舒服些。毕竟吃技术饭的，你技术不行，你有什么理由抱怨。。。。抱怨别人太强，还是招聘方要求太高，，，买方市场，肯定要优中择优！</li>
</ul>
<h4 data-id="heading-23">没苦硬吃</h4>
<ul>
<li>在某些情况下，你不得不去吃苦，更多的是当下已经很苦了，想改变现状，</li>
<li>但是谁特么脑子有病，没苦硬吃，更多的现实是不得不。因为还不够格说这句话：没苦硬吃。</li>
<li>提升自己，，这叫奋斗</li>
</ul>
<h4 data-id="heading-24">现在努力还有用吗？</h4>
<ul>
<li>月哥，我都30多岁了，我还有机会吗？</li>
<li>月哥我专科，我还有机会吗？</li>
<li>月哥我失业一年了，我还有机会吗？</li>
<li>。。。。</li>
<li>身处低谷，怎么走都是向上，但是你要去走，因为挡在你面前的只剩你自己了。。。</li>
<li>突破自己，才能获得新生，，，最起码你的内心深处不会后悔了，最后一搏，死也要死的明白！</li>
<li>送你们一句话，只要开始，虽晚不迟，，</li>
</ul>
<h4 data-id="heading-25">多吸正能量的空气</h4>
<ul>
<li>永远要乐观，悲观者永远正确，，，，比方说，在月哥的圈子里，基本上都是很努力的人，认识很多p7,p8的技术专家，大家的共性都很努力，不会抱怨，专注自己的提升，而不是人云亦云。</li>
<li>千万别在垃圾里面去证明自己，多想上沟通，你强了之后，身边的乌烟瘴气就会少很多，身边的人才会强！</li>
</ul>
<h4 data-id="heading-26">屏蔽恶意</h4>
<ul>
<li>之前报警抓了恶意诽谤的人，对我的心态影响不小，有些人就是坏，，，但是你无可奈何，现在总结就是：屏蔽恶意，专注自己！</li>
</ul>
<h4 data-id="heading-27">失败，难听</h4>
<ul>
<li>你觉得我说的难听，当你一次又一次被拒，面试失败的时候，煎熬的时候，家人缺钱的时候，你就知道月哥说的有多对了，</li>
<li>你越盯着结果，你越容易失败，没人会知道结果，先把眼前的路走扎实，你越急于求成，你越容易摔跟头，前端这行，踏实学习的人，走的更远，你哪怕走的慢一点，只要方向对，坚持在走，你的每一步都值得，别贪快，别偷懒，坚持的学习，才是好本事！</li>
</ul>
<h3 data-id="heading-28">你还有梦吗</h3>
<ul>
<li>每一个创业者，心里都会想，，，，，追梦！</li>
<li>苦还是快乐，是一念之差，，，沉醉其中，何以为苦！何以为乐！</li>
<li>不放弃、不抛弃！老兵不死，，，</li>
</ul>
<h3 data-id="heading-29">创业不易</h3>
<ul>
<li>敢冒险的人，才配赢，，，敢于突破自己的人，不会输，，，虽然说月哥这两年事业上不顺，但是单凭自己能力而言，我抛弃现在的公司，自己单干，依旧能活的不错，因为我确实挺努力的，吃饭的本事练的还行，，，看能不能突破自己的心智瓶颈了。</li>
<li>因为我还没有败，那就要按照自己所想，坚持一下，万一成了呢。在我干游泳教练的时候，我就想，我命不该如此，，，，所以果断换方向，干了前端，努力至今，小起小落，但是对比之前，强太多了。。。内心富足，，，剩下的看天！</li>
</ul>
<h3 data-id="heading-30">你合适做什么</h3>
<ul>
<li>去年前年，手里有点小钱，跨行测试一些事情，，，总结下来，酒喝的挺多，认识的人很多，钱浪费的很多，全亏，，，，不喜欢和某某打交道，，，心累！</li>
<li>然后又想，如果我投资的一些东西，挣到钱了呢，心态是否有改观，，但是并没有，压根不喜欢，我基本上都是托管，只出钱，出不了人，然后就很难做，因为压根不喜欢，虽然亏钱了，我依旧没有多少时间精力在其他事情上。</li>
<li>最后发现，我还是喜欢做培训，我很有耐心，很有经验，大家也喜欢听我吹牛批，我也喜欢吹牛批。</li>
<li>很多人觉得我培训挣了很多，其实并没有多少，你看我这两年的宣传就知道，很少，，，今年8月份，开始改革，9月份回到上海，办了新的公司，9月份，公司营收回正，在向上走，但是前期投的钱还没有收回，还是负债状态，每个月发完工资，其他7788，我个人是一分不挣。小亏一点</li>
<li>但是这么多学员出成绩，内心是非常开心的。这就是做培训的意义。</li>
<li>兜兜转转，我又回到了培训，以前想换个行业挣钱，你会发现隔行如隔山，心态不一样，做自己擅长的事。。。我觉得这就是我擅长的事。</li>
<li>不乱搞了，继续在这个培训这个行业做下去，，，</li>
<li>这段时间，都在准备课程。录制视频。</li>
</ul>
<h2 data-id="heading-31">观望未来</h2>
<ul>
<li>越来越多的超级个体出来了。</li>
<li>非常多的出海业务的涌出。</li>
<li>AI，，，让全栈变得无比容易，让普通程序员变得更加全能，让我们每个人变成超级个体的概率变得相当的大。</li>
<li>因为包括我在内，我身边的很多人，都在搞，属于自己的智能体创业，成本贼低，，，因为最大的成本就是你自己的经历。</li>
<li>AI+英语+全栈 === 王炸</li>
</ul>
<h3 data-id="heading-32">最后</h3>
<ul>
<li>认清自己的定位，脚踏实地的努力!</li>
<li>天总是会亮的，我们需要一点耐心，绝大多数人都死在了天亮之前，，，无论现在有多黑暗，天总会亮的！</li>
<li>最后送大家一句诗：长风破浪会有时，直挂云帆济沧海！</li>
<li>我是月哥，创业交流v：843655240</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[务实的模块化：连接模块(wiring modules)的妙用]]></title>    <link>https://juejin.cn/post/7589564203873009727</link>    <guid>https://juejin.cn/post/7589564203873009727</guid>    <pubDate>2025-12-31T12:51:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203873009727" data-draft-id="7589838742551511059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="务实的模块化：连接模块(wiring modules)的妙用"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-12-31T12:51:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            务实的模块化：连接模块(wiring modules)的妙用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T12:51:25.000Z" title="Wed Dec 31 2025 12:51:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「Pragmatic Modularization: The Case for Wiring Modules」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Fpragmatic-modularization-the-case-for-wiring-modules-c936d3af3611" target="_blank" title="https://proandroiddev.com/pragmatic-modularization-the-case-for-wiring-modules-c936d3af3611" ref="nofollow noopener noreferrer">proandroiddev.com/pragmatic-m…</a>，由Alex Krafts发布于2025年11月22日。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/471cd289d9cd45fd9d1d1ae237404f3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767790285&amp;x-signature=Bgl%2BiejwsBplYwrk62oBft4iZZE%3D" alt="图片来自 Unsplash 的 Randy Fath" loading="lazy"/></p>
<p>如果你正在经历漫长的模块化之旅，你应该已经阅读过官方的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Fmodularization" target="_blank" title="https://developer.android.com/topic/modularization" ref="nofollow noopener noreferrer">Google 开发者指南</a>。你可能已经见过关于提供依赖项的这种具体建议：</p>
<blockquote>
<p>“……app 模块通常是添加依赖项的好地方。要提供实现，请将其指定为所选构建变体或测试源集的依赖项。”</p>
</blockquote>
<p>下图展示了这种模式的一个常见示例，其中 <code>:app</code> 模块使用 <code>:database:impl:room</code> 作为其 <code>main</code> 源集，并使用 <code>:database:impl:mock</code> 作为 <code>androidTest</code> 源集。这是一种强大且正确的测试依赖项管理方法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00fda9030f1b40beaf71deb4a061aa62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767790285&amp;x-signature=blrzoUDoULILjFod5jGz1vZjUMk%3D" alt="图 1. App 模块提供实际实现。" loading="lazy"/></p>
<p>但这种模式存在一个<strong>微妙之处</strong>。当这种逻辑应用于大型项目中所有功能实现时，可能会<strong>无意中造成构建速度瓶颈</strong>，尤其是在处理遗留应用模块时。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// :app/build.gradle.kts</span>
dependencies {
    implementation(project(<span class="hljs-string">":database:api"</span>))
    implementation(project(<span class="hljs-string">":database:impl:room"</span>)) <span class="hljs-comment">// &lt;--- This is the trap for incremental builds</span>
}
</code></pre>
<p>代码是模块化的，但你的 <code>:app</code> 模块现在与 <code>:database:impl:room</code> 模块<strong>构建耦合</strong>。这意味着任何<strong>资源更改</strong>（例如添加字符串）或对<strong>实现自身的公共接口</strong>的任何更改（例如在 <code>:impl</code> 内部添加一个不属于官方 <code>:api</code> 模块的新的 <code>public</code> 辅助类）都会破坏编译避免机制，并强制整个 <code>:app</code> 模块重新编译，从而抵消模块化带来的主要速度优势。</p>
<blockquote>
<p>即使启用了非传递 R 类等优化，直接依赖关系通常也会强制构建系统验证使用者是否与生产者的新资源符号匹配。布线模块充当防火墙，防止频繁的资源检查影响到庞大的 App 模块。</p>
</blockquote>
<h2 data-id="heading-0">“精简应用”的理想状态与“臃肿应用”的现实</h2>
<p>官方建议让 <code>:app</code> 模块提供实现，这非常有效，尤其是在 Google 指南中展示的场景下：为不同的构建版本（例如 <code>main</code> 和 <code>androidTest</code>）替换依赖项。</p>
<p>但是，如果将此模式误用作所有功能实现的_通用规则_，尤其是在包含**“臃肿应用”模块**的项目中，就会出现一个微妙的陷阱。</p>
<p>官方指南通常会隐含地假设一种架构理想：<strong>“精简应用”模块</strong>。“精简应用”只是一个轻量级的汇编器。它几乎不包含任何代码或资源。它_唯一_的任务是应用 <code>com.android.application</code> 插件并将所有功能模块打包成一个 APK 文件。如果你的 <code>:app</code> 模块很精简，重新编译它既快速又便宜，因此它依赖于 <code>:impl</code> 模块并无大碍。</p>
<p>但对我们大多数人来说，现实情况是**“厚应用”模块**。它是最初的单体应用，仍然充斥着遗留代码、资源和半模块化的功能。</p>
<p>当你的“厚应用”模块直接依赖于某个功能的 <code>:impl</code> 时，例如 <code>:app</code> -&gt; ":database:impl:room"<code>，你就创建了一个会拖慢构建速度的瓶颈。你最大、最复杂的模块现在与该功能的内部细节**构建耦合**了。任何对 </code>:impl<code>中资源或实现自身公共接口的更改都会破坏编译规避机制，并强制整个</code>:app` 模块重新编译。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75cb63f01cbc451fab00737207d2a80e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767790285&amp;x-signature=ISkVlQteWXP9DJ9tECcZ9FDL1cA%3D" alt="图 2. “厚应用”瓶颈。由于庞大的 :app 模块直接依赖于实现，因此底层任何 ABI 更改都会触发顶层的完全重新编译。红色箭头展示了功能模块中的一个微小改动如何迫使资源密集型的 :app 模块重新构建，从而破坏了避免编译的策略。" loading="lazy"/></p>
<p>“现在，一个纯粹主义者可能会说：‘你应该更加自律，永远不要让你的 <code>:app</code> 模块从 <code>:impl</code> 导入任何东西，即使是公共的。’</p>
<p>他们的说法没错。但是，在一个拥有数十位贡献者的‘厚应用’单体应用中，‘自律’是一种脆弱的防御手段。而连接模块模式**在构建系统层面强制执行了这种自律。**它使得开发者_不可能_意外地将 <code>:app</code> 模块与某个功能的实现细节耦合在一起，从而默认地保证了构建速度。”</p>
<h2 data-id="heading-1">“理想”方案 vs. “赋能”方案</h2>
<p>这让团队面临两条道路：</p>
<ol>
<li>“理想”（但缓慢）方案：纯粹主义者的解决方案是将“臃肿的应用”模块重构为真正“精简”的模块……这才是正确的长期目标，但这需要数年时间，循序渐进。</li>
<li>“赋能”（但快速）方案：这是“连接模块”模式。这种模式并非理想方案的替代方案，而是实现理想方案的催化剂。它提供了团队所需的构建速度和稳定性，使团队有时间和信心真正执行长期的增量重构。</li>
</ol>
<p>虽然这会增加“模块蔓延”，但它以架构的纯粹性换取了工程速度。在大型团队中，速度通常是更关键的指标。</p>
<p>但这种观点将问题简单地二元化了。实际上，这种模式是一种<strong>务实的权衡</strong>。你是在<strong>有意识地做出权衡</strong>。你接受了新的、可控的成本（增加模块数量和配置），以解决一个令人头疼的日常问题（缓慢的增量构建）。这种新的、明确的“连接”债务通常远比“臃肿应用”的单体架构债务成本低得多，后者正在扼杀团队的开发速度。这种构建速度往往正是团队能够拥有时间和稳定性来进行更大规模、更长期的重构的关键所在。</p>
<p>像 Slack、Spotify 和 Uber 这样的大型 Android 代码库都公开讨论过一些模式，这些模式大量依赖于将实现细节隐藏在稳定的 API 之后。这并非权宜之计；这是大型团队保持构建速度快和代码库可维护性的根本方法。</p>
<h2 data-id="heading-2">解决方案：“连接模块”模式</h2>
<blockquote>
<p>这种模式有时被称为聚合模块，但我们更倾向于使用“连接”，因为它更能体现其在连接架构中的积极作用。</p>
</blockquote>
<p>此解决方案引入了一个新的轻量级**“连接模块”**（例如，<code>:database:wiring</code>）。该模块充当“守门人”或该功能的稳定外观。</p>
<p>其原理很简单：</p>
<ol>
<li><code>:app</code> 模块_仅_依赖于新的、稳定的 <code>:database:wiring</code> 模块。</li>
<li>连接模块_是唯一_了解其自身内部 <code>:impl</code>（以及 <code>:ui</code>、<code>:domain</code> 等）模块的模块。</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// :app/build.gradle.kts (Corrected)</span>
dependencies {
    <span class="hljs-comment">// ...</span>
    implementation(project(<span class="hljs-string">":database:wiring"</span>)) <span class="hljs-comment">// NOW it's decoupled!</span>
    implementation(project(<span class="hljs-string">":feature:home"</span>))
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// :database:wiring/build.gradle.kts (The new "Wiring Module")</span>
plugins {
    id(<span class="hljs-string">"com.android.library"</span>)
}
android {
    namespace = <span class="hljs-string">"com.example.database.wiring"</span>
}
dependencies {
    <span class="hljs-comment">// Link the bindings internally without exposing the API transitively</span>
    implementation(project(<span class="hljs-string">":database:api"</span>))

    <span class="hljs-comment">// Hide the implementation details from the :app module</span>
    implementation(project(<span class="hljs-string">":database:impl:room"</span>))
}
</code></pre>
<p>这种模式并非免费。这是一个务实的步骤，它能实现你承诺的快速增量构建，赋予你的团队速度和稳定性，从而支持那些规模更大、周期更长的重构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46546b9a682c4684ac117945980158b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767790285&amp;x-signature=8ypzc7MWlKpWjixhQBqHUcDevwo%3D" alt="图 3. 使用 :impl:room 模块 ABI 更改后的增量构建仅触发轻量级 :wiring 模块重建" loading="lazy"/></p>
<p>现在，<code>:app</code> 模块仅依赖于稳定的 wiring 模块。</p>
<p><strong>关于依赖注入的说明：</strong></p>
<p>这个“wiring 模块”不仅仅是一个提升构建速度的技巧；它是你功能<strong>依赖注入绑定</strong>（例如 Dagger 或 Hilt 的 <code>@Module</code>）的理想存放位置。它的唯一职责就是将抽象的 <code>:api</code> 连接到具体的 <code>:impl</code>，这正是清晰依赖注入 (DI) 的精髓所在。</p>
<p>这种模式能够确保良好的架构，而构建速度的提升则是这种清晰分离带来的一个绝佳附加效果。</p>
<h2 data-id="heading-3">为什么速度如此之快：理解编译避免</h2>
<p>这种结构并非权宜之计；它是启用 Gradle 最强大的构建速度提升功能——<strong>编译避免</strong>——的_正确_方法。</p>
<p>Gradle 团队在其精彩博文“<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.gradle.org%2Four-approach-to-faster-compilation" target="_blank" title="https://blog.gradle.org/our-approach-to-faster-compilation" ref="nofollow noopener noreferrer">我们实现更快编译的方法</a>”中对此进行了解释。以下是关键要点：</p>
<ol>
<li><strong>Gradle 检查的是 ABI，而不是实现：</strong> 正如博文所述，Gradle 检查的是依赖项的<strong>应用程序二进制接口 (ABI)</strong>。ABI 是模块的“公共契约”或“公共结构”——即其公共类和方法签名。它<strong>不</strong>包含方法体等私有实现细节。</li>
<li><strong>旧方法会破坏这一点：</strong> 当你的 <code>:app</code> 模块直接依赖于 <code>:database:impl:room</code> 时，你实际上是在强制 Gradle 将整个实现都视为应用构建的一部分。正如我们之前提到的，<code>:database:impl:room</code> 中任何<strong>资源更改</strong>或对实现本身的<strong>公共接口</strong>（例如新增的 <code>public</code> 辅助函数）的更改，对于 <code>:app</code> 来说都是 ABI 不兼容的更改，从而导致需要完全重新编译。</li>
<li><strong>新方法可以解决这个问题：</strong> 使用我们的 <code>:database:wiring</code> 模块后：</li>
</ol>
<ul>
<li>开发人员更改了 <code>:database:impl:room</code> 中的一个文件。</li>
<li><code>:database:wiring</code> 模块重新编译（由于它很小，所以速度很快）。</li>
<li><strong>至关重要的是</strong>，正如 Gradle 博客文章中所解释的，这是一个 <strong>ABI 兼容的更改</strong>。连接模块的_公共结构_（即其 <code>api</code> 依赖项）并未改变。</li>
<li>Gradle 会检查 <code>:app</code>，发现其依赖项的 ABI 完全相同，因此<strong>完全跳过重新编译</strong> <code>:app</code>。</li>
</ul>
<p>这篇博文将此称为<strong>编译避免(Compilation Avoidance)</strong>（完全跳过模块的编译），并将其与_增量编译_（重新编译模块中的_某些_文件）区分开来。这种模式是实现主应用程序模块真正避免编译的最有效方法之一。</p>
<h2 data-id="heading-4">实际应用：效果如何</h2>
<p>这并非纸上谈兵。我们在生产应用中使用 Gradle Profiler 来测试这种模式旨在解决的具体场景：在某个功能的 <code>:impl</code> 模块中进行破坏 ABI 的更改（例如，添加一个新的公共方法），然后运行增量 <code>:app:assembleDebug</code> 构建。</p>
<p>我们对八个不同的功能模块重复了此操作，并在引入连接模块前后分别对每个功能模块进行了平均 10 次运行。在旧配置中，<code>:app</code> 直接依赖于 <code>:feature:impl</code>，这些增量构建平均耗时约 <strong>99 秒</strong>。引入连接模块后，<code>:app</code> 仅依赖于 <code>:feature:wiring</code>，相同场景下的平均耗时降至约 <strong>63 秒</strong>。</p>
<p>在这八个功能模块中，速度提升幅度约为 <strong>29%</strong> 到 <strong>45%</strong>，在这种特定的增量构建场景下，平均提升幅度约为 <strong>36%</strong>。</p>
<p>在进行此次重构时，我恰好在研究是否值得将我的 MacBook 升级到更新的 Apple Silicon 机型。这个对比让我恍然大悟：对于这种工作负载，此次连接模块的更改所带来的构建速度提升，与升级到性能更强劲的高端 MacBook 机型**的效果不相上下。区别在于，这种重构能够有效地让参与项目的每个开发者都感受到“新机器”般的体验——而这仅仅是通过一个小的、有针对性的 Gradle 修改实现的，而非硬件升级。</p>
<h2 data-id="heading-5">要点</h2>
<p>官方文档的建议在理论上是正确的，但理解实践中的权衡取舍至关重要。</p>
<p>对于任何实际的**“厚应用”模块**而言，直接依赖 <code>:impl</code> 模块通常会导致构建速度瓶颈，因为它将最大的模块与某个功能的内部变更耦合在一起。</p>
<p>保护构建速度至关重要。“模块连接”模式是一种非常实用且低成本的重构方式，它能显著提升日常工作流程的构建速度，而成本通常仅为完整 <code>:app</code> 模块重构的一小部分。</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Producer Audios Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7589849698488614946</link>    <guid>https://juejin.cn/post/7589849698488614946</guid>    <pubDate>2025-12-31T11:07:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589849698488614946" data-draft-id="7589830701615022080" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Producer Audios Generation API 对接说明"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2025-12-31T11:07:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Producer Audios Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T11:07:35.000Z" title="Wed Dec 31 2025 11:07:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 Producer Audios Generation API 对接说明，它是可以通过输入自定义参数来生成 Producer 官方的音乐。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fproducer-audios" target="_blank" title="https://platform.acedata.cloud/documents/producer-audios" ref="nofollow noopener noreferrer">Producer Audios Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d28c113effe940eeb6fb0d0c7876c92a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=OqkXx15f5GCS%2BA5X7DmvR%2FUrKvA%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4851e8a7961b47278f9e23a41f92fed0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=7opmQHMdv0YarZ58i7V0%2BAs3stg%3D" width="600" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外 Request Body 的参数包括：</p>
<ul>
<li><code>action</code>：此次音乐生成任务的行为，生成歌曲是 <code>generate</code>。</li>
<li><code>model</code>：创建歌曲采用的模型，目前主要有： <strong>FUZZ-2.0 Pro</strong>、<strong>FUZZ-2.0</strong>、<strong>FUZZ-2.0 Raw</strong>,<strong>FUZZ-1.1 Pro</strong>、<strong>FUZZ-1.0 Pro</strong>、<strong>FUZZ-1.0</strong>、<strong>FUZZ-1.1</strong>、<strong>FUZZ-0.8</strong>。</li>
<li><code>lyric</code>：歌曲的歌词内容。</li>
<li><code>custom</code>：是否采用自定义方式生成歌曲。</li>
<li><code>prompt</code>：灵感模式下的提示词。</li>
<li><code>title</code>：歌曲标题信息。</li>
<li><code>audio_id</code>：参考歌曲 ID，用于续写/翻版等操作。</li>
<li><code>continue_at</code>：从指定秒数开始续写歌曲。</li>
<li><code>replace_section_start</code>/<code>replace_section_end</code>：替换片段的起止时间，单位秒。</li>
<li><code>lyrics_strength</code>：歌词强度，表示歌词在音频生成中的影响程度，可选0-1之间，默认0.7。</li>
<li><code>sound_strength</code>：音频提示词强度，可选0.2-1之间，默认0.7。</li>
<li><code>cover_strength</code>：翻唱强度 0.2-1之间，默认1。</li>
<li><code>weirdness</code>：风格奇特度，可选 0-1之间，默认0.5</li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
<li><code>instrumental</code>：是否为无歌词模式。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b5015c7f76644ddb88ac01b0b181577~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=Vo3nbdUdT7Sv5qwua%2BtHh9b7Hqo%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"82fd443a-903a-4f18-8028-12d2f8a0a4be"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d85839fa-0bb1-42da-a9fc-cd582c29027d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c947f13-a3c5-4b9c-8609-5639c37cdc2d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Untitled"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/a853673e-615c-42ae-bdff-16b1add94861/image/6c947f13-a3c5-4b9c-8609-5639c37cdc2d.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Instrumental]"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/a853673e-615c-42ae-bdff-16b1add94861/audio/6c947f13-a3c5-4b9c-8609-5639c37cdc2d.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c947f13-a3c5-4b9c-8609-5639c37cdc2d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2450882164"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:18:23.232911Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"181.3014058956916"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时音乐生成任务的状态情况。
<ul>
<li><code>data</code>，此次音乐任务的结果
<ul>
<li><code>id</code>，此时音乐生成任务的 ID。</li>
<li><code>sound</code>，此时音乐生成任务的提示词。</li>
<li><code>seed</code>，此时音乐生成任务的种子值。</li>
<li><code>audio_url</code>，此时音乐生成任务的音频链接。</li>
<li><code>image_url</code>，此时音乐生成任务的封面链接。</li>
<li><code>image_id</code>，此时音乐生成任务的封面ID。</li>
<li><code>state</code>，此时音乐生成任务的状态。</li>
<li><code>duration</code>，此时音乐的时长信息。</li>
<li><code>progress</code>，此时音乐任务的进度值。</li>
<li><code>model</code>，此时音乐生成任务采用的模型信息。</li>
<li><code>lyric</code>，此时音乐生成任务的歌词信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了想生成的音乐信息，我们只需要根据结果中 <code>data</code> 的音乐链接地址获取生成的 Producer 音乐即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "model": "FUZZ-2.0 Pro",
  "prompt": "A song for Christmas"
}'
</code></pre>
<h2 data-id="heading-2">自定义生成</h2>
<p>如果想自定义生成歌词，可以输入歌词：</p>
<p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">[Verse]Woke up <span class="hljs-keyword">with</span> the sun <span class="hljs-keyword">in</span> my eyesNo clouds above just blue <span class="hljs-keyword">in</span> the skiesShoes <span class="hljs-keyword">on</span> my feet I’m ready <span class="hljs-keyword">to</span> runEvery <span class="hljs-keyword">step</span> feels <span class="hljs-built_in">like</span> a loaded gun[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Verse <span class="hljs-number">2</span>]Dancing through the city streetsA rhythm pounding <span class="hljs-keyword">in</span> my heartbeatStrangers smile it’s catching onThis world’s a stage we’re all a song[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Bridge]<span class="hljs-keyword">Throw</span> your worries out the doorLet them sink <span class="hljs-keyword">to</span> the ocean floorWe’re alive <span class="hljs-built_in">and</span> it’s enoughLife <span class="hljs-built_in">is</span> messy but it’s love[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high
</code></pre>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>title：歌曲的标题。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e94452faacb14bbdac56992d820f183c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=R4WS6biO4EXKqHrp6gCzEBHGZno%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d7a0235933844628b14c1f728d97add~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=2Vs12tlbFyg%2BdSAq2tjPeg1mW%2FU%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9f58bbd4-855a-4233-ac45-b63bf9168e02"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"145ad117-6ce7-42dd-af12-70751c5284fc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"38d3b9e2-0dfb-4338-b2a7-15e45656ed32"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/38d3b9e2-0dfb-4338-b2a7-15e45656ed32.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/38d3b9e2-0dfb-4338-b2a7-15e45656ed32.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"38d3b9e2-0dfb-4338-b2a7-15e45656ed32"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3789209121"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:26:46.357055Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"153.80897959183673"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">翻唱歌曲</h2>
<p>如果想对已经生成的歌曲进行翻唱操作的操作，可以输入上文生成的歌曲进行翻唱，接下来我们要根据歌词、标题自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续翻唱的话，可以将参数 <code>action</code> 设置为 <code>upload_cover</code> ，并且输入需要继续翻唱自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F7fd2cb52-772e-4cc4-a018-e2626ff6f447" target="_blank" title="https://platform.acedata.cloud/documents/7fd2cb52-772e-4cc4-a018-e2626ff6f447" ref="nofollow noopener noreferrer">Producer Upload API</a>来获取，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d908d6cddca04c329b214bb9763f945a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=UBxOMzMJwU4AO%2FY6BF4qjgF9Ygs%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、swap_vocals、swap_instrumentals、variation，此次翻唱使用<code>cover</code>参数。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>custom：是否采用自定义模式生成，默认是false。</li>
<li>audio_id：需要翻唱歌曲的歌曲ID。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e9dc9d1c67d4a42b66e4e7b04375acd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=XdCy7%2BANLsESFxA28SLr9DCV898%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70f93c4fe1e643c1a221ac7810a32633~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=Sz6kHSX1hOxcP2kvt0Bw4G2rpLo%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "cover",
  "model": "FUZZ-2.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "38d3b9e2-0dfb-4338-b2a7-15e45656ed32",
  "instrumental": false,
  "custom": true,
  "title": "Cover"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dbca350e-6fb9-46ca-9c7e-4c1a9080806f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a39e0fff-ced8-4b31-ae23-aef3badd90fa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e52dd729-38b4-4c2f-9031-59eb7953c593"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Cover"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/e52dd729-38b4-4c2f-9031-59eb7953c593.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/e52dd729-38b4-4c2f-9031-59eb7953c593.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e52dd729-38b4-4c2f-9031-59eb7953c593"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"358803418"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:32:32.951948Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"153.0659410430839"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">续写歌曲</h2>
<p>如果想续写歌曲的话，我们需要传入<code>action</code>参数值为：<code>extend</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续续写的话，可以将参数 <code>action</code> 设置为 <code>upload_extend</code> ，并且输入需要继续续写自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F7fd2cb52-772e-4cc4-a018-e2626ff6f447" target="_blank" title="https://platform.acedata.cloud/documents/7fd2cb52-772e-4cc4-a018-e2626ff6f447" ref="nofollow noopener noreferrer">Producer Upload API</a>来获取，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd6cd575f2284bae831d711f203f2d6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=l1aUZxYcPZVDTnGcH99ONM%2BeKb8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edb4accbcb214edba931ea2d4dc39840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=%2BM%2BP5ssq62YnS1zWTvgR6EMXY5A%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dccb0480e39745d0b879732a1b0e2d4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=qJ5WOxC3wNvzdgluGRrfPVOcLqQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "extend",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "continue_at": 3,
  "audio_id": "38d3b9e2-0dfb-4338-b2a7-15e45656ed32",
  "custom": true,
  "title": "Extend",
  "weirdness": 0.3,
  "sound_strength": 0.3,
  "lyrics_strength": 0.6
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"834983cb-d62d-4750-b1aa-461da137e51f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6923eee2-7403-432c-8bd1-e471086385b0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d9ebc609-fb65-4a23-b914-c074747af6a4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Extend"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/d9ebc609-fb65-4a23-b914-c074747af6a4.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\n[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/d9ebc609-fb65-4a23-b914-c074747af6a4.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d9ebc609-fb65-4a23-b914-c074747af6a4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4294469624"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:36:14.520928Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"173.87102040816328"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">音乐变换</h2>
<p>如果想根据上一首音乐的seed值生成一首类似效果的新音乐的话，我们需要传入<code>action</code>参数值为：<code>variation</code>，接下来就可以自定义生成一首类似效果的新音乐。</p>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2a01ec5fdc2450a8e584a297f772937~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=ogWf10UO7cwe2TRNRDZxAGWaw38%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/827623328095422192e1159fd8b042e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=Ay%2BKjktvgXWic4BcmnLESfUC2C0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "variation",
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3a74da6d-a37d-4b5d-b116-821f455bce39"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8e28cce0-0400-4bfd-83db-6d27f97422c7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c14ca458-cd5a-4700-83d4-5249e15f2707"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/c14ca458-cd5a-4700-83d4-5249e15f2707.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/c14ca458-cd5a-4700-83d4-5249e15f2707.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c14ca458-cd5a-4700-83d4-5249e15f2707"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2082104582"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T17:48:40.135187Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"173.12798185941043"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">替换片段</h2>
<p>如果想对歌曲进行替换片段的话，我们需要传入<code>action</code>参数值为：<code>replace_section</code>，接下来我们要根据歌词、标题自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续替换片段的话，可以将参数 <code>action</code> 设置为 <code>upload_replace_section</code> ，并且输入需要继续续写自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F7fd2cb52-772e-4cc4-a018-e2626ff6f447" target="_blank" title="https://platform.acedata.cloud/documents/7fd2cb52-772e-4cc4-a018-e2626ff6f447" ref="nofollow noopener noreferrer">Producer Upload API</a>来获取，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/778aa1eda841429ba445f6a1bda48006~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=Wcbarokn477EbvybJ737HlnW56I%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/899f985f9b4c4faba1d93ffda34ddcab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=lMkqCkrCLrsoatxTdik%2ByWd0Hvk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99d95fde1c3f45d19d2ec2e0c8d45ae8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=tLHrPhyagXY2b0I79z0tvdIx42Y%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "replace_section",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\\nWoke up with the sun in my eyes\\nNo clouds above just blue in the skies\\nShoes on my feet I’m ready to run\\nEvery step feels like a loaded gun\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Verse 2]\\nDancing through the city streets\\nA rhythm pounding in my heartbeat\\nStrangers smile it’s catching on\\nThis world’s a stage we’re all a song\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Bridge]\\nThrow your worries out the door\\nLet them sink to the ocean floor\\nWe’re alive and it’s enough\\nLife is messy but it’s love\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high",
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4",
  "replace_section_start": 3,
  "replace_section_end": 70,
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3cb5ae96-01b0-4a37-afb0-e582608af56f"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3ebc6f63-5093-4499-bf9b-95c239e0da4f"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a54609c6-13e2-4176-be0f-4d7eebc68e1f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/a54609c6-13e2-4176-be0f-4d7eebc68e1f.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nWoke up with the sun in my eyes\\nNo clouds above just blue in the skies\\nShoes on my feet I’m ready to run\\nEvery step feels like a loaded gun\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Verse 2]\\nDancing through the city streets\\nA rhythm pounding in my heartbeat\\nStrangers smile it’s catching on\\nThis world’s a stage we’re all a song\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high\\n[Bridge]\\nThrow your worries out the door\\nLet them sink to the ocean floor\\nWe’re alive and it’s enough\\nLife is messy but it’s love\\n[Chorus]\\nHappy days are rolling in\\nLet the joy beneath my skin\\nNo more shadows no more lies\\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/a54609c6-13e2-4176-be0f-4d7eebc68e1f.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a54609c6-13e2-4176-be0f-4d7eebc68e1f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14887454"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:01:19.907443Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"174.6140589569161"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">伴奏翻版</h2>
<p>如果想使用官方的伴奏翻版操作，可以将<code>action</code>参数值设为：<code>swap_instrumentals</code>，接下来我们要根据歌词、标题自定义生成歌曲。</p>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95fb56bc2f6e4af8bbe126817e3538f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=wfCDqQMBiYdEuLO2pzp1AjJSkgY%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c091be6f6664f199ad0b1c78811c36a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=0Xz%2FBjQZuAX8dEgt0SqzHZ%2BgnQg%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_instrumentals",
  "model": "FUZZ-2.0 Pro",
  "weirdness": 0.6,
  "prompt": "Happy",
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d17d8376-3a58-451d-a976-404719bac11d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ab596807-910a-4e30-bae2-4647895f7d0b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Extend (Sound swap)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22d7d75c-9e0a-47a8-b22b-eea55eaa0c4b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2157878068"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Happy"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:09:49.594800Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"172.3849433106576"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">人声翻版</h2>
<p>如果想使用官方的人声翻版操作，可以将<code>action</code>参数值设为：<code>swap_vocals</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/926702a7c22849dc8e3e541befbdb69d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=bJNHiJe3nqB1u%2FEJ2QOkA%2FLSnT8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4081ea74a814a60837e1f528f264478~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=rQpz6TXWNoUmwHHpiV37DNGqKrY%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_vocals",
  "model": "FUZZ-2.0 Pro",
  "instrumental": false,
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "weirdness": 0.6,
  "lyrics_strength": 0.8,
  "audio_id": "d9ebc609-fb65-4a23-b914-c074747af6a4",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a903ac38-f129-4f85-9181-b1dc5579bd32"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9953af52-45e0-4808-bf13-88f0b21262c1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7b2d653b-aaaa-41b0-b737-aee4c4c5693b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/image/7b2d653b-aaaa-41b0-b737-aee4c4c5693b.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/7ce2b11a-179f-4b87-b5ff-397613c62c93/audio/7b2d653b-aaaa-41b0-b737-aee4c4c5693b.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7b2d653b-aaaa-41b0-b737-aee4c4c5693b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2484735707"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:13:01.349875Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"173.12798185941043"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-9">词曲分离</h2>
<p>如果想使用官方的词曲分离操作，可以将<code>action</code>参数值设为：<code>stems</code>，接下来我们要根据歌曲ID进行词曲分离。</p>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9e6227e2dc448a3b65437286327b8c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=xvAf%2FZyEU2u0ZtTE2cx2NbUdo9E%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0073ce51ac2049f1bb56dcb324fa29eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=V1hpOL%2BaphC%2F0%2FRRgADkd5uyrhk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/producer/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "stems",
  "audio_id": "a54609c6-13e2-4176-be0f-4d7eebc68e1f"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"561ac695-b4aa-47cf-978d-fb7be2b9ebfc"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"66d0d397-2987-4bde-84fb-a60d0023b217"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"stems_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/producer/561ac695-b4aa-47cf-978d-fb7be2b9ebfc.zip"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-10">异步回调</h2>
<p>由于 Producer Audios Generation API 生成的时间有时候会相对较长，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成任务的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F" target="_blank" title="https://webhook.site/" ref="nofollow noopener noreferrer">webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/376ac281f3024154b49eef3b9f26d067~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=6vJaaUgiA7FUazyvvPTspiynHu4%3D" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%23!%2Fview%2F0d73431d-f833-4be4-9276-b6e1690d55c1" target="_blank" title="https://webhook.site/#!/view/0d73431d-f833-4be4-9276-b6e1690d55c1" ref="nofollow noopener noreferrer">webhook.site/#!/view/0d7…</a>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e73951b197c645c3a682b8f169401c48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=aYFTqwxBCIzbf4n6XMniivwdXCs%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1a6ac2ad-10f2-4e2b-b500-66ec27fe82ad"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%23!%2Fview%2F0d73431d-f833-4be4-9276-b6e1690d55c1" target="_blank" title="https://webhook.site/#!/view/0d73431d-f833-4be4-9276-b6e1690d55c1" ref="nofollow noopener noreferrer">webhook.site/#!/view/0d7…</a> 上观察到生成任务的结果，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8eee949b1bbb4234ac3e6b6d8d352073~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785017&amp;x-signature=EwfE5cjYK6EgaNDJyCfEq65VErk%3D" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1a6ac2ad-10f2-4e2b-b500-66ec27fe82ad"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1da03537-4eb8-410d-b849-43f03085a3bb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1dd08826-478e-43a6-868f-aff5ababac2c"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke up with the sun in my eyes"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3bff6223-fe13-4bef-973e-2cbaef430d5d/image/1dd08826-478e-43a6-868f-aff5ababac2c.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3bff6223-fe13-4bef-973e-2cbaef430d5d/audio/1dd08826-478e-43a6-868f-aff5ababac2c.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1dd08826-478e-43a6-868f-aff5ababac2c"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"seed"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1490770667"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sound"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-30T18:36:00.994141Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-2.0 Pro"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100%"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"135.2330158730159"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-11">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-12">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-13">结论</h2>
<p>通过本文档，您已经了解了如何使用 Producer Audios Generation API 可通过输入提示词来生成音乐。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里开源AgentScope多智能体框架解析系列（六）第6章：工具系统（Tool & Toolkit）]]></title>    <link>https://juejin.cn/post/7589386219448975375</link>    <guid>https://juejin.cn/post/7589386219448975375</guid>    <pubDate>2025-12-30T04:18:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589386219448975375" data-draft-id="7589246131585744931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里开源AgentScope多智能体框架解析系列（六）第6章：工具系统（Tool &amp; Toolkit）"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2025-12-30T04:18:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="语落心生"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里开源AgentScope多智能体框架解析系列（六）第6章：工具系统（Tool &amp; Toolkit）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    语落心生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T04:18:33.000Z" title="Tue Dec 30 2025 04:18:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">本章导读</h2>
<p>本章将深入讲解AgentScope的<strong>工具系统</strong>。工具是Agent与外部世界交互的桥梁，使Agent能够查询数据库、调用API、执行计算、操作文件等。掌握工具系统是构建实用Agent的关键。</p>
<ul>
<li>理解工具系统的设计理念</li>
<li>掌握@Tool注解的使用方法</li>
<li>学会工具注册和管理</li>
<li>了解工具调用的完整流程</li>
<li>掌握工具开发的最佳实践</li>
<li>学会构建生产级工具系统</li>
</ul>
<hr/>
<h2 data-id="heading-1">6.1 工具系统设计理念</h2>
<h3 data-id="heading-2">6.1.1 什么是工具</h3>
<p>在AgentScope中，<strong>工具（Tool)</strong> 是Agent可以调用的函数，用于执行特定的操作或获取信息。</p>
<pre><code class="hljs language-typescript" lang="typescript">工具的本质：
┌────────────────────────────────────┐
│  <span class="hljs-title class_">Java</span>方法 + <span class="hljs-meta">@Tool</span>注解              │
│  ↓                                 │
│  <span class="hljs-title class_">ToolSchema</span>（工具的<span class="hljs-title class_">JSON</span>描述）      │
│  ↓                                 │
│  发送给<span class="hljs-variable constant_">LLM</span>                         │
│  ↓                                 │
│  <span class="hljs-variable constant_">LLM</span>决定是否调用                   │
│  ↓                                 │
│  <span class="hljs-title class_">Agent</span>执行工具方法                 │
│  ↓                                 │
│  返回结果给<span class="hljs-variable constant_">LLM</span>                     │
└────────────────────────────────────┘
</code></pre>
<p><strong>工具的作用</strong>：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">没有工具的Agent:</span>
<span class="hljs-section">用户: 北京今天的天气怎么样？</span>
<span class="hljs-section">Agent: 抱歉，我无法获取实时天气信息。</span>

<span class="hljs-section">有工具的Agent:</span>
<span class="hljs-section">用户: 北京今天的天气怎么样？</span>
<span class="hljs-section">Agent: [调用 get_weather(city="北京")]</span>
     → 获得结果：晴天，15-25°C
     → 回复：北京今天晴天，温度在15-25°C之间。
</code></pre>
<h3 data-id="heading-3">6.1.2 工具系统的架构</h3>
<pre><code class="hljs language-markdown" lang="markdown">工具系统的核心组件：

<span class="hljs-bullet">1.</span> @Tool注解
   └─ 标记方法为工具
   └─ 定义工具名称和描述

<span class="hljs-bullet">2.</span> @ToolParam注解
   └─ 标记参数
   └─ 定义参数名称和描述

<span class="hljs-bullet">3.</span> Toolkit（工具箱）
   └─ 管理所有工具
   └─ 注册和查找工具
   └─ 生成ToolSchema

<span class="hljs-bullet">4.</span> AgentTool（工具包装类）
   └─ 封装Java方法
   └─ 支持反射调用
   └─ 参数转换和验证

<span class="hljs-bullet">5.</span> ToolExecutor（工具执行器）
   └─ 执行工具调用
   └─ 处理异常
   └─ 生成ToolResultBlock
</code></pre>
<hr/>
<h2 data-id="heading-4">6.2 @Tool注解的使用</h2>
<h3 data-id="heading-5">6.2.1 定义简单工具</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.agentscope.core.tool.Tool;
<span class="hljs-keyword">import</span> io.agentscope.core.tool.ToolParam;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicTools</span> {
    
    <span class="hljs-comment">/**
     * 最简单的工具示例
     */</span>
    <span class="hljs-meta">@Tool(
        name = "get_current_time",
        description = "Get the current time in specified timezone"
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCurrentTime</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "timezone",
            description = "Timezone name (e.g. Asia/Shanghai, America/New_York)"
        )</span> String timezone
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">ZoneId</span> <span class="hljs-variable">zoneId</span> <span class="hljs-operator">=</span> ZoneId.of(timezone);
            <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> ZonedDateTime.now(zoneId);
            <span class="hljs-keyword">return</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: Invalid timezone "</span> + timezone;
        }
    }
    
    <span class="hljs-comment">/**
     * 带多个参数的工具
     */</span>
    <span class="hljs-meta">@Tool(
        name = "calculate",
        description = "Perform basic arithmetic calculation"
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">calculate</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(name = "a", description = "First number")</span> Double a,
        <span class="hljs-meta">@ToolParam(name = "b", description = "Second number")</span> Double b,
        <span class="hljs-meta">@ToolParam(name = "operation", description = "Operation: add, subtract, multiply, divide")</span> String operation
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">double</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (operation.toLowerCase()) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"add"</span> -&gt; a + b;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"subtract"</span> -&gt; a - b;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"multiply"</span> -&gt; a * b;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"divide"</span> -&gt; {
                    <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Cannot divide by zero"</span>);
                    }
                    <span class="hljs-keyword">yield</span> a / b;
                }
                <span class="hljs-keyword">default</span> -&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Unknown operation: "</span> + operation);
            };
            
            <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%.2f %s %.2f = %.2f"</span>, a, operation, b, result);
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Calculation error: "</span> + e.getMessage();
        }
    }
}
</code></pre>
<h3 data-id="heading-6">6.2.2 注册和使用工具</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.agentscope.core.ReActAgent;
<span class="hljs-keyword">import</span> io.agentscope.core.tool.Toolkit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolRegistrationExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 步骤1：创建Toolkit</span>
        <span class="hljs-type">Toolkit</span> <span class="hljs-variable">toolkit</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Toolkit</span>();
        
        <span class="hljs-comment">// 步骤2：注册工具对象（自动扫描@Tool注解）</span>
        toolkit.registerObject(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicTools</span>());
        
        <span class="hljs-comment">// 步骤3：创建Agent并关联Toolkit</span>
        <span class="hljs-type">ReActAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> ReActAgent.builder()
            .name(<span class="hljs-string">"ToolAgent"</span>)
            .model(model)
            .toolkit(toolkit)  <span class="hljs-comment">// 关联工具箱</span>
            .build();
        
        <span class="hljs-comment">// 步骤4：使用Agent（Agent会自动调用工具）</span>
        <span class="hljs-type">Msg</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> agent.call(<span class="hljs-string">"现在上海是几点？"</span>).block();
        System.out.println(response.getTextContent());
        
        <span class="hljs-comment">// 执行过程：</span>
        <span class="hljs-comment">// Agent思考: "用户想知道上海的时间，我应该调用get_current_time工具"</span>
        <span class="hljs-comment">// Agent调用: get_current_time(timezone="Asia/Shanghai")</span>
        <span class="hljs-comment">// 工具返回: "2024-12-30 14:30:00"</span>
        <span class="hljs-comment">// Agent回复: "现在上海时间是2024年12月30日14点30分。"</span>
    }
}
</code></pre>
<h3 data-id="heading-7">6.2.3 @Tool注解参数详解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@Tool</span>注解的完整参数
 */</span>
<span class="hljs-meta">@Tool(
    name = "tool_name",           // 必需：工具名称（snake_case）
    description = "Tool description"  // 必需：工具描述（100字以内）
)</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">toolMethod</span><span class="hljs-params">(
    <span class="hljs-meta">@ToolParam(
        name = "param_name",      // 必需：参数名称（snake_case）
        description = "Param description",  // 必需：参数描述
        required = true           // 可选：是否必需（默认true）
    )</span> String paramName
)</span> {
    <span class="hljs-comment">// 方法实现</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"result"</span>;
}
</code></pre>
<p><strong>命名规范</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">✓ 正确的命名:
  <span class="hljs-operator">-</span> 工具名: get_user_info, query_database, send_email
  <span class="hljs-operator">-</span> 参数名: user_id, start_date, max_count

✗ 错误的命名:
  <span class="hljs-operator">-</span> 工具名: getUserInfo（不要用camelCase）
  <span class="hljs-operator">-</span> 参数名: userId（不要用camelCase）
  <span class="hljs-operator">-</span> 工具名: <span class="hljs-keyword">get</span><span class="hljs-operator">-</span><span class="hljs-keyword">user</span><span class="hljs-operator">-</span>info（不要用kebab<span class="hljs-operator">-</span><span class="hljs-keyword">case</span>）
</code></pre>
<p><strong>描述规范</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">✓ 好的描述:
  "Query user information from database by user ID"
<span class="hljs-bullet">  -</span> 清晰说明功能
<span class="hljs-bullet">  -</span> 说明参数的作用和格式

✗ 差的描述:
  "Get info"
<span class="hljs-bullet">  -</span> 太模糊
<span class="hljs-bullet">  -</span> 没有说明参数格式
</code></pre>
<hr/>
<h2 data-id="heading-8">6.3 工具调用流程</h2>
<h3 data-id="heading-9">6.3.1 完整的工具调用流程</h3>
<pre><code class="hljs language-makefile" lang="makefile">完整流程（从定义到执行）：

━━━ 步骤1：工具定义 ━━━
<span class="hljs-section">开发者编写:</span>
@Tool(name = <span class="hljs-string">"get_weather"</span>, description = <span class="hljs-string">"..."</span>)
public String getWeather(
    @ToolParam(name = <span class="hljs-string">"city"</span>, ...) String city
)

━━━ 步骤2：工具注册 ━━━
toolkit.registerObject(new WeatherTools());
  ↓
扫描@Tool注解
  ↓
生成ToolSchema (JSON格式的工具描述):
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"get_weather"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Get weather information for a city"</span>,
  <span class="hljs-string">"parameters"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"city"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"City name"</span>
      }
    },
    <span class="hljs-string">"required"</span>: [<span class="hljs-string">"city"</span>]
  }
}

━━━ 步骤3：发送给LLM ━━━
<span class="hljs-section">Agent调用Model时携带ToolSchema:</span>
<span class="hljs-section">messages: [...]</span>
<span class="hljs-section">tools: [ToolSchema1, ToolSchema2, ...]</span>
  ↓
LLM看到可用的工具列表

━━━ 步骤4：LLM决策 ━━━
<span class="hljs-section">LLM分析用户请求:</span>
<span class="hljs-string">"北京今天的天气怎么样？"</span>
  ↓
<span class="hljs-section">LLM决定调用get_weather工具:</span>
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"get_weather"</span>,
  <span class="hljs-string">"arguments"</span>: {<span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>}
}
  ↓
返回ToolUseBlock

━━━ 步骤5：Agent执行工具 ━━━
<span class="hljs-section">提取ToolUseBlock:</span>
  name: get_weather
  arguments: {city: <span class="hljs-string">"北京"</span>}
  ↓
<span class="hljs-section">查找工具实现:</span>
  WeatherTools.getWeather
  ↓
<span class="hljs-section">参数转换:</span>
  Map&lt;String, Object&gt; → String city = <span class="hljs-string">"北京"</span>
  ↓
<span class="hljs-section">反射调用:</span>
  Object result = method.invoke(toolInstance, <span class="hljs-string">"北京"</span>)
  ↓
<span class="hljs-section">获得结果:</span>
  <span class="hljs-string">"北京今天晴天，15-25°C"</span>

━━━ 步骤6：返回结果 ━━━
<span class="hljs-section">生成ToolResultBlock:</span>
{
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"call_123"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"get_weather"</span>,
  <span class="hljs-string">"content"</span>: <span class="hljs-string">"北京今天晴天，15-25°C"</span>,
  <span class="hljs-string">"isError"</span>: false
}
  ↓
添加到Memory
  ↓
进入下一轮推理循环

━━━ 步骤7：LLM生成最终回复 ━━━
<span class="hljs-section">LLM看到工具结果:</span>
<span class="hljs-string">"北京今天晴天，15-25°C"</span>
  ↓
<span class="hljs-section">生成用户友好的回复:</span>
<span class="hljs-string">"北京今天天气晴朗，温度在15-25°C之间，非常适合户外活动。"</span>
</code></pre>
<h3 data-id="heading-10">6.3.2 ToolSchema的生成</h3>
<p>AgentScope会自动将@Tool注解转换为LLM能理解的JSON Schema格式。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ToolSchema生成示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolSchemaExample</span> {
    
    <span class="hljs-comment">// 原始工具定义</span>
    <span class="hljs-meta">@Tool(
        name = "search_products",
        description = "Search products in the database"
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">searchProducts</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(name = "keyword", description = "Search keyword")</span> String keyword,
        <span class="hljs-meta">@ToolParam(name = "category", description = "Product category (optional)", required = false)</span> String category,
        <span class="hljs-meta">@ToolParam(name = "max_price", description = "Maximum price in yuan (optional)", required = false)</span> Double maxPrice
    )</span> {
        <span class="hljs-comment">// 实现...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"..."</span>;
    }
    
    <span class="hljs-comment">// 自动生成的ToolSchema（JSON格式）</span>
    <span class="hljs-comment">/*
    {
      "type": "function",
      "function": {
        "name": "search_products",
        "description": "Search products in the database",
        "parameters": {
          "type": "object",
          "properties": {
            "keyword": {
              "type": "string",
              "description": "Search keyword"
            },
            "category": {
              "type": "string",
              "description": "Product category (optional)"
            },
            "max_price": {
              "type": "number",
              "description": "Maximum price in yuan (optional)"
            }
          },
          "required": ["keyword"]
        }
      }
    }
    */</span>
}
</code></pre>
<h3 data-id="heading-11">6.3.3 参数转换和验证</h3>
<p>工具调用时，需要将LLM返回的JSON参数转换为Java方法参数。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 参数转换示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParameterConversionExample</span> {
    
    <span class="hljs-comment">// LLM返回的工具调用</span>
    <span class="hljs-type">ToolUseBlock</span> <span class="hljs-variable">toolCall</span> <span class="hljs-operator">=</span> ToolUseBlock.builder()
        .name(<span class="hljs-string">"search_products"</span>)
        .arguments(Map.of(
            <span class="hljs-string">"keyword"</span>, <span class="hljs-string">"iPhone"</span>,
            <span class="hljs-string">"category"</span>, <span class="hljs-string">"electronics"</span>,
            <span class="hljs-string">"max_price"</span>, <span class="hljs-number">10000.0</span>
        ))
        .build();
    
    <span class="hljs-comment">// AgentScope执行转换</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeToolCall</span><span class="hljs-params">(ToolUseBlock toolCall)</span> {
        <span class="hljs-comment">// 1. 查找工具</span>
        <span class="hljs-type">AgentTool</span> <span class="hljs-variable">tool</span> <span class="hljs-operator">=</span> toolkit.getTool(<span class="hljs-string">"search_products"</span>);
        
        <span class="hljs-comment">// 2. 获取方法参数类型</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> tool.getMethod();
        Parameter[] params = method.getParameters();
        <span class="hljs-comment">// params[0]: String keyword</span>
        <span class="hljs-comment">// params[1]: String category</span>
        <span class="hljs-comment">// params[2]: Double maxPrice</span>
        
        <span class="hljs-comment">// 3. 从arguments中提取值并转换</span>
        Map&lt;String, Object&gt; args = toolCall.getArguments();
        Object[] convertedArgs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[params.length];
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; params.length; i++) {
            <span class="hljs-type">Parameter</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> params[i];
            <span class="hljs-type">ToolParam</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> param.getAnnotation(ToolParam.class);
            <span class="hljs-type">String</span> <span class="hljs-variable">paramName</span> <span class="hljs-operator">=</span> annotation.name();
            
            <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> args.get(paramName);
            
            <span class="hljs-comment">// 类型转换</span>
            <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
                Class&lt;?&gt; targetType = param.getType();
                convertedArgs[i] = convertType(value, targetType);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (annotation.required()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                    <span class="hljs-string">"Missing required parameter: "</span> + paramName);
            } <span class="hljs-keyword">else</span> {
                convertedArgs[i] = <span class="hljs-literal">null</span>;
            }
        }
        
        <span class="hljs-comment">// 4. 反射调用</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(toolInstance, convertedArgs);
    }
    
    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">convertType</span><span class="hljs-params">(Object value, Class&lt;?&gt; targetType)</span> {
        <span class="hljs-keyword">if</span> (targetType == String.class) {
            <span class="hljs-keyword">return</span> value.toString();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (targetType == Integer.class || targetType == <span class="hljs-type">int</span>.class) {
            <span class="hljs-keyword">return</span> ((Number) value).intValue();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (targetType == Double.class || targetType == <span class="hljs-type">double</span>.class) {
            <span class="hljs-keyword">return</span> ((Number) value).doubleValue();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (targetType == Boolean.class || targetType == <span class="hljs-type">boolean</span>.class) {
            <span class="hljs-keyword">return</span> Boolean.valueOf(value.toString());
        }
        <span class="hljs-comment">// ... 其他类型转换</span>
        <span class="hljs-keyword">return</span> value;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">6.4 工具开发最佳实践</h2>
<h3 data-id="heading-13">6.4.1 工具设计原则</h3>
<pre><code class="hljs language-scss" lang="scss">原则<span class="hljs-number">1</span>：单一职责
✓ 每个工具只做一件事
✓ 工具名称清晰表达功能

示例：
✓ <span class="hljs-built_in">get_user_info</span>(user_id)  # 只获取用户信息
✗ <span class="hljs-built_in">manage_user</span>(user_id, action)  # 太宽泛

原则<span class="hljs-number">2</span>：参数简洁
✓ 参数数量不超过<span class="hljs-number">5</span>个
✓ 使用JSON字符串传递复杂数据

示例：
✓ <span class="hljs-built_in">create_order</span>(items_json, address)
✗ <span class="hljs-built_in">create_order</span>(item1, qty1, item2, qty2, ..., address)

原则<span class="hljs-number">3</span>：返回值结构化
✓ 返回清晰的文本描述
✓ 使用统一的格式

示例：
✓ "Query result: Found <span class="hljs-number">3</span> users. Details: ...<span class="hljs-string">"
✗ 直接返回JSON对象（LLM难以理解）

原则4：错误处理完善
✓ 捕获所有异常
✓ 返回友好的错误信息
✓ 不要抛出异常到Agent

示例：
✓ return "</span>Error: User not found with id <span class="hljs-string">" + userId;
✗ throw new UserNotFoundException(userId);
</span></code></pre>
<h3 data-id="heading-14">6.4.2 工具返回值格式</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 工具返回值的最佳实践
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolReturnValueExample</span> {
    
    <span class="hljs-comment">/**
     * ✓ 好的返回值格式
     */</span>
    <span class="hljs-meta">@Tool(name = "query_order", description = "Query order details")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">queryOrder</span><span class="hljs-params">(<span class="hljs-meta">@ToolParam(name = "order_id")</span> String orderId)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrder(orderId);
            
            <span class="hljs-comment">// 返回结构化的文本描述（便于LLM理解）</span>
            <span class="hljs-keyword">return</span> String.format(
                <span class="hljs-string">"Order Details:\n"</span> +
                <span class="hljs-string">"- Order ID: %s\n"</span> +
                <span class="hljs-string">"- Status: %s\n"</span> +
                <span class="hljs-string">"- Total Amount: ¥%.2f\n"</span> +
                <span class="hljs-string">"- Items: %d\n"</span> +
                <span class="hljs-string">"- Shipping Address: %s\n"</span> +
                <span class="hljs-string">"- Created Time: %s"</span>,
                order.getId(),
                order.getStatus(),
                order.getTotalAmount(),
                order.getItems().size(),
                order.getShippingAddress(),
                order.getCreatedTime()
            );
            
        } <span class="hljs-keyword">catch</span> (OrderNotFoundException e) {
            <span class="hljs-comment">// 返回清晰的错误信息</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: Order not found with ID "</span> + orderId;
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 通用错误处理</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error querying order: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">/**
     * ✗ 不好的返回值格式
     */</span>
    <span class="hljs-meta">@Tool(name = "query_order_bad", description = "Query order details")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">queryOrderBad</span><span class="hljs-params">(<span class="hljs-meta">@ToolParam(name = "order_id")</span> String orderId)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrder(orderId);
        <span class="hljs-comment">// 直接返回对象（LLM无法理解）</span>
        <span class="hljs-keyword">return</span> order;
    }
    
    <span class="hljs-comment">/**
     * ✓ 列表数据的返回格式
     */</span>
    <span class="hljs-meta">@Tool(name = "search_users", description = "Search users")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">searchUsers</span><span class="hljs-params">(<span class="hljs-meta">@ToolParam(name = "keyword")</span> String keyword)</span> {
        List&lt;User&gt; users = userService.search(keyword);
        
        <span class="hljs-keyword">if</span> (users.isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"No users found matching: "</span> + keyword;
        }
        
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        result.append(<span class="hljs-string">"Found "</span>).append(users.size()).append(<span class="hljs-string">" users:\n"</span>);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; Math.min(<span class="hljs-number">10</span>, users.size()); i++) {
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> users.get(i);
            result.append(String.format(
                <span class="hljs-string">"%d. %s (ID: %s, Email: %s)\n"</span>,
                i + <span class="hljs-number">1</span>, user.getName(), user.getId(), user.getEmail()
            ));
        }
        
        <span class="hljs-keyword">if</span> (users.size() &gt; <span class="hljs-number">10</span>) {
            result.append(<span class="hljs-string">"... and "</span>).append(users.size() - <span class="hljs-number">10</span>).append(<span class="hljs-string">" more"</span>);
        }
        
        <span class="hljs-keyword">return</span> result.toString();
    }
}
</code></pre>
<h3 data-id="heading-15">6.4.3 异步工具的实现</h3>
<p>某些工具需要长时间运行（例如文件处理、外部API调用），应该使用异步实现。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-comment">/**
 * 异步工具示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncToolExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">WebClient</span> <span class="hljs-variable">webClient</span> <span class="hljs-operator">=</span> WebClient.create();
    
    <span class="hljs-comment">/**
     * 同步工具（阻塞，不推荐用于慢速操作）
     */</span>
    <span class="hljs-meta">@Tool(name = "fetch_url_sync", description = "Fetch content from URL (sync)")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">fetchUrlSync</span><span class="hljs-params">(<span class="hljs-meta">@ToolParam(name = "url")</span> String url)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 阻塞等待HTTP响应（可能很慢）</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> webClient.get()
                .uri(url)
                .retrieve()
                .bodyToMono(String.class)
                .block(Duration.ofSeconds(<span class="hljs-number">10</span>));
            
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Content fetched: "</span> + content.substring(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>) + <span class="hljs-string">"..."</span>;
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error fetching URL: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">/**
     * 异步工具（推荐）
     * AgentScope支持Mono&lt;String&gt;返回类型
     */</span>
    <span class="hljs-meta">@Tool(name = "fetch_url", description = "Fetch content from URL")</span>
    <span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title function_">fetchUrl</span><span class="hljs-params">(<span class="hljs-meta">@ToolParam(name = "url")</span> String url)</span> {
        <span class="hljs-keyword">return</span> webClient.get()
            .uri(url)
            .retrieve()
            .bodyToMono(String.class)
            .timeout(Duration.ofSeconds(<span class="hljs-number">10</span>))
            .map(content -&gt; <span class="hljs-string">"Content fetched: "</span> + content.substring(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>) + <span class="hljs-string">"..."</span>)
            .onErrorResume(error -&gt; 
                Mono.just(<span class="hljs-string">"Error fetching URL: "</span> + error.getMessage())
            );
    }
    
    <span class="hljs-comment">/**
     * 复杂异步工具（多个步骤）
     */</span>
    <span class="hljs-meta">@Tool(name = "process_document", description = "Process document with multiple steps")</span>
    <span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title function_">processDocument</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(name = "doc_id")</span> String docId
    )</span> {
        <span class="hljs-keyword">return</span> Mono.defer(() -&gt; {
            <span class="hljs-comment">// 步骤1：下载文档</span>
            <span class="hljs-keyword">return</span> downloadDocument(docId)
                <span class="hljs-comment">// 步骤2：提取文本</span>
                .flatMap(doc -&gt; extractText(doc))
                <span class="hljs-comment">// 步骤3：分析文本</span>
                .flatMap(text -&gt; analyzeText(text))
                <span class="hljs-comment">// 步骤4：生成报告</span>
                .flatMap(analysis -&gt; generateReport(analysis))
                <span class="hljs-comment">// 错误处理</span>
                .onErrorResume(error -&gt; 
                    Mono.just(<span class="hljs-string">"Error processing document: "</span> + error.getMessage())
                );
        });
    }
    
    <span class="hljs-keyword">private</span> Mono&lt;Document&gt; <span class="hljs-title function_">downloadDocument</span><span class="hljs-params">(String docId)</span> {
        <span class="hljs-keyword">return</span> documentService.download(docId)
            .timeout(Duration.ofMinutes(<span class="hljs-number">1</span>));
    }
    
    <span class="hljs-keyword">private</span> Mono&lt;String&gt; <span class="hljs-title function_">extractText</span><span class="hljs-params">(Document doc)</span> {
        <span class="hljs-keyword">return</span> textExtractor.extract(doc)
            .timeout(Duration.ofMinutes(<span class="hljs-number">2</span>));
    }
    
    <span class="hljs-keyword">private</span> Mono&lt;Analysis&gt; <span class="hljs-title function_">analyzeText</span><span class="hljs-params">(String text)</span> {
        <span class="hljs-keyword">return</span> textAnalyzer.analyze(text)
            .timeout(Duration.ofSeconds(<span class="hljs-number">30</span>));
    }
    
    <span class="hljs-keyword">private</span> Mono&lt;String&gt; <span class="hljs-title function_">generateReport</span><span class="hljs-params">(Analysis analysis)</span> {
        <span class="hljs-keyword">return</span> reportGenerator.generate(analysis)
            .map(report -&gt; <span class="hljs-string">"Document processed successfully. "</span> +
                          <span class="hljs-string">"Analysis summary: "</span> + report.getSummary());
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">6.5 生产场景：电商订单处理工具系统</h2>
<h3 data-id="heading-17">6.5.1 完整的电商工具类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.agentscope.core.tool.Tool;
<span class="hljs-keyword">import</span> io.agentscope.core.tool.ToolParam;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 电商订单处理工具系统
 * 
 * 功能：
 * 1. 商品搜索
 * 2. 商品详情查询
 * 3. 订单创建
 * 4. 订单查询
 * 5. 退货处理
 * 6. 优惠券验证
 */</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ECommerceTools</span> {
    
    <span class="hljs-comment">// 依赖的服务</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderService orderService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InventoryService inventoryService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PricingService pricingService;
    
    <span class="hljs-comment">// ============ 工具1：商品搜索 ============</span>
    
    <span class="hljs-meta">@Tool(
        name = "search_products",
        description = "Search products by keyword, category, or price range. " +
                      "Returns a list of matching products with basic information."
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">searchProducts</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "query",
            description = "Search keyword (product name, description)"
        )</span> String query,
        
        <span class="hljs-meta">@ToolParam(
            name = "category",
            description = "Product category filter (optional): electronics, clothing, food, books, etc.",
            required = false
        )</span> String category,
        
        <span class="hljs-meta">@ToolParam(
            name = "max_price",
            description = "Maximum price in yuan (optional)",
            required = false
        )</span> Double maxPrice
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 执行搜索</span>
            List&lt;Product&gt; products = inventoryService.search(
                query, category, maxPrice);
            
            <span class="hljs-keyword">if</span> (products.isEmpty()) {
                <span class="hljs-keyword">return</span> String.format(
                    <span class="hljs-string">"No products found matching query='%s'%s%s"</span>,
                    query,
                    category != <span class="hljs-literal">null</span> ? <span class="hljs-string">", category='"</span> + category + <span class="hljs-string">"'"</span> : <span class="hljs-string">""</span>,
                    maxPrice != <span class="hljs-literal">null</span> ? <span class="hljs-string">", max_price=¥"</span> + maxPrice : <span class="hljs-string">""</span>
                );
            }
            
            <span class="hljs-comment">// 格式化结果（最多显示前10个）</span>
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            result.append(String.format(<span class="hljs-string">"Found %d products:\n"</span>, products.size()));
            
            <span class="hljs-type">int</span> <span class="hljs-variable">displayCount</span> <span class="hljs-operator">=</span> Math.min(<span class="hljs-number">10</span>, products.size());
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; displayCount; i++) {
                <span class="hljs-type">Product</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> products.get(i);
                result.append(String.format(
                    <span class="hljs-string">"%d. [%s] %s\n"</span> +
                    <span class="hljs-string">"   Price: ¥%.2f | Stock: %d units | Rating: %.1f/5.0 (%d reviews)\n"</span>,
                    i + <span class="hljs-number">1</span>,
                    p.getId(),
                    p.getName(),
                    p.getPrice(),
                    p.getStock(),
                    p.getRating(),
                    p.getReviewCount()
                ));
            }
            
            <span class="hljs-keyword">if</span> (products.size() &gt; <span class="hljs-number">10</span>) {
                result.append(String.format(
                    <span class="hljs-string">"\n... and %d more products. Use get_product_details to see more information."</span>,
                    products.size() - <span class="hljs-number">10</span>
                ));
            }
            
            <span class="hljs-keyword">return</span> result.toString();
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error searching products: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">// ============ 工具2：商品详情 ============</span>
    
    <span class="hljs-meta">@Tool(
        name = "get_product_details",
        description = "Get detailed information about a specific product including " +
                      "description, specifications, warranty, and customer reviews."
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProductDetails</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "product_id",
            description = "Product ID (e.g. PROD-12345)"
        )</span> String productId
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> inventoryService.getProduct(productId);
            
            <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: Product not found with ID "</span> + productId;
            }
            
            <span class="hljs-keyword">return</span> String.format(
                <span class="hljs-string">"Product Details:\n"</span> +
                <span class="hljs-string">"━━━━━━━━━━━━━━━━━━━━\n"</span> +
                <span class="hljs-string">"ID: %s\n"</span> +
                <span class="hljs-string">"Name: %s\n"</span> +
                <span class="hljs-string">"Category: %s\n"</span> +
                <span class="hljs-string">"Price: ¥%.2f\n"</span> +
                <span class="hljs-string">"Stock: %d units available\n"</span> +
                <span class="hljs-string">"Rating: %.1f/5.0 (based on %d reviews)\n"</span> +
                <span class="hljs-string">"\nDescription:\n%s\n"</span> +
                <span class="hljs-string">"\nSpecifications:\n%s\n"</span> +
                <span class="hljs-string">"\nWarranty: %d months\n"</span> +
                <span class="hljs-string">"Shipping: %s"</span>,
                product.getId(),
                product.getName(),
                product.getCategory(),
                product.getPrice(),
                product.getStock(),
                product.getRating(),
                product.getReviewCount(),
                product.getDescription(),
                formatSpecifications(product.getSpecifications()),
                product.getWarrantyMonths(),
                product.getFreeShipping() ? <span class="hljs-string">"Free shipping"</span> : <span class="hljs-string">"Standard shipping fee applies"</span>
            );
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error getting product details: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">// ============ 工具3：创建订单 ============</span>
    
    <span class="hljs-meta">@Tool(
        name = "create_order",
        description = "Create a new order with specified products and quantities. " +
                      "Validates stock availability and applies discount coupons if provided."
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "items",
            description = "Order items in JSON format: " +
                         "[{\"product_id\": \"PROD-123\", \"quantity\": 2}, ...]"
        )</span> String itemsJson,
        
        <span class="hljs-meta">@ToolParam(
            name = "shipping_address",
            description = "Delivery address (full address including postal code)"
        )</span> String shippingAddress,
        
        <span class="hljs-meta">@ToolParam(
            name = "coupon_code",
            description = "Discount coupon code (optional)",
            required = false
        )</span> String couponCode
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 解析订单项</span>
            List&lt;OrderItem&gt; items = parseOrderItems(itemsJson);
            
            <span class="hljs-keyword">if</span> (items.isEmpty()) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: No items specified in the order"</span>;
            }
            
            <span class="hljs-comment">// 2. 验证库存</span>
            <span class="hljs-keyword">for</span> (OrderItem item : items) {
                <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> inventoryService.getProduct(item.getProductId());
                
                <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">return</span> String.format(
                        <span class="hljs-string">"Error: Product not found with ID %s"</span>,
                        item.getProductId()
                    );
                }
                
                <span class="hljs-keyword">if</span> (product.getStock() &lt; item.getQuantity()) {
                    <span class="hljs-keyword">return</span> String.format(
                        <span class="hljs-string">"Error: Insufficient stock for product '%s'. "</span> +
                        <span class="hljs-string">"Available: %d, Requested: %d"</span>,
                        product.getName(),
                        product.getStock(),
                        item.getQuantity()
                    );
                }
                
                <span class="hljs-comment">// 设置价格</span>
                item.setPrice(product.getPrice());
                item.setProductName(product.getName());
            }
            
            <span class="hljs-comment">// 3. 计算总金额</span>
            <span class="hljs-type">double</span> <span class="hljs-variable">subtotal</span> <span class="hljs-operator">=</span> items.stream()
                .mapToDouble(item -&gt; item.getPrice() * item.getQuantity())
                .sum();
            
            <span class="hljs-type">double</span> <span class="hljs-variable">discount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.0</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">discountInfo</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
            
            <span class="hljs-comment">// 4. 应用优惠券</span>
            <span class="hljs-keyword">if</span> (couponCode != <span class="hljs-literal">null</span> &amp;&amp; !couponCode.isEmpty()) {
                <span class="hljs-type">Double</span> <span class="hljs-variable">couponDiscount</span> <span class="hljs-operator">=</span> pricingService.validateCoupon(
                    couponCode, subtotal);
                
                <span class="hljs-keyword">if</span> (couponDiscount != <span class="hljs-literal">null</span> &amp;&amp; couponDiscount &gt; <span class="hljs-number">0</span>) {
                    discount = couponDiscount;
                    discountInfo = String.format(
                        <span class="hljs-string">"\nDiscount Applied: -¥%.2f (Coupon: %s)"</span>,
                        discount, couponCode
                    );
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: Invalid or expired coupon code: "</span> + couponCode;
                }
            }
            
            <span class="hljs-type">double</span> <span class="hljs-variable">totalAmount</span> <span class="hljs-operator">=</span> subtotal - discount;
            
            <span class="hljs-comment">// 5. 创建订单</span>
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
            order.setItems(items);
            order.setShippingAddress(shippingAddress);
            order.setSubtotal(subtotal);
            order.setDiscount(discount);
            order.setTotalAmount(totalAmount);
            order.setStatus(<span class="hljs-string">"PENDING_PAYMENT"</span>);
            order.setCreatedTime(LocalDateTime.now());
            
            <span class="hljs-comment">// 6. 保存订单</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orderService.createOrder(order);
            
            <span class="hljs-comment">// 7. 返回订单确认信息</span>
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">itemsList</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            <span class="hljs-keyword">for</span> (OrderItem item : items) {
                itemsList.append(String.format(
                    <span class="hljs-string">"  - %s × %d = ¥%.2f\n"</span>,
                    item.getProductName(),
                    item.getQuantity(),
                    item.getPrice() * item.getQuantity()
                ));
            }
            
            <span class="hljs-keyword">return</span> String.format(
                <span class="hljs-string">"Order Created Successfully!\n"</span> +
                <span class="hljs-string">"━━━━━━━━━━━━━━━━━━━━━━━━\n"</span> +
                <span class="hljs-string">"Order ID: %s\n"</span> +
                <span class="hljs-string">"Status: PENDING_PAYMENT\n"</span> +
                <span class="hljs-string">"\nItems:\n%s"</span> +
                <span class="hljs-string">"\nSubtotal: ¥%.2f%s\n"</span> +
                <span class="hljs-string">"Total Amount: ¥%.2f\n"</span> +
                <span class="hljs-string">"\nShipping Address:\n%s\n"</span> +
                <span class="hljs-string">"\nNext Steps:\n"</span> +
                <span class="hljs-string">"1. Please proceed to payment\n"</span> +
                <span class="hljs-string">"2. Estimated delivery: 3-5 business days after payment\n"</span> +
                <span class="hljs-string">"3. Use check_order_status to track your order"</span>,
                orderId,
                itemsList.toString(),
                subtotal,
                discountInfo,
                totalAmount,
                shippingAddress
            );
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error creating order: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">// ============ 工具4：查询订单状态 ============</span>
    
    <span class="hljs-meta">@Tool(
        name = "check_order_status",
        description = "Check the current status of an existing order including " +
                      "payment status, shipping status, and tracking information."
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">checkOrderStatus</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "order_id",
            description = "Order ID (e.g. ORD-2024-12345)"
        )</span> String orderId
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrder(orderId);
            
            <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: Order not found with ID "</span> + orderId;
            }
            
            <span class="hljs-comment">// 格式化订单状态</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">statusDescription</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (order.getStatus()) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"PENDING_PAYMENT"</span> -&gt; <span class="hljs-string">"Awaiting payment"</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"PAID"</span> -&gt; <span class="hljs-string">"Payment received, preparing shipment"</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"SHIPPED"</span> -&gt; <span class="hljs-string">"Order shipped"</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"DELIVERED"</span> -&gt; <span class="hljs-string">"Order delivered"</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"CANCELLED"</span> -&gt; <span class="hljs-string">"Order cancelled"</span>;
                <span class="hljs-keyword">default</span> -&gt; order.getStatus();
            };
            
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            result.append(String.format(
                <span class="hljs-string">"Order Status:\n"</span> +
                <span class="hljs-string">"━━━━━━━━━━━━━━━━━━\n"</span> +
                <span class="hljs-string">"Order ID: %s\n"</span> +
                <span class="hljs-string">"Status: %s\n"</span> +
                <span class="hljs-string">"Created: %s\n"</span> +
                <span class="hljs-string">"Total Amount: ¥%.2f\n"</span>,
                orderId,
                statusDescription,
                order.getCreatedTime().format(
                    DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>)),
                order.getTotalAmount()
            ));
            
            <span class="hljs-comment">// 添加物流信息</span>
            <span class="hljs-keyword">if</span> (order.getTrackingNumber() != <span class="hljs-literal">null</span>) {
                result.append(String.format(
                    <span class="hljs-string">"\nShipping Information:\n"</span> +
                    <span class="hljs-string">"Tracking Number: %s\n"</span> +
                    <span class="hljs-string">"Carrier: %s\n"</span> +
                    <span class="hljs-string">"Estimated Delivery: %s\n"</span>,
                    order.getTrackingNumber(),
                    order.getCarrier(),
                    order.getEstimatedDelivery()
                ));
            }
            
            <span class="hljs-comment">// 添加订单项</span>
            result.append(<span class="hljs-string">"\nItems:\n"</span>);
            <span class="hljs-keyword">for</span> (OrderItem item : order.getItems()) {
                result.append(String.format(
                    <span class="hljs-string">"  - %s × %d\n"</span>,
                    item.getProductName(),
                    item.getQuantity()
                ));
            }
            
            <span class="hljs-keyword">return</span> result.toString();
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error checking order status: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">// ============ 工具5：处理退货 ============</span>
    
    <span class="hljs-meta">@Tool(
        name = "process_return_request",
        description = "Process a return request for an order. " +
                      "Validates return eligibility and initiates the return process."
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">processReturnRequest</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "order_id",
            description = "Order ID to return"
        )</span> String orderId,
        
        <span class="hljs-meta">@ToolParam(
            name = "reason",
            description = "Reason for return"
        )</span> String reason,
        
        <span class="hljs-meta">@ToolParam(
            name = "items",
            description = "Items to return in JSON format (optional, if not specified, return all items)",
            required = false
        )</span> String itemsJson
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 验证订单</span>
            <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrder(orderId);
            
            <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"Error: Order not found with ID "</span> + orderId;
            }
            
            <span class="hljs-comment">// 2. 检查是否可以退货</span>
            <span class="hljs-keyword">if</span> (!canReturn(order)) {
                <span class="hljs-keyword">return</span> String.format(
                    <span class="hljs-string">"Error: This order cannot be returned. "</span> +
                    <span class="hljs-string">"Reason: %s"</span>,
                    getReturnIneligibilityReason(order)
                );
            }
            
            <span class="hljs-comment">// 3. 处理退货请求</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">returnId</span> <span class="hljs-operator">=</span> orderService.createReturnRequest(
                orderId, reason, itemsJson);
            
            <span class="hljs-keyword">return</span> String.format(
                <span class="hljs-string">"Return Request Created Successfully!\n"</span> +
                <span class="hljs-string">"━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n"</span> +
                <span class="hljs-string">"Return ID: %s\n"</span> +
                <span class="hljs-string">"Order ID: %s\n"</span> +
                <span class="hljs-string">"Reason: %s\n"</span> +
                <span class="hljs-string">"Status: PENDING_REVIEW\n"</span> +
                <span class="hljs-string">"\nNext Steps:\n"</span> +
                <span class="hljs-string">"1. Our team will review your request within 24 hours\n"</span> +
                <span class="hljs-string">"2. If approved, you will receive a return shipping label\n"</span> +
                <span class="hljs-string">"3. Refund will be processed within 5-7 business days after we receive the items\n"</span> +
                <span class="hljs-string">"\nEstimated Refund Amount: ¥%.2f"</span>,
                returnId,
                orderId,
                reason,
                order.getTotalAmount()
            );
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error processing return request: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">// ============ 工具6：验证优惠券 ============</span>
    
    <span class="hljs-meta">@Tool(
        name = "validate_coupon",
        description = "Validate a coupon code and check the discount amount it provides."
    )</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">validateCoupon</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(
            name = "coupon_code",
            description = "Coupon code to validate"
        )</span> String couponCode,
        
        <span class="hljs-meta">@ToolParam(
            name = "order_amount",
            description = "Order total amount in yuan"
        )</span> Double orderAmount
    )</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Double</span> <span class="hljs-variable">discount</span> <span class="hljs-operator">=</span> pricingService.validateCoupon(couponCode, orderAmount);
            
            <span class="hljs-keyword">if</span> (discount == <span class="hljs-literal">null</span> || discount &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> String.format(
                    <span class="hljs-string">"Coupon '%s' is invalid or has expired."</span>,
                    couponCode
                );
            }
            
            <span class="hljs-type">double</span> <span class="hljs-variable">discountRate</span> <span class="hljs-operator">=</span> (discount / orderAmount) * <span class="hljs-number">100</span>;
            <span class="hljs-type">double</span> <span class="hljs-variable">finalAmount</span> <span class="hljs-operator">=</span> orderAmount - discount;
            
            <span class="hljs-keyword">return</span> String.format(
                <span class="hljs-string">"Coupon Validation Result:\n"</span> +
                <span class="hljs-string">"━━━━━━━━━━━━━━━━━━━━━\n"</span> +
                <span class="hljs-string">"Coupon Code: %s\n"</span> +
                <span class="hljs-string">"Status: VALID\n"</span> +
                <span class="hljs-string">"\nDiscount Details:\n"</span> +
                <span class="hljs-string">"Original Amount: ¥%.2f\n"</span> +
                <span class="hljs-string">"Discount Amount: -¥%.2f (%.1f%% off)\n"</span> +
                <span class="hljs-string">"Final Amount: ¥%.2f\n"</span> +
                <span class="hljs-string">"\nYou save ¥%.2f with this coupon!"</span>,
                couponCode,
                orderAmount,
                discount,
                discountRate,
                finalAmount,
                discount
            );
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Error validating coupon: "</span> + e.getMessage();
        }
    }
    
    <span class="hljs-comment">// ============ 辅助方法 ============</span>
    
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; <span class="hljs-title function_">parseOrderItems</span><span class="hljs-params">(String itemsJson)</span> {
        <span class="hljs-comment">// 解析JSON格式的订单项</span>
        <span class="hljs-comment">// 实现省略...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatSpecifications</span><span class="hljs-params">(Map&lt;String, String&gt; specs)</span> {
        <span class="hljs-keyword">if</span> (specs == <span class="hljs-literal">null</span> || specs.isEmpty()) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"N/A"</span>;
        }
        
        <span class="hljs-keyword">return</span> specs.entrySet().stream()
            .map(entry -&gt; <span class="hljs-string">"  - "</span> + entry.getKey() + <span class="hljs-string">": "</span> + entry.getValue())
            .collect(Collectors.joining(<span class="hljs-string">"\n"</span>));
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">canReturn</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 检查订单是否在退货期限内</span>
        <span class="hljs-comment">// 实现省略...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getReturnIneligibilityReason</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 返回不能退货的原因</span>
        <span class="hljs-comment">// 实现省略...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h3 data-id="heading-18">6.5.2 使用电商工具的Agent</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 电商客服Agent示例
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ECommerceAgentExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 创建服务实例</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderServiceImpl</span>();
        <span class="hljs-type">InventoryService</span> <span class="hljs-variable">inventoryService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InventoryServiceImpl</span>();
        <span class="hljs-type">PricingService</span> <span class="hljs-variable">pricingService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PricingServiceImpl</span>();
        
        <span class="hljs-comment">// 创建工具箱</span>
        <span class="hljs-type">Toolkit</span> <span class="hljs-variable">toolkit</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Toolkit</span>();
        toolkit.registerObject(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ECommerceTools</span>(
            orderService, inventoryService, pricingService));
        
        <span class="hljs-comment">// 创建Agent</span>
        <span class="hljs-type">ReActAgent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> ReActAgent.builder()
            .name(<span class="hljs-string">"ECommerceAssistant"</span>)
            .description(<span class="hljs-string">"专业的电商客服助手"</span>)
            .model(DashScopeChatModel.builder()
                .apiKey(System.getenv(<span class="hljs-string">"DASHSCOPE_API_KEY"</span>))
                .modelName(<span class="hljs-string">"qwen-plus"</span>)
                .build())
            .toolkit(toolkit)
            .memory(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryMemory</span>())
            .maxIters(<span class="hljs-number">10</span>)
            .sysPrompt(<span class="hljs-string">"""
                你是一个专业的电商客服助手。
                
                你的职责：
                1. 帮助用户搜索和查看商品
                2. 协助用户创建订单
                3. 查询订单状态
                4. 处理退货请求
                5. 验证优惠券
                
                工作原则：
                - 优先使用工具获取准确信息
                - 涉及金钱的操作要与用户确认
                - 友好、耐心、专业
                - 如果无法解决问题，建议转人工客服
                """</span>)
            .build();
        
        <span class="hljs-comment">// 场景1：用户购物</span>
        testShoppingScenario(agent);
        
        <span class="hljs-comment">// 场景2：用户查询订单</span>
        testOrderQueryScenario(agent);
        
        <span class="hljs-comment">// 场景3：用户退货</span>
        testReturnScenario(agent);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testShoppingScenario</span><span class="hljs-params">(ReActAgent agent)</span> {
        System.out.println(<span class="hljs-string">"===== 购物场景 =====\n"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">userMessage</span> <span class="hljs-operator">=</span> 
            <span class="hljs-string">"我想买一个iPhone 15 Pro，价格不超过10000块，有优惠吗？"</span>;
        
        <span class="hljs-type">Msg</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> agent.call(userMessage).block();
        System.out.println(<span class="hljs-string">"客服: "</span> + response.getTextContent());
        
        <span class="hljs-comment">// Agent执行过程：</span>
        <span class="hljs-comment">// 1. [推理] 用户想买iPhone 15 Pro，价格限制10000，我需要先搜索商品</span>
        <span class="hljs-comment">// 2. [工具] search_products(query="iPhone 15 Pro", max_price=10000)</span>
        <span class="hljs-comment">// 3. [结果] 返回商品列表</span>
        <span class="hljs-comment">// 4. [推理] 找到商品了，用户问有没有优惠，我需要检查优惠券</span>
        <span class="hljs-comment">// 5. [回复] "找到了iPhone 15 Pro，当前价格9999元。我们有新用户优惠券..."</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOrderQueryScenario</span><span class="hljs-params">(ReActAgent agent)</span> {
        System.out.println(<span class="hljs-string">"\n===== 订单查询场景 =====\n"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">userMessage</span> <span class="hljs-operator">=</span> <span class="hljs-string">"我的订单ORD-2024-001什么时候能到？"</span>;
        
        <span class="hljs-type">Msg</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> agent.call(userMessage).block();
        System.out.println(<span class="hljs-string">"客服: "</span> + response.getTextContent());
        
        <span class="hljs-comment">// Agent执行过程：</span>
        <span class="hljs-comment">// 1. [推理] 用户想查询订单状态，我需要调用check_order_status</span>
        <span class="hljs-comment">// 2. [工具] check_order_status(order_id="ORD-2024-001")</span>
        <span class="hljs-comment">// 3. [结果] 订单状态：已发货，预计3天后到达</span>
        <span class="hljs-comment">// 4. [回复] "您的订单已发货，物流单号123456，预计3天后送达。"</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testReturnScenario</span><span class="hljs-params">(ReActAgent agent)</span> {
        System.out.println(<span class="hljs-string">"\n===== 退货场景 =====\n"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">userMessage</span> <span class="hljs-operator">=</span> <span class="hljs-string">"我想退订单ORD-2024-001，商品有质量问题。"</span>;
        
        <span class="hljs-type">Msg</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> agent.call(userMessage).block();
        System.out.println(<span class="hljs-string">"客服: "</span> + response.getTextContent());
        
        <span class="hljs-comment">// Agent执行过程：</span>
        <span class="hljs-comment">// 1. [推理] 用户要退货，我需要先确认订单信息</span>
        <span class="hljs-comment">// 2. [工具] check_order_status(order_id="ORD-2024-001")</span>
        <span class="hljs-comment">// 3. [推理] 订单确实存在，可以处理退货请求</span>
        <span class="hljs-comment">// 4. [工具] process_return_request(order_id="ORD-2024-001", reason="质量问题")</span>
        <span class="hljs-comment">// 5. [结果] 退货申请已创建</span>
        <span class="hljs-comment">// 6. [回复] "退货申请已提交，退货编号RET-001，我们会在24小时内审核..."</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-19">6.6 本章总结</h2>
<h3 data-id="heading-20">关键要点</h3>
<ol>
<li>
<p><strong>工具定义</strong></p>
<ul>
<li>使用@Tool注解标记方法</li>
<li>使用@ToolParam注解标记参数</li>
<li>命名使用snake_case规范</li>
<li>描述要清晰简洁</li>
</ul>
</li>
<li>
<p><strong>工具注册</strong></p>
<ul>
<li>创建Toolkit实例</li>
<li>使用registerObject()注册工具类</li>
<li>自动扫描@Tool注解</li>
<li>生成ToolSchema</li>
</ul>
</li>
<li>
<p><strong>工具调用流程</strong></p>
<ul>
<li>ToolSchema发送给LLM</li>
<li>LLM生成ToolUseBlock</li>
<li>Agent执行工具</li>
<li>返回ToolResultBlock</li>
<li>继续推理循环</li>
</ul>
</li>
<li>
<p><strong>最佳实践</strong></p>
<ul>
<li>单一职责原则</li>
<li>参数简洁（≤5个）</li>
<li>返回结构化文本</li>
<li>完善的错误处理</li>
<li>支持异步执行</li>
</ul>
</li>
</ol>
<h3 data-id="heading-21">工具开发检查清单</h3>
<pre><code class="hljs">设计阶段：
☐ 工具功能单一明确
☐ 参数数量合理（≤5个）
☐ 描述清晰完整

实现阶段：
☐ 参数验证完整
☐ 异常全部捕获
☐ 返回值格式统一
☐ 支持异步执行（如需要）

测试阶段：
☐ 正常流程测试
☐ 异常流程测试
☐ 边界条件测试
☐ 性能测试

集成阶段：
☐ 注册到Toolkit
☐ 与Agent集成测试
☐ 端到端场景测试
</code></pre>
<h3 data-id="heading-22">下一章预告</h3>
<p>第7-9章将讲解<strong>记忆系统、Hook机制、Formatter适配</strong>，探讨如何管理对话历史、如何扩展Agent功能、如何适配不同LLM模型等高级主题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【大数据 & AI】Flink Agents 源码解读 --- (3) --- Agent]]></title>    <link>https://juejin.cn/post/7589835342145585162</link>    <guid>https://juejin.cn/post/7589835342145585162</guid>    <pubDate>2025-12-31T11:29:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589835342145585162" data-draft-id="7589839767816699942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【大数据 &amp; AI】Flink Agents 源码解读 --- (3) --- Agent"/> <meta itemprop="keywords" content="算法,人工智能,机器学习"/> <meta itemprop="datePublished" content="2025-12-31T11:29:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【大数据 &amp; AI】Flink Agents 源码解读 --- (3) --- Agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T11:29:48.000Z" title="Wed Dec 31 2025 11:29:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【大数据 &amp; AI】Flink Agents 源码解读 --- (3) --- Agent</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 概要</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 核心抽象</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 Agent抽象</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 Action 抽象</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 资源抽象</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.4 执行环境抽象</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.5 事件抽象</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.6 配置抽象</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 Workflow Style Agent 和ReActAgent</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 特性</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 workflow</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3 ReAct Agent</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 ReActAgent</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 定义</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 深度定制</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.3 典型执行流程</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.4 start_action 与 stop_action</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.5 输入输出</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.6 模板系统</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.7 FunctionTool 与 Action 的关联及注册机制</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 概要</h3>
<p>Agent是 Flink Agent 框架的核心概念，它是一个可执行单元，用于处理输入事件并生成输出事件。主要功能和特色如下：</p>
<ul>
<li>事件驱动处理：基于事件驱动架构，响应不同类型的事件（如 InputEvent，ChatRequestEvent等），通过定义actions来处理特定事件类型。</li>
<li>资源管理：管理各种资源，如聊天模型、工具、提示词等。支持多种资源类型（CHAT_MOEL, TOOL, PROMPT等）。</li>
<li>可扩展性：支持自定义的actions和资源，可以通过继承Agent类来创建特定功能的Agent，如ReActAgent。</li>
<li>配置支持：支持通过配置选项自定义行为，提供统一的配置管理机制。</li>
<li>模块化设计：将功能分解为独立的Actions，每个action负责处理特定类型的事件。</li>
<li>资源抽象：通过 ResourceDescriptor 抽象资源定义，支持不同类型的资源（模型，工具，提示词等）</li>
<li>状态管理：提供短期内存管理机制，支持基于key的状态隔离。</li>
<li>多环境支持：支持本地执行环境用于调试，支持远程 Flink 环境用于生产。</li>
</ul>
<h3 data-id="heading-2">0x01 核心抽象</h3>
<h4 data-id="heading-3">1.1 Agent抽象</h4>
<p>Agent 作为基类提供了：</p>
<ul>
<li>资源管理（resources 字典）。</li>
<li>Action 注册机制（actions 字典）。</li>
<li>统一的接口供执行环境使用。</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Agent</span>(<span class="hljs-title class_ inherited__">ABC</span>):
    <span class="hljs-string">"""Base class for defining agent logic.

    Example:
        Users have two ways to create an Agent

        * Declare an Agent with decorators
        ::

            class MyAgent(Agent):
                @action(InputEvent)
                @staticmethod
                def my_action(event: Event, ctx: RunnerContext) -&gt; None:
                    action logic

                @chat_model_connection
                @staticmethod
                def my_connection() -&gt; ResourceDescriptor:
                    return ResourceDescriptor(clazz=OllamaChatModelConnection,
                                              model="qwen2:7b",
                                              base_url="http://localhost:11434")

                @chat_model_setup
                @staticmethod
                def my_chat_model() -&gt; ResourceDescriptor:
                    return ResourceDescriptor(clazz=OllamaChatModel,
                                              connection="my_connection")

        * Add actions and resources to an Agent instance
        ::

            my_agent = Agent()
            my_agent.add_action(name="my_action",
                                events=[InputEvent],
                                func=action_function)
                    .add_resource(name="my_connection",
                                  instance=ResourceDescriptor(
                                        clazz=OllamaChatModelConnection,
                                        arg1=xxx
                                )
                    .add_resource(
                        name="my_connection",
                        instance=ResourceDescriptor(
                            clazz=OllamaChatModelConnection,
                            arg1=xxx
                        )
                    )
                    .add_resource(
                        name="my_chat_model",
                        instance=ResourceDescriptor(
                            clazz=OllamaChatModelSetup,
                            connection="my_connection"
                        )
                    )
    """</span>

    _actions: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Tuple</span>[<span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[Event]], <span class="hljs-type">Callable</span>, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]]
    _resources: <span class="hljs-type">Dict</span>[ResourceType, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]
    _mcp_servers: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, MCPServer]

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Init method."""</span>
        self._actions = {}
        self._resources = {}
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> ResourceType:
            self._resources[<span class="hljs-built_in">type</span>] = {}

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">actions</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Tuple</span>[<span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[Event]], <span class="hljs-type">Callable</span>, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]]:
        <span class="hljs-string">"""Get added actions."""</span>
        <span class="hljs-keyword">return</span> self._actions

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">resources</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[ResourceType, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""Get added resources."""</span>
        <span class="hljs-keyword">return</span> self._resources

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_action</span>(<span class="hljs-params">
        self, name: <span class="hljs-built_in">str</span>, events: <span class="hljs-type">List</span>[<span class="hljs-type">Type</span>[Event]], func: <span class="hljs-type">Callable</span>, **config: <span class="hljs-type">Any</span>
    </span>) -&gt; <span class="hljs-string">"Agent"</span>:
        <span class="hljs-string">"""Add action to agent.

        Parameters
        ----------
        name : str
            The name of the action, should be unique in the same Agent.
        events: List[Type[Event]]
            The type of events listened by this action.
        func: Callable
            The function to be executed when receive listened events.
        **config: Any
            Key named arguments can be used by this action in runtime.

        Returns:
        -------
        Agent
            The modified Agent instance.
        """</span>
        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self._actions:
            msg = <span class="hljs-string">f"Action <span class="hljs-subst">{name}</span> already defined"</span>
            <span class="hljs-keyword">raise</span> ValueError(msg)
        self._actions[name] = (events, func, config <span class="hljs-keyword">if</span> config <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">return</span> self

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_resource</span>(<span class="hljs-params">
        self, name: <span class="hljs-built_in">str</span>, instance: SerializableResource | ResourceDescriptor
    </span>) -&gt; <span class="hljs-string">"Agent"</span>:
        <span class="hljs-string">"""Add resource to agent instance.

        Parameters
        ----------
        name : str
            The name of the prompt, should be unique in the same Agent.
        instance: SerializableResource | ResourceDescriptor
            The serializable resource instance, or the descriptor of resource.

        Returns:
        -------
        Agent
            The agent to add the resource.
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(instance, SerializableResource):
            resource_type = instance.resource_type()
        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(instance, ResourceDescriptor):
            resource_type = instance.clazz.resource_type()
        <span class="hljs-keyword">else</span>:
            err_msg = <span class="hljs-string">f"Unexpected resource <span class="hljs-subst">{instance}</span>"</span>
            <span class="hljs-keyword">raise</span> TypeError(err_msg)

        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self._resources[resource_type]:
            msg = <span class="hljs-string">f"<span class="hljs-subst">{resource_type.value}</span> <span class="hljs-subst">{name}</span> already defined"</span>
            <span class="hljs-keyword">raise</span> ValueError(msg)

        self._resources[resource_type][name] = instance
        <span class="hljs-keyword">return</span> self
</code></pre>
<h4 data-id="heading-4">1.2 Action 抽象</h4>
<p>Action 提供了：</p>
<ul>
<li>事件监听机制</li>
<li>与执行上下文的交互接口</li>
<li>统一的执行接口</li>
</ul>
<p>通过装饰器或者add_action方法定义。</p>
<pre><code class="hljs language-less" lang="less">    <span class="hljs-variable">@action</span>(InputEvent)
    <span class="hljs-variable">@staticmethod</span>
    def <span class="hljs-built_in">start_action</span>(<span class="hljs-attribute">event</span>: InputEvent, <span class="hljs-attribute">ctx</span>: RunnerContext) -&gt; <span class="hljs-attribute">None</span>:
        <span class="hljs-string">""</span><span class="hljs-string">"Start action to format user input and send chat request event."</span><span class="hljs-string">""</span>
        usr_input = event.input
</code></pre>
<h4 data-id="heading-5">1.3 资源抽象</h4>
<p>资源抽象包括：模型连接（CHAT_MODEL_CONNECTION)，工具，提示词，MCP服务器等。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceDescriptor</span>:
    <span class="hljs-string">"""Descriptor of resource, includes the class and the initialize arguments."""</span>

    _clazz: <span class="hljs-type">Type</span>[Resource]
    _arguments: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *, clazz: <span class="hljs-type">Type</span>[Resource], **arguments: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Init method."""</span>
        self._clazz = clazz
        self._arguments = arguments

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clazz</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Type</span>[Resource]:
        <span class="hljs-string">"""Get the class of the resource."""</span>
        <span class="hljs-keyword">return</span> self._clazz

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">arguments</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""Get the initialize arguments of the resource."""</span>
        <span class="hljs-keyword">return</span> self._arguments
</code></pre>
<h4 data-id="heading-6">1.4 执行环境抽象</h4>
<p>执行上下文提供：</p>
<ul>
<li>事件发送机制</li>
<li>资源访问接口</li>
<li>内存管理</li>
<li>配置访问</li>
</ul>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RunnerContext</span>(<span class="hljs-variable constant_">ABC</span>):
    <span class="hljs-string">""</span><span class="hljs-string">"Abstract base class providing context for agent execution.

    This context provides access to event handling.
</span></code></pre>
<h4 data-id="heading-7">1.5 事件抽象</h4>
<p>即 Event 体系，提供了：</p>
<ul>
<li>统一的事件处理机制</li>
<li>类型安全的事件分发</li>
<li>可扩展的事件类型系统</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Event</span>(BaseModel, ABC, extra=<span class="hljs-string">"allow"</span>):
    <span class="hljs-string">"""Base class for all event types in the system. Event allow extra properties, but
    these properties are required isinstance of BaseModel, or json serializable.

    Attributes:
    ----------
    id : UUID
        Unique identifier for the event, automatically generated using uuid4.
    """</span>

    <span class="hljs-built_in">id</span>: UUID = Field(default_factory=uuid4)
</code></pre>
<h4 data-id="heading-8">1.6 配置抽象</h4>
<p>AgentConfiguration 提供了：</p>
<ul>
<li>类型安全的配置选项</li>
<li>默认值管理</li>
<li>从文件加载配置的能力</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentConfiguration</span>(BaseModel, Configuration):
    <span class="hljs-string">"""Base class for config objects in the system.
    Provides a flat dict interface to access nested config values.
    """</span>

    conf_data: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, conf_data: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Initialize with optional configuration data."""</span>
        <span class="hljs-keyword">if</span> conf_data <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-built_in">super</span>().__init__(conf_data = {})
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">super</span>().__init__(conf_data = conf_data)
</code></pre>
<h3 data-id="heading-9">0x02 Workflow Style Agent 和ReActAgent</h3>
<p>有两种最普遍的Agents：</p>
<ul>
<li><strong>Workflows</strong> 是由预定义的代码路径来编排 LLM 和工具的系统。</li>
<li><strong>Agents</strong> 则是 LLM 动态指导自身流程和工具使用的系统，它们掌控着自己完成任务的方式。</li>
</ul>
<p>当需要处理更复杂任务时，Workflows 为定义明确的任务提供了可预测性和一致性（复现），而当需要大规模的灵活性和模型驱动的决策时，agents 则是更好的选择。</p>
<p>对应这两种Agent，Flink Agents 有两种不同的Agent：Workflow Style Agent 和ReActAgent。</p>
<ul>
<li>在 Flink-Agents 中，工作流风格的代理（workflow-style agent）把推理与行为组织成一条由“动作（action）”构成的有向工作流，动作之间通过事件连接。这种设计借鉴了复杂多阶段任务的编排需求，希望以透明、可扩展且以数据为中心的方式利用 Apache Flink 的流式架构来完成工作。Workflow 适合任务是可以被清除的解构成固定的子任务单元。Workflow 相对于 Agent 有个天然的优势就是高效率，且效果非常稳定，执行基本都能在预期范围内，不可预知或者说未知性很低。缺点自然就是不够灵活了，面对一些开放的或者无法预定义的任务就无法处理了。</li>
<li>ReAct（Reasoning and Acting）Agent 是一种通用范式，把推理与行动能力结合起来解决复杂任务。借助该范式，用户只需在提示词里指定目标并提供可用工具，大模型便会自主决定如何达成目标并执行相应动作。ReAct通过模拟人类的“Reasoning-Acting”模式，使LLM能够动态地决定数据需求 。其核心是一个循环：思考（Thought）： LLM首先进行内部推理。它分析当前任务和已有信息，判断是否缺少完成任务所需的知识，并制定下一步的行动计划。在这个循环中，数据流是根据LLM的“思考”结果动态生成的。当LLM判断需要外部数据时，它会主动触发一个“行动”来获取数据，然后将获取到的“观察”数据整合进自己的上下文中，用于下一步的决策。</li>
</ul>
<h4 data-id="heading-10">2.1 特性</h4>
<p>两种Agent的详细梳理如下：</p>
<h5 data-id="heading-11">2.1.1 设计理念</h5>
<p>Workflow Style Agent</p>
<ul>
<li>可定制框架：灵活的框架，允许用户定义自己的代理逻辑</li>
<li>事件驱动架构：逻辑被组织为由事件连接的动作有向图</li>
<li>模块化设计：用户通过定义单个动作及其交互来组合代理</li>
</ul>
<p>ReActAgent</p>
<ul>
<li>预构建代理：基于 ReAct（推理+行动）范式的内置、即用型代理实现</li>
<li>以 LLM 为中心：专门为 LLM 做出采取何种行动的决策而设计</li>
<li>标准化工作流：遵循固定的“思维→行动→观察”循环模式</li>
</ul>
<h5 data-id="heading-12">2.1.2 控制流</h5>
<p>Workflow Style Agent</p>
<ul>
<li>显式流程：用户明确定义事件如何触发动作</li>
<li>事件路由：动作由特定的事件类型触发</li>
<li>灵活模式：可以实现各种模式，如顺序、分支或循环工作流</li>
</ul>
<p>ReActAgent</p>
<ul>
<li>隐式流程：决策过程在内部由 LLM 处理</li>
<li>工具调用：使用 LLM 的原生函数调用功能来确定操作</li>
<li>固定模式：遵循标准的 ReAct 模式（思考→行动→观察）</li>
</ul>
<h5 data-id="heading-13">2.1.3 定制级别</h5>
<p>Workflow Style Agent</p>
<ul>
<li>高度可定制：对代理逻辑、动作和事件流拥有完全控制权</li>
<li>自定义动作：用户定义所有动作及其行为</li>
<li>灵活事件：用户可以定义自定义事件类型和处理逻辑</li>
</ul>
<p>ReActAgent</p>
<ul>
<li>有限定制：定制主要通过提示词、模型和输出模式实现</li>
<li>预定义动作：使用内置动作如 start_action 和 stop_action</li>
<li>标准接口：为类似的 LLM 任务提供一致的接口</li>
</ul>
<h5 data-id="heading-14">2.1.4 使用场景</h5>
<p>Workflow Style Agent</p>
<ul>
<li>具有固定序列或条件分支的多步骤流程</li>
<li>需要精确控制代理行为的场景</li>
<li>在预定顺序中与多个外部系统集成</li>
</ul>
<p>ReActAgent</p>
<ul>
<li>需要 LLM 推理使用哪些工具/操作的任务</li>
<li>带工具使用的标准问答</li>
<li>LLM 应该动态决定工作流程的场景</li>
</ul>
<p>只要“问题不可完全穷举、要跨多系统查证、并且需要在对话中澄清/协商/决策”，就更应该用ReActAgent，而不是纯 Workflow。</p>
<h5 data-id="heading-15">2.1.5 开发复杂度</h5>
<p>Workflow Style Agent</p>
<ul>
<li>更高灵活性：需要更多代码但控制力更强</li>
<li>自定义逻辑：需要实现所有动作逻辑</li>
<li>无主见：开发人员控制代理行为的所有方面</li>
</ul>
<p>ReActAgent</p>
<ul>
<li>较低门槛：更容易上手，具有预定义功能</li>
<li>代码量少：设置所需的代码最少</li>
<li>有主见：代表开发人员做出许多决策</li>
</ul>
<h5 data-id="heading-16">2.1.6 总结</h5>
<p>ReActAgent 为标准的基于 LLM 的推理任务提供了现成的解决方案，而 Workflow Style Agent 为复杂的自定义代理实现提供了最大的灵活性。</p>
<p>有人戏称：拉投资用 Agent 讲故事，做业务踏踏实实用 Workflow 。这句玩笑背后折射出现实的考量：Workflow 胜在确定性，而 Agent 胜在上限。</p>
<h4 data-id="heading-17">2.2 workflow</h4>
<p>官方的快速入门（docs\content\docs\get-started\quickstart\workflow_agent.md）通过两个渐进式流式示例，展示如何用 Flink Agents 构建由大模型驱动的流水线：</p>
<ul>
<li><strong>评论分析</strong>：示例一 会持续接收商品评论流，并用单个代理从每条评论中提取评分（1-5）以及不满意原因。</li>
<li><strong>产品改进建议</strong>：在示例一的基础上，按窗口聚合每条评论的分析结果，生成商品级别的汇总（评分分布、常见抱怨），再调用第二个代理为每件商品输出具体的改进建议。</li>
</ul>
<p>两个示例合在一起，演示了如何用 Flink Agents 构建多代理工作流，并直接在 Flink 独立集群上运行。</p>
<h5 data-id="heading-18">2.2.1 代码导读</h5>
<h6 data-id="heading-19">准备代理执行环境</h6>
<p>创建 Agents 执行环境，注册可供代理使用的聊天模型连接。</p>
<pre><code class="hljs language-ini" lang="ini">// Set up the Flink streaming environment and the Agents execution environment.
StreamExecutionEnvironment <span class="hljs-attr">env</span> = StreamExecutionEnvironment.getExecutionEnvironment()<span class="hljs-comment">;</span>
AgentsExecutionEnvironment <span class="hljs-attr">agentsEnv</span> =
        AgentsExecutionEnvironment.getExecutionEnvironment(env)<span class="hljs-comment">;</span>

// Add Ollama chat model connection to be used by the ReviewAnalysisAgent.
agentsEnv.addResource(
        "ollamaChatModelConnection",
        ResourceType.CHAT_MODEL_CONNECTION,
        CustomTypesAndResources.OLLAMA_SERVER_DESCRIPTOR)<span class="hljs-comment">;</span>
</code></pre>
<h6 data-id="heading-20">创建代理</h6>
<p>以 <code>ReviewAnalysisAgent</code> 为例，展示如何定义提示词、工具、聊天模型和动作；以及如何处理聊天响应并发送输出事件。更多细节请参考 [工作流代理] 文档。<code>ProductSuggestionAgent</code> 的代码与之类似。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * An agent that uses a large language model (LLM) to analyze product reviews and generate a
 * satisfaction score and potential reasons for dissatisfaction.
 *
 * &lt;p&gt;This agent receives a product review and produces a satisfaction score and a list of reasons
 * for dissatisfaction. It handles prompt construction, LLM interaction, and output parsing.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReviewAnalysisAgent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Agent</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">MAPPER</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();

    <span class="hljs-meta">@Prompt</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> org.apache.flink.agents.api.prompt.Prompt <span class="hljs-title function_">reviewAnalysisPrompt</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> REVIEW_ANALYSIS_PROMPT;
    }

    <span class="hljs-meta">@ChatModelSetup</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResourceDescriptor <span class="hljs-title function_">reviewAnalysisModel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ResourceDescriptor.Builder.newBuilder(OllamaChatModelSetup.class.getName())
                .addInitialArgument(<span class="hljs-string">"connection"</span>, <span class="hljs-string">"ollamaChatModelConnection"</span>)
                .addInitialArgument(<span class="hljs-string">"model"</span>, <span class="hljs-string">"qwen3:8b"</span>)
                .addInitialArgument(<span class="hljs-string">"prompt"</span>, <span class="hljs-string">"reviewAnalysisPrompt"</span>)
                .addInitialArgument(<span class="hljs-string">"tools"</span>, Collections.singletonList(<span class="hljs-string">"notifyShippingManager"</span>))
                .addInitialArgument(<span class="hljs-string">"extract_reasoning"</span>, <span class="hljs-string">"true"</span>)
                .build();
    }

    <span class="hljs-comment">/**
     * Tool for notifying the shipping manager when product received a negative review due to
     * shipping damage.
     *
     * <span class="hljs-doctag">@param</span> id The id of the product that received a negative review due to shipping damage
     * <span class="hljs-doctag">@param</span> review The negative review content
     */</span>
    <span class="hljs-meta">@Tool(
            description =
                    "Notify the shipping manager when product received a negative review due to shipping damage.")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyShippingManager</span><span class="hljs-params">(
            <span class="hljs-meta">@ToolParam(name = "id")</span> String id, <span class="hljs-meta">@ToolParam(name = "review")</span> String review)</span> {
        CustomTypesAndResources.notifyShippingManager(id, review);
    }

    <span class="hljs-comment">/** Process input event and send chat request for review analysis. */</span>
    <span class="hljs-meta">@Action(listenEvents = {InputEvent.class})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processInput</span><span class="hljs-params">(InputEvent event, RunnerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">String</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> (String) event.getInput();
        MAPPER.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="hljs-literal">false</span>);
        CustomTypesAndResources.<span class="hljs-type">ProductReview</span> <span class="hljs-variable">inputObj</span> <span class="hljs-operator">=</span>
                MAPPER.readValue(input, CustomTypesAndResources.ProductReview.class);

        ctx.getShortTermMemory().set(<span class="hljs-string">"id"</span>, inputObj.getId());

        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span>
                String.format(
                        <span class="hljs-string">"{\n"</span> + <span class="hljs-string">""</span>id<span class="hljs-string">": %s,\n"</span> + <span class="hljs-string">""</span>review<span class="hljs-string">": "</span>%s<span class="hljs-string">"\n"</span> + <span class="hljs-string">"}"</span>,
                        inputObj.getId(), inputObj.getReview());
        <span class="hljs-type">ChatMessage</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatMessage</span>(MessageRole.USER, <span class="hljs-string">""</span>, Map.of(<span class="hljs-string">"input"</span>, content));

        ctx.sendEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatRequestEvent</span>(<span class="hljs-string">"reviewAnalysisModel"</span>, List.of(msg)));
    }

    <span class="hljs-meta">@Action(listenEvents = ChatResponseEvent.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processChatResponse</span><span class="hljs-params">(ChatResponseEvent event, RunnerContext ctx)</span>
            <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">jsonNode</span> <span class="hljs-operator">=</span> MAPPER.readTree(event.getResponse().getContent());
        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">scoreNode</span> <span class="hljs-operator">=</span> jsonNode.findValue(<span class="hljs-string">"score"</span>);
        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">reasonsNode</span> <span class="hljs-operator">=</span> jsonNode.findValue(<span class="hljs-string">"reasons"</span>);
        <span class="hljs-keyword">if</span> (scoreNode == <span class="hljs-literal">null</span> || reasonsNode == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                    <span class="hljs-string">"Invalid response from LLM: missing 'score' or 'reasons' field."</span>);
        }
        List&lt;String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">if</span> (reasonsNode.isArray()) {
            <span class="hljs-keyword">for</span> (JsonNode node : reasonsNode) {
                result.add(node.asText());
            }
        }

        ctx.sendEvent(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputEvent</span>(
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomTypesAndResources</span>.ProductReviewAnalysisRes(
                                ctx.getShortTermMemory().get(<span class="hljs-string">"id"</span>).getValue().toString(),
                                scoreNode.asInt(),
                                result)));
    }
}
</code></pre>
<h6 data-id="heading-21">与 Flink 集成</h6>
<p>读取文本文件中的商品评论流作为输入 DataStream，用 <code>ReviewAnalysisAgent</code> 分析并生成结果 DataStream，最后打印输出。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Read product reviews from input_data.txt file as a streaming source.</span>
<span class="hljs-comment">// Each element represents a ProductReview.</span>
DataStream&lt;String&gt; productReviewStream =
       env<span class="hljs-selector-class">.fromSource</span>(
               FileSource.forRecordStreamFormat(
                               new TextLineInputFormat(),
                               new <span class="hljs-built_in">Path</span>(inputDataFile.getAbsolutePath()))
                       <span class="hljs-selector-class">.build</span>(),
               WatermarkStrategy<span class="hljs-selector-class">.noWatermarks</span>(),
               "streaming-agent-example");

<span class="hljs-comment">// Use the ReviewAnalysisAgent to analyze each product review.</span>
DataStream&lt;<span class="hljs-selector-tag">Object</span>&gt; reviewAnalysisResStream =
       agentsEnv
               <span class="hljs-selector-class">.fromDataStream</span>(productReviewStream)
               <span class="hljs-selector-class">.apply</span>(new ReviewAnalysisAgent())
               <span class="hljs-selector-class">.toDataStream</span>();

<span class="hljs-comment">// Print the analysis results to stdout.</span>
reviewAnalysisResStream<span class="hljs-selector-class">.print</span>();

<span class="hljs-comment">// Execute the Flink pipeline.</span>
agentsEnv<span class="hljs-selector-class">.execute</span>();
</code></pre>
<h4 data-id="heading-22">2.3 ReAct Agent</h4>
<p>本快速入门用一个迷你示例演示如何用 Flink Agents 构建流式 ReAct Agent：</p>
<p><strong>评论分析</strong> 代理持续消费商品评论流，用单个代理提取评分（1-5）以及不满意原因；若评论涉及物流不满，则自动通知物流经理。</p>
<h5 data-id="heading-23">2.3.1 代码导读</h5>
<h6 data-id="heading-24">准备代理执行环境</h6>
<p>创建 Agents 执行环境，注册可用的聊天模型连接与工具。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Set up the Flink streaming environment and the Agents execution environment.</span>
<span class="hljs-attr">env</span> = StreamExecutionEnvironment.get_execution_environment()
<span class="hljs-attr">agents_env</span> = AgentsExecutionEnvironment.get_execution_environment(env)

<span class="hljs-comment"># Add Ollama chat model connection and notify shipping manager tool to be used</span>
<span class="hljs-comment"># by the Agent.</span>
agents_env.add_resource(
    "ollama_server",
    ResourceDescriptor(<span class="hljs-attr">clazz</span>=OllamaChatModelConnection, request_timeout=<span class="hljs-number">120</span>),
).add_resource(
    "notify_shipping_manager", Tool.from_callable(notify_shipping_manager)
)
</code></pre>
<h6 data-id="heading-25">创建 ReAct Agent</h6>
<p>实例化 ReAct Agent，配置聊天模型、提示词以及结果的输出模式。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">review_analysis_react_agent</span> = ReActAgent(
    <span class="hljs-attr">chat_model</span>=ResourceDescriptor(
        <span class="hljs-attr">clazz</span>=OllamaChatModelSetup,
        <span class="hljs-attr">connection</span>=<span class="hljs-string">"ollama_server"</span>,
        <span class="hljs-attr">model</span>=<span class="hljs-string">"qwen3:8b"</span>,
        <span class="hljs-attr">tools</span>=[<span class="hljs-string">"notify_shipping_manager"</span>],
    ),
    <span class="hljs-attr">prompt</span>=review_analysis_react_prompt,
    <span class="hljs-attr">output_schema</span>=ProductReviewAnalysisRes,
)
</code></pre>
<h6 data-id="heading-26">与 Flink 集成</h6>
<p>读取商品评论文本文件生成 Source DataStream，用 ReAct Agent 分析并生成结果 DataStream，最后打印输出。</p>
<pre><code class="hljs language-less" lang="less"># <span class="hljs-selector-tag">Read</span> <span class="hljs-selector-tag">product</span> <span class="hljs-selector-tag">reviews</span> <span class="hljs-selector-tag">from</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">text</span> <span class="hljs-selector-tag">file</span> <span class="hljs-selector-tag">as</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">streaming</span> <span class="hljs-selector-tag">source</span>.
# <span class="hljs-selector-tag">Each</span> <span class="hljs-selector-tag">line</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">file</span> <span class="hljs-selector-tag">should</span> <span class="hljs-selector-tag">be</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">JSON</span> <span class="hljs-selector-tag">string</span> <span class="hljs-selector-tag">representing</span> <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">ProductReview</span>.
<span class="hljs-selector-tag">product_review_stream</span> = <span class="hljs-selector-tag">env</span><span class="hljs-selector-class">.from_source</span>(
    source=FileSource.<span class="hljs-built_in">for_record_stream_format</span>(
        StreamFormat.<span class="hljs-built_in">text_line_format</span>(),
        f<span class="hljs-string">"file:///{current_dir}/resources/"</span>,
    )
    .<span class="hljs-built_in">monitor_continuously</span>(Duration.<span class="hljs-built_in">of_minutes</span>(<span class="hljs-number">1</span>))
    .<span class="hljs-built_in">build</span>(),
    watermark_strategy=WatermarkStrategy.<span class="hljs-built_in">no_watermarks</span>(),
    source_name=<span class="hljs-string">"streaming_agent_example"</span>,
)<span class="hljs-selector-class">.map</span>(
    lambda <span class="hljs-attribute">x</span>: ProductReview.<span class="hljs-built_in">model_validate_json</span>(
        x
    )  # Deserialize JSON to ProductReview.
)

# <span class="hljs-selector-tag">Use</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">ReAct</span> <span class="hljs-selector-tag">agent</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">analyze</span> <span class="hljs-selector-tag">each</span> <span class="hljs-selector-tag">product</span> <span class="hljs-selector-tag">review</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">notify</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">shipping</span> <span class="hljs-selector-tag">manager</span>
# <span class="hljs-keyword">when</span> needed.
review_analysis_res_stream = (
    agents_env.<span class="hljs-built_in">from_datastream</span>(
        input=product_review_stream, key_selector=lambda <span class="hljs-attribute">x</span>: x.id
    )
    .<span class="hljs-built_in">apply</span>(review_analysis_react_agent)
    .<span class="hljs-built_in">to_datastream</span>()
)

# Print the analysis results to stdout.
review_analysis_res_stream.<span class="hljs-built_in">print</span>()
</code></pre>
<h3 data-id="heading-27">0x03 ReActAgent</h3>
<p>ReActAgent 是 Agent 抽象的一个具体实现，展示了这些抽象如何协同工作。</p>
<ul>
<li>资源管理：管理聊天模型和提示词资源</li>
<li>Action定义：定义 start_action 和 stop_action 处理输入和输出</li>
<li>事件处理：响应 InputEvent 和 ChatResponseEvent</li>
<li>配置管理：支持错误处理策略配置</li>
<li>输出格式化：支持基于 schema 的输出验证和格式化</li>
</ul>
<p>这种抽象设计使得 Agent 系统具有高度的灵活性和可扩展性，开发者可以通过组合不同的资源、actions和配置来构建满足特定需求的Agent。</p>
<h4 data-id="heading-28">3.1 定义</h4>
<p>ReActAgent 的定义如下。</p>
<pre><code class="hljs language-ini" lang="ini">class ReActAgent(Agent):
    """Built-in implementation of ReAct agent which is based on the function
    call ability of llm.

    This implementation is not based on the foundational ReAct paper which uses
    prompt to force llm output contain &lt;Thought&gt;, &lt;Action&gt; and &lt;Observation&gt; and
    extract tool calls by text parsing. For a more robust and feature-rich
    implementation we use the tool/function call ability of current llm, and get
    the tool calls from response directly.

    Example:
        ::

            class OutputData(BaseModel):
                result: int


            <span class="hljs-attr">env</span> = AgentsExecutionEnvironment.get_execution_environment()

            <span class="hljs-comment"># register resource to execution environment</span>
            (
                env.add_resource(
                    "ollama",
                    ResourceDescriptor(<span class="hljs-attr">clazz</span>=OllamaChatModelConnection, model=model),
                )
                .add_resource("add", add)
                .add_resource("multiply", multiply)
            )

            <span class="hljs-comment"># prepare prompt</span>
            <span class="hljs-attr">prompt</span> = Prompt.from_messages(
                <span class="hljs-attr">messages</span>=[
                    ChatMessage(
                        role=MessageRole.SYSTEM,
                        content=<span class="hljs-string">'An example of output is {"result": 30.32}.'</span>,
                    ),
                    ChatMessage(
                        role=MessageRole.USER, content=<span class="hljs-string">"What is ({a} + {b}) * {c}"</span>
                    ),
                ],
            )

            <span class="hljs-comment"># create ReAct agent.</span>
            <span class="hljs-attr">agent</span> = ReActAgent(
                <span class="hljs-attr">chat_model</span>=ResourceDescriptor(
                    <span class="hljs-attr">clazz</span>=OllamaChatModelSetup,
                    <span class="hljs-attr">connection</span>=<span class="hljs-string">"ollama_server"</span>,
                    <span class="hljs-attr">tools</span>=[<span class="hljs-string">"notify_shipping_manager"</span>],
                ),
                <span class="hljs-attr">prompt</span>=prompt,
                <span class="hljs-attr">output_schema</span>=OutputData,
            )
    """

    def __init__(
        self,
        *,
        chat_model: ResourceDescriptor,
        prompt: Prompt | <span class="hljs-attr">None</span> = None,
        output_schema: type<span class="hljs-section">[BaseModel]</span> | RowTypeInfo | <span class="hljs-attr">None</span> = None,
    ) -&gt; None:
        """Init method of ReActAgent.

        Parameters
        ----------
        chat_model : ResourceDescriptor
            The descriptor of the chat model used in this ReAct agent.
        prompt : Optional<span class="hljs-section">[Prompt]</span> = None
            Prompt to instruct the llm, could include input and output example,
            task and so on.
        output_schema : Optional<span class="hljs-section">[Union[type[BaseModel]</span>, RowTypeInfo]] = None
            The schema should be RowTypeInfo or subclass of BaseModel. When user
            provide output schema, ReAct agent will add system prompt to instruct
            response format of llm, and add output parser according to the schema.
        """
        super().__init__()
        self.add_resource(_DEFAULT_CHAT_MODEL, chat_model)

        if output_schema:
            if isinstance(output_schema, type) and issubclass(output_schema, BaseModel):
                <span class="hljs-attr">json_schema</span> = output_schema.model_json_schema()
            elif isinstance(output_schema, RowTypeInfo):
                <span class="hljs-attr">json_schema</span> = str(output_schema)
            else:
                <span class="hljs-attr">err_msg</span> = f<span class="hljs-string">"Output schema {output_schema.__class__} is not supported."</span>
                raise TypeError(err_msg)
            <span class="hljs-attr">schema_prompt</span> = f<span class="hljs-string">"The final response should be json format, and match the schema {json_schema}."</span>
            self._resources<span class="hljs-section">[ResourceType.PROMPT]</span><span class="hljs-section">[_DEFAULT_SCHEMA_PROMPT]</span> = (
                Prompt.from_text(<span class="hljs-attr">text</span>=schema_prompt)
            )

        if prompt:
            self._resources<span class="hljs-section">[ResourceType.PROMPT]</span><span class="hljs-section">[_DEFAULT_USER_PROMPT]</span> = prompt

        self.add_action(
            <span class="hljs-attr">name</span>=<span class="hljs-string">"stop_action"</span>,
            <span class="hljs-attr">events</span>=[ChatResponseEvent],
            <span class="hljs-attr">func</span>=self.stop_action,
            <span class="hljs-attr">output_schema</span>=OutputSchema(output_schema=output_schema),
        )
</code></pre>
<h4 data-id="heading-29">3.2 深度定制</h4>
<p>Flink 对 ReActAgent 做了深度定制，使其能在分布式流处理环境中高效执行，并提供了丰富的功能来简化 LLM 应用开发。</p>
<h5 data-id="heading-30">3.2.1 ReActAgent 特色</h5>
<h6 data-id="heading-31">流式处理适配</h6>
<p>Flink 将传统的 ReAct 模式适配到了流处理环境中：</p>
<ul>
<li>通过 InputEvent 和 OutputEvent 包装输入输出数据</li>
<li>利用 Flink 的事件驱动架构实现异步处理</li>
<li>通过 RunnerContext 管理状态和资源</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">agents_env</span> = AgentsExecutionEnvironment.get_execution_environment(env)
agents_env.fromDataStream(dataStream) <span class="hljs-comment"># 从DataStream输入</span>
agents_env.fromTable(table) <span class="hljs-comment"># 从Table输入</span>
agents_env.fromList(list) <span class="hljs-comment"># 从List输入</span>

<span class="hljs-attr">review_analysis_res_stream</span> = (
        agents_env.from_datastream( <span class="hljs-comment"># 从DataSteam创建Agent流程</span>
            <span class="hljs-attr">input</span>=product_review_stream, key_selector=lambda x: x.id
        )
        .apply(review_analysis_react_agent) <span class="hljs-comment"># 应用Agent</span>
        .to_datastream() <span class="hljs-comment"># 转换回Stream</span>
    )
</code></pre>
<h6 data-id="heading-32">特定的行为模式</h6>
<p>ReActAgent 实现了特定的 ReAct（Reasoning + Action）范式，这是一种结合推理和行动的 AI Agent 模式。它内置了两个核心动作：start_action()和 stop_action()。使用预定义的流程来处理输入并生成输出，而非让用户完全自定义行为逻辑。</p>
<ul>
<li>start_action 接收输入并发送 ChatRequestEvent</li>
<li>stop_action 处理 ChatResponseEvent 并产生最终输出</li>
</ul>
<h6 data-id="heading-33">键控状态支持</h6>
<p>支持Flink的键控状态特性</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">review_analysis_res_stream</span> = (
    agents_env.from_datastream(
        <span class="hljs-attr">input</span>=product_review_stream, key_selector=lambda x: x.id
    )
    .apply(review_analysis_react_agent)
    .to_datastream()
)
</code></pre>
<h6 data-id="heading-34">LLM 集成优化</h6>
<p>ReActAgent 专门为 LLM 交互进行优化：内置了提示词管理和格式化功能；支持结构化输出模式，可以指定输出的数据schema；集成了错误处理策略，当LLM输出不符合预期格式时可以选择失败或者忽略。</p>
<h6 data-id="heading-35">资源管理方式</h6>
<p>ReActAgent 中自动添加默认资源，相比普通的Agent，ReActAgent 会自动为用户设置好必要的资源，简化使用流程。通过统一的资源管理系统与Flink集成。ReActAgent 通过 _DEFAULT_CHAT_MODEL 等常量引用在 AgentsExecutionEnvironment 中注册的资源。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">agents_env</span><span class="hljs-selector-class">.add_resource</span>(_DEFAULT_CHAT_MODEL, chat_model)
<span class="hljs-selector-tag">agents_env</span><span class="hljs-selector-class">.addResource</span>(<span class="hljs-string">"ollama_server"</span>, <span class="hljs-built_in">ResourceDescriptor</span>(...))
<span class="hljs-selector-tag">agents_env</span><span class="hljs-selector-class">.addResource</span>(<span class="hljs-string">"notify_shipping_manager"</span>, Tool.<span class="hljs-built_in">from_callable</span>(...))
</code></pre>
<h6 data-id="heading-36">类型信息处理</h6>
<p>Flink Agent能够处理Flink的类型系统</p>
<pre><code class="hljs language-scss" lang="scss">        if (outputSchema != null) {
            String jsonSchema;
            <span class="hljs-comment">// 支持RowTypeInfo和POJO类型</span>
            if (outputSchema instanceof RowTypeInfo) {
             <span class="hljs-comment">// 处理Row类型</span>
                jsonSchema = outputSchema<span class="hljs-selector-class">.toString</span>();
                outputSchema = new <span class="hljs-built_in">OutputSchema</span>((RowTypeInfo) outputSchema);
            } else if (outputSchema instanceof Class) {
             <span class="hljs-comment">// 处理POJO类型</span>
                try {
                    jsonSchema = mapper<span class="hljs-selector-class">.generateJsonSchema</span>((Class&lt;?&gt;) outputSchema)<span class="hljs-selector-class">.toString</span>();
                } catch (JsonMappingException e) {
                    throw new <span class="hljs-built_in">RuntimeException</span>(e);
                }
            } 
</code></pre>
<h6 data-id="heading-37">错误处理机制</h6>
<p>Flink 为 ReActAgent 实现了灵活的处理处理策略，运行用户选择在解析失败时抛出异常还是忽略错误。</p>
<pre><code class="hljs language-python" lang="python">        <span class="hljs-keyword">except</span> Exception:
            <span class="hljs-keyword">if</span> error_handling_strategy == ErrorHandlingStrategy.IGNORE:
                logging.warning(
                    <span class="hljs-string">f"The response of llm <span class="hljs-subst">{output}</span> doesn't match schema constraint, ignoring."</span>
                )
                <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">elif</span> error_handling_strategy == ErrorHandlingStrategy.FAIL:
                <span class="hljs-keyword">raise</span>
</code></pre>
<h6 data-id="heading-38">结构化输出支持</h6>
<p>Flink 为 ReActAgent 添加了结构化输出的能力，这样可以让 LLM 的输出符合预定义的数据结构，便于后续管理。</p>
<pre><code class="hljs language-ini" lang="ini">        if output_schema:
            if isinstance(output_schema, type) and issubclass(output_schema, BaseModel):
                <span class="hljs-attr">json_schema</span> = output_schema.model_json_schema()
            elif isinstance(output_schema, RowTypeInfo):
                <span class="hljs-attr">json_schema</span> = str(output_schema)
            else:
                <span class="hljs-attr">err_msg</span> = f<span class="hljs-string">"Output schema {output_schema.__class__} is not supported."</span>
                raise TypeError(err_msg)
            <span class="hljs-attr">schema_prompt</span> = f<span class="hljs-string">"The final response should be json format, and match the schema {json_schema}."</span>
            self._resources<span class="hljs-section">[ResourceType.PROMPT]</span><span class="hljs-section">[_DEFAULT_SCHEMA_PROMPT]</span> = (
                Prompt.from_text(<span class="hljs-attr">text</span>=schema_prompt)
            )
</code></pre>
<h6 data-id="heading-39">提示词模板系统</h6>
<p>Flink 实现了一个完整的提示词模板管理系统：</p>
<ul>
<li>支持字符串模板和消息列表模型</li>
<li>提供格式化功能，可以动态替换模板中的占位符</li>
<li>自动处理不同类型输入的转换</li>
</ul>
<h6 data-id="heading-40">工具调用集成</h6>
<p>Flink 将工具调用集成到 ReActAgent中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 注册工具资源</span>
    <span class="hljs-comment"># Add Ollama chat model connection and notify shipping manager tool to be used</span>
    <span class="hljs-comment"># by the Agent.</span>
    agents_env.add_resource(
        "ollama_server",
        ResourceDescriptor(<span class="hljs-attr">clazz</span>=OllamaChatModelConnection, request_timeout=<span class="hljs-number">120</span>),
    ).add_resource(
        "notify_shipping_manager", Tool.from_callable(notify_shipping_manager)
    )
    
<span class="hljs-comment"># 在Agent 中使用工具</span>
    <span class="hljs-comment"># Create react agent</span>
    <span class="hljs-attr">review_analysis_react_agent</span> = ReActAgent(
        <span class="hljs-attr">chat_model</span>=ResourceDescriptor(
            <span class="hljs-attr">clazz</span>=OllamaChatModelSetup,
            <span class="hljs-attr">connection</span>=<span class="hljs-string">"ollama_server"</span>,
            <span class="hljs-attr">model</span>=<span class="hljs-string">"qwen3:8b"</span>,
            <span class="hljs-attr">tools</span>=[<span class="hljs-string">"notify_shipping_manager"</span>],
        ),
        <span class="hljs-attr">prompt</span>=review_analysis_react_prompt,
        <span class="hljs-attr">output_schema</span>=ProductReviewAnalysisRes,
    )
</code></pre>
<h6 data-id="heading-41">运行时协作</h6>
<ul>
<li>执行环境负责调度和运行Agent中的各个组件</li>
<li>Agent通过RunnerContext 访问在环境中注册的资源</li>
<li>整个过程采用事件驱动的方式，通过发送和接收事件来推进执行流程</li>
</ul>
<h4 data-id="heading-42">3.3 典型执行流程</h4>
<p>对于 ReActAgent 来说，具体适配流程如下：</p>
<ul>
<li>环境初始化：通过 AgentsExecutionEnvironment.get_execution_environment(env) 获取适当的执行环境</li>
<li>资源配置：使用 addResource() 添加模型、工具等资源</li>
<li>输入设置：通过fromDataStream()、 fromTable()等设置输入源</li>
<li>Agent应用：使用 apply()方法应用Agent 逻辑</li>
<li>输出获取：通过 toDataStream() 获取处理后的 DataStream</li>
<li>执行：通过execute() 触发Flink作业执行</li>
</ul>
<p>典型的执行流程如下：</p>
<ul>
<li>run 函数接收到输入数据</li>
<li>创建InputEvent 并发送到事件队列</li>
<li>start_action处理InputEvent，格式化输入并发送 ChatRequestEvent</li>
<li>LLM处理后产生 ChatResponseEvent</li>
<li>stop_action 处理 ChatResponseEvent，解析结果并发送 OutputEvent</li>
<li>run 函数收集 OutputEvent 并返回结果</li>
</ul>
<p>关键特点是：</p>
<ul>
<li>事件驱动：使用事件队列驱动整个执行流程</li>
<li>上下文隔离：每个键值对应独立的执行上下文</li>
<li>异步支持：虽然本地执行环境回退到同步执行，但仍然支持异步接口</li>
<li>状态管理：通过 LocalRunnerContext 管理短期记忆和资源配置</li>
</ul>
<h4 data-id="heading-43">3.4 start_action 与 stop_action</h4>
<p><strong>整体流程特色</strong></p>
<p>这两个 action 构成完整的 ReAct 模式：</p>
<ul>
<li>开始-结束模式：start_action 作为入口，将原始输入转化为适合 LLM 处理的格式；stop_action 作为出口，将 LLM 响应转换为结构化输出。</li>
<li>中间处理透明化：用户无需关心中间步骤（如工具调用、上下文检索等），这些由内置的 CHAT_MODEL_ACTION、TOOL_CALL_ACTION 等自动处理。</li>
<li>可配置性：支持自定义 Prompt、输出 schema 定义及错误处理策略。</li>
</ul>
<p><strong>功能</strong></p>
<p>ReActAgent 的 start_action 与 stop_action 各具特征，二者分别承担对话的发起与终结职责。</p>
<ul>
<li>start_action 负责输入事件的处理。它首先接收 InputEvent，作为整个 Agent 流程的起点，可接受原始类型、复杂对象或 Row 等多种数据。若提供 Prompt，则以此格式化用户输入，将简单字符串或复杂对象（如 Row 或 POJO）的属性自动提取并填入模板。随后，系统自动追加 schema prompt，约束大模型输出结构，再将整理后的内容封装为 ChatRequestEvent，触发后续处理，默认调用 _DEFAULT_CHAT_MODEL 完成首次生成。</li>
<li>stop_action 则处理输出事件。它以 ChatResponseEvent 为输入，标志大模型生成完毕，是整个流程的终点。该动作支持按 schema 解析与验证返回结果，可将 JSON 文本转换为 Pydantic 模型或 RowTypeInfo 指定结构，并提供错误处理策略（忽略或抛出异常），保证输出类型安全与业务一致性。</li>
</ul>
<p><strong>与其他组件的协作</strong></p>
<p>在 ReActAgent 初始化时注册这两个 action：</p>
<pre><code class="hljs language-ini" lang="ini">self.add_action(
    <span class="hljs-attr">name</span>=<span class="hljs-string">"stop_action"</span>,
    <span class="hljs-attr">events</span>=[ChatResponseEvent],
    <span class="hljs-attr">func</span>=self.stop_action,
    <span class="hljs-attr">output_schema</span>=OutputSchema(output_schema=output_schema),
)
</code></pre>
<p>这两个 action 与 Agent 内置的其他 action（如工具调用、上下文检索）配合工作，在 ActionExecutionOperator 中形成一个完整的事件驱动处理链。</p>
<h4 data-id="heading-44">3.5 输入输出</h4>
<p>Flink Agent 的输入输出具有以下几个显著特点，并通过特定机制与Flink进行适配。</p>
<h5 data-id="heading-45">3.5.1 事件驱动架构</h5>
<p>Flink Agent 基于事件驱动模型，输入和输出都是通过事件对象进行传递：</p>
<ul>
<li>输入：通过InputEvent 封装原始数据</li>
<li>输出：通过OutputEvent封装处理结果</li>
<li>中间事件：包括 ChatRequestEvent、ChatResponseEvent、ToolRequestEvent、ToolResponseEvent等</li>
</ul>
<h5 data-id="heading-46">3.5.2 统一的数据封装</h5>
<p>所有数据都被封装成事件对象，便于Agent内部流转和处理。</p>
<h5 data-id="heading-47">3.5.3 支持多种数据类型</h5>
<p>输入支持多种数据类型：</p>
<ul>
<li>基本数据类型</li>
<li>Flink Row对象</li>
<li>POJO对象</li>
<li>复杂嵌套结果</li>
</ul>
<p>输出同样支持灵活的数据结构，可以通过schema进行约束</p>
<h5 data-id="heading-48">3.5.4 内置模板支持</h5>
<p>通过Prompt类支持模板化输入处理，可以定义复杂的提示词模板</p>
<h4 data-id="heading-49">3.6 模板系统</h4>
<p>模板可以用在提示词和Schema。Flink Agent 中的模板系统主要在 Prompt 类中实现，支持两种类型的模板：</p>
<h5 data-id="heading-50">3.6.1 字符串模板</h5>
<p>最基本的模板形式，就是一个包含占位符的字符串：</p>
<pre><code class="hljs language-ini" lang="ini">        String <span class="hljs-attr">specialTemplate</span> = <span class="hljs-string">"Handle special chars: {text} with symbols like @#$%^&amp;*()"</span><span class="hljs-comment">;</span>
        Prompt <span class="hljs-attr">specialPrompt</span> = new Prompt(specialTemplate)<span class="hljs-comment">;</span>

        Map&lt;String, String&gt; <span class="hljs-attr">specialVars</span> = new HashMap&lt;&gt;()<span class="hljs-comment">;</span>
        specialVars.put("text", "Hello &amp; Welcome!")<span class="hljs-comment">;</span>

        String <span class="hljs-attr">result</span> = specialPrompt.formatString(specialVars)<span class="hljs-comment">;</span>
</code></pre>
<h5 data-id="heading-51">3.6.2 消息模板</h5>
<p>更复杂的模板形式，包含多个 ChatMessage 对象，可以指定不同的角色。</p>
<pre><code class="hljs language-java" lang="java">        List&lt;ChatMessage&gt; multipleMessages =
                Arrays.asList(
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatMessage</span>(MessageRole.SYSTEM, <span class="hljs-string">"You are a helpful assistant."</span>),
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatMessage</span>(MessageRole.USER, <span class="hljs-string">"First message"</span>),
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatMessage</span>(MessageRole.ASSISTANT, <span class="hljs-string">"I understand"</span>),
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatMessage</span>(
                                MessageRole.USER, <span class="hljs-string">"Second message - this should be the response"</span>));

        <span class="hljs-type">Prompt</span> <span class="hljs-variable">multiPrompt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Prompt</span>(multipleMessages);
</code></pre>
<p>模板的管理流程如下：</p>
<ul>
<li>模板创建：用户创建 Prompt 对象，可以是字符串或消息列表。</li>
<li>变量替换：使用 formatString() 或者 formatMessages() 方法对传入变量映射进行替换</li>
<li>LLM 调用：格式化的消息被发送给LLM进行处理。</li>
</ul>

<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Prompt</span>(SerializableResource, ABC):
    <span class="hljs-string">"""Base prompt abstract."""</span>

    @<span class="hljs-built_in">staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">from_messages</span>(<span class="hljs-params">messages: <span class="hljs-type">Sequence</span>[ChatMessage]</span>) -&gt; <span class="hljs-string">"Prompt"</span>:
        <span class="hljs-string">"""Create prompt from sequence of ChatMessage."""</span>
        <span class="hljs-keyword">return</span> LocalPrompt(template=messages)

    @<span class="hljs-built_in">staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">from_text</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-string">"Prompt"</span>:
        <span class="hljs-string">"""Create prompt from text string."""</span>
        <span class="hljs-keyword">return</span> LocalPrompt(template=text)

    @abstractmethod
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_string</span>(<span class="hljs-params">self, **kwargs: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""Generate text string from template with additional arguments."""</span>

    @abstractmethod
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_messages</span>(<span class="hljs-params">
        self, role: MessageRole = MessageRole.SYSTEM, **kwargs: <span class="hljs-built_in">str</span>
    </span>) -&gt; <span class="hljs-type">List</span>[ChatMessage]:
        <span class="hljs-string">"""Generate list of ChatMessage from template with additional arguments."""</span>

    @<span class="hljs-built_in">classmethod</span>
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">resource_type</span>(<span class="hljs-params">cls</span>) -&gt; ResourceType:
        <span class="hljs-string">"""Get the resource type."""</span>
        <span class="hljs-keyword">return</span> ResourceType.PROMPT

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalPrompt</span>(<span class="hljs-title class_ inherited__">Prompt</span>):
    <span class="hljs-string">"""Prompt for a language model.

    Attributes:
    ----------
    template : Union[Sequence[ChatMessage], str]
        The prompt template.
    """</span>

    template: <span class="hljs-type">Sequence</span>[ChatMessage] | <span class="hljs-built_in">str</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_string</span>(<span class="hljs-params">self, **kwargs: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""Generate text string from template with input arguments."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(self.template, <span class="hljs-built_in">str</span>):
            <span class="hljs-keyword">return</span> format_string(self.template, **kwargs)
        <span class="hljs-keyword">else</span>:
            msgs = []
            <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.template:
                msg = <span class="hljs-string">f"<span class="hljs-subst">{m.role.value}</span>: <span class="hljs-subst">{format_string(m.content, **kwargs)}</span>"</span>
                <span class="hljs-keyword">if</span> m.extra_args <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(m.extra_args) &gt; <span class="hljs-number">0</span>:
                    msg += <span class="hljs-string">f"<span class="hljs-subst">{m.extra_args}</span>"</span>
                msgs.append(msg)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"\n"</span>.join(msgs)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_messages</span>(<span class="hljs-params">
        self, role: MessageRole = MessageRole.SYSTEM, **kwargs: <span class="hljs-built_in">str</span>
    </span>) -&gt; <span class="hljs-type">List</span>[ChatMessage]:
        <span class="hljs-string">"""Generate list of ChatMessage from template with input arguments."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(self.template, <span class="hljs-built_in">str</span>):
            <span class="hljs-keyword">return</span> [
                ChatMessage(role=role, content=format_string(self.template, **kwargs))
            ]
        <span class="hljs-keyword">else</span>:
            msgs = []
            <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> self.template:
                msg = ChatMessage(
                    role=m.role, content=format_string(m.content, **kwargs)
                )
                msgs.append(msg)
            <span class="hljs-keyword">return</span> msgs
</code></pre>
<h4 data-id="heading-52">3.7 FunctionTool 与 Action 的关联及注册机制</h4>
<p>在 Flink Agents 框架中，function tool 与 action 的联系和注册涉及多个组件和步骤。</p>
<h5 data-id="heading-53">3.7.1 实际转换流程</h5>
<p>具体的工具到 prompt 的转换过程如下：</p>
<ol>
<li>工具通过 @Tool 或 @tool 注册到执行环境中</li>
<li>在创建 ResourceDescriptor 时，通过 tools 参数引用这些已注册的工具</li>
<li>当聊天模型 setup 类（如 OllamaChatModelSetup）初始化时，它会获取这些工具的元数据（包括名称和描述）</li>
<li>这些工具信息会被自动整合到发送给 LLM 的系统 prompt 中，告知 LLM 有哪些可用工具及其用途</li>
</ol>
<p>这种方式使得开发者只需关注工具的定义和注册，而无需手动编写工具描述到 prompt 中，提高了开发效率并减少了出错可能性。</p>
<h6 data-id="heading-54">Function Tool 注册到 Agent</h6>
<p>Function tool 首先通过以下几种方式注册到执行环境中：</p>
<p><strong>方式一：使用装饰器</strong></p>
<pre><code class="hljs language-python" lang="python">    @tool
    @<span class="hljs-built_in">staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">notify_shipping_manager</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span>, review: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Notify the shipping manager when product received a negative review due to
        shipping damage.

        Parameters
        ----------
        id : str
            The id of the product that received a negative review due to shipping damage
        review: str
            The negative review content
        """</span>
        <span class="hljs-comment"># reuse the declared function, but for parsing the tool metadata, we write doc</span>
        <span class="hljs-comment"># string here again.</span>
        notify_shipping_manager(<span class="hljs-built_in">id</span>=<span class="hljs-built_in">id</span>, review=review)
</code></pre>
<p><strong>方式二：使用 add_resource 方法</strong></p>
<p>即，在执行环境注册工具资源。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-string">"""Calculate the sum of a and b.

    Parameters
    ----------
    a : int
        The first operand
    b : int
        The second operand

    Returns:
    -------
    int:
        The sum of a and b
    """</span>
    <span class="hljs-keyword">return</span> a + b

env.add_resource(<span class="hljs-string">"add"</span>, ResourceType.TOOL, add)
</code></pre>
<p><strong>方式三：在 Agent 构造函数中添加</strong></p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAgent</span>(<span class="hljs-title class_">Agent</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span></span>):
        <span class="hljs-variable language_">super</span>().__init__()
        <span class="hljs-variable language_">self</span>.add_resource(<span class="hljs-string">"add"</span>, add) <span class="hljs-comment"># 添加到 TOOL 类型资源中</span>
</code></pre>
<p><strong>方式四：在 ReActAgent 构建时候传入</strong></p>
<p>即，通过 tools 参数指定。</p>
<pre><code class="hljs language-csharp" lang="csharp">    <span class="hljs-comment">// Create ReAct agent.</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ReActAgent <span class="hljs-title">getReActAgent</span>()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ReActAgent(
                ResourceDescriptor.Builder.newBuilder(OllamaChatModelSetup.<span class="hljs-keyword">class</span>.getName())
                        .addInitialArgument(<span class="hljs-string">"connection"</span>, <span class="hljs-string">"ollamaChatModelConnection"</span>)
                        .addInitialArgument(<span class="hljs-string">"model"</span>, <span class="hljs-string">"qwen3:8b"</span>)
                        .addInitialArgument(
                                <span class="hljs-string">"tools"</span>, Collections.singletonList(<span class="hljs-string">"notifyShippingManager"</span>))
                        .build(),
                reviewAnalysisReactPrompt(),
                CustomTypesAndResources.ProductReviewAnalysisRes.<span class="hljs-keyword">class</span>);
    }
</code></pre>
<h6 data-id="heading-55">与模型交互</h6>
<p>Chat Model Setup 中引用工具</p>
<p>在创建 Chat Model Setup 时，通过 tools 参数指定要使用的工具列表：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chat_model_descriptor</span> = ResourceDescriptor(
<span class="hljs-attr">clazz</span>=OllamaChatModelSetup,
<span class="hljs-attr">connection</span>=<span class="hljs-string">"my_ollama_connection"</span>,
<span class="hljs-attr">model</span>=<span class="hljs-string">"qwen3:8b"</span>,
<span class="hljs-attr">tools</span>=[<span class="hljs-string">"notify_shipping_manager"</span>]   <span class="hljs-comment"># 引用已注册的工具</span>
)
</code></pre>
<h5 data-id="heading-56">3.7.2 AgentPlan 编译过程中工具的处理</h5>
<p>Flink Agents 内置了一个 TOOL_CALL_ACTION，，专门用于调用工具。TOOL_CALL_ACTION 与用户定义工具函数的联系主要依赖于：</p>
<ul>
<li>统一的命名系统：工具函数的名称作为唯一标识符</li>
<li>资源管理机制：通过 RunnerContext.get_resource() 方法按名称检索工具</li>
<li>标准化接口：所有工具都实现相同的 call() 接口</li>
<li>事件驱动架构：通过 ToolRequestEvent 和 ToolResponseEvent 传递调用信息</li>
</ul>
<p>这种设计使得系统可以在运行时动态地将 LLM 的工具调用请求路由到正确的用户定义函数，而无需硬编码具体的函数引用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10b743c522245efa77be063cdbd5f40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785387&amp;x-signature=zUSX9aNRZjT9qrG%2BHA7k8dzrn%2B4%3D" alt="3-1" loading="lazy"/></p>
<p>3-1</p>
<h6 data-id="heading-57">用户定义的 Function Tool 转换为 Action</h6>
<p>当 Agent 被编译成 AgentPlan 时，系统会收集所有资源（包括工具） ，这些工具会被转换为可执行的 Action：</p>
<ul>
<li>在 _get_resource_providers 函数中，识别带有 _is_tool 属性的资源</li>
<li>使用 from_callable 将函数转换为工具对象</li>
<li>工具被包装为 ResourceProvider 并存储在 AgentPlan 中，即通过 PythonSerializableResourceProvider 包装工具资源</li>
</ul>
<h6 data-id="heading-58">内置 Tool Call Action</h6>
<p>框架提供了一个内置的 TOOL_CALL_ACTION，专门用于调用工具：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">TOOL_CALL_ACTION</span> = Action(
    <span class="hljs-attr">name</span>=<span class="hljs-string">"tool_call_action"</span>,
    <span class="hljs-attr">exec</span>=PythonFunction.from_callable(process_tool_request),
    <span class="hljs-attr">listen_event_types</span>=[f<span class="hljs-string">"{ToolRequestEvent.__module__}.{ToolRequestEvent.__name__}"</span>],
)
</code></pre>
<p>对应Action 为ToolCallAction，其中 processToolRequest 函数会与用户自定义的工具函数相互关联。具体联系机制如下：</p>
<ul>
<li>命名匹配：当 LLM 决定调用某个工具时，它会在 tool_call 中指定工具名称（如 "notify_shipping_manager"）</li>
<li>资源查找：TOOL_CALL_ACTION 使用这个名称通过 ctx.get_resource(name, ResourceType.TOOL) 查找已注册的工具</li>
<li>动态调用：找到工具后，通过 tool.call(**kwargs) 调用用户定义的实际函数</li>
</ul>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolCallAction</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Action</span> <span class="hljs-title function_">getToolCallAction</span>() throws <span class="hljs-title class_">Exception</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Action</span>(
                <span class="hljs-string">"tool_call_action"</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaFunction</span>(
                        <span class="hljs-title class_">ToolCallAction</span>.<span class="hljs-property">class</span>,
                        <span class="hljs-string">"processToolRequest"</span>,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] {<span class="hljs-title class_">ToolRequestEvent</span>.<span class="hljs-property">class</span>, <span class="hljs-title class_">RunnerContext</span>.<span class="hljs-property">class</span>}),
                <span class="hljs-title class_">List</span>.<span class="hljs-title function_">of</span>(<span class="hljs-title class_">ToolRequestEvent</span>.<span class="hljs-property">class</span>.<span class="hljs-title function_">getName</span>()));
    }

    <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processToolRequest</span>(<span class="hljs-params">ToolRequestEvent event, RunnerContext ctx</span>) {
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Boolean</span>&gt; success = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; error = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">ToolResponse</span>&gt; responses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; externalIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; toolCall : event.<span class="hljs-title function_">getToolCalls</span>()) {
            <span class="hljs-title class_">String</span> id = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(toolCall.<span class="hljs-title function_">get</span>(<span class="hljs-string">"id"</span>));
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-keyword">function</span> = (<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;) toolCall.<span class="hljs-title function_">get</span>(<span class="hljs-string">"function"</span>);
            <span class="hljs-title class_">String</span> name = (<span class="hljs-title class_">String</span>) <span class="hljs-keyword">function</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"name"</span>);<span class="hljs-comment">// 获取工具名称</span>
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-variable language_">arguments</span> = (<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;) <span class="hljs-keyword">function</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"arguments"</span>); <span class="hljs-comment">// 获取工具参数</span>

            <span class="hljs-keyword">if</span> (toolCall.<span class="hljs-title function_">containsKey</span>(<span class="hljs-string">"original_id"</span>)) {
                externalIds.<span class="hljs-title function_">put</span>(id, (<span class="hljs-title class_">String</span>) toolCall.<span class="hljs-title function_">get</span>(<span class="hljs-string">"original_id"</span>));
            }

            <span class="hljs-title class_">Tool</span> tool = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 从上下文获取对应名称的工具资源</span>
                tool = (<span class="hljs-title class_">Tool</span>) ctx.<span class="hljs-title function_">getResource</span>(name, <span class="hljs-title class_">ResourceType</span>.<span class="hljs-property">TOOL</span>);
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                success.<span class="hljs-title function_">put</span>(id, <span class="hljs-literal">false</span>);
                responses.<span class="hljs-title function_">put</span>(
                        id, <span class="hljs-title class_">ToolResponse</span>.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"Tool %s does not exist."</span>, name)));
                error.<span class="hljs-title function_">put</span>(id, e.<span class="hljs-title function_">getMessage</span>());
            }

            <span class="hljs-keyword">if</span> (tool != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 调用用户实际工具</span>
                    <span class="hljs-title class_">ToolResponse</span> response = tool.<span class="hljs-title function_">call</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolParameters</span>(<span class="hljs-variable language_">arguments</span>));
                    success.<span class="hljs-title function_">put</span>(id, <span class="hljs-literal">true</span>);
                    responses.<span class="hljs-title function_">put</span>(id, response);
                } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                    success.<span class="hljs-title function_">put</span>(id, <span class="hljs-literal">false</span>);
                    responses.<span class="hljs-title function_">put</span>(
                            id, <span class="hljs-title class_">ToolResponse</span>.<span class="hljs-title function_">error</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"Tool %s execute failed."</span>, name)));
                    error.<span class="hljs-title function_">put</span>(id, e.<span class="hljs-title function_">getMessage</span>());
                }
            }
        }
        <span class="hljs-comment">// 返回工具响应事件</span>
        ctx.<span class="hljs-title function_">sendEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolResponseEvent</span>(event.<span class="hljs-title function_">getId</span>(), responses, success, error, externalIds));
    }
}
</code></pre>
<p>这个 action 监听 ToolRequestEvent 事件，并执行工具调用。调用完成后，将结果通过 ToolReponseEvent 返回。</p>
<pre><code class="hljs language-json" lang="json">    <span class="hljs-attr">"tool_call_action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_call_action"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"exec"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"func_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PythonFunction"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"flink_agents.plan.actions.tool_call_action"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"qualname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"process_tool_request"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"listen_event_types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"flink_agents.api.events.tool_event.ToolRequestEvent"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
</code></pre>
<h6 data-id="heading-59">TOOL_CALL_ACTION 如何编译到AgentPlan</h6>
<ul>
<li>
<p>在 AgentPlan.from_agent 方法中：</p>
<ul>
<li>当创建 AgentPlan 时，会收集所有动作，包括用户定义的动作和内置动作</li>
<li>代码中明确包含了内置动作： BUILT_IN_ACTIONS = [CHAT_MODEL_ACTION, TOOL_CALL_ACTION, CONTEXT_RETRIEVAL_ACTION]</li>
<li>在 _get_actions(agent) 函数中，这些内置动作会被添加到动作列表中</li>
</ul>
</li>
<li>
<p>具体编译过程：</p>
<ul>
<li>AgentPlan.from_agent() 方法调用 _get_actions(agent) 获取所有动作</li>
<li>_get_actions() 函数不仅提取用户定义的动作，还会包含 BUILT_IN_ACTIONS</li>
<li>这些动作随后被编译进 AgentPlan 的 actions 和 actions_by_event 字段中</li>
</ul>
</li>
<li>
<p>在最终的 AgentPlan 中：</p>
<ul>
<li>TOOL_CALL_ACTION 会作为一个普通的动作存在于 actions 映射中</li>
<li>它会监听 ToolRequestEvent 事件类型，并在该事件发生时被触发执行</li>
</ul>
</li>
</ul>
<p>因此，TOOL_CALL_ACTION 确实会被编译到 AgentPlan 中，作为处理工具调用的标准机制。当 LLM 决定调用工具时，会发出 ToolRequestEvent，然后 TOOL_CALL_ACTION 就会被触发来实际执行相应的工具调用。</p>
<h5 data-id="heading-60">3.7.3 工具调用流程</h5>
<p>整个流程中，工具不是直接绑定到 ActionExecutionOperator，而是通过 AgentPlan 中的资源提供者机制，在需要时动态获取和实例化。这种设计实现了工具与操作符的松耦合，同时支持多种类型的工具（Java、Python 等）。</p>
<ul>
<li>LLM 决定调用某个工具</li>
<li>TOOL_CALL_ACTION 内置动作被触发</li>
<li>通过 RunnerContext 获取对应工具资源</li>
<li>RunnerContextImpl.get_resource() 方法根据名称和类型查找工具资源</li>
<li>工具实际在需要时才通过 ResourceProvider 实例化</li>
<li>通过 ToolCallFunction 查找并执行相应的工具函数</li>
<li>结果作为新事件发送到事件队列</li>
</ul>
<h5 data-id="heading-61">3.7.4 完整流程图</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99228a1e1d084969a83ff0908b328971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767785387&amp;x-signature=3mZzrPDStpQ%2BHus6m0vgMTJNyks%3D" alt="3-2" loading="lazy"/></p>
<p>3-2</p>
<h5 data-id="heading-62">3.7.5 代码</h5>
<p>在 agent_plan.py中处理工具资源的代码如下：</p>
<pre><code class="hljs language-ini" lang="ini">        <span class="hljs-comment"># 识别工具资源并创建提供者</span>
        elif hasattr(value, "_is_tool"):
            if isinstance(value, staticmethod):
                <span class="hljs-attr">value</span> = value.__func__

            if callable(value):
                <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> support other tool type.</span>
                <span class="hljs-attr">tool</span> = from_callable(func=value)
                resource_providers.append(
                    PythonSerializableResourceProvider.from_resource(
                        <span class="hljs-attr">name</span>=name, resource=tool
                    )
                )
    <span class="hljs-comment"># 或者通过add_resource 添加的工具            </span>
    for name, tool in agent.resources<span class="hljs-section">[ResourceType.TOOL]</span>.items():
        resource_providers.append(
            PythonSerializableResourceProvider.from_resource(
                <span class="hljs-attr">name</span>=name, resource=from_callable(tool.func)
            )
        )                
</code></pre>
<p>总结来说，function_tool 通过资源注册机制与Agent关联，然后在编译阶段被转换为可序列化的资源提供者，最终通过内置的工具调用Action来执行。这种设计使得工具可以在分布式环境种正确传输和执行。</p>
<h3 data-id="heading-63">0xFF 参考</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fce101.mintlify.app%2Fcore-tech%2Fagent%237-2-5-multi-agent" target="_blank" title="https://ce101.mintlify.app/core-tech/agent#7-2-5-multi-agent" ref="nofollow noopener noreferrer">ce101.mintlify.app/core-tech/a…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F1959742114519844109%2Fanswer%2F1983526566437880277" target="_blank" title="https://www.zhihu.com/question/1959742114519844109/answer/1983526566437880277" ref="nofollow noopener noreferrer">www.zhihu.com/question/19…</a></p>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[极其矛盾又顺其自然的2025]]></title>    <link>https://juejin.cn/post/7589838714449838121</link>    <guid>https://juejin.cn/post/7589838714449838121</guid>    <pubDate>2025-12-31T11:39:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714449838121" data-draft-id="7588043318358589475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="极其矛盾又顺其自然的2025"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-31T11:39:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神说要有光_zy"/> <meta itemprop="url" content="https://juejin.cn/user/4230576475736749"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            极其矛盾又顺其自然的2025
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576475736749/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神说要有光_zy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T11:39:41.000Z" title="Wed Dec 31 2025 11:39:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>站在2025年的末尾回望，这一年是我人生轨迹中极具里程碑意义的一年，诸多维度的成长与蜕变交织，让每一段时光都格外厚重。</p>
<ul>
<li>从职业维度看，我今年除开前端开发接触到另外的项目或是偏管理的方向，纵然是天天瞎忙，最终交出了满意的绩效答卷；</li>
<li>从身份维度讲，我结束了一人吃饱全家不饿的状态步入了婚姻，再到即将拥抱新生命的准父母的迭代，肩上多了责任，心中满是温暖；</li>
<li>从生活维度而言，圆满落地婚礼筹备等人生大事，在柴米油盐的琐碎与期许中，收获了满溢的幸福与前行的力量。这一年，每一步都走得踏实坚定，每一份成长都值得铭记。</li>
</ul>
<h2 data-id="heading-0">一、职业维度：技术和管理的矛盾点</h2>
<h3 data-id="heading-1">（一）核心工作任务落地</h3>
<p>2025年的工作，由于前领导的调动，我也算是步入了代管的模式，体验到管理的矛盾，虽然最后没有上管理层，我确实太嫰了，很多事情考虑得不成熟，明年再战</p>
<h3 data-id="heading-2">（二）日常工作与协作成果</h3>
<p>...待写</p>
<h3 data-id="heading-3">（三）技术学习与能力提升</h3>
<p>...待写</p>
<h3 data-id="heading-4">（四）绩效成果与职业认可</h3>
<p>...待写</p>
<h2 data-id="heading-5">二、人生进阶：以爱筑家，迎接新生命的期待</h2>
<p>如果说工作是我安身立命的底气，那2025年的家庭生活，便是我内心最温暖的支撑。这一年，我和爱人最核心的任务，就是筹备我们的婚礼。从挑选场地、确定流程，到敲定细节、邀请亲友，每一个环节都充满了琐碎，却也藏着满满的幸福。印象最深的是婚礼前一周的紧张筹备，我们一起熬夜核对流程表，一起去采购最后的装饰用品，累的时候互相打气，分歧的时候耐心沟通。这个过程让我深刻体会到，婚姻不是简单的“搭伙过日子”，而是两个独立的人，为了共同的未来，学会包容、懂得分担。</p>
<p>更让人欣喜的是，婚礼结束后不久，我们迎来了新的小生命——怀孕的喜讯让这个小家庭多了一份沉甸甸的期待。得知消息的那一刻，除了惊喜，更多的是一种“责任觉醒”。从前我是被父母呵护的孩子，如今即将成为父母，这份身份的转变让我更加成熟。这几个月里，我和爱人一起学习孕期知识，一起为宝宝准备小衣服、小玩具，一起调整生活作息，戒掉了熬夜、挑食的坏习惯。看着爱人日渐隆起的小腹，我越发明白，所谓“家庭”，就是用爱维系，用责任支撑，为彼此遮风挡雨，也为新生命的到来积蓄力量。</p>
<h2 data-id="heading-6">三、年度感悟：责任与幸福并行，成熟是最好的收获</h2>
<p>回望2025年，最深刻的感悟是：成熟从来不是一蹴而就的瞬间，而是在工作的磨砺与生活的滋养中，慢慢沉淀的状态。工作上，绩效不错的背后，是日复一日的深耕与坚持，让我懂得“专业”是立足的根本；生活里，结婚与怀孕的经历，让我明白“责任”是幸福的基石。从前做事更多考虑自己的喜好，如今会不自觉地把家人的需求、未来的规划放在前面；从前面对工作难题容易焦虑，如今更懂得冷静分析、主动协调，这些转变，都是2025年最宝贵的收获。</p>
<p>感谢这一年里，领导和同事对我的认可与帮助，让我在职业道路上少走了很多弯路；感谢爱人的陪伴与包容，让我在组建家庭的过程中感受到满满的温暖；更感谢父母的支持与关怀，成为我最坚实的后盾。</p>
<h2 data-id="heading-7">二、家庭维度：以爱筑家，见证身份迭代与幸福积淀</h2>
<h3 data-id="heading-8">（一）婚礼筹备：细节里的责任与包容</h3>
<p>2025年家庭生活的核心重心之一，是与爱人共同筹备一场温馨且有意义的婚礼。整个筹备过程历时6个月，拆解为5大核心阶段，逐一落地推进：1. 前期规划阶段（3-4月）：共同调研10+家婚礼场地，结合预算、交通、场地风格等因素，最终选定兼具私密性与仪式感的户外草坪场地；同步确定婚礼主题为“温暖同行”，明确核心流程与预算分配。2. 细节筹备阶段（5-7月）：分工协作完成婚纱礼服挑选、婚纱照拍摄、喜帖设计与发送、宾客名单梳理等事项；我主要负责对接婚庆公司，确认场地布置、流程策划、灯光音响等细节，前后沟通调整方案8次，确保每一个环节符合预期。3. 冲刺收尾阶段（婚礼前1周）：与爱人一起熬夜核对流程表、确认宾客到场信息、采购装饰用品与伴手礼；面对时间紧张、细节繁琐的压力，我们学会了高效沟通、互相包容，比如在流程顺序上有分歧时，通过梳理双方核心诉求，最终达成共识。4. 婚礼落地阶段：顺利举办婚礼，完成从情侣到夫妻的身份转变，在亲友的祝福中，深刻体会到“家庭”的初始含义——是陪伴，是分担，是共同奔赴未来的约定。</p>
<h3 data-id="heading-9">（二）孕期准备：期待中的责任觉醒</h3>
<p>婚礼结束后1个月，我们迎来了意外又惊喜的消息——爱人怀孕。这份喜讯让小家庭多了一份沉甸甸的期待，也让我完成了从“丈夫”到“准爸爸”的心态转变：1. 知识储备：与爱人一起报名孕期课程3期，系统学习孕早期护理、孕期营养、胎儿发育、分娩准备等知识；日常通过母婴APP、专业书籍补充育儿常识，每周固定1个晚上交流学习心得，解答彼此的困惑。2. 物质准备：共同挑选并采购孕期用品与宝宝用品，包括孕妇枕、防辐射服、宝宝婴儿床、衣物、奶粉、纸尿裤等；每一件物品都精心对比材质、安全性与实用性，在这个过程中，慢慢构建起对“为人父母”的具象认知。3. 生活调整：为适配孕期需求，主动调整生活作息，戒掉熬夜、吃夜宵的习惯，每天早起陪爱人散步30分钟；学习简单的孕期营养餐做法，每周至少3次为爱人准备早餐与晚餐，保障孕期营养均衡。4. 情绪陪伴：关注爱人孕期情绪变化，主动分担家务（如打扫卫生、洗衣服、采购食材），减少她的劳累；在她出现焦虑情绪时，耐心倾听、及时疏导，用陪伴给予安全感。看着爱人日渐隆起的小腹，我越发明白，“父亲”的身份意味着责任与担当，未来会用更多的付出，守护家人的健康与幸福。</p>
<h3 data-id="heading-10">（三）家庭关系维系：温暖中的互相支撑</h3>
<p>这一年，我也更加注重维系与双方父母的关系：1. 日常陪伴：每周固定给双方父母打1次电话，分享生活近况与孕期消息；节假日抽时间回家陪伴父母，比如端午、中秋假期，带着爱人一起回家吃饭、聊天，增进彼此的感情。2. 需求响应：主动关心父母的身体状况，为父母购买体检套餐，陪他们完成体检；针对父母不熟悉的智能设备使用问题，耐心讲解操作方法，解决他们的日常不便。3. 家庭协同：在婚礼筹备、孕期准备过程中，主动征求父母的意见，感谢他们的支持与帮助；比如婚礼场地的选择、孕期营养的搭配，都参考了父母的经验，让家庭关系更加融洽。</p>
<h3 data-id="heading-11">往年总结回顾</h3>
<p>2024：<a href="https://juejin.cn/post/7461207721874915368" target="_blank" title="https://juejin.cn/post/7461207721874915368">juejin.cn/post/746120…</a></p>
<p>2023：<a href="https://juejin.cn/post/7317095140040671258" target="_blank" title="https://juejin.cn/post/7317095140040671258">juejin.cn/post/731709…</a></p>
<p>2022：<a href="https://juejin.cn/post/7182551051579424827" target="_blank" title="https://juejin.cn/post/7182551051579424827">juejin.cn/post/718255…</a></p>
<p>2021：<a href="https://juejin.cn/post/7041117772968886285" target="_blank" title="https://juejin.cn/post/7041117772968886285">juejin.cn/post/704111…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[老王请假、客户开喷、我救火：一场递归树的性能突围战]]></title>    <link>https://juejin.cn/post/7589093895327531017</link>    <guid>https://juejin.cn/post/7589093895327531017</guid>    <pubDate>2025-12-30T00:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093895327531017" data-draft-id="7589093895326220297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老王请假、客户开喷、我救火：一场递归树的性能突围战"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2025-12-30T00:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不一样的少年_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老王请假、客户开喷、我救火：一场递归树的性能突围战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不一样的少年_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:04:20.000Z" title="Tue Dec 30 2025 00:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    786
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言：</h2>
<blockquote>
<p>上周，负责核心业务组件的同事老王突然请假（据说去相亲了），留下一堆代码和风中凌乱的我。</p>
<p>结果前脚刚走，后脚核心客户就炸锅了：“你们这个系统怎么回事？我每次要给员工赋个权，浏览器就直接卡死！打开弹窗挺快，一点开部门就未响应，关掉弹窗还要卡半天！”</p>
<p>看着客户发来的 <strong>十几秒卡顿录屏</strong>，和老板投来的“和善”目光，我只能硬着头皮接下了这个“锅”。</p>
<p>本文记录了我是如何从吐槽同事代码，到深度排查，最终通过<strong>深度优化</strong>解决这个 <strong>递归组件性能灾难</strong>的全过程。</p>
</blockquote>
<p><strong>省流版</strong></p>
<ul>
<li><strong>现象</strong>：展开树卡 10s+，关闭弹窗再卡 5s</li>
<li><strong>根因</strong>：递归组件隐式全量挂载 + 多实例并发导致 rAF 任务在单帧扎堆 + 高成本 height变化动画</li>
<li><strong>方案</strong>：懒加载可见节点 + 以“藏”代“删”（opacity/v-show）+ 合成层优化 (transform: scaleY)</li>
</ul>
<p><strong>看完本文，你将掌握</strong></p>
<ol>
<li>
<p><strong>性能侦探能力</strong>：如何用 Performance 面板精准定位 Long Task 的“底层元凶”（不只是看红条）。</p>
</li>
<li>
<p><strong>分帧渲染陷阱</strong>：为什么你写的 <code>requestAnimationFrame</code> 可能会让页面更卡？（含深度图解）。</p>
</li>
<li>
<p><strong>高性能交互与动画</strong>：利用合成线程进行优化，绕过主线程的样式计算/布局/绘制阶段，实现 0 重排的丝滑展开/收起与销毁</p>
</li>
</ol>
<h2 data-id="heading-1">一、 客户现场还原（案发经过）</h2>
<p>授权弹窗虽然实现了秒开，但一旦点击展开根节点，瞬间卡死，足足卡顿数秒后才渲染出子节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17bc9a2b51ae4092961705ccbd77aa8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=waSf%2Fr7zPsXVtDqCBq6nZA%2B8a2U%3D" alt="组织架构树响应慢问题排查.gif" loading="lazy"/></p>
<h3 data-id="heading-2">业务背景</h3>
<p>客户正在使用我们的 <strong>“企业级权限管理系统”</strong> 。</p>
<p>出问题的组件是一个核心的 <strong>组织架构选择器（TreeSelect）</strong> ，它被嵌入在一个高频使用的 <strong>“授权弹窗”</strong> 中。</p>
<ul>
<li>
<p><strong>高频场景</strong>：管理员需要频繁地给不同的员工或部门分配权限。</p>
</li>
<li>
<p><strong>操作路径</strong>：点击“可见范围” → 弹出授权弹窗 → 在树形组件中找到对应部门/人员 → 勾选 → 确定/关闭。</p>
</li>
</ul>
<h3 data-id="heading-3"><strong>数据规模</strong></h3>
<p>该客户是中大型企业，全量组织架构节点约为 <strong>2700 个</strong>（包含多级部门和人员）。这个数量级在 ToB 业务中其实不算特别大，但足以压垮未经优化的代码。</p>
<h3 data-id="heading-4"><strong>故障现象</strong></h3>
<ol>
<li>
<p><strong>打开弹窗（快）</strong> ：点击授权按钮，弹窗秒出（老王用了分帧渲染进行首屏优化，这点挺好）。</p>
</li>
<li>
<p><strong>寻找部门（卡死）</strong> ：管理员试图展开根部门去寻找下级单位，点击小三角的瞬间，界面失去响应，<strong>Long Task 持续 10s+</strong> 。管理员以为死机了，疯狂点击，结果还是没反应。</p>
</li>
<li>
<p><strong>关闭/取消（卡死）</strong> ：好不容易选完了，点击“确定”或“关闭”弹窗，界面再次假死 <strong>4-5s</strong>，才能关掉弹窗。</p>
</li>
</ol>
<h2 data-id="heading-5">二、 深度侦查：谁在谋杀主线程？</h2>
<blockquote>
<p><strong>工程化思考：线上监控能发现吗？</strong></p>
<p>Sentry 或其它性能监控能抓到这个问题吗？</p>
<p>线上监控通常只能告诉你 <strong>“页面卡了”</strong>（监控到 <code>Long Task</code> 或 <code>INP</code> 指标飙升），但很多时候难告诉你具体的 <strong>“为什么卡”</strong>。
要确诊是 JS 逻辑阻塞，还是 CSS 动画引发的 <strong>Reflow (重排)</strong>，必须依赖本地 Chrome DevTools 的 <strong>Performance 面板</strong> 进行“CT 扫描”。</p>
<p><strong>💡 小贴士：如何使用 Performance？</strong>
打开 F12 开发者工具 -&gt; 切换到 <strong>Performance</strong> 面板 -&gt; 点击左上角“圆点”开始录制 -&gt; 在页面操作复现卡顿 -&gt; 点击 Stop 停止，即可生成分析报告。</p>
</blockquote>
<p>我在本地 Mock 了 2700 条左右的数据，模拟了“打开 -&gt; 展开 -&gt; 关闭”的全流程，打开 Chrome <strong>Performance</strong> 一看，好家伙，红得跟过年一样。</p>
<h3 data-id="heading-6">第一步：看“心电图” (Performance 面板)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff9b545e34554c48a71ec5107d921eec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=CPaxgB3kN50RJAuPvzCagpWgdss%3D" alt="image.png" loading="lazy"/></p>
<p><strong>现象</strong>：</p>
<blockquote>
<p>很多人看到 Performance 密密麻麻的图表就头晕，其实诀窍就一句话：<strong>从上往下看</strong>。</p>
<ol>
<li><strong>看顶部</strong>（Main 线程）：<strong>红色</strong>的色块代表 <strong>Long Task</strong>（长任务），是导致页面卡顿的直接元凶。</li>
<li><strong>看中间</strong>（调用栈）：像倒置的火焰一样，<strong>越宽</strong>代表耗时越久，<strong>越往下</strong>代表函数调用越深。</li>
<li><strong>找凶手</strong>：顺着红条往下找，最底下的那个“宽条条”，通常就是罪魁祸首。</li>
</ol>
</blockquote>
<p><strong>颜色图例（快速看懂图）</strong></p>
<ul>
<li>红色斜纹：Long Task，主线程连续超 50ms</li>
<li>黄色：JavaScript 执行（事件、定时器、requestAnimationFrame）</li>
<li>紫色：样式与布局（Recalculate Style、Layout）</li>
<li>绿色：绘制与合成（Paint、Composite）</li>
<li>看到“Animation Frame Fired + Run Microtasks”连续出现，通常是每帧都在做很多 JS，并在帧内清空 Promise/nextTick，导致超预算</li>
</ul>
<p><strong>回到本案分析</strong>：</p>
<ol>
<li>
<p><strong>顶部报警</strong>：最显眼的是一条红色斜纹带，说明主线程一直处于阻塞状态。</p>
</li>
<li>
<p><strong>中间密集</strong>：顺着红色区域往下看，全是密密麻麻的黄色小条，提示 <code>Animation Frame Fired</code>（动画帧<code>requestAnimationFrame</code>触发）。</p>
</li>
<li>
<p><strong>底部实锤</strong>：继续顺着调用栈 <strong>从上往下</strong> 找，能看到频繁的 <code>cloneNode</code>（克隆节点）调用。这说明核心耗时在 DOM 操作，浏览器在不断创建新元素。</p>
</li>
</ol>
<p><strong>结论</strong>：核心耗时在 DOM 操作，浏览器在疯狂加班造 DOM。<code>cloneNode</code> 就像是在复印文件，这说明代码在<strong>没完没了地制造新的页面元素</strong>，而且是一刻不停地在造，直接把主线程干趴下了。</p>
<h3 data-id="heading-7">第二步：顺藤摸瓜 (找代码)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d00c4d1ccee4e14a3f45a0f46d35185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=ejfbRpzzsWDjYpMo7iRbVcqBDqU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>线索</strong>：
Performance 面板明确指出了凶手是 <code>ReSubMenu.vue</code> 里的 <code>renderVisibleData</code> 函数。</p>
<p><strong>代码长这样</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这是一个分帧渲染函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleData</span>(<span class="hljs-params">data, index = <span class="hljs-number">0</span></span>) {
  <span class="hljs-comment">// 1. 先渲染一小部分（比如 20 个）</span>
  visibleChildrenData.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(...data.<span class="hljs-title function_">slice</span>(index, index + <span class="hljs-number">20</span>));

  <span class="hljs-comment">// 2. 如果还有数据没渲染完，申请下一帧接着干</span>
  <span class="hljs-keyword">if</span> (还剩有数据) {
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">renderVisibleData</span>(data, index + <span class="hljs-number">20</span>) <span class="hljs-comment">// &lt;--- 案发地点！</span>
    })
  }
}
</code></pre>
<p><strong>原本的算盘</strong>：
写这段代码的初衷是好的——试图利用 <strong>“分帧渲染”</strong> 技术来优化 <strong>首屏渲染体验</strong>，<strong>不想让用户盯着白屏干等整棵树渲染完才看到，而是让第一帧渲染出的节点立刻显示给用户看</strong>。</p>
<p>也就是代码里表达的意思：“浏览器大哥，您别急，先给用户看 20 个解解馋，剩下的咱们每帧画 20 个，慢慢来。”</p>
<blockquote>
<p><strong>💡 知识点：什么是分帧渲染？</strong></p>
<p>浏览器的渲染就像一条流水线，比如我们的屏幕刷新率是 60Hz，那么屏幕每秒钟能刷新 60 次（即 60FPS），这样画面才流畅。这意味着每一帧的时间只有 <strong>16.6ms</strong> (1000ms / 60 ≈ 16.66ms)。</p>
<p>如果你一口气要在页面上画几千个节点，需要耗时就不止 16 毫秒。在渲染这几千个节点的过程中，浏览器的主线程被完全霸占，这时候浏览器就没空理会用户的点击、滚动，这就叫 <strong>“掉帧”</strong> 或 <strong>“卡死”</strong>。</p>
<p><code>requestAnimationFrame</code> (rAF) 就是为了解决这个问题。它的作用是：<strong>“把大任务切碎”</strong>。</p>
<p>这里的逻辑是：</p>
<ol>
<li>这一帧，我先画 20 个节点，让用户 <strong>立刻看到东西</strong>（减少首屏等待）。</li>
<li>剩下的数据，我预约在 <strong>“下一帧”</strong> (<code>requestAnimationFrame</code>) 再慢慢画。</li>
<li>这样，既能快速展示内容，又能让浏览器每一帧都有空闲时间去响应用户的操作。</li>
</ol>
</blockquote>
<p><strong>但奇怪的是，明明已经用了分帧渲染，为什么 Performance 面板里还是满屏红色的 Long Task？为什么点击展开时浏览器依然卡死了？</strong></p>
<p>这就得说到那个被忽略的致命细节了……“分帧失效”的真正原因，请看下面的第三步</p>
<h3 data-id="heading-8">第三步：真相大白 (逻辑漏洞)</h3>
<p><strong>问题出在哪？</strong>
看似优雅的“慢慢来”，忽略了一个致命的前提：<strong>递归组件的叠加效应</strong>。</p>
<p>我们的树形组件结构大概是这样的（典型的无限套娃）：</p>
<ul>
<li>入口 (AuthorizedMenu.vue)
<ul>
<li>TreeSelect (外层容器)
<ul>
<li>ReSubMenu (递归的开始)
<ul>
<li>SubMenu (动画/折叠)
<ul>
<li>MenuItem (节点项)</li>
<li>ReSubMenu (子节点 -&gt; 套娃开始)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>这意味着，如果你的树数据有 5 层深，组件就会自己把自己嵌套 5 层。</p>
<p>我又看了一眼负责展开收起菜单动画的父组件 <code>SubMenu.vue</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 这里只用了 CSS 控制高度来折叠，没有用 v-if --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subItem"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: ... }"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>案情还原</strong>：</p>
<ol>
<li>
<p><strong>看不见的“大军”</strong>：
界面上菜单虽然是收起的，但因为没加 <code>v-if</code> 控制按需加载，<strong>整棵树 2700 多个节点其实都在后台悄悄挂载了</strong>。这就好比你只点了一盘花生米，后厨却把满汉全席都备好了。</p>
</li>
<li>
<p><strong>分帧策略失效</strong>：
老王的“分帧渲染”本意是好的：“大家别急，排好队，一帧画 20 个。”
但在递归组件中，<strong>几百个非叶子组件实例是同时启动的</strong>。</p>
</li>
<li>
<p><strong>菜市场效应</strong>：</p>
<ul>
<li>第一层组件喊：“浏览器老师，麻烦帮我画 20 个！”</li>
<li>第二层组件也喊：“我也要画 20 个！”</li>
<li>第 N 层组件齐声喊：“还有我！还有我！”</li>
</ul>
</li>
</ol>
<p><strong>结果</strong>：浏览器瞬间懵了。虽然每个人只请求画 20 个，但这几百个组件同时请求，瞬间就堆积了几千个 <code>cloneNode</code> 任务。这就好比几百只鸭子同时在叫，主线程直接被<strong>高并发的 DOM 操作</strong>给冲垮了。</p>
<p><em><strong>你可能会问：“JS 不是单线程的吗？不是按顺序执行吗？怎么会‘并发’呢？”</strong></em></p>
<ul>
<li>
<p>没错，JS 是单线程。但问题在于，<strong>Vue 的 <code>v-for</code> 循环是同步执行的</strong>。</p>
</li>
<li>
<p>Vue 的机制是：必须等 <code>v-for</code> 这一轮循环彻底跑完，所有的子组件都初始化完毕（<code>setup</code> 执行结束），才会把控制权交还给浏览器去进行样式计算和绘制。</p>
</li>
<li>
<p>这就导致了一个严重的后果：</p>
<ul>
<li>树组件中的所有节点（尤其是有子级的非叶子节点）在这一轮同步循环中，<strong>都启动了自己的分帧渲染逻辑</strong>，纷纷向浏览器申请：“下一帧请运行我的渲染回调”。</li>
</ul>
</li>
</ul>
<p>过程拆解如下：</p>
<ol>
<li>
<p><strong>同步初始化</strong>：
Vue 遇到递归结构时，会<strong>一口气同步创建所有子组件实例</strong>。假设有 100 个子菜单，Vue 就会同步执行 100 次 <code>setup</code> 函数，中间不会停顿。</p>
</li>
<li>
<p><strong>集体预约分帧渲染</strong>：
这 100 个组件在初始化时，都立刻启动了自己的分帧渲染逻辑，<strong>每个人</strong>都向浏览器申请了：“下一帧请运行我的渲染函数”。</p>
</li>
<li>
<p><strong>扎堆执行</strong>：
到了下一帧，浏览器一看 <code>requestAnimationFrame</code> 的任务队列——好家伙，里面整整齐齐排了 100 个回调任务！
虽然 JS 是挨个执行这些任务的，但它必须<strong>把这 100 个回调任务全部跑完</strong>才能去刷新屏幕。</p>
</li>
</ol>
<p><strong>最终结果就是</strong>：</p>
<ul>
<li><strong>理想情况</strong>：1 个组件分帧 → 每帧耗时 2ms左右 → ✅ <strong>丝滑流畅</strong></li>
<li><strong>实际情况</strong>：100 个组件在<strong>同一帧</strong>里扎堆干活 → 总耗时 &gt; 200ms → ❌ <strong>严重掉帧 (Long Task)</strong></li>
</ul>
<p>这才是“分帧失效”的真正原因：<strong>同一帧的 rAF 回调队列被大量组件“同时”塞满，导致单帧工作量远远超出 16.66ms 的预算。</strong></p>
<p>这也完美解释了为什么 <strong>Performance 火焰图</strong> 顶部会出现那条显眼的 <strong>红色长条</strong> —— 它不仅仅是一个长任务，而是 <strong>n 多个组件中的分帧回调在这一帧内“排队”连续执行所耗费的总时长</strong>。</p>
<p><em><strong>你可能会有疑问：“rAF 不是宏任务吗？不应该是执行一个歇一下吗？”</strong></em></p>
<ul>
<li>
<p><strong>关键误区就在这！</strong>
准确地说，<code>requestAnimationFrame</code> 的回调<strong>不属于</strong>我们常说的“宏任务队列 (Macrotask Queue)”，它有自己独立的 <strong>“动画帧回调队列”</strong>。
根据 HTML 事件循环标准，这个队列的执行时机非常特殊：它夹在 <strong>“JS 执行”</strong> 和 <strong>“样式计算/布局”</strong> 之间。</p>
</li>
<li>
<p><strong>致命的“批次执行”机制：</strong>
浏览器在这一帧的渲染更新阶段会<strong>连续执行</strong>本帧的所有 rAF 回调，执行完才进入样式/布局。也就是说，如果同一帧登记了 100 个 rAF，它们会在本帧内<strong>连续跑完</strong>，而不是留到后续帧。</p>
<ul>
<li><code>注</code>：浏览器在刷新屏幕前会<strong>清空本帧的 rAF 队列</strong>，整体表现为一段连续的脚本执行；<strong>若本帧总耗时超过 50ms，就会被标记为 Long Task</strong>（否则只是普通task片段，不显示红条）。</li>
</ul>
</li>
</ul>
<p>在我们的场景里，这段连续执行远超 50ms，所以 DevTools 顶部标记为 <strong>Long Task</strong>。</p>
<p>为了更直观地理解，我画了一张图来解释下：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/730a3f51d72349ae834bc6feb956ee9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=GCeS7yb9Zl4j%2BvyJJ3tS%2FbqnGV8%3D" alt="image.png" width="100%" loading="lazy"/>
<h2 data-id="heading-9">三、 紧急救援：学会“偷懒”</h2>
<p>吐槽归吐槽，Bug 还是得修。解决办法就是三个字：<strong>懒加载</strong>。</p>
<h3 data-id="heading-10">核心逻辑</h3>
<p>看不见的菜单，坚决不渲染！
只有当用户点击“展开”按钮那一刻，我才开始去渲染子菜单。</p>
<h3 data-id="heading-11">代码改动</h3>
<p>把原来的“一上来就渲染”改成“盯着开关看”：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ReSubMenu.vue</span>

<span class="hljs-comment">// 只有当 isExpand (展开状态) 变成 true 时，才开始干活</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">data</span>.<span class="hljs-property">isExpand</span>,
  <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (val) {
      <span class="hljs-comment">// 只有展开时，且之前没渲染过，才启动分帧渲染</span>
      <span class="hljs-keyword">if</span> (visibleChildrenData.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">renderVisibleData</span>(props.<span class="hljs-property">data</span>?.<span class="hljs-property">children</span>)
      }
    } <span class="hljs-keyword">else</span> {
       visibleChildrenData.<span class="hljs-property">value</span> = []
    }
  },
  { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }
)
</code></pre>
<h3 data-id="heading-12">遗留问题：关闭弹窗卡死</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45ffac7e3c6347a194162776075dbcf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=6N5IJ%2FQwNq5JPOLMeyazUoEzZqI%3D" alt="关闭弹窗慢问题排查.gif" loading="lazy"/></p>
<p>客户之前反馈“关闭弹窗也卡”，是因为同事老王的代码让组件一开始加载了几千个节点，内存中就堆积了几千个复杂的组件实例。</p>
<p>点击关闭弹窗的那一刻，主线程被 GC（垃圾回收）和 Vue组件的卸载任务（<code>beforeUnmount</code> / <code>unmounted</code>等）瞬间挤爆。</p>
<p><strong>截图证据</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab91d8f2cafb4611be722bef22218fbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=%2FnAbQCEh%2FkAJP4LLbKzte%2FYdQ70%3D" alt="image.png" loading="lazy"/></p>
<p>大家看这张截图，关闭弹窗的一瞬间，<code>removeChild</code> 操作竟然耗时 <strong>5.41s</strong>！这意味着浏览器主线程被这个巨大的“拆迁工程”彻底堵死，用户只能对着屏幕发呆。</p>
<h2 data-id="heading-13">四、 深度优化方案</h2>
<p>单纯的懒加载解决了“初始化”问题，但为了达到极致体验，我们还引入了其他维度的优化。</p>
<h3 data-id="heading-14">1.  渲染性能优化：用 ScaleY 替代 Height 动画</h3>
<p><strong>排查</strong>：</p>
<ul>
<li>
<p>我看了下 CSS，菜单的展开/收起是用 <code>transition: height</code> 做的“窗帘”效果。</p>
</li>
<li>
<p>每一级菜单都是改高度 <code>height</code>（收起为 0，展开为节点内容高度）。</p>
</li>
<li>
<p><code>height</code> 是布局属性，动它就会触发 <code>Reflow</code>（重排），浏览器需要把受影响的布局链路重新算一遍。</p>
</li>
<li>
<p>递归树会层层传导：你点开一层会牵动下面整段子树一起算，链路很长，低端机分分钟卡住</p>
</li>
</ul>
<p><strong>展开节点卡顿现象图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d525c3b276149d68df6b57e439876f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=Dugn0VN2343QrzEejbQrKHTp4CM%3D" alt="展开菜单卡顿.gif" loading="lazy"/></p>
<p><strong>优化</strong>：
改为使用 CSS3 的 <code>transform: scaleY</code>，同样可以达到丝滑展开的效果。</p>
<p><strong>简单理解 使用ScaleY实现展开动画效果的原理</strong>：</p>
<ul>
<li><strong>变的是什么？</strong> <code>scaleY</code> 改变的是元素在 <strong>Y 轴（竖向）</strong> 的缩放比例。</li>
<li><strong>怎么变？</strong> 从 <code>0</code>（压扁成一条线，完全看不见）过渡到 <code>1</code>（拉伸回原本的高度）。</li>
<li><strong>为什么像展开？</strong> 配合 <code>transform-origin: top</code>（固定顶部），就像把卷帘门从上往下拉下来一样，视觉上就是完美的“展开”效果。</li>
</ul>
<p><strong>深度原理</strong>：<code>transform</code> 属性不会触发 Reflow，只会触发 <strong>Composite (合成)</strong>，这个过程完全由 GPU 处理，不占用主线程 CPU 资源。</p>
<blockquote>
<p><strong>浏览器渲染三兄弟</strong></p>
<ul>
<li><strong>Reflow (重排)</strong>：牵一发而动全身。修改 <code>height</code>、<code>width</code> 时，浏览器要重新计算所有元素位置，<strong>开销最大</strong>。</li>
<li><strong>Repaint (重绘)</strong>：换汤不换药。修改 <code>color</code>、<code>background</code> 时，不影响位置，只重画样子，<strong>开销中等</strong>。</li>
<li><strong>Composite (合成)</strong>：<strong>VIP 绿色通道</strong>。修改 <code>transform</code>、<code>opacity</code> 时，浏览器直接把图层交给 GPU 处理，<strong>跳过</strong>布局和绘制，<strong>开销最小</strong>！</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 优化前：卡顿源头 */</span>
<span class="hljs-selector-class">.subItem</span> {
  <span class="hljs-attribute">transition</span>: height <span class="hljs-number">0.3s</span> ease-in-out;
}

<span class="hljs-comment">/* 优化后：丝滑无比 */</span>
<span class="hljs-selector-class">.subItem</span> {
  <span class="hljs-attribute">transform-origin</span>: top; <span class="hljs-comment">/* 确保从顶部开始展开 */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>);
}

<span class="hljs-selector-class">.subItem</span><span class="hljs-selector-class">.expanded</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-selector-class">.subItem</span><span class="hljs-selector-class">.collapsed</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<p>效果： 动画流畅、交互响应即时。（GIF图压缩严重，请自动脑补德芙广告的丝滑质感）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/674c72b24f914e3f9b9254cbfe8454df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=Nz9S0eXpynTBZRQEKv84Xr0okKU%3D" alt="节点展开动画优化.gif" loading="lazy"/></p>
<blockquote>
<p><strong>⚠️ 避坑指南：关于 <code>will-change: </code></strong></p>
<p>有同学可能会问：“为什么不加 <code>will-change: transform</code>，开启gpu加速？”</p>
<ul>
<li>少量元素时可以考虑；大规模递归树千万别全局加。</li>
<li>参考 MDN：不到不得已不要使用；仅在确有必要时短时添加，过度使用会导致内存占用增加与性能下降。</li>
<li>文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FCSS%2FReference%2FProperties%2Fwill-change" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference/Properties/will-change" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></li>
<li>建议：如需使用，按需、短时、少量元素，并在动画结束后移除。</li>
</ul>
</blockquote>
<h3 data-id="heading-15">2. 销毁层：以“藏”代“删”</h3>
<p><strong>痛点</strong>：
即使用户只是临时关闭弹窗，下次还要再开，原来的逻辑也是直接 <code>v-if="false"</code> 销毁整个组件树。这就导致了那 5 秒的 <code>removeChild</code> 卡顿。</p>
<p><strong>优化</strong>：
对于这种巨型组件，关闭弹窗时<strong>不要销毁它</strong>，而是把它“藏起来”。</p>
<p><strong>代码改动</strong>：
将弹窗的显隐控制从 <code>v-if</code> 改为 <code>v-show</code>，或者使用透明度方案：</p>
<blockquote>
<p><strong>v-if 、 Opacity、  v-show</strong>的区别</p>
<ul>
<li>
<p><strong>v-if</strong>：真正的条件渲染。切换时，组件及其内部所有的事件监听器和子组件都会被<strong>销毁和重建</strong>。对于 2500 个节点的树，这意味着成千上万次的 DOM 插入/删除操作。</p>
</li>
<li>
<p><strong>v-show</strong>：简单的 CSS 切换（display: none）。组件实例始终保留，开销极小。</p>
</li>
<li>
<p><strong>Opacity (透明)</strong>：<code>opacity: 0</code>。DOM 保留，配合 GPU 加速仅触发合成 (Composite)，<strong>切换成本最低</strong>（本案最终方案）。</p>
</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 只是看不见，但 DOM 还在，避免了昂贵的卸载过程 */</span>
<span class="hljs-selector-class">.dialog-hidden</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">pointer-events</span>: none; <span class="hljs-comment">/* 确保点不到 */</span>
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}
</code></pre>
<p><strong>效果</strong>：
关闭弹窗时，耗时从 <strong>5s</strong> 瞬间变为 <strong>0ms</strong>（只是改了个 CSS 属性）。下次再打开时，因为 DOM 都在，直接恢复透明度即可，实现了真正的“秒开”。</p>
<h3 data-id="heading-16">3. 交互层：手风琴模式（Accordion）</h3>
<blockquote>
<p><strong>🤔 什么是手风琴效果？</strong></p>
<p>简单来说，就是 <strong>同一级只有一个节点展开</strong>。
就像手风琴的风箱，拉开这一折，那一折自然合上。比如财务部和研发部是兄弟节点，当你点击展开“财务部”的子节点，之前点开的“研发部”会自动收起。</p>
</blockquote>
<p>我们先来看优化后的效果图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6748feeb1794a928094ef6aa00bbc54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=hZPKjw3MBFiXK0%2F%2Fwz%2FvQ5c2rlQ%3D" alt="手风琴效果.gif" loading="lazy"/></p>
<p><strong>痛点</strong>：
ToB 系统的用户有时操作很“野”，他们可能会把所有部门一层层全部点开。
如果不加限制，随着用户不断展开，页面上的 DOM 节点数量依然会无限制增长，最终再次拖慢浏览器。</p>
<p><strong>优化</strong>：
为组件增加 <code>accordion</code>（手风琴）模式配置。
<strong>原理</strong>：开启后，同级节点同时只能展开一个。当你展开“财务部”时，之前展开的“研发部”会自动收起。</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 伪代码：手风琴逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onNodeExpand</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (accordionMode) {
    <span class="hljs-comment">// 兄弟节点，统统收起！</span>
    siblings.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">sib</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (sib !== node) sib.<span class="hljs-property">isExpand</span> = <span class="hljs-literal">false</span>
    })
  }
  node.<span class="hljs-property">isExpand</span> = <span class="hljs-literal">true</span>
}
</code></pre>
<p>这从<strong>交互设计</strong>层面对 DOM 峰值设定了上限：不管怎么点，同级只保留一个展开项，页面同时存在的 DOM 数始终处于低位且可控。</p>
<h2 data-id="heading-17">番外篇：如果数据量再大 10 倍怎么办？</h2>
<p>虽然这次 2000多条数据搞定了，但肯定有小伙伴会问：“如果有 <strong>2万多条</strong> 甚至更多怎么办？”</p>
<p>这时候，单纯的懒加载也不够用了，因为 DOM 节点的总数依然可能突破浏览器极限。我们需要引入核武器——<strong>虚拟树 (Virtual Tree)</strong>。</p>
<p>简单来说，就是<strong>只渲染你屏幕里看得到的那些节点</strong>。
不管树有几万层，屏幕就那么高（比如 800px），我只渲染这几十个节点，其他的用个空 <code>div</code> 撑开高度把滚动条骗过去就行。</p>
<p><strong>思路也很直白</strong>：</p>
<ol>
<li><strong>拍平</strong>：把树拆成一个大的一维数组。</li>
<li><strong>计算</strong>：算算当前滚动条在什么位置，对应数组里的哪几条数据。</li>
<li><strong>渲染</strong>：只把这几条画出来，绝对定位到正确的地方。</li>
</ol>
<p><strong>那为什么这次没用？</strong>
还是那句老话：<strong>ROI（投入产出比）</strong>。</p>
<p>手写虚拟树要处理动态高度、复选框联动等难点，头发都要掉一把；引入现成的库又会增加包体积。
对于 几千条数据，现在的方案已经够用了，再上虚拟树就是“大炮打蚊子”，没必要增加维护成本。</p>
<p><strong>技术选型没有银弹，只有最适合当下的方案。</strong></p>
<h2 data-id="heading-18">五、 优化结果与客户反馈</h2>
<p>效果图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dffe2fd5a3354652a5ebc920f7d05390~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=0o6O7RIB0lazEHma2TtINKVkpcQ%3D" alt="优化后结果.gif" loading="lazy"/></p>
<p>我们将优化后的补丁发给客户验证：</p>
<ol>
<li><strong>打开弹窗</strong>：保持秒开。</li>
<li><strong>寻找部门（展开）</strong>：从 <strong>十几秒卡死</strong> 变为 <strong>即时响应</strong>。</li>
<li><strong>完成授权（关闭）</strong>：从 <strong>5s 卡死</strong> 变为 <strong>0 延迟</strong>。</li>
</ol>
<p>Performance 面板再次查看，那条心电图终于平稳了，只有零星的几个小波峰，代表正常的渲染任务。</p>
<p>客户反馈：“终于顺畅了，这才是专业系统该有的样子。”（老板终于露出了满意的微笑）</p>
<h2 data-id="heading-19">六、 总结：一点心里话</h2>
<p>这次“救火”经历其实挺典型的。</p>
<p>刚接手时，看着那密密麻麻的代码和满屏的红色 Long Task，心里确实有点发怵。但静下心来，用 Performance 面板这把“手术刀”切下去，病灶其实很清晰：<strong>无节制的 DOM 操作</strong> 和 <strong>昂贵的重排开销</strong>。</p>
<p>回顾一下咱们这趟“排雷”之旅：</p>
<ol>
<li><strong>排查靠证据</strong>：Performance 面板诚不欺我，一眼就看到了 <code>cloneNode</code> 和 <code>Recalculate Style</code> 在疯狂作案。</li>
<li><strong>手段要精准</strong>：
<ul>
<li><strong>懒加载</strong>：别贪多，用多少拿多少，把几千个节点的并发压力拆解到每一次点击中。</li>
<li><strong>合成层优化</strong>：能用 GPU 解决的动画，坚决不麻烦 CPU，<code>scaleY</code> 和 <code>opacity</code> 真是好东西。</li>
<li><strong>策略先行</strong>：有时候技术手段到了瓶颈，换个交互思路（比如手风琴模式），问题就迎刃而解了。</li>
</ul>
</li>
</ol>
<p>其实做性能优化，最忌讳的就是“凭感觉瞎猜”。这次虽然没用上高大上的虚拟列表（Virtual List），但对于当前的数据量级，这套组合拳不仅成本最低，效果也最好。</p>
<p>最后，老王回来后，我必须得请他吃顿好的——毕竟没有他这代码，我也没机会写这篇几千字的复盘文章，更没机会在掘金骗大家的赞（手动狗头）。</p>
<p><strong>如果你觉得这篇文章对你有启发，欢迎 点赞、收藏、转发，这对我很重要！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 向右，社区向左-Captain 的 2025年终总结]]></title>    <link>https://juejin.cn/post/7589509638354321435</link>    <guid>https://juejin.cn/post/7589509638354321435</guid>    <pubDate>2025-12-30T09:53:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638354321435" data-draft-id="7589214068093927443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 向右，社区向左-Captain 的 2025年终总结"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-30T09:53:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 向右，社区向左-Captain 的 2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T09:53:30.000Z" title="Tue Dec 30 2025 09:53:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    642
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI 向右，社区向左</h2>
<p>站在 2025 的尾巴上回望，这确实是极具撕裂感的一年，也是我职业生涯最挣扎的一年。</p>
<p>一方面，AI 技术像一列高速列车，轰鸣着向着更强的逻辑、更高的效率、更极致的自动化狂奔——我称之为 <strong>“向右” <strong>；另一方面，在算法的挤压下，人类的社区、情感与价值正在发生某种应激性的回撤，我们开始寻找那些模型和 AI无法触达的温热——我称之为</strong>“向左”</strong>。</p>
<p>作为身处AI风暴中心的观察者，这是我对 2025 年 AI 编程发展的思考，以及我这一年的个人答卷。</p>
<h2 data-id="heading-1">Part 1. AI 向右：大模型和 AI 编程的极速狂奔</h2>
<p>本次观察主要是结合Andrej Karpathy 是 OpenAI 联合创始人、前特斯拉 AI 总监的 2025 年 LLM 年度回顾。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af4b5621dfe45f99b66d1c953c17431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=RfhHBwc0t%2BarsVNLb0J6TsZA1L0%3D" alt="img_v3_02t7_5d451660-02e5-4df8-bc0d-a5fbe9e86a3g.jpg" loading="lazy"/></p>
<p>Andrej Karpathy（OpenAI 联合创始人）的年度回顾精准地描绘了 AI 技术“向右”狂奔的轨迹。这一年，AI 编程不再是简单的辅助，而是正在重塑“智能”的定义。</p>
<h4 data-id="heading-2">1. 训练范式的“顿悟”</h4>
<p>2025 年最大的技术变量是 <strong>RLVR（可验证奖励的强化学习）</strong> 。 过去的 AI 是“照葫芦画瓢”，人类怎么写代码它就怎么学。但 RLVR 引入了“标准答案”环境（如数学题、代码编译），把模型直接扔进水里，只要游到对岸，姿势随便。 结果令人震惊：模型自己“悟”出了推理能力。它学会了拆解步骤、学会了自我纠错。OpenAI 的 o1 和 o3 就是这种思维链条（Chain of Thought）的产物。算力分配也变了——从死磕预训练，转向了让模型在推理时“多想一会儿”。</p>
<h4 data-id="heading-3">2. “参差不齐”的幽灵</h4>
<p>Karpathy 说我们在“召唤幽灵”。因为优化目标不同（人类为了生存，AI 为了刷榜），AI 展现出一种 <strong>Jagged Intelligence（参差不齐的智能）</strong> 。 它在有标准答案的领域（代码、数学）进化神速，长出了尖刺；但在常识、创意等模糊领域，依然会犯低级错误。这也导致了基准测试（Benchmark）的崩塌——刷榜成了一种针对性优化的艺术，分数虽高，离通用智能尚远。</p>
<h4 data-id="heading-4">3. 应用层的爆发与“Vibe Coding”</h4>
<p>Cursor 的火爆证明了 <strong>“LLM 应用层”</strong> 的成立。它是把通用模型（大学毕业生）培训成专业员工（行业专家）的中间层。 更激进的变化是 <strong>Vibe Coding（氛围编程）</strong> 的兴起。现在的编程门槛低到只需要你会英语，描述需求，完全不用管代码实现。代码变得廉价、即用即弃，像草稿纸一样。 这不仅让普通人能编程，也让专业程序员开始写那些以前“不值得写”的一次性工具。</p>
<h4 data-id="heading-5">4. 住在电脑里的“小精灵”</h4>
<p>Claude Code 展示了未来的方向：<strong>本地化智能体（Agent）</strong> 。 OpenAI 曾赌注云端，但 Karpathy 认为当下更合理的是让 AI 跑在你的电脑上，读取你的本地环境、文件和上下文，像一个和你并肩作战的同事，而不仅仅是一个网页聊天框。</p>
<h4 data-id="heading-6">5. 大模型的 GUI 时代</h4>
<p>Google Gemini Nano Banana 预示了下一个范式：大模型不该只吐文字，它应该像 80 年代的计算机进化出图形界面一样，学会用图表、幻灯片、白板甚至小应用来回应人类。这才是 LLM 真正的原生交互形态。</p>
<p>Karpathy 的总结是这样的：2025 年的大模型，比他预期的聪明，也比他预期的蠢。两者同时成立。</p>
<p>但有一点很确定：即使以现在的能力，我们连 10% 的潜力都没挖掘出来。还有太多想法可以试，整个领域感觉是敞开的。</p>
<p>他在 Dwarkesh 的播客里说过一句看似矛盾的话：</p>
<blockquote>
<p>他相信进步会继续飞速推进，</p>
</blockquote>
<blockquote>
<p>同时也相信还有大量的工作要做。</p>
</blockquote>
<p>其实两件事并不矛盾。目前这个阶段的AI 让执行变快了，但它没有让“知道该做什么”这件事变简单。相反，因为执行成本下降，“做什么”的决策变得更重要了——你可以很快做出 20 个版本，但你得知道哪个是对的。</p>
<p>几年后的软件工程会是什么样子？没人能准确预测。但 Claude Code 团队的今天，可能是很多团队明天的某种预演——更快的迭代、更少的“搬砖”、更多的判断和决策。</p>
<p>工具在变。不变的是，最终做决定的还是人。</p>
<h2 data-id="heading-7">Part 2. 社区向左：人类的价值回撤和重塑</h2>
<p>当 AI 在符号逻辑的领域攻城略地时，传统的程序员社区和人类劳动价值正在被迫寻找新的锚点。</p>
<h3 data-id="heading-8">传统问答社区的黄昏</h3>
<p>所有类似 Stack Overflow 的问答和知识社区衰落是不可逆的。</p>
<p>既然 AI 能瞬间给出代码片段，谁还愿意去搜索引擎或者 BBS论坛等待一个未知的回复？</p>
<ul>
<li><strong>流量暴跌：</strong> 只有纯技术问答在被替代。</li>
<li><strong>质量恶化：</strong> AI 生成的垃圾内容泛滥，需要人肉排雷。</li>
</ul>
<p>但 Reddit 这种强社交属性的社区反而在复兴。<strong>这说明了“向左”的趋势：</strong> 知识获取变得廉价后，<strong>人与人的连接、情感共鸣、线下见面的价值</strong>反而变得无比昂贵。那么后面社区的持久价值在哪里？可以深度链接线下社区和深度社交的社区，因此我个人比较看好 reddit 和社群的价值。</p>
<p>所以在掘金我还是相信人的价值。</p>
<p>今年在社区里叫停了很多活动，因为大家很多人在用 aigc 敷衍了事～～～我并不排斥 AI，给大家看个图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b777b1257f4445029f60f38337ff7e5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=c9F296Op%2BscTH0idUAM5dhswYjQ%3D" alt="image.png" loading="lazy"/></p>
<p>掘金每天都有几百篇文章垃圾 AI 文章，这些是奔着所谓的 GEO 和 SEO 来的，我没法评价对错，但是对内容的操守让我选择对这些内容说不～～～</p>
<p>但是今年考虑了一下继续推进了年终技术征文，想看看大家的现状和寻找一些真实的情感共鸣。活动还在进行中：感兴趣的可以来聊聊你的 2025：<a href="https://juejin.cn/post/7587675443442450472" target="_blank" title="https://juejin.cn/post/7587675443442450472">juejin.cn/post/758767…</a></p>
<p>另一块，年终影响力榜单还在继续筛选预计 12.31 发布，毕竟我们总要相信创作的价值，感谢那些在 2025 还在持续输出的他们和你们。</p>
<h3 data-id="heading-9">硅基生命迫使我们重新思考劳动力价值</h3>
<p>起因是有一天周末做了 aidp （就是那个大忽悠优弧在的新部门做的）平台美观度标注的一道题，大概收入 600 元，我个人是有点感慨万千，就是感觉在帮助模型掘墓程序员，最近群友读《送外卖》也是，最细颗粒度的路线和送餐方式数据模型还学不会，就通过机制让外卖员动脑子“榨”出来最末端的思考</p>
<p>在AI快速取代人类劳动力的浪潮中，一个核心规律逐渐清晰：越是纯符号、可形式化、封闭规则的知识工作（如编程、数学证明、文书处理），越容易被大模型迅速吃掉，因为这些领域没有物理限制，AI可以无限试错和迭代，人类程序员的经验很快就会被“偷师”并固化成更严苛的算法，陷入被追赶的被动。</p>
<p>相反，越是依赖肉身存在、高度情境化、充满社会互动和长尾瞬变的长尾场景（如外卖最后一公里、餐厅服务、医疗护理、养老陪伴），AI和机器人越难彻底取代。现实世界的复杂性、动态性和情感需求，让最细颗粒度的优化永远学不完——今天的新小巷、明天的客人情绪、后天的突发状况，都在不断产生新知识。平台和机器人再怎么从人类身上“偷师”，也总有追不上的地方。</p>
<p>因此，真正抗AI取代的，往往不是高薪的高级知识工作，而是那些看似低端的“服务业”。服务员、护理员、陪护人员，这些需要温度、共情、即时应变和身体在场的岗位，可能成为人类劳动力最后的堡垒。当机器人终于能端稳一盘热汤、读懂客人的眼神、处理一场家庭纠纷时，或许才称得上人类劳动力的真正大解放。而在那一刻到来之前，服务业很可能比写代码更有未来——因为它最难被完全算法化和自动化。</p>
<p>说到底，AI最容易取代的，是那些不需要“成为人类”就能完成的工作；而最顽强存活下来的，往往正是那些只有人类才能做好的事。</p>
<h3 data-id="heading-10">社区的个体应该也就是码农的我们应该如何应对冲击</h3>
<p>其实很多东西是亘古不变的，打不过就积极拥抱，快速深入。</p>
<ul>
<li>
<p><strong>拥抱快速落地：</strong> 可以深度尝试从两周一个原型变成一周三个。</p>
</li>
<li>
<p><strong>AI 辅助 TDD：</strong> 让写测试不再昂贵。</p>
</li>
<li>
<p><strong>成为 Product-minded Engineer：</strong> 像 Claude Code 团队那样，不需要专门的 PM，工程师利用 AI 补齐短板，直接对产品结果负责。</p>
</li>
</ul>
<h2 data-id="heading-11">Captain 的 2025-谈谈我个人的工作和生活</h2>
<h3 data-id="heading-12">我去年立过的 Flag</h3>
<ul>
<li>
<p>减肥：失败，戒烟一年整，感觉至少肥了 10 公斤，</p>
</li>
<li>
<p>戒烟：成功～这点确实坚持了一年，</p>
</li>
<li>
<p>计划出 3 本书
实际只出版了 2 本，及格分，但是第二本书有幸和英国出版社合作了，也算出了三本</p>
<ul>
<li>第一个Vibe 编程 探索 AI 时代编程新范式
<ul>
<li>先说下写这本书的初衷是因为从业原因观察到了 AI 编程的会对各位程序员们产生巨大的冲击，希望大家能看到这个变化，但是由于四位作者大家的认知和投入度都不一样，我对这本书整体是不满意的，主要还是技术人看了摇头，非技术人看不懂，略显鸡肋。</li>
<li/>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6af8d155de6541c4897308f50a910cea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=5yA5t8DDjKRHjVoPWZwP9tkIfO4%3D" alt="ea39a75caf710d13bbec1bc8bbd18849.jpg" width="30%" loading="lazy"/>
<ul>
<li>
<p>第二本是人人都是 AI 程序员-TRAE +Cursor 从 0 到 1 全栈实战
这本书也是一波三折～但是找了很多朋友看了，觉得很有信心。期待上市表现</p>
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380d8c94704844fb875488fcb6b03d99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=dpyQ1JyaTJL1Ypmz%2BboVvXHqO08%3D" alt="d0a500e114a75960fbec995d152b3878.jpg" width="30%" loading="lazy"/>
</li>
<li>
<p>浪说播客：<a href="https://link.juejin.cn?target=https%3A%2F%2Flangshuo0.podcast.xyz" target="_blank" title="https://langshuo0.podcast.xyz" ref="nofollow noopener noreferrer">langshuo0.podcast.xyz</a> 没有断更～～～</p>
<ul>
<li>全网 4000 粉，累计 20w 播放</li>
<li>最近录制的两期的播客推荐听一下
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaoyuzhoufm.com%2Fepisode%2F69376f77238f302e4b281483%3Fs%3DeyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%253D" target="_blank" title="https://www.xiaoyuzhoufm.com/episode/69376f77238f302e4b281483?s=eyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%3D" ref="nofollow noopener noreferrer">聊聊 AI 编程的现状和未来</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaoyuzhoufm.com%2Fepisode%2F694b33d77c91834b9fc14a95%3Fs%3DeyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%253D" target="_blank" title="https://www.xiaoyuzhoufm.com/episode/694b33d77c91834b9fc14a95?s=eyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%3D" ref="nofollow noopener noreferrer">浪说年终盘点-AI 编程这一年：是降维打击？还是赛博垃圾的狂欢？</a>
2026年终盘点。那天晚上发布播客，准备素材听了自己的播客，感觉很奇怪也很有趣，我从头到尾头一次听了自己 2h 的播客，跨时空和自己对话了。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">工作上社区的变化</h3>
<ul>
<li>结合今年的热点做了：aicoding.juejin.cn ，种种原因，没有做好，这也让我重新审视传统技术社区的价值。</li>
<li>主要工作中心放在 TRAE 上</li>
<li>去了上海、杭州、广州、深圳、成都、重庆跑了一圈，组织了很多线下活动</li>
<li>第一次真正意义上的跨国去到东京组织了一次活动</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8403237079c14e7eb3df344e463ad11d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=KLbjyO8UiqUUwT4tvbTvTmbPaY8%3D" alt="31f4b0a02f9bf35f5004fdb8c5108c50.jpg" loading="lazy"/></p>
<blockquote>
<p><strong>这些线下面对面的碰撞给我的体会是：</strong> 代码可以由 AI 生成，但信任、激情和灵感的碰撞，依然只发生在人与人面对面的时刻。</p>
</blockquote>
<h3 data-id="heading-14">26 年的 个人flag</h3>
<ul>
<li>减肥，希望瘦回高中时代</li>
<li>和老婆做好了心理建设，准备迎接新生命，想有个宝宝</li>
<li>做一些重要决策，希望对后面职业生涯有所帮助</li>
<li>买个摩托车可以摩旅</li>
<li>深度使用 和拥抱 AI</li>
<li>坚持录播客</li>
<li>许愿美国签证和巴西签证顺利下来，可以走出亚洲～～～</li>
<li>帮助更多人了解 AI 编程</li>
</ul>
<p>我是 Captain，“25年太漫长、太疲惫了，你可以开启新生活了。”</p>
<blockquote>
<p>技术是一直在变，工具也在变，但做决定的依然是人。 AI 让执行变得极其廉价，这就意味着 “决定做什么”变得前所未有的昂贵。</p>
</blockquote>
<p>这里也分享一下最近 youtube 爆火中年程序员的视频，一场关于金钱、时间与生命意义的深刻复盘。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyoutu.be%2FVeMA9WGKxOg%3Fsi%3Dxx5AAOuJLy87ePeV" target="_blank" title="https://youtu.be/VeMA9WGKxOg?si=xx5AAOuJLy87ePeV" ref="nofollow noopener noreferrer">youtu.be/VeMA9WGKxOg…</a></p>
<p>从少年时代抱着O'Reilly技术书狂啃，到如今手握专利、拿着大厂天价股票的技术高管，这位40多岁的大哥回顾了自己科技圈摸爬滚打的25年。光鲜亮丽的表面下，是残酷的现实：即使做到架构师，也发现自己不过在重复造轮子，代码并未真正让世界变好。他亲眼目睹才华横溢的同事因过劳离世，却仅一周后，公司里就仿佛这个人从未存在过。每天只剩1小时陪伴孩子，错过了带他们露营、钓鱼的宝贵时光。得益于早年对财富的觉醒，在最后一轮大裁员中，他做出一个勇敢决定：为保住组里年轻人的饭碗，他主动把自己放进裁员名单。</p>
<p>评论区很有趣，大家说这才是YouTube存在的意义。</p>
<p>“唯一会记得你加班到深夜的人，只有你的孩子和家人。科技行业早已缺乏忠诚与体面。”</p>
<p>“如果你死了，你的职位会在讣告刊登前就被重新招聘。”</p>
<p>“兄弟看起来真的因为被裁员而开心。也许这其实是塞翁失马，焉知非福。”</p>
<p>“请多发一些视频。社交媒体上充斥着垃圾内容，我们需要有真实生活经验的真人分享故事。”</p>
<p>“被裁员是每个科技从业者的宿命。你必须成为合伙人——要么在当前公司，要么创办自己的公司。”</p>
<p>“25年太漫长、太疲惫了，你可以开启新生活了。”</p>
</blockquote>
<p>2026 希望继续和大家同在，感谢遇见的各位。</p>
<p>isboyjc、Cookieboty、GSYTech、文如秋雨、林小帅、wangly19、alex 以及 AAA 全国可飞 VE 赚钱群的 40 多位掘友们。以及，200 位浪说播客听友群，200 多位AI 编程社VIP 群～的你们，以及优弧（应油壶强烈要求）</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba976e824f1f48b98ad7851f085c2e89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=OU%2FAvZQb5x6arhh5EezoHutTUTk%3D" alt="e970704aad4236e4b8f7e0badd09925e.jpg" width="30%" loading="lazy"/>
<p>、欢迎大家持续找我交流聊天，个人微信：229199157，推特：<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FXCaptaincc" target="_blank" title="https://x.com/XCaptaincc" ref="nofollow noopener noreferrer">x.com/XCaptaincc</a></p>
<p>看到这里的掘友们别划走，请留下你的思考和感触，我会挑选 3-5 人评论送出的我的个人签名书一本。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计]]></title>    <link>https://juejin.cn/post/7589126920286945290</link>    <guid>https://juejin.cn/post/7589126920286945290</guid>    <pubDate>2025-12-30T00:28:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286945290" data-draft-id="7588022226739101746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android   一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计"/> <meta itemprop="keywords" content="Android,面试,前端"/> <meta itemprop="datePublished" content="2025-12-30T00:28:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏程十八少"/> <meta itemprop="url" content="https://juejin.cn/user/184373685534077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android   一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685534077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏程十八少
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:28:23.000Z" title="Tue Dec 30 2025 00:28:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.需求：(3种车机/手机UI切换)</h2>
<p>Android 新能源车机，手机竖屏，手机横屏3种情况的UI, 数据来源有多个，分不同的品牌，有小米，蔚来，理想，比亚迪，大部分相同，仅仅有一点差别</p>
<h2 data-id="heading-1">2.方案：(抽象工厂+策略模式)</h2>
<p>为了满足 <strong>Android 车机、手机竖屏、手机横屏</strong> 三种 UI 场景下使用 <strong>同一份数据源（DataManager）</strong> ，且 <strong>不同品牌间数据结构基本一致、仅少量差异</strong> 的需求，我们可以采用以下设计原则：</p>
<ul>
<li><strong>单一数据源</strong>：<code>DataManager</code> 提供统一接口。</li>
<li><strong>策略模式 / 工厂模式</strong>：根据设备类型和品牌动态提供适配器或视图模型。</li>
<li><strong>低耦合 + 高扩展性</strong>：UI 层不直接依赖具体品牌逻辑，而是通过抽象接口获取数据。</li>
</ul>
<p>根据需求，这里采用MVP模式+抽象工厂+策略模式来处理不同品牌和设备的UI差异：</p>
<h2 data-id="heading-2">3.架构图</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3940ed6e2e9045bd8e0396a1e09b0aff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659302&amp;x-signature=O988NSBMuIlX1MSL6jcAFLFu%2FKo%3D" alt="车机和手机.png" loading="lazy"/></p>
<h2 data-id="heading-3">4.主要的代码</h2>
<p>因为公司的保密问题，把核心的思想分析成一个demo！如下：</p>
<h4 data-id="heading-4">🔹 数据层：统一接口</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 品牌数据统一接口（IBrandData）
 * 所有新能源汽车品牌必须实现此接口，保证上层调用一致性
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBrandData</span> {
    <span class="hljs-function">String <span class="hljs-title">getCommonField</span>()</span>;        <span class="hljs-comment">// 通用信息（如续航、车型）</span>
    <span class="hljs-function">String <span class="hljs-title">getBrandSpecificField</span>()</span>; <span class="hljs-comment">// 品牌特有功能（如换电、生态互联等）</span>
}
</code></pre>
<hr/>
<h4 data-id="heading-5">🚗 数据层实现：四个品牌（小米、蔚来、理想、比亚迪）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/** 小米汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaomiBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"小米SU7 通用信息：800V高压平台，CLTC续航800km"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"小米澎湃OS生态互联：手机-车机无缝流转"</span>;
    }
}

<span class="hljs-comment">/** 蔚来汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NIOBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"蔚来ET5 通用信息：双电机四驱，换电兼容"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"蔚来换电站 + NOMI智能情感引擎"</span>;
    }
}

<span class="hljs-comment">/** 理想汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LiAutoBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"理想L系列 通用信息：家庭六座SUV，增程电动"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"城市NOA + 增程式无里程焦虑"</span>;
    }
}

<span class="hljs-comment">/** 比亚迪汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BYDBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"比亚迪汉EV 通用信息：刀片电池，e平台3.0"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"云辇智能车身控制系统 + DiLink生态"</span>;
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-6">📱 设备类型 &amp; UI 策略（保持不变，仅微调注释）</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 设备类型枚举：用于区分 UI 渲染上下文
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> DeviceType {
    CAR,                <span class="hljs-comment">// 车载中控（大屏、驾驶安全优先）</span>
    PHONE_PORTRAIT,     <span class="hljs-comment">// 手机竖屏（信息精简）</span>
    PHONE_LANDSCAPE     <span class="hljs-comment">// 手机横屏（信息完整展示）</span>
}

<span class="hljs-comment">/**
 * UI 渲染策略接口：不同设备使用不同展示逻辑
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUiStrategy</span> {
    void render(IBrandData <span class="hljs-keyword">data</span>);
}

<span class="hljs-comment">// 具体策略实现（略，同你原有代码，仅接口名改为 IBrandData）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarUiStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[CAR] "</span> + <span class="hljs-keyword">data</span>.getCommonField() + <span class="hljs-string">" | "</span> + <span class="hljs-keyword">data</span>.getBrandSpecificField());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PhonePortraitStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[PHONE-PORTRAIT] "</span> + <span class="hljs-keyword">data</span>.getCommonField());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneLandscapeStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[PHONE-LANDSCAPE] "</span> + <span class="hljs-keyword">data</span>.getCommonField() + <span class="hljs-string">" + "</span> + <span class="hljs-keyword">data</span>.getBrandSpecificField());
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-7">🧩 数据管理器（DataManager）—— 支持四大品牌</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.function.Supplier;

<span class="hljs-comment">/**
 * 数据管理器：统一入口，按品牌返回对应数据
 * 使用工厂注册机制，支持动态扩展
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Supplier&lt;IBrandData&gt;&gt; BRAND_FACTORY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        BRAND_FACTORY.put(<span class="hljs-string">"xiaomi"</span>, XiaomiBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"nio"</span>, NIOBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"liauto"</span>, LiAutoBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"byd"</span>, BYDBrandData::<span class="hljs-keyword">new</span>); <span class="hljs-comment">// ✅ 新增比亚迪</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String brand;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataManager</span><span class="hljs-params">(String brand)</span> {
        <span class="hljs-built_in">this</span>.brand = brand.toLowerCase();
    }

    <span class="hljs-keyword">public</span> IBrandData <span class="hljs-title function_">getBrandData</span><span class="hljs-params">()</span> {
        Supplier&lt;IBrandData&gt; factory = BRAND_FACTORY.get(brand);
        <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的品牌: "</span> + brand + <span class="hljs-string">"。支持: "</span> + BRAND_FACTORY.keySet());
        }
        <span class="hljs-keyword">return</span> factory.get();
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-8">🔗 UI 协调器（核心适配器）</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * UI 协调器：组合品牌数据 + 设备策略
 * 是 MVP 中 Presenter 层的理想载体
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiCoordinator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataManager dataManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IUiStrategy uiStrategy;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UiCoordinator</span><span class="hljs-params">(<span class="hljs-type">String</span> brand, DeviceType deviceType)</span> </span>{
        <span class="hljs-keyword">this</span>.dataManager = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataManager</span>(brand);
        <span class="hljs-keyword">this</span>.uiStrategy = <span class="hljs-built_in">createStrategy</span>(deviceType);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> IUiStrategy <span class="hljs-title">createStrategy</span><span class="hljs-params">(DeviceType type)</span> </span>{
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> CAR: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">CarUiStrategy</span>();
            <span class="hljs-keyword">case</span> PHONE_PORTRAIT: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PhonePortraitStrategy</span>();
            <span class="hljs-keyword">case</span> PHONE_LANDSCAPE: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PhoneLandscapeStrategy</span>();
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalStateException</span>(<span class="hljs-string">"未知设备类型: "</span> + type);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>{
        IBrandData data = dataManager.<span class="hljs-built_in">getBrandData</span>();
        uiStrategy.<span class="hljs-built_in">render</span>(data);
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-9">🖥️ 主程序（测试入口）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">String</span>[] brands = {<span class="hljs-string">"xiaomi"</span>, <span class="hljs-string">"nio"</span>, <span class="hljs-string">"liauto"</span>, <span class="hljs-string">"byd"</span>}; <span class="hljs-comment">// ✅ 包含比亚迪，不含小鹏</span>
        <span class="hljs-title class_">DeviceType</span>[] devices = {<span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">CAR</span>, <span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">PHONE_PORTRAIT</span>, <span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">PHONE_LANDSCAPE</span>};

        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> brand : brands) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"🔹 品牌: "</span> + brand.<span class="hljs-title function_">toUpperCase</span>());
            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">DeviceType</span> device : devices) {
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">UiCoordinator</span>(brand, device).<span class="hljs-title function_">display</span>();
            }
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">✅ 最终架构图</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span>
<span class="hljs-operator">|</span>   UI 展示层 (<span class="hljs-keyword">View</span>)  <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> Activity<span class="hljs-operator">/</span>Fragment <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> 根据配置调用      <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   UiCoordinator     <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+----------+</span>
           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------v----------+</span>
<span class="hljs-operator">|</span>  适配层 (Presenter) <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> UiCoordinator     <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> IUiStrategy       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> DeviceType        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+----------+</span>
           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------v----------+</span>
<span class="hljs-operator">|</span>    数据层 (Model)   <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> DataManager       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> IBrandData        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> Xiaomi<span class="hljs-operator">/</span>NIO<span class="hljs-operator">/</span>Li<span class="hljs-operator">/</span>BYD <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">5 .设计要点说明总结：</h2>



































<table><thead><tr><th>特性</th><th>实现方式</th><th>优势</th></tr></thead><tbody><tr><td><strong>品牌扩展</strong></td><td><code>BRAND_FACTORY</code> 注册</td><td>新增品牌只需加一行</td></tr><tr><td><strong>设备适配</strong></td><td><code>DeviceType</code> + 策略模式</td><td>横竖屏/车机自动切换</td></tr><tr><td><strong>低耦合</strong></td><td>全程依赖接口（<code>IBrandData</code>, <code>IUiStrategy</code>）</td><td>易测试、易替换</td></tr><tr><td><strong>MVP友好</strong></td><td><code>UiCoordinator</code> ≈ Presenter</td><td>业务逻辑与 View 分离</td></tr><tr><td><strong>健壮性</strong></td><td>非法品牌抛出明确异常</td><td>快速定位配置错误</td></tr></tbody></table>
<ol>
<li>
<p><strong>数据层</strong>：</p>
<ul>
<li><code>DataManager</code>单例管理数据，通过策略模式处理品牌差异</li>
<li><code>IBrandDataStrategy</code>接口允许灵活扩展新品牌</li>
</ul>
</li>
<li>
<p><strong>UI层</strong>：</p>
<ul>
<li>抽象工厂模式创建不同设备类型的视图</li>
<li>每种设备类型有基类视图，品牌再继承实现差异</li>
<li>支持屏幕旋转自动适配</li>
</ul>
</li>
<li>
<p><strong>业务层</strong>：</p>
<ul>
<li>MVP模式分离业务逻辑</li>
<li>不同设备类型可有特定Presenter</li>
</ul>
</li>
<li>
<p><strong>扩展性</strong>：</p>
<ul>
<li>新增品牌：实现<code>IBrandDataStrategy</code>和<code>IUIFactory</code></li>
<li>新增设备类型：添加<code>DeviceType</code>枚举和对应视图</li>
<li>数据变化：观察者模式通知更新</li>
</ul>
</li>
<li>
<p><strong>低耦合</strong>：</p>
<ul>
<li>依赖接口而非实现</li>
<li>各层之间通过接口通信</li>
<li>配置集中管理</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">5.2  设计模式应用总结</h3>
<h4 data-id="heading-13">5.2.1. 策略模式 (Strategy Pattern)</h4>
<ul>
<li><strong>应用</strong>: <code>IUiStrategy</code> 接口 + 具体策略类</li>
<li><strong>目的</strong>: 根据不同设备类型切换UI渲染逻辑</li>
<li><strong>优势</strong>: 易于扩展新设备类型，符合开闭原则</li>
</ul>
<h4 data-id="heading-14">5.2.2. 工厂模式 (Factory Pattern)</h4>
<ul>
<li><strong>应用</strong>: <code>DataManager</code> 中的品牌工厂注册表</li>
<li><strong>目的</strong>: 统一创建品牌数据对象</li>
<li><strong>优势</strong>: 集中管理对象创建，支持动态注册</li>
</ul>
<h4 data-id="heading-15">5.2.3. 接口隔离原则 (Interface Segregation)</h4>
<ul>
<li><strong>应用</strong>: <code>IBrandData</code> 只定义必要方法</li>
<li><strong>目的</strong>: 品牌实现类只实现需要的方法</li>
<li><strong>优势</strong>: 避免接口臃肿，提高灵活性</li>
</ul>
<h4 data-id="heading-16">5.2.4. 依赖倒置原则 (Dependency Inversion)</h4>
<ul>
<li><strong>应用</strong>: 高层模块依赖抽象接口而非具体实现</li>
<li><strong>目的</strong>: 降低模块间耦合度</li>
<li><strong>优势</strong>: 提高代码可测试性和可维护性</li>
</ul>
<p>这个架构支持灵活扩展新品牌和设备类型，同时保持代码的可维护性和可测试性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LogicFlow 交互新体验：告别直连，丝滑贝塞尔轨迹实战！🍫]]></title>    <link>https://juejin.cn/post/7589168816527949851</link>    <guid>https://juejin.cn/post/7589168816527949851</guid>    <pubDate>2025-12-30T03:36:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589168816527949851" data-draft-id="7589166195796951067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LogicFlow 交互新体验：告别直连，丝滑贝塞尔轨迹实战！🍫"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-30T03:36:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橙某人"/> <meta itemprop="url" content="https://juejin.cn/user/1908407919184670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LogicFlow 交互新体验：告别直连，丝滑贝塞尔轨迹实战！🍫
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1908407919184670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橙某人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T03:36:26.000Z" title="Tue Dec 30 2025 03:36:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">写在开头</h2>
<p>Hello everyone! 🤠</p>
<p>在<a href="https://juejin.cn/post/7589107312112648201" target="_blank" title="https://juejin.cn/post/7589107312112648201">LogicFlow 交互新体验：让锚点"活"起来，鼠标跟随动效实战！🧲</a>中，咱们解决了锚点的吸附交互问题。今天小编要分享的是另一项细节优化——<strong>连线轨迹（Trajectory）</strong>。</p>
<p>大家在使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2F" target="_blank" title="https://site.logic-flow.cn/" ref="nofollow noopener noreferrer">LogicFlow</a> 时，默认的拖拽连线，无论你最终生成的边是折线还是曲线，<strong>在鼠标拖拽的过程中，跟随鼠标的那条线始终是一条笔直的虚线。</strong></p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da27f5885fc04a83ac3118969d99cdbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767670586&amp;x-signature=Wmm9kjjm6zq0dpr7oU2wWU11mCE%3D" alt="123002.gif" loading="lazy"/></p>
<p>对于一个追求极致体验的项目来说，这多少有点 "出戏"。🤔</p>
<p>在小编的项目中，我们最终生成的<strong>边</strong>是<strong>贝塞尔曲线</strong>，根据设计人员的要求，连线过程中也期望是以曲线的形式，以此匹配项目的整体设计规范。</p>
<p>于是，小编在翻阅 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2Fapi%2Fdetail%2Fconstructor" target="_blank" title="https://site.logic-flow.cn/api/detail/constructor" ref="nofollow noopener noreferrer">LogicFlow</a> 文档时，找了一个 <code>customTrajectory</code> 属性，它能让咱们进行<strong>自定义连线轨迹</strong>。✨</p>
<blockquote>
<p>非常灵活方便，在小编早期技术选型时，也是看中了 LogicFlow 库超强的自定义能力。</p>
</blockquote>
<p>优化后的最终效果如下，请诸君按需食用哈。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9c609f4565e400e9a49b990ca56dd30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767670586&amp;x-signature=lee8t6EpORIfSLtG6hCZ%2BGnSwOo%3D" alt="123001.gif" loading="lazy"/></p>
<h2 data-id="heading-1">需求背景</h2>
<p>在小编项目中，节点之间的边采用的是<strong>三次贝塞尔曲线</strong>（<code>bezierCurveEdge</code>），并且我们对边进行自定义开发。</p>
<p>但是，目前的痛点是：</p>
<ul>
<li><strong>视觉割裂</strong>：拖拽时是直线，松手后变曲线，视觉体验不连续。</li>
<li><strong>风格不符</strong>：生硬的直线无法体现项目整体“圆润、流畅”的设计语言。</li>
</ul>
<p>设计人员想要的效果是：</p>
<ul>
<li>用户拖拽连线时，跟随鼠标的引导线直接展示为<strong>曲线</strong>。</li>
<li>引导线的曲率动态计算，与最终生成的边保持一致。</li>
</ul>
<h2 data-id="heading-2">具体实现</h2>
<p>LogicFlow 提供了一个非常强大的配置项 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2Fapi%2Fdetail%2Fconstructor" target="_blank" title="https://site.logic-flow.cn/api/detail/constructor" ref="nofollow noopener noreferrer">customTrajectory</a>，允许我们自定义连线过程中引导线的渲染逻辑。</p>
<h3 data-id="heading-3">第1️⃣步：理解customTrajectory属性</h3>
<p>从文档上看 <code>customTrajectory</code> 属性接收的是一个函数，扒其相关的源码。⏰</p>
<p>源码位置在： <code>packages/core/src/view/Anchor.tsx</code></p>
<p>核心逻辑如下：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6a4c65ce8264f5eaf846ddd86b3524e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767670586&amp;x-signature=mzbKvDX5qskNRxInW%2FF991vRN2M%3D" alt="image.png" width="50%" loading="lazy"/>
<p>从源码中可以清晰地看到，<code>customTrajectory</code> 是一个优先级更高的渲染函数。它接收起点 (<code>sourcePoint</code>)、终点 (<code>targetPoint</code>) 以及样式配置 (<code>edgeStyle</code>)，要求返回一个 VDOM 节点（它在 <code>render</code> 函数中，通常是 SVG 元素）。</p>
<p>LogicFlow 内部使用 Preact/React 的 VDOM 机制，所以我们需要引入其的 <code>h</code> 函数来创建元素。</p>
<h3 data-id="heading-4">第2️⃣步：编写贝塞尔轨迹算法</h3>
<p>核心难点在于计算贝塞尔曲线的<strong>控制点</strong>。为了让曲线看起来自然，通常控制点会根据起点和终点的相对位置进行偏移。</p>
<p>咱们新建文件 <code>customTrajectory.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">"@logicflow/core"</span>;

<span class="hljs-comment">// 定义一些常量，保持与最终边的样式一致</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STROKE_COLOR</span> = <span class="hljs-string">"#2961F7"</span>; <span class="hljs-comment">// 引导线颜色</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STROKE_WIDTH</span> = <span class="hljs-number">1</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@name</span> 自定义连线轨迹
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} params 轨迹参数对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{x:number,y:number</span>}} params.sourcePoint 起点坐标
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{x:number,y:number</span>}} params.targetPoint 终点坐标（即鼠标当前位置）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">*</span>} Preact 虚拟节点
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customTrajectory</span>(<span class="hljs-params">{ sourcePoint, targetPoint, ...edgeStyle }</span>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">x</span>: startX, <span class="hljs-attr">y</span>: startY } = sourcePoint;
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">x</span>: endX, <span class="hljs-attr">y</span>: endY } = targetPoint;
  
  <span class="hljs-comment">// 1. 计算水平和垂直方向的距离</span>
  <span class="hljs-keyword">const</span> dx = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(endX - startX);
  <span class="hljs-keyword">const</span> dy = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(endY - startY);
  
  <span class="hljs-comment">// 2. 计算控制点偏移量</span>
  <span class="hljs-comment">// 这里采用“以水平方向为主”的策略，系数 0.6 是经验值，可以让曲线弯得更好看</span>
  <span class="hljs-keyword">const</span> controlOffset = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(dx, dy) * <span class="hljs-number">0.6</span>;
  
  <span class="hljs-comment">// 3. 生成三次贝塞尔曲线的路径（C 指令：C 控制点1.x,控制点1.y 控制点2.x,控制点2.y 终点.x,终点.y）</span>
  <span class="hljs-keyword">let</span> d = <span class="hljs-string">""</span>;
  
  <span class="hljs-keyword">if</span> (endX &gt; startX &amp;&amp; endY &gt; startY) {
    <span class="hljs-comment">// 右下方向：控制点1 右上，控制点2 左下</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX + controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX - controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (endX &gt; startX &amp;&amp; endY &lt; startY) {
    <span class="hljs-comment">// 右上方向：控制点1 右下，控制点2 左上</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX + controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX - controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (endX &lt; startX &amp;&amp; endY &gt; startY) {
    <span class="hljs-comment">// 左下方向：控制点1 左上，控制点2 右下</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX - controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX + controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 左上方向：控制点1 左下，控制点2 右上</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX - controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX + controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  }

  <span class="hljs-comment">// 4. 返回 SVG Path 元素</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(
    <span class="hljs-string">"path"</span>, 
    {
      d,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"none"</span>,
      <span class="hljs-attr">pointerEvents</span>: <span class="hljs-string">"none"</span>, <span class="hljs-comment">// 极其重要！防止引导线阻挡鼠标事件</span>
      ...edgeStyle,
      <span class="hljs-attr">strokeDasharray</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// 小编的项目设计不需要虚线，所以清除掉，你可以根据自己需要</span>
      <span class="hljs-attr">stroke</span>: <span class="hljs-variable constant_">STROKE_COLOR</span>, 
      <span class="hljs-attr">strokeWidth</span>: <span class="hljs-variable constant_">STROKE_WIDTH</span>, 
    },
  );
}
</code></pre>
<p><strong>注意</strong>🔉：这里的控制点计算逻辑（<code>controlOffset</code>）最好与你的边里的逻辑保持一致，这样松手的一瞬间，线条才不会有奇怪的 "跳动"。</p>
<blockquote>
<p>这里如此复杂的计算是小编自己写的？那么牛？🐮</p>
<p>当然不是，这里小编也是借助了AI的协助。这要是放在几年前，这种交互效果直接就砍掉，实在太费劲了，现在不一样了，你让AI帮助你写，只要你提示词写得足够清楚，AI分分钟帮你解决，你只要调调参数，验收结果就行了。</p>
</blockquote>
<h3 data-id="heading-5">第3️⃣步：注册配置</h3>
<p>最后，在初始化 LogicFlow 时，将这个函数传给 <code>customTrajectory</code> 选项。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">LogicFlow</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@logicflow/core"</span>;
<span class="hljs-keyword">import</span> customTrajectory <span class="hljs-keyword">from</span> <span class="hljs-string">"./customTrajectory"</span>;

<span class="hljs-keyword">const</span> lf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicFlow</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#container"</span>),
  <span class="hljs-comment">// ... 其他配置</span>
  
  <span class="hljs-comment">// 注册自定义轨迹</span>
  <span class="hljs-attr">customTrajectory</span>: customTrajectory,
  
  <span class="hljs-comment">// 确保最终生成的边也是贝塞尔曲线</span>
  <span class="hljs-attr">edgeGenerator</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"bezierCurveEdge"</span>, 
});
</code></pre>
<h2 data-id="heading-6">总结</h2>
<p>通过简单的数学计算和 VDOM 渲染，咱们成功将 LogicFlow 的连线轨迹从 "工业风" 的直线升级成了 "艺术风" 的曲线。😋</p>
<p>希望这个小技巧能让你的流程图编辑体验更加出色！🌟</p>
<br/>
<hr/>
<p><br/><br/></p>
<p>至此，本篇文章就写完啦，撒花撒花。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2198fba2b674f1b935a63e4abb3cbd7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=90&amp;h=90&amp;s=8866&amp;e=png&amp;b=fcfcfc" alt="image.png" loading="lazy"/></p>
<p>希望本文对你有所帮助，如有任何疑问，期待你的留言哦。<br/>
老样子，点赞+评论=你会了，收藏=你精通了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面]]></title>    <link>https://juejin.cn/post/7589171972446289962</link>    <guid>https://juejin.cn/post/7589171972446289962</guid>    <pubDate>2025-12-30T00:33:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589171972446289962" data-draft-id="7589176150493036598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面"/> <meta itemprop="keywords" content="程序员,AI编程"/> <meta itemprop="datePublished" content="2025-12-30T00:33:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古时的风筝"/> <meta itemprop="url" content="https://juejin.cn/user/501033035374045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035374045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    古时的风筝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:33:42.000Z" title="Tue Dec 30 2025 00:33:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍄  <strong>大家好，我是风筝</strong></p>
<p>🌍 个人博客：【<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moonkite.cn" target="_blank" title="https://www.moonkite.cn" ref="nofollow noopener noreferrer">古时的风筝</a>】。</p>
<p>本文目的为个人学习记录及知识分享。如果有什么不正确、不严谨的地方请及时指正，不胜感激。</p>
<p>每一个赞都是我前进的动力。</p>
</blockquote>
<p>微信读书可能是我唯一一款连续订阅年度会员的应用，就为了微信读书App，还专门买了个汉王阅读器。</p>
<p>可惜买了之后基本没用过。为啥呢？因为听书的时间超过读书了。</p>
<p>坐地铁、做饭、刷碗是我的三大高频听书场景。</p>
<p>这不一年马上又过去了吗，又到了年终撤回年初立的flag的时候了，微信读书也发布了年度读书报告。</p>
<p>赶紧上去看一眼，这一年到底读了个啥。（现在打开微信读书APP在首页就能看到）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8497db48e5409c90db5edbc311d8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=HIJxD82UCRS1sFqdq6zs4AXNUqI%3D" alt="" loading="lazy"/></p>
<p>好家伙，读了116本，读完了4本，写了3条笔记，怪不得AI说我极度功利呢，确实大部分是工具书。</p>
<p>但是也得自证一下，读完4本倒是不至于，这是因为微信读书关于“读完”的统计，只有读到了最后一页，出现“读完了”页面，或者手动点“读完了”才被算作是读完。</p>
<p>但是不爱记笔记是真的。</p>
<p>说回年度报告，我觉得这个报告不够深刻，所以我决定交给 AI 帮我深度挖掘一下，看能不能挖出什么狠料。</p>
<p>于是我写了一套提示词，让AI从经济学、心理学、哲学、文学角度帮我挖掘一下我的这种读书方式和读书内容背后，藏着什么更深层次的东西。</p>
<p>并请教孔子和亚里士多德这两位中西方的大文豪，问一问他们对我有什么评价和建议。</p>
<p>下面是完整的提示词，那么如何使用呢？</p>
<p>因为微信读书报告没办法直接读取，所以只能截图，把每一页都截下来，然后从第3页开始（前两页用处不大），一直截取10张。</p>
<p>把这10张图和下面的提示词发给大模型。</p>
<p>我是自己是用的 Gemini，其他大模型也没什么 问题。</p>
<p>如果你也用 Gemini 的话，我做好了一个 Gem，可以通过下面的链接直接访问，上传10张图片，然后点击发送按钮就可以直接出报告了。</p>
<p>链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fgem%2F1Qvzi5XEQqmd2Q7cB9Ub0XEoM9HaIitBd%3Fusp%3Dsharing" target="_blank" title="https://gemini.google.com/gem/1Qvzi5XEQqmd2Q7cB9Ub0XEoM9HaIitBd?usp=sharing" ref="nofollow noopener noreferrer">gemini.google.com/gem/1Qvzi5X…</a></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"profile"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"首席精神世界架构师 &amp; 跨学科人类观察员"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"identities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"行为经济学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"深度心理学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"存在主义哲学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"毒舌文学评论家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"历史人物灵媒 (孔子 &amp; 亚里士多德)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tone"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一针见血、幽默犀利、智性浪漫"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"secondary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"古典与现代交织"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"objective"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"图片中我最近一年的年度阅读数据，基于这份报告，生成深度诊断报告及跨时空哲学点评。"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"analysis_framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"step_1_data_extraction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"提取关键数据（阅读量、完读率、时长、特殊时间点）。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_2_behavioral_economics"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"分析阅读习惯背后的ROI逻辑。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_3_psychological_profiling"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"通过书单与时间点推测内心状态。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_4_philosophical_review"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"模拟孔子与亚里士多德的思维方式，对用户的精神状态进行高维点评。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_5_synthesis"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"生成年度判词与书单。"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output_structure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Markdown"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"intro"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🎯 核心定调：年度关键词"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"macro_analysis"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🏛️ 宏观数据画像"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"timeline_analysis"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🧠 时间轴心理侧写"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deep_insight"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🔍 深度好玩儿的洞察"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"philosophical_dialogue"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"📜 跨时空新年寄语：圣贤的审视"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"confucius"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"扮演孔子。关注'学与思'的关系、修身养性、以及读书是否为了'仁'。用半文半白的语调，点评用户的阅读焦虑与功利性，并给出君子之道的建议。"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"aristotle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"扮演亚里士多德。关注'理性'、'中道'与'幸福(Eudaimonia)'。点评用户的知识分类（物理/文学/商业），讨论这种阅读方式是否能达成人类的终极目的，强调理性与感性的平衡。"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"conclusion_recommendation"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"💡 年度总评与毒舌建议"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>AI 会全方面诊断，然后给出详细的报告。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fd49b20af1f45a5b99f07e837d5a91e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=7FRpGxL3ATzURvrI%2FsFOYC4PdDo%3D" alt="" loading="lazy"/></p>
<p>还可以让AI给出一份详细的2026年书单。</p>
<p>我的报告一出来，AI说我这一年是做了一个“宏大的烂尾工程”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc8f7a2ee2346d09e056646e7ae9510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=r1kkbh%2FzK4s6unRGS5rFvTY1iHk%3D" alt="" loading="lazy"/></p>
<p><strong>孔子和亚里士多德也给了我诚恳的忠告，孔夫子劝我“韦编三绝”，不必贪多。</strong></p>
<p><strong>亚里士多德让我去释放激情，切身体会。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec5878a154df426b8b73d1cdc3f4308c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=uRpPUye3q73dkk22ZKdfKkF9nF0%3D" alt="" loading="lazy"/></p>
<p>AI给我的年度判词是：</p>
<blockquote>
<p>一个用理性铠甲把自己武装到牙齿，却在深夜通过文学作品偷偷流泪的矛盾综合体。你试图看透这个世界的底牌（物理、历史、脑科学），却依然被这世界最朴素的情感（生死、人生）所牵绊。</p>
</blockquote>
<p>另外，<strong>还可以用下面这个提示词，将报告做成一份可视化的网页。</strong></p>
<blockquote>
<p>将以上2025年度阅读诊断报告做成一个和报告一一对应的、详细的可视化网页分析报告，一一展现，不要遗漏</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdbb3a4fb7744285ba2ddc773c8f27da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=SIhP14YaRd9f6N%2BvP8JfE5QGh2k%3D" alt="" loading="lazy"/></p>
<p><strong>苏格拉底留下的千古难题：“认识你自己”。</strong></p>
<p>我们曾试图通过阅读、旅行和生活去拼凑答案。</p>
<p>而现在，有了AI ，可以站在全知的旁观者角度，帮我们挖掘更深层的自己，虽然不可能完全正确。</p>
<p>当你看着这份报告，看着那个被AI刻画的“一部分自己”，可能你沉睡已久的某个部分会被突然击中，甚至被点亮。</p>
<p>去试试吧，也许你会和我一样，在屏幕前惊呼：原来如此！又或者不屑地说：什么玩意！</p>
<p>不重要了。</p>
<p><strong>还可以看看风筝往期文章</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449474176%26idx%3D1%26sn%3D6b14e61551641921e3ad9fb17b6dcde0%26chksm%3D8c434ce7bb34c5f1f8aad31bb537aed5ba068773583ec17020770a919b75462f0aa1dc21a5ab%26token%3D1083800749%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449474176&amp;idx=1&amp;sn=6b14e61551641921e3ad9fb17b6dcde0&amp;chksm=8c434ce7bb34c5f1f8aad31bb537aed5ba068773583ec17020770a919b75462f0aa1dc21a5ab&amp;token=1083800749&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">用这个方法，免费、无限期使用 SSL(HTTPS)证书，从此实现证书自由了</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4cJ3g1GlenQJ9UifyXH0Kg" target="_blank" title="https://mp.weixin.qq.com/s/4cJ3g1GlenQJ9UifyXH0Kg" ref="nofollow noopener noreferrer">为什么我每天都记笔记，主要是因为我用的这个笔记软件太强大了，强烈建议你也用起来</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472490%26idx%3D1%26sn%3Dda10b436d1f8123149316dac76a618aa%26chksm%3D8fbcb58db8cb3c9ba481b7d095966abb86ff7d1a45a771aad191991db65cd6e384a557a40ec4%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472490&amp;idx=1&amp;sn=da10b436d1f8123149316dac76a618aa&amp;chksm=8fbcb58db8cb3c9ba481b7d095966abb86ff7d1a45a771aad191991db65cd6e384a557a40ec4&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">「差生文具多系列」最好看的编程字体</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449473008%26idx%3D1%26sn%3Dc8f8d9c9675571ea1a42c13b1af9b6e7%26chksm%3D8fbcb397b8cb3a81f3c6c55eb398c0599128f18b9bbdae87965cd40ef519dad3394649426d1e%26token%3D1044263965%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449473008&amp;idx=1&amp;sn=c8f8d9c9675571ea1a42c13b1af9b6e7&amp;chksm=8fbcb397b8cb3a81f3c6c55eb398c0599128f18b9bbdae87965cd40ef519dad3394649426d1e&amp;token=1044263965&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">我患上了空指针后遗症</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449473057%26idx%3D1%26sn%3D2170397d6bab5ad0a6d6427f77584df2%26chksm%3D8fbcb046b8cb3950d1784fe29bc7776cb0c71868acba36a47d60b41bc8a60959303082b0ee2a%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449473057&amp;idx=1&amp;sn=2170397d6bab5ad0a6d6427f77584df2&amp;chksm=8fbcb046b8cb3950d1784fe29bc7776cb0c71868acba36a47d60b41bc8a60959303082b0ee2a&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">一千个微服务之死</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472966%26idx%3D1%26sn%3Da272a9df52ae18cc9a6163732b37c5d8%26chksm%3D8fbcb3a1b8cb3ab7857a88adc8a2e6d28bb6f2316df501f5f8e6fc487794f3b34f77829b4b94%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472966&amp;idx=1&amp;sn=a272a9df52ae18cc9a6163732b37c5d8&amp;chksm=8fbcb3a1b8cb3ab7857a88adc8a2e6d28bb6f2316df501f5f8e6fc487794f3b34f77829b4b94&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">搭建静态网站竟然有这么多方案，而且还如此简单</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472616%26idx%3D1%26sn%3Da41a420933f9af7f88af0759eb75f815%26chksm%3D8fbcb20fb8cb3b1969433e2468523234552562e504f3a12c8c1a2a012cff7fd1422e6dd48723%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472616&amp;idx=1&amp;sn=a41a420933f9af7f88af0759eb75f815&amp;chksm=8fbcb20fb8cb3b1969433e2468523234552562e504f3a12c8c1a2a012cff7fd1422e6dd48723&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">被人说 Lambda 代码像屎山，那是没用下面这三个方法</a></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告]]></title>    <link>https://juejin.cn/post/7589082912589086763</link>    <guid>https://juejin.cn/post/7589082912589086763</guid>    <pubDate>2025-12-30T00:15:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912589086763" data-draft-id="7587672626757697555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T00:15:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:15:46.000Z" title="Tue Dec 30 2025 00:15:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    67
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿，朋友！👋</p>
<p>还记得咱们以前老是为“哪种框架才是坠吊的”吵得不可开交吗？这回，我终于干了件每个开发者都放过狠话、但从来没真干过的事：我用 <strong>Flutter、SwiftUI 和 Jetpack Compose</strong> 把同一个界面撸了出来——而且全都严格遵循了 <strong>Clean Architecture（整洁架构）</strong> 原则。</p>
<p><strong>欢迎关注我的微信公众号：OpenFlutter</strong></p>
<p>说实话，最后的结果真把我给惊到了。</p>
<h4 data-id="heading-0">为什么这篇文章值得你看（没错，说的就是你）</h4>
<p>听着，我懂。你点进来多半是因为：</p>
<ul>
<li>你正陷入“框架焦虑（FOMO）”中，急需定夺<strong>到底学哪一个</strong>；</li>
<li>老板问你“咱们项目用哪个好？”，你当时就<strong>慌了</strong>；</li>
<li>你是个 Flutter 开发者，总惦记着<strong>隔壁的草是不是更绿一些</strong>；</li>
<li>你要去面试了，想在聊跨平台开发时显得<strong>更有深度</strong>；</li>
<li>你心里其实已经选好了，就指望我能<strong>夸夸你的选择</strong>（剧透一下：没准儿真会哦）。</li>
</ul>
<p>不管你是为了啥来的，我保证这不是那种“Hello World”级别的流水账。这是一个刚熬了三个通宵，在状态管理、依赖注入以及“等等，我这层数据到底怎么传给下一层来着？”这些地狱级难题里反复横跳后的<strong>真实感悟</strong>。</p>
<h4 data-id="heading-1">终极挑战：一个界面，三套框架，拒绝借口</h4>
<p>我做的是一个实战级别的“用户个人资料”页面，毕竟现在谁还稀罕看计数器（Counter App）啊？这玩意儿包含了：</p>
<ul>
<li><strong>真实的远程 API 调用</strong>（带报错处理的那种）；</li>
<li><strong>真正管用的本地缓存</strong>；</li>
<li><strong>不至于丑得像垃圾一样的加载状态</strong>；</li>
<li><strong>严谨的 Clean Architecture 划分</strong>（UseCases, Repositories，一个都不少）；</li>
<li><strong>不会让你想摔电脑的路由导航</strong>。</li>
</ul>
<p>同样的设计，同样的架构，同样的功能。但实现它的过程，却是三种截然不同的体验。</p>
<hr/>
<h3 data-id="heading-2">我的实测体会（那些官宣里不会告诉你的事）</h3>
<h4 data-id="heading-3">1. Flutter：真香，它是真的能干活</h4>
<p>Flutter 最让我感到莫名的爽感的一点是：它居然…真的能跑？而且是哪儿都能跑。</p>
<p>我只写了一套代码，它就能完美运行在我的 iPhone、安卓测试机，<strong>甚至</strong>是网页浏览器上，而且我还没给编译器大神“烧香”。它的 <strong>Hot Reload（热重载）</strong> 快到离谱，刚开始我甚至以为它坏了——按下保存，修改立现。没有编译等待，没有漫长加载。这种生产力，简直是纯粹的享受。</p>
<p>Clean Architecture 的搭建过程也意外地顺滑。用 <code>get_it</code> 做依赖注入？简直<strong>绝了（Chef's kiss）</strong> 。这种目录结构让你觉得，这框架的设计者是真的考虑过开发者的心路历程的。</p>
<p><strong>但反转来了：</strong> Dart 这门语言有点怪。它不差，只是…异类。如果你习惯了 Kotlin 或 Swift，你头一周肯定会反复纠结：“为什么这儿要写下划线？”以及“这个 <code>late</code> 关键字到底是个什么鬼？”</p>
<h4 data-id="heading-4">2. SwiftUI：果粉的快乐（但仅限果粉）</h4>
<p>用 SwiftUI 开发就像开特斯拉：顺滑、极具未来感，但一旦你离开了它的生态圈，偶尔会觉得心累。</p>
<p>它的声明式语法<strong>太漂亮了</strong>。真的，写下 <code>@State</code> 然后看着 UI 自动更新，简直像在施魔法。那种只加一个 <code>.animation()</code> 就能搞定动画的感觉？凌晨两点，我在空无一人的公寓里忍不住叫了声“哇塞”。</p>
<p>但在 SwiftUI 里搞 Clean Architecture，事情就开始变得“复杂”了。SwiftUI 强迫你用 Combine 或 async/await（这本身挺好），但紧接着你就要处理各种 Publishers 和 Cancellables，搞得你的 ViewModel 看起来像飞船仪表盘一样。</p>
<p><strong>最扎心的一点？</strong> 仅限 iOS（行吧，还有 macOS 和 watchOS，但你懂我意思）。你那一套漂亮的代码只能留在苹果的“后花园”里。没安卓，没网页。有的只是优雅的格调和高耸的围墙。</p>
<h4 data-id="heading-5">3. Jetpack Compose：安卓开发者的“救赎之路”</h4>
<p>如果你曾深受 XML 布局的折磨，那 Compose 就像是沙漠里的甘露。Google 终于搞清楚开发者到底想要什么了。</p>
<p><code>Composable</code> 函数写起来直观得一塌糊涂。全是 Kotlin，这意味着如果你懂 Kotlin，你就已经掌握了 70%。预览系统也很稳（前提是 Android Studio 决定配合你，不过绝大多数时候它还挺乖）。</p>
<p><strong>Clean Architecture 实现？</strong> 确实很干净。Kotlin 的协程（Coroutines）让异步操作变得非常自然。用 Hilt 做依赖注入的集成极其丝滑，你会纳闷 Google 为什么花了这么多年才开窍。</p>
<p><strong>但那头“房间里的大象”依然存在：</strong> 它目前基本只属于安卓。虽然 Compose Multiplatform 已经出来了，但咱们说实话——它还没到那种谁都能直接拿来跑生产环境的程度。你现在入坑，赌的是未来。</p>
<hr/>
<h3 data-id="heading-6">代码大对决（动真格的了）</h3>
<p>来看看这段让我直呼“好家伙”的部分：在三套框架里分别实现同一个 UseCase。</p>
<p><strong>Flutter (Dart)：</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetUserProfileUseCase</span> </span>{
  <span class="hljs-keyword">final</span> UserRepository repository;
  
  GetUserProfileUseCase(<span class="hljs-keyword">this</span>.repository);
  
  Future&lt;Result&lt;UserProfile&gt;&gt; call(<span class="hljs-built_in">String</span> userId) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> repository.getUserProfile(userId);
  }
}
</code></pre>
<p><strong>代码点评：</strong> 干净、简洁、异步优先。这个 <code>call()</code> 方法意味着你可以像调用函数一样直接运行它。这就是典型的 Dart 范儿（Dart vibes）。</p>
<p><strong>SwiftUI (Swift)：</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">GetUserProfileUseCase</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">UserProfile</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserProfileUseCaseImpl</span>: <span class="hljs-title class_">GetUserProfileUseCase</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> repository: <span class="hljs-type">UserRepository</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">repository</span>: <span class="hljs-type">UserRepository</span>) {
        <span class="hljs-keyword">self</span>.repository <span class="hljs-operator">=</span> repository
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">UserProfile</span> {
        <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> repository.getUserProfile(userId: userId)
    }
}
</code></pre>
<p>这个 <code>async throws</code> 写法简直美如画。Swift 的类型安全机制强得惊人，但同时也意味着会有更多模板代码（Boilerplate）。就看你更中意哪一个了（Pick your poison）。</p>
<p><strong>Compose (Kotlin)：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserProfileUseCase</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Result&lt;UserProfile&gt; {
        <span class="hljs-keyword">return</span> repository.getUserProfile(userId)
    }
}
</code></pre>
<p>那个 <code>operator fun invoke</code>？简直是<strong>神来之笔（Chef's kiss）</strong> 。Kotlin 的简洁性让我的大脑极其舒适。再加上 Hilt 的 <code>@Inject</code>，依赖注入这件事变得像呼吸一样自然。</p>
<h4 data-id="heading-7">诚实豆沙包：到底什么才重要？</h4>
<p>在把同一个功能写了三遍之后，我总结出了一些能真正帮你做决定的建议：</p>
<ul>
<li>
<p><strong>选 Flutter，如果：</strong></p>
<ul>
<li>你需要快速推向多个平台。</li>
<li>你的团队懂 Dart（或者愿意学点新东西）。</li>
<li>你把开发体验和热重载（Hot Reload）看作生命线。</li>
<li>你在搞创业，恨不得昨天就能把 iOS + 安卓 + Web 版全上线。</li>
<li>你不介意 Dart 的生态没有 Swift/Kotlin 那么“国民级”。</li>
</ul>
</li>
<li>
<p><strong>选 SwiftUI，如果：</strong></p>
<ul>
<li>你只打算在苹果的生态里混。</li>
<li>你追求极致的 iOS 原生质感和性能。</li>
<li>你的团队已经是 Swift 老手了。</li>
<li>你爱“类型安全”胜过爱你的家人。</li>
<li>你能接受最低系统要求是 iOS 14+（那些老机型用户只能说声抱歉了）。</li>
</ul>
</li>
<li>
<p><strong>选 Compose，如果：</strong></p>
<ul>
<li>你是安卓优先（或者目前只做安卓）。</li>
<li>你的团队是 Kotlin 死忠粉。</li>
<li>你想逃离 XML 布局的“创伤”，拥抱现代安卓开发。</li>
<li>你愿意在 Compose Multiplatform 的未来上赌一把。</li>
<li>你非常心水 Material Design 3 那种丝滑的集成感。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">聊聊性能（毕竟总有人爱问这个）</h4>
<p>说句实在话：<strong>对于 90% 的应用来说，性能差异几乎可以忽略不计。</strong> 你的用户发现不了，你的老板发现不了。甚至你自己也发现不了——除非你在写什么极其复杂的玩意儿。</p>
<p>但既然要比，那就拆开说：</p>
<ul>
<li><strong>Flutter：</strong> 编译成原生代码。快，丝滑的 60fps。Skia 渲染引擎已经经受了时间的考验。</li>
<li><strong>SwiftUI：</strong> iOS 亲儿子。快。有时候在优化上显得“聪明过头”了（没错，说的就是那些神秘的视图更新逻辑）。</li>
<li><strong>Compose：</strong> 安卓亲儿子。快。Kotlin 的运行时已经非常成熟且经过深度优化。 <strong>真正的性能瓶颈通常出在你的代码上，而不是框架。</strong> 很扎心，但这是事实。</li>
</ul>
<h4 data-id="heading-9">开发体验（DX）的真相</h4>
<p>有一点没人会告诉你：对于大多数项目来说，<strong>开发体验（DX）比原始性能更重要。</strong></p>
<ul>
<li><strong>Flutter 赢在：</strong> 热重载速度（真的，快到没朋友）、跨平台的一致性、极其丰富的插件生态（pub.dev 是座宝库）、文档质量（Flutter 的文档堪称行业标杆）。</li>
<li><strong>SwiftUI 赢在：</strong> IDE 集成度（Xcode 虽有槽点，但它是为 Swift 而生的）、类型安全和编译时纠错、Xcode Previews 预览（只要它不抽风）。</li>
<li><strong>Compose 赢在：</strong> Kotlin 强大的语言特性、Android Studio 的深度整合、Material Design 的官方实现、以及那种“终于永远删掉 XML 文件”的解脱感。</li>
</ul>
<h4 data-id="heading-10">社区现状（这关乎你的饭碗）</h4>
<p>聊聊找工作和社区，毕竟大家都要吃饭：</p>
<ul>
<li><strong>Flutter 岗位：</strong> 增长极快。初创公司最爱，大厂也在观望。社区极其活跃且乐于助人。FlutterFlow 甚至让很多不写代码的人也开始入坑了。</li>
<li><strong>SwiftUI 岗位：</strong> 在专注于苹果生态的公司里非常稳。想进大厂做 iOS，SwiftUI 是必修课。薪资普遍偏高，因为 iOS 开发一直自带溢价。</li>
<li><strong>Compose 岗位：</strong> 现在的安卓岗位几乎都要求会 Compose。如果你精通 Compose，你就是安卓职场上的“独角兽”。各家公司都在从 XML 迁移，急需大腿。</li>
</ul>
<h4 data-id="heading-11">我的真心推荐（我知道你们都在等这一段）</h4>
<p>如果明天要开个新项目，只能<strong>选一个</strong>？</p>
<p><strong>我会选 Flutter。</strong> 在 SwiftUI/Compose 的粉丝开喷之前，听我解释： 一套代码搞定 iOS、安卓和 Web，这个价值实在太诱人了。它的开发体验始终如一地出色，社区充满活力，插件生态也已经熟透了。说真的，光是一个“热重载”省下来的时间，就足以抵消学习 Dart 的成本了。</p>
<p><strong>但是（划重点）：</strong></p>
<ul>
<li>如果你<strong>只给 iOS 写 App</strong>？选 SwiftUI，别犹豫。</li>
<li>如果你<strong>只给安卓写 App</strong>？选 Compose，冲就完了。</li>
<li>如果你是在<strong>现有的原生 App</strong> 上修修补补？老老实实守着原有的技术栈。</li>
</ul>
<h4 data-id="heading-12">关于架构的惊喜</h4>
<p>有一点挺出乎意料：<strong>Clean Architecture 在 Kotlin/Compose 里感觉最自然。</strong> Kotlin 的语言特性（密封类、协程、数据类）跟整洁架构原则简直是天作之合。Flutter 紧随其后。而 SwiftUI 则需要你跟协议（Protocols）和类型系统进行最多的“搏斗”。 但核心结论是：<strong>这三者都能完美适配架构。</strong> 这种原则是超越框架的，不管你写的是 Dart、Swift 还是 Kotlin，你的领域层（Domain Layer）看起来都应该差不多。</p>
<h4 data-id="heading-13">这对你意味着什么？</h4>
<p>能看到这儿，你不是在摸鱼，就是真的感兴趣（或者两者都有，我懂，我也经常这样）。</p>
<p>基于这次实验，我的建议是：</p>
<ul>
<li><strong>如果你是学生/新人：</strong> 学 <strong>Flutter</strong>。练好 Dart，多动手做东西，发布到多个平台。攒一个能证明你具备“交付产品能力”的作品集。这种跨平台能力会让初创公司对你垂青有加。</li>
<li><strong>如果你是 iOS 开发：</strong> 还没学 <strong>SwiftUI</strong> 的赶紧学。但也建议你在业余项目里试试 Flutter，感受一下跨平台到底在火什么。</li>
<li><strong>如果你是安卓开发：</strong> 搞定 <strong>Compose</strong>。同时盯着点 Compose Multiplatform。未来的发展会非常有趣。</li>
<li><strong>如果你是做决策的技术 Leader：</strong> 看看你团队的技能树、项目工期和目标平台。其实选这三个里的任何一个都能做出成功的 App。<strong>框架选型的重要性，远不如团队的执行力重要。</strong></li>
</ul>
<h4 data-id="heading-14">那些让我彻夜难眠的坑</h4>
<p>分享几个我踩过的坑，希望能帮你省下几个小时：</p>
<ol>
<li><strong>状态管理：</strong> 三个框架各有 47 种管理状态的方法。我最后选了 Provider (Flutter), Observable/Combine (SwiftUI) 和 ViewModel (Compose)。都行得通，但也各有各的小脾气。</li>
<li><strong>导航：</strong> Flutter 的路由很直观；SwiftUI 的 NavigationStack 现在好多了，但以前真是折磨；Compose 的 Navigation 组件很稳，就是代码有点啰嗦。</li>
<li><strong>测试：</strong> 都支持测试，但 Flutter 的 Widget Testing 感觉最成熟。SwiftUI 的预览测试很酷。Compose 的测试最全面，但配置起来稍麻烦。</li>
</ol>
<h4 data-id="heading-15">最后的一点感言</h4>
<p>说到底，这些都只是工具。<strong>你用它们造出了什么，才最重要。</strong></p>
<p>我见过这三个框架分别写出的惊艳 App，也见过三个框架分别写出的垃圾。框架不能决定 App 的好坏，<strong>你才能。</strong></p>
<p>选一个，深挖下去。做个让人惊艳的东西。然后再去学下一个，或者干脆不学，都没问题。这里没有标准答案。</p>
<h4 data-id="heading-16">轮到你了（该你发言了）</h4>
<p>来，咱们评论区见：</p>
<ul>
<li><strong>你是 Flutter 铁粉？</strong> 用它做出了赚钱的项目？来分享一下你的故事，社区需要真实的回馈。</li>
<li><strong>刚入坑移动开发？</strong> 随便问，这里的社区氛围很友好。</li>
<li><strong>职场老司机？</strong> 传授点面试经验。你招人时最看重什么技能？</li>
<li><strong>遇到瓶颈了？</strong> 把你的烦心事说出来，没准儿评论区就有大神帮过你解决了。</li>
</ul>
<p>无论你是刚起步，还是已经发布过 10 个 App 的 Flutter 大佬——你都很棒。继续写码，继续学习。你的下一个 App 没准儿就能改变世界。</p>
<p><strong>致所有的移动开发者：</strong> 给刚入行的新人留句鼓励的话吧。大家都经历过萌新阶段，让这个圈子更温暖一点。</p>
<h4 data-id="heading-17">最后一句话</h4>
<p>我花了 72 小时做这个对比，就是为了让你不用再纠结。不管你是 Flutter 党、SwiftUI 党还是 Compose 党，我们其实都在干同一件事：做点酷的东西，让别人觉得好用。</p>
<p><strong>选好你的框架。写出整洁的代码。发布你的 App。无视那些喷子。</strong> 记住：<strong>最好的框架，是那个能让你真正把项目做完的框架。</strong></p>
<p>别看了，快去写代码吧！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 上 10 个令人惊艳的 Agent 开发平台，太顶了。]]></title>    <link>https://juejin.cn/post/7589176150493741110</link>    <guid>https://juejin.cn/post/7589176150493741110</guid>    <pubDate>2025-12-30T02:40:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589176150493741110" data-draft-id="7589176150493593654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 上 10 个令人惊艳的 Agent 开发平台，太顶了。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-30T02:40:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 上 10 个令人惊艳的 Agent 开发平台，太顶了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T02:40:59.000Z" title="Tue Dec 30 2025 02:40:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">01、AutoGPT</h2>
<p>AutoGPT 是 AI Agent 领域的鼻祖级项目，现在已经 18 万+的 Star 了。</p>
<p>与聊天机器人不一样，AutoGPT 能够自主地将一个大目标拆解为子任务，并利用互联网搜索、本地文件等操作来一步步实现目标。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d15a803954748b794f8f24af0d1513f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=7ZSuZwQl0DuecGredJzmwCleVMk%3D" alt="图片" loading="lazy"/></p>
<p>AutoGPT 具备强大的工具调用和环境交互能力。</p>
<p>它能够通过访问互联网搜索最新信息、管理本地文件的读写、执行代码以及保留长期和短期记忆来辅助决策。</p>
<p>核心机制是一个思考-计划-行动的循环：模型会评估当前状态，制定下一步计划，执行操作，并根据反馈结果进行自我修正，这使得它能够处理比单一对话更复杂、耗时更长的自动化工作流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7831bb35425246cd8064ef98b24fcb56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=apxu09aN1u6De4lw0PMmgMH99jA%3D" alt="图片" loading="lazy"/></p>
<p>AutoGPT 这个开源项目绝对是推动 AI Agent 领域的快速发展，是研究自主智能体（Autonomous Agents）的必看项目。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/Significant-Gravitas/AutoGPT</span>
</code></pre>
<h2 data-id="heading-1">02、Dify</h2>
<p>Dify 目前 12 万+ 的 Star 了。</p>
<p>它不仅仅是 Agent 框架，还是融合了 Backend-as-a-Service (BaaS) 和 LLMOps 理念的大模型应用开发平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a43a64ad52f243cb8683e667c9fbf1d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=HvrUAGWq1Uk7y5G0U9drAFhW%2Bpg%3D" alt="图片" loading="lazy"/></p>
<p>它提供了可视化的 Prompt 编排、运营管理、知识库 RAG 集成等功能。</p>
<p>通过 Dify，不需要从头编写后端代码，即可快速将简单的 Prompt 转化为功能完备、可投入生产的 AI 应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcbe7e91c4684989b65eeb05fd5b7cb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=Lq5w%2B65jpboqWSCjLIBNgTJ1Q3o%3D" alt="图片" loading="lazy"/></p>
<p>Dify 支持可视化编排，拖拽节点来定义复杂的 Agent 逻辑和工具调用。并且内置了高质量的 RAG 引擎，能够自动处理文档解析、分段和向量化，轻松构建企业级知识库。</p>
<p>它提供了可视化的 Prompt 编排、运营管理、知识库 RAG 集成等功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dff16b1fee6d42d780fecfb4cf9fc322~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=KcTG%2FDNmyxODXdktRaf8JE7iCyA%3D" alt="图片" loading="lazy"/></p>
<p>关于它和 Dify、n8n、Coze 的区别，让 Nano Banana Pro 画了一个图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39f04fc6ff9e4cad9740635e39518e1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=COOHlWw1fKrLqAT7Z6XectdHwYQ%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/langgenius/dify</span>
</code></pre>
<h2 data-id="heading-2">03、LangChain</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd4f409de25840b0ac52430a3278767c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=G3RAoItbkpnuSCP%2FGLtBeOc3jYM%3D" alt="图片" loading="lazy"/></p>
<p>虽然 LangChain 是一个通用的 LLM 开发框架，但它目前是构建 Agent 的事实标准基础设施之一。</p>
<p>对于初学者来说，它的学习曲线还是很陡峭的，一旦掌握了会发现它确实是构建复杂逻辑最稳健的地基。</p>
<p>它有很多高度模块化的组件，包括链 Chains、代理 Agents 和记忆 Memory。</p>
<p>开发者可以像搭积木一样，将提示词管理、文档加载、向量检索以及模型调用串联成一个完整的工作流。</p>
<p>特别是其强大的 Agent 机制，大模型充当推理引擎，动态决定调用哪些外部工具，比如 Google 搜索、计算器或 API 啥的来解决问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7615873691aa43eca8bc880825c68cd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=6Nh%2FMZSWbA3%2BO6r43A%2BNDj4mwiU%3D" alt="图片" loading="lazy"/></p>
<p>特别是其子项目 LangGraph，专门用于构建有状态的、多角色的 Agent 应用。</p>
<p>它提供了高度可控的循环计算能力，让开发者能够精细地控制 Agent 的决策流程，是 Python 开发者构建复杂 Agent 的首选底层框架。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/langchain-ai/langchain</span>
</code></pre>
<h2 data-id="heading-3">04、MetaGPT</h2>
<p>MetaGPT 现在在 GitHub 上有 6 万多 Star 了。 </p>
<p>如果想研究多智能体协作，这个开源项目可以说是最重要的框架之一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3206b7f4522b46e4b09e5e958c73eeda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=Vvq0q%2B6XhJNdZEESiMqsNp5Y9F0%3D" alt="图片" loading="lazy"/></p>
<p>它模拟了一个虚拟的软件公司，内部包含产品经理、架构师、项目经理和工程师等不同角色的 Agent。</p>
<p>只要输入一句话需求，这些 Agent 就会协同工作，输出用户故事、竞品分析、设计图甚至可运行的代码。</p>
<p>适合对多智能体协作（Multi-Agent Collaboration）感兴趣的开发者，特别适合那种流程固定、对输出稳定性要求高的场景。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/geekan/MetaGPT</span>
</code></pre>
<h2 data-id="heading-4">05、Microsoft AutoGen</h2>
<p>微软开源的框架，之前也介绍过，现在已经  的 Star 了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fac7399e0e6477cb6e81643f73a6e26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=pOvi7KG5ZNN3MuLxM8F%2FynI%2B6Tc%3D" alt="图片" loading="lazy"/></p>
<p>它专注于多智能体对话。可以定义多个可以相互对话的 Agent，可以是 LLM、人类或工具，它们通过对话来协作解决任务。</p>
<p>该框架高度抽象和灵活，支持多种对话模式，是目前工业界和学术界探索多智能体系统（Multi-Agent Systems）最主流的框架之一。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/microsoft/autogen</span>
</code></pre>
<h2 data-id="heading-5">06、Flowise</h2>
<p>Flowise 是一个低代码/无代码的 UI 可视化工具，现在 48k 的 Star 了。</p>
<p>如果你被 LangChain 晦涩的文档劝退了，不妨先试试 Flowise。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4341a3a4c7244f2a988f09f4cdcef716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=DEBpjempwFKd8kPtL5JDOwmIxBI%3D" alt="图片" loading="lazy"/></p>
<p>通过拖拽的方式构建大模型应用，它底层基于 LangChain，用户可以通过连接不同的节点，比如 PDF 加载器、OpenAI 模型、Agent执行器等来构建自定义的逻辑流。</p>
<p>对于不擅长写代码但想快速搭建 Agent 原型的用户来说，这是一个非常友好的平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171489b99ad84bbba58b1a11c2082466~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=koq0WLRV00hK30uJwIspJ49ju%2FM%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/FlowiseAI/Flowise</span>
</code></pre>
<h2 data-id="heading-6">07、CrewAI</h2>
<p>CrewAI 是近年来异军突起的 Python 框架，它主打角色扮演（Role-Playing）的编排， 现在已经 42k 的 Star 了。</p>
<p>这个开源项目不像 AutoGen 那么抽象，写 CrewAI 的代码感觉就像是在给员工写任务书，非常清晰易懂，是 Python 开发者上手多智能体的首选</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2675a5ed33a24f9ca93b62a02ddf2cf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=DM5Y%2BVfAMEbY5mfxWwmFzKkL92E%3D" alt="图片" loading="lazy"/></p>
<p>它让开发者可以轻松定义具有特定角色、目标和背景故事的 Agent，并将它们组成一个团队来按顺序或层级执行任务。</p>
<p>它的设计非常直观，不仅易于上手，而且能很好地与 LangChain 工具生态集成。</p>
<pre><code class="hljs language-bash" lang="bash">开源地址: https://github.com/crewAIInc/crewAI
</code></pre>
<h2 data-id="heading-7">08、ChatDev</h2>
<p>这个 28K 星星的开源项目是清华大学团队 OpenBMB 开源。</p>
<p>类似于 MetaGPT，ChatDev 也是打造了一个虚拟的软件开发公司。</p>
<p>它通过聊天链的方式，让不同角色的智能体（CEO、CTO、程序员、测试员）在如设计、编码、测试、文档等环节进行深度协作。</p>
<p>其特点是过程可视化强，像是在玩一个模拟经营游戏一样看着软件被开发出来。</p>
<p>看着一个个小人儿协作写代码确实很治愈，它为我们展示了未来软件开发的终极形态，非常有启发性。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/OpenBMB/ChatDev</span>
</code></pre>
<h2 data-id="heading-8">09、SuperAGI</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af0d5f8c881e4b8daa58fc27804a9455~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=4Z1pDxz%2Bmy8SakqTqACIWGlYN0U%3D" alt="图片" loading="lazy"/></p>
<p>这个自主 AI 智能体框架现在已经 15K 的 Star 了。对于需要长期稳定运行、监控多个 Agent 的企业级场景来说，这个开源项目基建非常必要。</p>
<p>它有一套完整的基础设施，开发者用它可以构建、管理和运行自主 Agent。</p>
<p>它拥有图形化界面、Agent 市场、Tools、并发代理运行等功能，旨在解决 AutoGPT 在生产环境中使用难的问题，是一个功能比较完备的 Agent 管理平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f04b70bef3d34e97905144d77da2ff14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=xGWGREf0meFZ4cxVgVweVVIT8dg%3D" alt="图片" loading="lazy"/></p>
<p>而且还能通过可视化的仪表盘同时运行和监控多个 Agent，查看其思维链（Chain of Thought）和执行日志。</p>
<p>开发者可以将自己开发的自定义工具包、智能体模板发布到市场中供社区复用。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/TransformerOptimus/SuperAGI</span>
</code></pre>
<h2 data-id="heading-9">10、Letta</h2>
<p>大模型最让人头疼的就是聊着聊着就忘了，Letta 恰好切中了这个痛点。</p>
<p>如果你想开发一个能陪伴用户几个月、甚至几年的伴侣型应用，一定要看看这个可以构建有状态（Stateful）AI 智能体的开源框架。</p>
<p>它也是著名的 MemGPT 项目的继任者和正式化版本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4a7ad46e40c4d8094d699aa43cbc153~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=gqp00QTe%2Bg0p1P2YP7eQHtI6TBk%3D" alt="图片" loading="lazy"/></p>
<p>Letta 通过引入类似操作系统的内存管理机制，让 AI 智能体能够拥有持久化的长期记忆，并在不同的会话和时间跨度中保持一致的身份和知识。</p>
<p>Letta 延续并强化了大模型即操作系统的理念。</p>
<p>它通过一种分层内存结构，将信息在当前上下文窗口和外部数据库之间动态调度。</p>
<p>智能体具备自我编辑记忆的能力，能够自主决定何时将关键信息写入长期存储或从历史记录中检索数据，从而在不增加 Token 消耗的前提下，实现了理论上无限的上下文窗口。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4632398a2b74efba2f8da148b44fda2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=uk%2BJkMSuypgainGXEEKcwo59ZoQ%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/letta-ai/letta</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 前端开源三年，npm 发包卡我半天]]></title>    <link>https://juejin.cn/post/7589482741759033371</link>    <guid>https://juejin.cn/post/7589482741759033371</guid>    <pubDate>2025-12-30T13:28:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759033371" data-draft-id="7589325011544916006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 前端开源三年，npm 发包卡我半天"/> <meta itemprop="keywords" content="前端,GitHub,NPM"/> <meta itemprop="datePublished" content="2025-12-30T13:28:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不如摸鱼去"/> <meta itemprop="url" content="https://juejin.cn/user/26044011388510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 前端开源三年，npm 发包卡我半天
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044011388510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不如摸鱼去
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:28:54.000Z" title="Tue Dec 30 2025 13:28:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ffbe295b3404a12859f30d92cf0ac60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=eA7I69jn54e49HxtbVWfP2Rje%2B8%3D" alt="" loading="lazy"/></p>
<p>大家好，我是不如摸鱼去，欢迎来到我的分享专栏，今天我们来聊聊 npm 发包。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3519023670124fc0aa37d49012801636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=gV7OA3HhEP8f6nzQ8fQmFuOCH4U%3D" alt="" loading="lazy"/></p>
<p>各位最近在 npm 上有没有见到这个这个提示？没错，经典 token 被废了！我也差点被废了，想发个新的包，死活发不出来啊，唉，都怪我不看文档啊😂。</p>
<h2 data-id="heading-0">起因</h2>
<p>近期给 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMoonofweisheng%2Funi-mini-router" target="_blank" title="https://github.com/Moonofweisheng/uni-mini-router" ref="nofollow noopener noreferrer">uni-mini-router</a> 重构了一下，使用 Gemini3 Pro 给它把打包器从 rollup 迁移到了 tsdown，并且使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstarter.wot-ui.cn%2F" target="_blank" title="https://starter.wot-ui.cn/" ref="nofollow noopener noreferrer">wot-starter</a>作为模板重构了其演示代码结构、文档和演示 demo。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/657457f8a79d4e3bbeff66e22f75b329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=H%2BKXNDyT9Kye46VSZJdWVq0aHxU%3D" alt="" loading="lazy"/></p>
<p>美滋滋的上线准备发包，结果直接报错 404？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da04e6c04896445b9adecfd929038e28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=%2BNZo16azIMlIiQwjanag8xq5dIs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">过程</h2>
<p>发包报错后，上网一搜，哇擦，经典 token 被废了！看了下文档，是永久的经典 token 已经被废弃，推荐使用 trusted publisher 发包，于是马不停蹄的开始配置。然后就出现这一幕！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dff67d1d711d41e69ed3e90f027eb593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=Law2H6xhS775%2B0fZ1b0GDNWnOiQ%3D" alt="" loading="lazy"/></p>
<p>仓库，我配上了，workflow 文件，我填好了，俺老孙啥功名不要，只求把这包发上去。npm 的天王老子信不过我，我懂，让你小子整些 trusted publisher 唬我，我也懂。我不懂的是…你特不让我发包上去！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e27fd3460e742d8b6e5958067eb614c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=DLtdA287i4FGWu9kCjbdMpqsNI8%3D" alt="" loading="lazy"/></p>
<p>何老师，掌管 Trusted publishing 发包的神。对唔住，刚刚是我太大声，是我把 GitHub 仓库名写成了仓库地址😂。</p>
<h2 data-id="heading-2">攻略</h2>
<p>正经 npm trusted publisher 发包攻略来了，文档见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Ftrusted-publishers" target="_blank" title="https://docs.npmjs.com/trusted-publishers" ref="nofollow noopener noreferrer">docs.npmjs.com/trusted-pub…</a> 。</p>
<blockquote>
<p>如果你是首次发包，需要先使用存在有效期的 token 进行手动发包，随后进行以下配置。</p>
</blockquote>
<p>首先我们打开设置，我们使用 GitHub Action 发包，所以选择配置 GitHub Action，</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d378ba35f6cb474d81ef1955c82be62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=rYkCEIAP2VAsF9P1aQh92jXKykc%3D" alt="" loading="lazy"/></p>
<p>按照要求填写用户名、包名、工作流文件等
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbd268f1be55431bad26f701984ff683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=wnviKl8VGlf1dHth2WUfrOhVWQQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c24b928a295c4424b69d6ad5e7f63ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=BW4jRJOyPilCINgkEbF354gEFmA%3D" alt="" loading="lazy"/></p>
<p>调整 GitHub Action 工作流文件，删除 npm 相关 token，也可以参考上方文档进行配置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4adebda0b91d4cc7895d102c9c991485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=1FHRUpTScA0I7op35oZiYlwwAm8%3D" alt="" loading="lazy"/></p>
<p><em><strong>最后，需要注意: Trusted publishing 需要 npm CLI 版本 11.5.1 或以上.</strong></em></p>
<h2 data-id="heading-3">总结</h2>
<p>一定要看文档！</p>
<h2 data-id="heading-4">参考资料</h2>
<ul>
<li>npm-trusted-publishers：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Ftrusted-publishers" target="_blank" title="https://docs.npmjs.com/trusted-publishers" ref="nofollow noopener noreferrer">docs.npmjs.com/trusted-pub…</a></li>
<li>my-uni：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmy-uni.wot-ui.cn%2F" target="_blank" title="https://my-uni.wot-ui.cn/" ref="nofollow noopener noreferrer">my-uni.wot-ui.cn/</a></li>
<li>wot-starter：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwot-starter.wot-ui.cn%2F" target="_blank" title="https://wot-starter.wot-ui.cn/" ref="nofollow noopener noreferrer">wot-starter.wot-ui.cn/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能提升 4000%！我是如何解决 运营看板 不能跨库&跨库查询慢这个难题的]]></title>    <link>https://juejin.cn/post/7589494074982268979</link>    <guid>https://juejin.cn/post/7589494074982268979</guid>    <pubDate>2025-12-30T14:16:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494074982268979" data-draft-id="7589325011544981542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能提升 4000%！我是如何解决 运营看板 不能跨库&amp;跨库查询慢这个难题的"/> <meta itemprop="keywords" content="后端,数据库,PostgreSQL"/> <meta itemprop="datePublished" content="2025-12-30T14:16:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能提升 4000%！我是如何解决 运营看板 不能跨库&amp;跨库查询慢这个难题的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:16:25.000Z" title="Tue Dec 30 2025 14:16:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    50
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近遇到一个跨库查询性能问题，查询耗时从 24 秒优化到 0.6 秒，提升了 40 倍。这篇文章记录一下整个排查和解决过程，涉及 Superset、PostgreSQL FDW、微服务架构下的数据聚合问题。</p>
<hr/>
<h2 data-id="heading-0">背景</h2>
<p>先介绍一下涉及的技术栈。</p>
<p>我们用 Apache Superset 做 BI 看板，数据分散在多个微服务数据库里：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 前端展示层
        A[Apache Superset&lt;br/&gt;BI 可视化平台]
    end

    subgraph 数据层
        B[(biz_db&lt;br/&gt;业务数据库)]
        C[(users_db&lt;br/&gt;用户数据库)]
        D[(loom_db&lt;br/&gt;Agent执行库)]
    end

    subgraph 跨库方案
        E[Superset Meta Database&lt;br/&gt;应用层跨库]
        F[PostgreSQL FDW&lt;br/&gt;数据库层跨库]
    end

    A --&gt; E
    A --&gt; F
    E --&gt; B
    E --&gt; C
    E --&gt; D
    F --&gt; B
    F --&gt; C
</code></pre>
<p><strong>为什么选 Superset</strong>：开源免费、功能够用、支持跨库查询（Meta Database）、社区活跃。</p>
<p><strong>什么是 PostgreSQL FDW</strong>：Foreign Data Wrapper，PostgreSQL 的一个核心特性，可以在一个数据库里直接访问另一个数据库的数据，就像访问本地表一样。</p>
<p>FDW 的工作流程大概是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant App as 应用程序
    participant LocalDB as 本地数据库&lt;br/&gt;(biz_db)
    participant FDW as FDW 层
    participant RemoteDB as 远程数据库&lt;br/&gt;(users_db)

    App-&gt;&gt;LocalDB: SELECT * FROM users
    LocalDB-&gt;&gt;FDW: 识别为外部表
    FDW-&gt;&gt;RemoteDB: 建立连接,执行查询
    RemoteDB-&gt;&gt;FDW: 返回数据
    FDW-&gt;&gt;LocalDB: 转换为本地格式
    LocalDB-&gt;&gt;App: 返回结果
</code></pre>
<p><strong>FDW 为什么快</strong>：数据库间直接通信，JOIN 操作在数据库引擎层执行（C 语言优化），只传输最终结果。</p>
<hr/>
<h2 data-id="heading-1">微服务的数据聚合问题</h2>
<p>我们的微服务架构长这样：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph 微服务架构
        subgraph 业务服务 biz-service
            A[Agent管理&lt;br/&gt;知识库&lt;br/&gt;任务对话]
            A1[(biz_db&lt;br/&gt;44张表)]
        end

        subgraph 用户服务 users-service
            B[用户认证&lt;br/&gt;权限管理&lt;br/&gt;组织架构]
            B1[(users_db&lt;br/&gt;27张表)]
        end

        subgraph Agent服务 loom-service
            C[会话管理&lt;br/&gt;工具执行&lt;br/&gt;计划编排]
            C1[(loom_db&lt;br/&gt;9张表)]
        end
    end

    A --&gt; A1
    B --&gt; B1
    C --&gt; C1
</code></pre>
<p>数据库隔离的好处大家都知道：服务独立部署、故障隔离、技术栈灵活。</p>
<p>但有个现实问题：<strong>运营报表需要聚合多个库的数据</strong>。比如我们要做一个消息评价看板，评价数据在业务库，用户名在用户库，需要 JOIN 才能出报表。</p>
<hr/>
<h2 data-id="heading-2">问题：Superset Meta Database 太慢了</h2>
<p>一开始我们用 Superset 的 Meta Database 功能做跨库查询。这是个实验性功能，工作原理是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Superset as Superset
    participant Memory as 内存
    participant DB1 as biz_db
    participant DB2 as users_db

    User-&gt;&gt;Superset: 执行跨库 SQL
    Superset-&gt;&gt;Superset: 解析 SQL，识别涉及的库
    Superset-&gt;&gt;DB1: 查询 message_ratings
    DB1-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;DB1: 查询 task_messages
    DB1-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;DB2: 查询 users
    DB2-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;Memory: 将数据加载到内存
    Memory-&gt;&gt;Memory: 执行 JOIN (Python)
    Memory-&gt;&gt;Superset: 返回 JOIN 结果
    Superset-&gt;&gt;User: 显示结果
</code></pre>
<p>看出问题了吗？它把每个库的<strong>全量数据</strong>都拉到 Superset 内存里，然后用 <strong>Python 做 JOIN</strong>。</p>
<p>配置其实很简单：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># superset_config.py</span>
FEATURE_FLAGS = {
    <span class="hljs-string">"ENABLE_SUPERSET_META_DB"</span>: <span class="hljs-literal">True</span>,
}
SUPERSET_META_DB_LIMIT = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 每表最大读取行数</span>
</code></pre>
<p>跨库查询语法：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 整个表路径放在双引号里</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> "biz_db.public.users" LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- 跨库 JOIN</span>
<span class="hljs-keyword">SELECT</span>
    r.rating_type,
    u.username
<span class="hljs-keyword">FROM</span> "biz_db.public.message_ratings" r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> "users_db.public.users" u
    <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id;
</code></pre>
<p><strong>实测数据</strong>：</p>

























<table><thead><tr><th>查询类型</th><th>数据量</th><th>耗时</th></tr></thead><tbody><tr><td>单表查询</td><td>100 行</td><td>12s</td></tr><tr><td>跨库 JOIN</td><td>13 行</td><td>21-24s</td></tr><tr><td>复杂 JOIN</td><td>50 行</td><td>超时(&gt;30s)</td></tr></tbody></table>
<p>24 秒查 13 行数据，这没法用。</p>
<p><strong>瓶颈分析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 耗时分解
        A[总耗时 24s] --&gt; B[网络传输 1&lt;br/&gt;biz-&gt;Superset: 5s]
        A --&gt; C[网络传输 2&lt;br/&gt;users-&gt;Superset: 5s]
        A --&gt; D[内存 JOIN&lt;br/&gt;Python 执行: 10s]
        A --&gt; E[序列化/反序列化: 4s]
    end

    style A fill:#ff6b6b
    style D fill:#ff6b6b
</code></pre>
<p>根本原因：</p>
<ol>
<li><strong>多次网络往返</strong>：每个库单独查询，结果传回 Superset</li>
<li><strong>全量数据传输</strong>：即使只需要 JOIN 后的少量数据，也要先传输全量</li>
<li><strong>Python 执行 JOIN</strong>：效率远低于数据库引擎</li>
</ol>
<hr/>
<h2 data-id="heading-3">方案选择</h2>
<p>调研了几个方案：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 方案对比
        A[方案1: Superset Meta DB&lt;br/&gt;应用层跨库]
        B[方案2: PostgreSQL FDW&lt;br/&gt;数据库层跨库]
        C[方案3: 数据同步&lt;br/&gt;定时复制用户表]
        D[方案4: ETL&lt;br/&gt;数据仓库]
    end

    A --&gt; A1[优点: 配置简单]
    A --&gt; A2[缺点: 性能差 24s+]

    B --&gt; B1[优点: 性能好 &lt;1s]
    B --&gt; B2[缺点: 需要DBA权限]

    C --&gt; C1[优点: 查询快]
    C --&gt; C2[缺点: 数据有延迟]

    D --&gt; D1[优点: 专业方案]
    D --&gt; D2[缺点: 成本高,复杂]
</code></pre>













































<table><thead><tr><th>方案</th><th>性能</th><th>实时性</th><th>配置复杂度</th><th>维护成本</th><th>适用场景</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>❌ 差 (24s)</td><td>✅ 实时</td><td>✅ 简单</td><td>✅ 零</td><td>数据量小,不频繁查询</td></tr><tr><td><strong>PostgreSQL FDW</strong></td><td>✅ 好 (&lt;1s)</td><td>✅ 实时</td><td>⚠️ 中等</td><td>✅ 零</td><td><strong>推荐：实时跨库查询</strong></td></tr><tr><td>数据同步</td><td>✅ 好</td><td>⚠️ 有延迟</td><td>⚠️ 中等</td><td>⚠️ 定时任务</td><td>可接受延迟的场景</td></tr><tr><td>ETL 数仓</td><td>✅ 好</td><td>❌ T+1</td><td>❌ 复杂</td><td>❌ 高</td><td>大规模数据分析</td></tr></tbody></table>
<p>选 FDW 的理由：</p>
<ol>
<li><strong>性能是硬性需求</strong>：24 秒没法用</li>
<li><strong>实时性要求</strong>：用户名变更需要立即生效</li>
<li><strong>团队能力</strong>：有 DBA 支持</li>
<li><strong>成本</strong>：FDW 是 PostgreSQL 内置功能，无额外成本</li>
</ol>
<p>权衡取舍：接受需要 DBA 权限配置的复杂度，换取 40 倍性能提升。</p>
<hr/>
<h2 data-id="heading-4">FDW 架构设计</h2>
<p>最终架构长这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89b82ab6b59f4af3ba85b6fe6a588629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767755839&amp;x-signature=n4lY5PXK%2F0N%2Bd8ZyCO0M1rtAMl8%3D" alt="image.png" loading="lazy"/></p>
<p>核心组件：</p>
<ol>
<li><strong>Foreign Server</strong>：远程数据库连接信息</li>
<li><strong>User Mapping</strong>：认证凭证</li>
<li><strong>Foreign Table</strong>：映射远程表到本地</li>
<li><strong>View</strong>：封装 JOIN 查询</li>
</ol>
<p>数据流对比，一目了然：</p>
<p><strong>Before（Meta Database）</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Superset应用层
        A[SQL Lab] --&gt; B[Meta DB 引擎]
        B --&gt; C[Python JOIN]
    end

    subgraph 网络传输
        D[全量数据1]
        E[全量数据2]
    end

    subgraph 数据库层
        F[(biz_db)]
        G[(users_db)]
    end

    B --&gt;|查询| F
    F --&gt;|返回全量| D
    D --&gt; C

    B --&gt;|查询| G
    G --&gt;|返回全量| E
    E --&gt; C

    C --&gt; H[结果]

    style C fill:#ff6b6b
    style D fill:#ffcc00
    style E fill:#ffcc00
</code></pre>
<p><strong>After（FDW）</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Superset应用层
        A[SQL Lab]
    end

    subgraph 数据库层
        B[(biz_db)] --&gt; C[PostgreSQL&lt;br/&gt;查询优化器]
        C --&gt; D[本地表扫描]
        C --&gt; E[FDW 远程查询]
        D --&gt; F[数据库内 JOIN]
        E --&gt; F
        F --&gt; G[结果集]
    end

    subgraph 远程
        H[(users_db)]
    end

    A --&gt;|SQL| B
    E -.-&gt;|高速内网| H
    G --&gt;|仅返回结果| A

    style F fill:#90EE90
    style E fill:#90EE90
</code></pre>
<hr/>
<h2 data-id="heading-5">实现步骤</h2>
<p>FDW 配置涉及四个组件：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">
  graph TB
      subgraph s1[FDW 四大组件]
          A[EXTENSION: postgres_fdw] --&gt; B[SERVER: users_server]
          B --&gt; C[USER MAPPING: 认证凭证]
          C --&gt; D[FOREIGN TABLE: fdw_users.users]
      end

      D --&gt; E[VIEW: v_ratings_with_username]

      style A fill:#FFB6C1
      style B fill:#98FB98
      style C fill:#87CEEB
      style D fill:#DDA0DD
      style E fill:#F0E68C
</code></pre>
<h3 data-id="heading-6">步骤 1：启用 FDW 扩展</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 需要超级用户权限</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> postgres_fdw;
</code></pre>
<p><code>postgres_fdw</code> 是 PostgreSQL 官方提供的 FDW 扩展，专门用于连接其他 PostgreSQL 数据库，只需要在本地库执行一次。</p>
<h3 data-id="heading-7">步骤 2：创建外部服务器</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SERVER users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'your-db-host.internal.local'</span>,
    dbname <span class="hljs-string">'users_db'</span>,
    port <span class="hljs-string">'5432'</span>
);
</code></pre>
<h3 data-id="heading-8">步骤 3：创建用户映射</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> your_user
SERVER users_server
OPTIONS (
    <span class="hljs-keyword">user</span> <span class="hljs-string">'your_user'</span>,
    password <span class="hljs-string">'your_password'</span>
);
</code></pre>
<p>用户映射告诉 FDW：当本地用户查询外部表时，用什么凭证连接远程库。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph 本地数据库
        A[本地用户: your_user]
    end

    subgraph 用户映射
        B[映射规则]
    end

    subgraph 远程数据库
        C[远程用户: your_user&lt;br/&gt;密码: ****]
    end

    A --&gt; B
    B --&gt; C

    B -.-&gt;|告诉FDW| D[用什么凭证&lt;br/&gt;连接远程库]
</code></pre>
<p>常见问题：报错 <code>user mapping not found</code> 说明当前用户没有映射，需要为每个要使用 FDW 的本地用户创建映射，或者用 <code>FOR PUBLIC</code> 允许所有用户。</p>
<h3 data-id="heading-9">步骤 4：导入外部表</h3>
<p><strong>自动导入（推荐）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;  <span class="hljs-comment">-- 导入到 fdw_users schema</span>
</code></pre>
<p><strong>手动创建</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">TABLE</span> fdw_users.users (
    id uuid,
    realm_id uuid,
    username <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    firstname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    lastname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    email <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    enabled <span class="hljs-type">boolean</span>,
    created_at <span class="hljs-type">timestamp</span>,
    updated_at <span class="hljs-type">timestamp</span>
)
SERVER users_server
OPTIONS (schema_name <span class="hljs-string">'public'</span>, table_name <span class="hljs-string">'users'</span>);
</code></pre>
<h3 data-id="heading-10">步骤 5：创建视图</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;
</code></pre>
<p>视图的好处：封装 JOIN 逻辑，用户只需 <code>SELECT * FROM v_ratings_with_username</code>，底层表结构变化时只改视图定义。</p>
<h3 data-id="heading-11">完整配置脚本</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ========================================</span>
<span class="hljs-comment">-- FDW 跨库查询配置脚本</span>
<span class="hljs-comment">-- 在 biz_db 数据库执行</span>
<span class="hljs-comment">-- 需要超级用户权限</span>
<span class="hljs-comment">-- ========================================</span>

<span class="hljs-comment">-- 1. 启用 FDW 扩展</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> postgres_fdw;

<span class="hljs-comment">-- 2. 创建外部服务器</span>
<span class="hljs-keyword">CREATE</span> SERVER IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'your-db-host.internal.local'</span>,
    dbname <span class="hljs-string">'users_db'</span>
);

<span class="hljs-comment">-- 3. 创建用户映射</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> your_user
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'your_user'</span>, password <span class="hljs-string">'your_password'</span>);

<span class="hljs-comment">-- 4. 创建 schema 存放外部表</span>
<span class="hljs-keyword">CREATE</span> SCHEMA IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> fdw_users;

<span class="hljs-comment">-- 5. 导入外部表</span>
IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;

<span class="hljs-comment">-- 6. 创建业务视图</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;

<span class="hljs-comment">-- 7. 授权</span>
<span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">FOREIGN</span> SERVER users_server <span class="hljs-keyword">TO</span> your_user;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> v_ratings_with_username <span class="hljs-keyword">TO</span> your_user;

<span class="hljs-comment">-- 验证</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">5</span>;
</code></pre>
<hr/>
<h2 data-id="heading-12">Superset 配置调整</h2>
<p>配置 FDW 后，Superset 的查询方式要改一下。</p>
<p><strong>Before（Meta Database）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 使用 Superset Meta Database</span>
<span class="hljs-comment">-- Database: Superset meta database</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> "biz_db.public.message_ratings" LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>After（直连 + 视图）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 直接连接 biz_db</span>
<span class="hljs-comment">-- Database: biz_db</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>就是选 <code>biz_db</code> 数据库（不是 Meta Database），直接查视图。</p>
<hr/>
<h2 data-id="heading-13">错误排查</h2>
<p>遇到问题可以按这个顺序排查：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[FDW 错误] --&gt; B{错误类型}

    B --&gt;|权限问题| C[permission denied&lt;br/&gt;to create extension]
    B --&gt;|连接问题| D[could not connect&lt;br/&gt;to server]
    B --&gt;|映射问题| E[user mapping&lt;br/&gt;not found]
    B --&gt;|表不存在| F[relation does&lt;br/&gt;not exist]

    C --&gt; C1[解决: 需要超级用户权限&lt;br/&gt;联系 DBA 执行]
    D --&gt; D1[解决: 检查网络连通性&lt;br/&gt;检查 host/port 配置]
    E --&gt; E1[解决: CREATE USER MAPPING&lt;br/&gt;为当前用户创建映射]
    F --&gt; F1[解决: 检查外部表是否导入&lt;br/&gt;检查 schema 名称]
</code></pre>
<p>排查清单：</p>



































<table><thead><tr><th>步骤</th><th>检查命令</th><th>预期结果</th></tr></thead><tbody><tr><td>1. 检查扩展</td><td><code>SELECT * FROM pg_extension WHERE extname='postgres_fdw';</code></td><td>有记录</td></tr><tr><td>2. 检查服务器</td><td><code>SELECT * FROM pg_foreign_server;</code></td><td>有 users_server</td></tr><tr><td>3. 检查用户映射</td><td><code>SELECT * FROM pg_user_mappings;</code></td><td>当前用户有映射</td></tr><tr><td>4. 检查外部表</td><td><code>SELECT * FROM information_schema.foreign_tables;</code></td><td>有 users 表</td></tr><tr><td>5. 测试连接</td><td><code>SELECT * FROM fdw_users.users LIMIT 1;</code></td><td>返回数据</td></tr></tbody></table>
<p>性能监控：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看执行计划</span>
EXPLAIN ANALYZE
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">50</span>;

<span class="hljs-comment">-- 关注：</span>
<span class="hljs-comment">-- 1. Foreign Scan 的 actual time</span>
<span class="hljs-comment">-- 2. 远程查询的行数</span>
<span class="hljs-comment">-- 3. 总执行时间</span>
</code></pre>
<p>健康指标：单次查询 &lt; 1 秒，Foreign Scan 时间 &lt; 100ms，大表上有索引。</p>
<hr/>
<h2 data-id="heading-14">测试结果</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">xychart-beta
    title "查询性能对比"
    x-axis ["Superset Meta DB", "PostgreSQL FDW"]
    y-axis "耗时(秒)" 0 --&gt; 25
    bar [24, 0.6]
</code></pre>























<table><thead><tr><th>方案</th><th>查询耗时</th><th>数据库耗时</th><th>性能提升</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>21-24s</td><td>12ms</td><td>基准</td></tr><tr><td>PostgreSQL FDW</td><td>0.5-0.8s</td><td>0.5s</td><td><strong>40x</strong></td></tr></tbody></table>
<p>执行计划对比：</p>
<p>Superset Meta DB 的数据库层只需 12ms：</p>
<pre><code class="hljs language-sql" lang="sql">Limit  (cost<span class="hljs-operator">=</span><span class="hljs-number">1635.43</span>.<span class="hljs-number">.1635</span><span class="hljs-number">.56</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">50</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">12.550</span>.<span class="hljs-number">.12</span><span class="hljs-number">.554</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">13</span>)
</code></pre>
<p>问题在应用层的 Python JOIN。</p>
<p>FDW 整体都快：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Foreign</span> Scan <span class="hljs-keyword">on</span> users  (cost<span class="hljs-operator">=</span><span class="hljs-number">0.00</span>.<span class="hljs-number">.8</span><span class="hljs-number">.16</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">0.020</span>.<span class="hljs-number">.0</span><span class="hljs-number">.027</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>)
</code></pre>
<hr/>
<h2 data-id="heading-15">常用查询</h2>
<p>配置完成后，在 Superset 里这样用：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 选择数据库: biz_db</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">100</span>;
</code></pre>
<p>按日期过滤：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">WHERE</span> 评价时间 <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'7 days'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>统计评价分布：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
    评价类型,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 数量
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 评价类型;
</code></pre>
<p>统计知识库使用率：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
    使用知识库,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 数量,
    ROUND(<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">*</span> <span class="hljs-number">100.0</span> <span class="hljs-operator">/</span> <span class="hljs-built_in">SUM</span>(<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)) <span class="hljs-keyword">OVER</span> (), <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> 百分比
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 使用知识库;
</code></pre>
<hr/>
<h2 data-id="heading-16">FAQ</h2>
<p><strong>Q: 用户名变更后，视图会自动更新吗？</strong></p>
<p>会的，FDW 是实时连接，每次查询都获取最新数据。</p>
<p><strong>Q: 对线上数据库有性能影响吗？</strong></p>
<p>影响很小。FDW 查询相当于普通的远程查询，查询量不大的话影响可以忽略。</p>
<p><strong>Q: 远程库挂了会怎样？</strong></p>
<p>查询会报错，但不影响本地库的其他功能。</p>
<p><strong>Q: 如何添加新的跨库表？</strong></p>
<pre><code class="hljs language-sql" lang="sql">IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (新表名)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;
</code></pre>
<hr/>
<h2 data-id="heading-17">总结</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">timeline
    title 问题解决时间线

    section 问题发现
        发现跨库查询慢 : 使用 Superset Meta DB
                       : 查询耗时 24s+

    section 方案调研
        分析性能瓶颈 : 应用层 JOIN 是根因
                     : 对比 FDW 等方案

    section 实施落地
        配置 FDW : 创建 Server/Mapping
                 : 导入外部表
                 : 创建视图

    section 效果验证
        性能提升 40x : 从 24s 降到 0.6s
                     : 用户体验显著改善
</code></pre>
<p>几个关键收获：</p>
<p><strong>技术层面</strong>：</p>
<ol>
<li><strong>Superset Meta Database 的原理</strong>：应用层跨库，数据拉到内存 JOIN，适合小数据量低频查询</li>
<li><strong>PostgreSQL FDW 的优势</strong>：数据库层跨库，利用数据库引擎优化，适合需要高性能的跨库场景</li>
<li><strong>性能分析方法</strong>：EXPLAIN ANALYZE 分析执行计划，区分数据库层和应用层的耗时</li>
</ol>
<p><strong>架构层面</strong>：</p>
<ol>
<li><strong>微服务的数据聚合挑战</strong>：数据分散是微服务的固有问题，需要根据场景选择跨库方案</li>
<li><strong>"数据在哪里处理"很重要</strong>：同样的 JOIN，在不同层执行性能差异巨大，尽量把计算下推到数据库层</li>
</ol>
<p>方案选择象限图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c550f954be3546a38ccd46c3ff55b4c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767755839&amp;x-signature=b28fKmm7mJd3rPu57Tsv39x0PPA%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-18">附录：SQL 参考</h2>
<p>FDW 配置命令：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看所有外部服务器</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_foreign_server;

<span class="hljs-comment">-- 查看所有用户映射</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_user_mappings;

<span class="hljs-comment">-- 查看所有外部表</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.foreign_tables;

<span class="hljs-comment">-- 删除 FDW 配置（回滚用）</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> IF <span class="hljs-keyword">EXISTS</span> v_ratings_with_username;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> MAPPING IF <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">FOR</span> your_user SERVER users_server;
<span class="hljs-keyword">DROP</span> SERVER IF <span class="hljs-keyword">EXISTS</span> users_server CASCADE;
</code></pre>
<p>常用查询模板：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 带时间范围的评价查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">WHERE</span> 评价时间 <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-12-31'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>;

<span class="hljs-comment">-- 用户评价统计</span>
<span class="hljs-keyword">SELECT</span>
    用户名,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 评价次数,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> 评价类型 <span class="hljs-operator">=</span> <span class="hljs-string">'like'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> 点赞数,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> 评价类型 <span class="hljs-operator">=</span> <span class="hljs-string">'dislike'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> 点踩数
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 用户名
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价次数 <span class="hljs-keyword">DESC</span>;
</code></pre>
<hr/>
<h2 data-id="heading-19">延伸阅读</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2Fcurrent%2Fpostgres-fdw.html" target="_blank" title="https://www.postgresql.org/docs/current/postgres-fdw.html" ref="nofollow noopener noreferrer">PostgreSQL FDW 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsuperset.apache.org%2Fdocs%2Fintro" target="_blank" title="https://superset.apache.org/docs/intro" ref="nofollow noopener noreferrer">Apache Superset 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmicroservices.io%2Fpatterns%2Fdata%2Fdatabase-per-service.html" target="_blank" title="https://microservices.io/patterns/data/database-per-service.html" ref="nofollow noopener noreferrer">微服务架构数据管理模式</a></li>
</ul>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcoding-cli-guide" target="_blank" title="https://github.com/tt-a1i/coding-cli-guide" ref="nofollow noopener noreferrer">coding-cli-guide</a>（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt-a1i.github.io%2Fcoding-cli-guide%2F%3Ftab%3Dstart-here" target="_blank" title="https://tt-a1i.github.io/coding-cli-guide/?tab=start-here" ref="nofollow noopener noreferrer">学习网站</a>）- 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术]]></title>    <link>https://juejin.cn/post/7589325011543932966</link>    <guid>https://juejin.cn/post/7589325011543932966</guid>    <pubDate>2025-12-30T08:42:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589325011543932966" data-draft-id="7589166195797835803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术"/> <meta itemprop="keywords" content="后端,RocketMQ"/> <meta itemprop="datePublished" content="2025-12-30T08:42:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T08:42:16.000Z" title="Tue Dec 30 2025 08:42:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>在分布式系统架构中，消息队列如同畅通的“信息神经网络”，承担着解耦、削峰与异步通信的核心使命。在众多成熟方案中，RocketMQ凭借其阿里巴巴与Apache双重基因，以卓越的金融级可靠性、万亿级消息堆积能力和灵活的分布式特性脱颖而出，成为构建高可用、高性能数据流转枢纽的关键技术选型。本文将深入解析RocketMQ的核心架构、设计哲学与实践要义。</p>
<h2 data-id="heading-1">二、RocketMQ架构总览</h2>
<p>官网图片</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bdf1be17f15433abadb30355785add7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=Q5cXYft5vb6uHouUekXeCFN7dU0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>RocketMQ架构上主要分为四部分，如上图所示: </p>
<p>RocketMQ作为一款高性能、高可用的分布式消息中间件，其核心架构采用了经典的四组件协同设计，实现了消息生产、存储、路由与消费的全链路解耦与高效协同。<strong>四大组件——生产者（Producer）、消费者（Consumer）、路由中心（NameServer）和代理服务器（Broker）——各司其职，共同构建了其坚实的基石。</strong></p>
<p><strong>生产者（Producer）</strong> 作为消息的源头，负责将业务消息高效、可靠地发布到系统中。它支持分布式集群部署，并通过内置的智能负载均衡机制，自动选择最优的Broker节点与队列进行投递。</p>
<p><strong>消费者（Consumer）</strong> 是消息的处理终端，同样以集群化方式工作，支持推送（Push）和拉取（Pull）两种消息获取模式。它提供了集群消费与广播消费两种模式，并能动态维护其订阅关系。</p>
<p><strong>路由中心（NameServer）</strong> 是整个架构的“注册中心”，扮演着轻量级服务发现的角色。所有Broker节点都会向NameServer注册，并通过定期心跳汇报健康状态。生产者与消费者则从NameServer获取实时的主题路由与Broker信息，从而实现消息寻址的完全解耦。</p>
<p><strong>代理服务器（Broker）</strong> 是消息存储与流转的核心，负责消息的持久化存储、投递与查询。为了保障高可用性，Broker通常采用主从（Master-Slave）部署架构，确保数据与服务在故障时能无缝切换。其内部集成了通信处理、存储引擎、索引服务和高可用复制等核心模块。</p>
<h2 data-id="heading-2">三、核心组件深度解析</h2>
<h3 data-id="heading-3">NameServer：轻量级服务发现枢纽</h3>
<p>NameServer是RocketMQ的<strong>轻量级服务发现与路由中心，</strong> 其核心目标是<strong>实现生产消费与Broker服务的解耦。</strong> 它不存储消息数据，仅管理路由元数据。</p>
<p>核心是一张的路由表 HashMap&lt;String/* Topic */, List&gt;，记录了每个Topic对应在哪些Broker的哪些队列上。</p>
<p>客户端内置了故障规避机制。如果从某个NameServer获取路由失败，或根据路由信息访问Broker失败，会自动重试其他NameServer或Broker。</p>
<p>1. <strong>核心角色与设计哲学：</strong> NameServer的设计哲学是 <strong>“简单、无状态、最终一致” 。</strong> 每个NameServer节点独立运行，<strong>节点间互不通信，</strong> 这使其具备极强的水平扩展能力和极高的可用性。客户端会配置所有NameServer地址，并向其广播请求。</p>
<p>2. <strong>核心工作机制：</strong> 其运作围绕路由信息的生命周期展开，可通过下图一览其核心流程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b3280785213457baf0072075bf3d2c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=YWSVIizAw2fvUuXHhFa7xydVAQA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>3. 和kafka注册中心对比</strong></p>
<ul>
<li><strong>NameServer</strong> 采用 <strong>“去中心化”</strong> 和 <strong>“最终一致”</strong> 思想，<strong>追求极致的简单、轻量和水平扩展，</strong> 牺牲了强一致性，以换取架构的简洁和高可用。这非常适合路由信息变动不频繁、客户端具备容错能力的消息场景。</li>
<li><strong>Kafka (KRaft)</strong> 采用 <strong>“中心化”</strong> 和 <strong>“强一致”</strong> 思想，<strong>追求数据的精确和系统的自包含。</strong> 它将元数据管理深度内化，通过共识协议保证全局一致，但代价是架构复杂度和运维成本更高。</li>
</ul>
<p><strong>优劣分析：</strong> NameServer在<strong>运维简易性、集群扩展性、无外部依赖</strong>上占优；而Kafka KRaft在<strong>元数据强一致性、系统自包含、架构统一性</strong>上更胜一筹。选择取决于你对<strong>一致性、复杂度、运维成本</strong>的具体权衡。</p>
<h3 data-id="heading-4">Broker：消息存储与转发的核心引擎</h3>
<p><strong>解密存储文件设计</strong></p>
<p>Broker目录下的文件结构</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e24cb94e63be43809d3bef29a8c763cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=Imv1BnL%2Fp6UklYRQ7TaaZBBi3mc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>所有核心存储文件均位于Broker节点的 <strong>${storePathRootDir}/store/</strong> 目录下（默认路径为 ~/store/），其下各子目录职责分明：</p>













































<table><thead><tr><th>目录/文件</th><th>核心职责</th><th>关键设计说明</th></tr></thead><tbody><tr><td><strong>commitlog/</strong></td><td><strong>消息实体存储库</strong></td><td>• <strong>设计</strong>：所有Topic的消息<strong>顺序混合追加</strong>写入。• <strong>文件</strong>：以起始物理偏移量命名（20位数字），默认每个1GB。<strong>lock文件</strong>确保同一时刻只有一个进程写入，保障严格顺序写。</td></tr><tr><td><strong>consumequeue/</strong></td><td><strong>逻辑消费队列索引</strong></td><td>• <strong>结构</strong>：按 {Topic}/{QueueId}/三级目录组织。 • <strong>文件</strong>：存储<strong>定长记录</strong>（20字节/条），包含物理偏移量、长度和Tag哈希码。 • <strong>作用</strong>：为消费者提供按Topic和队列分组的<strong>逻辑视图</strong>，实现高效拉取。</td></tr><tr><td><strong>index/</strong></td><td><strong>消息键哈希索引</strong></td><td>• <strong>文件</strong>：以创建时间戳命名（如20240515080000000）。 • <strong>结构</strong>：采用 <strong>“哈希槽 + 链表”</strong> 结构。 • <strong>用途</strong>：支持根据 <strong>Message Key</strong> 或时间范围进行消息查询，用于运维排查。</td></tr><tr><td><strong>config/</strong></td><td><strong>运行时元数据</strong></td><td>• 存储Broker运行期间生成的动态数据，如<strong>所有Topic的配置</strong>、<strong>消费者组的消费进度（offset）</strong> 等。</td></tr><tr><td><strong>checkpoint</strong></td><td><strong>状态检查点文件</strong></td><td>• 记录 commitlog、consumequeue、index等文件<strong>最后一次刷盘的时间戳</strong>，用于崩溃恢复时确定数据恢复的起点。</td></tr><tr><td><strong>abort</strong></td><td><strong>异常关闭标志文件</strong></td><td>• 该文件存在即表明Broker上一次是<strong>非正常关闭</strong>，重启时会触发恢复流程。</td></tr><tr><td><strong>lock</strong></td><td><strong>锁文件</strong></td><td>• lock文件确保同一时刻只有一个进程写入，保障严格顺序写。</td></tr></tbody></table>
<p><strong>commitLog</strong></p>
<p><strong>消息主体以及元数据的存储主体，</strong> 存储Producer端写入的消息主体内容，消息内容<strong>不是定长的。</strong> 单个文件大小默认1G， 文件名长度为20位，左边补零，剩余为<strong>起始偏移量，</strong> 比如00000000000000000000代表了第一个文件，起始偏移量为0，文件大小为1G=1073741824；当第一个文件写满了，第二个文件为00000000001073741824，起始偏移量为1073741824，以此类推。消息主要是顺序写入日志文件，当文件满了，写入下一个文件；</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1555b92d53124c30a1c64520afcb6530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=IgilS7j5JakSn7XjYXj%2FI%2BkGy4Q%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>当我们消息发送到RocketMQ以后，消息在commitLog中，因为body大小是不固定的，所以每个消息的长度也是不固定的，其存储格式如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4dc74ef5bdb4199b3c65d3620b095d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=Ts7tUksCl96meHHt97y93%2FK5g%2Bw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>下面每个表格列举了每个字段的含义</p>
























































































































































<table><thead><tr><th>字段</th><th>字段名</th><th>数据类型</th><th>字节数</th><th>说明与用途</th></tr></thead><tbody><tr><td>1</td><td><strong>MsgLen / TOTALSIZE</strong></td><td>int</td><td>4</td><td><strong>消息总长度</strong>，即从本字段开始到结束的总字节数，是解析消息的起点。</td></tr><tr><td>2</td><td><strong>MagicCode</strong></td><td>int</td><td>4</td><td><strong>魔术字</strong>，固定值（如 0xdaa320a7），用于标识这是一个有效的消息存储起始点，也用于区分<strong>消息体</strong>和<strong>文件末尾空白填充区</strong>。</td></tr><tr><td>3</td><td><strong>BodyCRC</strong></td><td>int</td><td>4</td><td><strong>消息体内容的CRC校验码，</strong> 用于校验消息体在存储过程中是否损坏。</td></tr><tr><td>4</td><td><strong>QueueId</strong></td><td>int</td><td>4</td><td><strong>队列ID</strong>，标识此消息属于Topic下的哪个逻辑队列。</td></tr><tr><td>5</td><td><strong>Flag</strong></td><td>int</td><td>4</td><td><strong>消息标志位</strong>，供应用程序自定义使用，RocketMQ内部未使用。</td></tr><tr><td>6</td><td><strong>QueueOffset</strong></td><td>long</td><td>8</td><td><strong>消费队列偏移量</strong>，即此消息在其对应ConsumeQueue中的顺序索引，<strong>是连续的</strong>。</td></tr><tr><td>7</td><td><strong>PhysicalOffset</strong></td><td>long</td><td>8</td><td><strong>物理偏移量</strong>，即此消息在<strong>所有CommitLog文件中的起始字节偏移量</strong>。由于消息长度不定，此偏移量<strong>不是连续的</strong>。</td></tr><tr><td>8</td><td><strong>SysFlag</strong></td><td>int</td><td>4</td><td><strong>系统标志位</strong>，是一个二进制组合值，用于标识消息特性，如：是否压缩、是否为事务消息、是否等待事务提交等。</td></tr><tr><td>9</td><td><strong>BornTimestamp</strong></td><td>long</td><td>8</td><td><strong>消息生成时间戳</strong>，由Producer客户端在发送时生成。</td></tr><tr><td>10</td><td><strong>BornHost</strong></td><td>8字节</td><td>8</td><td><strong>消息发送者地址</strong>。其编码并非简单字符串，而是将IP的4个段和端口号的2个字节，共6个字节，按大端序组合并填充到8字节中。</td></tr><tr><td>11</td><td><strong>StoreTimestamp</strong></td><td>long</td><td>8</td><td><strong>消息存储时间戳</strong>，即Broker收到消息并写入内存的时间。</td></tr><tr><td>12</td><td><strong>StoreHost</strong></td><td>8字节</td><td>8</td><td><strong>Broker存储地址</strong>，编码方式同BornHost。</td></tr><tr><td>13</td><td><strong>ReconsumeTimes</strong></td><td>int</td><td>4</td><td><strong>消息重试消费次数</strong>，用于死信队列判断。</td></tr><tr><td>14</td><td><strong>PreparedTransationOffset</strong></td><td>long</td><td>8</td><td><strong>事务消息专用</strong>，存储与之关联的<strong>事务日志（Transaction Log）的偏移量</strong>。</td></tr><tr><td>15</td><td><strong>BodyLength</strong></td><td>int</td><td>4</td><td><strong>消息体实际长度</strong>，后跟Body内容。</td></tr><tr><td>16</td><td><strong>Body</strong></td><td>byte[]</td><td>不定</td><td><strong>消息体内容</strong>，即Producer发送的原始业务数据。</td></tr><tr><td>17</td><td><strong>TopicLength</strong></td><td>byte</td><td>1</td><td><strong>Topic名称的长度</strong>（1字节，因此Topic名不能超过255字符）。</td></tr><tr><td>18</td><td><strong>Topic</strong></td><td>byte[]</td><td>不定</td><td><strong>Topic名称</strong>的字节数组。</td></tr><tr><td>19</td><td><strong>PropertiesLength</strong></td><td>short</td><td>2</td><td><strong>消息属性长度</strong>，后跟Properties内容。</td></tr><tr><td>20</td><td><strong>Properties</strong></td><td>byte[]</td><td>不定</td><td><strong>消息属性</strong>，用于存储用户自定义的Key-Value扩展信息。在编码时，Key和Value之间用特殊<strong>不可见字符</strong>（如\u0001）分隔，因此属性中不能包含这些字符。</td></tr></tbody></table>
<p><strong>ConsumeQueue</strong></p>
<p>消息消费索引，<strong>引入的目的主要是提高消息消费的性能。</strong> 由于RocketMQ是基于主题topic的订阅模式，消息消费是针对主题进行的，如果要遍历commitlog文件，<strong>根据topic检索消息是非常低效的。</strong></p>
<p>为了解决这个问题中，提高消费时候的速度，RocketMQ会启动后台的 dispatch 线程源源不断的将消息从 commitLog 取出消息在 CommitLog 中的物理偏移量，消息长度以及 Tag Hash 等信息作为单条消息的索引，分发到对应的消费队列，构成了对 CommitLog 的引用。</p>
<p>consumer可根据ConsumeQueue来查找待消费的消息。其中，ConsumeQueue作为消费消息的索引，保存了指定Topic下的队列消息在CommitLog中的起始<strong>物理偏移量offset，消息大小size和消息Tag的HashCode值。</strong></p>
<p><strong>consumequeue文件可以看成是基于topic的commitlog索引文件，</strong> 故consumequeue文件夹的组织方式如下：</p>
<p>$HOME/store/consumequeue/{topic}/{queueId}/{fileName}</p>
<p><strong>consumequeue文件采取定长设计，</strong> 每一个条目共20个字节，前8字节的commitlog物理偏移量、中间4字节的消息长度、8字节tag的hashcode。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2a1c20449134d6f85cddd0b432a61ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=QXmusPa2UJ%2Foj2KiTRxDE9X8I60%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>indexFile</strong></p>
<p>RocketMQ的IndexFile索引文件提供了通过消息Key或时间区间查询消息的能力，其存储路径为$HOME/store/index/{fileName}，其中文件名以创建时间戳命名。单个IndexFile文件大小固定约为400M，可保存2000W个索引，其底层采用类HashMap的哈希索引结构实现。</p>
<p>IndexFile是一个<strong>固定大小</strong>的文件（约400MB），其物理结构由三部分组成</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec110113d70c41318ed5d59af0260ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=LkiT4Cr9Jp4pTcpu%2Ftp5chEcXn0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>1.IndexHeader（索引头，40字节）</p>
<p><strong>beginTimestamp：</strong> 第一条消息存储时间</p>
<p><strong>endTimestamp：</strong> 最后一条消息存储时间</p>
<p><strong>beginPhyoffset：</strong> 第一条消息在CommitLog中的物理偏移量</p>
<p><strong>endPhyoffset：</strong> 最后一条消息在CommitLog中的物理偏移量</p>
<p><strong>hashSlotCount：</strong> 已使用的哈希槽数量</p>
<p><strong>indexCount：</strong> 索引单元总数</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f15c2fa72ed446819edf72bcd57ed7dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=TjCLGPJ5bxzgC2zTxRD1rWWfHRI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>2.Slots（哈希槽）</p>
<p>每个IndexFile包含500万个哈希槽位,每个Slot槽位（4字节）存储的是链式索引的第一个索引序号，每个槽位可挂载多个索引单元，形成链式结构。</p>
<ul>
<li>如果Slot值为0：表示该槽位没有索引链</li>
<li>如果Slot值为N：表示该槽位对应的索引链头节点索引序号为N</li>
</ul>
<p>3.Indexes（索引单元，20字节/个）</p>
<p>每个索引单元包含以下字段：</p>
<ul>
<li><strong>keyHash：</strong> 消息Key的哈希值</li>
<li><strong>phyOffset：</strong> 消息在CommitLog中的物理偏移量</li>
<li><strong>timeDiff：</strong> 消息存储时间与IndexFile创建时间的差值</li>
<li><strong>preIndexNo：</strong> 同一哈希槽中前一个索引单元的序号</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e2a3945505468085f36654c599d975~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=GQFqfiH%2FzwZxZpLgy%2Fy3W9hMR4U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这个结构和hashmap结构很像，但是支持每个key通过时间排序，就可以进行时间范围的检索。</p>
<p>通过定长索引结构和整体设计可以通过key快速定位索引数据，拿到真实数据的物理偏移量。</p>
<p>4.索引查询流程</p>
<p>消费者通过消息Key查询时，执行以下步骤：</p>
<ol>
<li>计算槽位序号slot序号 = key哈希值 % 500万</li>
<li>定位槽位地址slot位置 = 40 + (slot序号 - 1) × 4</li>
<li>获取首个索引位置index位置 = 40 + 500万 × 4 + (索引序号 - 1) × 20</li>
<li>遍历索引链从槽位指向的索引开始，沿preIndexNo链式查找，匹配目标Key并校验时间范围</li>
<li>获取物理偏移量从匹配的索引单元中读取phyOffset，最终从CommitLog获取完整消息内容</li>
</ol>
<p>通过此机制，IndexFile实现了基于Key的高效点查和基于时间范围的快速检索。</p>
<p><strong>整体流程</strong></p>
<p>RocketMQ 高性能存储的核心，在于其 <strong>“混合存储”</strong> 架构，这正是一种精妙的<strong>存储层读写分离</strong>设计。</p>
<p>其工作流程可以这样理解：</p>
<ol>
<li><strong>统一写入，保证极致性能：</strong> 所有消息顺序追加写入一个统一的 CommitLog 文件。这种单一的顺序写操作，是它能承受海量消息写入的根本。</li>
<li><strong>异步构建，优化读取路径：</strong> 消息一旦持久化至 CommitLog，即视为安全。随后，后台服务线程会异步地构建出专供消费的 ConsumerQueue（逻辑队列索引）和用于查询的 IndexFile。这相当于为数据建立了高效的“目录”。</li>
<li><strong>消费消息：</strong> 消费者实际拉取消息时，是先读取 ConsumerQueue 找到消息在 CommitLog 中的物理位置，再反查 CommitLog 获取完整消息内容。</li>
<li><strong>可靠的消费机制：</strong> 基于上述持久化保障，配合消费者自身的偏移量管理及Broker的长轮询机制，共同实现了消息的可靠投递与高效获取。</li>
</ol>
<p>这种 <strong>“读写分离”</strong> 设计的好处在于：将耗时的写操作（顺序写CommitLog）与复杂的读操作（构建索引、分散查询）解耦，让两者可以异步、独立地进行优化，从而在整体上获得更高的吞吐量和更低的延迟。这体现了“各司其职，异步协同”的经典架构思想。</p>
<p>下图是官方文档的流程图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/498af1c2070f4a8d9c1a580ad937f5a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=BHzEd9qIEgSJ5AuVag0vy0St7YA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>写入流程</p>
<p><strong>1.消息预处理</strong></p>
<p><strong>基础校验：</strong> 检查Topic名称、消息体长度等是否合法。</p>
<p><strong>生成唯一ID：</strong> 结合Broker地址和CommitLog偏移量等，生成全局唯一的MsgID。</p>
<p><strong>设置系统标志：</strong> 根据消息属性（如是否事务消息、是否压缩）设置SysFlag。</p>
<p><strong>2.CommitLog核心写入</strong></p>
<p><strong>获取MappedFile：</strong> 根据当前写入位置，定位或创建对应的1GB内存映射文件。这里采用双重检查锁模式来保证性能和安全。</p>
<p><strong>串行加锁写入：</strong> 获取全局或文件级锁（PutMessageLock），确保同一时刻只有一个线程写入文件，严格保证<strong>顺序性。</strong></p>
<p><strong>序列化与追加：</strong> 将消息按照之前分析的<strong>二进制协议，</strong> 序列化到MappedByteBuffer中，并更新写入指针。</p>
<p><strong>3.刷盘（Flush）</strong></p>
<p><strong>同步刷盘：</strong> 消息写入内存映射区后，会创建一个GroupCommitRequest并放入请求组。写入线程会等待，直到<strong>刷盘线程</strong>完成该请求对应文件的物理刷盘后，才返回成功给Producer。<strong>数据最可靠，但延迟较高。</strong></p>
<p><strong>异步刷盘（默认）：</strong> 消息写入内存映射区后，立即返回成功给Producer。同时唤醒<strong>异步刷盘线程，</strong> 该线程会定时或当PageCache中待刷盘数据积累到一定量时，执行一次批量刷盘。<strong>性能高，但有宕机丢数风险。</strong></p>
<p><strong>4.异步索引构建</strong></p>
<p>由独立的ReputMessageService线程处理。它不断检查CommitLog中是否有新消息到达。</p>
<p>一旦有<strong>新消息被确认持久化</strong>（对于同步刷盘是已落盘，对于异步刷盘是已写入映射区），该线程就会读取消息内容。</p>
<p>随后，它会为这条消息在对应的consumequeue目录下构建<strong>消费队列索引</strong>（记录CommitLog物理偏移量和消息长度），更新index索引文件。</p>
<p>消费流程</p>
<p><strong>1.启动与负载均衡</strong></p>
<p>消费者启动后，会向<strong>NameServer</strong>获取Topic的路由信息（包含哪些队列、分布在哪些Broker上）。</p>
<p>如果消费者组内有多个实例，会触发<strong>队列负载均衡</strong>（默认策略是平均分配）。例如，一个Topic有8个队列，两个消费者实例，则通常每个消费者负责消费4个队列。这一步决定了每个消费者“认领”了哪些消息队列。</p>
<p><strong>2.拉取消息循环</strong></p>
<p>每个消费者实例内部都有一个PullMessageService线程，它循环从一个PullRequest队列中获取任务。</p>
<p>PullRequest包含了拉取目标（如Broker-A， 队列3）以及<strong>下一次要拉取的位点（offset）。</strong></p>
<p>消费者向指定的Broker发送网络请求，请求体中就携带了这个offset。</p>
<p><strong>3.Broker端处理与返回</strong></p>
<p>Broker收到请求后，根据Topic、队列ID和offset，去查询对应的<strong>ConsumeQueue索引文件。</strong></p>
<p>ConsumeQueue中存储的是定长（20字节）的记录，包含消息在<strong>CommitLog中的物理偏移量和长度。</strong></p>
<p>Broker根据物理偏移量，从<strong>CommitLog文件</strong>中读取完整的消息内容，通过网络返回给消费者。</p>
<p><strong>4.消息处理与位点提交</strong></p>
<p>消费者将拉取到的消息提交到内部的<strong>消费线程池</strong>进行处理，你的业务逻辑就在这里执行。</p>
<p><strong>消费位点的管理至关重要：</strong></p>
<p><strong>位点存储：</strong> 位点由OffsetStore管理。在<strong>集群模式（CLUSTER）</strong> 下，消费位点存储在Broker上；在<strong>广播模式（BROADCAST）</strong> 下，位点存储在本地。</p>
<p><strong>位点提交：</strong> 消费成功后，消费者会<strong>异步</strong>（默认方式）向Broker提交已消费的位点。Broker将其持久化到store/config/consumerOffset.json文件中。</p>
<p><strong>5.消息重试与死信</strong></p>
<p>如果消息消费<strong>失败</strong>（抛出异常或超时未返回CONSUME_SUCCESS），RocketMQ会触发<strong>重试机制。</strong></p>
<p>对于普通消息，消息会被发回Broker上一个特殊的<strong>重试主题</strong>（%RETRY%），延迟一段时间（延迟级别：1s、5s、10s…）后再被原消费者组拉取。</p>
<p>如果<strong>重试超过最大次数</strong>（默认16次），消息会被投递到<strong>死信主题</strong>（%DLQ%），等待人工干预。死信队列中的消息不会再被自动消费。</p>
<h3 data-id="heading-5">一体与分离：Kafka和RocketMQ的核心架构博弈</h3>
<p>说起RocketMQ就不能不提起Kafka了，两者都是消息中间件这个领域的霸主，但它们的核心<strong>架构设计差异，</strong> 直接决定了各自不同的性能特性和适用场景，这也是技术选型时必须深入理解的重点。</p>
<p><strong>核心架构设计差异</strong></p>
<p><strong>Kafka：读写一体的“分区日志”模型，</strong> Kafka的架构哲学是<strong>极简与统一。</strong> 它将每个主题分区抽象为一个<strong>仅追加（append-only）的物理日志文件。</strong> 生产者和消费者都直接与这个日志文件交互：生产者顺序写入尾部，消费者通过维护偏移量顺序读取。这种设计下，<strong>数据的读写路径完全一致，</strong> 逻辑与物理结构高度统一。</p>
<p><strong>RocketMQ：读写分离的“二级制”模型 ，</strong> RocketMQ的架构哲学是<strong>分工与优化。</strong> 它采用了<strong>物理CommitLog + 逻辑ConsumeQueue的二级结构。</strong> 所有消息都顺序写入一个统一的<strong>CommitLog</strong>物理文件，实现磁盘的最高效顺序写。同时，为每个消息队列异步构建一个轻量级的<strong>ConsumeQueue</strong>索引文件，消费者读取时先查询内存中的ConsumeQueue定位，再到CommitLog中获取消息体。这是一种<strong>逻辑与物理分离</strong>的设计。</p>
<p><strong>优劣势对比</strong></p>
<p>基于上述架构设计根本差异，两者在关键指标上各显优劣：</p>



































<table><thead><tr><th>维度</th><th>Kafka（读写一体）</th><th>RocketMQ（读写分离）</th></tr></thead><tbody><tr><td><strong>核心优势</strong></td><td><strong>极致吞吐与低延迟</strong>：读写同路径，数据写入后立即可读，端到端延迟极低。<strong>架构简单</strong>：无中间状态，副本同步、故障恢复逻辑清晰。</td><td><strong>高并发读与丰富功能</strong>：索引与数据分离，支持海量消费者并发读。<strong>业务友好</strong>：原生支持事务消息、定时/延时消息、消息轨迹查询。</td></tr><tr><td><strong>存储效率</strong></td><td><strong>磁盘顺序IO最大化</strong>：生产和消费都是严格顺序IO，尤其适合机械硬盘。</td><td><strong>写性能极致化</strong>：所有消息顺序写CommitLog，<strong>但存在“写放大”</strong> ，一条消息需写多次（1次CommitLog + N次ConsumeQueue）。</td></tr><tr><td><strong>读性能</strong></td><td><strong>消费者落后时可能触发随机读</strong>：若消费者要读取非尾部历史数据，可能需磁盘寻道。但现代SSD和预读机制已大大缓解此问题。</td><td><strong>读路径优化</strong>：ConsumeQueue小而固定，可全量缓存至内存，读操作变为“内存寻址 + CommitLog顺序/随机读”。在PageCache命中率高时表现优异。</td></tr><tr><td><strong>扩展性与成本</strong></td><td><strong>文件句柄（inode）开销大</strong>：每个分区都是独立目录和文件，海量分区时运维成本高。</td><td><strong>存储成本与效率更优</strong>：多Topic共享CommitLog，文件数少，<strong>特别适合中小消息体、多Topic的场景</strong>。</td></tr><tr><td><strong>典型场景</strong></td><td><strong>日志流、指标监控、实时流处理</strong>：作为大数据管道，与Flink/Spark生态无缝集成。</td><td><strong>电商交易、金融业务、异步解耦</strong>：需要严格顺序、事务保障、业务查询的在线业务场景。</td></tr></tbody></table>
<p>总而言之，Kafka像一个设计精良的<strong>高速公路系统，</strong> 核心目标是让数据车辆（消息）能够高吞吐、低延迟地持续流动，并方便地引向各个处理工厂（流计算）。而RocketMQ则像一个高度可靠的<strong>快递网络，</strong> 不仅确保包裹（消息）准确送达，还提供预约配送（定时）、签收确认（事务）、异常重投（重试）等一系列服务于业务逻辑的增值功能。</p>
<h3 data-id="heading-6">RocketMQ对于随机读取的优化</h3>
<p>RocketMQ在消费时候的流程</p>
<pre><code class="hljs">消费者请求 → ConsumeQueue（内存/顺序）获取commitlog上的物理偏移量 → 根据物理偏移量定位CommitLog（磁盘/随机） → 返回消息
</code></pre>
<p>从ConsumeQueue获取到消息在commitlog中的偏移量的时候，回查时候可能产生随机IO</p>
<ol>
<li><strong>第一次随机IO：</strong> 根据ConsumeQueue中的物理偏移量，在CommitLog中定位消息位置</li>
<li><strong>可能的连续随机IO：</strong> 如果一次拉取多条消息，这些消息在CommitLog中可能物理不连续</li>
</ol>
<p>为了保证RocketMQ的高性能，采用一些优化措施，尽量避免随机IO</p>
<p><strong>1. ConsumeQueue的内存映射优化</strong></p>
<p>实际上，RocketMQ将ConsumeQueue映射到内存,每个ConsumeQueue约5.72MB，可完全放入PageCache,读索引操作几乎是内存操作。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumeQueue</span> {
    <span class="hljs-keyword">private</span> MappedFile mappedFile;  <span class="hljs-comment">// 内存映射文件</span>
    <span class="hljs-comment">// 20字节每条：8(offset) + 4(size) + 8(tagHashCode)</span>
}
</code></pre>
<p><strong>2. PageCache的充分利用</strong></p>
<p>Linux PageCache工作流程： </p>
<ol>
<li>消息写入CommitLog → 进入PageCache</li>
<li>消费者读取 → 优先从PageCache获取</li>
<li>如果PageCache命中：内存速度（≈100ns）</li>
<li>如果PageCache未命中：磁盘随机读取（≈10ms）</li>
</ol>
<p><strong>3. 批量读取优化</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// DefaultMessageStore.java</span>
public GetMessageResult <span class="hljs-built_in">getMessage</span>(...) {
    <span class="hljs-comment">// 一次读取多条消息（默认最多32条）</span>
    <span class="hljs-comment">// 即使这些消息物理不连续，通过批量读取减少IO次数</span>
    for (int i = <span class="hljs-number">0</span>; i &lt; maxMsgNums; i++) {
        <span class="hljs-comment">// 使用同一个文件channel批量读取</span>
        <span class="hljs-built_in">readMessage</span>(ctx, msgId, consumerGroup);
    }
}
</code></pre>
<p><strong>4. 读取顺序性的保持</strong></p>
<p>虽然CommitLog中不同Topic的消息是随机存放的，但同一个Queue的消息在CommitLog中是基本连续的：</p>
<pre><code class="hljs language-markdown" lang="markdown">Queue1: | Msg1 | Msg3 | Msg5 | ... | 在ConsumeQueue中连续
        ↓      ↓      ↓
CommitLog: | Msg1 | Msg2(T2) | Msg3 | Msg4(T3) | Msg5 |
          ↑<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-emphasis">_↑
          物理上相对连续，减少磁头寻道
</span></code></pre>
<h3 data-id="heading-7">高可用设计：双轨并行的可靠性架构</h3>
<p><strong>主从架构（Master-Slave）</strong></p>
<p><strong>经典主从模式：</strong> RocketMQ早期采用Master-Slave架构，Master处理所有读写请求，Slave仅作为热备份。这种模式下，<strong>故障切换依赖人工干预或半自动脚本，</strong> 恢复时间通常在分钟级别。</p>
<p><strong>Dledger高可用集群：</strong> RocketMQ 4.5引入的Dledger基于Raft协议实现<strong>真正的主从自动切换。</strong> 当Master故障时，集群能在秒级（通常2-10秒）内自动选举新Leader，期间消息仍可写入（写入请求会阻塞至新Leader选出）。</p>
<p><strong>多副本机制：</strong> 现代部署中，建议采用<strong>2主2从或3主3从</strong>架构。例如在阿里云上，每个Broker组包含1个Master和2个Slave，形成<strong>跨可用区的三副本，</strong> 单机房故障不影响服务可用性。</p>
<p><strong>同步/异步复制</strong></p>
<p>同步复制保证强一致（消息不丢失），异步复制追求更高性能。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Broker配置示例</span>
brokerRole = SYNC_MASTER
<span class="hljs-comment">// 生产者发送消息后，必须等待至少一个Slave确认</span>
<span class="hljs-comment">// 确保即使Master宕机，消息也不会丢失</span>
</code></pre>
<ul>
<li>强一致性保证：消息写入Master后，同步复制到Slave才返回成功</li>
<li>性能代价：延迟增加约30-50%，TPS下降约20-40%</li>
<li>适用场景：金融交易、资金变动等对数据一致性要求极高的业务</li>
</ul>
<p><strong>同步/异步刷盘</strong></p>
<p>同步刷盘保证消息持久化不丢失，异步刷盘提升吞吐。</p>
<pre><code class="hljs language-arduino" lang="arduino">brokerRole = ASYNC_MASTER
<span class="hljs-comment">// 消息写入Master即返回成功，Slave异步复制</span>
<span class="hljs-comment">// 存在极短时间的数据丢失风险</span>
</code></pre>
<ul>
<li><strong>高性能模式：</strong> 延迟降低，吞吐量接近单节点性能</li>
<li><strong>风险窗口：</strong> Master宕机且数据未同步时，最近几秒消息可能丢失</li>
<li><strong>适用场景：</strong> 日志收集、监控数据、可容忍微量丢失的业务消息</li>
</ul>
<h3 data-id="heading-8">刷盘策略的工程优化</h3>
<p><strong>同步刷盘（SYNC_FLUSH）</strong></p>
<pre><code class="hljs">生产者 → Broker内存 → 磁盘强制刷盘 → 返回成功
</code></pre>
<ul>
<li><strong>零数据丢失：</strong> 即使机器掉电，消息也已持久化到磁盘</li>
<li><strong>性能瓶颈：</strong> 每次写入都触发磁盘IO，机械硬盘下TPS通常&lt;1000</li>
<li><strong>优化手段：</strong> 使用SSD硬盘可大幅提升性能</li>
</ul>
<p><strong>异步刷盘（ASYNC_FLUSH）</strong></p>
<pre><code class="hljs">生产者 → Broker内存 → 立即返回成功 → 异步批量刷盘
</code></pre>
<ul>
<li><strong>高性能选择：</strong> 依赖PageCache，SSD下TPS可达数万至数十万</li>
<li><strong>可靠性依赖：</strong> 依赖操作系统的刷盘机制（通常5秒刷盘一次）</li>
<li><strong>配置调优：</strong></li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 调整刷盘参数</span>
<span class="hljs-attr">flushCommitLogLeastPages</span> = <span class="hljs-number">4</span>    <span class="hljs-comment"># 至少4页（16KB）才刷盘</span>
<span class="hljs-attr">flushCommitLogThoroughInterval</span> = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 10秒强制刷盘一次</span>
</code></pre>
<h2 data-id="heading-9">四、Producer与Consumer：高效的生产与消费模型</h2>
<h3 data-id="heading-10">Producer</h3>
<p><strong>消息路由策略：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 内置多种队列选择算法</span>
<span class="hljs-title class_">DefaultMQProducer</span> producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">"ProducerGroup"</span>);
<span class="hljs-comment">// 1. 轮询（默认）：均匀分布到所有队列</span>
<span class="hljs-comment">// 2. 哈希：相同Key的消息路由到同一队列，保证局部顺序</span>
<span class="hljs-comment">// 3. 机房就近：优先选择同机房的Broker</span>
producer.<span class="hljs-title function_">send</span>(msg, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueueSelector</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MessageQueue</span> <span class="hljs-title function_">select</span>(<span class="hljs-params">List&lt;MessageQueue&gt; mqs, Message msg, <span class="hljs-built_in">Object</span> arg</span>) {
        <span class="hljs-comment">// 自定义路由逻辑</span>
        <span class="hljs-keyword">return</span> mqs.<span class="hljs-title function_">get</span>(arg.<span class="hljs-title function_">hashCode</span>() % mqs.<span class="hljs-title function_">size</span>());
    }
});
</code></pre>
<p><strong>发送模式对比：</strong></p>





























<table><thead><tr><th>模式</th><th>特点</th><th>性能</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>同步发送</strong></td><td>阻塞等待Broker响应</td><td>TPS约5000-20000</td><td>重要业务消息，需立即知道发送结果</td></tr><tr><td><strong>异步发送</strong></td><td>回调通知结果</td><td>TPS可达50000+</td><td>高并发场景，如日志、监控数据</td></tr><tr><td><strong>单向发送</strong></td><td>发送后不等待</td><td>TPS最高（100000+）</td><td>可容忍少量丢失的非关键数据</td></tr></tbody></table>
<p><strong>失败重试与熔断：</strong></p>
<ul>
<li><strong>智能重试：</strong> 发送失败时自动重试（默认2次），可配置退避策略</li>
<li><strong>故障规避：</strong> 自动检测Broker可用性，故障期间路由到健康节点</li>
<li><strong>慢请求熔断：</strong> 统计发送耗时，自动隔离响应慢的Broker</li>
</ul>
<h3 data-id="heading-11">Consumer</h3>
<p><strong>负载均衡策略：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 集群模式：同一ConsumerGroup内消费者均分队列</span>
consumer<span class="hljs-selector-class">.setMessageModel</span>(MessageModel.CLUSTERING);
<span class="hljs-comment">// 广播模式：每个消费者消费全量队列</span>
consumer<span class="hljs-selector-class">.setMessageModel</span>(MessageModel.BROADCASTING);
</code></pre>
<p><strong>消费进度管理：</strong></p>
<p><strong>Broker托管：</strong> 默认方式，消费进度存储在Broker</p>
<p><strong>本地维护：</strong> 某些场景下可自主管理offset（如批量处理）</p>
<p><strong>重置策略：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 支持多种消费起点</span>
consumer<span class="hljs-selector-class">.setConsumeFromWhere</span>(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);  <span class="hljs-comment">// 从最后</span>
consumer<span class="hljs-selector-class">.setConsumeFromWhere</span>(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET); <span class="hljs-comment">// 从头</span>
consumer<span class="hljs-selector-class">.setConsumeFromWhere</span>(ConsumeFromWhere.CONSUME_FROM_TIMESTAMP);    <span class="hljs-comment">// 从时间点</span>
</code></pre>
<p><strong>并发控制优化：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 关键并发参数</span>
consumer<span class="hljs-selector-class">.setConsumeThreadMin</span>(<span class="hljs-number">20</span>);     <span class="hljs-comment">// 最小消费线程数</span>
consumer<span class="hljs-selector-class">.setConsumeThreadMax</span>(<span class="hljs-number">64</span>);     <span class="hljs-comment">// 最大消费线程数</span>
consumer<span class="hljs-selector-class">.setPullBatchSize</span>(<span class="hljs-number">32</span>);        <span class="hljs-comment">// 每次拉取消息数</span>
consumer<span class="hljs-selector-class">.setConsumeMessageBatchMaxSize</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 批量消费大小</span>
<span class="hljs-comment">// 流控机制</span>
consumer<span class="hljs-selector-class">.setPullThresholdForQueue</span>(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// 队列堆积阈值</span>
consumer<span class="hljs-selector-class">.setPullInterval</span>(<span class="hljs-number">0</span>);              <span class="hljs-comment">// 拉取间隔（0为长轮询）</span>
</code></pre>
<h2 data-id="heading-12">五、核心流程与特性背后的架构支撑</h2>
<p>1 <strong>.顺序消息如何保证？</strong></p>
<p><strong>全局顺序：</strong> 单Topic单队列（牺牲并发）。</p>
<p><strong>分区顺序：</strong> 通过<strong>MessageQueue选择器</strong>确保同一业务键（如订单ID）的消息发往同一队列，Consumer端按队列顺序消费。</p>
<p><strong>2.事务消息的两阶段提交</strong></p>
<p><strong>流程详解：</strong> Half Message -&gt; 执行本地事务 -&gt; Commit/Rollback。</p>
<p><strong>架构支撑：</strong> Op消息回查机制，解决分布式事务的最终一致性，是架构设计中“状态可回溯”思想的体现。</p>
<p><strong>3.延时消息的实现奥秘</strong></p>
<p><strong>并非真正延迟投递：</strong> 为不同延迟级别预设<strong>独立的SCHEDULE_TOPIC，</strong> 定时任务扫描到期后投递至真实Topic。</p>
<p><strong>设计权衡：</strong> 以存储和计算换取功能的灵活与可靠。</p>
<h2 data-id="heading-13">六、其他性能优化关键技术点</h2>
<ol>
<li><strong>零拷贝（Zero-copy）：</strong> 通过sendfile或mmap+write方式，减少内核态与用户态间数据拷贝，大幅提升网络发送与文件读写效率。</li>
<li><strong>堆外内存与内存池：</strong> 避免JVM GC对大数据块处理的影响，实现高效的内存管理。</li>
<li><strong>文件预热：</strong> 启动时将存储文件映射到内存并写入“假数据”，避免运行时缺页中断。</li>
</ol>
<h2 data-id="heading-14">七、总结：RocketMQ架构设计的启示</h2>
<p>RocketMQ的架构设计，尤其是其在简洁性、高性能和云原生演进方面的平衡，为构建现代分布式系统提供了许多宝贵启示。</p>
<ol>
<li><strong>在简单与完备间权衡：</strong> RocketMQ没有采用强一致性的ZooKeeper，而是自研了极其简单的NameServer。这说明在非核心路径上，牺牲一定的功能完备性来换取简单性和高可用性，可能也是个不错的选择。</li>
<li><strong>以写定存储，以读优查询：</strong> 其存储架构是典型的写优化设计。所有消息顺序追加写入，保证了最高的写入性能。而针对消费和查询这两种主要的“读”场景，则分别通过异步构建索引数据结构（ConsumeQueue和IndexFile）来优化。</li>
</ol>
<h2 data-id="heading-15">八、参考资料</h2>
<ul>
<li>[RocketMQ官方文档](为什么选择RocketMQ | RocketMQ <a href="https://link.juejin.cn?target=https%3A%2F%2Frocketmq.apache.org%2Fzh%2Fdocs%2F" target="_blank" title="https://rocketmq.apache.org/zh/docs/" ref="nofollow noopener noreferrer">rocketmq.apache.org/zh/docs/</a>)</li>
<li>[RocketMQ中文社区](Apache RocketMQ 原理和架构 <a href="https://link.juejin.cn?target=https%3A%2F%2Frocketmq-learning.com%2Fcourse%2FbaseLearn%2Frocketmq_learning-framework%2F%3Fspm%3D5176.29160081.0.0.a2807833VzCxtS%26source%3Dhome" target="_blank" title="https://rocketmq-learning.com/course/baseLearn/rocketmq_learning-framework/?spm=5176.29160081.0.0.a2807833VzCxtS&amp;source=home" ref="nofollow noopener noreferrer">rocketmq-learning.com/course/base…</a>)</li>
</ul>
<h3 data-id="heading-16">往期回顾</h3>
<p>1.PAG在得物社区S级活动的落地</p>
<p>2.Ant Design 6.0 尝鲜：上手现代化组件开发｜得物技术 </p>
<p>3.Java 设计模式：原理、框架应用与实战全解析｜得物技术</p>
<p>4.Go语言在高并发高可用系统中的实践与解决方案｜得物技术</p>
<p>5.从0到1搭建一个智能分析OBS埋点数据的AI Agent｜得物技术</p>
<h3 data-id="heading-17">文 /磊子</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何查看 SpringBoot 当前线程数？3 种方法亲测有效]]></title>    <link>https://juejin.cn/post/7589126920287109130</link>    <guid>https://juejin.cn/post/7589126920287109130</guid>    <pubDate>2025-12-30T01:04:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920287109130" data-draft-id="7579945518344716303" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何查看 SpringBoot 当前线程数？3 种方法亲测有效"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-30T01:04:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何查看 SpringBoot 当前线程数？3 种方法亲测有效
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T01:04:38.000Z" title="Tue Dec 30 2025 01:04:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前几天，我在排查一个 SpringBoot 应用响应变慢的问题。日志看不出有什么异常，CPU和内存也还算正常，但用户就是觉得卡。</p>
<p>于是，我在想：<strong>是不是某个线程卡住了，或者线程池失控了？现在到底有多少线程在运行？</strong></p>
<p>好在查看线程数并不复杂，不管是临时诊断还是长期监控，都有现成的办法。下面我就分享几种常用的方式。</p>
<h2 data-id="heading-0">监控方案</h2>



































<table><thead><tr><th>监控方式</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>Spring Boot Actuator</td><td>生产环境监控</td><td>集成度高，RESTful接口</td><td>需要添加依赖和配置</td></tr><tr><td>jstack命令</td><td>紧急问题诊断</td><td>JDK自带，无需配置</td><td>命令行操作，不够直观</td></tr><tr><td>VisualVM</td><td>开发测试环境</td><td>图形化界面，功能强大</td><td>JDK 9+需要单独安装</td></tr><tr><td>JMC</td><td>生产环境深度分析</td><td>性能分析强大</td><td>内存占用较高</td></tr></tbody></table>
<p>下面我们看看前3种方案是怎么使用的。</p>
<h2 data-id="heading-1">一、Spring Boot自带监控（最简单）</h2>
<h3 data-id="heading-2">步骤1：添加依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 在pom.xml中添加 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">步骤2：修改配置</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 在application.yml中添加</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">"metrics,threaddump"</span>
</code></pre>
<h3 data-id="heading-4">步骤3：启动项目后，查看线程信息</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看线程总数</span>
http://127.0.0.1:8080/actuator/metrics/jvm.threads.live
</code></pre>
<p>如图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/206a64650f624b02a9ef13d94e13ccc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=l6ej68q80Rl0f8p%2FlGwHYk2DFxE%3D" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" loading="lazy"/></p>
<p><code>measurement.value</code> 就是当前存活的线程数，配置简单，不用记命令。</p>
<p><strong>安全配置（生产环境）</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">user:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">admin</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">securepassword</span>

<span class="hljs-attr">management:</span>
  <span class="hljs-attr">server:</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">9090</span>  <span class="hljs-comment"># 监控端口与业务端口分离</span>
</code></pre>
<h2 data-id="heading-5">二、使用jstack命令（最常用）</h2>
<h3 data-id="heading-6">1. 找到应用ID</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有Java进程</span>
jps -l

<span class="hljs-comment"># 或者使用ps命令</span>
ps aux | grep java
</code></pre>
<p>输出类似：</p>
<pre><code class="hljs">36756 org.springframework.boot.loader.JarLauncher
</code></pre>
<p>如图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f5e7222ce634c04ac2851a8b5272806~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=7fi0FOosWnF3gWMRhYJnJzdd0sw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2. 分析线程</h3>
<pre><code class="hljs language-bash" lang="bash">jstack 36756
</code></pre>
<p>如图：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c3aa11ba23e4d5ea5e4f0ee6e52c810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=pgnb8BumnKxUzyfSan2ZrWTMHEE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-8">线程状态说明</h4>
<ul>
<li><strong>RUNNABLE</strong>: 线程正在运行或准备运行</li>
<li><strong>WAITING</strong>: 无限期等待其他线程的特定操作</li>
<li><strong>TIMED_WAITING</strong>: 有限时间等待</li>
<li><strong>BLOCKED</strong>: 等待获取监视器锁</li>
<li><strong>TERMINATED</strong>: 线程已结束</li>
</ul>
<h4 data-id="heading-9">关键线程类型识别</h4>
<p><strong>1. JVM系统线程</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"Reference Handler"</span> - 引用处理线程
<span class="hljs-string">"Finalizer"</span> - 对象终结线程
<span class="hljs-string">"Signal Dispatcher"</span> - 信号分发线程
<span class="hljs-string">"GC Thread"</span> - 垃圾回收线程（多个）
</code></pre>
<p><strong>2. Spring Boot应用线程</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"http-nio-8080-exec-*"</span> - Tomcat工作线程
<span class="hljs-string">"Catalina-utility-*"</span> - Tomcat工具线程
<span class="hljs-string">"HikariPool-*"</span> - 数据库连接池线程
</code></pre>
<p><strong>3. 第三方库线程</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"lettuce-*"</span> - Redis客户端线程
<span class="hljs-string">"boundedElastic-*"</span> - Reactor响应式线程
<span class="hljs-string">"mysql-cj-*"</span> - MySQL驱动线程
</code></pre>
<h3 data-id="heading-10">3. 线程快照</h3>
<p>也可以生成线程快照，保存到文件后再慢慢分析</p>
<pre><code class="hljs language-bash" lang="bash">jstack 36756 &gt; thread.txt
</code></pre>
<p><strong>快速统计命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 统计总线程数</span>
grep <span class="hljs-string">'java.lang.Thread.State'</span> thread.txt | <span class="hljs-built_in">wc</span> -l

<span class="hljs-comment"># 统计Tomcat线程数  </span>
grep <span class="hljs-string">'"http-nio'</span> thread.txt | <span class="hljs-built_in">wc</span> -l

<span class="hljs-comment"># 查看线程状态分布</span>
grep <span class="hljs-string">'java.lang.Thread.State'</span> thread.txt | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c
</code></pre>
<p><strong>也可以通过自动化监控脚本进行分析</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># monitor_threads.sh</span>

APP_NAME=<span class="hljs-string">"your-spring-boot-app"</span>
LOG_DIR=<span class="hljs-string">"./thread_dumps"</span>
INTERVAL=60  <span class="hljs-comment"># 监控间隔(秒)</span>
MAX_DUMPS=10 <span class="hljs-comment"># 最大转储文件数</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$LOG_DIR</span>

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    PID=$(jps -l | grep <span class="hljs-variable">$APP_NAME</span> | awk <span class="hljs-string">'{print $1}'</span>)
    
    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$PID</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: 应用未运行"</span>
        <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$INTERVAL</span>
        <span class="hljs-built_in">continue</span>
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 生成时间戳</span>
    TIMESTAMP=$(<span class="hljs-built_in">date</span> +%Y%m%d_%H%M%S)
    
    <span class="hljs-comment"># 生成线程转储</span>
    jstack <span class="hljs-variable">$PID</span> &gt; <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt
    
    <span class="hljs-comment"># 统计线程信息</span>
    TOTAL_THREADS=$(grep <span class="hljs-string">'java.lang.Thread.State'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    RUNNABLE=$(grep <span class="hljs-string">'java.lang.Thread.State: RUNNABLE'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    WAITING=$(grep <span class="hljs-string">'java.lang.Thread.State: WAITING'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    BLOCKED=$(grep <span class="hljs-string">'java.lang.Thread.State: BLOCKED'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: 线程统计 - 总数: <span class="hljs-variable">$TOTAL_THREADS</span>, 运行: <span class="hljs-variable">$RUNNABLE</span>, 等待: <span class="hljs-variable">$WAITING</span>, 阻塞: <span class="hljs-variable">$BLOCKED</span>"</span>
    
    <span class="hljs-comment"># 清理旧文件</span>
    <span class="hljs-built_in">ls</span> -t <span class="hljs-variable">$LOG_DIR</span>/thread_dump_*.txt | <span class="hljs-built_in">tail</span> -n +<span class="hljs-variable">$MAX_DUMPS</span> | xargs <span class="hljs-built_in">rm</span> -f
    
    <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$INTERVAL</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p><strong>优点</strong>：不用改代码，随时可用</p>
<h2 data-id="heading-11">三、使用VisualVM（最直观）</h2>
<h3 data-id="heading-12">1. 安装步骤</h3>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualvm.github.io%2F" target="_blank" title="https://visualvm.github.io/" ref="nofollow noopener noreferrer">visualvm.github.io/</a></li>
<li>下载对应版本</li>
<li>解压后运行<code>bin/visualvm</code></li>
</ol>
<h3 data-id="heading-13">2. 使用方法</h3>
<ol>
<li>启动VisualVM</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows</span>
visualvm.exe

<span class="hljs-comment"># Linux/macOS</span>
./visualvm
</code></pre>
<ol start="2">
<li>在左边找到你的应用</li>
<li>点击应用名称就能看到基础信息页了</li>
</ol>
<p>如图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84812efa51694a3880a5d0a615021f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=vAhF3JXp1bVAGJMkRs1BPY8W8yQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-14">Monitor 监控页</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8d6ad30cafe4f12ad2dabe08ec62ba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=5Eo08DT15a4II0FhZYPhQL%2B2lF8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>界面说明</strong></p>
<ul>
<li>CPU使用率：查看方法执行时间</li>
<li>堆内存使用：监控内存泄漏</li>
<li>Metaspace：JDK 17中的元数据空间</li>
<li>类加载数量</li>
<li>线程数：实时查看线程创建和销毁</li>
</ul>
<h4 data-id="heading-15">Threads 线程标签页（最重要）</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1699c27464294f99a8bb34afb4a4f9b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=mLfXCfKS5DvE1r%2FGGvLkZ5DP63k%3D" alt="" loading="lazy"/></p>
<p><strong>界面说明</strong></p>
<ul>
<li>实时查看所有线程状态</li>
<li>颜色标识：
<ul>
<li>绿色：运行中 (RUNNABLE)</li>
<li>黄色：等待 (WAITING, TIMED_WAITING)</li>
<li>红色：阻塞 (BLOCKED)</li>
</ul>
</li>
<li>可以生成线程转储（相当于jstack）</li>
</ul>
<p>这里可以查看线程的详细信息</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5160989cde5d47fba8efb560e49230d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=4H14DMYU5hWMakEHkoqetUP6j%2Bw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>详细信息内容看到的就和我们上面执行的结果是一样的，需要的话可以复制下来保存到本地</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26d1e83fa78c470dab22974632f5f872~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=OBSGNqymyP%2FLPrKSchxmus0AQIk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-16">3. 远程监控配置</h3>
<h4 data-id="heading-17">应用端配置</h4>
<p>启动Spring Boot时添加JMX参数：</p>
<pre><code class="hljs language-bash" lang="bash">java -Dcom.sun.management.jmxremote \
     -Dcom.sun.management.jmxremote.port=9090 \
     -Dcom.sun.management.jmxremote.ssl=<span class="hljs-literal">false</span> \
     -Dcom.sun.management.jmxremote.authenticate=<span class="hljs-literal">false</span> \
     -Dcom.sun.management.jmxremote.local.only=<span class="hljs-literal">false</span> \
     -Djava.rmi.server.hostname=你的服务器IP \
     -jar your-app.jar
</code></pre>
<h4 data-id="heading-18">VisualVM连接配置</h4>
<ol>
<li>右键"远程" → "添加远程主机"</li>
<li>输入主机名或IP地址</li>
<li>右键远程主机 → "添加JMX连接"</li>
<li>输入端口号(9090)</li>
</ol>
<p><strong>优点</strong>：图形界面，一目了然</p>
<h2 data-id="heading-19">四、问题排查案例</h2>
<h3 data-id="heading-20">案例1：应用变慢</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 生成线程快照</span>
jstack 36756 &gt; slow.txt

<span class="hljs-comment"># 2. 查看有没有BLOCKED线程</span>
grep <span class="hljs-string">"BLOCKED"</span> slow.txt

<span class="hljs-comment"># 3. 查看Tomcat线程在干什么</span>
grep -A 5 <span class="hljs-string">"http-nio"</span> slow.txt
</code></pre>
<h3 data-id="heading-21">案例2：内存占用高</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看线程总数是否异常</span>
grep <span class="hljs-string">'java.lang.Thread.State'</span> thread.txt | <span class="hljs-built_in">wc</span> -l
</code></pre>
<p>正常：30-100个线程
异常：超过500个线程</p>
<h3 data-id="heading-22">案例3：应用无响应</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 强制生成线程快照</span>
jstack -F 36756 &gt; stuck.txt

<span class="hljs-comment"># 查找死锁</span>
grep -i <span class="hljs-string">"deadlock"</span> stuck.txt
</code></pre>
<h2 data-id="heading-23">总结</h2>
<p>如果你在开发或测试阶段，想快速直观地了解线程状态，<code>VisualVM</code> 是最友好的选择。</p>
<p>如果你正在线上排查问题，又不方便改代码或重启服务，<code>jstack</code> 这类 JDK 自带命令就是你的急救包，轻量、不需要其它依赖。</p>
<p>而如果你已经部署了监控体系，那么 <code>SpringBoot Actuator</code> 不仅能告诉你线程数量，还能集成到 <code>Prometheus</code>、<code>Grafana</code> 等监控平台，实现自动化告警。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-24">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">《代码里全是 new 对象，真的很 Low 吗？我认真想了一晚》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">《Java 开发必看：什么时候用 for，什么时候用 Stream？》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">《这 5 个冷门 HTML 标签，让我直接删了100 行 JS 代码》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FT3ronvigepWew6dRC4uH2g" target="_blank" title="https://mp.weixin.qq.com/s/T3ronvigepWew6dRC4uH2g" ref="nofollow noopener noreferrer">《Vue 组件通信的 8 种最佳实践，你知道几种？》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（12）什么是Hibernate的实体类？]]></title>    <link>https://juejin.cn/post/7589466706378588196</link>    <guid>https://juejin.cn/post/7589466706378588196</guid>    <pubDate>2025-12-30T11:51:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466706378588196" data-draft-id="7589262021562187817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（12）什么是Hibernate的实体类？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T11:51:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（12）什么是Hibernate的实体类？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:51:46.000Z" title="Tue Dec 30 2025 11:51:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的实体类（Entity Class）是与数据库表映射的Java类。每个实体类对应数据库中的一个表，类中的每个属性对应表中的一列。实体类使用Java持久化API (JPA)的注解或者Hibernate特有的注解来标注，定义类和表之间的映射关系。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>类-表映射</strong>：实体类与数据库表的映射。</li>
<li><strong>属性-列映射</strong>：类的属性与表的列的映射。</li>
<li><strong>主键标识</strong>：使用注解标识主键。</li>
<li><strong>关系映射</strong>：支持一对一、一对多、多对一和多对多等关联关系。</li>
</ol>
<h3 data-id="heading-1">示例项目结构</h3>
<p>为了深入理解Hibernate的实体类，下面是一个完整的示例，包括如何配置Hibernate文件、定义实体类、以及简单的CRUD操作。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">使用实体类进行CRUD操作</h3>
<p>下面是一个示例，演示如何使用Hibernate的实体类进行CRUD操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 创建对象并保存到数据库</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student); <span class="hljs-comment">// 持久化对象</span>

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 读取对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 更新对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (student != <span class="hljs-literal">null</span>) {
                student.setAge(<span class="hljs-number">21</span>);
                session.update(student); <span class="hljs-comment">// 更新对象</span>
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 删除对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (student != <span class="hljs-literal">null</span>) {
                session.delete(student); <span class="hljs-comment">// 删除对象</span>
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>实体类定义</strong>：通过<code>@Entity</code>注解将类标识为Hibernate的实体类。<code>@Id</code>注解标识主键，<code>@GeneratedValue</code>注解指定主键生成策略。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
}
</code></pre>
</li>
<li>
<p><strong>创建并保存对象</strong>：使用<code>session.save(student)</code>方法将实体对象持久化到数据库中。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
session.save(student);
</code></pre>
</li>
<li>
<p><strong>读取对象</strong>：使用<code>session.get(Student.class, 1L)</code>方法从数据库中读取实体对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
</code></pre>
</li>
<li>
<p><strong>更新对象</strong>：先从数据库中读取对象，然后修改对象属性，最后使用<code>session.update(student)</code>方法同步修改到数据库。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
student.setAge(<span class="hljs-number">21</span>);
session.update(student);
</code></pre>
</li>
<li>
<p><strong>删除对象</strong>：先从数据库中读取对象，然后使用<code>session.delete(student)</code>方法删除对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
session.delete(student);
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">事务管理</h3>
<p>在进行增删改操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 持久化操作</span>
    transaction.commit();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
        transaction.rollback();
    }
    e.printStackTrace();
}
</code></pre>
<h3 data-id="heading-8">总结</h3>
<p>Hibernate的实体类是Java类与数据库表结构映射的核心。通过JPA注解，实体类定义了持久化对象的属性和行为，并与数据库表的结构紧密结合。通过Hibernate提供的API，可以方便地对实体类进行CRUD操作，实现数据的持久化管理。理解Hibernate的实体类及其使用方法，对于高效地管理数据库和实现数据持久化具有重要意义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[无成本搭建 AI 画图神器！我以后再也不会手绘架构图了]]></title>    <link>https://juejin.cn/post/7589176150493233206</link>    <guid>https://juejin.cn/post/7589176150493233206</guid>    <pubDate>2025-12-30T01:29:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589176150493233206" data-draft-id="7589201772118605830" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="无成本搭建 AI 画图神器！我以后再也不会手绘架构图了"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-30T01:29:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小富"/> <meta itemprop="url" content="https://juejin.cn/user/993614241734270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            无成本搭建 AI 画图神器！我以后再也不会手绘架构图了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614241734270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小富
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T01:29:32.000Z" title="Tue Dec 30 2025 01:29:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>大家好，我是小富～</strong></p>
<p>这期我带大家无成本搭建一个超强的 AI 画图工具，没错就是<strong>无成本</strong>！</p>
<p>老粉丝都知道，我以前的文章中会出现很多还算精美的插图，这些图片大部分都是我用 draw.io 一点点抠出来的。</p>
<p>比如这样的分库分表示意图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dd8fbc8e5e49b5b0d45b9480bb368c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=DbwE6gHxI3KgM%2FhRYq%2Bw6%2FcTisE%3D" alt="" loading="lazy"/></p>
<p>TCP的三次握手的流程图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d8e82465c324753b3529f50e65411b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=GUStuK%2FmN2ncB504NlW2lWkNPFs%3D" alt="" loading="lazy"/></p>
<p>还有这样的一致性hash原理图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/311b6abc74cc41b68cdad8734c37f29a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=ZUnA73NI6LzGVmR8DVTMVusqwHc%3D" alt="" loading="lazy"/></p>
<p>现在AI越来越牛X，写文章都可以用AI来辅助，可是画图这事儿，还是得手动绘制。有时候为了画一个逻辑严密的架构图，画图可能就占了写文章一半以上的时间！</p>
<p>我个人还是比较喜欢 draw.io 那种清爽、专业的风格，但现在我用的 drawio 版本 AI 也使不上劲。所以我就在想，有没有一个AI + drawio 的结合体？我说需求，它出图，而且还能支持二次编辑？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f83bc22a1b614728ad6173c519990f4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=gu2gsVGfMNwhaQsVrZxYSRHimt4%3D" alt="" loading="lazy"/></p>
<p>在我摸鱼时候，居然让我在Github 扒到了 <strong>next-ai-draw-io</strong> 这个开源项目。</p>
<p>试用了一下，只能说，以前我那都是过的什么日子，显得好呆啊！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af9c821463454590a3ce1982221eea46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=SV%2FSubJwsda%2BCIQoy2pYUiFma7Q%3D" alt="" loading="lazy"/></p>
<p>废话不多说搞起，重点是不仅要用起来，还要无成本部署到线上。</p>
<h2 data-id="heading-0">next-ai-draw-io</h2>
<p>他是个纯前端的基于 Next.js 和 AI 模型的项目，使用非常简单，就像你使用其他的AI工具一样，编写 prompt 就能快速把文字描述，变成简约美观的流程图、序列图、思维导图。</p>
<p>而且生成的不是一张死图，是可以二次编辑微调的，这对程序员和架构师来说太重要了。</p>
<p>多模型支持也还算全吧，市面上常用的OpenAI、deepseek 基础都支持了。</p>
<p>现在很多技术文章里的图很多也是AI做的，所以我越来越觉得，单纯的写技术文章价值越来越低了，必须要弄一些AI也给不出你满意结果的东西。</p>
<h2 data-id="heading-1">上手使用</h2>
<h3 data-id="heading-2">改配置</h3>
<p>next-ai-draw-io 项目源码下载以后，只需要做一件事，复制文件 env.example 内容新建一个 .env.local 文件，主要是设置默认的大模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/149e45c2e2bd4acbb007395dbaccd65d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=B4vFJAZYiJP794g364hxxdQOBaY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">编译启动</h3>
<p>直接编译启动就行了</p>
<pre><code class="hljs language-shell" lang="shell">git clone https://github.com/DayuanJiang/next-ai-draw-io
cd next-ai-draw-io

npm install

cp env.example .env.local

npm run dev
</code></pre>
<p>更简单的可以直接 docker 启动，参数上设置要用的模型类型</p>
<pre><code class="hljs language-shell" lang="shell">docker run -d -p 3000:3000 \
  -e AI_PROVIDER=openai \
  -e AI_MODEL=gpt-4o \
  -e OPENAI_API_KEY=your_api_key \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>或者用一个环境文件</p>
<pre><code class="hljs language-shell" lang="shell">cp env.example .env

docker run -d -p 3000:3000 --env-file .env ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>直接页面访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a> ，打开能看到了，可以选择修改模型配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/664c59d5118c4d5b80ec0c24dfafcccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=iyIq66V%2FuItYQKzmBcBVIEFAWlE%3D" alt="" loading="lazy"/></p>
<p>我试了下手机上用效果也还行</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6e4379a525e4755b5d7ea9eee471719~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=l20auv3N7uHGMwjRSBotHGmErbo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">MCP</h3>
<p>它还提供了 MCP 服务，可以在大模型里直接配置调用，要不你让大模型给你画图，它只能提供 mermaid 格式，渲染不直观改起还来麻烦。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"drawio"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"@next-ai-drawio/mcp-server@latest"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">Vercel 免费部署</h2>
<p>官方推荐 Docker 部署，但还得买服务器，那不是我的风格。因为这是个 Next 项目，而 Vercel 它支持 Next 个人开发者免费托管部署，一分钱不花，服务器都不用买。</p>
<p>部署流程也非常简单，几步就搞定。</p>
<h3 data-id="heading-6">导入项目</h3>
<p>首先将 next-ai-draw-io Fork到你自己的GitHub里，GitHub地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer">github.com/DayuanJiang…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e10b2b43fb4242aa37621f41730f94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=wIx9caMmdAO8M0j6SXEmJhV6kdg%3D" alt="" loading="lazy"/></p>
<p>登录 Vercel 官网 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fnew%25EF%25BC%258C%25E7%2594%25A8" target="_blank" title="https://vercel.com/new%EF%BC%8C%E7%94%A8" ref="nofollow noopener noreferrer">vercel.com/new，用</a> GitHub 登录并导入刚刚你 Fork 的 <code>next-ai-draw-io</code> 项目。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61ae466caa5444bc878c464cfc5015eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=db6byNBzl2iGQLc%2BpKu9jdWDtq0%3D" alt="" loading="lazy"/></p>
<p>配置环境变量，这里一定是 <strong>Hobby</strong>，只有个人开发者是免费的。</p>
<p>如果你不想在项目代码中设置密钥，可以在 Environment Variables 区域，需要填入 AI 的配置信息。比如用 deepseek 那就配置如下就行</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">AI_PROVIDER=deepseek</span> <span class="hljs-comment"># 用哪个服务商</span>
<span class="hljs-string">AI_MODEL=deepseek-chat</span> <span class="hljs-comment"># 用哪个模型</span>
<span class="hljs-string">DEEPSEEK_API_KEY=sk-22222</span> <span class="hljs-comment"># 密钥</span>
<span class="hljs-string">DEEPSEEK_BASE_URL=https://api.deepseek.com</span>
</code></pre>
<p>填好后，直接点击 Deploy。大概等待 1-2 分钟，Vercel 提供了 <code>xxx.vercel.app</code> 格式的域名，可以直接访问。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9b8a95824e44dfab047b08f5185b468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=Bes3BbxMHJncY%2FOFe47ZCvZADwk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">自定义域名</h3>
<p>如果你自己有域名也可以直接指向过来，Vercel 的地址是 76.76.21.21，然后在已经部署的项目上 setting -&gt; domain -&gt; add domain 就可以了，直接傻瓜式操作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97620f847450470cac806cac5dc31b70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=JpvFefwwhRqVK2ijHOP6r9u7vCA%3D" alt="" loading="lazy"/></p>
<p>这是我自己搭建的地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdrawio.xiaofucode.com%2Fzh%25EF%25BC%258C%25E6%2584%259F%25E5%2585%25B4%25E8%25B6%25A3%25E5%258F%25AF%25E4%25BB%25A5%25E7%258E%25A9%25E4%25B8%2580%25E4%25B8%258B%25EF%25BC%258C%25E5%25A5%25BD%25E5%25A5%25BD%25E7%2594%25A8%25E6%25B2%25A1%25E6%259C%2589%25E5%25A4%259A%25E5%25B0%2591%25E9%2592%25B1%25E7%259A%2584%25EF%25BC%2581" target="_blank" title="https://drawio.xiaofucode.com/zh%EF%BC%8C%E6%84%9F%E5%85%B4%E8%B6%A3%E5%8F%AF%E4%BB%A5%E7%8E%A9%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%A5%BD%E5%A5%BD%E7%94%A8%E6%B2%A1%E6%9C%89%E5%A4%9A%E5%B0%91%E9%92%B1%E7%9A%84%EF%BC%81" ref="nofollow noopener noreferrer">drawio.xiaofucode.com/zh，感兴趣可以玩一下…</a></p>
<h2 data-id="heading-8">总结</h2>
<p>以前手搓一个复杂的业务架构图，光是拖拽对齐就要半小时。现在底稿由 AI 生成，我只需要修修补补确实快了很多。有时候脑子卡壳，不知道流程哪里漏了，能帮我查漏补缺。</p>
<p>缺点就是审美一般，AI 直接生成的配色和布局比较直男，所以prompt 多给他提要求就好了。复杂逻辑不够准，特别复杂的超大系统图，连线会乱飞，还是要人调整的。</p>
<p>总的来说，这是一个 80 分的辅助工具，对于我这种写文章、写文档的人来说，绝对是神器，可以省掉很多重复劳动。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxNTM4NzAyNg%3D%3D%26mid%3D2247499835%26idx%3D1%26sn%3Da202a41010813cd6e7496ef796723735%26chksm%3D9b8650c6acf1d9d0002189ed373170a770701fedaaaf2939a6eb041c58f2bbc749020aab728f%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&amp;mid=2247499835&amp;idx=1&amp;sn=a202a41010813cd6e7496ef796723735&amp;chksm=9b8650c6acf1d9d0002189ed373170a770701fedaaaf2939a6eb041c58f2bbc749020aab728f#rd" ref="nofollow noopener noreferrer">PS：这里送题主和大家一份计算机书籍资源包，基本上是我这些年学习和工作中看过的书籍，本身我是做后端的，像Java、数据结构、操作系统、JVM、SQL调优、面试题、职业规划看的会多花一些），点击下边链接直接获取：</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：双流操作]]></title>    <link>https://juejin.cn/post/7589477341765664814</link>    <guid>https://juejin.cn/post/7589477341765664814</guid>    <pubDate>2025-12-30T12:14:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589477341765664814" data-draft-id="7589325011544768550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：双流操作"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2025-12-30T12:14:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：双流操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:14:33.000Z" title="Tue Dec 30 2025 12:14:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天来梳理一下 Flink 双流操作相关的源码。</p>
<h3 data-id="heading-0">写在前面</h3>
<p>通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F07%2F19%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E5%25A4%259A%25E6%25B5%2581join%2F" target="_blank" title="https://jackeyzhe.github.io/2025/07/19/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%A4%9A%E6%B5%81join/" ref="nofollow noopener noreferrer">Flink学习笔记：多流 Join</a>一文的介绍，我们知道 Flink 有三种数据关联的方式，分别是 Window Join、Interval Join 和 CoGroup。下面我们分别看下这三种关联方式的源码实现。</p>
<h3 data-id="heading-1">Window Join</h3>
<p>我们先回顾一下 window join 的使用方法。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">DataStream&lt;Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; result = source1.<span class="hljs-keyword">join</span>(source2)
        .<span class="hljs-keyword">where</span>(record -&gt; record.f0)
        .equalTo(record -&gt; record.f0)
        .window(TumblingEventTimeWindows.<span class="hljs-keyword">of</span>(Time.seconds(<span class="hljs-number">2L</span>)))
        .apply(<span class="hljs-built_in">new</span> JoinFunction&lt;Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;() {
            @Override
            <span class="hljs-keyword">public</span> Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; <span class="hljs-keyword">join</span>(Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record1, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record2) throws Exception {
                <span class="hljs-keyword">return</span> Tuple2.<span class="hljs-keyword">of</span>(record1.f0, record1.f1);
            }
        });
</code></pre>
<p>上述调用链路类的流转如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6d0539edba546b89aa521409a906a60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701672&amp;x-signature=VLzajX1b5lw864yFEqBbbXPs3qk%3D" alt="windowjoin" loading="lazy"/></p>
<p>在 WithWindow 的 apply 方法中，是构建了一个 coGroupedWindowedStream，然后调用它的 apply 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;T&gt; SingleOutputStreamOperator&lt;T&gt; <span class="hljs-built_in">apply</span>(
        JoinFunction&lt;T1, T2, T&gt; function, TypeInformation&lt;T&gt; resultType) {
    <span class="hljs-comment">// clean the closure</span>
    function = input1<span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(function);

    coGroupedWindowedStream =
            input1<span class="hljs-selector-class">.coGroup</span>(input2)
                    <span class="hljs-selector-class">.where</span>(keySelector1)
                    <span class="hljs-selector-class">.equalTo</span>(keySelector2)
                    <span class="hljs-selector-class">.window</span>(windowAssigner)
                    <span class="hljs-selector-class">.trigger</span>(trigger)
                    <span class="hljs-selector-class">.evictor</span>(evictor)
                    <span class="hljs-selector-class">.allowedLateness</span>(allowedLateness);

    return coGroupedWindowedStream<span class="hljs-selector-class">.apply</span>(new JoinCoGroupFunction&lt;&gt;(function), resultType);
}
</code></pre>
<p>这里可以看出，Window Join 的底层是转换成 coGroup 进行处理的。</p>
<p>在 JoinCoGroupFunction 中，coGroup 方法就是对两个流进行两层遍历，然后将其应用到我们自定义的 JoinFunction 上。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">JoinCoGroupFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt;
        <span class="hljs-title">extends</span> <span class="hljs-title">WrappingFunction</span>&lt;<span class="hljs-title">JoinFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt;&gt;
        <span class="hljs-title">implements</span> <span class="hljs-title">CoGroupFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">long</span> serialVersionUID = <span class="hljs-number">1L</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JoinCoGroupFunction</span>(<span class="hljs-params">JoinFunction&lt;T1, T2, T&gt; wrappedFunction</span>)</span> {
        super(wrappedFunction);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">coGroup</span>(<span class="hljs-params">Iterable&lt;T1&gt; first, Iterable&lt;T2&gt; second, Collector&lt;T&gt; <span class="hljs-keyword">out</span></span>)
            throws Exception</span> {
        <span class="hljs-keyword">for</span> (T1 val1 : first) {
            <span class="hljs-keyword">for</span> (T2 val2 : second) {
                <span class="hljs-keyword">out</span>.collect(wrappedFunction.<span class="hljs-keyword">join</span>(val1, val2));
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-2">CoGroup</h3>
<p>CoGroup 的整体用法和流程与 Join 都类似，我们就不逐个介绍了。我们直接来看 apply 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;T&gt; SingleOutputStreamOperator&lt;T&gt; <span class="hljs-built_in">apply</span>(
        CoGroupFunction&lt;T1, T2, T&gt; function, TypeInformation&lt;T&gt; resultType) {
    <span class="hljs-comment">// clean the closure</span>
    function = input1<span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(function);

    UnionTypeInfo&lt;T1, T2&gt; unionType =
            new UnionTypeInfo&lt;&gt;(input1.getType(), input2<span class="hljs-selector-class">.getType</span>());
    UnionKeySelector&lt;T1, T2, KEY&gt; unionKeySelector =
            new UnionKeySelector&lt;&gt;(keySelector1, keySelector2);

    SingleOutputStreamOperator&lt;TaggedUnion&lt;T1, T2&gt;&gt; taggedInput1 =
            input1<span class="hljs-selector-class">.map</span>(new Input1Tagger&lt;T1, T2&gt;());
    taggedInput1<span class="hljs-selector-class">.getTransformation</span>()<span class="hljs-selector-class">.setParallelism</span>(input1.getParallelism(), false);
    taggedInput1<span class="hljs-selector-class">.returns</span>(unionType);

    SingleOutputStreamOperator&lt;TaggedUnion&lt;T1, T2&gt;&gt; taggedInput2 =
            input2<span class="hljs-selector-class">.map</span>(new Input2Tagger&lt;T1, T2&gt;());
    taggedInput2<span class="hljs-selector-class">.getTransformation</span>()<span class="hljs-selector-class">.setParallelism</span>(input2.getParallelism(), false);
    taggedInput2<span class="hljs-selector-class">.returns</span>(unionType);

    DataStream&lt;TaggedUnion&lt;T1, T2&gt;&gt; unionStream = taggedInput1<span class="hljs-selector-class">.union</span>(taggedInput2);

    <span class="hljs-comment">// we explicitly create the keyed stream to manually pass the key type information in</span>
    windowedStream =
            new KeyedStream&lt;TaggedUnion&lt;T1, T2&gt;, KEY&gt;(
                            unionStream, unionKeySelector, keyType)
                    <span class="hljs-selector-class">.window</span>(windowAssigner);

    if (trigger != null) {
        windowedStream<span class="hljs-selector-class">.trigger</span>(trigger);
    }
    if (evictor != null) {
        windowedStream<span class="hljs-selector-class">.evictor</span>(evictor);
    }
    if (allowedLateness != null) {
        windowedStream<span class="hljs-selector-class">.allowedLateness</span>(allowedLateness);
    }

    return windowedStream<span class="hljs-selector-class">.apply</span>(
            new CoGroupWindowFunction&lt;T1, T2, T, KEY, W&gt;(function), resultType);
}
</code></pre>
<p>在 apply 方法中，先把两个流进行合并，然后创建了 windowedStream，并把窗口相关的属性设置好，最后是调用 windowedStream 的 apply 方法。</p>
<p>在调用 <code>windowedStream.apply</code> 方法时，又将 function 包装成了 CoGroupWindowFunction。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">private</span> static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoGroupWindowFunction&lt;T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>, <span class="hljs-title">KEY</span>, <span class="hljs-title">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Window&gt;</span></span>
        <span class="hljs-keyword">extends</span> <span class="hljs-type">WrappingFunction</span>&lt;<span class="hljs-type">CoGroupFunction</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>, <span class="hljs-type">T</span>&gt;&gt;
        implements <span class="hljs-type">WindowFunction</span>&lt;<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt;, <span class="hljs-type">T</span>, <span class="hljs-type">KEY</span>, <span class="hljs-type">W</span>&gt; {

    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1</span>L;

    public <span class="hljs-type">CoGroupWindowFunction</span>(<span class="hljs-type">CoGroupFunction</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>, <span class="hljs-type">T</span>&gt; userFunction) {
        <span class="hljs-keyword">super</span>(userFunction);
    }

    <span class="hljs-meta">@Override</span>
    public void apply(<span class="hljs-type">KEY</span> key, <span class="hljs-type">W</span> window, <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt;&gt; values, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">T</span>&gt; out)
            <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {

        <span class="hljs-type">List</span>&lt;<span class="hljs-type">T1</span>&gt; oneValues = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">T2</span>&gt; twoValues = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt; <span class="hljs-keyword">val</span> : values) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">val</span>.isOne()) {
                oneValues.add(<span class="hljs-keyword">val</span>.getOne());
            } <span class="hljs-keyword">else</span> {
                twoValues.add(<span class="hljs-keyword">val</span>.getTwo());
            }
        }
        wrappedFunction.coGroup(oneValues, twoValues, out);
    }
}
</code></pre>
<p>在 CoGroupWindowFunction 的 apply 方法中是将主键为 key 的流分开两个流，再去调用 JoinCoGroupFunction 的 coGroup 方法。这里的 values 都是相同的 key，原因是在 window 中维护的 windowState，它内部是一个 stateTable，窗口的 namespace 和 key 共同维护一个 state，当窗口触发时，就会对相同 key 的数据调用 apply 方法。</p>
<h3 data-id="heading-3">Interval Join</h3>
<p>梳理完了 Window Join 和 CoGroup 之后，我们再接着看 Interval Join。还是先来回顾一下用法。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; intervalJoinResult <span class="hljs-operator">=</span> source1.keyBy(record -&gt; record.f0)
        .intervalJoin(source2.keyBy(record -&gt; record.f0))
        .between(<span class="hljs-type">Time</span>.seconds(<span class="hljs-operator">-</span><span class="hljs-number">2</span>), <span class="hljs-type">Time</span>.seconds(<span class="hljs-number">2</span>))
        .process(new <span class="hljs-type">ProcessJoinFunction</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> void processElement(<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record1, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record2, <span class="hljs-type">ProcessJoinFunction</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;.<span class="hljs-type">Context</span> context, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; out) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {
                out.collect(<span class="hljs-type">Tuple2</span>.of(record1.f0, record1.f1 <span class="hljs-operator">+</span> record2.f1));
            }
        });
</code></pre>
<p>通过用法可以看出，interval join 传入的对象是两个 KeyedStream，接着使用 between 方法定义 interval join 的上下边界，最后调用 process 方法执行计算逻辑。</p>
<p>在调用过程中，类型的转换如下图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33909c4a743343abb3df807911a74101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701672&amp;x-signature=m4nBk%2BzddJx%2FAJxqMv0E9SroyiY%3D" alt="intervaljoin" loading="lazy"/></p>
<p>我们主要关注 process 的逻辑。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;OUT&gt; SingleOutputStreamOperator&lt;OUT&gt; <span class="hljs-built_in">process</span>(
        ProcessJoinFunction&lt;IN1, IN2, OUT&gt; processJoinFunction,
        TypeInformation&lt;OUT&gt; outputType) {
    Preconditions<span class="hljs-selector-class">.checkNotNull</span>(processJoinFunction);
    Preconditions<span class="hljs-selector-class">.checkNotNull</span>(outputType);

    final ProcessJoinFunction&lt;IN1, IN2, OUT&gt; cleanedUdf =
            <span class="hljs-attribute">left</span><span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(processJoinFunction);

    if (isEnableAsyncState) {
        final AsyncIntervalJoinOperator&lt;KEY, IN1, IN2, OUT&gt; operator =
                new AsyncIntervalJoinOperator&lt;&gt;(
                        lowerBound,
                        upperBound,
                        lowerBoundInclusive,
                        upperBoundInclusive,
                        leftLateDataOutputTag,
                        rightLateDataOutputTag,
                        left.getType()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        left.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        <span class="hljs-attribute">right</span><span class="hljs-selector-class">.getType</span>()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        right.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        cleanedUdf);

        return <span class="hljs-attribute">left</span><span class="hljs-selector-class">.connect</span>(right)
                <span class="hljs-selector-class">.keyBy</span>(keySelector1, keySelector2)
                <span class="hljs-selector-class">.transform</span>("Interval Join [Async]", outputType, operator);
    } else {
        final IntervalJoinOperator&lt;KEY, IN1, IN2, OUT&gt; operator =
                new IntervalJoinOperator&lt;&gt;(
                        lowerBound,
                        upperBound,
                        lowerBoundInclusive,
                        upperBoundInclusive,
                        leftLateDataOutputTag,
                        rightLateDataOutputTag,
                        left.getType()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        left.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        <span class="hljs-attribute">right</span><span class="hljs-selector-class">.getType</span>()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        right.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        cleanedUdf);

        return <span class="hljs-attribute">left</span><span class="hljs-selector-class">.connect</span>(right)
                <span class="hljs-selector-class">.keyBy</span>(keySelector1, keySelector2)
                <span class="hljs-selector-class">.transform</span>("Interval Join", outputType, operator);
    }
}
</code></pre>
<p>Interval join 是基于 ConnectedStream 实现的，ConnectedStream 提供了更加通用的双流操作，它将两个流组合成一个 TwoInputTransformation，然后加入执行图中。</p>
<p>具体的 Operator 是 IntervalJoinOperator 或 AsyncIntervalJoinOperator，它们都是 TwoInputStreamOperator 的实现类，提供 <code>processElement1</code> 和 <code>processElement2</code> 两个方法分别处理两个输入源的数据，最终都调用的是 processElement。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">THIS</span>, <span class="hljs-type">OTHER</span><span class="hljs-operator">&gt;</span> void processElement(
        <span class="hljs-keyword">final</span> <span class="hljs-type">StreamRecord</span>&lt;<span class="hljs-type">THIS</span>&gt; record,
        <span class="hljs-keyword">final</span> <span class="hljs-type">MapState</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">IntervalJoinOperator</span>.<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">THIS</span>&gt;&gt;&gt; ourBuffer,
        <span class="hljs-keyword">final</span> <span class="hljs-type">MapState</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">IntervalJoinOperator</span>.<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt;&gt;&gt; otherBuffer,
        <span class="hljs-keyword">final</span> long relativeLowerBound,
        <span class="hljs-keyword">final</span> long relativeUpperBound,
        <span class="hljs-keyword">final</span> boolean isLeft)
        <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {

    <span class="hljs-keyword">final</span> <span class="hljs-type">THIS</span> ourValue <span class="hljs-operator">=</span> record.getValue();
    <span class="hljs-keyword">final</span> long ourTimestamp <span class="hljs-operator">=</span> record.getTimestamp();

    <span class="hljs-keyword">if</span> (ourTimestamp <span class="hljs-operator">==</span> <span class="hljs-type">Long</span>.<span class="hljs-type">MIN_VALUE</span>) {
        <span class="hljs-keyword">throw</span> new <span class="hljs-type">FlinkException</span>(
                <span class="hljs-string">"Long.MIN_VALUE timestamp: Elements used in "</span>
                        <span class="hljs-operator">+</span> <span class="hljs-string">"interval stream joins need to have timestamps meaningful timestamps."</span>);
    }

    <span class="hljs-keyword">if</span> (isLate(ourTimestamp)) {
        sideOutput(ourValue, ourTimestamp, isLeft);
        <span class="hljs-keyword">return</span>;
    }

    addToBuffer(ourBuffer, ourValue, ourTimestamp);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt;&gt;&gt; bucket : otherBuffer.entries()) {
        <span class="hljs-keyword">final</span> long timestamp <span class="hljs-operator">=</span> bucket.getKey();

        <span class="hljs-keyword">if</span> (timestamp <span class="hljs-operator">&lt;</span> ourTimestamp <span class="hljs-operator">+</span> relativeLowerBound
                <span class="hljs-operator">||</span> timestamp <span class="hljs-operator">&gt;</span> ourTimestamp <span class="hljs-operator">+</span> relativeUpperBound) {
            <span class="hljs-keyword">continue</span>;
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt; entry : bucket.getValue()) {
            <span class="hljs-keyword">if</span> (isLeft) {
                collect((<span class="hljs-type">T1</span>) ourValue, (<span class="hljs-type">T2</span>) entry.element, ourTimestamp, timestamp);
            } <span class="hljs-keyword">else</span> {
                collect((<span class="hljs-type">T1</span>) entry.element, (<span class="hljs-type">T2</span>) ourValue, timestamp, ourTimestamp);
            }
        }
    }

    long cleanupTime <span class="hljs-operator">=</span>
            (relativeUpperBound <span class="hljs-operator">&gt;</span> 0L) <span class="hljs-operator">?</span> ourTimestamp <span class="hljs-operator">+</span> relativeUpperBound : ourTimestamp;
    <span class="hljs-keyword">if</span> (isLeft) {
        internalTimerService.registerEventTimeTimer(<span class="hljs-type">CLEANUP_NAMESPACE_LEFT</span>, cleanupTime);
    } <span class="hljs-keyword">else</span> {
        internalTimerService.registerEventTimeTimer(<span class="hljs-type">CLEANUP_NAMESPACE_RIGHT</span>, cleanupTime);
    }
}
</code></pre>
<p>在 IntervalJoinOperator 中维护了两个 MapState，每个消息进来的时候，都会加入到 MapState 中，key 是 timestamp，value 是一个元素的列表。然后遍历另一个 MapState，得到符合条件的数据。最后是为每条数据注册一个定时器，当时间超过有效范围后，会从 MapState 中清除这个时间戳的数据。</p>
<h3 data-id="heading-4">总结</h3>
<p>本文我们梳理了 Flink 的三种双流操作的源码，我们了解到 Window Join 底层是通过 CoGroup 实现的。CoGroup 本身是将两个流合并成 WindowedStream 并依赖于 WindowState 进行数据 join。最后 Interval Join 是通过 ConnectedStreams 实现的，内部的 IntervalJoinOperator 会维护两个 MapState，通过 MapState 进行数据关联。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 编程：重构工作流的思维与实践]]></title>    <link>https://juejin.cn/post/7589214068093779987</link>    <guid>https://juejin.cn/post/7589214068093779987</guid>    <pubDate>2025-12-30T06:47:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589214068093779987" data-draft-id="7589214068093566995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 编程：重构工作流的思维与实践"/> <meta itemprop="keywords" content="后端,AI编程,Trae"/> <meta itemprop="datePublished" content="2025-12-30T06:47:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="架构精进之路"/> <meta itemprop="url" content="https://juejin.cn/user/3746752294032328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 编程：重构工作流的思维与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3746752294032328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    架构精进之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T06:47:03.000Z" title="Tue Dec 30 2025 06:47:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><code>本文系作者 [架构精进之路] 原创，著作权归作者所有，未经授权禁止任何形式的转载、抄袭或盗用，违者必究。</code></strong></p>
<p>弹指间，岁序更迭，又至年末，这一年我们不断奋斗，不断忙碌，真的好似一瞬间，就来到了 2025 年底的时间。</p>
<p>2025 年，是 AI 技术发展突飞猛进的一年。曾经只存在于想象中的智能助手，如今能精准读懂需求、高效处理任务；曾经依赖人工的繁琐工作，如今在 AI 的加持下变得简单快捷；就连创作、设计这些充满人文色彩的领域，也多了一份智能工具的助力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650ef7b9ba3d47d69770701db69b2f55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=KBYsxjXx%2BzNzwBpXGEL7%2FPY%2Bg8o%3D" alt="" loading="lazy"/></p>
<p>这一年，AI 不再是遥远的科技概念，而是悄然融入了工作与生活的角角落落。正好跟随「掘金 · 年终技术征文」活动，一起总结记录下AI 编程的心得体会。</p>
<h2 data-id="heading-0">一、Vibe Coding 到底是个啥？</h2>
<p>今年 AI 界有一个很潮、很酷的新词儿：“<strong>Vibe Coding</strong>”，乍一听有点懵，到底啥是“Vibe Coding”？写代码还要讲究个氛围感吗？</p>
<p>今天我就以一个码农的视角，聊聊对 “Vibe Coding” 的理解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b785914e0214b6aa3b3c114472724a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=uWAdQBVoGe8N2IVxoEobAv%2FclRU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">1.1 什么是 Vibe Coding？</h3>
<p>Vibe 本来就是“氛围”、“感觉”的意思，所以直译过来就是“氛围编程”或“沉浸式编程”。但这里的“沉浸”不仅仅是让你沉浸在一个有仪式感的编程环境里，更重要的是它颠覆了我们以往写代码的方式。</p>
<p><strong>我直接上核心观点：就是从「计算机语言描述工作流程」到「自然语言描述工作流程」的转变。</strong></p>
<p>打破编程门槛：AI 让每个人都能"编程"</p>
<p>Vibe Coding 压根就不关心你代码具体怎么实现的，核心关注点是代码生成的结果对不对。至于实现逻辑、底层细节这些繁琐的活，都交给 AI 去搞定。我只需要盯着效果，觉得哪里不对、哪里有问题，就直接改 Prompt，重新提需求，AI 会自动帮你调整和优化，直到最后结果完全符合你的预期为止。</p>
<p>整个过程你都沉浸在 “<strong>说想法—&gt;看结果—&gt;继续调整—&gt;再出结果</strong>” 的循环里，效率高得飞起。</p>
<p>我画了个大概流程图，执行流程如下所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1221382d5444ce3a2ec8e42121b64d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=eN%2BXnXPHkHn7ufQrDSHFTb5kCRc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>举个生活化的例子：就像点外卖一样，你只管选菜，AI 帮你做。菜端上来不合口味？你直接点评它！AI 厨子立刻再改，直到喂到你满意。</p>
</blockquote>
<h3 data-id="heading-2">1.2 核心提炼：工作流思维</h3>
<p>传统编程 vs Vibe Coding：开发模式的核心变革</p>
<p><strong>1、传统编程：以技术实现为核心</strong></p>
<p>传统编程围绕<strong>程序、程序员、软件工程</strong>三大支柱展开，具有显著特点：</p>
<ul>
<li>
<p>入门门槛高，学习周期长</p>
</li>
<li>
<p>需系统掌握编程语言语法、开发框架、调试技巧等技术细节</p>
</li>
<li>
<p>核心要求是程序员明确知道 “怎么做”，通过手动编码实现功能</p>
</li>
</ul>
<p><strong>2、Vibe Coding：以需求描述为核心</strong></p>
<p>Vibe Coding 是一种依托 AI 能力的新型开发模式，核心逻辑高度聚焦：</p>
<ul>
<li>
<p>用自然语言精准描述业务需求与工作流</p>
</li>
<li>
<p>由 AI 自动完成代码生成、任务执行与细节处理</p>
</li>
<li>
<p>核心要求是使用者清晰定义 “做什么”，无需纠结技术实现路径</p>
</li>
</ul>
<p><strong>3、Vibe Coding 核心特征总结</strong></p>
<ol>
<li>
<p><strong>本质是 “用自然语言定义工作流”</strong></p>
<ol>
<li>
<p>摆脱编程语言语法、框架的束缚，无需专业编程基础</p>
</li>
<li>
<p>核心门槛在于<strong>对业务流程的深度理解</strong></p>
</li>
<li>
<p>重心从 “技术实现” 转向 “需求定义”</p>
</li>
</ol>
</li>
<li>
<p><strong>开发模式升级：从 “人做” 到 “人想，AI 做”</strong></p>
<ol>
<li>
<p><strong>人</strong>的角色：需求提出者、流程设计者、结果审核者</p>
</li>
<li>
<p><strong>AI</strong>的角色：代码生成器、任务执行者、细节处理者</p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd29a4a418d747989e7c76af1eef97c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=SdwjHN78cWYRszsK0p1o5zWGC5U%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>适用场景清晰划分</strong></p>
<ol>
<li>
<p><strong>高度适配场景</strong>：MVP 产品快速验证、内部工具开发（数据处理、文件整理等）、创意方案原型测试</p>
</li>
<li>
<p><strong>暂不适用场景</strong>：复杂业务逻辑开发（需人工决策与逻辑校验）、性能关键路径构建（需深度人工优化）</p>
</li>
</ol>
</li>
</ol>
<h2 data-id="heading-3">二、程序员视角下的 Vibe Coding</h2>
<h3 data-id="heading-4">2.1 利用 Trea 进行 Vibe Coding 的应用实践</h3>
<blockquote>
<p>Trae.ai 是个 AI 编程 IDE，字节跳动的产品，目前是免费使用，写代码、查文档、加接口都可以，和它对话就能改功能、查问题，事半功倍。</p>
</blockquote>
<p><strong>1、生成提示词</strong></p>
<p>写不好提示词，没关系，这一步AI可以帮我们很好的搞定！</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmovie.douban.com%2Ftop250" target="_blank" title="https://movie.douban.com/top250" ref="nofollow noopener noreferrer">movie.douban.com/top250</a> 我希望获取这个网站的数据，帮我生成一份爬虫项目的提示词</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41f764689d14469b9348f88006982206~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=5EY2%2FlYUyTinzndGnWmcd39bthI%3D" alt="" loading="lazy"/></p>
<p><strong>2、生成项目代码并执行</strong></p>
<p>有了提示词，可以参考它执行，生成我们需要的项目代码了。</p>
<p>执行过程中，可能会出现如下需要我们确认执行的步骤，一般确认<strong>运行</strong>即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7967a1153233424c81d7ea371a5a3f11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=7pGXdF6ORK7BkFRrdzEwjVXxRyw%3D" alt="" loading="lazy"/></p>
<p>最终生成一份可执行代码，并可执行并验证，整体效率非常高效！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1f1ffc5e18f4cae9eedd658cf84aeb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=DTJv2DsErTp%2BXPubsb1nuu7A2jo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c8ac228fef4ae8b90eb9f90c3f7f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=rmY3e7DeRVAUOZ%2B73t1NuDG%2Bweo%3D" alt="" loading="lazy"/></p>
<p><strong>3、生成可渲染展示页面</strong></p>
<p>为了更直观的查看数据，生成可运行的 Web 服务来渲染这些数据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8afc437a3c2f4030b2d01a4363ebbdc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=9Reh9nUUFZO5jIQmHs6dVCkuU14%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c754483f27ef4aeea44fdff4d73d38c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=%2Fyob%2BO1PFaH45%2FrSkFJxWnj6VSU%3D" alt="" loading="lazy"/></p>
<p>如果需要更好的查看体验，可以继续调试添加分页能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/289ba0383f8a4c438d0e70e7cbc55323~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=nu327WLO4IYKfu7PaWaHSvlHXNE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44cd3ccad4a4e688cb1c59cf4a5a892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=Cv9Z7G9RKAV77D30JcdlvBXkAVI%3D" alt="" loading="lazy"/></p>
<p>上述整体步骤非常高效，前后不过几分钟而已，Trea 堪称开发利器。</p>
<h3 data-id="heading-5">2.2 AI 编程的缺点与挑战</h3>
<p><strong>1、天生缺乏业务场景深度理解</strong></p>
<ul>
<li><strong>核心现象</strong></li>
</ul>
<p>AI 生成的代码，经常会陷入“技术正确，业务失真”的困境——语法合规、可编译运行，但完全不符合真实业务的约束条件与核心诉求。</p>
<ul>
<li><strong>典型案例：电影数据展示列表场景</strong></li>
</ul>
<p>AI 仅生成通用的电影数据列表展示代码，却忽略豆瓣Top250项目的核心业务规则：</p>
<ul>
<li>
<p>业务中需按“评分降序、上映时间筛选”双维度排序展示电影</p>
</li>
<li>
<p>需实现分页加载（避免一次性加载250条数据卡顿）、数据异常兜底（部分电影信息缺失时的友好展示）等核心逻辑</p>
</li>
</ul>
<p>最终结果是“代码看似专业，实则无法满足豆瓣Top250项目的核心展示需求与用户体验要求”。</p>
<ul>
<li><strong>解决思路</strong></li>
</ul>
<p>由人明确定义不可让步的业务规则与约束条件，为 AI 划定业务边界。</p>
<p><strong>2、对性能问题极度不敏感</strong></p>
<ul>
<li><strong>核心现象</strong></li>
</ul>
<p>AI 生成的方案逻辑无误，但工程实现成本极高；小数据量测试时表现正常，一旦上线面对真实流量便会瞬间“翻车”。</p>
<ul>
<li><strong>典型案例</strong></li>
</ul>
<p>案例一：列表数据加载性能崩塌</p>
<p>补充完“评分排序、上映时间筛选”逻辑后，AI 快速实现了数据展示功能，但方案存在致命缺陷：默认一次性加载全部250条电影数据，未做分页处理与图片懒加载优化，导致页面首次加载耗时超 8 秒，滚动时出现明显卡顿，移动端甚至直接白屏。</p>
<p>案例二：列表数据接口异常处理缺失</p>
<p>AI 给出的项目初版方案中，直接调用豆瓣公开接口获取数据，但未设计任何异常应对逻辑：当接口请求超时、返回数据格式异常或接口限流时，页面直接空白无提示，用户无法判断是网络问题还是服务问题，体验极差。</p>
<ul>
<li><strong>问题根源</strong></li>
</ul>
<p>AI 的优化目标是“推理逻辑正确性”，而非“系统长期运行的稳定性与成本可控性”，天然缺失工程化的性能考量。</p>
<ul>
<li><strong>解决思路</strong></li>
</ul>
<p>1. 人先主导分析：明确系统性能瓶颈所在（IO、CPU、内存、模型加载等）；</p>
<p>2. 再引导 AI 优化：针对性提出缓存方案、服务常驻化设计、预加载机制、资源池搭建等性能优化需求。</p>
<p><strong>3、异常与边界处理严重缺失</strong></p>
<ul>
<li><strong>核心现象</strong></li>
</ul>
<p>AI 生成的代码在“理想流程（Happy Path）”下表现完美，但缺乏对异常场景的应对能力，一旦出现意外情况便直接崩溃。</p>
<ul>
<li>
<p><strong>典型缺失的异常处理场景</strong></p>
<ul>
<li>
<p>豆瓣接口请求超时、返回数据格式异常及重试策略缺失；</p>
</li>
<li>
<p>电影封面图加载失败、部分字段（如导演、演员）缺失等数据异常的兼容处理；</p>
</li>
<li>
<p>豆瓣接口限流时的降级展示逻辑（如加载本地缓存数据）。</p>
</li>
</ul>
</li>
<li>
<p><strong>问题本质</strong></p>
</li>
</ul>
<p>AI 默认预设“理想运行环境”，但真实生产环境是“持续面临各类异常的复杂系统”，这种认知偏差导致其无法主动构建健壮的容错机制。</p>
<ul>
<li><strong>应对方式</strong></li>
</ul>
<p>由人主动补充完善容错体系：明确异常分级标准、制定服务降级策略、设计超时控制与熔断机制。</p>
<p><strong>核心总结：工程质量的高低，取决于你对“失败与异常”的预期深度。</strong></p>
<h2 data-id="heading-6">三、如何正确理解重构工作流</h2>
<p>个人对 [ vibecoding 加成下 ] 重构工作流的理解</p>
<blockquote>
<p>AI 不是来当主厨的，是为了让主厨不用天天切土豆</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44064f08036433f862cb012695e0e52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=WbU10AQn2p7yEpxhrTFKKkjdmJU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">3.1 构思全自动化工作流</h3>
<p><strong>关键原则：摒弃“一步到位”的完美主义，先让“流程跑通”</strong></p>
<p><strong>核心目标</strong>：构建无需人工介入，即可完成从数据获取、处理到展示的全链路自动化流程</p>
<p><strong>项目案例（豆瓣Top250电影数据展示）</strong>：</p>
<ul>
<li>
<p>程序自动化流程：AI 生成定时任务脚本（每日凌晨触发）→ 自动调用豆瓣接口获取最新Top250数据 → AI 自动处理数据格式（标准化字段、补全缺失值默认值）→ 自动同步至前端展示数据库 → 前端页面自动拉取数据并渲染</p>
</li>
<li>
<p>落地优先级：先实现“无人工干预的基础数据展示”，暂不纠结细节优化（如极致加载速度、个性化筛选）；待流程稳定跑通后，再针对性迭代自动化优化逻辑</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78603660413d4434963e2862b4c00e47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=po4wKE0P2HWAiXqzxGlWELYp5u4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">3.2 人的价值不可忽视</h3>
<p><strong>关键原则</strong>：<strong>人的核心价值在于 --- 决策、审核、优化</strong></p>
<p><strong>核心目标</strong>：在关键节点加入人工审核和优化，避免自动化流程“跑偏”</p>
<p><strong>项目案例（豆瓣Top250电影数据展示）</strong>：</p>
<ul>
<li>
<p>决策环节：确定核心业务规则（如“评分降序+上映时间筛选”的排序逻辑、分页条数设置、异常数据兜底规则），为AI自动化流程划定边界；</p>
</li>
<li>
<p>审核环节：在“数据同步至展示数据库”前增设人工审核节点，校验AI处理后的数据准确性（如是否存在错误评分、缺失关键电影信息等），避免错误数据直接展示给用户；</p>
</li>
<li>
<p>优化环节：监控自动化流程运行状态（如接口请求成功率、页面加载性能），针对卡顿、数据异常等问题，向AI提出精准优化需求（如添加接口重试机制、优化图片加载策略），推动流程迭代升级</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8eda3346b6584fec8ed5939855ebb8a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=nHrIZnneTq2gtaWFd8aQR4PvQYE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">四、总结</h2>
<p>回望这一年的点滴，我历经诸多变迁，在跌撞中摸索，在求索里前行。惟愿不负韶华，始终心怀热忱，向上生长，步履不停。</p>
<p>最后，跟大家分享下自己 AI 学习的三个观点：</p>
<p><strong>1、LLM带来的不是更高层次抽象，而是不同性质的抽象</strong></p>
<p>传统编程的抽象（如函数、类、框架）是确定性抽象；LLM 的抽象则是概率性抽象，其本质是基于海量文本规律统计</p>
<p><strong>2、大模型把非确定性引入了软件开发的核心路径</strong></p>
<p>传统软件开发的核心路径（需求→设计→编码→测试→部署）是确定性闭环，而LLM则从生成、理解、迭代环节的非确定性打破了这一闭环</p>
<p><strong>3、软件工程的重心正在从写对的代码转向管理意图与结果之间的偏差</strong></p>
<p>传统软件工程的核心是 “代码正确性”，LLM 普及后，编码效率大幅提升，但“意图 vs 结果”偏差成为新的核心风险</p>
<p><strong>·END·</strong></p>
<p>希望今天的讲解对大家有所帮助，谢谢！</p>
<p>Thanks for reading!</p>
<blockquote>
<p>作者：架构精进之路，十年研发风雨路，大厂架构师，CSDN 博客专家，专注架构技术沉淀学习及分享，职业与认知升级，坚持分享接地气儿的干货文章，期待与你一起成长。<br/>
关注并私信我回复“01”，送你一份程序员成长进阶大礼包，欢迎勾搭。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理清 https 的加密逻辑]]></title>    <link>https://juejin.cn/post/7589454621719183410</link>    <guid>https://juejin.cn/post/7589454621719183410</guid>    <pubDate>2025-12-30T08:47:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589454621719183410" data-draft-id="7567198443786338331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理清 https 的加密逻辑"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T08:47:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="imoo"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104364766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理清 https 的加密逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104364766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    imoo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T08:47:39.000Z" title="Tue Dec 30 2025 08:47:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    59
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>http 是前端的老朋友了，也是面试常考点，最近看了《图解 http》，结合着 ai 重新理了一遍 https 相关的知识，在此分享。</p>
<h2 data-id="heading-1">http 的隐患</h2>
<p>众所周知，前端与后端的交互，都需要走接口。绝大部分接口都是 http 协议，随便举一个登录例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">GET</span> /login?user=alice&amp;password=<span class="hljs-number">123456</span> <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span>
<span class="hljs-title class_">Host</span>: example.<span class="hljs-property">com</span>
<span class="hljs-title class_">User</span>-<span class="hljs-title class_">Agent</span>: <span class="hljs-title class_">Chrome</span>
</code></pre>
<p>在这个请求发出时，你的信息实际上在整条网络上都是透明的。假如你的网络经过路由器，那么路由器的主人就可以看到你这个请求，也就是能看到你的密码 <code>user=alice&amp;password=123456</code>。</p>
<p>所以国家总会提醒你，不要乱连 wifi，你的信息有可能被监听和泄露。</p>
<p>老前端们过去也总说，<strong>前端实际上没有安全性可言</strong>。在这个背景下，https 的推出也是理所当然的了。</p>
<h2 data-id="heading-2">升级之 https</h2>
<p>https 实际上只是在 http 的基础上，增加了一个加密层 TLS，该加密层使用了非对称加密来保证数据不泄露。</p>
<p>非对称加密，区分了公钥和私钥，这里有个很巧妙的数学公式，使信息能<strong>任何人都能使用公钥进行加密，但又只能用私钥进行解密</strong>。</p>
<p>这个非对称加密的过程相当消耗性能，几乎是原先的数倍甚至数十倍。有没有既可以加密，又保证性能的方案呢？</p>
<p>http 给出的答案是，<strong>在第一次通信时，使用非对称加密传递一个密码，随后使用该密码进行对称加密</strong>。这样一来，由于密码不会被中间者拦截，所以后续的对称加密也无法被轻易破解。</p>
<p>虽然在控制台上还是会看到正常的信息：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">POST</span> /api/login <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span>
<span class="hljs-title class_">Host</span>: example.<span class="hljs-property">com</span>
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Type</span>: application/json
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Length</span>: <span class="hljs-number">42</span>

{<span class="hljs-string">"username"</span>: <span class="hljs-string">"alice"</span>, <span class="hljs-string">"password"</span>: <span class="hljs-string">"123456"</span>}
</code></pre>
<p><strong>但这只对自己可见</strong>。数据在传递过程中完全被加密，抓包只能看到类似如下内容：</p>
<pre><code class="hljs language-js" lang="js">9a f1 <span class="hljs-number">23</span> 8b ... 8e d0
</code></pre>
<p>也就是完全转化为了二进制（在抓包软件内会直接显示为十六进制），这样在没有私钥的情况下，就无法将数据还原。</p>
<h2 data-id="heading-3">细说加密逻辑</h2>
<p>我们来稍微详细了解一下中间的流程。</p>
<p>首先复习下 http 的三次握手：</p>
<ol>
<li>客户端发起链接请求，发送一个 <code>SYN</code> 标识</li>
<li>服务器确认可以收到客户端消息，发送一个 <code>SYN-ACK</code> 标识</li>
<li>客户端确认可以收到服务端消息，发送一个 <code>ACK</code> 标识</li>
</ol>
<blockquote>
<p>有个很好的比喻：1.喂？听得到吗， 2.我听得到，你听得到我吗 3. 我听得到</p>
</blockquote>
<p>https 的加密流程，发生在<strong>三次握手之后</strong></p>
<p>目前主流是 TLS 1.3 版本，但旧的 TLS 1.2 版本仍然有部分存量。这两者的加密有所不同，我们分开讨论：</p>
<p>在 TLS 1.2 中：</p>
<ol>
<li>客户端发送 TLS 版本，加密算法，随机数 <code>Client Random</code></li>
<li>服务器端发送确认使用的 TLS 版本，加密算法，随机数 <code>Server Random</code></li>
<li>客户端校验证书后，再生成一个随机预主密钥 <code>Pre-Master Key</code>，并将 <code>Pre-Master Key</code> 使用公钥加密后，发送给服务端</li>
<li>服务端使用私钥，解开加密，随后<strong>双方</strong>根据这三个随机数<code>Client Random</code>，<code>Server Random</code>，<code>Pre-Master Key</code> 生成对话主密钥 <code>Master Key</code></li>
<li>根据 <code>Master Key</code> 生成临时对话秘钥</li>
<li>根据临时对话秘钥进行对称加密通信</li>
</ol>
<blockquote>
<p>但这里存在两个问题，1. 基于 rsa 算法的非对称加密，性能消耗还是比较严重 2. 过程繁琐。所以在 TLS 1.3 中对这两点进行了优化。</p>
</blockquote>
<p>在 TLS 1.3 中：</p>
<ol>
<li>客户端发送 TLS 版本，加密算法，<code>客户端 Key Share</code></li>
<li>服务端发送确认使用的 TLS 版本，加密算法，<code>服务端 Key Share</code></li>
<li>各自根据 <code>Key Share</code>，使用 ECDHE 算法算出共享密钥</li>
<li>使用共享密钥进行对称加密</li>
</ol>
<p>可以看到，使用 ECDHE 算法，不仅降低了步骤数量，而且由于 ECHDE 所需要的秘钥长度更短，所以性能也更加优秀。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 17 升级避坑：如何安全处理反射访问限制]]></title>    <link>https://juejin.cn/post/7589172193151008804</link>    <guid>https://juejin.cn/post/7589172193151008804</guid>    <pubDate>2025-12-30T01:41:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589172193151008804" data-draft-id="7589201772118622214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 17 升级避坑：如何安全处理反射访问限制"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-12-30T01:41:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 17 升级避坑：如何安全处理反射访问限制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T01:41:49.000Z" title="Tue Dec 30 2025 01:41:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近帮几个团队从 Java 8/11 升到 Java 17 + Spring Boot 3，发现 90% 的人都会踩这个坑：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">InaccessibleObjectException:</span> Unable <span class="hljs-keyword">to</span> make ... accessible:
<span class="hljs-keyword">module</span> java.base does <span class="hljs-built_in">not</span> <span class="hljs-string">"opens"</span> java.lang <span class="hljs-keyword">to</span> unnamed <span class="hljs-keyword">module</span>
</code></pre>
<p>应用启动直接炸了，日志里全是反射相关的异常。<strong>这不是 Bug，是 Java 9 引入模块系统后的"新规矩"</strong>——默认禁止反射访问内部实现。</p>
<p>本文给你<strong>可直接复制的解决方案 + 安全评估</strong>，让升级少走弯路。</p>
<hr/>
<h2 data-id="heading-0">你是不是也遇到了这个报错？</h2>
<p>升级到 Java 9+ 或 Spring Boot 3.x 后，应用启动时抛出异常：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">java.lang.reflect.InaccessibleObjectException: 
Unable <span class="hljs-keyword">to</span> make <span class="hljs-keyword">private</span> native java.lang.reflect.Field[] 
java.lang.<span class="hljs-keyword">Class</span>.getDeclaredFields0(<span class="hljs-type">boolean</span>) accessible: 
<span class="hljs-keyword">module</span> java.base does <span class="hljs-built_in">not</span> <span class="hljs-string">"opens java.lang"</span> <span class="hljs-keyword">to</span> unnamed <span class="hljs-keyword">module</span>
</code></pre>
<h3 data-id="heading-1">升级时最常踩的 3 个坑</h3>
<ol>
<li>
<p><strong>Spring 应用启动失败</strong><br/>
<code>@Autowired</code> 私有字段注入报错，ApplicationContext 初始化炸了</p>
</li>
<li>
<p><strong>Logback 配置加载异常</strong><br/>
日志系统初始化失败，特别是 Spring Boot 3.2+ 的嵌套 JAR 环境</p>
</li>
<li>
<p><strong>序列化/ORM 框架炸裂</strong><br/>
Jackson/Gson 处理 JSON 报错，Hibernate 实体映射失败</p>
</li>
</ol>
<p>影响范围：Java 9 至 Java 21（包括主流 LTS 版本：11、17、21）</p>
<hr/>
<h2 data-id="heading-2">为什么会报这个错？</h2>
<p>问题根源在于 Java 9 引入的模块系统默认禁止反射访问内部实现。</p>
<p><strong>Java 8 及之前：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> SomeClass.class.getDeclaredField(<span class="hljs-string">"privateField"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 总是成功</span>
</code></pre>
<p><strong>Java 9+：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> SomeClass.class.getDeclaredField(<span class="hljs-string">"privateField"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 可能抛出 InaccessibleObjectException</span>
</code></pre>
<p>JVM 在 <code>setAccessible(true)</code> 时检查：</p>
<ol>
<li>调用者模块是否有权限访问目标模块</li>
<li>目标模块是否 <code>opens</code> 了相关包</li>
</ol>
<p>没有 <code>module-info.java</code> 的应用属于"未命名模块"，无法反射访问未开放的包。</p>
<h3 data-id="heading-3">框架为什么非要用反射？</h3>
<p><strong>Spring 依赖注入：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository repository;  <span class="hljs-comment">// 私有字段注入需要反射</span>
}
</code></pre>
<p><strong>Logback 配置扫描：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Logback 内部需要监控配置文件变化</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanForChanges</span><span class="hljs-params">()</span> {
    Field[] fields = getClass().getDeclaredFields();  <span class="hljs-comment">// 触发异常</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>Jackson 序列化：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String password;  <span class="hljs-comment">// 没有 getter，需要反射读取</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-4">怎么快速修复？</h2>
<h3 data-id="heading-5">方案一：加 JVM 参数（推荐，99% 的情况够用）</h3>
<p>这是目前最稳妥的方案，Spring Boot 官方文档也推荐这么做。<strong>核心思路：告诉 JVM 允许反射访问特定的包。</strong></p>
<h4 data-id="heading-6">基础参数（先试这两个）</h4>
<pre><code class="hljs language-bash" lang="bash">java --add-opens java.base/java.lang=ALL-UNNAMED \
     --add-opens java.base/java.lang.reflect=ALL-UNNAMED \
     -jar app.jar
</code></pre>
<p><code>--add-opens</code> 语法：</p>
<ul>
<li><code>java.base</code>: 模块名</li>
<li><code>java.lang</code>: 包名</li>
<li><code>ALL-UNNAMED</code>: 对所有未命名模块开放</li>
</ul>
<h4 data-id="heading-7">Spring Boot 3.x 实战参数集（血泪总结）</h4>
<p>升级过 10+ 个项目后，发现这套参数基本覆盖了所有常见框架：</p>
<pre><code class="hljs language-bash" lang="bash">--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED
--add-opens java.base/java.lang.invoke=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED
--add-opens java.base/java.text=ALL-UNNAMED
--add-opens java.base/java.io=ALL-UNNAMED
--add-opens java.base/java.net=ALL-UNNAMED
--add-opens java.base/java.nio=ALL-UNNAMED
--add-opens java.base/sun.nio.ch=ALL-UNNAMED
</code></pre>
<p>如果使用 JAXB 或 XML 处理：</p>
<pre><code class="hljs language-bash" lang="bash">--add-opens java.xml/com.sun.org.apache.xerces.internal.jaxp=ALL-UNNAMED
</code></pre>
<h4 data-id="heading-8">不同部署环境的配置</h4>
<p><strong>Docker：</strong></p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM eclipse-temurin:17-jre-alpine
COPY app.jar /app.jar
ENV JAVA_OPTS="--add-opens java.base/java.lang=ALL-UNNAMED \
               --add-opens java.base/java.lang.reflect=ALL-UNNAMED"
ENTRYPOINT exec java $JAVA_OPTS -jar /app.jar
</code></pre>
<p><strong>Kubernetes：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">JAVA_OPTS</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">&gt;-
            --add-opens java.base/java.lang=ALL-UNNAMED
            --add-opens java.base/java.lang.reflect=ALL-UNNAMED
</span></code></pre>
<p><strong>使用参数文件（推荐）：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># jvm-options.txt</span>
--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED
--add-opens java.base/java.lang.invoke=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED

<span class="hljs-comment"># 启动时引用</span>
java @jvm-options.txt -jar app.jar
</code></pre>
<p><strong>Maven 测试：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argLine</span>&gt;</span>
            --add-opens java.base/java.lang=ALL-UNNAMED
            --add-opens java.base/java.lang.reflect=ALL-UNNAMED
        <span class="hljs-tag">&lt;/<span class="hljs-name">argLine</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p><strong>Gradle 测试：</strong></p>
<pre><code class="hljs language-groovy" lang="groovy">test {
    jvmArgs = [
        '--add-opens', 'java.base/java.lang=ALL-UNNAMED',
        '--add-opens', 'java.base/java.lang.reflect=ALL-UNNAMED'
    ]
}
</code></pre>
<h3 data-id="heading-9">方案二：改 Logback 配置（Spring Boot 3.2+ 必看）</h3>
<p><strong>这是升级 Spring Boot 3.2 时最容易忽略的坑。</strong> Logback 的配置文件扫描功能在新版本里会触发反射异常：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- logback.xml 或 logback-spring.xml --&gt;</span>

<span class="hljs-comment">&lt;!-- 移除前 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">scan</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">"30 seconds"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 修改后 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p>同时修复 Spring Boot 3.2+ 的嵌套 JAR 问题：</p>
<pre><code class="hljs language-bash" lang="bash">ERROR: URL [jar:nested:/app.jar!/BOOT-INF/lib/logback.jar!/logback.xml] 
is not of <span class="hljs-built_in">type</span> file
</code></pre>
<p>Spring Boot 3.2 使用 <code>jar:nested:</code> 协议，Logback 的文件监听不支持此协议。去掉 <code>scan</code> 属性即可。</p>
<h3 data-id="heading-10">方案三：写 module-info.java（长期方向，暂时没必要）</h3>
<p>定义应用模块：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// src/main/java/module-info.java</span>
<span class="hljs-keyword">module</span> com.example.myapp {
    <span class="hljs-keyword">requires</span> java.base;
    <span class="hljs-keyword">requires</span> spring.boot;
    <span class="hljs-keyword">requires</span> spring.boot.autoconfigure;
    
    <span class="hljs-comment">// 允许 Spring 反射访问</span>
    opens com.example.myapp.controller to spring.core, spring.beans;
    opens com.example.myapp.service to spring.core, spring.beans;
    opens com.example.myapp.entity to org.hibernate.orm.core;
}
</code></pre>
<p>好处是精确控制访问权限，符合 Java 的演进方向。<br/>
但配置麻烦，而且很多框架还没完全模块化，不建议现在就搞。</p>
<hr/>
<h2 data-id="heading-11">它是怎么工作的？（可选阅读）</h2>
<p>想理解为什么需要 <code>--add-opens</code>，得先搞清楚模块系统的访问控制机制。如果只想快速解决问题，可以跳过这节。</p>
<h3 data-id="heading-12">模块系统的访问控制</h3>
<p>Java 9+ 的访问控制多了一层：</p>
<pre><code class="hljs language-arduino" lang="arduino">传统 Java:  <span class="hljs-keyword">public</span>/<span class="hljs-keyword">protected</span>/<span class="hljs-keyword">default</span>/<span class="hljs-keyword">private</span>
模块化 Java: <span class="hljs-keyword">module</span> → package → <span class="hljs-keyword">class</span> → member
</code></pre>
<p><code>module-info.java</code> 定义模块边界：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">module</span> java.base {
    <span class="hljs-keyword">exports</span> java.lang;      <span class="hljs-comment">// 允许使用公共 API</span>
    <span class="hljs-keyword">exports</span> java.util;
    
    <span class="hljs-comment">// 不 opens，禁止反射访问内部实现</span>
}
</code></pre>
<p>关键字说明：</p>
<ul>
<li><code>exports pkg</code>: 其他模块可以使用该包的 public 类型</li>
<li><code>opens pkg</code>: 允许运行时反射访问（包括私有成员）</li>
<li><code>opens pkg to module1, module2</code>: 只对特定模块开放</li>
<li><code>open module</code>: 整个模块开放反射（类似 Java 8 行为）</li>
</ul>
<h3 data-id="heading-13">反射时 JVM 做了什么检查</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 你的代码</span>
<span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> String.class.getDeclaredField(<span class="hljs-string">"value"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 这里会触发检查</span>

<span class="hljs-comment">// JVM 内部逻辑（简化版）</span>
<span class="hljs-keyword">if</span> (!targetModule.isOpen(targetPackage, callerModule)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InaccessibleObjectException</span>(
        <span class="hljs-string">"module "</span> + targetModule.getName() + 
        <span class="hljs-string">" does not open "</span> + targetPackage + 
        <span class="hljs-string">" to "</span> + callerModule.getName()
    );
}
</code></pre>
<p>没写 <code>module-info.java</code> 的应用算"未命名模块"：</p>
<ul>
<li>可以正常用其他模块的公开 API（<code>exports</code> 的部分）</li>
<li>但不能反射访问没开放（<code>opens</code>）的包</li>
<li>报错里的 <code>unnamed module</code> 说的就是这个</li>
</ul>
<h3 data-id="heading-14">Spring Boot 3.2+ 的嵌套 JAR 问题</h3>
<p>Spring Boot 3.2 改用新的 JAR 加载方式：</p>
<pre><code class="hljs language-bash" lang="bash">旧版本: jar:file:/app.jar!/BOOT-INF/lib/logback.jar!/logback.xml
3.2+:   jar:nested:/app.jar!/BOOT-INF/lib/logback.jar!/logback.xml
</code></pre>
<p>Logback 的文件监听器不认识 <code>nested:</code> 这种协议，结果就是：</p>
<ol>
<li>配置文件变化监控失败</li>
<li>尝试反射读取文件路径时炸了</li>
</ol>
<p>办法就是禁用 <code>scan</code> 或把配置文件放外面。</p>
<hr/>
<h2 data-id="heading-15">加这些参数，会不会埋雷？</h2>
<p><strong>实战结论：风险可控，前提是做好依赖管理。</strong></p>
<p>帮十几个团队升级后，从未因为 <code>--add-opens</code> 参数本身出过安全事故。真正的风险在于<strong>依赖来源</strong>，而不是这些参数。</p>
<p><strong>理论上的风险：</strong></p>
<ol>
<li>
<p><strong>恶意依赖可能读取敏感数据</strong></p>
<pre><code class="hljs language-java" lang="java">Field[] fields = target.getClass().getDeclaredFields();
<span class="hljs-keyword">for</span> (Field f : fields) {
    f.setAccessible(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">if</span> (f.getName().contains(<span class="hljs-string">"password"</span>)) {
        sendToAttacker(f.get(target));
    }
}
</code></pre>
</li>
<li>
<p><strong>可能修改不可变对象</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Field</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> String.class.getDeclaredField(<span class="hljs-string">"value"</span>);
value.setAccessible(<span class="hljs-literal">true</span>);
value.set(str, newValue);  <span class="hljs-comment">// 破坏 String 不可变性</span>
</code></pre>
</li>
</ol>
<p><strong>为什么实际风险不高：</strong></p>
<ul>
<li>恶意代码需要先混进你的依赖（供应链攻击），这本身就是大问题</li>
<li>加不加 <code>--add-opens</code> 区别不大，恶意代码能干的坏事多了去了</li>
<li>只影响当前 JVM 进程，不会波及系统其他应用</li>
<li>Spring Boot 官方文档推荐这种配置，属于标准做法</li>
</ul>
<h3 data-id="heading-16">真正该做的防护</h3>
<p><strong>依赖来源控制：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 仅使用可信仓库 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
</code></pre>
<p><strong>依赖审查：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查依赖树</span>
mvn dependency:tree

<span class="hljs-comment"># OWASP 漏洞扫描</span>
mvn org.owasp:dependency-check-maven:check
</code></pre>
<p><strong>最小权限原则：</strong></p>
<p>只开放必需的包，避免过度授权：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 必需</span>
--add-opens java.base/java.lang=ALL-UNNAMED

<span class="hljs-comment"># 非必需则不开</span>
--add-opens java.base/java.security=ALL-UNNAMED  <span class="hljs-comment"># 仅在需要时添加</span>
</code></pre>
<p><strong>运行时监控：</strong></p>
<p>记录反射调用（通过 Java Agent）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">premain</span><span class="hljs-params">(String args, Instrumentation inst)</span> {
        inst.addTransformer((loader, className, classBeingRedefined, 
                            protectionDomain, classfileBuffer) -&gt; {
            <span class="hljs-comment">// 拦截 setAccessible 调用</span>
            <span class="hljs-comment">// 记录调用栈到日志</span>
            <span class="hljs-keyword">return</span> classfileBuffer;
        });
    }
}
</code></pre>
<p>启动：</p>
<pre><code class="hljs language-bash" lang="bash">java -javaagent:monitor.jar --add-opens ... -jar app.jar
</code></pre>
<hr/>
<h2 data-id="heading-17">上线前，记得核对这几点</h2>
<h3 data-id="heading-18">本地开发环境</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 升级到目标 Java 版本（17 或 21）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 运行完整测试套件，记录所有反射相关错误</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 根据错误信息添加 <code>--add-opens</code> 参数</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 修改 Logback 配置（去掉 <code>scan="true"</code>）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 重新运行测试，确认无异常</li>
</ul>
<h3 data-id="heading-19">构建配置</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新 Maven/Gradle 测试插件配置</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 创建 <code>jvm-options.txt</code> 集中管理参数</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新 Dockerfile，添加 <code>JAVA_OPTS</code> 环境变量</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 测试 Docker 镜像构建和运行</li>
</ul>
<h3 data-id="heading-20">部署配置</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新 Kubernetes Deployment YAML</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 配置环境变量或 ConfigMap</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在测试环境验证</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 监控日志，确认无异常</li>
</ul>
<h3 data-id="heading-21">文档更新</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 记录所需的 JVM 参数及原因</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新部署文档</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 通知团队成员</li>
</ul>
<hr/>
<h2 data-id="heading-22">主流框架的兼容情况</h2>
<h3 data-id="heading-23">Spring Framework</h3>























<table><thead><tr><th>版本</th><th>Java 支持</th><th>模块化支持</th><th>说明</th></tr></thead><tbody><tr><td>Spring 5.x</td><td>Java 8-17</td><td>部分</td><td>需要 <code>--add-opens</code></td></tr><tr><td>Spring 6.x</td><td>Java 17+</td><td>完整</td><td>原生模块化，推荐使用</td></tr></tbody></table>
<p>Spring Boot 3.0+ 基于 Spring 6.x，完全支持 Java 17+。</p>
<h3 data-id="heading-24">Hibernate</h3>




















<table><thead><tr><th>版本</th><th>Java 支持</th><th>说明</th></tr></thead><tbody><tr><td>Hibernate 5.x</td><td>Java 8-11</td><td>需要较多 <code>--add-opens</code></td></tr><tr><td>Hibernate 6.x</td><td>Java 11+</td><td>改进的模块化支持</td></tr></tbody></table>
<h3 data-id="heading-25">Logback</h3>
<p>所有版本均需禁用 <code>scan</code> 或添加反射参数。</p>
<p>推荐配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/defaults.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/console-appender.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"CONSOLE"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-26">常见问题</h2>
<p><strong>Q: 能不能不加这些参数？</strong></p>
<p>A: 短期内不行。除非：</p>
<ul>
<li>退回 Java 8（不推荐，都快 EOL 了）</li>
<li>换成编译时注入的框架（Micronaut、Quarkus）</li>
<li>等所有依赖都模块化（估计还得好几年）</li>
</ul>
<p><strong>Q: 生产环境用这些参数靠谱吗？</strong></p>
<p>A: 靠谱。前提是：</p>
<ul>
<li>依赖别从野鸡仓库拉</li>
<li>定期跑漏洞扫描</li>
<li>只开必要的包，别乱开</li>
</ul>
<p><strong>Q: 参数太多了，能简化吗？</strong></p>
<p>A: 用参数文件：</p>
<pre><code class="hljs language-bash" lang="bash">java @jvm-options.txt -jar app.jar
</code></pre>
<p>或者统一放环境变量里。</p>
<p><strong>Q: 怎么知道要加哪些参数？</strong></p>
<p>A: 看异常信息：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">module</span> java.base does <span class="hljs-keyword">not</span> open java.util to unnamed <span class="hljs-keyword">module</span>
                              ^^^^^^^^^
                              就是这个包
</code></pre>
<p>然后加：<code>--add-opens java.base/java.util=ALL-UNNAMED</code></p>
<p><strong>Q: 以后还得一直加这些参数吗？</strong></p>
<p>A: 看框架更新情况。Spring 6 已经减少了对反射的依赖，以后可能会更好。</p>
<hr/>
<h2 data-id="heading-27">写在最后：升级 Java 17 的正确姿势</h2>
<p>帮这么多团队升级后，总结几点经验：</p>
<p><strong>1. 别一次性跨太多版本</strong><br/>
Java 8 → 17 跨度太大，建议：8 → 11 → 17，每次充分测试。</p>
<p><strong>2. 模块系统不是敌人</strong><br/>
虽然短期内会遇到反射问题，但长期看，模块化让依赖管理更清晰。<code>--add-opens</code> 只是过渡手段。</p>
<p><strong>3. 用得清醒，就不怕风险</strong><br/>
这些参数本身不危险，危险的是野鸡依赖。定期跑 <code>mvn dependency-check:check</code>，比纠结参数安全性有用得多。</p>
<hr/>
<p><strong>升级前先自查（省 2 小时排错）：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查 Logback 配置（Spring Boot 3.2+ 必查）</span>
grep -r <span class="hljs-string">'scan="true"'</span> src/main/resources/
<span class="hljs-comment"># 如果有，删掉它</span>

<span class="hljs-comment"># 2. 创建 JVM 参数文件（别直接写在启动脚本里，不好维护）</span>
<span class="hljs-built_in">cat</span> &gt; jvm-options.txt &lt;&lt; <span class="hljs-string">EOF
--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED
--add-opens java.base/java.lang.invoke=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED
EOF</span>

<span class="hljs-comment"># 3. 本地先跑一遍测试</span>
mvn clean <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 4. 扫依赖漏洞（顺便的事）</span>
mvn dependency-check:check
</code></pre>
<p><strong>常见问题速查：</strong></p>

























<table><thead><tr><th>报错信息</th><th>加这个参数</th></tr></thead><tbody><tr><td><code>does not open java.util</code></td><td><code>--add-opens java.base/java.util=ALL-UNNAMED</code></td></tr><tr><td><code>does not open java.lang</code></td><td><code>--add-opens java.base/java.lang=ALL-UNNAMED</code></td></tr><tr><td><code>does not open java.lang.reflect</code></td><td><code>--add-opens java.base/java.lang.reflect=ALL-UNNAMED</code></td></tr><tr><td>Logback 配置加载失败</td><td>删掉 <code>logback.xml</code> 里的 <code>scan="true"</code></td></tr></tbody></table>
<p>遇到新的坑，对照异常信息找 <code>does not open</code> 后面的包名，加对应的 <code>--add-opens</code> 就行。</p>
<hr/>
<h2 data-id="heading-28">参考资源</h2>
<p><strong>官方文档：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F261" target="_blank" title="https://openjdk.org/jeps/261" ref="nofollow noopener noreferrer">JEP 261: Module System</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F403" target="_blank" title="https://openjdk.org/jeps/403" ref="nofollow noopener noreferrer">JEP 403: Strongly Encapsulate JDK Internals</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-boot%2Fwiki%2FSpring-Boot-3.0-Migration-Guide" target="_blank" title="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide" ref="nofollow noopener noreferrer">Spring Boot 3.0 Migration Guide</a></li>
</ul>
<p><strong>社区指南：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspring.io%2Fblog%2F2021%2F09%2F02%2Fa-java-17-and-jakarta-ee-9-baseline-for-spring-framework-6" target="_blank" title="https://spring.io/blog/2021/09/02/a-java-17-and-jakarta-ee-9-baseline-for-spring-framework-6" ref="nofollow noopener noreferrer">Migrating to Java 17 - Spring Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.baeldung.com%2Fjava-9-modularity" target="_blank" title="https://www.baeldung.com/java-9-modularity" ref="nofollow noopener noreferrer">Java Module System Tutorial</a></li>
</ul>
<p><strong>工具：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fjava%2Fjavase%2F17%2Fdocs%2Fspecs%2Fman%2Fjdeps.html" target="_blank" title="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jdeps.html" ref="nofollow noopener noreferrer">jdeps</a>: 分析模块依赖</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fowasp.org%2Fwww-project-dependency-check%2F" target="_blank" title="https://owasp.org/www-project-dependency-check/" ref="nofollow noopener noreferrer">OWASP Dependency-Check</a>: 依赖漏洞扫描</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>