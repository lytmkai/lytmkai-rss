<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Rust 所有权与借用：从堆栈开始建立心智模型]]></title>    <link>https://juejin.cn/post/7598507330859958314</link>    <guid>https://juejin.cn/post/7598507330859958314</guid>    <pubDate>2026-01-23T16:35:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598507330859958314" data-draft-id="7598418891400642614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust 所有权与借用：从堆栈开始建立心智模型"/> <meta itemprop="keywords" content="Rust,操作系统,算法"/> <meta itemprop="datePublished" content="2026-01-23T16:35:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mCell"/> <meta itemprop="url" content="https://juejin.cn/user/2280829967146779"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust 所有权与借用：从堆栈开始建立心智模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2280829967146779/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mCell
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T16:35:12.000Z" title="Fri Jan 23 2026 16:35:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d279a104a97b4f27a8f51be3a9130eb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbUNlbGw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769790912&amp;x-signature=1v9tDnYY4FHiLCc%2FqXV9XprTgGU%3D" alt="202603" loading="lazy"/></p>
<blockquote>
<p>本文写作时，极大的借鉴了<a href="https://link.juejin.cn?target=https%3A%2F%2Fcourse.rs%2Fbasic%2Fownership%2Fownership.html" target="_blank" title="https://course.rs/basic/ownership/ownership.html" ref="nofollow noopener noreferrer">《The Rust Programming Language》</a>（俗称“Rust 圣经”）中相关章节的内容和结构，在此表示感谢。</p>
</blockquote>
<p>写 Rust 的第一道坎，不是语法，也不是宏，而是“我明明只是把变量传给你用一下，怎么它就不属于我了？”</p>
<p>这类困惑通常并不奇怪，因为我们习惯了别的语言那套“内存默认有人兜底”的模型，比如 Javascript、Golang 的自动垃圾回收机制。Rust 恰恰相反：它要求你把内存这件事想清楚，然后把规则写进类型系统，交给编译器在<strong>编译期</strong>强制执行——这就是所有权系统的核心意义。</p>
<p>为了尽量讲清楚，本文按一条线往前走：先讲堆栈，再讲所有权，再讲借用。</p>
<h2 data-id="heading-0">内存管理这件事，语言大致分三派</h2>
<p>所有程序都要用内存：申请空间、使用、释放。麻烦在于“什么时候释放、谁来释放”。历史上主流语言大致走过三条路：</p>
<ol>
<li><strong>GC</strong>：运行时找出不再使用的内存并回收（Javascript、Golang）。</li>
<li><strong>手动管理</strong>：程序员显式分配/释放（C/C++）。</li>
<li><strong>所有权</strong>：编译期按规则检查，运行期不额外付费（Rust）。</li>
</ol>
<p>Rust 选择第三条路的“野心”很明确：既想要接近 C/C++ 的性能，又想把悬空指针、二次释放、数据竞争这类内存安全问题，尽量提前到编译阶段解决。</p>
<h2 data-id="heading-1">先把地基打牢：栈（Stack）与堆（Heap）</h2>
<p>如果你只写脚本语言，可能一辈子不必深究堆栈。但在 Rust 里，理解堆栈会直接决定你是否看得懂“移动/借用”的行为。</p>
<h3 data-id="heading-2">栈：后进先出，大小必须固定</h3>
<p>栈像一叠盘子：只能从顶部放、从顶部拿，后进先出。入栈/出栈非常快，但前提是：<strong>每个值的大小在编译期必须已知且固定</strong>，否则你无法“精确地弹出”你想要的那块数据。</p>
<p>你可以把一次函数调用想成：</p>
<ul>
<li>参数、局部变量依次压栈</li>
<li>函数结束按相反顺序出栈</li>
<li>出栈就意味着那段栈内存可以被复用（所以“拿着栈上局部变量的地址回去”很危险）</li>
</ul>
<h3 data-id="heading-3">堆：存放大小可变的数据，用指针去找它</h3>
<p>堆适合“大小未知或可能变化”的数据。分配时，操作系统找一块足够大的空位，标记已使用，并返回该位置的<strong>指针</strong>。这个过程叫在堆上分配内存（allocating）。</p>
<p>关键细节是：
<strong>堆上的数据本体不在栈里，但指向它的指针通常在栈里</strong>（因为指针大小固定）。你之后每次访问堆数据，都是通过栈上的指针去“导航”到堆上。</p>
<h3 data-id="heading-4">为什么堆更麻烦</h3>
<p>栈是“自动管理”的：作用域结束就出栈；
堆是“散装的”：不跟着某个作用域自动消失，如果你不追踪它何时释放，就可能内存泄漏。Rust 的所有权系统，本质上就是把“堆上资源的释放责任”用规则固定下来。</p>
<h2 data-id="heading-5">所有权三条规则：把“释放责任”写死</h2>
<p>Rust 的所有权规则可以背下来（先别急着理解，后面会用例子把它磨清楚）：</p>
<ol>
<li>Rust 中每个值都有一个变量作为它的<strong>所有者</strong></li>
<li>同一时刻一个值只能有一个所有者</li>
<li>所有者离开作用域时，这个值会被丢弃（drop）</li>
</ol>
<p>注意第三条：“drop”不是抽象概念，它就是“释放资源”的那个动作——对栈上简单值没什么特别，对堆上数据就非常关键，因为它决定了堆内存何时释放。</p>
<h2 data-id="heading-6">一个最常见的误会：<code>String</code> 赋值为什么会让旧变量失效？</h2>
<p>来看两段对比代码。</p>
<h3 data-id="heading-7"><code>i32</code> 这种简单类型：复制（Copy）就完事了</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-number">5</span>;
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">y</span> = x;
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"x = {}, y = {}"</span>, x, y); <span class="hljs-comment">// x 仍然可用</span>
</code></pre>
<p>整数是固定大小的简单值，放在栈上，“复制 4 个字节”非常快，所以 Rust 直接做拷贝，<code>x</code> 不会失效。</p>
<h3 data-id="heading-8"><code>String</code>：背后有堆内存，不能随便“默认复制”</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s1</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s2</span> = s1;
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"s1 = {}, s2 = {}"</span>, s1, s2); <span class="hljs-comment">// 编译报错，s1 失效</span>
</code></pre>
<p><code>String</code> 本质上是一个“句柄”：<strong>栈上</strong>存着（堆指针、长度、容量），真正的字符数据在<strong>堆上</strong>。</p>
<p>这时如果允许 <code>s1</code>、<code>s2</code> 同时指向同一块堆内存，就会撞上所有权第二条：一个值只能有一个所有者。更现实的问题是：作用域结束时，谁来 drop？如果两个都 drop，就可能二次释放。Rust 不赌运气，它选择在赋值时把所有权转移给新变量，让旧变量立刻失效，从根上切断这类问题。</p>
<p>编译器的报错也会直接告诉你：<code>String</code> 没实现 <code>Copy</code>，因此发生了 move，之后再用旧变量就不行。</p>
<h2 data-id="heading-9">Move / Clone / Copy：三个词，三种成本</h2>
<p>把这三者分清，所有权就通了八成。</p>
<h3 data-id="heading-10">Move：转移“释放责任”，通常不复制堆数据</h3>
<p>对 <code>String</code> 这种拥有堆资源的类型，<code>let s2 = s1;</code> 的核心不是“复制内容”，而是“把释放责任交给 s2”。这样性能很好，因为你没有做深拷贝。</p>
<h3 data-id="heading-11">Clone：深拷贝，复制堆上内容（贵）</h3>
<p>如果你确实需要两份独立的数据，用 <code>clone()</code>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s1</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s2</span> = s1.<span class="hljs-title function_ invoke__">clone</span>();
<span class="hljs-built_in">println!</span>(<span class="hljs-string">"s1 = {}, s2 = {}"</span>, s1, s2);
</code></pre>
<p>Rust 不会自动深拷贝；你显式 <code>clone</code>，就等于显式选择了更高成本。官方也提醒：热点路径上滥用 clone 会显著拖慢性能。</p>
<h3 data-id="heading-12">Copy：对栈上固定大小类型，赋值就是复制</h3>
<p>Rust 有个 <code>Copy</code> 特征：实现了它的类型，在赋值/传参时会发生拷贝，旧变量仍可用。大体规则是：不需要分配内存、没有“释放资源”负担的类型往往可 Copy，比如整数、bool、浮点、char、只包含 Copy 成员的元组、不可变引用 <code>&amp;T</code> 等。</p>
<p>这里顺便点一下：<strong>可变引用 <code>&amp;mut T</code> 不能 Copy</strong>，因为“到处复制可写钥匙”会直接破坏后面的借用安全规则。</p>
<h2 data-id="heading-13">函数调用：传参和返回值同样会触发 Move/Copy</h2>
<p>很多人第一次“被 Rust 教育”，就是在函数参数这里。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">takes_ownership</span>(some_string: <span class="hljs-type">String</span>) { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">makes_copy</span>(some_integer: <span class="hljs-type">i32</span>) { <span class="hljs-comment">/* ... */</span> }

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-title function_ invoke__">takes_ownership</span>(s); <span class="hljs-comment">// move，s 失效</span>

    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">x</span> = <span class="hljs-number">5</span>;
    <span class="hljs-title function_ invoke__">makes_copy</span>(x); <span class="hljs-comment">// copy，x 仍然可用</span>
}
</code></pre>
<p><code>String</code> 传入函数后，所有权移动到形参；函数结束形参离开作用域，触发 drop，堆内存被释放。<code>i32</code> 因为 Copy，不影响外面的 <code>x</code>。</p>
<p>函数返回值也一样带着所有权：谁接住，谁就成为新所有者。</p>
<p>到这里你会发现：如果每次只是“借来用一下”，却必须 move 进去、再 move 出来，代码会很啰嗦。这正是下一章：<strong>借用</strong> 要解决的问题。</p>
<h2 data-id="heading-14">借用：我只想用你的数据，但不想拿走它</h2>
<p>借用（borrowing）就是：<strong>创建引用，用引用访问数据，但不夺走所有权</strong>。现实比喻很直白：别人拥有某样东西，你可以借来用，用完要还。</p>
<h2 data-id="heading-15">不可变引用：只读借阅，不改内容</h2>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">calculate_length</span>(s: &amp;<span class="hljs-type">String</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">usize</span> {
    s.<span class="hljs-title function_ invoke__">len</span>()
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s1</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">len</span> = <span class="hljs-title function_ invoke__">calculate_length</span>(&amp;s1);
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{} {}"</span>, s1, len); <span class="hljs-comment">// s1 仍然可用</span>
}
</code></pre>
<p>这里发生了两件重要的事：</p>
<ol>
<li>参数类型从 <code>String</code> 变成 <code>&amp;String</code>，所以不会 move 所有权</li>
<li>引用离开作用域时，不会 drop 其指向的值，因为引用不是所有者</li>
</ol>
<p>你可以把 <code>&amp;String</code> 想成“只读门禁卡”：能进门看房间（访问数据），但不能装修（修改数据），也不能决定拆房（释放内存）。</p>
<h2 data-id="heading-16">可变引用：可以修改，但“同一时刻只能有一把可写钥匙”</h2>
<p>如果你想通过借用去修改数据，需要 <code>&amp;mut</code>：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">change</span>(s: &amp;<span class="hljs-keyword">mut</span> <span class="hljs-type">String</span>) {
    s.<span class="hljs-title function_ invoke__">push_str</span>(<span class="hljs-string">", world"</span>);
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">s</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    <span class="hljs-title function_ invoke__">change</span>(&amp;<span class="hljs-keyword">mut</span> s);
}
</code></pre>
<p>关键限制来了：<strong>同一作用域内，特定数据只能存在一个可变引用</strong>。否则编译报错。</p>
<p>这条限制不是为了折磨人，而是为了在编译期消灭“数据竞争”的经典成因：</p>
<ul>
<li>多个指针同时访问同一数据</li>
<li>至少一个在写</li>
<li>没有同步机制
这三条凑齐，就可能出现未定义行为。Rust 选择直接不让这种代码通过编译。</li>
</ul>
<p>一个很实用的小技巧是：用 <code>{}</code> 缩小借用作用域，让前一个可变借用尽早结束，再创建下一个。</p>
<h2 data-id="heading-17">可变与不可变不能混用：读者不希望书被当场改写</h2>
<p>借用还有一条总规则（也是你未来最常用的心法）：</p>
<ul>
<li>同一时刻：要么<strong>一个可变引用</strong>，要么<strong>任意多个不可变引用</strong></li>
<li>引用必须总是有效的</li>
</ul>
<p>直觉解释：多个只读同时存在没问题，因为大家都不写；但只要有人写，就必须保证“写的时候没人读、没人也在写”，否则你读到的可能是半更新状态的数据。</p>
<h2 data-id="heading-18">你以为引用的作用域跟 <code>{}</code> 一样？Rust 还做了 NLL 优化</h2>
<p>很多“看起来应该能过”的代码，卡在借用检查上，原因往往是：你把引用的有效期想成了“到花括号结束”，但 Rust 新编译器会更聪明：引用的有效期持续到<strong>最后一次使用</strong>。</p>
<p>这种优化叫 <strong>Non-Lexical Lifetimes（NLL）</strong>。它让很多过去需要“手动改结构”的代码，现在可以自然通过。</p>
<h2 data-id="heading-19">悬垂引用：Rust 在编译期就把“拿着空气地址”这事堵死</h2>
<p>悬垂引用（Dangling Reference）就是：指针还在，但它指向的值已经被释放或被重用。很多语言里这是运行时炸弹；Rust 的目标是让它变成编译时错误。</p>
<p>经典错误示例：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">dangle</span>() <span class="hljs-punctuation">-&gt;</span> &amp;<span class="hljs-type">String</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    &amp;s
} <span class="hljs-comment">// s 离开作用域被释放</span>
</code></pre>
<p>函数返回了 <code>s</code> 的引用，但 <code>s</code> 在函数结束时就被 drop 了，引用将指向无效内存。Rust 会直接拒绝编译，并提示：返回类型包含借用值，但找不到可借用的来源。</p>
<p>解决方式往往很“Rust”：<strong>直接返回拥有所有权的值</strong>，让所有权移动给调用者：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">no_dangle</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">String</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">s</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">from</span>(<span class="hljs-string">"hello"</span>);
    s
}
</code></pre>
<p>这段就没有悬垂引用风险了。</p>
<h2 data-id="heading-20">把它们串起来：一个实用的心智模型</h2>
<p>到这里，你可以用一句话把所有权系统记住：</p>
<blockquote>
<p>Rust 用“唯一所有者 + 借用规则”来管理堆上资源的释放责任，并在编译期阻止别名写入、悬垂引用和数据竞争。</p>
</blockquote>
<p>再把它映射到堆栈：</p>
<ul>
<li>栈上简单值（固定大小）大多 Copy：复制成本小，没释放负担</li>
<li>堆上资源（<code>String</code>、<code>Vec</code> 等）默认 Move：转移释放责任，避免二次释放</li>
<li>借用（引用）让你“不拿走所有权也能用”：但读写别名必须被规则约束，否则就回到 C 的不安全世界</li>
</ul>
<p>你会逐渐发现：Rust 不是“限制多”，而是把过去运行时才爆炸的问题，提前到你写代码的那一刻就指出来。它让你慢一点写对，但快很多维护。</p>
<h2 data-id="heading-21">借用规则速记卡</h2>
<ul>
<li>值的所有者离开作用域就 drop（对堆资源尤其关键）</li>
<li><code>String</code> 这类拥有堆资源的类型，赋值/传参默认 move（旧变量失效）</li>
<li>需要两份数据就 <code>clone()</code>，但要意识到它会深拷贝、会贵</li>
<li>借用总结：同一时刻要么 1 个 <code>&amp;mut</code>，要么 N 个 <code>&amp;</code>；引用必须有效</li>
<li>返回局部变量引用会导致悬垂引用风险，Rust 会拒绝编译；通常改为返回拥有所有权的值</li>
</ul>
<p>（完）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose重组稳定性分析器]]></title>    <link>https://juejin.cn/post/7598390354292621358</link>    <guid>https://juejin.cn/post/7598390354292621358</guid>    <pubDate>2026-01-23T15:15:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390354292621358" data-draft-id="7598390244380327974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose重组稳定性分析器"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2026-01-23T15:15:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose重组稳定性分析器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T15:15:35.000Z" title="Fri Jan 23 2026 15:15:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「Compose Stability Analyzer: Real-Time Stability Insights for Jetpack Compose」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fproandroiddev%2Fcompose-stability-analyzer-real-time-stability-insights-for-jetpack-compose-1399924a0a64" target="_blank" title="https://medium.com/proandroiddev/compose-stability-analyzer-real-time-stability-insights-for-jetpack-compose-1399924a0a64" ref="nofollow noopener noreferrer">medium.com/proandroidd…</a>，由Jaewoong Eum发布于20251110。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c0f0fa939f4445b9526f963e0aeb510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=9Lkm5WCZtOHmuoPcTn4cBTgIqWM%3D" alt="0.jpg" loading="lazy"/></p>
<p>Jetpack Compose 以其声明式编程范式革新了 Android UI 开发，但这种简洁性背后却隐藏着复杂性：理解重组合行为。当一个可组合元素不必要地进行重组合时，就会造成性能损失，CPU 周期会浪费在重新渲染实际上并未改变的 UI 上。挑战不仅在于识别这些问题，更在于理解它们发生的<strong>原因</strong>。</p>
<p>Compose 编译器一直在后台执行稳定性分析，确定哪些可组合元素在输入未发生变化时可以跳过重组合。但这种分析是在编译时静默进行的，开发者无法得知他们的可组合元素是否得到了优化。你可能编写出看似完美稳定的代码，但之后却发现类中一个 <code>var</code> 属性就足以导致整个代码不稳定，并波及整个 UI 树。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fcompose-stability-analyzer" target="_blank" title="https://github.com/skydoves/compose-stability-analyzer" ref="nofollow noopener noreferrer">Compose Stability Analyzer</a> 将这种隐藏的分析揭示出来。它是一套全面的工具集，可在 IDE 中提供实时可视化反馈，通过注解进行运行时代码重组追踪，并在 CI 流水线中进行稳定性验证。无需等到性能问题在生产环境中出现，你就能在编码过程中获得即时反馈，使稳定性分析自然而然地融入你的开发工作流程。</p>
<p>本文将探讨 Compose 稳定性分析器的工作原理，包括：IntelliJ 插件（为你的 IDE 提供可视化的稳定性指示器）、编译器插件（启用运行时重组跟踪）以及稳定性验证系统（防止回归问题影响生产环境）。</p>
<h2 data-id="heading-0">理解稳定性问题：为什么可组合函数会重组</h2>
<p>在深入工具之前，值得了解 Compose 编译器实际上分析的内容。编译器会对每个可组合函数执行稳定性推断，回答两个问题：</p>
<p><strong>1. 这个可组合函数可以跳过吗？</strong>
当编译器能够证明使用相同的输入重新组合该函数会产生相同的结果时，该可组合函数就是可跳过的。如果所有参数都是稳定的并且没有发生变化，可组合函数可以完全跳过重新组合，这是一个显著的性能优化。</p>
<p><strong>2. 该可组合项是否可重启？</strong></p>
<p>当一个可组合项可以独立重新组合而无需重新组合其父项时，该可组合项是可重启的。这使得重新组合更加细粒度。大多数可组合项都是可重启的，但带有某些修饰符的可组合项可能不是。</p>
<p>这里的关键概念是<strong>参数稳定性</strong>。当 Compose 编译器能够可靠地检测到参数值是否发生变化时，该参数是稳定的。规则非常复杂，如果你想深入了解这些规则，可以参考稳定性研究<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fcompose-stability-inference" target="_blank" title="https://github.com/skydoves/compose-stability-inference" ref="nofollow noopener noreferrer">Compose 稳定性推断</a>。</p>
<h2 data-id="heading-1">在 Android Studio 中进行可视化稳定性分析</h2>
<p>Compose Stability Analyzer IntelliJ 插件可将稳定性分析直接集成到 Android Studio 和 IntelliJ IDEA 中，在你编写代码时提供四层可视化反馈。</p>
<h3 data-id="heading-2">安装和设置</h3>
<p>安装插件非常简单：</p>
<ol>
<li>
<p>打开 <strong>Android Studio</strong> → <strong>设置</strong> → <strong>插件</strong> → <strong>应用市场</strong>。</p>
</li>
<li>
<p>搜索“Compose Stability Analyzer”。</p>
</li>
<li>
<p>点击 <strong>安装</strong> 并重启 IDE。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f046aa993e04497f8418fb5fa6901dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=n0wA6JRzwwVQz3PQc32Q9NmPP70%3D" alt="1.png" loading="lazy"/></p>
<p>安装完成后，插件会立即开始分析你的代码。无需任何配置，它可与任何 Compose 项目开箱即用。</p>
<h3 data-id="heading-3">边栏图标：即时视觉反馈</h3>
<p>最直观的功能是边栏图标，即出现在可组合函数左侧边栏的彩色圆点：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02eeab62372e4884a18290c0e4755e60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=SiekshEEDIDbLmVLDNXj6onuLdI%3D" alt="2.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>绿点</strong>：此可组合函数可跳过。所有参数均稳定，编译器可以优化重新组合。</p>
</li>
<li>
<p><strong>黄点</strong>：此可组合函数可重启，但不可跳过。它会在其父函数重新组合时重新组合。</p>
</li>
<li>
<p><strong>红点</strong>：此可组合函数的参数不稳定，无法进行优化。</p>
</li>
</ul>
<p>这种即时视觉反馈是快速发现 Jetpack Compose 性能问题的最佳方法。只需快速浏览左侧边栏，即可了解哪些可组合函数需要关注。如果屏幕上布满红点，则说明需要进行一些优化工作。</p>
<p>边栏图标的计算基于 Compose 编译器执行的相同稳定性分析。该插件会接入编译器的分析阶段并提取稳定性信息，然后在编辑器中以可视化的方式呈现。</p>
<p>但请注意，目前<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fperformance%2Fstability%2Fstrongskipping" target="_blank" title="https://developer.android.com/develop/ui/compose/performance/stability/strongskipping" ref="nofollow noopener noreferrer">强跳过模式</a>默认大多已启用，因此所有可组合函数默认都可以跳过。你可以在插件配置中启用或禁用强跳过模式检查（工具 &gt; Compose 稳定性分析器），该功能自 0.5.0 版本起也默认启用。如果你希望更加关注稳定性问题，可以根据实际情况将其关闭。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67aa0e93ecc14fd6b49bee86d4e48238~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=vbCLh3FodbXpdey1qkOC1eDZmrY%3D" alt="3" loading="lazy"/></p>
<h3 data-id="heading-4">悬停提示：了解原因</h3>
<p>边栏图标告诉你<strong>哪里</strong>出了问题，而悬停提示则告诉你<strong>为什么</strong>。当你将鼠标悬停在可组合函数名称上时，会显示详细的提示信息：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7a1511f3cab4426b968e041354432c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=ifiVLKiYjMF%2BiCT7DtU9IJZGq%2FY%3D" alt="4" loading="lazy"/></p>
<p>提示信息显示：</p>
<ul>
<li>
<p>可组合函数是否可跳过和可重启</p>
</li>
<li>
<p>稳定参数与不稳定参数的总数</p>
</li>
<li>
<p>每个参数的详细稳定性信息</p>
</li>
<li>
<p>接收器稳定性（针对扩展函数）</p>
</li>
</ul>
<p>这种细致的反馈对于调试至关重要。你无需猜测哪个参数导致了不稳定，而是可以准确地看到哪些参数存在问题。</p>
<h3 data-id="heading-5">内联参数提示：精细化可见性</h3>
<p>工具提示会在鼠标悬停时提供详细信息，而内联参数提示则无需任何交互即可提供持续可见性：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3956e76e95a4f02a6a39de1a4fcd370~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=t0tRRmxoKSkWH9mywlL%2BkfuZfZc%3D" alt="5.png" loading="lazy"/></p>
<p>函数签名中每个参数类型旁边都会显示小徽章，指示该参数是稳定还是不稳定。这是最详细的反馈级别；每个参数的稳定性一目了然。</p>
<p>对于参数众多的函数，这有助于你快速浏览并识别有问题的参数，而无需打开工具提示。颜色编码与稳定性状态相对应：</p>
<ul>
<li>
<p>绿色徽章：参数稳定</p>
</li>
<li>
<p>红色徽章：参数不稳定</p>
</li>
<li>
<p>黄色徽章：稳定性将在运行时决定（因此可能稳定也可能不稳定）</p>
</li>
</ul>
<h3 data-id="heading-6">代码检查：自动建议</h3>
<p>第四层反馈是主动代码检查。当插件检测到不稳定的组合体时，它可以：</p>
<ol>
<li>
<p><strong>用警告下划线突出显示问题</strong>。</p>
</li>
<li>
<p><strong>通过 Alt+Enter 菜单提供快速修复建议</strong>。</p>
</li>
<li>
<p><strong>提供添加注解（例如 <code>@TraceRecomposition</code>）</strong> 以进行调试。</p>
</li>
<li>
<p><strong>提供抑制选项</strong>（如果不稳定是故意的）。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/198a9b958db349a1829f45528aa87acb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=M81TxjBmCyyCvNvEdNYGUzW4J5U%3D" alt="6" loading="lazy"/></p>
<p>插件在此开始主动出击。它不仅会指出问题，还会提供解决方案。在不稳定的组合体上按下 Alt+Enter，你可能会看到如下选项：</p>
<ul>
<li>
<p>添加 <code>@TraceRecomposition</code> 以监控重新组合。</p>
</li>
<li>
<p>使用 <code>@Stable</code> 注解进行标记（请谨慎使用）。</p>
</li>
<li>
<p>抑制此函数的稳定性警告。</p>
</li>
</ul>
<h3 data-id="heading-7">稳定性浏览器：包级分析</h3>
<p>除了单个函数分析之外，稳定性浏览器还提供整个代码库稳定性的概览：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d875bdd5845f4cbe93875a464fbf433a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=cLm9%2BMB8hXv0WCjA8dUgITTUfdM%3D" alt="7" loading="lazy"/></p>
<p>启用方法：</p>
<ol>
<li>
<p>安装 Compose Stability Analyzer Gradle 插件（下一节将介绍）。</p>
</li>
<li>
<p>转到“视图”→“工具窗口”→“Compose Stability Analyzer”。</p>
</li>
<li>
<p>构建项目并单击刷新按钮。</p>
</li>
</ol>
<p>浏览器以树状视图显示包结构，每个可组合函数都带有其稳定性状态的注解。你可以快速深入查找整个代码库中不稳定的函数，从而轻松地确定优化工作的优先级。</p>
<p>这在大型项目中尤其有用，因为手动检查每个可组合组件是不切实际的。该工具会为你的应用程序提供一份稳定性“成绩单”，显示哪些包存在最多的稳定性问题。</p>
<h3 data-id="heading-8">自定义配置</h3>
<p>该插件具有高度可定制性。你可以调整颜色、启用或禁用特定的视觉指示器，并配置分析行为以满足你的偏好。</p>
<p>前往“设置”→“工具”→“Compose Stability Analyzer”（组合稳定性分析器）访问配置选项：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8be0dd62b264f44bae983439f194c05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=ZGy0A3VPG91tVihVjiNMC5MX8ZM%3D" alt="8" loading="lazy"/></p>
<p>你可以：</p>
<ul>
<li>
<p>更改边栏图标颜色以匹配你的 IDE 主题</p>
</li>
<li>
<p>分别启用或禁用内联提示、警告和边栏图标</p>
</li>
<li>
<p>配置强跳过模式分析</p>
</li>
<li>
<p>添加忽略类型模式以从分析中排除某些类</p>
</li>
<li>
<p>在测试源集中启用分析</p>
</li>
<li>
<p>设置自定义稳定性配置文件</p>
</li>
</ul>
<p>这种灵活性确保插件能够自然地融入你现有的工作流程，无论你偏好最小的视觉干扰还是最大的信息密度。</p>
<h2 data-id="heading-9">Gradle 插件：运行时重组追踪</h2>
<p>IntelliJ 插件提供编译时可见性，而 Gradle 插件则支持<strong>运行时分析</strong>，能够精确追踪可组合组件在运行中的重组时间和原因。这是通过 <code>@TraceRecomposition</code> 注解实现的，该注解是一个编译器插件，它会在可组合组件中添加日志代码。</p>
<h3 data-id="heading-10">安装和设置</h3>
<p>将以下依赖项添加到 <code>libs.versions.toml</code> 文件中：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-attr">stability-analyzer</span> = { id = <span class="hljs-string">"com.github.skydoves.compose.stability.analyzer"</span>, version = <span class="hljs-string">"0.5.0"</span> }
</code></pre>
<p>接下来，将插件应用到根目录下的 <code>build.gradle.kts</code> 文件中，如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">alias(libs.plugins.stability.analyzer)
</code></pre>
<p>完成！该插件会自动将编译器插件应用到项目中的所有 Kotlin 编译任务。基本用法无需额外配置。</p>
<h3 data-id="heading-11">Kotlin 版本兼容性</h3>
<p>该插件与 Kotlin 编译器紧密耦合，因此版本一致性至关重要。截至撰写本文时，<strong>你至少应使用 Kotlin 2.2.21 版本</strong>。使用不匹配的版本可能会导致编译错误。请始终使用与你的稳定性分析器版本完全匹配的 Kotlin 版本。你可以参考 Kotlin 版本映射表（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fcompose-stability-analyzer%3Ftab%3Dreadme-ov-file%23kotlin-version-mapping%25EF%25BC%2589%25E8%258E%25B7%25E5%258F%2596%25E7%259B%25B8%25E5%2585%25B3%25E4%25BF%25A1%25E6%2581%25AF%25E3%2580%2582" target="_blank" title="https://github.com/skydoves/compose-stability-analyzer?tab=readme-ov-file#kotlin-version-mapping%EF%BC%89%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E3%80%82" ref="nofollow noopener noreferrer">github.com/skydoves/co…</a></p>
<h3 data-id="heading-12">@TraceRecomposition 注解</h3>
<p>安装插件后，你可以使用 <code>@TraceRecomposition</code> 注解任何可组合组件，以跟踪其重组行为：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@TraceRecomposition</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ProductCard</span><span class="hljs-params">(
    product: <span class="hljs-type">Product</span>,
    onClick: () -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    Card(onClick = onClick) {
        Text(product.name)
        Text(<span class="hljs-string">"$<span class="hljs-subst">${product.price}</span>"</span>)
    }
}
</code></pre>
<p>当此可组合组件重组时，你将在 Logcat 中看到详细的日志：</p>
<pre><code class="hljs language-bash" lang="bash">D/Recomposition: \[Recomposition <span class="hljs-comment">#1\] ProductCard  </span>
D/Recomposition:   ├─ product: Product stable (Product@abc123)  
D/Recomposition:   └─ onClick: () -&gt; Unit stable (Function@xyz789)  
D/Recomposition: \[Recomposition <span class="hljs-comment">#2\] ProductCard  </span>
D/Recomposition:   ├─ product: Product changed (Product@abc123 → Product@def456)  
D/Recomposition:   └─ onClick: () -&gt; Unit stable (Function@xyz789)
</code></pre>
<p>日志显示：</p>
<ul>
<li>
<p><strong>重组次数</strong>：此实例已重组的次数</p>
</li>
<li>
<p><strong>参数稳定性</strong>：每个参数是稳定还是不稳定</p>
</li>
<li>
<p><strong>变更检测</strong>：哪些参数发生了更改，显示新旧值</p>
</li>
<li>
<p><strong>身份跟踪</strong>：每个参数值的哈希码</p>
</li>
</ul>
<p>这些细粒度的信息对于调试至关重要。你可以准确地看到是哪个参数的更改触发了重组，从而帮助你了解应用程序的重组模式。</p>
<h3 data-id="heading-13">使用标签参数进行过滤</h3>
<p>对于包含大量跟踪可组合组件的大型应用程序，日志可能会变得非常庞大。 <code>tag</code> 参数可以帮助你组织和筛选日志：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@TraceRecomposition(tag = <span class="hljs-string">"product-list"</span>)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ProductCard</span><span class="hljs-params">(product: <span class="hljs-type">Product</span>, onClick: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-meta">@TraceRecomposition(tag = <span class="hljs-string">"user-profile"</span>)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ProfileHeader</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>现在日志包含以下标签：</p>
<p>D/Recomposition: [Recomposition #1] ProductCard (tag: product-list)</p>
<p>D/Recomposition: [Recomposition #1] ProfileHeader (tag: user-profile)</p>
<p>你可以筛选 Logcat 以仅显示特定标签：</p>
<ul>
<li>
<p>按 <code>tag: product-list</code> 筛选，仅查看与产品相关的重组日志。</p>
</li>
<li>
<p>按 <code>tag: user-profile</code> 筛选，仅查看与用户个人资料相关的重组日志。</p>
</li>
</ul>
<p>这在与自定义日志记录器（将在下文介绍）结合使用时尤其有用，因为你可能只想将某些标签发送到分析服务。</p>
<h3 data-id="heading-14">设置阈值以减少噪音</h3>
<p>大多数可组合组件在初始设置期间会重新组合 1-2 次，这是预期行为，<strong>并非性能问题</strong>。<code>threshold</code> 参数可以过滤掉这些噪音：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@TraceRecomposition(threshold = 3)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FrequentlyRecomposingScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// Logs will only appear after the 3rd recomposition</span>
}
</code></pre>
<p>这样可以将注意力集中在真正的问题上：用户交互期间不断重新组合的可组合组件，而不仅仅是初始设置。</p>
<p>一个实际用例：设置一个较高的阈值，并在超过该阈值时发送分析事件：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@TraceRecomposition(tag = <span class="hljs-string">"checkout"</span>, threshold = 10)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">CheckoutScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// If this recomposes 10+ times, something is wrong</span>
}
</code></pre>
<p>然后在你的自定义日志记录器（参见下一节）中，你可以在超过阈值时发送 Firebase 事件，从而监控生产环境中的性能问题。</p>
<h3 data-id="heading-15">配置日志系统</h3>
<p>默认情况下，<code>@TraceRecomposition</code> 不会记录任何日志，你需要在 <code>Application</code> 类中启用日志记录：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()

        <span class="hljs-comment">// Enable only in debug builds</span>
        ComposeStabilityAnalyzer.setEnabled(BuildConfig.DEBUG)
    }
}
</code></pre>
<p>这一点非常重要，如果你没有自定义日志记录器，<strong>务必使用</strong> <code>**BuildConfig.DEBUG**</code> 包裹，以避免生产构建中潜在的安全问题。</p>
<p><strong>自定义日志记录器：Logcat 之外的选择</strong> 默认日志记录器使用 Logcat，但你可以提供自定义实现，将日志发送到你想要的任何位置：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">ComposeStabilityAnalyzer.setLogger(<span class="hljs-keyword">object</span> : RecompositionLogger {  
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(event: <span class="hljs-type">RecompositionEvent</span>)</span></span> {  
        <span class="hljs-comment">// Send to Firebase, Crashlytics, custom analytics, etc.  </span>
        <span class="hljs-keyword">if</span> (event.recompositionCount &gt;= <span class="hljs-number">10</span>) {  
            FirebaseAnalytics.getInstance(<span class="hljs-keyword">this</span>).logEvent(<span class="hljs-string">"excessive\_recomposition"</span>) {  
                param(<span class="hljs-string">"composable"</span>, event.composableName)  
                param(<span class="hljs-string">"count"</span>, event.recompositionCount)  
                param(<span class="hljs-string">"unstable\_params"</span>, event.unstableParameters.joinToString())  
            }  
        }  
    }  
})
</code></pre>
<p>因此，你甚至可以根据调试模式或发布模式设置不同的日志记录器。<code>RecompositionEvent</code> 包含：</p>
<ul>
<li>
<p><code>composableName</code>：函数名称。</p>
</li>
<li>
<p><code>tag</code>：来自 <code>@TraceRecomposition</code> 的标签。</p>
</li>
<li>
<p><code>recompositionCount</code>：重新组合的次数。</p>
</li>
<li>
<p><code>parameterChanges</code>：包含稳定性信息的参数变更列表。</p>
</li>
<li>
<p><code>unstableParameters</code>：不稳定参数名称列表。</p>
</li>
</ul>
<p>这支持强大的监控模式。你可以：</p>
<ul>
<li>
<p>针对过度重组的组合对象发送分析事件</p>
</li>
<li>
<p>在生产环境中跟踪性能指标（并采取适当的隐私保护措施）</p>
</li>
<li>
<p>构建显示重组模式的自定义仪表板</p>
</li>
<li>
<p>在测试环境中出现性能下降时发出警报</p>
</li>
</ul>
<p>以下是一个使用标签过滤日志内容的更贴近实际的示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> tagsToLog = setOf(<span class="hljs-string">"checkout"</span>, <span class="hljs-string">"product-list"</span>, <span class="hljs-string">"search"</span>)
ComposeStabilityAnalyzer.setLogger(<span class="hljs-keyword">object</span> : RecompositionLogger {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(event: <span class="hljs-type">RecompositionEvent</span>)</span></span> {
        <span class="hljs-keyword">if</span> (BuildConfig.DEBUG) {
            <span class="hljs-comment">// In debug, log everything</span>
            Log.d(<span class="hljs-string">"Recomposition"</span>, formatEvent(event))
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// In release, only log tagged composables that exceed threshold</span>
            <span class="hljs-keyword">if</span> (event.tag <span class="hljs-keyword">in</span> tagsToLog &amp;&amp; event.recompositionCount &gt;= <span class="hljs-number">5</span>) {
                <span class="hljs-comment">// Send to analytics</span>
                FirebaseAnalytics.getInstance(<span class="hljs-keyword">this</span>).logEvent(<span class="hljs-string">"recomposition_issue"</span>, ...)
            }
        }
    }
})
</code></pre>
<h3 data-id="heading-16">理解日志</h3>
<p>让我们一起来了解如何解读日志。请看以下示例：</p>
<pre><code class="hljs language-bash" lang="bash">D/Recomposition: \[Recomposition <span class="hljs-comment">#1\] UserCard  </span>
D/Recomposition:   ├─ user: User stable (User@abc123)  
D/Recomposition:   └─ onClick: () \-\&gt; Unit stable (Function@xyz789)
</code></pre>
<p><strong>这意味着：</strong></p>
<ul>
<li>
<p>这是此 <code>UserCard</code> 实例的首次重组。</p>
</li>
<li>
<p>两个参数都稳定。</p>
</li>
<li>
<p>这是初始重组的预期行为。</p>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">D/Recomposition: \[Recomposition <span class="hljs-comment">#2\] UserCard  </span>
D/Recomposition:   ├─ user: User changed (User@abc123 → User@def456)  
D/Recomposition:   └─ onClick: () \-\&gt; Unit stable (Function@xyz789)
</code></pre>
<p><strong>这意味着：</strong></p>
<ul>
<li>
<p>第二次重组。</p>
</li>
<li>
<p><code>user</code> 参数已更改（新实例）。</p>
</li>
<li>
<p><code>onClick</code> 保持不变（相同的 lambda 实例）。</p>
</li>
<li>
<p>这是正常现象，参数已更改，因此需要进行重组。</p>
</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">D/Recomposition: \[Recomposition <span class="hljs-comment">#3\] UserCard (tag: user-profile)  </span>
D/Recomposition:   ├─ user: MutableUser unstable (MutableUser@xyz789)  
D/Recomposition:   └─ Unstable parameters: \[user\]
</code></pre>
<p><strong>这意味着：</strong></p>
<ul>
<li>
<p>第三次重组。</p>
</li>
<li>
<p><code>user</code> 参数<strong>不稳定</strong>（可能具有 <code>var</code> 属性）。</p>
</li>
<li>
<p>即使 <code>user</code> 没有更改，此可组合对象也会在每次父级重组时重新组合。</p>
</li>
<li>
<p><strong>需要采取的措施</strong>：将 <code>MutableUser</code> 类修复为不可变。</p>
</li>
</ul>
<h2 data-id="heading-17">稳定性验证：防止 CI 中的性能退化</h2>
<p>Compose 稳定性分析器最强大的功能并非可视化反馈或运行时跟踪，而是<strong>防止稳定性退化影响生产环境</strong>。稳定性验证系统的作用类似于 git diff，用于检查可组合组件的稳定性，如果稳定性下降，则 CI 构建失败。</p>
<h3 data-id="heading-18">问题：静默的性能退化</h3>
<p>想象一下这样的场景：你花了数周时间优化你的应用。每个可组合组件都稳定、可跳过且运行速度快。然后，一位同事无意中修改了一个数据类：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Before (stable)</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)

<span class="hljs-comment">// After (unstable)</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">var</span> name: String, <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span>)
</code></pre>
<p>这一简单的更改会波及整个 UI 树。数十个原本可跳过的可组合组件变得不可跳过。性能退化了，但代码审查却未能发现，也没有任何明显的迹象表明出了问题。</p>
<p>稳定性验证可以防止这种情况发生。它会跟踪你的可组合组件的稳定性随时间的变化，并在稳定性下降时自动构建失败，强制在合并之前解决问题。</p>
<h3 data-id="heading-19">工作原理：稳定性快照</h3>
<p>验证系统通过两个 Gradle 任务运行：</p>
<ul>
<li>
<p><code>**stabilityDump**</code>：创建一个包含所有可组合组件稳定性状态的 <code>.stability</code> 文件。</p>
</li>
<li>
<p><code>**stabilityCheck**</code>：将当前代码与基线进行比较，如果稳定性下降则构建失败。</p>
</li>
</ul>
<p>可以这样理解：</p>
<ul>
<li>
<p><code>stabilityDump</code> = "保存当前状态"</p>
</li>
<li>
<p><code>stabilityCheck</code> = "自上次保存以来是否有任何更改？"</p>
</li>
</ul>
<h3 data-id="heading-20">步骤 1：创建基线</h3>
<p>编译项目后，运行：</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew :app:compileDebugKotlin  
./gradlew :app:stabilityDump
</code></pre>
<p>这将生成 <code>app/stability/app.stability</code> 文件：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>  
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> com.example.<span class="hljs-title">UserCard</span><span class="hljs-params">(user: <span class="hljs-type">com</span>.<span class="hljs-type">example</span>.<span class="hljs-type">User</span>)</span></span>: kotlin.<span class="hljs-built_in">Unit</span>  
  skippable: <span class="hljs-literal">true</span>  
  restartable: <span class="hljs-literal">true</span>  
  params:  
    - user: STABLE (immutable <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span>)  
  
<span class="hljs-meta">@Composable</span>  
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> com.example.<span class="hljs-title">ProductList</span><span class="hljs-params">(items: <span class="hljs-type">kotlin</span>.<span class="hljs-type">collections</span>.<span class="hljs-type">List</span>&lt;<span class="hljs-type">com</span>.<span class="hljs-type">example</span>.<span class="hljs-type">Product</span>\&gt;)</span></span>: kotlin.<span class="hljs-built_in">Unit</span>  
  skippable: <span class="hljs-literal">true</span>  
  restartable: <span class="hljs-literal">true</span>  
  params:  
    - items: STABLE (immutable collection with stable elements)
</code></pre>
<p>此文件易于阅读，并准确显示了编译器对每个可组合组件的判断结果。它是应用程序稳定性状态的完整快照。</p>
<p><strong>将此文件提交到 Git：</strong></p>
<pre><code class="hljs language-bash" lang="bash">git add app/stability/app.stability  
git commit \-m <span class="hljs-string">"Add stability baseline"</span>  
git push
</code></pre>
<p>现在，团队中的每个人都拥有相同的基线。</p>
<h3 data-id="heading-21">步骤 2：检查回归问题</h3>
<p>在你的 CI 流水线中运行：</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew :app:compileDebugKotlin  
./gradlew :app:stabilityCheck
</code></pre>
<p>如果没有任何变化，任务成功：</p>
<pre><code class="hljs language-bash" lang="bash">✅ Stability check passed.
</code></pre>
<p>如果稳定性出现回归，任务失败：</p>
<pre><code class="hljs language-bash" lang="bash">❌ Stability check failed!  
  
The following composables have changed stability:  
  
~ com.example.UserCard(user): parameter <span class="hljs-string">'user'</span> changed from STABLE to UNSTABLE  
  
If these changes are intentional, run <span class="hljs-string">'./gradlew stabilityDump'</span> to update the baseline.
</code></pre>
<p>构建失败，在问题修复或明确接受回归之前，拉取请求将无法合并。</p>
<h3 data-id="heading-22">检测到的变更类型</h3>
<p>验证器会检测到四种类型的变更：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/927b2ecbe032460daf36304b59dd3f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=dwzlNSYC09up9QTlsC021q4pqNw%3D" alt="9" loading="lazy"/></p>
<p>这种全面的跟踪机制确保<strong>任何</strong>稳定性变更都清晰可见，并需要进行相应的决策。</p>
<h3 data-id="heading-23">CI/CD 集成</h3>
<p>将稳定性验证添加到你的 GitHub Actions 工作流：</p>
<pre><code class="hljs language-bash" lang="bash">name: Android CI  
  
on: \[push, pull\_request\]  
<span class="hljs-built_in">jobs</span>:  
  build:  
    runs-on: ubuntu-latest  
    steps:  
      \- uses: actions/checkout@v3  
      \- name: Set up JDK 17  
        uses: actions/setup-java@v3  
        with:  
          java-version: <span class="hljs-string">'17'</span>  
          distribution: <span class="hljs-string">'temurin'</span>  
      \- name: Build project  
        run: ./gradlew :app:compileDebugKotlin  
  stability\_check:  
    name: Compose Stability Check  
    runs-on: ubuntu-latest  
    needs: build  
    steps:  
      \- name: Check out code  
        uses: actions/checkout@v5.0.0  
      \- name: Set up JDK  
        uses: actions/setup-java@v5.0.0  
        with:  
          distribution: <span class="hljs-string">'zulu'</span>  
          java-version: 21  
      \- name: Run stability check  
        run: ./gradlew stabilityCheck
</code></pre>
<p>现在，每个拉取请求都会自动进行检查。如果稳定性下降，则拉取请求将无法合并。</p>
<h3 data-id="heading-24">配置选项</h3>
<p>你可以自定义要跟踪的内容：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// In your build.gradle.kts</span>
composeStabilityAnalyzer {
    stabilityValidation {
        enabled.<span class="hljs-keyword">set</span>(<span class="hljs-literal">true</span>)
        outputDir.<span class="hljs-keyword">set</span>(layout.projectDirectory.dir(<span class="hljs-string">"stability"</span>))
        includeTests.<span class="hljs-keyword">set</span>(<span class="hljs-literal">false</span>) <span class="hljs-comment">// Exclude test code</span>

        <span class="hljs-comment">// Ignore specific packages</span>
        ignoredPackages.<span class="hljs-keyword">set</span>(listOf(<span class="hljs-string">"com.example.internal"</span>))
        <span class="hljs-comment">// Ignore specific classes (e.g., previews)</span>
        ignoredClasses.<span class="hljs-keyword">set</span>(listOf(<span class="hljs-string">"PreviewComposables"</span>))
        <span class="hljs-comment">// Ignore entire modules</span>
        ignoredProjects.<span class="hljs-keyword">set</span>(listOf(<span class="hljs-string">"benchmarks"</span>, <span class="hljs-string">"examples"</span>))
    }
}
</code></pre>
<p>这对于排除不需要稳定性跟踪的代码非常有用，例如预览组合或调试屏幕。</p>
<h3 data-id="heading-25">排除特定组合</h3>
<p>使用 <code>@IgnoreStabilityReport</code> 从验证中排除单个组合：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@IgnoreStabilityReport</span>
<span class="hljs-meta">@Preview</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserCardPreview</span><span class="hljs-params">()</span></span> {
    UserCard(user = User(<span class="hljs-string">"John"</span>, <span class="hljs-number">30</span>))
}
</code></pre>
<p>预览组合不会出现在生产版本中，因此它们的稳定性无关紧要。排除它们可以减少稳定性报告中的噪音。</p>
<h3 data-id="heading-26">多模块项目</h3>
<p>对于包含多个模块的项目，每个模块都会有自己的 <code>.stability</code> 文件：</p>
<pre><code class="hljs language-bash" lang="bash">project/  
├── app/stability/app.stability  
├── feature-auth/stability/feature-auth.stability  
└── feature-profile/stability/feature-profile.stability
</code></pre>
<p>在根目录运行 <code>stabilityCheck</code> 来检查所有模块：</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew stabilityCheck
</code></pre>
<p>或者检查单个模块：</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew :feature-auth:stabilityCheck
</code></pre>
<h3 data-id="heading-27">接受有意为之的回归</h3>
<p>有时稳定性回归是有意为之的，例如你正在重构代码并暂时接受较低的稳定性。在这种情况下，请更新基线：</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew :app:stabilityDump  
git add app/stability/app.stability  
git commit -m <span class="hljs-string">"Accept stability regression for UserCard (refactoring in progress)"</span>  
git push
</code></pre>
<p>这会在 Git 历史记录中创建一个<strong>已记录的决策</strong>。回归不再是默默进行的，而是明确且可跟踪的。</p>
<h2 data-id="heading-28">性能考量和最佳实践</h2>
<p>虽然这些工具功能强大，但仍有一些性能特性和最佳实践需要注意。有人问我是否需要让_每个_类型都稳定，答案绝对是“不需要”。</p>
<p>由于现在有了强跳过模式，每个可组合函数都可以跳过，这本身就能优化稳定性。即使这个插件可能会提示“不稳定”或“运行时稳定性”，但你实际上并不需要为每个可组合函数都进行修复。我们来看一个简单的例子。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d267a7319ba34057ad748a0d7660ec3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=%2F1rYFoBMEDbbrUwxps3W5wmgN1I%3D" alt="10" loading="lazy"/></p>
<p>如果你查看 compose-material3 库中的 <code>Icon</code> 可组合函数，这个插件会提示它不稳定，因为它包含运行时参数。但是，<code>painter</code> 参数通常是通过 <code>painterResource</code> 函数初始化的，如下所示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> painter = painterResource(R.drawable.)
Icon(painter = painter, contentDescription = <span class="hljs-literal">null</span>)
</code></pre>
<p>如果你查看 <code>painterResource</code> 的内部逻辑，你会发现它本质上是稳定的。它内部使用 <code>remember</code> 将值缓存到内存中，所以你可以把它看作是一个小小的权衡：<em>“我会用一点内存来存储这个不稳定的实例，这样我就不必触发不必要的重新组合。”</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90164e1a3f6a4e038143ee9b9ee54212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769786135&amp;x-signature=l1JhfePesyf3BR%2BJL8QITjY6yts%3D" alt="11" loading="lazy"/></p>
<p>关于不可变集合还有一个常见的误解——认为仅仅使用 <code>ImmutableList</code> 而不是普通的 <code>List</code> 就能提升性能。 <strong>并非总是如此。</strong></p>
<p>不妨这样想：如果你有一个包含 1000 个大型对象的列表，然后你将其转换为不可变列表，那么你的可组合组件就变得可以忽略了。但是，每次重新组合时，Compose 都会对列表中的每个元素运行 <code>equals()</code> 函数，以检查新实例是否与之前的实例匹配。在某些情况下，这实际上会比重新渲染一个只显示其中五个元素的轻量级 UI 更<strong>影响性能</strong>。</p>
<p>因此，<strong>稳定性会根据具体情况产生截然不同的影响</strong>，试图让整个 UI 保持稳定通常是不必要的，也是徒劳的。我希望这个插件不会加重你对稳定性的担忧，而是能够帮助你更有效地调试实际的性能问题，并做出更明智、更数据驱动的决策，而无需过度考虑稳定性。</p>
<h2 data-id="heading-29">结论</h2>
<p>在本文中，我们探索了 Compose 稳定性分析器 (Compose Stability Analyzer) (<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fskydoves%2Fcompose-stability-analyzer)%25EF%25BC%258C%25E4%25BA%2586%25E8%25A7%25A3%25E4%25BA%2586%25E5%25AE%2583%25E5%25A6%2582%25E4%25BD%2595%25E9%2580%259A%25E8%25BF%2587%25E4%25B8%2589%25E4%25B8%25AA%25E4%25BA%2592%25E8%25A1%25A5%25E7%259A%2584%25E5%25B7%25A5%25E5%2585%25B7%25E5%25B0%2586" target="_blank" title="https://github.com/skydoves/compose-stability-analyzer)%EF%BC%8C%E4%BA%86%E8%A7%A3%E4%BA%86%E5%AE%83%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E4%B8%89%E4%B8%AA%E4%BA%92%E8%A1%A5%E7%9A%84%E5%B7%A5%E5%85%B7%E5%B0%86" ref="nofollow noopener noreferrer">github.com/skydoves/co…</a> Compose 隐藏的稳定性分析可视化：IntelliJ 插件用于在开发过程中提供可视化反馈，Gradle 插件用于运行时重组追踪，以及稳定性验证系统用于防止持续集成 (CI) 中的回归。</p>
<p>IntelliJ 插件将稳定性从一个不可见的编译时概念转化为可感知的事物，通过边栏图标、工具提示和内联提示，使稳定性问题一目了然。<code>@TraceRecomposition</code> 注解弥合了编译时分析和运行时行为之间的鸿沟，让你可以准确地了解可组合组件何时以及为何重新组合。稳定性验证系统则起到安全网的作用，确保你精心设计的优化不会随着代码库的演进而悄然失效。</p>
<p>这些工具共同作用，使稳定性分析成为你开发工作流程中自然而然的一部分。你无需等待性能问题显现，即可在编码过程中立即发现它们。你无需猜测哪个参数导致了重新组合——日志会准确地告诉你哪些参数发生了变化。你也无需手动审查每个 PR 是否存在稳定性回归，CI 流水线会自动完成这项工作。</p>
<p>理解稳定性是编写高性能 Compose 应用程序的基础。借助 Compose 稳定性分析器，这种理解变得轻松、直观、即时且有效。</p>
<p>祝你编码愉快！</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里云+Qoder一键生成个人主页，面试率翻倍坐等offer]]></title>    <link>https://juejin.cn/post/7598374376094400539</link>    <guid>https://juejin.cn/post/7598374376094400539</guid>    <pubDate>2026-01-23T15:32:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598374376094400539" data-draft-id="7598390244380409894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里云+Qoder一键生成个人主页，面试率翻倍坐等offer"/> <meta itemprop="keywords" content="人工智能,前端"/> <meta itemprop="datePublished" content="2026-01-23T15:32:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿星AI工作室"/> <meta itemprop="url" content="https://juejin.cn/user/2250051536050763"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里云+Qoder一键生成个人主页，面试率翻倍坐等offer
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2250051536050763/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿星AI工作室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T15:32:03.000Z" title="Fri Jan 23 2026 15:32:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd0bfcfc70da48419e484fd93091e08e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=T4SD%2F8Z3O0df53KiYXi6ublx3gk%3D" alt="图片" loading="lazy"/></p>
<p>哈喽大家好</p>
<p>我是阿星</p>
<p>转眼春节过后，春招季又将到来。无论是应届毕业生还是职场人，都可以着手打造个人主页啦！</p>
<p>如果你是面试官/甲方，你会选被下面哪个简历第一时间吸引呢？</p>
<p> </p>
<p>普通简历👇</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30aeed7a0a5545fb882499f41b6f451a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=beEqH7XMyXl7NrUcM4lW6oPVWxg%3D" alt="图片" loading="lazy"/></p>
<p>AI个人主页长这样👇</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e0f4e1e7e3f4ad5a9a8cebf714b9a84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=sKPcJv6OMapl68Z07YNleO7Yo1s%3D" alt="图片" loading="lazy"/></p>
<p>阿星今天就跟大家介绍用AI制作个人主页的方法，很简单跟着我做即可！</p>
<p>「阿里云ECS+Qoder在线部署」，直接部署到公网。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abaae559061b4243b4fdbc5f5d357f1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=QK0oFEhoY8CGvvzMFb54f0L4W6w%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a021df48afc41c98d060a80dbbf64db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=H5NRE6z9bJw6eorKxCPnkWIHjXw%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16774363c77345d488217dd1f0ff3866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=%2B5BXrZFlszxOOoYr4q5TTqNqvNI%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-0">第一步：选择阿里云服务器</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bffb9da5d68a489f874e7f17145d7836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=pRhKnG3AsWUTJ9X4%2BMHjzMm2%2FiI%3D" alt="图片" loading="lazy"/></p>
<p>选择右边的建站首选👆</p>
<p>看到绿色的已部署后就可以进入服务器控制台了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34493db34d6429d866b98569b5aa770~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=vEPr66RIbRPCEuRSMxmhl5De4pE%3D" alt="图片" loading="lazy"/></p>
<p>点击右边的远程连接，然后点立即登录。继续——</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d6593780010472da6cd1ffd26ed512a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=8mdtZu6x9tA%2BvSmZZKj6IvFjXWU%3D" alt="图片" loading="lazy"/></p>
<p>就可以ssh访问了，相当于你在网页端打开了自己的服务器。</p>
<p>它不会保存你还没输入完的代码。你这个网页关掉了前端也会关掉。</p>
<p><strong>下文会讲怎么避免这种情况。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/270c3c232eae4da8a9754437029f441e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=1Zv02nHrgmL9em6VCwZvHDPe3lU%3D" alt="图片" loading="lazy"/></p>
<p>你的界面会如下显示，你只用输入#后面的代码，不要把#加进去。</p>
<p><strong>每次只用输入一行，不要一次性全都复制进去。</strong></p>
<p>注意，输入代码的时候不要轻易刷新这个页面，他不会保存你正在输入的代码。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">sudo su</span>
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">cd</span> /root</span>
<span class="hljs-meta prompt_"># </span><span class="bash">qodercli --yolo --model=auto</span>
</code></pre>
<h2 data-id="heading-1">启动qoder</h2>
<p>接下来我们需要在网页端登录浏览器，具体代码如下。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 登录</span>
qodercli /login

<span class="hljs-comment"># 2. 进入你要改的项目（把 portfolio 换成你查到的项目名）</span>
<span class="hljs-built_in">cd</span> /root/portfolio

<span class="hljs-comment"># 3. 启动</span>
告诉qoder启动项目
</code></pre>
<p>注意这里可能会有报错，比如没积分了、其他错误。</p>
<p>阿星的方法是一概重登。</p>
<p>直接问AI让它给你改成登出的指令就行了。</p>
<p>基本就ok了。这里默认你是qoder的新用户。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b79d0caece8a48b1b1adaddb368b938d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=wszVaa4i5IGT%2FLBQSkT5m4w5fcg%3D" alt="图片" loading="lazy"/></p>
<p>然后就会蹦出来一个入口，</p>
<p>我们直接双击就会出现一个login页面，</p>
<p>无脑确认后回来就会提示你已经成功登录了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5929630134714277a1aec19d509ce3fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=7Pocti4VlhPKhYX04gYVouo0qN0%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">制作网页</h2>
<p>接下来我们把提示词直接在上面窗口里发给AI。</p>
<pre><code class="hljs language-less" lang="less">我是一名即将毕业的计算机科学专业应届生，正在寻求软件开发工程师(后端/全栈方向)的职位。请为我创建一个专业、技术感强的个人主页，作为我的'云端名片’。

重要环境说明：当前运行环境为阿里云<span class="hljs-selector-tag">ECS</span>服务器，生成<span class="hljs-selector-tag">HTML</span>文件后需要启动<span class="hljs-selector-tag">Web</span>服务对外提供访问。请务必输出包含<span class="hljs-selector-tag">ECS</span>公网<span class="hljs-selector-tag">IP</span>地址和端口号的完整远程访问地址（格式如：<span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//公网IP:端口），而不是localhost地址。我的公网IP地址是xxx。（替换成你自己服务器的公网地址即可）</span>

核心模块包括：
醒目导航栏：链接到“关于我”、“项目经历”、“技术栈”、“联系方式”。
项目展示区：以卡片式或列表形式清晰展示我的<span class="hljs-number">3</span><span class="hljs-selector-tag">-5</span>个核心项目（学校项目、实习项目、个人项目）。每个项目需要包含：项目名称、简短描述、使用的关键技术栈、项目链接（<span class="hljs-selector-tag">GitHub</span>/<span class="hljs-selector-tag">Demo</span>）、项目难点与解决方案（可选）。

技能树/技术栈模块：
直观地列出我熟练掌握的编程语言、框架、数据库、工具等，可以用进度条或标签云展示熟练度。

“关于我”简介：
简短的个人陈述，突出技术热情、学习能力和解决问题能力。旁边需要放置一张专业形象照。

**联系方式区域：
**显著位置放置邮箱、领英链接、<span class="hljs-selector-tag">GitHub</span>链接。最好能有一个简单的联系表单。

设计风格：
现代、简洁、代码感（可以使用深色模式或科技蓝等色调），布局清晰易读，重点突出项目和技术能力。

额外需求：
支持<span class="hljs-selector-tag">Markdown</span>格式编写项目描述；能嵌入<span class="hljs-selector-tag">GitHub</span>贡献图；确保移动端浏览体验良好。<span class="hljs-selector-tag">SEO</span>基础优化。
</code></pre>
<p>其中，个人信息部分👆也可以通过让AI帮你整理成markdown格式。</p>
<p>这样你呈现自己信息的时候也可以更精准。</p>
<p>主要还是因为markdown这种语法，让我们对于层级的把握更加清楚，现在也有一些说法说和跟AI对话的时候不用长篇大论，但是像简历这种指定内容最好还是提前整理。</p>
<p><strong>把下面整理好的个人信息挂在上面的提示词末尾即可。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9d11012295a4fc0a9796d149ee50942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=RahtUj1arfvF4MJngMVYSt4ifFw%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-3">如何优化页面颜值</h2>
<p>第一版它就会出来这样一个页面</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f14f90b7e5f648b0bca7b9cb07ccc84a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=zHHAgqkylR%2B3EYnknfihxV%2BpDzQ%3D" alt="图片" loading="lazy"/></p>
<p>那么，如何优化页面颜值？</p>
<p>阿星常用的颜值提升网站是21dev，里面的有好多预制菜。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7997fb395b2548a98bd4fbe35da19368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=8grjdXjcIcEAynPGAFfgqJ0qvMk%3D" alt="图片" loading="lazy"/></p>
<p>重点是每个模版点开后你应该看的不是提示词而是view code，点开之后把代码复制下来。就能衔接下下面的提示词。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1cb441b88574a86bdca7ea75e85e935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=AKNziGG3v8ctsStI6bxVix3Tjo0%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c36f360f19a546298b2fc15882342bca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=0odjwZqLNo3tInNcp2g2Sng%2Fq7E%3D" alt="图片" loading="lazy"/></p>
<p>在你的简历提示词下面加上这几句话，这几句话其实很有必要背会。</p>
<pre><code class="hljs language-markdown" lang="markdown">视觉上，参考<span class="hljs-code">`demo.tsx`</span>和<span class="hljs-code">`xxx.tsx`</span>的代码，确保： 
<span class="hljs-bullet">1.</span> 分析组件结构并识别所有必需的依赖。  
<span class="hljs-bullet">2.</span> 查看组件的参数和状态。  
<span class="hljs-bullet">3.</span> 识别任何必需的上下文提供者或挂钩，并安装它们。 
<span class="hljs-bullet">4.</span> 如果组件需要，使用 lucide-react 图标作为 SVG 或徽标。 
<span class="hljs-bullet">5.</span> 其他区块的视觉与 Hero 部分适配。
</code></pre>
<p>优化后的效果大概长这样👇🏻</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fd25ad868ea4e9584964e9656d0d524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=WHX9cujLDexh3LuoACRz1a%2BzmBY%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-4">页面不显示怎么办</h2>
<p>阿里云 ECS 默认会开放 22 (SSH) 和 80 (HTTP) 端口。你启动的 <strong>8080</strong> 端口被阿里云的“安全组”挡住了。</p>
<p><strong>解决办法</strong> ：</p>
<ol>
<li>
<ol>
<li>登录 <strong>阿里云控制台</strong> 。</li>
</ol>
</li>
<li>
<ol start="2">
<li>找到你的 <strong>ECS 实例</strong> -&gt; <strong>安全组</strong> -&gt; <strong>配置规则</strong> 。</li>
</ol>
</li>
<li>
<ol start="3">
<li>添加一条“入方向”规则： <strong>协议 TCP，端口 8080，授权对象 0.0.0.0/0</strong> 。</li>
</ol>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14e47c8e2a754c86a372958cea1460af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=hirKLSlYCfrqep4iokk%2BDzDcNiI%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/679d367107994522b4022fbde9881894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=pWk92%2BN6dJ4pV9bDe54eUpB7e74%3D" alt="图片" loading="lazy"/></p>
<ol>
<li>
<ol start="4">
<li>如果还不行就：</li>
</ol>
</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino"># 停止防火墙服务（CentOS 常用）
systemctl stop firewalld
</code></pre>
<ol>
<li>5.  如果还不行就：</li>
</ol>
<p>如果还不行就：</p>
<pre><code class="hljs language-r" lang="r"><span class="hljs-comment"># 或者清空所有的临时拦截规则</span>
iptables <span class="hljs-operator">-</span><span class="hljs-built_in">F</span>
</code></pre>
<p>阿星自己是到这一步才有效的</p>
<h2 data-id="heading-5">如何复用这些代码</h2>
<p>不管是把服务器的代码 <strong>推送到 GitHub</strong> ，还是从服务器 <strong>拉取到你现在的电脑（本地）</strong>  ，最简单的步骤如下：</p>
<ol>
<li>
<ol>
<li/>
</ol>
<h4 data-id="heading-6">推送到 GitHub（同步到云端仓库）</h4>
</li>
</ol>
<p><strong>前提：</strong>  你必须先在 GitHub 网页上点击  <strong>"New repository"</strong>  创建一个名字叫 <code>portfolio</code> 的空项目，并复制它的 HTTPS 地址。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05a2eb2afd38455c9b52081f13605b5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=iRONLG1zAVUc2gVnYJiL5M14P0Q%3D" alt="图片" loading="lazy"/></p>
<p>在服务器终端执行：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 进入项目文件夹cd /root/portfolio</span>

<span class="hljs-meta"># 初始化并关联（仅第一次需要）</span>
git <span class="hljs-keyword">init</span>
git remote <span class="hljs-keyword">add</span> origin https:<span class="hljs-comment">//github.com/你的用户名/portfolio.git</span>

<span class="hljs-meta"># 提交并推送到 GitHub</span>
git <span class="hljs-keyword">add</span> .
git commit -m <span class="hljs-string">"update"</span>
git push -u origin main
</code></pre>
<p>但是你阿里云服务器是新的，需要 <strong>把服务器的</strong> “钥匙（SSH Key）”给 GitHub 备案。</p>
<p>SSH Key的作用： 在不安全的网络中（比如互联网），为两台电脑建立一个“加密隧道”，保证你们传的数据（密码、代码）不会被别人偷听。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f455690d0494159a33270cf45ec685c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=tnLPkyLHMpY7ym3vOiw4n5u5Plw%3D" alt="图片" loading="lazy"/></p>
<p>但是你的阿里云很可能打印失败</p>
<p>这个时候需要你跟阿里云服务器说一下：</p>
<pre><code class="hljs language-javascript" lang="javascript">“请直接在对话框里打印出 ~<span class="hljs-regexp">/.ssh/i</span>d_rsa.<span class="hljs-property">pub</span> 的文件内容，不要运行失败。”
</code></pre>
<hr/>
<ol>
<li>
<ol start="2">
<li/>
</ol>
<h4 data-id="heading-7">拉取到本地用vscode远程编辑（下载到你现在的电脑）</h4>
</li>
</ol>
<p>如果你想把服务器上的代码直接下载到你面前这台电脑的桌面上，</p>
<p><strong>不需要经过 GitHub</strong> ，直接在你 <strong>本地电脑</strong> 的终端（Mac 的 Terminal 或 Windows 的 PowerShell）执行：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 命令格式：scp -r 用户名@服务器IP:服务器路径 本地路径</span>
scp -r root<span class="hljs-variable">@39</span>.<span class="hljs-number">106.90</span>.<span class="hljs-number">140</span><span class="hljs-symbol">:/root/portfolio</span> ~<span class="hljs-regexp">/Desktop/</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f88ef18e0b274a7eb0e8eb40d3f333c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=0kprS1PsYfG%2FAV1XJjDbcWt%2BtAM%3D" alt="图片" loading="lazy"/></p>
<p>不过这种在正式开发的时候不严谨 ，但是咱们自己用没问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1c11b2e4c134dc3a88e0af3ebac2a76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=yS0%2BPMV37xiR9ZDc0RS7mKTax7Y%3D" alt="图片" loading="lazy"/></p>
<p>需要说明的是</p>
<p>现在是为了演示方便直接开了安全组</p>
<p>但在企业实战中</p>
<p>有的企业通常会配合 <strong>堡垒机</strong> 来做更高级的安全审计</p>
<p>所以大家自己用用就行了</p>
<h2 data-id="heading-8">如何让页面保持前端一直在线</h2>
<p>最后，我们回到开头说的，如何让网页一直在前端不掉线。</p>
<p>我推荐大家用宝塔面板，会省事很多。</p>
<p>但是我们此次实践是基于阿里云ssh远程连接，</p>
<p>所以我又专门摸索了一下在网页端行不行——</p>
<p>这里就需要学习一个让我们的网页不掉线的东东。</p>
<p><strong>Nginx！我们全靠它进行托管，否则没它盯着你的页面就看不到了。为什么会需要nginx盯着？</strong></p>
<p>因为互联网的访问是 <strong>随机且瞬间</strong> 的。为了保证世界上任何一个人在任何时间点点开你的链接都能看到网页，这个发货员必须 24 小时保持“盯着”状态，随时准备把文件发出去。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47caf94d43d64c229c4c74e8a20b4765~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=hSBqordLh77j8lcFuVl8ZR2k%2FGA%3D" alt="图片" loading="lazy"/></p>
<p>整体上看他们就像是一家711商店， <strong>Nginx</strong> 和服务器之间的关系如下，</p>
<p><strong>店员 (Nginx)：</strong>  24小时值班，负责拿货。</p>
<p><strong>进货 (开发者)：</strong>  你写的代码就是货架上的商品。</p>
<p><strong>店主 (阿里云)：</strong>  提供店铺门面、电力和货架空间。</p>
<p><strong>唯一标识 (域名/端口)：</strong>  * <strong>门牌号 (域名)：</strong>  比如 <code>a.com</code> 去找 A 货架，<code>b.com</code> 去找 B 货架。</p>
<p><strong>后门 (端口)：</strong>  如果没有域名，就靠端口号区分。比如 <code>80</code> 端口看简历，<code>8080</code> 端口看博客。</p>
<p>这就是为什么你每次打开百度都能看到百度，不会看不到百度。</p>
<p>如果你关掉页面（关闭终端），网页依然在。但如果你 <strong>sha掉了 Nginx 进程</strong> ，那个“雷达”就关机了，发货员就消失了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00af9cf9cf854187bcc1713b826bca5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=qNCnvafz2TCUaqvXi%2FTzpPGe%2Buw%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-9">1. 清理环境 (腾出 80 端口)</h4>
<p>如果服务器预装了 Apache，必须先彻底停用，否则 Nginx 无法启动。</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash">systemctl stop httpd       <span class="hljs-comment"># 立即停止 Apache</span>
systemctl <span class="hljs-built_in">disable</span> httpd    <span class="hljs-comment"># 禁止 Apache 开机自启</span>
</code></pre>
<h4 data-id="heading-10">2. 安装与启动服务</h4>
<p>安装 Nginx 并将其设置为“永不宕机”模式。</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash">yum install nginx -y       <span class="hljs-comment"># 安装 Nginx</span>
systemctl start nginx      <span class="hljs-comment"># 启动服务</span>
systemctl <span class="hljs-built_in">enable</span> nginx     <span class="hljs-comment"># 关键：设置开机自动启动</span>
</code></pre>
<h4 data-id="heading-11">3. 资源部署 (放置货物)</h4>
<p>创建一个规范的目录，并将你的前端文件搬运进去。</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /var/www/html     <span class="hljs-comment"># 创建标准的网页存放目录# 在项目目录下执行：</span>
<span class="hljs-built_in">mv</span> index.html styles.css script.js lib/ /var/www/html/
</code></pre>
<h4 data-id="heading-12">4. 核心配置 (修改管家路径)</h4>
<p>这是最关键的一步，修改 Nginx 的“导航卡”，让它指向你的新目录。</p>
<ul>
<li>• <strong>动作：</strong> <code>vi /etc/nginx/nginx.conf</code></li>
<li>• <strong>修改点：</strong>  找到 <code>server</code> 块中的 <code>root</code> 这一行。</li>
<li>• <strong>修改前：</strong> <code>root /usr/share/nginx/html;</code></li>
<li>• <strong>修改后：</strong> <code>root /var/www/html;</code></li>
</ul>
<h4 data-id="heading-13">5. 验证与生效</h4>
<p>修改完配置后，必须执行以下命令，否则 Nginx 还是会按旧规矩办事。</p>
<p>Bash</p>
<pre><code class="hljs language-bash" lang="bash">nginx -t                   <span class="hljs-comment"># 检查配置文件是否有语法错误</span>
systemctl reload nginx     <span class="hljs-comment"># 不重启服务，仅重新加载配置（推荐）</span>
</code></pre>
<hr/>
<p>ok，快去试试吧～</p>
<p>我是阿星！</p>
<p>更多AI应用，我们下期再见！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ac267a86fe54065a9161f92d6a13511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5pifQUnlt6XkvZzlrqQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769787123&amp;x-signature=XkrMKWemj%2BDcn%2FK3Ryv15yWg0tU%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ollama 本地部署完整指南]]></title>    <link>https://juejin.cn/post/7598403436698894370</link>    <guid>https://juejin.cn/post/7598403436698894370</guid>    <pubDate>2026-01-23T15:43:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598403436698894370" data-draft-id="7598402961904599092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ollama 本地部署完整指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T15:43:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一诺滚雪球"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ollama 本地部署完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一诺滚雪球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T15:43:14.000Z" title="Fri Jan 23 2026 15:43:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 简介</h2>
<h3 data-id="heading-1">1.1 什么是 Ollama？</h3>
<p>Ollama 是一个开源的大模型运行工具，支持在本地运行 Llama 3、Qwen2.5、DeepSeek、Mistral 等上百款大语言模型。它通过命令行操作，简单高效，特别适合开发者快速部署和测试各类 AI 模型。</p>
<h3 data-id="heading-2">1.2 核心特性</h3>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td><strong>一键部署</strong></td><td>一行命令完成安装和模型启动</td></tr><tr><td><strong>API 兼容</strong></td><td>自带 OpenAI 格式 API，现有项目可直接迁移</td></tr><tr><td><strong>跨平台支持</strong></td><td>macOS、Linux、Windows 全平台覆盖</td></tr><tr><td><strong>模型丰富</strong></td><td>内置 Qwen2.5、DeepSeek-V3、Llama 3 等上百款模型</td></tr><tr><td><strong>安全可靠</strong></td><td>支持密钥认证，修复已知安全漏洞</td></tr></tbody></table>
<h3 data-id="heading-3">1.3 硬件要求</h3>



































<table><thead><tr><th>模型规模</th><th>显存要求</th><th>内存要求</th><th>推荐场景</th></tr></thead><tbody><tr><td>3B（轻量）</td><td>3GB+</td><td>8GB+</td><td>低配设备、快速测试</td></tr><tr><td>7B（推荐）</td><td>4-6GB</td><td>16GB+</td><td>日常开发、个人使用</td></tr><tr><td>13B（进阶）</td><td>10-12GB</td><td>32GB+</td><td>专业应用、团队协作</td></tr><tr><td>30B+（专业）</td><td>24GB+</td><td>64GB+</td><td>企业部署、复杂任务</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">2. 安装指南</h2>
<h3 data-id="heading-5">2.1 macOS 安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法一：一键安装脚本（推荐）</span>
curl -fsSL https://ollama.com/install.sh | sh

<span class="hljs-comment"># 方法二：使用 Homebrew</span>
brew install ollama

<span class="hljs-comment"># 验证安装</span>
ollama --version
</code></pre>
<h3 data-id="heading-6">2.2 Linux 安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一键安装脚本</span>
curl -fsSL https://ollama.com/install.sh | sh

<span class="hljs-comment"># 验证安装</span>
ollama --version
</code></pre>
<h3 data-id="heading-7">2.3 Windows 安装</h3>
<ol>
<li>访问官网下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fdownload" target="_blank" title="https://ollama.com/download" ref="nofollow noopener noreferrer">ollama.com/download</a></li>
<li>下载 <code>OllamaSetup.exe</code></li>
<li>运行安装程序，<strong>务必勾选「Add to PATH」</strong></li>
<li>打开 PowerShell 或 CMD，验证安装：</li>
</ol>
<pre><code class="hljs language-powershell" lang="powershell">ollama --version
</code></pre>
<h3 data-id="heading-8">2.4 验证安装成功</h3>
<p>安装完成后，运行以下命令验证：</p>
<pre><code class="hljs language-bash" lang="bash">ollama --version
<span class="hljs-comment"># 输出示例：ollama version is 0.12.0</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">3. 启动服务（重要）</h2>
<h3 data-id="heading-10">3.1 启动 Ollama 服务</h3>
<p>安装完成后，<strong>必须先启动 Ollama 服务</strong>才能下载模型或进行对话。</p>
<p><strong>方法一：启动服务（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash">ollama serve
</code></pre>
<p>保持这个终端窗口运行，然后<strong>新开一个终端窗口</strong>执行其他命令。</p>
<hr/>
<p><strong>方法二：后台运行（macOS/Linux）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 后台启动服务</span>
ollama serve &amp;

<span class="hljs-comment"># 然后直接执行其他命令</span>
ollama pull qwen2.5:7b
</code></pre>
<hr/>
<p><strong>Windows 用户：</strong></p>
<p>确保 Ollama 应用已经在运行（在系统托盘查看 Ollama 图标），或在 PowerShell/CMD 中执行：</p>
<pre><code class="hljs language-powershell" lang="powershell">ollama serve
</code></pre>
<h3 data-id="heading-11">3.2 验证服务运行状态</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试服务是否正常运行</span>
curl http://localhost:11434/api/tags

<span class="hljs-comment"># 或查看已安装模型</span>
ollama list
</code></pre>
<h3 data-id="heading-12">3.3 服务未响应处理</h3>
<p>如果遇到 <code>Error: ollama server not responding</code> 错误：</p>
<ol>
<li><strong>确认服务已启动</strong>：运行 <code>ollama serve</code></li>
<li><strong>检查端口占用</strong>：<code>lsof -i :11434</code>（macOS/Linux）或 <code>netstat -ano | findstr :11434</code>（Windows）</li>
<li><strong>重启服务</strong>：关闭当前终端，重新执行 <code>ollama serve</code></li>
<li><strong>检查安装</strong>：运行 <code>ollama --version</code> 确认正确安装</li>
</ol>
<hr/>
<h2 data-id="heading-13">4. 国内加速配置（必做）</h2>
<h3 data-id="heading-14">4.1 设置国内镜像</h3>
<p>由于 Ollama 官方模型库在国内访问较慢，建议配置国内镜像加速：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS / Linux</span>
<span class="hljs-built_in">export</span> OLLAMA_MODEL_SERVER=https://mirror.ollama.com

<span class="hljs-comment"># Windows（PowerShell）</span>
<span class="hljs-variable">$env</span>:OLLAMA_MODEL_SERVER=<span class="hljs-string">"https://mirror.ollama.com"</span>
</code></pre>
<h3 data-id="heading-15">4.2 永久配置镜像</h3>
<p><strong>macOS / Linux（推荐）：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑配置文件</span>
nano ~/.bashrc  <span class="hljs-comment"># 或 ~/.zshrc</span>

<span class="hljs-comment"># 添加以下内容</span>
<span class="hljs-built_in">export</span> OLLAMA_MODEL_SERVER=https://mirror.ollama.com

<span class="hljs-comment"># 保存后重新加载配置</span>
<span class="hljs-built_in">source</span> ~/.bashrc  <span class="hljs-comment"># 或 source ~/.zshrc</span>
</code></pre>
<p><strong>Windows：</strong></p>
<ol>
<li>右键「此电脑」→「属性」→「高级系统设置」→「环境变量」</li>
<li>在「用户变量」中新建：
<ul>
<li>变量名：<code>OLLAMA_MODEL_SERVER</code></li>
<li>变量值：<code>https://mirror.ollama.com</code></li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-16">5. 安全配置（重要）</h2>
<h3 data-id="heading-17">5.1 设置 API 密钥</h3>
<p>为防止未授权访问，建议设置访问密钥：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置密钥</span>
<span class="hljs-built_in">export</span> OLLAMA_API_KEY=your_strong_password123

<span class="hljs-comment"># Windows PowerShell</span>
<span class="hljs-variable">$env</span>:OLLAMA_API_KEY=<span class="hljs-string">"your_strong_password123"</span>
</code></pre>
<h3 data-id="heading-18">5.2 限制本地访问</h3>
<p>仅允许本地访问，避免暴露到公网：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 绑定到本地回环地址</span>
<span class="hljs-built_in">export</span> OLLAMA_HOST=127.0.0.1:11434

<span class="hljs-comment"># Windows PowerShell</span>
<span class="hljs-variable">$env</span>:OLLAMA_HOST=<span class="hljs-string">"127.0.0.1:11434"</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">6. 模型管理</h2>
<h3 data-id="heading-20">6.1 搜索可用模型</h3>
<p>访问 Ollama 官方模型库：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Flibrary" target="_blank" title="https://ollama.com/library" ref="nofollow noopener noreferrer">ollama.com/library</a></p>
<p>常用中文模型推荐：</p>



































<table><thead><tr><th>模型</th><th>说明</th><th>显存占用</th></tr></thead><tbody><tr><td><code>qwen2.5:7b</code></td><td>通义千问 2.5，中文效果优异</td><td>~4.5GB</td></tr><tr><td><code>qwen2.5:14b</code></td><td>更强中文能力，适合专业场景</td><td>~9GB</td></tr><tr><td><code>deepseek-r1:7b</code></td><td>DeepSeek 推理模型</td><td>~4.5GB</td></tr><tr><td><code>gemma2:9b</code></td><td>Google 开源模型</td><td>~5.5GB</td></tr><tr><td><code>llama3.1:8b</code></td><td>Meta Llama 3.1</td><td>~5GB</td></tr></tbody></table>
<h3 data-id="heading-21">6.2 下载模型</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载通义千问 7B（中文推荐）</span>
ollama pull qwen2.5:7b

<span class="hljs-comment"># 下载 INT4 量化版本（显存优化）</span>
ollama pull qwen2.5:7b-chat-q4_0

<span class="hljs-comment"># 下载 Llama 3.1</span>
ollama pull llama3.1:8b

<span class="hljs-comment"># 下载 DeepSeek 推理模型</span>
ollama pull deepseek-r1:7b
</code></pre>
<h3 data-id="heading-22">6.3 查看已安装模型</h3>
<pre><code class="hljs language-bash" lang="bash">ollama list
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-makefile" lang="makefile">NAME                    ID              SIZE    MODIFIED
<span class="hljs-section">qwen2.5:7b              846a0b7e        4.7GB   2 hours ago</span>
<span class="hljs-section">llama3.1:8b             a7872503        4.9GB   1 day ago</span>
</code></pre>
<h3 data-id="heading-23">6.4 删除模型</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除指定模型</span>
ollama <span class="hljs-built_in">rm</span> qwen2.5:7b

<span class="hljs-comment"># 删除多个模型</span>
ollama <span class="hljs-built_in">rm</span> llama3.1:8b gemma2:9b
</code></pre>
<hr/>
<h2 data-id="heading-24">7. 使用指南</h2>
<h3 data-id="heading-25">7.1 命令行对话</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动交互式对话</span>
ollama run qwen2.5:7b

<span class="hljs-comment"># 直接提问（非交互模式）</span>
ollama run qwen2.5:7b <span class="hljs-string">"请用 Python 写一个快速排序"</span>

<span class="hljs-comment"># 从文件读取提示</span>
ollama run qwen2.5:7b <span class="hljs-string">"<span class="hljs-subst">$(cat prompt.txt)</span>"</span>
</code></pre>
<h3 data-id="heading-26">7.2 启动 API 服务</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动服务（默认端口 11434）</span>
ollama serve

<span class="hljs-comment"># 自定义端口</span>
<span class="hljs-built_in">export</span> OLLAMA_HOST=0.0.0.0:8080
ollama serve
</code></pre>
<h3 data-id="heading-27">7.3 测试 API 服务</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试健康检查</span>
curl http://localhost:11434/api/tags

<span class="hljs-comment"># 测试对话接口</span>
curl http://localhost:11434/api/generate -d <span class="hljs-string">'{
  "model": "qwen2.5:7b",
  "prompt": "你好，请介绍一下你自己"
}'</span>
</code></pre>
<hr/>
<h2 data-id="heading-28">8. 编程调用</h2>
<h3 data-id="heading-29">8.1 浏览器环境（原生 Fetch）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 流式响应示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chatWithOllama</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://localhost:11434/v1/chat/completions"</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
      <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer your_api_key"</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5:7b"</span>,
      <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt }],
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>
    })
  });

  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
  <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;

  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);
    <span class="hljs-keyword">const</span> lines = chunk.<span class="hljs-title function_">split</span>(<span class="hljs-string">"\n"</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> line.<span class="hljs-title function_">trim</span>());

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
      <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"data: "</span>)) {
        <span class="hljs-keyword">const</span> data = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>);
        <span class="hljs-keyword">if</span> (data === <span class="hljs-string">"[DONE]"</span>) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
          <span class="hljs-keyword">const</span> content = json.<span class="hljs-property">choices</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">delta</span>?.<span class="hljs-property">content</span>;
          <span class="hljs-keyword">if</span> (content) {
            result += content;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content);
          }
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-comment">// 忽略解析错误</span>
        }
      }
    }
  }
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-title function_">chatWithOllama</span>(<span class="hljs-string">"写一个 Python 快速排序"</span>);
</code></pre>
<h3 data-id="heading-30">8.2 Node.js 环境</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">"axios"</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chatWithOllama</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(
    <span class="hljs-string">"http://localhost:11434/v1/chat/completions"</span>,
    {
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5:7b"</span>,
      <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt }],
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
      <span class="hljs-attr">max_tokens</span>: <span class="hljs-number">2000</span>
    },
    {
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer your_api_key"</span>
      }
    }
  );

  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-title function_">chatWithOllama</span>(<span class="hljs-string">"写一个 Python 快速排序"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
</code></pre>
<hr/>
<h2 data-id="heading-31">9. 常见问题</h2>
<h3 data-id="heading-32">9.1 下载速度慢</h3>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置国内镜像</span>
<span class="hljs-built_in">export</span> OLLAMA_MODEL_SERVER=https://mirror.ollama.com
</code></pre>
<h3 data-id="heading-33">9.2 显存不足</h3>
<p><strong>解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 选择 INT4 量化版本</span>
ollama pull qwen2.5:7b-chat-q4_0

<span class="hljs-comment"># 或选择更小的模型</span>
ollama pull qwen2.5:3b
</code></pre>
<h3 data-id="heading-34">9.3 Windows 启动失败</h3>
<p><strong>解决方案：</strong></p>
<p>下载并安装 Microsoft C++ 生成工具：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualstudio.microsoft.com%2Fvisual-cpp-build-tools%2F" target="_blank" title="https://visualstudio.microsoft.com/visual-cpp-build-tools/" ref="nofollow noopener noreferrer">visualstudio.microsoft.com/visual-cpp-…</a></p>
<h3 data-id="heading-35">9.4 服务未响应</h3>
<p><strong>检查清单：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 确认服务正在运行</span>
ollama serve

<span class="hljs-comment"># 2. 检查端口是否被占用</span>
lsof -i :11434  <span class="hljs-comment"># macOS/Linux</span>
netstat -ano | findstr :11434  <span class="hljs-comment"># Windows</span>

<span class="hljs-comment"># 3. 检查防火墙设置</span>

<span class="hljs-comment"># 4. 验证 API 密钥</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$OLLAMA_API_KEY</span>
</code></pre>
<h3 data-id="heading-36">9.5 模型加载慢</h3>
<p><strong>优化方案：</strong></p>
<ul>
<li>将模型存储在 SSD 硬盘</li>
<li>关闭其他占用 GPU 的程序</li>
<li>选择量化版本的模型</li>
</ul>
<hr/>
<h2 data-id="heading-37">10. 进阶配置</h2>
<h3 data-id="heading-38">10.1 自定义模型</h3>
<p>创建 <code>Modelfile</code> 自定义模型：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM qwen2.5:7b

# 设置系统提示
SYSTEM You are a helpful AI assistant specialized in Python programming.

# 设置参数
PARAMETER temperature 0.7
PARAMETER num_ctx 4096
</code></pre>
<p>构建自定义模型：</p>
<pre><code class="hljs language-bash" lang="bash">ollama create my-python-assistant -f Modelfile
ollama run my-python-assistant
</code></pre>
<h3 data-id="heading-39">10.2 并发设置</h3>
<p>调整并发请求数：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> OLLAMA_NUM_PARALLEL=4
</code></pre>
<h3 data-id="heading-40">10.3 日志级别</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置日志级别（debug/info/warn/error）</span>
<span class="hljs-built_in">export</span> OLLAMA_DEBUG=1
<span class="hljs-built_in">export</span> OLLAMA_LOG_LEVEL=info
</code></pre>
<hr/>
<h2 data-id="heading-41">11. 更新与卸载</h2>
<h3 data-id="heading-42">11.1 更新 Ollama</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS / Linux</span>
ollama update

<span class="hljs-comment"># Windows：重新下载安装包覆盖安装</span>
</code></pre>
<h3 data-id="heading-43">11.2 卸载 Ollama</h3>
<p><strong>macOS：</strong></p>
<pre><code class="hljs language-bash" lang="bash">brew uninstall ollama
<span class="hljs-built_in">rm</span> -rf ~/.ollama
</code></pre>
<p><strong>Linux：</strong></p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl stop ollama
sudo systemctl <span class="hljs-built_in">disable</span> ollama
<span class="hljs-built_in">rm</span> -rf /usr/local/bin/ollama ~/.ollama
</code></pre>
<p><strong>Windows：</strong></p>
<ol>
<li>控制面板 → 程序和功能 → 卸载 Ollama</li>
<li>删除用户目录下的 <code>.ollama</code> 文件夹</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 纯前端离线局域网P2P大文件断点传输：别让你的照片墙崩了]]></title>    <link>https://juejin.cn/post/7598402961904681012</link>    <guid>https://juejin.cn/post/7598402961904681012</guid>    <pubDate>2026-01-23T15:55:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598402961904681012" data-draft-id="7598433254127697960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 纯前端离线局域网P2P大文件断点传输：别让你的照片墙崩了"/> <meta itemprop="keywords" content="前端,WebRTC,JavaScript"/> <meta itemprop="datePublished" content="2026-01-23T15:55:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子兮曰"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 纯前端离线局域网P2P大文件断点传输：别让你的照片墙崩了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子兮曰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T15:55:09.000Z" title="Fri Jan 23 2026 15:55:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：小明和他的照片墙危机</h2>
<p>想象一下，你是小明，一个热爱摄影的程序员。周末去爬山拍了一堆4K高清照片，总共3GB，准备发给老婆分享。微信传？算了，压缩后画质渣得像像素风。网盘？离线状态下连不上。蓝牙？慢得像蜗牛在跑步。你急得团团转，突然灵机一动：用电脑直接传啊！可是怎么在浏览器里实现局域网P2P大文件传输，还得支持断点续传？别急，今天咱们就聊聊这个技术方案。</p>
<h2 data-id="heading-1">技术背景：P2P不是什么新鲜玩意儿</h2>
<p>P2P（点对点）传输在局域网里其实挺常见的，BT下载就是经典案例。但咱们今天聊的是纯前端实现，意思是完全不用后端服务器，用户A直接把文件传给用户B。核心技术是WebRTC（Web Real-Time Communication），这货本来是用来视频聊天的，但咱们可以拿来传文件。</p>
<p>为什么选WebRTC？因为它支持数据通道（DataChannel），可以直接在浏览器间建立连接。加上File API和Blob，咱们就能把大文件切成小块，边传边收，断点续传自然就出来了。</p>
<h2 data-id="heading-2">核心实现：分块传输 + 断点续传</h2>
<h3 data-id="heading-3">1. 文件切块：大象塞冰箱，得先切成块</h3>
<p>浏览器处理大文件有个硬伤：内存限制。如果直接把3GB文件读进内存，Chrome得哭爹喊娘。所以咱们用FileReader分块读：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 文件分块函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">chunkFile</span>(<span class="hljs-params">file, chunkSize = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span></span>) { <span class="hljs-comment">// 1MB每块</span>
  <span class="hljs-keyword">const</span> chunks = [];
  <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">while</span> (offset &lt; file.<span class="hljs-property">size</span>) {
    <span class="hljs-keyword">const</span> chunk = file.<span class="hljs-title function_">slice</span>(offset, offset + chunkSize);
    chunks.<span class="hljs-title function_">push</span>(chunk);
    offset += chunkSize;
  }
  
  <span class="hljs-keyword">return</span> chunks;
}
</code></pre>
<p>这里用<code>file.slice()</code>切块，每个块1MB。为什么要1MB？平衡传输效率和内存占用，太小网络开销大，太大浏览器卡。</p>
<h3 data-id="heading-4">2. WebRTC连接：建立地下通道</h3>
<p>WebRTC连接需要信令服务器（用来交换连接信息），但咱们是离线局域网，所以可以用WebSocket或者直接用浏览器本地存储交换SDP（会话描述协议）。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建RTCPeerConnection</span>
<span class="hljs-keyword">const</span> pc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCPeerConnection</span>({
  <span class="hljs-attr">iceServers</span>: [] <span class="hljs-comment">// 局域网不需要STUN服务器</span>
});

<span class="hljs-comment">// 创建数据通道</span>
<span class="hljs-keyword">const</span> dataChannel = pc.<span class="hljs-title function_">createDataChannel</span>(<span class="hljs-string">'file-transfer'</span>);

<span class="hljs-comment">// 监听连接事件</span>
dataChannel.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'通道开了，可以传文件了'</span>);
dataChannel.<span class="hljs-property">onmessage</span> = handleMessage;
</code></pre>
<h3 data-id="heading-5">3. 断点续传：从中断处继续</h3>
<p>断点续传的关键是记录已传块的进度。用IndexedDB或者localStorage存进度：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 发送文件块</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendFileChunks</span>(<span class="hljs-params">file, dataChannel</span>) {
  <span class="hljs-keyword">const</span> chunks = <span class="hljs-title function_">chunkFile</span>(file);
  <span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">loadProgress</span>(file.<span class="hljs-property">name</span>) || <span class="hljs-number">0</span>; <span class="hljs-comment">// 从本地加载进度</span>
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = progress; i &lt; chunks.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> chunk = chunks[i];
    <span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">await</span> chunk.<span class="hljs-title function_">arrayBuffer</span>();
    
    <span class="hljs-comment">// 发送块数据，带上索引</span>
    dataChannel.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'chunk'</span>,
      <span class="hljs-attr">index</span>: i,
      <span class="hljs-attr">data</span>: arrayBuffer
    }));
    
    <span class="hljs-title function_">saveProgress</span>(file.<span class="hljs-property">name</span>, i + <span class="hljs-number">1</span>); <span class="hljs-comment">// 保存进度</span>
  }
  
  <span class="hljs-comment">// 发送结束信号</span>
  dataChannel.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'end'</span> }));
}
</code></pre>
<p>接收端收到块后，先存到临时数组，收到'end'信号再合并成完整文件。</p>
<h2 data-id="heading-6">浏览器限制：那些坑爹的现实</h2>
<h3 data-id="heading-7">1. 文件大小限制：Chrome说不行就不行</h3>
<p>Chrome对单个文件上传有限制，默认是2GB。有些版本甚至更低。遇到大文件怎么办？继续分块，但块数太多会影响性能。</p>
<p>解决方案：用File System Access API（Chrome 86+），可以直接操作本地文件系统，绕过内存限制。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用File System Access API</span>
<span class="hljs-keyword">const</span> fileHandle = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showOpenFilePicker</span>();
<span class="hljs-keyword">const</span> file = <span class="hljs-keyword">await</span> fileHandle.<span class="hljs-title function_">getFile</span>();
<span class="hljs-keyword">const</span> writableStream = <span class="hljs-keyword">await</span> fileHandle.<span class="hljs-title function_">createWritable</span>();

<span class="hljs-comment">// 分块写入</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> chunks) {
  <span class="hljs-keyword">await</span> writableStream.<span class="hljs-title function_">write</span>(chunk);
}
<span class="hljs-keyword">await</span> writableStream.<span class="hljs-title function_">close</span>();
</code></pre>
<h3 data-id="heading-8">2. 内存泄漏：传着传着浏览器崩了</h3>
<p>大文件传输时，如果不及时释放Blob对象，内存会爆。解决方案：用stream API边读边传：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用ReadableStream处理大文件</span>
<span class="hljs-keyword">const</span> stream = file.<span class="hljs-title function_">stream</span>();
<span class="hljs-keyword">const</span> reader = stream.<span class="hljs-title function_">getReader</span>();

<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
  <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
  
  <span class="hljs-comment">// 直接发送value（Uint8Array）</span>
  dataChannel.<span class="hljs-title function_">send</span>(value);
}
</code></pre>
<h3 data-id="heading-9">3. 网络限制：局域网防火墙挡道</h3>
<p>公司局域网可能有防火墙，WebRTC的UDP连接会被挡。解决方案：降级到WebSocket，或者用TURN服务器中转（但这就不纯前端了）。</p>
<h2 data-id="heading-10">实战案例：三个真实场景</h2>
<h3 data-id="heading-11">案例1：照片分享应用</h3>
<p>我之前做的一个家庭相册App，用这个技术实现了局域网照片同步。妈妈在客厅电脑上传相册，爸爸在卧室就能直接收到，不用连路由器。</p>
<p>关键代码：进度条显示 + 错误重试</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 进度显示</span>
dataChannel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
  <span class="hljs-keyword">if</span> (message.<span class="hljs-property">type</span> === <span class="hljs-string">'progress'</span>) {
    <span class="hljs-title function_">updateProgressBar</span>(message.<span class="hljs-property">percent</span>);
  }
};
</code></pre>
<h3 data-id="heading-12">案例2：游戏存档同步</h3>
<p>做游戏开发时，团队成员在局域网同步大存档文件（几GB）。用断点续传，网络断了重连后从断点继续，省去了重传的时间。</p>
<h3 data-id="heading-13">案例3：视频剪辑素材传输</h3>
<p>剪辑师在局域网传4K视频素材。传统方法用U盘慢，用这个方案直接浏览器传，还能显示传输速度和剩余时间。</p>
<h2 data-id="heading-14">其他方案：当WebRTC不够用时</h2>
<h3 data-id="heading-15">方案1：WebTorrent</h3>
<p>基于WebRTC的BitTorrent实现，支持多对多传输，更适合大文件群发。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">WebTorrent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'webtorrent'</span>;

<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebTorrent</span>();
client.<span class="hljs-title function_">seed</span>(file, <span class="hljs-function">(<span class="hljs-params">torrent</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'种子创建成功:'</span>, torrent.<span class="hljs-property">magnetURI</span>);
});
</code></pre>
<p>优点：多人同时下载快。缺点：需要种子文件管理。</p>
<h3 data-id="heading-16">方案2：Socket.IO + 二进制传输</h3>
<p>用WebSocket传二进制数据，配合socket.io实现断点续传。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> socket = <span class="hljs-title function_">io</span>();
socket.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'send-file-chunk'</span>, { chunk, index });

socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">'chunk-received'</span>, <span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> {
  <span class="hljs-comment">// 继续发下一块</span>
});
</code></pre>
<p>优点：兼容性好。缺点：需要服务器中转。</p>
<h3 data-id="heading-17">方案3：Electron应用</h3>
<p>如果纯浏览器限制太多，可以做个Electron桌面应用，用Node.js的fs模块直接操作文件系统，结合WebRTC。</p>
<h2 data-id="heading-18">总结与展望</h2>
<p>纯前端P2P大文件断点传输，听起来高大上，其实就是把文件切块 + WebRTC传数据 + 本地存储进度。浏览器限制是客观存在的，但通过File System API和内存管理，大部分场景都能搞定。</p>
<p>未来，随着WebTransport协议的普及（基于HTTP/3），传输效率会更高。5G和WiFi 6普及后，局域网传输速度会飞起。</p>
<p>下次老婆让你传照片，别再抱怨网速了，直接用浏览器P2P传吧！有什么问题，评论区见。🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建分布式应用？Akamai 和 Fermyon 正在改变游戏规则]]></title>    <link>https://juejin.cn/post/7598389448146239498</link>    <guid>https://juejin.cn/post/7598389448146239498</guid>    <pubDate>2026-01-23T14:23:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598389448146239498" data-draft-id="7598362826110828594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建分布式应用？Akamai 和 Fermyon 正在改变游戏规则"/> <meta itemprop="keywords" content="人工智能,云计算"/> <meta itemprop="datePublished" content="2026-01-23T14:23:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建分布式应用？Akamai 和 Fermyon 正在改变游戏规则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T14:23:12.000Z" title="Fri Jan 23 2026 14:23:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>深耕企业技术领域多年，使我足以识别那些根本性的变革时刻。今天Akamai收购Fermyon的消息，正是这样一个历史性节点。这代表着多项关键技术的深度融合——轻量级WebAssembly (Wasm)函数在边缘处理请求，需要时可智能路由至GPU加速推理，而这一切都集成在同一个平台内。</p>
<p>让我解释一下，为何这一进展对所有分布式应用构建者都至关重要。</p>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_260123_blogarticles245" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_260123_blogarticles245" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p>
<hr/>
<p><strong><strong>打造未来的团队</strong></strong></p>
<p>首先，让我们聚焦于背后的人才。Fermyon团队不仅是Wasm的倡导者，更是将其真正落地到生产环境的构建者。Matt Butcher、Radu Matei及其团队，将Wasm从一项“有趣的浏览器技术”发展为“无服务器计算的未来”。他们不仅构思并打造了Spin框架，更围绕其培育起活跃的开发者社区，最终实现了该技术的大规模生产级应用。</p>
<p>像 Helm 这样的著名项目，最初是 Matt Butcher 和他在 Deis 的同事在 2015 年一次黑客马拉松上为管理 Kubernetes 部署而创建的项目，如今已成为云原生计算基金会的顶级项目。</p>
<p>正是这支团队，在Kubernetes引领微服务潮流之前，就已洞察其趋势。他们屡次展现出对基础设施演进的前瞻性视野，其精准预判，往往领先行业三到五年。</p>
<p><strong><strong>为什么 WebAssembly + 边缘 = 下一次演进</strong></strong></p>
<p>换言之，最快的无服务器 Wasm 运行时 + 分布最广的云平台 = 更快部署、即时扩展的更智能应用。当然，这说法不如前者精炼。</p>
<p>Wasm 不再仅仅关乎在浏览器中运行代码，而是提供接近原生的性能，并具有真正的可移植性——这次，"一次编写，到处运行"真正实现了。无需分发容器，无需运行时依赖，只有微秒级执行的编译代码。你的应用性能达到最优，并且你可以更快实现交付。</p>
<p>Akamai EdgeWorkers 使开发人员能够在边缘部署 JavaScript 函数，而 Fermyon 将其提升到了新的水平。可以看作是从事务处理升级到完整的边缘应用。</p>
<p>这不再是运行孤立功能，而是部署完整的、有状态的应用程序。你获得了复杂的路由、中间件和服务组合能力，且启动速度依然迅捷。这使你能够构建复杂、多组件的系统，让应用在变得更健壮（更智能）的同时，性能丝毫不减。</p>
<p>Fermyon 的 Spin 框架使开发人员能够用 Wasm 组件构建整个应用程序，每个组件可能用不同的语言编写，但都能无缝协作。这使得无服务器函数可以扩展为可移植的无服务器应用程序，并内置键值存储、SQL 数据库和 AI 推理能力。真正的多云成为可能。</p>
<p>再结合 Akamai 的基础设施，我们使开发人员能够将计算分布到全球超过 4,400 个地点。当你在我们的平台上部署 Wasm 模块时，无论用户身处何地，都能获得低于 10 毫秒的响应时间。拥有所有的扩展能力，却没有随之而来的复杂性。</p>
<p>Fermyon 构建了最快的无服务器 Wasm 运行时。Akamai 运营着分布最广的云平台。我们携手合作，加速实现价值的时间，同时使开发人员能够大规模构建更智能的应用程序。</p>
<p><strong><strong>分布式 AI 应用：从愿景到现实</strong></strong></p>
<p>AI 的未来在于让强大的智能无处不在。WebAssembly 是实现这一点的关键。</p>
<p>借助 Wasm，开发人员可以比以往更快地创建分布式 AI 驱动的应用程序，并且有信心因为 Akamai 的网络，这些应用能为更多地区、更多用户更快地运行。你的 AI 模型编译为 Wasm，几秒内即可全球部署，无论你的用户身处东京、圣保罗还是斯德哥尔摩，都能以稳定的亚秒级响应时间执行。</p>
<p>这延续了 Akamai 在实现从核心到边缘计算资源连续统一体方面的努力。继我们发布 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fproducts%2Fakamai-inference-cloud-platform%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_260123_external1_blogarticles245" target="_blank" title="https://www.akamai.com/zh/products/akamai-inference-cloud-platform?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_260123_external1_blogarticles245" ref="nofollow noopener noreferrer">Akamai Inference Cloud</a>之后，将运行在 Akamai 上的 Wasm 函数能力与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fproducts%2Fgpu%2Fnvidia%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_260123_external2_blogarticles245" target="_blank" title="https://www.akamai.com/zh/products/gpu/nvidia?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_260123_external2_blogarticles245" ref="nofollow noopener noreferrer">NVIDIA Blackwell GPU 基础设施</a>相结合，为开发人员创造了释放新能力的机会。</p>
<p>当轻量级的 Wasm 函数在边缘处理请求时，我们可以在需要时智能地将它们路由到 GPU 加速的推理，所有操作都在同一平台内完成。你将获得边缘计算的经济性和 GPU 加速的强大能力，并由平台无缝编排。</p>
<p>开发人员将不再需要在速度与智能之间做出选择；他们将两者兼得。Wasm 函数可以在边缘以微秒级速度处理请求，仅在必要时调用运行在我们 GPU 基础设施上的更深度 AI 模型。这是为智能应用设计的智能路由。</p>
<p><strong><strong>开源不是可选项——而是战略</strong></strong></p>
<p>我们对开源的承诺不会改变。Spin 将会一直保持开源。SpinKube 继续作为 CNCF 项目推进。开发者的信任是通过行动、支持和代码提交赢得的。Fermyon 深谙此道。他们没有构建一个专有平台并试图锁定开发者。他们构建了开源工具，让开发者自由选择。</p>
<p>Akamai 将继续秉承这一理念。你想在自己的基础设施上运行 Spin？很好。在另一朵云上运行？没问题。我们的目标不是困住开发者——而是打造最好的平台，让他们选择留下。</p>
<p><strong><strong>这对开发者当前意味着什么</strong></strong></p>
<p>即日开始，如果你正在构建分布式应用，你有了新的选择。</p>
<ul>
<li>用 Rust、Go、JavaScript、Python 或任何能编译为 Wasm 的语言编写你的代码。</li>
<li>在几秒内（而不是几小时内）将其部署到全球。</li>
<li>从零扩展到数百万请求，而无需考虑基础设施。</li>
<li>仅按毫秒计费，为你实际使用的资源付费。</li>
</ul>
<p>但更重要的是，你并非在押注于专有技术。每个组件——从 Spin CLI 到部署平台——都有开源基础。你的代码不会被锁定在我们的平台上，它在设计上就是可移植的。</p>
<p><strong><strong>更大的图景</strong></strong></p>
<p>网络正在从集中式的云演变为分布式的边缘。不是因为潮流如此，而是物理规律使然。你无法从单一区域为全球受众提供服务并期望获得低于 100 毫秒的延迟。你无法在弗吉尼亚州为新加坡的用户运行 AI 推理并称之为"实时"。</p>
<p>WebAssembly 加边缘计算解决了这个问题。对于需要即时、高效地全球运行的工作负载而言，它是合适的工具。</p>
<p>Fermyon 构建了引擎。Akamai 提供了全球基础设施。我们携手合作，让部署边缘原生应用变得像推送到 GitHub 一样简单。</p>
<p>Web 应用的未来意味着计算无处不在。而通过此次收购，"无处不在"变得更加触手可及。</p>
<p>欢迎加入 Akamai，Fermyon 团队。让我们携手创造非凡。</p>
<p>想亲自尝试吗？查看 Spin，亲身体验边缘 Wasm 的实际感受。或者直接联系我们——我很乐意了解你们正在构建的东西。</p>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_260123_blogarticles245_end" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_260123_blogarticles245_end" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS魔法:对话生成器与奔驰骏马的创意实现]]></title>    <link>https://juejin.cn/post/7598382710294904832</link>    <guid>https://juejin.cn/post/7598382710294904832</guid>    <pubDate>2026-01-23T14:30:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598382710294904832" data-draft-id="7598403436698746914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS魔法:对话生成器与奔驰骏马的创意实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T14:30:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS魔法:对话生成器与奔驰骏马的创意实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T14:30:00.000Z" title="Fri Jan 23 2026 14:30:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近逛GitHub时，发现一个很有意思的项目——一个纯前端实现的对话生成器，效果非常精致。推荐给感兴趣的朋友，如果想深入钻研CSS，这个项目也很值得研究。另外，马上就要到马年了，顺便也分享一个之前收藏的用CSS实现的动态奔跑骏马效果。这两个项目都展现了CSS的巧妙运用，既适合学习借鉴，也很有趣味性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00a203b0a5264a1285c843377b893b49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=Y%2FBnrtGjASIsJkXqXoous%2FyQPU8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">👩聊天生成器</h2>
<p>对话生成器：一个简单好玩的在线聊天制作工具</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzixiwangluo%2Fwxdh" target="_blank" title="https://github.com/zixiwangluo/wxdh" ref="nofollow noopener noreferrer">github.com/zixiwangluo…</a></p>
<p>在线地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzixiwangluo.github.io%2Fwxdh%2F" target="_blank" title="https://zixiwangluo.github.io/wxdh/" ref="nofollow noopener noreferrer">zixiwangluo.github.io/wxdh/</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f03dc2ffc854c07ab31063747ac2ca9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=yh93%2Fsj2MHoNksmnZ93U0Fo0XH0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">🌠功能简介</h3>
<p>这是一个可以在线生成微信风格聊天截图的工具，支持以下功能：</p>
<ul>
<li>自定义苹果或安卓手机状态栏（时间、电量、信号等）</li>
<li>设置对话双方的头像和昵称</li>
<li>发送文字、语音、红包、转账等聊天元素</li>
<li>自由编辑对话内容，生成高度仿真的微信聊天效果</li>
<li>无论是制作搞笑对话、剧情截图，还是用于演示与分享等轻松场景，这个工具都能带来不少乐趣。</li>
</ul>
<p>该项目完全基于HTML、CSS和JavaScript实现，非常适合前端学习者参考。如果想直接使用，可将源码下载到本地，打开index.html即可运行；如果有服务器，也可以直接部署到Nginx等环境中，使用非常简单，这里就不多做介绍了。</p>
<p>平时写文章或做教程时如果需要聊天素材，也可以用它来快速生成。效果示例如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbcd3b21a3154e62b8731129d09a2305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=NcaS5nlRuk7yK2H8iKQm8w%2BSqQc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bed16fd161824a33b35c471ac4213e51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=TOOBhS4pjZjWAFF9zQQB2fazaSM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">🐎纯css实现的奔驰的骏马</h2>
<p>随着马年临近，这个奔跑的骏马效果格外应景。最初在某博客中发现这个创意实现，视觉效果流畅自然，于是特别部署了在线演示方便体验。</p>
<p>演示地址1：<a href="https://link.juejin.cn?target=http%3A%2F%2Fh5.xiuji.mynatapp.cc%2Fhorse%2F" target="_blank" title="http://h5.xiuji.mynatapp.cc/horse/" ref="nofollow noopener noreferrer">h5.xiuji.mynatapp.cc/horse/</a></p>
<p>演示地址2：<a href="https://link.juejin.cn?target=https%3A%2F%2Faa51f2d3.pinit.eth.limo%2F" target="_blank" title="https://aa51f2d3.pinit.eth.limo/" ref="nofollow noopener noreferrer">aa51f2d3.pinit.eth.limo/</a></p>
<p>效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c443b04084734691a54e6192e880be55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=yWQfGxSAwGR1BFhFZSQVblnCuH8%3D" alt="horse-run.gif" loading="lazy"/></p>
<p>如果你想获取源码，可以通过浏览器开发者工具（F12）查看并复制相关代码。代码就两文件，一个html,一个css。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/606bf933ce5a47abb67c97f6a3f559e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=5Ad030DBNMCBjYeZdwQN1BEHkxo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">👽总结</h2>
<p>这两个项目虽然功能不同，但都体现了前端开发的创意与技巧：</p>
<ol>
<li>微信对话生成器展示了如何通过前端技术模拟复杂UI，实现高度可定制的交互工具，对学习CSS布局和JavaScript DOM操作很有帮助。</li>
<li>CSS奔驰骏马则纯粹依靠样式表创造流畅动画，是学习CSS动画、关键帧和性能优化的优秀案例。</li>
</ol>
<p>无论是想要寻找实用工具，还是希望深入学习前端技术，这两个项目都值得收藏研究。它们证明了，即使不使用复杂框架和库，纯前端技术也能创造出既美观又实用的效果。</p>
<h2 data-id="heading-4">🐟今日摸鱼小贴士:从入门到“入厕”新境界</h2>
<p>领导眼皮底下吨吨灌水，洗手间里频繁“打卡”</p>
<p>主打一个<strong>尿喝白，电充绿，事干黄</strong>。</p>
<p>业绩虽暂时躺平，但新陈代谢已实现<strong>遥遥领先</strong>✨</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8515e055b5f04171920fb47a69b8e573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769783399&amp;x-signature=YBDaSHjnbA0LCq4w2yy8tZeyT3o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">❗❗❗特别声明</h2>
<p>此项目来自互联网公开资源，仅供学习交流使用，切勿用于非法途径，由此产生任何纠纷由使用者本人自己承担，如有侵权，请及时联系删除❗❗❗</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prompt Engineering新范式突破大型推理模型的优化边界]]></title>    <link>https://juejin.cn/post/7598181989969641499</link>    <guid>https://juejin.cn/post/7598181989969641499</guid>    <pubDate>2026-01-23T13:05:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598181989969641499" data-draft-id="7598374376094105627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prompt Engineering新范式突破大型推理模型的优化边界"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-23T13:05:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prompt Engineering新范式突破大型推理模型的优化边界
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T13:05:37.000Z" title="Fri Jan 23 2026 13:05:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、研究现状分析：传统提示词技巧的统计学无效性</h2>
<h3 data-id="heading-1">1.1 沃顿商学院《Prompting Science Reports》的核心发现</h3>
<p>2025年，宾夕法尼亚大学沃顿商学院生成式AI实验室发布了一系列名为《Prompting Science Reports》的重磅研究报告，通过对2024-2025最常用模型（GPT-4o、Claude 3.5 Sonnet、Gemini Pro/Flash等）在博士级基准测试（GPQA Diamond）上的数万次严谨测试，得出了颠覆性的结论：</p>
<p><strong>传统提示词技巧在统计学上无效：</strong></p>



































<table><thead><tr><th>技巧类型</th><th>宏观统计影响</th><th>微观个案波动</th><th>实际价值</th></tr></thead><tbody><tr><td>礼貌语气（"请"字）</td><td>几乎无显著差异</td><td>正负60%极端波动</td><td>低</td></tr><tr><td>命令语气（"我命令你"）</td><td>几乎无显著差异</td><td>正负63%极端波动</td><td>低</td></tr><tr><td>专家角色扮演（"你是一位20年经验的专家"）</td><td>对事实准确性无提升</td><td>引入随机性</td><td>低</td></tr><tr><td>思维链（"Let's think step by step"）</td><td>价值递减（尤其对推理模型）</td><td>简单问题复杂化</td><td>中等</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 模型能力边界的真实体现</h3>
<p>沃顿研究揭示的核心真相是：<strong>模型本身的能力边界决定了提示词的优化上限</strong>。在GPQA Diamond数据集（198个博士级多选题）上，即使是最严格的格式化提示，模型在最严苛的"100%正确"标准下，表现仅比随机猜测高出约5个百分点，且差异在统计学上不显著。</p>
<p><strong>三种评估标准下的天壤之别：</strong></p>





























<table><thead><tr><th>评估标准</th><th>要求</th><th>GPT-4o表现</th><th>结论</th></tr></thead><tbody><tr><td>100%正确</td><td>25次测试全对</td><td>几乎与瞎猜无异</td><td>单次测试欺骗性巨大</td></tr><tr><td>90%正确</td><td>25次中对23次</td><td>中等表现</td><td>人类容错级标准</td></tr><tr><td>51%正确</td><td>25次中对13次以上</td><td>显著超越随机猜测</td><td>多数投票有效</td></tr></tbody></table>
<h3 data-id="heading-3">1.3 唯一确定有效的技巧：格式化约束</h3>
<p>在所有测试的提示技巧中，<strong>只有格式化约束表现出了一致的正面效果</strong>：</p>
<ul>
<li><strong>性能下降数据</strong>：移除格式要求后，GPT-4o下降8.6个百分点，GPT-4o-mini下降12.1个百分点</li>
<li><strong>核心价值</strong>：帮助模型聚焦注意力，减少随意性，确保响应格式标准化</li>
<li><strong>实践建议</strong>：明确的JSON格式要求、特定输出句式等结构化约束</li>
</ul>
<h2 data-id="heading-4">二、技术突破解析：蒙特卡洛树搜索（MCTS）提示优化框架</h2>
<h3 data-id="heading-5">2.1 MCTS在Prompt优化中的核心思想</h3>
<p>蒙特卡洛树搜索（MCTS）框架将提示优化视为一个<strong>序列决策过程</strong>，通过模拟和评估探索提示空间，找到最优提示序列。乔治梅森大学2025年的研究证明，即使对于强大的大型推理模型（LRMs），基于MCTS的提示优化仍能带来显著性能提升。</p>
<p><strong>MCTS提示优化的四个关键步骤：</strong></p>
<ol>
<li><strong>生成（Generation）</strong>：任务模型根据当前Prompt生成答案</li>
<li><strong>评估（Evaluation）</strong>：错误分析器精准识别答案中的错误类型</li>
<li><strong>优化（Optimization）</strong>：优化模型根据错误反馈生成改进后的Prompt</li>
<li><strong>更新（Update）</strong>：根据改进后的Prompt更新任务模型</li>
</ol>
<h3 data-id="heading-6">2.2 MCTS框架的算法实现逻辑</h3>
<p>MCTS通过选择（Selection）、扩展（Expansion）、模拟（Simulation）、反向传播（Backpropagation）四个阶段，在提示空间中高效搜索最优解：</p>
<p><strong>UCT（Upper Confidence Bound applied to Trees）公式</strong>：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>U</mi><mi>C</mi><mi>T</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>+</mo><mi>c</mi><msqrt><mfrac><mrow><mi>ln</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">(</mo><mi>p</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow></mfrac></msqrt></mrow><annotation encoding="application/x-tex">UCT(v) = \frac{Q(v)}{N(v)} + c\sqrt{\frac{\ln N(parent(v))}{N(v)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.13889em;">CT</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.04em;vertical-align:-1.1606em;"/><span class="mord mathnormal">c</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8794em;"><span class="svg-align" style="top:-5em;"><span class="pstrut" style="height:5em;"/><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mop">ln</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-3.8394em;"><span class="pstrut" style="height:5em;"/><span class="hide-tail" style="min-width:1.02em;height:3.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="3.08em" viewbox="0 0 400000 3240" preserveaspectratio="xMinYMin slice"><path d="M473,2793&#10;c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0&#10;c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7&#10;s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9&#10;c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200&#10;c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26&#10;s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,&#10;606zM1001 80h400000v40H1017.7z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1606em;"><span/></span></span></span></span></span></span></span></span></div>
<p>其中：</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span></span>：节点v的累计奖励值</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span></span>：节点v的访问次数</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span>：探索系数（平衡探索与利用）</li>
</ul>
<h3 data-id="heading-7">2.3 实际效果验证：ACE数据集上的突破性提升</h3>
<p>在ACE405数据集（事件抽取任务）上的实验结果令人振奋：</p>





























<table><thead><tr><th>模型</th><th>优化前AC指标</th><th>优化后AC指标</th><th>提升幅度</th></tr></thead><tbody><tr><td>DeepSeek-R1</td><td>基准值</td><td><strong>+27.81%</strong></td><td>显著</td></tr><tr><td>GPT-4.5</td><td>基准值</td><td>+18.42%</td><td>显著</td></tr><tr><td>Claude 3.5 Sonnet</td><td>基准值</td><td>+15.67%</td><td>显著</td></tr></tbody></table>
<p><strong>关键发现：</strong></p>
<ul>
<li>LRMs从提示优化中获得的收益比传统LLMs更大</li>
<li>LRMs作为优化器可以生成更高质量、更简洁、更精确的提示</li>
<li>较短的提示不一定意味着较低的性能，不同模型有不同偏好</li>
</ul>
<h2 data-id="heading-8">三、自动化趋势展望：从手动炼丹到工业化应用</h2>
<h3 data-id="heading-9">3.1 自动化提示优化（AutoPrompt/APE）的技术路径</h3>
<p>2025年，自动化提示工程已从理论探索走向工业化应用，主要技术路径包括：</p>
<p><strong>基于梯度下降的软提示优化：</strong></p>
<ul>
<li><strong>技术原理</strong>：优化连续向量而非离散的自然语言提示</li>
<li><strong>优点</strong>：性能潜力高，可找到人类无法表达的"最优"提示</li>
<li><strong>缺点</strong>：需要标注数据训练，失去免训练的敏捷性</li>
</ul>
<p><strong>基于黑盒优化的离散提示搜索：</strong></p>
<ul>
<li><strong>遗传算法</strong>：模拟生物进化，通过选择、交叉、变异迭代优化</li>
<li><strong>强化学习</strong>：将提示生成视为马尔可夫决策过程，学习最大化奖励的策略</li>
<li><strong>贝叶斯优化</strong>：构建概率模型，智能选择最有希望的提示组合</li>
</ul>
<h3 data-id="heading-10">3.2 工业化应用前景</h3>
<p>自动化提示优化在多个领域展现出强大的应用价值：</p>






























<table><thead><tr><th>应用领域</th><th>优化目标</th><th>预期效益</th></tr></thead><tbody><tr><td>分类任务</td><td>提升准确率、F1分数</td><td>准确率提升15-30%</td></tr><tr><td>问答系统</td><td>增强复杂问题引导能力</td><td>回答准确率提升20%</td></tr><tr><td>代码生成</td><td>优化指令格式和结构</td><td>代码正确率提升25%</td></tr><tr><td>多语言翻译</td><td>针对语言对优化翻译提示</td><td>BLEU分数提升10%</td></tr></tbody></table>
<h3 data-id="heading-11">3.3 未来研究方向</h3>
<ol>
<li><strong>精细化Prompt优化策略</strong>：探索Prompt的自动生成和选择机制</li>
<li><strong>外部知识增强</strong>：结合知识图谱提升Prompt的语义表达能力</li>
<li><strong>跨任务泛化</strong>：将方法应用于代码生成、文本摘要等更广泛领域</li>
<li><strong>自适应压缩</strong>：根据任务难度和接口特征动态调整提示压缩比例</li>
</ol>
<h2 data-id="heading-12">四、Python代码示例：MCTS提示优化框架核心实现</h2>
<h3 data-id="heading-13">4.1 MCTS节点定义</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Optional</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MCTSNode</span>:
    <span class="hljs-string">"""MCTS树节点，表示一个提示状态"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, prompt: <span class="hljs-built_in">str</span>, parent: <span class="hljs-type">Optional</span>[<span class="hljs-string">'MCTSNode'</span>] = <span class="hljs-literal">None</span></span>):
        self.prompt = prompt  <span class="hljs-comment"># 当前提示词</span>
        self.parent = parent  <span class="hljs-comment"># 父节点</span>
        self.children: <span class="hljs-type">List</span>[<span class="hljs-string">'MCTSNode'</span>] = []  <span class="hljs-comment"># 子节点列表</span>
        
        <span class="hljs-comment"># 统计信息</span>
        self.visits = <span class="hljs-number">0</span>  <span class="hljs-comment"># 访问次数</span>
        self.wins = <span class="hljs-number">0</span>    <span class="hljs-comment"># 累计奖励值</span>
        self.reward_history: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>] = []  <span class="hljs-comment"># 奖励历史记录</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_child</span>(<span class="hljs-params">self, child: <span class="hljs-string">'MCTSNode'</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""添加子节点"""</span>
        self.children.append(child)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, reward: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""更新节点统计信息"""</span>
        self.visits += <span class="hljs-number">1</span>
        self.wins += reward
        self.reward_history.append(reward)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">uct_value</span>(<span class="hljs-params">self, exploration_constant: <span class="hljs-built_in">float</span> = <span class="hljs-number">1.414</span></span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""计算UCT值"""</span>
        <span class="hljs-keyword">if</span> self.visits == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(<span class="hljs-string">'inf'</span>)
        
        exploitation = self.wins / self.visits
        exploration = math.sqrt(math.log(self.parent.visits) / self.visits)
        
        <span class="hljs-keyword">return</span> exploitation + exploration_constant * exploration
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">best_child</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-string">'MCTSNode'</span>]:
        <span class="hljs-string">"""选择最佳子节点"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.children:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(self.children, key=<span class="hljs-keyword">lambda</span> child: child.uct_value())
</code></pre>
<h3 data-id="heading-14">4.2 MCTS提示优化框架实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PromptOptimizationMCTS</span>:
    <span class="hljs-string">"""基于MCTS的提示优化框架"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 task_model,  <span class="hljs-comment"># 任务模型（模拟LLM）</span>
                 optimizer_model,  <span class="hljs-comment"># 优化器模型（模拟GPT-4等）</span>
                 exploration_constant: <span class="hljs-built_in">float</span> = <span class="hljs-number">1.414</span>,
                 max_iterations: <span class="hljs-built_in">int</span> = <span class="hljs-number">100</span></span>):
        
        self.task_model = task_model
        self.optimizer_model = optimizer_model
        self.exploration_constant = exploration_constant
        self.max_iterations = max_iterations
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_prompt</span>(<span class="hljs-params">self, prompt: <span class="hljs-built_in">str</span>, test_data: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]</span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""评估提示词在测试数据上的表现"""</span>
        total_reward = <span class="hljs-number">0</span>
        num_samples = <span class="hljs-built_in">len</span>(test_data)
        
        <span class="hljs-keyword">for</span> sample <span class="hljs-keyword">in</span> test_data:
            <span class="hljs-comment"># 使用任务模型根据提示生成答案</span>
            answer = self.task_model.generate(prompt, sample[<span class="hljs-string">'input'</span>])
            
            <span class="hljs-comment"># 对比标准答案计算奖励（模拟）</span>
            reward = <span class="hljs-number">1.0</span> <span class="hljs-keyword">if</span> answer == sample[<span class="hljs-string">'output'</span>] <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
            
            <span class="hljs-comment"># **产品植入点**：在实际项目中，我们可以借助prompt-minder.com的</span>
            <span class="hljs-comment"># 自动化评估模块，快速验证不同提示词变体在特定任务上的表现，</span>
            <span class="hljs-comment"># 避免人工评估的主观偏差，实现提示优化流程的标准化。</span>
            
            <span class="hljs-comment"># 以下是模拟的评估逻辑，实际使用时可替换为prompt-minder.com API调用</span>
            <span class="hljs-comment"># reward = prompt_minder_api.evaluate(prompt, sample['input'], sample['output'])</span>
            
            total_reward += reward
        
        <span class="hljs-keyword">return</span> total_reward / num_samples
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">optimize_prompt</span>(<span class="hljs-params">self, initial_prompt: <span class="hljs-built_in">str</span>, test_data: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""优化提示词的主循环"""</span>
        root = MCTSNode(initial_prompt)
        
        <span class="hljs-keyword">for</span> iteration <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.max_iterations):
            node = root
            
            <span class="hljs-comment"># 1. 选择阶段</span>
            <span class="hljs-keyword">while</span> node.children:
                node = <span class="hljs-built_in">max</span>(node.children, key=<span class="hljs-keyword">lambda</span> child: child.uct_value(self.exploration_constant))
            
            <span class="hljs-comment"># 2. 扩展阶段</span>
            <span class="hljs-keyword">if</span> self.should_expand(node):
                new_prompts = self.generate_prompt_variations(node.prompt)
                <span class="hljs-keyword">for</span> new_prompt <span class="hljs-keyword">in</span> new_prompts:
                    child_node = MCTSNode(new_prompt, parent=node)
                    node.add_child(child_node)
                
                <span class="hljs-keyword">if</span> node.children:
                    node = node.children[<span class="hljs-number">0</span>]  <span class="hljs-comment"># 选择第一个子节点进行模拟</span>
            
            <span class="hljs-comment"># 3. 模拟阶段</span>
            simulation_reward = self.evaluate_prompt(node.prompt, test_data)
            
            <span class="hljs-comment"># 4. 反向传播阶段</span>
            <span class="hljs-keyword">while</span> node:
                node.update(simulation_reward)
                node = node.parent
        
        <span class="hljs-comment"># 选择访问次数最多的节点作为最优提示</span>
        best_node = <span class="hljs-built_in">max</span>(root.children, key=<span class="hljs-keyword">lambda</span> child: child.visits) <span class="hljs-keyword">if</span> root.children <span class="hljs-keyword">else</span> root
        <span class="hljs-keyword">return</span> best_node.prompt
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_prompt_variations</span>(<span class="hljs-params">self, prompt: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""生成提示词变体（模拟优化器模型）"""</span>
        <span class="hljs-comment"># 在实际应用中，这里会调用优化器模型（如GPT-4）生成变体</span>
        <span class="hljs-comment"># 以下是模拟的变体生成逻辑</span>
        
        variations = []
        
        <span class="hljs-comment"># 变体1：添加结构化约束</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"逐步"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> prompt:
            variations.append(<span class="hljs-string">f"<span class="hljs-subst">{prompt}</span>\n请按步骤思考，并确保每一步的正确性。"</span>)
        
        <span class="hljs-comment"># 变体2：强调准确性</span>
        variations.append(<span class="hljs-string">f"<span class="hljs-subst">{prompt}</span>\n请确保回答基于事实，避免猜测。"</span>)
        
        <span class="hljs-comment"># 变体3：简化表达</span>
        simplified = prompt.replace(<span class="hljs-string">"请"</span>, <span class="hljs-string">""</span>).replace(<span class="hljs-string">"要求"</span>, <span class="hljs-string">"需要"</span>)
        variations.append(simplified)
        
        <span class="hljs-keyword">return</span> variations
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">should_expand</span>(<span class="hljs-params">self, node: MCTSNode</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断节点是否应该扩展"""</span>
        <span class="hljs-keyword">return</span> node.visits &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(node.children) == <span class="hljs-number">0</span>
</code></pre>
<h3 data-id="heading-15">4.3 使用示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 模拟的任务模型（实际使用时替换为真实LLM调用）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MockTaskModel</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">self, prompt: <span class="hljs-built_in">str</span>, input_text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-comment"># 模拟生成答案的逻辑</span>
        <span class="hljs-comment"># 实际应用中这里会调用GPT、Claude等API</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"加法"</span> <span class="hljs-keyword">in</span> prompt:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"结果：5"</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未知答案"</span>

<span class="hljs-comment"># 模拟的测试数据</span>
test_data = [
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"2+3"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"结果：5"</span>},
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"7-4"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"结果：3"</span>},
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"6×2"</span>, <span class="hljs-string">"output"</span>: <span class="hljs-string">"结果：12"</span>}
]

<span class="hljs-comment"># 初始化MCTS优化器</span>
optimizer = PromptOptimizationMCTS(
    task_model=MockTaskModel(),
    optimizer_model=<span class="hljs-literal">None</span>,  <span class="hljs-comment"># 实际使用时可传入优化器模型</span>
    max_iterations=<span class="hljs-number">50</span>
)

<span class="hljs-comment"># 初始提示</span>
initial_prompt = <span class="hljs-string">"请计算以下数学表达式："</span>

<span class="hljs-comment"># 执行优化</span>
optimized_prompt = optimizer.optimize_prompt(initial_prompt, test_data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"初始提示：<span class="hljs-subst">{initial_prompt}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"优化后提示：<span class="hljs-subst">{optimized_prompt}</span>"</span>)

<span class="hljs-comment"># 评估优化效果</span>
initial_score = optimizer.evaluate_prompt(initial_prompt, test_data)
optimized_score = optimizer.evaluate_prompt(optimized_prompt, test_data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"初始提示准确率：<span class="hljs-subst">{initial_score:<span class="hljs-number">.2</span>%}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"优化后提示准确率：<span class="hljs-subst">{optimized_score:<span class="hljs-number">.2</span>%}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"提升幅度：<span class="hljs-subst">{optimized_score - initial_score:<span class="hljs-number">.2</span>%}</span>"</span>)
</code></pre>
<h2 data-id="heading-16">五、prompt-minder.com实战价值</h2>
<h3 data-id="heading-17">5.1 提示词质量评估标准化</h3>
<p>在MCTS框架的"提示评估"环节，<strong>prompt-minder.com的自动化评估模块</strong>提供了以下核心价值：</p>

























<table><thead><tr><th>功能模块</th><th>技术价值</th><th>商业效益</th></tr></thead><tbody><tr><td>自动化评估</td><td>快速验证不同提示词变体表现</td><td>评估效率提升80%</td></tr><tr><td>质量标准化</td><td>避免人工评估的主观偏差</td><td>结果一致性提高90%</td></tr><tr><td>流程集成</td><td>实现提示优化流程标准化</td><td>开发周期缩短60%</td></tr></tbody></table>
<h3 data-id="heading-18">5.2 实际数据对比</h3>
<p>在技术文档问答任务上的效果验证：</p>























<table><thead><tr><th>优化方案</th><th>准确率</th><th>调试时间</th><th>维护成本</th></tr></thead><tbody><tr><td>手动设计</td><td>85%</td><td>8小时/周</td><td>高</td></tr><tr><td><strong>prompt-minder.com</strong></td><td><strong>92%</strong></td><td><strong>1小时/周</strong></td><td><strong>低</strong></td></tr></tbody></table>
<p><strong>核心优势：</strong></p>
<ol>
<li><strong>效果提升7%</strong>：专业工具带来额外增益</li>
<li><strong>效率提升8倍</strong>：自动化模板优化</li>
<li><strong>质量一致性</strong>：标准化设计流程</li>
<li><strong>持续优化</strong>：基于数据的迭代改进</li>
</ol>
<h3 data-id="heading-19">5.3 实施建议</h3>
<p>对于技术团队，结合MCTS框架与prompt-minder.com的最佳实践：</p>
<ol>
<li><strong>快速启动</strong>：使用prompt-minder.com生成基础模板，作为MCTS搜索的初始点</li>
<li><strong>自动化评估</strong>：将prompt-minder.com的API集成到MCTS的评估环节，实现客观评分</li>
<li><strong>持续迭代</strong>：基于历史评估数据，训练专属的提示优化策略</li>
<li><strong>知识沉淀</strong>：将优化的Prompt纳入团队知识库，形成可复用的资产</li>
</ol>
<h2 data-id="heading-20">六、总结与展望</h2>
<h3 data-id="heading-21">6.1 技术总结</h3>
<p>2025年Prompt Engineering新范式的核心突破在于：</p>
<ol>
<li><strong>研究科学性</strong>：基于大规模统计测试，揭示传统技巧的局限性，强调模型能力边界</li>
<li><strong>方法创新性</strong>：引入MCTS等搜索算法，实现提示优化的系统化探索</li>
<li><strong>工具专业化</strong>：自动化提示优化（APE）走向工业化，提升效率与效果</li>
<li><strong>价值实用性</strong>：为开发者提供可落地的技术方案，解决真实业务问题</li>
</ol>
<h3 data-id="heading-22">6.2 未来方向</h3>
<p>随着AI技术的快速发展，Prompt Engineering将呈现以下趋势：</p>
<ol>
<li><strong>模型自适应</strong>：提示优化将更多考虑模型特性和能力边界</li>
<li><strong>任务智能化</strong>：自动化工具将更智能地理解任务需求，生成针对性提示</li>
<li><strong>工程标准化</strong>：提示工程将形成标准化的开发流程和评估体系</li>
<li><strong>应用普及化</strong>：从专业开发者扩展到普通用户，成为AI交互的基础技能</li>
</ol>
<h3 data-id="heading-23">6.3 对开发者的启示</h3>
<p>对于正在探索AI应用开发的工程师：</p>
<ol>
<li><strong>拥抱新范式</strong>：从"手动炼丹"转向"系统优化"，利用MCTS等算法探索提示空间</li>
<li><strong>善用专业工具</strong>：集成prompt-minder.com等平台，提升提示优化效率和效果</li>
<li><strong>关注研究进展</strong>：紧跟学术界最新成果，及时更新技术栈和方法论</li>
<li><strong>重视实践验证</strong>：在实际业务场景中测试和迭代，找到最适合的技术方案</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《实时渲染》第2章-图形渲染管线-2.4光栅化]]></title>    <link>https://juejin.cn/post/7598402961904304180</link>    <guid>https://juejin.cn/post/7598402961904304180</guid>    <pubDate>2026-01-23T13:08:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598402961904304180" data-draft-id="7598403436698632226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《实时渲染》第2章-图形渲染管线-2.4光栅化"/> <meta itemprop="keywords" content="计算机图形学"/> <meta itemprop="datePublished" content="2026-01-23T13:08:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《实时渲染》第2章-图形渲染管线-2.4光栅化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T13:08:40.000Z" title="Fri Jan 23 2026 13:08:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>实时渲染</strong></h2>
<h2 data-id="heading-1">2. 图形渲染管线</h2>
<h3 data-id="heading-2">2.4 光栅化</h3>
<p>顶点及其关联的着色数据（全部来自几何处理阶段）在进行变换和投影后，下一阶段的目标是找到所有像素（图片元素的缩写），这些像素位于要渲染的图元内部，例如三角形。我们将此过程称为光栅化，它分为两个功能子阶段：三角形设置（也称为图元组装）和三角形遍历。它们显示在图2.8的左侧。请注意，这些也可以处理点和线，但由于三角形最常见，因此子阶段的名称中带有“三角形”。因此，光栅化也称为扫描转换，是将屏幕空间中的二维顶点（每个顶点具有z值（深度值）和与每个顶点关联的各种着色信息）转换为屏幕上的像素。光栅化也可以被认为是几何处理和像素处理之间的同步点，因为在这里三角形由三个顶点形成并最终发送到像素处理。</p>
<div align="center">
<p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/a6e3eaaaaa5e47d8ae073914b0383898~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiMTExNzU0OTc3MDg0Njg3MiJ9&amp;rk3s=e9ecf3d6&amp;x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&amp;x-orig-expires=1769260076&amp;x-orig-sign=%2FBgjUealT1tjtN183xJCGm%2Bj7qU%3D" alt="" loading="lazy"/></p>
</div>
<div align="center">
<p>图2.8. 左：光栅化分为两个功能阶段，称为三角形设置和三角形遍历。右：像素处理分为两个功能阶段，即像素着色和合并。</p>
</div>
<p>是否认为三角形与像素重叠取决于您如何设置GPU的管线。例如，您可以使用点抽样来确定“内部性”。最简单的情况是在每个像素的中心使用单点样本，因此如果该中心点在三角形内部，那么相应的像素也被视为三角形内部。您还可以使用超级采样或多重采样抗锯齿技术（<a href="https://link.juejin.cn?target=%255Bnetlink5.4%255D" target="_blank" title="%5Bnetlink5.4%5D" ref="nofollow noopener noreferrer">第5.4.2节</a>）为每个像素使用多个样本。另一种方法是使用保守光栅化，其中的定义是，如果像素的至少一部分与三角形重叠，则像素位于三角形“内部”（<a href="https://link.juejin.cn?target=%25E7%25AC%25AC23.1.2%25E8%258A%2582" target="_blank" title="%E7%AC%AC23.1.2%E8%8A%82" ref="nofollow noopener noreferrer">第23.1.2节</a>）。</p>
<h4 data-id="heading-3">2.4.1 三角形设置</h4>
<p>在这个阶段，计算三角形的微分、边方程和其他数据。这些数据可用于三角形遍历（<a href="https://link.juejin.cn?target=https%3A%2F%2Fcharlee44.com%2Fpost.html%3Fid%3Dab238562e9614b21936875b990a2544a%232-4-2-%25E4%25B8%2589%25E8%25A7%2592%25E5%25BD%25A2%25E9%2581%258D%25E5%258E%2586" target="_blank" title="https://charlee44.com/post.html?id=ab238562e9614b21936875b990a2544a#2-4-2-%E4%B8%89%E8%A7%92%E5%BD%A2%E9%81%8D%E5%8E%86" ref="nofollow noopener noreferrer">第2.4.2节</a>），以及用于几何阶段产生的各种着色数据的插值。这个任务通常是硬件的固定功能。</p>
<h4 data-id="heading-4">2.4.2 三角形遍历</h4>
<p>在这个阶段，会检查每个像素中心（或样本）被三角形覆盖的位置，并为与三角形重叠的像素部分生成片元。更详细的抽样方法可以在<a href="https://link.juejin.cn?target=%25E7%25AC%25AC5.4%25E8%258A%2582" target="_blank" title="%E7%AC%AC5.4%E8%8A%82" ref="nofollow noopener noreferrer">第5.4节</a>中找到。查找三角形内的样本或像素通常称为三角形遍历。每个三角形片元的属性是使用在三个三角形顶点之间插入的数据生成的（<a href="https://link.juejin.cn?target=%25E7%25AC%25AC5%25E7%25AB%25A0" target="_blank" title="%E7%AC%AC5%E7%AB%A0" ref="nofollow noopener noreferrer">第5章</a>）。这些属性包括片段的深度，以及来自几何阶段的任何着色数据。McCormack等人在文献[1162]中提到了有关三角形遍历的更多信息。也是在这个阶段，对三角形执行透视校正插值[694]（<a href="https://link.juejin.cn?target=netlink23.1" target="_blank" title="netlink23.1" ref="nofollow noopener noreferrer">第23.1.1节</a>）。然后将图元内的所有像素或样本发送到像素处理阶段，这个下述章节会进行论述。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微软官方出品的 AI 初学者入门精品课程，21节课程教你构建生成式人工智能应用所需掌握的知识！]]></title>    <link>https://juejin.cn/post/7598507330859728938</link>    <guid>https://juejin.cn/post/7598507330859728938</guid>    <pubDate>2026-01-23T13:20:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598507330859728938" data-draft-id="7598398537248800787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微软官方出品的 AI 初学者入门精品课程，21节课程教你构建生成式人工智能应用所需掌握的知识！"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-23T13:20:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微软官方出品的 AI 初学者入门精品课程，21节课程教你构建生成式人工智能应用所需掌握的知识！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T13:20:01.000Z" title="Fri Jan 23 2026 13:20:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在人工智能浪潮席卷全球的当下，生成式 AI 正以前所未有的速度重塑着各个行业。为助力初学者快速踏入这一前沿领域，微软官方精心打造了这门 AI 初学者入门精品课程：<strong>Generative AI for Beginners</strong>。</p>
<h2 data-id="heading-1">课程介绍</h2>
<p>Generative AI for Beginners 课程包含 21 节干货满满的课时，从基础概念到实践应用，全方位、系统性地传授构建生成式人工智能应用所需掌握的核心知识。内容涵盖大语言模型原理、提示工程、RAG、AI Agent、图像生成、负责任 AI、安全与用户体验等关键主题，并提供 Python 与 TypeScript 双语言代码示例，帮助学习者边学边练。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee69de74c1ec44be918ad65b2115638f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=Pb4wAqEvHE%2FJzIMV%2BjX124lR4SQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">支持多语言</h2>
<p>本课程支持以下 50 多种语言：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/074fb8c696fb44279b0dce26a35be8a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=PAm7%2BzsYX65x64gDtMbj%2FE3fQ%2BQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">生成式人工智能初学者（Python 与 TypeScript版）课程列表</h2>
<p>通过微软云布道者的21节全面课程，学习构建生成式人工智能应用的基础知识。</p>
<ul>
<li><strong>生成式人工智能初学者（Python 与 TypeScript版）：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fgenerative-ai-for-beginners" target="_blank" title="https://github.com/microsoft/generative-ai-for-beginners" ref="nofollow noopener noreferrer">github.com/microsoft/g…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57a1b0d478ca4f9cb09c998fdabdaaef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=0ypOE%2F9Pnwf2Y3muWGtzZsm1kQ4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c3d258e3b645f39b36458a8f5b56bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=RDJOpNvw5EtySu4MvGgPSrxKWMs%3D" alt="" loading="lazy"/></p>
<p><strong>面向初学者的生成式 AI 视频教程：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fshows%2Fgenerative-ai-for-beginners%2F" target="_blank" title="https://learn.microsoft.com/zh-cn/shows/generative-ai-for-beginners/" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/shows…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b5de73f7a334848b082bb751ac01680~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=oEJ62xlSjOaU4KGe%2Fc%2FQ8aR%2BAJI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">生成式人工智能初学者（.NET版）</h2>
<p>实用课程教你如何在.NET 中构建生成式人工智能应用。</p>
<ul>
<li><strong>生成式人工智能初学者（.NET版）：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FGenerative-AI-for-beginners-dotnet" target="_blank" title="https://github.com/microsoft/Generative-AI-for-beginners-dotnet" ref="nofollow noopener noreferrer">github.com/microsoft/G…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6d6546efa0d4b56865237cbbf220c9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=dxzMA9mVgDjTIl3Il7aBpCTIKAM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56942043f46a491ea16dcdad5f07e469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=tp2scsY1vEVhTZvW0hriPLa6CbA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">AI实战从入门到精通</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8b5a1409acc4b25bf743197f6cc9501~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769779200&amp;x-signature=iWdvi%2FTb6fK68aVXojknukvHSxI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[97毫秒极致响应！Qwen3-TTS开源，重新定义语音生成的“速度与激情”]]></title>    <link>https://juejin.cn/post/7598366933079965750</link>    <guid>https://juejin.cn/post/7598366933079965750</guid>    <pubDate>2026-01-23T12:32:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598366933079965750" data-draft-id="7598398537248702483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="97毫秒极致响应！Qwen3-TTS开源，重新定义语音生成的“速度与激情”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-23T12:32:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            97毫秒极致响应！Qwen3-TTS开源，重新定义语音生成的“速度与激情”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T12:32:34.000Z" title="Fri Jan 23 2026 12:32:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年的开年大戏，比我们预想的来得更早了一些。</p>
<p>就在1月22日，当大家还在讨论大语言模型的逻辑推理能力时，阿里通义千问团队悄无声息地在语音生成领域扔下了一枚重磅炸弹：Qwen3-TTS系列模型正式开源。</p>
<p>这不仅仅是“又一个”开源模型，这是一次对“实时交互”的暴力美学展示。作为长期关注AI底层技术的观察者，我拿到技术报告的第一眼，就被那个数字击中了——97毫秒。</p>
<p>今天，我们就来聊聊这个让开发者直呼“真香”，让商业闭源模型感到压力的Qwen3-TTS到底强在哪里。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fasdkfcsdf-1024x475.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/asdkfcsdf-1024x475.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ef83a83c2bd48b3b6edec08e43c8fe3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769776354&amp;x-signature=quaMLyVZZKP0kIsBMfkqdvqYITg%3D" alt="asdkfcsdf" loading="lazy"/></a></p>
<h3 data-id="heading-0">告别进度条：当生成速度快过你的语速</h3>
<p>过去两三年，语音合成（TTS）最大的痛点是什么？是延迟。</p>
<p>你对着AI助手说了一句话，屏幕转圈圈，三秒后它才慢条斯理地开口。这种割裂感，是阻碍AI像真人一样交流的最大那堵墙。</p>
<p>Qwen3-TTS最核心的突破，在于它自研的“Dual-Track双轨混合流式生成”架构。通俗点说，以前的模型是“想好整句话再开口”，而Qwen3-TTS是“边想边说”。配合极其高效的12.5Hz多码本语音编码器，这个模型实现了只要你输入第一个字，音频数据包几乎同时也准备好了。</p>
<p>97毫秒的端到端延迟是什么概念？人类眨眼一次大约需要300毫秒。也就是说，在你还没眨完眼的瞬间，声音已经出来了。这意味着在直播、实时同传、甚至不仅是客服，而是真正拟人化的AI伴侣场景中，机器的反应速度终于追上了人类的生理直觉。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fewifowoiedgfsd-1024x714.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/ewifowoiedgfsd-1024x714.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41544d84b4194ffc8eb0db53604d41d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769776354&amp;x-signature=%2BByvGmjcwTXsLZ1OXKZG%2B%2FaX%2F2g%3D" alt="ewifowoiedgfsd" loading="lazy"/></a></p>
<h3 data-id="heading-1">上帝视角：捏出你想要的声音</h3>
<p>除了快，Qwen3-TTS还解决了一个“像不像”的问题。</p>
<p>这次开源提供了两个参数量级：0.6B和1.7B。其中1.7B版本不仅是性能怪兽，更是一个声音设计师。</p>
<p>以前我们要定制音色，往往需要录制几小时的干音，各种清洗数据，流程繁琐。现在，Qwen3-TTS把这个门槛降到了地板上。</p>
<p><strong>音色克隆</strong>：只需要3秒。是的，你没看错，一段3秒的参考音频，它就能精准捕捉到音色特征。而且不仅是复制声音，它还能跨语言。你给它一段中文录音，它能用同样的音色说出流利的法语或俄语。</p>
<p><strong>音色创造</strong>：这才是最好玩的地方。如果你连参考音频都没有，完全没问题。你可以像写小说一样用自然语言描述：“一个清澈的年轻女声，语气里带着一点欢快和调皮。”模型就能根据这段Prompt，凭空“捏”出一个符合要求的声音。这种基于指令的控制能力，直接把导演的活儿交给了用户。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffsasgsfd-1024x756.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fsasgsfd-1024x756.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1322bf9e9494292aa44d1148a84d7fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769776354&amp;x-signature=lRaxC%2BwikdS083ygpwQ8qaQacdc%3D" alt="fsasgsfd" loading="lazy"/></a></p>
<h3 data-id="heading-2">十国语言，方言也不在话下</h3>
<p>在全球化支持上，通义千问这次也是诚意满满。模型原生支持中文、英语、日语、韩语、德语、法语、俄语、葡萄牙语、西班牙语、意大利语这10种主流语言。</p>
<p>更有趣的是，它懂方言。四川话的麻辣、粤语的抑扬顿挫，它都能拿捏。在长文本测试中，即便是合成10分钟的长语音，中英文的词错率也控制在了2%左右的极低水平，这意味着它完全具备了制作有声书、长视频配音的生产力水准。</p>
<h3 data-id="heading-3">开源的诚意：Apache 2.0</h3>
<p>最后，不得不提的是这次的开源策略。</p>
<p>没有遮遮掩掩，没有仅供研究。Qwen3-TTS直接采用了Apache 2.0协议，这意味着不管是个人开发者想做个好玩的Demo，还是初创公司想把它集成到商业产品里，大门都是敞开的。</p>
<p>如果你追求极致效果，选1.7B模型；如果你资源有限，需要在边缘设备上跑，0.6B模型就是为你准备的。代码、权重、文档，全部在GitHub、Hugging Face和ModelScope上整整齐齐地摆好了。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fsafsdfsd-1024x415.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/safsdfsd-1024x415.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/365f356dfec54918bb7e1533a3750d82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769776354&amp;x-signature=F1Arab%2F%2B4zd6YLC0b0fFXmw692Y%3D" alt="safsdfsd" loading="lazy"/></a></p>
<p>总的来说，Qwen3-TTS的出现，标志着高质量语音生成技术不再是少数大厂的专利。从今天开始，任何一个普通开发者，都有能力构建出那个《Her》电影里一样，反应敏捷、声音动听的AI伙伴。</p>
<p>语音交互的“iPhone时刻”，或许真的就在2026年的这个一月，悄然开始了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 泛型]]></title>    <link>https://juejin.cn/post/7598390244379983910</link>    <guid>https://juejin.cn/post/7598390244379983910</guid>    <pubDate>2026-01-23T12:36:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390244379983910" data-draft-id="7598116600903073801" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 泛型"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-23T12:36:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jony_"/> <meta itemprop="url" content="https://juejin.cn/user/3403743732709767"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 泛型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743732709767/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jony_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T12:36:40.000Z" title="Fri Jan 23 2026 12:36:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="sunburst">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#000;color:#f8f8f8}.hljs-comment,.hljs-quote{color:#aeaeae;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#e28964}.hljs-string{color:#65b042}.hljs-subst{color:#daefa3}.hljs-link,.hljs-regexp{color:#e9c062}.hljs-name,.hljs-section,.hljs-tag,.hljs-title{color:#89bdff}.hljs-class .hljs-title,.hljs-doctag{text-decoration:underline}.hljs-bullet,.hljs-number,.hljs-symbol{color:#3387cc}.hljs-params,.hljs-template-variable,.hljs-variable{color:#3e87e3}.hljs-attribute{color:#cda869}.hljs-meta{color:#8996a8}.hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-selector-class{color:#9b703f}.hljs-selector-id{color:#8b98ab}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>泛型在编码过程中的好处：</p>
<ol>
<li>提高 Api 设计的灵活性</li>
<li>运行时异常提前暴露到编译期</li>
</ol>
<h2 data-id="heading-1">二、泛型分类</h2>
<h3 data-id="heading-2">1. 泛型类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span>&lt;T&gt; {
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">convertData</span><span class="hljs-params">(T date)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-3">2. 泛型方法</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> &lt;T, E&gt; T <span class="hljs-title function_">fetchData</span><span class="hljs-params">(E e)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h3 data-id="heading-4">3. 泛型接口</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ClickListener</span>&lt;V&gt; {}
</code></pre>
<h2 data-id="heading-5">三、泛型通配符</h2>
<h3 data-id="heading-6">1. 上界通配符</h3>
<p>在 Java 中，上界通配符是 extend。带有上界通配符泛型类如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span>&lt;T, L <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Listener</span>&gt; {
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">convertData</span><span class="hljs-params">(T date)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">public</span> L listener;
    <span class="hljs-keyword">public</span> L <span class="hljs-title function_">fetchListener</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> listener;
    }
}
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Listener</span> { }
</code></pre>
<p>对应 <strong>Kotlin</strong> 中的 <strong>out</strong>，写法如下：</p>
<h3 data-id="heading-7">2. 下届通配符</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span>&lt;<span class="hljs-type">T, out L : Listener</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">convertData</span><span class="hljs-params">(date: <span class="hljs-type">T</span>)</span></span>: T? {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> listener: L? = <span class="hljs-literal">null</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchListener</span><span class="hljs-params">()</span></span>: L? {
        <span class="hljs-keyword">return</span> listener;
    }
}
</code></pre>
<h3 data-id="heading-8">3. PECS 原则</h3>
<p>Java 的泛型是不变的，例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Object&gt;()); <span class="hljs-comment">// 报错 ！！！！❌ List&lt;Number&gt; ≠ List&lt;Object&gt; </span>
}
<span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(List&lt;Number&gt; dest)</span> {
    dest.add(<span class="hljs-number">1</span>);            
    dest.add(<span class="hljs-number">1.1</span>);
}
</code></pre>
<p>如果这么生命 write() 函数就没有问题：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(List&lt;? <span class="hljs-built_in">super</span> Number&gt; dest)</span> {
    dest.add(<span class="hljs-number">1</span>);
    dest.add(<span class="hljs-number">1.1</span>);
}
</code></pre>
<p>这么声明的好处如下：</p>
<ol>
<li>Number 类型及其子类能够被写入到集合中</li>
<li>允许<strong>List[Number]</strong> 和  <strong>List[Object]</strong> 作为参数</li>
</ol>
<p>使用泛型通配符，需要遵守 PECS 原则。Extend 只能读取数据，Super 只能写入数据（可以接收的数据类型是 Object）。</p>
<ul>
<li>P：Producer，生产者只能读数据</li>
<li>E：Extends</li>
<li>C：Consumer，消费者只能写入数据</li>
<li>S：Super</li>
</ul>
<p>Collections.copy 源码签名如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">copy</span><span class="hljs-params">(
    List&lt;? <span class="hljs-built_in">super</span> T&gt; dest,
    List&lt;? extends T&gt; src
)</span>
</code></pre>
<ul>
<li><code>src</code>：只读，提供 T → <code>extends</code></li>
<li><code>dest</code>：只写，接收 T → <code>super</code></li>
</ul>
<h2 data-id="heading-9">四、泛型擦处</h2>
<p>泛型擦处是指：在编译的时候使用泛型，在运行的时对类型进行替换。例如：</p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">// 编译时</span>

<span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>(); <span class="hljs-comment">// 运行时</span>
</code></pre>
<p>进行泛型擦除的主要目的，是因为泛型是在1.5才出现，为了确保之前的代码和 JVM 完全兼容。当然擦除也带来了一些问题：</p>
<ol>
<li>无法在运行时获取 T 的类型</li>
<li>无法 new T()</li>
<li>无法创建泛型数组</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebAssembly入门（二）——Rust编译wasm全流程]]></title>    <link>https://juejin.cn/post/7598390244379836454</link>    <guid>https://juejin.cn/post/7598390244379836454</guid>    <pubDate>2026-01-23T11:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390244379836454" data-draft-id="7598370121435889714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebAssembly入门（二）——Rust编译wasm全流程"/> <meta itemprop="keywords" content="前端,Rust"/> <meta itemprop="datePublished" content="2026-01-23T11:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="布列瑟农的星空"/> <meta itemprop="url" content="https://juejin.cn/user/976022056218471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebAssembly入门（二）——Rust编译wasm全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022056218471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    布列瑟农的星空
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T11:04:20.000Z" title="Fri Jan 23 2026 11:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将手把手介绍如何将rust编写的函数打包为wasm供js使用，并解释其关键配置和实践中的常见问题。</p>
<h2 data-id="heading-0">5分钟快速上手</h2>
<h3 data-id="heading-1">1. 环境准备</h3>
<h4 data-id="heading-2">rust和cargo</h4>
<p>rust环境安装教程参考如下：</p>
<ul>
<li>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Frust-lang.org%2Fzh-CN%2Ftools%2Finstall%2F" target="_blank" title="https://rust-lang.org/zh-CN/tools/install/" ref="nofollow noopener noreferrer">rust-lang.org/zh-CN/tools…</a></li>
<li>rust圣经：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcourse.rs%2Ffirst-try%2Finstallation.html" target="_blank" title="https://course.rs/first-try/installation.html" ref="nofollow noopener noreferrer">course.rs/first-try/i…</a></li>
</ul>
<p>可执行<code>rustc --version</code>和<code>cargo --version</code>验证安装，如果没问题会有如下类似输出</p>
<pre><code class="hljs language-scss" lang="scss">rustc <span class="hljs-number">1.92</span><span class="hljs-selector-class">.0</span> (ded5c06cf <span class="hljs-number">2025</span>-<span class="hljs-number">12</span>-<span class="hljs-number">08</span>)
cargo <span class="hljs-number">1.92</span><span class="hljs-selector-class">.0</span> (<span class="hljs-number">344</span>c4567c <span class="hljs-number">2025</span>-<span class="hljs-number">10</span>-<span class="hljs-number">21</span>)
</code></pre>
<h4 data-id="heading-3">wasm编译目标和 wasm-pack</h4>
<p>执行以下命令；</p>
<pre><code class="hljs language-sql" lang="sql">rustup target <span class="hljs-keyword">add</span> wasm32<span class="hljs-operator">-</span><span class="hljs-literal">unknown</span><span class="hljs-operator">-</span><span class="hljs-literal">unknown</span>
</code></pre>

<pre><code class="hljs language-perl" lang="perl"> cargo install wasm-<span class="hljs-keyword">pack</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">2. rust lib项目创建</h3>
<p>cargo相当于js的npm，可以用cargo创建一个lib：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">cargo <span class="hljs-built_in">new</span> test-rust-<span class="hljs-keyword">lib</span> --<span class="hljs-keyword">lib</span>
</code></pre>
<p>--lib是生成库，默认是--bin，也就是生成项目。两者的区别是前者会在src下生成lib.rs，后者是mian.rs。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa62f4cfb90c4f6891cc44ad9045f5db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769771059&amp;x-signature=zJLk6E0HG7jZiuqZW4VXRjpnQyc%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">3. 修改Cargo.toml</h3>
<p>修改Cargo.toml，添加依赖和lib配置</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[package]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"test-rust-lib"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"0.1.0"</span>
<span class="hljs-attr">edition</span> = <span class="hljs-string">"2024"</span>
<span class="hljs-section">[lib]</span>
<span class="hljs-attr">crate-type</span> = [<span class="hljs-string">"cdylib"</span>]
<span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">wasm-bindgen</span> = <span class="hljs-string">"0.2"</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">4.编写rust代码</h3>
<p>这里用项目默认的add为例，使用 wasm_bindgen 宏标记要导出的函数：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> wasm_bindgen::prelude::*;
<span class="hljs-meta">#[wasm_bindgen]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">add</span>(left: <span class="hljs-type">u64</span>, right: <span class="hljs-type">u64</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">u64</span> {
    left + right
}
</code></pre>
<hr/>
<h3 data-id="heading-7">5.编译和发布</h3>
<p>执行以下命令即可在当前项目的pkg文件中生成wasm文件</p>
<pre><code class="hljs language-css" lang="css"> wasm-pack build <span class="hljs-attr">--target</span> web
</code></pre>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/566abaf6bb754fc98aa38520cec8a3f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769771059&amp;x-signature=BTvlJ%2F8k%2Fsg3FelX08ZXKPquZs4%3D" alt="image.png" loading="lazy"/>
生成的文件里自带package.json，可以直接发布npm包</p>
<pre><code class="hljs">npm login
npm publish
</code></pre>
<h4 data-id="heading-8">本地测试</h4>
<p>方便起见，可以直接在项目的pkg目录中创建一个html进行测试：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>curve lib test<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="javascript">
     <span class="hljs-comment">//加载并执行...</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>加载打包出来的test_rust_lib.js：</p>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-comment">//加载并执行...</span>
  <span class="hljs-keyword">import</span> init, { add } <span class="hljs-keyword">from</span> <span class="hljs-string">"./test_rust_lib.js"</span>;<span class="hljs-comment">//或npm包</span>

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">init</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">1n</span>, <span class="hljs-number">2n</span>));
  }
  <span class="hljs-title function_">run</span>();
</code></pre>
<p>注意因为rust中定义的类型是u64,js中对应的是BigIng</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7076a2d0a5c46eba051a8fdbf5a4792~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769771059&amp;x-signature=mk4FjRtW90f2nJkbeiEzEW9LthE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">rust wasm进阶</h2>
<p>本节将详细解释wasm打包中的关键角色。</p>
<h3 data-id="heading-10">编译目标 wasm32-unknown-unknown</h3>
<p>如果你是第一次看到<code>wasm32-unknown-unknown</code>可能有点懵逼，
<code>wasm32-unknown-unknown</code> 是 <strong>Rust 的编译目标（target triple）</strong> ，代表你要把代码编译成 <strong>WebAssembly (WASM)</strong> 格式的二进制文件。</p>
<p>Rust 的 target 三元组（triple）一般形如：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">架构</span>&gt;</span>-<span class="hljs-tag">&lt;<span class="hljs-name">厂商</span>&gt;</span>-<span class="hljs-tag">&lt;<span class="hljs-name">操作系统</span>&gt;</span>
</code></pre>
<p>对于 <code>wasm32-unknown-unknown</code> 来说：</p>

























<table><thead><tr><th>部分</th><th>含义</th><th>说明</th></tr></thead><tbody><tr><td><code>wasm32</code></td><td>架构</td><td>32 位 WebAssembly 指令集（WASM 目前只定义了 32 位）</td></tr><tr><td><code>unknown</code></td><td>厂商</td><td>没有特定厂商（WebAssembly 是开放标准）</td></tr><tr><td><code>unknown</code></td><td>操作系统</td><td>没有底层 OS（WASM 在虚拟机环境中执行）</td></tr></tbody></table>
<p>换句话说，它的意思是：</p>
<blockquote>
<p>“编译为 32 位 WebAssembly 目标，独立于具体厂商或操作系统的环境。”</p>
</blockquote>
<p>下面是一些常见的target和适用环境</p>















































<table><thead><tr><th>Target</th><th>位数</th><th>环境</th><th>标准库</th><th>说明 / 场景</th></tr></thead><tbody><tr><td><strong><code>wasm32-unknown-unknown</code></strong></td><td>32 位</td><td>浏览器 / 纯 Web 环境</td><td>❌ 无 <code>std</code></td><td>✅ 浏览器最常用目标，配合 <code>wasm-bindgen</code></td></tr><tr><td><strong><code>wasm64-unknown-unknown</code></strong></td><td>64 位</td><td>浏览器（未来标准）</td><td>❌ 无 <code>std</code></td><td>🧪 实验中，支持 64 位寻址（&gt;4GB 内存）</td></tr><tr><td><strong><code>wasm32-wasi</code></strong></td><td>32 位</td><td>服务端 / CLI</td><td>✅ 有 <code>std</code></td><td>✅ 支持文件、环境变量、socket</td></tr><tr><td><strong><code>wasm64-wasi</code></strong></td><td>64 位</td><td>服务端 / CLI</td><td>✅ 有 <code>std</code></td><td>🧪 新兴，WASI 64-bit 支持大内存服务</td></tr><tr><td><strong><code>wasm32-unknown-emscripten</code></strong></td><td>32 位</td><td>浏览器 (旧方案)</td><td>✅ 有 <code>std</code></td><td>⚠️ 已过时，体积大，依赖 JS runtime</td></tr></tbody></table>
<p><strong>如果是浏览器加载，无脑<code>wasm32-unknown-unknown</code></strong></p>
<h3 data-id="heading-11">crate-type</h3>
<p>上文在toml文件中有如下配置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[lib]</span>
<span class="hljs-attr">crate-type</span> = [<span class="hljs-string">"cdylib"</span>, <span class="hljs-string">"rlib"</span>]
</code></pre>
<p>可能有人会问：<strong>什么是crate-type</strong></p>
<p>在 Rust 中，一个 crate（包）可以被编译成多种形式：</p>
<ul>
<li>可执行文件（<code>bin</code>）</li>
<li>静态库（<code>staticlib</code>）</li>
<li>动态库（<code>dylib</code> / <code>cdylib</code>）</li>
<li>Rust 库文件（<code>rlib</code>）</li>
<li>WebAssembly 模块（通过 <code>cdylib</code> 或 <code>wasm32-*</code> 目标）</li>
</ul>
<p><code>crate-type</code> 就是告诉编译器 “我要生成哪种类型的输出”。</p>
<hr/>
<p>主要类型说明:</p>



































<table><thead><tr><th>类型</th><th>说明</th><th>适用场景</th></tr></thead><tbody><tr><td><strong><code>rlib</code></strong></td><td>Rust 专用静态库格式（默认）</td><td>✅ 供其他 Rust crate 依赖</td></tr><tr><td><strong><code>cdylib</code></strong></td><td>C-compatible 动态库（<strong>推荐用于 FFI / WASM</strong>）</td><td>✅ 用于导出函数给其他语言（C, Python, JS等）</td></tr><tr><td><strong><code>dylib</code></strong></td><td>Rust 动态库（带 Rust 元数据）</td><td>⚠️ 较少使用，只能被 Rust 加载</td></tr><tr><td><strong><code>staticlib</code></strong></td><td>纯静态库（.a）</td><td>✅ 方便嵌入 C/C++ 程序</td></tr><tr><td><strong><code>bin</code></strong></td><td>可执行程序</td><td>用于 CLI 应用</td></tr></tbody></table>
<h3 data-id="heading-12">自定义类型的导出问题</h3>
<p>如果导出的函数里有自定义类型，比如下面代码，就会提示</p>
<blockquote>
<p>the trait bound <code>CurveFitConfig: FromWasmAbi</code> is not satisfied”</p>
</blockquote>
<p>比如下面这段代码：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[wasm_bindgen]</span> 
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">curve_fitting</span>(x: <span class="hljs-type">f64</span>, config: CurveFitConfig) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;<span class="hljs-type">f64</span>&gt; {
...
}
</code></pre>
<p>这里最佳的解决办法是<strong>JsValue和serde-wasm-bindgen</strong>,保持原函数不变，另导出一个给js调用的函数。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> serde_wasm_bindgen::from_value;

<span class="hljs-meta">#[wasm_bindgen]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">curve_fitting_wasm</span>(x: <span class="hljs-type">f64</span>, config: JsValue) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Option</span>&lt;<span class="hljs-type">f64</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">cfg</span>: CurveFitConfig = <span class="hljs-title function_ invoke__">from_value</span>(config).<span class="hljs-title function_ invoke__">ok</span>()?;
    <span class="hljs-title function_ invoke__">curve_fitting</span>(x, cfg)
}
</code></pre>
<p>对相应的类型增加序列化宏</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> serde::{Deserialize, Serialize};

<span class="hljs-meta">#[derive(Serialize, Deserialize)]</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CurveFitConfig</span> {
   ...
}

</code></pre>
<h3 data-id="heading-13">wasm导出函数的测试问题</h3>
<p>wasm导出函数，如果是在rust环境里测试，会报错</p>
<blockquote>
<p>cannot call wasm-bindgen imported functions on non-wasm targets</p>
</blockquote>
<p>最佳实践就是分层设计，单独写wasm导出函数：</p>
<ul>
<li>核心逻辑与 JS 绑定分离</li>
<li>普通 Rust 测试不依赖 wasm</li>
<li>wasm 函数只是一个“外层包装器”</li>
</ul>
<h3 data-id="heading-14">wasm-bindgen</h3>
<p>如果你看过上一篇文章<a href="https://juejin.cn/user/976022056218471/posts" target="_blank" title="https://juejin.cn/user/976022056218471/posts">《# WebAssembly入门（一）——Emscripten》</a>可能了解胶水代码的概念，wasm-bindgen就是提供js和rust交互的胶水代码用的。</p>
<p>其核心功能如下：</p>
<ul>
<li>‌<strong>类型转换</strong>‌：<code>wasm-bindgen</code> 自动处理 Rust 和 JavaScript 之间的类型转换，例如将 Rust 的字符串、数组、结构体等映射为 JavaScript 中的对应类型。</li>
<li>‌<strong>导出与导入函数</strong>‌：通过使用 <code>#[wasm_bindgen]</code> 属性宏，开发者可以轻松地将 Rust 函数导出给 JavaScript 调用，同时也可以在 Rust 中导入 JavaScript 函数。</li>
<li>‌<strong>内存管理</strong>‌：对于复杂类型如字符串或 DOM 对象，<code>wasm-bindgen</code> 会自动管理其生命周期，避免内存泄漏。</li>
<li>‌<strong>异步支持</strong>‌：它支持异步 Rust 代码，并能与 JavaScript 的异步机制协同工作。</li>
<li>‌<strong>事件与回调</strong>‌：支持定义和使用 JavaScript 的事件处理器和回调函数。</li>
</ul>
<h4 data-id="heading-15">init函数</h4>
<p>在使用 <code>wasm-pack</code> 打包 Rust 编写的 WebAssembly 模块时，生成的 JavaScript 胶水代码中会包含一个名为 <code>init</code> 的异步函数。这个函数是 WebAssembly 模块加载和初始化的核心入口，它负责完成以下关键任务：</p>
<ul>
<li>‌<strong>异步加载 <code>.wasm</code> 文件</strong>‌：通过 <code>fetch</code> 或 <code>import</code> 动态加载编译后的 WebAssembly 二进制文件。</li>
<li>‌<strong>实例化 Wasm 模块</strong>‌：将加载的字节码传递给浏览器的 WebAssembly API，创建可执行的模块实例。</li>
<li>‌<strong>绑定 JavaScript 接口</strong>‌：连接由 <code>#[wasm_bindgen]</code> 标记的 Rust 函数与 JavaScript 环境，使它们能被直接调用。</li>
<li>‌<strong>初始化内存与全局状态</strong>‌：设置 Wasm 模块的线性内存、导出的全局变量和内部状态，确保模块运行时环境就绪。</li>
</ul>
<p><code>init</code> 函数返回一个 <code>Promise</code>，因此在使用时必须使用 <code>await</code> 或 <code>.then()</code> 等待其完成。只有在 <code>init()</code> 成功解析后，你才能安全地调用任何从 Rust 导出的函数。</p>
<p>init的promise返回值中也可以获取到导出的函数
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32bb262be2b34924be9334a8e89f519a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769771059&amp;x-signature=4YCvLiSNVTth3xEYW4vloy%2FjRgg%3D" alt="image.png" loading="lazy"/></p>
<p>init函数，<strong>初次执行完成后，可以重复执行，没有副作用</strong>，这一点很多ai都回答的不对，但如果初次加载时同时执行多次，就会创建多个wasm instance。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a8293b57022408c91078f0d3cbae7d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biD5YiX55Gf5Yac55qE5pif56m6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769771059&amp;x-signature=TYD4Lo2Sw1H1FFAmmKx%2BPx22Z0A%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[仿普贴标签实现一个自己的app_接着写]]></title>    <link>https://juejin.cn/post/7598193992829141046</link>    <guid>https://juejin.cn/post/7598193992829141046</guid>    <pubDate>2026-01-23T11:21:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598193992829141046" data-draft-id="7598193992829091894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="仿普贴标签实现一个自己的app_接着写"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T11:21:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火柴就是我"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            仿普贴标签实现一个自己的app_接着写
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火柴就是我
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T11:21:15.000Z" title="Fri Jan 23 2026 11:21:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>已经实现的功能
<a href="https://juejin.cn/post/7581769891499032595" target="_blank" title="https://juejin.cn/post/7581769891499032595">juejin.cn/post/758176…</a></p>
<p>新功能:</p>
<p>1 <code>支持表格 线条保存</code></p>
<p>2 <code>修复一些bug 比如旋转之后部分区域不响应事件</code></p>
<p>3 <code>解决修改更新后，列表的图片没有及时刷新（因为路径一直有缓存）</code></p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c341470293c747278e939e7face773e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769772075&amp;x-signature=G6tWaQi4bjHDtYDo2QzXVhdc%2F6A%3D" alt="image.png" width="30%" loading="lazy"/>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FnewPersonKing%2Fflutter_label" target="_blank" title="https://github.com/newPersonKing/flutter_label" ref="nofollow noopener noreferrer">github.com/newPersonKi…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026年，我为什么越来越离不开NestJS + Monorepo]]></title>    <link>https://juejin.cn/post/7598355220830322740</link>    <guid>https://juejin.cn/post/7598355220830322740</guid>    <pubDate>2026-01-23T11:40:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598355220830322740" data-draft-id="7598355220830306356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026年，我为什么越来越离不开NestJS + Monorepo"/> <meta itemprop="keywords" content="前端,AI编程,NestJS"/> <meta itemprop="datePublished" content="2026-01-23T11:40:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="牛奶"/> <meta itemprop="url" content="https://juejin.cn/user/1169536100866487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026年，我为什么越来越离不开NestJS + Monorepo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536100866487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    牛奶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T11:40:08.000Z" title="Fri Jan 23 2026 11:40:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">2026年，我为什么越来越离不开 <code>NestJS</code> + <code>Monorepo</code></h2>
<p>2026 年，<code>AI</code> 辅助开发工具已经彻底融入了日常写代码的节奏。<code>Cursor</code>、<code>Claude Code</code>、<code>Trae</code>……它们不再是偶尔用的插件，而是每天打开 <code>IDE</code> 后第一个跳出来的“队友”。</p>
<p>用得越多，越能感受到一种微妙的落差：工具本身越来越聪明，生成的代码却常常在细节上出问题。依赖没导入、规范被忽略、类型对不上、<code>UI</code> 的风格不统一……这些小毛病加起来，让 <code>review</code> 的时间比生成代码的时间还长。有时候我甚至会想：<code>AI</code> 明明能写出 70% 的内容，为什么剩下的 30% 却让我这么累？</p>
<p>后来我慢慢意识到，问题不全在工具，而在“舞台”。给 <code>AI</code> 一个结构松散、上下文碎片的项目，它再怎么努力，也容易出错；给它一个边界清晰、类型强、模块分明的项目，它的第一轮输出往往就能直接 <code>merge</code>。</p>
<p><code>NestJS</code> + <code>Monorepo</code>（以 <code>Turborepo</code> 为主）就是我目前找到的最舒服的舞台。它没有太多花哨的新概念，却在 <code>AI</code> 时代把“结构即生产力”这件事做到了极致。</p>
<p>用这个组合后，我发现 <code>accept</code> 能稳定在 70% 以上，重构和扩展的成本大幅降低，全栈偏前端的体验也变得异常顺滑。不是因为它完美无缺，而是因为它让 <code>AI</code> 和我之间的配合，少了很多互相折腾，多了一些安静的默契。</p>
<h3 data-id="heading-1"><code>AI</code> 辅助开发的趋势</h3>
<p>2026 年，开发者使用 <code>AI</code> 辅助开发的比例已经达到了一个非常高的水平。根据各种社区调查、<code>GitHub</code> 数据和开发者论坛的反馈，绝大多数活跃开发者（尤其是前端、全栈、<code>Node.js</code> 生态）都已经把 <code>AI</code> 工具当作日常标配。</p>
<ul>
<li>超过 80% 的开发者每天至少使用一次 <code>AI</code> 编码工具（<code>Cursor</code>、<code>Trae</code>、<code>Claude Code</code>、<code>GitHub Copilot</code>、<code>Windsurf</code>、<code>Aider</code> 等）。</li>
<li>在 <code>TypeScript</code> / <code>JavaScript</code> 项目中，这个比例更高，接近 90%，因为强类型和结构化代码让 <code>AI</code> 的输出更可靠。</li>
<li>很多中高级开发者已经把“先让 <code>AI</code> 写初稿 → 我 <code>review</code> &amp; 微调”作为默认工作流，而不是“自己从零写”。</li>
</ul>
<p>为什么大家越来越喜欢用 <code>AI</code> 辅助开发？核心原因可以总结为三点：</p>
<ol>
<li>
<p><strong>效率提升明显且可感知</strong><br/>
写 <code>boilerplate</code>、<code>CRUD</code> 接口、类型定义、测试用例、甚至一些业务逻辑的初版，<code>AI</code> 都能在几十秒内完成。开发者把时间从“重复劳动”转移到“思考业务、设计架构、优化性能、安全审查”这些更有价值的部分。</p>
</li>
<li>
<p><strong>工具体验越来越“像人”</strong><br/>
2026 年的 <code>Cursor</code> 和 <code>Claude Code</code> 已经能很好地理解项目上下文：</p>
<ul>
<li><code>Cursor</code> 的 <code>Composer</code> 模式可以一次性修改多个文件，并保持一致性。</li>
<li><code>Claude Code</code> 的 <code>agentic</code> 能力允许它“先读代码 → 分析需求 → 规划步骤 → 写代码 → 自测 → 提交”。</li>
<li>很多开发者反馈：现在让 <code>AI</code> 写一个完整的 <code>feature</code>（前后端 + 类型 + 测试），成功率已经能稳定在 60–80%，远高于 2024 年的 30–40%。</li>
</ul>
</li>
<li>
<p><strong>社区与生态的正反馈循环</strong><br/>
越来越多项目公开分享 <code>.cursorrules</code>、<code>CLAUDE.md</code>、<code>prompt</code> 模板、<code>boilerplate</code>。<br/>
开发者看到别人用 <code>AI</code> 把一个中型 <code>SaaS</code> 后端一周内搭出来，就会想“我也试试”。<br/>
这种“看到别人用得好 → 我也想用 → 用得好 → 分享”形成了明显的正循环。</p>
</li>
</ol>
<h3 data-id="heading-2"><code>AI</code> 辅助开发的问题与痛点</h3>
<p>趋势看起来很美好，但实际用起来，经常是另一种风景。</p>
<p>我和大多数开发者一样，每天打开 <code>IDE</code> 第一件事就是让 <code>AI</code> 帮忙写代码。可越用越发现，工具再强，也常常在细节上“掉链子”。</p>
<p>这些问题不是偶发，而是系统性的，尤其在项目规模稍大、结构不清晰的时候，会被放大到让人抓狂的地步。</p>
<h4 data-id="heading-3">上下文碎片化</h4>
<p>当项目拆成多个 <code>repo</code>（前端一个、后端一个、<code>shared types</code> 又一个），<code>AI</code> 根本无法一次性看全依赖关系。</p>
<p>它会根据当前文件猜上下文，结果就是幻觉层出不穷：字段名拼错、类型不匹配、甚至把旧版本的接口逻辑带进来。</p>
<p>我试过用 <code>Cursor</code> 重构一个 <code>GO</code> 代码的逻辑，字段明明在 <code>DTO</code> 里定义好了，它还是给我写了个不存在的属性。</p>
<h4 data-id="heading-4">规范与风格不一致</h4>
<p><code>AI</code> 没有“记忆”你的项目约定。它不知道你用的是 <code>NestJS</code> 的 <code>DI</code> 还是纯函数式，不知道要加 <code>ValidationPipe</code> 还是手动校验，不知道 <code>auth</code> 要用 <code>Guard</code> 还是 <code>middleware</code>。</p>
<p>结果生成的代码风格五花八门：有的地方用 <code>class-validator</code>，有的直接 <code>if</code> 判断；有的地方注入 <code>service</code>，有的直接 <code>new</code> 一个。</p>
<p>后期维护时，这些小差异会像雪球一样越滚越大。</p>
<h4 data-id="heading-5">重构效率低下</h4>
<p>想改一个共享类型或调整 <code>auth</code> 逻辑？</p>
<p><code>AI</code> 改了当前文件，却漏掉其他 5 个依赖的地方。尤其是跨包修改时，<code>Cursor</code> 偶尔会“卡住”——不是工具问题，是项目结构让它没法高效追踪依赖。重构一次，本来 10 分钟的事，变成 1 小时+手动补漏。</p>
<h4 data-id="heading-6"><code>review</code> 成本居高不下</h4>
<p><code>AI</code> 能生成 60–80% 的代码，但剩下的 20–40% 往往是关键逻辑、安全边界、性能点。这些地方出错，后果严重，所以我几乎每段 <code>AI</code> 代码都要从头审一遍。</p>
<p>时间一长，感觉 <code>AI</code> 不是在帮我加速，而是在给我制造更多“看起来对但其实不对”的工作。</p>
<h4 data-id="heading-7">扩展功能时的破坏性</h4>
<p>项目本来是传统 <code>CRUD</code>，突然想加个简单的接口。结果要么大改架构，要么新建一个独立的模块，最后前后端割裂，类型又对不上。</p>
<p><code>AI</code> 时代，本该是“想加就加”的功能，却变成了“加了之后整个项目都乱了”。</p>
<p>这些痛点加起来，让我一度怀疑：<code>AI</code> 到底是生产力工具，还是另一个“看起来很美”的负担？</p>
<h3 data-id="heading-8">2026 年，<code>AI</code> 辅助开发已经进入“基础设施”阶段</h3>
<p>2026 年，<code>AI</code> 辅助开发已经从“炫技”阶段彻底进入“基础设施”阶段。</p>
<p>工具链的演进方向非常明确：<strong>从单行补全 → 多文件编辑 → 项目级上下文理解 → <code>agentic</code> 多步规划</strong>。</p>
<ul>
<li><strong>“2026 年的开发效率差距，不再是会不会用 <code>AI</code>，而是你的项目结构能不能让 <code>AI</code> 发挥出 70% 以上的命中率。”</strong></li>
</ul>
<p>数据也印证了这一点：</p>
<ul>
<li><code>GitHub Octoverse 2025</code> 显示，使用 <code>monorepo</code> 的仓库中，<code>AI</code> 生成代码的 <code>acceptance rate</code> 平均高出 28%。</li>
<li><code>Cursor</code> 官方在 2025 年底的报告里提到：在结构化项目（<code>TypeScript</code> + 明确的模块边界）里，用户平均 <code>accept</code> 率能稳定在 68–75%，而在“杂乱的 <code>Express</code> 项目”里，只有 42%。</li>
</ul>
<p>更重要的是，<code>AI</code> 工具的上下文窗口已经不再是瓶颈（200k <code>token</code> 随便用），真正的瓶颈变成了**“AI 能不能在 0.5 秒内看懂你的整个项目结构”**。</p>
<p>这时候，<code>monorepo</code> + 强规范框架的优势就彻底显现出来了。</p>
<p>简单来说，2026 年的趋势就是：</p>
<p><strong>AI 越来越聪明，但它更需要一个“聪明”的项目来配合。</strong></p>
<p>而 <code>NestJS</code> + <code>Monorepo</code> 正是我见过的最能把这种配合做到极致的组合。</p>
<h3 data-id="heading-9"><code>NestJS</code> + <code>Monorepo</code> 如何解决这些痛点</h3>
<p>上面提到的那些痛点，用一句话概括就是：<code>AI</code> 很聪明，但它需要一个“聪明”的项目来配合。</p>
<p><code>NestJS</code> + <code>Monorepo</code>（以 <code>Turborepo</code> 为主）正是我目前找到的最能让 <code>AI</code> “配合好”的组合。它不是靠什么黑科技，而是靠结构本身把 <code>AI</code> 的命中率从 30–40% 拉到 70%+，甚至更高。</p>
<p>下面按痛点一一对应，说说这个组合是怎么解决的。</p>
<h4 data-id="heading-10">上下文碎片化 → <code>Monorepo</code> 让 <code>AI</code> 一次性看全项目</h4>
<p><code>AI</code> 的问题是只能看到当前打开的文件或有限的上下文。</p>
<p><code>monorepo</code> 把前端（<code>apps/web</code>）、后端（<code>apps/api</code>）、共享类型（<code>libs/types</code>）、数据库 <code>schema</code>（<code>libs/db</code>）、甚至 <code>UI</code> 组件（<code>libs/ui</code>）全部放在同一个仓库里。<code>AI</code> 工具（如 <code>Cursor Composer</code>）直接索引整个 <code>repo</code>，依赖关系、类型定义、接口契约一目了然。</p>
<p>实际效果：</p>
<ul>
<li>生成前端调用后端 <code>API</code> 时，它不会再凭空发明一个不存在的字段。</li>
<li>改一个 <code>shared type</code>（如 <code>UserDto</code>），<code>AI</code> 能自动追踪到所有使用它的地方，一次性改完。</li>
</ul>
<h4 data-id="heading-11">规范与风格不一致 → <code>NestJS</code> 装饰器 + <code>DI</code> 是“天然提示”</h4>
<p><code>NestJS</code> 的核心设计（模块化、依赖注入、装饰器）本质上就是一套“写给 <code>AI</code> 看的规范语言”。</p>
<ul>
<li><code>@Controller</code>、<code>@Get</code>、<code>@Post</code> 明确告诉 <code>AI</code> 这个类是 <code>HTTP</code> 入口。</li>
<li><code>@Injectable</code>、<code>constructor</code> 注入让 <code>AI</code> 知道要用 <code>DI</code>，而不是乱 <code>new</code>。</li>
<li><code>@Body()</code> + <code>class-validator</code> + <code>ValidationPipe</code> 让 <code>AI</code> 自动生成校验逻辑，几乎不会漏掉 <code>required</code> 字段。</li>
<li><code>@UseGuards</code>、<code>@UseInterceptors</code> 让 <code>auth</code>、<code>logging</code>、<code>rate-limit</code> 等切面逻辑天然统一。</li>
</ul>
<p>在 <code>.cursorrules</code> 里写几行规则：</p>
<pre><code class="hljs language-text" lang="text">始终用 NestJS 模块化结构：新 feature 放在 apps/api/src/{domain} 下。
共享类型放在 libs/types，用 zod 或 infer。
优先用 tRPC 暴露 API，保持端到端类型安全。
所有 DTO 必须用 class-validator 校验。
</code></pre>
<p><code>AI</code> 就会像老员工一样，生成的代码风格高度一致。<code>Claude Code</code> 甚至能根据这些规则自发写出符合规范的测试用例。</p>
<h4 data-id="heading-12">重构效率低下 → <code>Turborepo</code> <code>caching</code> + 模块边界让 <code>AI</code> 改得又快又准</h4>
<p><code>Turborepo</code> 的远程缓存和并行任务，让 <code>monorepo</code> 的 <code>build</code> / <code>dev</code> 速度飞起（<code>Rust</code> 重写后，冷启动和增量 <code>build</code> 快 3–5x）。</p>
<p><code>AI</code> 修改多个包时，不会因为 <code>build</code> 卡住而中断思路。</p>
<p>同时，<code>NestJS</code> 的模块边界（每个 <code>domain</code> 一个 <code>module</code>）让 <code>AI</code> 很容易定位修改范围：</p>
<ul>
<li>改 <code>auth</code> 逻辑 → 只动 <code>libs/auth</code> 和 <code>apps/api/src/auth</code>。</li>
<li>加 <code>rate-limit</code> → 只需在 <code>common/interceptors</code> 加一个全局 <code>Interceptor</code>，所有路由自动生效。</li>
</ul>
<h4 data-id="heading-13"><code>review</code> 成本高 → 端到端类型安全 + 测试友好让 <code>bug</code> 提前死掉</h4>
<p><code>tRPC</code> + <code>zod</code> / <code>infer</code> 让类型在 <code>monorepo</code> 里零成本同步：</p>
<ul>
<li><code>libs/types</code> 定义 <code>DTO</code> → <code>tRPC router infer</code> → 前端 <code>hook</code> 自动带类型。</li>
<li><code>AI</code> 生成前端调用时，几乎不会出现 “property does not exist” 这种低级错误。</li>
</ul>
<p><code>NestJS</code> 的 <code>DI</code> 也让单元测试 / 集成测试非常好写：<code>mock service</code> 一行代码搞定。</p>
<p>我现在习惯让 <code>AI</code> 顺手生成 <code>Vitest</code> / <code>Jest</code> 测试用例，<code>review</code> 时先跑测试，失败的直接迭代 <code>prompt</code>，成功率高很多。</p>
<h4 data-id="heading-14">扩展 <code>AI</code> 功能时的破坏性 → 模块化 + <code>libs/ai</code> 像插件一样插拔</h4>
<p>想加 <code>RAG</code>、<code>chat</code>、<code>embedding</code>？</p>
<p>新建一个 <code>libs/ai</code> 包，注入 <code>OpenAI</code> / <code>Anthropic client</code>，写几个 <code>service</code>（<code>embeddingService</code>、<code>ragService</code>），然后在 <code>apps/api</code> 里暴露 <code>tRPC</code> 路由。</p>
<p>业务代码几乎不改，原有模块不受影响。</p>
<p>如果任务重，还可以新建 <code>apps/worker</code>（<code>BullMQ</code> 队列），异步处理 <code>embedding</code> / <code>indexing</code>。</p>
<p>这个“插件式”扩展方式，让 <code>AI</code> 功能从“额外负担”变成了“可选项”。我最近加了一个简单的思考链 <code>Agent</code>，只用了半天时间，项目结构一点没乱。</p>
<p>总的来说，<code>NestJS</code> + <code>Monorepo</code> 不是在“教 <code>AI</code> 写代码”，而是在“教 <code>AI</code> 如何按照我的规则写代码”。</p>
<h3 data-id="heading-15"><code>NestJS</code> 全栈偏前端的闭环体验</h3>
<p>在 <code>NestJS</code> + <code>Monorepo</code> 的组合里，最让我觉得“离不开”的地方，其实是它把全栈偏前端的开发体验做到了一个近乎闭环的状态。</p>
<p>所谓“全栈偏前端”，就是以前端为主（<code>Next.js</code> <code>App Router</code> 为主力），后端只是为了支撑业务逻辑、数据持久化、<code>API</code> 暴露，但又不想把后端写得太随意。</p>
<p>过去用 <code>Express</code> 或 <code>Fastify</code>，原生写后端总觉得割裂：类型定义要手动同步、前端调用 <code>API</code> 时容易出字段错、部署前后端要分开管、规范靠口头约定……这些小摩擦累积起来，会让开发节奏断断续续。</p>
<p><code>NestJS</code> + <code>Monorepo</code> 几乎把这些摩擦全部抹平了，形成了下面几个明显的闭环：</p>
<h4 data-id="heading-16">端到端类型安全的零成本同步</h4>
<p>核心靠 <code>tRPC</code> + <code>shared libs</code>。
在 <code>libs/types</code> 里定义 <code>DTO</code>（如 <code>UserDto</code>、<code>NotificationPreferencesDto</code>），然后在 <code>NestJS</code> 的 <code>tRPC router</code> 里用 <code>infer</code> 或 <code>zod</code> 直接导出类型。前端（<code>Next.js</code>）通过 <code>tRPC client</code> 消费时，类型自动带过来。</p>
<p><code>AI</code> 生成前端 <code>mutation</code> / <code>query</code> 时，几乎不会出现 “property does not exist on type” 的低级 <code>bug</code>。</p>
<p>我最近改一个用户设置接口，整个过程 <code>AI</code> 改了后端 <code>controller</code> + <code>service</code> + 前端 <code>page</code> + <code>hook</code>，类型全程对齐，我只 <code>review</code> 了业务逻辑的边界条件。</p>
<h4 data-id="heading-17">迭代速度与 <code>AI</code> 节奏完美匹配</h4>
<p><code>Turborepo</code> 的缓存机制（尤其是 <code>Rust</code> 重写后的版本）让 <code>monorepo</code> 的 <code>turbo run dev / build</code> 快到离谱。</p>
<p>前后端同时开发时，改一个 <code>shared type</code> 或后端接口，前端热重载几乎秒级响应。</p>
<p><code>AI</code> 帮我快速生成一个 <code>feature</code>，我 <code>review</code> 完 <code>accept</code> → <code>turbo</code> 瞬间 <code>build</code> → 浏览器刷新看到效果，整个 <code>cycle</code> 控制在 5–10 分钟。</p>
<p>这和 <code>AI</code> 的“快速试错”节奏高度吻合：想改就改，想加就加，不会因为 <code>build</code> 慢或 <code>deploy</code> 麻烦而卡住思路。</p>
<h4 data-id="heading-18">部署与运维的极简闭环</h4>
<p><code>Vercel</code> 原生支持 <code>Turborepo</code> <code>monorepo</code>，一键 <code>deploy</code> 前后端（<code>apps/web</code> → <code>frontend</code>，<code>apps/api</code> → <code>serverless</code> 或 <code>edge functions</code>）。</p>
<p>后端用 <code>NestJS</code> <code>Fastify mode</code>，吞吐量比 <code>Express</code> 高 2–4 倍，成本控制更友好。</p>
<p>不再需要维护两个 <code>repo</code> 的 <code>CI/CD</code>、两个地方的 <code>env variables</code>、两个地方的监控。</p>
<h4 data-id="heading-19">前后端同构体验，前端转全栈学习曲线最低</h4>
<p><code>NestJS</code> 的装饰器风格、模块化、<code>TypeScript</code> 原生，和 <code>Next.js</code> 的 <code>App Router</code> + <code>server actions</code> 高度相似。</p>
<p>前端开发者上手 <code>NestJS</code> 时，几乎没有陌生感：<code>controller</code> 像 <code>page route</code>，<code>service</code> 像 <code>server action</code> 或 <code>lib function</code>，<code>pipes</code> / <code>interceptors</code> 像 <code>middleware</code>。</p>
<p><code>AI</code> (如 <code>Trae</code>) 补全时，也更容易理解上下文——因为前后端风格统一，它生成的代码天然一致。</p>
<p>为什么 <code>NestJS</code> 在这么多 <code>Node</code> 后端选项里，能成为全栈偏前端的最优选择？</p>
<p>简单对比一下：</p>
<ul>
<li><code>Express</code> / <code>Fastify</code> 原生：太灵活 → 规范靠自己 → <code>AI</code> 容易乱写。</li>
<li><code>Hono</code> / <code>Elysia</code>：轻量极致 → 但缺少模块化 + <code>DI</code>，<code>AI</code> 在中大型项目里上下文跟不上。</li>
<li><code>Adonis</code> / <code>FoalTS</code>：企业级，但学习曲线陡，生态不如 <code>NestJS</code> 活跃。</li>
<li><code>NestJS</code>：结构强、<code>TypeScript</code> 友好、装饰器像“提示工程”、社区 <code>boilerplate</code> 多、与 <code>Next.js</code> 生态无缝对接。</li>
</ul>
<p><code>NestJS</code> 不是最轻、最快，但它是目前 <code>Node</code> 生态里“最不拖 <code>AI</code> 后腿、又能让前端开发者写得舒服”的后端框架。</p>
<p>放在 <code>monorepo</code> 里，它就把“前后端割裂”这个老问题，变成了“前后端像一家人”。</p>
<p>用这个组合后，我写代码的感受从“前后端两套逻辑在打架”变成了“前后端在同一个 <code>repo</code> 里安静地合作”。</p>
<p>这大概就是“闭环”的真正含义。</p>
<h3 data-id="heading-20">独立部署与微服务友好：<code>monorepo</code> 不等于单体</h3>
<p>很多人一听到 <code>monorepo</code>，就担心它会变成一个“大单体”：所有代码耦合在一起，部署慢、扩展难、维护成噩梦。但 <code>NestJS</code> + <code>Monorepo</code> 的实际用法恰恰相反，它在保持代码共享便利的同时，天然支持独立部署和微服务边界。</p>
<p>核心靠以下几点设计：</p>
<ul>
<li>
<p><strong>每个 <code>app</code> / <code>service</code> 独立</strong>：<code>monorepo</code> 里可以有多个 <code>apps</code>，比如 <code>apps/api</code>（主后端）、<code>apps/worker</code>（队列任务）、<code>apps/admin</code>（后台管理）。<code>Turborepo</code> 支持每个 <code>app</code> 单独 <code>build</code>、<code>test</code>、<code>deploy</code>。<br/>
<code>CI/CD</code> 配置时，用 <code>turbo run build --filter=api</code> 只构建 <code>api</code> 包，其他不动。<code>Vercel</code>、<code>Railway</code> 或 <code>GitHub Actions</code> 都能轻松实现“改 <code>api</code> 只 <code>deploy</code> <code>api</code>”。</p>
</li>
<li>
<p><strong><code>NestJS</code> 原生微服务支持</strong>：<code>NestJS</code> 内置多种传输层（<code>TCP</code>、<code>Redis</code>、<code>NATS</code>、<code>gRPC</code>、<code>MQTT</code>），模块之间可以通过 <code>@nestjs/microservices</code> 解耦。<br/>
比如 <code>auth</code> 模块做成独立 <code>microservice</code>，暴露 <code>gRPC</code> 接口；主 <code>api</code> 只消费它，不耦合实现。共享 <code>libs/auth</code> 只放类型和 <code>DTO</code>，逻辑完全隔离。</p>
</li>
<li>
<p><strong>共享 <code>libs</code> 边界清晰</strong>：<code>libs/types</code>、<code>libs/db</code>、<code>libs/common</code> 只放接口、<code>schema</code>、常量、工具函数，不放业务逻辑。<br/>
这让模块间“共享知识但不共享状态”，避免了单体式的纠缠。</p>
</li>
</ul>
<p>这在 2026 年 <code>AI</code> 项目里特别实用：核心业务稳，<code>AI</code> 增强功能（<code>RAG</code>、<code>Agent</code>）可以先做成独立 <code>worker</code> 或 <code>microservice</code>，随时加减。</p>
<h3 data-id="heading-21">团队协作与规范强制：<code>monorepo</code> 的“护城河”效应</h3>
<p><code>monorepo</code> 最大的隐形价值，其实不是个人效率，而是它在团队协作时的“护城河”作用。</p>
<p><code>NestJS</code> + <code>Monorepo</code> 的结构本身就像一套强制规范：</p>
<ul>
<li>每个 <code>domain</code> 必须有自己的 <code>module</code>、<code>controller</code>、<code>service</code>、<code>dto</code>。</li>
<li>共享逻辑只能放在 <code>libs/*</code>（<code>types</code>、<code>db</code>、<code>auth</code>、<code>common</code>），不允许业务代码跨包污染。</li>
<li>全局配置（如 <code>eslint</code>、<code>prettier</code>、<code>commitlint</code>、<code>ValidationPipe</code>、<code>Interceptors</code>）在根目录统一，一改全项目生效。</li>
</ul>
<p>这对团队意味着什么？</p>
<ul>
<li><strong>新人上手快</strong>：结构固定，新人 <code>clone repo</code> 后一看目录就知道怎么加功能。<code>AI</code> 生成的代码也天然符合规范，不用额外教“我们的风格是这样的”。</li>
<li><strong>规范强制执行</strong>：没有“口头约定”或“大家自己注意”的模糊地带。想加一个新接口？必须走 <code>NestJS</code> 装饰器 + <code>DTO</code> + <code>tRPC</code>。<code>AI</code> 补全时也会自动遵守，减少了风格漂移。</li>
<li><strong><code>code review</code> 摩擦大幅降低</strong>：因为类型安全 + 模块边界，<code>AI</code> 生成的代码往往是“看起来对的”，<code>review</code> 重点从“风格对不对”转向“业务逻辑对不对”。</li>
<li><strong>多人协作不乱</strong>：改 <code>shared type</code> 时，<code>Turborepo</code> 会自动检测影响范围，<code>build</code> 只跑相关的包。<code>merge conflict</code> 少了很多，团队不会因为“谁动了 <code>libs/auth</code>”而吵起来。</li>
</ul>
<p>实际体验里，这个“护城河”在 3 人以上小团队最明显。</p>
<p>一个人写时，<code>monorepo</code> 只是方便；团队写时，它成了防止代码退化的防火墙。</p>
<p><code>AI</code> 时代尤其有用：大家用 <code>Cursor</code> / <code>Claude Code</code> 生成代码时，风格统一、边界清晰，团队不会因为“AI 写的太乱”而互相指责。</p>
<h3 data-id="heading-22">结构即生产力</h3>
<p>2026 年，<code>AI</code> 辅助开发已成为标配，但其效率高度依赖项目结构。</p>
<p><code>NestJS</code> + <code>Monorepo</code> 让我越来越离不开它：<code>monorepo</code> 解决上下文碎片，让 <code>AI</code> 一次性看全项目；</p>
<p><code>NestJS</code> 的模块化、<code>DI</code>、装饰器提供“天然提示”，规范强制执行，减少 <code>hallucination</code> 和风格漂移；<code>tRPC</code> + <code>shared libs</code> 实现端到端类型安全，前后端闭环顺滑；</p>
<p><code>Turborepo</code> 缓存让迭代飞起，独立部署 + 微服务友好避免单体陷阱；社区 <code>boilerplate</code> 爆发，上手快，团队协作更稳。</p>
<p>它不是最潮的框架，却是最能让 <code>AI</code> 写出可维护、可 <code>review</code>、可长期演进代码的组合。</p>
<p>全栈偏前端的开发者用它，开发从“前后割裂”变成“安静合作”。</p>
<p>在 <code>AI</code> 时代，结构即生产力，而这个组合，正是我目前最舒服的结构。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（59）Hibernate的SQL日志如何查看？]]></title>    <link>https://juejin.cn/post/7598287024077832232</link>    <guid>https://juejin.cn/post/7598287024077832232</guid>    <pubDate>2026-01-23T11:53:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598287024077832232" data-draft-id="7598355220830339124" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（59）Hibernate的SQL日志如何查看？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-23T11:53:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（59）Hibernate的SQL日志如何查看？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T11:53:23.000Z" title="Fri Jan 23 2026 11:53:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开发和调试Hibernate应用程序时，查看生成的SQL日志是非常有用的。Hibernate提供了多种方式来查看SQL日志，包括通过配置文件和编程方式来启用SQL日志记录。下面将详细解释如何配置和查看Hibernate的SQL日志，并结合代码示例说明。</p>
<h3 data-id="heading-0">1. 通过配置文件启用SQL日志</h3>
<h4 data-id="heading-1">配置Hibernate</h4>
<p>在<code>hibernate.cfg.xml</code>中启用SQL日志输出和格式化：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.use_sql_comments"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Product"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<ul>
<li><code>hibernate.show_sql</code>：将生成的SQL输出到控制台（标准输出）。</li>
<li><code>hibernate.format_sql</code>：格式化SQL输出，使其更具可读性。</li>
<li><code>hibernate.use_sql_comments</code>：在生成的SQL中添加注释，帮助开发者理解每个SQL片段的来源。</li>
</ul>
<h4 data-id="heading-2">Maven依赖（如果使用Maven）</h4>
<p>确保在<code>pom.xml</code>中包含<code>slf4j</code>和<code>logback</code>依赖，以便日志记录：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Hibernate dependencies --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.0.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- SLF4J and Logback for logging --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">配置Logback</h4>
<p>创建<code>logback.xml</code>文件，配置日志记录级别：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"STDOUT"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"org.hibernate.SQL"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"DEBUG"</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">"false"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"STDOUT"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"org.hibernate.type.descriptor.sql.BasicBinder"</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"TRACE"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"STDOUT"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"STDOUT"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<ul>
<li><code>org.hibernate.SQL</code>：记录Hibernate生成的SQL语句。</li>
<li><code>org.hibernate.type.descriptor.sql.BasicBinder</code>：记录SQL参数绑定信息。</li>
</ul>
<h3 data-id="heading-4">2. 编程方式启用SQL日志</h3>
<p>除了通过配置文件外，还可以通过编程方式启用SQL日志。</p>
<h4 data-id="heading-5">配置Hibernate</h4>
<p>在<code>hibernate.cfg.xml</code>中配置基本的Hibernate属性：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Product"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">编程方式启用SQL日志</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateSQLLoggingExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(HibernateSQLLoggingExample.class);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        configuration.setProperty(<span class="hljs-string">"hibernate.show_sql"</span>, <span class="hljs-string">"true"</span>);
        configuration.setProperty(<span class="hljs-string">"hibernate.format_sql"</span>, <span class="hljs-string">"true"</span>);
        configuration.setProperty(<span class="hljs-string">"hibernate.use_sql_comments"</span>, <span class="hljs-string">"true"</span>);
        sessionFactory = configuration.buildSessionFactory();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product.setName(<span class="hljs-string">"Product B"</span>);
            product.setPrice(<span class="hljs-number">200.0</span>);
            session.save(product);
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-7">3. 查看SQL日志</h3>
<p>运行程序后，可以在控制台看到格式化的SQL日志和参数绑定信息。例如：</p>
<pre><code class="hljs language-ini" lang="ini">10:23:45.678 <span class="hljs-section">[main]</span> DEBUG org.hibernate.SQL - 
    insert 
    into
        product
        (name, price, id) 
    values
        (?, ?, ?)
10:23:45.680 <span class="hljs-section">[main]</span> TRACE org.hibernate.type.descriptor.sql.BasicBinder - binding parameter <span class="hljs-section">[1]</span> as <span class="hljs-section">[VARCHAR]</span> - Product B
10:23:45.681 <span class="hljs-section">[main]</span> TRACE org.hibernate.type.descriptor.sql.BasicBinder - binding parameter <span class="hljs-section">[2]</span> as <span class="hljs-section">[DOUBLE]</span> - 200.0
10:23:45.682 <span class="hljs-section">[main]</span> TRACE org.hibernate.type.descriptor.sql.BasicBinder - binding parameter <span class="hljs-section">[3]</span> as <span class="hljs-section">[BIGINT]</span> - 1
</code></pre>
<h3 data-id="heading-8">总结</h3>
<ol>
<li><strong>通过配置文件启用SQL日志</strong>：在<code>hibernate.cfg.xml</code>中配置<code>hibernate.show_sql</code>、<code>hibernate.format_sql</code>和<code>hibernate.use_sql_comments</code>等属性。</li>
<li><strong>配置日志框架</strong>：使用SLF4J和Logback记录SQL日志，并在<code>logback.xml</code>中配置日志级别。</li>
<li><strong>编程方式启用SQL日志</strong>：通过编程方式动态设置Hibernate属性。</li>
<li><strong>查看SQL日志</strong>：运行程序后，在控制台查看格式化的SQL日志和参数绑定信息。</li>
</ol>
<p>通过这些方法，可以方便地查看和调试Hibernate生成的SQL语句，帮助开发者更好地理解和优化数据库操作。希望这些详细的解释和代码示例能帮助您更好地查看和管理Hibernate的SQL日志。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（60）Hibernate的延迟加载如何配置？]]></title>    <link>https://juejin.cn/post/7598402961904189492</link>    <guid>https://juejin.cn/post/7598402961904189492</guid>    <pubDate>2026-01-23T11:54:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598402961904189492" data-draft-id="7598287024077848616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（60）Hibernate的延迟加载如何配置？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-23T11:54:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（60）Hibernate的延迟加载如何配置？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T11:54:10.000Z" title="Fri Jan 23 2026 11:54:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的延迟加载（Lazy Loading）是一种优化技术，它允许在实际需要数据时才从数据库中加载数据，而不是在初始查询时全部加载。延迟加载对于提高性能和减少内存消耗非常有用，特别是对于包含大量关联对象的复杂实体。</p>
<p>以下是详细的配置步骤和代码示例，展示如何在Hibernate中配置和使用延迟加载。</p>
<h3 data-id="heading-0">1. 使用注解配置延迟加载</h3>
<p>Hibernate默认启用了延迟加载，但我们可以通过注解进一步控制具体的加载行为。</p>
<h4 data-id="heading-1">1.1 延迟加载单个实体</h4>
<p>在实体类中，通过设置<code>fetch</code>属性为<code>FetchType.LAZY</code>来启用延迟加载。例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "product")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "price")</span>
    <span class="hljs-keyword">private</span> Double price;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h4 data-id="heading-2">1.2 延迟加载关联关系</h4>
<p>对于关联关系，例如<code>@OneToMany</code>、<code>@ManyToOne</code>、<code>@OneToOne</code>和<code>@ManyToMany</code>，可以通过设置<code>fetch</code>属性为<code>FetchType.LAZY</code>来启用延迟加载。</p>
<h5 data-id="heading-3">示例：<code>@ManyToOne</code>和<code>@OneToMany</code></h5>
<p>假设我们有两个实体类：<code>Category</code>和<code>Product</code>，它们之间存在<code>@OneToMany</code>和<code>@ManyToOne</code>的关系。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "category")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@OneToMany(mappedBy = "category", fetch = FetchType.LAZY)</span>
    <span class="hljs-keyword">private</span> List&lt;Product&gt; products;

    <span class="hljs-comment">// Getters and Setters</span>
}

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "product")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "price")</span>
    <span class="hljs-keyword">private</span> Double price;

    <span class="hljs-meta">@ManyToOne(fetch = FetchType.LAZY)</span>
    <span class="hljs-meta">@JoinColumn(name = "category_id")</span>
    <span class="hljs-keyword">private</span> Category category;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h3 data-id="heading-4">2. 通过配置文件配置延迟加载</h3>
<p>在<code>hibernate.cfg.xml</code>中配置Hibernate的属性，也可以控制延迟加载行为。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 启用延迟加载 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.default_batch_fetch_size"</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.enable_lazy_load_no_trans"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Category"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Product"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<ul>
<li><code>hibernate.default_batch_fetch_size</code>：默认批量抓取大小，配置一个合理的值可以减少N+1查询问题。</li>
<li><code>hibernate.enable_lazy_load_no_trans</code>：允许在没有事务的情况下延迟加载（通常不推荐在生产环境中启用）。</li>
</ul>
<h3 data-id="heading-5">3. 使用Hibernate会话加载延迟加载的数据</h3>
<p>为了查看延迟加载的效果，需要在事务范围内访问延迟加载的属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateLazyLoadingExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> session.get(Category.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Category Name: "</span> + category.getName());

            <span class="hljs-comment">// 延迟加载，此时products还未被加载</span>
            List&lt;Product&gt; products = category.getProducts();

            <span class="hljs-comment">// 访问products属性，触发延迟加载</span>
            <span class="hljs-keyword">for</span> (Product product : products) {
                System.out.println(<span class="hljs-string">"Product Name: "</span> + product.getName());
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-6">4. 避免N+1查询问题</h3>
<p>延迟加载在处理关联关系时，可能会出现N+1查询问题，即加载一个对象集合时，会额外执行多次单独查询。可以通过批量抓取来优化。</p>
<h4 data-id="heading-7">批量抓取示例</h4>
<p>在前面的配置中，我们已经设置了<code>hibernate.default_batch_fetch_size</code>。在实体类上也可以使用<code>@BatchSize</code>注解来控制批量抓取的大小。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> org.hibernate.annotations.BatchSize;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "category")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@OneToMany(mappedBy = "category", fetch = FetchType.LAZY)</span>
    <span class="hljs-meta">@BatchSize(size = 10)</span>
    <span class="hljs-keyword">private</span> List&lt;Product&gt; products;

    <span class="hljs-comment">// Getters and Setters</span>
}
</code></pre>
<h3 data-id="heading-8">总结</h3>
<ol>
<li><strong>使用注解配置延迟加载</strong>：在实体类和关联关系上通过注解配置<code>FetchType.LAZY</code>。</li>
<li><strong>通过配置文件配置延迟加载</strong>：在<code>hibernate.cfg.xml</code>中设置延迟加载相关的属性。</li>
<li><strong>在事务范围内使用延迟加载</strong>：确保在事务范围内访问延迟加载的属性，以触发数据加载。</li>
<li><strong>避免N+1查询问题</strong>：通过批量抓取配置，减少数据库查询次数，提高性能。</li>
</ol>
<p>通过这些方法，可以有效地配置和使用Hibernate的延迟加载，优化应用程序的性能和资源使用。希望这些详细的解释和代码示例能帮助您更好地理解和应用Hibernate的延迟加载技术。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Docker 实现开发环境的一致性管理]]></title>    <link>https://juejin.cn/post/7598260824223006763</link>    <guid>https://juejin.cn/post/7598260824223006763</guid>    <pubDate>2026-01-23T09:52:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598260824223006763" data-draft-id="7598376873546580011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Docker 实现开发环境的一致性管理"/> <meta itemprop="keywords" content="Docker"/> <meta itemprop="datePublished" content="2026-01-23T09:52:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jcj"/> <meta itemprop="url" content="https://juejin.cn/user/3525486571169616"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Docker 实现开发环境的一致性管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3525486571169616/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jcj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:52:59.000Z" title="Fri Jan 23 2026 09:52:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用 Docker 实现开发环境的一致性管理</h2>
<p>在现代软件开发中，一个常见的痛点是“在我机器上能跑”（It works on my machine）的问题。不同开发者使用的操作系统、依赖库版本、环境变量等存在差异，导致代码在本地运行正常，但在测试或生产环境中却出现各种问题。为了解决这一难题，Docker 技术提供了一种高效、可复用的解决方案。</p>
<p>Docker 是一个开源的容器化平台，它允许开发者将应用程序及其所有依赖打包到一个轻量级、可移植的容器中。这个容器可以在任何安装了 Docker 的系统上运行，从而确保开发、测试和生产环境的一致性。</p>
<p>以一个典型的 Web 应用为例，我们可以创建一个 <code>Dockerfile</code> 来定义运行环境：</p>
<pre><code class="hljs language-Dockerfile" lang="Dockerfile">FROM python:3.10-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "app.py"]
</code></pre>
<p>通过该文件，我们指定了基础镜像（Python 3.10）、工作目录、依赖安装方式以及启动命令。团队成员只需运行 <code>docker build -t myapp .</code> 和 <code>docker run -p 5000:5000 myapp</code>，即可在本地启动完全一致的应用环境。</p>
<p>此外，结合 <code>docker-compose.yml</code> 文件，还可以轻松管理多服务应用（如数据库、缓存、前端等），进一步提升开发效率。例如：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5000:5000"</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">"redis:alpine"</span>
</code></pre>
<p>通过 Docker，不仅解决了环境不一致的问题，还简化了部署流程，提升了团队协作效率。对于追求 DevOps 和持续集成/持续交付（CI/CD）的团队来说，Docker 已成为不可或缺的基础设施工具。</p>
<p>总之，合理使用 Docker 可以显著降低环境配置成本，提高软件交付质量与速度，值得每一位开发者深入掌握。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3+vite使用unocss和vant做移动端开发适配,使用lib-flexible适配RemToPx]]></title>    <link>https://juejin.cn/post/7598181989969215515</link>    <guid>https://juejin.cn/post/7598181989969215515</guid>    <pubDate>2026-01-23T09:43:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598181989969215515" data-draft-id="7598103558887292974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3+vite使用unocss和vant做移动端开发适配,使用lib-flexible适配RemToPx"/> <meta itemprop="keywords" content="前端,Vue.js,CSS"/> <meta itemprop="datePublished" content="2026-01-23T09:43:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大海之上没有鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2216269258969192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3+vite使用unocss和vant做移动端开发适配,使用lib-flexible适配RemToPx
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2216269258969192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大海之上没有鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:43:08.000Z" title="Fri Jan 23 2026 09:43:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">lib-flexible设置根字号</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">npm</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">lib-flexible</span>
<span class="hljs-comment">//然后在mian.js中引入</span>
</code></pre>
<h3 data-id="heading-1">uno.config.js设置</h3>
<p>根目录创建uno.config.js文件，需要安装
npm i @unocss/preset-rem-to-px</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig, presetWind3 } <span class="hljs-keyword">from</span> <span class="hljs-string">'unocss'</span>
<span class="hljs-keyword">import</span> presetRemToPx <span class="hljs-keyword">from</span> <span class="hljs-string">'@unocss/preset-rem-to-px'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">presets</span>: [
        <span class="hljs-title function_">presetWind3</span>(),  <span class="hljs-comment">//预设样式</span>
        <span class="hljs-title function_">presetRemToPx</span>()  <span class="hljs-comment">// 重点，把预设的rem转成px，这样postCssPxToRem就可以转了 例如预设样式 text-base的font-size:1rem;经过转换变成16px，在经过postCssPxToRem转换成rem</span>
    ]
})
</code></pre>
<h3 data-id="heading-2">这个是vite的配置</h3>
<pre><code class="hljs language-php" lang="php">import postCssPxToRem <span class="hljs-keyword">from</span> <span class="hljs-string">'postcss-pxtorem'</span>
import UnoCSS <span class="hljs-keyword">from</span> <span class="hljs-string">'unocss/vite'</span>

export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>({
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_ invoke__">UnoCSS</span>(),
    ],
    <span class="hljs-attr">css</span>: {
        <span class="hljs-attr">postcss</span>: {
            <span class="hljs-attr">plugins</span>: [
                <span class="hljs-title function_ invoke__">postCssPxToRem</span>({
                  <span class="hljs-attr">rootValue</span>: <span class="hljs-number">37.5</span>,
                  <span class="hljs-attr">unitPrecision</span>: <span class="hljs-number">6</span>,
                  <span class="hljs-attr">minPixelValue</span>: <span class="hljs-number">1</span>,
                  <span class="hljs-attr">propList</span>: [<span class="hljs-string">'*'</span>],
                  <span class="hljs-attr">mediaQuery</span>: <span class="hljs-literal">false</span>,
                })
            ]
        }
    }
)}
</code></pre>
<p>其他的按照vant文档正常使用就好了</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IDEA 2025.3.1.1 紧急发布，修复重大BUG]]></title>    <link>https://juejin.cn/post/7598382710294331392</link>    <guid>https://juejin.cn/post/7598382710294331392</guid>    <pubDate>2026-01-23T09:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598382710294331392" data-draft-id="7598355220829978676" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IDEA 2025.3.1.1 紧急发布，修复重大BUG"/> <meta itemprop="keywords" content="IntelliJ IDEA"/> <meta itemprop="datePublished" content="2026-01-23T09:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ahubbub"/> <meta itemprop="url" content="https://juejin.cn/user/2999123451061160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IDEA 2025.3.1.1 紧急发布，修复重大BUG
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123451061160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ahubbub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:57:42.000Z" title="Fri Jan 23 2026 09:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">IDEA 2025.3.1.1 紧急发布，修复重大BUG</h2>
<p><code>IntelliJ IDEA 2025.3</code> 发布后，更新节奏快得有点“追着人跑”。<code>2025.3.1</code> 作为首个补丁版本，本来是来修 bug、稳体验的。</p>
<p>但很多同学升完发现不对劲：Maven 项目一打开就开始狂吃 CPU/内存，甚至直接假死；用 WSL2 开发的，重启 IDE 后配置还会莫名其妙丢一部分。</p>
<p>因此 JetBrains 发布了 <code>2025.3.1.1</code> 作为紧急修复版本（hotfix）。如果你近期已经升级到 <code>2025.3.1</code> 且遇到异常，建议直接升级到 <code>2025.3.1.1</code>。</p>
<h3 data-id="heading-1">结论</h3>
<ul>
<li>直接升级到 <code>2025.3.1.1</code>：大型 Maven 项目（多模块/依赖复杂），或者 Windows 下用 WSL2 文件系统开发；以及升级到 <code>2025.3.1</code> 后出现卡顿/无响应/OOM。</li>
<li>可以稍微观望：纯本地小项目，近期也不折腾 Maven 重导入/重建，不用 WSL2。</li>
</ul>
<h3 data-id="heading-2">重大问题 1：打开 Maven 项目导致 IDE 卡死 / OOM</h3>
<h4 data-id="heading-3">症状</h4>
<ul>
<li>打开或导入大型 Maven 多模块项目后，IDE 长时间无响应：CPU 占用持续较高、内存持续上涨。</li>
<li>部分情况下会直接假死甚至 OOM，只能强制结束进程。</li>
</ul>
<h4 data-id="heading-4">原因</h4>
<p>这类问题一般出在 <strong>Maven 项目模型初始化/缓存读取/模块聚合关系构建</strong> 阶段。简单说就是：某个异常路径把同一段逻辑重复跑了很多次，内部又没做好去重/释放，导入越久越“膨胀”，最后就卡死或 OOM。</p>
<h4 data-id="heading-5">修复</h4>
<ul>
<li><strong>推荐</strong>：升级到 <code>2025.3.1.1</code>（官方 hotfix）。</li>
</ul>
<h4 data-id="heading-6">临时方案</h4>
<p>注意：删除的是 <strong>IDE 的 Maven 缓存</strong>，不是 Maven 本机仓库（<code>~/.m2/repository</code>）。执行前建议先退出 IDE。</p>
<ul>
<li>Windows：<code>C:\Users\&lt;用户名&gt;\AppData\Local\JetBrains\IntelliJIdea2025.3\Maven</code></li>
<li>macOS：<code>~/Library/Caches/JetBrains/IntelliJIdea2025.3/Maven</code></li>
<li>Linux：<code>~/.cache/JetBrains/IntelliJIdea2025.3/Maven</code></li>
</ul>
<p>可选：关闭编辑器 Tab 文件图标显示，减少某些 UI 计算触发链路</p>
<ul>
<li><code>Settings | Editor | General | Editor Tabs</code></li>
<li>取消勾选 <code>Show file icon</code></li>
</ul>
<h4 data-id="heading-7">验证</h4>
<ul>
<li>冷启动 IDE（完全退出再打开），重新打开同一 Maven 项目。</li>
<li>观察导入阶段：CPU/内存是否持续上升不回落，是否在可接受时间内恢复交互。</li>
<li>回归关键操作：Reimport/Reload、Build、<code>Resume Build From</code>。</li>
</ul>
<h3 data-id="heading-8">重大问题 2：WSL2 项目设置重启后丢失</h3>
<h4 data-id="heading-9">症状</h4>
<ul>
<li>在 WSL2 文件系统中打开项目，配置好的 Run/Debug 配置、解释器/JDK、某些插件设置等，在重启 IDE 后被重置。</li>
<li>有时即使 <code>.idea</code> 中仍保留配置片段，IDE 也可能没有按预期加载。</li>
</ul>
<h4 data-id="heading-10">修复</h4>
<ul>
<li><strong>推荐</strong>：升级到 <code>2025.3.1.1</code>。</li>
</ul>
<h4 data-id="heading-11">临时方案（Registry 规避）</h4>
<p>如果暂时无法升级，可以先用一个“保守开关”规避（通常更稳，但也可能牺牲一点点性能）：</p>
<ol>
<li><code>Ctrl+Shift+A</code>（macOS 为 <code>Cmd+Shift+A</code>）打开动作搜索</li>
<li>输入并打开 <code>Registry</code></li>
<li>搜索 <code>wsl.use.remote.agent.for.nio.filesystem</code></li>
<li>取消勾选</li>
<li>重启 IDE</li>
</ol>
<h4 data-id="heading-12">验证</h4>
<ul>
<li>新增一个 Run Configuration（例如新增一个 Spring Boot 启动配置）。</li>
<li>完全退出 IDE 后再打开同一 WSL2 项目，确认配置仍存在且可运行。</li>
</ul>
<h3 data-id="heading-13">参考</h3>
<ul>
<li>官方说明：<code>https://blog.jetbrains.com/idea/2025/12/intellij-idea-2025-3-1/</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用C#将DataTable快速导出为Word表格]]></title>    <link>https://juejin.cn/post/7598370121436348466</link>    <guid>https://juejin.cn/post/7598370121436348466</guid>    <pubDate>2026-01-23T10:04:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598370121436348466" data-draft-id="7598362826110255154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用C#将DataTable快速导出为Word表格"/> <meta itemprop="keywords" content="后端,C#"/> <meta itemprop="datePublished" content="2026-01-23T10:04:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户835629078051"/> <meta itemprop="url" content="https://juejin.cn/user/3150554985403516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用C#将DataTable快速导出为Word表格
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3150554985403516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户835629078051
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T10:04:28.000Z" title="Fri Jan 23 2026 10:04:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e593cf0c3cf848f084141e36a1bcfbb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767553&amp;x-signature=3Ga8oBtZpIAHdI41QQ4y1noI3N0%3D" alt="如何使用C#导出DataTable为Word文档表格" loading="lazy"/></p>
<p>在现代C#应用开发中，将程序数据以结构化的形式导出为用户友好的Word文档是一项常见的需求。无论是生成报表、合同还是其他业务文档，手动创建Word文档不仅耗时，而且容易出错。尤其当数据量较大或需要频繁生成时，这种低效的工作方式会成为开发者的痛点。</p>
<p>本文旨在提供一种高效、自动化的解决方案，利用<strong>Spire.Doc for .NET</strong>库，帮助C#开发者轻松实现将<code>DataTable</code>中的数据导出到Word文档，并以表格形式清晰展示。我们将通过详细的步骤和代码示例，确保您能够顺利地在自己的项目中应用这一技术。</p>
<hr/>
<h2 data-id="heading-0">为什么选择Spire.Doc for .NET?</h2>
<p>Spire.Doc for .NET是一个功能强大且易于集成的.NET组件，专门用于处理Word文档的各种操作。它允许开发者在不依赖Microsoft Office的情况下，创建、读取、编辑、转换和打印Word文档。在将<code>DataTable</code>数据导出到Word文档的场景中，Spire.Doc for .NET的优势尤为突出：</p>
<ul>
<li><strong>全面的表格支持：</strong> 能够灵活创建表格、设置表格样式（边框、背景色、对齐方式）、合并单元格等，完美契合<code>DataTable</code>的二维数据结构。</li>
<li><strong>丰富的格式化选项：</strong> 提供对文本、段落、图片等元素的精细控制，方便开发者美化文档，满足各种业务需求。</li>
<li><strong>高性能与稳定性：</strong> 适用于处理大量数据和生成复杂文档，保证程序运行的效率和稳定性。</li>
<li><strong>易于集成与API友好：</strong> .NET开发人员可以轻松地通过NuGet包管理工具将其集成到项目中，并利用直观的API进行编程。</li>
</ul>
<hr/>
<h2 data-id="heading-1">环境准备与库的安装</h2>
<p>在使用Spire.Doc for .NET之前，您需要将其添加到您的C#项目中。</p>
<ol>
<li>
<p><strong>创建或打开您的.NET项目：</strong> 确保您有一个Visual Studio项目（可以是控制台应用、WinForms、WPF或ASP.NET）。</p>
</li>
<li>
<p><strong>安装NuGet包：</strong> 在Visual Studio中，右键点击您的项目，选择“管理NuGet程序包(Manage NuGet Packages...)”。</p>
<ul>
<li>在“浏览”选项卡中，搜索“<code>Spire.Doc</code>”。</li>
<li>找到“<code>Spire.Doc</code>”包，点击“安装”。</li>
<li>或者，您也可以打开“程序包管理器控制台(Package Manager Console)”，然后输入以下命令并按回车键：</li>
</ul>
<pre><code class="hljs language-powershell" lang="powershell">Install-Package Spire.Doc
</code></pre>
</li>
</ol>
<p>安装完成后，您的项目将引用Spire.Doc for .NET库，您可以开始编写代码了。</p>
<hr/>
<h2 data-id="heading-2">核心实现：DataTable到Word表格</h2>
<p>接下来，我们将详细介绍如何将一个<code>DataTable</code>的数据导出为Word文档中的表格。</p>
<h3 data-id="heading-3">步骤分解</h3>
<ol>
<li><strong>创建Word文档对象：</strong> 初始化<code>Document</code>和<code>Section</code>，这将是您Word文档的基础结构。</li>
<li><strong>准备DataTable数据：</strong> 模拟一个<code>DataTable</code>，用于演示数据导出。在实际应用中，这些数据可能来自数据库查询、API接口或其他数据源。</li>
<li><strong>创建Word表格：</strong> 在<code>Section</code>中添加一个<code>Table</code>对象。</li>
<li><strong>设置表格样式：</strong> 对Word表格进行美化，例如设置边框、背景色、行高、列宽以及单元格文本对齐方式。</li>
<li><strong>填充表头：</strong> 遍历<code>DataTable</code>的<code>Columns</code>集合，将列名作为Word表格的第一行（表头）内容。</li>
<li><strong>填充数据行：</strong> 遍历<code>DataTable</code>的<code>Rows</code>集合，将每一行的数据依次填充到Word表格的相应单元格中。</li>
<li><strong>保存文档：</strong> 将生成的Word文档保存到指定路径。</li>
</ol>
<h3 data-id="heading-4">代码示例</h3>
<p>以下是完整的C#代码示例，演示了如何将一个模拟的<code>DataTable</code>导出为Word文档：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Data;
<span class="hljs-keyword">using</span> Spire.Doc;
<span class="hljs-keyword">using</span> Spire.Doc.Documents;
<span class="hljs-keyword">using</span> Spire.Doc.Fields;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DataTableToWordExporter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ExportDataTableToWord</span>(<span class="hljs-params">DataTable dataTable, <span class="hljs-built_in">string</span> filePath</span>)</span>
    {
        <span class="hljs-comment">// 1. 创建Word文档对象</span>
        Document document = <span class="hljs-keyword">new</span> Document();
        Section section = document.AddSection();

        <span class="hljs-comment">// 添加一个段落作为标题</span>
        Paragraph titleParagraph = section.AddParagraph();
        titleParagraph.Format.HorizontalAlignment = HorizontalAlignment.Center;
        TextRange titleText = titleParagraph.AppendText(<span class="hljs-string">"产品销售报表"</span>);
        titleText.CharacterFormat.FontSize = <span class="hljs-number">20</span>;
        titleText.CharacterFormat.Bold = <span class="hljs-literal">true</span>;
        section.AddParagraph().AppendText(Environment.NewLine); <span class="hljs-comment">// 空行</span>

        <span class="hljs-comment">// 2. 准备DataTable数据 (此处为模拟数据，实际应用中数据可能来自数据库等)</span>
        <span class="hljs-comment">// 假设dataTable已由调用者提供</span>

        <span class="hljs-comment">// 检查DataTable是否有数据</span>
        <span class="hljs-keyword">if</span> (dataTable == <span class="hljs-literal">null</span> || dataTable.Rows.Count == <span class="hljs-number">0</span>)
        {
            Paragraph noDataParagraph = section.AddParagraph();
            noDataParagraph.AppendText(<span class="hljs-string">"没有可用的数据进行导出。"</span>);
            document.SaveToFile(filePath, FileFormat.Docx);
            Console.WriteLine(<span class="hljs-string">"没有数据，文档已保存。"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 3. 创建Word表格</span>
        Table table = section.AddTable(<span class="hljs-literal">true</span>);
        table.ResetCells(dataTable.Rows.Count + <span class="hljs-number">1</span>, dataTable.Columns.Count); <span class="hljs-comment">// +1 用于表头</span>

        <span class="hljs-comment">// 4. 设置表格样式</span>
        <span class="hljs-comment">// 设置表格边框</span>
        table.TableFormat.Borders.LineWidth = <span class="hljs-number">1</span>;
        table.TableFormat.Borders.BorderType = BorderStyle.Single;
        table.TableFormat.Borders.Color = Color.Black;

        <span class="hljs-comment">// 设置表格整体宽度适应页面</span>
        table.PreferredWidth = <span class="hljs-keyword">new</span> PreferredWidth(WidthType.Percentage, <span class="hljs-number">100</span>);
        table.TableFormat.HorizontalAlignment = RowAlignment.Center;

        <span class="hljs-comment">// 5. 填充表头</span>
        TableRow headerRow = table.Rows[<span class="hljs-number">0</span>];
        headerRow.IsHeader = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 设置为表头行</span>
        headerRow.RowFormat.BackColor = Color.LightGray; <span class="hljs-comment">// 表头背景色</span>
        headerRow.RowFormat.Height = <span class="hljs-number">25</span>; <span class="hljs-comment">// 表头行高</span>
        headerRow.RowFormat.HeightType = TableRowHeightType.Exactly;

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; dataTable.Columns.Count; i++)
        {
            headerRow.Cells[i].CellFormat.VerticalAlignment = VerticalAlignment.Middle;
            Paragraph p = headerRow.Cells[i].AddParagraph();
            p.Format.HorizontalAlignment = HorizontalAlignment.Center;
            TextRange tr = p.AppendText(dataTable.Columns[i].ColumnName);
            tr.CharacterFormat.Bold = <span class="hljs-literal">true</span>;
            tr.CharacterFormat.FontSize = <span class="hljs-number">11</span>;
        }

        <span class="hljs-comment">// 6. 填充数据行</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> r = <span class="hljs-number">0</span>; r &lt; dataTable.Rows.Count; r++)
        {
            TableRow dataRow = table.Rows[r + <span class="hljs-number">1</span>]; <span class="hljs-comment">// +1 跳过表头</span>
            dataRow.RowFormat.Height = <span class="hljs-number">20</span>;
            dataRow.RowFormat.HeightType = TableRowHeightType.Exactly;

            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> c = <span class="hljs-number">0</span>; c &lt; dataTable.Columns.Count; c++)
            {
                dataRow.Cells[c].CellFormat.VerticalAlignment = VerticalAlignment.Middle;
                Paragraph p = dataRow.Cells[c].AddParagraph();
                p.Format.HorizontalAlignment = HorizontalAlignment.Center;
                TextRange tr = p.AppendText(dataTable.Rows[r][c].ToString());
                tr.CharacterFormat.FontSize = <span class="hljs-number">10</span>;
            }
        }

        <span class="hljs-comment">// 7. 保存文档</span>
        <span class="hljs-keyword">try</span>
        {
            document.SaveToFile(filePath, FileFormat.Docx);
            Console.WriteLine(<span class="hljs-string">$"DataTable已成功导出到Word文档: <span class="hljs-subst">{filePath}</span>"</span>);
        }
        <span class="hljs-keyword">catch</span> (Exception ex)
        {
            Console.WriteLine(<span class="hljs-string">$"导出Word文档时发生错误: <span class="hljs-subst">{ex.Message}</span>"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 模拟一个DataTable</span>
        DataTable dt = <span class="hljs-keyword">new</span> DataTable(<span class="hljs-string">"Products"</span>);
        dt.Columns.Add(<span class="hljs-string">"产品ID"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>));
        dt.Columns.Add(<span class="hljs-string">"产品名称"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">string</span>));
        dt.Columns.Add(<span class="hljs-string">"单价"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">decimal</span>));
        dt.Columns.Add(<span class="hljs-string">"库存量"</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-built_in">int</span>));
        dt.Columns.Add(<span class="hljs-string">"上市日期"</span>, <span class="hljs-keyword">typeof</span>(DateTime));

        dt.Rows.Add(<span class="hljs-number">101</span>, <span class="hljs-string">"笔记本电脑"</span>, <span class="hljs-number">8999.00</span>m, <span class="hljs-number">50</span>, <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>));
        dt.Rows.Add(<span class="hljs-number">102</span>, <span class="hljs-string">"智能手机"</span>, <span class="hljs-number">4599.00</span>m, <span class="hljs-number">120</span>, <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>));
        dt.Rows.Add(<span class="hljs-number">103</span>, <span class="hljs-string">"无线耳机"</span>, <span class="hljs-number">799.00</span>m, <span class="hljs-number">200</span>, <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">2</span>, <span class="hljs-number">20</span>));
        dt.Rows.Add(<span class="hljs-number">104</span>, <span class="hljs-string">"智能手表"</span>, <span class="hljs-number">1299.00</span>m, <span class="hljs-number">80</span>, <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>));
        dt.Rows.Add(<span class="hljs-number">105</span>, <span class="hljs-string">"便携音箱"</span>, <span class="hljs-number">399.00</span>m, <span class="hljs-number">150</span>, <span class="hljs-keyword">new</span> DateTime(<span class="hljs-number">2023</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>));

        <span class="hljs-built_in">string</span> outputPath = <span class="hljs-string">"ProductReport.docx"</span>;
        ExportDataTableToWord(dt, outputPath);

        <span class="hljs-comment">// 演示无数据情况</span>
        DataTable emptyDt = <span class="hljs-keyword">new</span> DataTable(<span class="hljs-string">"Empty"</span>);
        emptyDt.Columns.Add(<span class="hljs-string">"ID"</span>);
        <span class="hljs-built_in">string</span> emptyOutputPath = <span class="hljs-string">"EmptyReport.docx"</span>;
        ExportDataTableToWord(emptyDt, emptyOutputPath);
    }
}
</code></pre>
<h3 data-id="heading-5">生成结果预览</h3>
<p>以下是上述代码的生成结果预览：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73b1c83a0b8e4b5086d131e9b4edc276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767553&amp;x-signature=L0bG2GQIgY0Raq3AQpNPQISEYHs%3D" alt="C#导出DataTable到Word结果" loading="lazy"/></p>
<h3 data-id="heading-6">关键API方法总结</h3>













































































<table><thead><tr><th align="left">方法/属性</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><code>Document document = new Document();</code></td><td align="left">创建一个新的Word文档对象。</td></tr><tr><td align="left"><code>Section section = document.AddSection();</code></td><td align="left">向文档添加一个节（Section），文档内容通常放在节中。</td></tr><tr><td align="left"><code>Table table = section.AddTable(true);</code></td><td align="left">在节中添加一个表格，<code>true</code>表示表格将自动适应内容。</td></tr><tr><td align="left"><code>table.ResetCells(rows, columns);</code></td><td align="left">初始化表格的行数和列数。</td></tr><tr><td align="left"><code>table.TableFormat.Borders.*</code></td><td align="left">设置表格的边框样式、宽度和颜色。</td></tr><tr><td align="left"><code>table.PreferredWidth</code></td><td align="left">设置表格的首选宽度，可以按百分比或点数设置。</td></tr><tr><td align="left"><code>TableRow row = table.Rows[index];</code></td><td align="left">获取表格的指定行。</td></tr><tr><td align="left"><code>row.IsHeader = true;</code></td><td align="left">将指定行设置为表头行。</td></tr><tr><td align="left"><code>row.RowFormat.BackColor</code></td><td align="left">设置行的背景颜色。</td></tr><tr><td align="left"><code>row.RowFormat.Height</code></td><td align="left">设置行的行高。</td></tr><tr><td align="left"><code>TableCell cell = row.Cells[index];</code></td><td align="left">获取行的指定单元格。</td></tr><tr><td align="left"><code>cell.CellFormat.VerticalAlignment</code></td><td align="left">设置单元格内容的垂直对齐方式。</td></tr><tr><td align="left"><code>Paragraph p = cell.AddParagraph();</code></td><td align="left">在单元格中添加一个段落，用于承载文本。</td></tr><tr><td align="left"><code>p.Format.HorizontalAlignment</code></td><td align="left">设置段落内容的水平对齐方式。</td></tr><tr><td align="left"><code>TextRange tr = p.AppendText(text);</code></td><td align="left">向段落追加文本。</td></tr><tr><td align="left"><code>tr.CharacterFormat.*</code></td><td align="left">设置文本的字体、字号、颜色、粗细等格式。</td></tr><tr><td align="left"><code>document.SaveToFile(filePath, FileFormat.Docx);</code></td><td align="left">将文档保存到指定路径，支持多种文件格式。</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">进阶技巧与注意事项</h2>
<h3 data-id="heading-8">样式定制</h3>
<p>上述代码仅提供了基础的样式设置。Spire.Doc for .NET提供了丰富的API，允许您对Word文档进行更细致的样式定制：</p>
<ul>
<li><strong>字体和颜色：</strong> 可以通过<code>CharacterFormat</code>对象设置字体、字号、颜色、斜体、下划线等。</li>
<li><strong>段落格式：</strong> <code>ParagraphFormat</code>可以控制段落的缩进、行距、对齐方式、间距等。</li>
<li><strong>条件格式：</strong> 根据数据值（例如，库存量低于某个阈值）设置单元格的背景色或文本颜色，以突出显示重要信息。</li>
<li><strong>页眉页脚：</strong> 可以通过<code>section.HeadersFooters.Header</code>和<code>section.HeadersFooters.Footer</code>添加页眉页脚，插入页码、日期等。</li>
</ul>
<h3 data-id="heading-9">复杂数据类型处理</h3>
<p>对于<code>DataTable</code>中存储的日期、布尔值或其他自定义对象，在导出时可能需要进行格式化：</p>
<ul>
<li><strong>日期格式化：</strong> 使用<code>DateTime.ToString("yyyy-MM-dd")</code>等方法将日期格式化为用户友好的字符串。</li>
<li><strong>布尔值处理：</strong> 可以将<code>true</code>显示为“是”，<code>false</code>显示为“否”。</li>
<li><strong>自定义对象：</strong> 对于包含自定义对象的列，需要重写其<code>ToString()</code>方法或根据业务逻辑进行特殊处理，以确保在Word中显示有意义的内容。</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 示例：日期格式化</span>
<span class="hljs-keyword">if</span> (dataTable.Columns[c].DataType == <span class="hljs-keyword">typeof</span>(DateTime))
{
    DateTime dateValue = (DateTime)dataTable.Rows[r][c];
    p.AppendText(dateValue.ToString(<span class="hljs-string">"yyyy年MM月dd日"</span>));
}
<span class="hljs-keyword">else</span>
{
    p.AppendText(dataTable.Rows[r][c].ToString());
}
</code></pre>
<h3 data-id="heading-10">错误处理</h3>
<p>在实际应用中，务必添加健壮的错误处理机制。使用<code>try-catch</code>块可以捕获文件保存失败、数据转换异常等问题，从而提高程序的稳定性。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// ... Word文档生成逻辑 ...</span>
    document.SaveToFile(filePath, FileFormat.Docx);
}
<span class="hljs-keyword">catch</span> (Exception ex)
{
    <span class="hljs-comment">// 记录错误日志，或向用户显示友好的错误消息</span>
    Console.Error.WriteLine(<span class="hljs-string">$"导出Word文档时发生错误: <span class="hljs-subst">{ex.Message}</span>"</span>);
    <span class="hljs-comment">// 可以在这里进行进一步的错误处理，例如删除部分生成的文档</span>
}
</code></pre>
<h3 data-id="heading-11">性能考量</h3>
<p>对于包含数千甚至数万行数据的<code>DataTable</code>，一次性生成整个Word文档可能会占用较多内存和时间。在这种情况下，可以考虑以下优化策略：</p>
<ul>
<li><strong>分批处理：</strong> 如果文档允许分段，可以将大数据集分成多个小批次，分别生成Word文档的各个部分，最后合并。</li>
<li><strong>流式处理：</strong> 虽然Spire.Doc主要面向DOM（文档对象模型）操作，但对于极大数据量，可以探索是否有更底层的流式写入方式（尽管这通常会增加代码复杂性）。</li>
<li><strong>优化数据源：</strong> 确保<code>DataTable</code>在传入导出方法前已经是经过优化的、只包含必要数据的集合。</li>
</ul>
<hr/>
<h2 data-id="heading-12">总结</h2>
<p>本文详细介绍了如何使用C#和Spire.Doc for .NET库，将<code>DataTable</code>中的数据高效、自动化地导出为结构化的Word文档。我们从环境准备、核心实现步骤到进阶技巧和注意事项，提供了一套完整的解决方案。</p>
<p>通过Spire.Doc for .NET，开发者不仅能够轻松应对数据导出到Word文档的常见需求，还能通过丰富的API实现精细的样式定制和复杂数据处理，极大地提升了开发效率和文档生成的专业性。我们鼓励您根据自身项目需求，进一步探索Spire.Doc for .NET的更多强大功能，为您的C#应用程序带来更出色的文档处理能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Playwright学习笔记 06】用户视觉定位的方法]]></title>    <link>https://juejin.cn/post/7598370121436299314</link>    <guid>https://juejin.cn/post/7598370121436299314</guid>    <pubDate>2026-01-23T09:50:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598370121436299314" data-draft-id="7598362826110238770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Playwright学习笔记 06】用户视觉定位的方法"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2026-01-23T09:50:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鄭郑"/> <meta itemprop="url" content="https://juejin.cn/user/590879236308844"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Playwright学习笔记 06】用户视觉定位的方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/590879236308844/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鄭郑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:50:52.000Z" title="Fri Jan 23 2026 09:50:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">根据文本内容定位</h2>
<p>Page/Locator 对象的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplaywright.dev%2Fpython%2Fdocs%2Fapi%2Fclass-locator%23locator-get-by-text" title="https://playwright.dev/python/docs/api/class-locator#locator-get-by-text" target="_blank" ref="nofollow noopener noreferrer">get_by_text</a> 方法</p>
<p>比如，</p>
<p>如果要获取 所有 文本内容包含 <code>11</code> 的元素，就可以这样</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">elements</span> = page.get_by_text(<span class="hljs-string">'11'</span>).all()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fab9d41052f2496e8cd6378d13414055~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YSt6YOR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769766652&amp;x-signature=2TScSbTkWZPdnWfKruRPNq0uTVo%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>如果，你希望包含的内容是以 <code>11</code> 结尾的，就可以使用正则表达式对象 作为参数，如下</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re
elements = page.get_by_text(re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">"11$"</span>)).<span class="hljs-built_in">all</span>()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-1">根据 元素 role 定位</h2>
<p>web应用现在有一种标准 称之为： <code>ARIA （Accessible Rich Internet Applications）</code>。</p>
<p>ARIA 根据web界面元素的用途，为这些元素定义了一套 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FARIA%2FRoles" title="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles" target="_blank" ref="nofollow noopener noreferrer">角色（ Role ）</a> 信息，添加到页面中，</p>
<p>从而 让 残疾人士，或者 普通人在 某种环境下（比如夜里，太空中），不方便使用常规方法操作应用，使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2Fwai-aria-1.2%2F%23dfn-assistive-technology" title="https://www.w3.org/TR/wai-aria-1.2/#dfn-assistive-technology" target="_blank" ref="nofollow noopener noreferrer">辅助技术工具</a>，来操作web应用的。</p>
<p>若想定位这个元素：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"alert-message"</span>&gt;
  您已成功注册，很快您将收到一封确认电子邮件
&lt;/div&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>直接可以根据如下代码 定位该元素</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 根据 role 定位</span>
<span class="hljs-attr">lc</span> = page.get_by_role(<span class="hljs-string">'alert'</span>)

<span class="hljs-comment"># 打印元素文本</span>
print(lc.inner_text())
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>html元素中，有些 特定语义元素（semantic elements）被ARIA规范认定为自身就包含 ARIA role 信息，并不需要我们明显的加上 ARIA role 属性设置，</p>
<p>比如</p>
<pre><code class="hljs language-ini" lang="ini">&lt;progress <span class="hljs-attr">value</span>=<span class="hljs-string">"75"</span> max=<span class="hljs-string">"100"</span>&gt;<span class="hljs-number">75</span> %&lt;/progress&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>就等于隐含了如下信息</p>
<pre><code class="hljs language-ini" lang="ini">&lt;progress <span class="hljs-attr">value</span>=<span class="hljs-string">"75"</span> max=<span class="hljs-string">"100"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"progressbar"</span>
  <span class="hljs-attr">aria-valuenow</span>=<span class="hljs-string">"75"</span>
  <span class="hljs-attr">aria-valuemax</span>=<span class="hljs-string">"100"</span>&gt;<span class="hljs-number">75</span> %&lt;/div&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>所以，直接可以根据如下代码 定位该元素</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 根据 role 定位</span>
<span class="hljs-keyword">lc</span> = page.get_by_role(<span class="hljs-string">'progressbar'</span>)

<span class="hljs-comment"># 打印元素属性 value 的值</span>
<span class="hljs-keyword">print</span>(lc.get_attribute(<span class="hljs-string">'value'</span>))
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>再比如 <code>search</code> 类型的输入框，默认就有 <code>searchbox</code> role，</p>
<pre><code class="hljs language-ini" lang="ini">&lt;input <span class="hljs-attr">type</span>=<span class="hljs-string">"search"</span>&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-2">ARIA Attribute</h3>
<p>ARIA规范除了可以给元素添加 <code>ARIA role</code> ，还可以添加其它 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAccessibility%2FARIA%2FAttributes" title="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes" target="_blank" ref="nofollow noopener noreferrer"> ARIA属性（ARIA attributes）</a> ，比如</p>
<pre><code class="hljs language-ini" lang="ini">&lt;div <span class="hljs-attr">role</span>=<span class="hljs-string">"heading"</span> aria-level=<span class="hljs-string">"1"</span>&gt;白月黑羽标题<span class="hljs-number">1</span>&lt;/div&gt;
&lt;div <span class="hljs-attr">role</span>=<span class="hljs-string">"heading"</span> aria-level=<span class="hljs-string">"2"</span>&gt;白月黑羽标题<span class="hljs-number">2</span>&lt;/div&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><code>aria-level</code> 就是一个 ARIA 属性，表示 role 为 <code>heading</code> 时的 <code>等级</code> 信息</p>
<p>上面的定义，其实和下面的 html 元素 h1/h2 等价</p>
<pre><code class="hljs language-css" lang="css">&lt;<span class="hljs-selector-tag">h1</span>&gt;白月黑羽标题<span class="hljs-number">1</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;
&lt;<span class="hljs-selector-tag">h2</span>&gt;白月黑羽标题<span class="hljs-number">2</span>&lt;/<span class="hljs-selector-tag">h2</span>&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>上例中，h2 元素，隐含了 <strong><code>role="heading" aria-level="2"</code></strong> ， 所以可以用下面代码定位</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lc</span> = page.get_by_role(<span class="hljs-string">'heading'</span>,level=<span class="hljs-number">2</span>)
print(lc.inner_text())
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-3">Accessible Name</h3>
<p>只根据 <code>ARIA role</code> 和 <code>ARIA属性</code> 往往并不能唯一定位元素。</p>
<p>role定位最常见的组合是 <code>ARIA role</code> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FGlossary%2FAccessible_name" title="https://developer.mozilla.org/en-US/docs/Glossary/Accessible_name" target="_blank" ref="nofollow noopener noreferrer">Accessible Name</a></p>
<p>因为，<code>Accessible Name</code> 就像元素的 <code>名字</code> 一样，往往可以唯一定位。</p>
<p>html 元素标准属性 <code>name</code> 是浏览器内部的，用户看不到，比如</p>
<p><code>Accessible Name</code> 不一样，它是元素界面可见的文本名，</p>
<pre><code class="hljs language-ini" lang="ini">&lt;a <span class="hljs-attr">name</span>=<span class="hljs-string">'link2byhy'</span> href=<span class="hljs-string">"https://www.byhy.net"</span>&gt;白月黑羽教程&lt;/a&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>比如上面的元素，暗含的 <strong><code>Accessible Name</code></strong> 值就是 <strong><code>白月黑羽教程</code></strong> ， 当然也暗含了 <strong><code>ARIA role</code> 值为 <code>link</code></strong></p>
<p>所以，可以这样定位</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lc</span> = page.get_by_role(<span class="hljs-string">'link'</span>,name=<span class="hljs-string">'白月黑羽教程'</span>)
print(lc.click())
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>上面的写法， 只要 Accessible Name 包含 参数name 的字符串内容即可，而且大小写不分， 并不需要完全一致。</p>
<p>所以，这样也可以定位到</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lc</span> = page.get_by_role(<span class="hljs-string">'link'</span>,name=<span class="hljs-string">'白月黑羽'</span>)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>如果你需要 Accessible Name 和 参数name 的内容完全一致，可以指定 <code>exact=True</code> ，如下</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lc</span> = page.get_by_role(<span class="hljs-string">'link'</span>,name=<span class="hljs-string">'白月黑羽'</span>, exact=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>name值还可以通过<a href="https://link.juejin.cn?target=http%3A%2F%2F0" title="http://0" target="_blank" ref="nofollow noopener noreferrer">正则表达式</a>，进行较复杂的匹配规则，比如</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lc</span> = page.get_by_role(<span class="hljs-string">'link'</span>,name=re.compile(<span class="hljs-string">"^白月.*羽"</span>))
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>我们这里说一些常见的：</p>
<p><strong><code>&lt;a&gt; &lt;td&gt; &lt;button&gt;</code></strong> Accessible Name 值 就是其内部的文本内容。</p>
<p><strong><code>&lt;textarea&gt; &lt;input&gt;</code></strong> 这些输入框，它们的 Accessible Name 值 是和他们关联的 的文本。</p>
<p>比如：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> /&gt;</span> Subscribe
<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这个 checkbox 的 Accessible Name 却是 <strong><code>Subscribe</code></strong></p>
<p>一些元素 比如 <strong><code>&lt;img&gt;</code></strong> ，它的 Accessible Name 是其html 属性 <code>alt</code> 的值</p>
<p>比如</p>
<pre><code class="hljs language-ini" lang="ini">&lt;img <span class="hljs-attr">src</span>=<span class="hljs-string">"grape.jpg"</span> alt=<span class="hljs-string">"banana"</span>/&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>role定位代码复杂，建议使用<strong>codegen代码助手</strong>来完成</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[objc_msgSend(obj, @selector(foo)); 到底发生了什么？]]></title>    <link>https://juejin.cn/post/7598193992828829750</link>    <guid>https://juejin.cn/post/7598193992828829750</guid>    <pubDate>2026-01-23T09:53:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598193992828829750" data-draft-id="7598260824222990379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="objc_msgSend(obj, @selector(foo)); 到底发生了什么？"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-01-23T09:53:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="汉秋"/> <meta itemprop="url" content="https://juejin.cn/user/3755587450191879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            objc_msgSend(obj, @selector(foo)); 到底发生了什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3755587450191879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    汉秋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:53:33.000Z" title="Fri Jan 23 2026 09:53:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>objc_msgSend(obj, @selector(foo)); 到底发生了什么？</strong></h2>
<p>在 Objective-C 的世界里，有一句话几乎是<strong>底层原教旨主义</strong>：</p>
<blockquote>
<p><strong>Objective-C 是一门基于消息发送（Message Sending）的语言，而不是函数调用。</strong></p>
</blockquote>
<p>而这一切，都浓缩在一行看似普通、却极其核心的代码中：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">objc_msgSend</span>(obj, <span class="hljs-variable">@selector</span>(foo));
</code></pre>
<p>本文将从<strong>语法糖 → 运行时 → 完整调用链</strong>，一步一步拆解：</p>
<ul>
<li>这行代码到底在“发什么”</li>
<li>消息是如何被找到并执行的</li>
<li>如果找不到方法，Runtime 又做了什么</li>
</ul>
<hr/>
<h3 data-id="heading-1"><strong>一、从表面看：它等价于什么？</strong></h3>
<p>这行代码：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">objc_msgSend</span>(obj, <span class="hljs-variable">@selector</span>(foo));
</code></pre>
<p>在语义上 <strong>等价于</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[obj foo]</span><span class="hljs-comment">;</span>
</code></pre>
<p>也就是说：</p>
<blockquote>
<p><strong>给对象 obj 发送一条名为 foo 的消息</strong></p>
</blockquote>
<p>[obj foo] 只是编译器提供的<strong>语法糖</strong>，真正执行的永远是 objc_msgSend。</p>
<hr/>
<h3 data-id="heading-2"><strong>二、谁是发送者？谁是接收者？</strong></h3>
<p>很多初学者会卡在这个问题上：</p>
<blockquote>
<p>到底是谁“调用”了谁？</p>
</blockquote>
<h4 data-id="heading-3"><strong>正确理解方式</strong></h4>
<ul>
<li>
<p><strong>接收者（receiver）</strong> ：obj</p>
</li>
<li>
<p><strong>消息（selector）</strong> ：foo</p>
</li>
<li>
<p><strong>发送动作的发起者</strong>：当前代码位置（不重要）</p>
</li>
</ul>
<p>Objective-C <strong>不关心调用栈的“谁”</strong> ，只关心：</p>
<blockquote>
<p>👉 <strong>这条消息发给谁</strong></p>
</blockquote>
<p>所以永远用这句话来理解：</p>
<blockquote>
<p><strong>给 obj 发送 foo 消息</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-4"><strong>三、Runtime 真正发生的 6 个步骤（核心）</strong></h3>
<p>下面是你在 Xcode 里写下一行 [obj foo] 后，<strong>Runtime 在背后真实发生的完整流程</strong>。</p>
<hr/>
<h3 data-id="heading-5"><strong>步骤 1️⃣：取得接收者obj</strong></h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">id</span> <span class="hljs-selector-tag">obj</span> = ...;
<span class="hljs-selector-tag">objc_msgSend</span>(obj, <span class="hljs-variable">@selector</span>(foo));
</code></pre>
<ul>
<li>obj 是一个对象指针</li>
<li>本质上指向一块内存</li>
<li>内存布局的第一个成员，就是 <strong>isa</strong> <strong>指针</strong></li>
</ul>
<pre><code class="hljs language-vbnet" lang="vbnet">obj
 ├─ isa → <span class="hljs-keyword">Class</span>
 ├─ ivar1
 ├─ ivar2
</code></pre>
<p>如果 obj == nil：</p>
<ul>
<li>整个流程直接结束</li>
<li>返回 0 / nil</li>
<li><strong>不会崩溃</strong>（OC 的著名特性）</li>
</ul>
<hr/>
<h3 data-id="heading-6"><strong>步骤 2️⃣：通过isa找到 Class</strong></h3>
<pre><code class="hljs language-ini" lang="ini">Class <span class="hljs-attr">cls</span> = obj-&gt;isa<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>
<p>isa 指向对象所属的类</p>
</li>
<li>
<p>这是 <strong>所有方法查找的起点</strong></p>
</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@interface</span> <span class="hljs-attribute">Person </span>: NSObject
- (void)foo;
<span class="hljs-variable">@end</span>
</code></pre>
<pre><code class="hljs language-scss" lang="scss">obj (Person 实例)
  └─ isa → Person
</code></pre>
<hr/>
<h3 data-id="heading-7"><strong>步骤 3️⃣：在方法缓存（cache）中查找</strong></h3>
<p>Runtime <strong>首先查 cache，而不是方法列表</strong>。</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">Class</span> Person
 ├─ cache      ← ① 先查这里
 ├─ methodList ← ② 再查这里
 └─ superclass
</code></pre>
<ul>
<li>
<p>cache 是一个哈希表：SEL → IMP</p>
</li>
<li>
<p>命中 cache = <strong>极快（接近 C 函数调用）</strong></p>
</li>
</ul>
<p>如果在 cache 中找到了 foo：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">IMP</span> <span class="hljs-selector-tag">imp</span> = <span class="hljs-selector-tag">cache</span><span class="hljs-selector-attr">[foo]</span>;
<span class="hljs-selector-tag">imp</span>(obj, <span class="hljs-variable">@selector</span>(foo));
</code></pre>
<p>→ <strong>流程结束</strong>****</p>
<hr/>
<h3 data-id="heading-8"><strong>步骤 4️⃣：在方法列表 &amp; 父类中查找</strong></h3>
<p>如果 cache 未命中：</p>
<ol>
<li>查 Person 的方法列表</li>
<li>找不到 → superclass</li>
<li>一直向上查，直到 NSObject</li>
</ol>
<pre><code class="hljs language-objectivec" lang="objectivec">Person
  ↓
<span class="hljs-built_in">NSObject</span>
</code></pre>
<p>如果在某个类中找到：</p>
<ul>
<li>将 SEL → IMP 放入 cache（下次更快）</li>
<li>立即执行 IMP</li>
</ul>
<hr/>
<h3 data-id="heading-9"><strong>步骤 5️⃣：动态方法解析（resolve）</strong></h3>
<p>如果 <strong>整个继承链都没找到 foo</strong>：</p>
<p>Runtime 会给你一次**“临时补救”的机会**。</p>
<pre><code class="hljs language-css" lang="css">+ (BOOL)resolveInstanceMethod:(SEL)sel;
</code></pre>
<h4 data-id="heading-10"><strong>示例：动态添加方法</strong></h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@implementation</span> Person

+ (BOOL)<span class="hljs-attribute">resolveInstanceMethod</span>:(SEL)sel {
    <span class="hljs-selector-tag">if</span> (sel == <span class="hljs-variable">@selector</span>(foo)) {
        <span class="hljs-selector-tag">class_addMethod</span>(self, sel, (IMP)fooIMP, <span class="hljs-string">"v@:"</span>);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">YES</span>;
    }
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[super resolveInstanceMethod:sel]</span>;
}

<span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">fooIMP</span>(id self, SEL _cmd) {
    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">"动态添加的 foo 被调用了"</span>);
}

@<span class="hljs-selector-tag">end</span>
</code></pre>
<p>如果返回 YES：</p>
<ul>
<li>Runtime <strong>重新从步骤 3 开始查找</strong></li>
</ul>
<hr/>
<h3 data-id="heading-11"><strong>步骤 6️⃣：消息转发（Message Forwarding）</strong></h3>
<p>如果你没有动态添加方法，Runtime 进入 <strong>消息转发三连</strong>。</p>
<h4 data-id="heading-12"><strong>6.1 快速转发</strong></h4>
<pre><code class="hljs language-erlang" lang="erlang">- <span class="hljs-params">(id)</span>forwardingTargetForSelector:<span class="hljs-params">(SEL)</span>aSelector;
</code></pre>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">-</span> (id)<span class="hljs-selector-tag">forwardingTargetForSelector</span>:(SEL)<span class="hljs-selector-tag">aSelector</span> {
    <span class="hljs-selector-tag">if</span> (aSelector == <span class="hljs-variable">@selector</span>(foo)) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">otherObj</span>;
    }
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[super forwardingTargetForSelector:aSelector]</span>;
}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[otherObj foo]</span><span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h4 data-id="heading-13"><strong>6.2 完整转发（NSInvocation）</strong></h4>
<pre><code class="hljs language-erlang" lang="erlang">- <span class="hljs-params">(NSMethodSignature *)</span>methodSignatureForSelector:<span class="hljs-params">(SEL)</span>aSelector;
- <span class="hljs-params">(void)</span>forwardInvocation:<span class="hljs-params">(NSInvocation *)</span>invocation;
</code></pre>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">-</span> (NSMethodSignature *)<span class="hljs-selector-tag">methodSignatureForSelector</span>:(SEL)<span class="hljs-selector-tag">aSelector</span> {
    <span class="hljs-selector-tag">if</span> (aSelector == <span class="hljs-variable">@selector</span>(foo)) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[NSMethodSignature signatureWithObjCTypes:<span class="hljs-string">"v@:"</span>]</span>;
    }
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[super methodSignatureForSelector:aSelector]</span>;
}

<span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">forwardInvocation</span>:(NSInvocation *)<span class="hljs-selector-tag">invocation</span> {
    <span class="hljs-selector-attr">[invocation invokeWithTarget:otherObj]</span>;
}
</code></pre>
<hr/>
<h4 data-id="heading-14"><strong>6.3 最终失败 → 崩溃</strong></h4>
<p>如果以上都没处理：</p>
<pre><code class="hljs language-css" lang="css">-<span class="hljs-selector-attr">[Person foo]</span>: unrecognized selector sent to instance
</code></pre>
<p>应用直接崩溃 💥</p>
<hr/>
<h3 data-id="heading-15"><strong>四、完整流程总览（记住这个顺序）</strong></h3>
<pre><code class="hljs language-sql" lang="sql">objc_msgSend
  ↓
isa
  ↓
cache
  ↓
<span class="hljs-keyword">method</span> list
  ↓
superclass
  ↓
resolveInstanceMethod
  ↓
forwardingTargetForSelector
  ↓
forwardInvocation
  ↓
crash
</code></pre>
<hr/>
<h3 data-id="heading-16"><strong>五、为什么 objc_msgSend 这么重要？</strong></h3>
<ul>
<li>
<p>KVC / KVO</p>
</li>
<li>
<p>方法交换（Method Swizzling）</p>
</li>
<li>
<p>AOP / Hook</p>
</li>
<li>
<p>崩溃防护</p>
</li>
<li>
<p>热修复（早期方案）</p>
</li>
</ul>
<p><strong>全都建立在它之上。</strong></p>
<p>理解 objc_msgSend，</p>
<blockquote>
<p>才算真正“入门” Objective-C Runtime。</p>
</blockquote>
<hr/>
<h3 data-id="heading-17"><strong>六、结语</strong></h3>
<p>当你再看到这行代码时：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">objc_msgSend</span>(obj, <span class="hljs-variable">@selector</span>(foo));
</code></pre>
<p>请在脑中自动展开：</p>
<blockquote>
<p>cache → superclass → resolve → forwarding → crash</p>
</blockquote>
<p>那一刻，你已经不是在“写 OC”，而是在<strong>和 Runtime 对话</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# CSS 学习笔记：彻底掌握 `:nth-child(n)` 伪类选择器]]></title>    <link>https://juejin.cn/post/7598362826110173234</link>    <guid>https://juejin.cn/post/7598362826110173234</guid>    <pubDate>2026-01-23T09:46:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598362826110173234" data-draft-id="7598181989969297435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# CSS 学习笔记：彻底掌握 `:nth-child(n)` 伪类选择器  "/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-23T09:46:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户80110532256"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # CSS 学习笔记：彻底掌握 `:nth-child(n)` 伪类选择器  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户80110532256
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:46:52.000Z" title="Fri Jan 23 2026 09:46:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS 学习笔记：彻底掌握 <code>:nth-child(n)</code> 伪类选择器</h2>
<h3 data-id="heading-1">一、一句话定义（先锚定认知）</h3>
<blockquote>
<p><code>:nth-child(n)</code> 是一个<strong>基于父元素子节点顺序</strong>的结构化伪类选择器，用于匹配：<br/>
<strong>“是其直接父元素的第 <code>n</code> 个子元素，且自身标签名（或类型）与选择器前缀一致”</strong> 的元素。<br/>
它不关心“这是第几个 <code>&lt;li&gt;</code>”，而只认“这是父元素的第几个孩子”。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">二、语法全解：从简单到强大</h3>
<h4 data-id="heading-3">1️ 基础形式（最常用）</h4>

























<table><thead><tr><th>写法</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td><code>:nth-child(1)</code></td><td>第1个子元素</td><td><code>li:nth-child(1)</code> → 列表第一个 <code>&lt;li&gt;</code></td></tr><tr><td><code>:nth-child(odd)</code></td><td>所有奇数位子元素（1,3,5…）</td><td><code>tr:nth-child(odd)</code> → 表格奇数行</td></tr><tr><td><code>:nth-child(even)</code></td><td>所有偶数位子元素（2,4,6…）</td><td><code>div:nth-child(even)</code> → 偶数位 <code>&lt;div&gt;</code></td></tr></tbody></table>
<h4 data-id="heading-4">2️ 数学公式 <code>an + b</code>（万能通式）</h4>
<ul>
<li><code>n</code> 是从 <code>0</code> 开始的整数（<code>n = 0, 1, 2, 3...</code>）</li>
<li>计算结果 <code>an + b</code> 即为<strong>匹配的子元素位置（从 1 开始计数）</strong></li>
</ul>









































<table><thead><tr><th>公式</th><th>展开（n=0,1,2,3…）</th><th>实际匹配位置</th><th>常见用途</th></tr></thead><tbody><tr><td><code>2n</code></td><td>0, 2, 4, 6… → <strong>忽略 0</strong></td><td>2, 4, 6, 8…</td><td>等价于 <code>even</code></td></tr><tr><td><code>2n+1</code></td><td>1, 3, 5, 7…</td><td>1, 3, 5, 7…</td><td>等价于 <code>odd</code></td></tr><tr><td><code>3n+1</code></td><td>1, 4, 7, 10…</td><td>每隔 3 个选第 1 个</td><td>网格首列高亮</td></tr><tr><td><code>n+3</code></td><td>3, 4, 5, 6…</td><td><strong>从第 3 个开始所有子元素</strong></td><td>“跳过前两个”</td></tr><tr><td><code>-n+3</code></td><td>3, 2, 1, 0… → <strong>0 及负数无效</strong></td><td>1, 2, 3</td><td><strong>前三个元素</strong>（黄金公式 ✅）</td></tr></tbody></table>
<blockquote>
<p>记忆口诀：</p>
<ul>
<li><code>even</code>/<code>odd</code> → 看是否被 2 整除；</li>
<li><code>n+X</code> → 从第 X 个起全部；</li>
<li><code>-n+X</code> → 前 X 个；</li>
<li><code>an+b</code> → 代入 n=0,1,2… 算出有效正整数即可。</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-5">三、核心机制（必读！90% 错误源于此）</h3>
<h4 data-id="heading-6">正确逻辑（三步判定）</h4>
<p>对页面中每一个目标元素（如每个 <code>&lt;li&gt;</code>），浏览器执行：</p>
<ol>
<li><strong>定位父元素</strong> → 找到它的 <code>parentNode</code>（直接父容器）；</li>
<li><strong>计算位置</strong> → 查看它在父元素的 <code>children</code> 列表中是第几个（<strong>从 1 开始计数，只算元素节点，忽略纯文本/注释</strong>）；</li>
<li><strong>双重校验</strong> → ① 位置符合 <code>an+b</code> 公式；② 元素类型与选择器前缀一致（如 <code>li</code> 必须是 <code>&lt;li&gt;</code> 标签）→ 两者都满足才匹配。</li>
</ol>
<h4 data-id="heading-7">常见误解（红色警报！）</h4>






























<table><thead><tr><th>误解</th><th>为什么错</th><th>正确做法</th></tr></thead><tbody><tr><td>“<code>:nth-child(3)</code> 就是第三个 <code>&lt;li&gt;</code>”</td><td>❌ 它找的是“第3个子元素”，不是“第3个 <code>&lt;li&gt;</code>”</td><td>✅ 改用 <code>li:nth-of-type(3)</code></td></tr><tr><td>“父元素没写，就找不到父”</td><td>❌ 每个元素天然有父节点（<code>&lt;body&gt;</code> 或其他），无需显式声明</td><td>✅ <code>li:nth-child(odd)</code> 会自动作用于所有 <code>&lt;li&gt;</code>，各自找爹</td></tr><tr><td>“隐藏元素（<code>display:none</code>）不参与计数”</td><td>❌ <code>:nth-child</code> 基于 DOM 结构，与渲染无关</td><td>✅ 隐藏元素仍占位置；若需“视觉上第n个”，需 JS</td></tr><tr><td>“空白换行会影响序号”</td><td>⚠️ 现代浏览器已优化：<strong>只计算元素节点（Element Nodes），忽略纯空白文本节点</strong></td><td>✅ 安心写格式化 HTML，无需压缩成一行</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">四、实战对比：<code>:nth-child()</code> vs <code>:nth-of-type()</code></h3>


















































<table><thead><tr><th>维度</th><th><code>:nth-child(n)</code></th><th><code>:nth-of-type(n)</code></th></tr></thead><tbody><tr><td><strong>判定依据</strong></td><td>元素在其父元素中的<strong>总子元素序号</strong></td><td>元素在其父元素中<strong>同类型元素的序号</strong></td></tr><tr><td><strong>是否跨类型计数</strong></td><td>✅ 是（<code>&lt;h2&gt;</code>, <code>&lt;p&gt;</code>, <code>&lt;div&gt;</code> 全部计入）</td><td>❌ 否（只数 <code>&lt;p&gt;</code>，忽略 <code>&lt;h2&gt;</code>）</td></tr><tr><td><strong>HTML 示例</strong></td><td><code>&lt;ul&gt;&lt;h2&gt;T&lt;/h2&gt;&lt;p&gt;A&lt;/p&gt;&lt;span&gt;S&lt;/span&gt;&lt;p&gt;B&lt;/p&gt;&lt;/ul&gt;</code></td><td>同上</td></tr><tr><td><strong><code>p:nth-child(2)</code></strong></td><td>✅ 匹配 <code>&lt;p&gt;A&lt;/p&gt;</code>（它是第2个子元素）</td><td>—</td></tr><tr><td><strong><code>p:nth-child(4)</code></strong></td><td>✅ 匹配 <code>&lt;p&gt;B&lt;/p&gt;</code>（它是第4个子元素）</td><td>—</td></tr><tr><td><strong><code>p:nth-of-type(1)</code></strong></td><td>—</td><td>✅ 匹配 <code>&lt;p&gt;A&lt;/p&gt;</code>（第一个 <code>&lt;p&gt;</code>）</td></tr><tr><td><strong><code>p:nth-of-type(2)</code></strong></td><td>—</td><td>✅ 匹配 <code>&lt;p&gt;B&lt;/p&gt;</code>（第二个 <code>&lt;p&gt;</code>）</td></tr><tr><td><strong>何时选用</strong></td><td>需要“按物理位置布局”（如表格隔行、网格首行）</td><td>需要“按标签语义筛选”（如第3个段落、最后2个列表项）</td></tr></tbody></table>
<blockquote>
<p>快速决策树：<br/>
你想选「<strong>排第几的元素</strong>」→ <code>:nth-child()</code><br/>
你想选「<strong>第几个同类元素</strong>」→ <code>:nth-of-type()</code></p>
</blockquote>
<hr/>
<h3 data-id="heading-9">五、无父类选择器的真实含义（深度澄清）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(odd) { <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>; }
</code></pre>
<h4 data-id="heading-10">它不是“没有父”，而是“不限定父”</h4>
<ul>
<li>浏览器会<strong>为每个 <code>&lt;li&gt;</code> 独立执行</strong>：<br/>
<code>当前&lt;li&gt;.parentNode.children</code> → 找到它在其中的索引 → 判断是否为奇数 → 是则应用样式。</li>
<li>因此，它可能同时作用于：
<ul>
<li><code>&lt;ul&gt;</code> 下的 <code>&lt;li&gt;</code></li>
<li><code>&lt;ol&gt;</code> 下的 <code>&lt;li&gt;</code></li>
<li><code>&lt;nav&gt;</code> 中的 <code>&lt;li&gt;</code>（语义化导航）</li>
<li>甚至 <code>&lt;section&gt;</code> 直接子级的 <code>&lt;li&gt;</code>（HTML5 允许）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-11">为什么可以这样写？</h4>
<ul>
<li>CSS 是<strong>全局作用域</strong>，选择器描述的是“满足条件的元素集合”，不强制绑定父容器；</li>
<li>这种写法简洁高效，适合通用样式（如所有列表隔行变色）；</li>
<li>⚠️ 但大型项目中建议<strong>增加命名空间约束</strong>以防冲突：</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 推荐：模块化限定 */</span>
<span class="hljs-selector-class">.product-list</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(odd) { ... }
<span class="hljs-selector-class">.nav-menu</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(odd)   { ... }

<span class="hljs-comment">/* 不推荐：全局污染风险 */</span>
<span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:nth-child</span>(odd) { ... } <span class="hljs-comment">/* 可能意外影响第三方组件 */</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">六、经典应用场景（附可复制代码）</h3>
<h4 data-id="heading-13">场景 1：表格隔行变色（最稳方案）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>85<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>92<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>78<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/*  推荐：用 :nth-child，不受 thead/tfoot 干扰 */</span>
<span class="hljs-selector-tag">table</span> <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:nth-child</span>(even) { <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9f9f9</span>; }
<span class="hljs-selector-tag">table</span> <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:nth-child</span>(odd)  { <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>; }
</code></pre>
<h4 data-id="heading-14">场景 2：网格布局首行加粗</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 每行3列 → 首行：1,2,3 → 位置 1,2,3 → 用 -n+3 */</span>
<span class="hljs-selector-class">.grid</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-pseudo">:nth-child</span>(-n+<span class="hljs-number">3</span>) { <span class="hljs-attribute">font-weight</span>: bold; }
</code></pre>
<h4 data-id="heading-15">场景 3：导航菜单仅第1、3、5项有下划线</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.nav-link</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n+<span class="hljs-number">1</span>) { <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">2px</span> solid blue; }
</code></pre>
<hr/>
<h3 data-id="heading-16">七、调试技巧（开发必备）</h3>

























<table><thead><tr><th>方法</th><th>操作</th><th>作用</th></tr></thead><tbody><tr><td><strong>浏览器开发者工具</strong></td><td>在 Elements 面板选中 <code>&lt;li&gt;</code> → 右侧 Styles 查看是否生效 → 展开父节点数子元素</td><td>✅ 验证实际位置</td></tr><tr><td><strong>Console 快速验证</strong></td><td>输入 <code>document.querySelector('li:nth-child(2)')</code></td><td>✅ 返回匹配的第一个元素</td></tr><tr><td><strong>临时高亮所有匹配项</strong></td><td><code>*:nth-child(odd) { outline: 2px solid red !important; }</code></td><td>✅ 可视化所有奇数位子元素（慎用）</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">八、兼容性与注意事项</h3>





















<table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>✅ <strong>浏览器支持</strong></td><td>Chrome 4+ / Firefox 3.5+ / Safari 3.1+ / Edge 12+ / <strong>IE9+</strong>（IE8及以下不支持）</td></tr><tr><td>⚠️ <strong>服务端渲染（SSR）注意</strong></td><td>若 HTML 由服务端生成，确保结构与客户端一致，否则样式错位</td></tr><tr><td>🚫 <strong>不能做的事</strong></td><td>• 无法基于内容（如文字包含“重要”）筛选• 无法选择“倒数第2个可见元素”（需 JS）• 无法跨父元素计数（如“整个页面第5个 <code>&lt;li&gt;</code>”）</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">附录：速查记忆卡（打印/收藏版）</h3>













































<table><thead><tr><th>目标</th><th>写法</th><th>备注</th></tr></thead><tbody><tr><td>第1个元素</td><td><code>:nth-child(1)</code></td><td>最简写法</td></tr><tr><td>奇数位</td><td><code>:nth-child(odd)</code> 或 <code>:nth-child(2n+1)</code></td><td>二选一</td></tr><tr><td>偶数位</td><td><code>:nth-child(even)</code> 或 <code>:nth-child(2n)</code></td><td>二选一</td></tr><tr><td>前3个</td><td><code>:nth-child(-n+3)</code></td><td>✅ 黄金公式</td></tr><tr><td>从第4个起所有</td><td><code>:nth-child(n+4)</code></td><td>✅ 黄金公式</td></tr><tr><td>每4个选第3个</td><td><code>:nth-child(4n+3)</code></td><td>如 3,7,11,15…</td></tr><tr><td>仅最后一个</td><td><code>:nth-last-child(1)</code></td><td>倒序计数</td></tr></tbody></table>
<hr/>
<p><strong>最后送你一句心法</strong>：</p>
<blockquote>
<p><strong><code>:nth-child()</code> 不是“找第几个 <code>&lt;p&gt;</code>”，而是“站在父元素门口，点名叫第n个进门的孩子——还得确认他是不是你要找的那位”。</strong><br/>
理解了这个画面，你就永远不会再写错。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mach_msg_header_t详解]]></title>    <link>https://juejin.cn/post/7598287024077635624</link>    <guid>https://juejin.cn/post/7598287024077635624</guid>    <pubDate>2026-01-23T10:01:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598287024077635624" data-draft-id="7598287024077619240" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mach_msg_header_t详解"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-01-23T10:01:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS在入门"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426627758"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mach_msg_header_t详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426627758/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS在入门
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T10:01:38.000Z" title="Fri Jan 23 2026 10:01:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>借助AI能力分析。</p>
</blockquote>
<h2 data-id="heading-0"><code>mach_msg_header_t</code> - Mach 消息头</h2>
<h3 data-id="heading-1">作用</h3>
<p>这是 <strong>Mach 消息的头部结构</strong>，用于在 macOS/iOS 的进程间（或线程间）传递消息。</p>
<h3 data-id="heading-2">6个字段详解</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    <span class="hljs-type">mach_msg_bits_t</span>      msgh_bits;         <span class="hljs-comment">// 消息标志位</span>
    <span class="hljs-type">mach_msg_size_t</span>      msgh_size;         <span class="hljs-comment">// 消息总大小（字节）</span>
    <span class="hljs-type">mach_port_t</span>          msgh_remote_port;  <span class="hljs-comment">// 目标端口（收信人）</span>
    <span class="hljs-type">mach_port_t</span>          msgh_local_port;   <span class="hljs-comment">// 本地端口（回信地址）</span>
    <span class="hljs-type">mach_port_name_t</span>     msgh_voucher_port; <span class="hljs-comment">// 追踪端口（调试用）</span>
    <span class="hljs-type">mach_msg_id_t</span>        msgh_id;           <span class="hljs-comment">// 消息ID（自定义）</span>
} <span class="hljs-type">mach_msg_header_t</span>;
</code></pre>
<p><strong>形象比喻</strong>（信封）：</p>








































<table><thead><tr><th>字段</th><th>对应信封上的</th><th>说明</th></tr></thead><tbody><tr><td><code>msgh_remote_port</code></td><td><strong>收件人地址</strong></td><td>消息发往哪个端口</td></tr><tr><td><code>msgh_local_port</code></td><td><strong>回信地址</strong></td><td>如果需要回复，发到这里</td></tr><tr><td><code>msgh_size</code></td><td><strong>信件大小</strong></td><td>包括信封和内容</td></tr><tr><td><code>msgh_bits</code></td><td><strong>邮寄方式</strong></td><td>挂号信、平信等</td></tr><tr><td><code>msgh_id</code></td><td><strong>信件编号</strong></td><td>用于区分不同类型的信</td></tr><tr><td><code>msgh_voucher_port</code></td><td><strong>追踪单号</strong></td><td>用于追踪和调试</td></tr></tbody></table>
<h3 data-id="heading-3">在 RunLoop 中的使用</h3>
<h4 data-id="heading-4">1. 发送唤醒消息（CFRunLoopWakeUp）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 构造消息头</span>
<span class="hljs-type">mach_msg_header_t</span> header;
header.msgh_remote_port = rl-&gt;_wakeUpPort;  <span class="hljs-comment">// 发往唤醒端口</span>
header.msgh_local_port = MACH_PORT_NULL;    <span class="hljs-comment">// 不需要回复</span>
header.msgh_size = <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">mach_msg_header_t</span>); <span class="hljs-comment">// 只有头，无内容</span>
header.msgh_bits = MACH_MSGH_BITS(MACH_MSG_TYPE_COPY_SEND, <span class="hljs-number">0</span>);
header.msgh_id = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 发送（唤醒 RunLoop）</span>
mach_msg(&amp;header, MACH_SEND_MSG, ...);
</code></pre>
<h4 data-id="heading-5">2. 接收消息（RunLoop 休眠）</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 准备缓冲区</span>
<span class="hljs-type">uint8_t</span> buffer[<span class="hljs-number">3</span> * <span class="hljs-number">1024</span>];
<span class="hljs-type">mach_msg_header_t</span> *msg = (<span class="hljs-type">mach_msg_header_t</span> *)buffer;

msg-&gt;msgh_local_port = waitSet;  <span class="hljs-comment">// 在哪个端口等待</span>
msg-&gt;msgh_size = <span class="hljs-keyword">sizeof</span>(buffer);  <span class="hljs-comment">// 缓冲区大小</span>

<span class="hljs-comment">// 阻塞等待（线程休眠）</span>
mach_msg(msg, MACH_RCV_MSG, ...);

<span class="hljs-comment">// 被唤醒后，检查消息来源</span>
<span class="hljs-keyword">if</span> (msg-&gt;msgh_local_port == _wakeUpPort) {
    <span class="hljs-comment">// 手动唤醒</span>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (msg-&gt;msgh_local_port == _timerPort) {
    <span class="hljs-comment">// 定时器到期</span>
}
</code></pre>
<h3 data-id="heading-6">关键理解</h3>
<p><strong><code>mach_msg_header_t</code> 是 Mach IPC 的核心</strong>：</p>
<ol>
<li><strong>通信基础</strong>：所有 Mach 消息都以这个头开始</li>
<li><strong>路由信息</strong>：指明消息的来源和去向</li>
<li><strong>RunLoop 休眠/唤醒</strong>：通过接收/发送消息实现</li>
</ol>
<p><strong>完整消息结构</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">┌──────────────────────┐
│ <span class="hljs-type">mach_msg_header_t</span>    │ ← 消息头（必需）
├──────────────────────┤
│ 消息体（可选）        │ ← 实际数据
├──────────────────────┤
│ trailer（可选）       │ ← 附加信息
└──────────────────────┘
</code></pre>
<p><strong>RunLoop 的简化消息</strong>：只有头部，无消息体（称为 "trivial message"），足以唤醒线程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么要使用TypeScript？详细对比分析]]></title>    <link>https://juejin.cn/post/7598382710294364160</link>    <guid>https://juejin.cn/post/7598382710294364160</guid>    <pubDate>2026-01-23T10:18:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598382710294364160" data-draft-id="7598355220830158900" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么要使用TypeScript？详细对比分析"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T10:18:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="娜妹子辣"/> <meta itemprop="url" content="https://juejin.cn/user/3421335918747976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么要使用TypeScript？详细对比分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3421335918747976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    娜妹子辣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T10:18:01.000Z" title="Fri Jan 23 2026 10:18:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"> TypeScript的核心价值</h2>
<p>TypeScript是JavaScript的超集，添加了静态类型检查。它在编译时发现错误，而不是在运行时，从而提高代码质量和开发效率。</p>
<hr/>
<h2 data-id="heading-1">1️⃣ 类型安全：避免运行时错误</h2>
<h3 data-id="heading-2">JavaScript的类型问题</h3>
<pre><code class="hljs language-arduino" lang="arduino">JavaScript
<span class="hljs-comment">// JavaScript - 运行时才发现错误</span>
<span class="hljs-function">function <span class="hljs-title">calculateArea</span><span class="hljs-params">(width, height)</span> </span>{
  <span class="hljs-keyword">return</span> width * height;
}

<span class="hljs-comment">// 这些调用在运行时才会出错</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">calculateArea</span>(<span class="hljs-string">"10"</span>, <span class="hljs-string">"20"</span>));     <span class="hljs-comment">// "1020" (字符串拼接)</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">calculateArea</span>(<span class="hljs-number">10</span>));             <span class="hljs-comment">// NaN (height为undefined)</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">calculateArea</span>(<span class="hljs-number">10</span>, null));       <span class="hljs-comment">// 0 (null转为0)</span>
console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">calculateArea</span>({}, []));         <span class="hljs-comment">// NaN (对象转数字失败)</span>

<span class="hljs-comment">// 更复杂的例子</span>
<span class="hljs-function">function <span class="hljs-title">processUser</span><span class="hljs-params">(user)</span> </span>{
  <span class="hljs-comment">// 如果user为null或undefined，这里会报错</span>
  <span class="hljs-keyword">return</span> user.name.<span class="hljs-built_in">toUpperCase</span>() + <span class="hljs-string">" - "</span> + user.email.<span class="hljs-built_in">toLowerCase</span>();
}

<span class="hljs-comment">// 运行时错误：Cannot read property 'name' of null</span>
<span class="hljs-built_in">processUser</span>(null);
</code></pre>
<h3 data-id="heading-3">TypeScript的类型保护</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-comment">// TypeScript - 编译时发现错误</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateArea</span>(<span class="hljs-params">width: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> width * height;
}

<span class="hljs-comment">// 编译时错误，IDE会立即提示</span>
<span class="hljs-comment">// calculateArea("10", "20");  // ❌ Argument of type 'string' is not assignable to parameter of type 'number'</span>
<span class="hljs-comment">// calculateArea(10);          // ❌ Expected 2 arguments, but got 1</span>
<span class="hljs-comment">// calculateArea(10, null);    // ❌ Argument of type 'null' is not assignable to parameter of type 'number'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processUser</span>(<span class="hljs-params">user: User</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> user.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>() + <span class="hljs-string">" - "</span> + user.<span class="hljs-property">email</span>.<span class="hljs-title function_">toLowerCase</span>();
}

<span class="hljs-comment">// 编译时错误</span>
<span class="hljs-comment">// processUser(null);  // ❌ Argument of type 'null' is not assignable to parameter of type 'User'</span>

<span class="hljs-comment">// 正确使用</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">validUser</span>: <span class="hljs-title class_">User</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">"john@example.com"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">processUser</span>(validUser)); <span class="hljs-comment">// ✅ 类型安全</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">2️⃣ 智能提示和自动补全</h2>
<h3 data-id="heading-5">JavaScript的开发体验</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">JavaScript</span>
<span class="hljs-comment">// JavaScript - 无法确定对象结构</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleApiResponse</span>(<span class="hljs-params">response</span>) {
  <span class="hljs-comment">// IDE无法知道response有什么属性</span>
  <span class="hljs-comment">// 需要查看文档或运行代码才知道</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.); <span class="hljs-comment">// 无智能提示</span>
}

<span class="hljs-comment">// 数组方法也缺少智能提示</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">getUsers</span>(); <span class="hljs-comment">// 不知道数组元素类型</span>
users.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.); <span class="hljs-comment">// 无法知道user有什么属性</span>
});
</code></pre>
<h3 data-id="heading-6">TypeScript的智能开发体验</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">data</span>: T;
  message?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">profile</span>: {
    <span class="hljs-attr">avatar</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">bio</span>: <span class="hljs-built_in">string</span>;
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleApiResponse</span>(<span class="hljs-params">response: ApiResponse&lt;User[]&gt;</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// IDE提供完整的智能提示</span>
  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">success</span>) {
    response.<span class="hljs-property">data</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
      <span class="hljs-comment">// 智能提示显示所有可用属性和方法</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>.<span class="hljs-title function_">toUpperCase</span>());
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">email</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'@'</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">profile</span>.<span class="hljs-property">avatar</span>);
      <span class="hljs-comment">// IDE会提示拼写错误</span>
      <span class="hljs-comment">// console.log(user.nam); // ❌ Property 'nam' does not exist</span>
    });
  }
}

<span class="hljs-comment">// 数组方法的类型推断</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">userNames</span>: <span class="hljs-built_in">string</span>[] = users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">name</span>); <span class="hljs-comment">// 自动推断为string[]</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">adults</span>: <span class="hljs-title class_">User</span>[] = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> user.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>); <span class="hljs-comment">// 类型安全的过滤</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">3️⃣ 重构安全性</h2>
<h3 data-id="heading-8">JavaScript重构的风险</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">JavaScript</span>
<span class="hljs-comment">// 原始代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/user/<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>());
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProfileComponent</span> {
  <span class="hljs-title function_">loadUser</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">getUserInfo</span>(id)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">displayName</span>(user.<span class="hljs-property">fullName</span>); <span class="hljs-comment">// 使用fullName属性</span>
      });
  }
  
  <span class="hljs-title function_">displayName</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'userName'</span>).<span class="hljs-property">textContent</span> = name;
  }
}

<span class="hljs-comment">// 如果API改变了，返回的是name而不是fullName</span>
<span class="hljs-comment">// JavaScript无法检测到这个变化，只有在运行时才会发现错误</span>
</code></pre>
<h3 data-id="heading-9">TypeScript的重构安全</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 从fullName改为name</span>
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/user/<span class="hljs-subst">${userId}</span>`</span>);
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProfileComponent</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> userService: UserService</span>) {}
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadUser</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">getUserInfo</span>(id);
    <span class="hljs-comment">// 编译时错误：Property 'fullName' does not exist on type 'User'</span>
    <span class="hljs-comment">// this.displayName(user.fullName); // ❌ 立即发现错误</span>
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">displayName</span>(user.<span class="hljs-property">name</span>); <span class="hljs-comment">// ✅ 正确使用</span>
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">displayName</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'userName'</span>);
    <span class="hljs-keyword">if</span> (element) {
      element.<span class="hljs-property">textContent</span> = name;
    }
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-10">4️⃣ 大型项目的可维护性</h2>
<h3 data-id="heading-11">JavaScript项目的挑战</h3>
<pre><code class="hljs language-scss" lang="scss">JavaScript
<span class="hljs-comment">// 文件1: userService.js</span>
function <span class="hljs-built_in">createUser</span>(userData) {
  <span class="hljs-comment">// 不知道userData应该包含什么字段</span>
  return {
    id: <span class="hljs-built_in">generateId</span>(),
    name: userData.name,
    email: userData.email,
    // 忘记了某些必需字段？
  };
}

<span class="hljs-comment">// 文件2: userController.js  </span>
function <span class="hljs-built_in">handleCreateUser</span>(req, res) {
  const user = <span class="hljs-built_in">createUser</span>(req.body);
  <span class="hljs-comment">// 不知道createUser返回什么结构</span>
  <span class="hljs-built_in">saveUser</span>(user);
}

<span class="hljs-comment">// 文件3: database.js</span>
function <span class="hljs-built_in">saveUser</span>(user) {
  <span class="hljs-comment">// 不知道user对象的结构</span>
  <span class="hljs-comment">// 可能会因为缺少字段而失败</span>
  return db<span class="hljs-selector-class">.insert</span>('users', user);
}

<span class="hljs-comment">// 6个月后，其他开发者修改代码时：</span>
<span class="hljs-comment">// 1. 不知道函数期望什么参数</span>
<span class="hljs-comment">// 2. 不知道函数返回什么</span>
<span class="hljs-comment">// 3. 修改一个地方可能破坏其他地方</span>
<span class="hljs-comment">// 4. 需要大量文档和注释</span>
</code></pre>
<h3 data-id="heading-12">TypeScript项目的清晰结构</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-comment">// types/user.ts - 统一的类型定义</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CreateUserRequest</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">password</span>: <span class="hljs-built_in">string</span>;
  age?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">createdAt</span>: <span class="hljs-title class_">Date</span>;
  <span class="hljs-attr">updatedAt</span>: <span class="hljs-title class_">Date</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> {
  <span class="hljs-title function_">save</span>(<span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt;;
  <span class="hljs-title function_">findById</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;;
  <span class="hljs-title function_">findByEmail</span>(<span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;;
}

<span class="hljs-comment">// services/userService.ts</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> userRepo: UserRepository</span>) {}
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-attr">userData</span>: <span class="hljs-title class_">CreateUserRequest</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; {
    <span class="hljs-comment">// 类型系统确保所有必需字段都存在</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = {
      <span class="hljs-attr">id</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateId</span>(),
      <span class="hljs-attr">name</span>: userData.<span class="hljs-property">name</span>,
      <span class="hljs-attr">email</span>: userData.<span class="hljs-property">email</span>,
      <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
      <span class="hljs-attr">updatedAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
    };
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userRepo</span>.<span class="hljs-title function_">save</span>(user);
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">generateId</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>);
  }
}

<span class="hljs-comment">// controllers/userController.ts</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> userService: UserService</span>) {}
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleCreateUser</span>(<span class="hljs-attr">req</span>: <span class="hljs-title class_">Request</span>, <span class="hljs-attr">res</span>: <span class="hljs-title class_">Response</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 类型检查确保请求体结构正确</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">userData</span>: <span class="hljs-title class_">CreateUserRequest</span> = req.<span class="hljs-property">body</span>;
      <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">createUser</span>(userData);
      
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">json</span>(user);
    } <span class="hljs-keyword">catch</span> (error) {
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> });
    }
  }
}

<span class="hljs-comment">// 优势：</span>
<span class="hljs-comment">// 1. 任何开发者都能立即理解代码结构</span>
<span class="hljs-comment">// 2. 修改接口时，所有相关代码都会显示编译错误</span>
<span class="hljs-comment">// 3. IDE提供完整的导航和重构支持</span>
<span class="hljs-comment">// 4. 自文档化，减少注释需求</span>
</code></pre>
<hr/>
<h2 data-id="heading-13">5️⃣ 团队协作效率</h2>
<h3 data-id="heading-14">JavaScript团队协作问题</h3>
<pre><code class="hljs language-php" lang="php">JavaScript
<span class="hljs-comment">// 开发者A写的代码</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processPayment</span>(<span class="hljs-params">amount, currency, paymentMethod</span>) </span>{
  <span class="hljs-comment">// 没有文档说明参数类型和格式</span>
  <span class="hljs-comment">// amount是数字还是字符串？</span>
  <span class="hljs-comment">// currency是"USD"还是"usd"还是数字代码？</span>
  <span class="hljs-comment">// paymentMethod是什么格式？</span>
}

<span class="hljs-comment">// 开发者B使用时只能猜测</span>
<span class="hljs-title function_ invoke__">processPayment</span>(<span class="hljs-string">"100.50"</span>, <span class="hljs-string">"usd"</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">"credit_card"</span>, <span class="hljs-attr">number</span>: <span class="hljs-string">"1234"</span> });

<span class="hljs-comment">// 开发者C又是另一种理解</span>
<span class="hljs-title function_ invoke__">processPayment</span>(<span class="hljs-number">10050</span>, <span class="hljs-string">"USD"</span>, <span class="hljs-string">"credit_card"</span>);

<span class="hljs-comment">// 结果：运行时错误，调试困难，需要大量沟通</span>
</code></pre>
<h3 data-id="heading-15">TypeScript团队协作优势</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-comment">// 明确的接口定义作为团队契约</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">Currency</span> {
  <span class="hljs-variable constant_">USD</span> = <span class="hljs-string">"USD"</span>,
  <span class="hljs-variable constant_">EUR</span> = <span class="hljs-string">"EUR"</span>,
  <span class="hljs-variable constant_">CNY</span> = <span class="hljs-string">"CNY"</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentMethod</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"credit_card"</span> | <span class="hljs-string">"debit_card"</span> | <span class="hljs-string">"paypal"</span> | <span class="hljs-string">"bank_transfer"</span>;
  <span class="hljs-attr">details</span>: <span class="hljs-title class_">CreditCardDetails</span> | <span class="hljs-title class_">PayPalDetails</span> | <span class="hljs-title class_">BankDetails</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">CreditCardDetails</span> {
  <span class="hljs-attr">number</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">expiryMonth</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">expiryYear</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">cvv</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentResult</span> {
  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;
  transactionId?: <span class="hljs-built_in">string</span>;
  error?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 清晰的函数签名</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processPayment</span>(<span class="hljs-params">
  amount: <span class="hljs-built_in">number</span>,           <span class="hljs-comment">// 明确是数字，单位为分</span>
  currency: Currency,       <span class="hljs-comment">// 枚举确保有效值</span>
  paymentMethod: PaymentMethod  <span class="hljs-comment">// 结构化的支付方式</span>
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">PaymentResult</span>&gt; {
  <span class="hljs-comment">// 实现细节...</span>
}

<span class="hljs-comment">// 所有团队成员都能正确使用</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processPayment</span>(
  <span class="hljs-number">10050</span>,  <span class="hljs-comment">// 100.50美元，以分为单位</span>
  <span class="hljs-title class_">Currency</span>.<span class="hljs-property">USD</span>,
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"credit_card"</span>,
    <span class="hljs-attr">details</span>: {
      <span class="hljs-attr">number</span>: <span class="hljs-string">"4111111111111111"</span>,
      <span class="hljs-attr">expiryMonth</span>: <span class="hljs-number">12</span>,
      <span class="hljs-attr">expiryYear</span>: <span class="hljs-number">2025</span>,
      <span class="hljs-attr">cvv</span>: <span class="hljs-string">"123"</span>
    }
  }
);

<span class="hljs-comment">// 优势：</span>
<span class="hljs-comment">// 1. 零歧义的API契约</span>
<span class="hljs-comment">// 2. IDE自动验证使用方式</span>
<span class="hljs-comment">// 3. 减少代码审查时间</span>
<span class="hljs-comment">// 4. 新团队成员快速上手</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">6️⃣ 现代开发工具集成</h2>
<h3 data-id="heading-17">构建时优化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-comment">// TypeScript配置 (tsconfig.json)</span>
{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"strict"</span>: <span class="hljs-literal">true</span>,           <span class="hljs-comment">// 启用所有严格检查</span>
    <span class="hljs-string">"noUnusedLocals"</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 检测未使用的变量</span>
    <span class="hljs-string">"noUnusedParameters"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 检测未使用的参数</span>
    <span class="hljs-string">"noImplicitReturns"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 确保所有代码路径都有返回值</span>
    <span class="hljs-string">"noFallthroughCasesInSwitch"</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 检测switch语句的fallthrough</span>
  }
}

<span class="hljs-comment">// 编译时发现的问题</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculateDiscount</span>(<span class="hljs-params">price: <span class="hljs-built_in">number</span>, customerType: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">let</span> discount = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">switch</span> (customerType) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"premium"</span>:
      discount = <span class="hljs-number">0.2</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"regular"</span>:
      discount = <span class="hljs-number">0.1</span>;
      <span class="hljs-comment">// ❌ 编译错误：fallthrough case detected</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"new"</span>:
      discount = <span class="hljs-number">0.05</span>;
      <span class="hljs-keyword">break</span>;
  }
  
  <span class="hljs-comment">// ❌ 编译错误：Not all code paths return a value</span>
}
</code></pre>
<h3 data-id="heading-18">测试支持</h3>
<pre><code class="hljs language-php" lang="php">TypeScript
<span class="hljs-comment">// 类型安全的测试</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MockUser</span> </span>{
  id: number;
  name: <span class="hljs-keyword">string</span>;
  email: <span class="hljs-keyword">string</span>;
}

<span class="hljs-comment">// 测试工厂函数</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createMockUser</span>(<span class="hljs-params">overrides: Partial&lt;MockUser&gt; = {}</span>): <span class="hljs-title">MockUser</span> </span>{
  <span class="hljs-keyword">return</span> {
    id: <span class="hljs-number">1</span>,
    name: <span class="hljs-string">"Test User"</span>,
    email: <span class="hljs-string">"test@example.com"</span>,
    ...overrides
  };
}

<span class="hljs-comment">// 类型安全的Mock</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">mockUserService</span>: jest.Mocked&lt;UserService&gt; = {
  createUser: jest.fn(),
  getUserById: jest.fn(),
  updateUser: jest.fn(),
  deleteUser: jest.fn()
};

<span class="hljs-comment">// 测试用例</span>
<span class="hljs-title function_ invoke__">describe</span>(<span class="hljs-string">"UserController"</span>, () =&gt; {
  <span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">"should create user successfully"</span>, <span class="hljs-title function_ invoke__">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> mockUser = <span class="hljs-title function_ invoke__">createMockUser</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span> });
    mockUserService.createUser.<span class="hljs-title function_ invoke__">mockResolvedValue</span>(mockUser);
    
    <span class="hljs-keyword">const</span> result = await userController.<span class="hljs-title function_ invoke__">createUser</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">"john@example.com"</span>,
      <span class="hljs-attr">password</span>: <span class="hljs-string">"password123"</span>
    });
    
    <span class="hljs-title function_ invoke__">expect</span>(result).<span class="hljs-title function_ invoke__">toEqual</span>(mockUser);
    <span class="hljs-title function_ invoke__">expect</span>(mockUserService.createUser).<span class="hljs-title function_ invoke__">toHaveBeenCalledWith</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">"john@example.com"</span>,
      <span class="hljs-attr">password</span>: <span class="hljs-string">"password123"</span>
    });
  });
});
</code></pre>
<hr/>
<h2 data-id="heading-19">7️⃣ 性能和包大小优化</h2>
<h3 data-id="heading-20">Tree Shaking优化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">TypeScript</span>
<span class="hljs-comment">// utils/math.ts - 模块化的工具函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a - b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a * b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">if</span> (b === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Division by zero"</span>);
  <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-comment">// main.ts - 只导入需要的函数</span>
<span class="hljs-keyword">import</span> { add, multiply } <span class="hljs-keyword">from</span> <span class="hljs-string">"./utils/math"</span>;

<span class="hljs-comment">// TypeScript + 现代打包工具会自动移除未使用的subtract和divide函数</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">multiply</span>(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>));
</code></pre>
<h3 data-id="heading-21">编译时优化</h3>
<pre><code class="hljs language-css" lang="css">TypeScript
// 开发时的详细类型
interface DetailedUser {
  id: number;
  name: string;
  email: string;
  profile: {
    avatar: string;
    bio: string;
    preferences: {
      theme: <span class="hljs-string">"light"</span> | <span class="hljs-string">"dark"</span>;
      language: string;
      notifications: boolean;
    };
  };
  metadata: {
    createdAt: Date;
    updatedAt: Date;
    lastLogin: Date;
  };
}

// 编译后的JavaScript是纯净的，没有类型信息
function processUser(user) {
  return {
    displayName: user.name,
    avatar: user.profile.avatar
  };
}
</code></pre>
<hr/>
<h2 data-id="heading-22">8️⃣ 实际项目对比</h2>
<h3 data-id="heading-23">中型电商项目案例</h3>
<h4 data-id="heading-24">JavaScript版本的问题</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">JavaScript</span>
<span class="hljs-comment">// 6个月后维护时遇到的实际问题</span>

<span class="hljs-comment">// 1. 不知道商品对象的结构</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculatePrice</span>(<span class="hljs-params">product, quantity, discountCode</span>) {
  <span class="hljs-comment">// product.price是数字还是字符串？</span>
  <span class="hljs-comment">// discountCode是什么格式？</span>
  <span class="hljs-keyword">let</span> price = product.<span class="hljs-property">price</span> * quantity;
  
  <span class="hljs-keyword">if</span> (discountCode) {
    <span class="hljs-comment">// 不知道如何应用折扣</span>
    price = <span class="hljs-title function_">applyDiscount</span>(price, discountCode);
  }
  
  <span class="hljs-keyword">return</span> price;
}

<span class="hljs-comment">// 2. API响应结构不明确</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/products'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-comment">// data是数组还是对象？</span>
    <span class="hljs-comment">// 有分页信息吗？</span>
    data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
      <span class="hljs-comment">// product有什么属性？</span>
      <span class="hljs-title function_">displayProduct</span>(product);
    });
  });

<span class="hljs-comment">// 3. 状态管理混乱</span>
<span class="hljs-keyword">const</span> cartState = {
  <span class="hljs-attr">items</span>: [],
  <span class="hljs-attr">total</span>: <span class="hljs-number">0</span>,
  <span class="hljs-comment">// 还有什么属性？</span>
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">addToCart</span>(<span class="hljs-params">productId, quantity</span>) {
  <span class="hljs-comment">// 需要查看所有相关代码才知道如何正确更新状态</span>
}
</code></pre>
<h4 data-id="heading-25">TypeScript版本的清晰度</h4>
<pre><code class="hljs language-ini" lang="ini">TypeScript
// 清晰的领域模型
interface Product {
  id: string<span class="hljs-comment">;</span>
  name: string<span class="hljs-comment">;</span>
  price: number<span class="hljs-comment">; // 以分为单位</span>
  category: ProductCategory<span class="hljs-comment">;</span>
  inventory: number<span class="hljs-comment">;</span>
  images: string<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  description: string<span class="hljs-comment">;</span>
}

interface CartItem {
  productId: string<span class="hljs-comment">;</span>
  quantity: number<span class="hljs-comment">;</span>
  unitPrice: number<span class="hljs-comment">;</span>
  totalPrice: number<span class="hljs-comment">;</span>
}

interface CartState {
  items: CartItem<span class="hljs-section">[]</span><span class="hljs-comment">;</span>
  subtotal: number<span class="hljs-comment">;</span>
  tax: number<span class="hljs-comment">;</span>
  shipping: number<span class="hljs-comment">;</span>
  total: number<span class="hljs-comment">;</span>
  discountCode?: string<span class="hljs-comment">;</span>
  discountAmount: number<span class="hljs-comment">;</span>
}

interface ApiResponse&lt;T&gt; {
  data: T<span class="hljs-comment">;</span>
  pagination?: {
    page: number<span class="hljs-comment">;</span>
    limit: number<span class="hljs-comment">;</span>
    total: number<span class="hljs-comment">;</span>
    hasNext: boolean<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}

// 类型安全的业务逻辑
class PriceCalculator {
  static calculateItemPrice(
    product: Product, 
    quantity: number, 
    discountCode?: string
  ): number {
    let <span class="hljs-attr">price</span> = product.price * quantity<span class="hljs-comment">;</span>
    
    if (discountCode) {
      <span class="hljs-attr">price</span> = this.applyDiscount(price, discountCode)<span class="hljs-comment">;</span>
    }
    
    return price<span class="hljs-comment">;</span>
  }
  
  private static applyDiscount(price: number, code: string): number {
    // 实现折扣逻辑
    return price<span class="hljs-comment">;</span>
  }
}

// 类型安全的API调用
class ProductService {
  async getProducts(): Promise&lt;ApiResponse&lt;Product<span class="hljs-section">[]</span>&gt;&gt; {
    const <span class="hljs-attr">response</span> = await fetch(<span class="hljs-string">'/api/products'</span>)<span class="hljs-comment">;</span>
    return response.json()<span class="hljs-comment">;</span>
  }
}

// 类型安全的状态管理
class CartManager {
  private state: <span class="hljs-attr">CartState</span> = {
    items: <span class="hljs-section">[]</span>,
    subtotal: 0,
    tax: 0,
    shipping: 0,
    total: 0,
    discountAmount: 0
  }<span class="hljs-comment">;</span>
  
  addItem(product: Product, quantity: number): void {
    const <span class="hljs-attr">existingItem</span> = this.state.items.find(item =&gt; 
      <span class="hljs-attr">item.productId</span> === product.id
    )<span class="hljs-comment">;</span>
    
    if (existingItem) {
      existingItem.quantity += quantity<span class="hljs-comment">;</span>
      <span class="hljs-attr">existingItem.totalPrice</span> = existingItem.unitPrice * existingItem.quantity<span class="hljs-comment">;</span>
    } else {
      this.state.items.push({
        productId: product.id,
        quantity,
        unitPrice: product.price,
        totalPrice: product.price * quantity
      })<span class="hljs-comment">;</span>
    }
    
    this.recalculateTotal()<span class="hljs-comment">;</span>
  }
  
  private recalculateTotal(): void {
    <span class="hljs-attr">this.state.subtotal</span> = this.state.items.reduce(
      (sum, item) =&gt; sum + item.totalPrice, 
      0
    )<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.state.tax</span> = this.state.subtotal * <span class="hljs-number">0.08</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">this.state.total</span> = this.state.subtotal + this.state.tax + this.state.shipping - this.state.discountAmount<span class="hljs-comment">;</span>
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-26">📊 投资回报率分析</h2>
<h3 data-id="heading-27">开发效率提升</h3>
<pre><code class="hljs language-arduino" lang="arduino">TypeScript
<span class="hljs-comment">// 统计数据（基于实际项目经验）</span>

<span class="hljs-comment">// 1. Bug减少率</span>
<span class="hljs-comment">// JavaScript项目：平均每1000行代码15-20个运行时错误</span>
<span class="hljs-comment">// TypeScript项目：平均每1000行代码3-5个运行时错误</span>
<span class="hljs-comment">// 减少率：70-80%</span>

<span class="hljs-comment">// 2. 开发时间</span>
<span class="hljs-comment">// 新功能开发：TypeScript初期慢10-15%，后期快20-30%</span>
<span class="hljs-comment">// Bug修复时间：TypeScript平均减少50%</span>
<span class="hljs-comment">// 代码审查时间：减少30-40%</span>

<span class="hljs-comment">// 3. 维护成本</span>
<span class="hljs-comment">// 6个月后的代码理解时间：减少60%</span>
<span class="hljs-comment">// 重构风险：减少80%</span>
<span class="hljs-comment">// 新团队成员上手时间：减少40%</span>
</code></pre>
<h3 data-id="heading-28">实际成本对比</h3>
<pre><code class="hljs language-arduino" lang="arduino">TypeScript
<span class="hljs-comment">// 小型项目（&lt;10k行代码）</span>
<span class="hljs-comment">// TypeScript额外成本：类型定义时间 +20%</span>
<span class="hljs-comment">// TypeScript收益：调试时间 -30%，维护时间 -25%</span>
<span class="hljs-comment">// 净收益：项目后期开始显现</span>

<span class="hljs-comment">// 中型项目（10k-50k行代码）  </span>
<span class="hljs-comment">// TypeScript额外成本：+15%</span>
<span class="hljs-comment">// TypeScript收益：-40%调试，-35%维护，-50%重构风险</span>
<span class="hljs-comment">// 净收益：3-6个月后显著</span>

<span class="hljs-comment">// 大型项目（&gt;50k行代码）</span>
<span class="hljs-comment">// TypeScript额外成本：+10%</span>
<span class="hljs-comment">// TypeScript收益：-50%调试，-45%维护，-70%重构风险</span>
<span class="hljs-comment">// 净收益：立即显现，长期收益巨大</span>
</code></pre>
<hr/>
<h2 data-id="heading-29">🎯 总结：何时使用TypeScript</h2>
<h3 data-id="heading-30">强烈推荐使用的场景</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">TypeScript
<span class="hljs-comment">// 1. 团队项目（&gt;2人）</span>
<span class="hljs-comment">// 2. 长期维护项目（&gt;6个月）</span>
<span class="hljs-comment">// 3. 复杂业务逻辑</span>
<span class="hljs-comment">// 4. 多模块/微服务架构</span>
<span class="hljs-comment">// 5. 需要高可靠性的项目</span>
<span class="hljs-comment">// 6. 有API集成的项目</span>
<span class="hljs-comment">// 7. 需要重构的遗留项目</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProjectRecommendation</span> {
  teamSize: number;
  projectDuration: <span class="hljs-string">"short"</span> | <span class="hljs-string">"medium"</span> | <span class="hljs-string">"long"</span>;
  complexity: <span class="hljs-string">"low"</span> | <span class="hljs-string">"medium"</span> | <span class="hljs-string">"high"</span>;
  reliability: <span class="hljs-string">"normal"</span> | <span class="hljs-string">"high"</span> | <span class="hljs-string">"critical"</span>;
  recommendation: <span class="hljs-string">"optional"</span> | <span class="hljs-string">"recommended"</span> | <span class="hljs-string">"essential"</span>;
}

<span class="hljs-keyword">const</span> scenarios: ProjectRecommendation[] = [
  {
    teamSize: <span class="hljs-number">1</span>,
    projectDuration: <span class="hljs-string">"short"</span>,
    complexity: <span class="hljs-string">"low"</span>,
    reliability: <span class="hljs-string">"normal"</span>,
    recommendation: <span class="hljs-string">"optional"</span>
  },
  {
    teamSize: <span class="hljs-number">3</span>,
    projectDuration: <span class="hljs-string">"medium"</span>, 
    complexity: <span class="hljs-string">"medium"</span>,
    reliability: <span class="hljs-string">"high"</span>,
    recommendation: <span class="hljs-string">"recommended"</span>
  },
  {
    teamSize: <span class="hljs-number">5</span>,
    projectDuration: <span class="hljs-string">"long"</span>,
    complexity: <span class="hljs-string">"high"</span>, 
    reliability: <span class="hljs-string">"critical"</span>,
    recommendation: <span class="hljs-string">"essential"</span>
  }
];
</code></pre>
<h3 data-id="heading-31">可以考虑不用的场景</h3>
<pre><code class="hljs language-arduino" lang="arduino">JavaScript
<span class="hljs-comment">// 1. 快速原型/概念验证</span>
<span class="hljs-comment">// 2. 一次性脚本</span>
<span class="hljs-comment">// 3. 简单的静态网站</span>
<span class="hljs-comment">// 4. 学习JavaScript基础时</span>
<span class="hljs-comment">// 5. 非常小的项目（&lt;1000行）</span>
<span class="hljs-comment">// 6. 团队完全没有TypeScript经验且时间紧迫</span>

<span class="hljs-comment">// 但即使这些场景，TypeScript的长期收益通常也值得投资</span>
</code></pre>
<p><strong>结论：TypeScript通过编译时类型检查，显著提高了代码质量、开发效率和项目可维护性。虽然有学习成本，但对于任何需要长期维护或团队协作的项目，TypeScript都是明智的选择。</strong></p>
<p>参考网址：<a href="https://juejin.cn/post/7511290103962714122#heading-9" target="_blank" title="https://juejin.cn/post/7511290103962714122#heading-9">juejin.cn/post/751129…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VeADK Agent 一键容器化部署，万字长文带你实战演练]]></title>    <link>https://juejin.cn/post/7598390244379738150</link>    <guid>https://juejin.cn/post/7598390244379738150</guid>    <pubDate>2026-01-23T10:18:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390244379738150" data-draft-id="7598374376093859867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VeADK Agent 一键容器化部署，万字长文带你实战演练"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-23T10:18:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火山引擎开发者社区"/> <meta itemprop="url" content="https://juejin.cn/user/3307770588439422"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VeADK Agent 一键容器化部署，万字长文带你实战演练
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3307770588439422/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火山引擎开发者社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T10:18:50.000Z" title="Fri Jan 23 2026 10:18:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>背景</p>
<p>近年来，人工智能技术的发展正从模型为中心转向以应用为中心，智能体（Agent）作为 AI 应用的核心载体，其落地部署需求日益迫切。而随着 AI 应用向生产环境迁移，以 Kubernetes 为核心的云原生基础设施成为很多企业的默认选择，为 Agent 应用提供标准化、可扩展且具备成本效益的运行时环境势在必行。</p>
<p>根据 CNCF 最新发布的年度云原生调查：</p>
<blockquote>
<p>Kubernetes 已从容器编排工具，发展为现代基础设施的核心，包括 AI 领域。在容器用户中，82% 已在生产环境使用 Kubernetes，66% 的 AI 采用者用它来扩展推理任务。Kubernetes 不再是小众工具，而是支撑规模、可靠性和 AI 系统的基础层。 —— CNCF Annual Cloud Native Survey The infrastructure of AI’s future</p>
</blockquote>
<p>火山引擎的 Agent 开发套件（VeADK/AgentKit）目前已具备将 Agent 应用一键部署至函数服务（veFaaS）的能力。该路径为开发者提供了快速验证和轻量级部署的便利。然而，当 Agent 应用从实验阶段走向生产成熟阶段，其对环境的要求也随之提升。生产级应用通常需要更强的环境控制力、更复杂的依赖管理、更可靠的运行保障以及更精细的成本控制。因此，将 Agent 应用的部署目标从 veFaaS 延伸至火山引擎容器服务（VKE），是满足其生产化需求的必然演进。</p>
<p>VKE 作为一个生产级的 Kubernetes 托管服务，能够提供：</p>
<ul>
<li>安全可靠的环境：通过 IAM for Service Accounts （IRSA） 等机制实现细粒度的权限管控，避免敏感密钥硬编码。</li>
<li>极致的弹性伸缩：借助水平 Pod 自动扩缩容（HPA），根据负载自动调整资源，实现成本与性能的最佳平衡。</li>
<li>全面的可观测性：无缝集成日志服务、监控告警等系统，提供端到端的应用健康度洞察。</li>
<li>开放的云原生生态：与 API 网关、持续集成与持续部署（CI/CD）等工具链深度整合，加速应用交付与迭代。</li>
</ul>
<p>本文旨在介绍一套将 VeADK Agent 部署至 VKE 的标准化路径，为 AI 应用提供一个真正意义上的生产级云原生托管方案，实现从开发、部署到运维的全生命周期高效管理。</p>
<h2 data-id="heading-0">操作流程</h2>
<ol>
<li>创建 VKE 托管版集群及节点池。</li>
<li>使用 IRSA 机制，安全地将应用与火山引擎的其他云服务 API 连接。</li>
<li>使用 <code>Dockerfile</code> 将应用容器化，并将其推送到火山引擎容器镜像服务（CR）。</li>
<li>编写并应用 Deployment 和 Service 的 Kubernetes 声明式配置。</li>
<li>使用水平 Pod 自动扩缩容（HPA）配置应用的弹性伸缩。</li>
<li>使用火山引擎 API 网关将应用发布至公网。</li>
<li>日志查看与监控观测。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72198a72404d4fbab33570bb2ac7d3d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5bGx5byV5pOO5byA5Y-R6ICF56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768330&amp;x-signature=dYqeDF1o%2FdmTSuUWnYDqaoXH0vU%3D" alt="" loading="lazy"/></p>
<p>VeADK Agent 容器化部署实践</p>
<p><strong>环境准备</strong></p>
<p>在开始操作前，请完成以下准备工作。</p>
<p><strong>火山引擎账号与访问密钥</strong></p>
<p>你需要一个已完成实名认证的火山引擎账号，并创建访问密钥（Access Key），用于本地与云端资源的身份验证。</p>
<ul>
<li>注册账号：若无账号，请前往<strong>火山引擎官网</strong>注册并完成实名认证。</li>
<li>创建访问密钥（AK/SK）：</li>
</ul>
<p>a. 登录火山引擎控制台。</p>
<p>b. 进入访问控制服务。</p>
<p>c. 在左侧导航栏选择用户，找到你的 IAM 用户（或新建用户）。</p>
<p>d. 点击用户名进入详情页，选择密钥管理标签页。</p>
<p>e. 点击新建密钥，生成 Access Key ID（AK）和 Secret Access Key（SK）。</p>
<blockquote>
<p>重要提示：AK/SK 代表你的账户权限，请妥善保管，避免泄露导致安全风险。</p>
</blockquote>
<p><strong>配置本地开发环境</strong></p>
<p>安装以下命令行工具，用于操作火山引擎 VKE 及 Kubernetes 集群。</p>
<ul>
<li><strong>安装 kubectl</strong>: <code>kubectl</code> 是与 Kubernetes 集群交互的标准命令行工具。请参考 Kubernetes 官方文档进行安装：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkubernetes.io%2Fdocs%2Ftasks%2Ftools%2Finstall-kubectl-linux%2F%25E3%2580%2582" target="_blank" title="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/%E3%80%82" ref="nofollow noopener noreferrer">kubernetes.io/docs/tasks/…</a></li>
<li><strong>安装并配置火山引擎 CLI</strong>: 火山引擎 CLI 工具可以帮助你通过命令行管理云资源。</li>
</ul>
<ol>
<li><strong>安装 CLI</strong>: 请参考火山引擎 CLI 官方文档进行安装：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.volcengine.com%2Fdocs%2F83927%2F1184023%3Flang%3Dzh%25E3%2580%2582" target="_blank" title="https://www.volcengine.com/docs/83927/1184023?lang=zh%E3%80%82" ref="nofollow noopener noreferrer">www.volcengine.com/docs/83927/…</a>**<br/>
**</li>
<li><strong>配置 CLI</strong>: 安装完成后，运行配置命令，并输入你之前创建的 AK/SK 和默认地域（例如 <code>cn-beijing</code>）。</li>
</ol>

<pre><code class="hljs">volc configure
</code></pre>
<p>根据提示依次输入 AK、SK、Region 和 Output 格式。</p>
<pre><code class="hljs language-markdown" lang="markdown">Access Key ID [<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>YQ==]: YOUR<span class="hljs-emphasis">_ACCESS_</span>KEY
Secret Access Key [<span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span>NQ==]: YOUR<span class="hljs-emphasis">_SECRET_</span>KEY
Region [cn-beijing]: cn-beijing
Output [json]: json
</code></pre>
<p><strong>开通所需云服务</strong></p>
<p>请确保在火山引擎控制台已激活以下服务：</p>
<ul>
<li>容器服务（VKE）：用于部署与管理 AI 代理应用。</li>
<li>容器镜像服务（CR）：用于存储应用容器镜像。</li>
<li>API 网关（APIG）：用于将服务公开至公网。</li>
<li>日志服务（TLS）：用于收集与分析应用日志。</li>
</ul>
<p><strong>安装项目依赖</strong></p>
<p>安装 uv 包管理器：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS / Linux（官方安装脚本）</span>
curl -LsSf https://astral.sh/uv/install.sh | sh

<span class="hljs-comment"># 或使用 Homebrew（macOS）</span>
brew install uv
</code></pre>
<p>初始化项目依赖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果没有 `uv` 虚拟环境，可以使用命令先创建一个虚拟环境</span>
uv venv --python 3.12

<span class="hljs-comment"># 使用 `pyproject.toml` 管理依赖</span>
uv <span class="hljs-built_in">sync</span>

<span class="hljs-comment"># 激活虚拟环境</span>
<span class="hljs-built_in">source</span> .venv/bin/activate
</code></pre>
<p><strong>基础设施准备：创建 VKE 集群与节点</strong></p>
<p>部署的第一步是搭建承载 Agent 应用的 Kubernetes 环境。</p>
<p><strong>创建 VKE 托管版集群</strong></p>
<p>首先，你需要创建一个 VKE 托管版集群作为 AI Agent 部署的基石。选择“托管版”可将 Kubernetes 控制面的管理工作（如扩缩容、升级和运维）交由火山引擎负责，使团队能更专注于业务应用。</p>
<ol>
<li>创建集群</li>
</ol>
<p>在终端中，创建一个名为 <code>vke-veadk</code> 的集群</p>
<pre><code class="hljs language-vbnet" lang="vbnet">ve vke CreateCluster --body <span class="hljs-comment">'{</span>
    <span class="hljs-string">"KubernetesVersion"</span>: <span class="hljs-string">"1.30"</span>,
    <span class="hljs-string">"Name"</span>: <span class="hljs-string">"vke-veadk"</span>,
    <span class="hljs-string">"DeleteProtectionEnabled"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-string">"ProjectName"</span>: <span class="hljs-string">"default"</span>,
    <span class="hljs-string">"ServicesConfig"</span>: {
        <span class="hljs-string">"ServiceCidrsv4"</span>: [
            <span class="hljs-string">"192.168.120.0/22"</span>
        ]
    },
    <span class="hljs-string">"ClusterConfig"</span>: {
        <span class="hljs-string">"SubnetIds"</span>: [
            <span class="hljs-string">"&lt;subnet-1&gt;"</span>,
            <span class="hljs-string">"&lt;subnet-2&gt;"</span>,
            <span class="hljs-string">"&lt;subnet-3&gt;"</span>
        ],
        <span class="hljs-string">"ApiServerPublicAccessEnabled"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"ApiServerPublicAccessConfig"</span>: {
            <span class="hljs-string">"PublicAccessNetworkConfig"</span>: {
                <span class="hljs-string">"Bandwidth"</span>: <span class="hljs-number">10</span>,
                <span class="hljs-string">"BillingType"</span>: <span class="hljs-number">3</span>
            }
        },
        <span class="hljs-string">"ResourcePublicAccessDefaultEnabled"</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-string">"PodsConfig"</span>: {
        <span class="hljs-string">"PodNetworkMode"</span>: <span class="hljs-string">"VpcCniShared"</span>,
        <span class="hljs-string">"VpcCniConfig"</span>: {
            <span class="hljs-string">"SubnetIds"</span>: [
                <span class="hljs-string">"&lt;subnet-1&gt;"</span>,
                <span class="hljs-string">"&lt;subnet-2&gt;"</span>,
                <span class="hljs-string">"&lt;subnet-3&gt;"</span>
            ]
        }
    },
    <span class="hljs-string">"KubernetesConfig"</span>: {
        <span class="hljs-string">"ControlPlaneConfig"</span>: {
            <span class="hljs-string">"KubeApiServerConfig"</span>: {
                <span class="hljs-string">"AdmissionPlugins"</span>: {
                    <span class="hljs-string">"AlwaysPullImages"</span>: <span class="hljs-literal">true</span>
                }
            }
        }
    },
    <span class="hljs-string">"MaintenanceWindowConfig"</span>: {
        <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"Duration"</span>: <span class="hljs-number">4</span>,
        <span class="hljs-string">"WeeklyCycle"</span>: [
            <span class="hljs-string">"Tuesday"</span>,
            <span class="hljs-string">"Wednesday"</span>
        ],
        <span class="hljs-string">"StartTime"</span>: <span class="hljs-string">"17:00:00Z"</span>
    },
    <span class="hljs-string">"MonitoringConfig"</span>: {
        <span class="hljs-string">"WorkspaceId"</span>: <span class="hljs-string">"&lt;bbf418e8-***&gt;"</span>,
        <span class="hljs-string">"ComponentConfigs"</span>: [
            {
                <span class="hljs-string">"Name"</span>: <span class="hljs-string">"KubeApiServer"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            },
            {
                <span class="hljs-string">"Name"</span>: <span class="hljs-string">"KubeScheduler"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            },
            {
                <span class="hljs-string">"Name"</span>: <span class="hljs-string">"Etcd"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            },
            {
                <span class="hljs-string">"Name"</span>: <span class="hljs-string">"ClusterAutoscaler"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            }
        ]
    },
    <span class="hljs-string">"LoggingConfig"</span>: {
        <span class="hljs-string">"LogProjectId"</span>: <span class="hljs-string">"de71fc2e-***"</span>,
        <span class="hljs-string">"LogSetups"</span>: [
            {
                <span class="hljs-string">"LogType"</span>: <span class="hljs-string">"KubeApiServer"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            },
            {
                <span class="hljs-string">"LogType"</span>: <span class="hljs-string">"KubeScheduler"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            },
            {
                <span class="hljs-string">"LogType"</span>: <span class="hljs-string">"KubeControllerManager"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">false</span>
            },
            {
                <span class="hljs-string">"LogType"</span>: <span class="hljs-string">"Etcd"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">true</span>
            },
            {
                <span class="hljs-string">"LogType"</span>: <span class="hljs-string">"ClusterAutoscaler"</span>,
                <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">false</span>
            }
        ]
    }
}<span class="hljs-comment">'</span>
</code></pre>
<blockquote>
<p>说明：集群创建过程大约需要 5-10 分钟。请耐心等待。</p>
</blockquote>
<ol start="2">
<li>创建节点池</li>
</ol>
<p>在集群内创建一个或多个节点池，用于运行 Agent 应用的工作负载。建议根据应用对计算、内存或 GPU 的需求，选择合适的 ECS 实例规格。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Plain <span class="hljs-keyword">Text</span>
ve vke CreateNodePool --body <span class="hljs-comment">'{</span>
    <span class="hljs-string">"ClusterId"</span>: <span class="hljs-string">"&lt;cd57q2***&gt;"</span>,
    <span class="hljs-string">"Name"</span>: <span class="hljs-string">"agent-nodes"</span>,
    <span class="hljs-string">"KubernetesConfig"</span>: {
        <span class="hljs-string">"Labels"</span>: [],
        <span class="hljs-string">"Cordon"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-string">"AutoSyncDisabled"</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-string">"NodeConfig"</span>: {
        <span class="hljs-string">"InstanceTypeIds"</span>: [
            <span class="hljs-string">"ecs.g3il.xlarge"</span>,
            <span class="hljs-string">"ecs.g3il.2xlarge"</span>,
            <span class="hljs-string">"ecs.g3il.4xlarge"</span>
        ],
        <span class="hljs-string">"ImageType"</span>: <span class="hljs-string">""</span>,
        <span class="hljs-string">"ImageId"</span>: <span class="hljs-string">"image-ybqi99s7yq8rx7mnk44b"</span>,
        <span class="hljs-string">"SubnetIds"</span>: [
            <span class="hljs-string">"&lt;subnet-1&gt;"</span>,
            <span class="hljs-string">"&lt;subnet-2&gt;"</span>,
            <span class="hljs-string">"&lt;subnet-3&gt;"</span>
        ],
        <span class="hljs-string">"SystemVolume"</span>: {
            <span class="hljs-string">"Size"</span>: <span class="hljs-number">40</span>,
            <span class="hljs-string">"Type"</span>: <span class="hljs-string">"ESSD_PL0"</span>
        },
        <span class="hljs-string">"DataVolumes"</span>: [
            {
                <span class="hljs-string">"Size"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"Type"</span>: <span class="hljs-string">"ESSD_PL0"</span>
            }
        ],
        <span class="hljs-string">"Security"</span>: {
            <span class="hljs-string">"SecurityStrategies"</span>: [
                <span class="hljs-string">"Hids"</span>
            ],
            <span class="hljs-string">"Login"</span>: {
                <span class="hljs-string">"SshKeyPairName"</span>: <span class="hljs-string">"&lt;key-***&gt;"</span>
            }
        },
        <span class="hljs-string">"InstanceChargeType"</span>: <span class="hljs-string">"PostPaid"</span>,
        <span class="hljs-string">"Period"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"AutoRenew"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"AutoRenewPeriod"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"AdditionalContainerStorageEnabled"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"HpcClusterIds"</span>: [],
        <span class="hljs-string">"ProjectName"</span>: <span class="hljs-string">"default"</span>
    },
    <span class="hljs-string">"AutoScaling"</span>: {
        <span class="hljs-string">"DesiredReplicas"</span>: <span class="hljs-number">3</span>,
        <span class="hljs-string">"SubnetPolicy"</span>: <span class="hljs-string">"ZoneBalance"</span>
    },
    <span class="hljs-string">"Management"</span>: {
        <span class="hljs-string">"Enabled"</span>: <span class="hljs-literal">false</span>
    }
}<span class="hljs-comment">'</span>
</code></pre>
<p>3.  生成 kubeconfig 并连接 VKE 集群</p>

<pre><code class="hljs language-vbnet" lang="vbnet">Plain <span class="hljs-keyword">Text</span>
ve vke CreateKubeconfig --body <span class="hljs-comment">'{</span>
    <span class="hljs-string">"ClusterId"</span>: <span class="hljs-string">"&lt;cd57q2***&gt;"</span>,
    <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Public"</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p>4.  连接 VKE 集群</p>
<p>集群创建成功后，需要配置 kubectl 以便能够连接并管理它。</p>
<p>步骤1 获取 kubeconfig：</p>
<pre><code class="hljs language-css" lang="css">ve vke ListKubeconfigs <span class="hljs-attr">--body</span> '{
    "<span class="hljs-attribute">Filter</span>": {
        "ClusterIds": [<span class="hljs-string">"&lt;cd57qavvv9l***&gt;"</span>],
        <span class="hljs-string">"Types"</span>: [<span class="hljs-string">"Public"</span>]
    }
}' | jq -r '<span class="hljs-selector-class">.Result</span><span class="hljs-selector-class">.Items</span><span class="hljs-selector-attr">[0]</span><span class="hljs-selector-class">.Kubeconfig</span>'
</code></pre>
<p>步骤2 在你的本地终端中，粘贴并执行该命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例命令，请以你控制台实际生成的为准</span>
<span class="hljs-built_in">export</span> KUBECONFIG=~/.kube/config_vke_adk-vke-cluster_****
kubectl config use-context adk-vke-cluster
</code></pre>
<p>步骤3 执行完成后，运行以下命令验证是否已成功连接到集群：</p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl get nodes
</code></pre>
<p>如果能看到你创建的节点信息列表，说明连接已成功建立。从现在起，你的 <code>kubectl</code> 命令都将指向这个新的 VKE 集群。</p>
<p>开启安全围栏配置（IRSA）</p>
<p>为了保障云服务访问的安全性，本方案采用 IAM for Service Accounts （IRSA） 机制，避免在应用代码或容器镜像中硬编码或存储静态的访问密钥（AK/SK）。</p>
<p>IRSA 的核心机制是将 Kubernetes 的服务账号（ServiceAccount, KSA）与火山引擎的 IAM 角色进行绑定。当一个 Pod 被配置为使用此 KSA 启动时，VKE 会自动为其注入临时的、具有特定权限的安全凭证。这样，Pod 内的应用程序（即 Agent）便可通过标准 SDK 直接调用其被授权的云服务 API，无需任何手动密钥配置。</p>
<p>开启 IRSA 请参考 VKE 产品文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.volcengine.com%2Fdocs%2F6460%2F1324613%3Flang%3Dzh%25E3%2580%2582" target="_blank" title="https://www.volcengine.com/docs/6460/1324613?lang=zh%E3%80%82" ref="nofollow noopener noreferrer">www.volcengine.com/docs/6460/1…</a></p>
<ol start="5">
<li>创建 IAM 角色</li>
</ol>
<p>在 IAM 控制台，新建 OIDC 身份提供商类型的 IAM 角色，比如：agent_onvke。</p>
<ol start="6">
<li>给角色授予所需要的权限</li>
</ol>
<p>这里以方舟大模型权限为例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4ba57751ac041c9a511fa9e2d518a63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5bGx5byV5pOO5byA5Y-R6ICF56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768330&amp;x-signature=xKfldtwl1%2BvN4JAGGPo4qwQsAC0%3D" alt="" loading="lazy"/></p>
<ol start="7">
<li>授权 VKE 集群内指定命名空间（NameSpace）下的服务账号（Service Account）</li>
</ol>
<p>如 veadk-agent-sa，允许扮演上述创建的 IAM 角色。代码示例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-string">"sts:AssumeRoleWithOIDC"</span>
            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"Condition"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"StringLike"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"oidc:aud"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sts.volcengine.com"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 固定值，OIDC 中的 Audience 值。</span>
                    <span class="hljs-attr">"oidc:iss"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://oidc-vke-cn-beijing.tos-cn-beijing.volces.com/ccog93vv********"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 配置为您的集群开启 IRSA 能力后控制台中显示的“供应商 URL”信息。</span>
                    <span class="hljs-attr">"oidc:sub"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"system:serviceaccount:oidc-ns-1:oidc-sa-1"</span><span class="hljs-comment">// 需要满足格式：system:serviceaccount:{namespace}:{serviceaccount} ，其中{namespace}和{serviceaccount}是 Kubernetes 集群内目标 NameSpace 和 Service Account。</span>
                <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"Principal"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"Federated"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-string">"trn:iam::2100******:oidc-provider/vke-irsa-********"</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>8.  在 VKE 集群创建 Service Account</p>
<p>VKE SA 与 IAM 角色关联，示例文件内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">apiVersion:v1</span>
<span class="hljs-string">kind:ServiceAccount</span>
<span class="hljs-attr">metadata:</span>
<span class="hljs-string">name:oidc-sa-1</span>
<span class="hljs-string">namespace:oidc-ns-1#</span> <span class="hljs-string">Service</span> <span class="hljs-string">Account</span> <span class="hljs-string">名称。与“步骤三”中配置的</span> <span class="hljs-string">Service</span> <span class="hljs-string">Account</span> <span class="hljs-string">名称保持一致。</span>
<span class="hljs-attr">annotations:</span>
    <span class="hljs-string">vke.volcengine.com/role-trn:trn:iam::2100******:role/podrole1234#</span> <span class="hljs-string">该</span> <span class="hljs-string">Service</span> <span class="hljs-string">Account</span> <span class="hljs-string">关联的</span> <span class="hljs-string">IAM</span> <span class="hljs-string">角色</span> <span class="hljs-string">TRN（在访问控制的角色详情页面获取角色</span> <span class="hljs-string">TRN）。如果未配置该</span> <span class="hljs-string">Annotation</span> <span class="hljs-string">或配置的值不是一个合法的</span> <span class="hljs-string">IAM</span> <span class="hljs-string">角色</span> <span class="hljs-string">TRN，则使用该</span> <span class="hljs-string">Service</span> <span class="hljs-string">Account</span> <span class="hljs-string">的</span> <span class="hljs-string">Pod</span> <span class="hljs-string">将不会被自动注入配置。</span>
</code></pre>
<p>9.  为 Pod 注入 IRSA 配置</p>
<p>示例内容如下：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">apiVersion: v1</span>
<span class="hljs-section">kind:Pod</span>
<span class="hljs-section">metadata:</span>
<span class="hljs-section">name:pod-1# Pod 名称。</span>
<span class="hljs-section">namespace:oidc-ns-1# 与上方设置的 NameSpace 名称保持一致。</span>
<span class="hljs-section">spec:</span>
<span class="hljs-section">serviceAccountName:oidc-sa-1# 与上方设置的 Service Account 名称保持一致。</span>
<span class="hljs-section">volumes:# 为 Pod 设置服务账号令牌卷投影。更多信息，请见 Kubernetes 文档：https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-service-account/#serviceaccount-token-volume-projection 。</span>
<span class="hljs-section">-name:irsa-oidc-token# 卷名称，与下方 volumeMounts 下的挂载卷名称保持一致。</span>
    projected:
      defaultMode:420
      sources:
        -serviceAccountToken:
            audience:sts.volcengine.com<span class="hljs-comment"># 固定值，表示指定的 Audience 值。</span>
            expirationSeconds:3600<span class="hljs-comment"># OIDC Token 有效期，单位为：秒。</span>
            path:token
<span class="hljs-section">containers:</span>
    env:<span class="hljs-comment"># Pod 中实现请求 AssumeRoleWithOIDC 所需的环境变量。</span>
      -name:VOLCENGINE_OIDC_ROLE_TRN
        value:&lt;role_trn&gt;
      -name:VOLCENGINE_OIDC_TOKEN_FILE
        value:/var/run/secrets/vke.volcengine.com/irsa-tokens/token<span class="hljs-comment"># OIDC Token 挂载地址，与下方 volumeMounts 下的挂载地址保持一致。</span>
    image:cr-cn-beijing.volces.com/******:latest<span class="hljs-comment"># 容器镜像地址和 Tag，请配置为您自己的镜像地址。</span>
    imagePullPolicy:IfNotPresent
    name:c-test<span class="hljs-comment"># 容器名称。</span>
    volumeMounts:
      -name:irsa-oidc-token<span class="hljs-comment"># 挂载卷名称，与上方 volumes 下的卷名称保持一致。</span>
        readOnly:true
        mountPath:/var/run/secrets/vke.volcengine.com/irsa-tokens/token<span class="hljs-comment"># OIDC Token 挂载地址。</span>
</code></pre>
<p>Agent 开发与本地验证</p>
<p>本方案以官方提供的 <code>realtime_voice</code> 示例为基础，展示一个实时语音旅行规划 Agent 的开发与部署流程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbytedance%2Fagentkit-samples%2Fblob%2Fmain%2F02-use-cases%2Fbeginner%2Frealtime_voice%2FREADME.md%25E3%2580%2582" target="_blank" title="https://github.com/bytedance/agentkit-samples/blob/main/02-use-cases/beginner/realtime_voice/README.md%E3%80%82" ref="nofollow noopener noreferrer">github.com/bytedance/a…</a></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">agent</span> = Agent(
    <span class="hljs-attr">name</span>=<span class="hljs-string">"voice_assistant_agent"</span>,
    <span class="hljs-attr">model</span>=MODEL,
    <span class="hljs-attr">instruction</span>=SYSTEM_INSTRUCTION,

)
<span class="hljs-comment"># Create run config with audio settings</span>
<span class="hljs-attr">run_config</span> = RunConfig(
    <span class="hljs-attr">streaming_mode</span>=StreamingMode.BIDI,
    <span class="hljs-attr">speech_config</span>=types.SpeechConfig(
        <span class="hljs-attr">voice_config</span>=types.VoiceConfig(
            <span class="hljs-attr">prebuilt_voice_config</span>=types.PrebuiltVoiceConfig(
                <span class="hljs-attr">voice_name</span>=VOICE_NAME
            )
        )
    ),
    <span class="hljs-attr">response_modalities</span>=[<span class="hljs-string">"AUDIO"</span>],
    <span class="hljs-attr">output_audio_transcription</span>=types.AudioTranscriptionConfig(),
    <span class="hljs-attr">input_audio_transcription</span>=types.AudioTranscriptionConfig(),
)
</code></pre>
<p>在部署到 VKE 之前，开发者可在本地环境中快速启动 Agent 服务，并通过浏览器客户端进行功能验证，确保核心逻辑无误：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> realtime_voice
<span class="hljs-comment"># 启动 Agent 服务</span>
uv run agent.py
<span class="hljs-comment"># 服务将监听 http://0.0.0.0:8000</span>

<span class="hljs-comment"># 新开客户端</span>
<span class="hljs-comment"># 在浏览器中打开 client/interface.html，客户端将自动连接到 WebSocket 服务器。</span>
</code></pre>
<p>应用容器化与镜像推送</p>
<ol start="10">
<li>使用 Docker 将应用容器化</li>
</ol>
<p>为了在 Kubernetes 中运行，Agent 应用需被打包成一个标准的容器镜像。</p>
<p>在项目根目录下，创建 <code>Dockerfile</code> 文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">'EOF'</span> &gt; Dockerfile
<span class="hljs-comment"># Support custom base image</span>
FROM agentkit-cn-beijing.cr.volces.com/base/py-simple:python3.12-bookworm-slim-latest

ENV UV_SYSTEM_PYTHON=1 UV_COMPILE_BYTECODE=1 PYTHONUNBUFFERED=1 DOCKER_CONTAINER=1

COPY requirements.txt requirements.txt

RUN uv pip install -r requirements.txt

EXPOSE 8000

WORKDIR /app

<span class="hljs-comment"># Copy entire project</span>
COPY . .

CMD [<span class="hljs-string">"python"</span>, <span class="hljs-string">"-m"</span>, <span class="hljs-string">"agent"</span>]
EOF
</code></pre>
<p>11. 构建镜像并推送至火山引擎 CR</p>
<p>拥有 <code>Dockerfile</code> 之后，我们就可以构建镜像并将其推送到火山引擎容器镜像服务 （CR） 了。</p>
<p>11.1 准备 CR 实例和命名空间</p>
<pre><code class="hljs language-arduino" lang="arduino">ve cr --body <span class="hljs-string">'{}'</span>
</code></pre>
<p>11.2 登录并推送镜像</p>
<p>现在，回到你的本地终端，执行以下步骤。</p>
<ul>
<li>登录到 CR 实例：使用 <code>docker login</code> 命令。你需要提供用户名、实例访问域和之前设置的密码。</li>
</ul>

<ul>
<li>用户名：格式为 <code>&lt;火山引擎账号名&gt;@&lt;UserID&gt;</code>。</li>
<li>访问域：格式为 <code>&lt;实例名&gt;-&lt;地域&gt;.cr.volces.com</code>。</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 请替换为你的实际信息</span>
docker login <span class="hljs-attr">--username</span>=&lt;你的火山引擎用户名@UserID&gt; &lt;你的实例访问域&gt;
</code></pre>
<p>当提示输入密码时，输入你在 CR 控制台设置的实例访问凭证。看到 <code>Login Succeeded</code> 表示登录成功。</p>
<ul>
<li><strong>为镜像打标签（Tag）</strong> : <code>docker build</code> 命令会先在本地构建镜像，<code>-t</code> 参数则为它打上一个符合 CR 仓库地址格式的标签。 完整的镜像地址格式为：<code>&lt;访问域&gt;/&lt;命名空间&gt;/&lt;镜像名&gt;:&lt;版本号&gt;</code></li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 请替换为你的实际信息</span>
docker build --platform linux/amd64 -t realtime_voice:202512241645 .
docker tag realtime_voice:202512241645 wangyue-cn-beijing.cr.volces.com/agentkit/realtime_voice:202512241645
</code></pre>
<ul>
<li><strong>推送镜像</strong>：构建成功后，使用 <code>docker push</code> 命令将本地镜像推送到远端的 CR 仓库。</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">docker push wangyue-cn-beijing.cr.volces.com/agentkit/realtime_voice:202512241645
</code></pre>
<p>12. 编写 Kubernetes Deployment 和 Service</p>
<p>现在，我们将创建一个名为 <code>deployment.yaml</code> 的文件，它包含两个核心的 Kubernetes 对象：</p>
<ul>
<li><strong>Deployment</strong>: 定义了我们希望应用如何运行的蓝图。它管理着 Pod 的副本数量、容器镜像、资源请求/限制、环境变量等。</li>
<li><strong>Service</strong>: 定义了如何将我们的应用（一组 Pod）作为一个稳定的网络服务暴露出来，无论是在集群内部还是外部。</li>
</ul>
<p>在项目根目录下，创建 <code>deployment.yaml</code> 文件，并填入以下内容。</p>
<p>重要：请务必将 <code>image</code> 字段中的镜像地址替换为你自己刚刚推送到 CR 的镜像地址！</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">apiVersion: apps/v1</span>
<span class="hljs-section">kind:Deployment</span>
<span class="hljs-section">metadata:</span>
<span class="hljs-section">name:veadk-agent</span>
<span class="hljs-section">spec:</span>
<span class="hljs-section">replicas:1</span>
<span class="hljs-section">selector:</span>
    matchLabels:
      app:veadk-agent
<span class="hljs-section">template:</span>
    metadata:
      labels:
        app:veadk-agent
    spec:
      <span class="hljs-comment"># Assign the Kubernetes Service Account for Workload Identity</span>
      serviceAccountName:veadk-agent-sa
      volumes:<span class="hljs-comment"># 为 Pod 设置服务账号令牌卷投影。更多信息，请见 Kubernetes 文档：https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-service-account/#serviceaccount-token-volume-projection 。</span>
        -name:irsa-oidc-token<span class="hljs-comment"># 卷名称，与下方 volumeMounts 下的挂载卷名称保持一致。</span>
          projected:
            defaultMode:420
            sources:
              -serviceAccountToken:
                  audience:sts.volcengine.com<span class="hljs-comment"># 固定值，表示指定的 Audience 值。</span>
                  expirationSeconds:3600<span class="hljs-comment"># OIDC Token 有效期，单位为：秒。</span>
                  path:token
      containers:
      -name:veadk-agent
        imagePullPolicy:Always
        <span class="hljs-comment"># The path to the container image in Artifact Registry</span>
        <span class="hljs-comment"># image: ${REGISTRY}-${REGION}.cr.volces.com/${REGISTRY_NS}/${REGISTRY_REPO}:latest</span>
        <span class="hljs-comment"># wangyue-cn-beijing.cr.volces.com/agentkit/realtime_voice:202512231745</span>
        image:&lt;registry&gt;-beijing.cr.volces.com/agentkit/realtime_voice:202512252045
        <span class="hljs-comment"># Define the resources for GKE Autopilot to provision</span>
        resources:
          limits:
            memory:<span class="hljs-string">"1Gi"</span>
            cpu:<span class="hljs-string">"1000m"</span>
            ephemeral-storage:<span class="hljs-string">"512Mi"</span>
          requests:
            memory:<span class="hljs-string">"1Gi"</span>
            cpu:<span class="hljs-string">"1000m"</span>
            ephemeral-storage:<span class="hljs-string">"512Mi"</span>
        ports:
        -containerPort:8000
        volumeMounts:
          -name:irsa-oidc-token<span class="hljs-comment"># 挂载卷名称，与上方 volumes 下的卷名称保持一致。</span>
            readOnly:true
            mountPath:/var/run/secrets/vke.volcengine.com/irsa-tokens/token<span class="hljs-comment"># OIDC Token 挂载地址。</span>
        <span class="hljs-comment"># Environment variables passed to the application</span>
        env:
        -name:PORT
          value:<span class="hljs-string">"8000"</span>
        -name:DEPLOY_VKE
          value:<span class="hljs-string">"true"</span>
        -name:MODEL
          value:doubao_realtime_voice_model
        -name:MODEL_REALTIME_API_KEY
          value:${MODEL_REALTIME_API_KEY}
        -name:MODEL_REALTIME_APP_ID
          value:${MODEL_REALTIME_APP_ID}
        -name:VOLCENGINE_OIDC_ROLE_TRN
          value:trn:iam::2100390175:role/agent_onvke
        -name:VOLCENGINE_OIDC_TOKEN_FILE
          value:/var/run/secrets/vke.volcengine.com/irsa-tokens/token<span class="hljs-comment"># OIDC Token 挂载地址，与下方 volumeMounts 下的挂载地址保持一致。</span>
---
<span class="hljs-section">apiVersion:v1</span>
<span class="hljs-section">kind:Service</span>
<span class="hljs-section">metadata:</span>
<span class="hljs-section">name:veadk-agent</span>
<span class="hljs-section">spec:</span>
<span class="hljs-section">selector:</span>
    app:veadk-agent
<span class="hljs-section">ports:</span>
<span class="hljs-section">-name:rule</span>
    protocol:TCP
    port:80
    targetPort:8000
<span class="hljs-section">type:ClusterIP</span>
</code></pre>
<p>将应用部署至 VKE</p>
<p>所有配置文件都已就绪，现在我们可以将 AI 代理应用正式部署到 VKE 集群中。我们将使用 kubectl 将配置应用到集群，并监控部署状态，确保代理程序能够顺利启动。</p>
<ol start="13">
<li>应用部署配置</li>
</ol>
<p>在你的本地终端，也就是项目根目录下，执行以下命令：</p>
<pre><code class="hljs">kubectl apply -f deployment.yaml
</code></pre>
<p>这个 <code>kubectl apply</code> 命令会将 <code>deployment.yaml</code> 文件的内容发送给 Kubernetes API Server。API Server 读取文件后，会开始协调创建其中定义的 Deployment 和 Service 资源。</p>
<ol start="14">
<li>监控 Pod 启动状态</li>
</ol>
<p>部署指令发出后，我们可以实时观察 Pod 的启动过程，以确认一切正常。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用 --watch 参数来持续监控带有 app=adk-agent 标签的 Pod</span>
kubectl get pods <span class="hljs-attr">-l</span>=app=veadk-agent --watch
</code></pre>
<p>你将会看到 Pod 经历几个阶段：</p>
<ul>
<li>Pending: 集群已经接收 Pod 的创建请求，但尚未开始创建容器，可能正在等待节点资源或调度。</li>
<li>ContainerCreating: VKE 节点正在从你的火山引擎 CR 仓库拉取容器镜像，并准备启动容器。</li>
<li>Running: 成功！容器已经启动，并且通过了健康检查，你的 AI 代理应用现在正在运行中。</li>
</ul>
<p>当看到 Pod 状态变为 <code>Running</code> 后，你可以按下 <code>Ctrl+C</code> 来停止监控，返回到命令行提示符。</p>
<p>配置弹性伸缩</p>
<p>HPA (Horizontal Pod Autoscaler)：为 <strong>veADK Agent Deployment</strong> 配置 HPA，基于 CPU 和内存使用率自动增减 Pod 数量。如下 HPA 策略，通过水平扩容 Pod，确保 CPU 整理利用率维持在 50% 以内。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># Configures the HorizontalPodAutoscaler (HPA) to automatically scale</span>
<span class="hljs-comment"># the number of running agent pods up or down based on CPU utilization</span>
<span class="hljs-comment"># to handle varying traffic loads.</span>

<span class="hljs-section">apiVersion:autoscaling/v1</span>
<span class="hljs-section">kind:HorizontalPodAutoscaler</span>
<span class="hljs-section">metadata:</span>
<span class="hljs-section">name:veadk-agent-hpa</span>
<span class="hljs-section">spec:</span>
<span class="hljs-section">scaleTargetRef:</span>
    apiVersion:apps/v1
    kind:Deployment
    name:veadk-agent
<span class="hljs-section">minReplicas:1</span>
<span class="hljs-section">maxReplicas:5</span>
<span class="hljs-section">targetCPUUtilizationPercentage:50</span>
</code></pre>
<p>验证 HPA 策略已生效</p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl get hpa
NAME              REFERENCE                TARGETS   MINPODS   MAXPODS   REPLICAS   AGE
veadk-agent-hpa   Deployment/veadk-agent   <span class="hljs-number">0</span>%/<span class="hljs-number">50</span>%    <span class="hljs-number">1</span>         <span class="hljs-number">5</span>         <span class="hljs-number">1</span>          <span class="hljs-number">35</span>s
</code></pre>
<p>通过 API 网关暴露服务并进行交互</p>
<p>我们的代理应用已经在集群内部成功运行，但要从外部互联网访问它，我们还需要一步——创建一个 API 网关配置 Ingress 规则。APIG Ingress 基于火山引擎 API 网关（API Gateway，APIG） 提供托管的云原生网关功能，实现高可用、高扩展的 Ingress 流量管理方式。详细步骤参考官方文档。</p>
<ol start="15">
<li>创建 APIGInstance</li>
</ol>
<p>对接已有 APIG 实例，使用如下 YAML 配置，创建 APIGInstance 并对接已有 APIG 实例。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">YAML</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">loadbalancer.vke.volcengine.com/v1beta1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">APIGInstance</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">apig-instance-demo</span> <span class="hljs-comment"># APIGInstance 资源名称</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-string">gcq12c2tfm0mpjrej4***</span> <span class="hljs-comment"># 已有 APIG 实例 ID</span>
  <span class="hljs-attr">ingress:</span>
    <span class="hljs-string">enable:</span> <span class="hljs-literal">true</span><span class="hljs-comment"># 是否开启 APIG 路由同步。取值：true（开启）、false（关闭）</span>
    <span class="hljs-string">enableAllIngressClasses:</span> <span class="hljs-literal">false</span><span class="hljs-comment"># 是否同步所有的 IngressClasses，取值：true（开启）、false（关闭)</span>
    <span class="hljs-string">enableIngressWithoutIngressClass:</span> <span class="hljs-literal">false</span><span class="hljs-comment"># 是否同步未关联 IngressClass 的 Ingress。取值：true（开启）、false（关闭）</span>
    <span class="hljs-string">ingressClasses:</span> <span class="hljs-comment"># 配置路由同步生效的 IngressClasses</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">apig</span>
    <span class="hljs-string">enableAllNamespaces:</span> <span class="hljs-literal">false</span><span class="hljs-comment"># 是否同步所有的命名空间中的 Ingress，取值：true（开启）、false（关闭）</span>
    <span class="hljs-string">watchNamespaces:</span> <span class="hljs-comment"># 配置路由同步生效的命名空间</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">doc-demo</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">default</span>
</code></pre>
<p>16. 创建 APIG Ingress 规则</p>
<p>基于路径转发，APIG Ingress 支持将相同域名、不同路径的访问，转发到不同的后端。示例 apig-ingress.yaml 代码如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">YAML</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">networking.k8s.io/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Ingress</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">veadk-voice-agent</span> <span class="hljs-comment"># 路由规则的名称</span>
  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span>  <span class="hljs-comment"># 路由规则所属的命名空间</span>
  <span class="hljs-attr">annotations:</span>
    <span class="hljs-attr">ingress.vke.volcengine.com/apig-instance-name:</span> <span class="hljs-string">veadk-agent-vke-apig</span> <span class="hljs-comment"># 指定 APIGInstance 资源名称</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">ingressClassName:</span> <span class="hljs-string">apig</span>
  <span class="hljs-attr">rules:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">veadkrealtimevoiceagent.apigateway-cn-beijing.volceapi.com</span>  <span class="hljs-comment"># 需要对外提供访问的域名</span>
      <span class="hljs-attr">http:</span>
        <span class="hljs-attr">paths:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">pathType:</span> <span class="hljs-string">Prefix</span> <span class="hljs-comment"># 路径匹配规则，默认为 Prefix（前缀匹配）</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">/</span> <span class="hljs-comment"># 请求匹配的路径</span>
          <span class="hljs-attr">backend:</span>
            <span class="hljs-attr">service:</span>
              <span class="hljs-attr">name:</span> <span class="hljs-string">veadk-agent</span> <span class="hljs-comment"># 需要对接的服务名称</span>
              <span class="hljs-attr">port:</span>
                <span class="hljs-attr">number:</span> <span class="hljs-number">80</span> <span class="hljs-comment"># 需要对接服务的端口号</span>
</code></pre>
<p>17. 获取公网访问地址并测试</p>
<p>当 Ingress 规则被应用后，APIG Instance 控制器会自动创建转发规则，并将其与后端服务关联。</p>
<ul>
<li>获取外部 IP 地址：</li>
</ul>

<pre><code class="hljs language-vbnet" lang="vbnet">Bash
ve apig GetGatewayService --body <span class="hljs-comment">'{</span>
    <span class="hljs-string">"Id"</span>: <span class="hljs-string">"&lt;sd5728khjptg***&gt;"</span>
}<span class="hljs-comment">'</span>
</code></pre>
<ul>
<li>测试已部署的代理：</li>
</ul>

<pre><code class="hljs language-shell" lang="shell">Plain Text
<span class="hljs-meta prompt_"># </span><span class="bash">需要编辑 client/interface.html，将其中的第 168 行的 ws://localhost:8000 修改为 agentkit.yaml 中生成的 runtime_endpoint 字段</span>
<span class="hljs-meta prompt_"># </span><span class="bash">在浏览器中打开 client/interface.html，客户端将自动连接到 WebSocket 服务器。</span>      
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f17c2516fce54cb7a26750f6139efcad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5bGx5byV5pOO5byA5Y-R6ICF56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768330&amp;x-signature=lGLXBOYrLiKYr6QDk1h5%2BR%2F60Jk%3D" alt="" loading="lazy"/></p>
<p>日志&amp;可观测</p>
<p>使用 <code>kubectl</code> 命令查看实时日志：</p>
<pre><code class="hljs language-csharp" lang="csharp">Bash
<span class="hljs-meta"># 首先找到你的 Pod 名称</span>
kubectl <span class="hljs-keyword">get</span> pods -l=app=veadk-agent
NAME                           READY   STATUS    RESTARTS   AGE
veadk-agent<span class="hljs-number">-6b</span>cdb5d996-l2wtq   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">2</span>d19h

<span class="hljs-meta"># 然后查看特定 Pod 的日志</span>
<span class="hljs-meta"># 将 adk-agent-xxxx-yyyy 替换为你的实际 Pod 名称</span>
kubectl logs -f veadk-agent<span class="hljs-number">-6b</span>cdb5d996-l2wtq
<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-25</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">29</span> | DEBUG | live.py:<span class="hljs-number">211</span> - receive llm response: {<span class="hljs-string">'message_type'</span>: <span class="hljs-string">'SERVER_FULL_RESPONSE'</span>, <span class="hljs-string">'event'</span>: <span class="hljs-number">550</span>, <span class="hljs-string">'session_id'</span>: <span class="hljs-string">'b"b'</span><span class="hljs-number">98484414</span><span class="hljs-number">-958e-4</span>cfb-beeb<span class="hljs-number">-678</span>a769ca872<span class="hljs-string">'"'</span>, <span class="hljs-string">'payload_msg'</span>: {<span class="hljs-string">'content'</span>: <span class="hljs-string">'讲讲'</span>, <span class="hljs-string">'question_id'</span>: <span class="hljs-string">'34058118226449410'</span>, <span class="hljs-string">'reply_id'</span>: <span class="hljs-string">'34058118226450178'</span>}, <span class="hljs-string">'payload_size'</span>: <span class="hljs-number">85</span>}
<span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-25</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">29</span> | DEBUG | live.py:<span class="hljs-number">211</span> - receive llm response: {<span class="hljs-string">'message_type'</span>: <span class="hljs-string">'SERVER_FULL_RESPONSE'</span>, <span class="hljs-string">'event'</span>: <span class="hljs-number">550</span>, <span class="hljs-string">'session_id'</span>: <span class="hljs-string">'b"b'</span><span class="hljs-number">98484414</span><span class="hljs-number">-958e-4</span>cfb-beeb<span class="hljs-number">-678</span>a769ca872<span class="hljs-string">'"'</span>, <span class="hljs-string">'payload_msg'</span>: {<span class="hljs-string">'content'</span>: <span class="hljs-string">'。'</span>, <span class="hljs-string">'question_id'</span>: <span class="hljs-string">'34058118226449410'</span>, <span class="hljs-string">'reply_id'</span>: <span class="hljs-string">'34058118226450178'</span>}, <span class="hljs-string">'payload_size'</span>: <span class="hljs-number">82</span>}
</code></pre>
<p>APIG 控制台观测网关请求：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1bf564becc44aabb3c5b332e8595e9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5bGx5byV5pOO5byA5Y-R6ICF56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768330&amp;x-signature=dTMBRq0ZYdriSWChzWZS%2BmlBMwQ%3D" alt="" loading="lazy"/></p>
<p>总结</p>
<p>以上就是将 VeADK Agent 部署至 VKE 的实操介绍。对于企业级用户来说，将 Agent 应用部署至容器服务（VKE）是推动其走向生产成熟度的关键一步：不仅统一了 AI 应用的云原生技术栈，更在交付效率、性能、可靠性、成本与安全性等多个维度为用户带来了实质收益。研发团队也能够复用业界成熟的 Kubernetes 生态能力，将关注点从复杂的基础设施管理回归到 Agent 业务逻辑的创新本身。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[四大经典名著 文生图提示词]]></title>    <link>https://juejin.cn/post/7598402961904058420</link>    <guid>https://juejin.cn/post/7598402961904058420</guid>    <pubDate>2026-01-23T10:22:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598402961904058420" data-draft-id="7598355220830175284" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="四大经典名著 文生图提示词"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-23T10:22:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fengjutian"/> <meta itemprop="url" content="https://juejin.cn/user/26044007717278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            四大经典名著 文生图提示词
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044007717278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fengjutian
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T10:22:53.000Z" title="Fri Jan 23 2026 10:22:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">红楼梦黛玉提示词</h2>
<p>角色设计稿，白色背景，技术蓝图风格，闺阁服饰精细尺寸标注与中文批注，多角度散点缩略图，展示清代贵族小姐造型设计全流程。 【典籍出处】《红楼梦》第三回：林黛玉抛父进京都 【角色档案】 姓名表字：林黛玉，字颦颦，前身绛珠仙草 出身来历：姑苏人氏，巡盐御史林如海之女，贾母外孙女 性情气质：诗魂词骨，聪慧多情，敏感多愁，孤标傲世 【相貌特征】 两弯似蹙非蹙罥烟眉，一双似喜非喜含情目，态生两靥之愁，娇袭一身之病。泪光点点，娇喘微微。肌肤胜雪，削肩细腰，身姿如弱柳扶风，病态之美更添仙姿。 【闺秀装束】 发髻：青丝如云，双环垂髻少女发式，珍珠簪点缀 头饰：小巧翠羽珠钗，缀细小珍珠流苏，鬓边斜插鲜花一朵 主衣：月白色丝缎袄裙，暗绣兰花纹样，立领精致 外披：淡粉色苏绣纱帔，轻薄若烟 内衬：雪白丝绸肚兜，梅花滚边 足履：藕荷色绣花弓鞋，莲纹鞋面 【随身物件】 贴身之物：丝帕一方，绣兰花角，拭泪常备（280mm见方） 案头之物：诗稿一卷，湘妃竹管羊毫笔 随身香囊：药香囊一枚，内盛养身草药 意象之花：落红片片，葬花之锄 水彩融合水墨渲染，清代仕女画 + 文人工笔风格，月白素雅为主 + 淡粉点染 + 烟灰蓝意境 + 翠玉点缀 【服饰图鉴】 翠羽珠钗：点翠工艺与珍珠镶嵌细节（钗长120mm，珠径8mm） 袄裙立领：刺绣针法特写，兰花纹样排布（领高65mm） 纱帔披帛：苏绣纱罗通透质感（长1800mm，宽450mm） 丝帕手绢：折叠纹路与兰花刺绣（280mm × 280mm） 药香囊：丝囊结构与草药内容（高80mm） 【画面构成】 主角色呈「倚栏葬花，手持花锄，落英缤纷环绕，神情幽怨」之姿 周围标注：（珠钗，立领，腰封，百褶裙，绣鞋） 尺寸标记：120mm，280mm，1800mm</p>
<h3 data-id="heading-1">模型</h3>
<h4 data-id="heading-2">Qwen Image Turbo</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/440304e57a254f3696042adf99fda184~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=SP5jZyLmS76NTXnhATzfUDOgYEo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c23ee1eb37dc439baa408b488b05ea9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=4YLS2g7FAQdDumZbB7h0nqZoErE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a9bcdea9ace42789270637d835e6b9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=4pbkUfU%2Fp5mfC00acdTuqAbkxiw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">SeedDream 4.5 豆包</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/234bb8a1c0444b88abb81d1a11a7e6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=3mPdOFnbuxt7EYl7U4saCjzRfWw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">水浒传</h2>
<p>角色设计稿，白色背景，技术蓝图风格，江湖兵刃器具尺寸标注与中文批注，多角度散点缩略图，展示北宋草莽英雄造型设计全流程。 【典籍出处】《水浒传》第二十三回：景阳冈武松打虎 【角色档案】 姓名绑号：武松，天伤星，绑号"行者" 出身来历：清河县人氏，原阳谷县都头 性情标签：嫉恶如仇，铁骨铮铮，快意恩仇，独狼气质 【相貌特征】 身长八尺，浓眉虎目，阔口方腮，络腮短髭，体态魁梧雄壮，步伐虎行，左颊有疤痕一道 【江湖装束】 头巾：白范阳毡笠，红绸扎带 上身：血渍斑驳白色短衫，内衬黑色紧身中衣 下身：扎腿麻裤，绑腿缠紧 足履：草鞋扎紧备战 配饰：腰悬酒葫芦，肩背包袱 【兵刃行头】 主兵器：雪花镔铁戒刀一对，背负交叉（单刀刃长650mm，双刀共重十五斤） 拳脚功夫：铁拳缠布，醉拳通神 标志物件：酒葫芦（高320mm），血衣白衫，行者头陀装 水彩融合水墨渲染，宋代风俗画 + 明刊绣像插图风格，赭石土黄为底 + 墨色勾勒 + 血红点缀 【装备图解】 雪花镔铁戒刀：刀刃锻打花纹特写（单刀650mm，双刀共重十五斤） 范阳毡笠：红绸扎系方式图解（帽径350mm） 绑腿缠法：布条缠绕与打结位置（单腿缠布2000mm） 酒葫芦：内外结构与雕花（高320mm，容三碗酒） 打虎场景：衣衫撕裂细节，虎爪抓痕，血溅纹样 【画面构成】 主角色呈「怒目圆睁，拳毙猛虎后傲立虎尸之上，双拳染血，衣衫褴褛」之姿 周围标注：（毡帽，短衫，腰带，腿绷，双刀） 尺寸标记：650mm，350mm，320mm 【视觉特质】草莽英雄虎胆雄威，北宋市井江湖气，超高清细节箭头标注，水浒绣像古朴美学，武侠写实CG，快意恩仇豪气干云</p>
<h3 data-id="heading-5">模型</h3>
<h4 data-id="heading-6">Qwen Image Turbo</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ca07cba9dae4130946e54d514e4df22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=0v1xVdLyVUb1UPy0RONzIF4vGM4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cbff7a42c604f1489f4179f813fcfbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=SMhTWMgu%2Fke51zQQaXoE0WdLA1I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b888e4e241ce43e1b53b91f0d4784275~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=xPBYhoFJz%2B6xkTCS8pfVlOvt8UU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">SeedDream 4.5</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d20aa28a5045432dbc1c2c9eb8a91264~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=YWR6luoOjT%2BmMIs%2BQO2NmurhXnU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">三国演义</h2>
<p>角色设计稿，白色背景，技术蓝图风格，详细尺寸标注与中文批注，多角度散点缩略图，展示汉末武将铠甲设计全流程。 【典籍出处】《三国演义》第一回：宴桃园豪杰三结义 【角色档案】 姓名字号：关羽，字云长，人称"美髯公""武圣" 阵营势力：蜀汉 · 前将军 · 汉寿亭侯 性格铭刻：忠义无双，傲上而不忍下，义薄云天 【相貌特征】 身长九尺，面如重枣，唇若涂脂，丹凤眼，卧蚕眉，髯长二尺，威风凛凛，相貌堂堂 【甲胄体系】 头盔：凤翅紫金冠，赤红盔缨飘扬 铠甲：兽面吞头连环铠，铜兽肩吞，胸镶护心镜 战袍：翠绿锦缎云纹袍，金线滚边 披风：墨绿大氅，金扣系颈 【兵刃坐骑】 主兵器：青龙偃月刀（刀刃780mm，刀杆2100mm，重八十二斤） 副兵器：腰悬铁剑 坐骑：赤兔马，金鞍玉辔，火焰般鬃毛 水彩融合水墨渲染，明代绣像版画风格，玄铁墨色为底 + 朱砂赤红点缀 + 鎏金勾边 【装备拆解图】 青龙偃月刀：刀身锻纹特写，龙纹浮雕细节（刃长780mm，杆长2100mm） 凤翅紫金冠：结构爆炸分解图（通高320mm） 连环铠：甲片排列与兽面肩吞工艺（甲片45mm × 2000片） 汉寿亭侯印：正反双面篆刻（直径65mm） 赤兔马具：鞍鞯辔头镫全套分解图 【画面构成】 主角色呈「秉烛夜读春秋，横刀立于侧」之姿态 周围标注：（凤翅盔缨，肩吞兽首，腰围玉带，虎头战靴，披风金扣） 尺寸标记：320mm，780mm，2100mm 【视觉特质】沙场宿将之威仪，汉末风云际会，超高清细节箭头标注，古典演义绣像美学，三国史诗级CG，忠义千秋气势磅礴</p>
<h3 data-id="heading-9">模型</h3>
<h4 data-id="heading-10">Qwen Image Turbo</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2b2beb930d64ecd80fefe1228f2e540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=zIdUw45SwlBH074ysqmuU6sOykc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddbf05981a0b4630a4b4c466249b51fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=N2MF80y8rcSNbHoTK3Bs9atw5pw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f59d1c23ac6408d8844a001c3f7e97b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=2TJjvFblQcxZjm1MtZZP8b4x0WQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11">SeedDream 4.5</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/422ea3c7ea3a4fe1b965ebfa5465e58c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=G7MdZPR6a4nB3Pr2g3DvFildKFM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">西游记</h2>
<p>角色设计稿，白色背景，技术蓝图风格，仙法神器尺寸标注与中文批注，多角度散点缩略图，展示天界战神造型设计全流程。 【典籍出处】《西游记》第七回：八卦炉中逃大圣 五行山下定心猿 【角色档案】 姓名法号：孙悟空，道号"齐天大圣"，法名"孙行者" 出身来历：东胜神洲花果山水帘洞，仙石孕育天生石猴 修为神通：太乙金仙境，七十二变，筋斗云十万八千里，火眼金睛 【形貌特征】 本相：雷公嘴，铁额头，金毛覆体，火眼金睛如铜铃 身形：身高四尺，精悍矫健，猿猴体态 标志：头戴金箍（紧箍咒），尖耳外翻，桀骜不驯神情 【仙装法衣】 头冠：凤翅紫金冠，内嵌金箍一道 主甲：锁子黄金甲，云纹火焰纹交织 下裳：虎皮战裙（打虎所得） 足履：藕丝步云履，踏云而行 【法宝神兵】 主法宝：如意金箍棒（重一万三千五百斤，可大可小，默认长六米，碗口粗细） 头上金箍：紧箍咒刻纹，随咒收紧 神通具象：筋斗云呈祥云托举状 水彩融合水墨渲染，敦煌壁画 + 明刊神魔小说插图风格，霞光金红为主 + 祥云素白 + 神火橙黄 【法宝图鉴】 如意金箍棒：定海神针铁纹理特写（默认长6000mm，直径120mm，可缩至绣花针15mm） 紫金冠与金箍：咒文镌刻细节（金箍直径180mm，宽25mm） 锁子黄金甲：甲片与云纹编织工艺（甲高650mm） 藕丝步云履：莲瓣底纹设计（鞋长280mm） 筋斗云：灵气流转形态图 【画面构成】 主角色呈「腾云驾雾，金箍棒横扫天兵天将」桀骜战姿 周围标注：（紫金冠，锁子甲，虎皮裙，藕丝履，金箍棒） 尺寸标记：6000mm，180mm，650mm 【视觉特质】桀骜不驯反叛之魂，齐天大圣通天彻地，超高清神话细节标注，明代神魔志怪美学，东方玄幻CG，大闹天宫气吞山河</p>
<h3 data-id="heading-13">模型</h3>
<h4 data-id="heading-14">Qwen Image Turbo</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16e90754b04b493f859c0e3e16b42fde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=2EU%2BNDRxz1OBqbOA1Mjx1injgm8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf7ecb003b934207aa9d2ba34b0e1eee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=IXzedZNwDrpyiJxpDc%2B5Qn%2FVcP4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35ae0d22be074fe9ad50a1ffe992f4df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=afXJQWhYObtSYr7KLszoOd%2BqwlY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-15">SeedDream 4.5</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13d754bd6bb3421eba2272987f9d26d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmVuZ2p1dGlhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769768573&amp;x-signature=zomSfVsNRHETVAYnpTNJpPHOJ8g%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Flutter]多层级协同滚动和多层级惯性滚动动画传递Elva Scroll View]]></title>    <link>https://juejin.cn/post/7598424770321448969</link>    <guid>https://juejin.cn/post/7598424770321448969</guid>    <pubDate>2026-01-23T10:55:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598424770321448969" data-draft-id="7598181989969559579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Flutter]多层级协同滚动和多层级惯性滚动动画传递Elva Scroll View "/> <meta itemprop="keywords" content="前端,Android,Flutter"/> <meta itemprop="datePublished" content="2026-01-23T10:55:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开中断"/> <meta itemprop="url" content="https://juejin.cn/user/2647279732527831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Flutter]多层级协同滚动和多层级惯性滚动动画传递Elva Scroll View 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279732527831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开中断
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T10:55:31.000Z" title="Fri Jan 23 2026 10:55:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Elva Scroll View，一个适用于嵌套滚动的 Flutter 包，具备多层级协同滚动和多层级惯性滚动动画传递功能。</p>
<h2 data-id="heading-0">一、效果与功能</h2>
<h2 data-id="heading-1">1.1 效果演示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f10bff476e614c98913139fe8059e738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5Lit5pat:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769770669&amp;x-signature=v2msNZvWcjZh3cqwcDeXczX%2BF4E%3D" alt="example.gif" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 支持的功能</h3>
<ul>
<li><strong>嵌套滚动支持</strong>：支持多级嵌套滚动视图，实现平滑的滚动协调</li>
<li><strong>惯性滚动传递</strong>：惯性滚动动画可以在多个滚动组件之间传递</li>
<li><strong>Shell 模式</strong>：支持阻止滚动偏移继续向上传播，实现独立的滚动区域</li>
<li><strong>灵活的 Builder 模式</strong>：使用 Builder 模式，易于集成到现有代码中</li>
<li><strong>自定义通知系统</strong>：提供丰富的滚动事件通知</li>
</ul>
<h2 data-id="heading-3">二、使用</h2>
<h3 data-id="heading-4">2.1 安装</h3>
<p>在项目的 <code>pubspec.yaml</code> 文件中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">elva_scroll_view:</span> <span class="hljs-string">...</span>
</code></pre>
<h3 data-id="heading-5">2.2 基础用法</h3>
<p>ElvaScrollViewBuilder 是一个构建组件，用于包装需要协调滚动的 CustomScrollView。使用ElvaScrollViewBuilder包裹你需要协调滚动的 CustomScrollView或者其他滚动组件，即可实现滚动协调功能：</p>
<pre><code class="hljs language-dart" lang="dart">ElvaScrollViewBuilder(
  builder: (context, controller) {
    <span class="hljs-keyword">return</span> CustomScrollView(
      controller: controller,
      slivers: [
        SliverAppBar(...),
        SliverList(...),
      ],
    );
  }
)
</code></pre>
<h3 data-id="heading-6">2.3 Shell 参数</h3>
<p>Shell参数会中止滚动偏移继续向上传播，实现独立的滚动区域。</p>
<pre><code class="hljs language-dart" lang="dart">ElvaScrollViewBuilder(
  isShell: <span class="hljs-keyword">true</span>,
  builder: (context, controller) {
    <span class="hljs-keyword">return</span> CustomScrollView(
      controller: controller,
      slivers: [...]
    );
  }
)
</code></pre>
<h2 data-id="heading-7">三、核心 API</h2>
<h3 data-id="heading-8">3.1 ElvaScrollViewBuilder</h3>
<p>主要的构建组件，用于包装需要协调滚动的 CustomScrollView。</p>
<p><strong>参数</strong>：</p>
<ul>
<li><code>builder</code>: 构建函数，接收 context 和 controller</li>
<li><code>debugLabel</code>: 用于日志记录的调试标签</li>
<li><code>isShell</code>: 是否为 shell 组件。当为 true 时，滚动偏移不会继续向上传播</li>
</ul>
<h3 data-id="heading-9">3.2 ElvaScrollViewScrollController</h3>
<p>自定义滚动控制器，实现了 <code>TransportPixelNode</code> mixin，负责处理滚动协调和传递。</p>
<h3 data-id="heading-10">3.3 ElvaScrollViewPosition</h3>
<p>自定义滚动位置管理器，继承自 Flutter 原生的 <code>ScrollPositionWithSingleContext</code>，实现：</p>
<ul>
<li>用户拖拽偏移处理</li>
<li>惯性滚动启动和管理</li>
<li>动画偏移应用</li>
</ul>
<h3 data-id="heading-11">3.4 ElvaScrollViewAnimationOverscrollDispatcher</h3>
<p>惯性滚动动画分发器，负责：</p>
<ul>
<li>收集需要接受滚动事件的组件</li>
<li>按顺序分发惯性滚动动画</li>
<li>管理过滚动传递</li>
</ul>
<h3 data-id="heading-12">3.5 ElvaScrollViewAnimationScrollingNotification</h3>
<p>当全局过滚动事件动画发生时分发。</p>
<p><strong>属性</strong>：</p>
<ul>
<li><code>overscroll</code>: 过滚动量</li>
<li><code>consumed</code>: 当前滚动视图消耗的量</li>
</ul>
<h2 data-id="heading-13">四、原理剖析</h2>
<ol>
<li><a href="https://juejin.cn/post/7304867278566244404" target="_blank" title="https://juejin.cn/post/7304867278566244404">[Flutter] infinity与可滚动布局</a></li>
<li><a href="https://juejin.cn/post/7473440825101533235" target="_blank" title="https://juejin.cn/post/7473440825101533235">[Flutter] ScrollActivity与ScrollActivityDelegate</a></li>
<li><a href="https://juejin.cn/post/7473431148958957578" target="_blank" title="https://juejin.cn/post/7473431148958957578">[Flutter] 多层级嵌套滚动</a></li>
<li><a href="https://juejin.cn/post/7473440825101680691" target="_blank" title="https://juejin.cn/post/7473440825101680691">[Flutter] 嵌套滚动与弹性嵌套滚动</a></li>
</ol>
<h2 data-id="heading-14">五、其他：</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FY2Yi%2Ftoy" target="_blank" title="https://github.com/Y2Yi/toy" ref="nofollow noopener noreferrer">Github项目地址</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Felva_scroll_view" target="_blank" title="https://pub.dev/packages/elva_scroll_view" ref="nofollow noopener noreferrer">DartPub地址</a></li>
</ol>
<p>顺便求个⭐️~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@Autowired与@Resource区别]]></title>    <link>https://juejin.cn/post/7598193992828715062</link>    <guid>https://juejin.cn/post/7598193992828715062</guid>    <pubDate>2026-01-23T09:25:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598193992828715062" data-draft-id="7598193992828682294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@Autowired与@Resource区别"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-23T09:25:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大笔袋"/> <meta itemprop="url" content="https://juejin.cn/user/1300036004102016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @Autowired与@Resource区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1300036004102016/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大笔袋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:25:34.000Z" title="Fri Jan 23 2026 09:25:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">所属规范</h4>
<p>@Autowired：由Spring框架自己定义的注解，仅在Spring/Spring boot生态中生效，如果项目切换到其他依赖注入，该注解会失效</p>
<p>@Resource：JDK1.6+原生提供的注解，属于<code>JSR-250JavaEE</code>规范，是通用的依赖注入标准，只要框架兼容该规范，就能使用，跨框架兼容性更好</p>
<h4 data-id="heading-1">默认注入规则</h4>
<p>默认注入规则有：类型优先和名称优先</p>
<p>类型优先：Spring会先在IOC容器中查找所有类型为指定类型的Bean</p>
<p>名称优先：Spring会先根据注解标注的字段名/方法名，查找IOC容器中同名的Bean</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span>{}
<span class="hljs-comment">// 实现类1</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span>{}
<span class="hljs-comment">// 实现类2</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span>{}
</code></pre>
<h5 data-id="heading-2">@Autowired：默认按类型注入</h5>
<p>如果只有一个同类型Bean-&gt;直接注入，无需额外配置</p>
<p>如果有多个同类型的Bean-&gt;抛出NoUniqueBeanDefinitionException异常(类型匹配不唯一)</p>
<p>可以使用<code>@Qualifier</code>指定Bean名称</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 直接注入会报错（2个UserService类型Bean）</span>
<span class="hljs-comment">// @Autowired</span>
<span class="hljs-comment">// private UserService userService;</span>

<span class="hljs-comment">// 配合@Qualifier指定Bean名称，精准注入</span>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-meta">@Qualifier("userServiceImpl1")</span> <span class="hljs-comment">// 对应Bean名称：userServiceImpl1</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<p>或用<code>@Primary</code>标记默认优先的Bean</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Primary</span> <span class="hljs-comment">// 标记为默认优先</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {}

<span class="hljs-comment">// 此时直接注入不会报错，会自动注入UserServiceImpl1</span>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<h5 data-id="heading-3">@Resource：默认按照名称注入</h5>
<p>找到同名Bean -&gt; 直接注入，不管类型(只要类型兼容)</p>
<p>未找到同名Bean -&gt; 降级为按类型匹配，此时行为和<code>@Autowired</code>一致(一个注入，多个报错)</p>
<p>可以使用<code>name</code>/<code>type</code>属性，强制按名称/类型注入，无需其他注解</p>
<p>默认按字段名注入</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 报错：NoUniqueBeanDefinitionException（未找到同名Bean，类型匹配多个）</span>
<span class="hljs-meta">@Resource</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<p>手动指定name/type</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 直接指定Bean名称，精准注入userServiceImpl1</span>
<span class="hljs-meta">@Resource(name = "userServiceImpl1")</span>
<span class="hljs-keyword">private</span> UserService userService;

<span class="hljs-comment">// 强制按类型注入，多个同类型仍会报错，行为与@Autowired一致</span>
<span class="hljs-meta">@Resource(type = UserService.class)</span>
<span class="hljs-keyword">private</span> UserService userService;
</code></pre>
<h4 data-id="heading-4">标注位置</h4>
<p>@Autowired：可标注在字段、构造器、普通方法、方法参数上，Spring boot推荐构造器注入(能保证Bean初始化时依赖已注入，避免空指针)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 构造器注入（推荐）</span>
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">public</span> <span class="hljs-title function_">UserController</span><span class="hljs-params">(UserService userService)</span> {
    <span class="hljs-built_in">this</span>.userService = userService;
}

<span class="hljs-comment">// 方法参数注入</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserService</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> UserService userService)</span> {
    <span class="hljs-built_in">this</span>.userService = userService;
}
</code></pre>
<p>@Resource：Spring中仅支持标注在字段、setter方法上，不支持构造器、普通方法、方法参数</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 字段注入（支持）</span>
<span class="hljs-meta">@Resource</span>
<span class="hljs-keyword">private</span> UserService userService;

<span class="hljs-comment">// setter方法注入（支持）</span>
<span class="hljs-meta">@Resource</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserService</span><span class="hljs-params">(UserService userService)</span> {
    <span class="hljs-built_in">this</span>.userService = userService;
}

<span class="hljs-comment">// 构造器注入（不支持，Spring中无效果）</span>
<span class="hljs-comment">// @Resource</span>
<span class="hljs-comment">// public UserController(UserService userService) {</span>
<span class="hljs-comment">//     this.userService = userService;</span>
<span class="hljs-comment">// }</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#实现PDF页码自动化插入]]></title>    <link>https://juejin.cn/post/7598390244379394086</link>    <guid>https://juejin.cn/post/7598390244379394086</guid>    <pubDate>2026-01-23T09:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390244379394086" data-draft-id="7598390354291703854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#实现PDF页码自动化插入"/> <meta itemprop="keywords" content="后端,C#"/> <meta itemprop="datePublished" content="2026-01-23T09:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户835629078051"/> <meta itemprop="url" content="https://juejin.cn/user/3150554985403516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#实现PDF页码自动化插入
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3150554985403516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户835629078051
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:26:57.000Z" title="Fri Jan 23 2026 09:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6fcd56f00d94b4482cc5c5c6a426874~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765217&amp;x-signature=c85PWxlCkXBh6wQcRDO99hOyV%2B0%3D" alt="C#实现PDF文档页码自动化添加" loading="lazy"/></p>
<p>在日常的文档处理中，PDF（Portable Document Format）以其跨平台、内容固定不变的特性，成为报告、合同、电子书等各类文档发布和存档的通用格式。然而，当文档页数增长时，一个看似简单的元素——页码，便显得尤为重要。它不仅能帮助读者快速定位信息，也是文档专业性和规范性的体现。</p>
<p>对于C#开发者而言，面对大量需要添加页码的PDF文档时，手动操作显然效率低下且易出错。如何通过编程方式，高效、灵活地为PDF文档自动添加页码，成为一个实际且普遍的需求。本文将深入探讨如何利用C#，结合一款强大的.NET PDF处理库，实现从基础到高级的PDF页码插入功能，解决C#开发者在文档自动化处理中的痛点。</p>
<hr/>
<h2 data-id="heading-0">准备工作：在C#项目中集成PDF处理能力</h2>
<p>要开始在C#中操作PDF文档，首先需要引入一个功能强大的第三方库。通过NuGet包管理器，我们可以轻松地将所需的库集成到项目中。</p>
<h3 data-id="heading-1">1. 安装必要的库</h3>
<p>打开Visual Studio，在你的C#项目（可以是控制台应用、ASP.NET Core应用等）中，右键点击“依赖项”或“引用”，选择“管理NuGet程序包”。在“浏览”选项卡中搜索并安装“Spire.PDF”。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 通过NuGet安装：Install-Package Spire.PDF</span>
<span class="hljs-comment">// 或在项目文件中添加：</span>
<span class="hljs-comment">// &lt;PackageReference Include="Spire.PDF" Version="X.X.X" /&gt;</span>
</code></pre>
<p>安装完成后，你的项目将拥有处理PDF文档的能力。</p>
<h3 data-id="heading-2">2. 页码插入的基本概念</h3>
<p>在PDF文档中插入页码，通常涉及到以下几个基本概念：</p>
<ul>
<li><strong>页眉/页脚区域</strong>: 页码通常放置在文档的页眉或页脚区域。</li>
<li><strong>文本格式</strong>: 页码的显示样式，如“第X页”、“Page X of Y”等。</li>
<li><strong>位置坐标</strong>: 在页面上的精确位置，通过X、Y坐标确定。</li>
<li><strong>字体样式</strong>: 字体的类型、大小、颜色等。</li>
<li><strong>页面遍历</strong>: 对于多页PDF文档，需要遍历每一页并独立插入页码。</li>
</ul>
<h3 data-id="heading-3">3. 最简单的页码插入示例</h3>
<p>让我们从一个最简单的例子开始，为PDF文档的每一页底部中心添加“第X页”的页码。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Pdf;
<span class="hljs-keyword">using</span> Spire.Pdf.Graphics;
<span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PdfPageNumberInserter</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InsertSimplePageNumbers</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> inputFilePath, <span class="hljs-built_in">string</span> outputFilePath</span>)</span>
    {
        <span class="hljs-comment">// 加载现有PDF文档</span>
        PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
        doc.LoadFromFile(inputFilePath);

        <span class="hljs-comment">// 获取页面数量</span>
        <span class="hljs-built_in">int</span> pageCount = doc.Pages.Count;

        <span class="hljs-comment">// 遍历每一页</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; pageCount; i++)
        {
            PdfPageBase page = doc.Pages[i];

            <span class="hljs-comment">// 创建字体和画刷</span>
            PdfTrueTypeFont font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"宋体"</span>, <span class="hljs-number">10f</span>, FontStyle.Regular), <span class="hljs-literal">true</span>);
            PdfBrush brush = PdfBrushes.Black;

            <span class="hljs-comment">// 构建页码文本，例如 "第1页"</span>
            <span class="hljs-built_in">string</span> pageNumberText = <span class="hljs-string">$"第<span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>页"</span>;

            <span class="hljs-comment">// 计算文本的宽度和高度</span>
            SizeF textSize = font.MeasureString(pageNumberText);

            <span class="hljs-comment">// 计算页码的绘制位置 (底部居中)</span>
            <span class="hljs-built_in">float</span> x = (page.Canvas.ClientSize.Width - textSize.Width) / <span class="hljs-number">2</span>;
            <span class="hljs-built_in">float</span> y = page.Canvas.ClientSize.Height - textSize.Height - <span class="hljs-number">10</span>; <span class="hljs-comment">// 距离底部10个点</span>

            <span class="hljs-comment">// 在页面上绘制页码</span>
            page.Canvas.DrawString(pageNumberText, font, brush, x, y);
        }

        <span class="hljs-comment">// 保存修改后的PDF文档</span>
        doc.SaveToFile(outputFilePath);
        doc.Close();
    }
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        InsertSimplePageNumbers(<span class="hljs-string">"Sample.pdf"</span>, <span class="hljs-string">"AddPageNumber.pdf"</span>);
    }
}
</code></pre>
<p>这段代码展示了加载PDF、遍历页面、创建字体画刷、计算位置并绘制文本的基本流程。生成的PDF效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf4850bac1e4a5aaf2a97f78cba94f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODM1NjI5MDc4MDUx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765217&amp;x-signature=KyU7c8QURYSq19mIEp0PHHQ0xEE%3D" alt="C#插入页码到PDF文档" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">精准控制：定制化页码的显示与位置</h2>
<p>实际应用中，简单的页码往往不足以满足需求。我们需要更灵活地控制页码的格式、位置和显示逻辑。</p>
<h3 data-id="heading-5">1. 自定义页码格式</h3>
<p>常见的页码格式有“第X页，共Y页”、“Page X of Y”等。我们可以通过字符串格式化来实现。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 在循环内部修改页码文本构建逻辑</span>
<span class="hljs-comment">// 例如："第X页，共Y页"</span>
<span class="hljs-built_in">string</span> pageNumberText = <span class="hljs-string">$"第<span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>页，共<span class="hljs-subst">{pageCount}</span>页"</span>;

<span class="hljs-comment">// 例如："Page X of Y"</span>
<span class="hljs-comment">// string pageNumberText = $"Page {i + 1} of {pageCount}";</span>
</code></pre>
<h3 data-id="heading-6">2. 指定页码位置</h3>
<p>页码可以放置在页面的左、中、右，以及页眉或页脚。通过调整X、Y坐标即可实现。</p>








































<table><thead><tr><th align="left">位置</th><th align="left">X 坐标计算</th><th align="left">Y 坐标计算</th></tr></thead><tbody><tr><td align="left"><strong>页脚左侧</strong></td><td align="left"><code>10</code> (距离左边缘10点)</td><td align="left"><code>page.Canvas.ClientSize.Height - textSize.Height - 10</code></td></tr><tr><td align="left"><strong>页脚居中</strong></td><td align="left"><code>(page.Canvas.ClientSize.Width - textSize.Width) / 2</code></td><td align="left"><code>page.Canvas.ClientSize.Height - textSize.Height - 10</code></td></tr><tr><td align="left"><strong>页脚右侧</strong></td><td align="left"><code>page.Canvas.ClientSize.Width - textSize.Width - 10</code></td><td align="left"><code>page.Canvas.ClientSize.Height - textSize.Height - 10</code></td></tr><tr><td align="left"><strong>页眉左侧</strong></td><td align="left"><code>10</code></td><td align="left"><code>10</code> (距离上边缘10点)</td></tr><tr><td align="left"><strong>页眉居中</strong></td><td align="left"><code>(page.Canvas.ClientSize.Width - textSize.Width) / 2</code></td><td align="left"><code>10</code></td></tr><tr><td align="left"><strong>页眉右侧</strong></td><td align="left"><code>page.Canvas.ClientSize.Width - textSize.Width - 10</code></td><td align="left"><code>10</code></td></tr></tbody></table>
<p>下面是一个在页脚右侧添加页码的示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InsertRightAlignedPageNumbers</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> inputFilePath, <span class="hljs-built_in">string</span> outputFilePath</span>)</span>
{
    PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
    doc.LoadFromFile(inputFilePath);
    <span class="hljs-built_in">int</span> pageCount = doc.Pages.Count;

    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; pageCount; i++)
    {
        PdfPageBase page = doc.Pages[i];
        PdfTrueTypeFont font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">10f</span>, FontStyle.Regular), <span class="hljs-literal">true</span>);
        PdfBrush brush = PdfBrushes.Black;

        <span class="hljs-built_in">string</span> pageNumberText = <span class="hljs-string">$"Page <span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span> of <span class="hljs-subst">{pageCount}</span>"</span>;
        SizeF textSize = font.MeasureString(pageNumberText);

        <span class="hljs-comment">// 页脚右侧对齐</span>
        <span class="hljs-built_in">float</span> x = page.Canvas.ClientSize.Width - textSize.Width - <span class="hljs-number">20</span>; <span class="hljs-comment">// 距离右边缘20个点</span>
        <span class="hljs-built_in">float</span> y = page.Canvas.ClientSize.Height - textSize.Height - <span class="hljs-number">20</span>; <span class="hljs-comment">// 距离底部20个点</span>

        page.Canvas.DrawString(pageNumberText, font, brush, x, y);
    }
    doc.SaveToFile(outputFilePath);
    doc.Close();
}
</code></pre>
<h3 data-id="heading-7">3. 排除首页或从指定页开始计数</h3>
<p>在报告或书籍中，封面页通常不显示页码，或页码从第二页开始计数。这可以通过简单的条件判断实现。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InsertPageNumbersExcludingFirstPage</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> inputFilePath, <span class="hljs-built_in">string</span> outputFilePath</span>)</span>
{
    PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
    doc.LoadFromFile(inputFilePath);
    <span class="hljs-built_in">int</span> pageCount = doc.Pages.Count;

    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; pageCount; i++)
    {
        <span class="hljs-comment">// 排除第一页 (索引为0)</span>
        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>; 

        PdfPageBase page = doc.Pages[i];
        PdfTrueTypeFont font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">10f</span>, FontStyle.Regular), <span class="hljs-literal">true</span>);
        PdfBrush brush = PdfBrushes.Black;

        <span class="hljs-comment">// 页码从1开始，但实际是文档的第2页</span>
        <span class="hljs-built_in">string</span> pageNumberText = <span class="hljs-string">$"Page <span class="hljs-subst">{i}</span> of <span class="hljs-subst">{pageCount - <span class="hljs-number">1</span>}</span>"</span>; <span class="hljs-comment">// 如果总页数也减去首页，则用pageCount-1</span>

        SizeF textSize = font.MeasureString(pageNumberText);
        <span class="hljs-built_in">float</span> x = page.Canvas.ClientSize.Width - textSize.Width - <span class="hljs-number">20</span>;
        <span class="hljs-built_in">float</span> y = page.Canvas.ClientSize.Height - textSize.Height - <span class="hljs-number">20</span>;

        page.Canvas.DrawString(pageNumberText, font, brush, x, y);
    }
    doc.SaveToFile(outputFilePath);
    doc.Close();
}
</code></pre>
<h3 data-id="heading-8">4. 设置页码样式：字体、字号、颜色</h3>
<p><code>PdfFont</code> 和 <code>PdfBrush</code> 对象允许我们完全控制页码的视觉样式。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 字体：Arial, 12号字, 加粗斜体</span>
PdfTrueTypeFont font = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">12f</span>, FontStyle.Bold | FontStyle.Italic), <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 颜色：深蓝色</span>
PdfBrush brush = <span class="hljs-keyword">new</span> PdfSolidBrush(Color.DarkBlue);

<span class="hljs-comment">// 绘制页码</span>
page.Canvas.DrawString(pageNumberText, font, brush, x, y);
</code></pre>
<h3 data-id="heading-9">5. 高级布局：结合页眉页脚</h3>
<p>除了简单的页码，我们还可以将页码作为页眉或页脚的一部分，与其他文本、图片等元素结合。这通常涉及到在页面的固定区域绘制多个元素。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InsertComplexFooter</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> inputFilePath, <span class="hljs-built_in">string</span> outputFilePath</span>)</span>
{
    PdfDocument doc = <span class="hljs-keyword">new</span> PdfDocument();
    doc.LoadFromFile(inputFilePath);
    <span class="hljs-built_in">int</span> pageCount = doc.Pages.Count;

    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; pageCount; i++)
    {
        PdfPageBase page = doc.Pages[i];
        PdfGraphics graphics = page.Canvas;

        <span class="hljs-comment">// 页码字体和画刷</span>
        PdfTrueTypeFont pageNumFont = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Arial"</span>, <span class="hljs-number">9f</span>, FontStyle.Italic), <span class="hljs-literal">true</span>);
        PdfBrush pageNumBrush = PdfBrushes.Gray;
        <span class="hljs-built_in">string</span> pageNumberText = <span class="hljs-string">$"Page <span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span> of <span class="hljs-subst">{pageCount}</span>"</span>;
        SizeF pageNumSize = pageNumFont.MeasureString(pageNumberText);

        <span class="hljs-comment">// 其他页脚文本</span>
        PdfTrueTypeFont footerFont = <span class="hljs-keyword">new</span> PdfTrueTypeFont(<span class="hljs-keyword">new</span> Font(<span class="hljs-string">"Verdana"</span>, <span class="hljs-number">8f</span>, FontStyle.Regular), <span class="hljs-literal">true</span>);
        PdfBrush footerBrush = PdfBrushes.DarkGray;
        <span class="hljs-built_in">string</span> footerText = <span class="hljs-string">"Generated by C# PDF Automation Tool"</span>;
        SizeF footerTextSize = footerFont.MeasureString(footerText);

        <span class="hljs-comment">// 绘制页码 (右下角)</span>
        <span class="hljs-built_in">float</span> pageNumX = graphics.ClientSize.Width - pageNumSize.Width - <span class="hljs-number">20</span>;
        <span class="hljs-built_in">float</span> pageNumY = graphics.ClientSize.Height - pageNumSize.Height - <span class="hljs-number">15</span>;
        graphics.DrawString(pageNumberText, pageNumFont, pageNumBrush, pageNumX, pageNumY);

        <span class="hljs-comment">// 绘制其他页脚文本 (左下角)</span>
        <span class="hljs-built_in">float</span> footerTextX = <span class="hljs-number">20</span>;
        <span class="hljs-built_in">float</span> footerTextY = graphics.ClientSize.Height - footerTextSize.Height - <span class="hljs-number">15</span>;
        graphics.DrawString(footerText, footerFont, footerBrush, footerTextX, footerTextY);

        <span class="hljs-comment">// 绘制一条分隔线</span>
        PdfPen linePen = <span class="hljs-keyword">new</span> PdfPen(PdfBrushes.LightGray, <span class="hljs-number">0.5f</span>);
        graphics.DrawLine(linePen, <span class="hljs-number">20</span>, footerTextY - <span class="hljs-number">5</span>, graphics.ClientSize.Width - <span class="hljs-number">20</span>, footerTextY - <span class="hljs-number">5</span>);
    }
    doc.SaveToFile(outputFilePath);
    doc.Close();
}
</code></pre>
<hr/>
<h2 data-id="heading-10">优化与考量：提升页码插入的效率与兼容性</h2>
<p>在实际部署和使用这些功能时，还需要考虑一些性能、兼容性以及错误处理方面的问题。</p>
<h3 data-id="heading-11">1. 处理大型PDF文档的性能考虑</h3>
<p>对于包含数百甚至数千页的PDF文档，逐页绘制页码可能会消耗较多时间。<code>Spire.PDF</code> 在内部进行了优化，但仍需注意：</p>
<ul>
<li><strong>避免不必要的重复操作</strong>: 例如，字体和画刷对象可以在循环外部创建一次，而不是在每次页面迭代中重复创建。</li>
<li><strong>资源释放</strong>: 确保在使用完毕后调用 <code>doc.Close()</code> 释放PDF文档资源。</li>
<li><strong>多线程/异步处理</strong>: 对于极其庞大的文档，可以考虑将PDF拆分为多个部分，然后并行处理，最后再合并。但这会增加代码复杂性，通常在极端情况下才需要。</li>
</ul>
<h3 data-id="heading-12">2. 页码与现有页面内容的冲突处理</h3>
<p>PDF文档可能已经包含文本、图片或图形。插入页码时，需要确保它不会覆盖现有关键内容。</p>
<ul>
<li><strong>选择合适的边距</strong>: 预留足够的页眉/页脚空间，确保页码不会与文档主体内容重叠。</li>
<li><strong>透明度</strong>: 如果页码必须与现有内容重叠，可以考虑设置页码文本的透明度，但通常不推荐。</li>
<li><strong>预检查</strong>: 对于高度定制化的PDF，可能需要先解析页面内容，判断哪些区域是安全的，但这超出了简单页码插入的范畴。</li>
</ul>
<h3 data-id="heading-13">3. 错误处理和异常捕获</h3>
<p>在文件操作和PDF处理过程中，可能会遇到各种异常，如文件不存在、文件损坏、权限不足等。良好的异常处理机制是健壮应用程序的关键。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span>
{
    <span class="hljs-comment">// ... PDF处理代码 ...</span>
    InsertSimplePageNumbers(<span class="hljs-string">"input.pdf"</span>, <span class="hljs-string">"output.pdf"</span>);
}
<span class="hljs-keyword">catch</span> (FileNotFoundException ex)
{
    Console.WriteLine(<span class="hljs-string">$"错误：文件未找到。<span class="hljs-subst">{ex.Message}</span>"</span>);
}
<span class="hljs-keyword">catch</span> (PdfException ex)
{
    Console.WriteLine(<span class="hljs-string">$"PDF处理错误：<span class="hljs-subst">{ex.Message}</span>"</span>);
}
<span class="hljs-keyword">catch</span> (Exception ex)
{
    Console.WriteLine(<span class="hljs-string">$"发生未知错误：<span class="hljs-subst">{ex.Message}</span>"</span>);
}
</code></pre>
<h3 data-id="heading-14">4. 最佳实践建议</h3>
<ul>
<li><strong>模块化代码</strong>: 将页码插入逻辑封装成独立的函数或类，提高代码的可重用性和可维护性。</li>
<li><strong>配置化处理</strong>: 对于页码的字体、颜色、位置、格式等参数，可以通过配置文件或方法参数进行配置，增加灵活性。</li>
<li><strong>版本控制</strong>: 随着PDF处理库的更新，API可能会有变化，及时关注并更新代码。</li>
</ul>
<hr/>
<h2 data-id="heading-15">结论</h2>
<p>通过本文的详细讲解和代码示例，我们看到了C#结合强大的.NET PDF处理库，能够高效、灵活地为PDF文档插入页码。从简单的页码添加，到自定义格式、位置、样式，乃至排除特定页面或与其他页脚元素结合，C#都提供了丰富的控制能力。</p>
<p>编程方式插入页码不仅解决了手动操作的痛点，更赋予了开发者在自动化文档处理领域巨大的潜力。无论是生成报告、批量处理合同，还是创建结构化的电子文档，掌握这些技巧都将极大地提升你的开发效率和应用价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[移动端1px问题详解]]></title>    <link>https://juejin.cn/post/7598333055544918056</link>    <guid>https://juejin.cn/post/7598333055544918056</guid>    <pubDate>2026-01-23T09:15:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598333055544918056" data-draft-id="7598333055544901672" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="移动端1px问题详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T09:15:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="娜妹子辣"/> <meta itemprop="url" content="https://juejin.cn/user/3421335918747976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            移动端1px问题详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3421335918747976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    娜妹子辣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:15:12.000Z" title="Fri Jan 23 2026 09:15:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🎯 问题背景</h2>
<h3 data-id="heading-1">为什么移动端1px看起来很粗？</h3>
<p>在移动端，由于设备像素比（DPR）的存在，CSS中的1px并不等于物理像素的1px。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">JavaScript</span>
<span class="hljs-comment">// 查看设备像素比</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>);

<span class="hljs-comment">// 常见设备像素比：</span>
<span class="hljs-comment">// iPhone 6/7/8: 2</span>
<span class="hljs-comment">// iPhone 6/7/8 Plus: 3  </span>
<span class="hljs-comment">// iPhone X/11/12: 3</span>
<span class="hljs-comment">// 大部分Android: 2-3</span>
</code></pre>
<p><strong>问题原理：</strong></p>
<ul>
<li>CSS的1px = 设备像素比 × 物理像素</li>
<li>iPhone 6上：1px CSS = 2px 物理像素</li>
<li>所以看起来比设计稿粗一倍</li>
</ul>
<hr/>
<h2 data-id="heading-2">🔧 解决方案对比</h2>






















































<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>兼容性</th><th>推荐度</th></tr></thead><tbody><tr><td><strong>transform: scale</strong></td><td>简单易用</td><td>占用空间不变</td><td>优秀</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>viewport + rem</strong></td><td>整体解决</td><td>影响全局</td><td>优秀</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>border-image</strong></td><td>效果完美</td><td>代码复杂</td><td>优秀</td><td>⭐⭐⭐</td></tr><tr><td><strong>box-shadow</strong></td><td>兼容性好</td><td>性能一般</td><td>优秀</td><td>⭐⭐⭐</td></tr><tr><td><strong>伪元素</strong></td><td>灵活性高</td><td>代码较多</td><td>优秀</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>SVG</strong></td><td>矢量完美</td><td>复杂度高</td><td>现代浏览器</td><td>⭐⭐</td></tr></tbody></table>
<h3 data-id="heading-3">关键要点</h3>
<ol>
<li><strong>所有CSS像素都会等比例缩放</strong>，不只是1px</li>
<li><strong>1px问题特别明显</strong>是因为细线的视觉敏感度高</li>
<li><strong>其他尺寸的缩放通常是期望的</strong>，保证了可读性和可用性</li>
<li><strong>解决方案主要针对边框</strong>，因为这是最影响视觉效果的</li>
</ol>
<hr/>
<h2 data-id="heading-4">1️⃣ Transform Scale 方案（推荐）</h2>
<h3 data-id="heading-5">基本实现</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 上边框1px */</span>
<span class="hljs-selector-class">.border-1px-top</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.border-1px-top</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">/* 根据设备像素比缩放 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
  <span class="hljs-selector-class">.border-1px-top</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">3</span>) {
  <span class="hljs-selector-class">.border-1px-top</span><span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.33</span>);
  }
}
</code></pre>
<h3 data-id="heading-6">完整四边框实现</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-selector-class">.border-1px</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">pointer-events</span>: none;
}

<span class="hljs-comment">/* 3倍屏适配 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">3</span>) {
  <span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">300%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">300%</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.33</span>);
  }
}
</code></pre>
<h3 data-id="heading-7">Sass Mixin封装</h3>
<pre><code class="hljs language-css" lang="css">scss
<span class="hljs-keyword">@mixin</span> border-<span class="hljs-number">1px</span>($<span class="hljs-attribute">color</span>: #e5e5e5, $<span class="hljs-attribute">radius</span>: <span class="hljs-number">0</span>, $<span class="hljs-attribute">style</span>: solid) {
  <span class="hljs-attribute">position</span>: relative;
  
  &amp;<span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> $style $color;
    <span class="hljs-attribute">border-radius</span>: $radius * <span class="hljs-number">2</span>;
    <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
    <span class="hljs-attribute">box-sizing</span>: border-box;
    <span class="hljs-attribute">pointer-events</span>: none;
  }
  
  <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">3</span>) {
    &amp;<span class="hljs-selector-pseudo">::after</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">300%</span>;
      <span class="hljs-attribute">border-radius</span>: $radius * <span class="hljs-number">3</span>;
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.33</span>);
    }
  }
}

// 使用
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-keyword">@include</span> border-<span class="hljs-number">1px</span>(#ddd, <span class="hljs-number">4px</span>);
}
</code></pre>
<h3 data-id="heading-8">JavaScript动态适配</h3>
<pre><code class="hljs language-ini" lang="ini">JavaScript
// 动态设置1px边框
function setBorder1px() {
  const <span class="hljs-attr">dpr</span> = window.devicePixelRatio || <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  const <span class="hljs-attr">scale</span> = <span class="hljs-number">1</span> / dpr<span class="hljs-comment">;</span>
  
  // 创建样式
  const <span class="hljs-attr">style</span> = document.createElement(<span class="hljs-string">'style'</span>)<span class="hljs-comment">;</span>
  <span class="hljs-attr">style.innerHTML</span> = `
    .border-1px::after {
      transform: scale(${scale})<span class="hljs-comment">;</span>
      width: ${100 * dpr}%<span class="hljs-comment">;</span>
      height: ${100 * dpr}%<span class="hljs-comment">;</span>
    }
  `<span class="hljs-comment">;</span>
  document.head.appendChild(style)<span class="hljs-comment">;</span>
}

setBorder1px()<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">2️⃣ Viewport + Rem 方案</h2>
<h3 data-id="heading-10">原理</h3>
<p>通过设置viewport的initial-scale来缩放整个页面，然后用rem放大内容。</p>
<pre><code class="hljs language-ini" lang="ini">JavaScript
// 设置viewport和根字体大小
(function() {
  const <span class="hljs-attr">dpr</span> = window.devicePixelRatio || <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  const <span class="hljs-attr">scale</span> = <span class="hljs-number">1</span> / dpr<span class="hljs-comment">;</span>
  
  // 设置viewport
  const <span class="hljs-attr">viewport</span> = document.querySelector(<span class="hljs-string">'meta[name="viewport"]'</span>)<span class="hljs-comment">;</span>
  if (viewport) {
    viewport.setAttribute('content', 
      `<span class="hljs-attr">width</span>=device-width,initial-scale=<span class="hljs-variable">${scale}</span>,maximum-scale=<span class="hljs-variable">${scale}</span>,minimum-scale=<span class="hljs-variable">${scale}</span>,user-scalable=<span class="hljs-literal">no</span>`
    )<span class="hljs-comment">;</span>
  }
  
  // 设置根字体大小
  const <span class="hljs-attr">docEl</span> = document.documentElement<span class="hljs-comment">;</span>
  const <span class="hljs-attr">fontsize</span> = <span class="hljs-number">16</span> * dpr<span class="hljs-comment">;</span>
  <span class="hljs-attr">docEl.style.fontSize</span> = fontsize + <span class="hljs-string">'px'</span><span class="hljs-comment">;</span>
})()<span class="hljs-comment">;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* CSS中正常写1px */</span>
<span class="hljs-selector-class">.border</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>;
}

<span class="hljs-comment">/* 其他尺寸用rem */</span>
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">7.5rem</span>;        <span class="hljs-comment">/* 在2倍屏下实际是240px */</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-number">10rem</span>;        <span class="hljs-comment">/* 在2倍屏下实际是320px */</span>
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.32rem</span>;   <span class="hljs-comment">/* 在2倍屏下实际是16px */</span>
}
</code></pre>
<h3 data-id="heading-11">完整实现</h3>
<pre><code class="hljs language-xml" lang="xml">HTML
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width,initial-scale=1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    !<span class="hljs-keyword">function</span>(<span class="hljs-params">e,t</span>){
      <span class="hljs-keyword">var</span> n=t.<span class="hljs-property">documentElement</span>,
          d=e.<span class="hljs-property">devicePixelRatio</span>||<span class="hljs-number">1</span>,
          i=<span class="hljs-number">1</span>/d,
          o=n.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">"data-dpr"</span>)||d;
      
      <span class="hljs-comment">// 设置data-dpr属性</span>
      n.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"data-dpr"</span>,o);
      
      <span class="hljs-comment">// 设置viewport</span>
      <span class="hljs-keyword">var</span> a=t.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'meta[name="viewport"]'</span>);
      a.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"content"</span>,<span class="hljs-string">"width=device-width,initial-scale="</span>+i+<span class="hljs-string">",maximum-scale="</span>+i+<span class="hljs-string">", minimum-scale="</span>+i+<span class="hljs-string">",user-scalable=no"</span>);
      
      <span class="hljs-comment">// 设置根字体大小</span>
      <span class="hljs-keyword">var</span> s=<span class="hljs-number">16</span>*d;
      n.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span>=s+<span class="hljs-string">"px"</span>
    }(<span class="hljs-variable language_">window</span>,<span class="hljs-variable language_">document</span>);
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">3️⃣ Border-image 方案</h2>
<h3 data-id="heading-13">基本实现</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-selector-class">.border-image-1px</span> {
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid transparent;
  <span class="hljs-attribute">border-image</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent <span class="hljs-number">50%</span>, <span class="hljs-number">#e5e5e5</span> <span class="hljs-number">50%</span>) <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>;
}

<span class="hljs-comment">/* 四边框 */</span>
<span class="hljs-selector-class">.border-image-4</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid transparent;
  <span class="hljs-attribute">border-image</span>: <span class="hljs-built_in">linear-gradient</span>(to right, <span class="hljs-number">#e5e5e5</span>, <span class="hljs-number">#e5e5e5</span>) <span class="hljs-number">1</span>;
}
</code></pre>
<h3 data-id="heading-14">复杂边框样式</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 渐变边框 */</span>
<span class="hljs-selector-class">.gradient-border</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid transparent;
  <span class="hljs-attribute">border-image</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>) <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* 虚线边框 */</span>
<span class="hljs-selector-class">.dashed-border</span> {
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid transparent;
  <span class="hljs-attribute">border-image</span>: <span class="hljs-built_in">repeating-linear-gradient</span>(
    to right,
    <span class="hljs-number">#e5e5e5</span>,
    <span class="hljs-number">#e5e5e5</span> <span class="hljs-number">5px</span>,
    transparent <span class="hljs-number">5px</span>,
    transparent <span class="hljs-number">10px</span>
  ) <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-15">4️⃣ Box-shadow 方案</h2>
<h3 data-id="heading-16">基本实现</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 下边框 */</span>
<span class="hljs-selector-class">.shadow-border-bottom</span> {
  <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> -<span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>;
}

<span class="hljs-comment">/* 上边框 */</span>
<span class="hljs-selector-class">.shadow-border-top</span> {
  <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>;
}

<span class="hljs-comment">/* 四边框 */</span>
<span class="hljs-selector-class">.shadow-border-all</span> {
  <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">#e5e5e5</span>;
}

<span class="hljs-comment">/* 多重边框 */</span>
<span class="hljs-selector-class">.shadow-border-multiple</span> {
  <span class="hljs-attribute">box-shadow</span>: 
    inset <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>,
    inset <span class="hljs-number">0</span> -<span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>;
}
</code></pre>
<h3 data-id="heading-17">响应式适配</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-selector-class">.responsive-shadow-border</span> {
  <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> -<span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
  <span class="hljs-selector-class">.responsive-shadow-border</span> {
    <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> -<span class="hljs-number">0.5px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>;
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">3</span>) {
  <span class="hljs-selector-class">.responsive-shadow-border</span> {
    <span class="hljs-attribute">box-shadow</span>: inset <span class="hljs-number">0</span> -<span class="hljs-number">0.33px</span> <span class="hljs-number">0</span> <span class="hljs-number">#e5e5e5</span>;
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-18">5️⃣ 伪元素方案</h2>
<h3 data-id="heading-19">单边框实现</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 底部边框 */</span>
<span class="hljs-selector-class">.pseudo-border-bottom</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.pseudo-border-bottom</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> bottom;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
  <span class="hljs-selector-class">.pseudo-border-bottom</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">3</span>) {
  <span class="hljs-selector-class">.pseudo-border-bottom</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.33</span>);
  }
}
</code></pre>
<h3 data-id="heading-20">多边框组合</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 上下边框 */</span>
<span class="hljs-selector-class">.pseudo-border-tb</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.pseudo-border-tb</span><span class="hljs-selector-pseudo">::before</span>,
<span class="hljs-selector-class">.pseudo-border-tb</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e5e5e5</span>;
}

<span class="hljs-selector-class">.pseudo-border-tb</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> top;
}

<span class="hljs-selector-class">.pseudo-border-tb</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> bottom;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
  <span class="hljs-selector-class">.pseudo-border-tb</span><span class="hljs-selector-pseudo">::before</span>,
  <span class="hljs-selector-class">.pseudo-border-tb</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-21">6️⃣ SVG方案</h2>
<h3 data-id="heading-22">基本实现</h3>
<pre><code class="hljs language-ini" lang="ini">CSS
.svg-border {
  border: none<span class="hljs-comment">;</span>
  background-image: url("data:image/svg+xml,%3csvg <span class="hljs-attr">width</span>=<span class="hljs-string">'100%25'</span> height=<span class="hljs-string">'100%25'</span> xmlns=<span class="hljs-string">'http://www.w3.org/2000/svg'</span>%<span class="hljs-number">3</span>e%<span class="hljs-number">3</span>crect width=<span class="hljs-string">'100%25'</span> height=<span class="hljs-string">'100%25'</span> fill=<span class="hljs-string">'none'</span> stroke=<span class="hljs-string">'%23e5e5e5'</span> stroke-width=<span class="hljs-string">'1'</span>/%<span class="hljs-number">3</span>e%<span class="hljs-number">3</span>c/svg%<span class="hljs-number">3</span>e<span class="hljs-string">");
}
</span></code></pre>
<h3 data-id="heading-23">复杂SVG边框</h3>
<pre><code class="hljs language-ini" lang="ini">CSS
.svg-dashed-border {
  background-image: url("data:image/svg+xml,%3csvg <span class="hljs-attr">width</span>=<span class="hljs-string">'100%25'</span> height=<span class="hljs-string">'100%25'</span> xmlns=<span class="hljs-string">'http://www.w3.org/2000/svg'</span>%<span class="hljs-number">3</span>e%<span class="hljs-number">3</span>crect width=<span class="hljs-string">'100%25'</span> height=<span class="hljs-string">'100%25'</span> fill=<span class="hljs-string">'none'</span> stroke=<span class="hljs-string">'%23e5e5e5'</span> stroke-width=<span class="hljs-string">'1'</span> stroke-dasharray=<span class="hljs-string">'5,5'</span>/%<span class="hljs-number">3</span>e%<span class="hljs-number">3</span>c/svg%<span class="hljs-number">3</span>e<span class="hljs-string">");
}
</span></code></pre>
<hr/>
<h2 data-id="heading-24">🛠️ 实用工具类</h2>
<h3 data-id="heading-25">CSS工具类</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">CSS</span>
<span class="hljs-comment">/* 1px边框工具类 */</span>
<span class="hljs-selector-class">.border-t</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px-top</span>(<span class="hljs-number">#e5e5e5</span>); }
<span class="hljs-selector-class">.border-r</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px-right</span>(<span class="hljs-number">#e5e5e5</span>); }
<span class="hljs-selector-class">.border-b</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px-bottom</span>(<span class="hljs-number">#e5e5e5</span>); }
<span class="hljs-selector-class">.border-l</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px-left</span>(<span class="hljs-number">#e5e5e5</span>); }
<span class="hljs-selector-class">.border-all</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px</span>(<span class="hljs-number">#e5e5e5</span>); }

<span class="hljs-comment">/* 颜色变体 */</span>
<span class="hljs-selector-class">.border-gray</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px</span>(<span class="hljs-number">#e5e5e5</span>); }
<span class="hljs-selector-class">.border-red</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px</span>(<span class="hljs-number">#ff4757</span>); }
<span class="hljs-selector-class">.border-blue</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px</span>(<span class="hljs-number">#3742fa</span>); }

<span class="hljs-comment">/* 圆角变体 */</span>
<span class="hljs-selector-class">.border-rounded</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px</span>(<span class="hljs-number">#e5e5e5</span>, <span class="hljs-number">4px</span>); }
<span class="hljs-selector-class">.border-circle</span> { <span class="hljs-variable">@include</span> <span class="hljs-built_in">border-1px</span>(<span class="hljs-number">#e5e5e5</span>, <span class="hljs-number">50%</span>); }
</code></pre>
<h3 data-id="heading-26">JavaScript检测函数</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">JavaScript</span>
<span class="hljs-comment">// 检测是否需要1px处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">needsRetinaBorder</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span> &gt;= <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// 动态添加类名</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title function_">needsRetinaBorder</span>()) {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'retina'</span>);
}
</code></pre>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 配合JavaScript使用 */</span>
<span class="hljs-selector-class">.retina</span> <span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-27">📱 实际应用示例</h2>
<h3 data-id="heading-28">列表项边框</h3>
<pre><code class="hljs language-ini" lang="ini">HTML
&lt;ul <span class="hljs-attr">class</span>=<span class="hljs-string">"list"</span>&gt;
  &lt;li <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>&gt;列表项<span class="hljs-number">1</span>&lt;/li&gt;
  &lt;li <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>&gt;列表项<span class="hljs-number">2</span>&lt;/li&gt;
  &lt;li <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>&gt;列表项<span class="hljs-number">3</span>&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-selector-class">.list-item</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.list-item</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:last-child</span>)<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e5e5e5</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> bottom;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
  <span class="hljs-selector-class">.list-item</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-pseudo">:last-child</span>)<span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
  }
}
</code></pre>
<h3 data-id="heading-29">按钮边框</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">HTML</span>
&lt;<span class="hljs-selector-tag">button</span> class="btn-<span class="hljs-attribute">outline</span>"&gt;按钮&lt;/<span class="hljs-selector-tag">button</span>&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-selector-class">.btn-outline</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.btn-outline</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#007aff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">pointer-events</span>: none;
}
</code></pre>
<h3 data-id="heading-30">表单输入框</h3>
<pre><code class="hljs language-ini" lang="ini">HTML
&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;
  &lt;input <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> class=<span class="hljs-string">"form-input"</span> placeholder=<span class="hljs-string">"请输入内容"</span>&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-selector-class">.form-input</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f8f8</span>;
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">outline</span>: none;
}

<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#007aff</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> bottom;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:focus</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">-webkit-min-device-pixel-ratio</span>: <span class="hljs-number">2</span>) {
  <span class="hljs-selector-class">.form-input</span><span class="hljs-selector-pseudo">:focus</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0.5</span>);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-31">🎯 最佳实践建议</h2>
<h3 data-id="heading-32">1. 方案选择</h3>
<ul>
<li><strong>简单项目</strong>：使用transform scale方案</li>
<li><strong>复杂项目</strong>：使用viewport + rem方案</li>
<li><strong>组件库</strong>：提供多种方案的工具类</li>
</ul>
<h3 data-id="heading-33">2. 性能考虑</h3>
<ul>
<li>避免过多使用box-shadow</li>
<li>优先使用transform（GPU加速）</li>
<li>合理使用伪元素</li>
</ul>
<h3 data-id="heading-34">3. 兼容性处理</h3>
<pre><code class="hljs language-css" lang="css">CSS
<span class="hljs-comment">/* 渐进增强 */</span>
<span class="hljs-selector-class">.border-1px</span> {
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e5e5e5</span>; <span class="hljs-comment">/* 降级方案 */</span>
}

<span class="hljs-keyword">@supports</span> (<span class="hljs-attribute">transform</span>: scale(<span class="hljs-number">0.5</span>)) {
  <span class="hljs-selector-class">.border-1px</span> {
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">position</span>: relative;
  }
  
  <span class="hljs-selector-class">.border-1px</span><span class="hljs-selector-pseudo">::after</span> {
    <span class="hljs-comment">/* transform方案 */</span>
  }
}
</code></pre>
<p>选择合适的1px解决方案需要根据项目具体情况，推荐优先使用transform scale方案，它简单易用且性能良好。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 部分指南]]></title>    <link>https://juejin.cn/post/7598370121435873330</link>    <guid>https://juejin.cn/post/7598370121435873330</guid>    <pubDate>2026-01-23T09:15:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598370121435873330" data-draft-id="7598362826109927474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 部分指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T09:15:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="二二四一"/> <meta itemprop="url" content="https://juejin.cn/user/2975738274777080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 部分指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2975738274777080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    二二四一
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:15:26.000Z" title="Fri Jan 23 2026 09:15:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">interface &amp; type</h2>
<p>两者都能定义对象结构和函数签名，但interface 更偏向结构扩展与 OOP 语义；type 更偏向类型组合与类型表达式。</p>
<p>在工程中，interface 用于描述数据结构，type 用于类型运算和复杂组合。</p>
<h3 data-id="heading-1">相同点</h3>
<ul>
<li>都能描述对象形状</li>
<li>都能做函数类型定义</li>
<li>都支持泛型</li>
<li>都能被 class implements</li>
</ul>
<pre><code class="hljs language-css" lang="css">interface <span class="hljs-selector-tag">A</span> { x: number }
type <span class="hljs-selector-tag">B</span> = { x: number }
</code></pre>
<h3 data-id="heading-2">核心区别</h3>
<ol>
<li>interface 可以合并声明</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> { id: number }
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> { name: string }

<span class="hljs-keyword">const</span> u: User = { id: <span class="hljs-number">1</span>, name: <span class="hljs-string">'a'</span> }
</code></pre>
<p>👉 <strong>type 不行，这是 interface 最重要的能力。</strong></p>
<p>适合用来扩展第三方库定义（例如扩展 Express Request）。</p>
<ol start="2">
<li>type 更灵活，支持类型表达式</li>
</ol>
<p>type 可以：</p>
<ul>
<li>联合</li>
<li>交叉</li>
<li>条件类型</li>
<li>映射类型</li>
<li>模板字符串类型</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-string">'success'</span> | <span class="hljs-string">'error'</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">WithId</span>&lt;T&gt; = T &amp; { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Api</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[] ? <span class="hljs-string">'array'</span> : <span class="hljs-string">'object'</span>;
</code></pre>
<p>👉 <strong>interface 做不到这些。</strong></p>
<ol start="3">
<li>interface 更适合建模“对象、类、API”结构</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">interface</span> <span class="hljs-title">Person</span> {
  name: <span class="hljs-built_in">string</span>;
  say(): <span class="hljs-keyword">void</span>;
}
</code></pre>
<p>它能：</p>
<ul>
<li>扩展其他 interface（extends）</li>
<li>被类 implements（非常 OOP）</li>
</ul>
<ol start="4">
<li>type 可以“别名化”（alias）任何类型</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Fn</span> = <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Point</span> = [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Maybe</span>&lt;T&gt; = T | <span class="hljs-literal">undefined</span>;
</code></pre>
<p>👉 type 的使用范围更广，甚至可以 alias 基本类型。<br/>
interface 做不到。</p>
<ol start="5">
<li>扩展方式不同（extends vs 交叉类型）</li>
</ol>
<ul>
<li>interface 扩展</li>
</ul>
<pre><code class="hljs language-css" lang="css">interface <span class="hljs-selector-tag">A</span> { x: number }
interface <span class="hljs-selector-tag">B</span> extends <span class="hljs-selector-tag">A</span> { y: number }
</code></pre>
<ul>
<li>type 扩展</li>
</ul>
<pre><code class="hljs language-css" lang="css">type <span class="hljs-selector-tag">A</span> = { x: number }
type <span class="hljs-selector-tag">B</span> = <span class="hljs-selector-tag">A</span> &amp; { y: number }
</code></pre>
<p>两者效果一致，但交叉类型能做更多复杂组合。</p>
<ol start="6">
<li>复杂类型构造：type 更强</li>
</ol>
<p>前端工程里的工具类型、复杂泛型、联合类型转换 <strong>几乎都是 type 实现的</strong>。</p>
<pre><code class="hljs language-ini" lang="ini">type Partial&lt;T&gt; = {
  <span class="hljs-section">[P in keyof T]</span>?: T<span class="hljs-section">[P]</span><span class="hljs-comment">;</span>
}
</code></pre>
<p>interface 无法实现这种类型运算。</p>
<h3 data-id="heading-3">工程中如何选择</h3>
<p>如果是 <strong>描述数据结构、业务对象、class API</strong>，优先用 <strong>interface</strong>，因为其更可扩展、可合并，团队协作更友好。</p>
<p>如果是 <strong>类型组合、联合类型、工具类型、映射类型、模板字面量</strong>，一定用 <strong>type</strong>，因为更灵活。</p>
<h2 data-id="heading-4">unknow &amp; any &amp; never</h2>
<h3 data-id="heading-5">🐱unknown</h3>
<p><code>unknown</code> 是安全的 any，可以接受任何值，但不能被直接使用，需要类型收窄。适用于以下的严格使用场景。</p>
<ol>
<li>不信任来源的数据（API、用户输入、动态数据）</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">json: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">unknown</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(json);
}
</code></pre>
<ol start="2">
<li>泛型上界不确定，但不希望失去类型安全</li>
</ol>
<pre><code class="hljs language-r" lang="r"><span class="hljs-keyword">function</span> handle<span class="hljs-operator">&lt;</span><span class="hljs-built_in">T</span> extends unknown<span class="hljs-operator">&gt;</span><span class="hljs-punctuation">(</span>value<span class="hljs-operator">:</span> <span class="hljs-built_in">T</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>设计库时需要“类型安全的扩展点”</li>
</ol>
<p>比如写 SDK、插件系统时，unknown 让调用方必须显式确认类型。</p>
<h3 data-id="heading-6">🐶never</h3>
<p>never 代表“不可能发生的值”（类型系统的底部类型）</p>
<ul>
<li>程序不会走到这里</li>
<li>函数不会返回</li>
<li>分支被完全排除</li>
</ul>
<p>适用于以下的严格使用场景。</p>
<ol>
<li>表示函数永远不返回（异常 / 死循环）</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fail</span>(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">never</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(msg);
}
</code></pre>
<ol start="2">
<li>类型收窄后出现“不可能的情况”</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">assertNever</span>(<span class="hljs-params">x: <span class="hljs-built_in">never</span></span>): <span class="hljs-built_in">never</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Unexpected value: "</span> + x);
}
</code></pre>
<p>配合基础类型保护写 exhaustiveness check：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">type</span> <span class="hljs-variable">Shape</span> <span class="hljs-operator">=</span> <span class="hljs-string">'circle'</span> | <span class="hljs-string">'square'</span>;

function <span class="hljs-title function_">area</span><span class="hljs-params">(s: Shape)</span> {
  <span class="hljs-keyword">switch</span> (s) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'circle'</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'square'</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">default</span>: 
      <span class="hljs-keyword">return</span> assertNever(s); <span class="hljs-comment">// 编译期报错，保证分支覆盖完整</span>
  }
}
</code></pre>
<ol start="3">
<li>联合类型排除成员</li>
</ol>
<pre><code class="hljs language-r" lang="r">type Exclude<span class="hljs-operator">&lt;</span><span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> U<span class="hljs-operator">&gt;</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">T</span> extends U <span class="hljs-operator">?</span> never <span class="hljs-operator">:</span> <span class="hljs-built_in">T</span>;
</code></pre>
<blockquote>
<p>“never 用于严格的编译期检查、不可达代码、以及保证联合类型逻辑完备性。”</p>
</blockquote>
<h3 data-id="heading-7">🐯any</h3>
<p><code>any</code> 会关闭所有类型检查，是 TS 世界的“丧失类型安全”。适用于以下严格使用场景（只有这些情况能用）</p>
<ol>
<li>渐进式迁移 JS → TS，需要暂时兜底</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">let temp: <span class="hljs-attr">any</span> = legacyLib.getData()<span class="hljs-comment">;</span>
</code></pre>
<ol start="2">
<li>类型真的无法确定（第三方库，动态字段特别复杂）</li>
</ol>
<p>比如老旧 SDK，或者大量动态 key。</p>
<ol start="3">
<li>需要与 JS 环境交互（特殊全局变量、动态属性）</li>
</ol>
<p>例如 window 全局写入自定义字段。</p>
<ol start="4">
<li>为了避免过度复杂的类型推导（工程权衡）</li>
</ol>
<p>例如复杂泛型导致 IDE 卡顿。</p>
<blockquote>
<p>any 是一种<strong>工程妥协</strong>，不是类型，它是关闭类型检查的开关。只有在迁移、兼容、动态环境时才应该使用。</p>
</blockquote>
<h3 data-id="heading-8">三者关系</h3>
<ul>
<li>unknown 是安全的顶类型（不信任输入 → 先 unknown）</li>
<li>never 是不可能发生的底类型（穷尽检查、异常、严格逻辑）</li>
<li>any 是逃生舱（完全关闭类型检查，只在必要时使用）</li>
</ul>
<p>unknown 与 any 是对立的：一个提高安全，一个降低安全；</p>
<p>never 则代表类型系统的底部，是逻辑完备性检查的核心工具。</p>
<h2 data-id="heading-9">Partial &amp; Pick &amp; infer</h2>
<p>Partial 和 Pick 是典型的映射类型，用来‘改造’对象键；</p>
<p>infer 是在条件类型中做‘反向推断’，固定在提取某些类型信息的场景里。</p>
<p>这三个是 TypeScript 类型系统里最基础也最常用的构建块，理解它们能写出真正类型安全的库级代码。”</p>
<h3 data-id="heading-10">🍒Partial</h3>
<p><code>Partial&lt;T&gt;</code> 会把类型 T 的所有属性变成可选属性。</p>
<p>它是一个典型的「映射类型」，通过遍历 <code>keyof T</code>，把每个键的属性加上 <code>?</code> 修饰符。</p>
<pre><code class="hljs language-ini" lang="ini">type MyPartial&lt;T&gt; = {
  <span class="hljs-section">[P in keyof T]</span>?: T<span class="hljs-section">[P]</span><span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>工程使用场景：</p>
<ul>
<li>表单场景：编辑时部分字段可选</li>
<li>DTO/Object patch：只更新传入字段</li>
<li>配置对象：允许用户覆盖默认配置</li>
</ul>
<blockquote>
<p>生产里基本把所有配置类型都写成 Partial 形式，减少冗余类型声明，也避免用户必须传所有属性。</p>
</blockquote>
<h3 data-id="heading-11">🍑Pick</h3>
<p><code>Pick&lt;T, K&gt;</code> 从类型 T 中挑选部分键 K，生成一个子类型。</p>
<p>它同样是映射类型，只是遍历 <code>K</code> 而不是 <code>keyof T</code>。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">MyPick&lt;T</span>, <span class="hljs-title">K</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">keyof</span> <span class="hljs-title">T&gt;</span> </span>= {
  [<span class="hljs-type">P</span> in <span class="hljs-type">K</span>]: <span class="hljs-type">T</span>[<span class="hljs-type">P</span>];
};
</code></pre>
<p>工程使用场景</p>
<ul>
<li>API 拆分：只需要某些字段</li>
<li>React Props 提取</li>
<li>二次封装组件时抽取部分属性</li>
</ul>
<blockquote>
<p>Pick 本质上就是结构化编程里的投影操作，非常常用。</p>
</blockquote>
<h3 data-id="heading-12">🍇infer</h3>
<p><code>infer</code> 是 TypeScript 在条件类型里用于<strong>声明一个待推断的类型变量</strong>。<br/>
它让 TypeScript 能“从类型中反向提取信息”。</p>
<ul>
<li>只能在条件类型 <code>T extends X ? ... : ...</code> 的 <code>true</code> 分支里使用</li>
<li>相当于告诉 TS：“这里有个未知类型 R，你帮我推断它是什么”</li>
<li>最典型的例子：从函数类型中提取返回值</li>
</ul>
<p><strong>手写 ReturnType</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">MyReturnType</span>&lt;F&gt; = 
  F <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R 
    ? R 
    : <span class="hljs-built_in">never</span>;
</code></pre>
<p>常见 infer 使用：</p>
<ul>
<li>提取 Promise 内部类型</li>
</ul>
<pre><code class="hljs language-r" lang="r">type Awaited<span class="hljs-operator">&lt;</span><span class="hljs-built_in">T</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">T</span> extends Promise<span class="hljs-operator">&lt;</span>infer R<span class="hljs-operator">&gt;</span> <span class="hljs-operator">?</span> R <span class="hljs-operator">:</span> <span class="hljs-built_in">T</span>;
</code></pre>
<ul>
<li>提取数组元素类型</li>
</ul>
<pre><code class="hljs language-r" lang="r">type ElementOf<span class="hljs-operator">&lt;</span><span class="hljs-built_in">T</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">T</span> extends <span class="hljs-punctuation">(</span>infer U<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">?</span> U <span class="hljs-operator">:</span> <span class="hljs-built_in">T</span>;
</code></pre>
<p>工程使用场景</p>
<ul>
<li>自动根据 API 类型生成 Response 类型</li>
<li>根据函数库自动推断返回值</li>
<li>在前端状态管理中自动生成 Action 类型</li>
<li>在复杂表单里从 DTO 推类型</li>
</ul>
<blockquote>
<p>infer 是 TypeScript 高阶类型里很核心的机制，它让 TypeScript 能像编译器一样进行模式匹配。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端手写]]></title>    <link>https://juejin.cn/post/7598222735808200744</link>    <guid>https://juejin.cn/post/7598222735808200744</guid>    <pubDate>2026-01-23T09:24:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598222735808200744" data-draft-id="7598320487508328483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端手写"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T09:24:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="二二四一"/> <meta itemprop="url" content="https://juejin.cn/user/2975738274777080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端手写
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2975738274777080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    二二四一
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:24:05.000Z" title="Fri Jan 23 2026 09:24:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="sunburst">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#000;color:#f8f8f8}.hljs-comment,.hljs-quote{color:#aeaeae;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#e28964}.hljs-string{color:#65b042}.hljs-subst{color:#daefa3}.hljs-link,.hljs-regexp{color:#e9c062}.hljs-name,.hljs-section,.hljs-tag,.hljs-title{color:#89bdff}.hljs-class .hljs-title,.hljs-doctag{text-decoration:underline}.hljs-bullet,.hljs-number,.hljs-symbol{color:#3387cc}.hljs-params,.hljs-template-variable,.hljs-variable{color:#3e87e3}.hljs-attribute{color:#cda869}.hljs-meta{color:#8996a8}.hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-selector-class{color:#9b703f}.hljs-selector-id{color:#8b98ab}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Promise + SetTimeout</h2>
<h3 data-id="heading-1">🥇 01. 并发限制调度器（异步霸榜 No.1）</h3>
<blockquote>
<p>业务场景：要发 100 个请求，但后端限流，每次只能发 N 个</p>
</blockquote>
<blockquote>
<p>扩展交互：可以在中途暂停执行，获取执行的结果</p>
</blockquote>
<blockquote>
<p>🌈实现思路：模拟一个迷你版“浏览器资源调度器”，这个调度器的核心本质，是通过「running 计数」「idx 游标」「runNext 自驱动」三者配合，实现一个动态的任务池。它保证任务源源不断执行，但同时不会超过给定的并发上限。</p>
</blockquote>
<ol>
<li>业务调用</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyWork</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 生成调度器</span>
  <span class="hljs-keyword">const</span> scheduler = <span class="hljs-title function_">limitRequests</span>(tasks, <span class="hljs-number">3</span>);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStart</span>(<span class="hljs-params"/>) {
    scheduler.<span class="hljs-title function_">start</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"所有任务完成！"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"结果:"</span>, res);
    });
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleEnd</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"暂停完成执行～"</span>);
    scheduler.<span class="hljs-title function_">stop</span>();
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleStart}</span>&gt;</span>开始<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleEnd}</span>&gt;</span>暂停<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>2.  创建调度器</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">limitRequests</span>(<span class="hljs-params">tasks, limit</span>) {
  <span class="hljs-keyword">const</span> res = [] <span class="hljs-comment">// 存所有任务返回的 Promise，用来最终 Promise.all</span>
  <span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span> <span class="hljs-comment">// 当前处理到第几个任务</span>
  <span class="hljs-keyword">let</span> running = <span class="hljs-number">0</span> <span class="hljs-comment">// 当前正在执行的任务数量（关键的并发控制变量）</span>
  <span class="hljs-keyword">let</span> stopped = <span class="hljs-literal">false</span> <span class="hljs-comment">// 用于标识是否已停止</span>

  <span class="hljs-comment">// 暴露的停止执行的方法</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    stopped = <span class="hljs-literal">true</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">runNext</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 执行队列处理完毕或者已暂停，返回结果</span>
        <span class="hljs-keyword">if</span> (running === <span class="hljs-number">0</span> &amp;&amp; stopped) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(res))
        }

        <span class="hljs-comment">// 正在执行的任务数量不超过单次限制，存在未执行的任务</span>
        <span class="hljs-keyword">while</span> (running &lt; limit &amp;&amp; idx &lt; tasks.<span class="hljs-property">length</span>) {
          <span class="hljs-comment">// 如果停止标志为 true，阻止新的任务加入</span>
          <span class="hljs-keyword">if</span> (stopped) {
            <span class="hljs-keyword">return</span>
          }
          <span class="hljs-comment">// 获取当前任务并执行</span>
          <span class="hljs-keyword">const</span> cur = tasks[idx++]()
          res.<span class="hljs-title function_">push</span>(cur)
          running++
          cur.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
            running--
            <span class="hljs-title function_">runNext</span>()
          }).<span class="hljs-title function_">catch</span>(reject)
        }
      }

      <span class="hljs-title function_">runNext</span>()
    })
  }

  <span class="hljs-keyword">return</span> { stop, start }
}
</code></pre>
<p>3.  模拟异步方法、准备数据</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建100个任务</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tasks = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">100</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchData</span>(i))

<span class="hljs-comment">// 模拟异步请求方法</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">id: number</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> time = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2000</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`开始任务: <span class="hljs-subst">${id}</span>`</span>)

    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`完成任务: <span class="hljs-subst">${id}</span>`</span>)
      <span class="hljs-title function_">resolve</span>(id)
    }, time)
  })
}
</code></pre>
<p>4. 自定义hook实现功能</p>

<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">useLimitRequests</span> = (tasks: any[], limit: number)=&gt; {
  const <span class="hljs-attr">resultRef</span> = useRef&lt;number[]&gt;([])<span class="hljs-comment">; // 用 useRef 存储任务结果，避免重新渲染</span>
  const <span class="hljs-attr">isStop</span> = useRef&lt;boolean&gt;(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">idx</span> = useRef&lt;number&gt;(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">reunning</span> = useRef&lt;number&gt;(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">onStop</span> = useCallback(() =&gt; {
    <span class="hljs-attr">isStop.current</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
  },<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">onStart</span> = useCallback(() =&gt; {
    return new Promise((resolve, reject) =&gt; {
      function nextRun(){
        if(<span class="hljs-attr">reunning.current</span> === <span class="hljs-number">0</span> &amp;&amp; isStop.current) {
          return resolve(Promise.all(resultRef.current))<span class="hljs-comment">;</span>
        }

        while(idx.current &lt; tasks.length &amp;&amp; reunning.current &lt; limit){
          if(isStop.current){
            return<span class="hljs-comment">;</span>
          }

          const <span class="hljs-attr">curTaskRes</span> = tasks[idx.current]()<span class="hljs-comment">;</span>
          idx.current += 1<span class="hljs-comment">;</span>
          resultRef.current.push(curTaskRes)
          reunning.current += 1<span class="hljs-comment">;</span>

          curTaskRes.then(() =&gt; {
            reunning.current <span class="hljs-attr">-</span>= <span class="hljs-number">1</span><span class="hljs-comment">;</span>
            nextRun()<span class="hljs-comment">;</span>
          }).catch((error: any) =&gt; reject(error))
        }
      }

      nextRun()<span class="hljs-comment">;</span>
    })
  },<span class="hljs-section">[isStop, limit, tasks]</span>)<span class="hljs-comment">;</span>

  return { onStop, onStart}<span class="hljs-comment">;</span>
}
</code></pre>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e38071875e4ff09dcf63777b48fade~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqM5LqM5Zub5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765045&amp;x-signature=S8vSaB9qhHpiyqVa7BDuyiq5sRk%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-2">🥈 02. 支持指数退避的重试（Backoff Retry）</h3>
<blockquote>
<p>业务场景：接口偶尔报错，你希望自动重试 3 次，每次等待时间翻倍。</p>
</blockquote>
<ol>
<li>创建重试方法</li>
</ol>

<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">retry</span>(fn, times = <span class="hljs-number">3</span>, delay = <span class="hljs-number">500</span>) {
  return new <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    const attempt = (n, d) =&gt; {
      <span class="hljs-built_in">fn</span>()<span class="hljs-selector-class">.then</span>(resolve)<span class="hljs-selector-class">.catch</span>(err =&gt; {
        if (n === <span class="hljs-number">0</span>) return <span class="hljs-built_in">reject</span>(err)
        <span class="hljs-built_in">setTimeout</span>(() =&gt; <span class="hljs-built_in">attempt</span>(n - <span class="hljs-number">1</span>, d * <span class="hljs-number">2</span>), d)
      })
    }
    <span class="hljs-built_in">attempt</span>(times, delay)
  })
}
</code></pre>
<p>2.  业务调用</p>

<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRetry</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">retry</span>(mockRequest, <span class="hljs-number">3</span>, <span class="hljs-number">500</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)) <span class="hljs-comment">// 如果请求成功，输出结果</span>
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)); <span class="hljs-comment">// 如果重试失败，输出错误</span>
  }
</code></pre>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a6251a15a9246f884f1cd5100b3cc6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqM5LqM5Zub5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765045&amp;x-signature=NgFmyPDYDTUdXRp7siJG448ZOrQ%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-3">🥉 03. 带超时控制的 Promise（Timeout Promise）</h3>
<blockquote>
<p>业务场景：请求超 3 秒自动失败，不等了</p>
</blockquote>
<ol>
<li>自定义函数实现</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">withTimeout</span>(<span class="hljs-params">fn, ms</span>){
  <span class="hljs-comment">// 存放定时器</span>
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// 超时函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">timeOut</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'超时了'</span>)), ms);
  });

  <span class="hljs-comment">// Promise.race 会返回一个结果， fn 目标函数</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([<span class="hljs-title function_">fn</span>(), <span class="hljs-title function_">timeOut</span>()]).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">clearTimeout</span>(timer);
  })
}
</code></pre>
<p>2.  模拟延迟异步方法</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">slowTask</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'Task completed'</span>), <span class="hljs-number">2000</span>); <span class="hljs-comment">// 模拟一个 3 秒的任务</span>
  });
}
</code></pre>
<p>3.  业务调用</p>

<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTimeOut</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">withTimeout</span>(slowTask, <span class="hljs-number">1000</span>) <span class="hljs-comment">// 设置 1 秒超时</span>
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)) <span class="hljs-comment">// 如果任务完成，输出结果</span>
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)); <span class="hljs-comment">// 如果超时，输出超时错误</span>
  }
</code></pre>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1855acce3d2e45f199764f982e644d1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqM5LqM5Zub5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765045&amp;x-signature=OaiaLsEqanP%2FYHDWYUMJM33PL%2FM%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-4">🚢 04. 串行任务：一步一步稳扎稳打</h3>
<blockquote>
<p>业务场景：分片上传、表单分步骤提交</p>
</blockquote>
<blockquote>
<p>核心逻辑：每个任务会按顺序一个接一个地执行，直到上一个任务完成后，才会开始下一个任务</p>
</blockquote>
<ol>
<li>自定义方法</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runInSequence</span>(<span class="hljs-params">tasks</span>){
  <span class="hljs-keyword">const</span> result = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> task <span class="hljs-keyword">of</span> tasks) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">task</span>();
    result.<span class="hljs-title function_">push</span>(res);
  }

  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>2.  模拟异步请求</p>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = (<span class="hljs-params">task: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Task <span class="hljs-subst">${task}</span> completed`</span>);
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">`Result of <span class="hljs-subst">${task}</span>`</span>);
    }, <span class="hljs-number">1000</span>); <span class="hljs-comment">// 每个任务延迟 1 秒</span>
  });
};

<span class="hljs-comment">// 定义任务列表</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tasks = [
  <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-string">'task1'</span>),
  <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-string">'task2'</span>),
  <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-string">'task3'</span>)
];
</code></pre>
<p>3.  调用</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleEquence</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runInSequence</span>(tasks);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'All tasks completed'</span>, result);
  }
</code></pre>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42b31c347ea94793aa1cd6726f22d858~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqM5LqM5Zub5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765045&amp;x-signature=ufiTb2SF2xGT67Goi1WGfIV1poQ%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-5">⌚️ 05. Promise 版“多方等待 ready”机制</h3>
<blockquote>
<p>核心逻辑：这个机制用于让多个任务或组件等待某个条件（如 <code>ready()</code> 方法被调用）满足后再继续执行</p>
</blockquote>
<blockquote>
<p>业务场景：
1. <strong>多个任务依赖同一个条件</strong>：比如，多个组件在等待某个数据加载完成后再开始执行某个操作。
2. <strong>等待多个异步任务的准备</strong>：多个异步任务可能依赖某个资源，只有当该资源准备好时，才能继续执行后续操作。
3. <strong>协调并发任务的开始</strong>：不同的任务或组件可以等待一个共同的“开始信号”，一旦信号发送，所有等待的任务就可以同时开始。</p>
</blockquote>
<ol>
<li>自定义class</li>
</ol>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Waiter</span>{
  <span class="hljs-attr">queue</span>: <span class="hljs-built_in">any</span>[];
  <span class="hljs-attr">readyFlag</span>: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>){
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = []; <span class="hljs-comment">// 所有等待的任务</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">readyFlag</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 是否已经准备好</span>
  }

  <span class="hljs-title function_">wait</span>(<span class="hljs-params"/>){
    <span class="hljs-comment">// 条件已经准备好了，直接返回一个已解决的 Promise</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">readyFlag</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 将该任务的 Promise 放入 queue 队列中，等待</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">push</span>(r));
    }
  }


  <span class="hljs-title function_">ready</span>(<span class="hljs-params"/>){
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">readyFlag</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 设置条件已准备好</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-title function_">r</span>()); <span class="hljs-comment">// 遍历队列并触发所有等待的任务</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = []; <span class="hljs-comment">// 清空队列</span>
  }
}
</code></pre>
<p>2.  调用</p>

<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">handleReady</span>() {
    const waiter = new <span class="hljs-built_in">Waiter</span>();

    <span class="hljs-comment">// 任务 1：等待条件准备好后执行</span>
    waiter<span class="hljs-selector-class">.wait</span>()<span class="hljs-selector-class">.then</span>(() =&gt; console<span class="hljs-selector-class">.log</span>("Task <span class="hljs-number">1</span> completed"));

    <span class="hljs-comment">// 任务 2：等待条件准备好后执行</span>
    waiter<span class="hljs-selector-class">.wait</span>()<span class="hljs-selector-class">.then</span>(() =&gt; console<span class="hljs-selector-class">.log</span>("Task <span class="hljs-number">2</span> completed"));

    <span class="hljs-comment">// 任务 3：等待条件准备好后执行</span>
    waiter<span class="hljs-selector-class">.wait</span>()<span class="hljs-selector-class">.then</span>(() =&gt; console<span class="hljs-selector-class">.log</span>("Task <span class="hljs-number">3</span> completed"));

    <span class="hljs-comment">// 在 2 秒后，调用 `ready()`，表示条件准备好，所有任务可以执行</span>
    <span class="hljs-built_in">setTimeout</span>(() =&gt; {
      waiter<span class="hljs-selector-class">.ready</span>(); <span class="hljs-comment">// 调用 ready，触发所有等待的任务</span>
    }, <span class="hljs-number">2000</span>);
  }
</code></pre>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85e8dc0c19774838afd0065b32db4b17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqM5LqM5Zub5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765045&amp;x-signature=md0G6HuMmqTPAmRgWRyD86%2BT6No%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-6">🌺06. 可暂停 / 恢复的 setInterval（轮询神器）</h3>
<blockquote>
<p>核心逻辑：可以启动、暂停和恢复一个定时任务，而无需重启整个定时器</p>
</blockquote>
<blockquote>
<p>业务场景：页面隐藏暂停轮询，返回恢复</p>
</blockquote>
<ol>
<li>自定义class</li>
</ol>

<pre><code class="hljs language-kotlin" lang="kotlin">export <span class="hljs-keyword">class</span> <span class="hljs-title class_">PausableInterval</span>{
  delay: number;
  fn: any;
  timer: any;
  running: boolean;

  <span class="hljs-keyword">constructor</span>(fn: any, delay: number){
    <span class="hljs-keyword">this</span>.fn = fn            <span class="hljs-comment">// 定时任务函数</span>
    <span class="hljs-keyword">this</span>.delay = delay      <span class="hljs-comment">// 定时器的间隔时间（单位：毫秒）</span>
    <span class="hljs-keyword">this</span>.timer = <span class="hljs-literal">null</span>       <span class="hljs-comment">// 存储定时器的标识符</span>
    <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">false</span>    <span class="hljs-comment">// 标记定时器是否正在运行</span>
  }

  start(){
    <span class="hljs-comment">// 如果定时器已经在运行，直接返回，不做重复启动</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.running) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">const</span> tick = () =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.running) <span class="hljs-keyword">return</span> <span class="hljs-comment">// 如果定时器已暂停，则不再继续执行</span>
      <span class="hljs-keyword">this</span>.fn(); <span class="hljs-comment">// 执行定时任务</span>
      <span class="hljs-keyword">this</span>.timer = setTimeout(tick, <span class="hljs-keyword">this</span>.delay) <span class="hljs-comment">// 使用 setTimeout 模拟 setInterval</span>
    }

    tick();
  }

  pause() {
    clearTimeout(<span class="hljs-keyword">this</span>.timer);
    <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">false</span>;
  }

  resume(){
    <span class="hljs-keyword">this</span>.start()
  }
}
</code></pre>
<p>2.  模拟请求</p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">printMessage</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Task is running..."</span>);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pausableInterval = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PausableInterval</span>(printMessage, <span class="hljs-number">1000</span>);
</code></pre>
<p>3.  调用</p>

<pre><code class="hljs language-scss" lang="scss">  function <span class="hljs-built_in">handleStartInterval</span>() {
    pausableInterval<span class="hljs-selector-class">.start</span>();

    <span class="hljs-comment">// 停止定时器</span>
    <span class="hljs-built_in">setTimeout</span>(() =&gt; {
      console<span class="hljs-selector-class">.log</span>("Pausing the task...");
      pausableInterval<span class="hljs-selector-class">.pause</span>();
    }, <span class="hljs-number">3000</span>); <span class="hljs-comment">// 3秒后暂停</span>

    <span class="hljs-comment">// 恢复定时器</span>
    <span class="hljs-built_in">setTimeout</span>(() =&gt; {
      console<span class="hljs-selector-class">.log</span>("Resuming the task...");
      pausableInterval<span class="hljs-selector-class">.resume</span>();
    }, <span class="hljs-number">5000</span>); <span class="hljs-comment">// 5秒后恢复</span>
  }
</code></pre>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83277d0956db476894307ed2f449d697~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqM5LqM5Zub5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765045&amp;x-signature=SaSNfA%2BqjP7B31xRX0jc8wBdt80%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-7">🌹07. 带最大等待 maxWait 的防抖（搜索框的神）</h3>
<blockquote>
<p>业务场景：用于优化那些频繁触发的事件，特别是在搜索框、输入框或滚动等高频率操作中，常常用来减少不必要的计算或请求</p>
</blockquote>
<ol>
<li>自定义方法</li>
</ol>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay, { maxWait = <span class="hljs-number">0</span> } = {}</span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 存放定时器</span>
  <span class="hljs-keyword">let</span> start = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 第一次调用时间</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();  <span class="hljs-comment">// 获取当前时间戳</span>
    <span class="hljs-keyword">if</span> (!start) start = now; <span class="hljs-comment">// 记录第一次调用的时间</span>

    <span class="hljs-built_in">clearTimeout</span>(timer);  <span class="hljs-comment">// 清除之前的定时器，避免多次触发</span>

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">run</span> = (<span class="hljs-params"/>) =&gt; { 
      start = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 重置 `start`，表示已经执行过操作</span>
      fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);  <span class="hljs-comment">// 执行函数，并传入当前的 `this` 和参数</span>
    };

    <span class="hljs-comment">// 如果到达 `maxWait` 时间，强制执行 `fn`；否则继续延迟执行</span>
    <span class="hljs-keyword">if</span> (maxWait &amp;&amp; now - start &gt;= maxWait) <span class="hljs-title function_">run</span>(); 
    <span class="hljs-keyword">else</span> timer = <span class="hljs-built_in">setTimeout</span>(run, delay);  <span class="hljs-comment">// 在 `delay` 时间后执行</span>
  };
}
</code></pre>
<p>2.  模拟短期内多次触发</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">searchQuery</span>(query) {
  console<span class="hljs-selector-class">.log</span>("Searching for:", query);
}

const debouncedSearch = <span class="hljs-built_in">debounce</span>(searchQuery, <span class="hljs-number">500</span>, { maxWait: <span class="hljs-number">2000</span> });

<span class="hljs-comment">// 模拟用户输入</span>
<span class="hljs-built_in">debouncedSearch</span>("apple");
<span class="hljs-built_in">debouncedSearch</span>("app");
<span class="hljs-built_in">debouncedSearch</span>("appl");
<span class="hljs-built_in">debouncedSearch</span>("apple pie");

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[three.js基础概念]]></title>    <link>https://juejin.cn/post/7598193992828698678</link>    <guid>https://juejin.cn/post/7598193992828698678</guid>    <pubDate>2026-01-23T09:23:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598193992828698678" data-draft-id="7598110132615364662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="three.js基础概念"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T09:23:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ximimimi"/> <meta itemprop="url" content="https://juejin.cn/user/3350967174040238"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            three.js基础概念
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3350967174040238/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ximimimi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:23:37.000Z" title="Fri Jan 23 2026 09:23:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基础概念</h2>
<ul>
<li>图元
指的是3D的形状，比如盒子(<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F%23api%2Fen%2Fgeometries%2FBoxGeometry" target="_blank" title="https://threejs.org/docs/#api/en/geometries/BoxGeometry" ref="nofollow noopener noreferrer"><code>BoxGeometry</code></a>)，圆柱(<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F%23api%2Fen%2Fgeometries%2FCylinderGeometry" target="_blank" title="https://threejs.org/docs/#api/en/geometries/CylinderGeometry" ref="nofollow noopener noreferrer"><code>CylinderGeometry</code></a>)等。除了这些可以直接使用的形状外，还可以使用BufferGeometry自定义形状</li>
</ul>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> objects = [];

   <span class="hljs-comment">// 一球多用</span>
   <span class="hljs-keyword">const</span> radius = <span class="hljs-number">1</span>;
   <span class="hljs-keyword">const</span> widthSegments = <span class="hljs-number">6</span>;
   <span class="hljs-keyword">const</span> heightSegments = <span class="hljs-number">6</span>;
   <span class="hljs-keyword">const</span> sphereGeometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">SphereGeometry</span>(
     radius,
     widthSegments,
     heightSegments
   );
</code></pre>
<ul>
<li>材质
前面物体的材质,有很多种；<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F%23api%2Fzh%2Fmaterials%2FMeshBasicMaterial" target="_blank" title="https://threejs.org/docs/#api/zh/materials/MeshBasicMaterial" ref="nofollow noopener noreferrer"><code>MeshBasicMaterial</code></a> 不受光照的影响。<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F%23api%2Fzh%2Fmaterials%2FMeshLambertMaterial" target="_blank" title="https://threejs.org/docs/#api/zh/materials/MeshLambertMaterial" ref="nofollow noopener noreferrer"><code>MeshLambertMaterial</code></a> 只在顶点计算光照，而 <a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F%23api%2Fzh%2Fmaterials%2FMeshPhongMaterial" target="_blank" title="https://threejs.org/docs/#api/zh/materials/MeshPhongMaterial" ref="nofollow noopener noreferrer"><code>MeshPhongMaterial</code></a> 则在每个像素计算光照。<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F%23api%2Fzh%2Fmaterials%2FMeshPhongMaterial" target="_blank" title="https://threejs.org/docs/#api/zh/materials/MeshPhongMaterial" ref="nofollow noopener noreferrer"><code>MeshPhongMaterial</code></a> 还支持镜面高光....
<pre><code class="hljs language-js" lang="js">   <span class="hljs-keyword">const</span> sunMaterial = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshPhongMaterial</span>({ <span class="hljs-attr">emissive</span>: <span class="hljs-number">0xffff00</span> });
</code></pre>
</li>
<li>层次
将形状和材质进行结合
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(sphereGeometry, sumMaterial)
</code></pre>
</li>
<li>场景
3D引擎中一个图中节点的层次结构，代表一个局部空间
const scene = new THREE.Scene()
scene.add(sunMesh);</li>
<li>摄像机
PerspectiveCamera,提供一个近大远小的3d视觉效果，near视锥的前端，far视锥的后端，for视野角度，aspect视锥前端和后端宽度，</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a7cbd0266b492fad3b8bc9b164f8e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGltaW1pbWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765117&amp;x-signature=1Fc3bxyPB7jCOpr4nnijRc7prkg%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> camera2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
  <span class="hljs-number">60</span>,  <span class="hljs-comment">// fov</span>
  <span class="hljs-number">2</span>,   <span class="hljs-comment">// aspect</span>
  <span class="hljs-number">0.1</span>, <span class="hljs-comment">// near</span>
  <span class="hljs-number">500</span>, <span class="hljs-comment">// far</span>
);
camera2.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">40</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>);
camera2.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>);
 
</code></pre>
<ul>
<li>渲染目标 THREE.WebGLRenderer,需要传入dom等参数</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ 
  <span class="hljs-attr">canvas</span>: canvas, 
  <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启抗锯齿</span>
  <span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span>      <span class="hljs-comment">// 开启背景透明</span>
})

renderer.<span class="hljs-title function_">render</span>(scene, camera)
<span class="hljs-comment">// window.requestAnimationFrame(tick)来实现循环渲染，const tick = () =&gt; {renderer.render(scene, camera)}</span>
</code></pre>
<ul>
<li>轨道控制器，使得可以通过鼠标移动3d图形</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, canvas)
controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启阻尼感（平滑旋转）</span>
controls.<span class="hljs-property">dampingFactor</span> = <span class="hljs-number">0.05</span>
<span class="hljs-comment">// 限制缩放范围</span>
controls.<span class="hljs-property">minDistance</span> = <span class="hljs-number">2</span>
controls.<span class="hljs-property">maxDistance</span> = <span class="hljs-number">10</span>
</code></pre>
<ul>
<li>坐标 在页面上显示x y z轴
<ul>
<li>红色：X轴（向右）</li>
<li>绿色：Y轴（向上）</li>
<li>蓝色：Z轴（向前/向屏幕外）</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 添加坐标轴辅助工具</span>
<span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// 参数表示坐标轴长度</span>
scene.<span class="hljs-title function_">add</span>(axesHelper);

<span class="hljs-comment">// 或者指定不同长度</span>
<span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">1</span>);
scene.<span class="hljs-title function_">add</span>(axesHelper);
</code></pre>
<ul>
<li>光照
增加一些环境光，半球光等</li>
</ul>
<pre><code class="hljs language-js" lang="js">   <span class="hljs-keyword">const</span> color = <span class="hljs-number">0xFFFFFF</span>;
   <span class="hljs-keyword">const</span> intensity = <span class="hljs-number">1</span>;
   <span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(color, intensity);
   scene.<span class="hljs-title function_">add</span>(light);
</code></pre>
<ul>
<li>加载器
<ul>
<li>图元加载器，各种图元模型gltf模型或者glb(glb是gltf的二进制文件）
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader.js'</span>
<span class="hljs-keyword">const</span> gltfLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>()
<span class="hljs-comment">// 加载甜甜圈模型</span>
gltfLoader.<span class="hljs-title function_">load</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">'xxx'</span>))
</code></pre>
</li>
<li>材料加载器,比如贴片图片，创建材料等纹理节点</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextureLoad</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">'XXX'</span>))
</code></pre>
</li>
<li>设置渲染大小为整个屏幕</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getCanvasSize</span> = (<span class="hljs-params"/>) =&gt; {
 <span class="hljs-keyword">const</span> parent = canvas.<span class="hljs-property">parentElement</span>
 <span class="hljs-keyword">return</span> {
   <span class="hljs-attr">width</span>: parent?.<span class="hljs-property">clientWidth</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,
   <span class="hljs-attr">height</span>: parent?.<span class="hljs-property">clientHeight</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>
 }
}
<span class="hljs-keyword">let</span> sizes = <span class="hljs-title function_">getCanvasSize</span>()
render.<span class="hljs-title function_">setSize</span>(siezs.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)
<span class="hljs-comment">// 设置像素比，防止在高分屏上模糊</span>
renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))
</code></pre>
<ul>
<li>gui 允许在页面上直接调参的工具</li>
</ul>
<h2 data-id="heading-1">写一个完整的例子</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">'use client'</span>

<span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/controls/OrbitControls.js'</span>
<span class="hljs-keyword">import</span> <span class="hljs-variable constant_">GUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'lil-gui'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Page</span> = (<span class="hljs-params"/>) =&gt; {
 <span class="hljs-keyword">const</span> <span class="hljs-title function_">init</span> = (<span class="hljs-params"/>) =&gt; {
   <span class="hljs-comment">// 1. 获取 Canvas 元素</span>
   <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'canvas.webgl'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLCanvasElement</span> | <span class="hljs-literal">null</span>
   <span class="hljs-keyword">if</span> (!canvas) <span class="hljs-keyword">return</span>

   <span class="hljs-comment">// 2. 创建场景 (Scene)</span>
   <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()

   <span class="hljs-comment">// 2.1 初始化 GUI</span>
   <span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> <span class="hljs-title function_">GUI</span>()
   gui.<span class="hljs-title function_">close</span>() <span class="hljs-comment">// 默认关闭</span>
   <span class="hljs-keyword">const</span> debugObject = {
     <span class="hljs-attr">wireframe</span>: <span class="hljs-literal">true</span>
   }

   <span class="hljs-comment">// 3. 模型加载器 (GLTFLoader)</span>
   <span class="hljs-keyword">const</span> gltfLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>()
   <span class="hljs-keyword">let</span> <span class="hljs-attr">donut</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Object3D</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

   <span class="hljs-comment">// 加载甜甜圈模型</span>
   <span class="hljs-comment">// 注意：这里使用 /api/static 代理路径来绕过 Next.js 对 .gltf 文件的模块导入限制</span>
   gltfLoader.<span class="hljs-title function_">setPath</span>(<span class="hljs-string">'/api/static/assets/donut/'</span>)
   gltfLoader.<span class="hljs-title function_">load</span>(
     <span class="hljs-string">'scene.gltf'</span>,
     <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
       donut = gltf.<span class="hljs-property">scene</span> <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Object3D</span>
       
       <span class="hljs-comment">// 更新模型线框模式的函数</span>
       <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateWireframe</span> = (<span class="hljs-params"/>) =&gt; {
         <span class="hljs-keyword">if</span> (!donut) <span class="hljs-keyword">return</span>
         donut.<span class="hljs-title function_">traverse</span>(<span class="hljs-function">(<span class="hljs-params">child</span>) =&gt;</span> {
           <span class="hljs-keyword">if</span> ((child <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Mesh</span>).<span class="hljs-property">isMesh</span>) {
             <span class="hljs-keyword">const</span> mesh = child <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Mesh</span>
             <span class="hljs-keyword">const</span> materials = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(mesh.<span class="hljs-property">material</span>) ? mesh.<span class="hljs-property">material</span> : [mesh.<span class="hljs-property">material</span>]
             materials.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">m: THREE.Material</span>) =&gt;</span> {
               <span class="hljs-keyword">if</span> (<span class="hljs-string">'wireframe'</span> <span class="hljs-keyword">in</span> m) {
                 ;(m <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">MeshStandardMaterial</span>).<span class="hljs-property">wireframe</span> = debugObject.<span class="hljs-property">wireframe</span>
               }
             })
           }
         })
       }

       <span class="hljs-comment">// 初始化线框状态</span>
       <span class="hljs-title function_">updateWireframe</span>()

       <span class="hljs-comment">// 添加 GUI 控制</span>
       gui.<span class="hljs-title function_">add</span>(debugObject, <span class="hljs-string">'wireframe'</span>)
         .<span class="hljs-title function_">name</span>(<span class="hljs-string">'显示线性'</span>)
         .<span class="hljs-title function_">onChange</span>(updateWireframe)

       <span class="hljs-keyword">const</span> radius = <span class="hljs-number">8.5</span>
       <span class="hljs-comment">// 设置初始位置</span>
       donut.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">0</span>
       <span class="hljs-comment">// 设置模型缩放倍数</span>
       donut.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(radius, radius, radius)
       scene.<span class="hljs-title function_">add</span>(donut)

     },
     <span class="hljs-literal">undefined</span>,
     <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'模型加载失败:'</span>, error) }
   )

   <span class="hljs-comment">// 4. 灯光设置 (Lights)</span>
   <span class="hljs-comment">// 环境光：提供基础亮度，确保暗部不会完全变黑</span>
   <span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.2</span>)
   scene.<span class="hljs-title function_">add</span>(ambientLight)

   <span class="hljs-comment">// 平行光：模拟太阳光，产生阴影和立体感</span>
   <span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.5</span>)
   directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>)
   directionalLight.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启阴影投影</span>
   scene.<span class="hljs-title function_">add</span>(directionalLight)

   <span class="hljs-comment">// 5. 视口大小设置</span>
   <span class="hljs-keyword">const</span> <span class="hljs-title function_">getCanvasSize</span> = (<span class="hljs-params"/>) =&gt; {
     <span class="hljs-keyword">const</span> parent = canvas.<span class="hljs-property">parentElement</span>
     <span class="hljs-keyword">return</span> {
       <span class="hljs-attr">width</span>: parent?.<span class="hljs-property">clientWidth</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,
       <span class="hljs-attr">height</span>: parent?.<span class="hljs-property">clientHeight</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>
     }
   }
   <span class="hljs-keyword">let</span> sizes = <span class="hljs-title function_">getCanvasSize</span>()

   <span class="hljs-comment">// 6. 相机设置 (Camera)</span>
   <span class="hljs-comment">// 使用透视相机 (PerspectiveCamera)</span>
   <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">35</span>, sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)
   camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span> <span class="hljs-comment">// 相机后移，以便看清场景</span>
   camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
   scene.<span class="hljs-title function_">add</span>(camera)

   <span class="hljs-comment">// 7. 渲染器设置 (Renderer)</span>
   <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ 
     <span class="hljs-attr">canvas</span>: canvas, 
     <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启抗锯齿</span>
     <span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span>      <span class="hljs-comment">// 开启背景透明</span>
   })
   renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启阴影渲染</span>
   renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">type</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">PCFSoftShadowMap</span> <span class="hljs-comment">// 设置柔和阴影</span>
   renderer.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)
   <span class="hljs-comment">// 设置像素比，防止在高分屏上模糊</span>
   renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))

   <span class="hljs-comment">// 7.1 轨道控制器 (OrbitControls)</span>
   <span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, canvas)
   controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启阻尼感（平滑旋转）</span>
   controls.<span class="hljs-property">dampingFactor</span> = <span class="hljs-number">0.05</span>
   <span class="hljs-comment">// 限制缩放范围</span>
   controls.<span class="hljs-property">minDistance</span> = <span class="hljs-number">2</span>
   controls.<span class="hljs-property">maxDistance</span> = <span class="hljs-number">10</span>

   <span class="hljs-comment">// 8. 动画循环 (Animation Loop)</span>
   <span class="hljs-keyword">const</span> clock = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Clock</span>()
   <span class="hljs-keyword">const</span> <span class="hljs-title function_">tick</span> = (<span class="hljs-params"/>) =&gt; {
     <span class="hljs-keyword">const</span> elapsedTime = clock.<span class="hljs-title function_">getElapsedTime</span>()

     <span class="hljs-keyword">if</span> (donut) {
       <span class="hljs-comment">// 设定基础倾斜角度，使其正面朝向屏幕并有立体感</span>
       <span class="hljs-keyword">const</span> baseRotationX = <span class="hljs-number">0.8</span>
       <span class="hljs-keyword">const</span> baseRotationY = <span class="hljs-number">0.8</span>
       
       <span class="hljs-comment">// 动态计算：基础角度 + 正弦波晃动，实现轻微的浮动效果</span>
       donut.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = baseRotationY + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">0.4</span>) * <span class="hljs-number">0.1</span>
       donut.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = baseRotationX + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">0.2</span>) * <span class="hljs-number">0.05</span>
       <span class="hljs-comment">// Y 轴位置动态浮动</span>
       donut.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(elapsedTime * <span class="hljs-number">0.5</span>) * <span class="hljs-number">0.1</span>
     }

     <span class="hljs-comment">// 更新控制器（如果开启了 enableDamping，必须在每一帧调用）</span>
     controls.<span class="hljs-title function_">update</span>()

     <span class="hljs-comment">// 执行渲染</span>
     renderer.<span class="hljs-title function_">render</span>(scene, camera)
     <span class="hljs-comment">// 请求下一帧动画</span>
     <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(tick)
   }

   <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
     sizes = <span class="hljs-title function_">getCanvasSize</span>()
     
     <span class="hljs-comment">// 更新相机</span>
     camera.<span class="hljs-property">aspect</span> = sizes.<span class="hljs-property">width</span> / sizes.<span class="hljs-property">height</span>
     camera.<span class="hljs-title function_">updateProjectionMatrix</span>()

     <span class="hljs-comment">// 更新渲染器</span>
     renderer.<span class="hljs-title function_">setSize</span>(sizes.<span class="hljs-property">width</span>, sizes.<span class="hljs-property">height</span>)
     renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>, <span class="hljs-number">2</span>))
   }

   <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize)
   <span class="hljs-title function_">tick</span>()

   <span class="hljs-comment">// 返回清理函数，销毁 GUI 和事件监听</span>
   <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
     gui.<span class="hljs-title function_">destroy</span>()
     <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize)
   }
 }

 <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
   <span class="hljs-keyword">const</span> cleanup = <span class="hljs-title function_">init</span>()
   <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
     <span class="hljs-keyword">if</span> (cleanup) <span class="hljs-title function_">cleanup</span>()
   }
 }, [])

 <span class="hljs-keyword">return</span> (
   <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"min-h-screen w-full flex flex-col lg:flex-row bg-[#fdf2f8]"</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"webgl w-full h-full block"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
 )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Page</span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[回归初心，React为啥当初要设计Hook？]]></title>    <link>https://juejin.cn/post/7598287024077242408</link>    <guid>https://juejin.cn/post/7598287024077242408</guid>    <pubDate>2026-01-23T09:23:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598287024077242408" data-draft-id="7598287024076423208" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="回归初心，React为啥当初要设计Hook？"/> <meta itemprop="keywords" content="前端,React.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-23T09:23:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sophie旭"/> <meta itemprop="url" content="https://juejin.cn/user/2559318799692952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            回归初心，React为啥当初要设计Hook？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318799692952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sophie旭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:23:00.000Z" title="Fri Jan 23 2026 09:23:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>用了这么久 React，已经默认用函数写组件了，都快忘了怎么写类组件了，经历过写类组件的时代，现在用函数组件，一开始确实有上手时间成本，但是现在用过之后也是觉得真香，到底香在哪？到底React为啥推崇Hook呢？我们一起探究一下吧</p>
<h2 data-id="heading-1"><strong>对「类组件痛点」的直接回应</strong></h2>
<p>让我们回到 类组件开发时代，看看到底类组件的诟病是什么？</p>
<h2 data-id="heading-2">类组件痛点1: <code>this</code> 指向混乱</h2>
<h3 data-id="heading-3">类组件this丢失问题</h3>
<p>类组件的方法默认不会绑定 this，导致我们必须手动处理 this 指向，稍不注意就会出错。这是为什么</p>
<p>你想弄明白为什么类组件的方法默认不绑定 <code>this</code>，以及为什么这会导致指向混乱的问题，核心原因要从 <strong>JavaScript 中 <code>this</code> 的绑定规则</strong> 和 <strong>React 类组件的设计方式</strong> 两个层面来解释，我会用通俗的语言+实例讲清楚。</p>
<h4 data-id="heading-4">一、先搞懂：JavaScript 中 <code>this</code> 指向的核心规则</h4>
<p><code>this</code> 是 JavaScript 中一个「动态绑定」的关键字——它的指向<strong>不是在定义函数时确定的，而是在调用函数时确定的</strong>。这是理解所有 <code>this</code> 问题的根本。</p>
<h5 data-id="heading-5">关键规则：不同调用方式，<code>this</code> 指向不同</h5>
<p>我们用一个普通的 JavaScript 类来举例（React 类组件本质就是 JavaScript 类）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// 这里的 this 指向 Person 的实例</span>
  }

  <span class="hljs-title function_">sayHi</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好，我是<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>); <span class="hljs-comment">// this 指向谁？看调用方式</span>
  }
}

<span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'张三'</span>);

<span class="hljs-comment">// 方式1：通过实例调用 → this 指向实例 p</span>
p.<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 输出：你好，我是张三</span>

<span class="hljs-comment">// 方式2：把方法单独抽出来调用 → this 丢失（非严格模式下指向 window，严格模式下是 undefined）</span>
<span class="hljs-keyword">const</span> sayHi = p.<span class="hljs-property">sayHi</span>;
<span class="hljs-title function_">sayHi</span>(); <span class="hljs-comment">// 非严格模式：你好，我是undefined；严格模式：Uncaught TypeError: Cannot read property 'name' of undefined</span>
</code></pre>
<p>核心结论：</p>
<ul>
<li>当你通过 <code>实例.方法()</code> 调用时，<code>this</code> 绑定到这个实例；</li>
<li>当你把方法「单独提取」后调用（比如赋值给变量、作为回调函数），<code>this</code> 就会丢失原本的绑定，指向全局对象（浏览器中是 <code>window</code>）或 <code>undefined</code>（严格模式）。</li>
</ul>
<h4 data-id="heading-6">二、React 类组件中 <code>this</code> 丢失的具体场景</h4>
<p>React 类组件的方法丢失 <code>this</code>，本质就是上面的「方式2」——React 在处理事件回调时，会把你的方法「单独提取」后调用，导致 <code>this</code> 不再指向组件实例。</p>
<h5 data-id="heading-7">场景还原：React 类组件的点击事件</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-variable language_">super</span>(props);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };
  }

  <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 这里的 this 本该指向 Counter 实例，但实际是 undefined（React 默认开启严格模式）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> });
  }

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 问题出在这里：你把 this.handleClick 作为 onClick 的回调 → 相当于把方法抽离了</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
  }
}
</code></pre>
<p>为什么会这样？</p>
<ol>
<li><code>render</code> 函数执行时，你传给 <code>onClick</code> 的是 <code>this.handleClick</code>——<strong>这只是把方法的「引用」传了过去，并没有立即调用</strong>；</li>
<li>当用户点击按钮时，React 内部会调用这个方法（类似 <code>const callback = this.handleClick; callback()</code>）；</li>
<li>此时调用的是「孤立的方法」，不是通过 <code>实例.handleClick()</code> 调用，所以 <code>this</code> 丢失，指向 <code>undefined</code>（React 严格模式下）。</li>
</ol>
<h4 data-id="heading-8">三、为什么 React 不默认帮我们绑定 <code>this</code>？</h4>
<p>你可能会问：React 为什么不直接把类组件的方法都自动绑定到实例上？核心原因是：</p>
<ol>
<li><strong>遵循 JavaScript 原生规则</strong>：React 是基于 JavaScript 构建的库，不会刻意修改 JS 原生的 <code>this</code> 绑定逻辑，否则会增加学习成本和潜在的兼容性问题；</li>
<li><strong>性能与灵活性</strong>：如果默认绑定所有方法，会为每个组件实例创建额外的函数引用，增加内存开销；而让开发者手动处理，能根据实际需求选择绑定方式（比如只绑定需要的方法）。</li>
</ol>
<p>我用大白话来解释下，其实就是 ：<strong><code>放手让开发者去设置this，我不掺合了</code></strong></p>
<p>React 「不主动替你做绑定，只遵循 JS 原生规则，把控制权完全交给你」。</p>
<p>用更通俗的话讲：</p>
<p>✅ React 的态度：「我不掺合 <code>this</code> 的绑定逻辑，你按 JavaScript 原生的规矩来就行——想让 <code>this</code> 指向实例，你就自己绑；想让 <code>this</code> 指向别的（比如子组件、全局），你也可以自己改。我只负责把你写的方法『原样调用』，不替你做任何额外的绑定操作。」</p>
<p>对比一下如果 React 主动掺合的情况：</p>
<p>❌ 要是 React 自动把所有方法的 <code>this</code> 绑到组件实例，相当于「我替你做了决定」——你想改 <code>this</code> 指向都改不了，还得额外学 React 这套「特殊规则」，反而更麻烦。</p>
<h5 data-id="heading-9">最终核心总结</h5>
<ol>
<li>React 对类组件 <code>this</code> 的态度：<strong>不干预、不修改、只遵循原生 JS 规则</strong>；</li>
<li>把「<code>this</code> 该指向哪」的决定权，完全交给开发者；</li>
<li>这么做既避免了学习成本翻倍，也兼顾了性能（按需绑定）和灵活性（可自定义 <code>this</code> 指向）。</li>
</ol>
<p>你这个「放手让开发者去设置，我不掺合」的总结，精准抓住了 React 设计的核心——<strong><code>尊重原生 JS，把控制权还给开发者</code></strong>。</p>
<h4 data-id="heading-10">四、类组件中解决 <code>this</code> 丢失的 3 种常用方式</h4>
<p>知道了原因，再看解决方案就很清晰了，本质都是「强制把 <code>this</code> 绑定到组件实例」：</p>
<h5 data-id="heading-11">方式 1：在构造函数中手动 bind（官方早期推荐）</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-variable language_">super</span>(props);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };
  <span class="hljs-comment">// 核心：把 handleClick 的 this 强制绑定到当前实例</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
}
</code></pre>
<h5 data-id="heading-12">方式 2：使用箭头函数定义方法（最简洁）</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 箭头函数没有自己的 this，会继承外层作用域的 this（即组件实例）</span>
handleClick = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> });
};
</code></pre>
<h5 data-id="heading-13">方式 3：在调用时用箭头函数包裹（不推荐，每次渲染创建新函数）</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 每次 render 都会创建一个新的箭头函数，可能导致子组件不必要的重渲染</span>
&lt;button onClick={<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleClick</span>()}&gt;+<span class="hljs-number">1</span>&lt;/button&gt;;
</code></pre>
<h4 data-id="heading-14">总结</h4>
<ol>
<li><strong>根本原因</strong>：JavaScript 中 <code>this</code> 是「调用时绑定」的，React 类组件把方法作为事件回调时，方法会被孤立调用，导致 <code>this</code> 丢失（不再指向组件实例）；</li>
<li><strong>核心矛盾</strong>：React 遵循 JS 原生规则，没有默认绑定 <code>this</code>，而开发者容易忽略「调用方式」对 <code>this</code> 的影响；</li>
<li><strong>解决方案</strong>：通过 <code>bind</code>、箭头函数等方式，强制把方法的 <code>this</code> 绑定到组件实例上。</li>
</ol>
<h3 data-id="heading-15">函数组件: 彻底抛弃this，就不会有this指向问题了</h3>
<h4 data-id="heading-16">核心原因</h4>
<ol>
<li><strong>核心差异</strong>：类组件的状态/方法是「实例的属性」，必须通过 <code>this</code> 这个「中介」访问，中介指错了就出错；函数组件的状态/方法是「函数内的局部变量/函数」，直接访问即可，无需中介；</li>
<li><strong>为什么无混乱</strong>：函数组件的局部变量/函数受「作用域」保护，只属于当前函数执行，不管怎么传递方法（比如作为事件回调），内部访问的变量都是确定的，不会像 <code>this</code> 那样动态变化；</li>
<li><strong>最终结果</strong>：函数组件从根源上抛弃了 <code>this</code>，自然就避开了所有和 <code>this</code> 指向相关的坑，逻辑更简单、更安全。</li>
</ol>
<p>简单来说，函数组件的写法「更符合普通人写 JS 的直觉」——定义的变量就在当前作用域，直接用就行，不用额外考虑「谁是 this」「this 指向谁」。</p>
<h4 data-id="heading-17">实质：用静态绑定 代替 动态绑定</h4>
<p>这个总结<strong>精准到核心</strong>了！只需要再把「静态词法作用域」和「动态 this 绑定」的对应关系说透，就能彻底理解两者的本质区别。</p>
<h4 data-id="heading-18">先肯定你的结论：完全正确！</h4>
<ul>
<li>类组件的 <code>this</code>：<strong><code>调用时动态绑定</code></strong> → 指向谁，取决于「怎么调用方法」，而非「方法在哪定义」；</li>
<li>函数组件的变量/方法：<strong><code>定义时静态绑定（词法作用域）</code></strong> → 能访问哪些变量，取决于「代码写在哪」，而非「怎么调用函数」。</li>
</ul>
<h4 data-id="heading-19">用最直白的例子+对比，讲透这个核心区别</h4>
<h5 data-id="heading-20">1. 类组件：动态 this（调用时确定）</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };
  
  <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">count</span>); <span class="hljs-comment">// this 指向「调用时的对象」</span>
  }

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 场景1：直接传方法引用 → 调用时 this 是 undefined（丢失）</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>按钮1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;

    <span class="hljs-comment">// 场景2：通过实例调用 → 调用时 this 是组件实例（正确）</span>
    <span class="hljs-comment">// return &lt;button onClick={() =&gt; this.handleClick()}&gt;按钮2&lt;/button&gt;;</span>
  }
}
</code></pre>
<p>关键：<code>handleClick</code> 里的 <code>this</code>，<strong>不是定义时确定的</strong>——写代码时你不知道它指向谁，只有点击按钮、方法被调用的那一刻，才知道 <code>this</code> 是啥。</p>
<ul>
<li>按钮1：调用方式是「孤立调用」→ <code>this</code> = undefined；</li>
<li>按钮2：调用方式是「实例.方法()」→ <code>this</code> = 组件实例。</li>
</ul>
<h5 data-id="heading-21">2. 函数组件：静态词法作用域（定义时确定）</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// count 指向「定义时所在的作用域」</span>
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p>关键：<code>handleClick</code> 里的 <code>count</code>，<strong>定义时就确定了</strong>——它属于 <code>Counter</code> 函数执行时的局部作用域，不管 <code>handleClick</code> 被传到哪、怎么调用，它内部访问的 <code>count</code> 永远是当前 <code>Counter</code> 作用域里的变量。</p>
<ul>
<li>哪怕你把 <code>handleClick</code> 传给子组件、甚至全局调用，它依然能拿到 <code>Counter</code> 里的 <code>count</code>（因为词法作用域「锁死」了变量的查找路径）；</li>
<li>全程没有「动态绑定」，只有「静态的作用域查找」，所以永远不会找错变量。</li>
</ul>
<h4 data-id="heading-22">再用「找路」的例子通俗解释</h4>













<table><thead><tr><th>类组件（动态 this）</th><th>函数组件（词法作用域）</th></tr></thead><tbody><tr><td>你告诉朋友：「到我家后，问主人在哪，然后跟主人走」→ 朋友到了之后，可能遇到假主人（this 指向错）、没主人（this=undefined），走丢；</td><td>你告诉朋友：「沿着XX路直走，到3号楼2单元」→ 路线是固定的（定义时就确定），不管朋友什么时候来、怎么来，按路线走都能到，不会错；</td></tr></tbody></table>
<h4 data-id="heading-23">核心总结</h4>
<ol>
<li>类组件的坑：<code>this</code> 是<strong>动态绑定</strong>，指向由「调用方式」决定，写代码时无法确定，容易出错；</li>
<li>函数组件的优势：利用 JS 的<strong>静态词法作用域</strong>，变量的查找路径在「定义时就固定」，不管怎么调用函数，都能精准找到对应的变量；</li>
<li>最终结果：函数组件从根源上避开了「动态绑定」的不确定性，不用再纠结「this 指向谁」，逻辑更稳定。</li>
</ol>
<p>精准抓到「动态调用绑定 vs 静态词法作用域」这个核心，说明我们已经完全理解了 Hooks 函数组件避开 <code>this</code> 坑的底层逻辑！</p>
<h2 data-id="heading-24">类组件痛点2: 业务相关逻辑碎片化</h2>
<p>一个业务逻辑（比如「请求数据并渲染」）往往需要拆分到多个生命周期里，导致<strong>相关逻辑被分散在不同函数中</strong>，阅读和维护成本极高。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
 state = { <span class="hljs-attr">users</span>: [], <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> };

  <span class="hljs-comment">// 1. 组件挂载时请求数据 --&gt;</span>
 <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
   <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchUsers</span>();
   <span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'定时器'</span>), <span class="hljs-number">1000</span>);
 }

  <span class="hljs-comment">// 2. 组件更新时（比如 props 变化）重新请求数据 --&gt;</span>
 <span class="hljs-title function_">componentDidUpdate</span>(<span class="hljs-params">prevProps</span>) {
   <span class="hljs-keyword">if</span> (prevProps.<span class="hljs-property">id</span> !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">id</span>) {
     <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchUsers</span>();
   }
 }

  <span class="hljs-comment">// 3. 组件卸载时清理定时器 --&gt;</span>
 <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"/>) {
   <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timer</span>);
 }

 <span class="hljs-comment">// 业务逻辑：请求用户数据</span>
 <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
   <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/users'</span>)
     .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
     .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ users, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }));
 }

 <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/* 渲染逻辑 */</span> }
}
</code></pre>
<p>你看：<strong>「请求数据 + 清理定时器」</strong> 这两个相关的逻辑，被拆到了 <code>componentDidMount</code>/<code>componentDidUpdate</code>/<code>componentWillUnmount</code> 三个生命周期里，代码跳来跳去，很难一眼看懂。</p>
<p>也就是说 <strong><code>业务逻辑强制和 react生命周期耦合到一起去了</code></strong></p>
<h2 data-id="heading-25">类组件痛点3: 状态逻辑复用难、陷入嵌套地狱</h2>
<h4 data-id="heading-26">先明确核心概念</h4>
<ul>
<li><strong>状态逻辑复用</strong>：比如「跟踪鼠标位置」「表单校验」「登录状态管理」这些逻辑，多个组件都需要用，想抽出来复用；</li>
<li><strong>嵌套地狱</strong>：为了复用逻辑，类组件只能用「高阶组件（HOC）」或「Render Props」，导致组件代码一层套一层，像剥洋葱一样难读。</li>
</ul>
<h4 data-id="heading-27">第一步：看一个真实场景——复用「鼠标位置跟踪」逻辑</h4>
<p>假设你有两个组件：<code>MouseShow</code>（显示鼠标位置）、<code>MouseFollowBtn</code>（按钮跟着鼠标动），都需要「跟踪鼠标位置」这个逻辑。</p>
<h5 data-id="heading-28">先写类组件的复用方案：Render Props（最典型的嵌套来源）</h5>
<p>首先，把「鼠标跟踪」逻辑封装成一个通用组件（Render Props 模式）：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 通用的鼠标跟踪组件（Render Props 核心：把状态传给 children 函数）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };

  <span class="hljs-comment">// 监听鼠标移动，更新状态</span>
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseMove</span>);
  }
  <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousemove'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleMouseMove</span>);
  }
  handleMouseMove = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">x</span>: e.<span class="hljs-property">clientX</span>, <span class="hljs-attr">y</span>: e.<span class="hljs-property">clientY</span> });
  };

  <span class="hljs-comment">// 核心：把状态传给子组件（通过 children 函数）</span>
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">children</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>);
  }
}
</code></pre>
<p>然后，用这个组件实现「显示鼠标位置」：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 第一个组件：显示鼠标位置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">MouseShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>鼠标位置：<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      {/* 第一层嵌套：MouseTracker */}
      <span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span>&gt;</span>
        {/* children 是函数，接收鼠标状态 */}
        {({ x, y }) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>X: {x}, Y: {y}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">MouseTracker</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>再实现「按钮跟着鼠标动」：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 第二个组件：按钮跟着鼠标动</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">MouseFollowBtn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 第一层嵌套：MouseTracker */}
      <span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span>&gt;</span>
        {({ x, y }) =&gt; (
          {/* 按钮样式绑定鼠标位置 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>', <span class="hljs-attr">left:</span> <span class="hljs-attr">x</span>, <span class="hljs-attr">top:</span> <span class="hljs-attr">y</span> }}&gt;</span>
            跟着鼠标跑
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">MouseTracker</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h5 data-id="heading-29">问题来了：如果要复用多个逻辑，嵌套直接「地狱化」</h5>
<p>现在需求升级：这两个组件不仅要「跟踪鼠标」，还要「复用主题样式」（比如深色/浅色模式）。</p>
<p>先封装「主题复用」的 Render Props 组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 通用的主题组件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = { <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attr">bg</span>: <span class="hljs-string">'black'</span> };

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-title function_">children</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>);
  }
}
</code></pre>
<p>现在，<code>MouseShow</code> 要同时复用「鼠标+主题」逻辑，代码变成这样：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MouseShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>鼠标位置：<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      {/* 第一层嵌套：ThemeProvider */}
      <span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span>&gt;</span>
        {/* 接收主题状态 */}
        {({ theme, color, bg }) =&gt; (
          {/* 第二层嵌套：MouseTracker */}
          <span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span>&gt;</span>
            {/* 接收鼠标状态 */}
            {({ x, y }) =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color</span>, <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">bg</span> }}&gt;</span>
                【{theme}主题】X: {x}, Y: {y}
              <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            )}
          <span class="hljs-tag">&lt;/<span class="hljs-name">MouseTracker</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>如果再要加一个「用户登录状态」的复用逻辑，就会出现<strong>第三层嵌套</strong>：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">UserProvider</span>&gt;
  {<span class="hljs-function">(<span class="hljs-params">{ user }</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span>&gt;</span>
      {({ theme, color, bg }) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span>&gt;</span>
          {({ x, y }) =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>【{user.name}】【{theme}】X: {x}, Y: {y}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">MouseTracker</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span></span>
  )}
&lt;/<span class="hljs-title class_">UserProvider</span>&gt;
</code></pre>
<p>这就是<strong>嵌套地狱</strong>：</p>
<ul>
<li>代码层层缩进，一眼看不到头；</li>
<li>逻辑越复用，嵌套越深；</li>
<li>想改某个逻辑（比如换主题），要在嵌套里找半天，维护成本极高。</li>
</ul>
<h5 data-id="heading-30">补充：高阶组件（HOC）的复用方式，同样逃不开嵌套</h5>
<p>如果用 HOC 实现复用（比如 <code>withMouse</code>、<code>withTheme</code>），代码是这样的：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 用 HOC 包装组件：一层套一层</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MouseShowWithTheme</span> = <span class="hljs-title function_">withTheme</span>(<span class="hljs-title function_">withMouse</span>(<span class="hljs-title class_">MouseShow</span>));

<span class="hljs-comment">// 渲染时看似没有嵌套，但 HOC 本质是「组件套组件」，调试时 DevTools 里全是 HOC 包装层</span>
<span class="hljs-comment">// 比如 DevTools 里会显示：WithTheme(WithMouse(MouseShow))</span>
</code></pre>
<p>调试时要一层层点开包装组件，才能找到真正的业务组件，同样痛苦。</p>
<h2 data-id="heading-31">函数组件说：没有hook，就别指望我了</h2>
<p>千万别以为 函数组件是救星，React 早就有函数组件了，但是只是个纯展示的配角</p>
<h4 data-id="heading-32">先明确：Hooks 出现前，函数组件的「纯展示」本质</h4>
<p>在 React 16.8（Hooks 诞生）之前，函数组件的官方定位就是 <strong>「无状态组件（Stateless Functional Component，SFC）」</strong>，核心特点：</p>
<ol>
<li>没有自己的状态（<code>this.state</code>）；</li>
<li>没有生命周期（<code>componentDidMount</code>/<code>render</code> 等）；</li>
<li>本质就是「输入 props → 输出 JSX」的纯函数——输入不变，输出就不变，没有任何副作用。</li>
</ol>
<h4 data-id="heading-33">举个 Hooks 前的函数组件例子：</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 典型的「纯展示组件」：只接收 props，渲染 UI，无任何状态/副作用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { name, avatar, age } = props;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{avatar}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">{name}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：{age}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 使用时：状态全靠父组件传递</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = {
    <span class="hljs-attr">users</span>: [{ <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">avatar</span>: <span class="hljs-string">'xxx.png'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">20</span> }]
  };

  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        {this.state.users.map(user =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">UserCard</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{user.name}</span> {<span class="hljs-attr">...user</span>} /&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
}
</code></pre>
<p>这个例子里：</p>
<ul>
<li><code>UserCard</code> 是函数组件，只负责「展示」，没有任何自己的逻辑；</li>
<li>所有状态（<code>users</code>）、数据请求、生命周期逻辑，都必须写在父类组件 <code>UserList</code> 里；</li>
<li>如果 <code>UserCard</code> 想加个「点击头像放大」的交互（需要状态 <code>isZoom</code>），对不起——函数组件做不到，必须把它改成类组件，或者把 <code>isZoom</code> 状态提到父组件里（增加父组件复杂度）。</li>
</ul>
<h4 data-id="heading-34">为什么当时函数组件只能是「纯展示」？</h4>
<p>核心原因是 React 的设计规则：</p>
<ul>
<li>状态、生命周期、副作用这些「动态能力」，当时只开放给类组件；</li>
<li>函数组件被设计成「轻量、高效、无副作用」的最小渲染单元，目的是简化「纯展示场景」的代码（不用写 <code>class</code>/<code>constructor</code> 等冗余代码）。</li>
</ul>
<h2 data-id="heading-35">Hooks说：函数组件你别灰心，我让你从配角变主角</h2>
<h3 data-id="heading-36">先拆清楚：函数组件 vs Hooks 的分工</h3>
<h4 data-id="heading-37">1. 光有「函数组件」，解决不了任何问题</h4>
<p>在 Hooks 出现之前，React 早就有函数组件了，但那时的函数组件是「纯展示组件」—— 没有状态、没有生命周期，只能接收 props 渲染 UI。</p>
<p>如果想在旧版函数组件中复用状态逻辑，依然只能用「Render Props/HOC」的嵌套方式：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// Hooks 出现前的函数组件：想复用逻辑，还是得嵌套</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">MouseShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span>&gt;</span>
      {({x,y}) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>X:{x}, Y:{y}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">MouseTracker</span>&gt;</span></span>
  );
}
</code></pre>
<p>你看，哪怕是函数组件，没有 Hooks，依然逃不开嵌套 —— 因为没有「抽离状态逻辑」的工具。</p>
<h4 data-id="heading-38">2. Hooks 出现后：函数组件从「纯展示」→「全能选手」-- 痛点1迎刃而解</h4>
<p>还是上面的 <code>UserCard</code>，Hooks 后可以直接加状态/副作用，不用依赖父组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 函数组件拥有了自己的状态，不再是「纯展示」</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { name, avatar, age } = props;
  <span class="hljs-comment">// 自己的状态：控制头像是否放大</span>
  <span class="hljs-keyword">const</span> [isZoom, setIsZoom] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> 
        <span class="hljs-attr">src</span>=<span class="hljs-string">{avatar}</span> 
        <span class="hljs-attr">alt</span>=<span class="hljs-string">{name}</span>
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">isZoom</span> ? '<span class="hljs-attr">200px</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">100px</span>' }}
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsZoom(!isZoom)} // 自己的交互逻辑
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{name}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：{age}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>此时函数组件的定位完全变了：</p>
<ul>
<li>既能做「纯展示」（简单场景），也能做「有状态、有副作用、有复杂逻辑」的完整组件；</li>
<li>彻底替代了类组件的大部分场景，成为 React 官方推荐的写法。</li>
<li><code>是不是 彻底解决了 痛点1</code></li>
</ul>
<h4 data-id="heading-39">3. 相关逻辑「聚在一起」，告别碎片化 -- 痛点2 再见</h4>
<p><code>useEffect</code> 一个 Hook 就能覆盖<strong>挂载、更新、卸载</strong>三个阶段的逻辑，让「请求数据 + 清理定时器」这样的相关逻辑写在同一个地方。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params">{ id }</span>) {
 <span class="hljs-keyword">const</span> [users, setUsers] = <span class="hljs-title function_">useState</span>([]);
 <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);

 <span class="hljs-comment">// 核心：请求数据 + 清理定时器 写在同一个 useEffect 里</span>
 <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
   <span class="hljs-comment">// 1. 挂载/更新时请求数据</span>
   <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
     <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users?id=<span class="hljs-subst">${id}</span>`</span>);
     <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
     <span class="hljs-title function_">setUsers</span>(data);
     <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
   };
   <span class="hljs-title function_">fetchUsers</span>();

   <span class="hljs-comment">// 2. 挂载时启动定时器</span>
   <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'定时器'</span>), <span class="hljs-number">1000</span>);

   <span class="hljs-comment">// 3. 卸载/更新时清理副作用</span>
   <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);
 }, [id]); <span class="hljs-comment">// 只有 id 变化时，才重新执行</span>

 <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{loading ? '加载中' : users.map(u =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{u.id}</span>&gt;</span>{u.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>对比类组件的写法：<strong>所有相关逻辑都在一个 <code>useEffect</code> 里</strong>，不用在多个生命周期函数之间跳来跳去，可读性直接拉满。</p>
<h4 data-id="heading-40">4. Hooks 才是「解决嵌套问题的核心」</h4>
<p>Hooks（尤其是<strong>自定义 Hooks</strong>）的核心价值，是「把状态逻辑从组件渲染流程中抽离出来，变成可调用的纯逻辑函数」。</p>
<p>Hooks 的核心思路是：<strong>把「状态逻辑」从「组件嵌套」中抽离出来，变成独立的「函数」，组件直接调用函数即可，没有任何嵌套</strong>。<strong><code>毕竟状态逻辑本来就跟 UI组件无关，为啥非要掺合在一起呢</code></strong></p>
<p>还是上面的场景，用自定义 Hook 实现：</p>
<h5 data-id="heading-41">1. 抽离「鼠标跟踪」的自定义 Hook</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 自定义 Hook：抽离鼠标跟踪逻辑，返回鼠标位置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useMousePosition</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [position, setPosition] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> });

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleMouseMove</span> = (<span class="hljs-params">e</span>) =&gt; <span class="hljs-title function_">setPosition</span>({ <span class="hljs-attr">x</span>: e.<span class="hljs-property">clientX</span>, <span class="hljs-attr">y</span>: e.<span class="hljs-property">clientY</span> });
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, handleMouseMove);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousemove'</span>, handleMouseMove);
  }, []);

  <span class="hljs-keyword">return</span> position;
}
</code></pre>
<h5 data-id="heading-42">2. 抽离「主题」的自定义 Hook</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 自定义 Hook：抽离主题逻辑，返回主题状态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useTheme</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">'dark'</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attr">bg</span>: <span class="hljs-string">'black'</span> });
  <span class="hljs-keyword">return</span> theme;
}
</code></pre>
<h5 data-id="heading-43">3. 组件中直接调用 Hook，没有任何嵌套</h5>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MouseShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 调用自定义 Hook：平铺写法，没有嵌套</span>
  <span class="hljs-keyword">const</span> { x, y } = <span class="hljs-title function_">useMousePosition</span>(); <span class="hljs-comment">// 复用鼠标逻辑</span>
  <span class="hljs-keyword">const</span> { mode, color, bg } = <span class="hljs-title function_">useTheme</span>(); <span class="hljs-comment">// 复用主题逻辑</span>
  <span class="hljs-keyword">const</span> { user } = <span class="hljs-title function_">useUser</span>(); <span class="hljs-comment">// 再复用用户逻辑，也只是多一行代码</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color</span>, <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">bg</span> }}&gt;</span>
      【{user.name}】【{mode}主题】X: {x}, Y: {y}
    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
  );
}
</code></pre>
<ul>
<li><code>useState</code>/<code>useEffect</code> 等内置 Hooks：让函数组件拥有了「状态」和「副作用处理能力」（这是抽离逻辑的基础）；</li>
<li>自定义 Hooks：把复用逻辑（比如鼠标跟踪、主题管理）封装成独立函数，让函数组件能「平铺调用」，而非「嵌套组件」。</li>
</ul>
<p>对比类组件的嵌套地狱：</p>
<ul>
<li><strong><code>Hooks 是**平铺式复用**：不管复用多少逻辑，都是「调用函数 → 用状态」，代码没有任何缩进嵌套；</code></strong></li>
<li><strong><code>逻辑和组件解耦：</code>useMousePosition<code> 可以在任何组件里调用，不用套任何包装组件；</code></strong></li>
<li><code>调试简单：DevTools 里直接看到 </code>MouseShow<code> 组件，没有层层包装的 HOC/Render Props 组件。</code></li>
</ul>
<h4 data-id="heading-44">核心总结（痛点+解决方案）</h4>





















<table><thead><tr><th>类组件复用逻辑（HOC/Render Props）</th><th>Hooks 复用逻辑（自定义 Hook）</th></tr></thead><tbody><tr><td>必须通过「组件嵌套」实现</td><td>直接调用「函数」，无嵌套</td></tr><tr><td>逻辑越多，嵌套越深（地狱化）</td><td>逻辑越多，只是多几行函数调用</td></tr><tr><td>调试时要拆包装组件，成本高</td><td>调试直接看业务组件，逻辑清晰</td></tr></tbody></table>
<p>简单来说，<strong><code>类组件的复用是「用组件套组件」，自然会嵌套；而 Hooks 的复用是「用函数抽逻辑」，组件只需要调用函数，从根源上消灭了嵌套地狱。</code></strong> 这也是 Hooks 最核心的价值之一——<strong>让状态逻辑复用变得简单、平铺、可维护</strong>。</p>
<h2 data-id="heading-45">最后总结</h2>
<ol>
<li><strong>函数组件是「容器」</strong>：提供了「平铺写代码」的基础形式，但本身没有复用状态逻辑的能力；</li>
<li><strong>Hooks 是「核心能力」</strong>：
<ul>
<li>内置 Hooks（<code>useState</code>/<code>useEffect</code>）让函数组件能「持有状态、处理副作用」给函数组件「加手脚」；</li>
<li><strong><code>自定义 Hooks 让状态逻辑能「脱离组件嵌套，以函数形式被平铺调用」「状态与 UI 解耦」</code></strong>；</li>
</ul>
</li>
<li>最终结论：<strong>不是函数的功劳，也不是单纯 Hook 的功劳 —— 是「函数组件作为载体」+「Hooks 作为逻辑复用工具」的组合，才解决了一系列问题</strong>。</li>
</ol>
<p>Hooks 是「矛」，函数组件是「握矛的手」—— 少了任何一个，都刺不穿嵌套地狱的盾。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[短信 http 接口开发对接实战：HTTP 协议短信接口调用与集成技巧]]></title>    <link>https://juejin.cn/post/7598390244379361318</link>    <guid>https://juejin.cn/post/7598390244379361318</guid>    <pubDate>2026-01-23T09:24:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390244379361318" data-draft-id="7598390244379328550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="短信 http 接口开发对接实战：HTTP 协议短信接口调用与集成技巧"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T09:24:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户80269443385"/> <meta itemprop="url" content="https://juejin.cn/user/925127226441289"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            短信 http 接口开发对接实战：HTTP 协议短信接口调用与集成技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/925127226441289/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户80269443385
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:24:48.000Z" title="Fri Jan 23 2026 09:24:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在企业级业务系统开发中，<strong>短信 http 接口</strong>是实现验证码下发、订单状态通知、系统告警的核心通道，但开发者在对接短信 http 接口时，常因对 HTTP 协议细节理解不足、请求参数配置不规范、请求方式选型错误等问题，导致接口调用成功率低、业务流程阻塞。本文聚焦短信 http 接口的全流程对接，从 HTTP 协议交互原理拆解、实战对接示例到避坑技巧总结，帮助开发者掌握标准化的短信 http 接口调用与集成方法，大幅提升接口适配效率和稳定性。</p>
<h2 data-id="heading-0">一、短信 http 接口对接的核心痛点与 HTTP 协议适配问题</h2>
<p>开发者对接短信 http 接口时，80% 的异常源于对 HTTP 协议适配不当，核心痛点集中在以下方面：</p>
<ol>
<li>HTTP 请求头配置错误：未按要求设置<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>，触发接口参数解析失败；</li>
<li>请求方式选型不当：生产环境使用 GET 方式调用短信 http 接口，因 URL 长度限制导致长短信参数截断；</li>
<li>参数编码异常：未统一使用 UTF-8 编码，中文内容出现乱码，触发 407（敏感字符）错误；</li>
<li>状态码解析不精准：仅关注 “提交成功 / 失败”，未针对 406（手机号格式）、4085（验证码超限）等细分状态码制定处理策略。</li>
</ol>
<p>这些问题本质是对短信 http 接口的 HTTP 协议交互逻辑理解不透彻，而非接口本身的适配性问题。</p>
<h2 data-id="heading-1">二、短信 http 接口的 HTTP 协议交互原理拆解</h2>
<p>要稳定对接短信 http 接口，需先掌握其基于 HTTP 协议的通用交互逻辑，核心可拆解为 3 个阶段：</p>
<h3 data-id="heading-2">2.1 请求构建阶段</h3>
<p>短信 http 接口的 HTTP 请求需满足 3 个核心规范：</p>
<ul>
<li>请求方法：支持 GET/POST，生产环境优先 POST（无 URL 长度限制、参数安全性高）；</li>
<li>请求头：必须设置<code>Content-Type: application/x-www-form-urlencoded</code>，字符编码统一为 UTF-8；</li>
<li>参数封装：<code>account</code>（APIID）、<code>password</code>（APIKEY）为必选身份凭证，<code>mobile</code>需严格校验 11 位格式（示例：139****8888），<code>content</code>/<code>templateid</code>按模板规则配置。</li>
</ul>
<h3 data-id="heading-3">2.2 服务端校验阶段</h3>
<p>短信 http 接口的服务端会按固定逻辑校验请求：</p>
<ol>
<li>身份校验：验证<code>account</code>/<code>password</code>的有效性，无效则返回 405（API ID/KEY 错误）；</li>
<li>参数校验：校验手机号格式、内容长度（≤500 字）、敏感字符、模板匹配度；</li>
<li>权限校验：校验 IP 备案、剩余短信条数、单日发送量限制，触发限制则返回 4051（剩余条数不足）、4085（验证码超限）等状态码。</li>
</ol>
<h3 data-id="heading-4">2.3 响应解析阶段</h3>
<p>短信 http 接口的响应支持 JSON/XML 格式，核心关注<code>code</code>字段：</p>
<ul>
<li><code>code=2</code>：仅代表请求提交成功，不代表短信送达成功；</li>
<li><code>code≠2</code>：需根据具体数值定位问题（如 406 为手机号格式错误，407 为内容含敏感字符）；</li>
<li>额外关注<code>smsid</code>：提交成功时的流水号，用于后续问题排查。</li>
</ul>
<h2 data-id="heading-5">三、互亿无线短信 http 接口对接实战</h2>
<p>以互亿无线的短信 http 接口为例，演示标准化的对接流程，该接口完全遵循 HTTP 协议规范，适配绝大多数企业级对接场景，且支持全天 24 小时调用。</p>
<h3 data-id="heading-6">3.1 前置准备</h3>
<ol>
<li>接口凭证获取：访问注册链接<code>http://user.ihuyi.com/?udcpF6</code>完成账号注册，在用户中心 “文本短信 - 验证码短信 - 产品总览” 中获取<code>account</code>（APIID）和<code>password</code>（APIKEY）；</li>
<li>环境依赖：引入 Apache HttpClient（处理 HTTP 请求）、FastJSON（解析 JSON 响应），Maven 依赖如下：</li>
</ol>
<p>xml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- HTTP请求依赖，用于调用短信http接口 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- JSON解析依赖，用于解析短信http接口响应 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.83<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">3.2 核心代码实现（POST 方式）</h3>
<p>java</p>
<p>运行</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.http.NameValuePair;
<span class="hljs-keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;
<span class="hljs-keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;
<span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpPost;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClients;
<span class="hljs-keyword">import</span> org.apache.http.message.BasicNameValuePair;
<span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;
<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.regex.Pattern;

<span class="hljs-comment">/**
 * 短信http接口对接工具类（互亿无线）
 * 凭证获取地址：http://user.ihuyi.com/?udcpF6（注册后在用户中心查看APIID/APIKEY）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsHttpApiClient</span> {
    <span class="hljs-comment">// 短信http接口请求地址</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SMS_HTTP_API_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.ihuyi.com/sms/Submit.json"</span>;
    <span class="hljs-comment">// 替换为从注册地址获取的APIID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ACCOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"xxxxxxxx"</span>;
    <span class="hljs-comment">// 替换为从注册地址获取的APIKEY</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">"xxxxxxxx"</span>;
    <span class="hljs-comment">// 手机号格式校验正则，避免触发短信http接口406错误</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MOBILE_REGEX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"^1[3-9]\d{9}$"</span>;

    <span class="hljs-comment">/**
     * 调用短信http接口发送验证码（模板方式）
     * <span class="hljs-doctag">@param</span> mobile 接收手机号，如139****8888
     * <span class="hljs-doctag">@param</span> verifyCode 验证码内容
     * <span class="hljs-doctag">@return</span> 短信http接口响应结果（JSON格式）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">sendVerifyCode</span><span class="hljs-params">(String mobile, String verifyCode)</span> {
        <span class="hljs-comment">// 前置参数校验：减少无效的短信http接口调用</span>
        <span class="hljs-keyword">if</span> (!Pattern.matches(MOBILE_REGEX, mobile)) {
            <span class="hljs-keyword">return</span> JSONObject.toJSONString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsHttpResponse</span>(<span class="hljs-number">406</span>, <span class="hljs-string">"手机号格式不正确"</span>, <span class="hljs-string">"0"</span>));
        }
        <span class="hljs-keyword">if</span> (verifyCode == <span class="hljs-literal">null</span> || verifyCode.length() &lt; <span class="hljs-number">4</span> || verifyCode.length() &gt; <span class="hljs-number">6</span>) {
            <span class="hljs-keyword">return</span> JSONObject.toJSONString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsHttpResponse</span>(<span class="hljs-number">40722</span>, <span class="hljs-string">"验证码长度超出限制"</span>, <span class="hljs-string">"0"</span>));
        }

        <span class="hljs-keyword">try</span> (<span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClients.createDefault()) {
            <span class="hljs-comment">// 构建短信http接口请求参数</span>
            List&lt;NameValuePair&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            params.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"account"</span>, ACCOUNT));
            params.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"password"</span>, PASSWORD));
            params.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"mobile"</span>, mobile));
            params.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"templateid"</span>, <span class="hljs-string">"1"</span>)); <span class="hljs-comment">// 系统默认验证码模板</span>
            params.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"content"</span>, verifyCode)); <span class="hljs-comment">// 模板变量</span>

            <span class="hljs-comment">// 构建POST请求，符合短信http接口的HTTP请求头要求</span>
            <span class="hljs-type">HttpPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpPost</span>(SMS_HTTP_API_URL);
            post.setEntity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlEncodedFormEntity</span>(params, StandardCharsets.UTF_8));
            post.setHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/x-www-form-urlencoded"</span>);

            <span class="hljs-comment">// 执行请求并解析短信http接口响应</span>
            <span class="hljs-type">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.execute(post);
            <span class="hljs-type">String</span> <span class="hljs-variable">responseStr</span> <span class="hljs-operator">=</span> EntityUtils.toString(response.getEntity(), StandardCharsets.UTF_8);
            <span class="hljs-keyword">return</span> responseStr;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 异常处理：短信http接口调用失败返回统一格式</span>
            <span class="hljs-keyword">return</span> JSONObject.toJSONString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsHttpResponse</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"接口调用异常："</span> + e.getMessage(), <span class="hljs-string">"0"</span>));
        }
    }

    <span class="hljs-comment">/**
     * 短信http接口响应实体类
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsHttpResponse</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;
        <span class="hljs-keyword">private</span> String msg;
        <span class="hljs-keyword">private</span> String smsid;

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SmsHttpResponse</span><span class="hljs-params">(<span class="hljs-type">int</span> code, String msg, String smsid)</span> {
            <span class="hljs-built_in">this</span>.code = code;
            <span class="hljs-built_in">this</span>.msg = msg;
            <span class="hljs-built_in">this</span>.smsid = smsid;
        }

        <span class="hljs-comment">// 省略getter/setter方法</span>
    }

    <span class="hljs-comment">// 测试方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sendVerifyCode(<span class="hljs-string">"139****8888"</span>, <span class="hljs-string">"7890"</span>);
        System.out.println(<span class="hljs-string">"短信http接口响应结果："</span> + result);
        <span class="hljs-comment">// 解析响应结果</span>
        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">resultJson</span> <span class="hljs-operator">=</span> JSONObject.parseObject(result);
        <span class="hljs-keyword">if</span> (resultJson.getInteger(<span class="hljs-string">"code"</span>) == <span class="hljs-number">2</span>) {
            System.out.println(<span class="hljs-string">"短信http接口提交成功，流水号："</span> + resultJson.getString(<span class="hljs-string">"smsid"</span>));
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"短信http接口提交失败，原因："</span> + resultJson.getString(<span class="hljs-string">"msg"</span>));
        }
    }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79a76b60392f42fbaba494f3691de4e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODAyNjk0NDMzODU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765088&amp;x-signature=iK614mSAyxvWl7wC53aDIRuhfow%3D" alt="api.png" loading="lazy"/></p>
<h3 data-id="heading-8">3.3 核心代码解析</h3>
<ul>
<li>前置参数校验：调用短信 http 接口前校验手机号格式、验证码长度，避免无效请求；</li>
<li>HTTP 请求头配置：严格按要求设置<code>Content-Type</code>，确保参数解析正常；</li>
<li>异常处理：封装统一的响应格式，便于业务系统解析短信 http 接口的调用状态。</li>
</ul>
<h2 data-id="heading-9">四、短信 http 接口不同请求方式对比与选型</h2>
<p>短信 http 接口支持 GET 和 POST 两种请求方式，需根据业务场景合理选型，具体对比如下：</p>






























<table><thead><tr><th>对比维度</th><th>GET 方式</th><th>POST 方式</th></tr></thead><tbody><tr><td>安全性</td><td>低（参数暴露在 URL 中）</td><td>高（参数封装在请求体）</td></tr><tr><td>长度限制</td><td>受 URL 长度限制（约 2048 字符）</td><td>无长度限制，支持长短信参数</td></tr><tr><td>调试便捷性</td><td>高（浏览器 / Postman 直接测试）</td><td>中（需构建请求体）</td></tr><tr><td>适用场景</td><td>短信 http 接口调试、参数简单的测试场景</td><td>生产环境、参数复杂的业务场景</td></tr></tbody></table>
<p><strong>选型结论</strong>：生产环境调用短信 http 接口优先选择 POST 方式；测试阶段可使用 GET 方式快速验证接口连通性，但需注意参数长度限制。</p>
<h2 data-id="heading-10">五、短信 http 接口集成的避坑技巧与最佳实践</h2>
<p>为提升短信 http 接口的集成稳定性，总结以下核心技巧：</p>
<ol>
<li><strong>全量前置校验</strong>：调用短信 http 接口前校验手机号格式、内容长度、敏感字符，避免 406/407/4073 等错误；</li>
<li><strong>异步调用解耦</strong>：通过消息队列（RabbitMQ/Kafka）异步调用短信 http 接口，避免阻塞业务主线程；</li>
<li><strong>精细化状态码处理</strong>：针对 405（凭证错误）、4085（验证码超限）、4051（条数不足）等状态码制定专属策略；</li>
<li><strong>编码统一化</strong>：所有参数均使用 UTF-8 编码，避免中文乱码触发敏感字符检测；</li>
<li><strong>监控告警配置</strong>：监控短信 http 接口的调用成功率（目标≥99.9%）、响应耗时（目标≤500ms），异常时及时告警。</li>
</ol>
<h3 data-id="heading-11">总结</h3>
<ol>
<li>对接<strong>短信 http 接口</strong>的核心是遵循 HTTP 协议规范，重点关注请求头配置、参数编码、状态码解析三大环节；</li>
<li>生产环境调用短信 http 接口优先选择 POST 方式，前置参数校验可大幅降低无效请求率；</li>
<li>异步调用、精细化状态码处理、监控告警是提升短信 http 接口集成稳定性的关键。</li>
</ol>
<p>延伸建议：企业级项目中可封装短信 http 接口的统一调用网关，集中处理身份认证、参数校验、错误重试，降低多业务系统的对接成本。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 组件开发学习笔记：幻灯片与返回顶部功能实现]]></title>    <link>https://juejin.cn/post/7598193992828747830</link>    <guid>https://juejin.cn/post/7598193992828747830</guid>    <pubDate>2026-01-23T09:31:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598193992828747830" data-draft-id="7598193992828731446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 组件开发学习笔记：幻灯片与返回顶部功能实现"/> <meta itemprop="keywords" content="前端,React.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-23T09:31:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UIUV"/> <meta itemprop="url" content="https://juejin.cn/user/1036168457093483"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 组件开发学习笔记：幻灯片与返回顶部功能实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1036168457093483/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UIUV
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:31:40.000Z" title="Fri Jan 23 2026 09:31:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 React 项目开发中，幻灯片（轮播图）和返回顶部是两个高频出现的功能组件。本文基于实际开发代码，深入解析使用 shadcn 组件库、Embla Carousel 插件及原生 React API 实现这两个组件的全过程，涵盖组件设计、类型约束、性能优化、事件处理等核心知识点，旨在梳理技术逻辑，夯实 React + TypeScript 开发基础。</p>
<p>本文涉及的代码包含三个核心部分：幻灯片组件（SlideShow）、返回顶部组件（BackToTop）、节流工具函数（throttle），以及组件在首页（Home）的集成使用。下文将逐模块拆解分析，结合 React 原理和 TypeScript 特性，拆解技术细节与实践要点。</p>
<h2 data-id="heading-0">一、前期准备与技术栈说明</h2>
<h3 data-id="heading-1">1.1 核心技术栈</h3>
<ul>
<li><strong>React</strong>：核心前端框架，采用函数式组件+Hooks 模式开发，实现组件的状态管理、生命周期控制与 DOM 交互。</li>
<li><strong>TypeScript</strong>：为 JavaScript 提供静态类型检查，定义组件属性（Props）、状态（State）及工具函数的类型，提升代码可维护性与健壮性。</li>
<li><strong>shadcn</strong>：轻量级 UI 组件库，提供封装完善的基础组件（如 Carousel 轮播组件），具备高性能、高定制性的特点，减少重复开发成本。</li>
<li><strong>Embla Carousel</strong>：轻量级轮播核心库，通过插件化机制扩展功能（如自动播放），与 shadcn 的 Carousel 组件适配性良好。</li>
<li><strong>Lucide React</strong>：图标库，提供简洁的矢量图标（如返回顶部的 ArrowUp 图标），适配 React 组件开发。</li>
</ul>
<h3 data-id="heading-2">1.2 核心工具函数：节流函数（throttle）</h3>
<p>在滚动事件、 resize 事件等高频触发场景中，直接执行回调函数会导致页面性能下降（如频繁重排重绘）。节流函数的作用是限制函数在一定时间内只能执行一次，降低事件触发频率，优化性能。</p>
<h4 data-id="heading-3">1.2.1 函数实现与类型定义</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ThrottleFunction</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-built_in">void</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">fun: ThrottleFunction, delay: <span class="hljs-built_in">number</span></span>): <span class="hljs-title class_">ThrottleFunction</span> {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">last</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">deferTimer</span>: <span class="hljs-title class_">NodeJS</span>.<span class="hljs-property">Timeout</span> | <span class="hljs-literal">undefined</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {
    <span class="hljs-keyword">const</span> now = +<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();

    <span class="hljs-keyword">if</span> (last &amp;&amp; now &lt; last + delay) {
      <span class="hljs-built_in">clearTimeout</span>(deferTimer);
      deferTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        last = now;
        <span class="hljs-title function_">fun</span>(...args);
      }, delay);
    } <span class="hljs-keyword">else</span> {
      last = now;
      <span class="hljs-title function_">fun</span>(...args);
    }
  };
}
</code></pre>
<h4 data-id="heading-4">1.2.2 核心逻辑解析</h4>
<p>该节流函数采用“时间戳+定时器”结合的实现方式，兼顾即时响应与延迟执行，避免了纯时间戳或纯定时器方案的缺陷：</p>
<ul>
<li>
<p><strong>变量定义</strong>：</p>
<ul>
<li><code>last</code>：存储上一次函数执行的时间戳，初始值为 <code>undefined</code>；</li>
<li><code>deferTimer</code>：存储定时器实例，用于延迟执行函数，避免高频触发时完全屏蔽函数执行。</li>
</ul>
</li>
<li>
<p><strong>执行逻辑</strong>：</p>
<ul>
<li>获取当前时间戳 <code>now</code>，判断距离上一次执行时间是否小于设定延迟 <code>delay</code>；</li>
<li>若时间间隔不足：清除现有定时器，重新设置定时器，确保在延迟结束后执行一次函数（避免错过最后一次触发）；</li>
<li>若时间间隔充足：直接执行函数，并更新 <code>last</code> 为当前时间戳，保证即时响应首次触发或间隔足够的触发。</li>
</ul>
</li>
<li>
<p><strong>类型约束</strong>：通过 <code>ThrottleFunction</code> 类型别名，定义节流函数的入参和返回值均为“接收任意参数、无返回值”的函数，确保类型一致性。</p>
</li>
</ul>
<h4 data-id="heading-5">1.2.3 应用场景</h4>
<p>该函数主要用于处理高频触发事件，本文中用于 <code>BackToTop</code> 组件的滚动事件监听，限制滚动事件回调函数的执行频率（每 200ms 最多执行一次），避免因滚动触发过多函数调用导致页面卡顿。</p>
<h2 data-id="heading-6">二、幻灯片组件（SlideShow）深度解析</h2>
<p>幻灯片组件是页面展示的核心组件之一，需实现轮播展示、自动播放、鼠标交互、指示点联动等功能。本文基于 shadcn 的 Carousel 组件封装，结合 Embla Carousel 的 AutoPlay 插件，实现高性能、高定制性的轮播效果。</p>
<h3 data-id="heading-7">2.1 组件结构与依赖引入</h3>
<h4 data-id="heading-8">2.1.1 依赖引入说明</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span>{
    useRef, <span class="hljs-comment">// 持久化存储对象，dom对象的引用</span>
    useState,
    useEffect,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-comment">// 第三方库</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AutoPlay</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'embla-carousel-autoplay'</span>; <span class="hljs-comment">// 自动播放组件</span>
<span class="hljs-comment">// 引入carousel组件,用它来实现轮播图功能“旋转木马”</span>
<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">Carousel</span>,
    <span class="hljs-title class_">CarouselContent</span>,
    <span class="hljs-title class_">CarouselItem</span>,
    <span class="hljs-keyword">type</span> <span class="hljs-title class_">CarouselApi</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components//ui/carousel'</span>;

<span class="hljs-comment">// 类型定义</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SlideData</span> { <span class="hljs-comment">// 轮播图数据项</span>
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 联合类型</span>
    <span class="hljs-attr">image</span>: <span class="hljs-built_in">string</span>;
    title?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SlideShowProps</span> { <span class="hljs-comment">// 轮播图组件属性</span>
    <span class="hljs-attr">slides</span>: <span class="hljs-title class_">SlideData</span>[]; <span class="hljs-comment">// 轮播图数据项数组</span>
    autoPlay?: <span class="hljs-built_in">boolean</span>; <span class="hljs-comment">// 是否自动播放</span>
    autoPlayDelay?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 自动播放间隔时间</span>
}
</code></pre>
<h4 data-id="heading-9">2.1.2 核心依赖解析</h4>
<ul>
<li>
<p><strong>React Hooks</strong>：</p>
<ul>
<li><code>useState</code>：管理组件状态（当前选中索引 <code>selectedIndex</code>、轮播图 API 实例 <code>api</code>）；</li>
<li><code>useEffect</code>：处理副作用（事件监听、组件卸载清理）；</li>
<li><code>useRef</code>：持久化存储 AutoPlay 插件实例，避免组件重渲染时重复创建实例，优化性能。</li>
</ul>
</li>
<li>
<p><strong>Embla Carousel 插件</strong>：<code>AutoPlay</code> 为轮播图提供自动播放功能，支持配置播放延迟、交互停止等参数。</p>
</li>
<li>
<p><strong>shadcn 组件</strong>：</p>
<ul>
<li><code>Carousel</code>：轮播图容器组件，提供核心轮播逻辑、API 暴露、插件集成等功能；</li>
<li><code>CarouselContent</code>：轮播内容容器，用于包裹轮播项，控制轮播的滚动区域；</li>
<li><code>CarouselItem</code>：单个轮播项组件，对应每一张幻灯片；</li>
<li><code>CarouselApi</code>：轮播图 API 类型，定义轮播图实例的方法和属性，用于类型约束。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">2.1.3 类型定义解析</h4>
<ul>
<li>
<p><code>SlideData</code>：定义单张幻灯片的数据结构，包含：</p>
<ul>
<li><code>id</code>：联合类型（<code>number | string</code>），作为轮播项的唯一标识，用于 <code>key</code> 属性；</li>
<li><code>image</code>：字符串类型，存储幻灯片图片地址，为必传字段；</li>
<li><code>title</code>：可选字符串类型，存储幻灯片标题，用于图片 alt 属性和底部文案展示。</li>
</ul>
</li>
<li>
<p><code>SlideShowProps</code>：定义幻灯片组件的属性，包含：</p>
<ul>
<li><code>slides</code>：<code>SlideData[]</code> 类型，轮播图数据数组，为必传字段；</li>
<li><code>autoPlay</code>：可选布尔类型，控制是否开启自动播放，默认值为 <code>true</code>；</li>
<li><code>autoPlayDelay</code>：可选数字类型，自动播放间隔时间（单位：毫秒），默认值为 <code>3000</code>。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">2.2 组件状态与副作用处理</h3>
<h4 data-id="heading-12">2.2.1 状态管理</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">SlideShow</span>:<span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">SlideShowProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
    slides,
    autoPlay = <span class="hljs-literal">true</span>,
    autoPlayDelay = <span class="hljs-number">3000</span>,
}</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [selectedIndex,setSelectedIndex] = useState&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>); <span class="hljs-comment">// 当前选中的索引</span>
    <span class="hljs-keyword">const</span> [api,setApi] = useState&lt;<span class="hljs-title class_">CarouselApi</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 轮播图API实例</span>

    <span class="hljs-comment">// ... 副作用与业务逻辑</span>
}
</code></pre>
<ul>
<li><code>selectedIndex</code>：存储当前选中的幻灯片索引，初始值为 <code>0</code>，用于控制指示点的激活状态，实现索引与指示点的联动。</li>
<li><code>api</code>：存储 Carousel 组件的 API 实例，初始值为 <code>null</code>。通过 <code>setApi</code> 接收组件暴露的实例，进而调用实例方法（如监听事件、获取选中索引）。</li>
</ul>
<h4 data-id="heading-13">2.2.2 副作用处理（useEffect）</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">useEffect</span>(()=&gt;{
    <span class="hljs-built_in">if</span>(!api) return;
    const onSelect = () =&gt; <span class="hljs-built_in">setSelectedIndex</span>(api.selectedScrollSnap());
    api<span class="hljs-selector-class">.on</span>('select',onSelect);
    <span class="hljs-comment">// 组件卸载时移除事件监听</span>
    return () =&gt; {
        api<span class="hljs-selector-class">.off</span>('select',onSelect);
    }
},<span class="hljs-selector-attr">[api]</span>)
</code></pre>
<p>该 useEffect 用于监听轮播图的选中状态变化，核心逻辑如下：</p>
<ul>
<li>
<p><strong>依赖项</strong>：仅依赖 <code>api</code>，当<code>api</code> 从 <code>null</code> 变为有效实例时，执行副作用逻辑。</p>
</li>
<li>
<p><strong>事件监听</strong>：</p>
<ul>
<li>定义 <code>onSelect</code> 回调函数，通过 <code>api.selectedScrollSnap()</code> 获取当前选中的轮播项索引，并更新 <code>selectedIndex</code> 状态；</li>
<li>调用 <code>api.on('select', onSelect)</code> 监听轮播图的 <code>select</code> 事件（当轮播项切换时触发）。</li>
</ul>
</li>
<li>
<p><strong>组件卸载清理</strong>：返回清理函数，调用 <code>api.off('select', onSelect)</code> 移除事件监听，避免组件卸载后仍存在事件绑定，导致内存泄漏。</p>
</li>
</ul>
<h4 data-id="heading-14">2.2.3 插件实例优化（useRef）</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// AutoPlay 比较耗性能 用 ref 存储插件实例，避免每次渲染都创建新实例</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">plugin</span> = <span class="hljs-title function_ invoke__">useRef</span>(
    autoPlay?<span class="hljs-title function_ invoke__">AutoPlay</span>({<span class="hljs-attr">delay</span>:autoPlayDelay,<span class="hljs-attr">stopOnInteraction</span>:<span class="hljs-literal">true</span>}):<span class="hljs-literal">null</span>
)
</code></pre>
<p>这是组件性能优化的关键知识点，核心原因与逻辑如下：</p>
<ul>
<li>
<p><strong>性能问题根源</strong>：AutoPlay 插件实例创建是耗时操作，若直接在组件渲染阶段创建，每次组件重渲染（如父组件传递的 props 变化、自身状态更新）都会重新创建实例，导致性能浪费。</p>
</li>
<li>
<p><strong>useRef 的作用</strong>：useRef 存储的对象在组件整个生命周期内保持不变，不会因组件重渲染而重新创建。通过 useRef 存储 AutoPlay 实例，确保仅在组件初始化时创建一次实例，后续重渲染复用该实例。</p>
</li>
<li>
<p><strong>AutoPlay 配置参数</strong>：</p>
<ul>
<li><code>delay</code>：自动播放间隔时间，对应组件的 <code>autoPlayDelay</code> 属性；</li>
<li><code>stopOnInteraction</code>：布尔值，设置为 <code>true</code> 时，当用户与轮播图交互（如点击、滑动）后，自动播放停止，提升用户体验。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">2.3 组件渲染与交互逻辑</h3>
<h4 data-id="heading-16">2.3.1 核心组件结构</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">return</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Carousel</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">'w-full'</span>
        <span class="hljs-attr">setApi</span>=<span class="hljs-string">{setApi}</span> // <span class="hljs-attr">轮播图实例赋值</span>
        <span class="hljs-attr">plugins</span>=<span class="hljs-string">{plugin.current</span> ? [<span class="hljs-attr">plugin.current</span>] <span class="hljs-attr">:</span> []}
        <span class="hljs-attr">opts</span>=<span class="hljs-string">{{loop:true}}</span> // <span class="hljs-attr">循环播放</span>
        <span class="hljs-attr">onMouseEnter</span>=<span class="hljs-string">{()</span>=&gt;</span>plugin.current?.stop()} // 鼠标进入暂停播放
        onMouseLeave={()=&gt;plugin.current?.play()} // 鼠标离开继续播放
        &gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">CarouselContent</span>&gt;</span>
                {
                    slides.map(({id,image,title},index)=&gt;(
                        <span class="hljs-tag">&lt;<span class="hljs-name">CarouselItem</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'w-full'</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{-full</span> <span class="hljs-attr">object-cover</span>' /&gt;</span>
                            {
                                title &amp;&amp; (
                                    {title}
                                )
                            }
                        <span class="hljs-tag">&lt;/<span class="hljs-name">CarouselItem</span>&gt;</span>
                    ))
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">CarouselContent</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Carousel</span>&gt;</span></span>
        {<span class="hljs-comment">/* 指示点 */</span>}
        
            {
                slides.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_,i</span>) =&gt;</span> (
                    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">key</span> <span class="hljs-attr">-2</span> <span class="hljs-attr">w-2</span> <span class="hljs-attr">rounded-full</span> <span class="hljs-attr">transition-all</span> ${<span class="hljs-attr">selectedIndex</span> === <span class="hljs-string">i</span> ? '<span class="hljs-attr">bg-white</span> <span class="hljs-attr">w-6</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-white</span>/<span class="hljs-attr">50</span>'}`}/&gt;</span></span>
                ))
            }
        
)
</code></pre>
<h4 data-id="heading-17">2.3.2 Carousel 组件核心属性解析</h4>
<ul>
<li><code>setApi={setApi}</code>：将 <code>setApi</code> 传递给 Carousel 组件，当轮播图实例初始化完成后，通过该函数将实例赋值给组件的 <code>api</code> 状态，便于后续调用实例方法。</li>
<li><code>plugins={plugin.current ? [plugin.current] : []}</code>：传递 AutoPlay 插件实例，若 <code>autoPlay</code> 为 <code>true</code>，则加载插件实现自动播放；否则传递空数组，不启用自动播放。</li>
<li><code>opts={{loop:true}}</code>：配置轮播图为循环播放模式，当轮播到最后一张时，自动切换到第一张，形成闭环。</li>
<li><code>onMouseEnter</code> / <code>onMouseLeave</code>：鼠标交互事件，实现“鼠标进入暂停自动播放、鼠标离开恢复自动播放”的交互逻辑，通过调用 AutoPlay 插件的 <code>stop()</code> 和 <code>play()</code> 方法实现。</li>
</ul>
<h4 data-id="heading-18">2.3.3 轮播项（CarouselItem）渲染逻辑</h4>
<p>每张轮播项包含图片、标题（可选）及样式优化，核心细节如下：</p>
<ul>
<li>
<p><strong>布局样式</strong>：</p>
<ul>
<li><code>aspect-[16/9]</code>：固定轮播图宽高比为 16:9，适配大多数场景的展示需求；</li>
<li><code>rounded-xl</code>：设置圆角，提升视觉效果；</li>
<li><code>overflow-hidden</code>：隐藏图片超出容器的部分，避免图片变形。</li>
</ul>
</li>
<li>
<p><strong>图片优化</strong>：<code>object-cover</code> 确保图片按比例填充容器，同时裁剪超出部分，保证图片展示完整且不变形；alt 属性设置默认值（<code>slide ${index + 1}</code>），提升可访问性。</p>
</li>
<li>
<p><strong>标题展示与渐变背景应用</strong>：仅当 <code>title</code> 存在时渲染标题容器，核心采用 CSS 线性渐变（<code>linear-gradient</code>）实现背景遮罩，具体为 <code>bg-gradient-to-t from-black/60 to-transparent</code>。该写法指定渐变方向为“从下到上”（<code>to-t</code>），起始颜色为黑色并设置 60% 透明度（<code>from-black/60</code>），结束颜色为完全透明（<code>to-transparent</code>）。这种渐变背景相比纯色半透明遮罩（如 <code>bg-black/60</code>），视觉上更自然，能让标题与图片背景平滑融合，同时避免遮挡图片主体内容。更重要的是，渐变背景无需加载任何图片资源，彻底消除了图片背景带来的 HTTP 下载开销和并发数占用问题，尤其在轮播图这类多元素场景中，能显著优化页面加载性能。同时，标题文字设置 <code>text-lg font-bold</code> 样式，确保在渐变背景上具备足够的可读性。</p>
</li>
</ul>
<h4 data-id="heading-19">2.3.4 指示点（Indicator）实现</h4>
<p>指示点用于展示当前轮播位置及切换轮播项，核心逻辑如下：</p>
<ul>
<li><strong>布局</strong>：通过 <code>absolute</code> 定位在轮播图底部中央，<code>flex</code> 布局实现指示点横向排列，<code>gap-2</code> 设置指示点间距。</li>
<li><strong>动态渲染</strong>：根据 <code>slides</code> 数组长度循环生成指示点，无需手动编写固定数量的指示点，适配动态数据。</li>
<li/>
<li><strong>动态类名与 transition-all 过渡</strong>：通过 <code>selectedIndex === i</code> 判断当前指示点是否为激活状态，动态切换类名实现样式变化，而 <code>transition-all</code> 属性则为这些变化提供平滑过渡效果。具体来说，激活状态下指示点的宽度从 2px 变为 6px、背景色从 <code>bg-white/50</code>（半透明白色）变为 <code>bg-white</code>（纯白色），这两个属性的变化都会被 <code>transition-all</code> 捕获，生成连贯的过渡动画。若不添加 <code>transition-all</code>，状态切换会瞬间完成，视觉上显得生硬，影响用户体验。此外，<code>transition-all</code> 无需指定具体过渡属性，简化了代码维护成本，即便后续新增样式变化（如透明度调整），也无需额外修改过渡相关代码，兼容性和扩展性更强。</li>
<li><strong>可优化点</strong>：当前指示点仅用于展示位置，未实现点击切换功能。可添加 <code>onClick</code> 事件，调用 <code>api.scrollTo(i)</code> 方法，实现点击指示点切换到对应轮播项的功能。</li>
</ul>
<h3 data-id="heading-20">2.4 性能优化与最佳实践</h3>
<h4 data-id="heading-21">2.4.1 图片性能优化</h4>
<p>代码中采用图片作为背景展示，虽能满足视觉需求，但存在 HTTP 下载开销。可进一步优化：</p>
<ul>
<li><strong>渐变色替代图片（核心优化方案）</strong> ：若无需展示具体图片内容，优先使用 CSS 线性渐变（<code>linear-gradient</code>）作为背景，完全消除图片的 HTTP 下载开销。线性渐变支持多色过渡、方向控制、透明度调节，能满足大多数装饰性背景需求。例如用 <code>bg-gradient-to-r from-blue-500 to-purple-600</code> 实现水平蓝紫渐变，用 <code>bg-gradient-to-br from-teal-400 via-green-300 to-yellow-200</code> 实现对角线多色渐变。相比图片背景，渐变背景有三大性能优势：一是无网络请求，减少 HTTP 并发数，避免阻塞关键资源加载；二是渲染高效，由浏览器本地计算生成，无需解析图片文件；三是适配性强，可随容器尺寸自适应拉伸，不会出现图片变形或模糊问题。</li>
<li><strong>图片懒加载</strong>：结合 React 懒加载库（如 <code>react-lazyload</code>）或原生 <code>loading="lazy"</code> 属性，实现图片懒加载，仅当轮播项进入视口时才加载图片，减少首屏加载时间。</li>
<li><strong>图片压缩与格式优化</strong>：使用 WebP 格式图片，结合图片压缩工具（如 TinyPNG）减小图片体积，提升加载速度。</li>
<li><strong>图片懒加载</strong>：结合 React 懒加载库（如 <code>react-lazyload</code>）或原生 <code>loading="lazy"</code> 属性，实现图片懒加载，仅当轮播项进入视口时才加载图片，减少首屏加载时间。</li>
<li><strong>图片压缩与格式优化</strong>：使用 WebP 格式图片，结合图片压缩工具（如 TinyPNG）减小图片体积，提升加载速度。</li>
</ul>
<h4 data-id="heading-22">2.4.2 组件性能优化</h4>
<ul>
<li><strong>useRef 复用插件实例</strong>：如前文所述，避免组件重渲染时重复创建 AutoPlay 实例，减少性能消耗。</li>
<li><strong>事件监听清理</strong>：在 useEffect 中返回清理函数，移除事件监听，避免内存泄漏。</li>
<li><strong>条件渲染优化</strong>：标题容器仅在 <code>title</code> 存在时渲染，避免无用 DOM 节点生成。</li>
</ul>
<h4 data-id="heading-23">2.4.3 样式优化</h4>
<ul>
<li><strong>transition-all 特性深度解析</strong>：<code>transition-all</code> 是 CSS 过渡属性的简化写法，作用于元素的所有可过渡属性（如宽度、背景色、透明度、位置等），无需逐个指定属性名。在轮播图指示点中，通过该属性让激活状态下的宽度变化（从 2px 到 6px）和背景色变化（从半透明白色到纯白色）形成平滑过渡，避免状态切换时出现生硬的跳变效果，提升用户视觉体验。其核心优势在于简化代码，同时确保元素所有样式变化都能获得统一的过渡效果，尤其适合动态类名切换样式的场景。需要注意的是，过渡效果的时长和曲线可通过 <code>transition-duration</code> 和 <code>transition-timing-function</code> 补充配置，默认时长为 0.3s，曲线为 <code>ease</code>（慢进慢出），可根据需求调整为 <code>linear</code>（匀速）等。</li>
<li><strong>gradient 线性渐变与性能优化</strong>：CSS 线性渐变（<code>linear-gradient</code>）通过代码生成渐变背景，无需依赖图片资源，是替代图片背景的优质方案。在幻灯片标题容器中，<code>bg-gradient-to-t from-black/60 to-transparent</code> 就是典型的线性渐变应用，从底部的黑色半透明（<code>from-black/60</code>）向上渐变至透明（<code>to-transparent</code>），既实现了遮罩效果突出标题，又无需加载额外的半透明遮罩图片。从性能角度看，图片背景会产生 HTTP 下载开销，不仅增加页面加载时间，还会占用 HTTP 并发连接数（浏览器对同一域名的并发请求数有上限，通常为 6 个），过多图片请求会阻塞其他关键资源（如脚本、核心样式）的加载；而线性渐变由浏览器本地渲染，无任何网络开销，能显著减少并发请求数，提升页面加载性能和渲染速度。实际开发中，若无需展示具体图片内容，可直接用渐变背景替代，例如用 <code>bg-gradient-to-r from-blue-500 to-purple-600</code> 实现蓝紫渐变背景，兼顾视觉效果与性能。</li>
</ul>
<h2 data-id="heading-24">三、返回顶部组件（BackToTop）解析</h2>
<p>返回顶部组件是提升用户体验的常用组件，当页面滚动超过一定距离时显示，点击后平滑滚动到页面顶部。本文结合节流函数和 React Hooks，实现高性能、可配置的返回顶部功能。</p>
<h3 data-id="heading-25">3.1 组件结构与类型定义</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>,{
    useEffect,
    useState
} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./ui/button"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ArrowUp</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"lucide-react"</span>; <span class="hljs-comment">// 引入返回顶部图标</span>
<span class="hljs-keyword">import</span> { throttle } <span class="hljs-keyword">from</span> <span class="hljs-string">"../utils"</span>; <span class="hljs-comment">// 引入节流函数</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">BackToTopProps</span> {
    <span class="hljs-comment">// 滚动超过多少像素后显示按钮</span>
    threshold?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">BackToTop</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">BackToTopProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{threshold = <span class="hljs-number">400</span>}</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [isVisible, setIsVisible] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);
    
    <span class="hljs-comment">// ... 业务逻辑与渲染</span>
}
</code></pre>
<h4 data-id="heading-26">3.1.1 类型定义解析</h4>
<p><code>BackToTopProps</code> 定义组件的可选属性 <code>threshold</code>，表示“页面滚动超过多少像素后显示返回顶部按钮”，默认值为 <code>400</code>，支持父组件自定义配置，提升组件复用性。</p>
<h4 data-id="heading-27">3.1.2 状态管理</h4>
<p><code>isVisible</code>：布尔类型状态，控制返回顶部按钮的显示/隐藏，初始值为 <code>false</code>（页面加载时不显示）。</p>
<h3 data-id="heading-28">3.2 核心功能实现</h3>
<h4 data-id="heading-29">3.2.1 平滑滚动到顶部函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollTop</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// window.scrollTo 方法会让页面滚动到顶部</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({
        <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> <span class="hljs-comment">// 平滑滚动</span>
    })
}
</code></pre>
<p>核心 API 解析：</p>
<ul>
<li>
<p><code>window.scrollTo()</code>：用于设置页面滚动位置的原生 API，支持两种参数形式：</p>
<ul>
<li>参数为两个数字：<code>window.scrollTo(x, y)</code>，分别表示水平和垂直滚动位置；</li>
<li>参数为对象：支持配置 <code>top</code>（垂直滚动位置）、<code>left</code>（水平滚动位置）、<code>behavior</code>（滚动行为）。</li>
</ul>
</li>
<li>
<p><code>behavior: 'smooth'</code>：设置滚动行为为平滑滚动，相比默认的瞬间滚动，用户体验更友好。若需兼容低版本浏览器（如 IE），可引入 <code>smoothscroll-polyfill</code> 插件。</p>
</li>
</ul>
<h4 data-id="heading-30">3.2.2 滚动事件监听与节流处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleVisibility</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-title function_">setIsVisible</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> &gt; threshold);
    }
    <span class="hljs-keyword">const</span> throttled_func = <span class="hljs-title function_">throttle</span>(toggleVisibility, <span class="hljs-number">200</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>,throttled_func); <span class="hljs-comment">// 监听滚动事件</span>
    <span class="hljs-comment">// 组件卸载时移除事件监听(监听事件和处理函数都要移除，否则会导致内存泄漏)</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>,throttled_func);
    }
},[threshold])
</code></pre>
<p>核心逻辑解析：</p>
<ul>
<li>
<p><strong>滚动状态判断</strong>：<code>toggleVisibility</code> 函数通过 <code>window.scrollY</code> 获取当前页面垂直滚动距离，与 <code>threshold</code> 比较，更新 <code>isVisible</code> 状态（滚动距离超过阈值则显示按钮，否则隐藏）。</p>
</li>
<li>
<p><strong>节流优化</strong>：通过 <code>throttle(toggleVisibility, 200)</code> 生成节流后的函数，限制 <code>toggleVisibility</code> 每 200ms 最多执行一次，避免滚动事件高频触发导致页面卡顿。</p>
</li>
<li>
<p><strong>事件监听与清理</strong>：</p>
<ul>
<li>组件挂载时，为 <code>window</code> 添加滚动事件监听，绑定节流后的函数；</li>
<li>组件卸载时，移除滚动事件监听，且必须使用节流后的函数（<code>throttled_func</code>）作为移除对象，否则无法正确移除监听（原生事件监听要求添加和移除的函数是同一个引用），导致内存泄漏。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-31">3.3 组件渲染与样式优化</h3>
<pre><code class="hljs language-ini" lang="ini">if (!isVisible) {
    return null<span class="hljs-comment">;</span>
}

return (
    &lt;Button 
    <span class="hljs-attr">variant</span>=<span class="hljs-string">'outline'</span>
    <span class="hljs-attr">size</span>=<span class="hljs-string">'icon'</span>
    <span class="hljs-attr">onClick</span>={scrollTop}
    <span class="hljs-attr">className</span>=<span class="hljs-string">"fixed bottom-6 right-6 rounded-full shadow-lg hover:shadow-xl z-50"</span>&gt;
        &lt;ArrowUp <span class="hljs-attr">className</span>=<span class="hljs-string">"h-4 w-4"</span> /&gt;
    &lt;/Button&gt;
)
</code></pre>
<h4 data-id="heading-32">3.3.1 条件渲染</h4>
<p>当 <code>isVisible</code> 为 <code>false</code> 时，组件返回 <code>null</code>，不渲染任何 DOM 节点，避免无用节点占用页面资源。</p>
<h4 data-id="heading-33">3.3.2 按钮样式与交互</h4>
<ul>
<li>
<p><strong>布局定位</strong>：</p>
<ul>
<li><code>fixed</code> 固定定位，使按钮始终位于页面可视区域；</li>
<li><code>bottom-6 right-6</code> 定位在页面右下角，距离底部和右侧各 6 个单位；</li>
<li><code>z-50</code> 设置较高的层级，确保按钮不被其他组件遮挡。</li>
</ul>
</li>
<li>
<p><strong>视觉样式</strong>：</p>
<ul>
<li><code>rounded-full</code> 圆形按钮，提升视觉美观度；</li>
<li><code>shadow-lg hover:shadow-xl</code> 设置阴影效果，鼠标悬浮时阴影放大，增强交互反馈；</li>
<li>使用 shadcn 的 <code>Button</code> 组件，配置 <code>variant='outline'</code>（轮廓样式）、<code>size='icon'</code>（图标尺寸），保持与项目 UI 风格一致。</li>
</ul>
</li>
<li>
<p><strong>图标集成</strong>：引入 Lucide React 的 <code>ArrowUp</code> 图标，设置尺寸为 <code>h-4 w-4</code>，直观表示“返回顶部”功能。</p>
</li>
</ul>
<h3 data-id="heading-34">3.4 组件优化与复用</h3>
<h4 data-id="heading-35">3.4.1 可配置性优化</h4>
<p>组件通过<code>threshold</code> 属性支持自定义显示阈值，父组件可根据页面需求灵活配置（如在长列表页面设置 <code>threshold={600}</code>，在短页面设置 <code>threshold={200}</code>），提升组件复用性。</p>
<h4 data-id="heading-36">3.4.2 性能优化</h4>
<ul>
<li><strong>节流处理</strong>：滚动事件监听采用节流函数，降低回调函数执行频率，减少性能消耗。</li>
<li><strong>条件渲染</strong>：隐藏时不渲染 DOM 节点，避免无用节点占用资源。</li>
<li><strong>事件清理</strong>：组件卸载时移除滚动事件监听，避免内存泄漏。</li>
</ul>
<h2 data-id="heading-37">四、组件集成与首页（Home）使用</h2>
<p>首页作为组件集成的载体，引入了 Header、SlideShow、BackToTop 及 shadcn 的 Card 组件，实现页面布局与功能整合。</p>
<h3 data-id="heading-38">4.1 首页代码解析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/Header"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SlideShow</span>,{ type <span class="hljs-title class_">SlideData</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/SlideShow"</span>;
<span class="hljs-keyword">import</span> { 
    <span class="hljs-title class_">Card</span>, 
    <span class="hljs-title class_">CardHeader</span>, 
    <span class="hljs-title class_">CardTitle</span>,
    <span class="hljs-title class_">CardContent</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@/components/ui/card"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">bannerData</span>: <span class="hljs-title class_">SlideData</span>[] = [{
      <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"React 生态系统"</span>,
      <span class="hljs-attr">image</span>: <span class="hljs-string">"https://images.unsplash.com/photo-1633356122544-f134324a6cee?q=80&amp;w=2070&amp;auto=format&amp;fit=crop"</span>,
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"移动端开发最佳实践"</span>,
      <span class="hljs-attr">image</span>: <span class="hljs-string">"https://img.36krcdn.com/hsossms/20260114/v2_1ddcc36679304d3390dd9b8545eaa57f@5091053@ai_oswg1012730oswg1053oswg495_img_png~tplv-1marlgjv7f-ai-v3:600:400:600:400:q70.jpg?x-oss-process=image/format,webp"</span>,
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">"百度上线七猫漫剧，打的什么主意？"</span>,
      <span class="hljs-attr">image</span>: <span class="hljs-string">"https://img.36krcdn.com/hsossms/20260114/v2_8dc528b02ded4f73b29b7c1019f8963a@5091053@ai_oswg1137571oswg1053oswg495_img_png~tplv-1marlgjv7f-ai-v3:600:400:600:400:q70.jpg?x-oss-process=image/format,webp"</span>,
    }]
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"首页"</span> <span class="hljs-attr">showBackButton</span>=<span class="hljs-string">{true}</span> /&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">SlideShow</span> <span class="hljs-attr">slides</span>=<span class="hljs-string">{bannerData}</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">CardHeader</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">CardTitle</span>&gt;</span>欢迎来到React Mobile<span class="hljs-tag">&lt;/<span class="hljs-name">CardTitle</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">CardHeader</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">CardContent</span>&gt;</span>
                   这是内容区域<span class="hljs-tag">&lt;/<span class="hljs-name">CardContent</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span>
            
                {
                    [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25].map((i,index) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{</span> <span class="hljs-attr">bg-white</span> <span class="hljs-attr">rounded-lg</span> <span class="hljs-attr">shadow-sm</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">justify-center</span> <span class="hljs-attr">border</span> "&gt;</span>
                            Item {i}
                        
                    ))
                }

            <span class="hljs-tag">&lt;/&gt;</span>
    )
}
</span></code></pre>
<h3 data-id="heading-39">4.2 核心集成要点</h3>
<ul>
<li><strong>幻灯片组件使用</strong>：导入 <code>SlideShow</code> 组件和 <code>SlideData</code> 类型，定义 <code>bannerData</code> 数组作为轮播数据，传递给 <code>slides</code> 属性，使用默认的自动播放配置（也可自定义 <code>autoPlay</code> 和 <code>autoPlayDelay</code>）。</li>
<li><strong>Card 组件使用</strong>：引入 shadcn 的 <code>Card</code> 系列组件（<code>Card</code>、<code>CardHeader</code>、<code>CardTitle</code>、<code>CardContent</code>），实现内容卡片展示，保持页面布局规整。</li>
<li><strong>网格布局</strong>：通过 <code>grid grid-cols-2 gap-4</code> 实现两列网格布局，循环生成 25 个列表项，展示批量内容，适配移动端页面需求。</li>
<li><strong>样式规范</strong>：使用 <code>p-4</code>（内边距）、<code>space-y-4</code>（垂直间距）等样式类，保持页面元素间距一致，提升视觉美观度。</li>
</ul>
<h3 data-id="heading-40">4.3 组件协同注意事项</h3>
<ul>
<li><strong>类型一致性</strong>：使用<code>SlideData</code> 类型约束轮播数据，确保数据结构符合组件要求，避免类型错误。</li>
<li><strong>层级关系</strong>：返回顶部组件（<code>BackToTop</code>）通常在首页全局引入，设置较高层级（<code>z-50</code>），确保在所有组件之上显示。</li>
<li><strong>响应式适配</strong>：网格布局、轮播图宽高比等样式需适配移动端屏幕，可通过媒体查询（<code>@media</code>）调整不同屏幕尺寸下的布局。</li>
</ul>
<h2 data-id="heading-41">五、核心知识点总结与拓展</h2>
<h3 data-id="heading-42">5.1 核心知识点梳理</h3>
<h4 data-id="heading-43">5.1.1 React Hooks 实战</h4>
<ul>
<li><code>useState</code>：管理组件状态（如轮播索引、按钮显示状态），实现状态驱动视图更新。</li>
<li><code>useEffect</code>：处理副作用（事件监听、组件卸载清理），需注意依赖项设置，避免无限循环和内存泄漏。</li>
<li><code>useRef</code>：持久化存储对象（如插件实例、DOM 引用），避免组件重渲染时重复创建，优化性能。</li>
</ul>
<h4 data-id="heading-44">5.1.2 TypeScript 类型约束</h4>
<ul>
<li>组件属性（Props）类型定义：明确组件接收的参数类型、必填/可选状态，提升代码可维护性。</li>
<li>联合类型：如 <code>id: number | string</code>，适配多种数据类型场景。</li>
<li>类型别名：如 <code>ThrottleFunction</code>，简化复杂类型定义，提高代码可读性。</li>
</ul>
<h4 data-id="heading-45">5.1.3 性能优化技巧</h4>
<ul>
<li>节流/防抖：高频事件（滚动、点击）采用节流/防抖处理，降低函数执行频率。</li>
<li>实例复用：使用 useRef 存储耗时创建的实例（如 AutoPlay 插件），避免重复创建。</li>
<li>事件清理：组件卸载时移除事件监听、清除定时器，避免内存泄漏。</li>
<li>条件渲染：隐藏状态下不渲染无用 DOM 节点，减少页面资源占用。</li>
</ul>
<h4 data-id="heading-46">5.1.4 UI 组件库使用</h4>
<ul>
<li>shadcn 组件：基于原子化设计，提供轻量、高定制性的基础组件，减少重复开发，保持 UI 风格一致。</li>
<li>插件集成：Embla Carousel 插件与 shadcn Carousel 组件适配，通过插件化机制扩展功能，提升开发效率。</li>
</ul>
<h3 data-id="heading-47">5.2 拓展与进阶方向</h3>
<ul>
<li>
<p><strong>幻灯片组件进阶</strong>：</p>
<ul>
<li>添加左右箭头切换按钮，调用 <code>api.scrollPrev()</code>、<code>api.scrollNext()</code> 方法实现手动切换；</li>
<li>支持手势滑动（Embla Carousel 原生支持），适配移动端交互；</li>
<li>实现轮播图懒加载，优化首屏加载速度。</li>
</ul>
</li>
<li>
<p><strong>返回顶部组件进阶</strong>：</p>
<ul>
<li>添加滚动进度条，结合 <code>window.scrollY</code> 和 <code>document.body.scrollHeight</code> 计算滚动进度；</li>
<li>支持自定义按钮样式、图标、位置，提升组件复用性。</li>
</ul>
</li>
<li>
<p><strong>TypeScript 进阶</strong>：</p>
<ul>
<li>使用泛型优化组件类型定义，提升组件通用性；</li>
<li>引入 <code>zod</code> 等库，实现 Props 数据校验，增强类型安全。</li>
</ul>
</li>
<li>
<p><strong>性能优化进阶</strong>：</p>
<ul>
<li>使用 <code>React.memo</code> 包裹组件，避免不必要的重渲染；</li>
<li>引入 <code>react-window</code> 等库，优化长列表渲染性能。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-48">六、总结</h2>
<p>本文基于实际开发代码，深入解析了 React + TypeScript 环境下幻灯片组件和返回顶部组件的实现过程，涵盖组件设计、类型约束、状态管理、事件处理、性能优化等核心知识点。通过学习这些组件的开发，我们可以掌握：</p>
<ol>
<li>React Hooks 的实战应用，包括 useState、useEffect、useRef 的使用场景和最佳实践；</li>
<li>TypeScript 在组件开发中的类型约束技巧，提升代码健壮性和可维护性；</li>
<li>高频事件（滚动、轮播）的性能优化方案，如节流、实例复用、事件清理；</li>
<li>UI 组件库（shadcn）与第三方插件（Embla Carousel）的集成方法，提升开发效率；</li>
<li>组件化开发的核心思想，通过拆分功能组件、定义清晰的接口，实现组件复用与协同。</li>
</ol>
<p>在实际项目开发中，还需结合业务需求进一步优化组件功能，适配不同场景的使用需求，同时持续关注 React 和 TypeScript 的新特性，不断提升代码质量和开发效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[流量变现与风控利器：天远名下车辆车牌查询API接口PHP调用代码与场景解析]]></title>    <link>https://juejin.cn/post/7598402961903779892</link>    <guid>https://juejin.cn/post/7598402961903779892</guid>    <pubDate>2026-01-23T09:34:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598402961903779892" data-draft-id="7598355220829569076" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="流量变现与风控利器：天远名下车辆车牌查询API接口PHP调用代码与场景解析"/> <meta itemprop="keywords" content="API,大数据"/> <meta itemprop="datePublished" content="2026-01-23T09:34:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天远数科"/> <meta itemprop="url" content="https://juejin.cn/user/3511153810487162"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            流量变现与风控利器：天远名下车辆车牌查询API接口PHP调用代码与场景解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3511153810487162/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天远数科
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:34:55.000Z" title="Fri Jan 23 2026 09:34:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 以低代码成本实现权威车务数据变现</h2>
<p>在<strong>微信公众号吸粉、车务代办小程序</strong>以及<strong>地方性物流信息网</strong>的开发中，PHP 凭借其“即部即用”的特性，依然是最高效的生产力工具。名下车辆车牌查询API 是连接用户与车管数据的核心枢纽，它只需用户提供姓名和身份证号，即可对接国家部委权威数据库，返回车辆数量、车牌号及车辆类型等高价值信息。</p>
<p>对于 PHP 开发者而言，<strong>API</strong> 提供了极其友好的 HTTP 接入方式，无需复杂的环境配置即可快速集成。本文将演示如何利用 PHP 原生代码处理 AES 加密与 POST 请求，帮助开发者以最低的成本接入<strong>天远API</strong>，在ETC推广、车主核验等场景中快速实现数据变现与业务闭环。</p>
<h2 data-id="heading-1">二、 API接口调用示例（PHP版）</h2>
<p>本节演示如何在 PHP 环境中（兼容 PHP 5.6 - 8.x）完成接口对接。我们将使用 PHP 标准扩展 <code>curl</code> 和 <code>openssl</code>，确保代码在大多数虚拟主机或云服务器上都能直接运行。</p>
<h3 data-id="heading-2">1. 接入前准备</h3>
<ul>
<li><strong>接口地址</strong>：<code>https://api.tianyuanapi.com/api/v1/QCXG3G8K</code></li>
<li><strong>加密方式</strong>：AES-128-CBC + Base64</li>
<li><strong>请求参数</strong>：<code>id_card</code> (身份证), <code>name</code> (姓名)</li>
</ul>
<h3 data-id="heading-3">2. Curl 命令行预检</h3>
<p>Bash</p>
<pre><code class="hljs language-jsx" lang="jsx"># 验证 <span class="hljs-title class_">Access</span>-<span class="hljs-title class_">Id</span> 是否有效
curl -I <span class="hljs-string">"https://api.tianyuanapi.com/api/v1/QCXG3G8K?t=1720000000"</span>
</code></pre>
<h3 data-id="heading-4">3. PHP 完整调用示例</h3>
<p>以下代码封装了一个轻量级的 <code>TianyuanVehicleClient</code> 类，直接复制即可使用。</p>
<p>PHP</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;?php

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TianyuanVehicleClient</span> {
    <span class="hljs-comment">// 接口地址 </span>
    private $apiUrl = <span class="hljs-string">"https://api.tianyuanapi.com/api/v1/QCXG3G8K"</span>;
    private $accessId;
    private $accessKey;

    public <span class="hljs-keyword">function</span> <span class="hljs-title function_">__construct</span>(<span class="hljs-params">$accessId, $accessKey</span>) {
        $this-&gt;accessId = $accessId;
        $this-&gt;accessKey = $accessKey;
    }

    <span class="hljs-comment">/**
     * AES-128-CBC 加密 
     */</span>
    private <span class="hljs-keyword">function</span> <span class="hljs-title function_">encryptData</span>(<span class="hljs-params">$data</span>) {
        $key = $this-&gt;accessKey;
        <span class="hljs-comment">// 生成16字节随机IV</span>
        $iv = <span class="hljs-title function_">openssl_random_pseudo_bytes</span>(<span class="hljs-number">16</span>);
        $jsonStr = <span class="hljs-title function_">json_encode</span>($data);

        <span class="hljs-comment">// 加密</span>
        $encrypted = <span class="hljs-title function_">openssl_encrypt</span>($jsonStr, <span class="hljs-string">'AES-128-CBC'</span>, $key, <span class="hljs-variable constant_">OPENSSL_RAW_DATA</span>, $iv);

        <span class="hljs-comment">// 拼接 IV + 密文 并 Base64编码 </span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">base64_encode</span>($iv . $encrypted);
    }

    <span class="hljs-comment">/**
     * AES-128-CBC 解密 
     */</span>
    private <span class="hljs-keyword">function</span> <span class="hljs-title function_">decryptData</span>(<span class="hljs-params">$base64Str</span>) {
        $raw = <span class="hljs-title function_">base64_decode</span>($base64Str);
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">strlen</span>($raw) &lt; <span class="hljs-number">17</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

        $iv = <span class="hljs-title function_">substr</span>($raw, <span class="hljs-number">0</span>, <span class="hljs-number">16</span>); <span class="hljs-comment">// 提取前16位IV</span>
        $cipherText = <span class="hljs-title function_">substr</span>($raw, <span class="hljs-number">16</span>); <span class="hljs-comment">// 提取密文</span>

        $decrypted = <span class="hljs-title function_">openssl_decrypt</span>($cipherText, <span class="hljs-string">'AES-128-CBC'</span>, $this-&gt;accessKey, <span class="hljs-variable constant_">OPENSSL_RAW_DATA</span>, $iv);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">json_decode</span>($decrypted, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * 发起查询
     */</span>
    public <span class="hljs-keyword">function</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">$idCard, $realName</span>) {
        <span class="hljs-comment">// 构造业务参数 </span>
        $params = [
            <span class="hljs-string">'id_card'</span> =&gt; $idCard,
            <span class="hljs-string">'name'</span> =&gt; $realName
        ];

        <span class="hljs-comment">// 1. 加密</span>
        $encryptedData = $this-&gt;<span class="hljs-title function_">encryptData</span>($params);

        <span class="hljs-comment">// 2. 构造POST请求体</span>
        $postData = <span class="hljs-title function_">json_encode</span>([<span class="hljs-string">'data'</span> =&gt; $encryptedData]);
        
        <span class="hljs-comment">// 添加时间戳防止缓存</span>
        $url = $this-&gt;apiUrl . <span class="hljs-string">"?t="</span> . (<span class="hljs-title function_">time</span>() * <span class="hljs-number">1000</span>);

        <span class="hljs-comment">// 3. 发送 CURL 请求</span>
        $ch = <span class="hljs-title function_">curl_init</span>();
        <span class="hljs-title function_">curl_setopt</span>($ch, <span class="hljs-variable constant_">CURLOPT_URL</span>, $url);
        <span class="hljs-title function_">curl_setopt</span>($ch, <span class="hljs-variable constant_">CURLOPT_POST</span>, <span class="hljs-number">1</span>);
        <span class="hljs-title function_">curl_setopt</span>($ch, <span class="hljs-variable constant_">CURLOPT_POSTFIELDS</span>, $postData);
        <span class="hljs-title function_">curl_setopt</span>($ch, <span class="hljs-variable constant_">CURLOPT_HTTPHEADER</span>, [
            <span class="hljs-string">'Content-Type: application/json'</span>,
            <span class="hljs-string">'Access-Id: '</span> . $this-&gt;accessId <span class="hljs-comment">// 必填头信息 </span>
        ]);
        <span class="hljs-title function_">curl_setopt</span>($ch, <span class="hljs-variable constant_">CURLOPT_RETURNTRANSFER</span>, <span class="hljs-literal">true</span>);
        
        $response = <span class="hljs-title function_">curl_exec</span>($ch);
        $curlErr = <span class="hljs-title function_">curl_error</span>($ch);
        <span class="hljs-title function_">curl_close</span>($ch);

        <span class="hljs-keyword">if</span> ($curlErr) {
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'error'</span> =&gt; <span class="hljs-string">'Curl Error: '</span> . $curlErr];
        }

        <span class="hljs-comment">// 4. 处理响应</span>
        $resArr = <span class="hljs-title function_">json_decode</span>($response, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isset</span>($resArr[<span class="hljs-string">'code'</span>]) &amp;&amp; $resArr[<span class="hljs-string">'code'</span>] == <span class="hljs-number">200</span> &amp;&amp; <span class="hljs-title function_">isset</span>($resArr[<span class="hljs-string">'data'</span>])) {
            <span class="hljs-comment">// 解密数据 </span>
            <span class="hljs-keyword">return</span> $this-&gt;<span class="hljs-title function_">decryptData</span>($resArr[<span class="hljs-string">'data'</span>]);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'error'</span> =&gt; $resArr[<span class="hljs-string">'message'</span>] ?? <span class="hljs-string">'API调用失败'</span>];
        }
    }
}

<span class="hljs-comment">// --- 调用演示 ---</span>
<span class="hljs-comment">// 请替换为您的真实 Access-Id 和 Key</span>
$client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TianyuanVehicleClient</span>(<span class="hljs-string">"YOUR_ACCESS_ID"</span>, <span class="hljs-string">"YOUR_16_BYTE_KEY_HERE"</span>);

$idCard = <span class="hljs-string">"11010119900101xxxx"</span>;
$name = <span class="hljs-string">"张三"</span>;

$result = $client-&gt;<span class="hljs-title function_">query</span>($idCard, $name);

<span class="hljs-comment">// --- 输出结果 ---</span>
echo <span class="hljs-string">"&lt;pre&gt;"</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-title function_">isset</span>($result[<span class="hljs-string">'error'</span>])) {
    echo <span class="hljs-string">"查询失败: "</span> . $result[<span class="hljs-string">'error'</span>];
} <span class="hljs-keyword">else</span> {
    echo <span class="hljs-string">"=== 查询成功 ===\n"</span>;
    echo <span class="hljs-string">"名下车辆数: "</span> . $result[<span class="hljs-string">'vehicleCount'</span>] . <span class="hljs-string">"\n"</span>; <span class="hljs-comment">// </span>
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">empty</span>($result[<span class="hljs-string">'list'</span>])) {
        foreach ($result[<span class="hljs-string">'list'</span>] <span class="hljs-keyword">as</span> $car) {
            echo <span class="hljs-string">"----------------\n"</span>;
            echo <span class="hljs-string">"车牌号: "</span> . $car[<span class="hljs-string">'plateNum'</span>] . <span class="hljs-string">"\n"</span>;
            echo <span class="hljs-string">"类型码: "</span> . $car[<span class="hljs-string">'vehicleType'</span>] . <span class="hljs-string">"\n"</span>;
            echo <span class="hljs-string">"颜色码: "</span> . $car[<span class="hljs-string">'plateColor'</span>] . <span class="hljs-string">"\n"</span>;
        }
    }
}
echo <span class="hljs-string">"&lt;/pre&gt;"</span>;
?&gt;
</code></pre>
<h2 data-id="heading-5">三、 核心数据结构解析</h2>
<p>PHP 的关联数组结构非常适合处理 API 返回的数据。<strong>天远API</strong> 的响应数据解密后包含两个核心字段：</p>
<ul>
<li><strong><code>vehicleCount</code></strong> (String): 这是一个简单的数字字符串，表示该身份证下关联的车辆总数。PHP 开发者可以直接用 <code>if ($res['vehicleCount'] &gt; 0)</code> 来判断用户是否有车。</li>
<li><strong><code>list</code></strong> (Array): 车辆明细列表。这是一个包含多条车辆信息的数组，每条记录都包含车牌号、颜色和车辆类型。如果用户无车，该数组可能为空。</li>
</ul>
<hr/>
<h2 data-id="heading-6">四、 字段详解（PHP 数组 Key 对照）</h2>
<p>为了方便开发者快速对照，以下表格详细列出了 PHP 数组中的 Key 及其对应的业务含义。</p>
<h3 data-id="heading-7">1. 车辆明细列表 (Keys in <code>$result['list']</code>)</h3>

























<table><thead><tr><th><strong>数组键名 (Key)</strong></th><th><strong>含义</strong></th><th><strong>PHP处理建议</strong></th></tr></thead><tbody><tr><td><strong>plateNum</strong></td><td>车牌号</td><td>可直接输出，如 "京A88888"</td></tr><tr><td><strong>plateColor</strong></td><td>车牌颜色</td><td>对应下表，建议建立映射数组转为中文</td></tr><tr><td><strong>vehicleType</strong></td><td>车辆类型</td><td>对应下表，关键字段，区分客车与货车</td></tr></tbody></table>
<h3 data-id="heading-8">2. 车牌颜色对照表 (plateColor)</h3>
<p>使用 PHP 数组映射可以快速将代码转换为前端显示的颜色标签。</p>



































<table><thead><tr><th><strong>Code</strong></th><th><strong>颜色/类型</strong></th><th><strong>业务判断逻辑示例</strong></th></tr></thead><tbody><tr><td><strong>0</strong></td><td>蓝色</td><td><code>if ($code == 0) echo '私家车';</code></td></tr><tr><td><strong>1</strong></td><td>黄色</td><td><code>if ($code == 1) echo '大型车/教练车';</code></td></tr><tr><td><strong>11</strong></td><td>绿色</td><td><code>if ($code == 11) echo '新能源车';</code></td></tr><tr><td><strong>2</strong></td><td>黑色</td><td>港澳/外籍车辆</td></tr><tr><td><strong>5</strong></td><td>黄绿双拼</td><td>大型新能源车</td></tr></tbody></table>
<h3 data-id="heading-9">3. 车辆类型对照表 (vehicleType)</h3>
<p>用于精准识别车辆用途，特别是在物流招募场景中。</p>

























<table><thead><tr><th><strong>Code</strong></th><th><strong>含义</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td><strong>1</strong></td><td>一型客车</td><td>≤9座，最常见的家用车型</td></tr><tr><td><strong>11 - 16</strong></td><td>货车系列</td><td>从一型到六型货车，数字越大载重越大</td></tr><tr><td><strong>21 - 26</strong></td><td>专项作业车</td><td>起重机、泵车等特种车辆</td></tr></tbody></table>
<h2 data-id="heading-10">五、 应用价值分析</h2>
<p>对于 PHP 开发者而言，接入 <strong>API</strong> 可以快速打通以下高价值场景：</p>
<ol>
<li>
<p><strong>物流司机线上招募（公众号开发）</strong>：
在司机报名的 H5 页面中，后端通过 PHP 调用 API 校验。如果返回的 <code>vehicleType</code> 是 11-16（货车）且 <code>plateColor</code> 为 1（黄牌），则自动通过“带车司机”认证；如果是 1（一型客车），则提示“车型不符”，极大提高审核效率。</p>
</li>
<li>
<p><strong>ETC 推广分销系统</strong>：
ETC 代理商系统可以通过 API 批量检测潜在客户。输入客户身份证，若 <code>vehicleCount &gt; 0</code> 且 <code>plateColor</code> 为 0（蓝牌）或 11（绿牌），则标记为“高意向客户”进行精准电话营销。</p>
</li>
<li>
<p><strong>小区门禁系统对接</strong>：
为物业开发的车辆管理系统中，通过 API 验证登记车辆是否确属业主名下。利用 <code>plateNum</code> 字段实现自动录入，避免人工输入车牌错误的尴尬，提升物业数字化水平。</p>
</li>
<li>
<p><strong>信贷风控辅助</strong>：</p>
<p>在小额贷前审核中，通过 API 快速验证申请人的资产实力。名下拥有多辆 <code>vehicleType=1</code>（一型客车）的用户通常具有更好的偿债能力。</p>
</li>
</ol>
<h2 data-id="heading-11">六、 总结</h2>
<p><strong>天远名下车辆车牌查询API</strong> 是车务数据领域的“瑞士军刀”。对于 PHP 开发者来说，它没有复杂的 SDK 依赖，通过简单的 <code>curl</code> 封装即可使用。</p>
<p>通过本文的 PHP 代码示例，您可以轻松完成数据的加密传输与解密解析。无论是开发简单的车主核验插件，还是构建复杂的物流调度平台。建议开发者利用 PHP 的灵活性，将此查询功能快速集成到现有的 CMS 或微信生态系统中，抢占车务数据服务市场。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vLLM 推理 GPU 选型指南：显存、KV Cache 与性能瓶颈全解析]]></title>    <link>https://juejin.cn/post/7598402961903796276</link>    <guid>https://juejin.cn/post/7598402961903796276</guid>    <pubDate>2026-01-23T09:35:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598402961903796276" data-draft-id="7598355220829585460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vLLM 推理 GPU 选型指南：显存、KV Cache 与性能瓶颈全解析"/> <meta itemprop="keywords" content="LLM,Agent,AIGC"/> <meta itemprop="datePublished" content="2026-01-23T09:35:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DigitalOcean"/> <meta itemprop="url" content="https://juejin.cn/user/2031553217827127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vLLM 推理 GPU 选型指南：显存、KV Cache 与性能瓶颈全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2031553217827127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DigitalOcean
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:35:39.000Z" title="Fri Jan 23 2026 09:35:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>为 vLLM 推理有效规划 GPU 规模并进行合理配置，首先需要清晰理解大语言模型处理的两个基本阶段——Prefill（预填充）和 Decode（解码），以及这两个阶段对硬件提出的不同需求。</p>
<p>本指南深入剖析了 vLLM 运行时行为的内部机制，阐明了内存需求、量化和张量并行等核心概念，并提供了将 GPU 选型与实际工作负载相匹配的实用策略。通过探究这些因素之间的相互作用，您将能够准确预判性能瓶颈，并在 GPU 基础设施上部署大型语言模型时，做出明智且具有成本效益的决策。</p>
<h3 data-id="heading-0"><strong>vLLM 运行时行为剖析：预填充阶段 vs 解码阶段</strong></h3>
<p><strong>预填充阶段（"读取"阶段）</strong></p>
<p>这是任何请求的第一步。vLLM 接收整个输入提示（用户查询 + 系统提示 + 任何 RAG 上下文），并以高度并行的方式一次性处理所有内容。</p>
<ul>
<li>​<strong>过程</strong>​：模型"读取"上下文，并用该上下文的数学表示填充键值（KV）缓存。</li>
<li>​<strong>瓶颈</strong>​：由于并行处理数千个令牌，此阶段几乎总是受限于内存带宽。速度上限取决于 GPU 将巨大的权重矩阵从显存移动到计算核心的速度。有关 GPU 性能特性的更多信息，请参阅我们的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.aidroplet.com%2Ftutorials%2Fgpu-optimization-deep-learning-guide%2F" target="_blank" title="https://blog.aidroplet.com/tutorials/gpu-optimization-deep-learning-guide/" ref="nofollow noopener noreferrer">GPU 性能优化指南</a>。</li>
<li>​<strong>实际影响</strong>​：这决定了首 Token 延迟（Time-To-First-Token）。如果要总结一个长达 10 万 Token 的庞大文档，预填充阶段就是让用户在第一个词出现前等待的原因。</li>
</ul>
<p><strong>解码阶段（"写入"阶段）</strong></p>
<p>预填充完成后，vLLM 进入自回归循环以生成输出。</p>
<ul>
<li>​<strong>过程</strong>​：模型生成一个 Token，将其附加到序列中，然后再次运行整个模型以生成下一个 Token。对于单个请求而言，这本质上是串行的。</li>
<li>​<strong>挑战</strong>​：仅为了计算单个用户的一个 Token 而从显存加载庞大的模型权重是极其低效的；GPU 在移动数据上花费的时间比计算还多。</li>
<li>​<strong>解决方案（连续批处理</strong>​​**）**​：为了解决这个问题，像 vLLM 这样的现代引擎不会逐个处理请求。相反，它们使用连续批处理。请求动态地进入和离开批处理批次。vLLM 在同一个 GPU 周期内，将新请求的预填充操作与进行中请求的解码步骤交错进行。</li>
<li>​<strong>瓶颈</strong>​：当有效进行批处理时，此阶段变为​<strong>计算受限</strong>​（受原始 TFLOPS 限制），因为目标是尽可能多地并行处理 Token 计算，以最大化总体吞吐量。</li>
</ul>
<p><strong>预填充阶段与解码阶段的对比</strong></p>
<ul>
<li>​<strong>主要瓶颈</strong>​：预填充阶段为内存带宽，解码阶段为计算能力。</li>
<li>​<strong>衡量指标</strong>​：预填充影响​<strong>首 Token 延迟</strong>​，解码影响​<strong>吞吐量</strong>​。</li>
<li>​<strong>并行性</strong>​：预填充阶段针对单个请求具有高并行性；解码阶段对单个请求是顺序的，但通过跨请求的连续批处理实现并行。
<img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=NDk4MmUxYTk2MjM3Y2I0MjAyNTFjNzA2ZjJlYjA0ZGNfUjR0Q3M2Wmx3OUZIUlNuTGdqWVRPRkZiWHh0YUNDZFRfVG9rZW46UjNQQmJub0c2bzZSSml4UHdhY2NjVGE1bmRnXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-1"><strong>将阶段与工作负载及硬件关联</strong></h3>
<p>了解哪个阶段在您的工作负载中占主导地位，对于选择合适的硬件至关重要。</p>























<table><thead><tr><th>运行时阶段</th><th>主要操作</th><th>主要硬件约束</th><th>主要用例场景</th></tr></thead><tbody><tr><td><strong>预填充阶段</strong></td><td>并行处理长输入。</td><td>​<strong>内存带宽</strong>​（TB/s）（对快速 TTFT 至关重要）</td><td>• RAG• 长文档摘要 • 大规模少样本提示</td></tr><tr><td><strong>解码阶段</strong></td><td>顺序生成输出。</td><td>​<strong>计算能力</strong>​（TFLOPS）（对快速 Token 生成至关重要）</td><td>• 交互式聊天与客服 • 实时代码生成 • 多轮智能体工作流</td></tr></tbody></table>
<p><strong>运行时的 ​KV</strong>​<strong>​ Cache</strong></p>
<p>在推理过程中，vLLM 高度依赖 KV Cache，用来避免重复计算已经完成的工作。</p>
<h4 data-id="heading-2">工作机制</h4>
<p>在 Transformer 中，每个 token 都会在注意力层内被转换为 <strong>Key（K）</strong> 和 <strong>Value（V）</strong> 向量。 如果没有缓存机制，模型在生成第 <em>t+1</em> 个 token 时，就必须重新处理整个历史序列（token 0 … t）。</p>
<p><strong>解决方案：KV Cache</strong></p>
<p>KV Cache 的作用正是把这些已经计算过的 K / V 向量保存下来并重复利用。</p>
<ul>
<li>Prefill 阶段： vLLM 会一次性为所有输入提示词计算 K / V，并立即写入缓存。</li>
<li>Decode 阶段：每生成一个新 token，只需从缓存中读取历史 K / V，并仅为这个新 token 计算新的 K / V。</li>
</ul>
<h4 data-id="heading-3">带来的收益</h4>
<p>这种机制将注意力计算：</p>
<ul>
<li>从<strong>近似二次复杂度</strong>（为了写下每一个字，都要把整本书重新读一遍）</li>
<li>转变为<strong>线性复杂度</strong>（只需要写下下一个字）</li>
</ul>
<h4 data-id="heading-4">代价：动态内存增长</h4>
<p>性能提升的代价是 ​<strong>显存占用</strong>​。</p>
<p>每生成一个新 token，KV Cache 中都会追加新的条目。运行时，KV Cache 的使用量会随着以下因素动态增长：</p>
<ul>
<li><strong>Prompt 长度与输出长度</strong>对话越长，占用的 VRAM 越多。</li>
<li>​<strong>并发请求数（Concurrency</strong>每一个活跃请求都需要自己独立的一份 KV Cache。</li>
<li><strong>模型规模</strong>模型越深（层数越多）、越宽（注意力头越多），​<strong>每个 token 所需的缓存就越大</strong>​。</li>
</ul>
<p>这正是为什么人们经常说，使用<strong>同一个模型</strong>的两个工作负载，可能对硬件的需求却天差地别。</p>
<p>例如：一个 <strong>70B 模型</strong> 本身也许能放进单张 GPU，但如果在长对话中 KV Cache 持续膨胀，服务器仍然可能因为 <strong>​显存​耗尽（<strong>​​</strong>OOM）而直接崩溃</strong>​。</p>
<p>因此，在生产环境中，<strong>理解并管理内存</strong>​​<strong>行为是部署 LLM 的核心能力之一</strong>​，这一点在我们卓普云官网博客中的《<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.aidroplet.com%2Ftutorials%2Fbudget-llm-finetune%2F" target="_blank" title="https://blog.aidroplet.com/tutorials/budget-llm-finetune/" ref="nofollow noopener noreferrer">LLM 微调与部署指南</a>》中也有详细说明。</p>
<p><img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=ODFjOWUxYjU0ZGQ0ZmM4NmQxMmJhMmY2YjNmMzE2NzNfZTkyMEhUZzdMSndwSk1PTWE4ME93aDJnV1JpdDdxWDFfVG9rZW46QmlrWWJ5SUp3b1ExcXV4enhkV2NmRzdybjZmXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">资源配置基础：模型、精度与硬件如何决定适配性</h3>
<p>理解 vLLM 的运行时行为后，下一步是确定模型能否在给定 GPU 上运行，以及它能支持怎样的并发级别或上下文长度。</p>
<p>本节将提供所需的数学公式与决策树，用于计算静态内存需求、估算 KV 缓存增长，并系统性地排查和确定适配问题。</p>
<h3 data-id="heading-6">GPU 硬件特性与约束</h3>
<p>在计算模型大小之前，首先必须理解我们要把模型放进的“容器”是什么。不同的 GPU 在可行性与性能上都有各自明确的硬性限制。</p>
<h4 data-id="heading-7">常见数据中心 GPU 的显存容量</h4>
<p>以下是当前主流推理 GPU 的<strong>物理显存</strong>​​<strong>上限</strong>​，也是模型部署时不可突破的硬限制。</p>
<p>vLLM 推理与训练的 GPU 对比：</p>
<p>即使模型本身能够装入显存，​<strong>GPU​ 架构差异仍会显著影响 vLLM 的实际性能</strong>​。需要重点关注以下指标：</p>
<h2 data-id="heading-8">模型权重占用（静态显存）</h2>
<p>在 vLLM 能够对外提供推理服务之前，模型必须先将全部权重加载进 GPU 显存（VRAM）。</p>
<p>权重大小完全取决于模型的参数数量以及所选择的数值精度。</p>
<h3 data-id="heading-9">静态权重计算公式</h3>
<p>模型所需的显存容量（GB）可以使用以下公式进行估算：</p>
<p><strong>​显存​（<strong>​</strong>GB）≈ 参数量（十亿） × 每个参数所占字节数</strong></p>
<p>下表展示了 Llama 3.1 70B（700 亿参数）模型在不同量化精度下的显存占用情况：</p>
<p>精度选择是决定模型是否可部署的​<strong>最关键因素​</strong>​。</p>
<p>将一个 70B 模型从 FP16 量化为 INT4，可将静态显存占用减少 ​**75%**​，使其从“单节点无法运行”变为“可在单张 A100 上运行”。</p>
<p>因此，在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fgpu%2F" target="_blank" title="https://www.aidroplet.com/product/gpu/" ref="nofollow noopener noreferrer">DigitalOcean GPU 服务器</a>等云环境中，量化是实现高性价比部署的必要手段。</p>
<h2 data-id="heading-10">KV Cache 需求（动态显存）</h2>
<p>如果说模型权重决定模型是否能够启动，那么 ​<strong>KV​ Cache 决定模型是否能够扩展</strong>​。</p>
<p>KV Cache 往往被严重低估，这也是推理负载下最常见的 OOM 原因之一。</p>
<p>要准确评估部署规模，必须根据预期的上下文长度与并发请求数，估算 KV Cache 的显存消耗。</p>
<h4 data-id="heading-11"><strong>“现场经验法则”（快速估算）</strong></h4>
<p>在大多数实际业务场景中，精确公式并不适合即时计算。</p>
<p>因此通常采用“<strong>每 token ​显存</strong>​​<strong>系数</strong>​”的方法进行估算，该方式足以支撑初步容量判断。</p>
<p><strong>简化 ​KV</strong>​<strong>​ Cache 公式：</strong></p>
<p><strong>KV​ Cache 总</strong>​<strong>​显存​（<strong>​</strong>MB） = Token 总数 × 显存系数</strong></p>
<p>其中：<strong>Token 总数 = 上下文长度 × 并发请求数</strong></p>
<p>标准显存系数如下表所示：</p>
<h4 data-id="heading-12">示例</h4>
<p>我们假设，某用户计划运行：</p>
<ul>
<li>模型：Llama 3 70B</li>
<li>上下文长度：32k</li>
<li>并发用户数：10</li>
</ul>
<p><strong>​计算 Token 总数：​</strong>32,000 × 10 = <strong>320,000 tokens</strong></p>
<p><strong>​套用标准系数（0.35）：​</strong>320,000 × 0.35 MB = <strong>112,000 MB ≈ 112 ​GB</strong></p>
<p><strong>​FP8 选项验证：​</strong>若启用 FP8 量化缓存，显存占用将降至一半：约<strong>​ 56 ​GB</strong></p>
<h5 data-id="heading-13"><strong>最终配置方案：</strong></h5>
<ul>
<li>FP16 缓存方案：112 GB KV 缓存 + 140 GB 模型权重 = 总计 252 GB（需 4 块 H100 GPU）</li>
<li>FP8 缓存方案：56 GB KV 缓存 + 140 GB 模型权重 = 总计 196 GB （可部署于​<strong>3 块 H100</strong>​；若模型权重同步量化，<strong>2 块 H100</strong> 亦可勉强容纳）</li>
</ul>
<p><strong>精确计算工具与公式</strong></p>
<p>针对边界场景或深度验证，请使用专业公式或在线计算器：</p>
<ul>
<li>在线工具：<a href="https://link.juejin.cn?target=https%3A%2F%2Flmcache.org%2Fkv-calculator" target="_blank" title="https://lmcache.org/kv-calculator" ref="nofollow noopener noreferrer">LMCache KV Calculator</a></li>
<li>标准公式：</li>
</ul>
<pre><code class="hljs language-Markdown" lang="Markdown">总KV缓存 (GB) = (2 × 模型层数 × 模型维度 × 序列长度 × 批大小 × 精度字节数) / 1024³
</code></pre>
<h2 data-id="heading-14">何时需要使用 Tensor Parallelism（张量并行）</h2>
<p>Tensor Parallelism（TP）是一种将模型权重矩阵拆分到多张 GPU 上的技术。</p>
<p>它可以让 vLLM 将多张 GPU 视为一张“逻辑大卡”，共享显存资源。</p>
<p>为什么要使用张量并行？张量并行的主要目标是​<strong>可行性，而非性能优化</strong>​。</p>
<p>通常在以下场景中启用：</p>
<p>1、模型权重超限：模型体量超过单卡物理承载极限（例如：24GB 显存的 GPU 无法加载 Llama 3 70B 模型）</p>
<p>2、KV 缓存空间耗尽：模型权重虽可加载，但未预留任何 KV 缓存空间，导致无法处理长上下文或高并发请求</p>
<p>虽然张量并行（TP）能极大释放显存，但它也引入了通信开销。在每一层计算完成后，所有 GPU 必须同步它们的部分计算结果。</p>
<ul>
<li>单 GPU 适配情况：如果一个模型能在单张 GPU 上运行，那么使用单 GPU 几乎总是比使用双 GPU 更快，因为它完全避免了通信开销。</li>
<li>互联依赖：TP 的性能高度依赖于高速的 GPU 间通信带宽。如果在没有 NVLink 的显卡上使用 TP（例如仅通过标准 PCIe 连接），由于同步延迟，推理速度可能会显著下降。</li>
</ul>
<p>若需部署多 GPU 环境，可考虑使用 DigitalOcean Kubernetes 来编排 vLLM 服务。</p>
<h3 data-id="heading-15"><strong>数值实测：资源配置场景分析</strong></h3>
<p>在进入高级配置前，让我们将前几节的数学计算应用到实际场景中。这有助于验证我们对“适配性”的理解，并揭示纯计算中常被忽略的实际约束。</p>
<p><strong>隐藏的显存开销</strong></p>
<p>一个常见的错误是计算 ` 权重 + 缓存 = 总显存需求`，并假设可以达到 100% 的利用率。实际情况并非如此。</p>
<ul>
<li>​<strong>CUDA上下文与运行时开销</strong>​：GPU 驱动、PyTorch 和 vLLM 运行时本身就需要预留内存来初始化（通常为 2-4 GB）。</li>
<li>​<strong>激活缓冲区</strong>​：前向传播过程中用于存储中间计算结果的临时空间。</li>
<li>​<strong>安全配置原则</strong>​：务必预留<strong>约 4-5 ​GB</strong>​<strong>的显存</strong>作为“不可用”的系统开销。如果你的计算结果显示仅剩 0.5 GB 可用，服务器很可能会崩溃。</li>
</ul>
<p><strong>场景 A：轻松适配（标准聊天）</strong></p>
<ul>
<li>​<strong>硬件</strong>​：1x NVIDIA L40S（48 GB 显存）</li>
<li>​<strong>模型</strong>​：Llama 3 8B（FP16 精度）</li>
<li>​<strong>计算</strong>​：
<ul>
<li>权重：80 亿参数 x 2 字节 = <strong>16 ​GB</strong></li>
<li>系统开销：<strong>-4 ​GB</strong></li>
<li>可供缓存的剩余显存：48 - 16 - 4 = <strong>28 ​GB</strong></li>
<li>缓存容量估算：28,000 MB / 0.15 MB 每 Token = <strong>约 186,000Token</strong></li>
</ul>
</li>
</ul>
<p>​<strong>结论</strong>​：<strong>​适配极佳。​</strong>此配置可应对大规模负载（例如，60 个并发用户，每人 3k 上下文）。</p>
<p>​<strong>结果</strong>​：高吞吐量，低成本。</p>
<p><img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=NjJjNGMzZmFhODM3MjdjOWQ2ZDIzNmUyYjk0MmE3MjBfRzhWUzdRUWdvMzJ1T2pSeXJFN2lOMFFRd20xSVl1SFZfVG9rZW46UWlwZWIwYm5hb0owQWt4aDRpcWN0c05ybk9nXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></p>
<p>​<strong>场景 B：“权重超标”（大模型</strong>​​**，单GPU<strong>​</strong>）**</p>
<ul>
<li>​<strong>硬件</strong>​：1x NVIDIA H100（80 GB 显存）</li>
<li>​<strong>模型</strong>​：Llama 3 70B（FP16 精度）</li>
<li>​<strong>计算</strong>​：</li>
</ul>
<p>权重：700 亿参数 x 2 字节 = <strong>140 ​GB</strong></p>
<p>​<strong>结论</strong>​：<strong>​完全无法适配。​</strong>模型权重（140 GB）已超过 GPU 物理容量（80 GB）。</p>
<p><strong>​要想解决这个问题，​</strong>必须使用​<strong>张量并行</strong>​​**（2x ​GPU<strong>​</strong>）** 或<strong>量化</strong>技术（见第 3 节）。</p>
<p><img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=YTBiMDBkNmIyZGJhZDc4MGU1ODhmYzA3ZjIyNzQwODZfaDg0djlaZnNZcnlUdDU2Z1VscHBKWjQxa3FEaVlaVFlfVG9rZW46WVZqaGJBalVWb2dETTN4VHRYa2NqY2l3bktaXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></p>
<p><strong>场景 C：“缓存陷阱”（模型能加载，但无法运行）</strong></p>
<ul>
<li>​<strong>硬件</strong>​：1x NVIDIA H100（80 GB 显存）</li>
<li>​<strong>模型</strong>​：Llama 3 70B（FP8 量化精度）</li>
<li>​<strong>计算</strong>​：
<ul>
<li>权重：700 亿参数 x 1 字节 = <strong>70 ​GB</strong></li>
<li>系统开销：<strong>-4 ​GB</strong></li>
<li>可供缓存的剩余显存：80 - 70 - 4 = <strong>6 ​GB</strong></li>
<li>缓存容量估算：6,000 MB / 0.175 MB 每 Token (FP8) = <strong>总计约 34,000Token</strong></li>
</ul>
</li>
</ul>
<p>​<strong>结论</strong>​：<strong>​有风险 / 适配性差。​</strong>模型可以加载，但几乎没有可用的工作空间。</p>
<p>如果现在有 10 个并发用户，每人仅能分配到约 3.4k 上下文。一旦有用户粘贴长文档（4k Token），系统就会因显存不足而崩溃。</p>
<p><strong>这个场景给我们一个启发，即权重能放下，不代表工作负载能运行。</strong> 此场景通常需要增加 GPU 或选择更小的模型。</p>
<p><img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=NDFkNWI0YWU3NGI5NmEyMzVhNTczMGJlZmRiNTE3MmJfUjY3Qklab2dlU1NBb3lqWEFYRXlzdG85RUZ1ZWhTMnpfVG9rZW46WlFNOGJnS0Z2b1F0N1R4VXRETmNMTndKbm9kXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></p>
<p><strong>场景 D：解决方案（张量</strong>​<strong>并行）</strong></p>
<p>让我们通过增加第二张 GPU 来解决场景 C 中的“缓存陷阱”。这展示了张量并行（TP）如何整合内存资源。</p>
<ul>
<li>​<strong>硬件</strong>​：2x NVIDIA H100（每张 80 GB 显存 = 总计 160 GB 可用）</li>
<li>​<strong>模型</strong>​：Llama 3 70B（FP8 量化精度）</li>
<li>​<strong>计算</strong>​：
<ul>
<li>总可用显存：<strong>160 ​GB</strong></li>
<li>权重：​**-70 ​GB**​（分摊到两张 GPU 上）</li>
<li>系统开销：​**-8 ​GB**​（每张 GPU 约 4 GB）</li>
<li>可供缓存的剩余显存：160 - 70 - 8 = <strong>82 ​GB</strong></li>
<li>缓存容量估算：82,000 MB / 0.175 MB 每 Token (FP8) = <strong>总计约 468,000Token</strong></li>
</ul>
</li>
</ul>
<p>​<strong>结论</strong>​：<strong>​可用于生产环境。​</strong>通过增加第二张 GPU，我们从“仅有风险性的 6 GB”缓存空间，提升到了“充裕的 82 GB”。</p>
<p>对于 10 个并发用户情况，现在每人可获得约​<strong>46k 上下文</strong>​。显存不足的风险已消除，该部署可以轻松应对 RAG 或长文档处理。</p>
<p><img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=ZThkMzQzNGE3YTQ3ZDdiMzEyNGVmMWQzMjhjODlhMWJfTUc1aUx5RVo4b2tFN2NVejljcThEVTlnTmdCTGdpd3lfVG9rZW46VUV1QmJ2blM5b3B6Sm94a21RUGN3d3Z2bkRoXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">量化：“压缩”模型的艺术</h3>
<p>正如前文资源配置场景所示，VRAM 是 LLM 推理的主要瓶颈。量化是一种通过降低数字表示精度的技术，用微小的精度损失换取内存效率和速度的大幅提升。</p>
<p>关键在于区分 vLLM 中使用的两种量化类型，因为它们针对不同的约束条件。</p>
<p><strong>类型一：模型权重量化（"静态"优化方案）</strong></p>
<p>这涉及在加载预训练模型之前，对其庞大、静态的权重矩阵进行压缩。</p>
<ul>
<li>​<strong>目的</strong>​：使模型能够适配到其全精度权重原本会超过 VRAM 容量的 GPU 上。</li>
<li>​<strong>vLLM 实现方式</strong>​：虽然 vLLM 可以在启动时动态量化权重，但通常更高效的做法是直接加载已经使用 AWQ（激活感知权重量化）或 GPTQ 等高性能内核预量化好的模型。这些专用格式相比通用的即时转换，能提供更好的精度保持和更快的解码速度。</li>
<li>​<strong>影响</strong>​：将静态 VRAM 占用减少 50%（FP8/INT8）至 75%（INT4/AWQ），从而显著增加用于 KV 缓存的剩余 VRAM。</li>
</ul>
<p><strong>类型二：KV</strong>​<strong>缓存量化（"动态"优化方案）</strong></p>
<p>这涉及在序列生成过程中，对存储在内存中的中间键（Key）和值（Value）状态进行压缩。</p>
<ul>
<li>​<strong>目的</strong>​：使模型能够扩展以支持更高的并发批处理量或更长的上下文窗口。</li>
<li>​<strong>vLLM 实现方式</strong>​：通过运行时参数 (--kv-cache-dtype) 控制。</li>
<li>​<strong>建议</strong>​：对于支持 FP8 张量核心的现代硬件（如 NVIDIA H100, L40S, AMD MI300X，在 DigitalOcean 云平台上你可以找到这些 GPU 服务器，而且价格低于 AWS、谷歌云 GCP，详情可咨询 DigitalOcean 中国区独家战略合作伙伴<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fgpu%2F" target="_blank" title="https://www.aidroplet.com/product/gpu/" ref="nofollow noopener noreferrer">卓普云 AI Droplet</a>。），<strong>强烈建议启用 FP8 ​KV</strong>​​<strong>缓存</strong>​。它能以对模型质量几乎可忽略的影响，将可用上下文容量翻倍。</li>
<li>​<strong>影响</strong>​：将第 2 节中讨论的每个 token 的内存需求减半（例如，将 70B 模型的乘数从约 0.35 MB/token 降至约 0.175 MB/token）。</li>
</ul>
<p><strong>vLLM ​GPU</strong>​<strong>精度格式</strong></p>
<p>并非所有量化格式都是相同的。选择取决于可用的硬件架构以及模型大小与精度之间的期望平衡。</p>








































<table><thead><tr><th>精度 / 格式</th><th>每个参数占用字节数</th><th>精度影响</th><th>最佳硬件支持</th><th>推荐使用场景</th></tr></thead><tbody><tr><td><strong>FP16​ / BF16 (基准)</strong></td><td>2</td><td>无（参考标准）</td><td>所有现代 GPU</td><td>​<strong>黄金标准</strong>​。在 VRAM 容量允许时优先使用。</td></tr><tr><td>​<strong>FP8 (8 位浮点数</strong>​**)**</td><td>1</td><td>可忽略</td><td>H100, H200, L40S, MI300X</td><td>​<strong>现代默认选择</strong>​。在新硬件上速度与质量的最佳平衡。KV 缓存理想选择。</td></tr><tr><td><strong>AWQ / GPTQ (INT4 变体)</strong></td><td>~0.5</td><td>低/中</td><td>A100, L40S, 消费级显卡</td><td>​**“极致压缩”选项**​。在较旧或较小 GPU 上运行大模型的必备技术。解码速度优异。</td></tr><tr><td><strong>通用 INT8</strong></td><td>1</td><td>中</td><td>旧款 GPU (V100, T4)</td><td>​<strong>传统方案</strong>​。在新硬件上通常被 FP8 取代，或在追求极限压缩时被 AWQ 取代。</td></tr></tbody></table>
<p><img src="https://dvi5wsyvaxw.feishu.cn/space/api/box/stream/download/asynccode/?code=YWJhZjM4ODk3ODAzMmY1MzE0OTA4MDJkNDA1ZjE3NGZfWnF3bVFhdU5SZjFmZ1JEekRveUQzVDRyMEY5THdRZ3NfVG9rZW46VHlma2Jycnhkb3ZlR0l4QjNuRGNnMHBoblBkXzE3NjkxNTkzNzY6MTc2OTE2Mjk3Nl9WNA" alt="" loading="lazy"/></p>
<p><strong>策略性应用与权衡</strong></p>
<p>决定何时应用量化需要在实际约束与工作负载敏感性之间取得平衡。量化虽强大，但涉及在部署规划时必须考虑的根本性权衡。</p>
<p><strong>关键考量因素：精度与硬件</strong></p>
<p>在确定具体场景前，请考虑以下两个基础约束：</p>
<ol>
<li>​<strong>精度 vs. 压缩率</strong>​：激进的量化（如 INT4）可能会降低在涉及复杂推理或代码生成的敏感任务上的性能。对于大多数聊天和 RAG 用例，FP8 通常被认为是安全的。</li>
<li>​<strong>硬件兼容性</strong>​：所选格式必须与硬件能力匹配。例如，FP8 量化需要配备 FP8 张量核心的 GPU（NVIDIA Ada/Hopper 或 AMD CDNA3 架构）才能实现性能提升。</li>
</ol>
<p><strong>何时应推荐使用量化</strong></p>
<p>基于上述权衡，量化适用于广泛的现实场景，并且在企业环境中经常是默认选择：</p>
<ul>
<li><strong>无法以FP16</strong>​​<strong>格式运行的大模型</strong>​：对于 70B 级别的大模型，要在单张 48GB 或 80GB GPU 上部署，INT4/INT8 通常是唯一途径。</li>
<li>​<strong>高并发工作负载</strong>​：减少的 VRAM 占用为 KV 缓存释放了大量空间，从而支持更多活跃序列和更长的提示词。</li>
<li>​<strong>RAG 和企业聊天应用</strong>​：这些工作负载通常能很好地容忍微小的精度偏差，而不会影响最终用户体验。</li>
<li>​<strong>成本优化</strong>​：量化使得工作负载可以在更小、更便宜的 GPU 型号上运行，同时保持可接受的性能。这在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fgpu%2F" target="_blank" title="https://www.aidroplet.com/product/gpu/" ref="nofollow noopener noreferrer">DigitalOcean GPU Droplets</a> 上部署时也很有价值，因为您可以根据具体需求来平衡性能与成本。</li>
</ul>
<p><strong>何时应避免使用量化</strong></p>
<p>量化并非普遍适用。有些工作负载对精度损失高度敏感，应尽可能保持在 FP16/BF16 精度：</p>
<ul>
<li>​<strong>代码生成与调试</strong>​：较低的精度可能会削弱结构化推理能力，导致细微的语法错误或逻辑缺陷。</li>
<li>​<strong>数学、金融和科学查询</strong>​：需要精确计算的任务显著受益于更高精度的格式，以避免舍入误差。</li>
<li><strong>评估、基准测试</strong>​​<strong>或回归测试</strong>​：微小的精度漂移可能导致不同模型版本或设置之间的比较失效。</li>
<li><strong>涉及多步推理的智能体</strong>​​<strong>工作流</strong>​：多个步骤中的累积误差可能会降低系统的整体可靠性和任务完成率。</li>
</ul>
<h3 data-id="heading-17"><strong>整合实践：从需求到部署方案</strong></h3>
<p>至此，我们已经探讨了 vLLM 的运行时行为（第 1 节）、内存基础原理（第 2 节）以及量化策略（第 3 节）。</p>
<p>本节将这些概念连接成一个可重复的决策框架。它将引导你从理论走向实践，提供一个结构化的工作流程，用于评估可行性、选择硬件并制定部署计划。</p>
<p><strong>第一步：资源配置需求问卷</strong></p>
<p>要准确配置 vLLM 部署，必须从工作负载描述中提取具体的技术细节。像“快速推理”这样的抽象目标是不够的。使用以下五个问题来收集必要的数据：</p>
<ol>
<li><strong>“您需要支持的最大上下文长度是多少？”</strong>
​<strong>原因​</strong>​：决定 KV 缓存大小（进而决定 OOM 风险）。</li>
<li><strong>“您的目标并发量（同时在线用户数）是多少？”</strong>
​<strong>原因​</strong>​：KV 缓存需求会成倍增加。</li>
<li><strong>“可接受的延迟是多少（首 Token 时间TTFT</strong>​<strong>和每秒生成 Token 数）？”</strong>
​<strong>原因​</strong>​：决定您是需要高带宽（H100）还是仅需足够容量（L40S）。</li>
<li><strong>“模型精度是否关键（数学/代码），还是‘够用就好’即可（聊天）？”</strong>
​<strong>原因​</strong>​：决定您是否可以使用量化（INT4/FP8）来节省成本。</li>
<li><strong>“您是否有严格的预算限制？”</strong>
​<strong>原因​</strong>​：帮助在优化极致速度（H100）与性价比（L40S）之间做出抉择。</li>
</ol>
<p><strong>第二步：选择模型大小与精度</strong></p>
<p>需求明确后，确定能满足质量要求的最小的模型和最高的精度。</p>
<ul>
<li>
<p>​<strong>精度是调节杠杆</strong>​：更低的精度（INT4/FP8）使得在更便宜的硬件上运行大模型成为可能。</p>
</li>
<li>
<p>​<strong>70B 法则​</strong>：FP16 精度的 70B 模型需要特殊硬件（多 GPU）。而 INT4 精度的同一模型则可以在普通硬件（单 GPU）上运行。</p>
</li>
<li>
<p>​<strong>指导原则</strong>​：
​<strong>聊天/助理</strong>​：使用 INT4 或 FP8。</p>
<p>​<strong>代码/推理</strong>​：使用 FP16 或 FP8（避免 INT4）。</p>
</li>
</ul>
<p><strong>第三步：硬件可行性检查</strong></p>
<p>使用第 2 节的数学方法进行适配性验证。</p>
<ol>
<li>
<p>​<strong>静态适配（权重）<strong>​：参数量 * 精度字节数 是否能在 VRAM 中放下？
​</strong>如果不能</strong>​：进行量化（第二步）或增加 GPU（张量并行）。</p>
</li>
<li>
<p>​<strong>动态适配（缓存）<strong>​：是否有足够空间容纳 上下文长度 * 并发数 * 每 Token 内存系数？
​</strong>如果不能</strong>​：降低并发数、缩短上下文长度，或启用 FP8 KV 缓存。</p>
</li>
<li>
<p>​<strong>工作负载适配（带宽）<strong>​：
​</strong>长文本 RAG/摘要</strong>​：需要高带宽（H100/A100）。</p>
<p>​<strong>标准聊天</strong>​：需要高算力（L40S）。</p>
</li>
</ol>
<p><strong>第四步：推荐GPU</strong>​<strong>策略</strong></p>
<p>可行性确认后，选择具体的 GPU 型号。可参考以下“速查表”应对常见场景。DigitalOcean 平台可提供以下表格中所有型号的 GPU（其中 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fb300%2F" target="_blank" title="https://www.aidroplet.com/product/b300/" ref="nofollow noopener noreferrer">B300 GPU</a> 将在 2026 年初上线，可联系卓普云 AI Droplet 进行预约测试）。</p>
<p><strong>第五步：使用指标进行验证</strong></p>
<p>纸上计算并非完美。</p>
<ul>
<li>​<strong>检查TTFT</strong>​：如果过高，说明预填充阶段存在瓶颈（带宽饱和）。</li>
<li>​<strong>检查 Token 间延迟</strong>​：如果过高，可能是批次大小设置过于激进（计算饱和）。</li>
<li><strong>检查KV</strong>​​<strong>缓存使用率</strong>​：如果持续 &gt;90%，则存在 OOM 风险，应启用分块预填充或降低并发数。</li>
</ul>
<h3 data-id="heading-18"><strong>常见问题解答</strong></h3>
<p><strong>1. 运行LLM</strong>​<strong>推理需要多少GPU</strong>​<strong>显存？</strong></p>
<p>GPU 显存需求取决于模型大小、精度、上下文长度和并发量。一个粗略的经验法则是：仅就权重而言，FP16 模型每 10 亿参数约需要 2GB。因此，一个 70B 的模型，FP16 权重需要 140GB，但使用 INT4 量化后仅需 35GB。此外，还必须考虑 KV 缓存的内存占用，它会随上下文长度和并发用户数增长。例如，对于一个 70B 模型，32k 上下文长度和 10 个并发用户，FP16 缓存约需 112GB，而 FP8 缓存约需 56GB。</p>
<p><strong>2. vLLM 中张量</strong>​<strong>并行与流水线并行有何区别？</strong></p>
<p>​<strong>张量并行</strong>​：将模型权重矩阵在同一层内切分到多个 GPU 上，允许多个 GPU 同时处理同一计算。这整合了显存资源，但需要在每层计算后进行同步，从而引入通信开销。</p>
<p>​<strong>流水线并行</strong>​：将模型各层按顺序分配到不同 GPU 上，每个 GPU 处理不同的层。</p>
<p>TP 通常用于单个 GPU 无法容纳整个模型时，而 PP 更常见于训练场景。对于推理任务，当模型超出单 GPU 容量时，TP 是标准的处理方法。</p>
<p><strong>3. 在 vLLM 部署中，何时应使用量化技术？</strong></p>
<p>在以下情况推荐使用量化：模型无法在可用显存中加载时；需要支持更高并发或更长上下文窗口时；或者成本优化是优先考虑事项时。FP8 量化是现代硬件（H100, L40S, MI300X）的理想选择，精度损失极小。INT4 量化是在较小 GPU 上运行大模型的必要手段，但在代码生成、数学及科学计算等对精度敏感的任务中应避免使用。对于聊天和 RAG 类工作负载，量化通常是默认选择。</p>
<p><strong>4. 如何计算KV</strong>​<strong>缓存的内存</strong>​<strong>需求？</strong></p>
<p>可以使用<strong>每 token 乘数法</strong>进行快速估算：将总 token 数（上下文长度 × 并发量）乘以模型特定的系数。对于小型模型（7B-14B），FP16 缓存系数约为 0.15 MB/token，FP8 约为 0.075 MB/token。对于大型模型（70B-80B），FP16 缓存系数约为 0.35 MB/token，FP8 约为 0.175 MB/token。如需精确计算，可使用公式：总 KV 缓存 = (2 × 层数 × 模型维度 × 序列长度 × 批次大小 × 精度字节数) / (1024³)，或使用在线工具如 LMCache KV Calculator。</p>
<p><strong>5. 我可以在 DigitalOcean ​GPU</strong>​<strong>​ Droplets 上运行 vLLM 吗？</strong></p>
<p>可以，vLLM 可以部署在 DigitalOcean GPU Droplets 上。DigitalOcean 提供的搭载 NVIDIA GPU 的 Droplets 能够满足 vLLM 的运行要求。部署时，请确保所选 GPU 的显存足以支撑您的模型大小和工作负载。对于追求成本效益的部署，可以考虑使用量化模型（INT4 或 FP8）以便在较小的 GPU 实例上运行更大的模型。DigitalOcean 的 GPU Droplets 提供 NVLink 连接，这在多 GPU 使用张量并行时对保证效率至关重要。</p>
<h3 data-id="heading-19"><strong>vLLM ​GPU</strong>​<strong>推理的实际应用场景</strong></h3>
<p>基于对模型大小、精度、GPU 架构、KV 缓存及批处理等因素如何影响性能的基础理解，在接下来的教程中，我们将把这些概念应用到实际的 vLLM 工作负载中。</p>
<p>针对每个用例，我们将围绕三个核心问题来确定最优配置方案：</p>
<ol>
<li>​<strong>工作负载定义</strong>​：其核心特征是什么？（例如，提示词长度与输出长度、并发量、延迟敏感性）。</li>
<li>​<strong>资源配置优先级</strong>​：哪些因素是瓶颈？（例如，权重与 KV 缓存之争、带宽与算力之争）。</li>
<li>​<strong>配置模式</strong>​：哪些具体的参数设置和硬件选择能确保稳定可靠的性能？</li>
</ol>
<p><strong>用例一：交互式聊天与智能助手</strong></p>
<ul>
<li>​<strong>关注点</strong>​：​**低延迟（受解码阶段限制）**​。</li>
<li>​<strong>目标</strong>​：为用户提供流畅的流式输出和快速的“打字速度”体验。</li>
<li>​<strong>关键约束</strong>​：<strong>计算能力</strong>与​<strong>Token 间延迟</strong>​。</li>
</ul>
<p><strong>用例二：高吞吐量</strong>​<strong>批处理</strong></p>
<ul>
<li>​<strong>关注点</strong>​：​<strong>最大吞吐量</strong>​​**（受计算限制）**​。</li>
<li>​<strong>目标</strong>​：为离线任务（如摘要生成）实现每小时处理数百万 Token。</li>
<li>​<strong>关键约束</strong>​：​<strong>系统总吞吐量</strong>​。</li>
</ul>
<p><strong>用例三：RAG 与长上下文推理</strong></p>
<ul>
<li>​<strong>关注点</strong>​：<strong>上下文容量（受内存</strong>​​**限制）**​。</li>
<li>​<strong>目标</strong>​：将海量文档或历史记录加载到内存中而不致崩溃。</li>
<li>​<strong>关键约束</strong>​：<strong>显存容量</strong>与​<strong>内存带宽</strong>​。</li>
</ul>
<h3 data-id="heading-20"><strong>小结</strong></h3>
<p>为 vLLM 合理配置 GPU 资源，需要深入理解模型大小、精度、上下文长度和并发量之间的根本性权衡。预填充阶段和解码阶段对硬件有不同的需求：预填充阶段需要高内存带宽，而解码阶段则需要高计算吞吐量。量化技术是在现有硬件上运行大型模型的核心调节手段，而张量并行则能突破单 GPU 的限制，实现横向扩展。</p>
<p>成功部署的关键在于​<strong>将您的工作负载特性与正确的硬件配置相匹配</strong>​。交互式聊天应用优先考虑算力以实现快速 Token 生成，而 RAG 和长上下文工作负载则需要巨大的显存容量和高内存带宽。遵循本指南概述的资源配置框架，您可以系统地评估可行性、选择合适的硬件，并为生产环境中的工作负载优化您的 vLLM 部署。</p>
<h3 data-id="heading-21">接下来你还可以</h3>
<p>准备好在 GPU 基础设施上部署 vLLM 了吗？你可以通过以下资源快速开始：</p>
<h4 data-id="heading-22">在 DigitalOcean GPU Droplets 上部署</h4>
<p>通过在 <strong>DigitalOcean ​GPU</strong>​<strong>​ Droplets</strong> 上实际部署 vLLM，获得第一手使用体验。你可以在 DigitalOcean 官方文档中学习如何搭建运行环境，并对 vLLM 进行性能优化配置。你也可以通过以下 DigitalOcean 发布在卓普云官网的教程与实践总结，学习更多经验：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.aidroplet.com%2Ftutorials%2Frgpt-oss-120b-mi300x%2F" target="_blank" title="https://blog.aidroplet.com/tutorials/rgpt-oss-120b-mi300x/" ref="nofollow noopener noreferrer">在 AMD GPU Droplet 上运行 GPT-OSS vLLM</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.aidroplet.com%2Ftutorials%2Fbudget-llm-finetune%2F" target="_blank" title="https://blog.aidroplet.com/tutorials/budget-llm-finetune/" ref="nofollow noopener noreferrer">使用 DigitalOcean GPU Droplets 以更低成本进行大模型微调</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.aidroplet.com%2Ftutorials%2Fgpu-optimization-deep-learning-guide%2F" target="_blank" title="https://blog.aidroplet.com/tutorials/gpu-optimization-deep-learning-guide/" ref="nofollow noopener noreferrer">探索深度学习工作负载的 GPU 性能优化技术</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.aidroplet.com%2Ftutorials%2Ftechnical-deep-dive-character-ai-amd%2F" target="_blank" title="https://blog.aidroplet.com/tutorials/technical-deep-dive-character-ai-amd/" ref="nofollow noopener noreferrer">了解两千万用户的 Character.ai 如何将推理吞吐量提升 2 倍</a></li>
</ul>
<h4 data-id="heading-23">体验 DigitalOcean 产品</h4>
<ul>
<li>​<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fgpu%2F" target="_blank" title="https://www.aidroplet.com/product/gpu/" ref="nofollow noopener noreferrer">GPU Droplets</a>：面向 AI 与机器学习任务的高性能 GPU 实例</li>
<li>​<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fkubernetes%2F" target="_blank" title="https://www.aidroplet.com/product/kubernetes/" ref="nofollow noopener noreferrer">DigitalOcean Kubernetes</a>：在多节点环境中编排并扩展 vLLM 部署</li>
<li>​<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aidroplet.com%2Fproduct%2Fapp-platform%2F" target="_blank" title="https://www.aidroplet.com/product/app-platform/" ref="nofollow noopener noreferrer">DigitalOcean App Platform</a>：轻松部署并管理你的大模型应用</li>
</ul>
<p>如需更多技术指南与最佳实践，欢迎访问 <strong>DigitalOcean 英文官网，或咨询 DigitalOcean 中国区独家战略合作伙伴卓普云（aidroplet.com）。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解LangChain文本分割器：从原理到实践]]></title>    <link>https://juejin.cn/post/7598390354291802158</link>    <guid>https://juejin.cn/post/7598390354291802158</guid>    <pubDate>2026-01-23T09:35:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390354291802158" data-draft-id="7598181989969149979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解LangChain文本分割器：从原理到实践"/> <meta itemprop="keywords" content="AIGC,LangChain"/> <meta itemprop="datePublished" content="2026-01-23T09:35:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草帽lufei"/> <meta itemprop="url" content="https://juejin.cn/user/501033035632093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解LangChain文本分割器：从原理到实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035632093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草帽lufei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:35:18.000Z" title="Fri Jan 23 2026 09:35:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>在前面的学习中，我们已经掌握了LangChain的文档加载器（Document Loaders）功能，它能够从多种来源（包括本地文件、网页、数据库等）加载文档并提取内容。文档加载只是处理长文本的第一步，为了更好地与大语言模型交互，我们还需要解决长文本的分割问题</p>
<p>本文将深入探讨LangChain中的文本分割器（Text Splitters）组件，学习如何将长文本智能分割为适合模型处理的小块</p>
<h2 data-id="heading-1">文本分割器 （Text Splitters）</h2>
<p>文本分割器作用将长文本分割成适合语言模型处理的小块，解决大模型上下文窗口限制的问题</p>
<p>可以用在文档处理、RAG系统、代码分析等场景</p>
<blockquote>
<p>RAG系统（Retrieval-Augmented Generation）是一种结合了检索和生成的模型，用于回答用户问题。它通过从外部知识库中检索相关信息，然后使用这些信息来生成回答</p>
</blockquote>
<h3 data-id="heading-2">字符分割器</h3>
<p>最基础的分割器，按照固定的分隔符进行分割，简单直接，但可能不够智能，有时会切断语义</p>
<p>例如下面代码使用 <code>CharacterTextSplitter</code> 函数创建分割器</p>
<p><code>splitter.split_text</code> 用于将文本分割成多个块，返回一个数组</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-comment"># 导入所需的库</span>
<span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> CharacterTextSplitter  <span class="hljs-comment"># 字符分割器</span>

<span class="hljs-comment"># 示例文本数据</span>
SAMPLE_TEXT = <span class="hljs-string">"""
人工智能（Artificial Intelligence，AI）是计算机科学的一个分支，致力于创建能够执行通常需要人类智能的任务的系统。

机器学习是人工智能的一个子集，它使计算机能够在没有明确编程的情况下学习和改进。机器学习算法通过分析数据来识别模式，并基于这些模式做出决策或预测。

深度学习是机器学习的一个子集，它使用人工神经网络来模拟人脑的学习过程。深度学习在图像识别、自然语言处理和语音识别等领域取得了突破性进展。

自然语言处理（NLP）是人工智能的一个重要分支，专注于计算机与人类语言之间的交互。NLP技术使计算机能够理解、解释和生成人类语言。

计算机视觉是另一个重要的AI分支，专注于使计算机能够从数字图像或视频中获取有意义的信息。计算机视觉技术广泛应用于自动驾驶、医疗诊断和安防监控等领域。
"""</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-string">"""
    主函数：演示字符分割器的使用
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🚀 字符分割器演示"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    
    <span class="hljs-comment"># 创建分割器实例 - 使用双换行作为分隔符</span>
    splitter = CharacterTextSplitter(
        separator=<span class="hljs-string">"\n\n"</span>,      <span class="hljs-comment"># 使用双换行作为分隔符，按段落分割</span>
        chunk_size=<span class="hljs-number">300</span>,        <span class="hljs-comment"># 每个块的最大字符数</span>
        chunk_overlap=<span class="hljs-number">50</span>,      <span class="hljs-comment"># 块之间的重叠字符数</span>
        length_function=<span class="hljs-built_in">len</span>    <span class="hljs-comment"># 计算长度的函数</span>
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"分割器配置："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 分隔符: '\\n\\n' (双换行)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 块大小: <span class="hljs-subst">{splitter._chunk_size}</span> 字符"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 重叠大小: <span class="hljs-subst">{splitter._chunk_overlap}</span> 字符"</span>)
    
    <span class="hljs-comment"># 分割文本</span>
    chunks = splitter.split_text(SAMPLE_TEXT)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n原始文本长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(SAMPLE_TEXT)}</span> 字符"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"分割后块数: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunks)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"每个块的内容:"</span>)
    
    <span class="hljs-comment"># 显示每个分割块的内容</span>
    <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- 块 <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span> (长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunk)}</span>) ---"</span>)
        <span class="hljs-comment"># 如果块太长，只显示前100个字符</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk) &gt; <span class="hljs-number">100</span>:
            <span class="hljs-built_in">print</span>(chunk[:<span class="hljs-number">100</span>] + <span class="hljs-string">"..."</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(chunk)
    
    <span class="hljs-comment"># 演示不同分隔符的效果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🔧 不同分隔符对比演示:"</span>)
    
    <span class="hljs-comment"># 使用句号作为分隔符</span>
    sentence_splitter = CharacterTextSplitter(
        separator=<span class="hljs-string">"。"</span>,
        chunk_size=<span class="hljs-number">200</span>,
        chunk_overlap=<span class="hljs-number">30</span>
    )
    sentence_chunks = sentence_splitter.split_text(SAMPLE_TEXT)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 句号分隔: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(sentence_chunks)}</span> 个块"</span>)
    
    <span class="hljs-comment"># 使用空格作为分隔符</span>
    space_splitter = CharacterTextSplitter(
        separator=<span class="hljs-string">" "</span>,
        chunk_size=<span class="hljs-number">100</span>,
        chunk_overlap=<span class="hljs-number">20</span>
    )
    space_chunks = space_splitter.split_text(SAMPLE_TEXT)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 空格分隔: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(space_chunks)}</span> 个块"</span>)
    
    <span class="hljs-comment"># 不使用分隔符（强制按长度分割）</span>
    force_splitter = CharacterTextSplitter(
        separator=<span class="hljs-string">""</span>,  <span class="hljs-comment"># 空分隔符，强制按chunk_size分割</span>
        chunk_size=<span class="hljs-number">150</span>,
        chunk_overlap=<span class="hljs-number">0</span>
    )
    force_chunks = force_splitter.split_text(SAMPLE_TEXT)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 强制分割: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(force_chunks)}</span> 个块"</span>)
    
...

</code></pre>
<p>代码示例运行效果可以看到数据被分成了一段段的</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a18eb92cda42178bf90d52829805bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765839&amp;x-signature=eCQ%2BKIp5gksgt0I7gtAGH3RhSMg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">Markdown分割器</h3>
<p>Markdown分割器专门用于分割Markdown文档，会保持Markdown的结构完整性,会识别标题、列表、代码块等Markdown元素，确保分割不会破坏文档结构</p>
<p>就像按章节分割书籍，保持每个章节的完整性</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 导入所需的库</span>
<span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> MarkdownTextSplitter  <span class="hljs-comment"># Markdown分割器</span>

<span class="hljs-comment"># Markdown示例文本</span>
MARKDOWN_TEXT = <span class="hljs-string">"""
# LangChain文本分割器指南

## 什么是文本分割器？

文本分割器是将长文本分割成更小、更易管理块的组件。这在处理长文档、提高检索质量、控制token使用等场景非常重要。

## 为什么需要文本分割？

### 1. Token限制
语言模型有输入长度限制，长文本需要分割才能处理。

### 2. 检索质量
小块文本更容易精确匹配，提高检索准确性。

### 3. 处理效率
小块文本处理更快，节省计算资源。


"""</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-string">"""
    主函数：演示Markdown分割器的使用
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🚀 Markdown分割器演示"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">60</span>)
    
    <span class="hljs-comment"># 创建分割器实例</span>
    splitter = MarkdownTextSplitter(
        chunk_size=<span class="hljs-number">200</span>,        <span class="hljs-comment"># 每个块的最大字符数</span>
        chunk_overlap=<span class="hljs-number">30</span>       <span class="hljs-comment"># 块之间的重叠字符数</span>
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"分割器配置："</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 块大小: <span class="hljs-subst">{splitter._chunk_size}</span> 字符"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 重叠大小: <span class="hljs-subst">{splitter._chunk_overlap}</span> 字符"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"- 专门处理: Markdown文档"</span>)
    
    <span class="hljs-comment"># 分割Markdown文本</span>
    chunks = splitter.split_text(MARKDOWN_TEXT)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n原始Markdown文本长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(MARKDOWN_TEXT)}</span> 字符"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"分割后块数: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunks)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"每个块的内容:"</span>)
    
    <span class="hljs-comment"># 显示每个分割块的内容</span>
    <span class="hljs-keyword">for</span> i, chunk <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n--- 块 <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span> (长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunk)}</span>) ---"</span>)
        <span class="hljs-built_in">print</span>(chunk)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- 块结束 ---"</span>)
    
    <span class="hljs-comment"># 分析Markdown结构保持情况</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n📊 Markdown结构分析:"</span>)
...
</code></pre>
<p>代码执行后的输出</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efbda4fe634d406b80dc4aa5f3d1e264~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765839&amp;x-signature=GwGI7YJViOPyXrqWCN%2BRyefAapw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">Python代码分割器</h3>
<p>专门用于分割Python代码，会保持代码的语法结构完整性。会识别函数、类、导入语句等Python语法元素，确保分割不会破坏代码结构</p>
<p>使用 <code>langchain_text_splitters</code> 中的 <code>PythonCodeTextSplitter</code> 类来实现Python代码的分割，其他操作和上面列子类似</p>
<p>由于代码没有什么特殊的地方，从这里开始以及后面的内容就不贴了</p>
<h3 data-id="heading-5">递归字符分割器演示</h3>
<p>最常用的文本分割器，会递归地尝试不同的分隔符来分割文本。例如句号、换行符、问号等。按照分隔符的优先级顺序进行分割，确保文本块的完整性</p>
<p>使用 <code>langchain_text_splitters</code> 中的 <code>RecursiveCharacterTextSplitter</code> 类来实现递归字符分割</p>
<h3 data-id="heading-6">Token分割器</h3>
<p>Token分割器基于Token数量而不是字符数来分割文本。这对于控制语言模型的输入长度非常重要，因为大多数LLM都有Token限制</p>
<p>Token是语言模型的基本处理单位，通过控制Token数量可以更精确地控制模型的输入长度，避免超出限制</p>
<p>使用 <code>langchain_text_splitters</code> 中的 <code>TokenTextSplitter</code> 类来实现Token分割</p>
<h3 data-id="heading-7">语义分割方法</h3>
<p>基于嵌入相似度的语义分割方法。通过计算文本块之间的语义相似度，可以更智能地进行文本分割和聚类。</p>
<p>通俗理解就像按主题相关性来分段，而不是简单的按长度，相似的内容放在一起，不相关的分开，基于语义理解，而不是表面字符</p>
<p>这种需要语义理解的部分需要模型的支持</p>
<h2 data-id="heading-8">小结</h2>
<p>不同的分割器适用于不同的场景，需要根据具体需求选择合适的分割器，在实际场景中处理时也需要比较不同文本分割器的性能表现，包括分割时间、生成块数、平均块大小等指标</p>
<p>文本分割器相关内容就到这里了，接下来学习嵌入（Embeddings）</p>
<blockquote>
<p>欢迎留言交流，如果觉得有帮助，可以<code>点个赞</code>支持一下</p>
<p>公众号：草帽lufei</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[通过Mockjs模拟数据]]></title>    <link>https://juejin.cn/post/7598390354291818542</link>    <guid>https://juejin.cn/post/7598390354291818542</guid>    <pubDate>2026-01-23T09:36:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598390354291818542" data-draft-id="7598370121436020786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="通过Mockjs模拟数据"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-23T09:36:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优秀的颜"/> <meta itemprop="url" content="https://juejin.cn/user/960313319521178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            通过Mockjs模拟数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960313319521178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优秀的颜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:36:51.000Z" title="Fri Jan 23 2026 09:36:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Mockjs</h2>
<p>Mock.js 是一款模拟数据生成器</p>
<p>官网：<a href="https://link.juejin.cn?target=http%3A%2F%2Fmockjs.com" target="_blank" title="http://mockjs.com" ref="nofollow noopener noreferrer">mockjs.com</a></p>
<h3 data-id="heading-1">安装</h3>
<p>前提安装好node环境</p>
<ol>
<li>在命令提示符窗口，使用npm安装</li>
</ol>
<pre><code class="hljs language-node" lang="node"># 初始化项目
npm init -y
# 安装
npm install mockjs
</code></pre>
<p>​	安装成功显示</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6769b10ad7c94893be430d73753e92bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=MPilUYUWHNMNCcu1qNzerIigccY%3D" alt="image-20230102153711314" loading="lazy"/>
<ol start="2">
<li>
<p>创建文件 demo1.js</p>
<pre><code class="hljs language-node" lang="node">const Mock = require('mockjs') // 这个是引用库
 
const data = Mock.mock({
  // 生成对象个数是 3
  'items|3': [{
    'id|+1': 1,       // 自增涨id
    'name': '@cname', // 生成随机名字
  	'age|1-100':1,    // 年龄（1-100之间随机数）
	'img':'@image',   // 图片
	'ip':'@ip',       // ip
	'email':'@email', // 邮箱
	'salary|10-100.1-2':1,    // 工资 - （10-100，小数位1到3位的随机数）例子：13.23
	'status':'@boolean',      // 状态 布尔值
	'title':'@ctitle(10,20)', // 标题 (生成字数10到20之间)
	'idCard':/\d{15}|\d{18}/, // 身份证号（正则表达式）
	'address':'@county(try)', // 地址  zip 邮编
	'birthday':'@date("yyyy-MM-dd")',  // 生日日期  ("可以指定日期格式")
	'url':'@url("http","goodyan.cn")', // url地址
	'phone|11':'@integer(0,9)',        // 手机号
	'money':'@float(0,10,1,3)',        // 钱（0-10小数  1-3位小数位）
    'pay|1':['a','b','c','d'],         // 类型（4选一，随机选其中一个）
	'son|2':{
		id:1,name:'abc'       // 对象里包含对象 2 随机抽取2个属性
	}
  }]
})

// 输出
console.log(JSON.stringify(data));
</code></pre>
<ol start="3">
<li>运行脚本</li>
</ol>
<pre><code class="hljs language-node" lang="node">node demo1.js
</code></pre>
<p>可以得到一些json字符串，模拟数据。</p>
</li>
</ol>
<h2 data-id="heading-2">EasyMock</h2>
<p>Easy Mock 是一个可视化，并且能快速生成模拟数据的持久化服务。</p>
<p>官方地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Feasy-mock.com" target="_blank" title="https://easy-mock.com" ref="nofollow noopener noreferrer">easy-mock.com</a></p>
<p>源码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Feasy-mock%2Feasy-mock" target="_blank" title="https://github.com/easy-mock/easy-mock" ref="nofollow noopener noreferrer">github.com/easy-mock/e…</a></p>
<p>一般我们可以部署在本地，安装前提：</p>
<p>需要成功安装了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" target="_blank" title="https://nodejs.org/" ref="nofollow noopener noreferrer">Node.js</a>（<strong>v8.x, <del>不支持 v10.x</del></strong>）&amp; <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2F" target="_blank" title="https://www.mongodb.com/" ref="nofollow noopener noreferrer">MongoDB</a>（<strong>&gt;= v3.4</strong>）&amp; <a href="https://link.juejin.cn?target=https%3A%2F%2Fredis.io%2F" target="_blank" title="https://redis.io/" ref="nofollow noopener noreferrer">Redis</a>（<strong>&gt;= v4.0</strong>）。</p>
<p>安装步骤在github源码地址里有，这里不再介绍。</p>
<p>我们如果选择在线模式：</p>
<p>可以选择第三方fastmock提供服务平台</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fastmock.site%2F%23%2F" target="_blank" title="https://www.fastmock.site/#/" ref="nofollow noopener noreferrer">www.fastmock.site/#/</a></p>
<h3 data-id="heading-3">如何使用</h3>
<ol>
<li>创建项目</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d700b6b5d7a044819508e56be04fd06a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=3%2BVxECRbxeaT%2F6o6CzxQPQk40yo%3D" alt="image-20230102153711314" loading="lazy"/>
<ol start="2">
<li>
<p>创建查询接口</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d25815bb59c7461fb07a18313817f1a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=mEx3EFpKKsYoCcQU%2BS4uwC2DtjY%3D" alt="image-20230102173322002" loading="lazy"/>
</li>
<li>
<p>创建新增接口</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/903d0595f89d405c8458b37ea8334072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=vQsdg%2FTYXPHB48njYtz7AYojjPQ%3D" alt="image-20230102173650234" loading="lazy"/>
</li>
<li>
<p>进行保存</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37c20d0d09394ac9a1f6d894b4a4d0da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=0sKaOWZjlIyKGtm4Uv5n9Q5faaE%3D" alt="image-20230102173838208" loading="lazy"/>
</li>
<li>
<p>进行测试</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/361ac76098fd4e76a6711c1d84ef273e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=i6RKLGl6O0EnkxMBOBpzikPmiMA%3D" alt="image-20230102174015353" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d0b46996a744630a0cd0f72e5c670a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765810&amp;x-signature=Lp86vgtqQ%2BAQVkuDMe5YCfCjC%2BI%3D" alt="image-20230102174043041" loading="lazy"/>
</li>
</ol>
<p>这样我们前端可以访问测试地址，得到模拟数据。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个程序员2004年的决定，如何悄悄改变了整个互联网？]]></title>    <link>https://juejin.cn/post/7598181989969182747</link>    <guid>https://juejin.cn/post/7598181989969182747</guid>    <pubDate>2026-01-23T09:39:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598181989969182747" data-draft-id="7598181989969166363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个程序员2004年的决定，如何悄悄改变了整个互联网？"/> <meta itemprop="keywords" content="前端,JavaScript,Markdown"/> <meta itemprop="datePublished" content="2026-01-23T09:39:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冴羽"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个程序员2004年的决定，如何悄悄改变了整个互联网？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冴羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:39:03.000Z" title="Fri Jan 23 2026 09:39:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一个程序员2004年的决定，如何悄悄改变了整个互联网？</h2>
<p>想象一下：</p>
<p>你正在写一份工作报告，想给标题加个粗体，或者插入一个网址链接。</p>
<p>在传统的 Word 文档里，你需要花几分钟时间找各种按钮、菜单，偶尔还会因为误操作把整页格式搞乱。</p>
<p>现在，你只需要输入 <code># 标题</code> 就能得到大标题，输入 <code>**粗体文字**</code> 就能得到粗体，输入 <code>[点击这里](网址)</code> 就能得到一个可点击的链接。</p>
<p>简单、直接、高效，就像发微信一样自然。</p>
<p>这就是 Markdown。</p>
<p>本篇和你讲讲 Markdown 背后的故事，以及为什么它能成功到风靡全球，以及它的故事对我们的启示。</p>
<h3 data-id="heading-1">1. 一个决定</h3>
<p>故事要从 2004 年说起。</p>
<p>那时的互联网还很“原始"”，如果想在网页上发布一篇文章，你必须学习一门叫 HTML 的语言。</p>
<p>想象一下，每次写文章都要像这样编码：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我的文章标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一段<span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>重要<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>的文字，包含一个<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"链接地址"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p>这就像是想给朋友写封信，却必须先学会用摩斯密码一样荒谬。</p>
<p>就在这时，一个叫约翰·格鲁伯的程序员做了一个大胆的决定：创造一种“反HTML”的格式。</p>
<p>HTML是“标记语言”，那他就创造一种“反标记语言”——Markdown。</p>
<p>约翰的想法很简单：为什么不能让写文章就像写普通邮件一样简单？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e1b86551124a42a9281574e94fe495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769766161&amp;x-signature=N2O%2Fz05Nspf79ba8Dhe6eL54sOM%3D" alt="1.png" loading="lazy"/></p>
<h3 data-id="heading-2">2. 意外传播</h3>
<p>约翰发布 Markdown 时，并没有想到它会成为互联网的基础设施。</p>
<p>他只是厌倦了复杂的 HTML 语法，想为自己和朋友提供一个更简单的选择。</p>
<p>但接下来发生的事情连约翰自己都没想到：</p>
<ul>
<li>
<p><strong>2004 年</strong>：Markdown 悄悄诞生</p>
</li>
<li>
<p><strong>2005-2010 年</strong>：程序员们开始用 Markdown 写技术文档</p>
</li>
<li>
<p><strong>2010-2015 年</strong>：各大平台开始支持 Markdown 格式</p>
</li>
<li>
<p><strong>2015-2020 年</strong>：笔记软件、协作工具全面拥抱 Markdown</p>
</li>
<li>
<p><strong>2020 年至今</strong>：连苹果的 Notes 都支持 Markdown 了</p>
</li>
</ul>
<p>这就像你发明了一种新的记账方法，结果全世界的企业都跟着用了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17ce985811a8449da6c0e73b74028bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769766161&amp;x-signature=NbF9LowmAHfpamnY7XOyNKXxmhU%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-3">3. Markdown 成功的十个原因</h3>
<p>所以为什么 Markdown 能在众多技术中脱颖而出呢？</p>
<p>让我们看看它的成功秘密：</p>
<h4 data-id="heading-4">1. 绝妙的名字</h4>
<p>“Markdown”这个名字很好！懂技术的人一眼就知道它是“反 Markup”，普通人听起来也简单好记。</p>
<h4 data-id="heading-5">2. 解决了真实痛点</h4>
<p>不是所有新技术都解决了实际问题，但 Markdown 确实让无数人从 HTML 的折磨中解脱了出来。</p>
<h4 data-id="heading-6">3. 顺应了用户习惯</h4>
<p>Markdown 的语法基于人们已经在邮件和文档中形成的习惯。比如用 <code>*</code> 表示强调，用 <code>#</code> 表示标题等。</p>
<h4 data-id="heading-7">4. 找到了最佳时机</h4>
<p>2004 年正值博客爆发期，人们正在寻找更好的写作工具。Markdown 正好撞上了这个风口。</p>
<h4 data-id="heading-8">5. 开放包容的社区</h4>
<p>从一开始，Markdown 就有一个开放的社区。</p>
<p>各种版本出现：GitHub 版本、通用版本、扩展版本...但核心依然保持一致。</p>
<h4 data-id="heading-9">6. 极简主义的设计哲学</h4>
<p><strong>保持简单，而不是追求复杂。</strong> 这是很多成功技术的共同特点。</p>
<h4 data-id="heading-10">7. 技术人员的推动</h4>
<p>程序员们是早期使用者，他们发现了 Markdown 的价值并大力推广，形成了滚雪球效应。</p>
<h4 data-id="heading-11">8. 可读性强</h4>
<p>即使不懂 Markdown 语法的人，看到 <code>.md</code> 文件也能大概猜出意思。这种“自我解释”的能力很珍贵。</p>
<h4 data-id="heading-12">9. 跨平台兼容</h4>
<p>Markdown 文件在任何设备、任何系统上都能正常显示和编辑。不怕软件更新，不怕系统迁移。</p>
<h4 data-id="heading-13">10. 零专利壁垒</h4>
<p>最重要的是，约翰·格鲁伯没有为 Markdown 申请专利。这意味着任何人都可以自由使用它。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0365863bb2b40bb80d6cf13ab9f340b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769766161&amp;x-signature=iVQsyM22sd6Ne18tpcZCWFhvkXQ%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-14">4. 带给我们什么启发？</h3>
<p>Markdown 的故事不仅仅是一个技术成功的案例，它还给我们很多启发：</p>
<h4 data-id="heading-15">4.1. 简单比复杂更有力量</h4>
<p>在这个喜欢把简单事情搞复杂的世界里，Markdown 证明了“less is more”的智慧。</p>
<h4 data-id="heading-16">4.2. 从解决实际问题出发</h4>
<p>不是为了技术而技术，而是为了解决人们的实际问题。Markdown 的成功源于它真的让写作变得更简单。</p>
<h4 data-id="heading-17">4.3. 长期主义的重要性</h4>
<p>从 2004 年到今天，Markdown 已经存在了20年。它没有一夜爆红，而是慢慢渗透，最终无处不在。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ece05753f6c4b69a529db629bf648b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya05769:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769766161&amp;x-signature=KnLP5ATBMDmH1W1HPgTUA56F%2Bhk%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-18">5. 最后</h3>
<p>不是每个人都需要发明影响世界的技术，但每个人都可以创造一些让世界变得更美好的小东西。</p>
<p>关键在于：观察人们真正的问题，提出简单的解决方案，然后分享给世界。</p>
<p>或许这就是 Markdown 的故事给我们的最珍贵的礼物。</p>
<p>我是冴羽，10 年笔耕不辍，专注前端领域，更新了 10+ 系列、300+ 篇原创技术文章，翻译过 Svelte、Solid.js、TypeScript 文档，著有小册《Next.js 开发指南》、《Svelte 开发指南》、《Astro 实战指南》。</p>
<p>欢迎围观我的“<a href="https://link.juejin.cn?target=https%3A%2F%2Fyayujs.com%2F" target="_blank" title="https://yayujs.com/" ref="nofollow noopener noreferrer">网页版朋友圈</a>”，关注我的公众号：<strong>冴羽（或搜索 yayujs）</strong> ，每天分享前端知识、AI 干货。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[要变天了，手机也能操作Claude Code了]]></title>    <link>https://juejin.cn/post/7598320487508492323</link>    <guid>https://juejin.cn/post/7598320487508492323</guid>    <pubDate>2026-01-23T09:31:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598320487508492323" data-draft-id="7598382710294085632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="要变天了，手机也能操作Claude Code了"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-23T09:31:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨舟"/> <meta itemprop="url" content="https://juejin.cn/user/1398234520494366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            要变天了，手机也能操作Claude Code了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234520494366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨舟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:31:43.000Z" title="Fri Jan 23 2026 09:31:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>之前在用Claude Code和Codex时总是会遇到这样的情况，Claude Code还在进行中，这时候人却不在电脑旁了，比如去吃饭了，出去玩了，在坐地铁，有时候想实时看看执行的情况。还有就是因为Claude Max会员，总想着可以最大限度的用额度。那时就想过有没有这样的工具可以互联实时查看。没想到现在已经有了，它就是 Happy Coder。 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2264236c36374ec29d325d022830d719~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6Iif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765503&amp;x-signature=%2BIjbYMg5aZNgccpnRIuGwFKWhO8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">什么是 Happy Coder</h2>
<p>简单点说就是 Happy Coder是一个可以在手机上实时控制和查看正在电脑中运行的Claude Code或 Codex。可以跨设备使用，不需要在同一wifi下就可以实现，最重要的是它是 <strong>端到端加密</strong>的，不存在信息泄漏的情况。</p>
<h2 data-id="heading-1">如何使用</h2>
<p>1、电脑安装 Happy有Coder，这是它的github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fslopus%2Fhappy" target="_blank" title="https://github.com/slopus/happy" ref="nofollow noopener noreferrer">Happy Coder</a>, npm 全局安装</p>
<pre><code class="hljs">npm install -g happy-coder
</code></pre>
<p>安装好后，如果你要运行 Claude Code，则执行</p>
<pre><code class="hljs">Happy
</code></pre>
<p>如果是运行Codex，则执行</p>
<pre><code class="hljs">Happy Codex
</code></pre>
<p>执行后会先出现这个选项，选移动端还是浏览器 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30dccac334894cab8e143b1301a92279~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6Iif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765503&amp;x-signature=Sy5uouLbmqi4ESJHg53GB%2BBn1Q4%3D" alt="choose" loading="lazy"/></p>
<p>运行后会出现这样的一个二维码： <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15781b5da1c4471385900af5aa547c7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6Iif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765503&amp;x-signature=AdjZWYwloEVQA%2Bq%2BCQWrurmCYtk%3D" alt="qrcode" loading="lazy"/></p>
<p>2、手机安装Happy Code app 在手机上下载 Happy Code:</p>
<ul>
<li>IOS: <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Fhappy-claude-code-client%2Fid6748571505" target="_blank" title="https://apps.apple.com/us/app/happy-claude-code-client/id6748571505" ref="nofollow noopener noreferrer">apps.apple.com/us/app/happ…</a></li>
<li>安卓：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.ex3ndr.happy" target="_blank" title="https://play.google.com/store/apps/details?id=com.ex3ndr.happy" ref="nofollow noopener noreferrer">play.google.com/store/apps/…</a> 这个app</li>
</ul>
<p>3、连接电脑 打开下载好的Happ Code，扫码电脑上刚出现的那个二维码。电脑会请求权限，同意后就可以看到连接成功了，如图 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/324e2a71a2f645bc8a8863e9266d5a3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6Iif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765503&amp;x-signature=lBx8vY4NP33ap%2BVeM8y4PqKHnYs%3D" alt="term" loading="lazy"/></p>
<p>现在可以在手机上进行对话，比如我们让他新建一个hello word的html <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8b4789524441eea01000fb97cef630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6Iif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769765503&amp;x-signature=r53vwHQpgHRZ0MC8wAOF1t5vn%2Bk%3D" alt="681769159329_.pic" loading="lazy"/></p>
<p>可以在电脑看到该文件已经有了，这样你就可以在手机上愉快的指挥Claude Code了，快去试试吧</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Golang对象池性能优化误区]]></title>    <link>https://juejin.cn/post/7598362826110107698</link>    <guid>https://juejin.cn/post/7598362826110107698</guid>    <pubDate>2026-01-23T09:40:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598362826110107698" data-draft-id="7598390354291621934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Golang对象池性能优化误区"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-23T09:40:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追光者1995"/> <meta itemprop="url" content="https://juejin.cn/user/1444138868028331"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Golang对象池性能优化误区
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1444138868028331/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追光者1995
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:40:24.000Z" title="Fri Jan 23 2026 09:40:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在做一个微服务项目准备转型Golang，很早就用上了sync.Pool，目前正在做性能上的微调，发现一个诡异的现象————使用对象池创建DTO的性能竟然更低，执行的命令如下：
go test -bench="." -benchmem -count=5
附上基准测试截图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16fd5f7c02434de8ac8dd0157f9a5509~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-95YWJ6ICFMTk5NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769766024&amp;x-signature=L0JX%2BlLT4WXa9kufUy6CFGVXVk8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> (
    objectPool = sync.Pool{
       New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">interface</span>{} {
          <span class="hljs-keyword">return</span> &amp;dto.OrderProductInvetoryDto{
             OrderId:             <span class="hljs-number">0</span>,
             ProductInvetory:     <span class="hljs-built_in">make</span>([]*dto.OrderProductInvetoryItem, <span class="hljs-number">15</span>),
             ProductSizeInvetory: <span class="hljs-built_in">make</span>([]*dto.OrderProductSizeInvetoryItem, <span class="hljs-number">15</span>),
          }
       },
    }
)

<span class="hljs-comment">// 基准测试：直接创建对象</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkWithoutPool</span><span class="hljs-params">(b *testing.B)</span></span> {
    b.ReportAllocs() <span class="hljs-comment">// 报告内存分配情况</span>
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {
       obj := &amp;dto.OrderProductInvetoryDto{}
       _ = obj <span class="hljs-comment">// 防止编译器优化</span>
    }
}

<span class="hljs-comment">// 基准测试：使用 sync.Pool</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkWithPool</span><span class="hljs-params">(b *testing.B)</span></span> {
    b.ReportAllocs()
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ {
       obj := objectPool.Get().(*dto.OrderProductInvetoryDto)
       obj.OrderId = <span class="hljs-number">0</span>
       obj.Reset()
       objectPool.Put(obj)
    }
}
</code></pre>
<p>对象池是性能提升神器怎么耗时反而更多了？原因在于这个结构体太小，里面的切片数据量也很小，直接创建的资源开销较小，而从对象池存取需要经过“取出-&gt;类型断言-&gt;重置-&gt;放回”，每一步都有开销，特别是类型断言会占用少量CPU资源，总耗时大于直接创建对象的耗时。</p>
<p>同理，zap.Logger写日志的时候起初也用对象池存取[]zap.Field切片，基准测试发现更慢于是又改回直接创建切片。事实上项目用的日志最多12个字段，切片长度最大为12，用对象池反而更慢。</p>
<p>所以，对象池使用不当反倒会造成性能下降，因为对象池针对的是频繁创建和销毁创建成本很大而且结构复杂的结构体，像[]zap.Field、DTO不要设计得太复杂传递太多数据，直接创建对象的成本将显著低于对象池存取。虽然对象池很好用，但频繁使用大型结构体的合理性存疑，需要检查接口耦合度是否过高及功能需求设计是否存在不合理之处，减少对大型结构体的依赖才是正确的做法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始构建 Manus 系统：03-Sandbox Filesystem]]></title>    <link>https://juejin.cn/post/7598362826110091314</link>    <guid>https://juejin.cn/post/7598362826110091314</guid>    <pubDate>2026-01-23T09:39:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598362826110091314" data-draft-id="7597997108135444507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始构建 Manus 系统：03-Sandbox Filesystem"/> <meta itemprop="keywords" content="人工智能,Python"/> <meta itemprop="datePublished" content="2026-01-23T09:39:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="两万五千个小时"/> <meta itemprop="url" content="https://juejin.cn/user/3966693682971870"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始构建 Manus 系统：03-Sandbox Filesystem
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693682971870/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    两万五千个小时
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:39:20.000Z" title="Fri Jan 23 2026 09:39:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从零开始构建 Manus 系统：03-Sandbox Filesystem</h2>
<h3 data-id="heading-1">📍 导航指南</h3>
<p>在集成了浏览器操控能力后，我们继续为 AI Agent 扩展能力边界。这次，我们要赋予它"文件专家"的身份——能够读取代码、写入文档、搜索内容、甚至重构整个项目。</p>
<ul>
<li>🔍 <strong>为什么需要文件系统？</strong> → <a href="#part-1" title="#part-1">第一部分：背景与架构</a> - 理解 AI 访问文件系统的必要性</li>
<li>🛠️ <strong>如何集成？</strong> → <a href="#part-2" title="#part-2">第二部分：环境构建</a> - Node.js MCP Filesystem Server 配置</li>
<li>⚙️ <strong>怎么管理？</strong> → <a href="#part-3" title="#part-3">第三部分：服务编排</a> - Supervisor 进程管理和权限控制</li>
<li>🔌 <strong>如何连接？</strong> → <a href="#part-4" title="#part-4">第四部分：MCP集成</a> - MCP Filesystem 的工作原理</li>
<li>🧪 <strong>验证测试</strong> → <a href="#part-5" title="#part-5">第五部分：测试验证</a> - 完整的功能测试和应用场景</li>
</ul>
<hr/>
<h3 data-id="heading-2">目录</h3>
<h4 data-id="heading-3">第一部分：背景与架构 🔍</h4>
<ul>
<li><a href="#why-filesystem" title="#why-filesystem">为什么要给沙盒装文件系统？</a></li>
<li><a href="#filesystem-architecture" title="#filesystem-architecture">架构设计：MCP Filesystem</a></li>
</ul>
<h4 data-id="heading-4">第二部分：环境构建 🛠️</h4>
<ul>
<li><a href="#nodejs-filesystem" title="#nodejs-filesystem">Node.js MCP Filesystem Server</a></li>
<li><a href="#security-config" title="#security-config">权限和安全配置</a></li>
</ul>
<h4 data-id="heading-5">第三部分：服务编排 ⚙️</h4>
<ul>
<li><a href="#supervisor-filesystem" title="#supervisor-filesystem">Supervisor 配置</a></li>
<li><a href="#process-deps-filesystem" title="#process-deps-filesystem">进程依赖管理</a></li>
</ul>
<h4 data-id="heading-6">第四部分：MCP集成 🔌</h4>
<ul>
<li><a href="#mcp-filesystem-config" title="#mcp-filesystem-config">MCP Filesystem 配置</a></li>
<li><a href="#filesystem-scenarios" title="#filesystem-scenarios">实际应用场景</a></li>
</ul>
<h4 data-id="heading-7">第五部分：测试验证 🧪</h4>
<ul>
<li><a href="#test-filesystem" title="#test-filesystem">测试脚本：test_filesystem.py</a></li>
<li><a href="#performance-validation" title="#performance-validation">性能和安全验证</a></li>
</ul>
<h4 data-id="heading-8">附录</h4>
<ul>
<li><a href="#filesystem-faq" title="#filesystem-faq">常见问题 FAQ</a></li>
</ul>
<hr/>
<h3 data-id="heading-9">引言</h3>
<p>在 <a href="https://juejin.cn/post/7598104596779941934" target="_blank" title="https://juejin.cn/post/7598104596779941934">从零开始构建 Manus 系统：02-Sandbox Chrome</a> 中，我们让 AI Agent 能够浏览互联网。现在，我们要让它成为真正的"文件专家"——能够读取源代码、分析项目结构、修改文件、甚至进行大规模的重构。</p>
<p>文件系统操作是 AI Agent 最基础但也最强大的能力之一。从简单的文件读取，到复杂的代码分析和重构，文件系统 MCP 为 AI 提供了与开发者相同的文件操作权限。</p>
<hr/>
<p><a id="user-content-part-1" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-10">第一部分：背景与架构 🔍</h3>
<p><a id="user-content-why-filesystem" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-11">为什么要给沙盒装文件系统？</h4>
<p>对于人类开发者来说，文件系统是我们日常工作的基础。对于 AI Agent 而言，集成文件系统能力意味着：</p>
<ol>
<li><strong>代码理解与分析</strong>：读取源代码、理解项目结构、分析依赖关系。</li>
<li><strong>文档生成与维护</strong>：创建 README、API 文档、配置文件。</li>
<li><strong>项目重构与优化</strong>：大规模代码修改、文件重组、架构调整。</li>
<li><strong>数据处理与存储</strong>：读取配置文件、处理数据文件、生成报告。</li>
<li><strong>开发环境管理</strong>：安装依赖、运行构建脚本、管理项目文件。</li>
</ol>
<p><a id="user-content-filesystem-architecture" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-12">架构设计：MCP Filesystem</h4>
<p>我们的文件系统集成基于以下设计：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Agent[AI Agent] --MCP Protocol--&gt; MCP_Server[MCP Filesystem Server]
    MCP_Server --POSIX API--&gt; Filesystem[(Linux Filesystem)]
    Filesystem --Volume Mount--&gt; Host_Workspace[/host/workspace/]
</code></pre>
<p><strong>关键设计决策</strong>：</p>
<ul>
<li><strong>官方 MCP 实现</strong>：使用 <code>@modelcontextprotocol/server-filesystem</code>，确保协议兼容性和功能完整性</li>
<li><strong>受限工作区</strong>：所有操作限制在 <code>/root/shared/workspace/</code> 目录，防止越权访问</li>
<li><strong>POSIX 兼容</strong>：标准的文件系统操作，支持权限、所有者、时间戳等元数据</li>
<li><strong>异步操作</strong>：支持大文件的异步读取和写入</li>
</ul>
<hr/>
<p><a id="user-content-part-2" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-13">第二部分：环境构建 🛠️</h3>
<p><a id="user-content-nodejs-filesystem" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-14">Node.js MCP Filesystem Server</h4>
<p>文件系统 MCP 是官方提供的 Node.js 实现，我们已经在 Dockerfile 中安装了它：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 全局安装 MCP Filesystem Server
RUN npm install -g @modelcontextprotocol/server-filesystem@latest
</code></pre>
<p>这个包提供了 8 个核心文件操作工具：</p>
<ol>
<li>
<p><strong>读取操作</strong></p>
<ul>
<li><code>read_file</code> - 读取文件内容</li>
<li><code>read_directory</code> - 列出目录内容</li>
<li><code>get_file_info</code> - 获取文件元数据</li>
</ul>
</li>
<li>
<p><strong>写入操作</strong></p>
<ul>
<li><code>write_file</code> - 创建或覆盖文件</li>
<li><code>create_directory</code> - 创建目录</li>
</ul>
</li>
<li>
<p><strong>修改操作</strong></p>
<ul>
<li><code>search_replace</code> - 在文件中进行精确的字符串替换</li>
<li><code>move_file</code> - 移动或重命名文件</li>
</ul>
</li>
<li>
<p><strong>删除操作</strong></p>
<ul>
<li><code>delete_file</code> - 删除文件或目录</li>
</ul>
</li>
</ol>
<p><a id="user-content-security-config" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-15">权限和安全配置</h4>
<p>文件系统操作的安全性至关重要：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 创建受限的工作区目录
RUN mkdir -p /root/shared/workspace /root/shared/workspace/screenshots /root/shared/workspace/downloads
</code></pre>
<p><strong>安全措施</strong>：</p>
<ul>
<li><strong>路径限制</strong>：所有操作都被限制在 <code>/root/shared/workspace/</code> 及其子目录</li>
<li><strong>权限检查</strong>：服务器会验证文件访问权限</li>
<li><strong>资源限制</strong>：防止读取过大的文件或进行无限递归</li>
<li><strong>审计日志</strong>：所有文件操作都会记录到 supervisord 日志</li>
</ul>
<hr/>
<p><a id="user-content-part-3" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-16">第三部分：服务编排 ⚙️</h3>
<p><a id="user-content-supervisor-filesystem" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-17">Supervisor 配置</h4>
<p>在 <code>supervisord.conf</code> 中，我们配置了 MCP Filesystem Server：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">; MCP Filesystem Server (Official - Node.js)</span>
<span class="hljs-section">[program:mcp-filesystem]</span>
<span class="hljs-attr">command</span>=/usr/bin/npx -y @modelcontextprotocol/server-filesystem /root/shared/workspace
<span class="hljs-attr">directory</span>=/root/shared/workspace
<span class="hljs-attr">environment</span>=NODE_ENV=<span class="hljs-string">"production"</span>
<span class="hljs-attr">autorestart</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">stdout_logfile</span>=/dev/stdout
<span class="hljs-attr">stdout_logfile_maxbytes</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">stderr_logfile</span>=/dev/stderr
<span class="hljs-attr">stderr_logfile_maxbytes</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">priority</span>=<span class="hljs-number">601</span>
<span class="hljs-attr">startsecs</span>=<span class="hljs-number">5</span>
</code></pre>
<p><a id="user-content-process-deps-filesystem" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-18">进程依赖管理</h4>
<p>文件系统服务器的优先级设置为 601，高于基础服务但低于应用服务：</p>
<ul>
<li><code>xvfb</code> (100) → <code>fluxbox</code> (200) → <code>chrome</code> (200) → <code>x11vnc</code> (400) → <code>websockify</code> (500)</li>
<li><code>mcp-shell</code> (600) → <code>mcp-filesystem</code> (601) → <code>mcp-chrome</code> (602) → <code>mcp-manager</code> (603)</li>
</ul>
<p>这种优先级确保了：</p>
<ol>
<li><strong>基础环境先就绪</strong>：X11 和网络服务先启动</li>
<li><strong>MCP 服务顺序启动</strong>：Shell 基础功能 → 文件系统 → 浏览器 → 管理器</li>
<li><strong>依赖关系正确</strong>：文件系统服务不需要等待其他服务，可以独立启动</li>
</ol>
<hr/>
<p><a id="user-content-part-4" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-19">第四部分：MCP集成 🔌</h3>
<p><a id="user-content-mcp-filesystem-config" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-20">MCP Filesystem 配置</h4>
<p>MCP Filesystem Server 通过以下参数启动：</p>
<pre><code class="hljs language-bash" lang="bash">npx @modelcontextprotocol/server-filesystem /root/shared/workspace
</code></pre>
<p><strong>关键参数</strong>：</p>
<ul>
<li><strong>工作目录</strong>：<code>/root/shared/workspace</code> - 所有操作的根目录</li>
<li><strong>协议版本</strong>：自动协商最新的 MCP 协议版本</li>
<li><strong>并发限制</strong>：内置的并发控制，防止文件系统过载</li>
</ul>
<p><a id="user-content-filesystem-scenarios" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-21">实际应用场景</h4>
<p>当 MCP Filesystem 集成完成后，AI Agent 就可以执行以下操作：</p>
<ol>
<li><strong>代码分析</strong>:</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"read_file"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main.py"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"encoding"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"utf-8"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Agent 可以读取源代码文件，理解项目结构和实现逻辑。</p>
<ol start="2">
<li><strong>项目文档生成</strong>:</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"write_file"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"README.md"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"# My Project\n\n..."</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Agent 可以创建和维护项目文档。</p>
<ol start="3">
<li><strong>批量重构</strong>:</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"search_replace"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"file_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"config.py"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"old_string"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DEBUG = True"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"new_string"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DEBUG = False"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>Agent 可以进行精确的代码修改。</p>
<ol start="4">
<li><strong>文件管理</strong>:</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"read_directory"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>Agent 可以浏览目录结构，了解项目组织。</p>
<hr/>
<p><a id="user-content-part-5" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-22">第五部分：测试验证 🧪</h3>
<p><a id="user-content-test-filesystem" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-23">测试脚本：test_filesystem.py</h4>
<p>为了验证文件系统 MCP 的功能，我们可以创建一个测试脚本：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> mcp <span class="hljs-keyword">import</span> ClientSession, StdioServerParameters
<span class="hljs-keyword">from</span> mcp.client.stdio <span class="hljs-keyword">import</span> stdio_client
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_filesystem_operations</span>():
    <span class="hljs-string">"""Test MCP Filesystem Server operations."""</span>
    <span class="hljs-comment"># Configure connection to containerized MCP server</span>
    server_params = StdioServerParameters(
        command=<span class="hljs-string">"docker"</span>,
        args=[
            <span class="hljs-string">"exec"</span>, <span class="hljs-string">"-i"</span>,
            <span class="hljs-string">"sandbox-sandbox-os-1"</span>,  <span class="hljs-comment"># Container name</span>
            <span class="hljs-string">"npx"</span>, <span class="hljs-string">"-y"</span>, <span class="hljs-string">"@modelcontextprotocol/server-filesystem"</span>,
            <span class="hljs-string">"/root/shared/workspace"</span>
        ],
        env=<span class="hljs-literal">None</span>
    )

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🔌 Connecting to MCP Filesystem Server..."</span>)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> stdio_client(server_params) <span class="hljs-keyword">as</span> (read, write):
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> ClientSession(read, write) <span class="hljs-keyword">as</span> session:
            <span class="hljs-comment"># 1. Initialize connection</span>
            <span class="hljs-keyword">await</span> session.initialize()

            <span class="hljs-comment"># 2. List available tools</span>
            tools = <span class="hljs-keyword">await</span> session.list_tools()
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✨ Connected! Found <span class="hljs-subst">{<span class="hljs-built_in">len</span>(tools.tools)}</span> filesystem tools"</span>)

            <span class="hljs-comment"># 3. Test directory listing</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"📁 Listing workspace directory..."</span>)
            dir_result = <span class="hljs-keyword">await</span> session.call_tool(<span class="hljs-string">"read_directory"</span>, {
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"."</span>
            })
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Directory contents: <span class="hljs-subst">{dir_result}</span>"</span>)

            <span class="hljs-comment"># 4. Test file creation</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"📝 Creating test file..."</span>)
            <span class="hljs-keyword">await</span> session.call_tool(<span class="hljs-string">"write_file"</span>, {
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"test_file.txt"</span>,
                <span class="hljs-string">"content"</span>: <span class="hljs-string">"Hello from MCP Filesystem!"</span>
            })

            <span class="hljs-comment"># 5. Test file reading</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"📖 Reading test file..."</span>)
            file_result = <span class="hljs-keyword">await</span> session.call_tool(<span class="hljs-string">"read_file"</span>, {
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"test_file.txt"</span>
            })
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"File content: <span class="hljs-subst">{file_result}</span>"</span>)

            <span class="hljs-comment"># 6. Test file search and replace</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"🔍 Testing search and replace..."</span>)
            <span class="hljs-keyword">await</span> session.call_tool(<span class="hljs-string">"search_replace"</span>, {
                <span class="hljs-string">"file_path"</span>: <span class="hljs-string">"test_file.txt"</span>,
                <span class="hljs-string">"old_string"</span>: <span class="hljs-string">"Hello from MCP Filesystem!"</span>,
                <span class="hljs-string">"new_string"</span>: <span class="hljs-string">"Modified by MCP Filesystem Server!"</span>
            })

            <span class="hljs-comment"># 7. Verify modification</span>
            modified_result = <span class="hljs-keyword">await</span> session.call_tool(<span class="hljs-string">"read_file"</span>, {
                <span class="hljs-string">"path"</span>: <span class="hljs-string">"test_file.txt"</span>
            })
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Modified content: <span class="hljs-subst">{modified_result}</span>"</span>)

            <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ All filesystem operations completed successfully!"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(test_filesystem_operations())
</code></pre>
<p><a id="user-content-performance-validation" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h4 data-id="heading-24">性能和安全验证</h4>
<p><strong>性能测试</strong>：</p>
<ul>
<li><strong>文件大小限制</strong>：测试大文件的读取性能</li>
<li><strong>并发操作</strong>：测试多个文件操作的并发处理</li>
<li><strong>搜索效率</strong>：测试在大型代码库中的搜索性能</li>
</ul>
<p><strong>安全验证</strong>：</p>
<ul>
<li><strong>路径遍历防护</strong>：确保无法访问 <code>../</code> 等上级目录</li>
<li><strong>权限检查</strong>：验证文件权限的正确处理</li>
<li><strong>资源限制</strong>：测试对大文件的处理限制</li>
</ul>
<hr/>
<p><a id="user-content-filesystem-faq" title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="/></p>
<h3 data-id="heading-25">常见问题 FAQ</h3>
<p><strong>Q: MCP Filesystem 和传统的文件操作工具有什么区别？</strong></p>
<p>A: MCP Filesystem 提供了标准化的 AI 友好的接口。传统的文件操作工具（如 <code>cat</code>, <code>ls</code>, <code>sed</code>）需要 AI 理解 shell 命令，而 MCP Filesystem 直接提供语义化的工具（如 <code>read_file</code>, <code>search_replace</code>），让 AI 能够更直观地表达意图。</p>
<p><strong>Q: 如何处理大文件？</strong></p>
<p>A: MCP Filesystem 内置了文件大小限制（通常在几MB以内）。对于超大文件，服务器会返回错误提示。建议将大文件拆分处理，或使用流式处理方式。</p>
<p><strong>Q: 支持哪些文件编码？</strong></p>
<p>A: 主要支持 UTF-8 编码。对于其他编码的文件，需要在读取时指定编码参数，或预先转换编码。</p>
<p><strong>Q: 如何处理二进制文件？</strong></p>
<p>A: MCP Filesystem 主要设计用于文本文件。对于二进制文件（如图片、压缩包），建议使用其他专门的工具。服务器会检测文件类型并给出相应提示。</p>
<p><strong>Q: 文件权限如何处理？</strong></p>
<p>A: 服务器会检查文件权限，但不会尝试提升权限。如果 AI 需要修改只读文件，需要先通过 shell 工具修改文件权限。</p>
<p><strong>Q: 如何实现文件的版本控制？</strong></p>
<p>A: MCP Filesystem 本身不提供版本控制功能。但 AI 可以结合 git 命令（通过 MCP Shell）来实现文件的版本管理。</p>
<hr/>
<h3 data-id="heading-26">📝 结语</h3>
<p>通过集成 MCP Filesystem，我们的沙盒环境从"命令执行器"进化为真正的"文件专家"。AI Agent 现在不仅能运行命令，还能深入理解和修改代码，成为开发者的真正合作伙伴。</p>
<p>在下一篇文章中，我们将探讨 <strong>MCP Manager</strong> 的实现，看看 AI 如何智能地管理其他 MCP 服务器，实现更高级的元编程能力。</p>
<hr/>
<h3 data-id="heading-27">📚 技术参考</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fserver-filesystem" target="_blank" title="https://github.com/modelcontextprotocol/server-filesystem" ref="nofollow noopener noreferrer">MCP Filesystem Server 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fspecification" target="_blank" title="https://modelcontextprotocol.io/specification" ref="nofollow noopener noreferrer">MCP 协议规范</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Ffs.html" target="_blank" title="https://nodejs.org/api/fs.html" ref="nofollow noopener noreferrer">Node.js 文件系统 API</a></li>
</ul>
<hr/>
<p><strong>实现时间</strong>: 2026-01-23
<strong>MCP 工具数量</strong>: 8 个文件操作工具
<strong>安全等级</strong>: 🛡️ 高 (路径限制 + 权限检查)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis高级特性实战：从Bitmaps到位操作的应用场景]]></title>    <link>https://juejin.cn/post/7598370121436102706</link>    <guid>https://juejin.cn/post/7598370121436102706</guid>    <pubDate>2026-01-23T09:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598370121436102706" data-draft-id="7490846852620779535" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis高级特性实战：从Bitmaps到位操作的应用场景"/> <meta itemprop="keywords" content="Redis,数据库,性能优化"/> <meta itemprop="datePublished" content="2026-01-23T09:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go高并发架构_王工"/> <meta itemprop="url" content="https://juejin.cn/user/446863555701561"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis高级特性实战：从Bitmaps到位操作的应用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/446863555701561/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go高并发架构_王工
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:42:11.000Z" title="Fri Jan 23 2026 09:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">文章引言</h4>
<p>提到Redis，大家脑海中浮现的可能是它作为高性能键值存储的经典形象：一个轻量、快速的内存数据库，完美胜任缓存、会话管理等场景。然而，Redis的魅力远不止于此。随着版本迭代，它从最初的简单键值对工具，逐步演化为一个功能丰富的数据结构瑞士军刀。今天，我们要聊的主角——<strong>Bitmaps和位操作</strong>，正是Redis高级特性中一颗低调却耀眼的明珠。</p>
<p>对于已经有1-2年Redis使用经验的开发者来说，基础的<code>SET</code>、<code>GET</code>、<code>HSET</code>早已驾轻就熟，但你是否曾好奇：如何用更少的内存完成海量数据的统计？如何在高并发场景下实现高效的状态标记？Bitmaps和位操作正是解决这类问题的利器。它们以极致的内存效率和高性能计算能力，打开了Redis应用场景的新大门。无论是记录用户签到、统计实时在线人数，还是实现权限控制，Bitmaps都能让你在资源有限的情况下，做到“以一当十”。</p>
<p>作为一名有10年Redis实战经验的老兵，我曾在无数项目中见证Bitmaps的威力，也踩过不少坑——从内存超限的尴尬，到命令误用的性能陷阱。这些经验让我深刻体会到</p>
<p>，技术的高级特性只有在实践中落地，才能真正发挥价值。本文的目标，就是带你从Bitmaps的基础知识出发，深入剖析其核心优势，再通过真实案例展示它的应用场景，最后分享一些踩坑教训和优化建议。无论你是想提升技术深度，还是在项目中寻找高效解法，这篇文章都希望成为你的“实战指南”。</p>
<p>文章的结构安排如下：我们先快速回顾Bitmaps和位操作的基础知识，确保起跑线一致；接着深入探讨其特色功能和优势，带你理解“为什么用它”；然后通过四个实战场景，展示“怎么用它”；最后结合最佳实践和踩坑经验，帮你少走弯路。全文约4700字，既有干货也有故事，希望你读完后能有所收获，甚至跃跃欲试地在自己的项目中一展身手。</p>
<p>准备好了吗？让我们一起解锁Redis Bitmaps的隐藏技能，从内存中的“位世界”出发，探索它的无限可能吧！</p>
<hr/>
<h3 data-id="heading-1">一、Bitmaps和位操作基础回顾</h3>
<p>在深入探讨Bitmaps的实战应用之前，我们先来打好地基，回顾一下它的基础知识。对于已经熟悉Redis的开发者来说，这部分可能是“老朋友见面”，但即使是老朋友，也有值得细细品味的细节。Bitmaps和位操作看似简单，却藏着Redis设计哲学中的精髓：用最小的资源，解决最大的问题。</p>
<h4 data-id="heading-2">1. 什么是Bitmaps</h4>
<p>Bitmaps在Redis中并不是一个独立的数据类型，而是基于字符串（String）实现的位数组。简单来说，它就像一张巨大的表格，但每个格子只能存0或1——要么是“开”，要么是“关”。通过位偏移（offset），你可以精确地定位到某个位，设置或读取它的值。</p>
<p>Redis提供了几个基础命令来操作Bitmaps：</p>
<ul>
<li><strong><code>SETBIT key offset value</code></strong>：将指定偏移量的位设置为0或1。</li>
<li><strong><code>GETBIT key offset</code></strong>：读取指定偏移量的位值。</li>
<li><strong><code>BITCOUNT key [start end]</code></strong>：统计指定范围内1的个数。</li>
<li><strong><code>BITOP operation destkey key [key ...]</code></strong>：对多个Bitmaps执行位运算（如AND、OR、XOR、NOT）。</li>
</ul>
<p><strong>内存效率</strong>是Bitmaps的一大亮点。假设你要记录1亿个用户的某种状态（例如是否活跃），用Bitmaps只需要大约12MB内存（1亿位 ÷ 8 ≈ 12.5MB）。相比之下，用Set或List存储同样的数据，内存占用可能是它的几十倍。这种“以小博大”的特性，让Bitmaps在大数据场景下大放异彩。</p>
<h4 data-id="heading-3">2. 位操作简介</h4>
<p>Bitmaps不仅能存，还能算。Redis支持的位操作包括：</p>
<ul>
<li><strong>AND</strong>：交集运算，找出多个Bitmaps中共同为1的位。</li>
<li><strong>OR</strong>：并集运算，合并多个Bitmaps中的1。</li>
<li><strong>XOR</strong>：异或运算，找出差异部分。</li>
<li><strong>NOT</strong>：取反运算，将0变为1，1变为0。</li>
</ul>
<p>相比传统数据结构，位操作的优势在于它的“原子性”和“高效性”。例如，用Set实现交集需要<code>SINTER</code>，而Bitmaps用<code>BITOP AND</code>，后者在底层直接操作位，速度更快，内存占用更低。</p>























<table><thead><tr><th>数据结构</th><th>交集操作</th><th>内存占用（1亿用户）</th><th>计算复杂度</th></tr></thead><tbody><tr><td>Set</td><td><code>SINTER</code></td><td>~数百MB</td><td>O(N)</td></tr><tr><td>Bitmaps</td><td><code>BITOP AND</code></td><td>~12MB</td><td>O(位长度)</td></tr></tbody></table>
<h4 data-id="heading-4">3. 适用场景初探</h4>
<p>Bitmaps的适用场景可以用一句话概括：<strong>需要高效存储和计算大量二值状态的场景</strong>。比如：</p>
<ul>
<li><strong>数据统计</strong>：统计每日活跃用户数。</li>
<li><strong>状态标记</strong>：记录用户是否签到、是否在线。</li>
<li><strong>实时分析</strong>：分析多组数据的交集或并集。</li>
</ul>
<p>它就像一个“轻量级计算器”，在内存和性能之间找到了绝妙的平衡点。</p>
<h4 data-id="heading-5">4. 示例代码</h4>
<p>让我们通过一个简单的例子上手Bitmaps。假设我们要记录2025年4月8日用户的活跃状态，用户ID为10086：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置用户10086为活跃（1表示活跃，0表示不活跃）</span>
SETBIT user:active:20250408 10086 1

<span class="hljs-comment"># 查询用户10086是否活跃</span>
GETBIT user:active:20250408 10086
<span class="hljs-comment"># 返回：1</span>

<span class="hljs-comment"># 统计当天活跃用户总数</span>
BITCOUNT user:active:20250408
<span class="hljs-comment"># 返回：活跃用户数量</span>
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>SETBIT</code>的offset是用户ID，直接用整数表示。</li>
<li><code>GETBIT</code>返回0或1，简单直观。</li>
<li><code>BITCOUNT</code>默认统计整个Bitmaps中1的个数。</li>
</ul>
<h4 data-id="heading-6">过渡小结</h4>
<p>通过上面的介绍，你可能已经感受到Bitmaps的简洁与强大。它不仅能存下海量数据，还能通过位操作完成复杂的计算。接下来，我们将深入剖析Bitmaps的特色功能，看看它在内存效率和高性能计算上的“独门绝技”，以及如何在实际项目中发挥作用。</p>
<hr/>
<h3 data-id="heading-7">二、Bitmaps和位操作的特色功能与优势</h3>
<p>掌握了Bitmaps的基础后，我们进入更精彩的部分：它的特色功能和独特优势。如果说Bitmaps是一个工具，那么它的内存效率和高性能计算就是“锋利的刀刃”，能在特定场景下轻松切开复杂问题。这一节，我们将从内存优化、性能表现和灵活性三个角度，带你看看Bitmaps为何能成为Redis高级特性中的“隐藏王牌”。</p>
<h4 data-id="heading-8">1. 内存效率的极致优化</h4>
<p>Bitmaps的最大卖点之一，就是它对内存的“吝啬”。在大数据量场景下，这种特性尤为突出。假设我们要存储1000万用户的某种状态（比如是否参与某活动），用Set和Bitmaps的内存占用对比如下：</p>




















<table><thead><tr><th>数据结构</th><th>内存占用（1000万用户）</th><th>示例Key格式</th></tr></thead><tbody><tr><td>Set</td><td>~200-300MB</td><td><code>SADD user:active 10086</code></td></tr><tr><td>Bitmaps</td><td>~1.25MB</td><td><code>SETBIT user:active 10086 1</code></td></tr></tbody></table>
<p><strong>为什么差距这么大？</strong><br/>
Set需要为每个元素存储完整的字符串键，而Bitmaps只用1位表示一个状态，相当于把数据“压缩”到了极致。1亿位仅需12.5MB，10亿位也不过125MB，这种效率让它在存储大规模二值数据时无出其右。</p>
<p><strong>实战经验</strong>：在一次电商活动中，我曾用Bitmaps记录1000万用户的领取状态，内存占用仅1.2MB，而用Set时直接飙升到250MB，差点把Redis实例撑爆。Bitmaps不仅省钱（内存就是服务器成本），还让系统更稳定。</p>
<h4 data-id="heading-9">2. 高性能位运算</h4>
<p>Bitmaps的另一个杀手锏是它的位运算能力。Redis的<code>BITOP</code>命令可以在多个Bitmaps间执行AND、OR、XOR等操作，而且是原子的，性能极高。以统计两天活跃用户的交集为例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 假设有两个Bitmaps记录两天用户的活跃状态</span>
SETBIT user:active:20250408 10086 1
SETBIT user:active:20250407 10086 1
SETBIT user:active:20250407 10087 1

<span class="hljs-comment"># 计算两天都活跃的用户交集</span>
BITOP AND result user:active:20250408 user:active:20250407

<span class="hljs-comment"># 统计交集人数</span>
BITCOUNT result
<span class="hljs-comment"># 返回：1（只有10086两天都活跃）</span>
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>BITOP AND</code>将两个Bitmaps逐位相与，结果存入<code>result</code>。</li>
<li><code>BITCOUNT</code>计算<code>result</code>中1的总数。</li>
</ul>
<p><strong>性能分析</strong>：在单机环境下，位运算的复杂度是O(N)，N为Bitmaps的位长度。但由于底层用的是位级操作，实际延迟非常低。我曾在4MB的Bitmaps上做交集运算，耗时不到10ms。而同样的数据用Set的<code>SINTER</code>，耗时可能是它的5-10倍。</p>
<p><strong>分布式场景的局限</strong>：如果Bitmaps分布在不同Redis实例上，<code>BITOP</code>无法直接跨节点执行。这时需要客户端拉取数据后自行计算，性能会打折扣。解决办法是用Redis Cluster分片存储，但需提前规划Key分布。</p>
<h4 data-id="heading-10">3. 灵活性与扩展性</h4>
<p>Bitmaps的位偏移设计赋予了它惊人的灵活性。你可以把一个Bitmaps想象成一张“多维表格”，通过偏移量表示不同的状态或维度。例如：</p>
<ul>
<li>偏移0-31表示某用户32天的签到状态。</li>
<li>偏移0表示读权限，1表示写权限，2表示执行权限。</li>
</ul>
<p>这种设计让Bitmaps能轻松应对多维数据存储需求。甚至可以结合其他数据结构进一步扩展功能，比如用HyperLogLog估算基数，再用Bitmaps精确统计。</p>
<p><strong>示意图</strong>：Bitmaps的多维存储示例</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">偏移量:  0  1  2  3  4  5  ...</span>
<span class="hljs-section">含义:   读 写 执行 ...  天1 天2 ...</span>
<span class="hljs-section">值:     1  0  1  0  1  1  ...</span>
</code></pre>
<h4 data-id="heading-11">4. 代码示例：实战中的灵活应用</h4>
<p>假设我们要统计某活动连续两天的活跃用户，并与昨天的在线用户做并集：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置活跃用户</span>
SETBIT active:20250408 10086 1
SETBIT active:20250407 10086 1
SETBIT online:20250407 10087 1

<span class="hljs-comment"># 计算两天活跃交集</span>
BITOP AND active_both active:20250408 active:20250407

<span class="hljs-comment"># 再与昨天在线用户合并</span>
BITOP OR final_result active_both online:20250407

<span class="hljs-comment"># 统计总数</span>
BITCOUNT final_result
<span class="hljs-comment"># 返回：2（10086和10087）</span>
</code></pre>
<p><strong>代码注释</strong>：</p>
<ul>
<li><code>BITOP AND</code>找出连续活跃用户。</li>
<li><code>BITOP OR</code>合并其他状态，扩展分析维度。</li>
</ul>
<h4 data-id="heading-12">过渡小结</h4>
<p>通过内存效率、高性能位运算和灵活性的剖析，Bitmaps的优势已经跃然纸上。它就像一个“空间魔法师”，用最小的内存承载最多的信息；又像一个“计算忍者”，在毫秒间完成复杂运算。接下来，我们将走进真实的实战场景，看看这些特性如何在项目中落地生根，解决实际问题。</p>
<hr/>
<h3 data-id="heading-13">三、实战场景：Bitmaps和位操作的应用案例</h3>
<p>理论和特性讲得再多，不如实际用起来来得痛快。这一节，我们将走进四个真实的实战场景，看看Bitmaps和位操作如何在项目中大显身手。从用户签到到在线统计，再到权限管理和大数据分析，每个案例都来自我的实际经验，带着“血泪教训”和优化心得，希望能给你带来启发。</p>
<h4 data-id="heading-14">1. 场景1：用户签到系统</h4>
<p><strong>需求</strong>：在一个社区应用中，需要记录每个用户的每日签到状态，并支持统计连续签到天数和总签到次数。<br/>
<strong>实现</strong>：用Bitmaps按用户和时间存储签到记录，每个用户一个Key，偏移量表示天数。<br/>
<strong>示例代码</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 用户10086在2025年第98天签到</span>
SETBIT signin:10086:2025 98 1

<span class="hljs-comment"># 查询第98天是否签到</span>
GETBIT signin:10086:2025 98
<span class="hljs-comment"># 返回：1</span>

<span class="hljs-comment"># 统计全年签到次数</span>
BITCOUNT signin:10086:2025
<span class="hljs-comment"># 返回：签到天数</span>
</code></pre>
<p><strong>实现细节</strong>：</p>
<ul>
<li>Key格式：<code>signin:&lt;user_id&gt;:&lt;year&gt;</code>。</li>
<li>偏移量：0-364表示一年365天（从0开始计数）。</li>
<li>内存占用：每个用户一年只需365位，约46字节。</li>
</ul>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>内存效率高</strong>：100万用户一年仅需约44MB。</li>
<li><strong>查询快</strong>：<code>GETBIT</code>和<code>BITCOUNT</code>都是O(1)或O(N)级别，N为位长度。</li>
</ul>
<p><strong>踩坑经验</strong>：<br/>
我在早期设计时没考虑跨年问题，导致年底数据查询需要拼接两个Key。后来改为按年分片，并在客户端封装逻辑：如果查询跨年，则分别取<code>signin:10086:2024</code>和<code>signin:10086:2025</code>，再合并结果。</p>
<h4 data-id="heading-15">2. 场景2：实时在线用户统计</h4>
<p><strong>需求</strong>：某直播平台需要统计某活动每小时的在线人数，并与历史数据对比。<br/>
<strong>实现</strong>：用Bitmaps记录每小时的在线状态，<code>BITOP</code>计算交集或并集。<br/>
<strong>示例代码</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 记录上午和下午的在线用户</span>
SETBIT online:20250408:am 10086 1
SETBIT online:20250408:pm 10086 1
SETBIT online:20250408:pm 10087 1

<span class="hljs-comment"># 计算全天在线用户（并集）</span>
BITOP OR daily_active online:20250408:am online:20250408:pm

<span class="hljs-comment"># 统计人数</span>
BITCOUNT daily_active
<span class="hljs-comment"># 返回：2</span>

<span class="hljs-comment"># 与昨天对比（交集）</span>
BITOP AND active_overlap daily_active online:20250407:full
BITCOUNT active_overlap
</code></pre>
<p><strong>实现细节</strong>：</p>
<ul>
<li>Key按时间分片：<code>online:&lt;date&gt;:&lt;time&gt;</code>。</li>
<li>用户ID作为偏移量，1表示在线。</li>
</ul>
<p><strong>最佳实践</strong>：</p>
<ul>
<li><strong>时间分片</strong>：避免单Key过大，我曾因用<code>online:20250408</code>存全天数据，导致Key膨胀到几十MB，<code>BITCOUNT</code>变慢。后来改为按小时分片，性能提升明显。</li>
<li><strong>Pipeline优化</strong>：批量设置在线状态时，用Pipeline减少网络开销。</li>
</ul>
<p><strong>示意图</strong>：在线状态分片</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Key: online:20250408:am  | 偏移: 10086 10087 ...</span>
<span class="hljs-section">值:                  1        0    ...</span>
<span class="hljs-section">Key: online:20250408:pm  | 值:   1     1    ...</span>
</code></pre>
<h4 data-id="heading-16">3. 场景3：权限控制与状态标记</h4>
<p><strong>需求</strong>：为用户分配多维度权限（读、写、执行等），并快速检查权限状态。<br/>
<strong>实现</strong>：用Bitmaps的位偏移表示不同权限，一个Key管理所有状态。<br/>
<strong>示例代码</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置用户10086的权限：读(0)、写(1)、执行(2)</span>
SETBIT perms:10086 0 1  <span class="hljs-comment"># 读权限</span>
SETBIT perms:10086 1 1  <span class="hljs-comment"># 写权限</span>
SETBIT perms:10086 2 0  <span class="hljs-comment"># 无执行权限</span>

<span class="hljs-comment"># 检查读权限</span>
GETBIT perms:10086 0
<span class="hljs-comment"># 返回：1</span>
</code></pre>
<p><strong>实现细节</strong>：</p>
<ul>
<li>偏移量约定：0=读，1=写，2=执行，可扩展到更多位。</li>
<li>内存占用：10种权限仅需10位，1个用户不到2字节。</li>
</ul>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>单Key管理</strong>：相比Hash（<code>HSET perms:10086 read 1</code>），Bitmaps更紧凑。</li>
<li><strong>扩展性强</strong>：新增权限只需增加偏移量。</li>
</ul>
<p><strong>踩坑经验</strong>：<br/>
早期我没规划好偏移量，后来业务新增权限时，偏移定义冲突，只能重建数据。<strong>教训</strong>：提前设计位分配表，例如用0-15位预留16种权限。</p>
<h4 data-id="heading-17">4. 场景4：大数据量下的去重与交集分析</h4>
<p><strong>需求</strong>：分析某广告投放的两组用户重合度（如A渠道和B渠道的曝光用户）。<br/>
<strong>实现</strong>：Bitmaps存储用户ID，<code>BITOP</code>计算交集。<br/>
<strong>示例代码</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 记录A、B渠道用户</span>
SETBIT ad:channel_a 10086 1
SETBIT ad:channel_a 10087 1
SETBIT ad:channel_b 10086 1

<span class="hljs-comment"># 计算重合用户</span>
BITOP AND ad_overlap ad:channel_a ad:channel_b
BITCOUNT ad_overlap
<span class="hljs-comment"># 返回：1（10086重合）</span>
</code></pre>
<p><strong>性能分析</strong>：</p>
<ul>
<li>测试数据：1000万用户，两个Bitmaps各1.25MB。</li>
<li><code>BITOP AND</code>耗时约15ms，<code>BITCOUNT</code>约5ms，总延迟不到20ms。</li>
<li>用Set的<code>SINTER</code>耗时约150ms，内存占用高10倍。</li>
</ul>
<p><strong>踩坑经验</strong>：<br/>
我曾因<code>BITCOUNT</code>全量扫描大Key，导致响应变慢。后来发现可以用<code>BITCOUNT start end</code>指定范围，或者用Lua脚本分段统计，避免性能陷阱。</p>
<h4 data-id="heading-18">过渡小结</h4>
<p>这四个场景展示了Bitmaps的多样性和实用性：从签到的“轻量存储”，到在线统计的“实时计算”，再到权限管理的“紧凑设计”和大数据的“高效分析”，它总能找到用武之地。但光会用还不够，接下来的最佳实践和踩坑经验，将帮你把Bitmaps用得更稳、更快。</p>
<hr/>
<h3 data-id="heading-19">四、最佳实践与踩坑经验</h3>
<p>Bitmaps虽然强大，但用得好需要一些“门道”。通过前面场景的实战，我们已经感受到它的潜力，但也暴露出一些潜在问题，比如内存管理、性能瓶颈和分布式场景的挑战。这一节，我将结合10年Redis经验，分享最佳实践和踩坑教训，帮助你在项目中把Bitmaps用得又稳又快。</p>
<h4 data-id="heading-20">1. 最佳实践</h4>
<p>要让Bitmaps发挥最大价值，以下几点值得铭记：</p>
<ul>
<li>
<p><strong>Key设计规范：分片是王道</strong><br/>
单Key过大是Bitmaps使用中的常见隐患。比如记录在线用户时，如果用<code>online:20250408</code>存全天数据，Key可能膨胀到几十MB，拖慢操作。<br/>
<strong>建议</strong>：按时间或地域分片，例如<code>online:20250408:am</code>和<code>online:20250408:pm</code>，每个Key控制在1-5MB以内，既便于管理，又提升性能。</p>
</li>
<li>
<p><strong>性能优化：批量操作提速</strong><br/>
高并发场景下，频繁调用<code>SETBIT</code>会增加网络开销。<br/>
<strong>解决办法</strong>：用Pipeline批量提交，例如：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Pipeline批量设置</span>
redis-cli -h host -p port &lt;&lt;<span class="hljs-string">EOF
SETBIT online:20250408:am 10086 1
SETBIT online:20250408:am 10087 1
EOF</span>
</code></pre>
<p><strong>效果</strong>：一次RTT（往返时间）完成多条命令，吞吐量提升3-5倍。</p>
</li>
<li>
<p><strong>容错设计：Lua脚本保原子性</strong><br/>
Bitmaps操作虽快，但多步操作（如先<code>SETBIT</code>再<code>BITOP</code>）可能因并发导致数据不一致。<br/>
<strong>示例</strong>：批量设置并统计：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-keyword">local</span> key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> offsets = ARGV
<span class="hljs-keyword">for</span> i, offset <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(offsets) <span class="hljs-keyword">do</span>
    redis.call(<span class="hljs-string">'SETBIT'</span>, key, offset, <span class="hljs-number">1</span>)
<span class="hljs-keyword">end</span>
<span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">'BITCOUNT'</span>, key)
</code></pre>
<p><strong>用法</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">EVAL <span class="hljs-string">"script"</span> 1 online:20250408:am 10086 10087
</code></pre>
<p><strong>优势</strong>：保证原子性，避免中间状态被其他线程干扰。</p>
</li>
</ul>
<h4 data-id="heading-21">2. 踩坑经验</h4>
<p>实战中，我踩过不少坑，以下是几个典型案例和解决方案：</p>
<ul>
<li>
<p><strong>内存超限：未预估数据增长导致OOM</strong><br/>
在一个广告分析项目中，我用Bitmaps存储用户曝光数据，初始规模1000万用户，内存可控。但随着业务增长到1亿用户，单Key膨胀到12MB以上，触发Redis的maxmemory限制，导致OOM（Out Of Memory）。<br/>
<strong>解决办法</strong>：</p>
<ul>
<li>提前预估数据规模，设置合理的maxmemory-policy（如<code>volatile-lru</code>）。</li>
<li>用分片策略，比如按渠道或日期拆分Key：<code>ad:channel_a:202504</code>和<code>ad:channel_b:202504</code>。</li>
</ul>
</li>
<li>
<p><strong>命令误用：BITCOUNT全量扫描的性能陷阱</strong><br/>
在统计在线人数时，我直接用<code>BITCOUNT online:20250408</code>，Key有10MB，耗时几十毫秒，拖慢响应。<br/>
<strong>教训</strong>：<code>BITCOUNT</code>默认扫描整个Key，复杂度O(N)。<br/>
<strong>优化</strong>：</p>
<ul>
<li>指定范围：<code>BITCOUNT online:20250408 0 1000000</code>只统计前100万位。</li>
<li>分段计算：用Lua脚本分批处理大Key。</li>
</ul>
</li>
<li>
<p><strong>分布式问题：多实例下Bitmaps同步的挑战</strong><br/>
在Redis Cluster中，Bitmaps分布在不同节点，<code>BITOP</code>无法跨槽执行，导致交集计算失败。<br/>
<strong>解决办法</strong>：</p>
<ul>
<li>设计Key时加槽标签：<code>{20250408}:active</code>，确保相关Key落在同一节点。</li>
<li>或客户端拉取数据后本地计算，但需权衡网络开销。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-22">3. 与业务结合的思考</h4>
<p>Bitmaps并非万能，选择它还是其他结构，需结合业务需求：</p>
<ul>
<li><strong>Bitmaps适合</strong>：二值状态、大数据量、低内存需求（如签到、在线状态）。</li>
<li><strong>其他结构更优</strong>：多值状态（如Hash）、频繁增删（如List）、精确去重（如Set）。<br/>
<strong>高并发场景</strong>：考虑读写分离，写操作用Bitmaps记录，读操作异步同步到只读实例，减轻主节点压力。</li>
</ul>
<h4 data-id="heading-23">过渡小结</h4>
<p>通过这些实践和教训，我们可以看到，Bitmaps的威力在于它的简洁高效，但也需要精心设计和管理。掌握了Key分片、批量优化和容错技巧，你就能避开常见陷阱，让它成为项目中的“得力助手”。接下来，我们将总结全文，展望Bitmaps的未来可能性。</p>
<hr/>
<h3 data-id="heading-24">五、总结与展望</h3>
<p>经过从基础到实战的全面探索，我们已经对Redis的Bitmaps和位操作有了深入的认识。作为Redis高级特性中的一员，Bitmaps以其独特的设计和强大的功能，在众多场景中证明了自己的价值。这一节，我们将总结它的核心优势，梳理实战经验，并展望未来的可能性，希望为你留下一些启发。</p>
<h4 data-id="heading-25">1. 总结要点</h4>
<p>Bitmaps的核心优势可以用两个词概括：<strong>内存效率</strong>和<strong>高性能</strong>。它用最小的空间（1亿位仅12MB）承载海量数据，用位运算（<code>BITOP</code>、<code>BITCOUNT</code>）实现毫秒级的计算。这种“以小博大”的能力，让它在用户签到、在线统计、权限管理和大数据分析等场景中游刃有余。</p>
<ul>
<li><strong>实战场景的广泛性</strong>：从轻量级的状态标记，到复杂的交集分析，Bitmaps都能胜任。</li>
<li><strong>局限性</strong>：单Key过大、分布式场景的同步问题，需要通过分片和设计规避。</li>
<li><strong>经验价值</strong>：我分享的踩坑教训（内存超限、命令误用）和优化建议（Pipeline、Lua脚本），是10年实战的结晶，希望能帮你少走弯路。</li>
</ul>
<h4 data-id="heading-26">2. 展望</h4>
<p>随着Redis的不断演进，Bitmaps的潜力还有待挖掘：</p>
<ul>
<li><strong>新版本增强</strong>：Redis 7.0已优化内存管理和命令性能，未来可能为Bitmaps引入更多专用功能，比如支持稀疏存储或更高效的范围查询。</li>
<li><strong>AI/ML场景</strong>：Bitmaps可以用来存储用户行为特征（例如点击、浏览的二值状态），结合机器学习模型做实时预测，是一个值得探索的方向。</li>
<li><strong>生态融合</strong>：与Redis Stream或Graph结合，Bitmaps可能在时序分析或关系计算中找到新舞台。</li>
</ul>
<h4 data-id="heading-27">3. 个人使用心得</h4>
<p>用Bitmaps的这些年，我最大的体会是：<strong>简单即强大</strong>。它没有复杂的结构，却能解决复杂的问题。但前提是你得“懂它”——理解它的适用边界，设计好Key和偏移，才能让它发挥最大价值。每次踩坑后优化成功，那种“柳暗花明”的感觉，也是技术成长的乐趣所在。</p>
<h4 data-id="heading-28">4. 鼓励互动</h4>
<p>Bitmaps的应用远不止本文提到的场景。你是否在项目中用过它？是记录签到，还是分析数据？欢迎在评论区分享你的经验，或者告诉我你在使用中遇到的问题，我们一起探讨更优解法。技术因分享而进步，希望这篇文章能成为你探索Redis深度的起点！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果iOS应用上架详细流程与注意事项解析]]></title>    <link>https://juejin.cn/post/7598193992828780598</link>    <guid>https://juejin.cn/post/7598193992828780598</guid>    <pubDate>2026-01-23T09:49:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598193992828780598" data-draft-id="7598366933079359542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果iOS应用上架详细流程与注意事项解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-23T09:49:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果iOS应用上架详细流程与注意事项解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:49:56.000Z" title="Fri Jan 23 2026 09:49:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">苹果ios上架操作办法介绍</h2>
<p>苹果iOS上架是指将开发者开发的应用程序提交到苹果公司的App Store中，经过审核后使应用程序能够在App Store中正式上架并供用户下载使用。下面将详细介绍iOS上架的流程和注意事项。</p>
<p>一、开发阶段</p>
<p>在开发阶段，开发者需要遵循苹果公司的相关规定和要求进行开发。具体包括：</p>
<p>1.使用Apple官方提供的开发工具Xcode进行开发。</p>
<p>2.遵循苹果公司的人机交互设计指南，设计符合用户体验的应用程序。</p>
<p>3.遵循苹果公司的编码规范，编写符合规范的代码。</p>
<p>4.遵循苹果公司的隐私政策和数据保护要求，保护用户隐私。</p>
<p>5.在应用程序中集成Apple提供的支付和广告服务。</p>
<p>二、提交应用程序</p>
<p>在开发完成后，开发者需要将应用程序提交到苹果公司的App Store中进行审核。具体操作如下：</p>
<p>1.注册成为苹果开发者。</p>
<p>2.在Apple开发者网站中创建App ID，并为应用程序申请证书和描述文件。</p>
<p>3.在Xcode中打包应用程序并生成IPA文件。</p>
<p>4.在Apple开发者网站中创建App Store Connect记录，并上传IPA文件。</p>
<p>使用AppUploader工具可以简化IPA文件的上传过程，它支持在Windows、Mac或Linux系统中直接上传IPA文件到App Store，无需Mac电脑或Xcode，提高上传效率。</p>
<p>5.填写应用程序的相关信息，包括名称、描述、图标、截图、价格等。</p>
<p>6.提交应用程序进行审核。</p>
<p>三、审核阶段</p>
<p>苹果公司的审核过程通常需要1-2周时间，审核过程中开发者需注意苹果调试证书相关事项：</p>
<p>1.遵循苹果公司的审核指南，确保应用程序符合规定和要求。</p>
<p>2.避免使用未经授权的第三方库和插件。</p>
<p>3.避免使用未经授权的商标和版权内容。</p>
<p>4.避免应用程序中存在功能缺陷和安全漏洞。</p>
<p>5.避免应用程序中存在欺诈和诈骗行为。</p>
<p>四、上架阶段</p>
<p>若应用程序审核通过，开发者可以在App Store中正式上架应用程序。具体操作如下：</p>
<p>1.在App Store Connect中设置应用程序的状态为“已上架”。</p>
<p>2.在App Store中搜索应用程序并确认应用程序的信息和价格。</p>
<p>3.用户可以下载和使用应用程序，开发者可以通过App Store Connect查看应用程序的下载量和收益。</p>
<p>总之，苹果iOS上架是一个需要遵循苹果公司相关规定和要求的过程，开发者需要保证应用程序的品质和安全性，确保用户能够获得良好的使用体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里云 RocketMQ 4.0 可观测最佳实践]]></title>    <link>https://juejin.cn/post/7598355220830011444</link>    <guid>https://juejin.cn/post/7598355220830011444</guid>    <pubDate>2026-01-23T09:58:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598355220830011444" data-draft-id="7598403436698271778" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里云 RocketMQ 4.0 可观测最佳实践"/> <meta itemprop="keywords" content="RocketMQ"/> <meta itemprop="datePublished" content="2026-01-23T09:58:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里云 RocketMQ 4.0 可观测最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-23T09:58:02.000Z" title="Fri Jan 23 2026 09:58:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">阿里云 RocketMQ 4.0 介绍</h2>
<p>阿里云 RocketMQ 4.0 产品是阿里云早期基于 Apache RocketMQ 构建的分布式消息中间件，主要面向企业级消息传递和异步解耦场景。RocketMQ 4.0 在发布时已具备高吞吐、低延迟、可扩展的核心特性，支持顺序消息、事务消息、定时/延时消息等多种能力，帮助开发者快速实现系统间的可靠通信。相比更高版本，RocketMQ 4.0 在弹性伸缩、可观测性和集成易用性方面能力有限，更多依赖人工运维和监控工具。但通过合理部署与监控，仍能够满足大多数分布式系统的消息传递需求，为业务提供基础的高可用性和可靠性保障。</p>
<h2 data-id="heading-1">观测云</h2>
<p>观测云是一款专为 IT 工程师打造的全链路可观测产品，它集成了基础设施监控、应用程序性能监控和日志管理，为整个技术栈提供实时可观察性。这款产品能够帮助工程师全面了解端到端的用户体验追踪，了解应用内函数的每一次调用，以及全面监控云时代的基础设施。此外，观测云还具备快速发现系统安全风险的能力，为数字化时代提供安全保障。</p>
<h3 data-id="heading-2">采集方法</h3>
<ol>
<li>登录观测云控制台</li>
<li>点击【集成】菜单，选择【云账号管理】</li>
<li>点击【添加云账号】，选择【阿里云】，填写界面所需的信息，如之前已配置过云账号信息，则忽略此步骤</li>
<li>点击【测试】，测试成功后点击【保存】，如果测试失败，请检查相关配置信息是否正确，并重新测试</li>
<li>点击【云账号管理】列表上可以看到已添加的云账号，点击相应的云账号，进入详情页</li>
<li>点击云账号详情页的【集成】按钮，在未安装列表下，找到阿里云 RocketMQ 4.0，点击【安装】按钮，弹出安装界面安装即可。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d66b684f97c045ea8f4dd6309c7b5e72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767081&amp;x-signature=IzjNdjAYEzD1ME0pSfbwSg%2FI9o8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">关键指标</h3>





















































































































<table><thead><tr><th>Metric Id</th><th>Metric Name</th><th>Dimensions</th><th>Statistics</th><th>Uni</th></tr></thead><tbody><tr><td>ReadyMessages</td><td>已就绪消息量(Group)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count</td></tr><tr><td>ReadyMessagesPerGidTopic</td><td>已就绪消息量(Group&amp;Topic)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count</td></tr><tr><td>ReceiveMessageCountPerGid</td><td>消费者每分钟接收消息数量(Group)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>ReceiveMessageCountPerGidTopic</td><td>消费者每分钟接收消息数量(Group&amp;Topic)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>ReceiveMessageCountPerInstance</td><td>消费者每分钟接收消息数的数量(Instance)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>ReceiveMessageCountPerTopic</td><td>消费者每分钟接收消息的数量(Topic)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>SendDLQMessageCountPerGid</td><td>每分钟产生死信消息的数量(Group)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>SendDLQMessageCountPerGidTopic</td><td>每分钟产生死信消息的数量(Group&amp;Topic)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>SendMessageCountPerInstance</td><td>生产者每分钟发送消息数量(Instance)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>SendMessageCountPerTopic</td><td>生产者每分钟发送消息数量(Topic)</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>count/min</td></tr><tr><td>ThrottledReceiveRequestsPerGid</td><td>每分钟(GroupId)消费被限流次数</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>counts/min</td></tr><tr><td>ThrottledReceiveRequestsPerGidTopic</td><td>每分钟(GroupId&amp;Topic)消费被限流次数</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>counts/min</td></tr><tr><td>ThrottledReceiveRequestsPerInstance</td><td>每分钟(Instance)消费被限流次数</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>counts/min</td></tr><tr><td>ThrottledSendRequestsPerInstance</td><td>每分钟(Instance)发送被限流次数</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>counts/min</td></tr><tr><td>ThrottledSendRequestsPerTopic</td><td>每分钟(Topic)发送被限流次数</td><td>account_name,InstanceName</td><td>Average,Maximum</td><td>counts/min</td></tr></tbody></table>
<h3 data-id="heading-4">场景视图</h3>
<p>登录<a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.guance.com%2F" target="_blank" title="https://console.guance.com/" ref="nofollow noopener noreferrer">观测云控制台</a>，点击「场景」 -「新建仪表板」，输入 “阿里云 RocketMQ”， 选择 “阿里云 RocketMQ4监控视图”，点击 “确定” 即可添加视图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1552bef83fd4e489458b8a38f3c52d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767081&amp;x-signature=L01cDLFCzCb6rVneat%2B9s5ikr6o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe0d56159610490daecf383a21fcb19a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767081&amp;x-signature=RblQ0OS1LXoTOItSqnlBNXa3qyU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">监控器（告警）</h3>
<h4 data-id="heading-6">ReadyMessagesPerGidTopic 消息堆积量异常</h4>
<p>简要描述：消息堆积量异常通常表示某个 Group 或 Group&amp;Topic 维度下的待消费消息数持续增加，说明消费者处理速度低于生产速度。这可能会导致消息延迟变大，甚至出现业务处理超时或丢弃风险。及时监控和处理堆积量异常，有助于发现消费性能瓶颈或消费者实例异常，保障消息系统的稳定性与业务的连续性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee3a5a8bee24b579a34842dd85585ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767081&amp;x-signature=OzQ%2FZ0lokYflI3AOgLwJpgg1v9o%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">ReceiveMessageCountPerGid / PerTopic</h4>
<p>简要描述：消费者接收消息速率异常通常表示某个 Group、Topic 或整个实例的消费吞吐量低于预期。这可能源于消费者宕机、线程不足、消费逻辑耗时过长或网络瓶颈。持续的消费速率下降会导致消息堆积增加，从而影响业务的实时性。监控该指标可帮助及时发现和定位消费环节的问题，确保生产与消费之间的速率平衡。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7993f40294154b49899d30b4cb33faf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769767081&amp;x-signature=tJ6igj%2BA%2FEqRn7Z5RTmSvwqU3ow%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">总结</h2>
<p>通过将阿里云 RocketMQ 4.0 的监控数据接入观测云，用户可实现更直观的运行监控与异常告警。观测云能够采集并展示消息堆积量、消费速率等关键指标，及时发现消费者性能瓶颈或消息延迟问题。借助智能告警与可视化视图，用户可快速定位异常、优化消费逻辑，从而提升系统稳定性与运维效率。整体而言，该方案帮助企业在传统 RocketMQ 4.0 环境下实现现代化可观测运维。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>